- en: Chapter 7\. GeoPandas and Spatial Statistics
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 7 章. GeoPandas 和空间统计
- en: Maps are beautiful. The stories they tell can be so captivating that it’s easy
    to unintentionally disregard the geospatial statistics within them. But geospatial
    maps are not simply static images. There is information embedded in them, such
    as attributes associated with a specific feature in a GIS layer or pixel densities
    observed in raster images.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 地图很美丽。它们讲述的故事可能如此迷人，以至于很容易无意中忽略其中的地理空间统计数据。但地理空间地图不仅仅是静态图像。其中嵌入了信息，例如与 GIS 图层中特定要素相关联的属性或在光栅图像中观察到的像素密度。
- en: 'Python has a variety of packages for working with geospatial data. If you are
    familiar with Python, you likely know [pandas](https://oreil.ly/j6YBd), a data
    analysis tool built specifically for Python. Pandas allows us to read a wide variety
    of data types into a dataframe: a set of tables containing rows (which denote
    records) and columns (denoting attributes). [GeoPandas](https://oreil.ly/pb8lC)
    is an extension of pandas that lets you manipulate geometric and geospatial data
    using what it calls a *GeoDataFrame:* a geospatial dataframe in which each row
    is a spatial feature, such as a point, line, or polygon.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: Python 有多种用于处理地理空间数据的包。如果您熟悉 Python，您可能已经了解 [pandas](https://oreil.ly/j6YBd)，这是一个专为
    Python 构建的数据分析工具。Pandas 允许我们将各种数据类型读入数据框中：一组包含行（表示记录）和列（表示属性）的表格。[GeoPandas](https://oreil.ly/pb8lC)
    是 pandas 的扩展，允许您使用其称为 *GeoDataFrame* 的方式操作几何和地理空间数据框架：每行是空间要素，如点、线或多边形。
- en: This chapter will show you how to analyze your data and create maps using GeoPandas
    and GeoDataFrames, as well as some other important packages, such as [matplotlib](https://matplotlib.org)
    to visualize data and Census Data API. You will also learn how to access geospatial
    files and delve deeper into demographic data by creating and comparing demographic
    maps.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将向您展示如何使用 GeoPandas 和 GeoDataFrame 分析数据并创建地图，以及一些其他重要的包，如 [matplotlib](https://matplotlib.org)
    用于可视化数据和人口普查数据 API。您还将学习如何访问地理空间文件，并通过创建和比较人口地图深入了解人口统计数据。
- en: Installing GeoPandas
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 GeoPandas
- en: To install GeoPandas, you’ll use `conda` and `conda-forge` in your terminal.
    As in previous chapters, I’ll also show you how to create an environment for all
    the files you’ll need to work with the data in this chapter.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装 GeoPandas，您将在终端中使用 `conda` 和 `conda-forge`。与前几章一样，我还将向您展示如何为本章中所有需要处理的数据创建环境。
- en: 'Installing GeoPandas can be a little tricky. Think of it as a moody teenager.
    It often wants to go first (importing) and likes the latest trends (pay attention
    to versioning of dependencies). It also prefers a catchy nickname: typically,
    GeoPandas is called `gpd`, but from time to time, the code will write out `geopandas`
    instead. Pay attention and adjust your variables.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 GeoPandas 可能有点棘手。可以把它想象成一个情绪化的青少年。它通常想要先行（导入）并喜欢最新的趋势（注意依赖项的版本）。它还喜欢一个响亮的昵称：通常情况下，GeoPandas
    被称为 `gpd`，但有时代码会写出 `geopandas`。请注意并调整您的变量。
- en: 'To set up your environment, start with this:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置您的环境，请从这里开始：
- en: '[PRE0]'
  id: totrans-8
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: You can add your Python version here.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在此处添加您的 Python 版本。
- en: '[PRE1]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now you can start installing files into the `geop_env`:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您可以开始将文件安装到 `geop_env` 中：
- en: '[PRE2]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Now you can add any packages you would like to access to your `geop_env`. If
    you would like a collection of packages for geospatial analysis, I suggest downloading
    the geospatial package, but for now you can add packages individually if you prefer:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您可以将任何想要访问的包添加到 `geop_env` 中。如果您希望获取一组用于地理空间分析的包，我建议下载地理空间包，但现在如果您愿意，也可以逐个添加包：
- en: '[PRE3]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: GeoPandas simplifies working with geospatial data in Python. Let’s explore the
    expanded operations that enable you to perform spatial operations on geometric
    data.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: GeoPandas 简化了在 Python 中处理地理空间数据的工作。让我们探索扩展操作，使您能够在几何数据上执行空间操作。
- en: Working with GeoJSON files
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理 GeoJSON 文件
- en: GeoPandas lets you work with GeoJSON files. You may have heard of JSON, a common
    data exchange format. GeoJSON is a data exchange format based on JSON that’s specifically
    designed to represent geographic data structures and their nonspatial attributes.
    Working with GeoJSON files makes it fairly simple to identify coordinates and
    locations for your maps.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: GeoPandas 让您能够处理 GeoJSON 文件。您可能已经听说过 JSON，这是一种常见的数据交换格式。GeoJSON 是一种基于 JSON 的数据交换格式，专门设计用于表示地理数据结构及其非空间属性。使用
    GeoJSON 文件工作使得识别地图中的坐标和位置变得相当简单。
- en: '[Figure 7-1](#zooming_in_on_parisapostrophes_onest_ar) shows a map from [*geojson.io*](https://oreil.ly/JmXP4).
    Geojson.io is an open source tool that simplifies creating, viewing, and sharing
    your maps. You can perform a variety of functions on the internet without downloading
    any data to your computer.'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 7-1](#zooming_in_on_parisapostrophes_onest_ar)显示了来自[*geojson.io*](https://oreil.ly/JmXP4)的地图。Geojson.io
    是一个开源工具，简化了创建、查看和分享地图。你可以在互联网上执行各种功能，而无需将任何数据下载到你的计算机。'
- en: '![Zooming in on Paris’s 1st Arrondissement and selecting boundaries to create
    a GeoJSON file](assets/pgda_0701.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![缩放到巴黎第一区并选择边界以创建 GeoJSON 文件](assets/pgda_0701.png)'
- en: Figure 7-1\. Zooming in on Paris’s 1st Arrondissement and selecting boundaries
    to create a GeoJSON file
  id: totrans-20
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 7-1\. 缩放到巴黎第一区并选择边界以创建 GeoJSON 文件
- en: Click on the link [*geojson.io*](https://geojson.io) and zoom into a country.
    I chose France because, well, it’s France. An easy way to locate coordinates for
    a specific location is to select the region you are interested in and drag the
    polygon around the area. The tools for selecting a polygon are visible on the
    right edge of the mapping dashboard. Try locating Paris, France, on the map. Find
    the Tuileries Garden and draw a polygon around it. Once you save the polygon,
    you can view formatting options and style properties by clicking within the boundary.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 点击[*geojson.io*](https://geojson.io)链接并放大到一个国家。我选择了法国，因为，嗯，它是法国。查找特定位置的坐标的简单方法是选择你感兴趣的区域并拖动多边形周围的区域。选择多边形的工具可见于地图仪表板的右边缘。尝试在地图上找到法国巴黎。找到杜乐丽花园并在其周围绘制一个多边形。保存多边形后，你可以通过点击边界查看格式化选项和样式属性。
- en: The Meta tab in the top menu (shown in [Figure 7-1](#zooming_in_on_parisapostrophes_onest_ar))
    allows you to generate a *bounding box (bbox)*, which contains the coordinates
    and set of points you are interested in mapping. It defines the spatial location
    of an object of interest and its coordinates. You can also load a string in the
    well-known text (WKT) markup language for vector geometry objects.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 顶部菜单中的 Meta 标签（显示在[图 7-1](#zooming_in_on_parisapostrophes_onest_ar)中）允许你生成一个*边界框（bbox）*，其中包含你想要映射的坐标和点集。它定义了感兴趣对象的空间位置和其坐标。你还可以加载以
    well-known text（WKT）标记语言表示的字符串，用于矢量几何对象。
- en: The buttons in the lower left corner, visible in [Figure 7-2](#map_viewer_options),
    let you toggle between Mapbox (vector tiles), Satellite (raster data), and OSM
    (OpenStreetMap, which you learned about in [Chapter 5](ch05.xhtml#openstreetmap_accessing_geospatial_data)).
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 左下角的按钮，在[图 7-2](#map_viewer_options)中可见，允许你在 Mapbox（矢量瓦片）、卫星（光栅数据）和 OSM（OpenStreetMap，在[第
    5 章](ch05.xhtml#openstreetmap_accessing_geospatial_data)中介绍过）之间切换。
- en: '![Map viewer options](assets/pgda_0702.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![地图查看器选项](assets/pgda_0702.png)'
- en: Figure 7-2\. Map viewer options
  id: totrans-25
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 7-2\. 地图查看器选项
- en: If you want to save this file, you can do so in several different formats, including
    *.csv*, *.txt*, and a shapefile. Then you can import it to QGIS, ArcGIS, or a
    platform of your choice for additional exploration and analysis. Spreadsheet data
    is stored as *.csv* or *.txt* and often contains location information, such as
    coordinate data for longitude and latitude, addresses, or zip codes. Shapefiles
    are Esri vector files that capture location, shape, and related files about locations.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要保存这个文件，你可以以几种不同的格式保存，包括*.csv*、*.txt*和 shapefile。然后你可以将其导入到 QGIS、ArcGIS
    或你选择的平台进行进一步的探索和分析。电子表格数据存储为*.csv*或*.txt*，通常包含位置信息，如经度和纬度的坐标数据、地址或邮政编码。Shapefile
    是 Esri 的矢量文件，捕捉位置、形状和有关位置的相关文件。
- en: Creating a GeoDataFrame
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建一个 GeoDataFrame
- en: A GeoDataFrame is much the same as a pandas dataframe but with an extra column
    of geometric data. Many types of vector data describe discrete data with a fixed
    location while continuous data is often represented by raster data (although both
    can be either).
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: GeoDataFrame 类似于带有额外几何数据列的 pandas 数据帧。许多类型的矢量数据描述了具有固定位置的离散数据，而连续数据通常由栅格数据表示（尽管两者都可以是任意类型）。
- en: 'GeoPandas makes a few dataset examples available for exploration. You are going
    to access an example from NYC Boroughs, abbreviated as `nybb`:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: GeoPandas 提供了一些数据集示例供探索。你将访问缩写为`nybb`的 NYC Boroughs 示例：
- en: '[PRE4]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'These files represent the positions of cities, the contours of different countries,
    and the boundaries of New York City’s boroughs. To access them, you will need
    to include the name of the dataset as a parameter:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 这些文件代表城市的位置、不同国家的轮廓以及纽约市行政区的边界。要访问它们，你需要将数据集名称作为参数包含进去：
- en: '[PRE5]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'You can open this in a Jupyter Notebook from your terminal:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从终端打开Jupyter Notebook：
- en: '[PRE6]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Now, with the notebook open, you can create a dataframe. First, import the
    packages you’ll need into your environment:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，笔记本已打开，您可以创建一个数据帧。首先，将您需要的软件包导入到您的环境中：
- en: '[PRE7]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Next, you’ll need to retrieve the dataset and call for the active geometry
    column (in this instance, “geometry”) by creating a dataframe called `world.geometry.name`.
    When you call `head()`, the top five rows and the columns in the dataset will
    be returned:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，您需要检索数据集并调用活动几何列（在本例中为“geometry”）来创建一个名为`world.geometry.name`的数据帧。当您调用`head()`时，将返回数据集中的前五行和列：
- en: '[PRE8]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'You should get the following output:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该得到以下输出：
- en: '[PRE9]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Make note of the index assignments in the first column. You will be able to
    isolate a single borough by referring to it by its index location. `BoroCode`
    and `BoroName` are additional identifiers you can specify, but you may notice
    the simplicity of calling by index in the code snippets that follow.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 注意第一列中的索引分配。通过引用其索引位置，您将能够隔离单个区域。`BoroCode`和`BoroName`是您可以指定的附加标识符，但是您可能会注意到在随后的代码片段中通过索引调用的简易性。
- en: 'You are now working with a GeoDataFrame. You can use it to generate the plot
    in [Figure 7-3](#locations_of_new_york_city_boroughs_in) by running the following
    code in your Jupyter Notebook:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在正在使用一个GeoDataFrame。您可以在Jupyter Notebook中运行以下代码生成图7-3的绘图：
- en: '[PRE10]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![Locations of New York City boroughs in a GeoDataFrame](assets/pgda_0703.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![纽约市行政区域的地理数据框中的位置](assets/pgda_0703.png)'
- en: Figure 7-3\. Locations of New York City boroughs in a GeoDataFrame
  id: totrans-45
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图7-3。纽约市行政区域的位置
- en: You can change the size of the figure using the `figsize` argument. In the example
    in [Figure 7-3](#locations_of_new_york_city_boroughs_in), an alpha value of less
    than 1 adjusts the transparency. Edge color can be customized as well. You can
    find details in the [matplotlib documentation](https://oreil.ly/jy6fs).
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`figsize`参数可以更改图像的大小。在示例中，alpha值小于1可调整透明度。边缘颜色也可以自定义。你可以在[matplotlib文档](https://oreil.ly/jy6fs)中找到详细信息。
- en: 'I prefer maps without the visible axes in most instances. To remove the frames,
    simply add:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数情况下，我更喜欢没有可见轴的地图。要删除框架，只需添加：
- en: '[PRE11]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: You will next explore the data by interactive map, so the area coordinates are
    not necessary. That will generate the image in [Figure 7-4](#locations_of_new_york_city_boroughs_wit).
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 您将通过交互地图进一步探索数据，因此不需要区域坐标。这将生成图7-4中的图像。
- en: '![Locations of New York City boroughs without the axis frame](assets/pgda_0704.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![没有轴框架的纽约市行政区域的位置](assets/pgda_0704.png)'
- en: Figure 7-4\. Locations of New York City boroughs without the axis frame
  id: totrans-51
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图7-4。没有轴框架的纽约市行政区域的位置
- en: 'You can request a single borough by calling out a row number. Staten Island
    is in row 0 of the GeoDataFrame you generated a few pages ago. You can access
    a location by its index number using the callable function [`DataFrame.loc`](https://oreil.ly/vSEXO).
    I think of `loc` as an abbreviation for “label of column” since it requires an
    input label, such as “index” or “geometry.” The abbreviation `iloc` is for integer
    location index/integer of column. Substitute the name of the dataframe you created:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 通过调用行号可以请求单个区域。斯泰顿岛在您几页前生成的GeoDataFrame中的第0行。您可以使用可调用函数[`DataFrame.loc`](https://oreil.ly/vSEXO)根据其索引号访问位置。我认为`loc`是“列标签”的缩写，因为它需要输入标签，如“索引”或“几何”。缩写`iloc`用于整数位置索引/列的整数。替换您创建的数据帧名称：
- en: '[PRE12]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: This outputs the image of Staten Island shown in [Figure 7-5](#calling_a_single_borough_using_the_dotl).
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 这将输出显示在图7-5中的斯泰顿岛的图像。
- en: '![Calling a single borough using the .loc function](assets/pgda_0705.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![使用.loc函数调用单个行政区域](assets/pgda_0705.png)'
- en: Figure 7-5\. Calling a single borough using the `.loc` function
  id: totrans-56
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图7-5。使用`.loc`函数调用单个区域
- en: 'You can see the boundaries of Staten Island borough in [Figure 7-5](#calling_a_single_borough_using_the_dotl),
    but it would be helpful to have more information now that you know how to access
    the GeoDataFrame. You can also find the area of a borough:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在图7-5中看到斯泰顿岛区域的边界，但是现在您知道如何访问GeoDataFrame后，获取更多信息会更有帮助。您还可以找到区域的面积：
- en: '[PRE13]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'This outputs:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这将输出：
- en: '[PRE14]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'To view a borough’s boundary, run:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看一个行政区域的边界，请运行：
- en: '[PRE15]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'This outputs:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 这将输出：
- en: '[PRE16]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'In the interactive map ([Figure 7-6](#interactive_map_of_the_new_york_city_bo)),
    you can retrieve information by hovering over the borough. The reference distance
    is 0 because Staten Island’s index number is 0\. Clicking on any of the other
    boroughs will tell you the distance from Staten Island. The `gdf.explore` function
    generates an interactive map:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 在交互式地图 ([Figure 7-6](#interactive_map_of_the_new_york_city_bo)) 中，您可以通过悬停在市区上来检索信息。参考距离是
    0，因为史泰登岛的索引号是 0\. 点击任何其他市区将告诉您与史泰登岛的距离。`gdf.explore` 函数生成一个交互式地图：
- en: '[PRE17]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![Interactive map of the New York City boroughs](assets/pgda_0706.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![纽约市行政区交互地图](assets/pgda_0706.png)'
- en: Figure 7-6\. Interactive map of the New York City boroughs
  id: totrans-68
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 7-6\. 纽约市行政区交互地图
- en: Adding geospatial capabilities like geometry to pandas dataframes is only the
    beginning. Census data is a treasure trove of open source data, and knowing how
    to use GeoPandas will help you expand your ability to access and ask questions
    of this important dataset. Let’s look at some more census data.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 将像几何形状这样的地理空间能力添加到 pandas 数据框中仅仅是个开始。人口普查数据是开放数据的宝库，了解如何使用 GeoPandas 将帮助您扩展访问和查询这一重要数据集的能力。让我们再看看更多人口普查数据。
- en: 'Working with US Census Data: Los Angeles Population Density Map'
  id: totrans-70
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用美国人口普查数据：洛杉矶人口密度地图
- en: In this exercise, you’ll calculate population density by census tract across
    the county of Los Angeles, California.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，您将计算加利福尼亚州洛杉矶县各个小区的人口密度。
- en: Warning
  id: totrans-72
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 警告
- en: Be careful when working with Python census packages. If a developer loses interest
    in maintaining them or is overwhelmed with other tasks, your maps and graphics
    will no longer function. I learned that the hard way while writing this chapter.
    The good news is that it reminded me of the fail-safe basics that will always
    be reliable.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用 Python 人口普查包时要小心。如果开发者失去了维护它们的兴趣或者被其他任务压倒，您的地图和图形将不再工作。在写这一章节时，我就是这样学到的。好消息是，它提醒我始终可靠的备用基础知识。
- en: If you need a high-quality map of a census data question for professional services
    or research, you can build one in an open source platform like QGIS or by using
    proprietary software like ArcGIS. This example will walk you through the basics.
    When you understand how the Census API is structured and are able to write code
    outside of a fancy Python package, access to one of the most powerful publicly
    available datasets is at your fingertips.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要一个专业服务或研究的人口普查数据问题的高质量地图，您可以在像 QGIS 这样的开源平台上或使用像 ArcGIS 这样的专有软件构建一个。这个例子将带您了解基础知识。一旦您理解了人口普查
    API 的结构并能够在一个不花哨的 Python 包之外编写代码，您就可以轻松访问这个最强大的公开可用数据集之一。
- en: The first step is locating the data on [*census.gov*](https://oreil.ly/k6wuo).
    Data from the 2020 decennial census is becoming available for analysis depending
    on your area of interest. I rely on [Census Reporter](https://oreil.ly/TnwCF)
    for identifying and downloading datasets. Most repositories have the ACS data
    (often called the “long-form census”), which is collected each year from a proportion
    of the nation and bundled yearly or in five-year vintages. The API fetches the
    last five-year ACS vintage by default. This is an easy-to-navigate first stop
    to holistically understand the type of data captured.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是在 [*census.gov*](https://oreil.ly/k6wuo) 上找到数据。根据您的兴趣领域，2020 年人口普查的数据已经可以用于分析。我依赖于
    [Census Reporter](https://oreil.ly/TnwCF) 来识别和下载数据集。大多数仓库都有 ACS 数据（通常称为“长表人口普查”），每年从全国一部分收集，并以年度或五年时段的形式捆绑。API
    默认获取最近五年的 ACS 时段。这是一个易于导航的第一站，全面了解捕获数据类型的方法。
- en: Census Reporter has ready-to-use neighborhood data for many metropolitan areas,
    and that is the data you will see in these examples.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: Census Reporter 为许多大都市区提供即用的社区数据，这些示例中您将看到这些数据。
- en: Tip
  id: totrans-77
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 小贴士
- en: For more advanced users, [IPUMS](https://www.ipums.org) (formerly the Integrated
    Public Use Microdata Series, now known by its acronym) offers global harmonized
    datasets from census and survey data with supporting documentation. You can use
    this to integrate ACS and decennial census data with merged data from other sources.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 对于更高级的用户，[IPUMS](https://www.ipums.org)（前身为集成公共使用微数据系列，现以其首字母缩写命名）提供了来自人口普查和调查数据的全球协调数据集，并附有支持文件。您可以使用它将
    ACS 和人口普查数据与其他来源的合并数据集集成。
- en: Accessing Tract and Population Data Through the Census API and FTP
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 通过人口普查 API 和 FTP 访问小区和人口数据
- en: Accessing the Census API, through the FTP site or directly, is the foundation
    for being able to work outside the Census GUI. This will help you address bigger
    questions, with data ready for analysis in notebooks or QGIS.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 FTP 站点或直接访问人口普查 API 是能够在人口普查 GUI 外工作的基础。这将帮助您解决更大的问题，并且数据已准备好在笔记本或 QGIS 中进行分析。
- en: FTP sites provide quick and easy access to large files that can be challenging
    to navigate. If you are working in a MacOS environment, you may need to adjust
    a few settings, but I prefer the reliability and lack of clutter of accessing
    census data through FTP.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: FTP 站点提供了快速简便访问大文件的途径，这些文件可能难以导航。如果您在 MacOS 环境下工作，可能需要调整一些设置，但我更喜欢通过 FTP 访问人口普查数据的可靠性和无杂乱。
- en: Select System Preferences >> Sharing and check Remote Login. Select which users
    to allow access.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 选择“系统偏好设置 >> 共享”并选中“远程登录”。选择允许访问的用户。
- en: Next, navigate to your Finder window and select Go. In the dropdown menu, you
    will see a Connect to Server option ([Figure 7-7](#connecting_to_the_us_census_bureau_ftp)).
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，导航到您的 Finder 窗口并选择 Go。在下拉菜单中，您将看到一个连接到服务器的选项（[图 7-7](#connecting_to_the_us_census_bureau_ftp)）。
- en: '![Connecting to the US Census Bureau FTP site](assets/pgda_0707.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![连接到美国人口普查局 FTP 站点](assets/pgda_0707.png)'
- en: Figure 7-7\. Connecting to the US Census Bureau FTP site
  id: totrans-85
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 7-7\. 连接到美国人口普查局 FTP 站点
- en: The [FTP site](ftp://ftp2.census.gov/geo/tiger/) is accessible through the link.
    You will be able to scroll through the available files. You can also gain access
    through the [server site](https://oreil.ly/OlwXw). The [summary files](https://oreil.ly/bsd2s)
    are where most of the files of interest are located.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '[FTP 站点](ftp://ftp2.census.gov/geo/tiger/) 可通过链接访问。您将能够浏览可用的文件。您还可以通过[服务器站点](https://oreil.ly/OlwXw)获得访问权限。[总结文件](https://oreil.ly/bsd2s)是大多数感兴趣的文件所在之处。'
- en: You are going to explore decennial population data from the US census. The geographical
    data included here is from the 2019 ACS one-year survey. The census tables for
    population are from the 2010 census.^([1](ch07.xhtml#ch01fn10)) [Google Colab](https://oreil.ly/ytceM)
    works well for this exercise because the file structure is readily available,
    and once your session is over, the files are removed.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 您将要探索美国人口普查的十年人口数据。这里包含的地理数据来自 2019 年 ACS 一年调查。人口普查表来自 2010 年人口普查。^([1](ch07.xhtml#ch01fn10))
    [Google Colab](https://oreil.ly/ytceM) 在这项练习中表现良好，因为文件结构是直接可用的，并且会话结束后，文件会被移除。
- en: 'You will need to download the following packages not already included in Colab:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要下载以下在 Colab 中尚未包含的包：
- en: '[PRE18]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'I learned an important lesson when working with census data: always know the
    version of your packages, in case there are dependencies (or conflicts!). This
    is a helpful practice to add to your notebooks. Use the following code to display
    versions:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 当处理人口普查数据时，我学到了一条重要的经验教训：始终了解您的包版本，以防存在依赖关系（或冲突！）。这是一个有用的实践方法，可以添加到您的笔记本中。使用以下代码显示版本：
- en: '[PRE19]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Now you can request census tract information from the FTP server. You are looking
    for shapefiles for the census tracts. These are *.zip* files; note that the files
    you need may be bundled into a larger file. Download the [topologically integrated
    geographic encoding and referencing (TIGER) files](https://oreil.ly/THPPT) for
    California: FIPS 06\. (Federal Information Processing Standards Publications,
    or FIPS, files designate state and county equivalents.) TIGER shapefiles contain
     geographic information but not demographics, so we will add that information
    shortly. The link identifies the US Census Bureau FTP site and denotes geographic
    files from 2019 at the tract level in California:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您可以从 FTP 服务器请求人口普查区信息。您正在寻找人口普查区的形状文件。这些是 *.zip* 文件；请注意，您需要的文件可能捆绑在一个较大的文件中。下载加利福尼亚州的[拓扑集成地理编码和参照（TIGER）文件](https://oreil.ly/THPPT)：FIPS
    06\.（联邦信息处理标准出版物，或 FIPS 文件指定州和县的等效物）。TIGER 形状文件包含地理信息但不包括人口统计信息，因此我们将很快添加该信息。链接标识了美国人口普查局
    FTP 站点，并指定了加利福尼亚州 2019 年按区划级别的地理文件：
- en: '[PRE20]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Once you identify the file in the FTP, to retrieve it, you need the `!wget`
    call. The wget utility retrieves FTP files from web servers:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您在 FTP 中确定文件，要检索它，您需要 `!wget` 调用。wget 实用程序从 Web 服务器检索 FTP 文件：
- en: '[PRE21]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The quotations on the *.zip* file path are not needed for the `!wget` call,
    and the file will unzip into your Colab notebook. You can watch the progress right
    in the notebook as it unzips to 100%. Your output should look like this:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 `!wget` 调用，*.zip* 文件路径上的引号是不需要的，并且文件将解压缩到您的 Colab 笔记本中。您可以在笔记本中直接观察解压缩进度，直到完成到
    100%。您的输出应如下所示：
- en: '[PRE22]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '[Figure 7-8](#google_colab_file_structure) shows the files after they are unzipped
    into the folder hierarchy. Navigate to county-level data, using the same steps
    you used to locate the state tracts for California.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 7-8](#google_colab_file_structure)显示文件在解压缩到文件夹层次结构后的情况。导航到县级数据，使用与查找加利福尼亚州小区相同的步骤。'
- en: '![Google Colab file structure](assets/pgda_0708.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![Google Colab文件结构](assets/pgda_0708.png)'
- en: Figure 7-8\. Google Colab file structure
  id: totrans-100
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图7-8。Google Colab文件结构
- en: 'Now that the files are unzipped, we can retrieve the FTP files from the web
    servers:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 现在文件解压缩后，我们可以从Web服务器检索FTP文件：
- en: '[PRE23]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Now you can plot the California tracts (`ca_tracts`) using GeoPandas, reading
    the file from your Colab window. Each file has three dots next to the filename.
    Right-click on the dots and select Copy Path to copy the link to your files:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您可以使用GeoPandas绘制加利福尼亚小区（`ca_tracts`），从您的Colab窗口读取文件。每个文件名旁边有三个点。右键单击点并选择复制路径以复制文件链接：
- en: '[PRE24]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: The output is shown in [Figure 7-9](#california_census_tracts).
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 输出显示在[图 7-9](#california_census_tracts)中。
- en: '![California census tracts](assets/pgda_0709.png)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![加利福尼亚人口普查小区](assets/pgda_0709.png)'
- en: Figure 7-9\. California census tracts
  id: totrans-107
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图7-9。加利福尼亚人口普查小区
- en: Let’s take a moment to figure out what the table IDs mean, to help you find
    the right data.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们花点时间弄清楚表ID的含义，以帮助您找到正确的数据。
- en: Accessing Data from the Census API in Your Browser
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在浏览器中访问人口普查API的数据
- en: Next, you’ll need to open the [US Census Bureau website](https://oreil.ly/A3Bwq).
    In the search window, enter `**DP03**`, the table ID for census data ([Figure 7-10](#census_api_data)).
    The ID might seem random, but actually it provides important information. Right
    away, you can tell from the results that the DP indicates a data profile table.
    The [table IDs](https://oreil.ly/Fhioi) describe this table as containing “broad
    social, economic, housing, and demographic information.” The following number
    in the ID, 03, also refers to selected economic characteristics.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，您需要打开[美国人口普查局网站](https://oreil.ly/A3Bwq)。在搜索窗口中输入`**DP03**`，这是人口普查数据的表ID（[图 7-10](#census_api_data)）。该ID可能看起来很随机，但实际上它提供了重要信息。从结果中可以立即看出，DP指示一个数据概况表。表ID描述此表包含“广泛的社会、经济、住房和人口统计信息”。ID中的后续数字03还涉及选定的经济特征。
- en: '![Census API: data](assets/pgda_0710.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![人口普查API：数据](assets/pgda_0710.png)'
- en: 'Figure 7-10\. Census API: data'
  id: totrans-112
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图7-10。人口普查API：数据
- en: Select Enter to see a list of available tables. [Figure 7-11](#data_profile_tables_available_from_the)
    shows the different years and types of ACS surveys available from this search.
    These are called *data profiles*, and we will touch on them again a little later.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 选择Enter以查看可用表格列表。[图 7-11](#data_profile_tables_available_from_the)显示来自此搜索可用的不同年份和类型的ACS调查。这些被称为*数据概况*，稍后我们将再次提及它们。
- en: '![Data profile tables available from the US Census Bureau](assets/pgda_0711.png)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![来自美国人口普查局的数据概况表](assets/pgda_0711.png)'
- en: Figure 7-11\. Data profile tables available from the US Census Bureau
  id: totrans-115
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图7-11。来自美国人口普查局的数据概况表
- en: The [Available APIs page on *census.gov*](https://oreil.ly/tJM7C) ([Figure 7-12](#available_apis_and_other_us_census_bure))
    is an important resource that contains publicly available datasets on a wide variety
    of topics. From here, select American Community Survey (ACS).
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '[census.gov上的可用API页面](https://oreil.ly/tJM7C)（[图 7-12](#available_apis_and_other_us_census_bure)）是一个重要资源，包含广泛主题的公开可用数据集。从这里选择美国社区调查（ACS）。'
- en: '![Available APIs and other US Census Bureau datasets](assets/pgda_0712.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![可用API及其他美国人口普查局数据集](assets/pgda_0712.png)'
- en: Figure 7-12\. Available APIs and other US Census Bureau datasets
  id: totrans-118
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图7-12。可用API及其他美国人口普查局数据集
- en: Under American Community Survey (ACS), select 1-Year Estimates and scroll down
    to 2019\. Scroll down the list of tables until you see the data profiles. Grab
    the first link and paste it into your browser. You are going to edit this link
    and generate a *.csv* file.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在美国社区调查（ACS）下，选择1年估计，并滚动到2019年。滚动表格列表直至看到数据概况。复制第一个链接并粘贴到浏览器中。您将编辑此链接并生成一个*.csv*文件。
- en: Tip
  id: totrans-120
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: While you’re on the Available APIs page, you can request a key for running US
    Census Bureau service requests. You won’t need one for this exercise, but I recommend
    requesting one and saving it in a reliable location. Look around at the other
    datasets listed and familiarize yourself with the scope of publicly available
    data. Another useful US Census Bureau resource is the Developer Forum, an active
    community that accepts requests for datasets and consultancy.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 当你在“可用 API”页面时，你可以请求一个用于运行美国人口普查局服务请求的密钥。对于这个练习，你不需要一个，但我建议请求一个并将其保存在一个可靠的位置。浏览列出的其他数据集，并熟悉公开可用数据的范围。另一个有用的美国人口普查局资源是开发者论坛，这是一个接受数据集和咨询请求的活跃社区。
- en: Using Data Profiles
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用数据概况
- en: 'In the data profile section, you have the example call that you will edit and
    other details about the data profile tables:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在数据概况部分，你有将要编辑的示例调用以及关于数据概况表的其他详细信息：
- en: '**Example Call:**'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**示例调用：**'
- en: '*api.census.gov/data/2019/acs/acs1/profile?get=group(DP02)&for=us:1&key=YOUR_KEY_GOES_HERE*'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '*api.census.gov/data/2019/acs/acs1/profile?get=group(DP02)&for=us:1&key=YOUR_KEY_GOES_HERE*'
- en: 2019 ACS Data Profiles Variables [ [html](https://oreil.ly/G0PZ0) | [xml](https://oreil.ly/Iw9CJ)
    | [json](https://oreil.ly/ruuB4) ]
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 2019 年 ACS 数据概况变量 [ [html](https://oreil.ly/G0PZ0) | [xml](https://oreil.ly/Iw9CJ)
    | [json](https://oreil.ly/ruuB4) ]
- en: '[ACS Technical Documentation](https://oreil.ly/ynqzy)'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[ACS 技术文档](https://oreil.ly/ynqzy)'
- en: '[Examples and Supported Geography](https://oreil.ly/z8LI5)'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[示例和支持的地理位置](https://oreil.ly/z8LI5)'
- en: 'Click the link to gather more information. Your first edits will include substituting
    your table of interest, `DP03`, and removing the placeholder `&key=YOUR_KEY_GOES_HERE`
    from the URL:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 点击链接以收集更多信息。你的第一个编辑将包括替换你感兴趣的表格 `DP03`，并从 URL 中删除占位符 `&key=YOUR_KEY_GOES_HERE`：
- en: '*api.census.gov/data/2019/acs/acs1/profile?get=group(DP03)&for=us:1*'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '*api.census.gov/data/2019/acs/acs1/profile?get=group(DP03)&for=us:1*'
- en: Then paste the URL into your browser and hit Enter. You will now want to customize
    the geography portion of your URL to include all metropolitan areas. Select Examples
    and Supported Geography from the previous page and scroll down to the metropolitan
    area in the geography hierarchy shown in [Figure 7-13](#geography_hierarchy).
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 然后将 URL 粘贴到浏览器中并按 Enter 键。现在你将想要定制 URL 的地理部分，包括所有都市区域。从前一页选择示例和支持的地理位置，并滚动到地理层次结构图
    7-13 中所示的都市区域。
- en: '![Geography hierarchy](assets/pgda_0713.png)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![地理层次结构](assets/pgda_0713.png)'
- en: Figure 7-13\. Geography hierarchy
  id: totrans-133
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 7-13\. 地理层次结构
- en: 'Noticing the * (wildcard option), copy the URL, being sure to delete the `YOUR_KEY_GOES_HERE`
    section once again. The other option will give you data for a single metropolitan
    area: the Akron, Ohio, metro area.'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 注意到 *（通配符选项），复制 URL，确保再次删除 `YOUR_KEY_GOES_HERE` 部分。另一种选项将为你提供一个单一都市区域的数据：俄亥俄州阿克伦都会区。
- en: 'Once you are familiar with the URLs and data tables, it takes just a few quick
    edits to get a usable file with the demographic or economic data of interest.
    Modify the URL as shown:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你熟悉了 URL 和数据表，只需进行一些快速编辑即可获得所需的人口或经济数据的可用文件。按如下修改 URL：
- en: '*https://api.census.gov/data/2019/acs/acs1/profile?get=NAME,DP03_0001E&for=metropolitan%20statistical%20area/micropolitan%20statistical%20area:**'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '*https://api.census.gov/data/2019/acs/acs1/profile?get=NAME,DP03_0001E&for=metropolitan%20statistical%20area/micropolitan%20statistical%20area:**'
- en: 'Now paste it into your browser and hit Enter. The file saves in JSON format
    on my Mac. Instead of saving it as a *.csv* file, which would force you to edit
    it in Microsoft Excel, run the following lines of code to convert it from *.json*
    to *.csv*:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 现在将其粘贴到浏览器中并按 Enter 键。该文件以 JSON 格式保存在我的 Mac 上。与其将其保存为 *.csv* 文件，这会迫使你在 Microsoft
    Excel 中进行编辑，不如运行以下代码行将其从 *.json* 转换为 *.csv*：
- en: '[PRE25]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: This will output a formatted *.csv* file.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 这将输出一个格式化的 *.csv* 文件。
- en: Creating the Map
  id: totrans-140
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建地图
- en: To complete our project creating population densities, you will return to the
    URL for the 2010 census.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 要完成我们创建人口密度项目，你将返回到 2010 年人口普查的 URL。
- en: 'Let’s begin by looking at the reference URL from the 2010 census:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从查看 2010 年人口普查的参考 URL 开始：
- en: '*https://api.census.gov/data/2010/dec/sf1?get=LSAD_NAME,P001001&for=tract:*&in=state:06*'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '*https://api.census.gov/data/2010/dec/sf1?get=LSAD_NAME,P001001&for=tract:*&in=state:06*'
- en: 'Now that you are familiar with Census API calls, you can break the link down
    in Python to calculate the densities and customize the tables. The total population
    in the URL call for the census tracts in California includes table `P001001`;
    `sf1` refers to the decennial census:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经熟悉了人口普查 API 的调用，您可以在 Python 中分解链接，计算密度并自定义表格。在加利福尼亚州人口普查区段的 URL 调用中包括表`P001001`；`sf1`指的是十年一次的人口普查：
- en: '[PRE26]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Now that you’ve made your request, let’s look at the column names for your
    data:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经发出了请求，让我们查看数据的列名称：
- en: '[PRE27]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Remember the `index` function. You only need the first row (`r`) of data to
    read the headings. You can also create new names:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 记住`index`函数。您只需读取数据的第一行（`r`）来查看标题。您还可以创建新的名称：
- en: '[PRE28]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Follow along in the notebook. The following code will select by attributes for
    all Los Angeles County census tracts, remove any nulls, and create a new `geoid`
    column. Run the code and verify that the `geoid` column has indeed been added.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 在笔记本中跟随操作。以下代码将选择所有洛杉矶县的属性，删除任何空值，并创建一个新的`geoid`列。运行代码，并验证确实已添加了`geoid`列。
- en: 'First, we need to select attributes from Los Angeles county:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要从洛杉矶县中选择属性：
- en: '[PRE29]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Next, we create the new dataframe that includes our new geoid column:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们创建包含新`geoid`列的新数据框架：
- en: '[PRE30]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'There are 2,346 records in the dataframe. You can also do a quick count of
    records with a single line of code:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 数据框中有 2,346 条记录。您还可以通过一行代码快速计算记录数量：
- en: '[PRE31]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'To join the tract-level and county-level files, you will need to select an
    attribute for the join. To refresh your mind as to the choices, check the column
    headings with code:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 要将区段级别和县级文件连接起来，您需要选择一个连接属性。要回顾可用的选择，请使用以下代码检查列标题：
- en: '[PRE32]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'The join will combine column headings `GEOID` and `geoid` from the two datasets:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 该连接将合并来自两个数据集的列标题`GEOID`和`geoid`：
- en: '[PRE33]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Double-check the coordinate reference system to make sure they match on both
    the geography file and the census data. ALAND is the area, in square meters. Now
    you can add the block groups to your map:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 双重检查坐标参考系统，确保地理文件和人口普查数据匹配。ALAND 是面积，以平方米计。现在您可以将分组块添加到您的地图上：
- en: '[PRE34]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Population density measures how many people reside within a given area, and
    it is normally calculated in square kilometers. You can convert the study area
    to square kilometers right in the code cell:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 人口密度衡量在给定区域内居住的人数，通常以平方公里计算。您可以在代码单元格中直接将研究区域转换为平方公里：
- en: '[PRE35]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Next, select where you want the center of the map to be:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，选择您希望地图中心的位置：
- en: '[PRE36]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Now you can view the map and the legend (generated automatically) showing population
    density within Los Angeles County by running the following code:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您可以通过运行以下代码查看地图和图例（自动生成），显示洛杉矶县内的人口密度：
- en: '[PRE37]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: The output, your completed map, is shown in [Figure 7-14](#los_angeles_county_population_tracts_by).
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 输出结果，您完成的地图显示在[图 7-14](#los_angeles_county_population_tracts_by)中。
- en: '![Los Angeles County population tracts by density](assets/pgda_0714.png)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![洛杉矶县人口普查区段密度](assets/pgda_0714.png)'
- en: Figure 7-14\. Los Angeles County population tracts by density
  id: totrans-171
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 7-14\. 洛杉矶县人口普查区段密度
- en: Importing TIGER files from the Census API FTP site guarantees a single source
    of location accuracy at a variety of geographies. Here you’ve looked at census
    tract levels, but a simple edit to a URL call allows you to change to the level
    of counties, congressional districts, or municipalities, for example. Although
    these file types do not include demographic or economic information, you learned
    how to discover data resources and view them in the notebook. The ability to save
    JSON files in *.csv* format also means that you can upload them to a GUI, like
    QGIS, for further exploration.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 从人口普查 API FTP 站点导入 TIGER 文件可以保证单一的位置精度源。在这里，您查看了人口普查区段级别，但通过简单编辑 URL 调用，您可以更改到县级、国会选区或市政区等级。虽然这些文件类型不包括人口统计或经济信息，但您学会了如何发现数据资源并在笔记本中查看它们。将
    JSON 文件保存为*.csv*格式还意味着您可以将其上传到如 QGIS 等 GUI 进行进一步探索。
- en: Summary
  id: totrans-173
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: GeoPandas is a powerful open source Python project that lets users integrate
    geographic data with pandas objects and perform spatial operations. It quietly
    works beneath the surface in geospatial calculations. In this chapter, you have
    read and written files, selected data, made maps and plots, tackled interactive
    mapping and geometric manipulations, and explored a few useful packages to include
    in your future geospatial analyses.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: GeoPandas 是一个功能强大的开源 Python 项目，允许用户将地理数据与 pandas 对象集成，并进行空间操作。它在地理空间计算中默默地发挥作用。在本章中，您已经学习了文件的读取和写入、数据的选择、地图和图表的制作、交互式地图制作以及几个有用的包，以便将其包含在您未来的地理空间分析中。
- en: ^([1](ch07.xhtml#ch01fn10-marker)) The final data for the 2020 census was not
    yet available as of this writing. When it becomes available, you will only need
    to replace the link in the code cells with an updated link, and you will have
    the updated information.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](ch07.xhtml#ch01fn10-marker)) 截至本文撰写时，2020年人口普查的最终数据尚未公布。一旦数据公布，您只需在代码单元格中更新链接，即可获得最新信息。
