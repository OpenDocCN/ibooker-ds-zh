["```py\n# Load data from Basten & Betz (2013)\nimport numpy as np\nimport pandas as pd\npath = \"https://github.com/causal-methods/Data/raw/master/\" \ndf = pd.read_stata(path + \"finaldata.dta\")\ndf.head(4) \n```", "```py\n# Create variable \"Region\" for the graphic\ndef category(var):\n    if var == 1:\n        return \"Protestant (Vaud)\"\n    else:   \n        return \"Catholic (Fribourg)\"\ndf['Region'] = df[\"vaud\"].apply(category)\n\n# Rename variables with auto-explanatory names\ndf = df.rename(columns={\"prot1980s\": \"Share_of_Protestants\",\n                        \"pfl\": \"Preference_for_Leisure\"})\n\n# Scatter plot\nimport plotly.express as px\nleisure = px.scatter(df,\n                     x=\"Share_of_Protestants\",\n                     y=\"Preference_for_Leisure\",\n                     color=\"Region\")\nleisure.show() \n```", "```py\ndf = df.rename(columns={\"borderdis\": \"Border_Distance_in_Km\"})\n\nleisure = px.scatter(df,\n                     x=\"Border_Distance_in_Km\",\n                     y=\"Preference_for_Leisure\",\n                     color=\"Share_of_Protestants\",\n                     title=\"Discontinuity at Distance = 0\")\nleisure.show() \n```", "```py\ndf5 = df[df['Border_Distance_in_Km'] >= -5]\ndf5 = df5[df5['Border_Distance_in_Km'] <= 5] \n```", "```py\ndf5 = df5.rename(columns={\"reineink_pc_mean\": \"Mean_Income_(CHF)\",\n                          \"Ecoplan_gini\"    : \"Gini_1996\"})\n\noutcome = ['Preference_for_Leisure', 'Mean_Income_(CHF)', 'Gini_1996'] \n```", "```py\ncontrol = ['noreligion1980s', 'altitude']\ndf5.loc[:, control].groupby(df5['Region']).agg([np.mean, np.std]).T \n```", "```py\nfuzzy = px.scatter(df5,\n                     x=\"Border_Distance_in_Km\",\n                     y=\"Share_of_Protestants\",\n                     color=\"Region\",\n                     title=\"Fuzzy Regression Discontinuity\")\nfuzzy.show() \n```", "```py\ndef dummy(var):\n    if var >= 0:\n        return 1\n    else:   \n        return 0\n\ndf5[\"Simulated_Share_Protestant\"] = df5[\"Border_Distance_in_Km\"].apply(dummy)\n\nsharp = px.scatter(df5,\n                     x=\"Border_Distance_in_Km\",\n                     y=\"Simulated_Share_Protestant\",\n                     color=\"Region\",\n                     title=\"Sharp Regression Discontinuity\")\nsharp.show() \n```", "```py\n# Install libray to run Instrumental Variable estimation\n!pip install linearmodels \n```", "```py\nRequirement already satisfied: linearmodels in c:\\anaconda\\envs\\textbook\\lib\\site-packages (4.17)\nRequirement already satisfied: scipy>=1 in c:\\anaconda\\envs\\textbook\\lib\\site-packages (from linearmodels) (1.5.3)\nRequirement already satisfied: pandas>=0.23 in c:\\anaconda\\envs\\textbook\\lib\\site-packages (from linearmodels) (1.1.3)\nRequirement already satisfied: property-cached>=1.6.3 in c:\\anaconda\\envs\\textbook\\lib\\site-packages (from linearmodels) (1.6.4)\nRequirement already satisfied: patsy in c:\\anaconda\\envs\\textbook\\lib\\site-packages (from linearmodels) (0.5.1)\nRequirement already satisfied: Cython>=0.29.14 in c:\\anaconda\\envs\\textbook\\lib\\site-packages (from linearmodels) (0.29.21)\nRequirement already satisfied: statsmodels>=0.9 in c:\\anaconda\\envs\\textbook\\lib\\site-packages (from linearmodels) (0.10.2)\nRequirement already satisfied: numpy>=1.15 in c:\\anaconda\\envs\\textbook\\lib\\site-packages (from linearmodels) (1.19.2) \n```", "```py\nWARNING: No metadata found in c:\\anaconda\\envs\\textbook\\lib\\site-packages\nERROR: Could not install packages due to an EnvironmentError: [Errno 2] No such file or directory: 'c:\\\\anaconda\\\\envs\\\\textbook\\\\lib\\\\site-packages\\\\numpy-1.19.2.dist-info\\\\METADATA' \n```", "```py\nfrom linearmodels.iv import IV2SLS\niv = 'Preference_for_Leisure ~ 1 + Border_Distance_in_Km + t_dist + [Share_of_Protestants ~ vaud]'\niv_result = IV2SLS.from_formula(iv, df5).fit(cov_type='robust')\n\nprint(iv_result) \n```", "```py\nC:\\Anaconda\\envs\\textbook\\lib\\site-packages\\statsmodels\\tools\\_testing.py:19: FutureWarning:\n\npandas.util.testing is deprecated. Use the functions in the public API at pandas.testing instead. \n```", "```py\n IV-2SLS Estimation Summary                            \n==================================================================================\nDep. Variable:     Preference_for_Leisure   R-squared:                      0.4706\nEstimator:                        IV-2SLS   Adj. R-squared:                 0.4583\nNo. Observations:                     133   F-statistic:                    99.425\nDate:                    Fri, Nov 06 2020   P-value (F-stat)                0.0000\nTime:                            21:12:05   Distribution:                  chi2(3)\nCov. Estimator:                    robust                                         \n\n                                   Parameter Estimates                                   \n=========================================================================================\n                       Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI\n-----------------------------------------------------------------------------------------\nIntercept                 50.528     1.8885     26.755     0.0000      46.826      54.229\nBorder_Distance_in_Km     0.4380     0.6291     0.6963     0.4862     -0.7949      1.6710\nt_dist                   -0.3636     0.7989    -0.4552     0.6490     -1.9294      1.2022\nShare_of_Protestants     -13.460     3.1132    -4.3235     0.0000     -19.562     -7.3582\n=========================================================================================\n\nEndogenous: Share_of_Protestants\nInstruments: vaud\nRobust Covariance (Heteroskedastic)\nDebiased: False \n```", "```py\nC:\\Anaconda\\envs\\textbook\\lib\\site-packages\\linearmodels\\iv\\data.py:25: FutureWarning:\n\nis_categorical is deprecated and will be removed in a future version.  Use is_categorical_dtype instead \n```", "```py\nprint(iv_result.first_stage) \n```", "```py\n First Stage Estimation Results        \n===============================================\n                           Share_of_Protestants\n-----------------------------------------------\nR-squared                                0.9338\nPartial R-squared                        0.7095\nShea's R-squared                         0.7095\nPartial F-statistic                      403.04\nP-value (Partial F-stat)                 0.0000\nPartial F-stat Distn                    chi2(1)\n==========================          ===========\nIntercept                                0.1336\n                                       (7.7957)\nBorder_Distance_in_Km                    0.0169\n                                       (2.8397)\nt_dist                                  -0.0057\n                                      (-0.4691)\nvaud                                     0.6709\n                                       (20.076)\n-----------------------------------------------\n\nT-stats reported in parentheses\nT-stats use same covariance type as original model \n```", "```py\nnaive_srd = 'Preference_for_Leisure ~ 1 + vaud + Border_Distance_in_Km + t_dist'\nsrd = IV2SLS.from_formula(naive_srd, df5).fit(cov_type='robust')\nprint(srd) \n```", "```py\n OLS Estimation Summary                              \n==================================================================================\nDep. Variable:     Preference_for_Leisure   R-squared:                      0.3830\nEstimator:                            OLS   Adj. R-squared:                 0.3686\nNo. Observations:                     133   F-statistic:                    91.767\nDate:                    Fri, Nov 06 2020   P-value (F-stat)                0.0000\nTime:                            21:12:05   Distribution:                  chi2(3)\nCov. Estimator:                    robust                                         \n\n                                   Parameter Estimates                                   \n=========================================================================================\n                       Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI\n-----------------------------------------------------------------------------------------\nIntercept                 48.730     1.5731     30.976     0.0000      45.646      51.813\nvaud                     -9.0303     2.1821    -4.1383     0.0000     -13.307     -4.7534\nBorder_Distance_in_Km     0.2107     0.6028     0.3496     0.7266     -0.9707      1.3922\nt_dist                   -0.2874     0.8479    -0.3390     0.7346     -1.9493      1.3744\n========================================================================================= \n```"]