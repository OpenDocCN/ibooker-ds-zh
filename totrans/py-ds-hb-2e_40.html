<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 36. Visualization with Seaborn" data-type="chapter" epub:type="chapter"><div class="chapter" id="section-0414-visualization-with-seaborn">
<h1><span class="label">Chapter 36. </span>Visualization with Seaborn</h1>
<p><a data-primary="Matplotlib" data-secondary="Seaborn and" data-type="indexterm" id="ix_ch36-asciidoc0"/><a data-primary="Matplotlib" data-secondary="visualization with Seaborn" data-type="indexterm" id="ix_ch36-asciidoc1"/><a data-primary="Seaborn" data-type="indexterm" id="ix_ch36-asciidoc2"/><a data-primary="Seaborn" data-secondary="visualization with" data-type="indexterm" id="ix_ch36-asciidoc3"/>Matplotlib has been at the core of scientific visualization in Python
for decades, but even avid users will admit it often leaves much to be
desired. There are several complaints about Matplotlib that often come
up:</p>
<ul>
<li>
<p>A common early complaint, which is now outdated: prior to version 2.0,
Matplotlib’s color and style defaults were at times poor and
looked dated.</p>
</li>
<li>
<p>Matplotlib’s API is relatively low-level. Doing
sophisticated statistical visualization is possible, but often requires
a <em>lot</em> of boilerplate code.</p>
</li>
<li>
<p>Matplotlib predated Pandas by more than a decade, and thus is not
designed for use with Pandas <code>DataFrame</code> objects. In order to visualize
data from a <code>DataFrame</code>, you must extract each <code>Series</code> and often
concatenate them together into the right format. It would be nicer to
have a plotting library that can intelligently use the <code>DataFrame</code>
labels in a plot.</p>
</li>
</ul>
<p>An answer to these problems is <a href="http://seaborn.pydata.org">Seaborn</a>.
Seaborn provides an API on top of Matplotlib that offers sane choices
for plot style and color defaults, defines simple high-level functions
for common statistical plot types, and integrates with the functionality
provided by Pandas.</p>
<p>To be fair, the Matplotlib team has adapted to the changing landscape:
it added the <code>plt.style</code> tools discussed in
<a data-type="xref" href="ch34.xhtml#section-0411-settings-and-stylesheets">Chapter 34</a>, and Matplotlib is starting to handle
Pandas data more seamlessly. But for all the reasons just discussed,
Seaborn remains a useful add-on.</p>
<p class="pagebreak-before less_space">By convention, Seaborn is often imported as <code>sns</code>:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="o">%</code><code class="k">matplotlib</code> inline
        <code class="kn">import</code> <code class="nn">matplotlib.pyplot</code> <code class="k">as</code> <code class="nn">plt</code>
        <code class="kn">import</code> <code class="nn">seaborn</code> <code class="k">as</code> <code class="nn">sns</code>
        <code class="kn">import</code> <code class="nn">numpy</code> <code class="k">as</code> <code class="nn">np</code>
        <code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>

        <code class="n">sns</code><code class="o">.</code><code class="n">set</code><code class="p">()</code>  <code class="c1"># seaborn's method to set its chart style</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Full-color figures are available in the <a href="https://oreil.ly/PDSH_GitHub">supplemental materials on GitHub</a>.</p>
</div>
<section data-pdf-bookmark="Exploring Seaborn Plots" data-type="sect1"><div class="sect1" id="ch_0414-visualization-with-seaborn_exploring-seaborn-plots">
<h1>Exploring Seaborn Plots</h1>
<p><a data-primary="plotting" data-secondary="Seaborn" data-type="indexterm" id="ix_ch36-asciidoc4"/><a data-primary="Seaborn" data-secondary="datasets and plot types" data-type="indexterm" id="ix_ch36-asciidoc5"/><a data-primary="Seaborn" data-secondary="Matplotlib versus" data-type="indexterm" id="ix_ch36-asciidoc6"/>The main idea of Seaborn is that it provides high-level commands to
create a variety of plot types useful for statistical data exploration,
and even some statistical model 
<span class="keep-together">fitting</span>.</p>
<p>Let’s take a look at a few of the datasets and plot types
available in Seaborn. Note that all of the following <em>could</em> be done
using raw Matplotlib commands (this is, in fact, what Seaborn does under
the hood), but the Seaborn API is much more convenient.</p>
<section data-pdf-bookmark="Histograms, KDE, and Densities" data-type="sect2"><div class="sect2" id="ch_0414-visualization-with-seaborn_histograms-kde-and-densities">
<h2>Histograms, KDE, and Densities</h2>
<p><a data-primary="histograms" data-secondary="Seaborn" data-type="indexterm" id="ix_ch36-asciidoc7"/><a data-primary="Seaborn" data-secondary="histograms, kernel density estimation, and densities" data-type="indexterm" id="ix_ch36-asciidoc8"/>Often in statistical data visualization, all you want is to plot
histograms and joint distributions of variables. We have seen that this
is relatively straightforward in Matplotlib (see <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_5_0">Figure 36-1</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">data</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">multivariate_normal</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">],</code> <code class="p">[[</code><code class="mi">5</code><code class="p">,</code> <code class="mi">2</code><code class="p">],</code> <code class="p">[</code><code class="mi">2</code><code class="p">,</code> <code class="mi">2</code><code class="p">]],</code> <code class="n">size</code><code class="o">=</code><code class="mi">2000</code><code class="p">)</code>
        <code class="n">data</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">data</code><code class="p">,</code> <code class="n">columns</code><code class="o">=</code><code class="p">[</code><code class="s1">'x'</code><code class="p">,</code> <code class="s1">'y'</code><code class="p">])</code>

        <code class="k">for</code> <code class="n">col</code> <code class="ow">in</code> <code class="s1">'xy'</code><code class="p">:</code>
            <code class="n">plt</code><code class="o">.</code><code class="n">hist</code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">col</code><code class="p">],</code> <code class="n">density</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code> <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">)</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_5_0">
<img alt="output 5 0" height="392" src="assets/output_5_0.png" width="600"/>
<h6><span class="label">Figure 36-1. </span>Histograms for visualizing distributions</h6>
</div></figure>
<p><a data-primary="kernel density estimation (KDE)" data-secondary="Seaborn" data-type="indexterm" id="idm45858747603712"/>Rather than just providing a histogram as a visual output, we can get a
smooth estimate of the distribution using kernel density estimation
(introduced in <a data-type="xref" href="ch28.xhtml#section-0404-density-and-contour-plots">Chapter 28</a>), which Seaborn does with <code>sns.kdeplot</code> (see <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_7_0">Figure 36-2</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">kdeplot</code><code class="p">(</code><code class="n">data</code><code class="o">=</code><code class="n">data</code><code class="p">,</code> <code class="n">shade</code><code class="o">=</code><code class="kc">True</code><code class="p">);</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_7_0">
<img alt="output 7 0" height="391" src="assets/output_7_0.png" width="600"/>
<h6><span class="label">Figure 36-2. </span>Kernel density estimates for visualizing distributions</h6>
</div></figure>
<p class="pagebreak-before less_space">If we pass <code>x</code> and <code>y</code> columns to <code>kdeplot</code>, we instead get a
two-dimensional visualization of the joint density (see <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_9_0">Figure 36-3</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">kdeplot</code><code class="p">(</code><code class="n">data</code><code class="o">=</code><code class="n">data</code><code class="p">,</code> <code class="n">x</code><code class="o">=</code><code class="s1">'x'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s1">'y'</code><code class="p">);</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_9_0">
<img alt="output 9 0" height="398" src="assets/output_9_0.png" width="600"/>
<h6><span class="label">Figure 36-3. </span>A two-dimensional kernel density plot</h6>
</div></figure>
<p>We can see the joint distribution and the marginal distributions
together using <code>sns.jointplot</code>, which we’ll explore further
later in this chapter.<a data-startref="ix_ch36-asciidoc8" data-type="indexterm" id="idm45858747497616"/><a data-startref="ix_ch36-asciidoc7" data-type="indexterm" id="idm45858747477648"/></p>
</div></section>
<section data-pdf-bookmark="Pair Plots" data-type="sect2"><div class="sect2" id="ch_0414-visualization-with-seaborn_pair-plots">
<h2>Pair Plots</h2>
<p><a data-primary="pair plots" data-type="indexterm" id="idm45858747475264"/><a data-primary="plotting" data-secondary="pair plots" data-type="indexterm" id="idm45858747474560"/><a data-primary="Seaborn" data-secondary="pair plots" data-type="indexterm" id="idm45858747473616"/>When you generalize joint plots to datasets of larger dimensions, you
end up with <em>pair plots</em>. These are very useful for exploring
correlations between multidimensional data, when you’d like
to plot all pairs of values against each other.</p>
<p><a data-primary="Iris dataset" data-secondary="pair plots" data-type="indexterm" id="idm45858747471872"/>We’ll demo this with the well-known Iris dataset, which
lists measurements of petals and sepals of three Iris species:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">iris</code> <code class="o">=</code> <code class="n">sns</code><code class="o">.</code><code class="n">load_dataset</code><code class="p">(</code><code class="s2">"iris"</code><code class="p">)</code>
        <code class="n">iris</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]:</code>    <code class="n">sepal_length</code>  <code class="n">sepal_width</code>  <code class="n">petal_length</code>  <code class="n">petal_width</code> <code class="n">species</code>
        <code class="mi">0</code>           <code class="mf">5.1</code>          <code class="mf">3.5</code>           <code class="mf">1.4</code>          <code class="mf">0.2</code>  <code class="n">setosa</code>
        <code class="mi">1</code>           <code class="mf">4.9</code>          <code class="mf">3.0</code>           <code class="mf">1.4</code>          <code class="mf">0.2</code>  <code class="n">setosa</code>
        <code class="mi">2</code>           <code class="mf">4.7</code>          <code class="mf">3.2</code>           <code class="mf">1.3</code>          <code class="mf">0.2</code>  <code class="n">setosa</code>
        <code class="mi">3</code>           <code class="mf">4.6</code>          <code class="mf">3.1</code>           <code class="mf">1.5</code>          <code class="mf">0.2</code>  <code class="n">setosa</code>
        <code class="mi">4</code>           <code class="mf">5.0</code>          <code class="mf">3.6</code>           <code class="mf">1.4</code>          <code class="mf">0.2</code>  <code class="n">setosa</code></pre>
<p class="pagebreak-before less_space">Visualizing the multidimensional relationships among the samples is as
easy as calling <code>sns.pairplot</code> (see <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_14_0">Figure 36-4</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">pairplot</code><code class="p">(</code><code class="n">iris</code><code class="p">,</code> <code class="n">hue</code><code class="o">=</code><code class="s1">'species'</code><code class="p">,</code> <code class="n">height</code><code class="o">=</code><code class="mf">2.5</code><code class="p">);</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_14_0">
<img alt="output 14 0" height="395" src="assets/output_14_0.png" width="600"/>
<h6><span class="label">Figure 36-4. </span>A pair plot showing the relationships between four variables</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Faceted Histograms" data-type="sect2"><div class="sect2" id="ch_0414-visualization-with-seaborn_faceted-histograms">
<h2>Faceted Histograms</h2>
<p><a data-primary="faceted histograms" data-type="indexterm" id="idm45858747305072"/><a data-primary="histograms" data-secondary="faceted" data-type="indexterm" id="idm45858747304368"/><a data-primary="Seaborn" data-secondary="faceted histograms" data-type="indexterm" id="idm45858747328160"/>Sometimes the best way to view data is via histograms of subsets, as
shown in <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_17_0">Figure 36-5</a>. Seaborn’s <code>FacetGrid</code> makes
this simple. We’ll take a look at some data that shows the
amount that restaurant staff receive in tips based on various indicator
data:<sup><a data-type="noteref" href="ch36.xhtml#idm45858747325904" id="idm45858747325904-marker">1</a></sup></p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">tips</code> <code class="o">=</code> <code class="n">sns</code><code class="o">.</code><code class="n">load_dataset</code><code class="p">(</code><code class="s1">'tips'</code><code class="p">)</code>
        <code class="n">tips</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">7</code><code class="p">]:</code>    <code class="n">total_bill</code>   <code class="n">tip</code>     <code class="n">sex</code> <code class="n">smoker</code>  <code class="n">day</code>    <code class="n">time</code>  <code class="n">size</code>
        <code class="mi">0</code>       <code class="mf">16.99</code>  <code class="mf">1.01</code>  <code class="n">Female</code>     <code class="n">No</code>  <code class="n">Sun</code>  <code class="n">Dinner</code>     <code class="mi">2</code>
        <code class="mi">1</code>       <code class="mf">10.34</code>  <code class="mf">1.66</code>    <code class="n">Male</code>     <code class="n">No</code>  <code class="n">Sun</code>  <code class="n">Dinner</code>     <code class="mi">3</code>
        <code class="mi">2</code>       <code class="mf">21.01</code>  <code class="mf">3.50</code>    <code class="n">Male</code>     <code class="n">No</code>  <code class="n">Sun</code>  <code class="n">Dinner</code>     <code class="mi">3</code>
        <code class="mi">3</code>       <code class="mf">23.68</code>  <code class="mf">3.31</code>    <code class="n">Male</code>     <code class="n">No</code>  <code class="n">Sun</code>  <code class="n">Dinner</code>     <code class="mi">2</code>
        <code class="mi">4</code>       <code class="mf">24.59</code>  <code class="mf">3.61</code>  <code class="n">Female</code>     <code class="n">No</code>  <code class="n">Sun</code>  <code class="n">Dinner</code>     <code class="mi">4</code></pre>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="n">tips</code><code class="p">[</code><code class="s1">'tip_pct'</code><code class="p">]</code> <code class="o">=</code> <code class="mi">100</code> <code class="o">*</code> <code class="n">tips</code><code class="p">[</code><code class="s1">'tip'</code><code class="p">]</code> <code class="o">/</code> <code class="n">tips</code><code class="p">[</code><code class="s1">'total_bill'</code><code class="p">]</code>

        <code class="n">grid</code> <code class="o">=</code> <code class="n">sns</code><code class="o">.</code><code class="n">FacetGrid</code><code class="p">(</code><code class="n">tips</code><code class="p">,</code> <code class="n">row</code><code class="o">=</code><code class="s2">"sex"</code><code class="p">,</code> <code class="n">col</code><code class="o">=</code><code class="s2">"time"</code><code class="p">,</code> <code class="n">margin_titles</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code>
        <code class="n">grid</code><code class="o">.</code><code class="n">map</code><code class="p">(</code><code class="n">plt</code><code class="o">.</code><code class="n">hist</code><code class="p">,</code> <code class="s2">"tip_pct"</code><code class="p">,</code> <code class="n">bins</code><code class="o">=</code><code class="n">np</code><code class="o">.</code><code class="n">linspace</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">40</code><code class="p">,</code> <code class="mi">15</code><code class="p">));</code></pre>
<figure class="width-90"><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_17_0">
<img alt="output 17 0" height="401" src="assets/output_17_0.png" width="600"/>
<h6><span class="label">Figure 36-5. </span>An example of a faceted histogram</h6>
</div></figure>
<p class="pagebreak-before less_space">The faceted chart gives us some quick insights into the dataset: for
example, we see that it contains far more data on male servers during
the dinner hour than other categories, and typical tip amounts appear to
range from approximately 10% to 20%, with some outliers on either end.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="Categorical Plots" data-type="sect1"><div class="sect1" id="ch_0414-visualization-with-seaborn_categorical-plots">
<h1>Categorical Plots</h1>
<p><a data-primary="categorical plots" data-type="indexterm" id="idm45858747136064"/><a data-primary="plotting" data-secondary="categorical plots" data-type="indexterm" id="idm45858747135360"/><a data-primary="Seaborn" data-secondary="categorical plots" data-type="indexterm" id="idm45858747134416"/>Categorical plots can be useful for this kind of visualization as well.
These allow you to view the distribution of a parameter within bins
defined by any other parameter, as shown in <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_19_0">Figure 36-6</a>.</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="k">with</code> <code class="n">sns</code><code class="o">.</code><code class="n">axes_style</code><code class="p">(</code><code class="n">style</code><code class="o">=</code><code class="s1">'ticks'</code><code class="p">):</code>
            <code class="n">g</code> <code class="o">=</code> <code class="n">sns</code><code class="o">.</code><code class="n">catplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s2">"day"</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s2">"total_bill"</code><code class="p">,</code> <code class="n">hue</code><code class="o">=</code><code class="s2">"sex"</code><code class="p">,</code>
                            <code class="n">data</code><code class="o">=</code><code class="n">tips</code><code class="p">,</code> <code class="n">kind</code><code class="o">=</code><code class="s2">"box"</code><code class="p">)</code>
            <code class="n">g</code><code class="o">.</code><code class="n">set_axis_labels</code><code class="p">(</code><code class="s2">"Day"</code><code class="p">,</code> <code class="s2">"Total Bill"</code><code class="p">);</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_19_0">
<img alt="output 19 0" height="398" src="assets/output_19_0.png" width="600"/>
<h6><span class="label">Figure 36-6. </span>An example of a factor plot, comparing distributions given various discrete factors</h6>
</div></figure>
<section class="pagebreak-before less_space" data-pdf-bookmark="Joint Distributions" data-type="sect2"><div class="sect2" id="ch_0414-visualization-with-seaborn_joint-distributions">
<h2>Joint Distributions</h2>
<p><a data-primary="joint distributions" data-type="indexterm" id="idm45858747044640"/><a data-primary="plotting" data-secondary="joint distributions" data-type="indexterm" id="idm45858747043936"/><a data-primary="Seaborn" data-secondary="joint distributions" data-type="indexterm" id="idm45858747042992"/>Similar to the pair plot we saw earlier, we can use <code>sns.jointplot</code> to
show the joint distribution between different datasets, along with the
associated marginal distributions (see <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_21_0">Figure 36-7</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">10</code><code class="p">]:</code> <code class="k">with</code> <code class="n">sns</code><code class="o">.</code><code class="n">axes_style</code><code class="p">(</code><code class="s1">'white'</code><code class="p">):</code>
             <code class="n">sns</code><code class="o">.</code><code class="n">jointplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s2">"total_bill"</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s2">"tip"</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">tips</code><code class="p">,</code> <code class="n">kind</code><code class="o">=</code><code class="s1">'hex'</code><code class="p">)</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_21_0">
<img alt="output 21 0" height="392" src="assets/output_21_0.png" width="600"/>
<h6><span class="label">Figure 36-7. </span>A joint distribution plot</h6>
</div></figure>
<p>The joint plot can even do some automatic kernel density estimation and
regression, as shown in <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_23_0">Figure 36-8</a>.</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">jointplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s2">"total_bill"</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s2">"tip"</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">tips</code><code class="p">,</code> <code class="n">kind</code><code class="o">=</code><code class="s1">'reg'</code><code class="p">);</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_23_0">
<img alt="output 23 0" height="398" src="assets/output_23_0.png" width="600"/>
<h6><span class="label">Figure 36-8. </span>A joint distribution plot with a regression fit</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Bar Plots" data-type="sect2"><div class="sect2" id="ch_0414-visualization-with-seaborn_bar-plots">
<h2>Bar Plots</h2>
<p><a data-primary="bar plots" data-type="indexterm" id="idm45858746909200"/><a data-primary="Planets dataset" data-secondary="bar plots" data-type="indexterm" id="idm45858746908272"/><a data-primary="plotting" data-secondary="bar plots" data-type="indexterm" id="idm45858746907328"/><a data-primary="Seaborn" data-secondary="bar plots" data-type="indexterm" id="idm45858746906384"/><a data-primary="time series" data-secondary="bar plots" data-type="indexterm" id="idm45858746905440"/>Time series can be plotted using <code>sns.factorplot</code>. In the following
example, we’ll use the Planets dataset that we first saw in
<a data-type="xref" href="ch20.xhtml#section-0308-aggregation-and-grouping">Chapter 20</a>; see
<a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_26_0">Figure 36-9</a> for the result.</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="n">planets</code> <code class="o">=</code> <code class="n">sns</code><code class="o">.</code><code class="n">load_dataset</code><code class="p">(</code><code class="s1">'planets'</code><code class="p">)</code>
         <code class="n">planets</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">12</code><code class="p">]:</code>             <code class="n">method</code>  <code class="n">number</code>  <code class="n">orbital_period</code>   <code class="n">mass</code>  <code class="n">distance</code>  <code class="n">year</code>
         <code class="mi">0</code>  <code class="n">Radial</code> <code class="n">Velocity</code>       <code class="mi">1</code>         <code class="mf">269.300</code>   <code class="mf">7.10</code>     <code class="mf">77.40</code>  <code class="mi">2006</code>
         <code class="mi">1</code>  <code class="n">Radial</code> <code class="n">Velocity</code>       <code class="mi">1</code>         <code class="mf">874.774</code>   <code class="mf">2.21</code>     <code class="mf">56.95</code>  <code class="mi">2008</code>
         <code class="mi">2</code>  <code class="n">Radial</code> <code class="n">Velocity</code>       <code class="mi">1</code>         <code class="mf">763.000</code>   <code class="mf">2.60</code>     <code class="mf">19.84</code>  <code class="mi">2011</code>
         <code class="mi">3</code>  <code class="n">Radial</code> <code class="n">Velocity</code>       <code class="mi">1</code>         <code class="mf">326.030</code>  <code class="mf">19.40</code>    <code class="mf">110.62</code>  <code class="mi">2007</code>
         <code class="mi">4</code>  <code class="n">Radial</code> <code class="n">Velocity</code>       <code class="mi">1</code>         <code class="mf">516.220</code>  <code class="mf">10.50</code>    <code class="mf">119.47</code>  <code class="mi">2009</code></pre>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="k">with</code> <code class="n">sns</code><code class="o">.</code><code class="n">axes_style</code><code class="p">(</code><code class="s1">'white'</code><code class="p">):</code>
             <code class="n">g</code> <code class="o">=</code> <code class="n">sns</code><code class="o">.</code><code class="n">catplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s2">"year"</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">planets</code><code class="p">,</code> <code class="n">aspect</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code>
                             <code class="n">kind</code><code class="o">=</code><code class="s2">"count"</code><code class="p">,</code> <code class="n">color</code><code class="o">=</code><code class="s1">'steelblue'</code><code class="p">)</code>
             <code class="n">g</code><code class="o">.</code><code class="n">set_xticklabels</code><code class="p">(</code><code class="n">step</code><code class="o">=</code><code class="mi">5</code><code class="p">)</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_26_0">
<img alt="output 26 0" height="377" src="assets/output_26_0.png" width="600"/>
<h6><span class="label">Figure 36-9. </span>A histogram as a special case of a factor plot</h6>
</div></figure>
<p>We can learn more by looking at the <em>method</em> of discovery of each of
these planets (see <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_28_0">Figure 36-10</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="k">with</code> <code class="n">sns</code><code class="o">.</code><code class="n">axes_style</code><code class="p">(</code><code class="s1">'white'</code><code class="p">):</code>
             <code class="n">g</code> <code class="o">=</code> <code class="n">sns</code><code class="o">.</code><code class="n">catplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s2">"year"</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">planets</code><code class="p">,</code> <code class="n">aspect</code><code class="o">=</code><code class="mf">4.0</code><code class="p">,</code> <code class="n">kind</code><code class="o">=</code><code class="s1">'count'</code><code class="p">,</code>
                             <code class="n">hue</code><code class="o">=</code><code class="s1">'method'</code><code class="p">,</code> <code class="n">order</code><code class="o">=</code><code class="nb">range</code><code class="p">(</code><code class="mi">2001</code><code class="p">,</code> <code class="mi">2015</code><code class="p">))</code>
             <code class="n">g</code><code class="o">.</code><code class="n">set_ylabels</code><code class="p">(</code><code class="s1">'Number of Planets Discovered'</code><code class="p">)</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_28_0">
<img alt="output 28 0" height="685" src="assets/output_28_0.png" width="600"/>
<h6><span class="label">Figure 36-10. </span>Number of planets discovered by year and type</h6>
</div></figure>
<p>For more information on plotting with Seaborn, see the
<a href="https://oreil.ly/fCHxn">Seaborn documentation</a>, and particularly the
<a href="https://oreil.ly/08xGE">example gallery</a>.</p>
</div></section>
</div></section>
<section class="pagebreak-before less_space" data-pdf-bookmark="Example: Exploring Marathon Finishing Times" data-type="sect1"><div class="sect1" id="ch_0414-visualization-with-seaborn_example-exploring-marathon-finishing-times">
<h1>Example: Exploring Marathon Finishing Times</h1>
<p><a data-primary="Seaborn" data-secondary="marathon finishing times example" data-type="indexterm" id="ix_ch36-asciidoc9"/>Here we’ll look at using Seaborn to help visualize and
understand finishing results from a marathon.<sup><a data-type="noteref" href="ch36.xhtml#idm45858746633600" id="idm45858746633600-marker">2</a></sup> I’ve scraped
the data from sources on the web, aggregated it and removed any
identifying information, and put it on GitHub, where it can be

<span class="keep-together">downloaded</span>.<sup><a data-type="noteref" href="ch36.xhtml#idm45858746632288" id="idm45858746632288-marker">3</a></sup></p>
<p>We will start by downloading the data and loading
it into Pandas:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="c1"># url = ('https://raw.githubusercontent.com/jakevdp/'</code>
         <code class="c1">#        'marathon-data/master/marathon-data.csv')</code>
         <code class="c1"># !cd data &amp;&amp; curl -O {url}</code></pre>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">16</code><code class="p">]:</code> <code class="n">data</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="s1">'data/marathon-data.csv'</code><code class="p">)</code>
         <code class="n">data</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">16</code><code class="p">]:</code>    <code class="n">age</code> <code class="n">gender</code>     <code class="n">split</code>     <code class="n">final</code>
         <code class="mi">0</code>   <code class="mi">33</code>      <code class="n">M</code>  <code class="mi">01</code><code class="p">:</code><code class="mi">05</code><code class="p">:</code><code class="mi">38</code>  <code class="mi">02</code><code class="p">:</code><code class="mi">08</code><code class="p">:</code><code class="mi">51</code>
         <code class="mi">1</code>   <code class="mi">32</code>      <code class="n">M</code>  <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">26</code>  <code class="mi">02</code><code class="p">:</code><code class="mi">09</code><code class="p">:</code><code class="mi">28</code>
         <code class="mi">2</code>   <code class="mi">31</code>      <code class="n">M</code>  <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">49</code>  <code class="mi">02</code><code class="p">:</code><code class="mi">10</code><code class="p">:</code><code class="mi">42</code>
         <code class="mi">3</code>   <code class="mi">38</code>      <code class="n">M</code>  <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">16</code>  <code class="mi">02</code><code class="p">:</code><code class="mi">13</code><code class="p">:</code><code class="mi">45</code>
         <code class="mi">4</code>   <code class="mi">31</code>      <code class="n">M</code>  <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">32</code>  <code class="mi">02</code><code class="p">:</code><code class="mi">13</code><code class="p">:</code><code class="mi">59</code></pre>
<p>Notice that Pandas loaded the time columns as Python strings (type
<code>object</code>); we can see this by looking at the <code>dtypes</code> attribute of the
<code>DataFrame</code>:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">17</code><code class="p">]:</code> <code class="n">data</code><code class="o">.</code><code class="n">dtypes</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">17</code><code class="p">]:</code> <code class="n">age</code>        <code class="n">int64</code>
         <code class="n">gender</code>    <code class="nb">object</code>
         <code class="n">split</code>     <code class="nb">object</code>
         <code class="n">final</code>     <code class="nb">object</code>
         <code class="n">dtype</code><code class="p">:</code> <code class="nb">object</code></pre>
<p>Let’s fix this by providing a converter for the times:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">18</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">datetime</code>

         <code class="k">def</code> <code class="nf">convert_time</code><code class="p">(</code><code class="n">s</code><code class="p">):</code>
             <code class="n">h</code><code class="p">,</code> <code class="n">m</code><code class="p">,</code> <code class="n">s</code> <code class="o">=</code> <code class="nb">map</code><code class="p">(</code><code class="nb">int</code><code class="p">,</code> <code class="n">s</code><code class="o">.</code><code class="n">split</code><code class="p">(</code><code class="s1">':'</code><code class="p">))</code>
             <code class="k">return</code> <code class="n">datetime</code><code class="o">.</code><code class="n">timedelta</code><code class="p">(</code><code class="n">hours</code><code class="o">=</code><code class="n">h</code><code class="p">,</code> <code class="n">minutes</code><code class="o">=</code><code class="n">m</code><code class="p">,</code> <code class="n">seconds</code><code class="o">=</code><code class="n">s</code><code class="p">)</code>

         <code class="n">data</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="s1">'data/marathon-data.csv'</code><code class="p">,</code>
                            <code class="n">converters</code><code class="o">=</code><code class="p">{</code><code class="s1">'split'</code><code class="p">:</code><code class="n">convert_time</code><code class="p">,</code> <code class="s1">'final'</code><code class="p">:</code><code class="n">convert_time</code><code class="p">})</code>
         <code class="n">data</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">18</code><code class="p">]:</code>    <code class="n">age</code> <code class="n">gender</code>           <code class="n">split</code>           <code class="n">final</code>
         <code class="mi">0</code>   <code class="mi">33</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">05</code><code class="p">:</code><code class="mi">38</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">08</code><code class="p">:</code><code class="mi">51</code>
         <code class="mi">1</code>   <code class="mi">32</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">26</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">09</code><code class="p">:</code><code class="mi">28</code>
         <code class="mi">2</code>   <code class="mi">31</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">49</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">10</code><code class="p">:</code><code class="mi">42</code>
         <code class="mi">3</code>   <code class="mi">38</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">16</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">13</code><code class="p">:</code><code class="mi">45</code>
         <code class="mi">4</code>   <code class="mi">31</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">32</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">13</code><code class="p">:</code><code class="mi">59</code></pre>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">19</code><code class="p">]:</code> <code class="n">data</code><code class="o">.</code><code class="n">dtypes</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">19</code><code class="p">]:</code> <code class="n">age</code>                 <code class="n">int64</code>
         <code class="n">gender</code>             <code class="nb">object</code>
         <code class="n">split</code>     <code class="n">timedelta64</code><code class="p">[</code><code class="n">ns</code><code class="p">]</code>
         <code class="n">final</code>     <code class="n">timedelta64</code><code class="p">[</code><code class="n">ns</code><code class="p">]</code>
         <code class="n">dtype</code><code class="p">:</code> <code class="nb">object</code></pre>
<p>That will make it easier to manipulate the temporal data. For the
purpose of our Seaborn plotting utilities, let’s next add
columns that give the times in seconds:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">20</code><code class="p">]:</code> <code class="n">data</code><code class="p">[</code><code class="s1">'split_sec'</code><code class="p">]</code> <code class="o">=</code> <code class="n">data</code><code class="p">[</code><code class="s1">'split'</code><code class="p">]</code><code class="o">.</code><code class="n">view</code><code class="p">(</code><code class="nb">int</code><code class="p">)</code> <code class="o">/</code> <code class="mf">1E9</code>
         <code class="n">data</code><code class="p">[</code><code class="s1">'final_sec'</code><code class="p">]</code> <code class="o">=</code> <code class="n">data</code><code class="p">[</code><code class="s1">'final'</code><code class="p">]</code><code class="o">.</code><code class="n">view</code><code class="p">(</code><code class="nb">int</code><code class="p">)</code> <code class="o">/</code> <code class="mf">1E9</code>
         <code class="n">data</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">20</code><code class="p">]:</code>    <code class="n">age</code> <code class="n">gender</code>           <code class="n">split</code>           <code class="n">final</code>  <code class="n">split_sec</code>  <code class="n">final_sec</code>
         <code class="mi">0</code>   <code class="mi">33</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">05</code><code class="p">:</code><code class="mi">38</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">08</code><code class="p">:</code><code class="mi">51</code>     <code class="mf">3938.0</code>     <code class="mf">7731.0</code>
         <code class="mi">1</code>   <code class="mi">32</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">26</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">09</code><code class="p">:</code><code class="mi">28</code>     <code class="mf">3986.0</code>     <code class="mf">7768.0</code>
         <code class="mi">2</code>   <code class="mi">31</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">49</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">10</code><code class="p">:</code><code class="mi">42</code>     <code class="mf">4009.0</code>     <code class="mf">7842.0</code>
         <code class="mi">3</code>   <code class="mi">38</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">16</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">13</code><code class="p">:</code><code class="mi">45</code>     <code class="mf">3976.0</code>     <code class="mf">8025.0</code>
         <code class="mi">4</code>   <code class="mi">31</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">32</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">13</code><code class="p">:</code><code class="mi">59</code>     <code class="mf">3992.0</code>     <code class="mf">8039.0</code></pre>
<p>To get an idea of what the data looks like, we can plot a <code>jointplot</code>
over the data; <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_41_0">Figure 36-11</a> shows the result.</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">21</code><code class="p">]:</code> <code class="k">with</code> <code class="n">sns</code><code class="o">.</code><code class="n">axes_style</code><code class="p">(</code><code class="s1">'white'</code><code class="p">):</code>
             <code class="n">g</code> <code class="o">=</code> <code class="n">sns</code><code class="o">.</code><code class="n">jointplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s1">'split_sec'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s1">'final_sec'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">data</code><code class="p">,</code> <code class="n">kind</code><code class="o">=</code><code class="s1">'hex'</code><code class="p">)</code>
             <code class="n">g</code><code class="o">.</code><code class="n">ax_joint</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">linspace</code><code class="p">(</code><code class="mi">4000</code><code class="p">,</code> <code class="mi">16000</code><code class="p">),</code>
                             <code class="n">np</code><code class="o">.</code><code class="n">linspace</code><code class="p">(</code><code class="mi">8000</code><code class="p">,</code> <code class="mi">32000</code><code class="p">),</code> <code class="s1">':k'</code><code class="p">)</code></pre>
<p>The dotted line shows where someone’s time would lie if they
ran the marathon at a perfectly steady pace. The fact that the
distribution lies above this indicates (as you might expect) that most
people slow down over the course of the marathon. If you have run
competitively, you’ll know that those who do the
opposite—run faster during the second half of the race—are said to have
“negative-split” the race.</p>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_41_0">
<img alt="output 41 0" height="394" src="assets/output_41_0.png" width="600"/>
<h6><span class="label">Figure 36-11. </span>The relationship between the split for the first half-marathon and the fin‐ ishing time for the full marathon</h6>
</div></figure>
<p>Let’s create another column in the data, the split fraction,
which measures the degree to which each runner negative-splits or
positive-splits the race:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">22</code><code class="p">]:</code> <code class="n">data</code><code class="p">[</code><code class="s1">'split_frac'</code><code class="p">]</code> <code class="o">=</code> <code class="mi">1</code> <code class="o">-</code> <code class="mi">2</code> <code class="o">*</code> <code class="n">data</code><code class="p">[</code><code class="s1">'split_sec'</code><code class="p">]</code> <code class="o">/</code> <code class="n">data</code><code class="p">[</code><code class="s1">'final_sec'</code><code class="p">]</code>
         <code class="n">data</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">22</code><code class="p">]:</code>    <code class="n">age</code> <code class="n">gender</code>           <code class="n">split</code>           <code class="n">final</code>  <code class="n">split_sec</code>  <code class="n">final_sec</code>  \
         <code class="mi">0</code>   <code class="mi">33</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">05</code><code class="p">:</code><code class="mi">38</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">08</code><code class="p">:</code><code class="mi">51</code>     <code class="mf">3938.0</code>     <code class="mf">7731.0</code>
         <code class="mi">1</code>   <code class="mi">32</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">26</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">09</code><code class="p">:</code><code class="mi">28</code>     <code class="mf">3986.0</code>     <code class="mf">7768.0</code>
         <code class="mi">2</code>   <code class="mi">31</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">49</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">10</code><code class="p">:</code><code class="mi">42</code>     <code class="mf">4009.0</code>     <code class="mf">7842.0</code>
         <code class="mi">3</code>   <code class="mi">38</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">16</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">13</code><code class="p">:</code><code class="mi">45</code>     <code class="mf">3976.0</code>     <code class="mf">8025.0</code>
         <code class="mi">4</code>   <code class="mi">31</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">32</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">13</code><code class="p">:</code><code class="mi">59</code>     <code class="mf">3992.0</code>     <code class="mf">8039.0</code>

            <code class="n">split_frac</code>
         <code class="mi">0</code>   <code class="o">-</code><code class="mf">0.018756</code>
         <code class="mi">1</code>   <code class="o">-</code><code class="mf">0.026262</code>
         <code class="mi">2</code>   <code class="o">-</code><code class="mf">0.022443</code>
         <code class="mi">3</code>    <code class="mf">0.009097</code>
         <code class="mi">4</code>    <code class="mf">0.006842</code></pre>
<p>Where this split difference is less than zero, the person negative-split
the race by that fraction. Let’s do a distribution plot of
this split fraction (see <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_45_0">Figure 36-12</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">23</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">displot</code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="s1">'split_frac'</code><code class="p">],</code> <code class="n">kde</code><code class="o">=</code><code class="kc">False</code><code class="p">)</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">axvline</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="n">color</code><code class="o">=</code><code class="s2">"k"</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s2">"--"</code><code class="p">);</code></pre>
<figure class="width-75"><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_45_0">
<img alt="output 45 0" height="399" src="assets/output_45_0.png" width="600"/>
<h6><span class="label">Figure 36-12. </span>The distribution of split fractions; 0.0 indicates a runner who completed the first and second halves in identical times</h6>
</div></figure>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">24</code><code class="p">]:</code> <code class="nb">sum</code><code class="p">(</code><code class="n">data</code><code class="o">.</code><code class="n">split_frac</code> <code class="o">&lt;</code> <code class="mi">0</code><code class="p">)</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">24</code><code class="p">]:</code> <code class="mi">251</code></pre>
<p>Out of nearly 40,000 participants, there were only 250 people who
negative-split their marathon.</p>
<p>Let’s see whether there is any correlation between this
split fraction and other variables. We’ll do this using a
<code>PairGrid</code>, which draws plots of all these correlations (see <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_48_0">Figure 36-13</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">25</code><code class="p">]:</code> <code class="n">g</code> <code class="o">=</code> <code class="n">sns</code><code class="o">.</code><code class="n">PairGrid</code><code class="p">(</code><code class="n">data</code><code class="p">,</code> <code class="nb">vars</code><code class="o">=</code><code class="p">[</code><code class="s1">'age'</code><code class="p">,</code> <code class="s1">'split_sec'</code><code class="p">,</code> <code class="s1">'final_sec'</code><code class="p">,</code> <code class="s1">'split_frac'</code><code class="p">],</code>
                          <code class="n">hue</code><code class="o">=</code><code class="s1">'gender'</code><code class="p">,</code> <code class="n">palette</code><code class="o">=</code><code class="s1">'RdBu_r'</code><code class="p">)</code>
         <code class="n">g</code><code class="o">.</code><code class="n">map</code><code class="p">(</code><code class="n">plt</code><code class="o">.</code><code class="n">scatter</code><code class="p">,</code> <code class="n">alpha</code><code class="o">=</code><code class="mf">0.8</code><code class="p">)</code>
         <code class="n">g</code><code class="o">.</code><code class="n">add_legend</code><code class="p">();</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_48_0">
<img alt="output 48 0" height="401" src="assets/output_48_0.png" width="600"/>
<h6><span class="label">Figure 36-13. </span>The relationship between quantities within the marathon dataset</h6>
</div></figure>
<p>It looks like the split fraction does not correlate particularly with
age, but does correlate with the final time: faster runners tend to have
closer to even splits on their marathon time. Let’s zoom in
on the histogram of split fractions separated by gender, shown in <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_50_0">Figure 36-14</a>.</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">26</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">kdeplot</code><code class="p">(</code><code class="n">data</code><code class="o">.</code><code class="n">split_frac</code><code class="p">[</code><code class="n">data</code><code class="o">.</code><code class="n">gender</code><code class="o">==</code><code class="s1">'M'</code><code class="p">],</code> <code class="n">label</code><code class="o">=</code><code class="s1">'men'</code><code class="p">,</code> <code class="n">shade</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code>
         <code class="n">sns</code><code class="o">.</code><code class="n">kdeplot</code><code class="p">(</code><code class="n">data</code><code class="o">.</code><code class="n">split_frac</code><code class="p">[</code><code class="n">data</code><code class="o">.</code><code class="n">gender</code><code class="o">==</code><code class="s1">'W'</code><code class="p">],</code> <code class="n">label</code><code class="o">=</code><code class="s1">'women'</code><code class="p">,</code> <code class="n">shade</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'split_frac'</code><code class="p">);</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_50_0">
<img alt="output 50 0" height="415" src="assets/output_50_0.png" width="600"/>
<h6><span class="label">Figure 36-14. </span>The distribution of split fractions by gender</h6>
</div></figure>
<p>The interesting thing here is that there are many more men than women
who are running close to an even split! It almost looks like a bimodal
distribution among the men and women. Let’s see if we can
suss out what’s going on by looking at the distributions as
a function of age.</p>
<p><a data-primary="violin plot" data-type="indexterm" id="idm45858745363680"/>A nice way to compare distributions is to use a <em>violin plot</em>, shown in
<a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_52_0">Figure 36-15</a>.</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">27</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">violinplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s2">"gender"</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s2">"split_frac"</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">data</code><code class="p">,</code>
                        <code class="n">palette</code><code class="o">=</code><code class="p">[</code><code class="s2">"lightblue"</code><code class="p">,</code> <code class="s2">"lightpink"</code><code class="p">]);</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_52_0">
<img alt="output 52 0" height="293" src="assets/output_52_0.png" width="600"/>
<h6><span class="label">Figure 36-15. </span>A violin plot showing the split fraction by gender</h6>
</div></figure>
<p>Let’s look a little deeper, and compare these violin plots
as a function of age (see <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_55_0">Figure 36-16</a>). We’ll start
by creating a new column in the array that specifies the age range that
each person is in, by decade:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">28</code><code class="p">]:</code> <code class="n">data</code><code class="p">[</code><code class="s1">'age_dec'</code><code class="p">]</code> <code class="o">=</code> <code class="n">data</code><code class="o">.</code><code class="n">age</code><code class="o">.</code><code class="n">map</code><code class="p">(</code><code class="k">lambda</code> <code class="n">age</code><code class="p">:</code> <code class="mi">10</code> <code class="o">*</code> <code class="p">(</code><code class="n">age</code> <code class="o">//</code> <code class="mi">10</code><code class="p">))</code>
         <code class="n">data</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">28</code><code class="p">]:</code>    <code class="n">age</code> <code class="n">gender</code>           <code class="n">split</code>           <code class="n">final</code>  <code class="n">split_sec</code>  <code class="n">final_sec</code>  \
         <code class="mi">0</code>   <code class="mi">33</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">05</code><code class="p">:</code><code class="mi">38</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">08</code><code class="p">:</code><code class="mi">51</code>     <code class="mf">3938.0</code>     <code class="mf">7731.0</code>
         <code class="mi">1</code>   <code class="mi">32</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">26</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">09</code><code class="p">:</code><code class="mi">28</code>     <code class="mf">3986.0</code>     <code class="mf">7768.0</code>
         <code class="mi">2</code>   <code class="mi">31</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">49</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">10</code><code class="p">:</code><code class="mi">42</code>     <code class="mf">4009.0</code>     <code class="mf">7842.0</code>
         <code class="mi">3</code>   <code class="mi">38</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">16</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">13</code><code class="p">:</code><code class="mi">45</code>     <code class="mf">3976.0</code>     <code class="mf">8025.0</code>
         <code class="mi">4</code>   <code class="mi">31</code>      <code class="n">M</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">01</code><code class="p">:</code><code class="mi">06</code><code class="p">:</code><code class="mi">32</code> <code class="mi">0</code> <code class="n">days</code> <code class="mi">02</code><code class="p">:</code><code class="mi">13</code><code class="p">:</code><code class="mi">59</code>     <code class="mf">3992.0</code>     <code class="mf">8039.0</code>

            <code class="n">split_frac</code>  <code class="n">age_dec</code>
         <code class="mi">0</code>   <code class="o">-</code><code class="mf">0.018756</code>       <code class="mi">30</code>
         <code class="mi">1</code>   <code class="o">-</code><code class="mf">0.026262</code>       <code class="mi">30</code>
         <code class="mi">2</code>   <code class="o">-</code><code class="mf">0.022443</code>       <code class="mi">30</code>
         <code class="mi">3</code>    <code class="mf">0.009097</code>       <code class="mi">30</code>
         <code class="mi">4</code>    <code class="mf">0.006842</code>       <code class="mi">30</code></pre>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">29</code><code class="p">]:</code> <code class="n">men</code> <code class="o">=</code> <code class="p">(</code><code class="n">data</code><code class="o">.</code><code class="n">gender</code> <code class="o">==</code> <code class="s1">'M'</code><code class="p">)</code>
         <code class="n">women</code> <code class="o">=</code> <code class="p">(</code><code class="n">data</code><code class="o">.</code><code class="n">gender</code> <code class="o">==</code> <code class="s1">'W'</code><code class="p">)</code>

         <code class="k">with</code> <code class="n">sns</code><code class="o">.</code><code class="n">axes_style</code><code class="p">(</code><code class="n">style</code><code class="o">=</code><code class="kc">None</code><code class="p">):</code>
             <code class="n">sns</code><code class="o">.</code><code class="n">violinplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s2">"age_dec"</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s2">"split_frac"</code><code class="p">,</code> <code class="n">hue</code><code class="o">=</code><code class="s2">"gender"</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">data</code><code class="p">,</code>
                            <code class="n">split</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code> <code class="n">inner</code><code class="o">=</code><code class="s2">"quartile"</code><code class="p">,</code>
                            <code class="n">palette</code><code class="o">=</code><code class="p">[</code><code class="s2">"lightblue"</code><code class="p">,</code> <code class="s2">"lightpink"</code><code class="p">]);</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_55_0">
<img alt="output 55 0" height="253" src="assets/output_55_0.png" width="600"/>
<h6><span class="label">Figure 36-16. </span>A violin plot showing the split fraction by gender and age</h6>
</div></figure>
<p>We can see where the distributions among men and women differ: the split
distributions of men in their 20s to 50s show a pronounced overdensity
toward lower splits when compared to women of the same age (or of any
age, for that matter).</p>
<p>Also surprisingly, it appears that the 80-year-old women seem to
outperform <em>everyone</em> in terms of their split time, although this is
likely a small number effect, as there are only a handful of runners in
that range:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">30</code><code class="p">]:</code> <code class="p">(</code><code class="n">data</code><code class="o">.</code><code class="n">age</code> <code class="o">&gt;</code> <code class="mi">80</code><code class="p">)</code><code class="o">.</code><code class="n">sum</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">30</code><code class="p">]:</code> <code class="mi">7</code></pre>
<p>Back to the men with negative splits: who are these runners? Does this
split fraction correlate with finishing quickly? We can plot this very
easily. We’ll use <code>regplot</code>, which will automatically fit a
linear regression model to the data (see <a data-type="xref" href="#fig_0414-visualization-with-seaborn_files_in_output_59_0">Figure 36-17</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">31</code><code class="p">]:</code> <code class="n">g</code> <code class="o">=</code> <code class="n">sns</code><code class="o">.</code><code class="n">lmplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s1">'final_sec'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s1">'split_frac'</code><code class="p">,</code> <code class="n">col</code><code class="o">=</code><code class="s1">'gender'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">data</code><code class="p">,</code>
                        <code class="n">markers</code><code class="o">=</code><code class="s2">"."</code><code class="p">,</code> <code class="n">scatter_kws</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">color</code><code class="o">=</code><code class="s1">'c'</code><code class="p">))</code>
         <code class="n">g</code><code class="o">.</code><code class="n">map</code><code class="p">(</code><code class="n">plt</code><code class="o">.</code><code class="n">axhline</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="mf">0.0</code><code class="p">,</code> <code class="n">color</code><code class="o">=</code><code class="s2">"k"</code><code class="p">,</code> <code class="n">ls</code><code class="o">=</code><code class="s2">":"</code><code class="p">);</code></pre>
<figure><div class="figure" id="fig_0414-visualization-with-seaborn_files_in_output_59_0">
<img alt="output 59 0" height="207" src="assets/output_59_0.png" width="600"/>
<h6><span class="label">Figure 36-17. </span>Split fraction versus finishing time by gender</h6>
</div></figure>
<p>Apparently, among both men and women, the people with fast splits tend
to be faster runners who are finishing within ~15,000 seconds, or about
4 hours. People slower than that are much less likely to have a fast
second split<a data-startref="ix_ch36-asciidoc9" data-type="indexterm" id="idm45858744827824"/>.<a data-startref="ix_ch36-asciidoc6" data-type="indexterm" id="idm45858744826992"/><a data-startref="ix_ch36-asciidoc5" data-type="indexterm" id="idm45858744826288"/><a data-startref="ix_ch36-asciidoc4" data-type="indexterm" id="idm45858744825616"/></p>
</div></section>
<section data-pdf-bookmark="Further Resources" data-type="sect1"><div class="sect1" id="section-0415-further-resources">
<h1>Further Resources</h1>
<p><a data-primary="Matplotlib" data-secondary="resources and documentation for" data-type="indexterm" id="idm45858744824496"/>A single part of a book can never hope to cover all the available
features and plot types available in Matplotlib. As with other packages
we’ve seen, liberal use of IPython’s tab
completion and help functions (see
<a data-type="xref" href="ch01.xhtml#section-0101-help-and-documentation">Chapter 1</a>) can be very helpful when exploring Matplotlib’s
API. In addition, Matplotlib’s <a href="http://matplotlib.org">online
documentation</a> can be a helpful reference. See in particular the
<a href="https://oreil.ly/WNiHP">Matplotlib gallery</a>, which shows
thumbnails of hundreds of different plot types, each one linked to a
page with the Python code snippet used to generate it. This allows you
to visually inspect and learn about a wide range of different plotting
styles and visualization techniques.</p>
<p>For a book-length treatment of Matplotlib, I would recommend
<em>Interactive Applications Using Matplotlib</em> (Packt), written by
Matplotlib core developer Ben Root.</p>
</div></section>
<section class="pagebreak-before less_space" data-pdf-bookmark="Other Python Visualization Libraries" data-type="sect1"><div class="sect1" id="ch_0415-further-resources_other-python-visualization-libraries">
<h1>Other Python Visualization Libraries</h1>
<p><a data-primary="plotting" data-secondary="various Python graphics libraries" data-type="indexterm" id="idm45858744792208"/>Although Matplotlib is the most prominent Python visualization library,
there are other more modern tools that are worth exploring as well.
I’ll mention a few of them briefly here:</p>
<ul>
<li>
<p><a data-primary="Bokeh" data-type="indexterm" id="idm45858744790432"/><a href="http://bokeh.pydata.org">Bokeh</a> is a JavaScript visualization library
with a Python frontend that creates highly interactive visualizations
capable of handling very large and/or streaming datasets.</p>
</li>
<li>
<p><a data-primary="Plotly" data-type="indexterm" id="idm45858744788304"/><a href="http://plot.ly">Plotly</a> is the eponymous open source product of the
Plotly company, and is similar in spirit to Bokeh. It is actively
developed and provides a wide range of interactive chart types.</p>
</li>
<li>
<p><a data-primary="Holo Views" data-type="indexterm" id="idm45858744786208"/><a href="https://holoviews.org">HoloViews</a> is a more declarative, unified API
for generating charts in a variety of backends, including Bokeh and
Matplotlib.</p>
</li>
<li>
<p><a data-primary="Vega/Vega-Lite" data-type="indexterm" id="idm45858744783984"/><a href="https://vega.github.io">Vega</a> and
<a href="https://vega.github.io/vega-lite">Vega-Lite</a> are declarative graphics
representations, and are the product of years of research into how to
think about data visualization and interaction. The reference rendering
implementation is JavaScript, and the
<a href="https://altair-viz.github.io">Altair package</a><a data-primary="Altair" data-type="indexterm" id="idm45858744781408"/> provides a Python API to
generate these charts.</p>
</li>
</ul>
<p>The visualization landscape in the Python world is constantly evolving,
and I expect that this list may be out of date by the time this book is
published. Additionally, because Python is used in so many domains,
you’ll find many other visualization tools built for more
specific use cases. It can be hard to keep track of all of them, but a
good resource for learning about this wide variety of visualization
tools is <a href="https://pyviz.org">PyViz</a>, an open, community-driven site containing
tutorials and examples of many different visualization tools.<a data-startref="ix_ch36-asciidoc3" data-type="indexterm" id="idm45858744779056"/><a data-startref="ix_ch36-asciidoc2" data-type="indexterm" id="idm45858744778352"/><a data-startref="ix_ch36-asciidoc1" data-type="indexterm" id="idm45858744777680"/><a data-startref="ix_ch36-asciidoc0" data-type="indexterm" id="idm45858744777008"/></p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45858747325904"><sup><a href="ch36.xhtml#idm45858747325904-marker">1</a></sup> The restaurant staff data used in this section divides employees into two sexes: female and male. Biological sex isn’t binary, but the following discussion and visualizations are limited by this data.</p><p data-type="footnote" id="idm45858746633600"><sup><a href="ch36.xhtml#idm45858746633600-marker">2</a></sup> The marathon data used in this section divides runners into two genders: men and women. While gender is a spectrum, the following discussion and visualizations use this binary because they depend on the data.</p><p data-type="footnote" id="idm45858746632288"><sup><a href="ch36.xhtml#idm45858746632288-marker">3</a></sup> If you are interested in using Python for web scraping, I would recommend <a class="orm:hideurl" href="https://oreil.ly/e3Xdg"><em>Web Scraping with Python</em></a> by Ryan Mitchell, also from O’Reilly.</p></div></div></section></div></body></html>