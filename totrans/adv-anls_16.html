<html><head></head><body><section data-pdf-bookmark="Chapter 13. Capstone: Python for Data Analytics" data-type="chapter" epub:type="chapter"><div class="chapter" id="python-for-data-analysis-capstone">&#13;
<h1><span class="label">Chapter 13. </span>Capstone: Python for Data Analytics</h1>&#13;
&#13;
&#13;
<p>At the end of <a data-type="xref" href="ch08.html#r-data-manipulation-visualization">Chapter 8</a> you extended what you learned about R to explore and test <a data-primary="mpg dataset example" data-type="indexterm" id="idm46274529594552"/><a data-primary="datasets" data-secondary="mpg example" data-type="indexterm" id="idm46274529593880"/><a data-primary="vehicle mileage (mpg) dataset example" data-type="indexterm" id="idm46274529592936"/>relationships in the <em>mpg</em> dataset. We’ll do the same in this chapter, using Python. We’ve conducted the same work in Excel and R, so I’ll focus less on the whys of our analysis in favor of the hows of doing it in Python.</p>&#13;
&#13;
<p>To get started, let’s call in all the necessary <a data-primary="modules, Python" data-secondary="importing and installing" data-type="indexterm" id="idm46274529591064"/><a data-primary="scipy.stats submodule, Python" data-type="indexterm" id="idm46274529589736"/>modules. Some of these are new: from <code>scipy</code>, we’ll import the <code>stats</code> submodule. To do this, we’ll use the <code>from</code> keyword to tell Python what module to look for, then the usual <code>import</code> keyword to choose a sub-module. As the name suggests, we’ll use the <code>stats</code> submodule of <code>scipy</code> to conduct our statistical analysis. We’ll also be using a <a data-primary="sklearn package, Python" data-type="indexterm" id="idm46274529586328"/><a data-primary="sickit-learn package, Python" data-type="indexterm" id="idm46274529585544"/><a data-primary="packages" data-secondary="Python" data-type="indexterm" id="idm46274529584808"/><a data-primary="Python programming language" data-secondary="packages" data-type="indexterm" id="idm46274529583864"/><a data-primary="Anaconda, Python" data-secondary="packages with" data-type="indexterm" id="idm46274529582904"/><a data-primary="machine learning" data-type="indexterm" id="idm46274529581960"/>new package called <code>sklearn</code>, or <em>scikit-learn</em>, to validate our model on a train/test split. This package has become a dominant resource for machine learning and also comes installed with Anaconda.</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>&#13;
        <code class="kn">import</code> <code class="nn">seaborn</code> <code class="k">as</code> <code class="nn">sns</code>&#13;
        <code class="kn">import</code> <code class="nn">matplotlib.pyplot</code> <code class="k">as</code> <code class="nn">plt</code>&#13;
        <code class="kn">from</code> <code class="nn">scipy</code> <code class="k">import</code> <code class="n">stats</code>&#13;
        <code class="kn">from</code> <code class="nn">sklearn</code> <code class="k">import</code> <code class="n">linear_model</code>&#13;
        <code class="kn">from</code> <code class="nn">sklearn</code> <code class="k">import</code> <code class="n">model_selection</code>&#13;
        <code class="kn">from</code> <code class="nn">sklearn</code> <code class="k">import</code> <code class="n">metrics</code></pre>&#13;
&#13;
<p>With the <code>usecols</code> argument of <code>read_csv()</code> we can <a data-primary="read_csv() function, R and Python" data-type="indexterm" id="idm46274529359816"/><a data-primary="usecols argument, Python" data-type="indexterm" id="idm46274529359144"/>specify which columns to read into the DataFrame:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">mpg</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="s">'datasets/mpg/mpg.csv'</code><code class="p">,</code><code class="n">usecols</code><code class="o">=</code>&#13;
           <code class="p">[</code><code class="s">'mpg'</code><code class="p">,</code><code class="s">'weight'</code><code class="p">,</code><code class="s">'horsepower'</code><code class="p">,</code><code class="s">'origin'</code><code class="p">,</code><code class="s">'cylinders'</code><code class="p">])</code>&#13;
        <code class="n">mpg</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]:</code>&#13;
     <code class="n">mpg</code>  <code class="n">cylinders</code>  <code class="n">horsepower</code>  <code class="n">weight</code> <code class="n">origin</code>&#13;
 <code class="mi">0</code>  <code class="mf">18.0</code>          <code class="mi">8</code>         <code class="mi">130</code>    <code class="mi">3504</code>    <code class="n">USA</code>&#13;
 <code class="mi">1</code>  <code class="mf">15.0</code>          <code class="mi">8</code>         <code class="mi">165</code>    <code class="mi">3693</code>    <code class="n">USA</code>&#13;
 <code class="mi">2</code>  <code class="mf">18.0</code>          <code class="mi">8</code>         <code class="mi">150</code>    <code class="mi">3436</code>    <code class="n">USA</code>&#13;
 <code class="mi">3</code>  <code class="mf">16.0</code>          <code class="mi">8</code>         <code class="mi">150</code>    <code class="mi">3433</code>    <code class="n">USA</code>&#13;
 <code class="mi">4</code>  <code class="mf">17.0</code>          <code class="mi">8</code>         <code class="mi">140</code>    <code class="mi">3449</code>    <code class="n">USA</code></pre>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Exploratory Data Analysis" data-type="sect1"><div class="sect1" id="idm46274531767080">&#13;
<h1>Exploratory Data Analysis</h1>&#13;
&#13;
<p>Let’s start with the <a data-primary="DataFrames, Python" data-secondary="descriptive statistics with" data-type="indexterm" id="idm46274528454232"/><a data-primary="descriptive statistics" data-secondary="with Python DataFrames" data-secondary-sortas="Python DataFrames" data-type="indexterm" id="idm46274528453400"/><a data-primary="exploratory data analysis (EDA)" data-secondary="with Python capstone" data-secondary-sortas="Python capstone" data-type="indexterm" id="ch13_term1"/><a data-primary="Python programming language" data-secondary="exploratory data analysis with" data-type="indexterm" id="ch13_term2"/>descriptive statistics:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">mpg</code><code class="o">.</code><code class="n">describe</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code>&#13;
              <code class="n">mpg</code>   <code class="n">cylinders</code>  <code class="n">horsepower</code>       <code class="n">weight</code>&#13;
<code class="n">count</code>  <code class="mf">392.000000</code>  <code class="mf">392.000000</code>  <code class="mf">392.000000</code>   <code class="mf">392.000000</code>&#13;
<code class="n">mean</code>    <code class="mf">23.445918</code>    <code class="mf">5.471939</code>  <code class="mf">104.469388</code>  <code class="mf">2977.584184</code>&#13;
<code class="n">std</code>      <code class="mf">7.805007</code>    <code class="mf">1.705783</code>   <code class="mf">38.491160</code>   <code class="mf">849.402560</code>&#13;
<code class="nb">min</code>      <code class="mf">9.000000</code>    <code class="mf">3.000000</code>   <code class="mf">46.000000</code>  <code class="mf">1613.000000</code>&#13;
<code class="mi">25</code><code class="o">%</code>     <code class="mf">17.000000</code>    <code class="mf">4.000000</code>   <code class="mf">75.000000</code>  <code class="mf">2225.250000</code>&#13;
<code class="mi">50</code><code class="o">%</code>     <code class="mf">22.750000</code>    <code class="mf">4.000000</code>   <code class="mf">93.500000</code>  <code class="mf">2803.500000</code>&#13;
<code class="mi">75</code><code class="o">%</code>     <code class="mf">29.000000</code>    <code class="mf">8.000000</code>  <code class="mf">126.000000</code>  <code class="mf">3614.750000</code>&#13;
<code class="nb">max</code>     <code class="mf">46.600000</code>    <code class="mf">8.000000</code>  <code class="mf">230.000000</code>  <code class="mf">5140.000000</code></pre>&#13;
&#13;
<p>Because <em>origin</em> is a <a data-primary="categorical variables" data-secondary="in Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274528446552"/>categorical variable, by default it doesn’t show up as part of <code>describe()</code>. Let’s explore this variable instead <a data-primary="frequency tables" data-type="indexterm" id="idm46274528337672"/><a data-primary="pandas, Python" data-secondary="frequency tables with" data-type="indexterm" id="idm46274528336968"/><a data-primary="columns argument, Python" data-type="indexterm" id="idm46274528336024"/><a data-primary="crosstab() function, Python" data-type="indexterm" id="idm46274528335384"/>with a frequency table. This can be done in <code>pandas</code> with the <code>crosstab()</code> function. First, we’ll specify what data to place on the index: <em>origin</em>. We’ll get a count for each level by setting the <code>columns</code> argument to <code>count</code>:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">pd</code><code class="o">.</code><code class="n">crosstab</code><code class="p">(</code><code class="n">index</code><code class="o">=</code><code class="n">mpg</code><code class="p">[</code><code class="s">'origin'</code><code class="p">],</code> <code class="n">columns</code><code class="o">=</code><code class="s">'count'</code><code class="p">)</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]:</code>&#13;
<code class="n">col_0</code>   <code class="n">count</code>&#13;
<code class="n">origin</code>&#13;
<code class="n">Asia</code>       <code class="mi">79</code>&#13;
<code class="n">Europe</code>     <code class="mi">68</code>&#13;
<code class="n">USA</code>       <code class="mi">245</code></pre>&#13;
&#13;
<p>To make a <a data-primary="two-way frequency tables" data-type="indexterm" id="idm46274528248904"/>two-way frequency table, we can instead set <code>columns</code> to another categorical variable, such as <code>cylinders</code>:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">pd</code><code class="o">.</code><code class="n">crosstab</code><code class="p">(</code><code class="n">index</code><code class="o">=</code><code class="n">mpg</code><code class="p">[</code><code class="s">'origin'</code><code class="p">],</code> <code class="n">columns</code><code class="o">=</code><code class="n">mpg</code><code class="p">[</code><code class="s">'cylinders'</code><code class="p">])</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]:</code>&#13;
<code class="n">cylinders</code>  <code class="mi">3</code>   <code class="mi">4</code>  <code class="mi">5</code>   <code class="mi">6</code>    <code class="mi">8</code>&#13;
<code class="n">origin</code>&#13;
<code class="n">Asia</code>       <code class="mi">4</code>  <code class="mi">69</code>  <code class="mi">0</code>   <code class="mi">6</code>    <code class="mi">0</code>&#13;
<code class="n">Europe</code>     <code class="mi">0</code>  <code class="mi">61</code>  <code class="mi">3</code>   <code class="mi">4</code>    <code class="mi">0</code>&#13;
<code class="n">USA</code>        <code class="mi">0</code>  <code class="mi">69</code>  <code class="mi">0</code>  <code class="mi">73</code>  <code class="mi">103</code></pre>&#13;
&#13;
<p>Next, let’s retrieve descriptive statistics for <em>mpg</em> by each level of <em>origin</em>. I’ll do this by <a data-primary="chaining, method, Python" data-type="indexterm" id="idm46274528205240"/><a data-primary="subsetting" data-secondary="DataFrames, Python" data-type="indexterm" id="idm46274528204600"/>chaining together two methods, then subsetting the results:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">mpg</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s">'origin'</code><code class="p">)</code><code class="o">.</code><code class="n">describe</code><code class="p">()[</code><code class="s">'mpg'</code><code class="p">]</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">6</code><code class="p">]:</code>&#13;
        <code class="n">count</code>       <code class="n">mean</code>       <code class="n">std</code>   <code class="nb">min</code>    <code class="mi">25</code><code class="o">%</code>   <code class="mi">50</code><code class="o">%</code>     <code class="mi">75</code><code class="o">%</code>   <code class="nb">max</code>&#13;
<code class="n">origin</code>&#13;
<code class="n">Asia</code>     <code class="mf">79.0</code>  <code class="mf">30.450633</code>  <code class="mf">6.090048</code>  <code class="mf">18.0</code>  <code class="mf">25.70</code>  <code class="mf">31.6</code>  <code class="mf">34.050</code>  <code class="mf">46.6</code>&#13;
<code class="n">Europe</code>   <code class="mf">68.0</code>  <code class="mf">27.602941</code>  <code class="mf">6.580182</code>  <code class="mf">16.2</code>  <code class="mf">23.75</code>  <code class="mf">26.0</code>  <code class="mf">30.125</code>  <code class="mf">44.3</code>&#13;
<code class="n">USA</code>     <code class="mf">245.0</code>  <code class="mf">20.033469</code>  <code class="mf">6.440384</code>   <code class="mf">9.0</code>  <code class="mf">15.00</code>  <code class="mf">18.5</code>  <code class="mf">24.000</code>  <code class="mf">39.0</code></pre>&#13;
&#13;
<p>We can also visualize the overall <a data-primary="visualization of data" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="ch13_term3"/><a data-primary="Python programming language" data-secondary="visualization of data in" data-type="indexterm" id="ch13_term4"/><a data-primary="histograms" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527815176"/><a data-primary="distributions" data-secondary="visualizations of" data-type="indexterm" id="idm46274527813960"/><a data-primary="visualization of data" data-secondary="distributions with" data-type="indexterm" id="idm46274527813016"/>distribution of <em>mpg</em>, as in <a data-type="xref" href="#mpg-hist-seaborn">Figure 13-1</a>:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">displot</code><code class="p">(</code><code class="n">data</code><code class="o">=</code><code class="n">mpg</code><code class="p">,</code> <code class="n">x</code><code class="o">=</code><code class="s">'mpg'</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="mpg-hist-seaborn">&#13;
<img alt="Histogram of MPG" src="assets/aina_1301.png"/>&#13;
<h6><span class="label">Figure 13-1. </span>Histogram of <em>mpg</em></h6>&#13;
</div></figure>&#13;
&#13;
<p>Now let’s make a <a data-primary="boxplots" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527726584"/>boxplot as in <a data-type="xref" href="#mpg-box-seaborn">Figure 13-2</a> comparing the distribution of <em>mpg</em> across each level of <em>origin</em>:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">boxplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s">'origin'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s">'mpg'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">mpg</code><code class="p">,</code> <code class="n">color</code><code class="o">=</code><code class="s">'pink'</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="mpg-box-seaborn">&#13;
<img alt="Box plot" src="assets/aina_1302.png"/>&#13;
<h6><span class="label">Figure 13-2. </span>Boxplot of <em>mpg</em> by <em>origin</em></h6>&#13;
</div></figure>&#13;
&#13;
<p>Alternatively, we can <a data-primary="col argument, Python" data-type="indexterm" id="idm46274527698200"/><a data-primary="displot() function, Python" data-type="indexterm" id="idm46274527697464"/><a data-primary="facet plots" data-type="indexterm" id="idm46274527696824"/><a data-primary="histograms" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527696152"/><a data-primary="visualization of data" data-secondary="facet plots" data-type="indexterm" id="idm46274527694936"/>set the <code>col</code> argument of <code>displot()</code> to <code>origin</code> to create faceted histograms, such as in <a data-type="xref" href="#mpg-facet-seaborn">Figure 13-3</a>:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">displot</code><code class="p">(</code><code class="n">data</code><code class="o">=</code><code class="n">mpg</code><code class="p">,</code> <code class="n">x</code><code class="o">=</code><code class="s">"mpg"</code><code class="p">,</code> <code class="n">col</code><code class="o">=</code><code class="s">"origin"</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="mpg-facet-seaborn">&#13;
<img alt="Faceted histogram" src="assets/aina_1303.png"/>&#13;
<h6><span class="label">Figure 13-3. </span>Faceted histogram of <em>mpg</em> by <em>origin</em></h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Hypothesis Testing" data-type="sect1"><div class="sect1" id="idm46274531766488">&#13;
<h1>Hypothesis Testing</h1>&#13;
&#13;
<p>Let’s <a data-startref="ch13_term1" data-type="indexterm" id="idm46274527675320"/><a data-startref="ch13_term2" data-type="indexterm" id="idm46274527642072"/><a data-startref="ch13_term3" data-type="indexterm" id="idm46274527641400"/><a data-startref="ch13_term4" data-type="indexterm" id="idm46274527640728"/>again test for a difference in mileage between American and European cars. For ease of analysis, we’ll split the observations in each group into their <a data-primary="DataFrames, Python" data-secondary="in hypothesis testing" data-secondary-sortas="hypothesis testing" data-type="indexterm" id="idm46274527639752"/><a data-primary="hypothesis testing" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="ch13_term6"/><a data-primary="Python programming language" data-secondary="hypothesis testing with" data-type="indexterm" id="ch13_term7"/>own DataFrames.</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">10</code><code class="p">]:</code> <code class="n">usa_cars</code> <code class="o">=</code> <code class="n">mpg</code><code class="p">[</code><code class="n">mpg</code><code class="p">[</code><code class="s">'origin'</code><code class="p">]</code><code class="o">==</code><code class="s">'USA'</code><code class="p">]</code>&#13;
        <code class="n">europe_cars</code> <code class="o">=</code> <code class="n">mpg</code><code class="p">[</code><code class="n">mpg</code><code class="p">[</code><code class="s">'origin'</code><code class="p">]</code><code class="o">==</code><code class="s">'Europe'</code><code class="p">]</code></pre>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Independent Samples T-test" data-type="sect2"><div class="sect2" id="idm46274527620680">&#13;
<h2>Independent Samples T-test</h2>&#13;
&#13;
<p>We can now <a data-primary="independent samples t-tests" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="ch13_term5"/><a data-primary="ttest_ind() function, Python" data-type="indexterm" id="idm46274527586024"/><a data-primary="scipy.stats submodule, Python" data-type="indexterm" id="idm46274527585384"/>use the <code>ttest_ind()</code> function from <code>scipy.stats</code> to conduct the t-test. This <a data-primary="Series data structure, Python" data-type="indexterm" id="idm46274527583752"/><a data-primary="arrays, Python NumPy" data-secondary="in hypothesis testing" data-secondary-sortas="hypothesis testing" data-type="indexterm" id="idm46274527583032"/>function expects two <code>numpy</code> arrays as arguments; <code>pandas</code> Series also work:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="n">stats</code><code class="o">.</code><code class="n">ttest_ind</code><code class="p">(</code><code class="n">usa_cars</code><code class="p">[</code><code class="s">'mpg'</code><code class="p">],</code> <code class="n">europe_cars</code><code class="p">[</code><code class="s">'mpg'</code><code class="p">])</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="n">Ttest_indResult</code><code class="p">(</code><code class="n">statistic</code><code class="o">=-</code><code class="mf">8.534455914399228</code><code class="p">,</code>&#13;
            <code class="n">pvalue</code><code class="o">=</code><code class="mf">6.306531719750568e-16</code><code class="p">)</code></pre>&#13;
&#13;
<p>Unfortunately, the <a data-primary="p-values" data-secondary="in Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527531080"/><a data-primary="confidence intervals" data-secondary="in Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527529960"/><a data-primary="researchpy module, Python" data-type="indexterm" id="idm46274527528744"/>output here is rather scarce: while it does include the p-value, it doesn’t include the confidence interval. To run a t-test with more output, check out the <code>researchpy</code> module.</p>&#13;
&#13;
<p>Let’s move on to analyzing our <a data-primary="continuous variables" data-secondary="relationships between" data-type="indexterm" id="idm46274527526744"/><a data-primary="corr() method, Python" data-type="indexterm" id="idm46274527525768"/><a data-primary="correlation matrices" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527525096"/>continuous variables. We’ll start with a correlation matrix. We can use the <code>corr()</code> method from <code>pandas</code>, including only the relevant &#13;
<span class="keep-together">variables</span>:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="n">mpg</code><code class="p">[[</code><code class="s">'mpg'</code><code class="p">,</code><code class="s">'horsepower'</code><code class="p">,</code><code class="s">'weight'</code><code class="p">]]</code><code class="o">.</code><code class="n">corr</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">12</code><code class="p">]:</code>&#13;
                 <code class="n">mpg</code>  <code class="n">horsepower</code>    <code class="n">weight</code>&#13;
<code class="n">mpg</code>         <code class="mf">1.000000</code>   <code class="o">-</code><code class="mf">0.778427</code> <code class="o">-</code><code class="mf">0.832244</code>&#13;
<code class="n">horsepower</code> <code class="o">-</code><code class="mf">0.778427</code>    <code class="mf">1.000000</code>  <code class="mf">0.864538</code>&#13;
<code class="n">weight</code>     <code class="o">-</code><code class="mf">0.832244</code>    <code class="mf">0.864538</code>  <code class="mf">1.000000</code></pre>&#13;
&#13;
<p>Next, let’s <a data-primary="Python programming language" data-secondary="visualization of data in" data-type="indexterm" id="ch13_term8"/><a data-primary="visualization of data" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="ch13_term9"/><a data-primary="visualization of data" data-secondary="relationships with" data-type="indexterm" id="ch13_term10"/><a data-primary="scatterplots" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527449560"/>visualize the relationship between <em>weight</em> and <em>mpg</em> with a scatterplot as shown in <a data-type="xref" href="#mpg-weight-scatter-seaborn">Figure 13-4</a>:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">scatterplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s">'weight'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s">'mpg'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">mpg</code><code class="p">)</code>&#13;
        <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s">'Relationship between weight and mileage'</code><code class="p">)</code></pre>&#13;
&#13;
<figure class="width-70"><div class="figure" id="mpg-weight-scatter-seaborn">&#13;
<img alt="Scatter plot" src="assets/aina_1304.png"/>&#13;
<h6><span class="label">Figure 13-4. </span>Scatterplot of <em>mpg</em> by <em>weight</em></h6>&#13;
</div></figure>&#13;
&#13;
<p>Alternatively, we could produce scatterplots <a data-primary="pairplot() function, Python" data-type="indexterm" id="idm46274527419560"/><a data-primary="seaborn package, Python" data-secondary="data visualization with" data-type="indexterm" id="idm46274527418888"/><a data-primary="pairplots" data-type="indexterm" id="idm46274527417944"/><a data-primary="visualization of data" data-secondary="pairplots" data-type="indexterm" id="idm46274527417272"/>across all pairs of our dataset with the <code>pairplot()</code> function from <code>seaborn</code>. Histograms of each variable are included along the diagonal, as seen in <a data-type="xref" href="#seaborn-pairplot">Figure 13-5</a>:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">pairplot</code><code class="p">(</code><code class="n">mpg</code><code class="p">[[</code><code class="s">'mpg'</code><code class="p">,</code><code class="s">'horsepower'</code><code class="p">,</code><code class="s">'weight'</code><code class="p">]])</code></pre>&#13;
&#13;
<figure><div class="figure" id="seaborn-pairplot">&#13;
<img alt="Pairplot" src="assets/aina_1305.png"/>&#13;
<h6><span class="label">Figure 13-5. </span>Pairplot of <em>mpg</em>, <em>horsepower</em>, and <em>weight</em></h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Linear Regression" data-type="sect2"><div class="sect2" id="idm46274527592392">&#13;
<h2>Linear Regression</h2>&#13;
&#13;
<p>Now it’s <a data-startref="ch13_term5" data-type="indexterm" id="idm46274527372280"/><a data-startref="ch13_term8" data-type="indexterm" id="idm46274527371160"/><a data-startref="ch13_term9" data-type="indexterm" id="idm46274527370488"/><a data-startref="ch13_term10" data-type="indexterm" id="idm46274527369816"/>time for a linear regression. To do this, we’ll <a data-primary="linear regression" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="ch13_term11"/><a data-primary="linregress() function, Python" data-type="indexterm" id="idm46274527334984"/><a data-primary="scipy.stats submodule, Python" data-type="indexterm" id="idm46274527334344"/><a data-primary="arrays, Python NumPy" data-secondary="in hypothesis testing" data-secondary-sortas="hypothesis testing" data-type="indexterm" id="idm46274527333704"/><a data-primary="Series data structure, Python" data-type="indexterm" id="idm46274527332488"/><a data-primary="linear regression" data-secondary="mpg dataset example for" data-type="indexterm" id="idm46274527331848"/><a data-primary="regression model" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527330904"/>use <code>linregress()</code> from <code>scipy</code>, which also looks for two <code>numpy</code> arrays or <code>pandas</code> Series. We’ll specify which <a data-primary="dependent variables" data-secondary="in linear regression" data-secondary-sortas="linear regression" data-type="indexterm" id="idm46274527327832"/><a data-primary="independent variables" data-secondary="in linear regression" data-secondary-sortas="linear regression" data-type="indexterm" id="idm46274527326584"/><a data-primary="variables" data-secondary="linear relationships of" data-type="indexterm" id="idm46274527325368"/><a data-primary="x argument, Python" data-type="indexterm" id="idm46274527324424"/><a data-primary="y argument, Python" data-type="indexterm" id="idm46274527323752"/><a data-primary="linear regression" data-secondary="independent/dependent variables in" data-type="indexterm" id="idm46274527323080"/><a data-primary="linear relationships of variables" data-type="indexterm" id="idm46274527322168"/>variable is our independent and dependent variable with the <code>x</code> and <code>y</code> arguments, respectively:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="c"># Linear regression of weight on mpg</code>&#13;
        <code class="n">stats</code><code class="o">.</code><code class="n">linregress</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="n">mpg</code><code class="p">[</code><code class="s">'weight'</code><code class="p">],</code> <code class="n">y</code><code class="o">=</code><code class="n">mpg</code><code class="p">[</code><code class="s">'mpg'</code><code class="p">])</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="n">LinregressResult</code><code class="p">(</code><code class="n">slope</code><code class="o">=-</code><code class="mf">0.007647342535779578</code><code class="p">,</code>&#13;
   <code class="n">intercept</code><code class="o">=</code><code class="mf">46.21652454901758</code><code class="p">,</code> <code class="n">rvalue</code><code class="o">=-</code><code class="mf">0.8322442148315754</code><code class="p">,</code>&#13;
   <code class="n">pvalue</code><code class="o">=</code><code class="mf">6.015296051435726e-102</code><code class="p">,</code> <code class="n">stderr</code><code class="o">=</code><code class="mf">0.0002579632782734318</code><code class="p">)</code></pre>&#13;
&#13;
<p>Again, you’ll see that some of the <a data-primary="r-value, Python" data-type="indexterm" id="idm46274527266568"/><a data-primary="correlation coefficient" data-secondary="with regression" data-secondary-sortas="regression" data-type="indexterm" id="idm46274527247784"/>output you may be used to is missing here. <em>Be careful:</em> the <code>rvalue</code> included is the <em>correlation coefficient</em>, not R-square. For a richer linear regression output, check <a data-primary="statsmodels module, Python" data-type="indexterm" id="idm46274527245224"/>out the <code>statsmodels</code> module.</p>&#13;
&#13;
<p>Last but not least, let’s overlay our <a data-primary="regression line, fitting" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527243464"/><a data-primary="seaborn package, Python" data-secondary="data visualization with" data-type="indexterm" id="idm46274527242248"/><a data-primary="regplot() function, Python" data-type="indexterm" id="idm46274527241304"/>regression line to a scatterplot. <code>seaborn</code> has a separate function to do just that: <code>regplot()</code>. As usual, we’ll specify our independent and dependent variables, and where to get the data. This <a data-primary="scatterplots" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527239560"/><a data-primary="Python programming language" data-secondary="visualization of data in" data-type="indexterm" id="idm46274527238312"/><a data-primary="visualization of data" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527237288"/>results in <a data-type="xref" href="#mpg-scatter-reg-seaborn">Figure 13-6</a>:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">16</code><code class="p">]:</code> <code class="c"># Fit regression line to scatterplot</code>&#13;
        <code class="n">sns</code><code class="o">.</code><code class="n">regplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s">"weight"</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s">"mpg"</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">mpg</code><code class="p">)</code>&#13;
        <code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s">'Weight (lbs)'</code><code class="p">)</code>&#13;
        <code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s">'Mileage (mpg)'</code><code class="p">)</code>&#13;
        <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s">'Relationship between weight and mileage'</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="mpg-scatter-reg-seaborn">&#13;
<img alt="Fit scatter plot" src="assets/aina_1306.png"/>&#13;
<h6><span class="label">Figure 13-6. </span>Scatterplot with fit regression line of <em>mpg</em> by <em>weight</em></h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Train/Test Split and Validation" data-type="sect2"><div class="sect2" id="idm46274527208200">&#13;
<h2>Train/Test Split and Validation</h2>&#13;
&#13;
<p>At the end of <a data-type="xref" href="ch09.html#r-capstone">Chapter 9</a> you learned how to <a data-primary="splitting data" data-type="indexterm" id="ch13_term12"/><a data-primary="training and testing datasets" data-type="indexterm" id="ch13_term13"/><a data-primary="testing and training datasets" data-type="indexterm" id="ch13_term14"/><a data-primary="train/test split and validation" data-type="indexterm" id="ch13_term15"/>apply a train/test split when building a linear regression model in R.</p>&#13;
&#13;
<p>We will <a data-primary="train_test_split() function, Python" data-type="indexterm" id="idm46274527169128"/><a data-primary="DataFrames, Python" data-secondary="in hypothesis testing" data-secondary-sortas="hypothesis testing" data-type="indexterm" id="idm46274527168424"/>use the <code>train_test_split()</code> function to split our dataset into <em>four</em> DataFrames: not just by training and testing but also <a data-primary="independent variables" data-secondary="in train/test splits" data-secondary-sortas="train/test splits" data-type="indexterm" id="idm46274527166248"/><a data-primary="dependent variables" data-secondary="in train/test splits" data-secondary-sortas="train/test splits" data-type="indexterm" id="idm46274527165000"/>independent and dependent variables. We’ll pass in a DataFrame containing our independent variable first, then one containing the dependent variable. <a data-primary="random_state argument, Python" data-type="indexterm" id="idm46274527163480"/>Using the <code>random_state</code> argument, we’ll seed the random number generator so the results remain consistent for this example:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">17</code><code class="p">]:</code> <code class="n">X_train</code><code class="p">,</code> <code class="n">X_test</code><code class="p">,</code> <code class="n">y_train</code><code class="p">,</code> <code class="n">y_test</code> <code class="o">=</code>&#13;
        <code class="n">model_selection</code><code class="o">.</code><code class="n">train_test_split</code><code class="p">(</code><code class="n">mpg</code><code class="p">[[</code><code class="s">'weight'</code><code class="p">]],</code> <code class="n">mpg</code><code class="p">[[</code><code class="s">'mpg'</code><code class="p">]],</code>&#13;
        <code class="n">random_state</code><code class="o">=</code><code class="mi">1234</code><code class="p">)</code></pre>&#13;
&#13;
<p>By default, the data is split 75/25 between <a data-primary="subsetting" data-secondary="with train/test splits" data-secondary-sortas="train/test splits" data-type="indexterm" id="idm46274527160824"/>training and testing subsets:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">18</code><code class="p">]:</code>  <code class="n">y_train</code><code class="o">.</code><code class="n">shape</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">18</code><code class="p">]:</code> <code class="p">(</code><code class="mi">294</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>&#13;
&#13;
&#13;
<code class="n">In</code><code class="p">[</code><code class="mi">19</code><code class="p">]:</code>  <code class="n">y_test</code><code class="o">.</code><code class="n">shape</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">19</code><code class="p">]:</code> <code class="p">(</code><code class="mi">98</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code></pre>&#13;
&#13;
<p>Now, let’s <a data-primary="fitting regression line" data-type="indexterm" id="idm46274527091704"/><a data-primary="LinearRegression() function, Python" data-type="indexterm" id="idm46274527070616"/><a data-primary="regr.fit() function, Python" data-type="indexterm" id="idm46274527070008"/><a data-primary="predict() function, R and Python" data-type="indexterm" id="idm46274527069400"/><a data-primary="arrays, Python NumPy" data-secondary="slicing" data-type="indexterm" id="idm46274527068760"/><a data-primary="head() method" data-secondary="in Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274527067816"/><a data-primary="slicing in Python" data-type="indexterm" id="idm46274527066600"/>fit the model to the training data. First we’ll specify the linear model with <code>LinearRegression()</code>, then we’ll train the model with <code>regr.fit()</code>. To get the predicted values for the test dataset, we can use <code>predict()</code>. This results in a <code>numpy</code> array, not a <code>pandas</code> DataFrame, so the <code>head()</code> method won’t work to print the first few rows.  We can, however, slice it:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">20</code><code class="p">]:</code>  <code class="c"># Create linear regression object</code>&#13;
         <code class="n">regr</code> <code class="o">=</code> <code class="n">linear_model</code><code class="o">.</code><code class="n">LinearRegression</code><code class="p">()</code>&#13;
&#13;
         <code class="c"># Train the model using the training sets</code>&#13;
         <code class="n">regr</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">X_train</code><code class="p">,</code> <code class="n">y_train</code><code class="p">)</code>&#13;
&#13;
         <code class="c"># Make predictions using the testing set</code>&#13;
         <code class="n">y_pred</code> <code class="o">=</code> <code class="n">regr</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">X_test</code><code class="p">)</code>&#13;
&#13;
         <code class="c"># Print first five observations</code>&#13;
         <code class="n">y_pred</code><code class="p">[:</code><code class="mi">5</code><code class="p">]</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">20</code><code class="p">]:</code>  <code class="n">array</code><code class="p">([[</code><code class="mf">14.86634263</code><code class="p">],</code>&#13;
         <code class="p">[</code><code class="mf">23.48793632</code><code class="p">],</code>&#13;
         <code class="p">[</code><code class="mf">26.2781699</code> <code class="p">],</code>&#13;
         <code class="p">[</code><code class="mf">27.69989655</code><code class="p">],</code>&#13;
         <code class="p">[</code><code class="mf">29.05319785</code><code class="p">]])</code></pre>&#13;
&#13;
<p>The <code>coef_</code> attribute <a data-primary="coef_attribute, Python" data-type="indexterm" id="idm46274526944584"/>returns the coefficient of our test model:</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">21</code><code class="p">]:</code>  <code class="n">regr</code><code class="o">.</code><code class="n">coef_</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">21</code><code class="p">]:</code> <code class="n">array</code><code class="p">([[</code><code class="o">-</code><code class="mf">0.00760282</code><code class="p">]])</code></pre>&#13;
&#13;
<p>To get more information about the model, such as the coefficient p-values or R-squared, try <a data-primary="statsmodels module, Python" data-type="indexterm" id="idm46274526933544"/>fitting it with the <code>statsmodels</code> package.</p>&#13;
&#13;
<p>For now, we’ll <a data-primary="evaluation metrics" data-type="indexterm" id="idm46274526931816"/><a data-primary="metrics sklearn submodule, Python" data-type="indexterm" id="idm46274526931080"/><a data-primary="sklearn package, Python" data-type="indexterm" id="idm46274526930440"/>evaluate the performance of the model on our test data, this time using the <code>metrics</code> submodule of <code>sklearn</code>. We’ll pass in our actual and predicted <a data-primary="r2_score() function, Python" data-type="indexterm" id="idm46274526928808"/><a data-primary="mean_squared_error() function, Python" data-type="indexterm" id="idm46274526928136"/><a data-primary="mean_squared_error() function, Python" data-type="indexterm" id="idm46274526927496"/><a data-primary="RMSE (root mean square error)" data-type="indexterm" id="idm46274526926856"/>values to the <code>r2_score()</code> and <code>mean_squared_error()</code> functions, which will return the R-squared and RMSE, respectively.</p>&#13;
&#13;
<pre data-code-language="ipython3" data-type="programlisting"><code class="n">In</code><code class="p">[</code><code class="mi">22</code><code class="p">]:</code>  <code class="n">metrics</code><code class="o">.</code><code class="n">r2_score</code><code class="p">(</code><code class="n">y_test</code><code class="p">,</code> <code class="n">y_pred</code><code class="p">)</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">22</code><code class="p">]:</code> <code class="mf">0.6811923996681357</code>&#13;
&#13;
&#13;
<code class="n">In</code><code class="p">[</code><code class="mi">23</code><code class="p">]:</code>  <code class="n">metrics</code><code class="o">.</code><code class="n">mean_squared_error</code><code class="p">(</code><code class="n">y_test</code><code class="p">,</code> <code class="n">y_pred</code><code class="p">)</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">23</code><code class="p">]:</code> <code class="mf">21.63348076436662</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conclusion" data-type="sect1"><div class="sect1" id="idm46274527207576">&#13;
<h1>Conclusion</h1>&#13;
&#13;
<p>The usual <a data-startref="ch13_term6" data-type="indexterm" id="idm46274526828376"/><a data-startref="ch13_term7" data-type="indexterm" id="idm46274526827672"/><a data-startref="ch13_term11" data-type="indexterm" id="idm46274526827000"/><a data-startref="ch13_term12" data-type="indexterm" id="idm46274526826328"/><a data-startref="ch13_term13" data-type="indexterm" id="idm46274526825656"/><a data-startref="ch13_term14" data-type="indexterm" id="idm46274526824984"/><a data-startref="ch13_term15" data-type="indexterm" id="idm46274526824312"/>caveat applies to this chapter: we’ve just scratched the surface of what analysis is possible on this or any other dataset. But I hope you feel you’ve hit your stride on working with data in Python.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Exercises" data-type="sect1"><div class="sect1" id="idm46274526823032">&#13;
<h1>Exercises</h1>&#13;
&#13;
<p>Take another <a data-primary="Python programming language" data-secondary="exercises" data-type="indexterm" id="idm46274526821736"/><a data-primary="ais dataset example" data-type="indexterm" id="idm46274526820760"/><a data-primary="datasets" data-secondary="ais example" data-type="indexterm" id="idm46274526820088"/>look at the <em>ais</em> dataset, this time using Python. Read the Excel workbook in from the <a href="https://oreil.ly/dsZDM">book repository</a> and complete the following. You should be pretty comfortable with this analysis by now.</p>&#13;
<ol>&#13;
<li>&#13;
<p>Visualize the distribution of red blood cell count (<em>rcc</em>) by sex (<em>sex</em>).</p>&#13;
</li>&#13;
<li>&#13;
<p>Is there a significant difference in red blood cell count between the two groups of sex?</p>&#13;
</li>&#13;
<li>&#13;
<p>Produce a correlation matrix of the relevant variables in this dataset.</p>&#13;
</li>&#13;
<li>&#13;
<p>Visualize the relationship of height (<em>ht</em>) and weight (<em>wt</em>).</p>&#13;
</li>&#13;
<li>&#13;
<p>Regress <em>ht</em> on <em>wt</em>. Find the equation of the fit regression line. Is there a significant relationship?</p>&#13;
</li>&#13;
<li>&#13;
<p>Split your regression model into training and testing subsets. What is the R-squared and RMSE on your test model?</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>