<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 2. Essential Facilities for Spatial Analysis" data-type="chapter" epub:type="chapter"><div class="chapter" id="essential_facilities_for_spatial_analys">
<h1><span class="label">Chapter 2. </span>Essential Facilities for Spatial Analysis</h1>
<p><a data-type="xref" href="ch01.xhtml#introduction_to_geospatial_analytics">Chapter 1</a> covered the complexity of mapping a three-dimensional (3D) globe to a two-dimensional (2D) coordinate system. <a contenteditable="false" data-primary="spatial analysis" data-secondary="essential facilities" data-type="indexterm" id="ix_spaanfac"/>This often requires an understanding of how to select an appropriate map projection depending on the area you are interested in viewing or analyzing. You learned how 3D coordinates on the surface of the Earth can be converted to 2D coordinates. For that, the concepts of <em>geoid</em> and <em>ellipsoid</em> were introduced. You also saw a variety of map projections in <a data-type="xref" href="ch01.xhtml#introduction_to_geospatial_analytics">Chapter 1</a>, and I discussed how to choose an appropriate one for a given area—for example, selecting a projection that minimizes distortion over the area you are viewing.</p>
<p>What happens to topographical features that are below or above the Earth’s surface? Geospatial tools are also able to analyze these features spatially as well as time-series data, which is often described as a <em>fourth dimension</em>. </p>
<p>You may have<a contenteditable="false" data-primary="GIS" data-type="indexterm" id="idm45433742573872"/> noticed the term <em>GIS</em> doing a lot of the heavy lifting when learning about spatial literacy, but in reality there are multiple integrated concepts contributing at the systems level. I have discussed the <em>spatial data framework,</em> where spatial locations are identified on the Earth’s surface. <a contenteditable="false" data-primary="spatial data framework" data-type="indexterm" id="idm45433742584112"/>This is fundamental for building a comprehensive (and reliable) reference system for geocoding and mapping data.</p>
<p>In this chapter, you will continue to build on your spatial literacy skills with three brief sample projects in QGIS. First, you will download and customize the QGIS dashboard. Then I’ll introduce simple Python scripting as you explore data from the NYC Open Data portal. The Mapping Inequality project will provide an opportunity to explore historical data and download the data for analysis in QGIS. This will help you familiarize yourself with QGIS and introduce you to important concepts, including uploading vector data layers, filtering datasets, and writing Python scripts in the console.</p>
<section data-pdf-bookmark="Exploring Spatial Data in QGIS" data-type="sect1"><div class="sect1" id="exploring_spatial_data_in_qgis">
<h1>Exploring Spatial Data in QGIS</h1>
<p>I mentioned QGIS in the previous chapter, and although you will work with it extensively in <a data-type="xref" href="ch03.xhtml#qgis_exploring_pyqgis_and_native_algori">Chapter 3</a>, you’ll get your feet wet in this chapter by using QGIS and Python to explore publicly available datasets and discuss some key concepts of spatial literacy.<a contenteditable="false" data-primary="spatial analysis" data-secondary="essential facilities" data-tertiary="exploring spatial data in QGIS" data-type="indexterm" id="ix_spaanfacQGIS"/><a contenteditable="false" data-primary="QGIS" data-type="indexterm" id="ix_QGIS"/></p>
<p>QGIS is a free and open source GIS. <a contenteditable="false" data-primary="GIS" data-secondary="QGIS" data-type="indexterm" id="idm45433742544368"/>A <em>GIS</em>, which you might recall stands for “geographic information system,” is a complete application or system of tools for working with geospatial data. <a contenteditable="false" data-primary="geographic information systems" data-see="GIS" data-type="indexterm" id="idm45433742542880"/>Once you download the software, you will have access to these tools. Python is available as a plug-in and is easily installed.</p>
<section data-pdf-bookmark="Installing QGIS" data-type="sect2"><div class="sect2" id="installing_qgis">
<h2>Installing QGIS</h2>
<p>To follow along, please install QGIS.<a contenteditable="false" data-primary="QGIS" data-secondary="installing" data-type="indexterm" id="ix_QGISinst"/> You can download and install the software at the <a href="https://qgis.org/en/site">QGIS Project’s website</a>. (Look for the long-term repositories for stability, identified as “LTR” on the site. Detailed installation instructions are in the <a href="https://oreil.ly/mgycA">User Guide</a>.) Your dashboard will resemble the one shown in <a data-type="xref" href="#qgis_dashboard_showing_the_browser_left">Figure 2-1</a> once you add a few panels to the view.</p>
<figure><div class="figure" id="qgis_dashboard_showing_the_browser_left"><img alt="QGIS dashboard showing the Browser (A), Layers (B), Processing Toolbox (C), and Layer Styling (D) panels" height="863" src="assets/pgda_0201.png" width="1441"/>
<h6><span class="label">Figure 2-1. </span>QGIS dashboard showing the (A) Browser, (B) Layers, (C) Processing Toolbox, and (D) Layer Styling panels</h6>
</div></figure>
<p><a data-type="xref" href="#qgis_dashboard_showing_the_browser_left">Figure 2-1</a> shows the (a) Browser, (b) Layers, (c) Processing Toolbox, and (d) Layer Styling panels (unselected in the lower right corner). The Browser allows you to view your computer file system and upload data into the QGIS Layers panel or drag files directly onto the canvas. The Processing Toolbox has several tools to explore; you will be using the Python scripting tool in a later exercise in the chapter. Last, the Layer Styling panel provides customization for points on a map, transparency of levels, and color schemes (among its many features). In the last exercise in the chapter, you will assign a color scheme to a map legend describing grades of perceived desirability of neighborhood communities.</p>
<p>Customizing your dashboard is relatively straightforward. Select View from the menu at the top of your screen and scroll down to Panels. <a data-type="xref" href="#customizing_your_dashboard_with_display">Figure 2-2</a> shows the checked options that have been added to the console. You can move them around according to your preference by selecting them individually and moving them to the desired location.</p>
<figure><div class="figure" id="customizing_your_dashboard_with_display"><img alt="Customizing your dashboard with display options, such as panels" height="781" src="assets/pgda_0202.png" width="1110"/>
<h6><span class="label">Figure 2-2. </span>Customizing your dashboard with display options, such as panels</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Adding Basemaps to QGIS" data-type="sect2"><div class="sect2" id="adding_basemaps_to_qgis">
<h2>Adding Basemaps to QGIS</h2>
<p>Adding <a contenteditable="false" data-primary="QGIS" data-secondary="installing" data-startref="ix_QGISinst" data-type="indexterm" id="idm45433742529936"/>additional basemaps is one last customization that will help enhance your work environment. <a contenteditable="false" data-primary="QGIS" data-secondary="adding basemaps to" data-type="indexterm" id="ix_QGISbmp"/><a contenteditable="false" data-primary="basemaps" data-secondary="adding to QGIS" data-type="indexterm" id="ix_bsemp"/>Basemaps are reference maps that add context to the data layers. Your XYZ Tiles folder (scroll down in your lefthand Browser panel) will currently appear empty. To add basemaps, navigate to the <a href="https://oreil.ly/SH2p6">GitHub page of Qiusheng Wu</a>, Assistant Professor of Geography at the University of Tennessee, Knoxville. Click on the raw file to download it directly to the Downloads folder.<a contenteditable="false" data-primary="Python Console in QGIS" data-type="indexterm" id="idm45433742869536"/> You can opt for a different location, but you will have to recall where it is located to upload it to the Python console. <a data-type="xref" href="#the_executable_file_for_downloading_bas">Figure 2-3</a> is a snippet of the screen you will see.</p>
<figure><div class="figure" id="the_executable_file_for_downloading_bas"><img alt="The executable file for downloading basemaps to QGIS" height="548" src="assets/pgda_0203.png" width="1270"/>
<h6><span class="label">Figure 2-3. </span>The executable file for downloading basemaps to QGIS</h6>
</div></figure>
<p>Right-click in the text and save the file to your Downloads folder as a <em>.py</em> script (<a data-type="xref" href="#saving_the_python_script_to_your_downlo">Figure 2-4</a>).</p>
<figure><div class="figure" id="saving_the_python_script_to_your_downlo"><img alt="Saving the Python script to your Downloads folder" height="850" src="assets/pgda_0204.png" width="986"/>
<h6><span class="label">Figure 2-4. </span>Saving the Python script to your Downloads folder</h6>
</div></figure>
<p>Your script is now saved to your local computer. <a contenteditable="false" data-primary="Python Console in QGIS" data-secondary="installing" data-type="indexterm" id="idm45433742509136"/>There are multiple locations to open the Python Console in QGIS, indicated by the Python icon. <a data-type="xref" href="#installing_the_python_plug_in_to_qgis">Figure 2-5</a> highlights the console icon in the Plugins menu at the top of the dashboard.</p>
<figure><div class="figure" id="installing_the_python_plug_in_to_qgis"><img alt="Installing the Python plug-in to QGIS" height="190" src="assets/pgda_0205.png" width="568"/>
<h6><span class="label">Figure 2-5. </span>Installing the Python plug-in to QGIS</h6>
</div></figure>
<p>The Python Console is where you can enter a few line-by-line commands or click the Show Editor button on the menu to enter Python scripts or snippets of code. The code snippets are run from the editor. The Python code editor has a save option if you are writing longer scripts. This feature is a reason you may decide to run code in the editor as opposed to simply dragging layers onto canvas.</p>
<p>Click the icon of a pad of paper with a pencil to open the scripting window. When you select the green + symbol, you can navigate to the location of the downloaded script. Hit the run icon (a little green arrow symbol), and the code will run in the console (<a data-type="xref" href="#run_the_script_and_the_basemaps_will_po">Figure 2-6</a>). You will now see available basemaps populating the XYZ Tile folder. Drag them directly onto the canvas to view them. Be sure to reorder the basemap when adding layers to the canvas. You will want the data layers to be at the top of the Layers panel.</p>
<figure><div class="figure" id="run_the_script_and_the_basemaps_will_po"><img alt="Run the script and the basemaps will populate the XYZ Tiles folder" height="974" src="assets/pgda_0206.png" width="3174"/>
<h6><span class="label">Figure 2-6. </span>Run the script and the basemaps will populate the XYZ Tiles folder</h6>
</div></figure>
<p class="pagebreak-before less_space">QGIS has a powerful programming interface that allows you to extend its core functionality and write scripts to automate your tasks in Python scripting language. Even if you are new to programming, learning a little bit of Python and navigating this interface will enable you to be much more productive in your geospatial data work.<a contenteditable="false" data-primary="basemaps" data-secondary="adding to QGIS" data-startref="ix_bsemp" data-type="indexterm" id="idm45433742498560"/><a contenteditable="false" data-primary="QGIS" data-secondary="adding basemaps to" data-startref="ix_QGISbmp" data-type="indexterm" id="idm45433742826080"/></p>
</div></section>
<section data-pdf-bookmark="Exploring Data Resources" data-type="sect2"><div class="sect2" id="exploring_data_resources">
<h2>Exploring Data Resources</h2>
<p>This book mainly uses data resources that I first used in my training or in projects, updated with the latest reported data. <a contenteditable="false" data-primary="datasets" data-secondary="exploring data resources" data-type="indexterm" id="idm45433743017200"/><a contenteditable="false" data-primary="QGIS" data-secondary="exploring data resources" data-type="indexterm" id="idm45433742492160"/>You can access the resources directly from my <a href="https://oreil.ly/SbS0R">GitHub page</a>. I want to be certain you can access the datasets no matter what operating system you use. QGIS has a wide variety of tools that make this straightforward.</p>
<div data-type="tip"><h6>Tip</h6>
<p>If you are an advanced user and would like to replace the datasets in this book with local data or data that reflects your personal or professional interests, here are a few suggestions:</p>
<ul>
<li>
<p>You will want a healthy mix of urban and rural locations with different types of roads, boundaries, water features, and topographies.</p>
</li>
<li>
<p>When given a choice, I prefer recent data, but for instructional purposes, I defer to sources with the widest variety of attributes.</p>
</li>
<li>
<p>Don’t forget to save your data in the GeoPackage file format so you will be able to continue exploring.</p>
</li>
<li>
<p>If you are creating a raster file of your region, locate the extent coordinates of your largest layer.<a contenteditable="false" data-primary="QGIS" data-startref="ix_QGIS" data-type="indexterm" id="idm45433742483680"/></p>
</li>
</ul>
</div>
</div></section>
</div></section>
<section data-pdf-bookmark="Visualizing Environmental Complaints in New York City" data-type="sect1"><div class="sect1" id="visualizing_environmental_complaints_in">
<h1>Visualizing Environmental Complaints in New York City</h1>
<p>You can see an example of how geography is represented in QGIS in <a data-type="xref" href="#the_dohmh_indoor_environmental_complain">Figure 2-7</a>. <a contenteditable="false" data-primary="QGIS" data-secondary="visualizing environmental complaints in New York City" data-type="indexterm" id="ix_QGISvis"/>The points represent indoor environmental complaints received by the Department of Health and Mental Hygiene (DOHMH) in New York City.<a contenteditable="false" data-primary="NYC Open Data" data-type="indexterm" id="idm45433742477984"/> The data in this image is from <a href="https://oreil.ly/QGsn5">NYC Open Data</a>, a resource for free public data from city agencies and other partners.<a contenteditable="false" data-primary="GitHub repository for this book" data-type="indexterm" id="idm45433742474512"/> This particular dataset can be downloaded from the <a href="https://oreil.ly/9ADWy">GitHub repository accompanying this book</a>.</p>
<figure><div class="figure" id="the_dohmh_indoor_environmental_complain"><img alt="The DOHMH Indoor Environmental Complaint dataset shown in the QGIS interface; the left panel is the Browser, and the right panel is the canvas" height="1013" src="assets/pgda_0207.png" width="1451"/>
<h6><span class="label">Figure 2-7. </span>The DOHMH Indoor Environmental Complaint dataset shown in the QGIS interface; the left panel is the Browser, and the right panel is the canvas</h6>
</div></figure>
<section data-pdf-bookmark="Uploading Data to QGIS" data-type="sect2"><div class="sect2" id="uploading_data_to_qgis">
<h2>Uploading Data to QGIS</h2>
<p>You have a few options to upload the data into QGIS. <a contenteditable="false" data-primary="QGIS" data-secondary="visualizing environmental complaints in New York City" data-tertiary="uploading data to QGIS" data-type="indexterm" id="ix_QGISvisupl"/>Using the Browser panel, select the Home folder (circled in <a data-type="xref" href="#the_dohmh_indoor_environmental_complain">Figure 2-7</a>), navigate to your Downloads folder, and select the dataset file that you downloaded. You can drag shapefiles (<em>.shp</em>) into the view from the Browser directly onto the canvas (the right panel).</p>
<p>What you are observing in <a data-type="xref" href="#the_dohmh_indoor_environmental_complain">Figure 2-7</a> are the 311 information hotline calls made within New York City during a certain period of time. Initially, you don’t know much about the nature of the calls or how the data could be filtered for better insights.</p>
<section data-pdf-bookmark="Uploading files with the Data Source Manager" data-type="sect3"><div class="sect3" id="uploading_files_with_the_data_source_ma">
<h3>Uploading files with the Data Source Manager</h3>
<p>The Data Source Manager (circled in <a data-type="xref" href="#using_the_data_source_manager_to_upload">Figure 2-8</a>) is the first option, and my preferred one, for uploading data from <em>.csv</em> files. <a contenteditable="false" data-primary="Data Source Manager (QGIS)" data-secondary="uploading files with" data-type="indexterm" id="idm45433742601200"/>If your data has a geometry column, as this one does (see the Latitude and Longitude columns in the Sample Data window in <a data-type="xref" href="#using_the_data_source_manager_to_upload">Figure 2-8</a>), you can select them in the X field (longitude) and Y field (latitude) and add the data to the Layers panel in your console.</p>
<p class="pagebreak-before less_space">Until you confirm or edit the delimited file with geometric attributes, it will not be considered spatial. This option is preferred for <em>.csv</em> files because, although QGIS often recognizes geometric attributes instinctually, you may need to change data types manually in the column headings.</p>
<figure><div class="figure" id="using_the_data_source_manager_to_upload"><img alt="Using the Data Source Manager to upload delimited text files" height="1044" src="assets/pgda_0208.png" width="1448"/>
<h6><span class="label">Figure 2-8. </span>Using the Data Source Manager to upload delimited text files</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Adding data as a vector layer" data-type="sect3"><div class="sect3" id="adding_data_as_a_vector_layer-id00002">
<h3>Adding data as a vector layer</h3>
<p>You also have the option of adding the dataset as a vector layer, as shown in <a data-type="xref" href="#adding_data_as_a_vector_layer">Figure 2-9</a>. <a contenteditable="false" data-primary="vectors" data-secondary="adding dataset as vector layer in QGIS" data-type="indexterm" id="idm45433742456640"/>This works well for GeoJSON and a variety of other data formats.<a contenteditable="false" data-primary="GeoJSON" data-type="indexterm" id="idm45433742452896"/> QGIS can detect most types of geometries. I prefer this method when working with PostgreSQL databases, as it simplifies the process of updating files stored outside of QGIS.</p>
<figure><div class="figure" id="adding_data_as_a_vector_layer"><img alt="Adding data as a vector layer" height="1054" src="assets/pgda_0209.png" width="1166"/>
<h6><span class="label">Figure 2-9. </span>Adding data as a vector layer</h6>
</div></figure>
<p>Right-click on a data file in the Layers panel and you will see an option to view the Attribute Table (shown as a snapshot in <a data-type="xref" href="#examining_the_attribute_table_to_determ">Figure 2-10</a>). The <a contenteditable="false" data-primary="attribute tables" data-secondary="QGIS" data-type="indexterm" id="idm45433742477120"/>Attribute Table is useful for reviewing the columns available as well as the format of the geometry (Latitude and Longitude). A small but important detail is to match the case of column headers when writing code to avoid errors when running your scripts.</p>
<figure><div class="figure" id="examining_the_attribute_table_to_determ"><img alt="Examining the Attribute Table to determine geometry columns" height="522" src="assets/pgda_0210.png" width="1364"/>
<h6><span class="label">Figure 2-10. </span>Examining the Attribute Table to determine geometry columns</h6>
</div></figure>
<p>You can also<a contenteditable="false" data-primary="basemaps" data-secondary="customizing in QGIS" data-type="indexterm" id="idm45433742500064"/> customize your basemaps now that you have uploaded the additional basemaps to QGIS (as shown in <a data-type="xref" href="#adding_the_data_layer_and_the_openstree">Figure 2-11</a>).</p>
<figure><div class="figure" id="adding_the_data_layer_and_the_openstree"><img alt="Adding the data layer and the OpenStreetMap basemap from XYZ Tiles" height="1003" src="assets/pgda_0211.png" width="1603"/>
<h6><span class="label">Figure 2-11. </span>Adding the data layer and the OpenStreetMap basemap from XYZ Tiles</h6>
</div></figure>
</div></section>
</div></section>
<section class="pagebreak-before" data-pdf-bookmark="Setting the Project CRS" data-type="sect2"><div class="sect2" id="setting_the_project_crs">
<h2 class="less_space">Setting the Project CRS</h2>
<p>QGIS will attempt to assign<a contenteditable="false" data-primary="QGIS" data-secondary="visualizing environmental complaints in New York City" data-startref="ix_QGISvisupl" data-tertiary="uploading data to QGIS" data-type="indexterm" id="idm45433742437632"/> a project <a contenteditable="false" data-primary="CRS (coordinate reference system)" data-secondary="setting for QGIS project" data-type="indexterm" id="idm45433742435680"/>coordinate reference system (CRS), as seen in <a data-type="xref" href="#setting_the_crs_layer_epsgfourthreetwos">Figure 2-12</a>. You can  change it in the Layer CRS window, visible when clicking the data in the Layers panel.</p>
<figure><div class="figure" id="setting_the_crs_layer_epsgfourthreetwos"><img alt="Setting the CRS Layer EPSG:4326—WGS84" height="547" src="assets/pgda_0212.png" width="482"/>
<h6><span class="label">Figure 2-12. </span>Setting the CRS Layer EPSG:4326—WGS84</h6>
</div></figure>
<p>Now that the CRS layer is selected, you can hover over points in the map for additional information. Select the Identify Features icon (the small “i” inside a blue circle), then select a point on the map.<a contenteditable="false" data-primary="coordinate reference system" data-see="CRS" data-type="indexterm" id="idm45433742600720"/></p>
<p>You will explore many of these geospatial and nongeospatial features a little later on when we begin working in the Python Console.</p>
</div></section>
<section data-pdf-bookmark="Using the Query Editor to Filter Data" data-type="sect2"><div class="sect2" id="using_the_query_editor_to_filter_data">
<h2>Using the Query Editor to Filter Data</h2>
<p>Let’s say that our research question here is: w<em>here are Manhattan residents reporting issues concerning asbestos?</em> <a contenteditable="false" data-primary="QGIS" data-secondary="visualizing environmental complaints in New York City" data-tertiary="using Query Editor to filter data" data-type="indexterm" id="ix_QGISvisQEfil"/><a contenteditable="false" data-primary="filtering data" data-secondary="using Query Editor in QGIS" data-type="indexterm" id="ix_filtrQGIS"/>Asbestos levels are important to monitor because asbestos is a known carcinogen when released into the atmosphere. QGIS has a built-in query builder that can help familiarize you with datasets. Right-click on the dataset in the Layers panel and choose Filter.<a contenteditable="false" data-primary="Provider Specific Filter Expression console (QGIS)" data-type="indexterm" id="idm45433742425680"/></p>
<p>When you click on a field, it will populate in the Provider Specific Filter Expression console, shown in <a data-type="xref" href="#filtering_data_by_incident_type_and_loc">Figure 2-13</a>. Select the Sample option under Values to view the sample data. Add an Operator and click the Test button at the bottom of the console. You will see how many rows have been returned. You can add more filters to the data or click OK and load the updated dataset to your canvas. Scrolling through the Fields and selecting Sample will provide information for exploring in the console.</p>
<figure><div class="figure" id="filtering_data_by_incident_type_and_loc"><img alt="Filtering data by incident type and location" height="613" src="assets/pgda_0213.png" width="940"/>
<h6><span class="label">Figure 2-13. </span>Filtering data by incident type and location</h6>
</div></figure>
<p>The canvas in <a data-type="xref" href="#the_canvas_updated_with_a_new_query_to">Figure 2-14</a> has been filtered to show only asbestos complaints. There are additional options to filter based on Complaint_Status and Date, if you want to explore!</p>
<p>What follows is a brief introduction to the Python Console in QGIS. You will run some code and even generate a template script in the Processing Toolbox.<a contenteditable="false" data-primary="filtering data" data-secondary="using Query Editor in QGIS" data-startref="ix_filtrQGIS" data-type="indexterm" id="idm45433742470784"/><a contenteditable="false" data-primary="QGIS" data-secondary="visualizing environmental complaints in New York City" data-startref="ix_QGISvisQEfil" data-tertiary="using Query Editor to filter data" data-type="indexterm" id="idm45433742413520"/><a contenteditable="false" data-primary="QGIS" data-secondary="visualizing environmental complaints in New York City" data-startref="ix_QGISvis" data-type="indexterm" id="idm45433742411728"/><a contenteditable="false" data-primary="spatial analysis" data-secondary="essential facilities" data-startref="ix_spaanfacQGIS" data-tertiary="exploring spatial data in QGIS" data-type="indexterm" id="idm45433742410144"/></p>
<figure><div class="figure" id="the_canvas_updated_with_a_new_query_to"><img alt="The canvas updated with a new query to show asbestos complaints" height="1916" src="assets/pgda_0214.png" width="2470"/>
<h6><span class="label">Figure 2-14. </span>The canvas updated with a new query to show asbestos complaints</h6>
</div></figure>
</div></section>
</div></section>
<section data-pdf-bookmark="Visualizing Population Data" data-type="sect1"><div class="sect1" id="visualizing_population_data">
<h1>Visualizing Population Data</h1>
<p>Whether you are planning on making maps professionally or for personal use, finding great data resources can be a challenge. <a href="https://www.naturalearthdata.com">Natural Earth</a> is a public-domain dataset available through collaboration and support from volunteers and the North American Cartographic Information Society (NACIS).<a contenteditable="false" data-primary="NACIS (North American Cartographic Information Society)" data-type="indexterm" id="idm45433742459760"/><a contenteditable="false" data-primary="spatial analysis" data-secondary="essential facilities" data-tertiary="visualizing population data" data-type="indexterm" id="ix_spaanfacvispop"/><a contenteditable="false" data-primary="QGIS" data-secondary="visualizing population data" data-type="indexterm" id="ix_QGISvispop"/><a contenteditable="false" data-primary="Natural Earth dataset" data-type="indexterm" id="idm45433742398432"/><a contenteditable="false" data-primary="North American Cartographic Information Society (NACIS)" data-type="indexterm" id="idm45433742397328"/></p>
<p>Its freely available vector and raster data—in shapefile and TIFF format, <span class="keep-together">respectively—all</span><a contenteditable="false" data-primary="EPSG:4326 projection" data-type="indexterm" id="idm45433742395520"/> use <a contenteditable="false" data-primary="WGS84 projection" data-type="indexterm" id="idm45433742393488"/>the EPSG:4326 projection, also known as the WGS84 projection. Additionally, you can choose how detailed the data is for downloading. The more detailed data, 1:10 m,<sup><a data-type="noteref" href="ch02.xhtml#ch01fn6" id="ch01fn6-marker">1</a></sup> will be the most resource intensive, with 1:50 m and 1:110 m providing moderate and coarse levels of detail. This relationship is described as a representative fraction scale: 1 unit on the map (such as inches or centimeters) represents the equivalent units on the ground. In our example, 1:50,000,000 means 1 cm = 50 km or 1 inch = 790 miles. In the left panel in <a data-type="xref" href="#population_data_by_python_console_windo">Figure 2-15</a>, you see the Browser window. Once you download the dataset, it can be uploaded from the Browser window and brought directly onto the canvas (in the right panel). Drag the shapefile (<em>.shp</em>) into view. The points represent populated places in the world. The attributes associated with each symbol include capitals, major cities, and towns, for example. The shaded polygons represent urban areas.</p>
<figure><div class="figure" id="population_data_by_python_console_windo"><img alt="Population Data by Python Console window (QGIS)" height="857" src="assets/pgda_0215.png" width="1441"/>
<h6><span class="label">Figure 2-15. </span>Population data by Python Console window (QGIS)</h6>
</div></figure>
<p>Once the data is on the canvas, you can begin to query in the Python Console.<a contenteditable="false" data-primary="Python Console in QGIS" data-secondary="population data visualization" data-type="indexterm" id="idm45433742383664"/> To expand the console, select the icon on the left (under the red arrow on the left). Code will run when you select the green button (under the red arrow on the right). When running a single line of code, the &gt;&gt;&gt; console is fine. When I am iterating over multiple lines of code, I use the editor (the panel on the lower right).</p>
<section data-pdf-bookmark="The QGIS Python Console" data-type="sect2"><div class="sect2" id="the_qgis_python_console">
<h2>The QGIS Python Console</h2>
<p>You can also upload data to the canvas using the Python Console. <a contenteditable="false" data-primary="Python Console in QGIS" data-type="indexterm" id="ix_PyCon"/>Add the vector layer to your local computer: select Layer &gt;&gt; Add Layer &gt;&gt; Add Vector Layer. Copy the path from there or, if you know your directory and the name of the file, you can enter it directly.</p>
<p>Create a variable called <code>uri</code> (or whatever you prefer; I like <code>uri</code>, which stands for <em>uniform resource identifier—</em>a character string for identifying resources). <a contenteditable="false" data-primary="uri variable" data-type="indexterm" id="idm45433742376672"/>You are storing the string that describes the path or source of the data. This will be one of the three parameters you see below in the code snippet for the <code>iface.addVectorLayer</code> function. The second parameter is the layer name you choose, and <code>ogr</code> is the provider key (representing the OGR Simple Features Library, today known only by its acronym). <a contenteditable="false" data-primary="OGR Simple Features Library" data-type="indexterm" id="idm45433742372448"/>Other examples of provider keys include <em>postgres</em> and <em>delimited text</em>.</p>
<p>Write this code into the Python Console, substituting your own username as it appears in your filepath:</p>
<pre data-type="programlisting">
<span>uri=</span>"Users/yourfilepathusername/Downloads/50m_cultural/ne_50m_populated_places.shp"<span>
vlayer = iface.addVectorLayer(uri,</span> "places"<span>,</span> "ogr"<span>)</span></pre>
<p>Run the script, and the canvas populates with the data points.<a contenteditable="false" data-primary="Python" data-secondary="writing code in QGIS Python Console" data-type="indexterm" id="idm45433742367488"/> You can also query populations in the editor:</p>
<pre data-type="programlisting">
for feature in vlayer.getFeatures():
    print(<span>"{pop:.2f} mio people live in {name}"</span>.format(name=feature[<span>'ADMIN'</span>],
	pop=feature[<span>'POP_EST'</span>]/<span>1000000</span>))</pre>
<p>The indentations in your code are important for delineating code that is part of a function; you will get an error if you forget to include them when required. You can see code examples in the editor in <a data-type="xref" href="#population_data_by_python_console_windo">Figure 2-15</a>, in the <a href="https://oreil.ly/aPqZE">Python documentation</a>, and in the <a href="https://oreil.ly/XFgS7">PyQGIS Developer Cookbook</a> online reference. The code result displays in the left window. When you successfully run the code, you will see the output available for scrolling.</p>
<p>When writing code in the editor, comment out any code you do not want to run again (by starting the line with #), as each time you run the cell it will generate output. <a contenteditable="false" data-primary="comments (Python)" data-type="indexterm" id="idm45433742388080"/>Remember to use your own filepath. If the points are not styled to your taste, you can use the Layer Styling panel or write Python code into the console.</p>
<p>A renderer modifies how the data is displayed in a data layer. Next, run the following code and adjust the <code>setSize</code> parameter to your liking:</p>
<pre data-type="programlisting">
vlayer.renderer().symbol().setSize(<span>6</span>)
vlayer.triggerRepaint()</pre>
<p>The <code>triggerRepaint</code> function will update the map. If you don’t call this function, the map won’t update until you run the canvas again.</p>
<p>The Class <a href="https://oreil.ly/gxOJ9"><code>QgsSimpleMarkerSymbolLayerBase</code></a> modifies the shape, size, angle, and scale method of parameters, with many shape options available (listed in the <a href="https://oreil.ly/5zu3W">documentation</a>). Enter the following code to change the shape of the point from a circle to a star:</p>
<pre data-type="programlisting">
vlayer.renderer().symbol().symbolLayer(<span>0</span>).setShape
(QgsSimpleMarkerSymbolLayerBase.Star)
vlayer.triggerRepaint()</pre>
<p class="pagebreak-before less_space">More advanced scripting options are available in the Processing Toolbox. <a contenteditable="false" data-primary="Processing Toolbox (QGIS)" data-secondary="advanced scripting options for Python" data-type="indexterm" id="idm45433742351456"/>If you scroll down to the Python Scripts icon, you will see any saved scripts listed under Example Scripts. If you select the Python icon at the top of the Processing Toolbox, you will see four options: Create New Script, Create New Script From Template, Open Existing Script, and Add Script to Toolbox.</p>
<p>Select Create New Script From Template. Run the script (see the log in <a data-type="xref" href="#python_scripting_window_rendering_a_map">Figure 2-16</a>), and the output layer will show in the Layers Panel as a new layer.</p>
<figure><div class="figure" id="python_scripting_window_rendering_a_map"><img alt="Python scripting window rendering a map" height="1025" src="assets/pgda_0216.png" width="1868"/>
<h6><span class="label">Figure 2-16. </span>Python scripting window rendering a map</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Loading a Raster Layer" data-type="sect2"><div class="sect2" id="loading_a_raster_layer">
<h2>Loading a Raster Layer</h2>
<p>The data you are using is from the <a href="https://oreil.ly/3fZQh">QGIS sample data repository</a>. The<a contenteditable="false" data-primary="Python Console in QGIS" data-startref="ix_PyCon" data-type="indexterm" id="idm45433742344128"/> steps<a contenteditable="false" data-primary="raster data" data-secondary="loading raster layer in QGIS" data-type="indexterm" id="idm45433742342720"/> for loading a raster layer are similar to those for loading a vector layer. <a contenteditable="false" data-primary="QGIS" data-secondary="visualizing population data" data-tertiary="loading raster layer" data-type="indexterm" id="idm45433742340096"/>The biggest differences are that we are now using a <em>.tif</em> file, and the <a contenteditable="false" data-primary="Geospatial Data Abstraction Library (GDAL)" data-secondary="gdal provider" data-type="indexterm" id="idm45433742354624"/>provider parameter is now <code>gdal</code> (from the Geospatial Data Abstraction Library, which we’ll discuss in <a data-type="xref" href="ch09.xhtml#exploring_the_geospatial_data_abstracti">Chapter 9</a>) instead of <code>ogr</code>:</p>
<pre data-type="programlisting">
<span>uri=</span>"Users/bonnymcclain/Downloads/qgis_sample_data/raster/SR_50M_alaska_nad.tif"<span>
rlayer = iface.addRasterLayer(uri,</span> "SR raster"<span>,</span>"gdal"<span>)</span></pre>
<p>It can be helpful to use <code>if</code> statements in determining <a contenteditable="false" data-primary="if statements (Python)" data-type="indexterm" id="idm45433742331680"/>if the code run is successful. The <code>print</code> statement is <a contenteditable="false" data-primary="print statement" data-type="indexterm" id="idm45433742330000"/>indented and will be run when the specific condition holds:</p>
<pre data-type="programlisting">
<strong><span>if</span></strong><span> rlayer.isValid():
        print(</span>"This is a valid raster layer!"<span>)
<strong>else</strong>:
 </span>      print("This raster layer is invalid!"<span>)</span></pre>
<p>Following is an example of raster statistics you can run in the console, and many more are available in the <a href="https://oreil.ly/OKP96">QGIS documentation</a>:</p>
<pre data-type="programlisting">
print(<span>"Width: {}px"</span>.format(rlayer.width())
print(<span>"Height: {}px"</span>.format(rlayer.height()))
print(<span>"Extent: {}"</span>.format(rlayer.extent().toString()))</pre>
<p>The output is shown in <a data-type="xref" href="#adding_a_raster_layer_to_the_canvas">Figure 2-17</a> and here:</p>
<pre data-type="programlisting">
Width: 1754px
Height: 1394px
Extent: -6232946.6726976688951254,-735684.6617672089487314 : 
6363148.4376372583210468,9275122.9686814155429602</pre>
<p>This indicates the pixel values and the <em>extent,</em> or actual <a contenteditable="false" data-primary="extent (raster layer in QGIS)" data-type="indexterm" id="idm45433742319248"/>dimensions, of the layer we are viewing.</p>
<figure><div class="figure" id="adding_a_raster_layer_to_the_canvas"><img alt="Adding a raster layer to the canvas" height="1496" src="assets/pgda_0217.png" width="2260"/>
<h6><span class="label">Figure 2-17. </span>Adding a raster layer to the canvas</h6>
</div></figure>
</div></section>
<section class="pagebreak-before" data-pdf-bookmark="Redlining: Mapping Inequalities" data-type="sect2"><div class="sect2" id="redlining_mapping_inequalities">
<h2 class="less_space">Redlining: Mapping Inequalities</h2>
<p>I’ll end this chapter with a powerful visualization that demonstrates the value of place and location when considering a data question.<a contenteditable="false" data-primary="QGIS" data-secondary="visualizing population data" data-tertiary="redlining, mapping inequalities" data-type="indexterm" id="ix_QGISvispopredl"/><a contenteditable="false" data-primary="redlining, or mapping inequalities" data-type="indexterm" id="ix_redln"/> The <a href="https://oreil.ly/LOcDk">Mapping Inequality: Redlining in New Deal America</a> research project presents data from the <a href="https://oreil.ly/M4kIq">Home Owners’ Loan Corporation (HOLC)</a>, a federal foreclosure-prevention program introduced in 1933 as part of President Franklin Delano Roosevelt’s New Deal.<a contenteditable="false" data-primary="HOLC (Home Owners' Loan Corporation) data" data-type="indexterm" id="idm45433742308512"/> Here’s how the site introduces the data:</p>
<blockquote>
<p>HOLC staff members, using data and evaluations organized by local real estate professionals—lenders, developers, and real estate appraisers—in each city, assigned grades to residential neighborhoods that reflected their “mortgage security” that would then be visualized on color-coded maps. Neighborhoods receiving the highest grade of “A”—colored green on the maps—were deemed minimal risks for banks and other mortgage lenders when they were determining who should receive loans and which areas in the city were safe investments. Those receiving the lowest grade of “D,” colored red, were considered “hazardous.”</p>
</blockquote>
<p>This practice, called redlining, locked existing land-use systems into place. Areas outside of the best classifications (green or blue) were more likely to flood (due to more asphalt covering the ground), to have fewer parks and limited treelines, and to be closer to garbage dumps and interstate freeways.</p>
<p>The project’s website allows you to select a city and explore maps. I spend a lot of time in New York City, so I selected Manhattan in the screenshot in <a data-type="xref" href="#redlining_a_map_of_holc_neighborhood_gr">Figure 2-18</a>. I have walked the neighborhoods of New York City for many years, watching economic investments into neighborhoods once widely considered too dangerous to roam. The 1930s redlining maps highlighted the neighborhoods that surround Central Park as “still desirable” and “best”—as long as they weren’t too close to Harlem and other primarily Black neighborhoods.<sup><a data-type="noteref" href="ch02.xhtml#ch01fn7" id="ch01fn7-marker">2</a></sup> Although mortgage-security redlining is no longer a government-sponsored practice, the land-use systems in many of these areas are still locked in and are often explored as foundational to research directed toward environmental racism.</p>
<figure><div class="figure" id="redlining_a_map_of_holc_neighborhood_gr">
<img height="1886" src="assets/pgda_0218.png" width="3352"/>
<h6><span class="label">Figure 2-18. </span>Redlining: a map of HOLC neighborhood grades in 1930s Manhattan, generated with the Mapping Inequality project’s online tool</h6>
</div></figure>
<p>The data can be downloaded and uploaded to QGIS. Add the shapefiles by dragging them from the Browser panel onto the canvas.<a contenteditable="false" data-primary="shapefiles (.shp)" data-secondary="styling by HOLC grade" data-type="indexterm" id="idm45433742308240"/> To update the colored polygons according to HOLC grade, use the Layer Styling panel, as shown in <a data-type="xref" href="#styling_the_shapefiles_by_holc_grade">Figure 2-19</a>, to select Categorized as a format and <code>holc_grade</code> as the value, then each color as the symbol (selected individually for each value by clicking on each square).</p>
<figure><div class="figure" id="styling_the_shapefiles_by_holc_grade"><img alt="Styling the shapefiles by HOLC grade" height="329" src="assets/pgda_0219.png" width="527"/>
<h6><span class="label">Figure 2-19. </span>Styling the shapefiles by HOLC grade</h6>
</div></figure>
<p><a data-type="xref" href="#qgis_attribute_table_for_mapcomma_which">Figure 2-20</a> shows the New York City map and attribute table displayed in QGIS. Saving the layer as a file will make it available for other maps, where you can examine the persistent impact of redlining.</p>
<figure><div class="figure" id="qgis_attribute_table_for_mapcomma_which"><img alt="QGIS attribute table for map, which includes the attributes state, city, holc_grade, neighborhood, and area" height="1038" src="assets/pgda_0220.png" width="1370"/>
<h6><span class="label">Figure 2-20. </span>QGIS attribute table for map, which includes the attributes <code>state</code>, <code>city</code>, <code>holc_grade</code>, <code>neighborhood</code>, and <code>area</code></h6>
</div></figure>
<p>Redlined areas were—and are—also more likely to be <em>urban heat islands</em>: artificial or natural locations with higher temperatures than the city average. <a contenteditable="false" data-primary="urban heat islands" data-type="indexterm" id="idm45433742275088"/>Neighborhoods with more greenery, fewer impervious surfaces covering the ground, or fewer industrial or large buildings tend to absorb sun more easily than neighborhoods full of concrete, so they are cooler in the summer. Cooler neighborhoods are shown in yellow in <a data-type="xref" href="#urban_heat_islandscomma_calculated_with">Figure 2-21</a>, and the warmer areas are indicated by orange and red. The red circle in <a data-type="xref" href="#urban_heat_islandscomma_calculated_with">Figure 2-21</a> depicts a concentration of higher surface temperatures that maps to HOLC red and yellow grades from the 1930s. The satellite images often capture urban clusters on Earth examining the LandScan urban extant and associated temperatures.</p>
<figure><div class="figure" id="urban_heat_islandscomma_calculated_with"><img alt="Urban heat islands, calculated with mean average between 2003 and 2018. Data source: Earth Engine Data Catalog" height="1218" src="assets/pgda_0221.png" width="1441"/>
<h6><span class="label">Figure 2-21. </span>Urban heat islands, calculated with mean average between 2003 and 2018. Data source: <a href="https://oreil.ly/Fw1tg">Earth Engine Data Catalog</a></h6>
</div></figure>
</div></section>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="summary-id000015">
<h1>Summary</h1>
<p>In this chapter, you were introduced to QGIS and its Python Console. <a contenteditable="false" data-primary="redlining, or mapping inequalities" data-startref="ix_redln" data-type="indexterm" id="idm45433742266736"/><a contenteditable="false" data-primary="QGIS" data-secondary="visualizing population data" data-startref="ix_QGISvispopredl" data-tertiary="redlining, mapping inequalities" data-type="indexterm" id="idm45433742265520"/>You learned how to load <em>.csv</em> and delimited files, shapefiles, and raster data. QGIS has a robust query editor, but often you can execute the same tasks in the Python Console or editor. <a contenteditable="false" data-primary="spatial analysis" data-secondary="essential facilities" data-startref="ix_spaanfacvispop" data-tertiary="visualizing population data" data-type="indexterm" id="idm45433742267072"/><a contenteditable="false" data-primary="QGIS" data-secondary="visualizing population data" data-startref="ix_QGISvispop" data-type="indexterm" id="idm45433742261920"/>You also got a taste for how bringing data together into a map can help you explore complex research questions. Publicly available geospatial datasets can be powerful decision-resource tools for exploring societal harms and benefits as well as frameworks for evaluating potential risks in the public and private sector. This book will provide a window into the scale of the resources available and show you how to interact and explore location intelligence to draw out deeper insights and bigger questions.<a contenteditable="false" data-primary="spatial analysis" data-secondary="essential facilities" data-startref="ix_spaanfac" data-type="indexterm" id="idm45433743174720"/></p>
<p>In the next chapter, you will learn more about PyQGIS, the Python language of QGIS.</p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="ch01fn6"><sup><a href="ch02.xhtml#ch01fn6-marker">1</a></sup> The scale of a map is the ratio of a distance on the map to the corresponding distance on the ground. For reference, <em>1:10 m</em> means that 1 unit on your map (screen) is equal to 10,000,000 units. 1 m on the map = 10,000,000 m. Read more about <a href="https://oreil.ly/LJFbr">Map Scales</a> at the US Geological Survey Information Center.</p><p data-type="footnote" id="ch01fn7"><sup><a href="ch02.xhtml#ch01fn7-marker">2</a></sup> To learn more, see Mitchell, Bruce, and Franco, Juan. 2018. <em>HOLC ‘Redlining’ Maps: The Persistent Structure of Segregation and Economic Inequality.</em> National Community Reinvestment Coalition. <a href="https://ncrc.org/holc"><em>https://ncrc.org/holc</em></a>.</p></div></div></section></div></body></html>