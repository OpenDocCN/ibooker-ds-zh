<html><head></head><body><section data-pdf-bookmark="Chapter 8. Structuring and Refactoring Your Code" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter8">&#13;
<h1><span class="label">Chapter 8. </span>Structuring and Refactoring Your Code</h1>&#13;
&#13;
&#13;
<p>Before we move on to the analyzing and visualizing aspects of data wrangling, we’re going to take a brief “detour” to discuss some strategies for making the most of everything we’ve done so far. In the last few chapters, we’ve explored how to access and parse data from a variety of data formats and sources, how to evaluate its quality in practical terms, and how to clean and augment it for eventual analysis. In the process, our relatively simple programs have evolved and changed, becoming—inevitably—more convoluted and complex. Our <code>for</code> loops now have one or (more) nested <code>if</code> statements, and some of those now have apparently “magic” numbers embedded in them (like our <code>the_date.weekday() &lt;= 4</code> in <a data-type="xref" href="ch07.html#weekday_rides">Example 7-5</a>). Is this just the price of more functional code?</p>&#13;
&#13;
<p>Remember that commenting our code can do a lot to help keep the logic of our scripts understandable, both to potential collaborators and our future selves. But it turns out that detailed documentation (much as I love it) isn’t the only way that we improve the clarity of our Python code. Just like other types of written documents, Python supports a range of useful mechanisms for structuring and organizing our code. By making judicious use of these, we can make it simpler to both use and reuse our programming work down the line.</p>&#13;
&#13;
<p>So in this chapter, we’re going to go over the tools and concepts that will allow us to refine our code in such a way that it is both readable and reusable. This process, <a data-primary="refactoring code" data-type="indexterm" id="idm45143401458288"/><a data-primary="Python" data-secondary="refactoring code" data-see="refactoring code" data-type="indexterm" id="idm45143401457584"/>known as <em>refactoring</em>, exemplifies yet another way that using Python for our data wrangling work makes it possible to get more output for our effort: while we can rely on the functionality that <em>someone else</em>’s library offers when we need to, we can <em>also</em> create new coding “shortcuts” that are customized to exactly our own preferences and needs.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Revisiting Custom Functions" data-type="sect1"><div class="sect1" id="idm45143401454560">&#13;
<h1>Revisiting Custom Functions</h1>&#13;
&#13;
<p>When we <a data-primary="Python" data-secondary="functions" data-tertiary="user-defined" data-type="indexterm" id="python-functions-user-defined2"/><a data-primary="functions" data-secondary="user-defined" data-tertiary="when to use" data-type="indexterm" id="functions-user-defined-usage"/><a data-primary="user-defined functions" data-secondary="when to use" data-type="indexterm" id="user-defined-functions-usage"/>were covering the Python fundamentals way back in <a data-type="xref" href="ch02.html#chapter2">Chapter 2</a>, one of the things we touched on was the concept of “custom” or <em>user-defined</em> functions.<sup><a data-type="noteref" href="ch08.html#idm45143401447136" id="idm45143401447136-marker">1</a></sup> In <a data-type="xref" href="ch02.html#greet_me">Example 2-7</a>, we saw how a custom function could be used to encapsulate the simple task of printing out a greeting when a particular name was provided—but of course we can create custom functions that are as simple or as complex as we like. Before we dive into the mechanics of writing our own custom functions, however, let’s take a step back and think about which design considerations can best help us decide <em>when</em> writing a custom function is likely to be most helpful. Of course, like all writing, there are few hard-and-fast rules, but what follows are a few heuristics that can help you decide when and how refactoring is likely to be worth it.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Will You Use It More Than Once?" data-type="sect2"><div class="sect2" id="idm45143401444528">&#13;
<h2>Will You Use It More Than Once?</h2>&#13;
&#13;
<p>Like variables, one way to identify parts of your code that could benefit from being repackaged into custom functions is to look for any particular task that gets done more than once. From validating input to formatting output (as we did, say, in <a data-type="xref" href="ch07.html#xls_meta_and_date_parsing">Example 7-7</a>) and everything in between, if your current script includes lots of fiddly conditionals or repetitive steps, that’s an indicator that you may want to think about designing some custom functions. Keep in mind, too, that the repetition you’re considering doesn’t need to exist within a single script for refactoring to be worthwhile. If you find that there are particular tasks that you’re doing frequently <em>across</em> the scripts that you’re writing (for example, testing to see if a given day is a weekday, as we did in <a data-type="xref" href="ch07.html#weekday_rides">Example 7-5</a>), you can always put the custom function into an external script and include it anywhere you might need it, just as we did with our credentials files in <a data-type="xref" href="ch05.html#chapter5">Chapter 5</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Is It Ugly and Confusing?" data-type="sect2"><div class="sect2" id="idm45143402677024">&#13;
<h2>Is It Ugly and Confusing?</h2>&#13;
&#13;
<p>Documenting <a data-primary="documentation" data-secondary="user-defined functions as" data-type="indexterm" id="docs-user-defined"/>your work as you go is a gift to both current collaborators and your future self.<sup><a data-type="noteref" href="ch08.html#idm45143402674080" id="idm45143402674080-marker">2</a></sup> At the same time, thoroughly commenting your code—especially if you include not just the <em>how</em> but the <em>why</em> of your approach, which I still recommend—can eventually make it a bit unwieldy to read. Creating really comprehensible code, then, is a balancing act between providing enough detail to be comprehensive while <em>also</em> being sufficiently concise so your documentation actually gets read.</p>&#13;
&#13;
<p>Packaging relevant bits of code into custom functions is actually a key way you can help thread this needle: like variables, custom functions can (and should!) have descriptive names. Just by <em>reading</em> the function name, whoever is looking at your code will get some essential information about what is happening, without your needing to add multiple lines of descriptive comments immediately around it. If the function name is descriptive enough and/or a particular reader doesn’t need more detail right away, they can just move on. Meanwhile, they’ll still be able to find your lovely, descriptive documentation for that function if they need it—neatly tucked away in another part of the program (or another file altogether). This means that the <em>inline</em> comments <a data-primary="commenting code" data-type="indexterm" id="idm45143402669936"/><a data-primary="inline comments" data-type="indexterm" id="idm45143402669200"/>for your main script can stay relatively succinct without sacrificing the completeness of your <a data-primary="documentation" data-secondary="user-defined functions as" data-startref="docs-user-defined" data-type="indexterm" id="idm45143402668288"/>documentation.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Do You Just Really Hate the Default Functionality?" data-type="sect2"><div class="sect2" id="idm45143402666720">&#13;
<h2>Do You Just Really <strong>Hate</strong> the Default Functionality?</h2>&#13;
&#13;
<p>OK, so this <a data-primary="default functionality, changing with user-defined functions" data-type="indexterm" id="idm45143402664752"/>is maybe not the <em>best</em> reason to write a custom function, but it is a real one. Over time, you may find that there are tasks you need to complete over and over again as part of your data wrangling endeavors, and that there’s something about the existing functions and libraries that just <em>bugs</em> you. Maybe it’s a function name that you find confusing so you <em>always</em> have to remind yourself precisely what it’s called. Or maybe there’s a parameter you consistently forget to add that just makes everything more difficult (I’m looking at you, <code>pd.read_csv()</code>, with your <code>dtype='string'</code> parameter!). If you’re working alone or in a small team, it’s perfectly fine to write custom functions that help make your life easier just because they <em>do</em>. You don’t need a grand rationale. If it will make your life easier, go ahead! That’s the power of being the programmer.</p>&#13;
&#13;
<p>Of course, there are some limits to this. Unless you want to take a much more formal and involved approach to writing Python code, you can’t very effectively do things like define a new function that has the same name as an existing function or make operators like <code>+</code> or <code>-</code> behave differently.<sup><a data-type="noteref" href="ch08.html#idm45143402658928" id="idm45143402658928-marker">3</a></sup> However, if you just really wish that an existing function you have to use all the time worked a <em>little</em> bit differently, go with it—just make sure you document the heck out of your <a data-primary="Python" data-secondary="functions" data-startref="python-functions-user-defined2" data-tertiary="user-defined" data-type="indexterm" id="idm45143402657568"/><a data-primary="functions" data-secondary="user-defined" data-startref="functions-user-defined-usage" data-tertiary="when to use" data-type="indexterm" id="idm45143402656032"/><a data-primary="user-defined functions" data-secondary="when to use" data-startref="user-defined-functions-usage" data-type="indexterm" id="idm45143402654528"/>version!</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Understanding Scope" data-type="sect1"><div class="sect1" id="idm45143402653040">&#13;
<h1>Understanding Scope</h1>&#13;
&#13;
<p>Now<a data-primary="Python" data-secondary="functions" data-tertiary="scope" data-type="indexterm" id="python-functions-scope"/><a data-primary="functions" data-secondary="user-defined" data-tertiary="scope" data-type="indexterm" id="functions-user-defined-scope"/><a data-primary="user-defined functions" data-secondary="scope" data-type="indexterm" id="user-defined-functions-scope"/><a data-primary="scope (for functions)" data-type="indexterm" id="scope"/> that we’ve gone over some of the <em>reasons</em> you might refactor your code with custom functions, it’s time to discuss the mechanics a little bit. Probably the most important concept to understand when you start writing custom functions is <em>scope</em>. Although we haven’t used this term before, <em>scope</em> is something that we’ve actually been working with since we declared our first variables way back in <a data-type="xref" href="ch02.html#whats_in_a_name">“What’s in a name?”</a>. In that example, we saw that we could:</p>&#13;
<ol class="pagebreak-before less_space">&#13;
<li>&#13;
<p>Create and assign a value to a variable (<code>author = "Susan E. McGregor"</code>).</p>&#13;
</li>&#13;
<li>&#13;
<p>Use that variable to refer to its contents later and pass its value to a function (<code>print(author)</code>).</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>At the same time, we know that if we created a program that simply consisted of the line:</p>&#13;
<pre>print(author)</pre>&#13;
&#13;
<p>we’d get an error, because in the universe of our one-line script, there is no memory-box labeled <code>author</code>. So Python chucks an error at us and declines to go any further.</p>&#13;
&#13;
<p>When we talk about <em>scope</em> in programming, what we’re actually talking about is the current “universe” from the perspective of a particular piece of code. An individual script has a scope that evolves as each line of code is read by the computer, from top to bottom, which is what leads to the (very much expected) behaviors of the scripts in Examples <a data-type="xref" data-xrefstyle="select:labelnumber" href="#no_scope">8-1</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#author_scope">8-2</a>.</p>&#13;
<div data-type="example" id="no_scope">&#13;
<h5><span class="label">Example 8-1. </span>No <code>author</code> variable in scope</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c1"># no variable called "author" exists in the same "universe"</code>&#13;
<code class="c1"># as this line of code; throw an error</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">author</code><code class="p">)</code></pre></div>&#13;
<div data-type="example" id="author_scope">&#13;
<h5><span class="label">Example 8-2. </span>An <code>author</code> variable in scope</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c1"># create variable "author"</code>&#13;
<code class="n">author</code> <code class="o">=</code> <code class="s2">"Susan E. McGregor"</code>&#13;
&#13;
<code class="c1"># variable "author" exists in the "universe" of this line of code; carry on!</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">author</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Just as every time we create a new variable, a new “box” is created in the computer’s memory, each time we define a new custom function, a new little universe, or <em>scope</em>, is created for it as well. This means that when we use custom functions, we are compartmentalizing our code not just <em>visually</em> but <em>logically</em> and <em>functionally</em>. This means that we can treat our <em>own</em> custom functions much the way we do the built-in Python methods and library functions that we’ve been using throughout this book: as “recipes” to which we provide “ingredients” and which return to us some value or freshly made Python object in return. The only difference is that with custom functions, we are the chefs!</p>&#13;
&#13;
<p>To get a handle on what this all means in practice, let’s revisit <a data-type="xref" href="ch02.html#greet_me">Example 2-7</a> from <a data-type="xref" href="ch02.html#chapter2">Chapter 2</a> but with a couple of tweaks, as shown in <a data-type="xref" href="#greet_me_revisited">Example 8-3</a>.</p>&#13;
<div data-type="example" id="greet_me_revisited">&#13;
<h5><span class="label">Example 8-3. </span>greet_me_revisited.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c1"># create a function that prints out a greeting</code>&#13;
<code class="c1"># to any name passed to the function</code>&#13;
<code class="k">def</code> <code class="nf">greet_me</code><code class="p">(</code><code class="n">a_name</code><code class="p">):</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="s2">"Variable `a_name` in `greet_me`: "</code><code class="o">+</code><code class="n">a_name</code><code class="p">)</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="s2">"Hello "</code><code class="o">+</code><code class="n">a_name</code><code class="p">)</code>&#13;
&#13;
&#13;
<code class="c1"># create a variable named `author`</code>&#13;
<code class="n">author</code> <code class="o">=</code> <code class="s2">"Susan E. McGregor"</code>&#13;
&#13;
<code class="c1"># create another variable named `editor`</code>&#13;
<code class="n">editor</code>  <code class="o">=</code> <code class="s2">"Jeff Bleiel"</code>&#13;
&#13;
<code class="n">a_name</code> <code class="o">=</code> <code class="s2">"Python"</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="s2">"Variable `a_name` in main script: "</code><code class="o">+</code><code class="n">a_name</code><code class="p">)</code>&#13;
&#13;
<code class="c1"># use my custom function, `greet_me` to output "Hello" messages to each person</code>&#13;
<code class="n">greet_me</code><code class="p">(</code><code class="n">author</code><code class="p">)</code>&#13;
<code class="n">greet_me</code><code class="p">(</code><code class="n">editor</code><code class="p">)</code>&#13;
&#13;
<code class="k">print</code><code class="p">(</code><code class="s2">"Variable `a_name` in main script again: "</code><code class="o">+</code><code class="n">a_name</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>This yields the following output:</p>&#13;
&#13;
<pre data-type="programlisting">Variable `a_name` in main script: Python&#13;
Variable `a_name` in `greet_me`: Susan E. McGregor&#13;
Hello Susan E. McGregor&#13;
Variable `a_name` in `greet_me`: Jeff Bleiel&#13;
Hello Jeff Bleiel&#13;
Variable `a_name` in main script again: Python</pre>&#13;
&#13;
<p>Because any custom function automatically gets its own scope, that function can only “see” the variables and values that are explicitly passed into it. In turn, the values and variables inside that function are effectively “hidden” from the primary script. One consequence of this is that when we write custom functions, we don’t need to worry about what variable names have already been used in the primary script, or vice versa. As a result, we need to define fewer unique variable names in general, which is helpful as we begin to write longer and more complex scripts. It <em>also</em> means that once we have a custom function working as we expect, we can use—and even modify—the details of how it functions <em>without</em> having to make adjustments to the variables and functions in the surrounding<a data-primary="Python" data-secondary="functions" data-startref="python-functions-scope" data-tertiary="scope" data-type="indexterm" id="idm45143401200416"/><a data-primary="functions" data-secondary="user-defined" data-startref="functions-user-defined-scope" data-tertiary="scope" data-type="indexterm" id="idm45143401199088"/><a data-primary="user-defined functions" data-secondary="scope" data-startref="user-defined-functions-scope" data-type="indexterm" id="idm45143401197760"/><a data-primary="scope (for functions)" data-startref="scope" data-type="indexterm" id="idm45143401196672"/> script.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Defining the Parameters for Function “Ingredients”" data-type="sect1"><div class="sect1" id="idm45143402652416">&#13;
<h1>Defining the Parameters for Function “Ingredients”</h1>&#13;
&#13;
<p>We <a data-primary="Python" data-secondary="functions" data-tertiary="arguments" data-type="indexterm" id="python-functions-arguments"/><a data-primary="functions" data-secondary="arguments" data-type="indexterm" id="functions-arguments"/><a data-primary="arguments (for functions)" data-type="indexterm" id="arguments"/><a data-primary="parameters (for functions)" data-type="indexterm" id="parameters"/><a data-primary="user-defined functions" data-secondary="arguments" data-type="indexterm" id="user-defined-functions-arguments"/>already have a fair amount of experience with providing “ingredients” (officially known as <em>arguments</em>) to the methods and functions that come built into Python, or that we’ve had access to through the many libraries we’ve used so far. As we begin to write custom functions, however, we need to explore in more detail what the process is for defining the <em>parameters</em> that those functions will accept.<sup><a data-type="noteref" href="ch08.html#idm45143401186992" id="idm45143401186992-marker">4</a></sup></p>&#13;
&#13;
<p>First, know that—unlike some programming languages—Python doesn’t require (or even really allow) you to <em>insist</em> that a function’s parameters have specific data types.<sup><a data-type="noteref" href="ch08.html#idm45143401184608" id="idm45143401184608-marker">5</a></sup> If someone wants to pass entirely the wrong types of data into your function, they can absolutely do that. As the function author, then, it’s up to you to decide whether and how you want to confirm (or <em>validate</em>) the appropriateness of the arguments or “ingredients” that have been passed into your custom functions. In principle, there are three ways to approach this:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Check the data types of all the arguments that have been passed into your function and complain to the programmer if you find something you don’t like.</p>&#13;
</li>&#13;
<li>&#13;
<p>Wrap your code in <a href="https://w3schools.com/python/python_try_except.asp">Python’s <code>try...except</code> blocks</a> so that you can capture certain types of errors without halting the entire program. You can also use this to customize the message to the programmer about what went wrong.</p>&#13;
</li>&#13;
<li>&#13;
<p>Not worry about it and let the user of the function (in other words, the programmer) work through any problems using the default Python error messages.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>While it may seem a bit laissez-faire, my primary recommendation at this point is actually to go with option three: don’t worry about it. Not because errors won’t happen (they will—you can revisit <a data-type="xref" href="ch02.html#greet_me_ff">“Fast Forward”</a> if you need a refresher on what some of them look like) but because our primary interest here is wrangling data, not writing enterprise-level Python. As with the scripts we wrote in <a data-type="xref" href="ch04.html#chapter4">Chapter 4</a>, we want to strike a balance between what we try to handle programmatically and what we rely on the programmer (whoever they may be) to investigate and handle for themselves. Since the programs we’re writing won’t bring down a website or corrupt the only copy of our data if they work incorrectly, not trying to anticipate and handle every possible error that might arise seems more than reasonable. Of course, if you document your functions clearly—a process we’ll look at in more detail in <a data-type="xref" href="#documenting_custom_functions">“Documenting Your Custom Scripts and &#13;
<span class="keep-together">Functions with pydoc</span>”</a>—then other programmers will have everything they need to avoid errors in the first place.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="What Are Your Options?" data-type="sect2"><div class="sect2" id="idm45143401173664">&#13;
<h2>What Are Your Options?</h2>&#13;
&#13;
<p>Even if<a data-primary="optional arguments" data-type="indexterm" id="idm45143401172144"/> we’re not trying to write custom functions for use by thousands of people, we can still make them flexible and fully featured. One of the simplest ways to do this is to write our functions to solve the most common version of our problem but allow optional arguments—like those we’ve seen in <em>pandas</em><sup><a data-type="noteref" href="ch08.html#idm45143401170704" id="idm45143401170704-marker">6</a></sup> and other libraries—that make them somewhat adaptable. For example, we could modify our <code>greet_me()</code> function to have a default greeting of “Hello” that can <em>also</em> be overridden by an optional value passed in by the programmer. This lets us craft functions that can be used effectively in multiple contexts. As an example, let’s look at the modified version of <code>greet_me</code> shown in <a data-type="xref" href="#greet_me_options">Example 8-4</a>.</p>&#13;
<div data-type="example" id="greet_me_options">&#13;
<h5><span class="label">Example 8-4. </span>greet_me_options.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c1"># create a function that prints out a greeting to any name</code>&#13;
<code class="k">def</code> <code class="nf">greet_me</code><code class="p">(</code><code class="n">a_name</code><code class="p">,</code> <code class="n">greeting</code><code class="o">=</code><code class="s2">"Hello"</code><code class="p">):</code>&#13;
    <code class="k">print</code><code class="p">(</code><code class="n">greeting</code><code class="o">+</code><code class="s2">" "</code><code class="o">+</code><code class="n">a_name</code><code class="p">)</code>&#13;
&#13;
<code class="c1"># create a variable named author</code>&#13;
<code class="n">author</code> <code class="o">=</code> <code class="s2">"Susan E. McGregor"</code>&#13;
&#13;
<code class="c1"># create another variable named editor</code>&#13;
<code class="n">editor</code>  <code class="o">=</code> <code class="s2">"Jeff Bleiel"</code>&#13;
&#13;
<code class="c1"># use `greet_me()` to output greeting messages to each person</code>&#13;
&#13;
<code class="c1"># say "Hello" by default</code>&#13;
<code class="n">greet_me</code><code class="p">(</code><code class="n">author</code><code class="p">)</code>&#13;
<code class="c1"># let the programmer specify "Hi" as the greeting</code>&#13;
<code class="n">greet_me</code><code class="p">(</code><code class="n">editor</code><code class="p">,</code> <code class="n">greeting</code><code class="o">=</code><code class="s2">"Hi"</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>As you can see, adding optional arguments is really as simple as specifying a default value in the function definition; if the programmer passes a different value, it will simply overwrite that default when the function is called.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Getting Into Arguments?" data-type="sect2"><div class="sect2" id="idm45143401092576">&#13;
<h2>Getting Into Arguments?</h2>&#13;
&#13;
<p>Providing a default value in the function declaration is not the only way to add optional arguments to your custom functions. Python also supports two generic types of optional arguments, <code>*args</code> and <code>**kwargs</code>:</p>&#13;
<dl>&#13;
<dt class="horizontal"><code>*args</code> </dt>&#13;
<dd>&#13;
<p>The <code>*args</code> parameter <a data-primary="*args parameter" data-primary-sortas="args parameter" data-type="indexterm" id="idm45143401087600"/>is useful when you want to be able to pass a list of several values into a function and giving all of them names and/or default values would be tedious. Values passed in as <code>*args</code> are stored as a list, so they can be accessed within the function by writing a <code>for...in</code> loop to go through them one by one (e.g., <code>for arg in args</code>).</p>&#13;
</dd>&#13;
<dt class="horizontal"><code>**kwargs</code> </dt>&#13;
<dd>&#13;
<p>The <code>**kwargs</code> parameter is similar to <code>*args</code>, except that it allows an <a data-primary="**kwargs parameter" data-primary-sortas="kwargs parameter" data-type="indexterm" id="idm45143401082128"/>arbitrary number of keyword arguments to be passed to the function without assigning any of them a default value, as we did for <code>greeting</code> in <a data-type="xref" href="#greet_me_options">Example 8-4</a>. Values passed this way can be accessed via the <code>kwargs.get()</code> method (e.g., <code>my_var = kwargs.get("greeting")</code>).</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>If using <code>*args</code> and <code>**kwargs</code> seems like a handy way to (literally) leave your options open when writing custom functions, I’m here to tell you that it’s <em>always</em> better to write custom functions (and scripts!) that solve the problems you <em>have</em>—not the ones you <em>think</em> you might have somewhere down the line. While the idea of extreme flexibility may seem attractive at first, it will usually lead to spending lots of time <em>thinking</em> about “someday” problems, rather than <em>actually</em> solving the ones right in front of us. And who has time for that? We’ve got data to<a data-primary="Python" data-secondary="functions" data-startref="python-functions-arguments" data-tertiary="arguments" data-type="indexterm" id="idm45143401074416"/><a data-primary="functions" data-secondary="arguments" data-startref="functions-arguments" data-type="indexterm" id="idm45143401072928"/><a data-primary="arguments (for functions)" data-startref="arguments" data-type="indexterm" id="idm45143401071712"/><a data-primary="parameters (for functions)" data-startref="parameters" data-type="indexterm" id="idm45143401070800"/><a data-primary="user-defined functions" data-secondary="arguments" data-startref="user-defined-functions-arguments" data-type="indexterm" id="idm45143401069840"/> wrangle!</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Return Values" data-type="sect1"><div class="sect1" id="idm45143401068480">&#13;
<h1>Return Values</h1>&#13;
&#13;
<p>So far, <a data-primary="Python" data-secondary="functions" data-tertiary="return values" data-type="indexterm" id="python-functions-return"/><a data-primary="functions" data-secondary="return values" data-type="indexterm" id="functions-return-values"/><a data-primary="user-defined functions" data-secondary="return values" data-type="indexterm" id="user-defined-functions-return"/><a data-primary="return values" data-type="indexterm" id="return-values"/>our variations on the <code>greet_me()</code> function have been of pretty limited ambition; we’ve really just used them to print (slightly) customized messages to the console. By comparison, the functions we’ve used from external libraries have proven incredibly powerful; they can take a humble <em>.csv</em> and transform it into a <em>pandas</em> DataFrame or convert a whole <em>.xls</em> file into a collection of detailed lists and attributes that capture almost every aspect of this multitiered file type. While that level of Python programming is beyond the scope of this book, we can still create clean, super-useful custom functions harnessing the power of <em>return values</em>.</p>&#13;
&#13;
<p>If parameters/arguments are the “ingredients” in our function “recipes,” then <em>return values</em> are the final dish—the outputs that get consumed by the rest of our program. Really, return values are just pieces of data; they can be <em>literals</em> (like the string “Hello”), or they can be variables of any data type. They are useful because they let us hand off to a function whatever it needs and get back the thing that we need, without worrying (at least from the perspective—or <em>scope</em>—of the main program) how the proverbial sausage gets made. If we restructure the basic <code>greet_me()</code> function in <a data-type="xref" href="#greet_me_revisited">Example 8-3</a> to use a return value, it might look something like <a data-type="xref" href="#make_greeting">Example 8-5</a>.</p>&#13;
<div data-type="example" id="make_greeting">&#13;
<h5><span class="label">Example 8-5. </span>make_greeting.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c1"># create a function that **returns** a greeting to any name passed in</code>&#13;
<code class="k">def</code> <code class="nf">make_greeting</code><code class="p">(</code><code class="n">a_name</code><code class="p">):</code>&#13;
    <code class="k">return</code><code class="p">(</code><code class="s2">"Hello "</code><code class="o">+</code><code class="n">a_name</code><code class="p">)</code>&#13;
&#13;
&#13;
<code class="c1"># create a variable named author</code>&#13;
<code class="n">author</code> <code class="o">=</code> <code class="s2">"Susan E. McGregor"</code>&#13;
&#13;
<code class="c1"># create another variable named editor</code>&#13;
<code class="n">editor</code>  <code class="o">=</code> <code class="s2">"Jeff Bleiel"</code>&#13;
&#13;
&#13;
<code class="c1"># use my custom function, `greet_me()` to build and store</code>&#13;
<code class="c1"># the "Hello" messages to each person</code>&#13;
<code class="n">author_greeting</code> <code class="o">=</code> <code class="n">make_greeting</code><code class="p">(</code><code class="n">author</code><code class="p">)</code>&#13;
<code class="n">editor_greeting</code> <code class="o">=</code> <code class="n">make_greeting</code><code class="p">(</code><code class="n">editor</code><code class="p">)</code>&#13;
&#13;
<code class="c1"># now `print()` the greetings built and returned by each function call</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">author_greeting</code><code class="p">)</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">editor_greeting</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>At first you might be thinking, “How did that help?” While it’s true that our main program actually got <em>longer</em>, it also arguably became a little bit more flexible and easier to understand. Because my <code>make_greeting()</code> function <em>returns</em> the greeting (rather than just printing it directly), I can do more things with it. Sure, I can just print it as we did in <a data-type="xref" href="#make_greeting">Example 8-5</a>, but I can now also store its return value in a variable and do something else with it later. For example, I could add the line:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">print</code><code class="p">(</code><code class="n">editor_greeting</code><code class="o">+</code><code class="s2">", how are you?"</code><code class="p">)</code></pre>&#13;
&#13;
<p>While that new message might not seem so exciting, it lets me both compartmentalize <em>some</em> work into the function (in this case, adding “Hello” to any name) while <em>also</em> giving me more flexibility about what to do with the output (for example, add more text to one but not <a data-primary="Python" data-secondary="functions" data-startref="python-functions-return" data-tertiary="return values" data-type="indexterm" id="idm45143400970688"/><a data-primary="functions" data-secondary="return values" data-startref="functions-return-values" data-type="indexterm" id="idm45143400969200"/><a data-primary="user-defined functions" data-secondary="return values" data-startref="user-defined-functions-return" data-type="indexterm" id="idm45143400967984"/><a data-primary="return values" data-startref="return-values" data-type="indexterm" id="idm45143400966800"/>the other).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Climbing the “Stack”" data-type="sect1"><div class="sect1" id="idm45143400965600">&#13;
<h1>Climbing the “Stack”</h1>&#13;
&#13;
<p>Of course, <a data-primary="Python" data-secondary="functions" data-tertiary="nesting" data-type="indexterm" id="python-functions-nesting"/><a data-primary="functions" data-secondary="nesting" data-type="indexterm" id="functions-nesting"/><a data-primary="nesting" data-secondary="functions" data-type="indexterm" id="nesting-functions-refactor"/><a data-primary="user-defined functions" data-secondary="nesting" data-type="indexterm" id="user-defined-functions-nesting"/>creating a whole new variable just to store a simple greeting, as we did in <a data-type="xref" href="#make_greeting">Example 8-5</a>, does seem like a little bit more trouble than it’s worth. And in fact, there’s no rule that says we have to stash the output from a function in a variable before passing it to another function—we can actually “nest” our function calls so that the first function’s <em>output</em> just becomes the next function’s <em>input</em>. This is a strategy that we’ve actually used before, usually when we were manipulating strings and passing them to the <code>print()</code> function, as we did when we added the <code>strip()</code> function call to our <em>.csv</em> building process in <a data-type="xref" href="ch07.html#fixed_width_strip_parsing">Example 7-8</a>. But we can do this with <em>any</em> set of functions, assuming the first one returns what the next one needs. To see how this works in practice, take a look at the rewrite of <a data-type="xref" href="#make_greeting">Example 8-5</a> shown in <a data-type="xref" href="#make_greeting_no_vars">Example 8-6</a>, where I’ve added a new function to append the “, how are you?” text to a greeting message.</p>&#13;
<div data-type="example" id="make_greeting_no_vars">&#13;
<h5><span class="label">Example 8-6. </span>make_greeting_no_vars.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c1"># function that returns a greeting to any name passed in</code>&#13;
<code class="k">def</code> <code class="nf">make_greeting</code><code class="p">(</code><code class="n">a_name</code><code class="p">):</code>&#13;
    <code class="k">return</code><code class="p">(</code><code class="s2">"Hello "</code><code class="o">+</code><code class="n">a_name</code><code class="p">)</code>&#13;
&#13;
<code class="c1"># function that adds a question to any greeting</code>&#13;
<code class="k">def</code> <code class="nf">add_question</code><code class="p">(</code><code class="n">a_greeting</code><code class="p">):</code>&#13;
    <code class="k">return</code><code class="p">(</code><code class="n">a_greeting</code><code class="o">+</code><code class="s2">", how are you?"</code><code class="p">)</code>&#13;
&#13;
<code class="c1"># create a variable named author</code>&#13;
<code class="n">author</code> <code class="o">=</code> <code class="s2">"Susan E. McGregor"</code>&#13;
&#13;
<code class="c1"># create another variable named editor</code>&#13;
<code class="n">editor</code>  <code class="o">=</code> <code class="s2">"Jeff Bleiel"</code>&#13;
&#13;
<code class="c1"># print the greeting message</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">make_greeting</code><code class="p">(</code><code class="n">author</code><code class="p">))</code>&#13;
&#13;
<code class="c1"># pass the greeting message to the question function and print the result!</code>&#13;
<code class="k">print</code><code class="p">(</code><code class="n">add_question</code><code class="p">(</code><code class="n">make_greeting</code><code class="p">(</code><code class="n">editor</code><code class="p">)))</code></pre></div>&#13;
&#13;
<p>While the code statement <code>print(make_greeting(author))</code> is still fairly easy to interpret, things start to get more complicated with <code>print(add_question(make_greeting(editor)))</code>, which I hope helps illustrate that there’s a limit to the utility of function call nesting. The more function calls you nest, the more difficult it is to read the code, even though the “order of operations” logic stays the same: the “innermost” function is always executed first, and its return value “bubbles up” to become the input for the next function. <em>That</em> return value then bubbles up to the next function, and so on and so forth. In traditional programming terminology this, is known as the <em>function stack</em>, where the innermost function is the “bottom” of the stack and the outermost is the “top.”<sup><a data-type="noteref" href="ch08.html#idm45143400844448" id="idm45143400844448-marker">7</a></sup> An illustration of the function stack for the last line of <a data-type="xref" href="#make_greeting_no_vars">Example 8-6</a> is shown in <a data-type="xref" href="#nested_function_stack">Figure 8-1</a>.</p>&#13;
&#13;
<p>While this sort of function-call nesting is at the heart of <a href="https://en.wikipedia.org/wiki/Functional_programming">an entire programming philosophy</a>, for the sake of readability it is best used sparingly <a data-primary="Python" data-secondary="functions" data-startref="python-functions-nesting" data-tertiary="nesting" data-type="indexterm" id="idm45143400840672"/><a data-primary="functions" data-secondary="nesting" data-startref="functions-nesting" data-type="indexterm" id="idm45143400839120"/><a data-primary="nesting" data-secondary="functions" data-startref="nesting-functions-refactor" data-type="indexterm" id="idm45143400837904"/><a data-primary="user-defined functions" data-secondary="nesting" data-startref="user-defined-functions-nesting" data-type="indexterm" id="idm45143400836672"/>in most instances.</p>&#13;
&#13;
<figure><div class="figure" id="nested_function_stack">&#13;
<img alt="A nested function call stack." src="assets/ppdw_0801.png"/>&#13;
<h6><span class="label">Figure 8-1. </span>A nested function call stack</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Refactoring for Fun and Profit" data-type="sect1"><div class="sect1" id="idm45143400833200">&#13;
<h1>Refactoring for Fun and Profit</h1>&#13;
&#13;
<p>Now that we’ve explored some of the key principles and mechanisms for refactoring our code, let’s see how it can be used to improve the clarity of some of our scripts from previous chapters. As we move through the follwoing examples, remember that choices about what to refactor and how (as with <em>any</em> kind of editing process) are partly a matter of preference and style. To that end, I’ll describe the reasoning behind my choices below each example; you may find these to be useful models when it comes to developing your <em>own</em> refactoring practice.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="A Function for Identifying Weekdays" data-type="sect2"><div class="sect2" id="idm45143400830384">&#13;
<h2>A Function for Identifying Weekdays</h2>&#13;
&#13;
<p>In <a data-type="xref" href="ch07.html#weekday_rides">Example 7-5</a>, we<a data-primary="refactoring code" data-secondary="weekdays function example" data-type="indexterm" id="refactoring-weekdays"/><a data-primary="Python" data-secondary="functions" data-tertiary="weekdays refactoring example" data-type="indexterm" id="python-functions-weekdays"/><a data-primary="functions" data-secondary="for refactoring" data-secondary-sortas="refactoring" data-tertiary="weekdays example" data-type="indexterm" id="functions-weekdays"/><a data-primary="weekday() function" data-type="indexterm" id="weekdays"/> created a small script designed to read in our <a href="https://s3.amazonaws.com/tripdata/index.html">Citi Bike rides data</a> and output a new file containing only the rides that took place on a weekday. While there was nothing fundamentally wrong with the approach we used in that example, I think it is a good candidate for refactoring for a couple of reasons.</p>&#13;
&#13;
<p>First, the existing script relies on a couple of ugly and not-very-descriptive function calls. The first one is required to convert the available date string into an actual <code>datetime</code> format that Python can evaluate meaningfully:</p>&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<code class="n">the_date</code> <code class="o">=</code> <code class="n">datetime</code><code class="o">.</code><code class="n">strptime</code><code class="p">(</code><code class="n">a_row</code><code class="p">[</code><code class="s1">'starttime'</code><code class="p">],</code> <code class="s1">'</code><code class="si">%Y</code><code class="s1">-</code><code class="si">%m</code><code class="s1">-</code><code class="si">%d</code><code class="s1"> </code><code class="si">%H</code><code class="s1">:</code><code class="si">%M</code><code class="s1">:</code><code class="si">%S</code><code class="s1">.</code><code class="si">%f</code><code class="s1">'</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p>Similarly, though the built-in <code>weekday()</code> method is reasonably straightforward (although it might be better named <code>dayofweek()</code>), we have to compare it to the “magic number” <code>4</code> in order to determine if <code>the_date</code> is, in fact, a weekday:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="k">if</code> <code class="n">the_date</code><code class="o">.</code><code class="n">weekday</code><code class="p">()</code> <code class="o">&lt;=</code> <code class="mi">4</code><code class="p">:</code></pre>&#13;
&#13;
<p>Overall, I think these parts of the code would be more readable without these relatively obscure formats and comparisons.</p>&#13;
&#13;
<p>Second, checking whether a particular date-like string is a Monday-through-Friday weekday seems like the kind of thing that might come up reasonably frequently in data wrangling work. If I encapsulate this task into a custom function, I can easily reuse it in other scripts.</p>&#13;
&#13;
<p>To see how I’ve gone about refactoring the <a data-type="xref" href="ch07.html#weekday_rides">Example 7-5</a> script, take a look at &#13;
<span class="keep-together"><a data-type="xref" href="#weekday_rides_refactored">Example 8-7</a>.</span></p>&#13;
<div data-type="example" id="weekday_rides_refactored">&#13;
<h5><span class="label">Example 8-7. </span>weekday_rides_refactored.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c1"># objective: filter all September, 2020 Citi Bike rides, and output a new</code><code>&#13;
</code><code class="c1">#             file containing only weekday rides</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># program outline:</code><code>&#13;
</code><code class="c1"># 1. read in the data file: 202009-citibike-tripdata.csv</code><code>&#13;
</code><code class="c1"># 2. create a new output file, and write the header row to it.</code><code>&#13;
</code><code class="c1"># 3. for each row in the file, make a date from the `starttime`:</code><code>&#13;
</code><code class="c1">#       a. if it's a weekday, write the row to our output file</code><code>&#13;
</code><code class="c1"># 4. close the output file</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># import the "csv" library</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">csv</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># import the "datetime" library</code><code>&#13;
</code><code class="kn">from</code><code> </code><code class="nn">datetime</code><code> </code><code class="kn">import</code><code> </code><code class="n">datetime</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">main</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO1-1" id="co_structuring_and_refactoring_your_code_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="c1"># open our data file in "read" mode</code><code>&#13;
</code><code>    </code><code class="n">source_file</code><code> </code><code class="o">=</code><code> </code><code class="nb">open</code><code class="p">(</code><code class="s2">"</code><code class="s2">202009-citibike-tripdata.csv</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">r</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># open our output file in "write" mode</code><code>&#13;
</code><code>    </code><code class="n">output_file</code><code> </code><code class="o">=</code><code> </code><code class="nb">open</code><code class="p">(</code><code class="s2">"</code><code class="s2">202009-citibike-weekday-tripdata.csv</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">w</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># pass our source_file to the DictReader "recipe"</code><code>&#13;
</code><code>    </code><code class="c1"># and store the result in a variable called `citibike_reader`</code><code>&#13;
</code><code>    </code><code class="n">citibike_reader</code><code> </code><code class="o">=</code><code> </code><code class="n">csv</code><code class="o">.</code><code class="n">DictReader</code><code class="p">(</code><code class="n">source_file</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># create a corresponding DictWriter; specify its fieldnames should</code><code>&#13;
</code><code>    </code><code class="c1"># be drawn from `citibike_reader`</code><code>&#13;
</code><code>    </code><code class="n">output_writer</code><code> </code><code class="o">=</code><code> </code><code class="n">csv</code><code class="o">.</code><code class="n">DictWriter</code><code class="p">(</code><code class="n">output_file</code><code class="p">,</code><code>&#13;
</code><code>                                   </code><code class="n">fieldnames</code><code class="o">=</code><code class="n">citibike_reader</code><code class="o">.</code><code class="n">fieldnames</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># actually write the header row to the output file</code><code>&#13;
</code><code>    </code><code class="n">output_writer</code><code class="o">.</code><code class="n">writeheader</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># loop through our `citibike_reader` rows</code><code>&#13;
</code><code>    </code><code class="k">for</code><code> </code><code class="n">a_row</code><code> </code><code class="ow">in</code><code> </code><code class="n">citibike_reader</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># if the current 'starttime' value is a weekday</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="n">is_weekday</code><code class="p">(</code><code class="n">a_row</code><code class="p">[</code><code class="s1">'</code><code class="s1">starttime</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO1-2" id="co_structuring_and_refactoring_your_code_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>            </code><code class="c1"># write that row of data to our output file</code><code>&#13;
</code><code>            </code><code class="n">output_writer</code><code class="o">.</code><code class="n">writerow</code><code class="p">(</code><code class="n">a_row</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># close the output file</code><code>&#13;
</code><code>    </code><code class="n">output_file</code><code class="o">.</code><code class="n">close</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">is_weekday</code><code class="p">(</code><code class="n">date_string</code><code class="p">,</code><code> </code><code class="n">date_format</code><code class="o">=</code><code class="s1">'</code><code class="si">%Y</code><code class="s1">-</code><code class="si">%m</code><code class="s1">-</code><code class="si">%d</code><code class="s1"> </code><code class="si">%H</code><code class="s1">:</code><code class="si">%M</code><code class="s1">:</code><code class="si">%S</code><code class="s1">.</code><code class="si">%f</code><code class="s1">'</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO1-2" id="co_structuring_and_refactoring_your_code_CO1-3"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># convert the value in the 'date_string' to datetime format</code><code>&#13;
</code><code>    </code><code class="n">the_date</code><code> </code><code class="o">=</code><code> </code><code class="n">datetime</code><code class="o">.</code><code class="n">strptime</code><code class="p">(</code><code class="n">date_string</code><code class="p">,</code><code> </code><code class="n">date_format</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># if `the_date` is a weekday (i.e., its integer value is 0-5)</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">the_date</code><code class="o">.</code><code class="n">weekday</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">&lt;</code><code class="o">=</code><code> </code><code class="mi">4</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="k">return</code><code class="p">(</code><code class="bp">True</code><code class="p">)</code><code>&#13;
</code><code>    </code><code class="k">else</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="k">return</code><code class="p">(</code><code class="bp">False</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">if</code><code> </code><code class="nv-Magic">__name__</code><code> </code><code class="o">==</code><code> </code><code class="s2">"</code><code class="s2">__main__</code><code class="s2">"</code><code class="p">:</code><code> </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO1-3" id="co_structuring_and_refactoring_your_code_CO1-4"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">main</code><code class="p">(</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_structuring_and_refactoring_your_code_CO1-1" id="callout_structuring_and_refactoring_your_code_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Wrapping our top-level script into a function called <code>main()</code> is a Python convention that also serves an important functional purpose. Because the computer reads Python top to bottom, if we <em>don’t</em> wrap this code in a function, then the computer won’t have gotten to the definition of <code>is_weekday()</code> when it reaches <code>if is_weekday(a_row['starttime'])</code> and will throw an error.</p></dd>&#13;
<dt><a class="co" href="#co_structuring_and_refactoring_your_code_CO1-2" id="callout_structuring_and_refactoring_your_code_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We can use the <code>is_weekday()</code> function to handle the finicky details of converting our date string to both a “real” date and its weekday value. The descriptive function name conveys what is happening at a high level without forcing the reader to wade through the particulars.</p></dd>&#13;
<dt><a class="co" href="#co_structuring_and_refactoring_your_code_CO1-4" id="callout_structuring_and_refactoring_your_code_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>The computer still reads from top to bottom as usual, but while it encounters both the <code>main()</code> and <code>is_weekday()</code> function definitions first, we aren’t asking it to execute anything until the very bottom of the script.</p></dd>&#13;
</dl>&#13;
&#13;
<p>As you can see, while the bulk of the code (and even many of the comments) in <a data-type="xref" href="#weekday_rides_refactored">Example 8-7</a> are the same as those in <a data-type="xref" href="ch07.html#weekday_rides">Example 7-5</a>, things have been reorganized in a way that makes the <code>main()</code> part of the program much more concise and readable. Sure, if the programmer <em>wants</em> to know the details of how weekdays are identified, the specifics are available right there in the <code>is_weekday()</code> function definition. Otherwise, though, they can just read through the primary part of the script and very easily confirm that it is doing what the outline <a data-primary="refactoring code" data-secondary="weekdays function example" data-startref="refactoring-weekdays" data-type="indexterm" id="idm45143400565056"/><a data-primary="Python" data-secondary="functions" data-startref="python-functions-weekdays" data-tertiary="weekdays refactoring example" data-type="indexterm" id="idm45143400563792"/><a data-primary="functions" data-secondary="for refactoring" data-secondary-sortas="refactoring" data-startref="functions-weekdays" data-tertiary="weekdays example" data-type="indexterm" id="idm45143400562272"/><a data-primary="weekday() function" data-startref="weekdays" data-type="indexterm" id="idm45143400560512"/>alleges.</p>&#13;
<aside class="pagebreak-before less_space" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45143400559440">&#13;
<h5>What’s the __main__ Frame?</h5>&#13;
<p>If you’re <a contenteditable="false" data-primary="__main__" data-primary-sortas="main frame" data-type="indexterm" id="idm45143400557680"/>&#13;
wondering<a contenteditable="false" data-primary="Python" data-secondary="__main__" data-secondary-sortas="main frame" data-type="indexterm" id="idm45143400556144"/> about the <code>if</code> statement at callout 3 in the last snippet, the first thing to know is that it is <em>also</em> a Python convention and a programmatic shorthand for telling the computer “if this script is being run directly.” The principal objective of this protective <code>if</code> statement is to prevent unexpected behaviors if you import one Python script into another.<sup><a data-type="noteref" href="ch08.html#idm45143400593680" id="idm45143400593680-marker">8</a></sup> Another way to minimize the chances of code overlap or “crashing” is to group useful functions thematically and add them to descriptively named files (for example, <code>date_functions.py</code>), and then import these as needed. While the <code>if __name__ == "__main__":</code> statement will help keep things running smoothly (almost) no matter what, my experience has been that it is easier to keep track of your commonly used functions if you collect them in one (or a few) well-named places.</p>&#13;
</div></aside>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Metadata Without the Mess" data-type="sect2"><div class="sect2" id="idm45143400829728">&#13;
<h2>Metadata Without the Mess</h2>&#13;
&#13;
<p>In <a data-type="xref" href="ch07.html#xls_meta_and_date_parsing">Example 7-7</a>, we <a data-primary="refactoring code" data-secondary="metadata  parsing example" data-type="indexterm" id="refactoring-metadata"/><a data-primary="Python" data-secondary="functions" data-tertiary="metadata parsing refactoring example" data-type="indexterm" id="python-functions-metadata"/><a data-primary="functions" data-secondary="for refactoring" data-secondary-sortas="refactoring" data-tertiary="metadata parsing example" data-type="indexterm" id="functions-metadata"/><a data-primary="metadata" data-secondary="refactoring example" data-type="indexterm" id="metadata-refactor"/>built on code from Examples <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch04.html#xls_parsing">4-6</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch07.html#xls_meta_parsing">7-6</a> to create a single script that both effectively interpreted Microsoft Excel dates <em>and</em> split our source data file into a metadata text file and a structured <em>.csv</em>. While the resulting script did everything we needed, its code became leggy and hard to read, full of hard-to-interpret conditionals and obscure date-formatting function calls.</p>&#13;
&#13;
<p>Here we can clean things up a little bit by handling the formatting of the different types of row content (for the <em>.csv</em> or the <em>.txt</em> file, respectively) in separate functions. This requires rearranging (and clarifying) our script’s logic somewhat. It also illustrates some of the challenges that can arise when it comes to getting all the requisite information <em>into</em> our custom functions. The approach outlined in <a data-type="xref" href="#xls_meta_and_date_parsing_refactored">Example 8-8</a> illustrates my currently preferred way of handling these issues.</p>&#13;
<div data-type="example" id="xls_meta_and_date_parsing_refactored">&#13;
<h5><span class="label">Example 8-8. </span>xls_meta_and_date_parsing_refactored.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c1"># converting data in an .xls file with Python to csv + metadata file, with</code><code>&#13;
</code><code class="c1"># functional date values using the "xrld" library.</code><code>&#13;
</code><code class="c1"># first, pip install the xlrd library:</code><code>&#13;
</code><code class="c1"># https://pypi.org/project/xlrd/2.0.1/</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># then, import the `xlrd` library</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">xlrd</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># import the csv library</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">csv</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># needed to test if a given value is *some* type of number</code><code>&#13;
</code><code class="kn">from</code><code> </code><code class="nn">numbers</code><code> </code><code class="kn">import</code><code> </code><code class="n">Number</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># for parsing/formatting our newly interpreted Excel dates</code><code>&#13;
</code><code class="kn">from</code><code> </code><code class="nn">datetime</code><code> </code><code class="kn">import</code><code> </code><code class="n">datetime</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">main</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># use `open_workbook()` to load our data in the `source_workbook` variable</code><code>&#13;
</code><code>    </code><code class="n">source_workbook</code><code> </code><code class="o">=</code><code> </code><code class="n">xlrd</code><code class="o">.</code><code class="n">open_workbook</code><code class="p">(</code><code class="s2">"</code><code class="s2">fredgraph.xls</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">global</code><code> </code><code class="n">the_datemode</code><code> </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO2-1" id="co_structuring_and_refactoring_your_code_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">the_datemode</code><code> </code><code class="o">=</code><code> </code><code class="n">source_workbook</code><code class="o">.</code><code class="n">datemode</code><code> </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO2-1" id="co_structuring_and_refactoring_your_code_CO2-2"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># open and name a simple metadata text file</code><code>&#13;
</code><code>    </code><code class="n">source_workbook_metadata</code><code> </code><code class="o">=</code><code> </code><code class="nb">open</code><code class="p">(</code><code class="s2">"</code><code class="s2">fredgraph_metadata.txt</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">w</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># an `.xls` workbook can have multiple sheets</code><code>&#13;
</code><code>    </code><code class="k">for</code><code> </code><code class="n">sheet_name</code><code> </code><code class="ow">in</code><code> </code><code class="n">source_workbook</code><code class="o">.</code><code class="n">sheet_names</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># create a variable that points to the current worksheet</code><code>&#13;
</code><code>        </code><code class="n">current_sheet</code><code> </code><code class="o">=</code><code> </code><code class="n">source_workbook</code><code class="o">.</code><code class="n">sheet_by_name</code><code class="p">(</code><code class="n">sheet_name</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># create "xls_"+sheet_name+".csv" as current sheet's output file</code><code>&#13;
</code><code>        </code><code class="n">output_file</code><code> </code><code class="o">=</code><code> </code><code class="nb">open</code><code class="p">(</code><code class="s2">"</code><code class="s2">xls_</code><code class="s2">"</code><code class="o">+</code><code class="n">sheet_name</code><code class="o">+</code><code class="s2">"</code><code class="s2">_dates.csv</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">w</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># use the `writer()` recipe to write `.csv`-formatted rows</code><code>&#13;
</code><code>        </code><code class="n">output_writer</code><code> </code><code class="o">=</code><code> </code><code class="n">csv</code><code class="o">.</code><code class="n">writer</code><code class="p">(</code><code class="n">output_file</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># Boolean variable to detect if we've hit our table-type data yet</code><code>&#13;
</code><code>        </code><code class="n">is_table_data</code><code> </code><code class="o">=</code><code> </code><code class="bp">False</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># now, we need to loop through every row in our sheet</code><code>&#13;
</code><code>        </code><code class="k">for</code><code> </code><code class="n">row_num</code><code class="p">,</code><code> </code><code class="n">row</code><code> </code><code class="ow">in</code><code> </code><code class="nb">enumerate</code><code class="p">(</code><code class="n">current_sheet</code><code class="o">.</code><code class="n">get_rows</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="c1"># pulling out the value in the first column of the current row</code><code>&#13;
</code><code>            </code><code class="n">first_entry</code><code> </code><code class="o">=</code><code> </code><code class="n">current_sheet</code><code class="o">.</code><code class="n">row_values</code><code class="p">(</code><code class="n">row_num</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="c1"># if we've hit the header row of our data table</code><code>&#13;
</code><code>            </code><code class="k">if</code><code> </code><code class="n">first_entry</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">observation_date</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>                </code><code class="c1"># it's time to switch our "flag" value to "True"</code><code>&#13;
</code><code>                </code><code class="n">is_table_data</code><code> </code><code class="o">=</code><code> </code><code class="bp">True</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="c1"># if `is_table_data` is True</code><code>&#13;
</code><code>            </code><code class="k">if</code><code> </code><code class="n">is_table_data</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>                </code><code class="c1"># pass the requisite data to out `create_table_row()` function</code><code>&#13;
</code><code>                </code><code class="n">new_row</code><code> </code><code class="o">=</code><code> </code><code class="n">create_table_row</code><code class="p">(</code><code class="n">current_sheet</code><code class="p">,</code><code> </code><code class="n">row_num</code><code class="p">)</code><code> </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO2-2" id="co_structuring_and_refactoring_your_code_CO2-3"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>                </code><code class="c1"># write this new row to the data output file</code><code>&#13;
</code><code>                </code><code class="n">output_writer</code><code class="o">.</code><code class="n">writerow</code><code class="p">(</code><code class="n">new_row</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="c1"># otherwise, this row must be metadata</code><code>&#13;
</code><code>            </code><code class="k">else</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>                </code><code class="c1"># pass the requisite data to our `create_meta_text()` function</code><code>&#13;
</code><code>                </code><code class="n">metadata_line</code><code> </code><code class="o">=</code><code> </code><code class="n">create_meta_text</code><code class="p">(</code><code class="n">current_sheet</code><code class="p">,</code><code> </code><code class="n">row_num</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>                </code><code class="c1"># write this new row to the metadata output file</code><code>&#13;
</code><code>                </code><code class="n">source_workbook_metadata</code><code class="o">.</code><code class="n">write</code><code class="p">(</code><code class="n">metadata_line</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># just for good measure, let's close our output files</code><code>&#13;
</code><code>        </code><code class="n">output_file</code><code class="o">.</code><code class="n">close</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">source_workbook_metadata</code><code class="o">.</code><code class="n">close</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">create_table_row</code><code class="p">(</code><code class="n">the_sheet</code><code class="p">,</code><code> </code><code class="n">the_row_num</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># extract the table-type data values into separate variables</code><code>&#13;
</code><code>    </code><code class="n">the_date_num</code><code> </code><code class="o">=</code><code> </code><code class="n">the_sheet</code><code class="o">.</code><code class="n">row_values</code><code class="p">(</code><code class="n">the_row_num</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code>&#13;
</code><code>    </code><code class="n">U6_value</code><code> </code><code class="o">=</code><code> </code><code class="n">the_sheet</code><code class="o">.</code><code class="n">row_values</code><code class="p">(</code><code class="n">the_row_num</code><code class="p">)</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># create a new row object with each of the values</code><code>&#13;
</code><code>    </code><code class="n">new_row</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="n">the_date_num</code><code class="p">,</code><code> </code><code class="n">U6_value</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># if the `the_date_num` is a number, then the current row is *not*</code><code>&#13;
</code><code>    </code><code class="c1"># the header row. We need to transform the date.</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="nb">isinstance</code><code class="p">(</code><code class="n">the_date_num</code><code class="p">,</code><code> </code><code class="n">Number</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># use the xlrd library's `xldate_as_datetime()` to generate</code><code>&#13;
</code><code>        </code><code class="c1"># a Python datetime object</code><code>&#13;
</code><code>        </code><code class="n">the_date_num</code><code> </code><code class="o">=</code><code> </code><code class="n">xlrd</code><code class="o">.</code><code class="n">xldate</code><code class="o">.</code><code class="n">xldate_as_datetime</code><code class="p">(</code><code class="n">the_date_num</code><code class="p">,</code><code> </code><code class="n">the_datemode</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># create a new list containing `the_date_num` (formatted to MM/DD/YYYY</code><code>&#13;
</code><code>        </code><code class="c1"># using the `strftime()` recipe) and the value in the second column</code><code>&#13;
</code><code>        </code><code class="n">new_row</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="n">the_date_num</code><code class="o">.</code><code class="n">strftime</code><code class="p">(</code><code class="s1">'</code><code class="si">%m</code><code class="s1">/</code><code class="si">%d</code><code class="s1">/</code><code class="si">%Y</code><code class="s1">'</code><code class="p">)</code><code class="p">,</code><code class="n">U6_value</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># return the fully formatted row</code><code>&#13;
</code><code>    </code><code class="k">return</code><code class="p">(</code><code class="n">new_row</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">create_meta_text</code><code class="p">(</code><code class="n">the_sheet</code><code class="p">,</code><code> </code><code class="n">the_row_num</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">meta_line</code><code> </code><code class="o">=</code><code> </code><code class="s2">"</code><code class="s2">"</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># since we'd like our metadata file to be nicely formatted, we</code><code>&#13;
</code><code>    </code><code class="c1"># need to loop through the individual cells of each metadata row</code><code>&#13;
</code><code>    </code><code class="k">for</code><code> </code><code class="n">item</code><code> </code><code class="ow">in</code><code> </code><code class="n">the_sheet</code><code class="o">.</code><code class="n">row</code><code class="p">(</code><code class="n">the_row_num</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="c1"># write the value of the cell, followed by a tab character</code><code>&#13;
</code><code>            </code><code class="n">meta_line</code><code> </code><code class="o">=</code><code> </code><code class="n">meta_line</code><code> </code><code class="o">+</code><code> </code><code class="n">item</code><code class="o">.</code><code class="n">value</code><code> </code><code class="o">+</code><code> </code><code class="s1">'</code><code class="se">\t</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># at the end of each line of metadata, add a newline</code><code>&#13;
</code><code>    </code><code class="n">meta_line</code><code> </code><code class="o">=</code><code> </code><code class="n">meta_line</code><code class="o">+</code><code class="s1">'</code><code class="se">\n</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># return the fully formatted line</code><code>&#13;
</code><code>    </code><code class="k">return</code><code class="p">(</code><code class="n">meta_line</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">if</code><code> </code><code class="nv-Magic">__name__</code><code> </code><code class="o">==</code><code> </code><code class="s2">"</code><code class="s2">__main__</code><code class="s2">"</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">main</code><code class="p">(</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_structuring_and_refactoring_your_code_CO2-1" id="callout_structuring_and_refactoring_your_code_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Though they should be used sparingly, creating a <em>global</em> variable here called <code>the_datemode</code> means its value can be accessed by <em>any</em> function (the <code>global</code> here refers to its scope). Note that in Python, global variables cannot be assigned a value in the same line they are declared, which is why this has been done across two separate code statements.</p></dd>&#13;
<dt><a class="co" href="#co_structuring_and_refactoring_your_code_CO2-3" id="callout_structuring_and_refactoring_your_code_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>For example, if we <em>didn’t</em> create a global variable, for the date mode, we would have to pass it as another argument to <code>create_table_row()</code>, which feels a bit incongruous.</p></dd>&#13;
</dl>&#13;
&#13;
<p>If you compare <a data-type="xref" href="#xls_meta_and_date_parsing_refactored">Example 8-8</a> with <a data-type="xref" href="#weekday_rides_refactored">Example 8-7</a>, you’ll see they have several key features in common: instead of code that executes automatically, everything in this script has been compartmentalized into functions, with the conventional <code>main()</code> function call protected by an <code>if __name__ == "__main__":</code> conditional. This example also overlaps with <a data-type="xref" href="ch07.html#xls_meta_and_date_parsing">Example 7-7</a> almost perfectly: the includes are all the same, and while it has been rearranged into three functions instead of a single, linear script, most of the code is almost identical.</p>&#13;
&#13;
<p>Part of what I want to illustrate here is that refactoring your code doesn’t have to be an enormous undertaking, but the results are invaluable. As a program, the structure of <a data-type="xref" href="#xls_meta_and_date_parsing_refactored">Example 8-8</a> is now basically all logic and no particulars—fiddly details are handled by our new functions. If I suddenly needed to download and parse a new data series from the FRED database, I would feel comfortable just throwing it at this script to see what happens, because if there are problems, <em>I know exactly where to go to fix them</em>. Instead of having to wade through the entire program, any formatting issues that might arise with a new data source are almost certainly going to be the result of code in either <code>create_table_row()</code> or <code>create_meta_text()</code>—and even then, problems will probably only appear in one or the other. That means that in order to adapt this script to work with new (similar) data sources, I’ll probably only have to look at (maybe) a dozen lines of code. That’s certainly better than wading through close to 100!</p>&#13;
&#13;
<p>In other words, while refactoring your data wrangling scripts usually doesn’t mean <em>writing</em> too much more code, it can really save you from <em>reading</em> more than you need to when you want to use, reuse, or adapt it later—and that’s yet another way that Python can help you scale your data wrangling work.</p>&#13;
<aside class="pagebreak-before less_space" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="going_global">&#13;
<h5>Going Global?</h5>&#13;
<p>In Python, global variables<a data-primary="Python" data-secondary="variables" data-tertiary="global" data-type="indexterm" id="idm45143399328880"/><a data-primary="variables" data-secondary="global" data-type="indexterm" id="idm45143399327664"/><a data-primary="global variables" data-type="indexterm" id="idm45143399326720"/> like the one used in <a data-type="xref" href="#xls_meta_and_date_parsing_refactored">Example 8-8</a> differ from typical variables in two ways:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Using the <em>global</em> keyword indicates that this variable can be accessed—and modified—from inside <em>any</em> function in our program (that is, its <em>scope</em> is “global”).</p>&#13;
</li>&#13;
<li>&#13;
<p>A global variable (like <code>the_datemode</code>) cannot be declared and assigned a value in the same code statement the way we do with most variables (e.g., <code>is_table_data = False</code>). Instead, we have to declare it with the <em>global</em> keyword on one line and assign a value to it on a subsequent line.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>Right now you might be thinking, “Hey, this <em>global</em> keyword is handy. Why don’t I just make <em>all</em> my variables global?” Even though global variables can be quite useful at times, they should always be used cautiously—even as a last resort.</p>&#13;
&#13;
<p>True, adding global variables to our code may help minimize how much you have to re<em>write</em> your code in order to re<em>factor</em> it. At the same time, the drawbacks of using lots of global variables can quickly overtake the advantages of refactoring in the first place—most especially the ability to reuse variable names across functions and scripts. As you write code over time, you’ll almost certainly start to develop your own conventions for naming variables, along with your collection of commonly used functions. But if one of your scripts contains a global variable that <em>shares</em> a name with a variable used by an included function, you’ll start to get strange and inexplicable behavior from your code. This kind of overlap can lead to the bug hunt of your life, because you’ll have to go through your code line by line in order to uncover the mix-up. In other words, use global variables <em>extremely</em> sparingly—and not at all if you can avoid it!</p>&#13;
</div></aside>&#13;
&#13;
<p>Given all the reasons <em>not</em> to use global variables, why did I ultimately decide to use one here? First, there is only <em>one</em> possible value for <code>source_workbook.datemode</code>, because there is only one <code>datemode</code> attribute per Excel spreadsheet. So even if a particular workbook had 20 different sheets each containing 100 columns of data, there would still only be one, single, unchanging value for <code>datemode</code> for all of them. So conceptually, the value of <code>datemode</code> is actually “global”; it’s reasonable that the variable we use to store this value would be as well. And since the value of <code>datemode</code> will never need to be updated within the script, there is less risk of retrieving an unexpected value from it.</p>&#13;
&#13;
<p>As with all writing, however, these choices are partly a matter of taste—and even our own taste can change over time. While at first I liked the symmetry of creating one function to “build” each row of table data and another function to “build” each line of metadata text, there’s also something to be said for breaking that symmetry and avoiding the use of the global <code>datemode</code> variable altogether, as shown in <a data-type="xref" href="#xls_meta_and_date_parsing_refactored_again">Example 8-9</a>.</p>&#13;
<div data-type="example" id="xls_meta_and_date_parsing_refactored_again">&#13;
<h5><span class="label">Example 8-9. </span>xls_meta_and_date_parsing_refactored_again.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c1"># converting data in an .xls file with Python to csv + metadata file, with</code><code>&#13;
</code><code class="c1"># functional date values using the "xrld" library.</code><code>&#13;
</code><code class="c1"># first, pip install the xlrd library:</code><code>&#13;
</code><code class="c1"># https://pypi.org/project/xlrd/2.0.1/</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># then, import the `xlrd` library</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">xlrd</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># import the csv library</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">csv</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># needed to test if a given value is *some* type of number</code><code>&#13;
</code><code class="kn">from</code><code> </code><code class="nn">numbers</code><code> </code><code class="kn">import</code><code> </code><code class="n">Number</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># for parsing/formatting our newly interpreted Excel dates</code><code>&#13;
</code><code class="kn">from</code><code> </code><code class="nn">datetime</code><code> </code><code class="kn">import</code><code> </code><code class="n">datetime</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">main</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># use `open_workbook()` to load our data in the `source_workbook` variable</code><code>&#13;
</code><code>    </code><code class="n">source_workbook</code><code> </code><code class="o">=</code><code> </code><code class="n">xlrd</code><code class="o">.</code><code class="n">open_workbook</code><code class="p">(</code><code class="s2">"</code><code class="s2">fredgraph.xls</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># open and name a simple metadata text file</code><code>&#13;
</code><code>    </code><code class="n">source_workbook_metadata</code><code> </code><code class="o">=</code><code> </code><code class="nb">open</code><code class="p">(</code><code class="s2">"</code><code class="s2">fredgraph_metadata.txt</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">w</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># an `.xls` workbook can have multiple sheets</code><code>&#13;
</code><code>    </code><code class="k">for</code><code> </code><code class="n">sheet_name</code><code> </code><code class="ow">in</code><code> </code><code class="n">source_workbook</code><code class="o">.</code><code class="n">sheet_names</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># create a variable that points to the current worksheet</code><code>&#13;
</code><code>        </code><code class="n">current_sheet</code><code> </code><code class="o">=</code><code> </code><code class="n">source_workbook</code><code class="o">.</code><code class="n">sheet_by_name</code><code class="p">(</code><code class="n">sheet_name</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># create "xls_"+sheet_name+".csv" as the current sheet's output file</code><code>&#13;
</code><code>        </code><code class="n">output_file</code><code> </code><code class="o">=</code><code> </code><code class="nb">open</code><code class="p">(</code><code class="s2">"</code><code class="s2">xls_</code><code class="s2">"</code><code class="o">+</code><code class="n">sheet_name</code><code class="o">+</code><code class="s2">"</code><code class="s2">_dates.csv</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">w</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># use the `writer()` recipe to write `.csv`-formatted rows</code><code>&#13;
</code><code>        </code><code class="n">output_writer</code><code> </code><code class="o">=</code><code> </code><code class="n">csv</code><code class="o">.</code><code class="n">writer</code><code class="p">(</code><code class="n">output_file</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># Boolean variable to detect if we've hit our table-type data yet</code><code>&#13;
</code><code>        </code><code class="n">is_table_data</code><code> </code><code class="o">=</code><code> </code><code class="bp">False</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># now, we need to loop through every row in our sheet</code><code>&#13;
</code><code>        </code><code class="k">for</code><code> </code><code class="n">row_num</code><code class="p">,</code><code> </code><code class="n">row</code><code> </code><code class="ow">in</code><code> </code><code class="nb">enumerate</code><code class="p">(</code><code class="n">current_sheet</code><code class="o">.</code><code class="n">get_rows</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="c1"># pulling out the value in the first column of the current row</code><code>&#13;
</code><code>            </code><code class="n">first_entry</code><code> </code><code class="o">=</code><code> </code><code class="n">current_sheet</code><code class="o">.</code><code class="n">row_values</code><code class="p">(</code><code class="n">row_num</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="c1"># if we've hit the header row of our data table</code><code>&#13;
</code><code>            </code><code class="k">if</code><code> </code><code class="n">first_entry</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">observation_date</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>                </code><code class="c1"># it's time to switch our "flag" value to "True"</code><code>&#13;
</code><code>                </code><code class="n">is_table_data</code><code> </code><code class="o">=</code><code> </code><code class="bp">True</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="c1"># if `is_table_data` is True</code><code>&#13;
</code><code>            </code><code class="k">if</code><code> </code><code class="n">is_table_data</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>                </code><code class="c1"># extract the table-type data values into separate variables</code><code>&#13;
</code><code>                </code><code class="n">the_date_num</code><code> </code><code class="o">=</code><code> </code><code class="n">current_sheet</code><code class="o">.</code><code class="n">row_values</code><code class="p">(</code><code class="n">row_num</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code>&#13;
</code><code>                </code><code class="n">U6_value</code><code> </code><code class="o">=</code><code> </code><code class="n">current_sheet</code><code class="o">.</code><code class="n">row_values</code><code class="p">(</code><code class="n">row_num</code><code class="p">)</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>                </code><code class="c1"># if the value is a number, then the current row is *not*</code><code>&#13;
</code><code>                </code><code class="c1"># the header row, so transform the date</code><code>&#13;
</code><code>                </code><code class="k">if</code><code> </code><code class="nb">isinstance</code><code class="p">(</code><code class="n">the_date_num</code><code class="p">,</code><code> </code><code class="n">Number</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO3-1" id="co_structuring_and_refactoring_your_code_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>                    </code><code class="n">the_date_num</code><code> </code><code class="o">=</code><code> </code><code class="n">format_excel_date</code><code class="p">(</code><code class="n">the_date_num</code><code class="p">,</code><code>&#13;
</code><code>                                                     </code><code class="n">source_workbook</code><code class="o">.</code><code class="n">datemode</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>                </code><code class="c1"># write this new row to the data output file</code><code>&#13;
</code><code>                </code><code class="n">output_writer</code><code class="o">.</code><code class="n">writerow</code><code class="p">(</code><code class="p">[</code><code class="n">the_date_num</code><code class="p">,</code><code> </code><code class="n">U6_value</code><code class="p">]</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="c1"># otherwise, this row must be metadata</code><code>&#13;
</code><code>            </code><code class="k">else</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>                </code><code class="c1"># pass the requisite data to our `create_meta_text()` function</code><code>&#13;
</code><code>                </code><code class="n">metadata_line</code><code> </code><code class="o">=</code><code> </code><code class="n">create_meta_text</code><code class="p">(</code><code class="n">current_sheet</code><code class="p">,</code><code> </code><code class="n">row_num</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>                </code><code class="c1"># write this new row to the metadata output file</code><code>&#13;
</code><code>                </code><code class="n">source_workbook_metadata</code><code class="o">.</code><code class="n">write</code><code class="p">(</code><code class="n">metadata_line</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># just for good measure, let's close our output files</code><code>&#13;
</code><code>        </code><code class="n">output_file</code><code class="o">.</code><code class="n">close</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">source_workbook_metadata</code><code class="o">.</code><code class="n">close</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">format_excel_date</code><code class="p">(</code><code class="n">a_date_num</code><code class="p">,</code><code> </code><code class="n">the_datemode</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># use the xlrd library's `xldate_as_datetime()` to generate</code><code>&#13;
</code><code>    </code><code class="c1"># a Python datetime object</code><code>&#13;
</code><code>    </code><code class="n">a_date_num</code><code> </code><code class="o">=</code><code> </code><code class="n">xlrd</code><code class="o">.</code><code class="n">xldate</code><code class="o">.</code><code class="n">xldate_as_datetime</code><code class="p">(</code><code class="n">a_date_num</code><code class="p">,</code><code> </code><code class="n">the_datemode</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># create a new list containing the_date_num (formatted to MM/DD/YYYY</code><code>&#13;
</code><code>    </code><code class="c1"># using the `strftime()` recipe) and the value in the second column</code><code>&#13;
</code><code>    </code><code class="n">formatted_date</code><code> </code><code class="o">=</code><code> </code><code class="n">a_date_num</code><code class="o">.</code><code class="n">strftime</code><code class="p">(</code><code class="s1">'</code><code class="si">%m</code><code class="s1">/</code><code class="si">%d</code><code class="s1">/</code><code class="si">%Y</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">return</code><code class="p">(</code><code class="n">formatted_date</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">create_meta_text</code><code class="p">(</code><code class="n">the_sheet</code><code class="p">,</code><code> </code><code class="n">the_row_num</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">meta_line</code><code> </code><code class="o">=</code><code> </code><code class="s2">"</code><code class="s2">"</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># since we'd like our metadata file to be nicely formatted, we</code><code>&#13;
</code><code>    </code><code class="c1"># need to loop through the individual cells of each metadata row</code><code>&#13;
</code><code>    </code><code class="k">for</code><code> </code><code class="n">item</code><code> </code><code class="ow">in</code><code> </code><code class="n">the_sheet</code><code class="o">.</code><code class="n">row</code><code class="p">(</code><code class="n">the_row_num</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="c1"># write the value of the cell, followed by a tab character</code><code>&#13;
</code><code>            </code><code class="n">meta_line</code><code> </code><code class="o">=</code><code> </code><code class="n">meta_line</code><code> </code><code class="o">+</code><code> </code><code class="n">item</code><code class="o">.</code><code class="n">value</code><code> </code><code class="o">+</code><code> </code><code class="s1">'</code><code class="se">\t</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># at the end of each line of metadata, add a newline</code><code>&#13;
</code><code>    </code><code class="n">meta_line</code><code> </code><code class="o">=</code><code> </code><code class="n">meta_line</code><code class="o">+</code><code class="s1">'</code><code class="se">\n</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">return</code><code class="p">(</code><code class="n">meta_line</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="k">if</code><code> </code><code class="nv-Magic">__name__</code><code> </code><code class="o">==</code><code> </code><code class="s2">"</code><code class="s2">__main__</code><code class="s2">"</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">main</code><code class="p">(</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_structuring_and_refactoring_your_code_CO3-1" id="callout_structuring_and_refactoring_your_code_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Although I no longer pass parallel information to a custom function in order to generate the table-type and metadata output files, abandoning that symmetry prevents my having to create a global variable.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Which of these is the better solution? As with all writing, it depends on your preferences, your use cases, and your <em>audience</em>. Some groups or institutions will be “opinionated” about the choice to use—or avoid—global variables; some will feel that shorter solutions are preferable, while others will prize structural symmetry, or reusability. While <a data-type="xref" href="#xls_meta_and_date_parsing_refactored_again">Example 8-9</a> sacrifices some structural symmetry, it <em>generates</em> a function that may be more broadly reusable. The choice of which is more important is, as always, up to you to <a data-primary="refactoring code" data-secondary="metadata  parsing example" data-startref="refactoring-metadata" data-type="indexterm" id="idm45143399925072"/><a data-primary="Python" data-secondary="functions" data-startref="python-functions-metadata" data-tertiary="metadata parsing refactoring example" data-type="indexterm" id="idm45143399923808"/><a data-primary="functions" data-secondary="for refactoring" data-secondary-sortas="refactoring" data-startref="functions-metadata" data-tertiary="metadata parsing example" data-type="indexterm" id="idm45143398686976"/><a data-primary="metadata" data-secondary="refactoring example" data-startref="metadata-refactor" data-type="indexterm" id="idm45143398685200"/>determine.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Documenting Your Custom Scripts and &#10;Functions with pydoc" data-type="sect1"><div class="sect1" id="documenting_custom_functions">&#13;
<h1>Documenting Your Custom Scripts and &#13;
<span class="keep-together">Functions with pydoc</span></h1>&#13;
&#13;
<p>Up until <a data-primary="Python" data-secondary="functions" data-tertiary="documentation" data-type="indexterm" id="python-functions-documentation"/><a data-primary="functions" data-secondary="user-defined" data-tertiary="documentation" data-type="indexterm" id="functions-user-defined-document"/><a data-primary="user-defined functions" data-secondary="documentation" data-type="indexterm" id="user-defined-functions-document"/><a data-primary="documentation" data-secondary="with pydoc" data-secondary-sortas="pydoc" data-type="indexterm" id="documentation-pydoc"/><a data-primary="pydoc" data-type="indexterm" id="pydoc"/>now, we’ve taken a thorough but free-form approach to documenting our code. There’s nothing wrong with this in principle, especially if it helps ensure you actually <em>do</em> the documentation in the first place. As your inventory of Python scripts (and their potential audience) expands, however, it is useful to be able to review your personal collection of custom functions without individually opening up and reading through each and every Python file. If nothing else, having lots of files open makes it that much more likely that a stray keystroke will introduce an error into a function you rely on in lots of other scripts—which is a really quick way to ruin your day.</p>&#13;
&#13;
<p>Fortunately, with just a little bit of formatting we can adapt our existing program descriptions and comments to work with a command-line function called <code>pydoc</code>. This will let us print out our script and function descriptions to the command line just by providing the relevant filename.</p>&#13;
&#13;
<p>To see this in action, let’s start by refactoring one more script. In this case, we’ll revise <a data-type="xref" href="ch07.html#fixed_width_strip_parsing">Example 7-8</a> to make it a little bit more concise. In the process, I’ll also update the comments at the top of the script (and add some to our new function) to make them compatible with the <code>pydoc</code> command. You can see what this looks like in <a data-type="xref" href="#fixed_width_string_parsing_refactored">Example 8-10</a>.</p>&#13;
<div data-type="example" id="fixed_width_string_parsing_refactored">&#13;
<h5><span class="label">Example 8-10. </span>fixed_width_strip_parsing_refactored.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="sd">""" NOAA data formatter </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO4-1" id="co_structuring_and_refactoring_your_code_CO4-1"><img alt="1" src="assets/1.png"/></a><code class="sd">&#13;
Reads data from an NOAA fixed-width data file with Python and outputs&#13;
a well-formatted CSV file.&#13;
&#13;
The source file for this example comes from the NOAA and can be accessed here:&#13;
https://www1.ncdc.noaa.gov/pub/data/ghcn/daily/ghcnd-stations.txt&#13;
&#13;
The metadata for the file can be found here:&#13;
https://www1.ncdc.noaa.gov/pub/data/ghcn/daily/readme.txt&#13;
&#13;
Available functions&#13;
-------------------&#13;
* convert_to_columns: Converts a line of text to a list&#13;
&#13;
Requirements&#13;
------------&#13;
* csv module&#13;
&#13;
"""</code><code>&#13;
</code><code class="c1"># we'll start by importing the "csv" library</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">csv</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">main</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="c1"># variable to match our output filename to the input filename</code><code>&#13;
</code><code>    </code><code class="n">filename</code><code> </code><code class="o">=</code><code> </code><code class="s2">"</code><code class="s2">ghcnd-stations</code><code class="s2">"</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># we'll just open the file in read format ("r") as usual</code><code>&#13;
</code><code>    </code><code class="n">source_file</code><code> </code><code class="o">=</code><code> </code><code class="nb">open</code><code class="p">(</code><code class="n">filename</code><code class="o">+</code><code class="s2">"</code><code class="s2">.txt</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="s2">"</code><code class="s2">r</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># the "readlines()" method converts a text file to a list of lines</code><code>&#13;
</code><code>    </code><code class="n">stations_list</code><code> </code><code class="o">=</code><code> </code><code class="n">source_file</code><code class="o">.</code><code class="n">readlines</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># as usual, we'll create an output file to write to</code><code>&#13;
</code><code>    </code><code class="n">output_file</code><code> </code><code class="o">=</code><code> </code><code class="nb">open</code><code class="p">(</code><code class="n">filename</code><code class="o">+</code><code class="s2">"</code><code class="s2">.csv</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">w</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># and we'll use the `csv` library to create a "writer" that gives us handy</code><code>&#13;
</code><code>    </code><code class="c1"># "recipe" functions for creating our new file in csv format</code><code>&#13;
</code><code>    </code><code class="n">output_writer</code><code> </code><code class="o">=</code><code> </code><code class="n">csv</code><code class="o">.</code><code class="n">writer</code><code class="p">(</code><code class="n">output_file</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># we have to "hard code" these headers using the contents of `readme.txt`</code><code>&#13;
</code><code>    </code><code class="n">headers</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s2">"</code><code class="s2">ID</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">LATITUDE</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">LONGITUDE</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">ELEVATION</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">STATE</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">NAME</code><code class="s2">"</code><code class="p">,</code><code>&#13;
</code><code>               </code><code class="s2">"</code><code class="s2">GSN_FLAG</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">HCNCRN_FLAG</code><code class="s2">"</code><code class="p">,</code><code class="s2">"</code><code class="s2">WMO_ID</code><code class="s2">"</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># create a list of `tuple`s with each column's start and end index</code><code>&#13;
</code><code>    </code><code class="n">column_ranges</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code class="mi">11</code><code class="p">)</code><code class="p">,</code><code class="p">(</code><code class="mi">13</code><code class="p">,</code><code class="mi">20</code><code class="p">)</code><code class="p">,</code><code class="p">(</code><code class="mi">22</code><code class="p">,</code><code class="mi">30</code><code class="p">)</code><code class="p">,</code><code class="p">(</code><code class="mi">32</code><code class="p">,</code><code class="mi">37</code><code class="p">)</code><code class="p">,</code><code class="p">(</code><code class="mi">39</code><code class="p">,</code><code class="mi">40</code><code class="p">)</code><code class="p">,</code><code class="p">(</code><code class="mi">42</code><code class="p">,</code><code class="mi">71</code><code class="p">)</code><code class="p">,</code><code class="p">(</code><code class="mi">73</code><code class="p">,</code><code class="mi">75</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>                     </code><code class="p">(</code><code class="mi">77</code><code class="p">,</code><code class="mi">79</code><code class="p">)</code><code class="p">,</code><code class="p">(</code><code class="mi">81</code><code class="p">,</code><code class="mi">85</code><code class="p">)</code><code class="p">]</code><code> </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO4-2" id="co_structuring_and_refactoring_your_code_CO4-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># write our headers to the output file</code><code>&#13;
</code><code>    </code><code class="n">output_writer</code><code class="o">.</code><code class="n">writerow</code><code class="p">(</code><code class="n">headers</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># loop through each line of our file</code><code>&#13;
</code><code>    </code><code class="k">for</code><code> </code><code class="n">line</code><code> </code><code class="ow">in</code><code> </code><code class="n">stations_list</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># send our data to be formatted</code><code>&#13;
</code><code>        </code><code class="n">new_row</code><code> </code><code class="o">=</code><code> </code><code class="n">convert_to_columns</code><code class="p">(</code><code class="n">line</code><code class="p">,</code><code> </code><code class="n">column_ranges</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># use the `writerow` function to write new_row to our output file</code><code>&#13;
</code><code>        </code><code class="n">output_writer</code><code class="o">.</code><code class="n">writerow</code><code class="p">(</code><code class="n">new_row</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># for good measure, close our output file</code><code>&#13;
</code><code>    </code><code class="n">output_file</code><code class="o">.</code><code class="n">close</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="k">def</code><code> </code><code class="nf">convert_to_columns</code><code class="p">(</code><code class="n">data_line</code><code class="p">,</code><code> </code><code class="n">column_info</code><code class="p">,</code><code> </code><code class="n">zero_index</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO4-3" id="co_structuring_and_refactoring_your_code_CO4-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="sd">"""Converts a line of text to a list based on the index pairs provided&#13;
&#13;
    Parameters&#13;
    ----------&#13;
    data_line : str&#13;
        The line of text to be parsed&#13;
    column_info : list of tuples&#13;
        Each tuple provides the start and end index of a data column&#13;
    zero_index: boolean, optional&#13;
        If False (default), reduces starting index position by one&#13;
&#13;
    Returns&#13;
    -------&#13;
    list&#13;
        a list of data values, stripped of surrounding whitespace&#13;
    """</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">new_row</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># function assumes that provided indices are *NOT* zero-indexed,</code><code>&#13;
</code><code>    </code><code class="c1"># so reduce starting index values by 1</code><code>&#13;
</code><code>    </code><code class="n">index_offset</code><code> </code><code class="o">=</code><code> </code><code class="mi">1</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># if column_info IS zero-indexed, don't offset starting index values</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="n">zero_index</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="n">index_offset</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># go through list of column indices</code><code>&#13;
</code><code>    </code><code class="k">for</code><code> </code><code class="n">index_pair</code><code> </code><code class="ow">in</code><code> </code><code class="n">column_info</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># pull start value, modifying by `index_offset`</code><code>&#13;
</code><code>        </code><code class="n">start_index</code><code> </code><code class="o">=</code><code> </code><code class="n">index_pair</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">-</code><code class="n">index_offset</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># pull end value</code><code>&#13;
</code><code>        </code><code class="n">end_index</code><code> </code><code class="o">=</code><code> </code><code class="n">index_pair</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1"># strip whitespace from around the data</code><code>&#13;
</code><code>        </code><code class="n">new_row</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="p">(</code><code class="n">data_line</code><code class="p">[</code><code class="n">start_index</code><code class="p">:</code><code class="n">end_index</code><code class="p">]</code><code class="p">)</code><code class="o">.</code><code class="n">strip</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1"># return stripped data</code><code>&#13;
</code><code>    </code><code class="k">return</code><code> </code><code class="n">new_row</code><code>&#13;
</code><code>&#13;
</code><code class="k">if</code><code> </code><code class="nv-Magic">__name__</code><code> </code><code class="o">==</code><code> </code><code class="s2">"</code><code class="s2">__main__</code><code class="s2">"</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="n">main</code><code class="p">(</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_structuring_and_refactoring_your_code_CO4-1" id="callout_structuring_and_refactoring_your_code_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>By starting and ending the file and the <code>convert_to_columns()</code> function descriptions with a set of three double quotation marks (<code>"""</code>), they visually stand from the rest of the comments in the file and will now be accessible to <code>pydoc</code> by running the following in a terminal:<sup><a data-type="noteref" href="ch08.html#idm45143398618416" id="idm45143398618416-marker">9</a></sup></p>&#13;
&#13;
<pre data-type="programlisting">pydoc fixed_width_strip_parsing_refactored</pre>&#13;
&#13;
<p>This will display all of the file and function descriptions within the command-line interface (use the arrow keys to scroll up and down, or the space bar to move an entire “page” down at once). To exit the documentation and return to the command line, just hit the q key.</p></dd>&#13;
<dt><a class="co" href="#co_structuring_and_refactoring_your_code_CO4-2" id="callout_structuring_and_refactoring_your_code_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Instead of writing a unique line of code to pull each column of data out of a given line of text, I’ve put all the start/end values for each column into a list of <a href="http://docs.python.org/3.3/library/stdtypes.html?highlight=tuple#tuples">Python <code>tuple</code>s</a>, which are essentially unchangeable lists.</p></dd>&#13;
<dt><a class="co" href="#co_structuring_and_refactoring_your_code_CO4-3" id="callout_structuring_and_refactoring_your_code_CO4-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>By passing the column start/end information to the <code>convert_to_columns()</code> function along with each line of data, we can use a <code>for...in</code> loop to convert the text to columns. This makes our main script easier to read <em>and</em> results in a function that could be reused with <em>any</em> line of text we need to split into columns, as long as we pass in the start/end index pairs in the correct format. I’ve even added a flag value called <code>zero_index</code>, which lets us use this function with start/end pairs that consider zero to be the first position (the default value assumes—as this dataset does—that the first position is “1”).</p></dd>&#13;
</dl>&#13;
&#13;
<p>Note that in addition to viewing the documentation for the whole file, it is possible to use <code>pydoc</code> to view the documentation for a single function (for example, the <code>convert_to_columns()</code> function) by running:</p>&#13;
<pre>pydoc fixed_width_strip_parsing_refactored.convert_to_columns</pre>&#13;
&#13;
<p>and moving through/exiting its documentation in the same way as you did <a data-primary="Python" data-secondary="functions" data-startref="python-functions-documentation" data-tertiary="documentation" data-type="indexterm" id="idm45143398614320"/><a data-primary="functions" data-secondary="user-defined" data-startref="functions-user-defined-document" data-tertiary="documentation" data-type="indexterm" id="idm45143398612832"/><a data-primary="user-defined functions" data-secondary="documentation" data-startref="user-defined-functions-document" data-type="indexterm" id="idm45143398611376"/><a data-primary="documentation" data-secondary="with pydoc" data-secondary-sortas="pydoc" data-startref="documentation-pydoc" data-type="indexterm" id="idm45143398501488"/><a data-primary="pydoc" data-startref="pydoc" data-type="indexterm" id="idm45143398500000"/>for the entire file.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45143398498800">&#13;
<h5>Navigating Documentation in the Command Line</h5>&#13;
<p>Generically, you <a data-primary="documentation" data-secondary="navigating via command line" data-type="indexterm" id="idm45143400044112"/><a data-primary="command line" data-secondary="navigating documentation" data-type="indexterm" id="idm45143400043136"/>can view the documentation of any Python script (if its description has been properly formatted) using the command:</p>&#13;
<pre>pydoc __filename_without_.py_extension__</pre>&#13;
&#13;
<p>Likewise, you can access the documentation of any function in a script using:</p>&#13;
<pre>pydoc __filename_without_.py_extension__.__function_name__</pre>&#13;
&#13;
<p>And since you can’t use your mouse to get around these files, the following keyboard shortcuts will be especially helpful:</p>&#13;
<dl>&#13;
<dt>arrow up/arrow down</dt>&#13;
<dd>&#13;
<p>Move one line up/down</p>&#13;
</dd>&#13;
<dt>spacebar</dt>&#13;
<dd>&#13;
<p>Move one entire page down</p>&#13;
</dd>&#13;
<dt>q</dt>&#13;
<dd>&#13;
<p>Quit/exit documentation</p>&#13;
</dd>&#13;
</dl>&#13;
</div></aside>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Case for Command-Line Arguments" data-type="sect1"><div class="sect1" id="command_line_args">&#13;
<h1>The Case for Command-Line Arguments</h1>&#13;
&#13;
<p>Refactoring <a data-primary="refactoring code" data-secondary="with command-line arguments" data-secondary-sortas="command-line arguments" data-type="indexterm" id="refactoring-command-line"/><a data-primary="command-line arguments, refactoring with" data-type="indexterm" id="command-line-args-refactor"/><a data-primary="arguments" data-secondary="command-line" data-type="indexterm" id="args-command-line"/><a data-primary="Python" data-secondary="functions" data-tertiary="command-line arguments" data-type="indexterm" id="python-functions-command-line"/><a data-primary="functions" data-secondary="user-defined" data-tertiary="command-line arguments" data-type="indexterm" id="functions-user-defined-args"/><a data-primary="user-defined functions" data-secondary="command-line arguments" data-type="indexterm" id="user-defined-functions-args-command"/>one long script into a series of functions isn’t the only way we can make our data wrangling code more reusable. For multistep data wrangling processes (such as those that involve downloading data, like <a data-type="xref" href="ch05.html#downloading_turnstile_index">Example 5-8</a>, or converting PDF images to text, like <a data-type="xref" href="ch04.html#pdf_parsing">Example 4-16</a>), breaking up our <em>code</em> into multiple scripts is yet another way to save time and effort. For one thing, this approach lets us minimize how often we do resource-intensive tasks, like downloading data or actually converting PDF pages to images. Even more, these tasks tend to be pretty rote—it doesn’t make much difference <em>what</em> data we’re downloading or <em>which</em> PDF we’re converting to images; our script will pretty much always be doing the same thing. As a result, all we need are a few additional tricks to transform our currently bespoke data wrangling scripts into standalone code that we can reuse as is—over and over again.</p>&#13;
&#13;
<p>As an example, let’s look back at <a data-type="xref" href="ch05.html#downloading_turnstile_index">Example 5-8</a>. In this script, the main thing we’re doing is downloading the contents of a web page; it’s just that in this instance we’ve “hard-coded” the <a href="http://web.mta.info/developers/turnstile.html">target file</a> specifically. Likewise, the code that downloaded the XML and JSON files in <a data-type="xref" href="ch05.html#data_download">Example 5-1</a> was almost identical—the only real difference was the source URLs and the filenames of the local copies. If there was a way that we could refactor these scripts so that the <em>whole thing</em> acted more like a function, that could potentially save us a lot of time and effort in the long run.</p>&#13;
&#13;
<p>Fortunately, this is very achievable with standalone Python files, thanks to the built-in <em>argparse</em> Python library, <a data-primary="argparse library" data-type="indexterm" id="idm45143398476992"/>which lets us write our scripts to both require—and use—arguments passed in from the command line. Thanks to <em>argparse</em>, we don’t need to write a new script for every individual web page we want to download, because it lets us specify both the target URL <em>and</em> the name of our output file right from the command line, as shown in <a data-type="xref" href="#webpage_saver">Example 8-11</a>.</p>&#13;
<div data-type="example" id="webpage_saver">&#13;
<h5><span class="label">Example 8-11. </span>webpage_saver.py</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="sd">""" Web page Saver!&#13;
&#13;
Downloads the contents of a web page and saves it locally&#13;
&#13;
Usage&#13;
-----&#13;
python webpage_saver.py target_url filename&#13;
&#13;
&#13;
Parameters&#13;
----------&#13;
target_url : str&#13;
    The full URL of the web page to be downloaded&#13;
filename : str&#13;
    The desired filename of the local copy&#13;
&#13;
Requirements&#13;
------------&#13;
* argparse module&#13;
* requests module&#13;
&#13;
&#13;
"""</code><code>&#13;
</code><code class="c1"># include the requests library in order to get data from the web</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">requests</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># include argparse library to pull arguments from the command line</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">argparse</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># create a new `ArgumentParser()`</code><code>&#13;
</code><code class="n">parser</code><code> </code><code class="o">=</code><code> </code><code class="n">argparse</code><code class="o">.</code><code class="n">ArgumentParser</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># arguments will be assigned based on the order in which they were provided</code><code>&#13;
</code><code class="n">parser</code><code class="o">.</code><code class="n">add_argument</code><code class="p">(</code><code class="s2">"</code><code class="s2">target_url</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="n">help</code><code class="o">=</code><code class="s2">"</code><code class="s2">Full URL of web page to be downloaded</code><code class="s2">"</code><code class="p">)</code><code> </code><a class="co" href="#callout_structuring_and_refactoring_your_code_CO5-1" id="co_structuring_and_refactoring_your_code_CO5-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="n">parser</code><code class="o">.</code><code class="n">add_argument</code><code class="p">(</code><code class="s2">"</code><code class="s2">filename</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="n">help</code><code class="o">=</code><code class="s2">"</code><code class="s2">The desired filename of the local copy</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code class="n">args</code><code> </code><code class="o">=</code><code> </code><code class="n">parser</code><code class="o">.</code><code class="n">parse_args</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># pull the url of the web page we're downloading from the provided arguments</code><code>&#13;
</code><code class="n">target_url</code><code> </code><code class="o">=</code><code> </code><code class="n">args</code><code class="o">.</code><code class="n">target_url</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># pull the intended output filename from the provided arguments</code><code>&#13;
</code><code class="n">output_filename</code><code> </code><code class="o">=</code><code> </code><code class="n">args</code><code class="o">.</code><code class="n">filename</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># create appropriate header information for our web page request</code><code>&#13;
</code><code class="n">headers</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code>&#13;
</code><code>    </code><code class="s1">'</code><code class="s1">User-Agent</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">Mozilla/5.0 (X11; CrOS x86_64 13597.66.0) </code><code class="s1">'</code><code> </code><code class="o">+</code><code> </code><code>\&#13;
</code><code>                  </code><code class="s1">'</code><code class="s1">AppleWebKit/537.36 (KHTML, like Gecko) </code><code class="s1">'</code><code> </code><code class="o">+</code><code> </code><code>\&#13;
</code><code>                  </code><code class="s1">'</code><code class="s1">Chrome/88.0.4324.109 Safari/537.36</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>    </code><code class="s1">'</code><code class="s1">From</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">YOUR NAME HERE - youremailaddress@emailprovider.som</code><code class="s1">'</code><code>&#13;
</code><code class="p">}</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># because we're just loading a regular web page, we send a `get` request to the</code><code>&#13;
</code><code class="c1"># URL, along with our informational headers</code><code>&#13;
</code><code class="n">webpage</code><code> </code><code class="o">=</code><code> </code><code class="n">requests</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="n">target_url</code><code class="p">,</code><code> </code><code class="n">headers</code><code class="o">=</code><code class="n">headers</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># opening up a local file to save the contents of the web page to</code><code>&#13;
</code><code class="n">output_file</code><code> </code><code class="o">=</code><code> </code><code class="nb">open</code><code class="p">(</code><code class="n">output_filename</code><code class="p">,</code><code class="s2">"</code><code class="s2">w</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># the web page's code is in the `text` property of the website's response</code><code>&#13;
</code><code class="c1"># so write that to our file</code><code>&#13;
</code><code class="n">output_file</code><code class="o">.</code><code class="n">write</code><code class="p">(</code><code class="n">webpage</code><code class="o">.</code><code class="n">text</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="c1"># close our output file!</code><code>&#13;
</code><code class="n">output_file</code><code class="o">.</code><code class="n">close</code><code class="p">(</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_structuring_and_refactoring_your_code_CO5-1" id="callout_structuring_and_refactoring_your_code_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Here we’re assigning the parameter name we can use to access the values passed via the command-line from within our script. The help text is important! Be descriptive but concise.</p></dd>&#13;
</dl>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45143399649744">&#13;
<h5>Help Me!</h5>&#13;
<p>We’ve written <a data-primary="arguments" data-secondary="positional" data-type="indexterm" id="idm45143400027168"/><a data-primary="positional arguments (for functions)" data-type="indexterm" id="idm45143400026160"/><a data-primary="documentation" data-secondary="of required arguments" data-secondary-sortas="required arguments" data-type="indexterm" id="idm45143400025520"/><a data-primary="arguments" data-secondary="documentation of" data-type="indexterm" id="idm45143399911712"/>this code to use <em>positional</em> arguments in the command line, rather than <em>optional</em> arguments, because our code can’t do anything useful unless it has at least a <code>target_url</code> and a <code>filename</code> to save it to.</p>&#13;
&#13;
<p>But how would someone new to our script know that? Well, we obviously have our <code>pydoc</code>-compatible documentation, but we <em>also</em> have the “help” text we added along with each argument. If someone encounters our script and only wants to know what the required arguments are, they can run:</p>&#13;
<pre>python webpage_saver.py -h</pre>&#13;
&#13;
<p>which will print out a concise “how-to” guide for our script (with respect to required arguments, at least) to the command line.</p>&#13;
</div></aside>&#13;
&#13;
<p>Now we <em>should</em> have an easy way to download any web page to our device, without having to write a script for every unique URL. For example, if we run:</p>&#13;
<pre>python webpage_saver.py "http://web.mta.info/developers/turnstile.html" \&#13;
"MTA_turnstiles_index.html"</pre>&#13;
&#13;
<p>we will get exactly the same result as in <a data-type="xref" href="ch05.html#downloading_turnstile_index">Example 5-8</a>, but we can <em>also</em> run:</p>&#13;
<pre>python webpage_saver.py \&#13;
"https://www.citibikenyc.com/system-data/operating-reports" \&#13;
"citibike_operating_reports.html"</pre>&#13;
&#13;
<p>to get the Citi Bike operating reports without having to even <em>open</em>, much less modify, our <a data-primary="refactoring code" data-secondary="with command-line arguments" data-secondary-sortas="command-line arguments" data-startref="refactoring-command-line" data-type="indexterm" id="idm45143400251152"/><a data-primary="command-line arguments, refactoring with" data-startref="command-line-args-refactor" data-type="indexterm" id="idm45143400249552"/><a data-primary="arguments" data-secondary="command-line" data-startref="args-command-line" data-type="indexterm" id="idm45143400248624"/><a data-primary="Python" data-secondary="functions" data-startref="python-functions-command-line" data-tertiary="command-line arguments" data-type="indexterm" id="idm45143399710912"/><a data-primary="functions" data-secondary="user-defined" data-startref="functions-user-defined-args" data-tertiary="command-line arguments" data-type="indexterm" id="idm45143399709408"/><a data-primary="user-defined functions" data-secondary="command-line arguments" data-startref="user-defined-functions-args-command" data-type="indexterm" id="idm45143399769088"/>script. Handy, no?</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>Using command-line arguments with <a data-primary="command line" data-secondary="copy/paste to" data-type="indexterm" id="idm45143399766752"/><a data-primary="copying" data-secondary="to command line" data-secondary-sortas="command line" data-type="indexterm" id="idm45143399765776"/>your task-specific scripts can save you time, but not if you end up copying complex URLs into your command-line interface character by character. To make things simpler, here’s a quick overview of how to copy/paste to the command line, depending on your operating system:</p>&#13;
<dl>&#13;
<dt>Linux (including Chromebook)</dt>&#13;
<dd>&#13;
<p>Highlight the URL/text you want to copy, then context-click and select Copy. In your command-line window, just click and it will automatically paste.</p>&#13;
</dd>&#13;
<dt>Windows/Macintosh</dt>&#13;
<dd>&#13;
<p>Highlight the URL/text you want to copy, then context-click and select Copy. In your command-line window, context-click again and select Paste.</p>&#13;
</dd>&#13;
</dl>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Where Scripts and Notebooks Diverge" data-type="sect1"><div class="sect1" id="idm45143398487392">&#13;
<h1>Where Scripts and Notebooks Diverge</h1>&#13;
&#13;
<p>By now <a data-primary="Python" data-secondary="notebooks" data-tertiary="standalone scripts versus" data-type="indexterm" id="idm45143399412880"/><a data-primary="notebooks (Jupyter)" data-secondary="standalone scripts versus" data-type="indexterm" id="idm45143399411536"/><a data-primary="standalone scripts versus notebooks" data-type="indexterm" id="idm45143399410576"/>you may have noticed that in the preceding sections, I <em>didn’t</em> describe a way to get arguments from the command line into a Jupyter notebook, nor have I talked much about generating and interacting with script and function documentation for Jupyter notebooks, either. This is not because these things are impossible but because Jupyter notebooks are designed to let you interact with Python differently than standalone scripts, and some of these concepts are less applicable to them. As someone who started working with Python before Jupyter (formerly IPython) notebooks existed, my bias is still toward standalone scripts for the majority of my rubber-to-the-road Python data wrangling. While notebooks are (generally) great for testing and tweaking chunks of code, I almost always end up migrating back to standalone scripts once I’ve identified the approach that works for a particular data wrangling task. This is mostly because as I move further along in a project, I often get impatient even with the process of opening and modifying a script unless I have to—much less launching a webserver or waiting for a web page to load (I might not even have an internet connection!). These are some of the reasons why I favor using command-line arguments and standalone scripts for common, straightforward tasks.</p>&#13;
&#13;
<p>As we’ll soon see, however, the interactivity of Jupyter notebooks makes them somewhat superior to standalone Python scripts when it comes to experimenting with—and especially sharing—the data analysis and visualization portion of our data wrangling work. As a result, you’ll find more references to Jupyter notebooks in particular as we turn to those topics in Chapters <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch09.html#chapter9">9</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch10.html#chapter10">10</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conclusion" data-type="sect1"><div class="sect1" id="idm45143399178656">&#13;
<h1>Conclusion</h1>&#13;
&#13;
<p>In this chapter, we’ve taken a bit of a break from data wrangling per se to revisit some of our prior work where the code had gotten unwieldy. Through the process of refactoring, we explored how we can reorganize code that <em>works</em> into code that <em>works well</em>, because it is more readable and reusable. As our data wrangling projects evolve, this will help us build up and make use of our own collection of custom functions that meet our own particular data wrangling needs. Similarly, by applying a bit more structure to our documentation, we made it accessible—and useful—right from the command line so that we can find the script or function that we’re looking for without opening a single script. And in a similar vein, we applied that refactoring logic to our scripts so that we can customize their functionality without having to open <em>them</em>, either!</p>&#13;
&#13;
<p>In the next chapter, we’ll return to our focus on data with an overview of some of essential data analysis techniques. After that, in <a data-type="xref" href="ch10.html#chapter10">Chapter 10</a> we’ll (briefly) cover the core visualization approaches that will help you understand and present your data effectively so that you can better share your data wrangling insights with the world!</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45143401447136"><sup><a href="ch08.html#idm45143401447136-marker">1</a></sup> In this case, the programmer is actually considered the “user.”</p><p data-type="footnote" id="idm45143402674080"><sup><a href="ch08.html#idm45143402674080-marker">2</a></sup> Truly, good documentation will save your $h!t sometimes.</p><p data-type="footnote" id="idm45143402658928"><sup><a href="ch08.html#idm45143402658928-marker">3</a></sup> Doing these things is definitely possible but is well beyond the scope of most data wrangling activities, and therefore this book.</p><p data-type="footnote" id="idm45143401186992"><sup><a href="ch08.html#idm45143401186992-marker">4</a></sup> Technically, <em>parameters</em> describe the variable names assigned in the function definition, while <em>arguments</em> are the actual values that are passed to the function when it is called. In practice, though, these terms are often used interchangeably.</p><p data-type="footnote" id="idm45143401184608"><sup><a href="ch08.html#idm45143401184608-marker">5</a></sup> So-called “statically typed” programming languages will actually complain <em>before</em> your code runs if you’ve passed the wrong data type to a function or method.</p><p data-type="footnote" id="idm45143401170704"><sup><a href="ch08.html#idm45143401170704-marker">6</a></sup> There’s that <code>dtype='string'</code> again!</p><p data-type="footnote" id="idm45143400844448"><sup><a href="ch08.html#idm45143400844448-marker">7</a></sup> This term is also why the forum is called <em>Stack</em> Exchange.</p><p data-type="footnote" id="idm45143400593680"><sup><a href="ch08.html#idm45143400593680-marker">8</a></sup> You can find a helpful description/demonstration of the reasoning behind this convention at <a href="https://freecodecamp.org/news/if-name-main-python-example"><em class="hyperlink">https://freecodecamp.org/news/if-name-main-python-example</em></a>.</p><p data-type="footnote" id="idm45143398618416"><sup><a href="ch08.html#idm45143398618416-marker">9</a></sup> The actual structure/formatting I’ve used here a mashup of different styles derived from the guide at <a href="https://realpython.com/documenting-python-code/#documenting-your-python-code-base-using-docstrings"><em class="hyperlink">https://realpython.com/documenting-python-code/#documenting-your-python-code-base-using-docstrings</em></a>. While using a standard approach may matter if you are working with a large team, if you are working alone or in a small group, find a style that works for you!</p></div></div></section></body></html>