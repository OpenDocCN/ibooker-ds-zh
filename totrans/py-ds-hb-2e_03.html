<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 2. Enhanced Interactive Features" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch1.02">
<h1><span class="label">Chapter 2. </span>Enhanced Interactive Features</h1>
<p><a data-primary="IPython" data-secondary="enhanced interactive features" data-type="indexterm" id="ix_ch02-asciidoc0"/>Much of the power of IPython and Jupyter comes from the additional
interactive tools they make available. This chapter will cover
a number of those tools, including so-called magic commands, tools
for exploring input and output history, and tools to interact with the
shell.</p>
<section data-pdf-bookmark="IPython Magic Commands" data-type="sect1"><div class="sect1" id="section-0103-magic-commands">
<h1>IPython Magic Commands</h1>
<p><a data-primary="IPython" data-secondary="magic commands" data-type="indexterm" id="ix_ch02-asciidoc1"/><a data-primary="magic commands" data-type="indexterm" id="ix_ch02-asciidoc2"/>The previous chapter showed how IPython lets you use and explore Python
efficiently and interactively. Here we’ll begin discussing
some of the enhancements that IPython adds on top of the normal Python
syntax. These are known in IPython as <em>magic commands</em>, and are prefixed
by the <code>%</code> character. These magic commands are designed to succinctly
solve various common problems in standard data analysis. Magic commands
come in two flavors: <em>line magics</em>, which are denoted by a single <code>%</code>
prefix and operate on a single line of input, and <em>cell magics</em>, which
are denoted by a double <code>%%</code> prefix and operate on multiple lines of
input. I’ll demonstrate and discuss a few brief examples
here, and come back to a more focused discussion of several useful magic
commands later.</p>
<section data-pdf-bookmark="Running External Code: %run" data-type="sect2"><div class="sect2" id="ch_0103-magic-commands_running-external-code-run">
<h2>Running External Code: %run</h2>
<p><a data-primary="%run" data-primary-sortas="run" data-type="indexterm" id="idm45858813176656"/><a data-primary="code" data-secondary="magic commands for running external" data-type="indexterm" id="idm45858813175808"/><a data-primary="external code, magic commands for running" data-type="indexterm" id="idm45858813174960"/><a data-primary="magic commands" data-secondary="running external code" data-type="indexterm" id="idm45858813174352"/>As you begin developing more extensive code, you will likely find
yourself working in IPython for interactive exploration, as well as a
text editor to store code that you want to reuse. Rather than running
this code in a new window, it can be convenient to run it within your
IPython session. This can be done with the <code>%run</code> magic command.</p>
<p class="pagebreak-before less_space">For example, imagine you’ve created a <em>myscript.py</em> file
with the following contents:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># file: myscript.py</code>

<code class="k">def</code> <code class="nf">square</code><code class="p">(</code><code class="n">x</code><code class="p">):</code>
    <code class="sd">"""square a number"""</code>
    <code class="k">return</code> <code class="n">x</code> <code class="o">**</code> <code class="mi">2</code>

<code class="k">for</code> <code class="n">N</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">4</code><code class="p">):</code>
    <code class="nb">print</code><code class="p">(</code><code class="sa">f</code><code class="s2">"</code><code class="si">{</code><code class="n">N</code><code class="si">}</code><code class="s2"> squared is </code><code class="si">{</code><code class="n">square</code><code class="p">(</code><code class="n">N</code><code class="p">)</code><code class="si">}</code><code class="s2">"</code><code class="p">)</code></pre>
<p>You can execute this from your IPython session as follows:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="o">%</code><code class="k">run</code> myscript.py
<code class="mi">1</code> <code class="n">squared</code> <code class="ow">is</code> <code class="mi">1</code>
<code class="mi">2</code> <code class="n">squared</code> <code class="ow">is</code> <code class="mi">4</code>
<code class="mi">3</code> <code class="n">squared</code> <code class="ow">is</code> <code class="mi">9</code></pre>
<p>Note also that after you’ve run this script, any functions
defined within it are available for use in your IPython session:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">square</code><code class="p">(</code><code class="mi">5</code><code class="p">)</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="mi">25</code></pre>
<p>There are several options to fine-tune how your code is run; you can see
the documentation in the normal way, by typing <strong><code>%run?</code></strong> in the IPython
interpreter.</p>
</div></section>
<section data-pdf-bookmark="Timing Code Execution: %timeit" data-type="sect2"><div class="sect2" id="ch_0103-magic-commands_timing-code-execution-timeit">
<h2>Timing Code Execution: %timeit</h2>
<p><a data-primary="%timeit" data-primary-sortas="timeit" data-type="indexterm" id="idm45858813010304"/><a data-primary="code" data-secondary="magic commands for determining execution time" data-type="indexterm" id="idm45858813009328"/><a data-primary="magic commands" data-secondary="code execution timing" data-type="indexterm" id="idm45858813008416"/><a data-primary="timing, of code" data-type="indexterm" id="idm45858813007472"/>Another example of a useful magic function is <code>%timeit</code>, which will
automatically determine the execution time of the single-line Python
statement that follows it. For example, we may want to check the
performance of a list comprehension:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="o">%</code><code class="k">timeit</code> L = [n ** 2 for n in range(1000)]
<code class="mi">430</code> <code class="n">µs</code> <code class="err">±</code> <code class="mf">3.21</code> <code class="n">µs</code> <code class="n">per</code> <code class="n">loop</code> <code class="p">(</code><code class="n">mean</code> <code class="err">±</code> <code class="n">std</code><code class="o">.</code> <code class="n">dev</code><code class="o">.</code> <code class="n">of</code> <code class="mi">7</code> <code class="n">runs</code><code class="p">,</code> <code class="mi">1000</code> <code class="n">loops</code> <code class="n">each</code><code class="p">)</code></pre>
<p>The benefit of <code>%timeit</code> is that for short commands it will
automatically perform multiple runs in order to attain more robust
results. For multiline statements, adding a second <code>%</code> sign will turn
this into a cell magic that can handle multiple lines of input. For
example, here’s the equivalent construction with a <code>for</code>
loop:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="o">%%time</code>it
   <code class="o">...</code><code class="p">:</code> <code class="n">L</code> <code class="o">=</code> <code class="p">[]</code>
   <code class="o">...</code><code class="p">:</code> <code class="k">for</code> <code class="n">n</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1000</code><code class="p">):</code>
   <code class="o">...</code><code class="p">:</code>     <code class="n">L</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">n</code> <code class="o">**</code> <code class="mi">2</code><code class="p">)</code>
   <code class="o">...</code><code class="p">:</code>
<code class="mi">484</code> <code class="n">µs</code> <code class="err">±</code> <code class="mf">5.67</code> <code class="n">µs</code> <code class="n">per</code> <code class="n">loop</code> <code class="p">(</code><code class="n">mean</code> <code class="err">±</code> <code class="n">std</code><code class="o">.</code> <code class="n">dev</code><code class="o">.</code> <code class="n">of</code> <code class="mi">7</code> <code class="n">runs</code><code class="p">,</code> <code class="mi">1000</code> <code class="n">loops</code> <code class="n">each</code><code class="p">)</code></pre>
<p>We can immediately see that list comprehensions are about 10% faster
than the equivalent <code>for</code> loop construction in this case.
We’ll explore <code>%timeit</code> and other approaches to timing and
profiling code in <a data-type="xref" href="ch03.xhtml#section-0107-timing-and-profiling">“Profiling and Timing Code”</a>.</p>
</div></section>
<section data-pdf-bookmark="Help on Magic Functions: ?, %magic, and %lsmagic" data-type="sect2"><div class="sect2" id="ch_0103-magic-commands_help-on-magic-functions-magic-and-lsmagic">
<h2>Help on Magic Functions: ?, %magic, and %lsmagic</h2>
<p><a data-primary="%lsmagic" data-primary-sortas="lsmagic" data-type="indexterm" id="idm45858812850288"/><a data-primary="%magic" data-primary-sortas="magic" data-type="indexterm" id="idm45858812822912"/><a data-primary="help" data-secondary="magic functions" data-type="indexterm" id="idm45858812822064"/><a data-primary="magic commands" data-secondary="help commands" data-type="indexterm" id="idm45858812821216"/>Like normal Python functions, IPython magic functions have docstrings,
and this useful documentation can be accessed in the standard manner.
So, for example, to read the documentation of the <code>%timeit</code> magic
function, simply type this:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> %timeit<code class="o">?</code></pre>
<p>Documentation for other functions can be accessed similarly. To access a
general description of available magic functions, including some
examples, you can type this:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="o">%</code><code class="k">magic</code></pre>
<p>For a quick and simple list of all available magic functions, type this:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="o">%</code><code class="k">lsmagic</code></pre>
<p>Finally, I’ll mention that it is quite straightforward to
define your own magic functions if you wish. I won’t discuss
it here, but if you are interested, see the references listed in
<a data-type="xref" href="ch03.xhtml#section-0108-more-ipython-resources">“More IPython Resources”</a>.<a data-startref="ix_ch02-asciidoc2" data-type="indexterm" id="idm45858812777088"/><a data-startref="ix_ch02-asciidoc1" data-type="indexterm" id="idm45858812776480"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Input and Output History" data-type="sect1"><div class="sect1" id="section-0104-input-output-history">
<h1>Input and Output History</h1>
<p><a data-primary="input/output history, IPython" data-type="indexterm" id="ix_ch02-asciidoc3"/><a data-primary="IPython" data-secondary="input/output history" data-type="indexterm" id="ix_ch02-asciidoc4"/><a data-primary="magic commands" data-secondary="IPython input/output history" data-type="indexterm" id="ix_ch02-asciidoc5"/>Previously you saw that the IPython shell allows you to access previous
commands with the up and down arrow keys, or equivalently the
Ctrl-p/Ctrl-n shortcuts. Additionally, in both the shell and notebooks,
IPython exposes several ways to obtain the output of previous commands,
as well as string versions of the commands themselves. We’ll
explore those here.</p>
<section data-pdf-bookmark="IPython’s In and Out Objects" data-type="sect2"><div class="sect2" id="ch_0104-input-output-history_ipythons-in-and-out-objects">
<h2>IPython’s In and Out Objects</h2>
<p><a data-primary="In objects, IPython" data-type="indexterm" id="idm45858812748464"/><a data-primary="input/output history, IPython" data-secondary="In and Out objects" data-type="indexterm" id="idm45858812747760"/><a data-primary="Out objects, IPython" data-type="indexterm" id="idm45858812746848"/>By now I imagine you’re becoming familiar with the
<code>In [1]:</code>/<code>Out[1]:</code> style of prompts used by IPython. But it turns out
that these are not just pretty decoration: they give a clue as to how
you can access previous inputs and outputs in your current session.
Suppose we start a session that looks like this:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">math</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">math</code><code class="o">.</code><code class="n">sin</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="mf">0.9092974268256817</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">math</code><code class="o">.</code><code class="n">cos</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="o">-</code><code class="mf">0.4161468365471424</code></pre>
<p>We’ve imported the built-in <code>math</code> package, then computed
the sine and the cosine of the number 2. These inputs and outputs are
displayed in the shell with <code>In</code>/<code>Out</code> labels, but there’s
more—IPython actually creates some Python variables called <code>In</code> and
<code>Out</code> that are automatically updated to reflect this history:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">In</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="p">[</code><code class="s1">''</code><code class="p">,</code> <code class="s1">'import math'</code><code class="p">,</code> <code class="s1">'math.sin(2)'</code><code class="p">,</code> <code class="s1">'math.cos(2)'</code><code class="p">,</code> <code class="s1">'In'</code><code class="p">]</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">Out</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]:</code>
<code class="p">{</code><code class="mi">2</code><code class="p">:</code> <code class="mf">0.9092974268256817</code><code class="p">,</code>
 <code class="mi">3</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.4161468365471424</code><code class="p">,</code>
 <code class="mi">4</code><code class="p">:</code> <code class="p">[</code><code class="s1">''</code><code class="p">,</code> <code class="s1">'import math'</code><code class="p">,</code> <code class="s1">'math.sin(2)'</code><code class="p">,</code> <code class="s1">'math.cos(2)'</code><code class="p">,</code> <code class="s1">'In'</code><code class="p">,</code> <code class="s1">'Out'</code><code class="p">]}</code></pre>
<p>The <code>In</code> object is a list, which keeps track of the commands in order
(the first item in the list is a placeholder so that <code>In [1]</code> can refer
to the first command):</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="nb">print</code><code class="p">(</code><code class="n">In</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code>
<code class="kn">import</code> <code class="nn">math</code></pre>
<p>The <code>Out</code> object is not a list but a dictionary mapping input numbers to
their outputs (if any):</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="nb">print</code><code class="p">(</code><code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">])</code>
<code class="mf">.9092974268256817</code></pre>
<p>Note that not all operations have outputs: for example, <code>import</code>
statements and <code>print</code> statements don’t affect the output.
The latter may be surprising, but makes sense if you consider that
<code>print</code> is a function that returns <code>None</code>; for brevity, any command that
returns <code>None</code> is not added to <code>Out</code>.</p>
<p>This can be useful when you want to interact with past results.
For example, let’s check the sum of <code>sin(2) ** 2</code> and
<code>cos(2) ** 2</code> using the previously computed results:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code> <code class="o">**</code> <code class="mi">2</code> <code class="o">+</code> <code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]</code> <code class="o">**</code> <code class="mi">2</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="mf">1.0</code></pre>
<p>The result is <code>1.0</code>, as we’d expect from the well-known
trigonometric identity. In this case, using these previous results
probably is not necessary, but it can become quite handy if you execute
a very expensive computation and forget to assign the result to a
variable.</p>
</div></section>
<section data-pdf-bookmark="Underscore Shortcuts and Previous Outputs" data-type="sect2"><div class="sect2" id="ch_0104-input-output-history_underscore-shortcuts-and-previous-outputs">
<h2>Underscore Shortcuts and Previous Outputs</h2>
<p><a data-primary="_ (underscore) shortcut" data-type="indexterm" id="idm45858812470960"/><a data-primary="input/output history, IPython" data-secondary="underscore shortcuts and previous outputs" data-type="indexterm" id="idm45858812470256"/><a data-primary="shortcuts" data-secondary="accessing previous output" data-type="indexterm" id="idm45858812469376"/><a data-primary="underscore (_) shortcut" data-type="indexterm" id="idm45858812468464"/>The standard Python shell contains just one simple shortcut for
accessing previous output: the variable <code>_</code> (i.e., a single underscore)
is kept updated with the previous output. This works in IPython as well:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="nb">print</code><code class="p">(</code><code class="n">_</code><code class="p">)</code>
<code class="mf">.0</code></pre>
<p class="pagebreak-before less_space">But IPython takes this a bit further—you can use a double underscore to
access the second-to-last output, and a triple underscore to access the
third-to-last output (skipping any commands with no output):</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">10</code><code class="p">]:</code> <code class="nb">print</code><code class="p">(</code><code class="n">__</code><code class="p">)</code>
<code class="o">-</code><code class="mf">0.4161468365471424</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="nb">print</code><code class="p">(</code><code class="n">___</code><code class="p">)</code>
<code class="mf">.9092974268256817</code></pre>
<p>IPython stops there: more than three underscores starts to get a bit
hard to count, and at that point it’s easier to refer to the
output by line number.</p>
<p>There is one more shortcut I should mention, however—a shorthand for
<code>Out[<em>X</em>]</code> is <code>_<em>X</em></code> (i.e., a single underscore followed by the line
number):</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="mf">0.9092974268256817</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="n">_2</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="mf">0.9092974268256817</code></pre>
</div></section>
<section data-pdf-bookmark="Suppressing Output" data-type="sect2"><div class="sect2" id="ch_0104-input-output-history_suppressing-output">
<h2>Suppressing Output</h2>
<p><a data-primary="input/output history, IPython" data-secondary="suppressing output" data-type="indexterm" id="idm45858812342032"/><a data-primary="output, suppressing" data-type="indexterm" id="idm45858812341088"/>Sometimes you might wish to suppress the output of a statement (this is
perhaps most common with the plotting commands that we’ll
explore in <a data-type="xref" href="part04.xhtml#section-0400-introduction-to-matplotlib">Part IV</a>). Or maybe the command you’re executing produces
a result that you’d prefer not to store in your output
history, perhaps so that it can be deallocated when other references are
removed. The easiest way to suppress the output of a command is to add a
semicolon to the end of the line:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="n">math</code><code class="o">.</code><code class="n">sin</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code> <code class="o">+</code> <code class="n">math</code><code class="o">.</code><code class="n">cos</code><code class="p">(</code><code class="mi">2</code><code class="p">);</code></pre>
<p>The result is computed silently, and the output is neither displayed on
the screen nor stored in the <code>Out</code> dictionary:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="mi">14</code> <code class="ow">in</code> <code class="n">Out</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="kc">False</code></pre>
</div></section>
<section data-pdf-bookmark="Related Magic Commands" data-type="sect2"><div class="sect2" id="ch_0104-input-output-history_related-magic-commands">
<h2>Related Magic Commands</h2>
<p><a data-primary="%history" data-primary-sortas="history" data-type="indexterm" id="idm45858812282256"/>For accessing a batch of previous inputs at once, the <code>%history</code> magic
command is very helpful. Here is how you can print the first four
inputs:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">16</code><code class="p">]:</code> <code class="o">%</code><code class="k">history</code> -n 1-3
   <code class="mi">1</code><code class="p">:</code> <code class="kn">import</code> <code class="nn">math</code>
   <code class="mi">2</code><code class="p">:</code> <code class="n">math</code><code class="o">.</code><code class="n">sin</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code>
   <code class="mi">3</code><code class="p">:</code> <code class="n">math</code><code class="o">.</code><code class="n">cos</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code></pre>
<p>As usual, you can type <code>%history?</code> for more information and a
description of options available (see
<a data-type="xref" href="ch01.xhtml#section-0101-help-and-documentation">Chapter 1</a> for details on the <code>?</code> functionality). Other useful magic

<span class="keep-together">commands</span> are <code>%rerun</code>, which will re-execute some portion of the command
history, and <code>%save</code>, which saves some set of the command history to a
file).<a data-startref="ix_ch02-asciidoc5" data-type="indexterm" id="idm45858812242272"/><a data-startref="ix_ch02-asciidoc4" data-type="indexterm" id="idm45858812210064"/><a data-startref="ix_ch02-asciidoc3" data-type="indexterm" id="idm45858812209392"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="IPython and Shell Commands" data-type="sect1"><div class="sect1" id="section-0105-ipython-and-shell-commands">
<h1>IPython and Shell Commands</h1>
<p><a data-primary="IPython" data-secondary="shell commands" data-type="indexterm" id="ix_ch02-asciidoc6"/><a data-primary="shell, IPython" data-secondary="commands" data-type="indexterm" id="ix_ch02-asciidoc7"/>When working interactively with the standard Python interpreter, one of
the frustrations is the need to switch between multiple windows to
access Python tools and system <a data-primary="IPython" data-secondary="command-line commands in shell" data-type="indexterm" id="idm45858812204512"/><a data-primary="shell, IPython" data-secondary="command-line commands" data-type="indexterm" id="idm45858812203600"/>command-line tools. IPython bridges this
gap and gives you a syntax for executing shell commands directly from
within the IPython terminal. The magic happens with the exclamation
point: anything appearing after <code>!</code> on a line will be executed not by
the Python kernel, but by the system command line.</p>
<p>The following discussion assumes you’re on a Unix-like
system, such as Linux or macOS. Some of the examples that follow will
fail on Windows, which uses a different type of shell by default, though
if you use the <a href="https://oreil.ly/H5MEE"><em>Windows Subsystem for Linux</em></a> the examples here should
run correctly. If you’re unfamiliar with shell commands,
I’d suggest reviewing the
<a href="https://oreil.ly/RrD2Y">Unix shell tutorial</a> put
together by the always excellent Software Carpentry Foundation.</p>
<section data-pdf-bookmark="Quick Introduction to the Shell" data-type="sect2"><div class="sect2" id="ch_0105-ipython-and-shell-commands_quick-introduction-to-the-shell">
<h2>Quick Introduction to the Shell</h2>
<p><a data-primary="shell, IPython" data-secondary="basics" data-type="indexterm" id="idm45858812198352"/>A full introduction to using the shell/terminal/command line is well
beyond the scope of this chapter, but for the uninitiated I will offer a
quick introduction here. The shell is a way to interact textually with
your computer. Ever since the mid-1980s, when Microsoft and Apple
introduced the first versions of their now ubiquitous graphical
operating systems, most computer users have interacted with their
operating systems through the familiar menu selections and drag-and-drop
movements. But operating systems existed long before these graphical
user interfaces, and were primarily controlled through sequences of text
input: at the prompt, the user would type a command, and the computer
would do what the user told it to. Those early prompt systems were the
precursors of the shells and terminals that most data scientists still
use today.</p>
<p>Someone unfamiliar with the shell might ask why you would bother with
this, when many of the same results can be accomplished by simply
clicking on icons and menus. A shell user might reply with another
question: why hunt for icons and menu items when you can accomplish
things much more easily by typing? While it might sound like a typical
tech preference impasse, when moving beyond basic tasks it quickly
becomes clear that the shell offers much more control of advanced
tasks—though admittedly the learning curve can be intimidating.</p>
<p>As an example, here is a sample of a Linux/macOS shell session where a
user explores, creates, and modifies directories and files on their
system (<code>osx:~ $</code> is the prompt, and everything after the <code>$</code> is the
typed command; text that is preceded by a <code>#</code> is meant just as
description, rather than something you would actually type in):</p>
<pre data-type="programlisting">
osx:~ $ <strong>echo "hello world"</strong>            # echo is like Python's print function
hello world

osx:~ $ <strong>pwd</strong>                            # pwd = print working directory
/home/jake                             # This is the "path" that we're sitting in

osx:~ $ <strong>ls</strong>                             # ls = list working directory contents
notebooks  projects

osx:~ $ <strong>cd projects/</strong>                   # cd = change directory

osx:projects $ <strong>pwd</strong>
/home/jake/projects

osx:projects $ <strong>ls</strong>
datasci_book   mpld3   myproject.txt

osx:projects $ <strong>mkdir myproject</strong>          # mkdir = make new directory

osx:projects $ <strong>cd myproject/</strong>

osx:myproject $ <strong>mv ../myproject.txt ./</strong>  # mv = move file. Here we're moving the
                                        # file myproject.txt from one directory
                                        # up (../) to the current directory (./).
osx:myproject $ <strong>ls</strong>
myproject.txt
</pre>
<p>Notice that all of this is just a compact way to do familiar operations
(navigating a directory structure, creating a directory, moving a file,
etc.) by typing commands rather than clicking icons and menus. With just
a few commands (<code>pwd</code>, <code>ls</code>, <code>cd</code>, <code>mkdir</code>, and <code>cp</code>) you can do many of
the most common file operations, but it’s when you go beyond
these basics that the shell approach becomes really powerful.</p>
</div></section>
<section data-pdf-bookmark="Shell Commands in IPython" data-type="sect2"><div class="sect2" id="ch_0105-ipython-and-shell-commands_shell-commands-in-ipython">
<h2>Shell Commands in IPython</h2>
<p>Any standard shell command can be used directly in IPython by prefixing
it with the <code>!</code> character. For example, the <code>ls</code>, <code>pwd</code>, and <code>echo</code>
commands can be run as follows:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="o">!</code>ls
<code class="n">myproject</code><code class="o">.</code><code class="n">txt</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="o">!</code>pwd
<code class="o">/</code><code class="n">home</code><code class="o">/</code><code class="n">jake</code><code class="o">/</code><code class="n">projects</code><code class="o">/</code><code class="n">myproject</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="o">!</code><code class="nb">echo</code> <code class="s2">"printing from the shell"</code>
<code class="n">printing</code> <code class="kn">from</code> <code class="nn">the</code> <code class="n">shell</code></pre>
</div></section>
<section data-pdf-bookmark="Passing Values to and from the Shell" data-type="sect2"><div class="sect2" id="ch_0105-ipython-and-shell-commands_passing-values-to-and-from-the-shell">
<h2>Passing Values to and from the Shell</h2>
<p><a data-primary="shell, IPython" data-secondary="passing values to and from" data-type="indexterm" id="idm45858812116512"/><a data-primary="variables" data-secondary="passing to and from shell" data-type="indexterm" id="idm45858812115632"/>Shell commands can not only be called from IPython, but can also be made
to interact with the IPython namespace. For example, you can save the
output of any shell command to a Python list using the assignment
operator, <code>=</code>:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">contents</code> <code class="o">=</code> <code class="o">!</code>ls

<code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="nb">print</code><code class="p">(</code><code class="n">contents</code><code class="p">)</code>
<code class="p">[</code><code class="s1">'myproject.txt'</code><code class="p">]</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">directory</code> <code class="o">=</code> <code class="o">!</code>pwd

<code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="nb">print</code><code class="p">(</code><code class="n">directory</code><code class="p">)</code>
<code class="p">[</code><code class="s1">'/Users/jakevdp/notebooks/tmp/myproject'</code><code class="p">]</code></pre>
<p>These results are not returned as lists, but as a special shell return
type defined in 
<span class="keep-together">IPython</span>:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="nb">type</code><code class="p">(</code><code class="n">directory</code><code class="p">)</code>
<code class="n">IPython</code><code class="o">.</code><code class="n">utils</code><code class="o">.</code><code class="n">text</code><code class="o">.</code><code class="n">SList</code></pre>
<p>This looks and acts a lot like a Python list but has additional
functionality, such as the <code>grep</code> and <code>fields</code> methods and the <code>s</code>, <code>n</code>,
and <code>p</code> properties that allow you to search, filter, and display the
results in convenient ways. For more information on these, you can use
IPython’s built-in help features.</p>
<p>Communication in the other direction—passing Python variables into the
shell—is possible using the <code>{<em>varname</em>}</code> syntax:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="n">message</code> <code class="o">=</code> <code class="s2">"hello from Python"</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">10</code><code class="p">]:</code> <code class="o">!</code><code class="nb">echo</code> <code class="o">{</code>message<code class="o">}</code>
<code class="n">hello</code> <code class="kn">from</code> <code class="nn">Python</code></pre>
<p>The curly braces contain the variable name, which is replaced by the
variable’s contents in the shell command.</p>
</div></section>
<section data-pdf-bookmark="Shell-Related Magic Commands" data-type="sect2"><div class="sect2" id="ch_0105-ipython-and-shell-commands_shell-related-magic-commands">
<h2>Shell-Related Magic Commands</h2>
<p><a data-primary="input/output history, IPython" data-secondary="shell-related magic commands" data-type="indexterm" id="idm45858811942640"/><a data-primary="IPython" data-secondary="shell-related magic commands" data-type="indexterm" id="idm45858811941728"/><a data-primary="magic commands" data-secondary="shell-related" data-type="indexterm" id="idm45858811940816"/>If you play with IPython’s shell commands for a while, you
might notice that you cannot use <code>!cd</code> to navigate the filesystem:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="o">!</code>pwd
<code class="o">/</code><code class="n">home</code><code class="o">/</code><code class="n">jake</code><code class="o">/</code><code class="n">projects</code><code class="o">/</code><code class="n">myproject</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="o">!</code><code class="nb">cd</code> ..

<code class="n">In</code> <code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="o">!</code>pwd
<code class="o">/</code><code class="n">home</code><code class="o">/</code><code class="n">jake</code><code class="o">/</code><code class="n">projects</code><code class="o">/</code><code class="n">myproject</code></pre>
<p>The reason is that shell commands in the notebook are executed in a
temporary subshell that does not maintain state from command to command.
If you’d like to change the working directory in a more
enduring way, you can use the <code>%cd</code> magic command:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="o">%</code><code class="k">cd</code> ..
<code class="o">/</code><code class="n">home</code><code class="o">/</code><code class="n">jake</code><code class="o">/</code><code class="n">projects</code></pre>
<p>In fact, by default you can even use this without the <code>%</code> sign:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="n">cd</code> <code class="n">myproject</code>
<code class="o">/</code><code class="n">home</code><code class="o">/</code><code class="n">jake</code><code class="o">/</code><code class="n">projects</code><code class="o">/</code><code class="n">myproject</code></pre>
<p><a data-primary="%automagic" data-primary-sortas="automagic" data-type="indexterm" id="idm45858811831360"/><a data-primary="automagic function" data-type="indexterm" id="idm45858811827600"/><a data-primary="shell, IPython" data-secondary="magic commands" data-type="indexterm" id="idm45858811826992"/>This is known as an <em>automagic</em> function, and the ability to execute
such commands without an explicit <code>%</code> can be toggled with the
<code>%automagic</code> magic function.</p>
<p>Besides <code>%cd</code>, other available shell-like magic functions are <code>%cat</code>,
<code>%cp</code>, <code>%env</code>, <code>%ls</code>, <code>%man</code>, <code>%mkdir</code>, <code>%more</code>, <code>%mv</code>, <code>%pwd</code>, <code>%rm</code>,
and <code>%rmdir</code>, any of which can be used without the <code>%</code> sign if
<code>automagic</code> is on. This makes it so that you can almost treat the
IPython prompt as if it’s a normal shell:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">16</code><code class="p">]:</code> <code class="n">mkdir</code> <code class="n">tmp</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">17</code><code class="p">]:</code> <code class="n">ls</code>
<code class="n">myproject</code><code class="o">.</code><code class="n">txt</code>  <code class="n">tmp</code><code class="o">/</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">18</code><code class="p">]:</code> <code class="n">cp</code> <code class="n">myproject</code><code class="o">.</code><code class="n">txt</code> <code class="n">tmp</code><code class="o">/</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">19</code><code class="p">]:</code> <code class="n">ls</code> <code class="n">tmp</code>
<code class="n">myproject</code><code class="o">.</code><code class="n">txt</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">20</code><code class="p">]:</code> <code class="n">rm</code> <code class="o">-</code><code class="n">r</code> <code class="n">tmp</code></pre>
<p>This access to the shell from within the same terminal window as your
Python session lets you more naturally combine Python and the shell in
your workflows with fewer context switches<a data-startref="ix_ch02-asciidoc7" data-type="indexterm" id="idm45858811754176"/>.<a data-startref="ix_ch02-asciidoc6" data-type="indexterm" id="idm45858811714128"/><a data-startref="ix_ch02-asciidoc0" data-type="indexterm" id="idm45858811713520"/></p>
</div></section>
</div></section>
</div></section></div></body></html>