<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 32. Text and Annotation" data-type="chapter" epub:type="chapter"><div class="chapter" id="section-0409-text-and-annotation">
<h1><span class="label">Chapter 32. </span>Text and Annotation</h1>
<p><a data-primary="annotation of plots" data-type="indexterm" id="ix_ch32-asciidoc0"/><a data-primary="text" data-seealso="annotation of plots" data-type="indexterm" id="ix_ch32-asciidoc0a"/><a data-primary="Matplotlib" data-secondary="text and annotation" data-type="indexterm" id="ix_ch32-asciidoc1"/><a data-primary="plotting" data-secondary="text and annotation for" data-type="indexterm" id="ix_ch32-asciidoc2"/>Creating a good visualization involves guiding the reader so that the
figure tells a story. In some cases, this story can be told in an
entirely visual manner, without the need for added text, but in others,
small textual cues and labels are necessary. Perhaps the most basic
types of annotations you will use are axes labels and titles, but the
options go beyond this. Let’s take a look at some data and
how we might visualize and annotate it to help convey interesting
information. We’ll start by setting up the notebook for
plotting and importing the functions we will use:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="o">%</code><code class="k">matplotlib</code> inline
        <code class="kn">import</code> <code class="nn">matplotlib.pyplot</code> <code class="k">as</code> <code class="nn">plt</code>
        <code class="kn">import</code> <code class="nn">matplotlib</code> <code class="k">as</code> <code class="nn">mpl</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">use</code><code class="p">(</code><code class="s1">'seaborn-whitegrid'</code><code class="p">)</code>
        <code class="kn">import</code> <code class="nn">numpy</code> <code class="k">as</code> <code class="nn">np</code>
        <code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code></pre>
<section data-pdf-bookmark="Example: Effect of Holidays on US Births" data-type="sect1"><div class="sect1" id="ch_0409-text-and-annotation_example-effect-of-holidays-on-us-births">
<h1>Example: Effect of Holidays on US Births</h1>
<p><a data-primary="annotation of plots" data-secondary="holidays/US births example" data-type="indexterm" id="ix_ch32-asciidoc3"/>Let’s return to some data we worked with earlier, in
<a data-type="xref" href="ch21.xhtml#ch_0309-pivot-tables_example-birthrate-data">“Example: Birthrate Data”</a>, where we generated a plot of average births over the course of
the calendar year. We’ll start with the same cleaning
procedure we used there, and plot the results (see <a data-type="xref" href="#fig_0409-text-and-annotation_files_in_output_6_0">Figure 32-1</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="c1"># shell command to download the data:</code>
        <code class="c1"># !cd data &amp;&amp; curl -O \</code>
        <code class="c1">#   https://raw.githubusercontent.com/jakevdp/data-CDCbirths/master/</code>
        <code class="c1">#   births.csv</code></pre>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="kn">from</code> <code class="nn">datetime</code> <code class="kn">import</code> <code class="n">datetime</code>

        <code class="n">births</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="s1">'data/births.csv'</code><code class="p">)</code>

        <code class="n">quartiles</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">percentile</code><code class="p">(</code><code class="n">births</code><code class="p">[</code><code class="s1">'births'</code><code class="p">],</code> <code class="p">[</code><code class="mi">25</code><code class="p">,</code> <code class="mi">50</code><code class="p">,</code> <code class="mi">75</code><code class="p">])</code>
        <code class="n">mu</code><code class="p">,</code> <code class="n">sig</code> <code class="o">=</code> <code class="n">quartiles</code><code class="p">[</code><code class="mi">1</code><code class="p">],</code> <code class="mf">0.74</code> <code class="o">*</code> <code class="p">(</code><code class="n">quartiles</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code> <code class="o">-</code> <code class="n">quartiles</code><code class="p">[</code><code class="mi">0</code><code class="p">])</code>
        <code class="n">births</code> <code class="o">=</code> <code class="n">births</code><code class="o">.</code><code class="n">query</code><code class="p">(</code><code class="s1">'(births &gt; @mu - 5 * @sig) &amp;</code>
                               <code class="p">(</code><code class="n">births</code> <code class="o">&lt;</code> <code class="nd">@mu</code> <code class="o">+</code> <code class="mi">5</code> <code class="o">*</code> <code class="nd">@sig</code><code class="p">)</code><code class="s1">')</code>

        <code class="n">births</code><code class="p">[</code><code class="s1">'day'</code><code class="p">]</code> <code class="o">=</code> <code class="n">births</code><code class="p">[</code><code class="s1">'day'</code><code class="p">]</code><code class="o">.</code><code class="n">astype</code><code class="p">(</code><code class="nb">int</code><code class="p">)</code>

        <code class="n">births</code><code class="o">.</code><code class="n">index</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">to_datetime</code><code class="p">(</code><code class="mi">10000</code> <code class="o">*</code> <code class="n">births</code><code class="o">.</code><code class="n">year</code> <code class="o">+</code>
                                      <code class="mi">100</code> <code class="o">*</code> <code class="n">births</code><code class="o">.</code><code class="n">month</code> <code class="o">+</code>
                                      <code class="n">births</code><code class="o">.</code><code class="n">day</code><code class="p">,</code> <code class="nb">format</code><code class="o">=</code><code class="s1">'%Y%m</code><code class="si">%d</code><code class="s1">'</code><code class="p">)</code>
        <code class="n">births_by_date</code> <code class="o">=</code> <code class="n">births</code><code class="o">.</code><code class="n">pivot_table</code><code class="p">(</code><code class="s1">'births'</code><code class="p">,</code>
                                            <code class="p">[</code><code class="n">births</code><code class="o">.</code><code class="n">index</code><code class="o">.</code><code class="n">month</code><code class="p">,</code> <code class="n">births</code><code class="o">.</code><code class="n">index</code><code class="o">.</code><code class="n">day</code><code class="p">])</code>
        <code class="n">births_by_date</code><code class="o">.</code><code class="n">index</code> <code class="o">=</code> <code class="p">[</code><code class="n">datetime</code><code class="p">(</code><code class="mi">2012</code><code class="p">,</code> <code class="n">month</code><code class="p">,</code> <code class="n">day</code><code class="p">)</code>
                                <code class="k">for</code> <code class="p">(</code><code class="n">month</code><code class="p">,</code> <code class="n">day</code><code class="p">)</code> <code class="ow">in</code> <code class="n">births_by_date</code><code class="o">.</code><code class="n">index</code><code class="p">]</code></pre>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">12</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>
        <code class="n">births_by_date</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">);</code></pre>
<figure><div class="figure" id="fig_0409-text-and-annotation_files_in_output_6_0">
<img alt="output 6 0" height="383" src="assets/output_6_0.png" width="600"/>
<h6><span class="label">Figure 32-1. </span>Average daily births by date<sup><a data-type="noteref" href="ch32.xhtml#idm45858755315264" id="idm45858755315264-marker">1</a></sup></h6>
</div></figure>
<p>When we’re visualizing data like this, it is often useful to
annotate certain features of the plot to draw the reader’s
attention. This can be done manually with the <code>plt.text</code>/<code>ax.text</code>
functions, which will place text at a particular <em>x</em>/<em>y</em> value (see <a data-type="xref" href="#fig_0409-text-and-annotation_files_in_output_8_0">Figure 32-2</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">12</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>
        <code class="n">births_by_date</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">)</code>

        <code class="c1"># Add labels to the plot</code>
        <code class="n">style</code> <code class="o">=</code> <code class="nb">dict</code><code class="p">(</code><code class="n">size</code><code class="o">=</code><code class="mi">10</code><code class="p">,</code> <code class="n">color</code><code class="o">=</code><code class="s1">'gray'</code><code class="p">)</code>

        <code class="n">ax</code><code class="o">.</code><code class="n">text</code><code class="p">(</code><code class="s1">'2012-1-1'</code><code class="p">,</code> <code class="mi">3950</code><code class="p">,</code> <code class="s2">"New Year's Day"</code><code class="p">,</code> <code class="o">**</code><code class="n">style</code><code class="p">)</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">text</code><code class="p">(</code><code class="s1">'2012-7-4'</code><code class="p">,</code> <code class="mi">4250</code><code class="p">,</code> <code class="s2">"Independence Day"</code><code class="p">,</code> <code class="n">ha</code><code class="o">=</code><code class="s1">'center'</code><code class="p">,</code> <code class="o">**</code><code class="n">style</code><code class="p">)</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">text</code><code class="p">(</code><code class="s1">'2012-9-4'</code><code class="p">,</code> <code class="mi">4850</code><code class="p">,</code> <code class="s2">"Labor Day"</code><code class="p">,</code> <code class="n">ha</code><code class="o">=</code><code class="s1">'center'</code><code class="p">,</code> <code class="o">**</code><code class="n">style</code><code class="p">)</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">text</code><code class="p">(</code><code class="s1">'2012-10-31'</code><code class="p">,</code> <code class="mi">4600</code><code class="p">,</code> <code class="s2">"Halloween"</code><code class="p">,</code> <code class="n">ha</code><code class="o">=</code><code class="s1">'right'</code><code class="p">,</code> <code class="o">**</code><code class="n">style</code><code class="p">)</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">text</code><code class="p">(</code><code class="s1">'2012-11-25'</code><code class="p">,</code> <code class="mi">4450</code><code class="p">,</code> <code class="s2">"Thanksgiving"</code><code class="p">,</code> <code class="n">ha</code><code class="o">=</code><code class="s1">'center'</code><code class="p">,</code> <code class="o">**</code><code class="n">style</code><code class="p">)</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">text</code><code class="p">(</code><code class="s1">'2012-12-25'</code><code class="p">,</code> <code class="mi">3850</code><code class="p">,</code> <code class="s2">"Christmas "</code><code class="p">,</code> <code class="n">ha</code><code class="o">=</code><code class="s1">'right'</code><code class="p">,</code> <code class="o">**</code><code class="n">style</code><code class="p">)</code>

        <code class="c1"># Label the axes</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">set</code><code class="p">(</code><code class="n">title</code><code class="o">=</code><code class="s1">'USA births by day of year (1969-1988)'</code><code class="p">,</code>
               <code class="n">ylabel</code><code class="o">=</code><code class="s1">'average daily births'</code><code class="p">)</code>

        <code class="c1"># Format the x-axis with centered month labels</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">set_major_locator</code><code class="p">(</code><code class="n">mpl</code><code class="o">.</code><code class="n">dates</code><code class="o">.</code><code class="n">MonthLocator</code><code class="p">())</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">set_minor_locator</code><code class="p">(</code><code class="n">mpl</code><code class="o">.</code><code class="n">dates</code><code class="o">.</code><code class="n">MonthLocator</code><code class="p">(</code><code class="n">bymonthday</code><code class="o">=</code><code class="mi">15</code><code class="p">))</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">set_major_formatter</code><code class="p">(</code><code class="n">plt</code><code class="o">.</code><code class="n">NullFormatter</code><code class="p">())</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">set_minor_formatter</code><code class="p">(</code><code class="n">mpl</code><code class="o">.</code><code class="n">dates</code><code class="o">.</code><code class="n">DateFormatter</code><code class="p">(</code><code class="s1">'%h'</code><code class="p">));</code></pre>
<figure><div class="figure" id="fig_0409-text-and-annotation_files_in_output_8_0">
<img alt="output 8 0" height="392" src="assets/output_8_0.png" width="600"/>
<h6><span class="label">Figure 32-2. </span>Annotated average daily births by date<sup><a data-type="noteref" href="ch32.xhtml#idm45858755112736" id="idm45858755112736-marker">2</a></sup></h6>
</div></figure>
<p>The <code>ax.text</code> method takes an <em>x</em> position, a <em>y</em> position, a string,
and then optional keywords specifying the color, size, style, alignment,
and other properties of the text. Here we used
<code>ha='right'</code> and
<code>ha='center'</code>, where <code>ha</code> is short for
<em>horizontal alignment</em>. See the docstrings of <code>plt.text</code> and
<code>mpl.text.Text</code> for more information on the available options.<a data-startref="ix_ch32-asciidoc3" data-type="indexterm" id="idm45858755072496"/></p>
</div></section>
<section data-pdf-bookmark="Transforms and Text Position" data-type="sect1"><div class="sect1" id="ch_0409-text-and-annotation_transforms-and-text-position">
<h1>Transforms and Text Position</h1>
<p><a data-primary="annotation of plots" data-secondary="transforms and text position" data-type="indexterm" id="ix_ch32-asciidoc4"/><a data-primary="text" data-secondary="transforms and position of" data-type="indexterm" id="ix_ch32-asciidoc5"/><a data-primary="transforms" data-secondary="modifying" data-type="indexterm" id="ix_ch32-asciidoc6"/><a data-primary="transforms" data-secondary="text position and" data-type="indexterm" id="ix_ch32-asciidoc7"/>In the previous example, we anchored our text annotations to data
locations. Sometimes it’s preferable to anchor the text to a
fixed position on the axes or figure, independent of the data. In
Matplotlib, this is done by modifying the <em>transform</em>.</p>
<p>Matplotlib makes use of a few different coordinate systems: a data point
at <math alttext="left-parenthesis x comma y right-parenthesis equals left-parenthesis 1 comma 1 right-parenthesis">
<mrow>
<mo>(</mo>
<mi>x</mi>
<mo>,</mo>
<mi>y</mi>
<mo>)</mo>
<mo>=</mo>
<mo>(</mo>
<mn>1</mn>
<mo>,</mo>
<mn>1</mn>
<mo>)</mo>
</mrow>
</math> corresponds to a certain location on
the axes or figure, which in turn corresponds to a particular pixel on
the screen. Mathematically, transforming between such coordinate systems
is relatively straightforward, and Matplotlib has a well-developed set
of tools that it uses internally to perform these transforms (these
tools can be explored in the <code>matplotlib.transforms</code> submodule).</p>
<p>A typical user rarely needs to worry about the details of the
transforms, but it is helpful knowledge to have when considering the
placement of text on a figure. There are three predefined transforms
that can be useful in this situation:</p>
<dl>
<dt><code>ax.transData</code></dt>
<dd>
<p>Transform associated with data coordinates</p>
</dd>
<dt><code>ax.transAxes</code></dt>
<dd>
<p>Transform associated with the axes (in units of axes
dimensions)</p>
</dd>
<dt><code>fig.transFigure</code></dt>
<dd>
<p>Transform associated with the figure (in units of
figure dimensions)</p>
</dd>
</dl>
<p>Let’s look at an example of drawing text at various
locations using these transforms (see <a data-type="xref" href="#fig_0409-text-and-annotation_files_in_output_11_0">Figure 32-3</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">facecolor</code><code class="o">=</code><code class="s1">'lightgray'</code><code class="p">)</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">axis</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">10</code><code class="p">])</code>

        <code class="c1"># transform=ax.transData is the default, but we'll specify it anyway</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">text</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="s2">". Data: (1, 5)"</code><code class="p">,</code> <code class="n">transform</code><code class="o">=</code><code class="n">ax</code><code class="o">.</code><code class="n">transData</code><code class="p">)</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">text</code><code class="p">(</code><code class="mf">0.5</code><code class="p">,</code> <code class="mf">0.1</code><code class="p">,</code> <code class="s2">". Axes: (0.5, 0.1)"</code><code class="p">,</code> <code class="n">transform</code><code class="o">=</code><code class="n">ax</code><code class="o">.</code><code class="n">transAxes</code><code class="p">)</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">text</code><code class="p">(</code><code class="mf">0.2</code><code class="p">,</code> <code class="mf">0.2</code><code class="p">,</code> <code class="s2">". Figure: (0.2, 0.2)"</code><code class="p">,</code> <code class="n">transform</code><code class="o">=</code><code class="n">fig</code><code class="o">.</code><code class="n">transFigure</code><code class="p">);</code></pre>
<figure><div class="figure" id="fig_0409-text-and-annotation_files_in_output_11_0">
<img alt="output 11 0" height="200" src="assets/output_11_0.png" width="600"/>
<h6><span class="label">Figure 32-3. </span>Comparing Matplotlib’s coordinate systems</h6>
</div></figure>
<p>Matplotlib’s default text alignment is such that the “.”
at the beginning of each string will approximately mark the specified
coordinate location.</p>
<p>The <code>transData</code> coordinates give the usual data coordinates associated
with the x- and y-axis labels. The <code>transAxes</code> coordinates give the
location from the bottom-left 
<span class="keep-together">corner</span> of the axes (the white box),
as a fraction of the total axes size. The <code>transFigure</code> coordinates are
similar, but specify the position from the bottom-left corner of the
figure (the gray box) as a fraction of the total figure size.</p>
<p>Notice now that if we change the axes limits, it is only the <code>transData</code>
coordinates that will be affected, while the others remain stationary
(see <a data-type="xref" href="#fig_0409-text-and-annotation_files_in_output_13_0">Figure 32-4</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">ax</code><code class="o">.</code><code class="n">set_xlim</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">2</code><code class="p">)</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">set_ylim</code><code class="p">(</code><code class="o">-</code><code class="mi">6</code><code class="p">,</code> <code class="mi">6</code><code class="p">)</code>
        <code class="n">fig</code></pre>
<figure><div class="figure" id="fig_0409-text-and-annotation_files_in_output_13_0">
<img alt="output 13 0" height="392" src="assets/output_13_0.png" width="600"/>
<h6><span class="label">Figure 32-4. </span>Comparing Matplotlib’s coordinate systems</h6>
</div></figure>
<p>This behavior can be seen more clearly by changing the axes limits
interactively: if you are executing this code in a notebook, you can
make that happen by changing <code>%matplotlib inline</code> to
<code>%matplotlib notebook</code> and using each plot’s menu to
interact with the plot.<a data-startref="ix_ch32-asciidoc7" data-type="indexterm" id="idm45858754828208"/><a data-startref="ix_ch32-asciidoc6" data-type="indexterm" id="idm45858754827504"/><a data-startref="ix_ch32-asciidoc5" data-type="indexterm" id="idm45858754826832"/><a data-startref="ix_ch32-asciidoc4" data-type="indexterm" id="idm45858754826160"/></p>
</div></section>
<section data-pdf-bookmark="Arrows and Annotation" data-type="sect1"><div class="sect1" id="ch_0409-text-and-annotation_arrows-and-annotation">
<h1>Arrows and Annotation</h1>
<p><a data-primary="annotation of plots" data-secondary="arrows" data-type="indexterm" id="ix_ch32-asciidoc8"/><a data-primary="arrows" data-type="indexterm" id="ix_ch32-asciidoc9"/>Along with tickmarks and text, another useful annotation mark is the
simple arrow.</p>
<p>While there is a <code>plt.arrow</code> function available, I wouldn’t
suggest using it: the arrows it creates are SVG objects that will be
subject to the varying aspect ratio of your plots, making it tricky to
get them right. Instead, I’d suggest using the
<code>plt.annotate</code> function, which creates some text and an arrow and allows
the arrows to be very flexibly specified.</p>
<p>Here is a demonstration of <code>annotate</code> with several of its options (see
<a data-type="xref" href="#fig_0409-text-and-annotation_files_in_output_16_0">Figure 32-5</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">()</code>

        <code class="n">x</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">linspace</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">1000</code><code class="p">)</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">x</code><code class="p">,</code> <code class="n">np</code><code class="o">.</code><code class="n">cos</code><code class="p">(</code><code class="n">x</code><code class="p">))</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">axis</code><code class="p">(</code><code class="s1">'equal'</code><code class="p">)</code>

        <code class="n">ax</code><code class="o">.</code><code class="n">annotate</code><code class="p">(</code><code class="s1">'local maximum'</code><code class="p">,</code> <code class="n">xy</code><code class="o">=</code><code class="p">(</code><code class="mf">6.28</code><code class="p">,</code> <code class="mi">1</code><code class="p">),</code> <code class="n">xytext</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">4</code><code class="p">),</code>
                    <code class="n">arrowprops</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">facecolor</code><code class="o">=</code><code class="s1">'black'</code><code class="p">,</code> <code class="n">shrink</code><code class="o">=</code><code class="mf">0.05</code><code class="p">))</code>

        <code class="n">ax</code><code class="o">.</code><code class="n">annotate</code><code class="p">(</code><code class="s1">'local minimum'</code><code class="p">,</code> <code class="n">xy</code><code class="o">=</code><code class="p">(</code><code class="mi">5</code> <code class="o">*</code> <code class="n">np</code><code class="o">.</code><code class="n">pi</code><code class="p">,</code> <code class="o">-</code><code class="mi">1</code><code class="p">),</code> <code class="n">xytext</code><code class="o">=</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="o">-</code><code class="mi">6</code><code class="p">),</code>
                    <code class="n">arrowprops</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">arrowstyle</code><code class="o">=</code><code class="s2">"-&gt;"</code><code class="p">,</code>
                                    <code class="n">connectionstyle</code><code class="o">=</code><code class="s2">"angle3,angleA=0,angleB=-90"</code><code class="p">));</code></pre>
<figure><div class="figure" id="fig_0409-text-and-annotation_files_in_output_16_0">
<img alt="output 16 0" height="398" src="assets/output_16_0.png" width="600"/>
<h6><span class="label">Figure 32-5. </span>Annotation examples</h6>
</div></figure>
<p>The arrow style is controlled through the <code>arrowprops</code> dictionary, which
has numerous options available. These options are well documented in
Matplotlib’s online documentation, so rather than repeating
them here it is probably more useful to show some examples.
Let’s demonstrate several of the possible options using the
birthrate plot from before (see <a data-type="xref" href="#fig_0409-text-and-annotation_files_in_output_18_0">Figure 32-6</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">12</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>
        <code class="n">births_by_date</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">)</code>

        <code class="c1"># Add labels to the plot</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">annotate</code><code class="p">(</code><code class="s2">"New Year's Day"</code><code class="p">,</code> <code class="n">xy</code><code class="o">=</code><code class="p">(</code><code class="s1">'2012-1-1'</code><code class="p">,</code> <code class="mi">4100</code><code class="p">),</code>  <code class="n">xycoords</code><code class="o">=</code><code class="s1">'data'</code><code class="p">,</code>
                    <code class="n">xytext</code><code class="o">=</code><code class="p">(</code><code class="mi">50</code><code class="p">,</code> <code class="o">-</code><code class="mi">30</code><code class="p">),</code> <code class="n">textcoords</code><code class="o">=</code><code class="s1">'offset points'</code><code class="p">,</code>
                    <code class="n">arrowprops</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">arrowstyle</code><code class="o">=</code><code class="s2">"-&gt;"</code><code class="p">,</code>
                                    <code class="n">connectionstyle</code><code class="o">=</code><code class="s2">"arc3,rad=-0.2"</code><code class="p">))</code>

        <code class="n">ax</code><code class="o">.</code><code class="n">annotate</code><code class="p">(</code><code class="s2">"Independence Day"</code><code class="p">,</code> <code class="n">xy</code><code class="o">=</code><code class="p">(</code><code class="s1">'2012-7-4'</code><code class="p">,</code> <code class="mi">4250</code><code class="p">),</code>  <code class="n">xycoords</code><code class="o">=</code><code class="s1">'data'</code><code class="p">,</code>
                    <code class="n">bbox</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">boxstyle</code><code class="o">=</code><code class="s2">"round"</code><code class="p">,</code> <code class="n">fc</code><code class="o">=</code><code class="s2">"none"</code><code class="p">,</code> <code class="n">ec</code><code class="o">=</code><code class="s2">"gray"</code><code class="p">),</code>
                    <code class="n">xytext</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="o">-</code><code class="mi">40</code><code class="p">),</code> <code class="n">textcoords</code><code class="o">=</code><code class="s1">'offset points'</code><code class="p">,</code> <code class="n">ha</code><code class="o">=</code><code class="s1">'center'</code><code class="p">,</code>
                    <code class="n">arrowprops</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">arrowstyle</code><code class="o">=</code><code class="s2">"-&gt;"</code><code class="p">))</code>

        <code class="n">ax</code><code class="o">.</code><code class="n">annotate</code><code class="p">(</code><code class="s1">'Labor Day Weekend'</code><code class="p">,</code> <code class="n">xy</code><code class="o">=</code><code class="p">(</code><code class="s1">'2012-9-4'</code><code class="p">,</code> <code class="mi">4850</code><code class="p">),</code> <code class="n">xycoords</code><code class="o">=</code><code class="s1">'data'</code><code class="p">,</code>
                    <code class="n">ha</code><code class="o">=</code><code class="s1">'center'</code><code class="p">,</code> <code class="n">xytext</code><code class="o">=</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="o">-</code><code class="mi">20</code><code class="p">),</code> <code class="n">textcoords</code><code class="o">=</code><code class="s1">'offset points'</code><code class="p">)</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">annotate</code><code class="p">(</code><code class="s1">''</code><code class="p">,</code> <code class="n">xy</code><code class="o">=</code><code class="p">(</code><code class="s1">'2012-9-1'</code><code class="p">,</code> <code class="mi">4850</code><code class="p">),</code> <code class="n">xytext</code><code class="o">=</code><code class="p">(</code><code class="s1">'2012-9-7'</code><code class="p">,</code> <code class="mi">4850</code><code class="p">),</code>
                    <code class="n">xycoords</code><code class="o">=</code><code class="s1">'data'</code><code class="p">,</code> <code class="n">textcoords</code><code class="o">=</code><code class="s1">'data'</code><code class="p">,</code>
                    <code class="n">arrowprops</code><code class="o">=</code><code class="p">{</code><code class="s1">'arrowstyle'</code><code class="p">:</code> <code class="s1">'|-|,widthA=0.2,widthB=0.2'</code><code class="p">,</code> <code class="p">})</code>

        <code class="n">ax</code><code class="o">.</code><code class="n">annotate</code><code class="p">(</code><code class="s1">'Halloween'</code><code class="p">,</code> <code class="n">xy</code><code class="o">=</code><code class="p">(</code><code class="s1">'2012-10-31'</code><code class="p">,</code> <code class="mi">4600</code><code class="p">),</code>  <code class="n">xycoords</code><code class="o">=</code><code class="s1">'data'</code><code class="p">,</code>
                    <code class="n">xytext</code><code class="o">=</code><code class="p">(</code><code class="o">-</code><code class="mi">80</code><code class="p">,</code> <code class="o">-</code><code class="mi">40</code><code class="p">),</code> <code class="n">textcoords</code><code class="o">=</code><code class="s1">'offset points'</code><code class="p">,</code>
                    <code class="n">arrowprops</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">arrowstyle</code><code class="o">=</code><code class="s2">"fancy"</code><code class="p">,</code>
                                    <code class="n">fc</code><code class="o">=</code><code class="s2">"0.6"</code><code class="p">,</code> <code class="n">ec</code><code class="o">=</code><code class="s2">"none"</code><code class="p">,</code>
                                    <code class="n">connectionstyle</code><code class="o">=</code><code class="s2">"angle3,angleA=0,angleB=-90"</code><code class="p">))</code>

        <code class="n">ax</code><code class="o">.</code><code class="n">annotate</code><code class="p">(</code><code class="s1">'Thanksgiving'</code><code class="p">,</code> <code class="n">xy</code><code class="o">=</code><code class="p">(</code><code class="s1">'2012-11-25'</code><code class="p">,</code> <code class="mi">4500</code><code class="p">),</code>  <code class="n">xycoords</code><code class="o">=</code><code class="s1">'data'</code><code class="p">,</code>
                    <code class="n">xytext</code><code class="o">=</code><code class="p">(</code><code class="o">-</code><code class="mi">120</code><code class="p">,</code> <code class="o">-</code><code class="mi">60</code><code class="p">),</code> <code class="n">textcoords</code><code class="o">=</code><code class="s1">'offset points'</code><code class="p">,</code>
                    <code class="n">bbox</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">boxstyle</code><code class="o">=</code><code class="s2">"round4,pad=.5"</code><code class="p">,</code> <code class="n">fc</code><code class="o">=</code><code class="s2">"0.9"</code><code class="p">),</code>
                    <code class="n">arrowprops</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code>
                        <code class="n">arrowstyle</code><code class="o">=</code><code class="s2">"-&gt;"</code><code class="p">,</code>
                        <code class="n">connectionstyle</code><code class="o">=</code><code class="s2">"angle,angleA=0,angleB=80,rad=20"</code><code class="p">))</code>


        <code class="n">ax</code><code class="o">.</code><code class="n">annotate</code><code class="p">(</code><code class="s1">'Christmas'</code><code class="p">,</code> <code class="n">xy</code><code class="o">=</code><code class="p">(</code><code class="s1">'2012-12-25'</code><code class="p">,</code> <code class="mi">3850</code><code class="p">),</code>  <code class="n">xycoords</code><code class="o">=</code><code class="s1">'data'</code><code class="p">,</code>
                     <code class="n">xytext</code><code class="o">=</code><code class="p">(</code><code class="o">-</code><code class="mi">30</code><code class="p">,</code> <code class="mi">0</code><code class="p">),</code> <code class="n">textcoords</code><code class="o">=</code><code class="s1">'offset points'</code><code class="p">,</code>
                     <code class="n">size</code><code class="o">=</code><code class="mi">13</code><code class="p">,</code> <code class="n">ha</code><code class="o">=</code><code class="s1">'right'</code><code class="p">,</code> <code class="n">va</code><code class="o">=</code><code class="s2">"center"</code><code class="p">,</code>
                     <code class="n">bbox</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">boxstyle</code><code class="o">=</code><code class="s2">"round"</code><code class="p">,</code> <code class="n">alpha</code><code class="o">=</code><code class="mf">0.1</code><code class="p">),</code>
                     <code class="n">arrowprops</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">arrowstyle</code><code class="o">=</code><code class="s2">"wedge,tail_width=0.5"</code><code class="p">,</code> <code class="n">alpha</code><code class="o">=</code><code class="mf">0.1</code><code class="p">));</code>

        <code class="c1"># Label the axes</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">set</code><code class="p">(</code><code class="n">title</code><code class="o">=</code><code class="s1">'USA births by day of year (1969-1988)'</code><code class="p">,</code>
               <code class="n">ylabel</code><code class="o">=</code><code class="s1">'average daily births'</code><code class="p">)</code>

        <code class="c1"># Format the x-axis with centered month labels</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">set_major_locator</code><code class="p">(</code><code class="n">mpl</code><code class="o">.</code><code class="n">dates</code><code class="o">.</code><code class="n">MonthLocator</code><code class="p">())</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">set_minor_locator</code><code class="p">(</code><code class="n">mpl</code><code class="o">.</code><code class="n">dates</code><code class="o">.</code><code class="n">MonthLocator</code><code class="p">(</code><code class="n">bymonthday</code><code class="o">=</code><code class="mi">15</code><code class="p">))</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">set_major_formatter</code><code class="p">(</code><code class="n">plt</code><code class="o">.</code><code class="n">NullFormatter</code><code class="p">())</code>
        <code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">set_minor_formatter</code><code class="p">(</code><code class="n">mpl</code><code class="o">.</code><code class="n">dates</code><code class="o">.</code><code class="n">DateFormatter</code><code class="p">(</code><code class="s1">'%h'</code><code class="p">));</code>

        <code class="n">ax</code><code class="o">.</code><code class="n">set_ylim</code><code class="p">(</code><code class="mi">3600</code><code class="p">,</code> <code class="mi">5400</code><code class="p">);</code></pre>
<p>The variety of options make <code>annotate</code> powerful and flexible: you can
create nearly any arrow style you wish. Unfortunately, it also means
that these sorts of features often must be manually tweaked, a process
that can be very time-consuming when producing publication-quality
graphics! Finally, I’ll note that the preceding mix of
styles is by no means best practice for presenting data, but rather is
included as a demonstration of some of the available options.</p>
<p>More discussion and examples of available arrow and annotation styles
can be found in the Matplotlib
<a href="https://oreil.ly/abuPw">Annotations
tutorial</a><a data-startref="ix_ch32-asciidoc9" data-type="indexterm" id="idm45858754096704"/><a data-startref="ix_ch32-asciidoc8" data-type="indexterm" id="idm45858754096032"/>.<a data-startref="ix_ch32-asciidoc2" data-type="indexterm" id="idm45858754095232"/><a data-startref="ix_ch32-asciidoc1" data-type="indexterm" id="idm45858754094528"/><a data-startref="ix_ch32-asciidoc0" data-type="indexterm" id="idm45858754093856"/><a data-startref="ix_ch32-asciidoc0a" data-type="indexterm" id="idm45858754304176"/></p>
<figure><div class="figure" id="fig_0409-text-and-annotation_files_in_output_18_0">
<img alt="output 18 0" height="383" src="assets/output_18_0.png" width="600"/>
<h6><span class="label">Figure 32-6. </span>Annotated average birth rates by day<sup><a data-type="noteref" href="ch32.xhtml#idm45858754301680" id="idm45858754301680-marker">3</a></sup></h6>
</div></figure>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45858755315264"><sup><a href="ch32.xhtml#idm45858755315264-marker">1</a></sup> A full-size version of this figure can be found on <a href="https://oreil.ly/PDSH_GitHub">GitHub</a>.</p><p data-type="footnote" id="idm45858755112736"><sup><a href="ch32.xhtml#idm45858755112736-marker">2</a></sup> A full-size version of this figure can be found on <a href="https://oreil.ly/PDSH_GitHub">GitHub</a>.</p><p data-type="footnote" id="idm45858754301680"><sup><a href="ch32.xhtml#idm45858754301680-marker">3</a></sup> A full-size version of this figure can be found on <a href="https://oreil.ly/PDSH_GitHub">GitHub</a>.</p></div></div></section></div></body></html>