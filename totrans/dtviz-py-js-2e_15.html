<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 11. Exploring Data with pandas" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter_pandas_exploring">
<h1><span class="label">Chapter 11. </span>Exploring Data with pandas</h1>
<p>In the previous chapter, we cleaned the Nobel Prize dataset that we scraped from Wikipedia in <a data-type="xref" href="ch06.xhtml#chapter_heavy_scraping">Chapter 6</a>. <a data-primary="pandas" data-secondary="exploring data with" data-type="indexterm" id="ix_pndsexp"/>Now it’s time to start exploring our shiny new dataset, looking for interesting patterns, stories to tell, and anything else that could form the basis for an interesting visualization.</p>
<p>First off, let’s try to clear our minds and take a long, hard look at the data to hand to get a broad idea of the visualizations suggested. <a data-type="xref" href="#explore_JSON">Example 11-1</a> shows the form of the Nobel dataset, with categorical, temporal, and geographical data.<a data-primary="pandas" data-secondary="exploring data with" data-tertiary="cleaned Nobel Prize dataset" data-type="indexterm" id="idm45607765467136"/></p>
<div data-type="example" id="explore_JSON">
<h5><span class="label">Example 11-1. </span>Our cleaned Nobel Prize dataset</h5>
<pre data-code-language="python" data-type="programlisting"><code class="p">[{</code>
 <code class="s1">'category'</code><code class="p">:</code> <code class="s1">'Physiology or Medicine'</code><code class="p">,</code>
 <code class="s1">'date_of_birth'</code><code class="p">:</code> <code class="s1">'8 October 1927'</code><code class="p">,</code>
 <code class="s1">'date_of_death'</code><code class="p">:</code> <code class="s1">'24 March 2002'</code><code class="p">,</code>
 <code class="s1">'gender'</code><code class="p">:</code> <code class="s1">'male'</code><code class="p">,</code>
 <code class="s1">'link'</code><code class="p">:</code> <code class="s1">'http://en.wikipedia.org/wiki/C%C3%A9sar_Milstein'</code><code class="p">,</code>
 <code class="s1">'name'</code><code class="p">:</code> <code class="s1">'César Milstein'</code>
 <code class="s1">'country'</code><code class="p">:</code> <code class="s1">'Argentina'</code><code class="p">,</code>
 <code class="s1">'place_of_birth'</code><code class="p">:</code> <code class="s1">'Bahía Blanca,  Argentina'</code><code class="p">,</code>
 <code class="s1">'place_of_death'</code><code class="p">:</code> <code class="s1">'Cambridge , England'</code><code class="p">,</code>
 <code class="s1">'year'</code><code class="p">:</code> <code class="mi">1984</code><code class="p">,</code>
 <code class="s1">'born_in'</code><code class="p">:</code> <code class="n">NaN</code>
 <code class="p">},</code>
 <code class="o">...</code>
 <code class="p">]</code></pre></div>
<p class="pagebreak-before">The data in <a data-type="xref" href="#explore_JSON">Example 11-1</a> suggests a <a data-primary="pandas" data-secondary="exploring data with" data-tertiary="stories to investigate in Nobel Prize dataset" data-type="indexterm" id="idm45607765434144"/>number of <em>stories</em> we might want to investigate, among them:</p>
<ul>
<li>
<p>Gender disparities among the prize winners</p>
</li>
<li>
<p>National trends (e.g., which country has most prizes in Economics)</p>
</li>
<li>
<p>Details about individual winners, such as their average age on receiving the prize or life expectancy</p>
</li>
<li>
<p>Geographical journey from place of birth to adopted country using the <code>born_in</code> and <code>country</code> fields</p>
</li>
</ul>
<p>These investigative lines form the basis for the coming sections, which will probe the dataset by asking questions of it, such as “How many women other than Marie Curie have won the Nobel Prize for Physics?”, “Which countries have the most prizes per capita
rather than absolute?”, and “Is there a historical trend to prizes by nation, a changing of the guard from old (science) world (big European
nations) to new (US and upcoming Asian nations)?”
Before beginning our explorations, let’s ready our tools and load our Nobel Prize dataset.</p>
<section data-pdf-bookmark="Starting to Explore" data-type="sect1"><div class="sect1" id="idm45607765426928">
<h1>Starting to Explore</h1>
<p>To start our exploration, let’s fire up a <a data-primary="pandas" data-secondary="exploring data with" data-tertiary="starting to explore" data-type="indexterm" id="ix_pndsexpstrt"/>Jupyter notebook from the command line:</p>
<pre data-type="programlisting">$ jupyter notebook</pre>
<p>We’ll use the <em>magic</em> <code>matplotlib</code> command to <a data-primary="magic commands" data-secondary="%matplotlib" data-type="indexterm" id="idm45607765368480"/>enable inline plotting:</p>
<pre data-code-language="python" data-type="programlisting"><code class="o">%</code><code class="n">matplotlib</code> <code class="n">inline</code></pre>
<p>Then import the <a data-primary="data exploration modules, standard" data-type="indexterm" id="idm45607765364048"/>standard set of data exploration modules:</p>
<pre data-code-language="python" data-type="programlisting"><code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>
<code class="kn">import</code> <code class="nn">numpy</code> <code class="k">as</code> <code class="nn">np</code>
<code class="kn">import</code> <code class="nn">matplotlib.pyplot</code> <code class="k">as</code> <code class="nn">plt</code>
<code class="kn">import</code> <code class="nn">json</code>
<code class="kn">import</code> <code class="nn">matplotlib</code>
<code class="kn">import</code> <code class="nn">seaborn</code> <code class="k">as</code> <code class="nn">sns</code></pre>
<p>Now we’ll make a few adjustments to the plotting parameters and the general look and feel of the charts.<a data-primary="Matplotlib" data-secondary="changing style before plotting charts" data-type="indexterm" id="idm45607765322640"/> Make sure to change the style <em>before</em> adjusting figure sizes, fonts, and the rest:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">matplotlib</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">use</code><code class="p">(</code><code class="s1">'</code><code class="s1">seaborn</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO1-1" id="co_exploring_data_with_pandas_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>
</code><code class="n">plt</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">figure.figsize</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="mi">8</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO1-2" id="co_exploring_data_with_pandas_CO1-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code class="n">plt</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">font.size</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">14</code><code class="s1">'</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO1-1" id="callout_exploring_data_with_pandas_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>We’ll use the seaborn theming for our charts, arguably more attractive than Matplotlib’s default.<a data-primary="seaborn library" data-secondary="themes for charts" data-type="indexterm" id="idm45607765257024"/></p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO1-2" id="callout_exploring_data_with_pandas_CO1-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Sets the<a data-primary="figures (Matplotlib)" data-secondary="setting size" data-type="indexterm" id="idm45607765253632"/> default plotting size to eight inches by four.</p></dd>
</dl>
<p>At the end of <a data-type="xref" href="ch09.xhtml#chapter_cleaning">Chapter 9</a>, we saved our clean dataset as a JSON file. Let’s load the clean data into a pandas
DataFrame, ready to begin exploring.<a data-primary="DataFrames" data-secondary="loading JSON data into" data-type="indexterm" id="idm45607765251152"/></p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_json</code><code class="p">(</code><code class="nb">open</code><code class="p">(</code><code class="s1">'data/nobel_winners_cleaned.json'</code><code class="p">))</code></pre>
<p>Let’s get some basic information about our dataset’s structure:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code><code class="o">.</code><code class="n">info</code><code class="p">()</code>

<code class="o">&lt;</code><code class="k">class</code> <code class="err">'</code><code class="nc">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">frame</code><code class="o">.</code><code class="n">DataFrame</code><code class="s1">'&gt;</code>
<code class="n">RangeIndex</code><code class="p">:</code> <code class="mi">858</code> <code class="n">entries</code><code class="p">,</code> <code class="mi">0</code> <code class="n">to</code> <code class="mi">857</code>
<code class="n">Data</code> <code class="n">columns</code> <code class="p">(</code><code class="n">total</code> <code class="mi">13</code> <code class="n">columns</code><code class="p">):</code>
 <code class="c1">#   Column          Non-Null Count  Dtype</code>
<code class="o">---</code>  <code class="o">------</code>          <code class="o">--------------</code>  <code class="o">-----</code>
 <code class="mi">0</code>   <code class="n">category</code>        <code class="mi">858</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">1</code>   <code class="n">country</code>         <code class="mi">858</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">2</code>   <code class="n">date_of_birth</code>   <code class="mi">858</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">3</code>   <code class="n">date_of_death</code>   <code class="mi">559</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">4</code>   <code class="n">gender</code>          <code class="mi">858</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">5</code>   <code class="n">link</code>            <code class="mi">858</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">6</code>   <code class="n">name</code>            <code class="mi">858</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">7</code>   <code class="n">place_of_birth</code>  <code class="mi">831</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">8</code>   <code class="n">place_of_death</code>  <code class="mi">524</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">9</code>   <code class="n">text</code>            <code class="mi">858</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">10</code>  <code class="n">year</code>            <code class="mi">858</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="n">int64</code>
 <code class="mi">11</code>  <code class="n">award_age</code>       <code class="mi">858</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="n">int64</code>
 <code class="mi">12</code>  <code class="n">born_in</code>         <code class="mi">102</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">13</code>  <code class="n">bio_image</code>       <code class="mi">770</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
 <code class="mi">14</code>  <code class="n">mini_bio</code>        <code class="mi">857</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>    <code class="nb">object</code>
<code class="n">dtypes</code><code class="p">:</code> <code class="n">int64</code><code class="p">(</code><code class="mi">2</code><code class="p">),</code> <code class="nb">object</code><code class="p">(</code><code class="mi">13</code><code class="p">)</code>
<code class="n">memory</code> <code class="n">usage</code><code class="p">:</code> <code class="mf">100.7</code><code class="o">+</code> <code class="n">KB</code></pre>
<p>Note that our dates of birth and death columns have the standard pandas datatype of <code>object</code>. <a data-primary="object type" data-type="indexterm" id="idm45607765107840"/><a data-primary="datetime object (Python)" data-secondary="converting pandas objects to" data-type="indexterm" id="idm45607765107232"/><a data-primary="to_datetime method (pandas)" data-type="indexterm" id="idm45607765106352"/>In order to make date comparisons, we’ll need to convert those to the datetime type, <code>datetime64</code>. We can use pandas’s <a href="https://oreil.ly/jjcoR"><code>to_datetime</code> method</a> to achieve this conversion:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code><code class="o">.</code><code class="n">date_of_birth</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">to_datetime</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_birth</code><code class="p">)</code>
<code class="n">df</code><code class="o">.</code><code class="n">date_of_death</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">to_datetime</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_death</code><code class="p">)</code></pre>
<p>Running <code>df.info()</code> should now show two datetime columns:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="p">)</code><code>
</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code class="n">date_of_birth</code><code>     </code><code class="mi">858</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code> </code><code class="n">datetime64</code><code class="p">[</code><code class="n">ns</code><code class="p">,</code><code> </code><code class="n">UTC</code><code class="p">]</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO2-1" id="co_exploring_data_with_pandas_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code class="n">date_of_death</code><code>     </code><code class="mi">559</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code> </code><code class="n">datetime64</code><code class="p">[</code><code class="n">ns</code><code class="p">,</code><code> </code><code class="n">UTC</code><code class="p">]</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO2-1" id="callout_exploring_data_with_pandas_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p><a href="https://oreil.ly/ZzSOR">UTC</a> (Coordinated Universal Time in English) is the primary time standard by which the world regulates clocks and time. It’s almost always desirable to work to this standard.<a data-primary="UTC (Coordinated Universal Time)" data-type="indexterm" id="idm45607764865456"/><a data-primary="Coordinated Universal Time (UTC)" data-type="indexterm" id="idm45607764864784"/></p></dd>
</dl>
<p><code>to_datetime</code> usually works without needing extra arguments and should throw an error if given non time-based data, but it’s worth checking the converted columns to make sure. In the case of our Nobel Prize dataset, everything checks out.<a data-primary="pandas" data-secondary="exploring data with" data-startref="ix_pndsexpstrt" data-tertiary="starting to explore" data-type="indexterm" id="idm45607764863376"/></p>
</div></section>
<section data-pdf-bookmark="Plotting with pandas" data-type="sect1"><div class="sect1" id="idm45607765373072">
<h1>Plotting with pandas</h1>
<p>Both pandas Series and DataFrames have integrated plotting, which wraps the most common Matplotlib charts, a few of which we explored in the last chapter.<a data-primary="pandas" data-secondary="exploring data with" data-tertiary="plotting with pandas" data-type="indexterm" id="idm45607764860496"/><a data-primary="plotting with pandas" data-seealso="Matplotlib" data-type="indexterm" id="idm45607764828544"/> This makes it easy to get quick visual feedback as you interact with your DataFrame. And if you want to visualize something a little more complicated, the pandas containers will play nicely with vanilla Matplotlib. You can also adapt the plots produced by pandas using standard Matplotlib customizations.</p>
<p>Let’s look at an example of pandas’s integrated plotting, starting with a basic plot of gender disparity in Nobel Prize wins.
Notoriously, the Nobel Prize has been distributed unequally among the genders. Let’s get a quick feel for that disparity by using a bar plot on the <em>gender</em> category. <a data-type="xref" href="#explore_gender_code">Example 11-2</a> produces <a data-type="xref" href="#explore_gender">Figure 11-1</a>, showing the huge difference, with males receiving 811 of the 858 prizes in our dataset.</p>
<div data-type="example" id="explore_gender_code">
<h5><span class="label">Example 11-2. </span>Using pandas’s integrated plotting to see gender disparities</h5>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_gender</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'gender'</code><code class="p">)</code>
<code class="n">by_gender</code><code class="o">.</code><code class="n">size</code><code class="p">()</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">)</code></pre></div>
<figure><div class="figure" id="explore_gender">
<img alt="dpj2 1101" height="1076" src="assets/dpj2_1101.png" width="2272"/>
<h6><span class="label">Figure 11-1. </span>Prize counts by gender</h6>
</div></figure>
<p>In <a data-type="xref" href="#explore_gender_code">Example 11-2</a>, the Series produced by the gender group’s <code>size</code> method has its own integrated <code>plot</code> method, which turns the raw numbers into a chart:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_gender</code><code class="o">.</code><code class="n">size</code><code class="p">()</code>
<code class="n">Out</code><code class="p">:</code>
<code class="n">gender</code>
<code class="n">female</code>     <code class="mi">47</code>
<code class="n">male</code>      <code class="mi">811</code>
<code class="n">dtype</code><code class="p">:</code> <code class="n">int64</code></pre>
<p>In addition to the default line plot, the pandas <code>plot</code> method takes a <code>kind</code> argument to select among other possible plots.<a data-primary="plotting with pandas" data-secondary="types of plots" data-type="indexterm" id="idm45607764765344"/> Among the more commonly used are:</p>
<ul>
<li>
<p><code>bar</code> or <code>barh</code> (<em>h</em> for horizontal) for bar plots</p>
</li>
<li>
<p><code>hist</code> for a histogram</p>
</li>
<li>
<p><code>box</code> for a box plot</p>
</li>
<li>
<p><code>scatter</code> for scatter plots</p>
</li>
</ul>
<p>You can find a full list of pandas’s integrated plots  <a href="https://oreil.ly/Zeo9f">in the docs</a> as well as some pandas plotting functions that take DataFrames and Series as <span class="keep-together">arguments</span>.</p>
<p>Let’s extend our investigation into gender disparities and start extending our plotting know-how.</p>
</div></section>
<section data-pdf-bookmark="Gender Disparities" data-type="sect1"><div class="sect1" id="idm45607764861600">
<h1>Gender Disparities</h1>
<p>Let’s break down the gender numbers shown in <a data-type="xref" href="#explore_gender">Figure 11-1</a> by category of prize. pandas’s <code>groupby</code> method can take a list of columns to group by, with each group being accessed by multiple keys:<a data-primary="pandas" data-secondary="exploring data with" data-tertiary="gender disparities in Nobel Prize winner dataset" data-type="indexterm" id="ix_pndsexpgndr"/><a data-primary="gender disparities in Nobel Prize winners, exploring" data-type="indexterm" id="ix_gndrdisp"/></p>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_cat_gen</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">category</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">gender</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>
</code><code>
</code><code class="n">by_cat_gen</code><code class="o">.</code><code class="n">get_group</code><code class="p">(</code><code class="p">(</code><code class="s1">'</code><code class="s1">Physics</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">female</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code class="p">[</code><code class="p">[</code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">]</code><code class="p">]</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO3-1" id="co_exploring_data_with_pandas_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO3-1" id="callout_exploring_data_with_pandas_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Gets a group using a <code>category</code> and <code>gender</code> key:</p></dd>
</dl>
<pre data-type="programlisting">Out:
                       name  year
269    Maria Goeppert-Mayer  1963
612  Marie Skłodowska-Curie  1903</pre>
<p>Using the <code>size</code> method to get the size of these groups returns a Series with a <code>MultiIndex</code> that labels the values by both category and gender:</p>
<pre class="pagebreak-before less_space" data-code-language="python" data-type="programlisting"><code class="n">by_cat_gen</code><code class="o">.</code><code class="n">size</code><code class="p">()</code></pre>
<pre data-type="programlisting">Out:
category                gender
Chemistry               female      4
                        male      167
Economics               female      1
                        male       74
...
Physiology or Medicine  female     11
                        male      191
dtype: int64</pre>
<p>We can plot this multi-indexed Series directly, using <code>hbar</code> as the <code>kind</code> argument to produce a horizontal bar chart. This code produces <a data-type="xref" href="#explore_cat_gen">Figure 11-2</a>.</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_cat_gen</code><code class="o">.</code><code class="n">size</code><code class="p">()</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'barh'</code><code class="p">)</code></pre>
<figure><div class="figure" id="explore_cat_gen">
<img alt="dpj2 1102" height="1063" src="assets/dpj2_1102.png" width="2274"/>
<h6><span class="label">Figure 11-2. </span>Plotting multikey groups</h6>
</div></figure>
<p><a data-type="xref" href="#explore_cat_gen">Figure 11-2</a> is a little crude and makes comparing gender disparities harder than it should be. Let’s go about refining our charts to make those disparities clearer.</p>
<section data-pdf-bookmark="Unstacking Groups" data-type="sect2"><div class="sect2" id="idm45607764609504">
<h2>Unstacking Groups</h2>
<p><a data-type="xref" href="#explore_cat_gen">Figure 11-2</a> isn’t the easiest chart to read, even were we to improve the sorting of the bars. <a data-primary="groups" data-secondary="unstacking in pandas bar chart" data-type="indexterm" id="idm45607764606784"/>Handily, pandas Series has a cool <code>unstack</code> method that takes the multiple indices—​in this case, gender and category—​and uses them as columns and indices, respectively, to create a new DataFrame. Plotting this DataFrame gives a much <span class="keep-together">more usable</span> plot, as it compares prize wins by gender. The following code produces <a data-type="xref" href="#explore_cat_gen_unstack">Figure 11-3</a>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_cat_gen</code><code class="o">.</code><code class="n">size</code><code class="p">()</code><code class="o">.</code><code class="n">unstack</code><code class="p">()</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'barh'</code><code class="p">)</code></pre>
<figure><div class="figure" id="explore_cat_gen_unstack">
<img alt="dpj2 1103" height="1063" src="assets/dpj2_1103.png" width="2271"/>
<h6><span class="label">Figure 11-3. </span>Unstacked Series of group sizes</h6>
</div></figure>
<p><a data-type="xref" href="#explore_cat_gen_unstack">Figure 11-3</a> shows a huge discrepancy between male and female prize numbers. Let’s make the data a little more concrete by using pandas to produce a chart showing the percentage of female winners by category. We’ll also order the category bars by prize haul.</p>
<p>First, we’ll unstack the <code>by_cat_gen</code> group to produce a <code>cat_gen_sz</code> DataFrame:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">cat_gen_sz</code> <code class="o">=</code> <code class="n">by_cat_gen</code><code class="o">.</code><code class="n">size</code><code class="p">()</code><code class="o">.</code><code class="n">unstack</code><code class="p">()</code>
<code class="n">cat_gen_sz</code><code class="o">.</code><code class="n">head</code><code class="p">()</code></pre>
<pre data-type="programlisting">gender      female  male
category
Chemistry        4   167
Economics        1    74
Literature      13    93
Peace           16    87
Physics          2   199</pre>
<p>We’ll do the pandas manipulation in two stages for demonstration purposes, using two new columns to store our new data. First, we’ll make a column containing the ratio of female winners to the total number of winners:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">cat_gen_sz</code><code class="p">[</code><code class="s1">'</code><code class="s1">ratio</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">cat_gen_sz</code><code class="o">.</code><code class="n">female</code><code> </code><code class="o">/</code><code>\</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO4-1" id="co_exploring_data_with_pandas_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>                     </code><code class="p">(</code><code class="n">cat_gen_sz</code><code class="o">.</code><code class="n">female</code><code> </code><code class="o">+</code><code> </code><code class="n">cat_gen_sz</code><code class="o">.</code><code class="n">male</code><code class="p">)</code><code>
</code><code class="n">cat_gen_sz</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO4-1" id="callout_exploring_data_with_pandas_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The awkward forward slash stops Python breaking, but this is a division <span class="keep-together">operation</span>.</p></dd>
</dl>
<pre data-type="programlisting">ender      female  male     ratio
category
Chemistry        4   167  0.023392
Economics        1    74  0.013333
Literature      13    93  0.122642
Peace           16    87  0.155340
Physics          2   199  0.009950</pre>
<p>With the ratio column in place, we can create a column containing percentage of female winners by multiplying that ratio by 100:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">cat_gen_sz</code><code class="p">[</code><code class="s1">'female_pc'</code><code class="p">]</code> <code class="o">=</code> <code class="n">cat_gen_sz</code><code class="p">[</code><code class="s1">'ratio'</code><code class="p">]</code> <code class="o">*</code> <code class="mi">100</code></pre>
<p>Let’s plot these female percentages on a horizontal bar chart, setting an x-limit of 100 (%) and sorting the categories by prize number:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">cat_gen_sz</code> <code class="o">=</code> <code class="n">cat_gen_sz</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="n">by</code><code class="o">=</code><code class="s1">'female_pc'</code><code class="p">,</code> <code class="n">ascending</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code>
<code class="n">ax</code> <code class="o">=</code> <code class="n">cat_gen_sz</code><code class="p">[[</code><code class="s1">'female_pc'</code><code class="p">]]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'barh'</code><code class="p">)</code>
<code class="n">ax</code><code class="o">.</code><code class="n">set_xlim</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code> <code class="mi">100</code><code class="p">])</code>
<code class="n">ax</code><code class="o">.</code><code class="n">set_xlabel</code><code class="p">(</code><code class="s1">'</code><code class="si">% o</code><code class="s1">f female winners'</code><code class="p">)</code></pre>
<p>You can see the new plot in <a data-type="xref" href="#img_female_pc">Figure 11-4</a>, clearly showing the discrepancy in prize totals by gender.</p>
<figure><div class="figure" id="img_female_pc">
<img alt="dpj2 1104" height="1065" src="assets/dpj2_1104.png" width="2269"/>
<h6><span class="label">Figure 11-4. </span>Percentage of winning females by prize category</h6>
</div></figure>
<p>Ignoring Economics, a recent and contentious addition to the Nobel Prize categories, <a data-type="xref" href="#img_female_pc">Figure 11-4</a> shows that the largest discrepancy in the number of male and female prize winners is in Physics, with only two female winners. Let’s remind ourselves who they are:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code><code class="p">[(</code><code class="n">df</code><code class="o">.</code><code class="n">category</code> <code class="o">==</code> <code class="s1">'Physics'</code><code class="p">)</code> <code class="o">&amp;</code> <code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">gender</code> <code class="o">==</code> <code class="s1">'female'</code><code class="p">)]</code>\
    <code class="p">[[</code><code class="s1">'name'</code><code class="p">,</code> <code class="s1">'country'</code><code class="p">,</code><code class="s1">'year'</code><code class="p">]]</code></pre>
<pre data-type="programlisting">Out:
                       name    country  year
269    Maria Goeppert-Mayer  United States  1963
612  Marie Skłodowska-Curie         Poland  1903</pre>
<p>While most people will have heard of Marie Curie, who is actually one of the four illustrious winners of two Nobel Prizes, few have heard of Maria Goeppert-Mayer.<sup><a data-type="noteref" href="ch11.xhtml#idm45607764293184" id="idm45607764293184-marker">1</a></sup> This ignorance is surprising, given the drive to encourage women into science. I would want my visualization to enable people to discover and learn a little about Maria Goeppert-Mayer.</p>
</div></section>
<section data-pdf-bookmark="Historical Trends" data-type="sect2"><div class="sect2" id="idm45607764608592">
<h2>Historical Trends</h2>
<p>It would be interesting to see if there has been any increase in female prize allocation in recent years.<a data-primary="historical trends, exploring" data-secondary="gender of Nobel Prize winners" data-type="indexterm" id="ix_histtrndgndr"/><a data-primary="gender disparities in Nobel Prize winners, exploring" data-secondary="historical trends" data-type="indexterm" id="idm45607764289392"/> One way to visualize this would be as grouped bars over time. Let’s run up a quick plot, using <code>unstack</code> as in <a data-type="xref" href="#explore_cat_gen_unstack">Figure 11-3</a> but using the year and gender columns:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_year_gender</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">([</code><code class="s1">'year'</code><code class="p">,</code><code class="s1">'gender'</code><code class="p">])</code>
<code class="n">year_gen_sz</code> <code class="o">=</code> <code class="n">by_year_gender</code><code class="o">.</code><code class="n">size</code><code class="p">()</code><code class="o">.</code><code class="n">unstack</code><code class="p">()</code>
<code class="n">year_gen_sz</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">16</code><code class="p">,</code><code class="mi">4</code><code class="p">))</code></pre>
<p><a data-type="xref" href="#explore_year_gen">Figure 11-5</a>, the hard-to-read plot produced, is only functional. The trend of female prize distributions can be observed, but the plot has many problems. Let’s use Matplotlib’s and pandas’s eminent flexibility to fix them.</p>
<figure><div class="figure" id="explore_year_gen">
<img alt="dpj2 1105" height="1075" src="assets/dpj2_1105.png" width="4666"/>
<h6><span class="label">Figure 11-5. </span>Prizes by year and gender</h6>
</div></figure>
<p>The first thing we need to do is reduce the number of x-axis labels.<a data-primary="labels" data-secondary="reducing number of x-axis labels in pandas plot" data-type="indexterm" id="idm45607764222448"/> By default, Matplotlib will label each bar or bar group of a bar plot, which in the case of our hundred years of prizes creates a mess of labels. What we need is the ability to thin out the number of axis labels as desired. There are various ways to do this in Matplotlib; I’ll demonstrate the one I’ve found to be most reliable. It’s the sort of thing you’re going to want to reuse, so it makes sense to stick it in a dedicated function. <a data-type="xref" href="#explore_thin_axis">Example 11-3</a> shows a function to reduce the number of ticks on our x-axis.</p>
<div data-type="example" id="explore_thin_axis">
<h5><span class="label">Example 11-3. </span>Reducing the number of x-axis labels</h5>
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code><code> </code><code class="nf">thin_xticks</code><code class="p">(</code><code class="n">ax</code><code class="p">,</code><code> </code><code class="n">tick_gap</code><code class="o">=</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="n">rotation</code><code class="o">=</code><code class="mi">45</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="sd">""" Thin x-ticks and adjust rotation """</code><code>
</code><code>    </code><code class="n">ticks</code><code> </code><code class="o">=</code><code> </code><code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">get_ticklocs</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO5-1" id="co_exploring_data_with_pandas_CO5-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>    </code><code class="n">ticklabels</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="n">l</code><code class="o">.</code><code class="n">get_text</code><code class="p">(</code><code class="p">)</code><code>
</code><code>                  </code><code class="k">for</code><code> </code><code class="n">l</code><code> </code><code class="ow">in</code><code> </code><code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">get_ticklabels</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO5-1" id="co_exploring_data_with_pandas_CO5-2"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>    </code><code class="c1"># Sets the new tick locations and labels at an interval</code><code>
</code><code>    </code><code class="c1"># of tick_gap (default +10+):</code><code>
</code><code>    </code><code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">set_ticks</code><code class="p">(</code><code class="n">ticks</code><code class="p">[</code><code class="p">:</code><code class="p">:</code><code class="n">tick_gap</code><code class="p">]</code><code class="p">)</code><code>
</code><code>    </code><code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">set_ticklabels</code><code class="p">(</code><code class="n">ticklabels</code><code class="p">[</code><code class="p">:</code><code class="p">:</code><code class="n">tick_gap</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                            </code><code class="n">rotation</code><code class="o">=</code><code class="n">rotation</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO5-2" id="co_exploring_data_with_pandas_CO5-3"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>    </code><code class="n">ax</code><code class="o">.</code><code class="n">figure</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO5-1" id="callout_exploring_data_with_pandas_CO5-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Gets the existing locations and labels of the x-ticks, currently one per bar.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO5-3" id="callout_exploring_data_with_pandas_CO5-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Rotates the labels for readability, by default on an upward <span class="keep-together">diagonal</span>.</p></dd>
</dl></div>
<p>As well as needing to reduce the number of ticks, the x-axis in <a data-type="xref" href="#explore_year_gen">Figure 11-5</a> has a discontinuous range, missing the years 1939–1945 of WWII, during which no Nobel Prizes were presented. We want to see such gaps, so we need to set the x-axis range manually to include all years from the start of the Nobel Prize to the current day.</p>
<p>The current unstacked group sizes use an automatic year index:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_year_gender</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">([</code><code class="s1">'year'</code><code class="p">,</code> <code class="s1">'gender'</code><code class="p">])</code>
<code class="n">by_year_gender</code><code class="o">.</code><code class="n">size</code><code class="p">()</code><code class="o">.</code><code class="n">unstack</code><code class="p">()</code>
<code class="n">Out</code><code class="p">:</code>
<code class="n">gender</code>  <code class="n">female</code>  <code class="n">male</code>
<code class="n">year</code>
<code class="mi">1901</code>       <code class="n">NaN</code>     <code class="mf">6.0</code>
<code class="mi">1902</code>       <code class="n">NaN</code>     <code class="mf">7.0</code>
<code class="o">...</code>
<code class="mi">2014</code>         <code class="mf">2.0</code>    <code class="mf">11.0</code>
<code class="p">[</code><code class="mi">111</code> <code class="n">rows</code> <code class="n">x</code> <code class="mi">2</code> <code class="n">columns</code><code class="p">]</code></pre>
<p>In order to see any gaps in the prize distribution, all we have to do is reindex this Series with one containing <a data-primary="indices" data-secondary="Series full-range index of years for Nobel Prize" data-type="indexterm" id="idm45607764001200"/>the full range of years:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">new_index</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">Index</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="mi">1901</code><code class="p">,</code><code> </code><code class="mi">2015</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">name</code><code class="o">=</code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO6-1" id="co_exploring_data_with_pandas_CO6-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code class="n">by_year_gender</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">gender</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>
</code><code class="n">year_gen_sz</code><code> </code><code class="o">=</code><code> </code><code class="n">by_year_gender</code><code class="o">.</code><code class="n">size</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">unstack</code><code class="p">(</code><code class="p">)</code><code>
</code><code>  </code><code class="o">.</code><code class="n">reindex</code><code class="p">(</code><code class="n">new_index</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO6-2" id="co_exploring_data_with_pandas_CO6-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO6-1" id="callout_exploring_data_with_pandas_CO6-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Here we create a full-range index named <code>year</code>, covering all the Nobel Prize years.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO6-2" id="callout_exploring_data_with_pandas_CO6-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We replace our discontinuous index with the new continuous one.</p></dd>
</dl>
<p>Another problem with <a data-type="xref" href="#explore_year_gen">Figure 11-5</a> is the excessive number of bars. Although we do get male and female bars side by side, it looks messy and has aliasing artifacts too.<a data-primary="bar charts" data-secondary="stacked" data-type="indexterm" id="idm45607763940912"/><a data-primary="stacked bars" data-type="indexterm" id="idm45607763939968"/> It’s better to have dedicated male and female plots but stacked so as to allow easy comparison. <a data-primary="subplots (Matplotlib)" data-type="indexterm" id="idm45607763939056"/>We can achieve this using the subplotting method we saw in <a data-type="xref" href="ch10.xhtml#mpl_axes_subplots">“Axes and Subplots”</a>, using the pandas data but customizing the plot using our Matplotlib know-how. <a data-type="xref" href="#explore_year_gen_stack_code">Example 11-4</a> shows how to do this, producing the plot in <a data-type="xref" href="#explore_year_gen_stack">Figure 11-6</a>.</p>
<div data-type="example" id="explore_year_gen_stack_code">
<h5><span class="label">Example 11-4. </span>Stacked gender prizes by year</h5>
<pre data-code-language="python" data-type="programlisting"><code class="n">new_index</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">Index</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="mi">1901</code><code class="p">,</code><code> </code><code class="mi">2015</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">name</code><code class="o">=</code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="n">by_year_gender</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">gender</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>
</code><code>
</code><code class="n">year_gen_sz</code><code> </code><code class="o">=</code><code> </code><code class="n">by_year_gender</code><code class="o">.</code><code class="n">size</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">unstack</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">reindex</code><code class="p">(</code><code class="n">new_index</code><code class="p">)</code><code>
</code><code>
</code><code class="n">fig</code><code class="p">,</code><code> </code><code class="n">axes</code><code> </code><code class="o">=</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">nrows</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">ncols</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO7-1" id="co_exploring_data_with_pandas_CO7-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>            </code><code class="n">sharex</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code><code> </code><code class="n">sharey</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code><code> </code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">16</code><code class="p">,</code><code> </code><code class="mi">8</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO7-2" id="co_exploring_data_with_pandas_CO7-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>
</code><code class="n">ax_f</code><code> </code><code class="o">=</code><code> </code><code class="n">axes</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code>
</code><code class="n">ax_m</code><code> </code><code class="o">=</code><code> </code><code class="n">axes</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code>
</code><code>
</code><code class="n">fig</code><code class="o">.</code><code class="n">suptitle</code><code class="p">(</code><code class="s1">'</code><code class="s1">Nobel Prize-winners by gender</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">fontsize</code><code class="o">=</code><code class="mi">16</code><code class="p">)</code><code>
</code><code>
</code><code class="n">ax_f</code><code class="o">.</code><code class="n">bar</code><code class="p">(</code><code class="n">year_gen_sz</code><code class="o">.</code><code class="n">index</code><code class="p">,</code><code> </code><code class="n">year_gen_sz</code><code class="o">.</code><code class="n">female</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO7-3" id="co_exploring_data_with_pandas_CO7-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code class="n">ax_f</code><code class="o">.</code><code class="n">set_ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Female winners</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>
</code><code class="n">ax_m</code><code class="o">.</code><code class="n">bar</code><code class="p">(</code><code class="n">year_gen_sz</code><code class="o">.</code><code class="n">index</code><code class="p">,</code><code> </code><code class="n">year_gen_sz</code><code class="o">.</code><code class="n">male</code><code class="p">)</code><code>
</code><code class="n">ax_m</code><code class="o">.</code><code class="n">set_ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Male winners</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>
</code><code class="n">ax_m</code><code class="o">.</code><code class="n">set_xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO7-1" id="callout_exploring_data_with_pandas_CO7-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Creates two axes, on a two (row) by one (column) grid.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO7-2" id="callout_exploring_data_with_pandas_CO7-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We’ll share the x- and y-axes, which will make comparisons between the two plots sensible.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO7-3" id="callout_exploring_data_with_pandas_CO7-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>We provide the axis’s bar chart (<code>bar</code>) method with the continuous year index and the unstacked gender columns.</p></dd>
</dl></div>
<p>The take-home from our investigation into gender distributions is that there is a huge discrepancy but, as shown by <a data-type="xref" href="#explore_year_gen_stack">Figure 11-6</a>, a slight improvement in recent years. Moreover, with Economics being an outlier, the difference is greatest in the sciences. Given the fairly small number of female prize winners, there’s not a lot more to be seen here.</p>
<figure><div class="figure" id="explore_year_gen_stack">
<img alt="dpj2 1106" height="2280" src="assets/dpj2_1106.png" width="4674"/>
<h6><span class="label">Figure 11-6. </span>Prizes by year and gender, on two stacked axes</h6>
</div></figure>
<p>Let’s now take a look at national trends in prize wins and see if there are any interesting nuggets for visualization.<a data-primary="historical trends, exploring" data-secondary="gender of Nobel Prize winners" data-startref="ix_histtrndgndr" data-type="indexterm" id="idm45607763718272"/><a data-primary="gender disparities in Nobel Prize winners, exploring" data-startref="ix_gndrdisp" data-type="indexterm" id="idm45607763717088"/><a data-primary="pandas" data-secondary="exploring data with" data-startref="ix_pndsexpgndr" data-tertiary="gender disparities in Nobel Prize winner dataset" data-type="indexterm" id="idm45607763660304"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="National Trends" data-type="sect1"><div class="sect1" id="sect_national_trends">
<h1>National Trends</h1>
<p>The obvious starting point in looking at national trends is to plot the absolute number of prize winners.<a data-primary="national trends in Nobel Prize winners" data-type="indexterm" id="ix_nattrnd"/><a data-primary="pandas" data-secondary="exploring data with" data-tertiary="national trends in Novel Prize winners" data-type="indexterm" id="ix_pndsexpnattrnd"/> This is easily done in one line of pandas, broken up here for ease of reading:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'country'</code><code class="p">)</code><code class="o">.</code><code class="n">size</code><code class="p">()</code><code class="o">.</code><code class="n">order</code><code class="p">(</code><code class="n">ascending</code><code class="o">=</code><code class="kc">False</code><code class="p">)</code>
        <code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">12</code><code class="p">,</code><code class="mi">4</code><code class="p">))</code></pre>
<p>This produces <a data-type="xref" href="#explore_nat_abs">Figure 11-7</a>, showing the United States with the lion’s share of prizes.</p>
<p>The absolute number of prizes will be bound to favor countries with large populations. Let’s look at a fairer comparison, visualizing prizes per capita.</p>
<figure><div class="figure" id="explore_nat_abs">
<img alt="dpj2 1107" height="1072" src="assets/dpj2_1107.png" width="3471"/>
<h6><span class="label">Figure 11-7. </span>Absolute prize wins by country</h6>
</div></figure>
<section data-pdf-bookmark="Prize Winners Per Capita" data-type="sect2"><div class="sect2" id="idm45607763600512">
<h2>Prize Winners Per Capita</h2>
<p>The absolute number of prize winners is bound to favor larger countries, which raises the question, how do the numbers stack up if we account for population sizes? <a data-primary="national trends in Nobel Prize winners" data-secondary="prize winners per capita" data-type="indexterm" id="ix_nattrndpercap"/>In order to test prize haul per capita, we need to divide the absolute prize numbers by population size. In <a data-type="xref" href="ch05.xhtml#country_data">“Getting Country Data for the Nobel Dataviz”</a>, we downloaded some country data from the web and stored it as a JSON file. Let’s retrieve it now and use it to produce a plot of prizes relative to population size.</p>
<p>First, let’s get the national group sizes, with country names as index labels:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">nat_group</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'country'</code><code class="p">)</code>
<code class="n">ngsz</code> <code class="o">=</code> <code class="n">nat_group</code><code class="o">.</code><code class="n">size</code><code class="p">()</code>
<code class="n">ngsz</code><code class="o">.</code><code class="n">index</code>
<code class="n">Out</code><code class="p">:</code>
<code class="n">Index</code><code class="p">([</code><code class="sa">u</code><code class="s1">'Argentina'</code><code class="p">,</code> <code class="sa">u</code><code class="s1">'Australia'</code><code class="p">,</code> <code class="sa">u</code><code class="s1">'Austria'</code><code class="p">,</code> <code class="sa">u</code><code class="s1">'Azerbaijan'</code><code class="p">,</code><code class="o">...</code><code class="p">])</code></pre>
<p>Now let’s load our country data into a DataFrame and remind ourselves of the data it contains:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df_countries</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_json</code><code class="p">(</code><code class="s1">'data/winning_country_data.json'</code><code class="p">,</code>\
                            <code class="n">orient</code><code class="o">=</code><code class="s1">'index'</code><code class="p">)</code>

<code class="n">df_countries</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="s1">'Japan'</code><code class="p">]</code> <code class="c1"># countries indexed by name</code>

<code class="n">Out</code><code class="p">:</code>
<code class="n">gini</code>                   <code class="mf">38.1</code>
<code class="n">name</code>                  <code class="n">Japan</code>
<code class="n">alpha3Code</code>              <code class="n">JPN</code>
<code class="n">area</code>               <code class="mf">377930.0</code>
<code class="n">latlng</code>        <code class="p">[</code><code class="mf">36.0</code><code class="p">,</code> <code class="mf">138.0</code><code class="p">]</code>
<code class="n">capital</code>               <code class="n">Tokyo</code>
<code class="n">population</code>        <code class="mi">127080000</code>
<code class="n">Name</code><code class="p">:</code> <code class="n">Japan</code><code class="p">,</code> <code class="n">dtype</code><code class="p">:</code> <code class="nb">object</code></pre>
<p>Our country dataset is already indexed to its <code>name</code> column. If we add to it the <code>ngsz</code> national group-size Series, which also has a country name index, the two will combine on the shared indices, giving our country data a new <code>nobel_wins</code> column. We can then use this new column to create a <code>nobel_wins_per_capita</code> by dividing it by population size:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df_countries</code> <code class="o">=</code> <code class="n">df_countries</code><code class="o">.</code><code class="n">set_index</code><code class="p">(</code><code class="s1">'name'</code><code class="p">)</code>
<code class="n">df_countries</code><code class="p">[</code><code class="s1">'nobel_wins'</code><code class="p">]</code> <code class="o">=</code> <code class="n">ngsz</code>
<code class="n">df_countries</code><code class="p">[</code><code class="s1">'nobel_wins_per_capita'</code><code class="p">]</code> <code class="o">=</code>\
    <code class="n">df_countries</code><code class="o">.</code><code class="n">nobel_wins</code> <code class="o">/</code> <code class="n">df_countries</code><code class="o">.</code><code class="n">population</code></pre>
<p>We now need only to sort the <code>df_countries</code> DataFrame by its new <code>nobel_wins_per_cap</code> column and plot the Nobel Prize wins per capita, producing <a data-type="xref" href="#explore_per_cap">Figure 11-8</a>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code><code class="o">.</code><code class="n">countries</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="n">by</code><code class="o">=</code><code class="s1">'nobel_wins_per_capita'</code><code class="p">,</code>\
    <code class="n">ascending</code><code class="o">=</code><code class="kc">False</code><code class="p">)</code><code class="o">.</code><code class="n">nobel_per_capita</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">,</code>\
    <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">12</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code></pre>
<figure><div class="figure" id="explore_per_cap">
<img alt="dpj2 1108" height="1068" src="assets/dpj2_1108.png" width="3473"/>
<h6><span class="label">Figure 11-8. </span>National prize numbers per capita</h6>
</div></figure>
<p>This shows the Caribbean island of Saint Lucia taking top place. Home to the Nobel Prize–winning poet <a href="https://oreil.ly/OOYBc">Derek Walcott</a>, its small population of 175,000 gives it a high Nobel Prizes per capita.</p>
<p>Let’s see how things stack up with the larger countries by filtering the results for countries that have won more than two Nobel Prizes:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df_countries</code><code class="p">[</code><code class="n">df_countries</code><code class="o">.</code><code class="n">nobel_wins</code> <code class="o">&gt;</code> <code class="mi">2</code><code class="p">]</code>\
        <code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="n">by</code><code class="o">=</code><code class="s1">'nobel_wins_per_capita'</code><code class="p">,</code> <code class="n">ascending</code><code class="o">=</code><code class="kc">False</code><code class="p">)</code>\
        <code class="o">.</code><code class="n">nobel_wins_per_capita</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">)</code></pre>
<p>The results in <a data-type="xref" href="#explore_per_cap_filter">Figure 11-9</a> show the Scandinavian countries and Switzerland punching above their weight.</p>
<figure><div class="figure" id="explore_per_cap_filter">
<img alt="dpj2 1109" height="1068" src="assets/dpj2_1109.png" width="2272"/>
<h6><span class="label">Figure 11-9. </span>National prize numbers per capita, filtered for three or more wins</h6>
</div></figure>
<p>Changing the metric for national prize counts from absolute to per capita makes a big difference. Let’s now refine our search a little and focus on the prize categories, looking for interesting nuggets there.<a data-primary="national trends in Nobel Prize winners" data-secondary="prize winners per capita" data-startref="ix_nattrndpercap" data-type="indexterm" id="idm45607763303168"/></p>
</div></section>
<section data-pdf-bookmark="Prizes by Category" data-type="sect2"><div class="sect2" id="idm45607763599888">
<h2>Prizes by Category</h2>
<p>Let’s drill down a bit into the absolute prize data and look at wins by category. <a data-primary="national trends in Nobel Prize winners" data-secondary="prizes by category" data-type="indexterm" id="ix_nattrndcat"/>This will require grouping by country and category columns, getting the size of those groups, unstacking the resulting Series and then plotting the columns of the resulting DataFrame. First, we get our categories with country group sizes:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">nat_cat_sz</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">([</code><code class="s1">'country'</code><code class="p">,</code> <code class="s1">'category'</code><code class="p">])</code><code class="o">.</code><code class="n">size</code><code class="p">()</code>
<code class="o">.</code><code class="n">unstack</code><code class="p">()</code>
<code class="n">nat_cat_sz</code>
<code class="n">Out</code><code class="p">:</code>
<code class="n">category</code>     <code class="n">Chemistry</code>  <code class="n">Economics</code>  <code class="n">Literature</code>  <code class="n">Peace</code>  \<code class="o">...</code>
<code class="n">country</code>
<code class="n">Argentina</code>            <code class="mi">1</code>        <code class="n">NaN</code>         <code class="n">NaN</code>      <code class="mi">2</code>
<code class="n">Australia</code>          <code class="n">NaN</code>          <code class="mi">1</code>           <code class="mi">1</code>    <code class="n">NaN</code>
<code class="n">Austria</code>              <code class="mi">3</code>          <code class="mi">1</code>           <code class="mi">1</code>      <code class="mi">2</code>
<code class="n">Azerbaijan</code>         <code class="n">NaN</code>        <code class="n">NaN</code>         <code class="n">NaN</code>    <code class="n">NaN</code>
<code class="n">Bangladesh</code>         <code class="n">NaN</code>        <code class="n">NaN</code>         <code class="n">NaN</code>      <code class="mi">1</code></pre>
<p>We then use the <code>nat_cat_sz</code> DataFrame to produce subplots for the six Nobel Prize categories:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">COL_NUM</code><code> </code><code class="o">=</code><code> </code><code class="mi">2</code><code>
</code><code class="n">ROW_NUM</code><code> </code><code class="o">=</code><code> </code><code class="mi">3</code><code>
</code><code>
</code><code class="n">fig</code><code class="p">,</code><code> </code><code class="n">axes</code><code> </code><code class="o">=</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">ROW_NUM</code><code class="p">,</code><code> </code><code class="n">COL_NUM</code><code class="p">,</code><code> </code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">12</code><code class="p">,</code><code class="mi">12</code><code class="p">)</code><code class="p">)</code><code>
</code><code>
</code><code class="k">for</code><code> </code><code class="n">i</code><code class="p">,</code><code> </code><code class="p">(</code><code class="n">label</code><code class="p">,</code><code> </code><code class="n">col</code><code class="p">)</code><code> </code><code class="ow">in</code><code> </code><code class="nb">enumerate</code><code class="p">(</code><code class="n">nat_cat_sz</code><code class="o">.</code><code class="n">items</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO8-1" id="co_exploring_data_with_pandas_CO8-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>    </code><code class="n">ax</code><code> </code><code class="o">=</code><code> </code><code class="n">axes</code><code class="p">[</code><code class="n">i</code><code class="o">/</code><code class="o">/</code><code class="n">COL_NUM</code><code class="p">,</code><code> </code><code class="n">i</code><code class="o">%</code><code class="n">COL_NUM</code><code class="p">]</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO8-2" id="co_exploring_data_with_pandas_CO8-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>    </code><code class="n">col</code><code> </code><code class="o">=</code><code> </code><code class="n">col</code><code class="o">.</code><code class="n">order</code><code class="p">(</code><code class="n">ascending</code><code class="o">=</code><code class="kc">False</code><code class="p">)</code><code class="p">[</code><code class="p">:</code><code class="mi">10</code><code class="p">]</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO8-3" id="co_exploring_data_with_pandas_CO8-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code>    </code><code class="n">col</code><code> </code><code class="o">=</code><code> </code><code class="n">col</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="n">ascending</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO8-4" id="co_exploring_data_with_pandas_CO8-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a><code>
</code><code>    </code><code class="n">col</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'</code><code class="s1">barh</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">)</code><code>
</code><code>    </code><code class="n">ax</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="n">label</code><code class="p">)</code><code>
</code><code>
</code><code class="n">plt</code><code class="o">.</code><code class="n">tight_layout</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO8-5" id="co_exploring_data_with_pandas_CO8-5"><img alt="5" height="12" src="assets/5.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO8-1" id="callout_exploring_data_with_pandas_CO8-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p><code>items</code> returns an iterator for the DataFrames columns in form of (column_label, column) tuples.<a data-primary="integer division operator (//) in Python 3" data-type="indexterm" id="idm45607763040944"/></p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO8-2" id="callout_exploring_data_with_pandas_CO8-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Python 3 acquired the handy <a href="https://oreil.ly/X6QGK">integer division</a> operator <code>//</code>, which returns the rounded-down integer value of the division.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO8-3" id="callout_exploring_data_with_pandas_CO8-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p><code>order</code> orders the column’s Series by first making a copy. It is the equivalent of <code>sort(inplace=False)</code>.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO8-4" id="callout_exploring_data_with_pandas_CO8-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></dt>
<dd><p>Having sliced off the largest 10 countries, we now reverse the order to make the bar chart, which plots from bottom to top, presenting the largest countries at the top.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO8-5" id="callout_exploring_data_with_pandas_CO8-5"><img alt="5" height="12" src="assets/5.png" width="12"/></a></dt>
<dd><p><code>tight_layout</code> should prevent label overlaps among the subplots. If you have any problems with <code>tight_layout</code>, see the end of <a data-type="xref" href="ch10.xhtml#sect_mpl_titles">“Titles and Axes Labels”</a>.</p></dd>
</dl>
<p>This produces the plots in <a data-type="xref" href="#explore_nat_cat">Figure 11-10</a>.</p>
<p>A couple of interesting nuggets from <a data-type="xref" href="#explore_nat_cat">Figure 11-10</a> are the United States’ overwhelming dominance of the Economics prize, reflecting a post-WWII economic consensus, and France’s leadership of the Literature prize.</p>
<figure><div class="figure" id="explore_nat_cat">
<img alt="dpj2 1110" height="3462" src="assets/dpj2_1110.png" width="3471"/>
<h6><span class="label">Figure 11-10. </span>Prizes by country and category</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Historical Trends in Prize Distribution" data-type="sect2"><div class="sect2" id="sect_hist_trends">
<h2>Historical Trends in Prize Distribution</h2>
<p>Now that we know the aggregate prize stats by country, are there any interesting historical trends to the prize distribution? Let’s explore this with some line plots.<a data-primary="national trends in Nobel Prize winners" data-secondary="prizes by category" data-startref="ix_nattrndcat" data-type="indexterm" id="idm45607762989504"/><a data-primary="national trends in Nobel Prize winners" data-secondary="historical trends" data-type="indexterm" id="ix_nattrndhist"/><a data-primary="historical trends, exploring" data-secondary="nationality of Nobel Prize winners" data-type="indexterm" id="ix_histtrndnat"/></p>
<p>First, let’s increase the default font size to 20 points to make the plot labels more legible:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">plt</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'font.size'</code><code class="p">]</code> <code class="o">=</code> <code class="mi">20</code></pre>
<p>We’re going to be looking at prize distribution by year and country, so we’ll need a new unstacked DataFrame based on these two columns. As previously, we add a <code>new_index</code> to give continuous years:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">new_index</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">Index</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="mi">1901</code><code class="p">,</code> <code class="mi">2015</code><code class="p">),</code> <code class="n">name</code><code class="o">=</code><code class="s1">'year'</code><code class="p">)</code>

<code class="n">by_year_nat_sz</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">([</code><code class="s1">'year'</code><code class="p">,</code> <code class="s1">'country'</code><code class="p">])</code>\
    <code class="o">.</code><code class="n">size</code><code class="p">()</code><code class="o">.</code><code class="n">unstack</code><code class="p">()</code><code class="o">.</code><code class="n">reindex</code><code class="p">(</code><code class="n">new_index</code><code class="p">)</code></pre>
<p>The trend we’re interested in is the cumulative sum of Nobel Prizes by country over its history. We can further explore trends in individual categories, but for now we’ll look at the total for all. pandas has a handy <code>cumsum</code> method for just this. Let’s take the United States column and plot it:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_year_nat_sz</code><code class="p">[</code><code class="s1">'United States'</code><code class="p">]</code><code class="o">.</code><code class="n">cumsum</code><code class="p">()</code><code class="o">.</code><code class="n">plot</code><code class="p">()</code></pre>
<p>This produces the chart in <a data-type="xref" href="#explore_cumsum_us">Figure 11-11</a>.</p>
<figure><div class="figure" id="explore_cumsum_us">
<img alt="dpj2 1111" height="1071" src="assets/dpj2_1111.png" width="2272"/>
<h6><span class="label">Figure 11-11. </span>Cumulative sum of US prize winners over time</h6>
</div></figure>
<p>The gaps in the line plot are where the fields are <code>NaN</code>, years when the US won no prizes. The <code>cumsum</code> algorithm returns <code>NaN</code> here. Let’s fill those in with a zero to remove the gaps:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_year_nat_sz</code><code class="p">[</code><code class="s1">'United States'</code><code class="p">]</code><code class="o">.</code><code class="n">fillna</code><code class="p">(</code><code class="mi">0</code><code class="p">)</code>
    <code class="o">.</code><code class="n">cumsum</code><code class="p">()</code><code class="o">.</code><code class="n">plot</code><code class="p">()</code></pre>
<p>This produces the cleaner chart shown in <a data-type="xref" href="#explore_cumsum_us_gapless">Figure 11-12</a>.</p>
<figure><div class="figure" id="explore_cumsum_us_gapless">
<img alt="dpj2 1112" height="1071" src="assets/dpj2_1112.png" width="2272"/>
<h6><span class="label">Figure 11-12. </span>Cumulative sum of US prize winners over time</h6>
</div></figure>
<p>Let’s compare the US prize rate with that of the rest of the world:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_year_nat_sz</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>
</code><code>    </code><code class="o">.</code><code class="n">size</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">unstack</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">fillna</code><code class="p">(</code><code class="mi">0</code><code class="p">)</code><code>
</code><code>
</code><code class="n">not_US</code><code> </code><code class="o">=</code><code> </code><code class="n">by_year_nat_sz</code><code class="o">.</code><code class="n">columns</code><code class="o">.</code><code class="n">tolist</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO9-1" id="co_exploring_data_with_pandas_CO9-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code class="n">not_US</code><code class="o">.</code><code class="n">remove</code><code class="p">(</code><code class="s1">'</code><code class="s1">United States</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>
</code><code class="n">by_year_nat_sz</code><code class="p">[</code><code class="s1">'</code><code class="s1">Not US</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">by_year_nat_sz</code><code class="p">[</code><code class="n">not_US</code><code class="p">]</code><code class="o">.</code><code class="n">sum</code><code class="p">(</code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO9-2" id="co_exploring_data_with_pandas_CO9-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code class="n">ax</code><code> </code><code class="o">=</code><code> </code><code class="n">by_year_nat_sz</code><code class="p">[</code><code class="p">[</code><code class="s1">'</code><code class="s1">United States</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Not US</code><code class="s1">'</code><code class="p">]</code><code class="p">]</code><code>\
</code><code>    </code><code class="o">.</code><code class="n">cumsum</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">style</code><code class="o">=</code><code class="p">[</code><code class="s1">'</code><code class="s1">-</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO9-3" id="co_exploring_data_with_pandas_CO9-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO9-1" id="callout_exploring_data_with_pandas_CO9-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Gets the list of country column names and removes United States.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO9-2" id="callout_exploring_data_with_pandas_CO9-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Uses our list of non-US country names to create a <code>'Not_US'</code> column, the sum of all the prizes for countries in the <code>not_US</code> list.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO9-3" id="callout_exploring_data_with_pandas_CO9-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>By default, the lines in pandas plots are colored. In order to distinguish them in the printed book, we can use the <code>style</code> argument to make one line solid (<em>-</em>) and the other dashed (<em>--</em>), using the Matplotlib line styles (see <a href="https://oreil.ly/dUw3x">the docs</a> for details).</p></dd>
</dl>
<p>This code produces the chart shown in <a data-type="xref" href="#explore_cumsum_us_notus">Figure 11-13</a>.</p>
<figure><div class="figure" id="explore_cumsum_us_notus">
<img alt="dpj2 1113" height="1020" src="assets/dpj2_1113.png" width="2218"/>
<h6><span class="label">Figure 11-13. </span>United States versus rest of world prize hauls</h6>
</div></figure>
<p>Where the <code>'Not_US'</code> haul shows a steady increase over the years of the prize, the US shows a rapid increase around the end of World War II. Let’s investigate that further, looking at regional differences. We’ll focus on the two or three largest winners for North America, Europe, and Asia:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_year_nat_sz</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>\
</code><code>    </code><code class="o">.</code><code class="n">size</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">unstack</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">reindex</code><code class="p">(</code><code class="n">new_index</code><code class="p">)</code><code class="o">.</code><code class="n">fillna</code><code class="p">(</code><code class="mi">0</code><code class="p">)</code><code>
</code><code>
</code><code class="n">regions</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO10-1" id="co_exploring_data_with_pandas_CO10-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>    </code><code class="p">{</code><code class="s1">'</code><code class="s1">label</code><code class="s1">'</code><code class="p">:</code><code class="s1">'</code><code class="s1">N. America</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>      </code><code class="s1">'</code><code class="s1">countries</code><code class="s1">'</code><code class="p">:</code><code class="p">[</code><code class="s1">'</code><code class="s1">United States</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Canada</code><code class="s1">'</code><code class="p">]</code><code class="p">}</code><code class="p">,</code><code>
</code><code>    </code><code class="p">{</code><code class="s1">'</code><code class="s1">label</code><code class="s1">'</code><code class="p">:</code><code class="s1">'</code><code class="s1">Europe</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>     </code><code class="s1">'</code><code class="s1">countries</code><code class="s1">'</code><code class="p">:</code><code class="p">[</code><code class="s1">'</code><code class="s1">United Kingdom</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Germany</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">France</code><code class="s1">'</code><code class="p">]</code><code class="p">}</code><code class="p">,</code><code>
</code><code>    </code><code class="p">{</code><code class="s1">'</code><code class="s1">label</code><code class="s1">'</code><code class="p">:</code><code class="s1">'</code><code class="s1">Asia</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>     </code><code class="s1">'</code><code class="s1">countries</code><code class="s1">'</code><code class="p">:</code><code class="p">[</code><code class="s1">'</code><code class="s1">Japan</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Russia</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">India</code><code class="s1">'</code><code class="p">]</code><code class="p">}</code><code>
</code><code class="p">]</code><code>
</code><code>
</code><code class="k">for</code><code> </code><code class="n">region</code><code> </code><code class="ow">in</code><code> </code><code class="n">regions</code><code class="p">:</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO10-2" id="co_exploring_data_with_pandas_CO10-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>    </code><code class="n">by_year_nat_sz</code><code class="p">[</code><code class="n">region</code><code class="p">[</code><code class="s1">'</code><code class="s1">label</code><code class="s1">'</code><code class="p">]</code><code class="p">]</code><code> </code><code class="o">=</code><code>\
</code><code>        </code><code class="n">by_year_nat_sz</code><code class="p">[</code><code class="n">region</code><code class="p">[</code><code class="s1">'</code><code class="s1">countries</code><code class="s1">'</code><code class="p">]</code><code class="p">]</code><code class="o">.</code><code class="n">sum</code><code class="p">(</code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code>
</code><code>
</code><code class="n">by_year_nat_sz</code><code class="p">[</code><code class="p">[</code><code class="n">r</code><code class="p">[</code><code class="s1">'</code><code class="s1">label</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="k">for</code><code> </code><code class="n">r</code><code> </code><code class="ow">in</code><code> </code><code class="n">regions</code><code class="p">]</code><code class="p">]</code><code class="o">.</code><code class="n">cumsum</code><code class="p">(</code><code class="p">)</code><code>\
</code><code>  </code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">style</code><code class="o">=</code><code class="p">[</code><code class="s1">'</code><code class="s1">-</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">-.</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code> </code><code class="c1"># solid, dashed, dash-dotted line style </code><a class="co" href="#callout_exploring_data_with_pandas_CO10-3" id="co_exploring_data_with_pandas_CO10-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO10-1" id="callout_exploring_data_with_pandas_CO10-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Our continental country list created by selecting the biggest two or three winners in the three continents compared.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO10-2" id="callout_exploring_data_with_pandas_CO10-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Creates a new column with a region label for each <code>dict</code> in the <code>regions</code> list, summing its <code>countries</code> members.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO10-3" id="callout_exploring_data_with_pandas_CO10-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Plots the cumulative sum of all the new region columns.</p></dd>
</dl>
<p>This gives us the plot in <a data-type="xref" href="#explore_cumsum_regions">Figure 11-14</a>. The rate of Asia’s prize haul has increased slightly over the years, but the main point of note is North America’s huge increase in prizes around the mid-1940s, overtaking a declining Europe in total prizes around the mid-1980s.</p>
<figure><div class="figure" id="explore_cumsum_regions">
<img alt="dpj2 1114" height="1020" src="assets/dpj2_1114.png" width="2218"/>
<h6><span class="label">Figure 11-14. </span>Historical prize trends by region</h6>
</div></figure>
<p>Let’s expand the detail of the previous national plots by summarizing the prize rates for the 16 biggest winners, excluding the outlying United States:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">COL_NUM</code><code> </code><code class="o">=</code><code> </code><code class="mi">4</code><code>
</code><code class="n">ROW_NUM</code><code> </code><code class="o">=</code><code> </code><code class="mi">4</code><code>
</code><code>
</code><code class="n">by_nat_sz</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">)</code><code class="o">.</code><code class="n">size</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">by_nat_sz</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="n">ascending</code><code class="o">=</code><code class="kc">False</code><code class="p">,</code><code>\
</code><code>    </code><code class="n">inplace</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code><code>  </code><a class="co" href="#callout_exploring_data_with_pandas_CO11-1" id="co_exploring_data_with_pandas_CO11-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>
</code><code class="n">fig</code><code class="p">,</code><code> </code><code class="n">axes</code><code> </code><code class="o">=</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">COL_NUM</code><code class="p">,</code><code> </code><code class="n">ROW_NUM</code><code class="p">,</code><code>\</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO11-2" id="co_exploring_data_with_pandas_CO11-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>    </code><code class="n">sharex</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code><code> </code><code class="n">sharey</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO11-2" id="co_exploring_data_with_pandas_CO11-3"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>    </code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">12</code><code class="p">,</code><code class="mi">12</code><code class="p">)</code><code class="p">)</code><code>
</code><code>
</code><code class="k">for</code><code> </code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">nat</code><code> </code><code class="ow">in</code><code> </code><code class="nb">enumerate</code><code class="p">(</code><code class="n">by_nat</code><code class="o">.</code><code class="n">index</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="mi">17</code><code class="p">]</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO11-3" id="co_exploring_data_with_pandas_CO11-4"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code>    </code><code class="n">ax</code><code> </code><code class="o">=</code><code> </code><code class="n">axes</code><code class="p">[</code><code class="n">i</code><code class="o">/</code><code class="n">COL_NUM</code><code class="p">,</code><code> </code><code class="n">i</code><code class="o">%</code><code class="n">ROW_NUM</code><code class="p">]</code><code>
</code><code>    </code><code class="n">by_year_nat_sz</code><code class="p">[</code><code class="n">nat</code><code class="p">]</code><code class="o">.</code><code class="n">cumsum</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO11-4" id="co_exploring_data_with_pandas_CO11-5"><img alt="4" height="12" src="assets/4.png" width="12"/></a><code>
</code><code>    </code><code class="n">ax</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="n">nat</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO11-1" id="callout_exploring_data_with_pandas_CO11-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Sorts our country groups from highest to lowest win-hauls.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO11-2" id="callout_exploring_data_with_pandas_CO11-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Gets a 4×4 grid of axes with shared x- and y-axes for normalized comparison.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO11-4" id="callout_exploring_data_with_pandas_CO11-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Enumerates over the sorted index from the second row (1), excluding the US (0).</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO11-5" id="callout_exploring_data_with_pandas_CO11-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></dt>
<dd><p>Selects the <code>nat</code> country name column and plots its cumulative sum of prizes on the grid axis <code>ax</code>.</p></dd>
</dl>
<p>This produces <a data-type="xref" href="#explore_nat_grid">Figure 11-15</a>, which shows some nations like Japan, Australia, and Israel on the rise historically, while others flatten off.</p>
<figure><div class="figure" id="explore_nat_grid">
<img alt="dpj2 1115" height="3474" src="assets/dpj2_1115.png" width="3470"/>
<h6><span class="label">Figure 11-15. </span>Prize rates for the 16 largest national winners after the US</h6>
</div></figure>
<p>Another good way to summarize national prize rates over time is by using a heatmap and dividing the totals by decade. <a data-primary="heatmaps" data-type="indexterm" id="idm45607762191840"/>The seaborn library provides a good heatmap.<a data-primary="seaborn library" data-secondary="heatmap" data-type="indexterm" id="idm45607762191104"/> Let’s import it and use its <code>set</code> method to increase the font size of its labels by scaling them:</p>
<pre data-code-language="python" data-type="programlisting"><code class="kn">import</code> <code class="nn">seaborn</code> <code class="k">as</code> <code class="nn">sns</code>

<code class="n">sns</code><code class="o">.</code><code class="n">set</code><code class="p">(</code><code class="n">font_scale</code> <code class="o">=</code> <code class="mf">1.3</code><code class="p">)</code></pre>
<p>The division of data into chunks is also known as <a href="https://oreil.ly/SkFSj"><em>binning</em></a>, as it creates <em>bins</em> of data. <a data-primary="binning data" data-type="indexterm" id="idm45607762166784"/>pandas has a handy <code>cut</code> method for just this job, taking a column of continuous values—​in our case, Nobel Prize years—​and returning ranges of a specified size. You can supply the DataFrame’s <code>groupby</code> method with the result of <code>cut</code> and it will group by the range of indexed values. The following code produces <a data-type="xref" href="#explore_heatmap_nat_year">Figure 11-16</a>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">bins</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">year</code><code class="o">.</code><code class="n">min</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">year</code><code class="o">.</code><code class="n">max</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="mi">10</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO12-1" id="co_exploring_data_with_pandas_CO12-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>
</code><code class="n">by_year_nat_binned</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">,</code><code>\
</code><code>    </code><code class="p">[</code><code class="n">pd</code><code class="o">.</code><code class="n">cut</code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">year</code><code class="p">,</code><code> </code><code class="n">bins</code><code class="p">,</code><code> </code><code class="n">precision</code><code class="o">=</code><code class="mi">0</code><code class="p">)</code><code class="p">]</code><code class="p">)</code><code>\</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO12-2" id="co_exploring_data_with_pandas_CO12-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>    </code><code class="o">.</code><code class="n">size</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">unstack</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">fillna</code><code class="p">(</code><code class="mi">0</code><code class="p">)</code><code>
</code><code>
</code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">8</code><code class="p">,</code><code> </code><code class="mi">8</code><code class="p">)</code><code class="p">)</code><code>
</code><code>
</code><code class="n">sns</code><code class="o">.</code><code class="n">heatmap</code><code class="p">(</code><code>\
</code><code>  </code><code class="n">by_year_nat_binned</code><code class="p">[</code><code class="n">by_year_nat_binned</code><code class="o">.</code><code class="n">sum</code><code class="p">(</code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code> </code><code class="o">&gt;</code><code> </code><code class="mi">2</code><code class="p">]</code><code class="p">,</code><code>\</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO12-3" id="co_exploring_data_with_pandas_CO12-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code>  </code><code class="n">cmap</code><code class="o">=</code><code class="s1">'</code><code class="s1">rocket_r</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO12-4" id="co_exploring_data_with_pandas_CO12-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO12-1" id="callout_exploring_data_with_pandas_CO12-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Gets our bin ranges for the decades from 1901 (1901, 1911, 1921…​).</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO12-2" id="callout_exploring_data_with_pandas_CO12-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Cuts our Nobel Prize years into decades using the <code>bins</code> ranges with <code>precision</code> set to <code>0</code>, to give integer years.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO12-3" id="callout_exploring_data_with_pandas_CO12-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Before heatmapping, we filter for those countries with over two Nobel Prizes.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO12-4" id="callout_exploring_data_with_pandas_CO12-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></dt>
<dd><p>We use the continuous <code>rocket_r</code> heatmap to highlight the differences. Check out all the pandas color palettes in the <a href="https://oreil.ly/3FmHj">seaborn documentation</a>.</p></dd>
</dl>
<p><a data-type="xref" href="#explore_heatmap_nat_year">Figure 11-16</a> captures some interesting trends, such as Russia’s brief flourishing in the 1950s, which petered out around the 1980s.</p>
<p>Now that we’ve investigated the Nobel Prize nations, let’s turn our attention to the individual winners. Are there any interesting things we can discover about them using the data at hand?<a data-primary="historical trends, exploring" data-secondary="nationality of Nobel Prize winners" data-startref="ix_histtrndnat" data-type="indexterm" id="idm45607761981600"/><a data-primary="pandas" data-secondary="expoloring data with" data-startref="ix_pndsexpnattrnd" data-tertiary="national trends in Novel Prize winners" data-type="indexterm" id="idm45607761980416"/><a data-primary="national trends in Nobel Prize winners" data-secondary="historical trends" data-startref="ix_nattrndhist" data-type="indexterm" id="idm45607761978960"/><a data-primary="national trends in Nobel Prize winners" data-startref="ix_nattrnd" data-type="indexterm" id="idm45607761977776"/></p>
<figure><div class="figure" id="explore_heatmap_nat_year">
<img alt="dpj2 1116" height="3474" src="assets/dpj2_1116.png" width="3241"/>
<h6><span class="label">Figure 11-16. </span>Nations’ Nobel Prize hauls by decade</h6>
</div></figure>
</div></section>
</div></section>
<section data-pdf-bookmark="Age and Life Expectancy of Winners" data-type="sect1"><div class="sect1" id="idm45607763658720">
<h1>Age and Life Expectancy of Winners</h1>
<p>We have the date of birth for all our winners and the date of death for 559 of them. <a data-primary="age and life expectancy of Nobel Prize winners, exploring with pandas" data-type="indexterm" id="ix_agelife"/><a data-primary="pandas" data-secondary="exploring data with" data-tertiary="age and life expectancy of Nobel Prize winners" data-type="indexterm" id="ix_pndsexpage"/>Combined with the year in which they won their prizes, we have a fair amount of individual data to mine. Let’s investigate the age distribution of winners and try to glean some idea of the winners’ longevity.</p>
<section data-pdf-bookmark="Age at Time of Award" data-type="sect2"><div class="sect2" id="sect_age_at_time_of_award">
<h2>Age at Time of Award</h2>
<p>In <a data-type="xref" href="ch09.xhtml#chapter_cleaning">Chapter 9</a>, we added an <code>'award_age'</code> column to our Nobel Prize dataset by subtracting the winners’ ages from their prize years.<a data-primary="age and life expectancy of Nobel Prize winners, exploring with pandas" data-secondary="age at time of award" data-type="indexterm" id="idm45607761967840"/> A quick and easy win is to use pandas’s histogram plot to assess this distribution:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code><code class="p">[</code><code class="s1">'award_age'</code><code class="p">]</code><code class="o">.</code><code class="n">hist</code><code class="p">(</code><code class="n">bins</code><code class="o">=</code><code class="mi">20</code><code class="p">)</code></pre>
<p>Here we require that the age data be divided into 20 bins. <a data-primary="bins of data" data-type="indexterm" id="idm45607761960704"/>This produces <a data-type="xref" href="#explore_hist_award_age">Figure 11-17</a>, showing that the early ’60s is a sweet spot for the prize and if you haven’t achieved it by 100, it probably isn’t going to happen. Note the outlier around 20, which is the 17-year-old recipient of the Peace Prize, <a href="https://oreil.ly/8ft8y">Malala Yousafzai</a>.</p>
<figure><div class="figure" id="explore_hist_award_age">
<img alt="dpj2 1117" height="1063" src="assets/dpj2_1117.png" width="2270"/>
<h6><span class="label">Figure 11-17. </span>Distribution of ages at time of award</h6>
</div></figure>
<p>We can use <a data-primary="distribution plots" data-type="indexterm" id="idm45607761943008"/><a data-primary="seaborn library" data-secondary="distplot" data-type="indexterm" id="idm45607761942272"/><a data-primary="kernel density estimates (KDEs)" data-type="indexterm" id="idm45607761941328"/>seaborn’s <code>displot</code> to get a better feel for the distribution, adding a kernel density estimate (KDE)<sup><a data-type="noteref" href="ch11.xhtml#idm45607761940144" id="idm45607761940144-marker">2</a></sup> to the histogram. The following one-liner produces <a data-type="xref" href="#explore_hist_award_age_kde">Figure 11-18</a>, showing that our sweet spot is around 60 years of age:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">sns</code><code class="o">.</code><code class="n">displot</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="s1">'award_age'</code><code class="p">],</code> <code class="n">kde</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code> <code class="n">height</code><code class="o">=</code><code class="mi">4</code><code class="p">,</code> <code class="n">aspect</code><code class="o">=</code><code class="mi">2</code><code class="p">)</code></pre>
<figure><div class="figure" id="explore_hist_award_age_kde">
<img alt="dpj2 1118" height="1091" src="assets/dpj2_1118.png" width="2284"/>
<h6><span class="label">Figure 11-18. </span>Distribution of ages at time of award with KDE superimposed</h6>
</div></figure>
<p>A <a href="https://oreil.ly/EWFhx">box plot</a> is a good way of visualizing continuous data, showing the quartiles, the first and third marking the edges of the box and the second quartile (or median average) marking the line in the box.<a data-primary="box plots" data-type="indexterm" id="idm45607761904688"/> Generally, as in <a data-type="xref" href="#explore_boxplot_age_gen">Figure 11-19</a>, the horizontal end lines (known as the whisker ends) indicate the max and min of the data.  Let’s use a seaborn box plot and divide the prizes by gender:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">sns</code><code class="o">.</code><code class="n">boxplot</code><code class="p">(</code><code class="n">df</code><code class="p">,</code> <code class="n">x</code><code class="o">=</code><code class="s1">'gender'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s1">'award_age'</code><code class="p">)</code></pre>
<p>This produces <a data-type="xref" href="#explore_boxplot_age_gen">Figure 11-19</a>, which shows that the distributions by gender are similar, with women having a slightly lower average age. Note that with far fewer female prize winners, their statistics are subject to a good deal more uncertainty.</p>
<figure><div class="figure" id="explore_boxplot_age_gen">
<img alt="dpj2 1119" height="1086" src="assets/dpj2_1119.png" width="2284"/>
<h6><span class="label">Figure 11-19. </span>Ages of prize winners by gender</h6>
</div></figure>
<p>seaborn’s rather <a data-primary="violin plots" data-type="indexterm" id="idm45607761856160"/><a data-primary="seaborn library" data-secondary="violin plot" data-type="indexterm" id="idm45607761855424"/>nice violin plot combines the conventional box plot with a kernel density estimation to give a more refined view of the breakdown by age and gender. The following code produces <a data-type="xref" href="#explore_violin_age_gen">Figure 11-20</a>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">sns</code><code class="o">.</code><code class="n">violinplot</code><code class="p">(</code><code class="n">data</code><code class="o">=</code><code class="n">df</code><code class="p">,</code> <code class="n">x</code><code class="o">=</code><code class="s1">'gender'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s1">'award_age'</code><code class="p">)</code></pre>
<figure><div class="figure" id="explore_violin_age_gen">
<img alt="dpj2 1120" height="1086" src="assets/dpj2_1120.png" width="2284"/>
<h6><span class="label">Figure 11-20. </span>Violin plots of prize-age distribution by gender</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Life Expectancy of Winners" data-type="sect2"><div class="sect2" id="idm45607761970576">
<h2>Life Expectancy of Winners</h2>
<p>Now let’s look at the longevity of Nobel Prize winners, by subtracting the available dates of death from their respective dates of birth.<a data-primary="age and life expectancy of Nobel Prize winners, exploring with pandas" data-secondary="life expectancy of winners" data-type="indexterm" id="ix_agelifelife"/><a data-primary="life expectancy of Nobel Prize winners, exploring with pandas" data-type="indexterm" id="ix_lifeexp"/> We’ll store this data in a new <code>'age_at_death'</code> column:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">age_at_death</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">date_of_death</code><code> </code><code class="o">-</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">date_of_birth</code><code class="p">)</code><code>\
</code><code>                     </code><code class="o">.</code><code class="n">dt</code><code class="o">.</code><code class="n">days</code><code class="o">/</code><code class="mi">365</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO13-1" id="co_exploring_data_with_pandas_CO13-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO13-1" id="callout_exploring_data_with_pandas_CO13-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p><code>datetime64</code> data can be added and subtracted in a sensible fashion, producing a pandas <code>timedelta</code> column. We can use its <code>dt</code> method to get the interval in days, dividing this by 365 to get the age at death as a float.</p></dd>
</dl>
<p>We make a copy of the <code>'age_at_death'</code> column,<sup><a data-type="noteref" href="ch11.xhtml#idm45607761762448" id="idm45607761762448-marker">3</a></sup> removing all empty <code>NaN</code> rows.  This can then be used to make the histogram and KDE shown in <a data-type="xref" href="#explore_hist_aad">Figure 11-21</a>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">age_at_death</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">age_at_death</code><code class="o">.</code><code class="n">notnull</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code class="o">.</code><code class="n">age_at_death</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO14-1" id="co_exploring_data_with_pandas_CO14-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>
</code><code class="n">sns</code><code class="o">.</code><code class="n">displot</code><code class="p">(</code><code class="n">age_at_death</code><code class="p">,</code><code> </code><code class="n">bins</code><code class="o">=</code><code class="mi">40</code><code class="p">,</code><code> </code><code class="n">kde</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code><code> </code><code class="n">aspect</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">height</code><code class="o">=</code><code class="mi">4</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO14-1" id="callout_exploring_data_with_pandas_CO14-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Removes all <code>NaN</code>s to clean the data and reduce plotting errors (e.g., <code>distplot</code> fails with <code>NaN</code>s).</p></dd>
</dl>
<figure><div class="figure" id="explore_hist_aad">
<img alt="dpj2 1121" height="1091" src="assets/dpj2_1121.png" width="2284"/>
<h6><span class="label">Figure 11-21. </span>Life expectancy of the Nobel Prize winners</h6>
</div></figure>
<p><a data-type="xref" href="#explore_hist_aad">Figure 11-21</a> shows the Nobel Prize winners to be a remarkably long-lived bunch, with an average age in the early 80s. This is all the more impressive given that the large majority of winners are men, who have significantly lower average life expectancies<sup><a data-type="noteref" href="ch11.xhtml#idm45607761692592" id="idm45607761692592-marker">4</a></sup> in the general population than women. One contributary factor to this longevity is the selection bias we saw earlier. Nobel Prize winners aren’t generally honored until they’re in their late 50s and 60s, which removes the subpopulation who died before having the chance to be acknowledged, pushing up the longevity figures.</p>
<p><a data-type="xref" href="#explore_hist_aad">Figure 11-21</a> shows some centenarians among the prize winners. Let’s find them:</p>
<pre data-type="programlisting">df[df.age_at_death &gt; 100][['name', 'category', 'year']]
Out:
                     name                category  year
101          Ronald Coase               Economics  1991
328   Rita Levi-Montalcini  Physiology or Medicine 1986</pre>
<p class="pagebreak-before">Now let’s<a data-primary="kernel density estimates (KDEs)" data-type="indexterm" id="idm45607761658064"/> superimpose a couple of KDEs to show differences in mortality for male and female recipients:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df_temp</code><code> </code><code class="o">=</code><code> </code><code class="n">df_temp</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">age_at_death</code><code class="o">.</code><code class="n">notnull</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO15-1" id="co_exploring_data_with_pandas_CO15-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code class="n">sns</code><code class="o">.</code><code class="n">kdeplot</code><code class="p">(</code><code class="n">df_temp</code><code class="p">[</code><code class="n">df_temp</code><code class="o">.</code><code class="n">gender</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">male</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>    </code><code class="o">.</code><code class="n">age_at_death</code><code class="p">,</code><code> </code><code class="n">shade</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">male</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="n">sns</code><code class="o">.</code><code class="n">kdeplot</code><code class="p">(</code><code class="n">df_temp</code><code class="p">[</code><code class="n">df_temp</code><code class="o">.</code><code class="n">gender</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">female</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>    </code><code class="o">.</code><code class="n">age_at_death</code><code class="p">,</code><code> </code><code class="n">shade</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">female</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>
</code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO15-1" id="callout_exploring_data_with_pandas_CO15-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Creates a DataFrame with only valid <code>'age_at_death'</code> fields.</p></dd>
</dl>
<p>This produces <a data-type="xref" href="#explore_aad_kde">Figure 11-22</a>, which, allowing for the small number of female winners and flatter distribution, shows the male and female averages to be close. Female Nobel Prize winners seem to live relatively shorter lives than their counterparts in the general population.</p>
<figure><div class="figure" id="explore_aad_kde">
<img alt="dpj2 1122" height="1088" src="assets/dpj2_1122.png" width="2281"/>
<h6><span class="label">Figure 11-22. </span>Nobel Prize winner life expectancies by gender</h6>
</div></figure>
<p>A violin plot provides another perspective, shown in <a data-type="xref" href="#explore_aad_violin">Figure 11-23</a>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">sns</code><code class="o">.</code><code class="n">violinplot</code><code class="p">(</code><code class="n">data</code><code class="o">=</code><code class="n">df</code><code class="p">,</code> <code class="n">x</code><code class="o">=</code><code class="s1">'gender'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s1">'age_at_death'</code><code class="p">,</code>\
               <code class="n">aspect</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code> <code class="n">height</code><code class="o">=</code><code class="mi">4</code><code class="p">)</code></pre>
<figure><div class="figure" id="explore_aad_violin">
<img alt="dpj2 1123" height="1090" src="assets/dpj2_1123.png" width="2284"/>
<h6><span class="label">Figure 11-23. </span>Winner life expectancies by gender</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Increasing Life Expectancies over Time" data-type="sect2"><div class="sect2" id="idm45607761805472">
<h2>Increasing Life Expectancies over Time</h2>
<p>Let’s do a little historical demographic analysis by seeing if there’s a correlation between the date of birth of our Nobel Prize winners and their life expectancy.<a data-primary="life expectancy of Nobel Prize winners, exploring with pandas" data-startref="ix_lifeexp" data-type="indexterm" id="idm45607761486592"/><a data-primary="age and life expectancy of Nobel Prize winners, exploring with pandas" data-secondary="life expectancy of winners" data-startref="ix_agelifelife" data-type="indexterm" id="idm45607761485648"/><a data-primary="age and life expectancy of Nobel Prize winners, exploring with pandas" data-secondary="increasing life expectancies over time" data-type="indexterm" id="idm45607761512224"/><a data-primary="lmplot method" data-type="indexterm" id="idm45607761511344"/> We’ll use one of seaborn’s <code>lmplot</code>s to provide a scatter plot and line-fitting with confidence intervals (see <a data-type="xref" href="ch10.xhtml#mpl_seaborn">“seaborn”</a>):</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df_temp</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">age_at_death</code><code class="o">.</code><code class="n">notnull</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO16-1" id="co_exploring_data_with_pandas_CO16-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO16-2" id="co_exploring_data_with_pandas_CO16-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>    </code><code class="p">{</code><code class="s1">'</code><code class="s1">age at death</code><code class="s1">'</code><code class="p">:</code><code class="n">df_temp</code><code class="o">.</code><code class="n">age_at_death</code><code class="p">,</code><code>
</code><code>     </code><code class="s1">'</code><code class="s1">date of birth</code><code class="s1">'</code><code class="p">:</code><code class="n">df_temp</code><code class="o">.</code><code class="n">date_of_birth</code><code class="o">.</code><code class="n">dt</code><code class="o">.</code><code class="n">year</code><code class="p">}</code><code class="p">)</code><code>
</code><code class="n">sns</code><code class="o">.</code><code class="n">lmplot</code><code class="p">(</code><code class="n">data</code><code class="o">=</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">x</code><code class="o">=</code><code class="s1">'</code><code class="s1">date of birth</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">y</code><code class="o">=</code><code class="s1">'</code><code class="s1">age at death</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>  </code><code class="n">height</code><code class="o">=</code><code class="mi">6</code><code class="p">,</code><code> </code><code class="n">aspect</code><code class="o">=</code><code class="mf">1.5</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO16-1" id="callout_exploring_data_with_pandas_CO16-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Creates a temporary DataFrame, removing all the rows with no <code>'age_at_death'</code> field.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO16-2" id="callout_exploring_data_with_pandas_CO16-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Creates a new DataFrame with only the two columns of interest from the refined <code>df_temp</code>. We grab only the year from the <code>date_of_birth</code>, using its <a href="https://oreil.ly/hGULX"><code>dt</code> accessor</a>.</p></dd>
</dl>
<p>This produces <a data-type="xref" href="#explore_birth_death">Figure 11-24</a>, showing an increase in life expectancy of a decade or so over the prize’s duration.</p>
<figure><div class="figure" id="explore_birth_death">
<img alt="dpj2 1124" height="1681" src="assets/dpj2_1124.png" width="2588"/>
<h6><span class="label">Figure 11-24. </span>Correlating date of birth with age at death</h6>
</div></figure>
</div></section>
</div></section>
<section data-pdf-bookmark="The Nobel Diaspora" data-type="sect1"><div class="sect1" id="idm45607761363968">
<h1>The Nobel Diaspora</h1>
<p>While cleaning our Nobel Prize dataset in <a data-type="xref" href="ch09.xhtml#chapter_cleaning">Chapter 9</a>, we found duplicate entries recording the winner’s place of birth and country at time of winning.<a data-primary="age and life expectancy of Nobel Prize winners, exploring with pandas" data-startref="ix_agelife" data-type="indexterm" id="idm45607761361520"/><a data-primary="pandas" data-secondary="exploring data with" data-startref="ix_pndsexpage" data-tertiary="age and life expectancy of Nobel Prize winners" data-type="indexterm" id="idm45607761360608"/><a data-primary="pandas" data-secondary="exploring data with" data-tertiary="diaspora of Nobel Prize winners" data-type="indexterm" id="idm45607761359152"/><a data-primary="national trends in Nobel Prize winners" data-secondary="movement of prize winners from country of birth to adopted country" data-type="indexterm" id="idm45607761357968"/> We preserved these, giving us 104 winners whose country at time of winning was different from their country of birth. Is there a story to tell here?</p>
<p>A good way to visualize the movement patterns from the winners’ country of birth to their adopted country is by using a heatmap to show all <code>born_in</code>/<code>country</code> pairs. <a data-primary="heatmaps" data-type="indexterm" id="idm45607761355712"/>The following code produces the heatmap in <a data-type="xref" href="#explore_diaspora">Figure 11-25</a>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">by_bornin_nat</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">df</code><code class="o">.</code><code class="n">born_in</code><code class="o">.</code><code class="n">notnull</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code>\</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO17-1" id="co_exploring_data_with_pandas_CO17-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>    </code><code class="p">[</code><code class="s1">'</code><code class="s1">born_in</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code class="o">.</code><code class="n">size</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">unstack</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">by_bornin_nat</code><code class="o">.</code><code class="n">index</code><code class="o">.</code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">Born in</code><code class="s1">'</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO17-2" id="co_exploring_data_with_pandas_CO17-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code class="n">by_bornin_nat</code><code class="o">.</code><code class="n">columns</code><code class="o">.</code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">Moved to</code><code class="s1">'</code><code>
</code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">12</code><code class="p">,</code><code> </code><code class="mi">12</code><code class="p">)</code><code class="p">)</code><code>
</code><code>
</code><code class="n">ax</code><code> </code><code class="o">=</code><code> </code><code class="n">sns</code><code class="o">.</code><code class="n">heatmap</code><code class="p">(</code><code class="n">by_bornin_nat</code><code class="p">,</code><code> </code><code class="n">vmin</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="n">vmax</code><code class="o">=</code><code class="mi">8</code><code class="p">,</code><code> </code><code class="n">cmap</code><code class="o">=</code><code class="s2">"</code><code class="s2">crest</code><code class="s2">"</code><code class="p">,</code><code>\</code><code> </code><a class="co" href="#callout_exploring_data_with_pandas_CO17-3" id="co_exploring_data_with_pandas_CO17-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code>                 </code><code class="n">linewidth</code><code class="o">=</code><code class="mf">0.5</code><code class="p">)</code><code>
</code><code class="n">ax</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="s1">'</code><code class="s1">The Nobel Diaspora</code><code class="s1">'</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_exploring_data_with_pandas_CO17-1" id="callout_exploring_data_with_pandas_CO17-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Selects all rows with a <code>'born_in'</code> field, and forms groups on this and the country column.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO17-2" id="callout_exploring_data_with_pandas_CO17-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We rename the row index and column  names to make them more descriptive.</p></dd>
<dt><a class="co" href="#co_exploring_data_with_pandas_CO17-3" id="callout_exploring_data_with_pandas_CO17-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>seaborn’s <code>heatmap</code> attempts to set the correct bounds for the data, but in this case, we must manually adjust the limits (<code>vmin</code> and <code>vmax</code>) to see all the cells.</p></dd>
</dl>
<figure><div class="figure" id="explore_diaspora">
<img alt="dpj2 1125" height="3471" src="assets/dpj2_1125.png" width="3291"/>
<h6><span class="label">Figure 11-25. </span>The Nobel Prize diaspora</h6>
</div></figure>
<p><a data-type="xref" href="#explore_diaspora">Figure 11-25</a> shows some interesting patterns, which tell a tale of persecution and sanctuary. First, the United States is the overwhelming recipient of relocated Nobel winners, followed by the United Kingdom. Note that the biggest contingents for both (except cross-border traffic from Canada) are from Germany. Italy, Hungary, and Austria are the next largest groups. Examining the individuals in these groups shows that the majority were displaced as a result of the rise of antisemitic fascist regimes in the run-up to World War II and the increasing persecution of Jewish minorities.</p>
<p>To take an example, all four of the Nobel winners who moved from Germany to the United Kingdom were German research scientists with Jewish ancestry who moved in response to the Nazis’ rise to power:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code><code class="p">[(</code><code class="n">df</code><code class="o">.</code><code class="n">born_in</code> <code class="o">==</code> <code class="s1">'Germany'</code><code class="p">)</code> <code class="o">&amp;</code> <code class="p">(</code><code class="n">df</code><code class="o">.</code><code class="n">country</code> <code class="o">==</code> <code class="s1">'United Kingdom'</code><code class="p">)]</code>
    <code class="p">[[</code><code class="s1">'name'</code><code class="p">,</code> <code class="s1">'date_of_birth'</code><code class="p">,</code> <code class="s1">'category'</code><code class="p">]]</code>

<code class="n">Out</code><code class="p">:</code>
                    <code class="n">name</code> <code class="n">date_of_birth</code>                <code class="n">category</code>
<code class="mi">119</code>  <code class="n">Ernst</code> <code class="n">Boris</code> <code class="n">Chain</code>    <code class="mi">1906</code><code class="o">-</code><code class="mi">06</code><code class="o">-</code><code class="mi">19</code>  <code class="n">Physiology</code> <code class="ow">or</code> <code class="n">Medicine</code>
<code class="mi">484</code>   <code class="n">Hans</code> <code class="n">Adolf</code> <code class="n">Krebs</code>    <code class="mi">1900</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">25</code>  <code class="n">Physiology</code> <code class="ow">or</code> <code class="n">Medicine</code>
<code class="mi">486</code>           <code class="n">Max</code> <code class="n">Born</code>    <code class="mi">1882</code><code class="o">-</code><code class="mi">12</code><code class="o">-</code><code class="mi">11</code>                 <code class="n">Physics</code>
<code class="mi">503</code>       <code class="n">Bernard</code> <code class="n">Katz</code>    <code class="mi">1911</code><code class="o">-</code><code class="mi">03</code><code class="o">-</code><code class="mi">26</code>  <code class="n">Physiology</code> <code class="ow">or</code> <code class="n">Medicine</code></pre>
<p>Ernst Chain pioneered the industrial production of penicillin. Hans Krebs discovered the Krebs cycle, one of the most important discoveries in biochemistry, which regulates the energy production of cells. Max Born was one of the pioneers of quantum mechanics, and Bernard Katz uncovered the fundamental properties of synaptic junctions in neurons.</p>
<p>There are many such illustrious names among the winning emigrants. One interesting discovery is the number of prize winners who were part of the famous <a href="https://oreil.ly/tIzjj">Kindertransport</a>, an organized rescue effort that took place nine months before the outbreak of WWII and saw ten thousand Jewish children from Germany, Austria, Czechoslovakia, and Poland transported to the United Kingdom. Of these children, four went on to win a Nobel Prize.</p>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45607761363376">
<h1>Summary</h1>
<p>In this chapter, we explored our Nobel Prize dataset, probing the key fields of gender, category, country, and year (of prize) looking for interesting trends and stories we can tell or enable visually. We used a fair number of Matplotlib (by way of pandas) and seaborn’s plots, from basic bar charts to more complicated statistical summaries like violin plots and heatmaps. Mastery of these tools and the others in the Python chart armory will allow you to quickly get the feel of your datasets, which is a prerequisite to building a visualization around them. We found more than enough stories in the data to suggest a web visualization. In the next chapter, we will imagine and design just such a Nobel Prize winner visualization, cherry-picking the nuggets gained in this chapter.<a data-primary="pandas" data-secondary="exploring data with" data-startref="ix_pndsexp" data-type="indexterm" id="idm45607761136688"/></p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45607764293184"><sup><a href="ch11.xhtml#idm45607764293184-marker">1</a></sup> Anecdotally, no one I have asked in person or in talk audiences has known the name of the <em>other</em> female Nobel Prize winner for Physics.</p><p data-type="footnote" id="idm45607761940144"><sup><a href="ch11.xhtml#idm45607761940144-marker">2</a></sup> See <a href="https://oreil.ly/DUd3e">Wikipedia</a> for details. Essentially the data is smoothed and a probability density function derived.</p><p data-type="footnote" id="idm45607761762448"><sup><a href="ch11.xhtml#idm45607761762448-marker">3</a></sup> We are ignoring leap years and other subtle, complicating factors in deriving years from days.</p><p data-type="footnote" id="idm45607761692592"><sup><a href="ch11.xhtml#idm45607761692592-marker">4</a></sup> Depending on the country, this is around five to six years. See <a href="https://oreil.ly/6xY9W">Our World in Data</a> for some stats.</p></div></div></section></div></body></html>