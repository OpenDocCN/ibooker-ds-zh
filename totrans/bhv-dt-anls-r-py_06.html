<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Building Causal Diagrams from Scratch"><div class="chapter" id="building_causal_diagrams_from_scratch">
<h1><span class="label">Chapter 4. </span>Building Causal Diagrams from Scratch</h1>

<blockquote data-type="epigraph" epub:type="epigraph">
<p>At this point, you may be wondering where the [causal diagram] comes from. It’s an excellent question. It may be the question.<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="about" id="idm45968166739224"/> A [CD] is supposed to be a theoretical representation of the state-of-the-art knowledge about the phenomena you’re studying. It’s what an expert would say is the thing itself, and that expertise comes from a variety of sources. Examples include economic theory, other scientific models, conversations with experts, your own observations and experiences, literature reviews, as well as your own intuition and hypotheses.</p>
<p data-type="attribution">Scott Cunningham, <em>Causal Inference: The Mixtape</em> (2021)<a contenteditable="false" data-type="indexterm" data-primary="Cunningham, Scott" id="idm45968166736088"/></p>
</blockquote>
<p>Our goal in this book is always to measure the impact of one variable on another, which we can represent as a “starter” CD<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="simplest possible" id="idm45968166734296"/> (<a data-type="xref" href="#the_simplest_possible_cd">Figure 4-1</a>).</p>
<figure><div id="the_simplest_possible_cd" class="figure">
<img src="Images/BEDA_0401.png" alt="The simplest possible CD" width="671" height="139"/>
<h6><span class="label">Figure 4-1. </span>The simplest possible CD</h6>
</div></figure>
<p>Once you have drawn that relationship, what comes next? How can you know what other variables you should include or not? Many authors say you should rely on expert knowledge, which is fine if you work in an established field like economics or epidemiology. But my perspective in this book is that you’re likely “behavioral scientist number one” in your organization and therefore you need to be able to start from a blank slate.</p>
<p>In this chapter, I’ll outline a recipe to get you from the basic CD in <a data-type="xref" href="#the_simplest_possible_cd">Figure 4-1</a> to a workable CD. As we go through the process, please keep in mind<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="about goal of" id="idm45968166727112"/> our ultimate goal of understanding what drives behaviors so that we can draw relevant and actionable conclusions for our business. Our objective is not to build a complete and precise knowledge of the whole world. Shortcuts and approximations are fair game, and everything should be assessed according to a single criterion: is this helping me with my business goal?</p>
<p>In addition, the recipe I’ll outline is not a mechanical algorithm that you could follow blindly to get to the right CD. On the contrary, business sense, common sense, and data insights will be crucial. We’ll go back and forth between our qualitative understanding of the causal situation at hand and the quantitative relationships present in the data, cross-checking one with the other until we feel that we have a satisfactory result. “Satisfactory” is an important word here: in applied settings, you usually can’t tell your manager that you’ll give them the right answer in three years. You need to give them the least bad answer possible in the short term, while planning the data collection work that will improve your answer over the years.</p>
<p>In the next section, I’ll present the business problem for this chapter and the corresponding variables of interest. We’ll then progressively build out the corresponding CD along the following recipe, with one section per step:<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="process overview" id="idm45968166723416"/></p>
<ul>
<li><p>Identify variables that could/should potentially be included in the CD.</p></li>
<li><p>Determine if the variables should be included.</p></li>
<li><p>Iterate the process as needed.</p></li>
<li><p>Simplify the diagram.</p></li>
</ul>
<p>Let’s get started!</p>
<section data-type="sect1" data-pdf-bookmark="Business Problem and Data Setup"><div class="sect1" id="business_problem_and_data_setup">
<h1>Business Problem and Data Setup</h1>
<p>For this section, we’ll be working with a real-world data set<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="data set" id="idm45968166716600"/><a contenteditable="false" data-type="indexterm" data-primary="booking cancellation and deposit type CD" id="ch04-bldCD"/><a contenteditable="false" data-type="indexterm" data-primary="GitHub" data-secondary="causal diagram–building data" id="idm45968166713400"/><a contenteditable="false" data-type="indexterm" data-primary="data" data-secondary="causal diagrams" data-tertiary="building from scratch" id="idm45968166711960"/><a contenteditable="false" data-type="indexterm" data-primary="data" data-secondary="hotel bookings real-world data set" id="idm45968166710312"/><a contenteditable="false" data-type="indexterm" data-primary="GitHub" data-secondary="hotel bookings real-world data set" id="idm45968166708920"/> of hotel bookings for two hotels located within the same city.<sup><a data-type="noteref" id="ch01fn8-marker" href="ch04.xhtml#ch01fn8">1</a></sup> The data and packages that we’ll use are described in the next subsection, and we’ll then do a deeper dive to understand the relationship of interest.</p>
<section data-type="sect2" data-pdf-bookmark="Data and Packages"><div class="sect2" id="data_and_librarie">
<h2>Data and Packages</h2>
<p>The <a href="https://oreil.ly/BehavioralDataAnalysisCh4">GitHub folder for this chapter</a> contains the CSV file <em>chap4-hotel_booking_case_study.csv</em> with the variable listed in <a data-type="xref" href="#variables_in_data_file">Table 4-1</a>.</p>
<table class="border pagebreak-before less_space" id="variables_in_data_file">
<caption><span class="label">Table 4-1. </span>Variables in data file</caption>
<thead>
<tr>
<th>Variable name</th>
<th>Variable description</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>NRDeposit</em> (NRD)</td>
<td>Binary 0/1, whether the reservation had a nonrefundable deposit</td>
</tr>
<tr>
<td><em>IsCanceled</em></td>
<td>Binary 0/1, whether the reservation was canceled or not</td>
</tr>
<tr>
<td><em>DistributionChannel</em></td>
<td>Categorical variable with values “Direct,” “Corporate,” “TA/TO” (travel agent/travel organization), “Other”</td>
</tr>
<tr>
<td><em>CustomerType</em></td>
<td>Categorical variable with values “Transient,” “Transient-Party,” “Contract,” “Group”</td>
</tr>
<tr>
<td><em>MarketSegment</em></td>
<td>Categorical variable with values “Direct,” “Corporate,” “Online TA,” “Offline TA/TO,” “Groups,” “Other”</td>
</tr>
<tr>
<td><em>Children</em></td>
<td>Integer, number of children in the reservation</td>
</tr>
<tr>
<td><em>ADR</em></td>
<td>Numeric, average daily rate, total reservation amount/number of days</td>
</tr>
<tr>
<td><em>PreviousCancellation</em></td>
<td>Binary 0/1, whether the customer previously canceled a reservation or not</td>
</tr>
<tr>
<td><em>IsRepeatedGuest</em></td>
<td>Binary 0/1, whether the customer has previously made a reservation at the hotel</td>
</tr>
<tr>
<td><em>Country</em></td>
<td>Categorical, country of origin of the customer</td>
</tr>
<tr>
<td><em>Quarter</em></td>
<td>Categorical, quarter of year for the reservation</td>
</tr>
<tr>
<td><em>Year</em></td>
<td>Integer, year of the reservation</td>
</tr>
</tbody>
</table>
<p>In this chapter, we’ll use the following packages in addition to the standard ones called out in the preface:</p>
<pre data-type="programlisting" data-code-language="r"><code class="c1">## R</code>
<code class="nf">library</code><code class="p">(</code><code class="n">rcompanion</code><code class="p">)</code> <code class="c1"># For Cramer V correlation coefficient function</code>
<code class="nf">library</code><code class="p">(</code><code class="n">car</code><code class="p">)</code> <code class="c1"># For VIF diagnostic function</code>
</pre>
<pre data-type="programlisting" data-code-language="python">
<code class="c1">## Python</code>
<code class="kn">from</code> <code class="nn">math</code> <code class="kn">import</code> <code class="n">sqrt</code> <code class="c1"># For Cramer V calculation</code>
<code class="kn">from</code> <code class="nn">scipy.stats</code> <code class="kn">import</code> <code class="n">chi2_contingency</code> <code class="c1"># For Cramer V calculation</code></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Understanding the Relationship of Interest"><div class="sect2" id="understanding_the_relationship_of_inter">
<h2>Understanding the Relationship of Interest</h2>
<p>We’ll try to answer the question,<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="business problem" id="idm45968166653768"/> “Does the type of deposit impact the cancellation rate of bookings?” as expressed in <a data-type="xref" href="#causal_relationship_of_interest">Figure 4-2</a>.</p>
<figure><div id="causal_relationship_of_interest" class="figure">
<img src="Images/BEDA_0402.png" alt="Causal relationship of interest" width="671" height="139"/>
<h6><span class="label">Figure 4-2. </span>Causal relationship of interest</h6>
</div></figure>
<p>Let’s start by looking at the base cancellation rate by deposit type<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="base cancellation rate by deposit type" id="idm45968166648472"/> (I like to look at both the absolute numbers and the percentages, in case some categories have very small numbers):</p>
<pre data-type="programlisting" data-code-language="r" class="pagebreak-before less_space"><code class="c1">## R (output not shown)</code>
<code class="nf">with</code><code class="p">(</code><code class="n">dat</code><code class="p">,</code> <code class="nf">table</code><code class="p">(</code><code class="n">NRDeposit</code><code class="p">,</code> <code class="n">IsCanceled</code><code class="p">))</code>
<code class="nf">with</code><code class="p">(</code><code class="n">dat</code><code class="p">,</code> <code class="nf">prop.table</code><code class="p">(</code><code class="nf">table</code><code class="p">(</code><code class="n">NRDeposit</code><code class="p">,</code> <code class="n">IsCanceled</code><code class="p">),</code> <code class="m">1</code><code class="p">))</code>
</pre>
<pre data-type="programlisting" data-code-language="python">
<code class="c1">## Python</code>
<code class="n">table_cnt</code> <code class="o">=</code> <code class="n">dat_df</code><code class="o">.</code><code class="n">groupby</code><code class="p">([</code><code class="s1">'NRDeposit'</code><code class="p">,</code> <code class="s1">'IsCanceled'</code><code class="p">])</code><code class="o">.</code>\
<code class="n">agg</code><code class="p">(</code><code class="n">cnt</code> <code class="o">=</code> <code class="p">(</code><code class="s1">'Country'</code><code class="p">,</code> <code class="k">lambda</code> <code class="n">x</code><code class="p">:</code> <code class="nb">len</code><code class="p">(</code><code class="n">x</code><code class="p">)))</code>
<code class="k">print</code><code class="p">(</code><code class="n">table_cnt</code><code class="p">)</code>

<code class="n">table_pct</code> <code class="o">=</code> <code class="n">table_cnt</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="n">level</code><code class="o">=</code><code class="mi">0</code><code class="p">)</code><code class="o">.</code><code class="n">apply</code><code class="p">(</code><code class="k">lambda</code> <code class="n">x</code><code class="p">:</code> <code class="mi">100</code> <code class="o">*</code> <code class="n">x</code><code class="o">/</code><code class="nb">float</code><code class="p">(</code><code class="n">x</code><code class="o">.</code><code class="n">sum</code><code class="p">()))</code>
<code class="k">print</code><code class="p">(</code><code class="n">table_pct</code><code class="p">)</code>
                        <code class="n">cnt</code>
<code class="n">NRDeposit</code> <code class="n">IsCanceled</code>       
<code class="mi">0</code>         <code class="mi">0</code>           <code class="mi">63316</code>
          <code class="mi">1</code>           <code class="mi">23042</code>
<code class="mi">1</code>         <code class="mi">0</code>              <code class="mi">55</code>
          <code class="mi">1</code>             <code class="mi">982</code>
                            <code class="n">cnt</code>
<code class="n">NRDeposit</code> <code class="n">IsCanceled</code>           
<code class="mi">0</code>         <code class="mi">0</code>           <code class="mf">73.318048</code>
          <code class="mi">1</code>           <code class="mf">26.681952</code>
<code class="mi">1</code>         <code class="mi">0</code>            <code class="mf">5.303761</code>
          <code class="mi">1</code>           <code class="mf">94.696239</code></pre>
<p>We can see that the overwhelming majority of bookings have no deposit, with a <span class="keep-together">cancellation</span> rate of about 27%. <a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="confounder" id="idm45968166572616"/><a contenteditable="false" data-type="indexterm" data-primary="confounders" data-secondary="hotel booking cancellation rate" id="idm45968166440392"/>On the other hand, bookings with nonrefundable deposits (<em>NRDeposit</em>) have a very high cancellation rate. On the face of it, this correlation is surprising. Would changing our policy to “no deposit” for everyone reduce cancellation rates? Behavioral common sense tells us that more likely, the hotels are requesting nonrefundable deposits for “high risk” bookings and there is a confounder, as represented in <a data-type="xref" href="#the_causal_relationship_is_likely_confo">Figure 4-3</a>.</p>
<figure><div id="the_causal_relationship_is_likely_confo" class="figure">
<img src="Images/BEDA_0403.png" alt="The causal relationship is likely confounded" width="671" height="417"/>
<h6><span class="label">Figure 4-3. </span>The causal relationship is likely confounded</h6>
</div></figure>
<p>We went pretty quickly from <a data-type="xref" href="#causal_relationship_of_interest">Figure 4-2</a> to <a data-type="xref" href="#the_causal_relationship_is_likely_confo">Figure 4-3</a>, but it was an important step: the CD in <a data-type="xref" href="#causal_relationship_of_interest">Figure 4-2</a> represents a basic business analytics question, “What is the causal relationship between deposit type and cancellation rate?” On the other hand, the CD in <a data-type="xref" href="#the_causal_relationship_is_likely_confo">Figure 4-3</a> represents a more informed behavioral hypothesis: “A <span class="keep-together">nonrefundable</span> deposit seems to increase cancellation rate, but that relationship is probably confounded by factors we’ll need to determine.”</p>
<p>A nice aspect of using CDs for behavioral data analysis is <a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="collaboration tool" id="idm45968166429000"/><a contenteditable="false" data-type="indexterm" data-primary="information unknown" data-secondary="causal diagrams eliciting" id="idm45968166427624"/>that they are a great collaboration tool. Anyone in your organization with minimal knowledge of CDs can look at <a data-type="xref" href="#the_causal_relationship_is_likely_confo">Figure 4-3</a> and say, “Well yeah, we require nonrefundable deposits for holiday bookings and these often get canceled because of weather,” or any other tidbit of behavioral knowledge that you couldn’t get otherwise.</p>
<p>At this point, the best next step would be a randomized experiment: assign refundable or nonrefundable deposits to a random sample of customers and you’ll be able to confirm or disprove your behavioral hypothesis. However, you may not be able to do so, or not yet. In the meantime, we’ll try to deconfound the relationship by identifying relevant variables to include.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Identify Candidate Variables to Include"><div class="sect1" id="identify_candidate_variables_to_include">
<h1>Identify Candidate Variables to Include</h1>
<p>When trying to identify potential variables to include, a natural<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="variables to include" id="ch04-var2i"/><a contenteditable="false" data-type="indexterm" data-primary="variables" data-secondary="causal diagrams" data-tertiary="variables to include" id="ch04-var2i2"/> inclination is to start with the data you have available. This inclination is misleading, akin to the drunk person who looks for their house keys not where they lost them, but under a streetlamp because there is more light there. By doing so, you may be ignoring the most important variables simply because they’re not under your nose. You’re also more likely to take the variables in your data at face value, and not question whether they are the best representation of what’s happening in the real world.</p>
<p>For instance, categorical variables in your data are likely to<a contenteditable="false" data-type="indexterm" data-primary="categorical variables" data-secondary="business-centric" id="idm45968166417112"/> represent a business-centric perspective rather than a customer-centric perspective, and it may be more appropriate to aggregate some categories together, or even to merge different variables into new ones. In our case, we have a variable <em>MarketSegment</em> and one for the number of children in the reservation. We can confirm by looking at the data that very few corporate customers bring children with them. Therefore we could consider creating a new categorical variable with categories “corporate without children,” “noncorporate without children,” and “noncorporate with children,” setting aside the corporate customers with children as outliers worthy of a separate investigation (maybe the seed for tailored services?).</p>
<p>Instead of falling for this “What You See Is All There Is” bias,<a contenteditable="false" data-type="indexterm" data-primary="data" data-secondary="variable selection examples" data-tertiary="causal diagrams" id="idm45968166413944"/><a contenteditable="false" data-type="indexterm" data-primary="variables" data-secondary="variable selection examples" data-tertiary="causal diagrams" id="idm45968166412200"/><a contenteditable="false" data-type="indexterm" data-primary="biases in data and analyses" data-secondary="What You See Is All There Is" id="idm45968166410536"/><a contenteditable="false" data-type="indexterm" data-primary="Kahneman, Daniel" id="idm45968166409128"/><sup><a data-type="noteref" id="ch01fn9-marker" href="ch04.xhtml#ch01fn9">2</a></sup> we’ll start with the behavioral categories outlined in <a data-type="xref" href="ch02.xhtml#understanding_behavioral_data">Chapter 2</a>, from the action backward:</p>
<ul class="pagebreak-before less_space">
<li><p>Actions</p></li>
<li><p>Intentions</p></li>
<li><p>Cognition and emotions</p></li>
<li><p>Personal characteristics</p></li>
<li><p>Business behaviors</p></li>
</ul>
<p>Finally, variables in each one of these categories may be affected by time trends such as linear trends or seasonality, so we’ll add these by default at the end of this section. In order to reinforce the focus on qualitative intuitions, we won’t look at any data until the next section, about validating relationships. Replacing our a priori cancellation risk (as well as other potential confounders) by these categories, our CD now looks like <a data-type="xref" href="#updated_cd_with_categories_of_potential">Figure 4-4</a>, with a bunch of unobserved variables added to our two variables of interest.</p>
<figure><div id="updated_cd_with_categories_of_potential" class="figure">
<img src="Images/BEDA_0404.png" alt="Updated CD with categories of potential variables to include" width="1421" height="750"/>
<h6><span class="label">Figure 4-4. </span>Updated CD with categories of potential variables to include</h6>
</div></figure>
<p>For each of these categories, we’ll now look for variables that may be a cause of either of our two variables of interest.</p>
<section data-type="sect2" class="pagebreak-before" data-pdf-bookmark="Actions"><div class="sect2" id="action">
<h2 class="less_space">Actions</h2>
<p>When looking for variables to include in the actions category,<a contenteditable="false" data-type="indexterm" data-primary="actions" data-secondary="causal diagram variable selection" id="idm45968166395320"/><a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="actions" id="idm45968166393848"/> we’re usually trying to identify past behaviors from the customer that may affect whether the hotel required a nonrefundable deposit (NRD).</p>
<p>An obvious candidate in this case is whether the customer previously canceled. Maybe the hotel is more likely to request an NRD from customers who flaked in the past. It is also conceivable that whatever caused them to cancel in the past is also more likely to make them cancel in the future.</p>
<p>More generally, when one of our variables of interest is itself an action, past behavior is often a good predictive variable to include, even just as a proxy for unobserved personal characteristics. We have two variables related to past behavior in our data: <span class="keep-together"><em>PreviousCancellation</em></span> and <em>IsRepeatedGuest</em>. <a data-type="xref" href="#updated_cd_at_the_end_of_the_actions_st">Figure 4-5</a> shows our updated CD, with the unchanged portions in gray.</p>
<figure><div id="updated_cd_at_the_end_of_the_actions_st" class="figure">
<img src="Images/BEDA_0405.png" alt="Updated CD at the end of the actions step" width="1356" height="915"/>
<h6><span class="label">Figure 4-5. </span>Updated CD at the end of the actions step</h6>
</div></figure>
<p>This is not to say that these are the only relevant past behaviors; they just happen to be the only ones I thought of and that we had data for. Hopefully, you can think of others!</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Intentions"><div class="sect2" id="intentions-id00050">
<h2>Intentions</h2>
<p>Intentions are easy to overlook in data analysis, because they<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="intentions" id="idm45968166383512"/><a contenteditable="false" data-type="indexterm" data-primary="intentions" data-secondary="causal diagram building" id="idm45968166381784"/><a contenteditable="false" data-type="indexterm" data-primary="intentions" data-secondary="about" id="idm45968166380408"/> are often missing from our existing data. However, they are one of the most important drivers of behaviors, and they can often be revealed by interviewing customers and employees. They thus represent one of the best illustrations of the benefits of not just looking at existing, available data, but adopting a “behaviors first” approach.</p>
<p>In this case, there are two intentions I can think of: the reason for the trip and the reason for the cancellation (<a data-type="xref" href="#adding_intentions_to_our_cd">Figure 4-6</a>).</p>
<figure><div id="adding_intentions_to_our_cd" class="figure">
<img src="Images/BEDA_0406.png" alt="Adding intentions to our CD" width="1423" height="915"/>
<h6><span class="label">Figure 4-6. </span>Adding intentions to our CD</h6>
</div></figure>
<p>Note that I represented <em>TripReason</em> as a potential confounder, i.e., with an arrow to both of our variables of interest, whereas <em>CancellationReason</em> affects only <em>IsCanceled</em>. At this point, this is just a behavioral hunch, namely that the reason for the cancellation doesn’t affect the type of deposit. My rationale is that the reason for cancellation is not known at the time of the deposit.</p>
<p class="pagebreak-before less_space"><a data-type="xref" href="#adding_intentions_to_our_cd">Figure 4-6</a> also shows the versatility of CDs for behavioral analysis: we can put down these two potential variables in our CD even without knowing the actual list of reasons in either case, which we’ll determine later through interviews. For the time being, we can note that three of the variables available in our data appear to be affected by trip reason and can be included as such: <em>CustomerType</em>, <em>MarketSegment,</em> and <em>DistributionChannel</em> (<a data-type="xref" href="#updated_cd_at_the_end_of_the_intention">Figure 4-7</a>). We’ll also revisit these variables in the subsection about personal characteristics.</p>
<figure><div id="updated_cd_at_the_end_of_the_intention" class="figure">
<img src="Images/BEDA_0407.png" alt="Updated CD at the end of the intention step" width="1455" height="1203"/>
<h6><span class="label">Figure 4-7. </span>Updated CD at the end of the intention step</h6>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Cognition and Emotions"><div class="sect2" id="cognition_and_emotions">
<h2>Cognition and Emotions</h2>
<p>When trying to identify relevant social, psychological, or cognitive<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="cognition and emotions" id="idm45968166364552"/><a contenteditable="false" data-type="indexterm" data-primary="cognition in human behavior" data-secondary="causal diagram building" id="idm45968166362824"/><a contenteditable="false" data-type="indexterm" data-primary="emotions in human behavior" data-secondary="causal diagram building" id="idm45968166337208"/><a contenteditable="false" data-type="indexterm" data-primary="decision points in causal diagram building" id="idm45968166335864"/> phenomena for an analysis, I like to zoom in on specific decision points. Here that would be when the customer makes the reservation and when they cancel it.</p>
<p>At the first decision point, customers may not understand that their deposit is nonrefundable, or they may forget it. At the second decision point, they may treat their deposit as a sunk cost and not make efforts to keep their reservations (<a data-type="xref" href="#updated_cd_at_the_end_of_the_cognition">Figure 4-8</a>).</p>
<figure><div id="updated_cd_at_the_end_of_the_cognition" class="figure">
<img src="Images/BEDA_0408.png" alt="Updated CD at the end of the cognition and emotions step" width="1649" height="1203"/>
<h6><span class="label">Figure 4-8. </span>Updated CD at the end of the cognition and emotions step</h6>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Personal Characteristics"><div class="sect2" id="personal_characteristics-id00058">
<h2>Personal Characteristics</h2>
<p>As mentioned in <a data-type="xref" href="ch02.xhtml#understanding_behavioral_data">Chapter 2</a>, <a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="personal characteristics" id="idm45968166327656"/><a contenteditable="false" data-type="indexterm" data-primary="personal characteristics in human behavior" data-secondary="causal diagram building" id="idm45968166325944"/><a contenteditable="false" data-type="indexterm" data-primary="demographic variables" data-secondary="causal diagram building" id="idm45968166324536"/>demographic variables are often valuable not so much for themselves but as proxies for other personal characteristics such as personality traits. The challenge at this step is therefore to resist the pull of whatever demographic variables are present in our data, and stick with our causal-behavioral mindset. A good way to do so is to think about traits first, before looking at demographic variables.</p>
<section data-type="sect3" class="pagebreak-before" data-pdf-bookmark="Traits"><div class="sect3" id="traits">
<h3 class="less_space">Traits</h3>
<p>Based on our knowledge of personality psychology, good<a contenteditable="false" data-type="indexterm" data-primary="traits of personality in causal diagrams" id="idm45968166320344"/> candidate traits to cause our cancellation behavior are conscientiousness and neuroticism: it seems plausible that less organized and more carefree people are more likely to end up cancelling a reservation (<a data-type="xref" href="#cd_updated_with_personality_traits">Figure 4-9</a>).</p>
<figure><div id="cd_updated_with_personality_traits" class="figure">
<img src="Images/BEDA_0409.png" alt="CD updated with personality traits" width="1455" height="1203"/>
<h6><span class="label">Figure 4-9. </span>CD updated with personality traits</h6>
</div></figure>
</div></section>
<section data-type="sect3" class="pagebreak-before" data-pdf-bookmark="Demographic variables"><div class="sect3" id="demographic_variables">
<h3 class="less_space">Demographic variables</h3>
<p>We noted earlier that we have corporate and noncorporate customers making reservations at the hotels. Beyond the reasons for the trip and for the cancellation, this also affects some other personal characteristics such as price elasticity and income, both of which would affect our two variables of interest. Let’s group these under the heading “financial characteristics.” They are probably somewhat captured by the three variables we saw earlier, <em>CustomerType</em>, <em>MarketSegment,</em> and <em>DistributionChannel</em>, as well as by a few other variables in our data such as <em>Children</em>, <em>ADR</em> (the average daily rate, i.e., the price for a night), and <em>Country</em> (<a data-type="xref" href="#cd_updated_with_demographic_variables">Figure 4-10</a>).</p>
<figure><div id="cd_updated_with_demographic_variables" class="figure">
<img src="Images/BEDA_0410.png" alt="CD updated with demographic variables" width="1455" height="1337"/>
<h6><span class="label">Figure 4-10. </span>CD updated with demographic variables</h6>
</div></figure>
</div></section>
</div></section>
<section data-type="sect2" class="pagebreak-before" data-pdf-bookmark="Business Behaviors"><div class="sect2" id="business_behaviors">
<h2 class="less_space">Business Behaviors</h2>
<p>Business behaviors often play a big role in the relationships we’re<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="business behaviors" id="idm45968166304408"/><a contenteditable="false" data-type="indexterm" data-primary="business behaviors" data-secondary="causal diagram building" id="idm45968166302680"/> investigating, but they can easily be overlooked and tricky to integrate.</p>
<p>In this example, business rules obviously play an important role, as they determine which customers will have to provide an NRD. In that sense, they influence <em>all</em> the arrows in the CD going into <em>NRDeposit</em>. We can account for this influence in several ways, depending on the forms it takes.</p>
<p>A business rule may explicitly connect two observable variables (possibly including our variables of interest). Here for instance, we can imagine a business rule stating that all customers who have previously canceled must now provide an NRD. By listing all such rules, we can confirm or disprove all arrows from an observed variable directly into <em>NRDeposit</em>. This may also surface variables that are involved in business rules but are not yet in our data: for example, we could imagine that customers who don’t provide a proof of ID at the time of the reservation must pay an NRD. I said “not yet in our data” because by definition any criterion that is part of a business rule is observable, even if it’s not captured in a database.<sup><a data-type="noteref" id="idm45968166298152-marker" href="ch04.xhtml#idm45968166298152">3</a></sup></p>
<p>Alternatively, a business rule may be best represented as an additional intermediary variable. For instance, if all reservations during the Christmas holidays must be backed by an NRD, we could create a <em>ChristmasHolidays</em> binary variable with an arrow to <em>NRDeposit</em>. That variable would then mediate the effect of other variables such as <em>CustomerType</em> or <em>Children</em> on <em>NRDeposit</em>.</p>
<p>We don’t know what business rules the two hotels in our example apply so we have to leave that subsection as something that we would want to explore through later <span class="keep-together">interviews.</span></p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Time Trends"><div class="sect2" id="time_trends">
<h2>Time Trends</h2>
<p>Finally, there might be some global time trends in our data, such<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="time trends" id="idm45968166291672"/><a contenteditable="false" data-type="indexterm" data-primary="timing" data-secondary="time trends in building causal diagrams" id="idm45968166289944"/> as a progressive increase in the number of reservations requiring an NRD paralleled by a progressive, but unrelated, increase in the cancellation rate. In addition, given how seasonal the hotel industry is, there are probably some cyclical aspects that we would want to capture (<a data-type="xref" href="#updated_cd_at_the_end_of_the_time_trend">Figure 4-11</a>).</p>
<figure><div id="updated_cd_at_the_end_of_the_time_trend" class="figure">
<img src="Images/BEDA_0411.png" alt="Updated CD at the end of the time trends step" width="1455" height="1337"/>
<h6><span class="label">Figure 4-11. </span>Updated CD at the end of the time trends step</h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In the present case, the <em>Year</em> and <em>Quarter</em> variables only capture trends and cycles. Sometimes it can also make sense to include binary variables to account for specific events that make a certain year stand out or mark a permanent change. An obvious example is COVID-19, which, when the dust settles, will turn out to have been a temporary blip in certain sectors but the beginning of a sea change in others.</p>
</div>
<p>With that final addition, <a data-type="xref" href="#updated_cd_at_the_end_of_the_time_trend">Figure 4-11</a> now has a raft of candidate variables, some observable and some not. In the next section, we’ll see how to confirm which observable variables to keep.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ch04-var2i" id="idm45968166280968"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ch04-var2i2" id="idm45968166279624"/></p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Validate Observable Variables to Include Based on Data"><div class="sect1" id="validate_observable_variables_to_includ">
<h1>Validate Observable Variables to Include Based on Data</h1>
<p>Let’s look at the observable variables we have as candidates at<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="variables validated via data" id="ch04-varval"/><a contenteditable="false" data-type="indexterm" data-primary="variables" data-secondary="causal diagrams" data-tertiary="variables validated via data" id="ch04-varval2"/><a contenteditable="false" data-type="indexterm" data-primary="data" data-secondary="variable selection examples" data-tertiary="variables validated via data" id="ch04-varval3"/> the end of the identification phase (<a data-type="xref" href="#observable_variables_in_our_cdcomma_spl">Figure 4-12</a>).</p>
<figure><div id="observable_variables_in_our_cdcomma_spl" class="figure">
<img src="Images/BEDA_0412.png" alt="Observable variables in our CD, split by categorical (left) and numeric (right)" width="1434" height="1282"/>
<h6><span class="label">Figure 4-12. </span>Observable variables in our CD, split by categorical (left) and numeric (right)</h6>
</div></figure>
<p>In this specific example, all of these observable variables are tentatively connected to both of our variables of interest. This is the default situation, but in some cases you may have a very strong a priori rationale to connect a predictor variable to only one of your variables of interest (that was the case, for example, with some of our unobserved variables). When in doubt, I would err on the side of caution and include both connections.</p>
<p>In <a data-type="xref" href="#observable_variables_in_our_cdcomma_spl">Figure 4-12</a>, the observable <a contenteditable="false" data-type="indexterm" data-primary="data" data-secondary="categorical" data-see="categorical variables" id="idm45968166265032"/><a contenteditable="false" data-type="indexterm" data-primary="data" data-secondary="numeric" data-see="numeric variables" id="idm45968166263384"/><a contenteditable="false" data-type="indexterm" data-primary="categorical variables" data-secondary="causal diagram variables" id="idm45968166261736"/><a contenteditable="false" data-type="indexterm" data-primary="numeric variables" data-secondary="causal diagram variables" id="idm45968166260344"/>variables are split between categorical (on the left of the CD) and numeric (on the right of the CD). These two types of data call for different quantitative tools, so we’ll see them in turn.</p>
<section data-type="sect2" data-pdf-bookmark="Relationships Between Numeric Variables"><div class="sect2" id="relationships_between_numeric_variables">
<h2>Relationships Between Numeric Variables</h2>
<p>Our first step will be to look at the correlation matrix for all the<a contenteditable="false" data-type="indexterm" data-primary="numeric variables" data-secondary="binary variables with 0/1 values" id="idm45968166256504"/><a contenteditable="false" data-type="indexterm" data-primary="confounders" data-secondary="hotel booking cancellation rate" id="idm45968166254984"/><a contenteditable="false" data-type="indexterm" data-primary="numeric variables" data-secondary="relationships between" id="idm45968166253592"/><a contenteditable="false" data-type="indexterm" data-primary="binary variables" data-secondary="numeric with 0/1 values" id="idm45968166252216"/> numeric variables in our data. A useful but dirty trick is to convert binary variables to 0/1 (if they’re not already in that format) so that you can treat them as numeric. It allows you to get a sense of the correlation between variables, but don’t tell your statistician friends!</p>
<p>Looking at the rows for your two variables of interest will allow you to see how <a contenteditable="false" data-type="indexterm" data-primary="correlation" data-secondary="relationships between numeric variables" id="idm45968166249992"/><a contenteditable="false" data-type="indexterm" data-primary="causes" data-secondary="correlation implying causation" id="idm45968166248504"/><a contenteditable="false" data-type="indexterm" data-primary="correlation" data-secondary="causation implied" id="idm45968166247112"/>correlated they are with all the numeric variables in your data set. At a glance, it will also show you any large correlation between these other variables. The strength of the correlation with the cause and effect of interest can then help us determine what to do with a given variable.</p>
<p>How strong is strong? It depends. Remember that our goal is to correctly measure the causal effect of our cause of interest on our effect of interest; as a rule of thumb, you can consider as “strong” any correlation that is of the same order of magnitude (i.e., the same number of zeros between the comma and the first nonzero digit) as the correlation between your cause of interest and your effect of interest.</p>
<p>As you can see in <a data-type="xref" href="#correlation_matrix_for_numeric_and_bina">Figure 4-13</a>, the correlation coefficient between our two variables of interest is 0.16. The first column indicates the correlations with <em>NRDeposit</em> and the second column the correlations with <em>IsCanceled</em>. <em>PreviousCancellation</em> has correlation coefficients with our variables of interest that are of the same order of magnitude (0.15 and 0.13, respectively). Similarly, <em>ADR</em> has a correlation coefficient with <em>IsCanceled</em> that is significant by that criterion (0.13).</p>
<p>The “order of magnitude” threshold for inclusion is not scientific in the least, and it can be tightened or loosened depending on how many variables you have at hand. If you have few variables passing the threshold and some other variables are close to it, it is perfectly fine to include them.</p>
<p>You may object that a variable could have a low correlation with either of our variables of interest but still be a confounder that needs to be accounted for. This is true, and you can include a variable even if it is only feebly correlated with our variables of interest, based on a strong theoretical rationale. However, for practical purposes, you should usually focus on variables having at least a moderate level of correlation with our variables of interest.</p>
<figure><div id="correlation_matrix_for_numeric_and_bina" class="figure">
<img src="Images/BEDA_0413.png" alt="Correlation matrix for numeric and binary variables" width="1463" height="1339"/>
<h6><span class="label">Figure 4-13. </span>Correlation matrix for numeric and binary variables</h6>
</div></figure>
<p>If we include all the correlations that are 0.1 or above in absolute value in <a data-type="xref" href="#correlation_matrix_for_numeric_and_bina">Figure 4-13</a> and exclude the others, our CD is now as in <a data-type="xref" href="#cd_with_updated_arrows_for_the_numeric">Figure 4-14</a>.</p>
<figure><div id="cd_with_updated_arrows_for_the_numeric" class="figure">
<img src="Images/BEDA_0414.png" alt="CD with updated arrows for the numeric and binary observable variables" width="1438" height="966"/>
<h6><span class="label">Figure 4-14. </span>CD with updated arrows for the numeric and binary observable variables</h6>
</div></figure>
<p>While the correlation matrix only gives us symmetrical coefficients that could represent arrows in either direction, I have used some common sense and business knowledge to assume the direction of the arrows. The hotel company has no mastery of time, so we can assume that <em>Years</em> is the cause and not the effect of variables it’s correlated with, although that effect may go through intermediary variables such as trends in society over time. <em>IsRepeatedGuest</em> is a prerequisite for <em>PreviousCancellation</em>; because it refers to a past event, it must also be the cause of <em>ADR</em> or they both share a common cause.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Don’t forget that this is a <em>tentative</em> CD:</p>
<ul>
<li><p>Some of these correlations are likely false positives (the coefficient appears stronger than it really is, out of sheer randomness) and conversely, some of the smaller correlations may be false negatives.</p></li>
<li><p>At this stage, we’re tentatively treating correlations as evidence of causation. Some of the arrows we’ve drawn in <a data-type="xref" href="#cd_with_updated_arrows_for_the_numeric">Figure 4-14</a> may themselves reflect relationships that are confounded. After adequately measuring the relationship between <em>NRDeposit</em> and <em>IsCanceled</em>, we may want or need to do the same for other relationships (e.g., the one between <em>IsRepeatedGuest</em> and <em>ADR</em>).</p></li>
</ul>
</div>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Relationships Between Categorical Variables"><div class="sect2" id="relationships_between_categorical_varia">
<h2>Relationships Between Categorical Variables</h2>
<p>The same logic applies for categorical variables, with the only<a contenteditable="false" data-type="indexterm" data-primary="categorical variables" data-secondary="relationships between" id="idm45968166220712"/><a contenteditable="false" data-type="indexterm" data-primary="Cramer’s V for categorical variables" id="idm45968166219256"/><a contenteditable="false" data-type="indexterm" data-primary="categorical variables" data-secondary="Cramer’s V for" id="idm45968166218136"/><a contenteditable="false" data-type="indexterm" data-primary="binary variables" data-secondary="Cramer’s V for categorical variables" id="idm45968166216760"/> complication that we can’t use Pearson’s correlation coefficient. However, a variant of it, <a href="https://oreil.ly/KAoIa">Cramer’s V</a>, has been developed for categorical variables. In R, it is implemented in the <code>rcompanion</code> package:</p>
<pre data-type="programlisting" data-code-language="r"><code class="c1">## R</code>
<code class="o">&gt;</code> <code class="nf">with</code><code class="p">(</code><code class="n">dat</code><code class="p">,</code> <code class="n">rcompanion</code><code class="o">::</code><code class="nf">cramerV</code><code class="p">(</code><code class="n">NRDeposit</code><code class="p">,</code> <code class="n">IsCanceled</code><code class="p">))</code>
<code class="n">Cramer</code> <code class="n">V</code> 
   <code class="m">0.165</code></pre>
<p>You can see that in the case of binary variables, it yields a result that is quite close to the direct application of Pearson’s correlation coefficient. Unfortunately, it is not implemented in Python, but I provide a function to calculate it:<a contenteditable="false" data-type="indexterm" data-primary="Python" data-secondary="Cramer’s V function" id="idm45968166200888"/></p>
<pre data-type="programlisting" data-code-language="python"><code class="c1">## Python</code>
<code class="k">def</code>  <code class="nf">CramerV</code><code class="p">(</code><code class="n">var1</code><code class="p">,</code> <code class="n">var2</code><code class="p">):</code>
    <code class="o">...</code>
    <code class="k">return</code> <code class="n">V</code>

<code class="n">V</code> <code class="o">=</code> <code class="n">CramerV</code><code class="p">(</code><code class="n">dat_df</code><code class="p">[</code><code class="s1">'NRDeposit'</code><code class="p">],</code> <code class="n">dat_df</code><code class="p">[</code><code class="s1">'IsCanceled'</code><code class="p">])</code>   
<code class="k">print</code><code class="p">(</code><code class="n">V</code><code class="p">)</code>
<code class="mf">0.16483946381640308</code></pre>
<p><a data-type="xref" href="#correlation_matrix_for_categorical_and">Figure 4-15</a> shows the corresponding correlation matrix.</p>
<p>This correlation yields a variety of insights. Looking at the bottom row, we can see that <em>Quarter</em> <a contenteditable="false" data-type="indexterm" data-primary="granularity" data-secondary="units of time" id="idm45968166142872"/><a contenteditable="false" data-type="indexterm" data-primary="time intervals" data-secondary="granularity" id="idm45968166141528"/>is not meaningfully correlated with anything else. This suggests that seasonality is not a relevant factor for our analysis. Conversely, it is possible that a quarter is too coarse a unit of time and that we need to zoom in on very specific time periods such as the Christmas holidays. We can drop <em>Quarter</em> from our CD and replace it with an unobserved variable <em>Seasonality</em> as a cue for future research.</p>
<p>Our three variables for customer segments, <em>CustomerType</em>, <em>MarketSegment,</em> and <em>DistributionChannel,</em> show a mixed pattern, with some very strong and some weak correlations between them. Similarly, their correlations with other variables are all over the place: all three of them have correlations with <em>Country</em> in the 0.1X digits for example, but two of them have high correlations with <em>RepeatedGuest</em> (0.35 and 0.4) whereas the third one has a correlation of only 0.11. This suggests that these variables are not just interchangeable, but that they are capturing some aspects of the same behaviors. This calls for further investigation and most likely creating new variables.</p>
<figure><div id="correlation_matrix_for_categorical_and" class="figure">
<img src="Images/BEDA_0415.png" alt="Correlation matrix for categorical and binary variables" width="1345" height="1225"/>
<h6><span class="label">Figure 4-15. </span>Correlation matrix for categorical and binary variables</h6>
</div></figure>
<p>Applying these insights and the same criterion of including only correlations above 0.1, our CD now looks like <a data-type="xref" href="#cd_with_updated_arrows_for_the_categori">Figure 4-16</a>.</p>
<figure><div id="cd_with_updated_arrows_for_the_categori" class="figure">
<img src="Images/BEDA_0416.png" alt="CD with updated arrows for the categorical and binary observable variables" width="1438" height="966"/>
<h6><span class="label">Figure 4-16. </span>CD with updated arrows for the categorical and binary observable variables</h6>
</div></figure>
<p>Our CD is starting to get moderately complex, but it can for the most part be summarized in a few behavioral arguments:</p>
<ul>
<li><p>Our four variables on the left reflect personal characteristics and they are significantly correlated with each other. I have chosen to reflect these correlations with double-headed arrows because trying to determine the direction of arrows would be pointless: <em>CustomerType</em> doesn’t cause <em>MarketSegment</em> any more than the other way around. In reality, after doing the necessary interviews, we should create new variables that capture the deeper personal characteristics at play.</p></li>
<li><p>Personal characteristics appear to affect our variables of interest, potentially causing some confounding.</p></li>
<li><p>Personal characteristics appear to have affected past behaviors <em>IsRepeatedGuest</em> and <em>PreviousCancellation.</em> (Again, I’m making assumptions on the direction of the effects based on business knowledge. On the face of it, it seems unlikely that having canceled a previous reservation would make someone change country or market segment.) Once we have clarified the nature of the deeper personal characteristics at play, we may decide to fold these past behaviors under some personal characteristics variables, implicitly creating behavioral personas (e.g., “recurring business traveler (Y/N)”).</p></li>
</ul>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Relationships Between Numeric and Categorical Variables"><div class="sect2" id="relationships_between_numeric_and_categ">
<h2>Relationships Between Numeric and Categorical Variables</h2>
<p>Measuring correlations between numeric and categorical<a contenteditable="false" data-type="indexterm" data-primary="numeric variables" data-secondary="relationships with categorical" id="idm45968166122568"/><a contenteditable="false" data-type="indexterm" data-primary="categorical variables" data-secondary="relationships between numeric and" id="idm45968166121176"/><a contenteditable="false" data-type="indexterm" data-primary="regression" data-secondary="relationships between numeric and categorical variables" id="idm45968166119784"/> variables is a more cumbersome process than measuring correlations within a homogenous category.</p>
<p>Saying that there is a correlation between a numeric and a categorical variable is equivalent to saying that the values of the numeric variable are different on average across the categories of the categorical variable. We can check if this is the case by comparing the mean of the numeric variable across the categories of the categorical variable. For example, we expect that the financial characteristics of the customer may impact the average daily rate for the reservation. It would be best to explore that relationship after having built better variables for customer segmentation, but for the sake of the argument we can use <em>CustomerType</em>:</p>
<pre data-type="programlisting" data-code-language="r">
<code class="c1">## R (output not shown)</code>
<code class="o">&gt;</code> <code class="n">dat</code> <code class="o">%&gt;%</code> <code class="nf">group_by</code><code class="p">(</code><code class="n">CustTyp</code><code class="p">)</code> <code class="o">%&gt;%</code> <code class="nf">summarize</code><code class="p">(</code><code class="n">ADR</code> <code class="o">=</code> <code class="nf">mean</code><code class="p">(</code><code class="n">ADR</code><code class="p">))</code></pre>
<pre data-type="programlisting" data-code-language="python"><code class="c1">## Python</code>
<code class="n">dat_df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'CustTyp'</code><code class="p">)</code><code class="o">.</code><code class="n">agg</code><code class="p">(</code><code class="n">ADR</code> <code class="o">=</code> <code class="p">(</code><code class="s1">'ADR'</code><code class="p">,</code> <code class="n">np</code><code class="o">.</code><code class="n">mean</code><code class="p">))</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">10</code><code class="p">]:</code> 
                        <code class="n">ADR</code>
<code class="n">CustTyp</code>                    
<code class="n">Contract</code>          <code class="mf">92.753036</code>
<code class="n">Group</code>             <code class="mf">84.361949</code>
<code class="n">Transient</code>        <code class="mf">110.062373</code>
<code class="n">Transient</code><code class="o">-</code><code class="n">Party</code>   <code class="mf">87.675056</code>
</pre>
<p>We can see that the average daily rate varies substantially between customer types.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you’re unsure whether the variations are truly substantial or if they only reflect random sampling errors, you can build confidence intervals for them using the Bootstrap, as explained later in <a data-type="xref" href="ch07.xhtml#measuring_uncertainty_with_the_bootstra">Chapter 7</a>.</p>
</div>
<p>In our example, there are two numeric variables whose correlation with categorical variables we may want to check: <em>ADR</em> and <em>Year</em>. We find that <em>ADR</em> varies substantially across customer types but that these are reasonably stable over time, which brings us to our final CD for observable variables (<a data-type="xref" href="#final_cd_for_observable_variables">Figure 4-17</a>).</p>
<p>At this point, I’d like to reiterate and expand on my earlier warning: in the process of validating observable variables,<a contenteditable="false" data-type="indexterm" data-primary="correlation" data-secondary="causation implied" id="idm45968166005848"/><a contenteditable="false" data-type="indexterm" data-primary="causes" data-secondary="correlation implying causation" id="idm45968166004472"/><a contenteditable="false" data-type="indexterm" data-primary="confounders" data-secondary="hotel booking cancellation rate" id="idm45968166003128"/> I have implicitly assumed that correlation was causation. But maybe these relationships are themselves confounded: the correlation between personal characteristics variables and <em>PreviousCancellation</em> might be entirely caused by the relationship between personal characteristics variables and <span class="keep-together"><em>IsRepeatedGuest</em>.</span></p>
<figure><div id="final_cd_for_observable_variables" class="figure">
<img src="Images/BEDA_0417.png" alt="Final CD for observable variables" width="1438" height="1141"/>
<h6><span class="label">Figure 4-17. </span>Final CD for observable variables</h6>
</div></figure>
<p>Let’s imagine for instance that business customers are more likely to be repeated guests. They may then also appear to have a higher rate of previous cancellation than leisure customers even though among repeated guests, business and leisure customers have the exact same rate of previous cancellations.</p>
<p>You can think of these causality assumptions as white lies:<a contenteditable="false" data-type="indexterm" data-primary="causes" data-secondary="correlation implying causation" data-tertiary="white lies" id="idm45968165996936"/><a contenteditable="false" data-type="indexterm" data-primary="correlation" data-secondary="causation implied" data-tertiary="white lies" id="idm45968165995224"/> they’re not true, but it’s OK, because we’re not trying to build the true, complete CD, we’re trying to deconfound the relationship between NRD and cancellation rate. From that perspective, it is <em>much</em> more important to get the direction of arrows right than to have unconfounded relationships between variables outside of our variables of interest. If you’re still skeptical, one of the exercises in the next chapter explores this question further.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ch04-varval" id="idm45968165992536"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ch04-varval2" id="idm45968165991160"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ch04-varval3" id="idm45968165989784"/></p>
</div></section>
</div></section>
<section data-type="sect1" class="pagebreak-before" data-pdf-bookmark="Expand Causal Diagram Iteratively"><div class="sect1" id="expand_causal_diagram_iteratively">
<h1 class="less_space">Expand Causal Diagram Iteratively</h1>
<p>After confirming or disproving relationships between observable<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="expanding iteratively" id="idm45968165986120"/> variables based on data, we have a tentatively complete CD (<a data-type="xref" href="#tentatively_complete_cd_with_observable">Figure 4-18</a>).</p>
<figure><div id="tentatively_complete_cd_with_observable" class="figure">
<img src="Images/BEDA_0418.png" alt="Tentatively complete CD with observable and unobservable variables, grouping personal characteristics variables under one heading for readability" width="1474" height="1259"/>
<h6><span class="label">Figure 4-18. </span>Tentatively complete CD with observable and unobservable variables, grouping personal characteristics variables under one heading for readability</h6>
</div></figure>
<p>From there, we’ll expand our CD iteratively by identifying proxies for unobserved variables and identifying further causes of the current variables.</p>
<section data-type="sect2" data-pdf-bookmark="Identify Proxies for Unobserved Variables"><div class="sect2" id="identify_proxies_for_unobserved_variabl">
<h2>Identify Proxies for Unobserved Variables</h2>
<p>Unobserved variables represent a challenge, <a contenteditable="false" data-type="indexterm" data-primary="variables" data-secondary="unobserved variables" data-tertiary="proxies in causal diagrams" id="idm45968165949272"/><a contenteditable="false" data-type="indexterm" data-primary="variables" data-secondary="causal diagrams" data-tertiary="proxies for unobserved variables" id="idm45968165947608"/><a contenteditable="false" data-type="indexterm" data-primary="unobserved variables" data-secondary="proxies in causal diagrams" id="idm45968165945944"/><a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="proxies for unobserved variables" id="idm45968165944552"/>because even if they are confirmed through interviews or UX research, they can’t be accounted for directly in the regression analysis.</p>
<p>We can still try to mitigate them somewhat by identifying potential proxies through interviews and research. For example, we may find that conscientiousness is indeed correlated with a lower rate of cancellation, but also with requesting a confirmation email (<a data-type="xref" href="#identifying_proxies_for_unobserved_vari">Figure 4-19</a>).</p>
<figure><div id="identifying_proxies_for_unobserved_vari" class="figure">
<img src="Images/BEDA_0419.png" alt="Identifying proxies for unobserved variables" width="1115" height="593"/>
<h6><span class="label">Figure 4-19. </span>Identifying proxies for unobserved variables</h6>
</div></figure>
<p>Of course, requesting a confirmation email is not caused only by conscientiousness—it may also reflect the seriousness of the intent, lack of ease with digital channels, etc. And conversely, it may reduce the cancellation rate by itself, by providing easily accessible information on the reservation. Regardless, if we find that this behavior is negatively correlated with cancellation rate, we may leverage that insight by, for example, sending an SMS reminder to customers who didn’t choose to receive a confirmation email.</p>
<p>By brainstorming and validating through research potential proxies for unobserved variables, we’re providing meaningful connections between observable variables. Knowing that <em>RequestedConfirmation</em> is connected with <em>IsCanceled</em> through <em>Conscientiousness</em> provides a behavioral rationale for what would otherwise be a raw statistical regularity.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Identify Further Causes"><div class="sect2" id="identify_further_causes">
<h2>Identify Further Causes</h2>
<p>We’ll also expand our CD by identifying causes of the “outer” variables<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="identifying further causes" id="idm45968165933832"/><a contenteditable="false" data-type="indexterm" data-primary="parent in causal diagrams" data-secondary="identifying further causes" id="idm45968165932216"/> in our CD, i.e., the variables that currently don’t have any parent in our CD. In particular, when we have a variable <em>A</em> that affects our cause of interest (possibly indirectly) but not our effect of interest, and another variable <em>B</em> that conversely affects our effect of interest but not our cause of interest, any joint cause of <em>A</em> and <em>B</em> introduces confounding in our CD, because that joint cause is also a joint cause of our two variables of interest.</p>
<p>In our example, the only observable variable without any parent (observable or not) is <em>Year</em>, and obviously it can’t have one (apart maybe from the laws of physics?), so this step doesn’t apply.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Iterate"><div class="sect2" id="iterate">
<h2>Iterate</h2>
<p>As you introduce new variables, you create new opportunities for<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="iterating" id="idm45968165925832"/> proxies and further causes. For example, our newly introduced <em>RequestedConfirmation</em> may be affected by <em>Conscientiousness</em> but also by <em>TripReason</em>. This means you should continue to expand your CD until it appears to account for all the relevant variables that you can think of and their interconnections.</p>
<p>There are however significant decreasing returns to this process: as you expand your CD “outward,” the newly added variables will tend to have smaller and smaller correlations with your variables of interest, because of all the noise along the way. This means that accounting for them will deconfound your relationship of interest in smaller and smaller quantities.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Simplify Causal Diagram"><div class="sect1" id="simplify_causal_diagram">
<h1>Simplify Causal Diagram</h1>
<p>The final step once you’ve decided to stop iteratively expanding the CD<a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" data-tertiary="simplifying" data-tertiary-sortas="9dzzz" id="idm45968165919672"/> is to simplify it. Indeed, you now have a diagram that is hopefully accurate and complete for practical purposes, but it might not be structured in the way that would be most helpful to meet the needs of the business. Therefore I would recommend the following simplification steps:</p>
<ul>
<li><p>Collapse chains when the intermediary variables are not of interest or are <span class="keep-together">unobserved.</span></p></li>
<li><p>Expand chains when you need to find observed variables or if you want to track the way another variable relates to the diagram.</p></li>
<li><p>Slice variables when you think the individual variables would contain interesting information (e.g., the correlation with one of your variables of interest is really driven by only one slice in particular).</p></li>
<li><p>Combine variables for clarity when reading the diagram or when variation between types does not matter.</p></li>
<li><p>Break cycles wherever you find them by introducing intermediary steps or identifying the aspect of the relationship that is important.</p></li>
</ul>
<p>In our example, we may decide that <em>IsRepeatedGuest</em>, <em>Children,</em> and <em>Year</em> do not add value beyond what is captured through <em>PreviousCancellation</em> and <em>ADR</em>. Indeed, we can dispense with these three variables because they can’t confound our relationship of interest (<a data-type="xref" href="#final_cd_after_simplification">Figure 4-20</a>).</p>
<figure><div id="final_cd_after_simplification" class="figure">
<img src="Images/BEDA_0420.png" alt="Final CD after simplification" width="1449" height="904"/>
<h6><span class="label">Figure 4-20. </span>Final CD after simplification</h6>
</div></figure>
<p>You should be left with a clean and (somewhat!) readable diagram, although it might be somewhat larger than those we have seen so far.</p>
<p>If this process seems long and somewhat tedious, <a contenteditable="false" data-type="indexterm" data-primary="causal diagrams (CDs)" data-secondary="building from scratch" id="idm45968165905848"/>that’s because it is. Understanding your business very well is the price to pay to be able to draw causal inferences on customer (or employee) behavior that are at least somewhat valid when you are not able to run experiments.</p>
<p>Fortunately, this process is extremely cumulative and transferable. Once you’ve done it for a certain analysis, your knowledge of the causal relationships that matter for your business can be reused for another analysis. Even if you don’t go very deep the first time you go through this process, you can just focus on one category of confounders and causes; the next time you run this analysis or a similar one, you can pick up where you left and do a deeper dive on another category, maybe interviewing customers about a different aspect of their experience. Similarly, once someone has gone through the process, a new team member or employee can very easily and quickly acquire the corresponding knowledge and pick up where they left off by looking at the resulting CD or even just the list of relevant variables to keep in mind.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ch04-bldCD" id="idm45968165902840"/></p>
</div></section>
<section data-type="sect1" class="pagebreak-before" data-pdf-bookmark="Conclusion"><div class="sect1" id="conclusion-id00009">
<h1 class="less_space">Conclusion</h1>
<p>To use the cliche phrase, building a CD is an art and a science. I have done my best to provide as clear a recipe as possible to do so:</p>
<ol>
<li><p>Start with the relationship that you’re trying to measure.</p></li>
<li><p>Identify candidate variables to include. Namely, use your behavioral science knowledge and business expertise to identify variables that are likely affecting either of your variables of interest.</p></li>
<li><p>Confirm which observable variables to include based on their correlations in the data.</p></li>
<li><p>Iteratively expand your CD by adding proxies for unobserved variables where possible and adding further causes of the variables included so far.</p></li>
<li><p>Finally, simplify your CD by removing irrelevant relationships and variables.</p></li>
</ol>
<p>As you do so, always keep in mind your ultimate goal: measuring the causal impact of your cause of interest on your effect of interest. We’ll see in the next chapter how to use a CD to remove confounding in your analysis and obtain an unbiased estimate for that impact. Thus, the best CD is the one that allows you to make the best use of the data you currently have available and that drives fruitful further research.</p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="ch01fn8"><sup><a href="ch04.xhtml#ch01fn8-marker">1</a></sup> Nuno Antonio, Ana de Almeida, and Luis Nunes, “Hotel booking demand data sets,” <em>Data in Brief</em>, 2019. <a href="https://doi.org/10.1016/j.dib.2018.11.126"><em class="hyperlink">https://doi.org/10.1016/j.dib.2018.11.126</em></a></p><p data-type="footnote" id="ch01fn9"><sup><a href="ch04.xhtml#ch01fn9-marker">2</a></sup> This colorful label was popularized by behavioral scientist Daniel Kahneman.</p><p data-type="footnote" id="idm45968166298152"><sup><a href="ch04.xhtml#idm45968166298152-marker">3</a></sup> Think about it: how would the rule be implemented otherwise?</p></div></div></section></div></body></html>