<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 3. Debugging and Profiling" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch1.03">
<h1><span class="label">Chapter 3. </span>Debugging and Profiling</h1>
<p><a data-primary="debugging" data-type="indexterm" id="ix_ch03-asciidoc0"/><a data-primary="IPython" data-secondary="error handling" data-type="indexterm" id="ix_ch03-asciidoc1"/>In addition to the enhanced interactive tools discussed in the previous
chapter, Jupyter provides a number of ways to explore and understand the
code you are running, such as by tracking down bugs in the logic or unexpected
slow execution. This chapter will discuss some of these tools.</p>
<section data-pdf-bookmark="Errors and Debugging" data-type="sect1"><div class="sect1" id="section-0106-errors-and-debugging">
<h1>Errors and Debugging</h1>
<p>Code development and data analysis always require a bit of trial and
error, and IPython contains tools to streamline this process. This
section will briefly cover some options for controlling
Python’s exception reporting, followed by exploring tools
for debugging errors in code.</p>
<section data-pdf-bookmark="Controlling Exceptions: %xmode" data-type="sect2"><div class="sect2" id="ch_0106-errors-and-debugging_controlling-exceptions-xmode">
<h2>Controlling Exceptions: %xmode</h2>
<p><a data-primary="%mode" data-primary-sortas="mode" data-type="indexterm" id="idm45858811692432"/><a data-primary="exceptions, controlling" data-type="indexterm" id="idm45858811691456"/><a data-primary="IPython" data-secondary="controlling exceptions" data-type="indexterm" id="idm45858811690784"/>Most of the time when a Python script fails, it will raise an exception.
When the interpreter hits one of these exceptions, information about the
cause of the error can be found in the <em>traceback</em>, which can be
accessed from within Python. With the <code>%xmode</code> magic function, IPython
allows you to control the amount of information printed when the
exception is raised. Consider the following code:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">):</code>
            <code class="k">return</code> <code class="n">a</code> <code class="o">/</code> <code class="n">b</code>

        <code class="k">def</code> <code class="nf">func2</code><code class="p">(</code><code class="n">x</code><code class="p">):</code>
            <code class="n">a</code> <code class="o">=</code> <code class="n">x</code>
            <code class="n">b</code> <code class="o">=</code> <code class="n">x</code> <code class="o">-</code> <code class="mi">1</code>
            <code class="k">return</code> <code class="n">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">)</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">func2</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>
<code class="ne">ZeroDivisionError</code>                         <code class="n">Traceback</code> <code class="p">(</code><code class="n">most</code> <code class="n">recent</code> <code class="n">call</code> <code class="n">last</code><code class="p">)</code>
<code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">2</code><code class="o">-</code><code class="n">b2e110f6fc8f</code><code class="o">&gt;</code> <code class="ow">in</code> <code class="o">&lt;</code><code class="n">module</code><code class="o">&gt;</code><code class="p">()</code>
<code class="o">----&gt;</code> <code class="mi">1</code> <code class="n">func2</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>

<code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">1</code><code class="o">-</code><code class="n">d849e34d61fb</code><code class="o">&gt;</code> <code class="ow">in</code> <code class="n">func2</code><code class="p">(</code><code class="n">x</code><code class="p">)</code>
      <code class="mi">5</code>     <code class="n">a</code> <code class="o">=</code> <code class="n">x</code>
      <code class="mi">6</code>     <code class="n">b</code> <code class="o">=</code> <code class="n">x</code> <code class="o">-</code> <code class="mi">1</code>
<code class="o">----&gt;</code> <code class="mi">7</code>     <code class="k">return</code> <code class="n">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">)</code>

<code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">1</code><code class="o">-</code><code class="n">d849e34d61fb</code><code class="o">&gt;</code> <code class="ow">in</code> <code class="n">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">)</code>
      <code class="mi">1</code> <code class="k">def</code> <code class="nf">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">):</code>
<code class="o">----&gt;</code> <code class="mi">2</code>     <code class="k">return</code> <code class="n">a</code> <code class="o">/</code> <code class="n">b</code>
      <code class="mi">3</code>
      <code class="mi">4</code> <code class="k">def</code> <code class="nf">func2</code><code class="p">(</code><code class="n">x</code><code class="p">):</code>
      <code class="mi">5</code>     <code class="n">a</code> <code class="o">=</code> <code class="n">x</code>

<code class="ne">ZeroDivisionError</code><code class="p">:</code> <code class="n">division</code> <code class="n">by</code> <code class="n">zero</code></pre>
<p>Calling <code>func2</code> results in an error, and reading the printed trace lets
us see exactly what happened. In the default mode, this trace includes
several lines showing the context of each step that led to the error.
Using the <code>%xmode</code> magic function (short for <em>exception mode</em>), we can
change what information is printed.</p>
<p><code>%xmode</code> takes a single argument, the mode, and there are three
possibilities: <code>Plain</code>, <code>Context</code>, and <code>Verbose</code>. The default is
<code>Context</code>, which gives output like that just shown. <code>Plain</code> is more
compact and gives less information:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="o">%</code><code class="k">xmode</code> Plain
<code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="ne">Exception</code> <code class="n">reporting</code> <code class="n">mode</code><code class="p">:</code> <code class="n">Plain</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">func2</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>
<code class="n">Traceback</code> <code class="p">(</code><code class="n">most</code> <code class="n">recent</code> <code class="n">call</code> <code class="n">last</code><code class="p">):</code>

  <code class="n">File</code> <code class="s2">"&lt;ipython-input-4-b2e110f6fc8f&gt;"</code><code class="p">,</code> <code class="n">line</code> <code class="mi">1</code><code class="p">,</code> <code class="ow">in</code> <code class="o">&lt;</code><code class="n">module</code><code class="o">&gt;</code>
    <code class="n">func2</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>

  <code class="n">File</code> <code class="s2">"&lt;ipython-input-1-d849e34d61fb&gt;"</code><code class="p">,</code> <code class="n">line</code> <code class="mi">7</code><code class="p">,</code> <code class="ow">in</code> <code class="n">func2</code>
    <code class="k">return</code> <code class="n">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">)</code>

  <code class="n">File</code> <code class="s2">"&lt;ipython-input-1-d849e34d61fb&gt;"</code><code class="p">,</code> <code class="n">line</code> <code class="mi">2</code><code class="p">,</code> <code class="ow">in</code> <code class="n">func1</code>
    <code class="k">return</code> <code class="n">a</code> <code class="o">/</code> <code class="n">b</code>

<code class="ne">ZeroDivisionError</code><code class="p">:</code> <code class="n">division</code> <code class="n">by</code> <code class="n">zero</code></pre>
<p>The <code>Verbose</code> mode adds some extra information, including the arguments
to any functions that are called:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="o">%</code><code class="k">xmode</code> Verbose
<code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="ne">Exception</code> <code class="n">reporting</code> <code class="n">mode</code><code class="p">:</code> <code class="n">Verbose</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">func2</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>
<code class="ne">ZeroDivisionError</code>                         <code class="n">Traceback</code> <code class="p">(</code><code class="n">most</code> <code class="n">recent</code> <code class="n">call</code> <code class="n">last</code><code class="p">)</code>
<code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">6</code><code class="o">-</code><code class="n">b2e110f6fc8f</code><code class="o">&gt;</code> <code class="ow">in</code> <code class="o">&lt;</code><code class="n">module</code><code class="o">&gt;</code><code class="p">()</code>
<code class="o">----&gt;</code> <code class="mi">1</code> <code class="n">func2</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>
        <code class="k">global</code> <code class="n">func2</code> <code class="o">=</code> <code class="o">&lt;</code><code class="n">function</code> <code class="n">func2</code> <code class="n">at</code> <code class="mh">0x103729320</code><code class="o">&gt;</code>

<code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">1</code><code class="o">-</code><code class="n">d849e34d61fb</code><code class="o">&gt;</code> <code class="ow">in</code> <code class="n">func2</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code>
      <code class="mi">5</code>     <code class="n">a</code> <code class="o">=</code> <code class="n">x</code>
      <code class="mi">6</code>     <code class="n">b</code> <code class="o">=</code> <code class="n">x</code> <code class="o">-</code> <code class="mi">1</code>
<code class="o">----&gt;</code> <code class="mi">7</code>     <code class="k">return</code> <code class="n">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">)</code>
        <code class="k">global</code> <code class="n">func1</code> <code class="o">=</code> <code class="o">&lt;</code><code class="n">function</code> <code class="n">func1</code> <code class="n">at</code> <code class="mh">0x1037294d0</code><code class="o">&gt;</code>
        <code class="n">a</code> <code class="o">=</code> <code class="mi">1</code>
        <code class="n">b</code> <code class="o">=</code> <code class="mi">0</code>

<code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">1</code><code class="o">-</code><code class="n">d849e34d61fb</code><code class="o">&gt;</code> <code class="ow">in</code> <code class="n">func1</code><code class="p">(</code><code class="n">a</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code> <code class="n">b</code><code class="o">=</code><code class="mi">0</code><code class="p">)</code>
      <code class="mi">1</code> <code class="k">def</code> <code class="nf">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">):</code>
<code class="o">----&gt;</code> <code class="mi">2</code>     <code class="k">return</code> <code class="n">a</code> <code class="o">/</code> <code class="n">b</code>
        <code class="n">a</code> <code class="o">=</code> <code class="mi">1</code>
        <code class="n">b</code> <code class="o">=</code> <code class="mi">0</code>
      <code class="mi">3</code>
      <code class="mi">4</code> <code class="k">def</code> <code class="nf">func2</code><code class="p">(</code><code class="n">x</code><code class="p">):</code>
      <code class="mi">5</code>     <code class="n">a</code> <code class="o">=</code> <code class="n">x</code>

<code class="ne">ZeroDivisionError</code><code class="p">:</code> <code class="n">division</code> <code class="n">by</code> <code class="n">zero</code></pre>
<p>This extra information can help you narrow in on why the exception is
being raised. So why not use the <code>Verbose</code> mode all the time? As code
gets complicated, this kind of traceback can get extremely long.
Depending on the context, sometimes the brevity of <code>Plain</code> or <code>Context</code>
mode is easier to work with.</p>
</div></section>
<section data-pdf-bookmark="Debugging: When Reading Tracebacks Is Not Enough" data-type="sect2"><div class="sect2" id="ch_0106-errors-and-debugging_debugging-when-reading-tracebacks-is-not-enough">
<h2>Debugging: When Reading Tracebacks Is Not Enough</h2>
<p><a data-primary="IPython" data-secondary="debugging" data-type="indexterm" id="ix_ch03-asciidoc2"/><a data-primary="Jupyter notebook" data-secondary="debugging" data-type="indexterm" id="ix_ch03-asciidoc3"/>The <a data-primary="pdb (Python debugger)" data-type="indexterm" id="idm45858818769456"/>standard Python tool for interactive debugging is <code>pdb</code>, the Python
debugger. This debugger lets the user step through the code line by line
in order to see what might be causing a more difficult error. The
IPython-enhanced version of this is <code>ipdb</code>, the 
<span class="keep-together">IPython</span> debugger.</p>
<p>There are many ways to launch and use both these debuggers; we
won’t cover them fully here. Refer to the online
documentation of these two utilities to learn more.</p>
<p><a data-primary="%debug" data-primary-sortas="debug" data-type="indexterm" id="idm45858818766496"/>In IPython, perhaps the most convenient interface to debugging is the
<code>%debug</code> magic command. If you call it after hitting an exception, it
will automatically open an interactive debugging prompt at the point of
the exception. The <code>ipdb</code> prompt lets you explore the current state of
the stack, explore the available variables, and even run Python
commands!</p>
<p>Let’s look at the most recent exception, then do some basic
tasks. We’ll print the values of <code>a</code> and <code>b</code>, then type
<code>quit</code> to quit the debugging session:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="o">%</code><code class="k">debug</code> &lt;ipython-input-1-d849e34d61fb&gt;(2)func1()
      <code class="mi">1</code> <code class="k">def</code> <code class="nf">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">):</code>
<code class="o">----&gt;</code> <code class="mi">2</code>     <code class="k">return</code> <code class="n">a</code> <code class="o">/</code> <code class="n">b</code>
      <code class="mi">3</code>

<code class="n">ipdb</code><code class="o">&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">a</code><code class="p">)</code>
<code class="mi">1</code>
<code class="n">ipdb</code><code class="o">&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">b</code><code class="p">)</code>
<code class="mi">0</code>
<code class="n">ipdb</code><code class="o">&gt;</code> <code class="n">quit</code></pre>
<p>The interactive debugger allows much more than this, though—we can even
step up and down through the stack and explore the values of variables
there:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="o">%</code><code class="k">debug</code> &lt;ipython-input-1-d849e34d61fb&gt;(2)func1()
      <code class="mi">1</code> <code class="k">def</code> <code class="nf">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">):</code>
<code class="o">----&gt;</code> <code class="mi">2</code>     <code class="k">return</code> <code class="n">a</code> <code class="o">/</code> <code class="n">b</code>
      <code class="mi">3</code>

<code class="n">ipdb</code><code class="o">&gt;</code> <code class="n">up</code> <code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">1</code><code class="o">-</code><code class="n">d849e34d61fb</code><code class="o">&gt;</code><code class="p">(</code><code class="mi">7</code><code class="p">)</code><code class="n">func2</code><code class="p">()</code>
      <code class="mi">5</code>     <code class="n">a</code> <code class="o">=</code> <code class="n">x</code>
      <code class="mi">6</code>     <code class="n">b</code> <code class="o">=</code> <code class="n">x</code> <code class="o">-</code> <code class="mi">1</code>
<code class="o">----&gt;</code> <code class="mi">7</code>     <code class="k">return</code> <code class="n">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">)</code>

<code class="n">ipdb</code><code class="o">&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">x</code><code class="p">)</code>
<code class="mi">1</code>
<code class="n">ipdb</code><code class="o">&gt;</code> <code class="n">up</code> <code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">6</code><code class="o">-</code><code class="n">b2e110f6fc8f</code><code class="o">&gt;</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="o">&lt;</code><code class="n">module</code><code class="o">&gt;</code><code class="p">()</code>
<code class="o">----&gt;</code> <code class="mi">1</code> <code class="n">func2</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>

<code class="n">ipdb</code><code class="o">&gt;</code> <code class="n">down</code> <code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">1</code><code class="o">-</code><code class="n">d849e34d61fb</code><code class="o">&gt;</code><code class="p">(</code><code class="mi">7</code><code class="p">)</code><code class="n">func2</code><code class="p">()</code>
      <code class="mi">5</code>     <code class="n">a</code> <code class="o">=</code> <code class="n">x</code>
      <code class="mi">6</code>     <code class="n">b</code> <code class="o">=</code> <code class="n">x</code> <code class="o">-</code> <code class="mi">1</code>
<code class="o">----&gt;</code> <code class="mi">7</code>     <code class="k">return</code> <code class="n">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">)</code>

<code class="n">ipdb</code><code class="o">&gt;</code> <code class="n">quit</code></pre>
<p>This allows us to quickly find out not only what caused the error, but
what function calls led up to the error.</p>
<p>If you’d like the debugger to launch automatically whenever
an exception is raised, you can use the <code>%pdb</code> magic function to turn on
this automatic behavior:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="o">%</code><code class="k">xmode</code> Plain
        <code class="o">%</code><code class="k">pdb</code> on
        <code class="n">func2</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>
<code class="ne">Exception</code> <code class="n">reporting</code> <code class="n">mode</code><code class="p">:</code> <code class="n">Plain</code>
<code class="n">Automatic</code> <code class="n">pdb</code> <code class="n">calling</code> <code class="n">has</code> <code class="n">been</code> <code class="n">turned</code> <code class="n">ON</code>
<code class="ne">ZeroDivisionError</code><code class="p">:</code> <code class="n">division</code> <code class="n">by</code> <code class="n">zero</code> <code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">1</code><code class="o">-</code><code class="n">d849e34d61fb</code><code class="o">&gt;</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code><code class="n">func1</code><code class="p">()</code>
      <code class="mi">1</code> <code class="k">def</code> <code class="nf">func1</code><code class="p">(</code><code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">):</code>
<code class="o">----&gt;</code> <code class="mi">2</code>     <code class="k">return</code> <code class="n">a</code> <code class="o">/</code> <code class="n">b</code>
      <code class="mi">3</code>

<code class="n">ipdb</code><code class="o">&gt;</code> <code class="nb">print</code><code class="p">(</code><code class="n">b</code><code class="p">)</code>
<code class="mi">0</code>
<code class="n">ipdb</code><code class="o">&gt;</code> <code class="n">quit</code></pre>
<p>Finally, if you have a script that you’d like to run from
the beginning in interactive mode, you can run it with the command
<code>%run -d</code>, and use the <code>next</code> command to step through the lines of code
interactively.</p>
<p>There are many more available commands for interactive debugging than
I’ve shown here. <a data-type="xref" href="#table-3-1">Table 3-1</a> contains a description
of some of the more common and useful ones.</p>
<table id="table-3-1">
<caption><span class="label">Table 3-1. </span>Partial list of debugging commands</caption>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>l(ist)</code></p></td>
<td><p>Show the current location in the file</p></td>
</tr>
<tr>
<td><p><code>h(elp)</code></p></td>
<td><p>Show a list of commands, or find help on a specific command</p></td>
</tr>
<tr>
<td><p><code>q(uit)</code></p></td>
<td><p>Quit the debugger and the program</p></td>
</tr>
<tr>
<td><p><code>c(ontinue)</code></p></td>
<td><p>Quit the debugger, continue in the program</p></td>
</tr>
<tr>
<td><p><code>n(ext)</code></p></td>
<td><p>Go to the next step of the program</p></td>
</tr>
<tr>
<td><p><code>&lt;enter&gt;</code></p></td>
<td><p>Repeat the previous command</p></td>
</tr>
<tr>
<td><p><code>p(rint)</code></p></td>
<td><p>Print variables</p></td>
</tr>
<tr>
<td><p><code>s(tep)</code></p></td>
<td><p>Step into a subroutine</p></td>
</tr>
<tr>
<td><p><code>r(eturn)</code></p></td>
<td><p>Return out of a subroutine</p></td>
</tr>
</tbody>
</table>
<p>For more information, use the <code>help</code> command in the debugger, or take a
look at <code>ipdb</code>’s <a href="https://oreil.ly/TVSAT">online
documentation</a><a data-startref="ix_ch03-asciidoc3" data-type="indexterm" id="idm45858818356112"/><a data-startref="ix_ch03-asciidoc2" data-type="indexterm" id="idm45858818355408"/>.<a data-startref="ix_ch03-asciidoc1" data-type="indexterm" id="idm45858818354608"/><a data-startref="ix_ch03-asciidoc0" data-type="indexterm" id="idm45858818353904"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Profiling and Timing Code" data-type="sect1"><div class="sect1" id="section-0107-timing-and-profiling">
<h1>Profiling and Timing Code</h1>
<p><a data-primary="code" data-secondary="profiling and timing" data-type="indexterm" id="ix_ch03-asciidoc4"/><a data-primary="development, IPython" data-secondary="profiling and timing code" data-type="indexterm" id="ix_ch03-asciidoc5"/><a data-primary="IPython" data-secondary="profiling and timing code" data-type="indexterm" id="ix_ch03-asciidoc6"/>In <a data-primary="timing, of code" data-type="indexterm" id="ix_ch03-asciidoc7"/>the process of developing code and creating data processing
pipelines, there are often trade-offs you can make between various
implementations. Early in developing your algorithm, it can be
counterproductive to worry about such things. <a data-primary="Knuth, Donald" data-type="indexterm" id="idm45858818346592"/>As Donald Knuth famously
quipped, “We should forget about small efficiencies, say about 97% of
the time: premature optimization is the root of all evil.”</p>
<p>But once you have your code working, it can be useful to dig into its
efficiency a bit. Sometimes it’s useful to check the
execution time of a given command or set of commands; other times
it’s useful to examine a multiline process and determine
where the bottleneck lies in some complicated series of operations.
IPython provides access to a wide array of functionality for this kind
of timing and profiling of code. Here we’ll discuss the
following IPython magic commands:</p>
<dl>
<dt><code>%time</code></dt>
<dd>
<p>Time the execution of a single statement</p>
</dd>
<dt><code>%timeit</code></dt>
<dd>
<p>Time repeated execution of a single statement for more
accuracy</p>
</dd>
<dt><code>%prun</code></dt>
<dd>
<p>Run code with the profiler</p>
</dd>
<dt><code>%lprun</code></dt>
<dd>
<p>Run code with the line-by-line profiler</p>
</dd>
<dt><code>%memit</code></dt>
<dd>
<p>Measure the memory use of a single statement</p>
</dd>
<dt><code>%mprun</code></dt>
<dd>
<p>Run code with the line-by-line memory profiler</p>
</dd>
</dl>
<p>The last four commands are not bundled with IPython; to use them,
you’ll need to get the <code>line_profiler</code> and <code>memory_profiler</code>
extensions, which we will discuss in the following sections.</p>
<section data-pdf-bookmark="Timing Code Snippets: %timeit and %time" data-type="sect2"><div class="sect2" id="ch_0107-timing-and-profiling_timing-code-snippets-timeit-and-time">
<h2>Timing Code Snippets: %timeit and %time</h2>
<p><a data-primary="%time" data-primary-sortas="time" data-type="indexterm" id="idm45858818332544"/><a data-primary="%timeit" data-primary-sortas="timeit" data-type="indexterm" id="idm45858818331568"/><a data-primary="code" data-secondary="timing of snippets" data-type="indexterm" id="idm45858818330624"/><a data-primary="development, IPython" data-secondary="timing of code snippets" data-type="indexterm" id="idm45858818329680"/>We saw the <code>%timeit</code> line magic and <code>%%timeit</code> cell magic in the
introduction to magic functions in
<a data-type="xref" href="ch02.xhtml#section-0103-magic-commands">“IPython Magic Commands”</a>; these can be
used to time the repeated execution of snippets of code:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="o">%</code><code class="k">timeit</code> sum(range(100))
<code class="mf">1.53</code> <code class="n">µs</code> <code class="err">±</code> <code class="mf">47.8</code> <code class="n">ns</code> <code class="n">per</code> <code class="n">loop</code> <code class="p">(</code><code class="n">mean</code> <code class="err">±</code> <code class="n">std</code><code class="o">.</code> <code class="n">dev</code><code class="o">.</code> <code class="n">of</code> <code class="mi">7</code> <code class="n">runs</code><code class="p">,</code> <code class="mi">1000000</code> <code class="n">loops</code> <code class="n">each</code><code class="p">)</code></pre>
<p>Note that because this operation is so fast, <code>%timeit</code> automatically
does a large number of repetitions. For slower commands, <code>%timeit</code> will
automatically adjust and perform fewer repetitions:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="o">%%time</code>it
        <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code>
        <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1000</code><code class="p">):</code>
            <code class="k">for</code> <code class="n">j</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1000</code><code class="p">):</code>
                <code class="n">total</code> <code class="o">+=</code> <code class="n">i</code> <code class="o">*</code> <code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">)</code> <code class="o">**</code> <code class="n">j</code>
<code class="mi">536</code> <code class="n">ms</code> <code class="err">±</code> <code class="mf">15.9</code> <code class="n">ms</code> <code class="n">per</code> <code class="n">loop</code> <code class="p">(</code><code class="n">mean</code> <code class="err">±</code> <code class="n">std</code><code class="o">.</code> <code class="n">dev</code><code class="o">.</code> <code class="n">of</code> <code class="mi">7</code> <code class="n">runs</code><code class="p">,</code> <code class="mi">1</code> <code class="n">loop</code> <code class="n">each</code><code class="p">)</code></pre>
<p>Sometimes repeating an operation is not the best option. For example, if
we have a list that we’d like to sort, we might be misled by
a repeated operation; sorting a pre-sorted list is much faster than
sorting an unsorted list, so the repetition will skew the result:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">random</code>
        <code class="n">L</code> <code class="o">=</code> <code class="p">[</code><code class="n">random</code><code class="o">.</code><code class="n">random</code><code class="p">()</code> <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">100000</code><code class="p">)]</code>
        <code class="o">%</code><code class="k">timeit</code> L.sort()
<code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="mf">1.71</code> <code class="n">ms</code> <code class="err">±</code> <code class="mi">334</code> <code class="n">µs</code> <code class="n">per</code> <code class="n">loop</code> <code class="p">(</code><code class="n">mean</code> <code class="err">±</code> <code class="n">std</code><code class="o">.</code> <code class="n">dev</code><code class="o">.</code> <code class="n">of</code> <code class="mi">7</code> <code class="n">runs</code><code class="p">,</code> <code class="mi">1000</code> <code class="n">loops</code> <code class="n">each</code><code class="p">)</code></pre>
<p class="pagebreak-before less_space">For this, the <code>%time</code> magic function may be a better choice. It also is
a good choice for longer-running commands, when short, system-related
delays are unlikely to affect the result. Let’s time the
sorting of an unsorted and a presorted list:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">random</code>
        <code class="n">L</code> <code class="o">=</code> <code class="p">[</code><code class="n">random</code><code class="o">.</code><code class="n">random</code><code class="p">()</code> <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">100000</code><code class="p">)]</code>
        <code class="nb">print</code><code class="p">(</code><code class="s2">"sorting an unsorted list:"</code><code class="p">)</code>
        <code class="o">%</code><code class="k">time</code> L.sort()
<code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">sorting</code> <code class="n">an</code> <code class="n">unsorted</code> <code class="nb">list</code><code class="p">:</code>
        <code class="n">CPU</code> <code class="n">times</code><code class="p">:</code> <code class="n">user</code> <code class="mf">31.3</code> <code class="n">ms</code><code class="p">,</code> <code class="n">sys</code><code class="p">:</code> <code class="mi">686</code> <code class="n">µs</code><code class="p">,</code> <code class="n">total</code><code class="p">:</code> <code class="mi">32</code> <code class="n">ms</code>
        <code class="n">Wall</code> <code class="n">time</code><code class="p">:</code> <code class="mf">33.3</code> <code class="n">ms</code></pre>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="nb">print</code><code class="p">(</code><code class="s2">"sorting an already sorted list:"</code><code class="p">)</code>
        <code class="o">%</code><code class="k">time</code> L.sort()
<code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">sorting</code> <code class="n">an</code> <code class="n">already</code> <code class="nb">sorted</code> <code class="nb">list</code><code class="p">:</code>
        <code class="n">CPU</code> <code class="n">times</code><code class="p">:</code> <code class="n">user</code> <code class="mf">5.19</code> <code class="n">ms</code><code class="p">,</code> <code class="n">sys</code><code class="p">:</code> <code class="mi">268</code> <code class="n">µs</code><code class="p">,</code> <code class="n">total</code><code class="p">:</code> <code class="mf">5.46</code> <code class="n">ms</code>
        <code class="n">Wall</code> <code class="n">time</code><code class="p">:</code> <code class="mf">14.1</code> <code class="n">ms</code></pre>
<p>Notice how much faster the presorted list is to sort, but notice also
how much longer the timing takes with <code>%time</code> versus <code>%timeit</code>, even for
the presorted list! This is a result of the fact that <code>%timeit</code> does
some clever things under the hood to prevent system calls from
interfering with the timing. For example, it prevents cleanup of unused
Python objects (known as <em>garbage collection</em>) that might otherwise
affect the timing. For this reason, <code>%timeit</code> results are usually
noticeably faster than <code>%time</code> results.</p>
<p>For <code>%time</code>, as with <code>%timeit</code>, using the <code>%%</code> cell magic syntax allows
timing of multiline scripts:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="o">%%time</code>
        <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code>
        <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1000</code><code class="p">):</code>
            <code class="k">for</code> <code class="n">j</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1000</code><code class="p">):</code>
                <code class="n">total</code> <code class="o">+=</code> <code class="n">i</code> <code class="o">*</code> <code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">)</code> <code class="o">**</code> <code class="n">j</code>
<code class="n">CPU</code> <code class="n">times</code><code class="p">:</code> <code class="n">user</code> <code class="mi">655</code> <code class="n">ms</code><code class="p">,</code> <code class="n">sys</code><code class="p">:</code> <code class="mf">5.68</code> <code class="n">ms</code><code class="p">,</code> <code class="n">total</code><code class="p">:</code> <code class="mi">661</code> <code class="n">ms</code>
<code class="n">Wall</code> <code class="n">time</code><code class="p">:</code> <code class="mi">710</code> <code class="n">ms</code></pre>
<p>For more information on <code>%time</code> and <code>%timeit</code>, as well as their
available options, use the IPython help functionality (e.g., type
<code>%time?</code> at the IPython prompt).<a data-startref="ix_ch03-asciidoc7" data-type="indexterm" id="idm45858811480864"/></p>
</div></section>
<section data-pdf-bookmark="Profiling Full Scripts: %prun" data-type="sect2"><div class="sect2" id="ch_0107-timing-and-profiling_profiling-full-scripts-prun">
<h2>Profiling Full Scripts: %prun</h2>
<p><a data-primary="%prun" data-primary-sortas="prun" data-type="indexterm" id="idm45858811478576"/><a data-primary="development, IPython" data-secondary="profiling full scripts" data-type="indexterm" id="idm45858811477600"/><a data-primary="profiling" data-secondary="full scripts" data-type="indexterm" id="idm45858811476480"/><a data-primary="script" data-secondary="profiling" data-type="indexterm" id="idm45858811475632"/>A program is made up of many single statements, and sometimes timing
these statements in context is more important than timing them on their
own. Python contains a built-in code profiler (which you can read about
in the Python documentation), but IPython offers a much more convenient
way to use this profiler, in the form of the magic function <code>%prun</code>.</p>
<p>By way of example, we’ll define a simple function that does
some calculations:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">sum_of_lists</code><code class="p">(</code><code class="n">N</code><code class="p">):</code>
            <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code>
            <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">5</code><code class="p">):</code>
                <code class="n">L</code> <code class="o">=</code> <code class="p">[</code><code class="n">j</code> <code class="o">^</code> <code class="p">(</code><code class="n">j</code> <code class="o">&gt;&gt;</code> <code class="n">i</code><code class="p">)</code> <code class="k">for</code> <code class="n">j</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="n">N</code><code class="p">)]</code>
                <code class="n">total</code> <code class="o">+=</code> <code class="nb">sum</code><code class="p">(</code><code class="n">L</code><code class="p">)</code>
            <code class="k">return</code> <code class="n">total</code></pre>
<p>Now we can call <code>%prun</code> with a function call to see the profiled
results:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="o">%</code><code class="k">prun</code> sum_of_lists(1000000)
<code class="mi">14</code> <code class="n">function</code> <code class="n">calls</code> <code class="ow">in</code> <code class="mf">0.932</code> <code class="n">seconds</code>
<code class="n">Ordered</code> <code class="n">by</code><code class="p">:</code> <code class="n">internal</code> <code class="n">time</code>
<code class="n">ncalls</code>  <code class="n">tottime</code>  <code class="n">percall</code>  <code class="n">cumtime</code>  <code class="n">percall</code> <code class="n">filename</code><code class="p">:</code><code class="n">lineno</code><code class="p">(</code><code class="n">function</code><code class="p">)</code>
     <code class="mi">5</code>    <code class="mf">0.808</code>    <code class="mf">0.162</code>    <code class="mf">0.808</code>  <code class="mf">0.162</code> <code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">7</code><code class="o">-</code><code class="n">f105717832a2</code><code class="o">&gt;</code><code class="p">:</code><code class="mi">4</code><code class="p">(</code><code class="o">&lt;</code><code class="n">listcomp</code><code class="o">&gt;</code><code class="p">)</code>
     <code class="mi">5</code>    <code class="mf">0.066</code>    <code class="mf">0.013</code>    <code class="mf">0.066</code>  <code class="mf">0.013</code> <code class="p">{</code><code class="n">built</code><code class="o">-</code><code class="ow">in</code> <code class="n">method</code> <code class="n">builtins</code><code class="o">.</code><code class="n">sum</code><code class="p">}</code>
     <code class="mi">1</code>    <code class="mf">0.044</code>    <code class="mf">0.044</code>    <code class="mf">0.918</code>  <code class="mf">0.918</code> <code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">7</code><code class="o">-</code><code class="n">f105717832a2</code><code class="o">&gt;</code><code class="p">:</code><code class="mi">1</code>
     <code class="o">&gt;</code> <code class="p">(</code><code class="n">sum_of_lists</code><code class="p">)</code>
     <code class="mi">1</code>    <code class="mf">0.014</code>    <code class="mf">0.014</code>    <code class="mf">0.932</code>  <code class="mf">0.932</code> <code class="o">&lt;</code><code class="n">string</code><code class="o">&gt;</code><code class="p">:</code><code class="mi">1</code><code class="p">(</code><code class="o">&lt;</code><code class="n">module</code><code class="o">&gt;</code><code class="p">)</code>
     <code class="mi">1</code>    <code class="mf">0.000</code>    <code class="mf">0.000</code>    <code class="mf">0.932</code>  <code class="mf">0.932</code> <code class="p">{</code><code class="n">built</code><code class="o">-</code><code class="ow">in</code> <code class="n">method</code> <code class="n">builtins</code><code class="o">.</code><code class="n">exec</code><code class="p">}</code>
     <code class="mi">1</code>    <code class="mf">0.000</code>    <code class="mf">0.000</code>    <code class="mf">0.000</code>  <code class="mf">0.000</code> <code class="p">{</code><code class="n">method</code> <code class="s1">'disable'</code> <code class="n">of</code> <code class="s1">'_lsprof.Profiler'</code>
     <code class="o">&gt;</code> <code class="n">objects</code><code class="p">}</code></pre>
<p>The result is a table that indicates, in order of total time on each
function call, where the execution is spending the most time. In this
case, the bulk of the execution time is in the list comprehension inside
<code>sum_of_lists</code>. From here, we could start thinking about what changes we
might make to improve the performance of the algorithm.</p>
<p>For more information on <code>%prun</code>, as well as its available options, use
the IPython help functionality (i.e., type <code>%prun?</code> at the IPython
prompt).</p>
</div></section>
<section data-pdf-bookmark="Line-by-Line Profiling with %lprun" data-type="sect2"><div class="sect2" id="ch_0107-timing-and-profiling_line-by-line-profiling-with-lprun">
<h2>Line-by-Line Profiling with %lprun</h2>
<p><a data-primary="%lprun" data-primary-sortas="lprun" data-type="indexterm" id="idm45858811310864"/><a data-primary="line-by-line profiling" data-type="indexterm" id="idm45858811309664"/><a data-primary="profiling" data-secondary="line-by-line" data-type="indexterm" id="idm45858811308992"/>The function-by-function profiling of <code>%prun</code> is useful, but sometimes
it’s more convenient to have a line-by-line profile report.
This is not built into Python or IPython, but there is a <code>line_profiler</code>
package available for installation that can do this. Start by using
Python’s packaging tool, <code>pip</code>, to install the
<code>line_profiler</code> package:</p>
<pre data-type="programlisting">
$ <strong>pip install line_profiler</strong>
</pre>
<p>Next, you can use IPython to load the <code>line_profiler</code> IPython extension,
offered as part of this package:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="o">%</code><code class="k">load_ext</code> line_profiler</pre>
<p>Now the <code>%lprun</code> command will do a line-by-line profiling of any
function. In this case, we need to tell it explicitly which functions
we’re interested in profiling:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">10</code><code class="p">]:</code> <code class="o">%</code><code class="k">lprun</code> -f sum_of_lists sum_of_lists(5000)
<code class="n">Timer</code> <code class="n">unit</code><code class="p">:</code> <code class="mf">1e-06</code> <code class="n">s</code>

<code class="n">Total</code> <code class="n">time</code><code class="p">:</code> <code class="mf">0.014803</code> <code class="n">s</code>
<code class="n">File</code><code class="p">:</code> <code class="o">&lt;</code><code class="n">ipython</code><code class="o">-</code><code class="nb">input</code><code class="o">-</code><code class="mi">7</code><code class="o">-</code><code class="n">f105717832a2</code><code class="o">&gt;</code>
<code class="n">Function</code><code class="p">:</code> <code class="n">sum_of_lists</code> <code class="n">at</code> <code class="n">line</code> <code class="mi">1</code>


<code class="n">Line</code> <code class="c1">#      Hits         Time  Per Hit   % Time  Line Contents</code>
<code class="o">==============================================================</code>
      <code class="mi">1</code>                                           <code class="k">def</code> <code class="nf">sum_of_lists</code><code class="p">(</code><code class="n">N</code><code class="p">):</code>
      <code class="mi">2</code>         <code class="mi">1</code>          <code class="mf">6.0</code>      <code class="mf">6.0</code>      <code class="mf">0.0</code>      <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code>
      <code class="mi">3</code>         <code class="mi">6</code>         <code class="mf">13.0</code>      <code class="mf">2.2</code>      <code class="mf">0.1</code>      <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">5</code><code class="p">):</code>
      <code class="mi">4</code>         <code class="mi">5</code>      <code class="mf">14242.0</code>   <code class="mf">2848.4</code>     <code class="mf">96.2</code>          <code class="n">L</code> <code class="o">=</code> <code class="p">[</code><code class="n">j</code> <code class="o">^</code> <code class="p">(</code><code class="n">j</code> <code class="o">&gt;&gt;</code> <code class="n">i</code><code class="p">)</code> <code class="k">for</code> <code class="n">j</code>
      <code class="mi">5</code>         <code class="mi">5</code>        <code class="mf">541.0</code>    <code class="mf">108.2</code>      <code class="mf">3.7</code>          <code class="n">total</code> <code class="o">+=</code> <code class="nb">sum</code><code class="p">(</code><code class="n">L</code><code class="p">)</code>
      <code class="mi">6</code>         <code class="mi">1</code>          <code class="mf">1.0</code>      <code class="mf">1.0</code>      <code class="mf">0.0</code>      <code class="k">return</code> <code class="n">total</code></pre>
<p>The information at the top gives us the key to reading the results: the
time is reported in microseconds, and we can see where the program is
spending the most time. At this point, we may be able to use this
information to modify aspects of the script and make it perform better
for our desired use case.</p>
<p>For more information on <code>%lprun</code>, as well as its available options, use
the IPython help functionality (i.e., type <code>%lprun?</code> at the IPython
prompt).</p>
</div></section>
<section data-pdf-bookmark="Profiling Memory Use: %memit and %mprun" data-type="sect2"><div class="sect2" id="ch_0107-timing-and-profiling_profiling-memory-use-memit-and-mprun">
<h2>Profiling Memory Use: %memit and %mprun</h2>
<p><a data-primary="%memit" data-primary-sortas="memit" data-type="indexterm" id="idm45858811015376"/><a data-primary="%mprun" data-primary-sortas="mprun" data-type="indexterm" id="idm45858811014304"/><a data-primary="memory use, profiling" data-type="indexterm" id="idm45858811013424"/><a data-primary="profiling" data-secondary="memory use" data-type="indexterm" id="idm45858811012752"/>Another aspect of profiling is the amount of memory an operation uses.
This can be evaluated with another IPython extension, the
<code>memory_profiler</code>. As with the <code>line_profiler</code>, we start by
<code>pip</code>-installing the extension:</p>
<pre data-type="programlisting">
$ <strong>pip install memory_profiler</strong>
</pre>
<p>Then we can use IPython to load it:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="o">%</code><code class="k">load_ext</code> memory_profiler</pre>
<p>The memory profiler extension contains two useful magic functions:
<code>%memit</code> (which offers a memory-measuring equivalent of <code>%timeit</code>) and
<code>%mprun</code> (which offers a memory-measuring equivalent of <code>%lprun</code>). The
<code>%memit</code> magic function can be used rather simply:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="o">%</code><code class="k">memit</code> sum_of_lists(1000000)
<code class="n">peak</code> <code class="n">memory</code><code class="p">:</code> <code class="mf">141.70</code> <code class="n">MiB</code><code class="p">,</code> <code class="n">increment</code><code class="p">:</code> <code class="mf">75.65</code> <code class="n">MiB</code></pre>
<p>We see that this function uses about 140 MB of memory.</p>
<p>For a line-by-line description of memory use, we can use the <code>%mprun</code>
magic function. Unfortunately, this works only for functions defined in
separate modules rather than the notebook itself, so we’ll
start by using the <code>%%file</code> cell magic to create a simple module called
<code>mprun_demo.py</code>, which contains our <code>sum_of_lists</code> function, with one
addition that will make our memory profiling results more clear:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="o">%%file</code> mprun_demo.py
         <code class="k">def</code> <code class="nf">sum_of_lists</code><code class="p">(</code><code class="n">N</code><code class="p">):</code>
             <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code>
             <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">5</code><code class="p">):</code>
                 <code class="n">L</code> <code class="o">=</code> <code class="p">[</code><code class="n">j</code> <code class="o">^</code> <code class="p">(</code><code class="n">j</code> <code class="o">&gt;&gt;</code> <code class="n">i</code><code class="p">)</code> <code class="k">for</code> <code class="n">j</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="n">N</code><code class="p">)]</code>
                 <code class="n">total</code> <code class="o">+=</code> <code class="nb">sum</code><code class="p">(</code><code class="n">L</code><code class="p">)</code>
                 <code class="k">del</code> <code class="n">L</code> <code class="c1"># remove reference to L</code>
             <code class="k">return</code> <code class="n">total</code>
<code class="n">Overwriting</code> <code class="n">mprun_demo</code><code class="o">.</code><code class="n">py</code></pre>
<p>We can now import the new version of this function and run the memory
line 
<span class="keep-together">profiler</span>:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="kn">from</code> <code class="nn">mprun_demo</code> <code class="kn">import</code> <code class="n">sum_of_lists</code>
         <code class="o">%</code><code class="k">mprun</code> -f sum_of_lists sum_of_lists(1000000)

<code class="n">Filename</code><code class="p">:</code> <code class="o">/</code><code class="n">Users</code><code class="o">/</code><code class="n">jakevdp</code><code class="o">/</code><code class="n">github</code><code class="o">/</code><code class="n">jakevdp</code><code class="o">/</code><code class="n">PythonDataScienceHandbook</code><code class="o">/</code><code class="n">notebooks_v2</code><code class="o">/</code>
<code class="o">&gt;</code> <code class="n">m</code> <code class="n">prun_demo</code><code class="o">.</code><code class="n">py</code>

<code class="n">Line</code> <code class="c1">#    Mem usage    Increment  Occurrences   Line Contents</code>
<code class="o">============================================================</code>
     <code class="mi">1</code>     <code class="mf">66.7</code> <code class="n">MiB</code>     <code class="mf">66.7</code> <code class="n">MiB</code>           <code class="mi">1</code>   <code class="k">def</code> <code class="nf">sum_of_lists</code><code class="p">(</code><code class="n">N</code><code class="p">):</code>
     <code class="mi">2</code>     <code class="mf">66.7</code> <code class="n">MiB</code>      <code class="mf">0.0</code> <code class="n">MiB</code>           <code class="mi">1</code>       <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code>
     <code class="mi">3</code>     <code class="mf">75.1</code> <code class="n">MiB</code>      <code class="mf">8.4</code> <code class="n">MiB</code>           <code class="mi">6</code>       <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">5</code><code class="p">):</code>
     <code class="mi">4</code>    <code class="mf">105.9</code> <code class="n">MiB</code>     <code class="mf">30.8</code> <code class="n">MiB</code>     <code class="mi">5000015</code>           <code class="n">L</code> <code class="o">=</code> <code class="p">[</code><code class="n">j</code> <code class="o">^</code> <code class="p">(</code><code class="n">j</code> <code class="o">&gt;&gt;</code> <code class="n">i</code><code class="p">)</code> <code class="k">for</code> <code class="n">j</code>
     <code class="mi">5</code>    <code class="mf">109.8</code> <code class="n">MiB</code>      <code class="mf">3.8</code> <code class="n">MiB</code>           <code class="mi">5</code>           <code class="n">total</code> <code class="o">+=</code> <code class="nb">sum</code><code class="p">(</code><code class="n">L</code><code class="p">)</code>
     <code class="mi">6</code>     <code class="mf">75.1</code> <code class="n">MiB</code>    <code class="o">-</code><code class="mf">34.6</code> <code class="n">MiB</code>           <code class="mi">5</code>           <code class="k">del</code> <code class="n">L</code> <code class="c1"># remove reference to L</code>
     <code class="mi">7</code>     <code class="mf">66.9</code> <code class="n">MiB</code>     <code class="o">-</code><code class="mf">8.2</code> <code class="n">MiB</code>           <code class="mi">1</code>       <code class="k">return</code> <code class="n">total</code></pre>
<p>Here, the <code>Increment</code> column tells us how much each line affects the
total memory budget: observe that when we create and delete the list
<code>L</code>, we are adding about 30 MB of memory usage. This is on top of the
background memory usage from the Python interpreter itself.</p>
<p>For more information on <code>%memit</code> and <code>%mprun</code>, as well as their
available options, use the IPython help functionality (e.g., type
<code>%memit?</code> at the IPython prompt).<a data-startref="ix_ch03-asciidoc6" data-type="indexterm" id="idm45858810665872"/><a data-startref="ix_ch03-asciidoc5" data-type="indexterm" id="idm45858810665168"/><a data-startref="ix_ch03-asciidoc4" data-type="indexterm" id="idm45858810664496"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="More IPython Resources" data-type="sect1"><div class="sect1" id="section-0108-more-ipython-resources">
<h1>More IPython Resources</h1>
<p><a data-primary="IPython" data-secondary="learning resources" data-type="indexterm" id="idm45858810662480"/>In this set of chapters, we’ve just scratched the surface of
using IPython to enable data science tasks. Much more information is
available both in print and on the web, and here I’ll list
some other resources that you may find helpful.</p>
<section data-pdf-bookmark="Web Resources" data-type="sect2"><div class="sect2" id="ch_0108-more-ipython-resources_web-resources">
<h2>Web Resources</h2>
<dl>
<dt><a href="http://ipython.org">The IPython website</a></dt>
<dd>
<p><a data-primary="IPython" data-secondary="web resources" data-type="indexterm" id="idm45858810658128"/>The IPython website provides
links to documentation, examples, tutorials, and a variety of other
resources.</p>
</dd>
<dt><a href="http://nbviewer.jupyter.org">The nbviewer website</a></dt>
<dd>
<p>This site shows
static renderings of any Jupyter notebook available on the internet. The
front page features some example notebooks that you can browse to see
what other folks are using IPython for!</p>
</dd>
<dt><a href="https://github.com/jupyter/jupyter/wiki">A curated collection of Jupyter notebooks</a></dt>
<dd>
<p>This ever-growing list of notebooks, powered by
nbviewer, shows the depth and breadth of numerical analysis you can do
with IPython. It includes everything from short examples and tutorials
to full-blown courses and books composed in the notebook format!</p>
</dd>
<dt>Video tutorials</dt>
<dd>
<p>Searching the internet, you will find many video
tutorials on IPython. I’d especially recommend seeking
tutorials from the PyCon, SciPy, and PyData conferences by Fernando
Perez and Brian Granger, two of the primary creators and maintainers of
IPython and Jupyter.</p>
</dd>
</dl>
</div></section>
<section data-pdf-bookmark="Books" data-type="sect2"><div class="sect2" id="ch_0108-more-ipython-resources_books">
<h2>Books</h2>
<dl>
<dt><a href="https://oreil.ly/ik2g7"><em>Python for Data Analysis</em> (O’Reilly)</a></dt>
<dd>
<p>Wes McKinney’s book
includes a chapter that covers using IPython as a data scientist.
Although much of the material overlaps what we’ve discussed
here, another perspective is always helpful.</p>
</dd>
<dt><em>Learning IPython for Interactive Computing and Data Visualization</em> (Packt)</dt>
<dd>
<p>This
short book by Cyrille Rossant offers a good introduction to using
IPython for data analysis.</p>
</dd>
<dt><em>IPython Interactive Computing and Visualization Cookbook</em> (Packt)</dt>
<dd>
<p>Also by
Cyrille Rossant, this book is a longer and more advanced treatment of
using IPython for data science. Despite its name, it’s not
just about IPython; it also goes into some depth on a broad range of
data science topics.</p>
</dd>
</dl>
<p>Finally, a reminder that you can find help on your own:
IPython’s <code>?</code>-based help functionality (discussed in
<a data-type="xref" href="ch01.xhtml#section-0101-help-and-documentation">Chapter 1</a>) can be useful if you use it well and use it often. As you go
through the examples here and elsewhere, this can be used to familiarize
yourself with all the tools that IPython has to offer.</p>
</div></section>
</div></section>
</div></section></div></body></html>