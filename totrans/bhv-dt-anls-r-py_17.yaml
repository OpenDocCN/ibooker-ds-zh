- en: Chapter 12\. Mediation and Instrumental Variables
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the last chapter, we saw that moderation allows us to open the black box
    of a causal relationship by revealing groups for which that relationship is stronger
    or weaker. *Mediation* refers to the presence of an intermediary variable between
    two variables in a chain; it offers a different way to probe that black box by
    understanding the causal mechanism at play—the “how” of the causal effect.
  prefs: []
  type: TYPE_NORMAL
- en: This has several benefits on both the causal and behavioral sides of our framework.
    From a causal perspective, mediation reduces the risk of false positives, and
    not accounting adequately for it can bias our analyses. From a behavioral perspective,
    mediation helps us better design and understand experiments. In a sense, mediation
    is nothing new, and most of the arguments in this chapter could have been summarized
    as “expand the chains in your CDs as much as you can, at least at the beginning.”
    But I believe such a simplification would have been a disservice to you, because
    the search for mediators is at the root of many scientific discoveries. “But why?”
    is one of the best follow-up questions after confirming the causal relationship
    between two variables. Customer satisfaction increases retention, *but why*? Is
    it because it reduces the probability of looking for alternatives or because it
    increases the customer’s opinion of the company?
  prefs: []
  type: TYPE_NORMAL
- en: Mediation also offers a nice stepping stone for the last tool we’ll see in this
    book, instrumental variables (IVs). IVs, which are like mediation on steroids,
    allow us to answer questions that would otherwise be intractable. As promised
    at the beginning of the book, we’ll obtain an unbiased estimate of the effect
    of customer satisfaction on later purchasing behavior, and IVs make that possible.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the next section, I’ll introduce you to mediation in the context of the
    C-Mart store play areas example from [Chapter 11](ch11.xhtml#introduction_to_moderation)
    and show you how mediation can make a causal-behavioral analysis more effective.
    Then in the second section, we’ll get to the grand finale: instrumental variables.'
  prefs: []
  type: TYPE_NORMAL
- en: Mediation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let’s continue with the C-Mart example from the previous chapter and assume
    that C-Mart is now interested in measuring the effect of the play areas on grocery
    purchases ([Figure 12-1](#our_relationship_of_interest)).
  prefs: []
  type: TYPE_NORMAL
- en: '![Our relationship of interest](Images/BEDA_1201.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 12-1\. Our relationship of interest
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Based on prior analyses, the management of C-Mart believes that visit duration
    is a key causal mechanism in this relationship. That is, they believe that *PlayArea*
    causes *VisitDuration*, which itself causes *GroceryPurchases*. Obviously, we
    could disregard that hypothesis and analyze the relationship displayed in [Figure 12-1](#our_relationship_of_interest)
    directly by building the corresponding regression, CIs, etc. However, we’re going
    to confirm and measure that causal mechanism, because taking it into account has
    several benefits:'
  prefs: []
  type: TYPE_NORMAL
- en: Mediation allows us to understand the mechanisms at play and generate actionable
    insights.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In certain circumstances, not accounting for mediation could bias a causal estimate.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Let’s review these benefits in more detail in the next two subsections, and
    then I’ll get into the technical considerations of measuring mediation.
  prefs: []
  type: TYPE_NORMAL
- en: Understanding Causal Mechanisms
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The first benefit of identifying and measuring mediation is that it provides
    an explanation of the causal mechanism at hand. Correlation is still not (always)
    causation, but understanding what’s actually happening from a behavioral perspective
    is a strong safeguard against spurious correlations. If you have two variables
    that are correlated but you’re unsure whether that correlation is causal, finding
    and validating a mediator between them offers very strong evidence that the relationship
    is causal. At that point, the most likely source of error would be reverse causality—the
    causality flows in the opposite direction. (The alternative is that each of the
    three variables just happens to have a spurious correlation with the other two;
    that’s three spurious correlations from random chance instead of one, which is
    a highly improbable event.)
  prefs: []
  type: TYPE_NORMAL
- en: Mediation is also a very effective complement to moderation, in both the discovery
    and the design phases. In the discovery phase (what I referred to as the “fishing
    expedition” in the previous chapter), identifying likely mediators can help the
    brainstorming process. Even if a mediator is not observable (e.g., a belief or
    emotion), simply considering it might lead you to a measurable moderator and provide
    a rationale for it. We saw in [Chapter 11](ch11.xhtml#introduction_to_moderation)
    that the relationship between *PlayArea* and *GroceryPurchases* is moderated by
    *Children*, something that makes immediate and intuitive sense. However, recognizing
    that this relationship is mediated by *VisitDuration* can give us clues to other
    possible moderators. For example, if the mediation is complete, the overall effect
    is likely to be weaker for visits near the closing time, something that would
    not be immediately apparent if we disregarded the role of *VisitDuration* ([Figure 12-2](#the_relationship_between_playarea_and_g)).
  prefs: []
  type: TYPE_NORMAL
- en: '![The relationship between PlayArea and GroceryPurchases](Images/BEDA_1202.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 12-2\. The relationship between PlayArea and GroceryPurchases
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: We could probe that hypothesis by checking whether the effect of *PlayArea*
    on *GroceryPurchases* is weaker for visits that start near the closing time, which
    would provide further information about the nature of the effect.
  prefs: []
  type: TYPE_NORMAL
- en: Mediation can also be helpful for designing or improving business processes
    and messages. Too often, segmentation exercises end up with “segment A shows a
    stronger effect than segment B.” This is only useful in better targeting preexisting
    treatments, such as marketing campaigns. Understanding the mechanism through which
    the moderation acts provides us with useful insights for ideation. Having confirmed
    that the moderating effect of *Children* on *PlayArea* is mediated by *VisitDuration*,
    we could lean into it by offering a perk, like extra parking validation or a snack
    station near the play area. We could also replace the play areas with (potentially
    cheaper) mini-cinemas showing cartoons.
  prefs: []
  type: TYPE_NORMAL
- en: Causal Biases
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Mediation is not just a “nice to have” tool. In some circumstances, not accounting
    for it can introduce biases in our causal estimates.
  prefs: []
  type: TYPE_NORMAL
- en: The simplest case where this occurs is when we’re trying to measure the (total)
    effect of one variable on another, but we unwittingly include a mediator in our
    regression as a control variable. Let’s assume that we’ve measured the effect
    of having a play area on grocery purchases at the individual level, in line with
    the recommendations from [Chapter 2](ch02.xhtml#understanding_behavioral_data).
    It is conceivable that a play area not only affects the visit duration of customers
    who would have come regardless but also draws new customers. To account for this
    causal path, we need to recast our CD at the store level ([Figure 12-3](#cd_recast_at_the_store_level)).
  prefs: []
  type: TYPE_NORMAL
- en: '![CD recast at the store level](Images/BEDA_1203.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 12-3\. CD recast at the store level
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Note that while average grocery purchases at the customer level are fully mediated
    by average visit duration, this is not the case for total grocery sales at the
    store level. The level at which you measure behaviors matters!
  prefs: []
  type: TYPE_NORMAL
- en: 'In [Figure 12-3](#cd_recast_at_the_store_level), it is clear that *CustomersNumber*
    is a mediator of the effect of *PlayArea* on *GrocerySales*. However, we can easily
    imagine that someone investigating that effect would decide to include *CustomersNumber*
    as a control variable in that regression: *GrocerySales* = *β[p].PlayArea* + *β[c].CustomersNumber*.
    After all, the size of a store’s customer base certainly affects its total grocery
    sales, and it may have impacted the selection of stores where play areas would
    be built ([Figure 12-4](#the_storeapostrophes_customer_base_is_a)).'
  prefs: []
  type: TYPE_NORMAL
- en: '![The store’s customer base is a confounder](Images/BEDA_1204.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 12-4\. The store’s customer base is a confounder
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: '[Figure 12-4](#the_storeapostrophes_customer_base_is_a) presents a causal conundrum:
    the store’s customer base, measured by the number of potential customers who are
    within shopping distance of the store, may be a confounder of the relationship
    between *PlayArea* and *GrocerySales*. But at the same time, *CustomersNumber*
    is a mediator of that relationship. This situation calls for thoughtful controlling
    of the relevant regressions—that is, all the regressions where the dependent variable
    is *CustomersNumber* or *GrocerySales*.'
  prefs: []
  type: TYPE_NORMAL
- en: This can be achieved by adding to these regressions thoughtful control variables.
    For instance, the number of customers one year before installing the play area
    is a good proxy for the customer base and by definition doesn’t capture any of
    the effects of installing a play area. Alternatively, we could choose another
    proxy such as a *Rural/Urban* categorical variable.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once again, this illustrates the dangers of the “everything and the kitchen
    sink” approach to variable inclusion: just because the current number of customers
    is available and relevant to our situation doesn’t mean that it should automatically
    be included as a control.'
  prefs: []
  type: TYPE_NORMAL
- en: Identifying Mediation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When I introduced the building blocks of CDs in [Chapter 3](ch03.xhtml#introduction_to_causal_diagrams),
    I mentioned that a *mediator* is a variable between two other variables in a chain,
    as in [Figure 12-5](#the_effect_of_having_a_play_area_on_gro).
  prefs: []
  type: TYPE_NORMAL
- en: '![The effect of having a play area on grocery purchases is mediated by the
    duration of the visit](Images/BEDA_1205.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 12-5\. The effect of having a play area on grocery purchases is mediated
    by the duration of the visit
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: '*VisitDuration* is an effect of *PlayArea*, and a cause of *GroceryPurchases*.
    As such, it is the mediator of the effect of *PlayArea* on *GroceryPurchases*
    in this CD.'
  prefs: []
  type: TYPE_NORMAL
- en: Assuming that the CD in [Figure 12-5](#the_effect_of_having_a_play_area_on_gro)
    gives us the whole story, *PlayArea* has no effect on *GroceryPurchases* apart
    from the path through *VisitDuration*; changing *PlayArea* while holding *VisitDuration*
    constant would not change *GroceryPurchases*. The effect of *PlayArea* on *GroceryPurchases*
    is said to be “completely” or “fully” mediated. Alternatively, we could imagine
    a situation where *PlayArea* also has a direct effect on *GroceryPurchases*, apart
    from the *VisitDuration* path ([Figure 12-6](#partial_mediation)).
  prefs: []
  type: TYPE_NORMAL
- en: '![Partial mediation](Images/BEDA_1206.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 12-6\. Partial mediation
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: This is called “partial” mediation. *VisitDuration* is still a mediator, even
    if it doesn’t account for the total effect of *PlayArea* on *GroceryPurchases*.
    The direct effect from *PlayArea* to *GroceryPurchases* may be truly direct—there
    is no intermediary variable involved—or it may represent one or several other
    mediators we don’t know of or are not interested in analyzing (in which case we
    have collapsed the corresponding chain or chains).
  prefs: []
  type: TYPE_NORMAL
- en: Like the search for potential moderators, the search for mediators is a trial-and-error
    fishing expedition, but the scope of the search (and therefore the risk of false
    positives) is much more limited. Since a potential mediator should be investigated
    only if there is a strong behavioral rationale for it, the number of candidates
    is considerably restricted. In addition, confirming a mediator involves several
    regressions, which also reduces the risk of false positives.
  prefs: []
  type: TYPE_NORMAL
- en: Given the benefits of accounting for mediators and the risks of not doing so,
    you should always include relevant mediators in your analysis, at least as a first
    step. Once you have identified which chains you’re going to analyze and which
    you’re going to disregard, you can safely collapse the latter ones (e.g., mediators
    between variables that play only a secondary role in your analysis).
  prefs: []
  type: TYPE_NORMAL
- en: As with moderators, the search process entails finding a potential candidate
    and then validating it through a Bootstrap confidence interval. In our example,
    *VisitDuration* is an obvious candidate, so let’s see how we can confirm and measure
    its mediation role.
  prefs: []
  type: TYPE_NORMAL
- en: Measuring Mediation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Measuring mediation is straightforward but a bit cumbersome. It boils down
    to running several regressions to estimate the following:'
  prefs: []
  type: TYPE_NORMAL
- en: The total effect of *PlayArea* on *GroceryPurchases*
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The effect of *PlayArea* on *GroceryPurchases* that is mediated by *VisitDuration*,
    a.k.a. the indirect effect
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The effect of *PlayArea* on *GroceryPurchases* that is not mediated by *VisitDuration*,
    a.k.a. the direct effect
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If we find no evidence for the indirect, mediated path, we should reject our
    tentative mediator. Conversely, if we find no evidence for the direct path, then
    the effect is fully mediated. The *percentage of total effect mediated* is a common
    and useful way to summarize that evidence. We’ll wrap up the section by considering
    the special case in which the mediator is a binary variable.
  prefs: []
  type: TYPE_NORMAL
- en: Total effect
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'We first determine the total effect by running a regression of *GroceryPurchases*
    on *PlayArea* (without including *VisitDuration*):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The total effect is approximately 27.6, meaning that adding a play area increases
    the amount spent on groceries by $27.6 on average, *not holding the visit duration
    constant*.
  prefs: []
  type: TYPE_NORMAL
- en: Mediated effect
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The effect of *PlayArea* on *GroceryPurchases* mediated by *VisitDuration*
    can be obtained by multiplying together the effect of *PlayArea* on *VisitDuration*
    and the effect of *VisitDuration* on *GroceryPurchases*. This makes intuitive
    sense: if a play area increases the average duration of a visit by X minutes and
    each additional minute of visit duration increases the amount spent on groceries
    by $Y, then adding a play area increases the amount spent on groceries by $X *
    Y.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The first regression is for the arrow between *PlayArea* and *VisitDuration*.
    It yields a coefficient of about 12.6 (having a play area adds about 12.6 minutes
    to the average visit duration):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'The second regression is for the arrow between *VisitDuration* and *GroceryPurchases*.
    However, I will also include *PlayArea* in this regression. Looking back at [Figure 12-6](#partial_mediation)
    and remembering the definition of a confounder, we can see that if the mediation
    is only partial (i.e., there is a direct arrow from *PlayArea* to *GroceryPurchases*),
    *PlayArea* is a confounder of the relationship between *VisitDuration* and *GroceryPurchases*.
    Therefore it must be included in the regression by default. Running a regression
    with our primary cause and our mediator as explanatory variables yields coefficients
    of, respectively, 0.16 (adding a play area adds about $0.16 to the average grocery
    purchase per visit, holding the visit duration constant) and 2.2 (adding one minute
    to visit duration adds about $2.20 to the average grocery purchases per visit):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: In this very simple example, these three are the only variables involved, but
    in real life you would have to also include any other variable with an arrow towards
    the dependent variable in each of your regressions.
  prefs: []
  type: TYPE_NORMAL
- en: I mentioned earlier that the primary cause should be included in the regression
    “by default.” Sometimes, however, the primary cause and the mediator may be so
    closely correlated that including both of them in a regression creates multicollinearity.
    This is generally caused by full mediation and is evidenced by suspiciously large
    coefficients in opposite directions (that is, the primary cause and the mediator
    mostly cancel each other out) with large p-values. In the worst cases, your analysis
    software may even give up and return an error message without finishing the regression.
    Whenever including the primary cause in the regression makes the coefficient for
    the mediator go haywire, do not include the primary cause.
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally, you may also encounter more complex situations, such as two mediators
    with an extra arrow between them, that is, one of the mediators is also a cause
    of the other ([Figure 12-7](#one_of_the_mediators_affects_the_other)). This is
    not just a theoretical possibility; it actually happens from time to time, especially
    with behavioral data. Situations like that one defy shortcuts and you’ll need
    to remember what we learned in [Part II](part02.xhtml#causal_diagrams_and_deconfounding):
    the backdoor criterion for deconfounding and other rules of CDs still apply and
    will let you know which variables you should and should not include in your regression.'
  prefs: []
  type: TYPE_NORMAL
- en: '![One of the mediators affects the other mediator](Images/BEDA_1207.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 12-7\. One of the mediators affects the other mediator
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'The mediated effect is equal to the product of the two coefficients along the
    mediation chain (i.e., the coefficient of the regression of *VisitDuration* on
    *PlayArea*, and the coefficient of the regression of *GroceryPurchases* on *VisitDuration*):'
  prefs: []
  type: TYPE_NORMAL
- en: '*MediatedEffect* ≈ 12.6 * 2.2 ≈ 27.5'
  prefs: []
  type: TYPE_NORMAL
- en: 'From there, we can calculate the percentage of the total effect that is mediated:'
  prefs: []
  type: TYPE_NORMAL
- en: '*PercentageMediated = MediatedEffect / TotalEffect ≈ 27.5 / 27.6 ≈ 99.5%*'
  prefs: []
  type: TYPE_NORMAL
- en: The Bootstrap 90%-CI for this percentage is approximately [0.9933; 0.9975].
  prefs: []
  type: TYPE_NORMAL
- en: Direct effect
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The direct, unmediated effect is equal to the coefficient for *PlayArea* in
    the regression of *GroceryPurchases* on *PlayArea* and *VisitDuration*: *UnmediatedEffect*
    ≈ 0.16\. From there, we can calculate the percentage of the total effect that
    is unmediated:'
  prefs: []
  type: TYPE_NORMAL
- en: '*PercentageUnmediated* = *UnmediatedEffect / TotalEffect* ≈ 0.16 / 27.6 ≈ 0.5%'
  prefs: []
  type: TYPE_NORMAL
- en: In other words, the total effect is technically not fully mediated. For practical
    purposes, however, we can neglect the unmediated effect. Note that “unmediated
    effect” is always expressed in relation to a specific mediator. If you had two
    mediators that together completely mediated a total effect, the mediated effect
    of the first one would be equal to the unmediated effect of the second one and
    vice versa.
  prefs: []
  type: TYPE_NORMAL
- en: 'In situations where you encounter multicollinearity and are unable to include
    the primary cause in the regression as described earlier, the effect is most likely
    fully mediated. You can and should check that this is the case by calculating
    the percentage of the total effect that is unmediated as the residual of the mediated
    effect:'
  prefs: []
  type: TYPE_NORMAL
- en: '*PercentageUnmediated* = (*TotalEffect - MediatedEffect*) / *TotalEffect*'
  prefs: []
  type: TYPE_NORMAL
- en: If you obtain an unmediated effect that is economically significant through
    that approach, this means you most likely have a more complex causal structure
    on your hands than you thought. Then it’s time to revisit your CD with a critical
    eye. Maybe your primary cause and your mediator share a further joint cause? Or
    could there be several mediators with interrelations between them?
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The mediator in this example was positively correlated with both its cause and
    its effect. Mediators can also have a negative effect if exactly one of the two
    coefficients along the chain is negative. If that happens, and there is another
    mediator or a direct effect between our cause and effect of interest, then the
    mediator will *reduce* the total effect. In that case, your first mediator could
    represent, say, −25% of the total effect while the direct effect (or another mediator)
    would represent 125% of the total effect, but the sum of the proportions of effects
    will still be 100%. This is perfectly normal and expected, so don’t let it trip
    you up.
  prefs: []
  type: TYPE_NORMAL
- en: If you find that confusing, you’re in good company. Social scientists debated
    for decades whether or not having a significant total effect should be a prerequisite
    to mediation analysis. But there are a variety of perfectly legitimate regulating
    or self-regulating phenomena where a mediator compensates for the direct effect.
    For example, C-Mart may find that its price changes do not affect its sales volume
    as expected because they cause corresponding price changes from its competitors.
  prefs: []
  type: TYPE_NORMAL
- en: When the mediator is a binary variable
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The mediator in this example was a numeric variable, so we could easily obtain
    the mediated effect by multiplying the coefficients for the two arrows involved.
    When the mediator is a binary variable, it is still possible to quantify mediation
    analytically, i.e., by using equations, but the formulas get more convoluted.
  prefs: []
  type: TYPE_NORMAL
- en: 'If we call the cause of interest *X*, the mediator *M*, and the effect of interest
    *Y*, the regression equations for the mediator and the final effect become:'
  prefs: []
  type: TYPE_NORMAL
- en: '*P(M* = 1) = logistic(*α[0]* + *α[X].X*)'
  prefs: []
  type: TYPE_NORMAL
- en: '*Y* = *β*[0] + *β[X].X* + *β[M].M*'
  prefs: []
  type: TYPE_NORMAL
- en: 'Note that the first equation is now a logistic regression, as appropriate for
    a binary variable. Instead of predicting the value of M as with a linear regression,
    we now predict the probability that it will take the value 1, P(M = 1). We can
    substitute that probability in the second equation:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Y* = *β*[0] + *β[X].X* + *β[M].P*(*M* = *1*)'
  prefs: []
  type: TYPE_NORMAL
- en: 'The direct effect is still straightforward to calculate: if X increases by
    1, the direct effect increases Y by *β[X]*. But the indirect effect now presents
    an additional challenge because the impact of X on M is not linear. Therefore,
    the impact of X on M has to be determined *for a certain value of X*. This issue
    is similar to the one we encountered with moderation in [Chapter 11](ch11.xhtml#introduction_to_moderation),
    and the possible solutions are the same:'
  prefs: []
  type: TYPE_NORMAL
- en: Define a global reference point, such as the average value of X in our data.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Or calculate the mediated effect and percentage mediated for each row in our
    data and then calculate their respective averages.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: As was the case in [Chapter 11](ch11.xhtml#introduction_to_moderation), I recommend
    the second approach, modified as needed to fit the business decision at hand.
  prefs: []
  type: TYPE_NORMAL
- en: Instrumental Variables
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Mediation represents a great addition to the behavioral data analysis toolbox
    in itself, but it’s also a stepping stone to another powerful tool called instrumental
    variables (IVs). In a nutshell, IVs leverage a known mediation relationship to
    reduce confounding biases in our coefficients.
  prefs: []
  type: TYPE_NORMAL
- en: One of the most powerful use cases is to use an experiment to answer a broader,
    and often harder, question. I’ll illustrate this application with an example involving
    customer satisfaction, one of the most watched business metrics, but also admittedly
    one of the hardest to measure.
  prefs: []
  type: TYPE_NORMAL
- en: 'As first mentioned in [Chapter 2](ch02.xhtml#understanding_behavioral_data),
    AirCnC’s leadership wants to know the impact of customer satisfaction (*CSAT*)
    on one of their key performance indicators, the amount spent during the six months
    following a booking (*M6Spend*). We’ll reuse the data from the experiment in [Chapter 10](ch10.xhtml#cluster_randomization_and_hierarchical)
    in which we explored the impact on customer satisfaction of a change in call center
    procedures: namely, “Instead of apologizing repeatedly when something went wrong,
    the call center reps should apologize at the beginning of the interaction, then
    get into ‘problem-solving mode,’ then end up offering several options to the customer.”'
  prefs: []
  type: TYPE_NORMAL
- en: Data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The [GitHub folder for this chapter](https://oreil.ly/BehavioralDataAnalysisCh12)
    contains a copy of the experimental data from [Chapter 10](ch10.xhtml#cluster_randomization_and_hierarchical).
    This time we’ll include the M6Spend variable in our analysis. [Table 12-1](#variables_in_our_data-id00085)
    outlines the variables in our data for this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: Table 12-1\. Variables in our data
  prefs: []
  type: TYPE_NORMAL
- en: '|   | Variable description | chap10-experimental_data.csv |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| *Center_ID* | Categorical variable for the 10 call centers | ✓ |'
  prefs: []
  type: TYPE_TB
- en: '| *Rep_ID* | Categorical variable for the 193 call center reps | ✓ |'
  prefs: []
  type: TYPE_TB
- en: '| *Age* | Age of customer calling, 20-60 | ✓ |'
  prefs: []
  type: TYPE_TB
- en: '| *Reason* | Reason for call, “payment”/’property” | ✓ |'
  prefs: []
  type: TYPE_TB
- en: '| *Call_CSAT* | Customer satisfaction with call, 0-10 | ✓ |'
  prefs: []
  type: TYPE_TB
- en: '| *Group* | Experimental assignment, “ctrl”/”treat” | ✓ |'
  prefs: []
  type: TYPE_TB
- en: '| *M6Spend* | Amount spent on bookings within 6 months of a booking | ✓ |'
  prefs: []
  type: TYPE_TB
- en: Packages
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In this section, we’ll use the following specific packages for instrumental
    variables:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: Understanding and Applying IVs
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Once you’re familiar with CDs and mediation, the idea behind IVs becomes reasonably
    simple to express:'
  prefs: []
  type: TYPE_NORMAL
- en: Let’s assume you have a fully mediated relationship between two variables, and
    the relationship between the mediator and the final variable is confounded. Then
    you can obtain an unbiased estimate for that relationship by dividing the coefficient
    for the total effect by the coefficient for the first arm of the mediation (i.e.,
    the relationship between the first variable and the mediator).
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: To see what this looks like in our example, let’s start by drawing the CD of
    our variables of interest. We want to measure the causal relationship between
    *CSAT* and *M6Spend*. It’s plausible that a high CSAT increases the amount spent
    on bookings in the following months, but the relationship is also subject to unmeasured
    confounders, including personality traits such as openness. Finally, we have data
    on our experimental treatment, which we know affects *CSAT* thanks to our experiment
    in [Chapter 10](ch10.xhtml#cluster_randomization_and_hierarchical) ([Figure 12-8](#the_cd_for_our_variables_of_interest)).
  prefs: []
  type: TYPE_NORMAL
- en: '![The CD for our variables of interest](Images/BEDA_1208.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 12-8\. The CD for our variables of interest
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: As you can see, in this CD, *CSAT* is a mediator between *Group* and *M6Spend*,
    but the relationship between *CSAT* and *M6Spend* is biased upward by the confounding
    effect of *Openness*.
  prefs: []
  type: TYPE_NORMAL
- en: In an ideal world, we would have data about the *Openness* variable and we would
    be able to run the two true regressions ([Equation 12-1](#12eqtn1) and [Equation
    12-2](#12eqtn2)).
  prefs: []
  type: TYPE_NORMAL
- en: Equation 12-1\.
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: '*CSAT* = *β[g]*[1].*Group* + *β*[o1].*Openness*'
  prefs: []
  type: TYPE_NORMAL
- en: Equation 12-2\.
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: '*M6Spend* = *β[c]*[2].*CSAT* + *β[o]*[2].*Openness*'
  prefs: []
  type: TYPE_NORMAL
- en: But even if we got data about Openness specifically (e.g., through a survey),
    how could we be sure that there isn’t another confounder lurking around the corner?
  prefs: []
  type: TYPE_NORMAL
- en: 'Taking a step back from the math for a second, this question takes us to the
    very heart of behavioral analytics: customer satisfaction is an essential criterion
    for success in business, but because it is so strongly influenced by a myriad
    of unobserved individual characteristics that impact individual behaviors, we
    can’t hope to identify and control for all of these characteristics. This issue
    can’t be resolved satisfactorily outside of a causal-behavioral framework, but
    it is straightforward to handle within it.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Back to the math—let’s go through the intuition laid out earlier:'
  prefs: []
  type: TYPE_NORMAL
- en: Calculate the coefficient for the leftmost relationship, between *Group* and
    *CSAT*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Calculate the coefficient for the total effect of *Group* on *M6Spend.*
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Calculate the coefficient for the effect of *CSAT* on *M6Spend* by dividing
    the total effect from step 2 by the coefficient for the leftmost relationship
    from step 1.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Step 1: Leftmost relationship'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Because *Group* is a random assignment, uncorrelated with *Openness*, we can
    run the following regression instead of [Equation 12-1](#12eqtn1):'
  prefs: []
  type: TYPE_NORMAL
- en: '*CSAT* = *β[g]*[1].*Group*'
  prefs: []
  type: TYPE_NORMAL
- en: Our estimate for *β[g]*[1] is unbiased and can be plugged as needed in [Equation
    12-1](#12eqtn1), because it is the true causal coefficient.
  prefs: []
  type: TYPE_NORMAL
- en: 'Step 2: Total effect'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The equation for the total effect ([Equation 12-3](#eqtnR)) is called the *reduced*
    regression (and we’ll index it by “r”) because it collapses the chain between
    the variables.
  prefs: []
  type: TYPE_NORMAL
- en: Equation 12-3\. Equation R
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: '*M6Spend* = *β[gr].Group* (Eq. R)'
  prefs: []
  type: TYPE_NORMAL
- en: For the same reasons as for the first arm of the mediation, our estimate for
    *β[gr]* is unbiased.
  prefs: []
  type: TYPE_NORMAL
- en: 'Step 3: Relationship of interest'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This is where the magic happens: as discussed in the previous section about
    mediation, *β[gr]* = *β[c]*[2] * *β[g]*[1]. We can rewrite this equation as *β[c]*[2]
    = *β[gr]* / *β[g]*[1]. Because all variables right of the equal sign are unbiased,
    the one left of it is as well. This estimate for *β[c]*[2] is unbiased.'
  prefs: []
  type: TYPE_NORMAL
- en: 'In other words, we can deconfound the relationship between two variables if
    we can find a variable (called the *instrument*) that is a cause of our cause
    of interest but is otherwise unrelated to both the confounder and the effect of
    interest:'
  prefs: []
  type: TYPE_NORMAL
- en: The first condition (called the *independence assumption*) is necessary for
    the reduced regression to be unbiased, but fortunately it is always true with
    a random assignment.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The second condition (called the *exclusion restriction*) can be rephrased as
    saying that the relationship between the instrument and the effect of interest
    must be fully mediated by the cause of interest. It is necessary for the equation
    *β[gr]* = *β[c]*[2] * *β[g]*[1] to be true. Unfortunately, it can’t be proven
    mathematically (that would require knowing the coefficient for the second arm
    of the mediation, which is what we’re looking for!) and must be assumed based
    on qualitative causal considerations—in this case, for example, that the experimental
    group assignment is unlikely to affect *M6Spend* outside of the *CSAT* chain.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Measurement
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: That was the intuition. We could certainly calculate all the corresponding regressions
    by hand, but as we spoiled twenty-first-century data analysts have come to expect,
    there is a package for that.
  prefs: []
  type: TYPE_NORMAL
- en: 'First, we’ll do two sanity checks by running the linear regressions for the
    first arm of the mediation and for the total effect (i.e., the reduced equation).
    If either of these yields a coefficient very close to zero (as determined by the
    Bootstrap CI), that would jeopardize our IV regression. In most cases, you’ll
    want to include some other covariates that are causally related to your variables
    of interest. In our example from [Chapter 10](ch10.xhtml#cluster_randomization_and_hierarchical),
    *Age* (the age of the caller) and *Reason* (the reason for the call) were predictive
    of *CSAT* and included beside *Group*. We should include them here as well:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Fortunately, both coefficients are safely distinct from zero, so we can move
    to our IV regression.
  prefs: []
  type: TYPE_NORMAL
- en: Python code
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'In Python, we’ll use the package `linearmodels`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'The syntax of the `IV2SLS.from_formula()` function is almost the same as for
    `ols()`. The predicted variable, our effect of interest, goes to the left of the
    tilde sign (“~”) and the predictors go to the right of it, with the first-stage
    regression written between brackets. Two things to note:'
  prefs: []
  type: TYPE_NORMAL
- en: You need to explicitly include a constant (“1”) among the predictors.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The other covariates related to your variables of interest (here, *Age* and
    *Reason*) should be included here as well, outside of the brackets. Note that
    they will automatically be included in the first-stage regression. Your formula
    for the first-stage regression only needs to include the mediator, a.k.a. our
    cause of interest, and the instrument.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The output of the Python function is limited, but that’s all we need. The effect
    of *call_CSAT* on *M6Spend* is about $2.99 per unit, about $1 less than the naive,
    biased regression of *M6Spend* on *call_CSAT* would suggest:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: The Bootstrap 90%-CI for the unbiased effect is approximately [2.26; 3.89].
  prefs: []
  type: TYPE_NORMAL
- en: R code
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'In R, we’ll use the package `ivreg`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'Thankfully, the authors of the `ivreg` package have made a conscious effort
    to make the `ivreg()` function as similar as possible to `lm()`, in both its syntax
    and its output. The only difference in the formula is that there are now two lists
    of regressors, separated by a vertical bar “|”. Here’s where the variables need
    to go:'
  prefs: []
  type: TYPE_NORMAL
- en: The cause of interest, here *call_CSAT*, appears only on the left of the bar.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The instrument(s), here *Group*, appear only on the right of the bar.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The other explanatory variables that contribute to our cause or effect of interest,
    here *Age* and *Reason*, appear on both sides of the bar.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The output of `ivreg()` is also very similar to the output of `lm()`. Our value
    of interest is the coefficient for *call_CSAT*. `ivreg()` also returns the results
    of several diagnostics for IV, which test the strength of various relationships
    in our model. Here again, the effect of *call_CSAT* on *M6Spend* is about $2.99
    per unit. The corresponding Bootstrap 90%-CI is approximately [2.26; 3.89].
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'In our simple example, this difference between the two estimates comes from
    *Openness*. In real life, it’s unlikely that we would be able to confidently identify
    all the confounders at play, which we could instead, if you will, label “unknown
    psychological stuff.” However, even without measuring these confounders, we can
    measure their impact on *M6Spend* through *CSAT*: a change in these confounders
    that causes *CSAT* to increase by 1 point also causes *M6Spend* to increase by
    about $1\. Now we can go run surveys to measure openness or any other unknown
    psychological stuff with the knowledge that there is, so to speak, $1 worth of
    confounding on *M6Spend* per point of *CSAT* to account for. We know what we don’t
    know, which, if you ask me, is pretty cool.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Applying IVs: Frequently Asked Questions'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In the preceding example, we’ve leveraged IVs for the downstream analysis of
    experimental data: using experimental data to deconfound causal relationships.
    This is one of their most straightforward and potent uses, but it’s not the only
    one. Once you get familiar with IVs, you’ll start asking yourself “what about...?”
    Building complete examples for each potential use case would be redundant, but
    it’s worth calling out the most common ones:'
  prefs: []
  type: TYPE_NORMAL
- en: Can I use IVs with purely observational data?
  prefs: []
  type: TYPE_NORMAL
- en: Yes, and the process is exactly the same as with experimental data, but because
    the independence assumption is not a given in that case, you’ll need to make sure
    that it holds. I have often come up with a potential instrument only to realize
    a bit later that there was another connection between the instrument and the final
    effect lurking in the background.
  prefs: []
  type: TYPE_NORMAL
- en: Can I use IVs with a binary final effect?
  prefs: []
  type: TYPE_NORMAL
- en: In such a case, the relationships between coefficients are significantly more
    complicated than they are with linear regressions all along. The R package `ivprobit()`
    allows you to run a probit regression with an instrument, but as far as I know,
    there is no such solution for logistic regression.
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Here we are. At the beginning of the book I promised that we would measure
    the causal impact of customer satisfaction on a business metric, and we did just
    that: “An increase of stated customer satisfaction by one unit increases spending
    in the following six months by $2.99.” No lengthy caveat and footnotes, no “correlation
    is not causation” hand-waving—this is as clear-cut a result as it gets. And hopefully,
    a whole world of opportunities is opening in your mind. Customer satisfaction,
    loyalty program memeberships, brand perception: measuring the business implications
    of all these nebulous and biased concepts is within your reach. And chances are,
    you already have the data you need. Did someone in marketing run an experiment
    two years ago offering a discount to customers if they signed up for your loyalty
    program? Then it’s simply a matter of pulling the corresponding data and applying
    the one-line formula for IV regression. Of course, that simplicity isn’t coming
    out of nowhere. It’s been a long time in the making, as it requires:'
  prefs: []
  type: TYPE_NORMAL
- en: Well-defined and understood variables for customer satisfaction and spending,
    as we saw in [Part I](part01.xhtml#understanding_behaviors)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The right causal diagram, as we discovered in [Part II](part02.xhtml#causal_diagrams_and_deconfounding)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tools that allow us to handle uncertainty without having to memorize a bunch
    of statistical tests, as we saw in [Part III](part03.xhtml#robust_data_analysis)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Well-designed and well-analyzed experiments, as we explored in [Part IV](part04.xhtml#designing_and_analyzing_experiments)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Finally, an understanding of moderation and mediation, as we learned in [Part V](part05.xhtml#advanced_tools_in_behavioral_data_analy)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To end on a slightly less formal note: it is often noted that children appear
    to have an infinite curiosity for the world (“Why is the sky blue?”). Of course,
    that curiosity is not actually infinite, and at some point most children stop
    asking so many questions. It is my sincere hope that this book will have rekindled
    some of that childlike curiosity in you—that you’ll let yourself be intrigued
    by the world (especially the people) around you and you’ll wonder, “But why?”
    Of course, before claiming any credit for that, I’ll have to contemplate the very
    real possibility that I got the causality wrong and that you had it all in you
    from the start ([Figure 12-9](#did_i_mention_that_correlation_is_not_c)).'
  prefs: []
  type: TYPE_NORMAL
- en: '![Did I mention that correlation is not causation?](Images/BEDA_1209.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 12-9\. Did I mention that correlation is not causation?
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
