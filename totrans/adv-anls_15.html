<html><head></head><body><section data-pdf-bookmark="Chapter 12. Data Manipulation and &#10;Visualization in Python" data-type="chapter" epub:type="chapter"><div class="chapter" id="python-data-manipulation-visualization">&#13;
<h1><span class="label">Chapter 12. </span>Data Manipulation and &#13;
<span class="keep-together">Visualization in Python</span></h1>&#13;
&#13;
&#13;
<p>In <a data-type="xref" href="ch08.html#r-data-manipulation-visualization">Chapter 8</a> you learned how to manipulate and visualize data, with heavy help from the <code>tidyverse</code> suite of packages. Here we’ll demonstrate similar techniques on the <a data-primary="Star dataset example" data-secondary="in Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274531940104"/>same <em>star</em> dataset, this time in Python. In particular, we’ll <a data-primary="pandas, Python" data-secondary="data manipulation with" data-type="indexterm" id="idm46274531938312"/><a data-primary="seaborn package, Python" data-secondary="data visualization with" data-type="indexterm" id="idm46274531937336"/>use <code>pandas</code> and <code>seaborn</code> to manipulate and visualize data, respectively. This isn’t a comprehensive guide to what these modules, or Python, can do with data analysis. Instead, it’s enough to get you exploring on your own.</p>&#13;
&#13;
<p>As much as possible, I’ll mirror the steps and perform the same operations that we did in <a data-type="xref" href="ch08.html#r-data-manipulation-visualization">Chapter 8</a>. Because of this familiarity, I’ll focus less on the whys of <a data-primary="data manipulation" data-secondary="in Python" data-secondary-sortas="Python" data-type="indexterm" id="ch12_term1"/><a data-primary="Python programming language" data-secondary="data manipulation with" data-type="indexterm" id="ch12_term20"/>manipulating and visualizing data than I will on hows of doing it in Python. Let’s load the necessary modules and get started with <em>star</em>. The third <a data-primary="matplotlib, Python" data-secondary="pyplot submodule of" data-type="indexterm" id="idm46274531913288"/><a data-primary="modules, Python" data-secondary="matplotlib" data-type="indexterm" id="idm46274531912280"/>module, <code>matplotlib</code>, is new for you and will be used to complement our work in <code>seaborn</code>. It comes installed with <a data-primary="Anaconda, Python" data-secondary="packages with" data-type="indexterm" id="idm46274531910376"/>Anaconda. Specifically, we’ll be using the <code>pyplot</code> submodule, aliasing it as <code>plt</code>.</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code>  <code class="kn">import</code> <code class="nn">pandas</code> <code class="kn">as</code> <code class="nn">pd</code>&#13;
         <code class="kn">import</code> <code class="nn">seaborn</code> <code class="kn">as</code> <code class="nn">sns</code>&#13;
         <code class="kn">import</code> <code class="nn">matplotlib.pyplot</code> <code class="kn">as</code> <code class="nn">plt</code>&#13;
&#13;
         <code class="n">star</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_excel</code><code class="p">(</code><code class="s">'datasets/star/star.xlsx'</code><code class="p">)</code>&#13;
         <code class="n">star</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">1</code><code class="p">]:</code>&#13;
   <code class="n">tmathssk</code>  <code class="n">treadssk</code>             <code class="n">classk</code>  <code class="n">totexpk</code>   <code class="n">sex</code> <code class="n">freelunk</code>   <code class="n">race</code>  \&#13;
<code class="mi">0</code>       <code class="mi">473</code>       <code class="mi">447</code>        <code class="n">small</code><code class="o">.</code><code class="k">class</code>        <code class="err">7  </code><code class="nc">girl</code>       <code class="n">no</code>  <code class="n">white</code>&#13;
<code class="mi">1</code>       <code class="mi">536</code>       <code class="mi">450</code>        <code class="n">small</code><code class="o">.</code><code class="k">class</code>       <code class="err">21  </code><code class="nc">girl</code>       <code class="n">no</code>  <code class="n">black</code>&#13;
<code class="mi">2</code>       <code class="mi">463</code>       <code class="mi">439</code>  <code class="n">regular</code><code class="o">.</code><code class="k">with</code><code class="o">.</code><code class="n">aide</code>        <code class="mi">0</code>   <code class="n">boy</code>      <code class="n">yes</code>  <code class="n">black</code>&#13;
<code class="mi">3</code>       <code class="mi">559</code>       <code class="mi">448</code>            <code class="n">regular</code>       <code class="mi">16</code>   <code class="n">boy</code>       <code class="n">no</code>  <code class="n">white</code>&#13;
<code class="mi">4</code>       <code class="mi">489</code>       <code class="mi">447</code>        <code class="n">small</code><code class="o">.</code><code class="k">class</code>        <code class="err">5   </code><code class="nc">boy</code>      <code class="n">yes</code>  <code class="n">white</code>&#13;
&#13;
   <code class="n">schidkn</code>&#13;
<code class="mi">0</code>       <code class="mi">63</code>&#13;
<code class="mi">1</code>       <code class="mi">20</code>&#13;
<code class="mi">2</code>       <code class="mi">19</code>&#13;
<code class="mi">3</code>       <code class="mi">69</code>&#13;
<code class="mi">4</code>       <code class="mi">79</code></pre>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Column-Wise Operations" data-type="sect1"><div class="sect1" id="idm46274531907352">&#13;
<h1>Column-Wise Operations</h1>&#13;
&#13;
<p>In <a data-type="xref" href="ch11.html#data-structures-in-python">Chapter 11</a> you learned that <code>pandas</code> will attempt to convert <a data-primary="one-dimensional data structures" data-type="indexterm" id="idm46274531799064"/>one-dimensional data structures into <a data-primary="Series data structure, Python" data-type="indexterm" id="idm46274531798264"/><a data-primary="columns" data-secondary="data manipulation operations for" data-type="indexterm" id="ch12_term2"/><a data-primary="data manipulation" data-secondary="of columns" data-secondary-sortas="columns" data-type="indexterm" id="ch12_term3"/>Series. This seemingly trivial point will be quite important when selecting columns. Let’s take a look at an example: say we <em>just</em> wanted to keep the <em>tmathssk</em> column from <a data-primary="DataFrames, Python" data-secondary="building" data-type="indexterm" id="idm46274531793800"/>our DataFrame. We could do so using the familiar single-bracket notation, but this technically results in a Series, not a DataFrame:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code>  <code class="n">math_scores</code> <code class="o">=</code> <code class="n">star</code><code class="p">[</code><code class="s">'tmathssk'</code><code class="p">]</code>&#13;
         <code class="nb">type</code><code class="p">(</code><code class="n">math_scores</code><code class="p">)</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">series</code><code class="o">.</code><code class="n">Series</code></pre>&#13;
&#13;
<p>It’s probably better to keep this as a DataFrame if we aren’t positive that we want <em>math_scores</em> to stay as a one-dimensional structure. To do so, we can use two sets of brackets instead of one:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">math_scores</code> <code class="o">=</code> <code class="n">star</code><code class="p">[[</code><code class="s">'tmathssk'</code><code class="p">]]</code>&#13;
        <code class="nb">type</code><code class="p">(</code><code class="n">math_scores</code><code class="p">)</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">frame</code><code class="o">.</code><code class="n">DataFrame</code></pre>&#13;
&#13;
<p>Following this pattern, we can keep only the <a data-primary="columns attribute, Python" data-type="indexterm" id="idm46274531751256"/><a data-primary="columns" data-secondary="keeping" data-type="indexterm" id="idm46274531750648"/>desired columns in <em>star</em>. I’ll use the <code>columns</code> attribute to confirm.</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code>  <code class="n">star</code> <code class="o">=</code> <code class="n">star</code><code class="p">[[</code><code class="s">'tmathssk'</code><code class="p">,</code><code class="s">'treadssk'</code><code class="p">,</code><code class="s">'classk'</code><code class="p">,</code><code class="s">'totexpk'</code><code class="p">,</code><code class="s">'schidkn'</code><code class="p">]]</code>&#13;
         <code class="n">star</code><code class="o">.</code><code class="n">columns</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">Index</code><code class="p">([</code><code class="s">'tmathssk'</code><code class="p">,</code> <code class="s">'treadssk'</code><code class="p">,</code> <code class="s">'classk'</code><code class="p">,</code>&#13;
             <code class="s">'totexpk'</code><code class="p">,</code> <code class="s">'schidkn'</code><code class="p">],</code> <code class="n">dtype</code><code class="o">=</code><code class="s">'object'</code><code class="p">)</code></pre>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46274531662392">&#13;
<h5>Object-Oriented Programming in Python</h5>&#13;
<p>So far you’ve seen methods and functions in Python. These are <a data-primary="attributes, Python" data-type="indexterm" id="idm46274531596744"/><a data-primary="object-oriented programming (OOP)" data-type="indexterm" id="idm46274531596104"/><a data-primary="Python programming language" data-secondary="attributes" data-type="indexterm" id="idm46274531595464"/><a data-primary="OOP (object-oriented programming)" data-type="indexterm" id="idm46274531594552"/>things that objects can <em>do</em>. Attributes, on the other hand, represent some <em>state</em> of an object itself. These are affixed to an object’s name with a period; unlike methods, no parentheses are used. Attributes, functions, and methods are all elements of <em>object-oriented programming</em> (OOP), a paradigm meant to structure work into simple and reusable pieces of code. To <a data-primary="Python programming language" data-secondary="further reading on" data-type="indexterm" id="idm46274531592312"/>learn more about how OOP works in Python, check out <a class="orm:hideurl" href="https://oreil.ly/s1XhF"><em>Python in a Nutshell</em></a>, 3rd edition by Alex Martelli et al. (O’Reilly).</p>&#13;
</div></aside>&#13;
&#13;
<p>To drop <a data-primary="columns" data-secondary="dropping" data-type="indexterm" id="idm46274531589576"/><a data-primary="drop() method, Python" data-type="indexterm" id="idm46274531588184"/><a data-primary="dropping columns" data-type="indexterm" id="idm46274531587512"/><a data-primary="axis argument with drop(), Python" data-type="indexterm" id="idm46274531586840"/>specific columns, use the <code>drop()</code> method. <code>drop()</code> can be used to <a data-primary="rows" data-secondary="dropping" data-type="indexterm" id="idm46274531585240"/>drop columns <em>or</em> rows, so we’ll need to specify which by using the <code>axis</code> argument. In <code>pandas</code>, rows are axis <code>0</code> and columns axis <code>1</code>, as <a data-type="xref" href="#pandas-axes">Figure 12-1</a> demonstrates.</p>&#13;
&#13;
<figure><div class="figure" id="pandas-axes">&#13;
<img alt="Axes of star dataset" src="assets/aina_1201.png"/>&#13;
<h6><span class="label">Figure 12-1. </span>Axes of a <code>pandas</code> DataFrame</h6>&#13;
</div></figure>&#13;
&#13;
<p>Here’s how to drop the <em>schidkn</em> column:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">star</code> <code class="o">=</code> <code class="n">star</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="s">'schidkn'</code><code class="p">,</code> <code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code>&#13;
        <code class="n">star</code><code class="o">.</code><code class="n">columns</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="n">Index</code><code class="p">([</code><code class="s">'tmathssk'</code><code class="p">,</code> <code class="s">'treadssk'</code><code class="p">,</code>&#13;
            <code class="s">'classk'</code><code class="p">,</code> <code class="s">'totexpk'</code><code class="p">],</code> <code class="n">dtype</code><code class="o">=</code><code class="s">'object'</code><code class="p">)</code></pre>&#13;
&#13;
<p>Let’s now look at <a data-primary="columns" data-secondary="creating new" data-type="indexterm" id="idm46274531520888"/><a data-primary="DataFrames, Python" data-secondary="building" data-type="indexterm" id="idm46274531507224"/>deriving new columns of a DataFrame. We can do that using bracket notation—this time, I <em>do</em> want the result to be a <a data-primary="Series data structure, Python" data-type="indexterm" id="idm46274531505688"/>Series, as each column of a DataFrame is actually a Series (just as each <a data-primary="vectors" data-secondary="R data frames as list of" data-type="indexterm" id="idm46274531504888"/>column of an R data frame is actually a vector). Here I’ll calculate combined math and reading scores:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">star</code><code class="p">[</code><code class="s">'new_column'</code><code class="p">]</code> <code class="o">=</code> <code class="n">star</code><code class="p">[</code><code class="s">'tmathssk'</code><code class="p">]</code> <code class="o">+</code> <code class="n">star</code><code class="p">[</code><code class="s">'treadssk'</code><code class="p">]</code>&#13;
        <code class="n">star</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">6</code><code class="p">]:</code>&#13;
   <code class="n">tmathssk</code>  <code class="n">treadssk</code>             <code class="n">classk</code>  <code class="n">totexpk</code>  <code class="n">new_column</code>&#13;
<code class="mi">0</code>       <code class="mi">473</code>       <code class="mi">447</code>        <code class="n">small</code><code class="o">.</code><code class="k">class</code>        <code class="err">7         920</code>&#13;
<code class="mi">1</code>       <code class="mi">536</code>       <code class="mi">450</code>        <code class="n">small</code><code class="o">.</code><code class="k">class</code>       <code class="err">21         986</code>&#13;
<code class="mi">2</code>       <code class="mi">463</code>       <code class="mi">439</code>  <code class="n">regular</code><code class="o">.</code><code class="k">with</code><code class="o">.</code><code class="n">aide</code>        <code class="mi">0</code>         <code class="mi">902</code>&#13;
<code class="mi">3</code>       <code class="mi">559</code>       <code class="mi">448</code>            <code class="n">regular</code>       <code class="mi">16</code>        <code class="mi">1007</code>&#13;
<code class="mi">4</code>       <code class="mi">489</code>       <code class="mi">447</code>        <code class="n">small</code><code class="o">.</code><code class="k">class</code>        <code class="err">5         936</code></pre>&#13;
&#13;
<p>Again, <em>new_column</em> isn’t a terribly descriptive variable name. Let’s <a data-primary="rename() function, R and Python" data-type="indexterm" id="idm46274531501528"/>fix that with the <code>rename()</code> function. We’ll use the <code>columns</code> argument and pass data to it in a format you’re likely unfamiliar with:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">star</code> <code class="o">=</code> <code class="n">star</code><code class="o">.</code><code class="n">rename</code><code class="p">(</code><code class="n">columns</code> <code class="o">=</code> <code class="p">{</code><code class="s">'new_column'</code><code class="p">:</code><code class="s">'ttl_score'</code><code class="p">})</code>&#13;
        <code class="n">star</code><code class="o">.</code><code class="n">columns</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">Index</code><code class="p">([</code><code class="s">'tmathssk'</code><code class="p">,</code> <code class="s">'treadssk'</code><code class="p">,</code> <code class="s">'classk'</code><code class="p">,</code> <code class="s">'totexpk'</code><code class="p">,</code> <code class="s">'ttl_score'</code><code class="p">],</code>&#13;
           <code class="n">dtype</code><code class="o">=</code><code class="s">'object'</code><code class="p">)</code></pre>&#13;
&#13;
<p>The curly bracket notation used in the last <a data-primary="dictionaries, Python" data-type="indexterm" id="idm46274531399432"/><a data-primary="Python dictionaries" data-type="indexterm" id="idm46274531372744"/>example is a Python <em>dictionary</em>. Dictionaries are <a data-primary="data structures" data-secondary="in Python" data-secondary-sortas="Python" data-seealso="DataFrames, Python" data-type="indexterm" id="idm46274531296536"/>collections of <em>key-value</em> pairs, with the key and value of each element separated by a colon. This is a core Python data structure and one to check out as you continue <a data-startref="ch12_term2" data-type="indexterm" id="idm46274531294312"/><a data-startref="ch12_term3" data-type="indexterm" id="idm46274531293608"/>learning the language.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Row-Wise Operations" data-type="sect1"><div class="sect1" id="idm46274531906760">&#13;
<h1>Row-Wise Operations</h1>&#13;
&#13;
<p>Now let’s move to <a data-primary="data manipulation" data-secondary="of rows" data-secondary-sortas="rows" data-type="indexterm" id="ch12_term4"/><a data-primary="rows" data-secondary="data manipulation operations for" data-type="indexterm" id="ch12_term5"/>common operations by row. We’ll start with <a data-primary="rows" data-secondary="sorting" data-type="indexterm" id="idm46274531288152"/><a data-primary="sorting data" data-type="indexterm" id="idm46274531287208"/><a data-primary="sort_values() method, Python" data-type="indexterm" id="idm46274531286536"/>sorting, which can be done in <code>pandas</code> with the <code>sort_values()</code> method. We’ll pass a list of columns we want to sort by in their respective order to the <code>by</code> argument:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="n">star</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="n">by</code><code class="o">=</code><code class="p">[</code><code class="s">'classk'</code><code class="p">,</code> <code class="s">'tmathssk'</code><code class="p">])</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">8</code><code class="p">]:</code>&#13;
     <code class="n">tmathssk</code>  <code class="n">treadssk</code>   <code class="n">classk</code>  <code class="n">totexpk</code>  <code class="n">ttl_score</code>&#13;
<code class="mi">309</code>        <code class="mi">320</code>       <code class="mi">360</code>  <code class="n">regular</code>        <code class="mi">6</code>        <code class="mi">680</code>&#13;
<code class="mi">1470</code>       <code class="mi">320</code>       <code class="mi">315</code>  <code class="n">regular</code>        <code class="mi">3</code>        <code class="mi">635</code>&#13;
<code class="mi">2326</code>       <code class="mi">339</code>       <code class="mi">388</code>  <code class="n">regular</code>        <code class="mi">6</code>        <code class="mi">727</code>&#13;
<code class="mi">2820</code>       <code class="mi">354</code>       <code class="mi">398</code>  <code class="n">regular</code>        <code class="mi">6</code>        <code class="mi">752</code>&#13;
<code class="mi">4925</code>       <code class="mi">354</code>       <code class="mi">391</code>  <code class="n">regular</code>        <code class="mi">8</code>        <code class="mi">745</code></pre>&#13;
&#13;
<p>By default, all columns are sorted ascendingly. To modify that, we can include another argument, <code>ascending</code>, which will contain a list of <code>True</code>/<code>False</code> flags. Let’s sort <em>star</em> by class size (<em>classk</em>) ascending and math score (<em>treadssk</em>) descending. Because we’re not assigning this output back to <em>star</em>, this sorting is not permanent to the &#13;
<span class="keep-together">dataset</span>.</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="c"># Sort by class size ascending and math score descending</code>&#13;
        <code class="n">star</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="n">by</code><code class="o">=</code><code class="p">[</code><code class="s">'classk'</code><code class="p">,</code> <code class="s">'tmathssk'</code><code class="p">],</code>&#13;
         <code class="n">ascending</code><code class="o">=</code><code class="p">[</code><code class="bp">True</code><code class="p">,</code> <code class="bp">False</code><code class="p">])</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">9</code><code class="p">]:</code>&#13;
      <code class="n">tmathssk</code>  <code class="n">treadssk</code>   <code class="n">classk</code>  <code class="n">totexpk</code>  <code class="n">ttl_score</code>&#13;
<code class="mi">724</code>        <code class="mi">626</code>       <code class="mi">474</code>  <code class="n">regular</code>       <code class="mi">15</code>       <code class="mi">1100</code>&#13;
<code class="mi">1466</code>       <code class="mi">626</code>       <code class="mi">554</code>  <code class="n">regular</code>       <code class="mi">11</code>       <code class="mi">1180</code>&#13;
<code class="mi">1634</code>       <code class="mi">626</code>       <code class="mi">580</code>  <code class="n">regular</code>       <code class="mi">15</code>       <code class="mi">1206</code>&#13;
<code class="mi">2476</code>       <code class="mi">626</code>       <code class="mi">538</code>  <code class="n">regular</code>       <code class="mi">20</code>       <code class="mi">1164</code>&#13;
<code class="mi">2495</code>       <code class="mi">626</code>       <code class="mi">522</code>  <code class="n">regular</code>        <code class="mi">7</code>       <code class="mi">1148</code></pre>&#13;
&#13;
<p>To <a data-primary="filtering data" data-type="indexterm" id="ch12_term6"/><a data-primary="rows" data-secondary="filtering" data-type="indexterm" id="ch12_term7"/>filter <a data-primary="Python programming language" data-secondary="data structures" data-seealso="DataFrames, Python" data-type="indexterm" id="idm46274531101672"/>a DataFrame, we’ll first use conditional logic to create a <a data-primary="Series data structure, Python" data-type="indexterm" id="idm46274531100328"/>Series of <code>True</code>/<code>False</code> flags indicating whether each row meets some criteria. We’ll then keep only the rows in the DataFrame where records in the Series are flagged as <code>True</code>. For example, let’s keep only the records where <code>classk</code> is equal to <code>small.class</code>.</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">10</code><code class="p">]:</code> <code class="n">small_class</code> <code class="o">=</code> <code class="n">star</code><code class="p">[</code><code class="s">'classk'</code><code class="p">]</code> <code class="o">==</code> <code class="s">'small.class'</code>&#13;
         <code class="n">small_class</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">10</code><code class="p">]:</code>&#13;
        <code class="mi">0</code>     <code class="bp">True</code>&#13;
        <code class="mi">1</code>     <code class="bp">True</code>&#13;
        <code class="mi">2</code>    <code class="bp">False</code>&#13;
        <code class="mi">3</code>    <code class="bp">False</code>&#13;
        <code class="mi">4</code>     <code class="bp">True</code>&#13;
        <code class="n">Name</code><code class="p">:</code> <code class="n">classk</code><code class="p">,</code> <code class="n">dtype</code><code class="p">:</code> <code class="nb">bool</code></pre>&#13;
&#13;
<p>We can now filter by this resulting Series by using brackets. We can <a data-primary="shape attribute, Python" data-type="indexterm" id="idm46274531095784"/>confirm the number of rows and columns in our new DataFrame with the <code>shape</code> attribute:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="n">star_filtered</code> <code class="o">=</code> <code class="n">star</code><code class="p">[</code><code class="n">small_class</code><code class="p">]</code>&#13;
         <code class="n">star_filtered</code><code class="o">.</code><code class="n">shape</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="p">(</code><code class="mi">1733</code><code class="p">,</code> <code class="mi">5</code><code class="p">)</code></pre>&#13;
&#13;
<p><code>star_filtered</code> will contain fewer rows than <em>star</em>, but the same number of columns:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="n">star</code><code class="o">.</code><code class="n">shape</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="p">(</code><code class="mi">5748</code><code class="p">,</code> <code class="mi">5</code><code class="p">)</code></pre>&#13;
&#13;
<p>Let’s try one more: we’ll find the records where <code>treadssk</code> is at least <code>500</code>:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="n">star_filtered</code> <code class="o">=</code> <code class="n">star</code><code class="p">[</code><code class="n">star</code><code class="p">[</code><code class="s">'treadssk'</code><code class="p">]</code> <code class="o">&gt;=</code> <code class="mi">500</code><code class="p">]</code>&#13;
         <code class="n">star_filtered</code><code class="o">.</code><code class="n">shape</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="p">(</code><code class="mi">233</code><code class="p">,</code> <code class="mi">5</code><code class="p">)</code></pre>&#13;
&#13;
<p>It’s also possible to filter by multiple conditions using and/or statements. Just like &#13;
<span class="keep-together">in R,</span> <code>&amp;</code> and <code>|</code> indicate “and” and “or” in Python, respectively. Let’s pass both of the previous criteria into one statement by placing each in parentheses, connecting <a data-startref="ch12_term4" data-type="indexterm" id="idm46274530884040"/><a data-startref="ch12_term5" data-type="indexterm" id="idm46274530883336"/><a data-primary="&amp; ampersand" data-type="indexterm" id="idm46274530882664"/><a data-primary="ampersand (&amp;), R and Python operator" data-type="indexterm" id="idm46274530881992"/>them &#13;
<span class="keep-together">with <code>&amp;</code>:</span></p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="c"># Find all records with reading score at least 500 and in small class</code>&#13;
         <code class="n">star_filtered</code> <code class="o">=</code> <code class="n">star</code><code class="p">[(</code><code class="n">star</code><code class="p">[</code><code class="s">'treadssk'</code><code class="p">]</code> <code class="o">&gt;=</code> <code class="mi">500</code><code class="p">)</code> <code class="o">&amp;</code>&#13;
                   <code class="p">(</code><code class="n">star</code><code class="p">[</code><code class="s">'classk'</code><code class="p">]</code> <code class="o">==</code> <code class="s">'small.class'</code><code class="p">)]</code>&#13;
         <code class="n">star_filtered</code><code class="o">.</code><code class="n">shape</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">14</code><code class="p">]:</code> <code class="p">(</code><code class="mi">84</code><code class="p">,</code> <code class="mi">5</code><code class="p">)</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Aggregating and Joining Data" data-type="sect1"><div class="sect1" id="idm46274531292344">&#13;
<h1>Aggregating and Joining Data</h1>&#13;
&#13;
<p>To <a data-startref="ch12_term6" data-type="indexterm" id="idm46274530816504"/><a data-startref="ch12_term7" data-type="indexterm" id="idm46274530815832"/><a data-primary="aggregating data" data-type="indexterm" id="ch12_term8"/><a data-primary="data manipulation" data-secondary="by aggregation and joins" data-secondary-sortas="aggregation and joins" data-type="indexterm" id="ch12_term9)"/>group observations in a DataFrame, we’ll use the <code>groupby()</code> method. If we print <code>star_grouped</code>, you’ll see it’s a <code>DataFrameGroupBy</code> object:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="n">star_grouped</code> <code class="o">=</code> <code class="n">star</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s">'classk'</code><code class="p">)</code>&#13;
         <code class="n">star_grouped</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="o">&lt;</code><code class="n">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">groupby</code><code class="o">.</code><code class="n">generic</code><code class="o">.</code><code class="n">DataFrameGroupBy</code>&#13;
            <code class="nb">object</code> <code class="n">at</code> <code class="mh">0x000001EFD8DFF388</code><code class="o">&gt;</code></pre>&#13;
&#13;
<p>We can now choose other <a data-primary="joining data" data-type="indexterm" id="ch12_term10"/><a data-primary="combining (joining) data" data-type="indexterm" id="ch12_term30"/>fields to aggregate this grouped DataFrame by. <a data-type="xref" href="#pandas-agg-types">Table 12-1</a> lists some <a data-primary="aggregation functions, R and Python" data-type="indexterm" id="idm46274530739800"/><a data-primary="sum() function, R and Python" data-type="indexterm" id="idm46274530739128"/><a data-primary="count() function, R and Python" data-type="indexterm" id="idm46274530738488"/><a data-primary="mean() function, R and Python" data-type="indexterm" id="idm46274530737848"/><a data-primary="max() function, R and Python" data-type="indexterm" id="idm46274530737160"/><a data-primary="min() function, R and Python" data-type="indexterm" id="idm46274530736472"/><a data-primary="std() function, Python" data-type="indexterm" id="idm46274530735784"/><a data-primary="functions" data-secondary="in Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274530735112"/><a data-primary="Python programming language" data-secondary="methods" data-type="indexterm" id="idm46274530733896"/><a data-primary="pandas, Python" data-secondary="functions in" data-type="indexterm" id="idm46274530732936"/><a data-primary="pandas, Python" data-secondary="data manipulation with" data-type="indexterm" id="idm46274530731992"/>common aggregation methods.</p>&#13;
<table id="pandas-agg-types">&#13;
<caption><span class="label">Table 12-1. </span>Helpful aggregation functions in <code>pandas</code></caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Method</th>&#13;
<th>Aggregation type</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>sum()</code></p></td>&#13;
<td><p>Sum</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>count()</code></p></td>&#13;
<td><p>Count values</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>mean()</code></p></td>&#13;
<td><p>Average</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>max()</code></p></td>&#13;
<td><p>Highest value</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>min()</code></p></td>&#13;
<td><p>Lowest value</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>std()</code></p></td>&#13;
<td><p>Standard deviation</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>The following gives us the average math score for each class size:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">16</code><code class="p">]:</code> <code class="n">star_grouped</code><code class="p">[[</code><code class="s">'tmathssk'</code><code class="p">]]</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">16</code><code class="p">]:</code>&#13;
                        <code class="n">tmathssk</code>&#13;
    <code class="n">classk</code>&#13;
    <code class="n">regular</code>            <code class="mf">483.261000</code>&#13;
    <code class="n">regular</code><code class="o">.</code><code class="k">with</code><code class="o">.</code><code class="n">aide</code>  <code class="mf">483.009926</code>&#13;
    <code class="n">small</code><code class="o">.</code><code class="k">class</code>        <code class="err">491.470283</code></pre>&#13;
&#13;
<p>Now we’ll find the highest total score for each year of teacher experience. Because this would return quite a few rows, I will <a data-primary="head() method" data-secondary="in Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274530673048"/>include the <code>head()</code> method to get just a few. This practice of <a data-primary="chaining, method, Python" data-type="indexterm" id="idm46274530671416"/><a data-primary="methods" data-secondary="in Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274530670744"/>adding multiple methods to the same command is called method <em>chaining</em>:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">17</code><code class="p">]:</code> <code class="n">star</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s">'totexpk'</code><code class="p">)[[</code><code class="s">'ttl_score'</code><code class="p">]]</code><code class="o">.</code><code class="n">max</code><code class="p">()</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">17</code><code class="p">]:</code>&#13;
                <code class="n">ttl_score</code>&#13;
        <code class="n">totexpk</code>&#13;
        <code class="mi">0</code>             <code class="mi">1171</code>&#13;
        <code class="mi">1</code>             <code class="mi">1133</code>&#13;
        <code class="mi">2</code>             <code class="mi">1091</code>&#13;
        <code class="mi">3</code>             <code class="mi">1203</code>&#13;
        <code class="mi">4</code>             <code class="mi">1229</code></pre>&#13;
&#13;
<p><a data-type="xref" href="ch08.html#r-data-manipulation-visualization">Chapter 8</a> reviewed the similarities and differences between <a data-primary="VLOOKUP() function, Excel" data-type="indexterm" id="idm46274530598984"/><a data-primary="left outer join" data-type="indexterm" id="idm46274530598376"/><a data-primary="merge() method,  Python" data-type="indexterm" id="idm46274530597768"/>Excel’s <code>VLOOKUP()</code> and a left outer join. I’ll read in a fresh copy of <em>star</em> as well as <em>districts</em>; let’s use <code>pandas</code> to join these datasets. We’ll use the <code>merge()</code> method to “look up” data from <em>school-districts</em> into <em>star</em>. By setting the <code>how</code> argument to <code>left</code>, we’ll specify a left outer join, which again is the join type most similar to <code>VLOOKUP()</code>:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">18</code><code class="p">]:</code> <code class="n">star</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_excel</code><code class="p">(</code><code class="s">'datasets/star/star.xlsx'</code><code class="p">)</code>&#13;
         <code class="n">districts</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="s">'datasets/star/districts.csv'</code><code class="p">)</code>&#13;
         <code class="n">star</code><code class="o">.</code><code class="n">merge</code><code class="p">(</code><code class="n">districts</code><code class="p">,</code> <code class="n">how</code><code class="o">=</code><code class="s">'left'</code><code class="p">)</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">18</code><code class="p">]:</code>&#13;
   <code class="n">tmathssk</code>  <code class="n">treadssk</code>             <code class="n">classk</code>  <code class="n">totexpk</code>   <code class="n">sex</code> <code class="n">freelunk</code>   <code class="n">race</code>  \&#13;
<code class="mi">0</code>       <code class="mi">473</code>       <code class="mi">447</code>        <code class="n">small</code><code class="o">.</code><code class="k">class</code>        <code class="err">7  </code><code class="nc">girl</code>       <code class="n">no</code>  <code class="n">white</code>&#13;
<code class="mi">1</code>       <code class="mi">536</code>       <code class="mi">450</code>        <code class="n">small</code><code class="o">.</code><code class="k">class</code>       <code class="err">21  </code><code class="nc">girl</code>       <code class="n">no</code>  <code class="n">black</code>&#13;
<code class="mi">2</code>       <code class="mi">463</code>       <code class="mi">439</code>  <code class="n">regular</code><code class="o">.</code><code class="k">with</code><code class="o">.</code><code class="n">aide</code>        <code class="mi">0</code>   <code class="n">boy</code>      <code class="n">yes</code>  <code class="n">black</code>&#13;
<code class="mi">3</code>       <code class="mi">559</code>       <code class="mi">448</code>            <code class="n">regular</code>       <code class="mi">16</code>   <code class="n">boy</code>       <code class="n">no</code>  <code class="n">white</code>&#13;
<code class="mi">4</code>       <code class="mi">489</code>       <code class="mi">447</code>        <code class="n">small</code><code class="o">.</code><code class="k">class</code>        <code class="err">5   </code><code class="nc">boy</code>      <code class="n">yes</code>  <code class="n">white</code>&#13;
&#13;
   <code class="n">schidkn</code>    <code class="n">school_name</code>          <code class="n">county</code>&#13;
<code class="mi">0</code>       <code class="mi">63</code>     <code class="n">Ridgeville</code>     <code class="n">New</code> <code class="n">Liberty</code>&#13;
<code class="mi">1</code>       <code class="mi">20</code>  <code class="n">South</code> <code class="n">Heights</code>         <code class="n">Selmont</code>&#13;
<code class="mi">2</code>       <code class="mi">19</code>      <code class="n">Bunnlevel</code>         <code class="n">Sattley</code>&#13;
<code class="mi">3</code>       <code class="mi">69</code>          <code class="n">Hokah</code>      <code class="n">Gallipolis</code>&#13;
<code class="mi">4</code>       <code class="mi">79</code>   <code class="n">Lake</code> <code class="n">Mathews</code>  <code class="n">Sugar</code> <code class="n">Mountain</code></pre>&#13;
&#13;
<p>Python, <a data-primary="Python programming language" data-secondary="R similarities to" data-type="indexterm" id="idm46274530590120"/><a data-primary="R programming language" data-secondary="Python similarities to" data-type="indexterm" id="idm46274530589384"/>like R, is quite intuitive about joining data: it knew by default to merge on <em>schidkn</em> and brought in <a data-startref="ch12_term8" data-type="indexterm" id="idm46274530402008"/><a data-startref="ch12_term9" data-type="indexterm" id="idm46274530401272"/><a data-startref="ch12_term10" data-type="indexterm" id="idm46274530400600"/><a data-startref="ch12_term30" data-type="indexterm" id="idm46274530399928"/>both <em>school_name</em> and <em>county</em>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Reshaping Data" data-type="sect1"><div class="sect1" id="idm46274530817320">&#13;
<h1>Reshaping Data</h1>&#13;
&#13;
<p>Let’s take a <a data-primary="data manipulation" data-secondary="by reshaping" data-secondary-sortas="reshaping" data-type="indexterm" id="ch12_term11"/><a data-primary="pandas, Python" data-secondary="data manipulation with" data-type="indexterm" id="ch12_term12"/><a data-primary="reshaping in data manipulation" data-type="indexterm" id="ch12_term13"/><a data-primary="columns" data-secondary="data manipulation operations for" data-type="indexterm" id="ch12_term14"/><a data-primary="data manipulation" data-secondary="of columns" data-secondary-sortas="columns" data-type="indexterm" id="ch12_term25"/>look at widening and lengthening a dataset in Python, again using <code>pandas</code>. To start, we can <a data-primary="melt() function, Python" data-type="indexterm" id="idm46274530389576"/>use the <code>melt()</code> function to combine <em>tmathssk</em> and <em>treadssk</em> into one column. To do this, I’ll specify the DataFrame to <a data-primary="frame argument, Python" data-type="indexterm" id="idm46274530387400"/>manipulate with the <code>frame</code> argument, which variable to use as a <a data-primary="id_vars parameter, Python" data-type="indexterm" id="idm46274530386152"/><a data-primary="value_vars, Python" data-type="indexterm" id="idm46274530385480"/>unique identifier with <code>id_vars</code>, and which variables to melt into a single column with <code>value_vars</code>. I’ll also specify what to <a data-primary="value_name, Python" data-type="indexterm" id="idm46274530383848"/><a data-primary="var_name, Python" data-type="indexterm" id="idm46274530383144"/>name the resulting value and label variables with <code>value_name</code> and <code>var_name</code>, respectively:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">19</code><code class="p">]:</code> <code class="n">star_pivot</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">melt</code><code class="p">(</code><code class="n">frame</code><code class="o">=</code><code class="n">star</code><code class="p">,</code> <code class="n">id_vars</code> <code class="o">=</code> <code class="s">'schidkn'</code><code class="p">,</code>&#13;
            <code class="n">value_vars</code><code class="o">=</code><code class="p">[</code><code class="s">'tmathssk'</code><code class="p">,</code> <code class="s">'treadssk'</code><code class="p">],</code> <code class="n">value_name</code><code class="o">=</code><code class="s">'score'</code><code class="p">,</code>&#13;
            <code class="n">var_name</code><code class="o">=</code><code class="s">'test_type'</code><code class="p">)</code>&#13;
         <code class="n">star_pivot</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">19</code><code class="p">]:</code>&#13;
            <code class="n">schidkn</code> <code class="n">test_type</code>  <code class="n">score</code>&#13;
         <code class="mi">0</code>       <code class="mi">63</code>  <code class="n">tmathssk</code>    <code class="mi">473</code>&#13;
         <code class="mi">1</code>       <code class="mi">20</code>  <code class="n">tmathssk</code>    <code class="mi">536</code>&#13;
         <code class="mi">2</code>       <code class="mi">19</code>  <code class="n">tmathssk</code>    <code class="mi">463</code>&#13;
         <code class="mi">3</code>       <code class="mi">69</code>  <code class="n">tmathssk</code>    <code class="mi">559</code>&#13;
         <code class="mi">4</code>       <code class="mi">79</code>  <code class="n">tmathssk</code>    <code class="mi">489</code></pre>&#13;
&#13;
<p>How about renaming <em>tmathssk</em> and <em>treadssk</em> as <em>math</em> and <em>reading</em>, respectively? To do this, I’ll use a <a data-primary="dictionaries, Python" data-type="indexterm" id="idm46274530226824"/><a data-primary="Python dictionaries" data-type="indexterm" id="idm46274530226232"/>Python dictionary to set up an object called <code>mapping</code>, which serves as something like a “lookup table” to recode the values. I’ll <a data-primary="map() method, Python" data-type="indexterm" id="idm46274530224984"/>pass this into the <code>map()</code> method which will recode <em>test_type</em>. I’ll also <a data-primary="unique() method, Python" data-type="indexterm" id="idm46274530223320"/>use the <code>unique()</code> method to confirm that only <em>math</em> and <em>reading</em> are now found in <em>test_type</em>:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">20</code><code class="p">]:</code> <code class="c"># Rename records in `test_type`</code>&#13;
         <code class="n">mapping</code> <code class="o">=</code> <code class="p">{</code><code class="s">'tmathssk'</code><code class="p">:</code><code class="s">'math'</code><code class="p">,</code><code class="s">'treadssk'</code><code class="p">:</code><code class="s">'reading'</code><code class="p">}</code>&#13;
         <code class="n">star_pivot</code><code class="p">[</code><code class="s">'test_type'</code><code class="p">]</code> <code class="o">=</code> <code class="n">star_pivot</code><code class="p">[</code><code class="s">'test_type'</code><code class="p">]</code><code class="o">.</code><code class="n">map</code><code class="p">(</code><code class="n">mapping</code><code class="p">)</code>&#13;
&#13;
         <code class="c"># Find unique values in test_type</code>&#13;
         <code class="n">star_pivot</code><code class="p">[</code><code class="s">'test_type'</code><code class="p">]</code><code class="o">.</code><code class="n">unique</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">20</code><code class="p">]:</code> <code class="n">array</code><code class="p">([</code><code class="s">'math'</code><code class="p">,</code> <code class="s">'reading'</code><code class="p">],</code> <code class="n">dtype</code><code class="o">=</code><code class="nb">object</code><code class="p">)</code></pre>&#13;
&#13;
<p>To <a data-primary="pivot_table() method, Python" data-type="indexterm" id="idm46274530310136"/><a data-primary="index argument, Python" data-type="indexterm" id="idm46274530326120"/><a data-primary="columns argument, Python" data-type="indexterm" id="idm46274530325512"/><a data-primary="values argument, Python" data-type="indexterm" id="idm46274530324872"/>widen <em>star_pivot</em> back into separate <em>math</em> and <em>reading</em> columns, I’ll use the <code>pivot_table()</code> method. First I’ll specify what variable to index by with the <code>index</code> argument, then which variables contain the labels and values to pivot from with the <code>columns</code> and <code>values</code> arguments, respectively.</p>&#13;
&#13;
<p>It’s possible in <code>pandas</code> to set unique index columns; by default, <code>pivot_table()</code> will set whatever variables you’ve included in the <code>index</code> argument there. To <a data-primary="reset_index() method, Python" data-type="indexterm" id="idm46274530319208"/>override this, I’ll use the <code>reset_index()</code> method. To <a data-primary="Python programming language" data-secondary="further reading on" data-type="indexterm" id="idm46274530184792"/>learn more about custom indexing in <code>pandas</code>, along with countless other data manipulation and analysis techniques we couldn’t <a data-startref="ch12_term1" data-type="indexterm" id="idm46274530183320"/><a data-startref="ch12_term20" data-type="indexterm" id="idm46274530182616"/>cover here, check out <a class="orm:hideurl" href="https://oreil.ly/CrP7B"><em>Python for Data Analysis</em></a>, 2nd edition by Wes McKinney (O’Reilly).</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">21</code><code class="p">]:</code> <code class="n">star_pivot</code><code class="o">.</code><code class="n">pivot_table</code><code class="p">(</code><code class="n">index</code><code class="o">=</code><code class="s">'schidkn'</code><code class="p">,</code>&#13;
          <code class="n">columns</code><code class="o">=</code><code class="s">'test_type'</code><code class="p">,</code> <code class="n">values</code><code class="o">=</code><code class="s">'score'</code><code class="p">)</code><code class="o">.</code><code class="n">reset_index</code><code class="p">()</code>&#13;
&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">21</code><code class="p">]:</code>&#13;
         <code class="n">test_type</code>  <code class="n">schidkn</code>        <code class="n">math</code>     <code class="n">reading</code>&#13;
         <code class="mi">0</code>                <code class="mi">1</code>  <code class="mf">492.272727</code>  <code class="mf">443.848485</code>&#13;
         <code class="mi">1</code>                <code class="mi">2</code>  <code class="mf">450.576923</code>  <code class="mf">407.153846</code>&#13;
         <code class="mi">2</code>                <code class="mi">3</code>  <code class="mf">491.452632</code>  <code class="mf">441.000000</code>&#13;
         <code class="mi">3</code>                <code class="mi">4</code>  <code class="mf">467.689655</code>  <code class="mf">421.620690</code>&#13;
         <code class="mi">4</code>                <code class="mi">5</code>  <code class="mf">460.084746</code>  <code class="mf">427.593220</code>&#13;
         <code class="o">..</code>             <code class="o">...</code>         <code class="o">...</code>         <code class="o">...</code>&#13;
         <code class="mi">74</code>              <code class="mi">75</code>  <code class="mf">504.329268</code>  <code class="mf">440.036585</code>&#13;
         <code class="mi">75</code>              <code class="mi">76</code>  <code class="mf">490.260417</code>  <code class="mf">431.666667</code>&#13;
         <code class="mi">76</code>              <code class="mi">78</code>  <code class="mf">468.457627</code>  <code class="mf">417.983051</code>&#13;
         <code class="mi">77</code>              <code class="mi">79</code>  <code class="mf">490.500000</code>  <code class="mf">434.451613</code>&#13;
         <code class="mi">78</code>              <code class="mi">80</code>  <code class="mf">490.037037</code>  <code class="mf">442.537037</code>&#13;
&#13;
         <code class="p">[</code><code class="mi">79</code> <code class="n">rows</code> <code class="n">x</code> <code class="mi">3</code> <code class="n">columns</code><code class="p">]</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Data Visualization" data-type="sect1"><div class="sect1" id="idm46274530178552">&#13;
<h1>Data Visualization</h1>&#13;
&#13;
<p>Let’s now <a data-startref="ch12_term11" data-type="indexterm" id="idm46274530177416"/><a data-startref="ch12_term12" data-type="indexterm" id="idm46274530058184"/><a data-startref="ch12_term13" data-type="indexterm" id="idm46274530057512"/><a data-startref="ch12_term14" data-type="indexterm" id="idm46274530056840"/><a data-startref="ch12_term25" data-type="indexterm" id="idm46274530056168"/><a data-primary="Python programming language" data-secondary="visualization of data in" data-type="indexterm" id="ch12_term15"/><a data-primary="seaborn package, Python" data-secondary="data visualization with" data-type="indexterm" id="ch12_term16"/><a data-primary="visualization of data" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="ch12_term17"/>briefly touch on data visualization in Python, specifically using the <code>seaborn</code> package. <code>seaborn</code> works especially well for statistical analysis and with <code>pandas</code> DataFrames, so it’s a great choice here. Similarly to how <code>pandas</code> is built on top of <code>numpy</code>, <code>seaborn</code> leverages features of another popular <a data-primary="matplotlib, Python" data-secondary="and seaborn package" data-secondary-sortas="seaborn package" data-type="indexterm" id="idm46274530048952"/>Python plotting package, <code>matplotlib</code>.</p>&#13;
&#13;
<p><code>seaborn</code> includes many functions to build different plot types. We’ll modify the arguments within these functions to specify which dataset to plot, which variables &#13;
<span class="keep-together">go along</span> the x- and y-axes, which colors to use, and so on. Let’s get started by visualizing the <a data-primary="countplot() function, Python" data-type="indexterm" id="idm46274530045800"/>count of observations for each level of <em>classk</em>, which we can do with the &#13;
<span class="keep-together"><code>countplot()</code></span> function.</p>&#13;
&#13;
<p>Our dataset is <em>star</em>, which we’ll specify with the <code>data</code> argument. To place our <a data-primary="x-axis, mapping" data-type="indexterm" id="idm46274530042152"/><a data-primary="visualization of data" data-secondary="countplots (bar charts)" data-type="indexterm" id="idm46274530041448"/><a data-primary="bar charts (countplots)" data-type="indexterm" id="idm46274530040504"/><a data-primary="countplots" data-type="indexterm" id="idm46274530039832"/><a data-primary="x argument, Python" data-type="indexterm" id="idm46274530039160"/>levels of <em>classk</em> along the x-axis we’ll use the <code>x</code> argument. This results in the countplot shown in <a data-type="xref" href="#seaborn-countplot">Figure 12-2</a>:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">22</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">countplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s">'classk'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">star</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="seaborn-countplot">&#13;
<img alt="Countplot" src="assets/aina_1202.png"/>&#13;
<h6><span class="label">Figure 12-2. </span>Countplot</h6>&#13;
</div></figure>&#13;
&#13;
<p>Now for a <a data-primary="histograms" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274530024984"/><a data-primary="displot() function, Python" data-type="indexterm" id="idm46274530023704"/>histogram of <em>treadssk</em>, we’ll use the <code>displot()</code> function. Again, we’ll specify <code>x</code> and <code>data</code>. <a data-type="xref" href="#seaborn-histogram">Figure 12-3</a> shows the result:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">23</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">displot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s">'treadssk'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">star</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="seaborn-histogram">&#13;
<img alt="Histogram" src="assets/aina_1203.png"/>&#13;
<h6><span class="label">Figure 12-3. </span>Histogram</h6>&#13;
</div></figure>&#13;
&#13;
<p><code>seaborn</code> functions include many optional arguments to customize a plot’s appearance. For example, let’s change the number of bins to 25 and the plot color to pink. This results in <a data-type="xref" href="#seaborn-custom-histogram">Figure 12-4</a>:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">24</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">displot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s">'treadssk'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">star</code><code class="p">,</code> <code class="n">bins</code><code class="o">=</code><code class="mi">25</code><code class="p">,</code> <code class="n">color</code><code class="o">=</code><code class="s">'pink'</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="seaborn-custom-histogram">&#13;
<img alt="Custom histogram" src="assets/aina_1204.png"/>&#13;
<h6><span class="label">Figure 12-4. </span>Custom histogram</h6>&#13;
</div></figure>&#13;
&#13;
<p>To make a <a data-primary="boxplots" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="ch12_term18"/><a data-primary="boxplot() function, Python" data-type="indexterm" id="idm46274529877288"/>boxplot, use the <code>boxplot()</code> function as in <a data-type="xref" href="#seaborn-boxplot">Figure 12-5</a>:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">25</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">boxplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s">'treadssk'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">star</code><code class="p">)</code></pre>&#13;
&#13;
<p>In any of these cases so far, we could’ve “flipped” the plot by instead including the <a data-primary="y-axis, mapping" data-type="indexterm" id="idm46274529864856"/><a data-primary="y argument, Python" data-type="indexterm" id="idm46274529864248"/>variable of interest in the <code>y</code> argument. Let’s try it with our boxplot, and we’ll get what’s shown in <a data-type="xref" href="#seaborn-flipped-boxplot">Figure 12-6</a> as output:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">26</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">boxplot</code><code class="p">(</code><code class="n">y</code><code class="o">=</code><code class="s">'treadssk'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">star</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="seaborn-boxplot">&#13;
<img alt="Boxplot" src="assets/aina_1205.png"/>&#13;
<h6><span class="label">Figure 12-5. </span>Boxplot</h6>&#13;
</div></figure>&#13;
&#13;
<figure><div class="figure" id="seaborn-flipped-boxplot">&#13;
<img alt="Boxplot" src="assets/aina_1206.png"/>&#13;
<h6><span class="label">Figure 12-6. </span>“Flipped” boxplot</h6>&#13;
</div></figure>&#13;
&#13;
<p>To make a boxplot for each level of class size, we’ll include an additional argument to <a data-primary="x-axis, mapping" data-type="indexterm" id="idm46274529827288"/>plot <em>classk</em> along the x-axis, giving us the boxplot by group depicted in <a data-type="xref" href="#seaborn-grouped-boxplot">Figure 12-7</a>:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">27</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">boxplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s">'classk'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s">'treadssk'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">star</code><code class="p">)</code></pre>&#13;
&#13;
<figure class="width-80"><div class="figure" id="seaborn-grouped-boxplot">&#13;
<img alt="Grouped boxplot" src="assets/aina_1207.png"/>&#13;
<h6><span class="label">Figure 12-7. </span>Boxplot by group</h6>&#13;
</div></figure>&#13;
&#13;
<p>Now <a data-startref="ch12_term18" data-type="indexterm" id="idm46274529779320"/>let’s <a data-primary="scatterplot() function, Python" data-type="indexterm" id="idm46274529743640"/>use the <code>scatterplot()</code> function to plot the relationship of <em>tmathssk</em> on the x-axis and <em>treadssk</em> on the y. <a data-type="xref" href="#seaborn-scatterplot">Figure 12-8</a> is the result:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">28</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">scatterplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s">'tmathssk'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s">'treadssk'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">star</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="seaborn-scatterplot">&#13;
<img alt="Scatterplot" src="assets/aina_1208.png"/>&#13;
<h6><span class="label">Figure 12-8. </span>Scatterplot</h6>&#13;
</div></figure>&#13;
&#13;
<p class="pagebreak-before less_space">Let’s say we wanted to share this plot with an outside audience, who may not be familiar with what <em>treadssk</em> and <em>tmathssk</em> are. We can add more helpful labels to this chart by borrowing <a data-primary="matplotlib, Python" data-secondary="pyplot submodule of" data-type="indexterm" id="idm46274529724504"/><a data-primary="scatterplots" data-secondary="with Python" data-secondary-sortas="Python" data-type="indexterm" id="idm46274529723528"/><a data-primary="y-axis, mapping" data-type="indexterm" id="idm46274529722312"/>features from <code>matplotlib.pyplot</code>. We’ll run the same <code>scatterplot()</code> function as before, but this time we’ll also call in functions from <code>pyplot</code> to add custom x- and y-axis labels, as well as a chart title. This results in <a data-type="xref" href="#seaborn-labeled-scatterplot">Figure 12-9</a>:</p>&#13;
&#13;
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">29</code><code class="p">]:</code> <code class="n">sns</code><code class="o">.</code><code class="n">scatterplot</code><code class="p">(</code><code class="n">x</code><code class="o">=</code><code class="s">'tmathssk'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s">'treadssk'</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">star</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s">'Math score'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s">'Reading score'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s">'Math score versus reading score'</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="seaborn-labeled-scatterplot">&#13;
<img alt="Scatterplot with custom labels and title" src="assets/aina_1209.png"/>&#13;
<h6><span class="label">Figure 12-9. </span>Scatterplot with custom axis labels and title</h6>&#13;
</div></figure>&#13;
&#13;
<p><code>seaborn</code> includes many more features for building visually appealing data visualizations. To <a data-startref="ch12_term15" data-type="indexterm" id="idm46274529616280"/><a data-startref="ch12_term16" data-type="indexterm" id="idm46274529615576"/><a data-startref="ch12_term17" data-type="indexterm" id="idm46274529614904"/>learn more, check out <a href="https://oreil.ly/2joMU">the official documentation</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conclusion" data-type="sect1"><div class="sect1" id="idm46274530059656">&#13;
<h1>Conclusion</h1>&#13;
&#13;
<p>There’s so much more that <code>pandas</code> and <code>seaborn</code> can do, but this is enough to get you started with the true task at hand: to explore and test relationships in data. That will be the focus of <a data-type="xref" href="ch13.html#python-for-data-analysis-capstone">Chapter 13</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Exercises" data-type="sect1"><div class="sect1" id="idm46274529610216">&#13;
<h1>Exercises</h1>&#13;
&#13;
<p>The <a href="https://oreil.ly/hFEOG">book repository</a> has two <a data-primary="Python programming language" data-secondary="exercises" data-type="indexterm" id="idm46274529607656"/>files in the <em>census</em> subfolder of <em>datasets</em>, <em>census.csv</em> and <em>census-divisions.csv</em>. Read these into Python and do the &#13;
<span class="keep-together">following</span>:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Sort the data by region ascending, division ascending and population descending. (You will need to combine datasets to do this.) Write the results to an Excel worksheet.</p>&#13;
</li>&#13;
<li>&#13;
<p>Drop the postal code field from your merged dataset.</p>&#13;
</li>&#13;
<li>&#13;
<p>Create a new column, <em>density</em>, that is a calculation of population divided by land area.</p>&#13;
</li>&#13;
<li>&#13;
<p>Visualize the relationship between  land area  and  population for all observations in 2015.</p>&#13;
</li>&#13;
<li>&#13;
<p>Find the total population for each region in 2015.</p>&#13;
</li>&#13;
<li>&#13;
<p>Create a table containing state names and populations, with the population for each year 2010–2015 kept in an individual column.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>