<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 20. Visualizing Individual Winners" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter_d3_bios">
<h1><span class="label">Chapter 20. </span>Visualizing Individual Winners</h1>
<p>We want our Nobel Prize visualization (Nobel-viz) to include a list of currently selected winners and a biography box (aka bio-box) to display the details of an individual winner (see <a data-type="xref" href="#d3bio_target">Figure 20-1</a>). <a data-primary="D3 library" data-secondary="visualizing individual Nobel Prize winners" data-type="indexterm" id="ix_D3visNPwin"/>By clicking on a winner in the list, the user can see his or her details in the bio-box. In this chapter, we’ll see how to build the list and bio-box, how to repopulate the list when the user selects new data (with the menu bar filters), and how to make the list clickable.</p>
<figure><div class="figure" id="d3bio_target">
<img alt="dpj2 2001" height="888" src="assets/dpj2_2001.png" width="1438"/>
<h6><span class="label">Figure 20-1. </span>The chapter’s target elements</h6>
</div></figure>
<p>As this chapter will demonstrate, D3 isn’t just for building SVG visualizations. <a data-primary="data binding in D3" data-type="indexterm" id="idm45607738339408"/>You can bind data to any DOM element and use it to change its attributes and properties or its event-handling callback functions.<a data-primary="DOM (Document Object Model)" data-secondary="binding data to elements and changing them in D3" data-type="indexterm" id="idm45607738338576"/><a data-primary="on method (D3)" data-type="indexterm" id="idm45607738337648"/> D3’s data joining and event handling (achieved via the <code>on</code> method) play very well with common user interfaces such as the clickable list of this chapter and selection boxes.<sup><a data-type="noteref" href="ch20.xhtml#idm45607738336336" id="idm45607738336336-marker">1</a></sup></p>
<p>Let’s deal first with the list of winners and how it is built with the dataset of currently selected winners.</p>
<section data-pdf-bookmark="Building the List" data-type="sect1"><div class="sect1" id="idm45607738334304">
<h1>Building the List</h1>
<p>We build our list of winners (see <a data-type="xref" href="#d3bio_target">Figure 20-1</a>) using an HTML table with Year, Category, and Name columns. <a data-primary="lists" data-secondary="building list of Nobel Prize winners for D3 visualization" data-type="indexterm" id="ix_listD3"/><a data-primary="D3 library" data-secondary="visualizing individual Nobel Prize winners" data-tertiary="building a list of winners" data-type="indexterm" id="ix_D3visNPwinlist"/>The basic skeleton of this list is provided in the Nobel-viz’s <em>index.xhtml</em> file:</p>
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="p">&lt;</code><code class="nt">meta</code> <code class="na">charset</code><code class="o">=</code><code class="s">"utf-8"</code><code class="p">&gt;</code>
<code class="p">&lt;</code><code class="nt">body</code><code class="p">&gt;</code>
...
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"nobel-list"</code><code class="p">&gt;</code>
      <code class="p">&lt;</code><code class="nt">h2</code><code class="p">&gt;</code>Selected winners<code class="p">&lt;/</code><code class="nt">h2</code><code class="p">&gt;</code>
      <code class="p">&lt;</code><code class="nt">table</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">thead</code><code class="p">&gt;</code>
          <code class="p">&lt;</code><code class="nt">tr</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">th</code> <code class="na">id</code><code class="o">=</code><code class="s">'year'</code><code class="p">&gt;</code>Year<code class="p">&lt;/</code><code class="nt">th</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">th</code> <code class="na">id</code><code class="o">=</code><code class="s">'category'</code><code class="p">&gt;</code>Category<code class="p">&lt;/</code><code class="nt">th</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">th</code> <code class="na">id</code><code class="o">=</code><code class="s">'name'</code><code class="p">&gt;</code>Name<code class="p">&lt;/</code><code class="nt">th</code><code class="p">&gt;</code>
          <code class="p">&lt;/</code><code class="nt">tr</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">thead</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">tbody</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">tbody</code><code class="p">&gt;</code>
      <code class="p">&lt;/</code><code class="nt">table</code><code class="p">&gt;</code>
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
...
<code class="p">&lt;/</code><code class="nt">body</code><code class="p">&gt;</code></pre>
<p>We’ll use a <a data-primary="CSS" data-secondary="styling selected winners table for D3 visualization" data-type="indexterm" id="idm45607738306256"/>little CSS in <em>style.css</em> to style this table, adjusting the width of the columns and their font size:</p>
<pre data-code-language="css" data-type="programlisting"><code class="c">/* WINNERS LIST */</code><code>
</code><code class="nf">#nobel-list</code><code> </code><code class="p">{</code><code> </code><code class="k">overflow</code><code class="o">:</code><code> </code><code class="nb">scroll</code><code class="p">;</code><code> </code><code class="k">overflow-x</code><code class="o">:</code><code> </code><code class="nb">hidden</code><code class="p">;</code><code> </code><code class="p">}</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO1-1" id="co_visualizing_individual_winners_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>

</code><code class="nf">#nobel-list</code><code> </code><code class="nt">table</code><code class="p">{</code><code> </code><code class="k">font-size</code><code class="o">:</code><code> </code><code class="m">10px</code><code class="p">;</code><code> </code><code class="p">}</code><code>
</code><code class="nf">#nobel-list</code><code> </code><code class="nt">table</code><code> </code><code class="nt">th</code><code class="nf">#year</code><code> </code><code class="p">{</code><code> </code><code class="k">width</code><code class="o">:</code><code> </code><code class="m">30px</code><code> </code><code class="p">}</code><code>
</code><code class="nf">#nobel-list</code><code> </code><code class="nt">table</code><code> </code><code class="nt">th</code><code class="nf">#category</code><code> </code><code class="p">{</code><code> </code><code class="k">width</code><code class="o">:</code><code> </code><code class="m">120px</code><code> </code><code class="p">}</code><code>
</code><code class="nf">#nobel-list</code><code> </code><code class="nt">table</code><code> </code><code class="nt">th</code><code class="nf">#name</code><code> </code><code class="p">{</code><code> </code><code class="k">width</code><code class="o">:</code><code> </code><code class="m">120px</code><code> </code><code class="p">}</code><code>

</code><code class="nf">#nobel-list</code><code> </code><code class="nt">h2</code><code> </code><code class="p">{</code><code> </code><code class="k">font-size</code><code class="o">:</code><code> </code><code class="m">14px</code><code class="p">;</code><code> </code><code class="k">margin</code><code class="o">:</code><code> </code><code class="m">4px</code><code class="p">;</code><code>
</code><code class="k">text-align</code><code class="o">:</code><code> </code><code class="nb">center</code><code> </code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_visualizing_individual_winners_CO1-1" id="callout_visualizing_individual_winners_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p><code>overflow: scroll</code> clips the content of the list (keeping it within our <code>nobel-list</code> container) and adds a scroll bar so we can access all the winners. <code>overflow-x: hidden</code> inhibits the addition of a horizontal scroll bar.</p></dd>
</dl>
<p>In order to create the list, we will add <code>&lt;tr&gt;</code> row elements (containing a <code>&lt;td&gt;</code> data tag for each column) to the table’s <code>&lt;tbody&gt;</code> element for each winner in the current dataset, producing something like this:</p>
<pre data-code-language="html" data-type="programlisting">        ...
        <code class="p">&lt;</code><code class="nt">tbody</code><code class="p">&gt;</code>
          <code class="p">&lt;</code><code class="nt">tr</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">td</code><code class="p">&gt;</code>2014<code class="p">&lt;/</code><code class="nt">td</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">td</code><code class="p">&gt;</code>Chemistry<code class="p">&lt;/</code><code class="nt">td</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">td</code><code class="p">&gt;</code>Eric Betzig<code class="p">&lt;/</code><code class="nt">td</code><code class="p">&gt;</code>
          <code class="p">&lt;/</code><code class="nt">tr</code><code class="p">&gt;</code>
          ...
        <code class="p">&lt;/</code><code class="nt">tbody</code><code class="p">&gt;</code>
        ...</pre>
<p>To create these rows, an <code>updateList</code> method will be <a data-primary="updateList method (D3)" data-type="indexterm" id="idm45607737612400"/><a data-primary="onDataChange method (JavaScript)" data-type="indexterm" id="idm45607737611792"/>called by our central  <code>onDataChange</code> when the app is initialized and subsequently when the user applies a data filter and the list of winners changes (see <a data-type="xref" href="ch16.xhtml#d3build_sect_components">“Basic Data Flow”</a>). The data received by <code>updateList</code> will have the following structure:</p>
<pre data-code-language="js" data-type="programlisting"><code class="c1">// data =</code>
<code class="p">[{</code>
  <code class="nx">name</code><code class="o">:</code><code class="s2">"C\u00e9sar Milstein"</code><code class="p">,</code>
  <code class="nx">category</code><code class="o">:</code><code class="s2">"Physiology or Medicine"</code><code class="p">,</code>
  <code class="nx">gender</code><code class="o">:</code><code class="s2">"male"</code><code class="p">,</code>
  <code class="nx">country</code><code class="o">:</code><code class="s2">"Argentina"</code><code class="p">,</code>
  <code class="nx">year</code><code class="o">:</code> <code class="mi">1984</code>
  <code class="nx">_id</code><code class="o">:</code> <code class="s2">"5693be6c26a7113f2cc0b3f4"</code>
 <code class="p">},</code>
 <code class="p">...</code>
<code class="p">]</code></pre>
<p><a data-type="xref" href="#d3bio_list_code">Example 20-1</a> shows the <code>updateList</code> method. The data received is first sorted by year and then, after any existing rows have been removed, used to build the table rows.</p>
<div data-type="example" id="d3bio_list_code">
<h5><span class="label">Example 20-1. </span>Building the selected winners list</h5>
<pre data-code-language="js" data-type="programlisting"><code class="kd">let</code><code> </code><code class="nx">updateList</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code> </code><code class="p">(</code><code class="nx">data</code><code class="p">)</code><code> </code><code class="p">{</code><code>
  </code><code class="kd">let</code><code> </code><code class="nx">tableBody</code><code class="p">,</code><code> </code><code class="nx">rows</code><code class="p">,</code><code> </code><code class="nx">cells</code><code>
  </code><code class="c1">// Sort the winners' data by year
</code><code>  </code><code class="nx">data</code><code> </code><code class="o">=</code><code> </code><code class="nx">data</code><code class="p">.</code><code class="nx">sort</code><code class="p">(</code><code class="kd">function</code><code> </code><code class="p">(</code><code class="nx">a</code><code class="p">,</code><code> </code><code class="nx">b</code><code class="p">)</code><code> </code><code class="p">{</code><code>
    </code><code class="k">return</code><code> </code><code class="o">+</code><code class="nx">b</code><code class="p">.</code><code class="nx">year</code><code> </code><code class="o">-</code><code> </code><code class="o">+</code><code class="nx">a</code><code class="p">.</code><code class="nx">year</code><code>
  </code><code class="p">}</code><code class="p">)</code><code>
  </code><code class="c1">// select table-body from index.xhtml
</code><code>  </code><code class="nx">tableBody</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#nobel-list tbody'</code><code class="p">)</code><code>
  </code><code class="c1">// create place-holder rows bound to winners' data
</code><code>  </code><code class="nx">rows</code><code> </code><code class="o">=</code><code> </code><code class="nx">tableBody</code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'tr'</code><code class="p">)</code><code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code><code>

  </code><code class="nx">rows</code><code class="p">.</code><code class="nx">join</code><code class="p">(</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO2-1" id="co_visualizing_individual_winners_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
    </code><code class="p">(</code><code class="nx">enter</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="p">{</code><code>
      </code><code class="c1">// create any new rows required
</code><code>      </code><code class="k">return</code><code> </code><code class="nx">enter</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'tr'</code><code class="p">)</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code><code> </code><code class="kd">function</code><code> </code><code class="p">(</code><code class="nx">event</code><code class="p">,</code><code> </code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO2-2" id="co_visualizing_individual_winners_CO2-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
        </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'You clicked a row '</code><code> </code><code class="o">+</code><code> </code><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code class="p">)</code><code>
        </code><code class="nx">displayWinner</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code>
      </code><code class="p">}</code><code class="p">)</code><code>
    </code><code class="p">}</code><code class="p">,</code><code>
    </code><code class="p">(</code><code class="nx">update</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">update</code><code class="p">,</code><code>
    </code><code class="p">(</code><code class="nx">exit</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="p">{</code><code>
      </code><code class="k">return</code><code> </code><code class="nx">exit</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO2-3" id="co_visualizing_individual_winners_CO2-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
        </code><code class="p">.</code><code class="nx">transition</code><code class="p">(</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">duration</code><code class="p">(</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">TRANS_DURATION</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'opacity'</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">remove</code><code class="p">(</code><code class="p">)</code><code>
    </code><code class="p">}</code><code>
  </code><code class="p">)</code><code>

  </code><code class="nx">cells</code><code> </code><code class="o">=</code><code> </code><code class="nx">tableBody</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO2-4" id="co_visualizing_individual_winners_CO2-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a><code>
    </code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'tr'</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'td'</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="kd">function</code><code> </code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
      </code><code class="k">return</code><code> </code><code class="p">[</code><code class="nx">d</code><code class="p">.</code><code class="nx">year</code><code class="p">,</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">category</code><code class="p">,</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">name</code><code class="p">]</code><code>
    </code><code class="p">}</code><code class="p">)</code><code>
  </code><code class="c1">// Append data cells, then set their text
</code><code>  </code><code class="nx">cells</code><code class="p">.</code><code class="nx">join</code><code class="p">(</code><code class="s1">'td'</code><code class="p">)</code><code class="p">.</code><code class="nx">text</code><code class="p">(</code><code class="nx">d</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">d</code><code class="p">)</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO2-5" id="co_visualizing_individual_winners_CO2-5"><img alt="5" height="12" src="assets/5.png" width="12"/></a><code>
  </code><code class="c1">// Display a random winner if data is available
</code><code>  </code><code class="k">if</code><code> </code><code class="p">(</code><code class="nx">data</code><code class="p">.</code><code class="nx">length</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO2-6" id="co_visualizing_individual_winners_CO2-6"><img alt="6" height="12" src="assets/6.png" width="12"/></a><code>
    </code><code class="nx">displayWinner</code><code class="p">(</code><code class="nx">data</code><code class="p">[</code><code class="nb">Math</code><code class="p">.</code><code class="nx">floor</code><code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">random</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="nx">data</code><code class="p">.</code><code class="nx">length</code><code class="p">)</code><code class="p">]</code><code class="p">)</code><code>
  </code><code class="p">}</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_visualizing_individual_winners_CO2-1" id="callout_visualizing_individual_winners_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>A now familiar join pattern, using the bound winners’ data to create and update list items.</p></dd>
<dt><a class="co" href="#co_visualizing_individual_winners_CO2-2" id="callout_visualizing_individual_winners_CO2-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>When the user clicks on a row, this click-handler function will pass the winner data bound to that row to a <code>displayWinner</code> method, which will update the bio-box accordingly.</p></dd>
<dt><a class="co" href="#co_visualizing_individual_winners_CO2-3" id="callout_visualizing_individual_winners_CO2-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>This custom <code>exit</code> function fades out any excess rows over the transition period of two seconds, reducing their opacity to zero before removing them.</p></dd>
<dt><a class="co" href="#co_visualizing_individual_winners_CO2-4" id="callout_visualizing_individual_winners_CO2-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></dt>
<dd><p>First, we use a winner’s data to create an array of data with year, category, and name, which will be used to create the row’s <code>&lt;td&gt;</code> data cells…​</p></dd>
<dt><a class="co" href="#co_visualizing_individual_winners_CO2-5" id="callout_visualizing_individual_winners_CO2-5"><img alt="5" height="12" src="assets/5.png" width="12"/></a></dt>
<dd><p>…​we then join this array to the row’s data cells (<code>td</code>) and use it to set their text.</p></dd>
<dt><a class="co" href="#co_visualizing_individual_winners_CO2-6" id="callout_visualizing_individual_winners_CO2-6"><img alt="6" height="12" src="assets/6.png" width="12"/></a></dt>
<dd><p>Each time the data is changed, we select a winner at random from the new dataset and display him or her in the bio-box.</p></dd>
</dl></div>
<p>As the user moves the cursor over a row in our winners table, we want to highlight the row and also to change the style of pointer to <code>cursor</code> to indicate that the row is clickable. Both of these details are fixed by the following CSS, added to our <em>style.css</em> file:</p>
<pre data-code-language="css" data-type="programlisting"><code class="nf">#nobel-list</code> <code class="nt">tr</code><code class="nd">:hover</code><code class="p">{</code>
    <code class="k">cursor</code><code class="o">:</code> <code class="nb">pointer</code><code class="p">;</code>
    <code class="k">background</code><code class="o">:</code> <code class="nb">lightblue</code><code class="p">;</code>
<code class="p">}</code></pre>
<p>Our <code>updateList</code> method calls a <code>displayWinner</code> method to build a winner’s biography box when a row is clicked or when the data changes (with a random choice). Let’s now see how the bio-box is built.<a data-primary="lists" data-secondary="building list of Nobel Prize winners for D3 visualization" data-startref="ix_listD3" data-type="indexterm" id="idm45607737159632"/><a data-primary="D3 library" data-secondary="visualizing individual Nobel Prize winners" data-startref="ix_D3visNPwinlist" data-tertiary="building a list of winners" data-type="indexterm" id="idm45607737158448"/></p>
</div></section>
<section data-pdf-bookmark="Building the Bio-Box" data-type="sect1"><div class="sect1" id="idm45607738333680">
<h1>Building the Bio-Box</h1>
<p>The bio-box uses a winner’s <a data-primary="bio-box" data-secondary="building for D3 visualization of individual Nobel Prize winners" data-type="indexterm" id="ix_biobox"/><a data-primary="D3 library" data-secondary="visualizing individual Nobel Prize winners" data-tertiary="building the bio-box" data-type="indexterm" id="ix_D3visNPwinbio"/>object to fill in the details of a little mini-biography. <a data-primary="HTML" data-secondary="skeleton for bio-box for Nobel Prize winners in D3 visualization" data-type="indexterm" id="idm45607737126432"/>The bio-box’s HTML skeleton is provided in the <em>index.xhtml</em> file consisting of content blocks for the biographical elements and a <code>readmore</code> footer providing a Wikipedia link to further information on the winner:</p>
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="p">&lt;</code><code class="nt">meta</code> <code class="na">charset</code><code class="o">=</code><code class="s">"utf-8"</code><code class="p">&gt;</code>
<code class="p">&lt;</code><code class="nt">body</code><code class="p">&gt;</code>
...
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"nobel-winner"</code><code class="p">&gt;</code>
      <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"picbox"</code><code class="p">&gt;&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
      <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">'winner-title'</code><code class="p">&gt;&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
      <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">'infobox'</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">'property'</code><code class="p">&gt;</code>
          <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">'label'</code><code class="p">&gt;</code>Category<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
          <code class="p">&lt;</code><code class="nt">span</code> <code class="na">name</code><code class="o">=</code><code class="s">'category'</code><code class="p">&gt;&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">'property'</code><code class="p">&gt;</code>
          <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">'label'</code><code class="p">&gt;</code>Year<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
          <code class="p">&lt;</code><code class="nt">span</code> <code class="na">name</code><code class="o">=</code><code class="s">'year'</code><code class="p">&gt;&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">'property'</code><code class="p">&gt;</code>
          <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">'label'</code><code class="p">&gt;</code>Country<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
          <code class="p">&lt;</code><code class="nt">span</code> <code class="na">name</code><code class="o">=</code><code class="s">'country'</code><code class="p">&gt;&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
      <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
      <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">'biobox'</code><code class="p">&gt;&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
      <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">'readmore'</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">a</code> <code class="na">href</code><code class="o">=</code><code class="s">'#'</code><code class="p">&gt;</code>Read more at Wikipedia<code class="p">&lt;/</code><code class="nt">a</code><code class="p">&gt;&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
...
<code class="p">&lt;/</code><code class="nt">body</code><code class="p">&gt;</code></pre>
<p>A little CSS in <em>style.css</em> sets the positions of the list and bio-box elements, sizes their content blocks, and <a data-primary="CSS" data-secondary="styling winner infobox for D3 visualization of individual Nobel Prize winners" data-type="indexterm" id="idm45607737121552"/>provides borders and font specifics:</p>
<pre data-code-language="css" data-type="programlisting"><code class="c">/* WINNER INFOBOX */</code>

<code class="nf">#nobel-winner</code> <code class="p">{</code>
    <code class="k">font-size</code><code class="o">:</code> <code class="m">11px</code><code class="p">;</code>
    <code class="k">overflow</code><code class="o">:</code> <code class="nb">auto</code><code class="p">;</code>
    <code class="k">overflow-x</code><code class="o">:</code> <code class="nb">hidden</code><code class="p">;</code>
    <code class="k">border-top</code><code class="o">:</code> <code class="m">4px</code> <code class="nb">solid</code><code class="p">;</code>
<code class="p">}</code>

<code class="nf">#nobel-winner</code> <code class="nf">#winner-title</code> <code class="p">{</code>
    <code class="k">font-size</code><code class="o">:</code> <code class="m">12px</code><code class="p">;</code>
    <code class="k">text-align</code><code class="o">:</code> <code class="nb">center</code><code class="p">;</code>
    <code class="k">padding</code><code class="o">:</code> <code class="m">2px</code><code class="p">;</code>
    <code class="k">font-weight</code><code class="o">:</code> <code class="nb">bold</code><code class="p">;</code>
<code class="p">}</code>

<code class="nf">#nobel-winner</code> <code class="nf">#infobox</code> <code class="nc">.label</code> <code class="p">{</code>
    <code class="k">display</code><code class="o">:</code> <code class="nb">inline-block</code><code class="p">;</code>
    <code class="k">width</code><code class="o">:</code> <code class="m">60px</code><code class="p">;</code>
    <code class="k">font-weight</code><code class="o">:</code> <code class="nb">bold</code><code class="p">;</code>
<code class="p">}</code>

<code class="nf">#nobel-winner</code> <code class="nf">#biobox</code> <code class="p">{</code> <code class="k">font-size</code><code class="o">:</code> <code class="m">11px</code><code class="p">;</code> <code class="p">}</code>
<code class="nf">#nobel-winner</code> <code class="nf">#biobox</code> <code class="nt">p</code> <code class="p">{</code> <code class="k">text-align</code><code class="o">:</code> <code class="nb">justify</code><code class="p">;</code> <code class="p">}</code>

<code class="nf">#nobel-winner</code> <code class="nf">#picbox</code> <code class="p">{</code>
    <code class="k">float</code><code class="o">:</code> <code class="nb">right</code><code class="p">;</code>
    <code class="k">margin-left</code><code class="o">:</code> <code class="m">5px</code><code class="p">;</code>
<code class="p">}</code>
<code class="nf">#nobel-winner</code> <code class="nf">#picbox</code> <code class="nt">img</code> <code class="p">{</code> <code class="k">width</code><code class="o">:</code><code class="m">100px</code><code class="p">;</code> <code class="p">}</code>

<code class="nf">#nobel-winner</code> <code class="nf">#readmore</code> <code class="p">{</code>
    <code class="k">font-weight</code><code class="o">:</code> <code class="nb">bold</code><code class="p">;</code>
    <code class="k">text-align</code><code class="o">:</code> <code class="nb">center</code><code class="p">;</code>
<code class="p">}</code></pre>
<p>With our content blocks in place, we need to make a callback to our data API to get the data needed to fill them. <a data-type="xref" href="#d3bio_winner_code">Example 20-2</a> shows the <code>displayWinner</code> method used to build the box.</p>
<div class="pagebreak-before less_space" data-type="example" id="d3bio_winner_code">
<h5><span class="label">Example 20-2. </span>Updating a selected winner’s biography box</h5>
<pre data-code-language="js" data-type="programlisting"><code class="kd">let</code><code> </code><code class="nx">displayWinner</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code> </code><code class="p">(</code><code class="nx">wData</code><code class="p">)</code><code> </code><code class="p">{</code><code>
  </code><code class="c1">// store the winner's bio-box element
</code><code>  </code><code class="kd">let</code><code> </code><code class="nx">nw</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#nobel-winner'</code><code class="p">)</code><code>

  </code><code class="nx">nw</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#winner-title'</code><code class="p">)</code><code class="p">.</code><code class="nx">text</code><code class="p">(</code><code class="nx">wData</code><code class="p">.</code><code class="nx">name</code><code class="p">)</code><code>
  </code><code class="nx">nw</code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'border-color'</code><code class="p">,</code><code> </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">categoryFill</code><code class="p">(</code><code class="nx">wData</code><code class="p">.</code><code class="nx">category</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO3-1" id="co_visualizing_individual_winners_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>

  </code><code class="nx">nw</code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'.property span'</code><code class="p">)</code><code class="p">.</code><code class="nx">text</code><code class="p">(</code><code class="kd">function</code><code> </code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO3-2" id="co_visualizing_individual_winners_CO3-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
    </code><code class="kd">var</code><code> </code><code class="nx">property</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'name'</code><code class="p">)</code><code>
    </code><code class="k">return</code><code> </code><code class="nx">wData</code><code class="p">[</code><code class="nx">property</code><code class="p">]</code><code>
  </code><code class="p">}</code><code class="p">)</code><code>

  </code><code class="nx">nw</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#biobox'</code><code class="p">)</code><code class="p">.</code><code class="nx">html</code><code class="p">(</code><code class="nx">wData</code><code class="p">.</code><code class="nx">mini_bio</code><code class="p">)</code><code>
  </code><code class="c1">// Add an image if available, otherwise remove the old one
</code><code>  </code><code class="k">if</code><code> </code><code class="p">(</code><code class="nx">wData</code><code class="p">.</code><code class="nx">bio_image</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO3-3" id="co_visualizing_individual_winners_CO3-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
    </code><code class="nx">nw</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#picbox img'</code><code class="p">)</code><code>
      </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'src'</code><code class="p">,</code><code> </code><code class="s1">'static/images/winners/'</code><code> </code><code class="o">+</code><code> </code><code class="nx">wData</code><code class="p">.</code><code class="nx">bio_image</code><code class="p">)</code><code>
      </code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'display'</code><code class="p">,</code><code> </code><code class="s1">'inline'</code><code class="p">)</code><code>
  </code><code class="p">}</code><code> </code><code class="k">else</code><code> </code><code class="p">{</code><code>
    </code><code class="nx">nw</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#picbox img'</code><code class="p">)</code><code class="p">.</code><code class="nx">style</code><code class="p">(</code><code class="s1">'display'</code><code class="p">,</code><code> </code><code class="s1">'none'</code><code class="p">)</code><code>
  </code><code class="p">}</code><code>

  </code><code class="nx">nw</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#readmore a'</code><code class="p">)</code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO3-4" id="co_visualizing_individual_winners_CO3-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a><code>
    </code><code class="s1">'href'</code><code class="p">,</code><code>
    </code><code class="s1">'http://en.wikipedia.org/wiki/'</code><code> </code><code class="o">+</code><code> </code><code class="nx">wData</code><code class="p">.</code><code class="nx">name</code><code>
  </code><code class="p">)</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_visualizing_individual_winners_CO3-1" id="callout_visualizing_individual_winners_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Our <code>nobel-winner</code> element has a top border (CSS: <code>border-top: 4px solid</code>), which we will color according to the winner’s category, using the <code>categoryFill</code> method defined in <em>nbviz_core.js</em>.</p></dd>
<dt><a class="co" href="#co_visualizing_individual_winners_CO3-2" id="callout_visualizing_individual_winners_CO3-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We select the <code>&lt;span&gt;</code> tags of all the divs with class <code>property</code>.  These are of the form <code>&lt;span name=<em>category</em>&gt;&lt;/span&gt;</code>. We use the span’s <code>name</code> attribute to retrieve the correct property from our Nobel winner’s data and use it to set the tag’s text.</p></dd>
<dt><a class="co" href="#co_visualizing_individual_winners_CO3-3" id="callout_visualizing_individual_winners_CO3-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Here we set the <code>src</code> (source) attribute on our winner’s image if one is available. We use the image tag’s <code>display</code> attribute to hide it (setting it to <code>none</code>) if no image is available or show it (the default <code>inline</code>) if one is.</p></dd>
<dt><a class="co" href="#co_visualizing_individual_winners_CO3-4" id="callout_visualizing_individual_winners_CO3-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></dt>
<dd><p>Our winner’s name was scraped from Wikipedia and can be used to retrieve their Wikipedia page.</p></dd>
</dl></div>
<section data-pdf-bookmark="Updating the Winners List" data-type="sect2"><div class="sect2" id="idm45607736500064">
<h2>Updating the Winners List</h2>
<p>When the details (winners list and bio) module is imported, it appends a callback function to the callbacks array in the core module.<a data-primary="lists" data-secondary="updating Nobel Prize winners list in D3 visualization" data-type="indexterm" id="idm45607736498656"/><a data-primary="updates" data-secondary="updating Nobel Prize winners list in D3 visualization" data-type="indexterm" id="idm45607736497712"/> When data is updated in response to user interaction, this callback function is called and the list updated with new country data, using Crossfilter’s country dimension:</p>
<pre data-code-language="js" data-type="programlisting"><code class="nx">nbviz</code><code class="p">.</code><code class="nx">callbacks</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_visualizing_individual_winners_CO4-1" id="co_visualizing_individual_winners_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
  </code><code class="kd">let</code><code> </code><code class="nx">data</code><code> </code><code class="o">=</code><code> </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">countryDim</code><code class="p">.</code><code class="nx">top</code><code class="p">(</code><code class="kc">Infinity</code><code class="p">)</code><code>
  </code><code class="nx">updateList</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code><code>
</code><code class="p">}</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_visualizing_individual_winners_CO4-1" id="callout_visualizing_individual_winners_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>This anonymous function is called in the core module when data is updated.</p></dd>
</dl>
<p>Now that we’ve seen how we add a bit of personality to our Nobel-viz by allowing users to display a winner’s biography, let’s summarize this chapter before moving on to see how the menu bar is built.<a data-primary="bio-box" data-secondary="building for D3 visualization of individual Nobel Prize winners" data-startref="ix_biobox" data-type="indexterm" id="idm45607736467568"/><a data-primary="D3 library" data-secondary="visualizing individual Nobel Prize winners" data-startref="ix_D3visNPwinbio" data-tertiary="building the bio-box" data-type="indexterm" id="idm45607736466352"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45607736464768">
<h1>Summary</h1>
<p>In this chapter, we saw how D3 can be used to build conventional HTML constructions, not just SVG graphics. D3 is just as at home building lists, tables, and the like as it is displaying circles or changing the rotation of a line. Wherever there is changing data that needs to be reflected by elements of a web page, D3 is likely able to solve the problem elegantly and efficiently.</p>
<p>With our winners list and biography box covered, we’ve seen how all the visual elements in our Nobel-viz are built. It only remains to see how the visualization’s menu bar is built and how the changes it enables, to both the dataset and the measure of prizes, are reflected by these visual elements.<a data-primary="D3 library" data-secondary="visualizing individual Nobel Prize winners" data-startref="ix_D3visNPwin" data-type="indexterm" id="idm45607736463056"/></p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45607738336336"><sup><a href="ch20.xhtml#idm45607738336336-marker">1</a></sup> We’ll cover selection boxes (as data filters) in <a data-type="xref" href="ch21.xhtml#chapter_d3_ui">Chapter 21</a>.</p></div></div></section></div></body></html>