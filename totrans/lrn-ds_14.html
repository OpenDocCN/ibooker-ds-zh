<html><head></head><body><section data-pdf-bookmark="Chapter 11. Data Visualization" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch-viz">&#13;
<h1><span class="label">Chapter 11. </span>Data Visualization</h1>&#13;
&#13;
<p>As data scientists<a contenteditable="false" data-primary="visualization, data" data-type="indexterm" id="ix_vis_data_ch11"/>, we create data visualizations in order to understand our data and explain our analyses to other people. A plot should have a message, and it’s our job to communicate this message as clearly as possible.</p>&#13;
&#13;
<p>In <a class="reference internal" data-type="xref" href="ch10.html#ch-eda">Chapter 10</a>, we connected<a contenteditable="false" data-primary="plotly library" data-type="indexterm" id="id1306"/> the choice of a statistical graph to the kind of data being plotted; we also introduced many standard plots and showed how to read them. In this chapter, we discuss the principles of effective data visualization that make it easier for our audience to grasp the message in our plot. We talk about how to choose scales for axes, handle large amounts of data with smoothing and aggregation, facilitate meaningful comparisons, incorporate study design, and add contextual information. We also show how to create plots using <code>plotly</code>, a popular package for plotting in Python.</p>&#13;
&#13;
<p>One tricky part about writing a chapter on data visualization is that software packages for visualization change all the time, so any code we display can quickly get out of date. Because of this, some books avoid code entirely. We instead strike a balance, where we cover high-level data visualization principles that are broadly useful. Then we separately include practical plotting code to implement these principles. When new software becomes available, readers can still use our principles to guide the creation of their visualizations.</p>&#13;
&#13;
<section data-pdf-bookmark="Choosing Scale to Reveal Structure" data-type="sect1"><div class="sect1" id="ch-viz-scale">&#13;
<h1>Choosing Scale to Reveal Structure</h1>&#13;
&#13;
<p>In <a class="reference internal" data-type="xref" href="ch10.html#ch-eda">Chapter 10</a>, we explored prices<a contenteditable="false" data-primary="visualization, data" data-secondary="choosing scale to reveal structure" data-type="indexterm" id="ix_vis_struct_scale"/> for houses sold in the San Francisco Bay Area between 2003 and 2009. Let’s revisit that example and take a look at a histogram of sale prices:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">histogram</code></span><span><code class="p">(</code></span><span><code class="n">sfh</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">nbins</code></span><span><code class="o">=</code></span><span><code class="mi">100</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>             </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s2">"</code><code class="s2">Sale price (USD)</code><code class="s2">"</code></span><span><code class="p">}</code><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_11in01.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>While this plot accurately displays the data, most of the visible bins are crammed into the left side of the plot. This makes it hard to understand the distribution of prices.</p>&#13;
&#13;
<p>Through data visualization, we want to reveal important features of the data, like the shape of a distribution and the relationship between two or more features. As this example shows, after we produce an initial plot, there are still other aspects we need to consider. In this section, we cover <em>principles of scale</em> that help us decide how to adjust the axis limits, place tick marks, and apply transformations. We begin by examining when and how we might adjust a plot to reduce empty space; in other words, we try to fill the data region of our plot with data.</p>&#13;
&#13;
<section data-pdf-bookmark="Filling the Data Region" data-type="sect2"><div class="sect2" id="filling-the-data-region">&#13;
<h2>Filling the Data Region</h2>&#13;
&#13;
<p>As we can see from the histogram<a contenteditable="false" data-primary="scale principles in visualization" data-secondary="filling data region" data-type="indexterm" id="id1307"/><a contenteditable="false" data-primary="filling data region, visualization" data-type="indexterm" id="id1308"/> of sale prices, it’s hard to read a distribution when most of the data appear in a small portion of the plotting region. When this happens, important features of the data, like multiple modes and skewness, can be obscured. A similar issue happens for scatterplots. When all the points are bunched together in the corner of a scatterplot, it’s hard to see the shape of the distribution and therefore glean any insights the shape would impart.</p>&#13;
&#13;
<p>This issue<a contenteditable="false" data-primary="outliers" data-secondary="removing to fill data region" data-type="indexterm" id="id1309"/> can crop up when there are a few unusually large observations. In order to get a better view of the main portion of the data, we can drop those observations from the plot by adjusting the x- or y-axis limits, or we can remove the outlier values from the data before plotting. In either case, we mention this exclusion in the caption or on the plot itself.</p>&#13;
&#13;
<p>Let’s use this idea to improve the histogram of sale<a contenteditable="false" data-primary="home sale prices example" data-secondary="scaling data" data-type="indexterm" id="id1310"/> prices. In the side-by-side plots that follow, we clip the data by changing the limits of the x-axis. On the left, we’ve excluded houses that cost over $2 million. The shape of the distribution for the bulk of the houses is much clearer in this plot. For instance, we can more easily observe the skewness and a smaller secondary mode. On the right, we separately show detail in the long right tail of the distribution (see it larger <a href="https://oreil.ly/lVDrE">online</a>):</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in02.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Notice that the x-axis in the left plot includes 0, but the x-axis in the right plot begins at $2M. We consider when to include or exclude 0 on an axis next.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Including Zero" data-type="sect2"><div class="sect2" id="including-zero">&#13;
<h2>Including Zero</h2>&#13;
&#13;
<p>We often don’t need<a contenteditable="false" data-primary="zero, including, to reveal structure" data-type="indexterm" id="ix_zero_inc"/><a contenteditable="false" data-primary="scale principles in visualization" data-secondary="zero, including" data-type="indexterm" id="ix_scale_prin_zero"/><a contenteditable="false" data-primary="axes in plots, adjusting" data-type="indexterm" id="ix_axes_adj"/><a contenteditable="false" data-primary="dog breeds dataset" data-secondary="and including zero on plot axis" data-secondary-sortas="including zero on plot axis" data-type="indexterm" id="id1311"/> to include 0 on an axis, especially if including it makes it difficult to fill the data region. For example, let’s make a scatterplot of average longevity plotted against average height for dog breeds. (This dataset was first introduced in <a class="reference internal" data-type="xref" href="ch10.html#ch-eda">Chapter 10</a>; it includes several features for 172 breeds.)</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in03.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The x-axis of the plot on the left starts at 10 cm since all dogs are at least that tall, and similarly, the y-axis begins at 6 years. The scatterplot on the right includes 0 on both axes. This pushes the data up to the top of the data region and leaves empty space that doesn’t help us see the linear relationship.</p>&#13;
&#13;
<p>There are some cases where we usually want to include 0. For bar charts, including 0 is important so that the heights of the bars directly relate to the data values. As an example, we’ve created two bar charts that compare the longevity of dog breeds. The left plot includes 0, but the right plot doesn’t:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in04.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>It’s easy to incorrectly conclude from the right plot that small breeds live twice as long as large breeds.</p>&#13;
&#13;
<p>We also typically<a contenteditable="false" data-primary="probability" data-secondary=" modeling" data-type="indexterm" id="id1312"/><a contenteditable="false" data-primary="proportions, modeling" data-type="indexterm" id="id1313"/> want to include 0 when working with proportions, since proportions range from 0 to 1. The following plot shows the proportion of breeds in each type:</p>&#13;
&#13;
<figure class="informal width-50"><div class="figure"><img src="assets/leds_11in05.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>In both the bar and dot plots, including 0 makes it easier for you to accurately compare the relative sizes of the categories.</p>&#13;
&#13;
<p>Earlier, when we adjusted axes, we essentially dropped data from our plotting region. While this is a useful strategy when a handful of observations are unusually large (or small), it is less effective with skewed distributions. In this situation, we often need to transform the data to gain a better view of its shape<a contenteditable="false" data-primary="" data-startref="ix_zero_inc" data-type="indexterm" id="id1314"/><a contenteditable="false" data-primary="" data-startref="ix_scale_prin_zero" data-type="indexterm" id="id1315"/><a contenteditable="false" data-primary="" data-startref="ix_axes_adj" data-type="indexterm" id="id1316"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Revealing Shape Through Transformations" data-type="sect2"><div class="sect2" id="revealing-shape-through-transformations">&#13;
<h2>Revealing Shape Through Transformations</h2>&#13;
&#13;
<p>Another common<a contenteditable="false" data-primary="transformations" data-secondary="revealing shape through" data-type="indexterm" id="ix_transf_shape"/><a contenteditable="false" data-primary="scale principles in visualization" data-secondary="revealing shape through transformations" data-type="indexterm" id="ix_scale_prin_shape"/><a contenteditable="false" data-primary="shape of data table" data-secondary="revealing through scale choice" data-type="indexterm" id="ix_shape_scale"/><a contenteditable="false" data-primary="log scale, transforming axis to" data-type="indexterm" id="ix_log_scale_axis"/><a contenteditable="false" data-primary="home sale prices example" data-secondary="log scaling" data-type="indexterm" id="ix_home_price_set_log"/><a contenteditable="false" data-primary="logarithm transformation" data-secondary="for revealing shape" data-secondary-sortas="revealing shape" data-type="indexterm" id="id1317"/><a contenteditable="false" data-primary="transformations" data-secondary="logarithm (log)" data-type="indexterm" id="id1318"/> way to adjust scale is to transform the data or the plot’s axes. We use transformations for skewed data so that it is easier to inspect the distribution. And when the transformation produces a symmetric distribution, the symmetry carries with it useful properties for modeling (see <a class="reference internal" data-type="xref" href="ch15.html#ch-linear">Chapter 15</a>).</p>&#13;
&#13;
<p>There are multiple ways to transform data, but the log transformation tends to be especially useful. For instance, in the following charts we reproduced two histograms of San Francisco house sale prices. The top histogram is the original data. For the histogram below, we took the log (base 10) of the prices before plotting:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in06.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The log transformation makes the distribution of prices more symmetric. Now we can more easily see important features of the distribution, like the mode at around <span class="math notranslate nohighlight"><math> <msup> <mn>10</mn> <mrow> <mn>5.85</mn> </mrow> </msup> </math></span>, which is about 700,000, and the secondary mode near <span class="math notranslate nohighlight"><math> <msup> <mn>10</mn> <mrow> <mn>5.55</mn> </mrow> </msup> </math></span>, or 350,000.</p>&#13;
&#13;
<p>The downside of using the log transform is that the actual values aren’t as intuitive—in this example, we needed to convert the values back to dollars to understand the sale price. Therefore, we often favor transforming the axis to a log scale, rather than the data. This way, we can see the original values on the axis:</p>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_11in07.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>This histogram with its log-scaled x-axis essentially shows the same shape as the histogram of the transformed data. But since the axis is displayed in the original units, we can directly read off the location of the modes in dollars. Note that the bins get narrower to the right because the bin widths are equal on the USD scale but plotted on the log USD scale. Also note that <span class="math notranslate nohighlight"><math> <mi>μ</mi> </math></span> on the y-axis is <span class="math notranslate nohighlight"><math> <msup> <mn>10</mn> <mrow> <mo>−</mo> <mn>6</mn> </mrow> </msup> </math></span>.</p>&#13;
&#13;
<p>The log transform can also reveal shape in scatterplots. Here, we’ve plotted building size on the x-axis and lot size on the y-axis. It’s hard to see the shape in this plot since many of the points are crammed along the bottom of the data region:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in08.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p class="pagebreak-before less_space">However, when we use a log scale for both the x- and y-axes, the shape of the relationship is much easier to see:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">scatter</code></span><span><code class="p">(</code></span><span><code class="n">sfh</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">bsqft</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">lsqft</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>           </code><span><code class="n">log_x</code></span><span><code class="o">=</code></span><span><code class="kc">True</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">log_y</code></span><span><code class="o">=</code></span><span><code class="kc">True</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>           </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s2">"</code><code class="s2">bsqft</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">Building size (sq ft)</code><code class="s2">"</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                   </code><span><code class="s2">"</code><code class="s2">lsqft</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">Lot size (sq ft)</code><code class="s2">"</code></span><span><code class="p">}</code><code class="p">,</code></span><code>&#13;
</code><code>           </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-65"><div class="figure"><img src="assets/leds_11in09.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>With the transformed axes, we can see that the lot size increases roughly linearly with building size (on the log scale). The log transformation pulls large values—values that are orders of magnitude larger than others—in toward the center. This transformation can help fill the data region and uncover hidden structure, as we saw for both the distribution of house price and the relationship between house size and lot size.</p>&#13;
&#13;
<p>In addition<a contenteditable="false" data-primary="aspect ratio of plot, adjusting" data-type="indexterm" id="id1319"/> to setting the limits of an axis and transforming an axis, we also want to consider the aspect ratio of the plot—the length compared to the width. Adjusting the aspect ratio is called <em>banking</em>, and in the next section, we show how banking can help reveal relationships between features<a contenteditable="false" data-primary="" data-startref="ix_shape_scale" data-type="indexterm" id="id1320"/><a contenteditable="false" data-primary="" data-startref="ix_transf_shape" data-type="indexterm" id="id1321"/><a contenteditable="false" data-primary="" data-startref="ix_log_scale_axis" data-type="indexterm" id="id1322"/><a contenteditable="false" data-primary="" data-startref="ix_scale_prin_shape" data-type="indexterm" id="id1323"/><a contenteditable="false" data-primary="" data-startref="ix_home_price_set_log" data-type="indexterm" id="id1324"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Banking to Decipher Relationships" data-type="sect2"><div class="sect2" id="banking-to-decipher-relationships">&#13;
<h2>Banking to Decipher Relationships</h2>&#13;
&#13;
<p>With scatterplots<a contenteditable="false" data-primary="dog breeds dataset" data-secondary="revealing data relationships" data-type="indexterm" id="ix_dog_breeds_data_rel"/><a contenteditable="false" data-primary="banking to decipher relationships" data-type="indexterm" id="id1325"/><a contenteditable="false" data-primary="scale principles in visualization" data-secondary="banking to decipher relationships" data-type="indexterm" id="id1326"/>, we try to choose scales so that the relationship between the two features roughly follows a 45-degree line. This scaling is called <em>banking to 45 degrees</em>. It makes it easier to see shape and trends because our eyes can more easily pick up deviations from a line this way. As an example of this, we’ve reproduced the plot that shows longevity of dog breeds against height:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">scatter</code></span><span><code class="p">(</code></span><span><code class="n">dogs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">height</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">longevity</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">300</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>           </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s2">"</code><code class="s2">height</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">Height (cm)</code><code class="s2">"</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                   </code><span><code class="s2">"</code><code class="s2">longevity</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">Typical lifespan (yr)</code><code class="s2">"</code></span><span><code class="p">}</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-55"><div class="figure"><img src="assets/leds_11in10.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The scatterplot has been banked to 45 degrees, and we can more easily see how the data roughly follow a line and where they deviate a bit at the extremes.</p>&#13;
&#13;
<p>While banking to 45 degrees helps us see whether or not the data follow a linear relationship, when there is clear curvature it can be hard to figure out the form of the relationship. When this happens, we try transformations that will get the data to fall along a straight line (see, for example, <a class="reference internal" data-type="xref" href="#example-transforms">Figure 11-1</a>). The log transformation can be useful in uncovering the general form of curvilinear relationships.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Revealing Relationships Through Straightening" data-type="sect2"><div class="sect2" id="revealing-relationships-through-straightening">&#13;
<h2>Revealing Relationships Through Straightening</h2>&#13;
&#13;
<p>We often use scatter<a contenteditable="false" data-primary="variables and variable types" data-secondary="straightening to reveal relationships" data-type="indexterm" id="ix_var_str_rel_ch11"/><a contenteditable="false" data-primary="scale principles in visualization" data-secondary="straightening to reveal relationships" data-type="indexterm" id="ix_scale_prin_straight"/><a contenteditable="false" data-primary="straightening to reveal relationships" data-type="indexterm" id="ix_str_rel_ch11"/> plots to look at the relationship between two features. For instance, here we’ve plotted height against weight for the dog breeds:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">scatter</code></span><span><code class="p">(</code></span><span><code class="n">dogs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">height</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">weight</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>           </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s2">"</code><code class="s2">height</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">Height (cm)</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="s2">"</code><code class="s2">weight</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">Weight (lb)</code><code class="s2">"</code></span><span><code class="p">}</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in11.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>We see that taller dogs weigh more, but this relationship isn’t linear.</p>&#13;
&#13;
<p>When it looks like two variables have a nonlinear relationship, it’s useful to try applying a log scale to the x-axis, y-axis, or both. Let’s look for a linear relationship in the scatterplot with transformed axes. Here we re-created the plot of weight by height for dog breeds, but this time we applied a log scale to the y-axis:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">scatter</code></span><span><code class="p">(</code></span><span><code class="n">dogs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">height</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">weight</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">log_y</code></span><span><code class="o">=</code></span><span><code class="kc">True</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>           </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s2">"</code><code class="s2">height</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">Height (cm)</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="s2">"</code><code class="s2">weight</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">Weight (lb)</code><code class="s2">"</code></span><span><code class="p">}</code><code class="p">,</code></span><code>&#13;
</code><code>           </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">300</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">300</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in12.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>This plot shows a roughly linear relationship, and in this case, we say that there’s a log–linear relationship<a contenteditable="false" data-primary="logarithm transformation" data-secondary="for revealing relationships" data-secondary-sortas="revealing relationships" data-type="indexterm" id="id1327"/><a contenteditable="false" data-primary="transformations" data-secondary="logarithm (log)" data-type="indexterm" id="id1328"/> between dog weight and height.</p>&#13;
&#13;
<p>In general, when we see a linear relationship after transforming one or both axes, we can use <a class="reference internal" data-type="xref" href="#tab-transform-rels">Table 11-1</a> to reveal what relationship the original variables have (in the table, a and b are constants). We make these transformations because it is easier for us to see if points fall along a line than to see if they follow a power law compared to an exponential.</p>&#13;
&#13;
<table class="pagebreak-before less_space" id="tab-transform-rels">&#13;
	<caption><span class="label">Table 11-1. </span><span>Relationships between two variables when transformations are applied</span></caption>&#13;
	<thead>&#13;
		<tr>&#13;
			<th class="text-left head">x-axis</th>&#13;
			<th class="text-left head">y-axis</th>&#13;
			<th class="text-left head">Relationship</th>&#13;
			<th class="text-left head">Also known as</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td class="text-left">No transform</td>&#13;
			<td class="text-left">&#13;
			<p>No transform</p>&#13;
			</td>&#13;
			<td class="text-left">&#13;
			<p>Linear: <span class="math notranslate nohighlight"><math> <mi>y</mi> <mo>=</mo> <mi>a</mi> <mi>x</mi> <mo>+</mo> <mi>b</mi> </math></span></p>&#13;
			</td>&#13;
			<td class="text-left">&#13;
			<p>Linear</p>&#13;
			</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td class="text-left">Log–scale</td>&#13;
			<td class="text-left">&#13;
			<p>No transform</p>&#13;
			</td>&#13;
			<td class="text-left">&#13;
			<p>Log: <span class="math notranslate nohighlight"><math> <mi>y</mi> <mo>=</mo> <mi>a</mi> <mi>log</mi> <mo>⁡</mo> <mi>x</mi> <mo>+</mo> <mi>b</mi> </math></span></p>&#13;
			</td>&#13;
			<td class="text-left">&#13;
			<p>Linear–log</p>&#13;
			</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td class="text-left">No transform</td>&#13;
			<td class="text-left">&#13;
			<p>Log–scale</p>&#13;
			</td>&#13;
			<td class="text-left">&#13;
			<p>Exponential: <span class="math notranslate nohighlight"><math> <mi>y</mi> <mo>=</mo> <mi>b</mi> <msup> <mi>a</mi> <mi>x</mi> </msup> </math></span></p>&#13;
			</td>&#13;
			<td class="text-left">&#13;
			<p>Log–linear</p>&#13;
			</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td class="text-left">Log–scale</td>&#13;
			<td class="text-left">&#13;
			<p>Log–scale</p>&#13;
			</td>&#13;
			<td class="text-left">&#13;
			<p>Power: <span class="math notranslate nohighlight"><math> <mi>y</mi> <mo>=</mo> <mi>b</mi> <msup> <mi>x</mi> <mi>a</mi> </msup> </math></span></p>&#13;
			</td>&#13;
			<td class="text-left">&#13;
			<p>Log–log</p>&#13;
			</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<p>As <a class="reference internal" data-type="xref" href="#tab-transform-rels">Table 11-1</a> shows, the log transform can reveal several common types of relationships. Because of this, the log transform is considered the jackknife of transformations. As another, albeit artificial, example, the leftmost plot in <a class="reference internal" data-type="xref" href="#example-transforms">Figure 11-1</a> reveals a curvilinear relationship between <em>x</em> and <em>y</em>. The middle plot shows a different <span class="keep-together">curvilinear</span> relationship between <em>log(y)</em> and <em>x</em>; this plot also appears nonlinear. A further log transformation, at the far right, displays a plot of <em>log(y)</em> against <em>log(x)</em>. This plot confirms that the data have a log–log (or power) relationship because the transformed points fall along a line.</p>&#13;
&#13;
<figure><div class="figure" id="example-transforms"><img src="assets/leds_1101.png"/>&#13;
<h6><span class="label">Figure 11-1. </span>Scatterplots showing how log transforms can “straighten” a curvilinear relationship between two variables</h6>&#13;
</div></figure>&#13;
&#13;
<p>Adjusting scale is an important practice in data visualization. While the log transform is versatile, it doesn’t handle all situations where skew or curvature occurs. For example, at times the values are all roughly the same order of magnitude and the log transformation has little impact. Another transformation to consider is the square root transformation, which is often useful for count data.</p>&#13;
&#13;
<p>In the next section, we look at principles of smoothing, which we use when we need to visualize lots of data<a contenteditable="false" data-primary="" data-startref="ix_str_rel_ch11" data-type="indexterm" id="id1329"/><a contenteditable="false" data-primary="" data-startref="ix_var_str_rel_ch11" data-type="indexterm" id="id1330"/><a contenteditable="false" data-primary="" data-startref="ix_scale_prin_straight" data-type="indexterm" id="id1331"/><a contenteditable="false" data-primary="" data-startref="ix_dog_breeds_data_rel" data-type="indexterm" id="id1332"/><a contenteditable="false" data-primary="" data-startref="ix_vis_struct_scale" data-type="indexterm" id="id1333"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Smoothing and Aggregating Data" data-type="sect1"><div class="sect1" id="sec-viz-smoothing">&#13;
<h1>Smoothing and Aggregating Data</h1>&#13;
&#13;
<p>When we have lots of data<a contenteditable="false" data-primary="smoothing data for visualization" data-type="indexterm" id="ix_smooth_vis"/><a contenteditable="false" data-primary="visualization, data" data-secondary="smoothing and aggregating data" data-type="indexterm" id="ix_vis_smooth"/>, we often don’t want to plot all of the individual data points. The following scatter<a contenteditable="false" data-primary="Cherry Blossom race dataset" data-type="indexterm" id="id1334"/> plot shows data from <a class="reference external" href="https://www.cherryblossom.org">Cherry Blossom</a>, an annual 10-mile race that takes place in Washington, DC, in April, when the cherry trees are in bloom. These data were scraped from the race’s website and include official times and other information for all registered male runners from 1999 to 2012. We’ve plotted the runners’ ages on the x-axis and race times on the <span class="keep-together">y-axis</span>:</p>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_11in13.png"/>&#13;
</div></figure>&#13;
&#13;
<p>This scatterplot contains<a contenteditable="false" data-primary="overplotting" data-type="indexterm" id="id1335"/> over 70,000 points. With so many points, many of them overlap. This is a common problem called <em>overplotting</em>. In this case, overplotting prevents us from seeing how time and age are related. About the only thing that we can see in this plot is a group of very young runners, which points to possible issues with data quality. To address overplotting, we use smoothing techniques that aggregate data before plotting.</p>&#13;
&#13;
<section data-pdf-bookmark="Smoothing Techniques to Uncover Shape" data-type="sect2"><div class="sect2" id="smoothing-techniques-to-uncover-shape">&#13;
<h2>Smoothing Techniques to Uncover Shape</h2>&#13;
&#13;
<p>The histogram<a contenteditable="false" data-primary="histograms, for data distribution" data-type="indexterm" id="ix_histo_plot2"/><a contenteditable="false" data-primary="shape of data table" data-secondary="smoothing data for visualization" data-type="indexterm" id="ix_shape_smooth_vis"/><a contenteditable="false" data-primary="smoothing data for visualization" data-secondary="uncovering shape" data-type="indexterm" id="ix_smooth_shape"/> is a familiar type of plot that uses smoothing. A histogram aggregates data values by putting points into bins and plotting one bar for each bin. Smoothing here means that we cannot differentiate the location of individual points in a bin: the points are smoothly allocated across their bins. With histograms, the area of a bin corresponds to the percentage (or count or proportion) of points in the bin. (Often the bins are equal in width, and we take a shortcut to label the height of a bin as the proportion.)</p>&#13;
&#13;
<p>The following histogram<a contenteditable="false" data-primary="dog breeds dataset" data-secondary="smoothing histogram to uncover shape" data-type="indexterm" id="ix_dog_breeds_smooth"/> plots the distribution of lifespans for dog breeds:</p>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_11in14.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Above this histogram is a rug plot that draws a single line for every data value. We can see in the tallest bin that even a small amount of data can cause overplotting in the rug plot. By smoothing out the points in the rug plot, the histogram reveals the general shape of the distribution. In this case, we see that many breeds have a longevity of about 12 years. For more on how to read and interpret histograms, see <span class="keep-together"><a class="reference internal" data-type="xref" href="ch10.html#ch-eda">Chapter 10</a></span>.</p>&#13;
&#13;
<p>Another common<a contenteditable="false" data-primary="kernel density estimate (KDE)" data-type="indexterm" id="id1336"/> smoothing technique is <em>kernel density estimation</em> (KDE). A KDE plot shows the distribution using a smooth curve rather than bars. In the following plot, we show the same histogram of dog longevity with a KDE curve overlaid. The KDE curve has a similar shape as the histogram:</p>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_11in15.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>It might come as a surprise to think of a histogram as a smoothing method. Both the KDE and histogram aim to help us see important features in the distribution of values. Similar smoothing techniques can be used with scatterplots. This is the topic of the next section<a contenteditable="false" data-primary="" data-startref="ix_smooth_shape" data-type="indexterm" id="id1337"/><a contenteditable="false" data-primary="" data-startref="ix_shape_smooth_vis" data-type="indexterm" id="id1338"/><a contenteditable="false" data-primary="" data-startref="ix_dog_breeds_smooth" data-type="indexterm" id="id1339"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Smoothing Techniques to Uncover Relationships and Trends" data-type="sect2"><div class="sect2" id="smoothing-techniques-to-uncover-relationships-and-trends">&#13;
<h2>Smoothing Techniques to Uncover Relationships and Trends</h2>&#13;
&#13;
<p>We can find high-density regions<a contenteditable="false" data-primary="binning data, smoothing technique" data-type="indexterm" id="ix_bin_smooth"/><a contenteditable="false" data-primary="smoothing data for visualization" data-secondary="uncovering relationships and trends" data-type="indexterm" id="ix_smooth_rel_trend"/><a contenteditable="false" data-primary="Cherry Blossom race dataset" data-type="indexterm" id="ix_cherry_bloss"/> of a scatterplot by binning data, like in a histogram. The following plot remakes the earlier scatterplot of the Cherry Blossom race times against age. This plot uses hexagonal bins to aggregate points together, and then shades the hexagons based on how many points fall in them:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">runners_over_17</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">runners</code></span><span><code class="p">[</code></span><span><code class="n">runners</code></span><span><code class="p">[</code></span><span><code class="s2">"</code><code class="s2">age</code><code class="s2">"</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">&gt;</code></span><code> </code><span><code class="mi">17</code></span><span><code class="p">]</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">plt</code></span><span><code class="o">.</code></span><span><code class="n">figure</code></span><span><code class="p">(</code></span><span><code class="n">figsize</code></span><span><code class="o">=</code></span><span><code class="p">(</code></span><span><code class="mi">4</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">4</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">plt</code></span><span><code class="o">.</code></span><span><code class="n">hexbin</code></span><span><code class="p">(</code></span><span><code class="n">data</code></span><span><code class="o">=</code></span><span><code class="n">runners_over_17</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">age</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">time</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">gridsize</code></span><span><code class="o">=</code></span><span><code class="mi">35</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">cmap</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Blues</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">sns</code></span><span><code class="o">.</code></span><span><code class="n">despine</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">plt</code></span><span><code class="o">.</code></span><span><code class="n">grid</code></span><span><code class="p">(</code></span><span><code class="kc">False</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">plt</code></span><span><code class="o">.</code></span><span><code class="n">xlabel</code></span><span><code class="p">(</code></span><span><code class="s2">"</code><code class="s2">Runner age (yr)</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">plt</code></span><span><code class="o">.</code></span><span><code class="n">ylabel</code></span><span><code class="p">(</code></span><span><code class="s2">"</code><code class="s2">Race time (sec)</code><code class="s2">"</code></span><span><code class="p">)</code><code class="p">;</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in16.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Notice the high-density region in the 25-to-40 age group, signified by the dark region in the plot. The plot shows us that many of the runners in this age range complete the race in around 5,000 seconds (about 80 minutes). (Note that we drop the dubious young runners from this plot.) We can also see upward curvature in the region corresponding to the 40-to-60 age group, which indicates that these runners are generally slower than those in the 25-to-40 age group. This plot is similar to a heat map, where the higher-density regions are conveyed through hotter or brighter colors.</p>&#13;
&#13;
<p>Kernel density<a contenteditable="false" data-primary="kernel density estimate (KDE)" data-type="indexterm" id="id1340"/> estimation also works in two dimensions. When we use KDE in two dimensions, we typically plot the contours of the resulting three-dimensional shape, and we read the plot like a topographical map:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">plt</code></span><span><code class="o">.</code></span><span><code class="n">figure</code></span><span><code class="p">(</code></span><span><code class="n">figsize</code></span><span><code class="o">=</code></span><span><code class="p">(</code></span><span><code class="mi">5</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">3</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">sns</code></span><span><code class="o">.</code></span><span><code class="n">kdeplot</code></span><span><code class="p">(</code></span><span><code class="n">data</code></span><span><code class="o">=</code></span><span><code class="n">runners_over_17</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">age</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">time</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">plt</code></span><span><code class="o">.</code></span><span><code class="n">xlabel</code></span><span><code class="p">(</code></span><span><code class="s2">"</code><code class="s2">Runner age (yr)</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">plt</code></span><span><code class="o">.</code></span><span><code class="n">ylabel</code></span><span><code class="p">(</code></span><span><code class="s2">"</code><code class="s2">Race time (sec)</code><code class="s2">"</code></span><span><code class="p">)</code><code class="p">;</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in17.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>This two-dimensional KDE gives similar insights as the shaded squares of the previous plot. We see a high concentration of runners in the 25-to-40 age group, and these runners have times that appear to be roughly 5,000 seconds. Smoothing lets us get a better picture when there’s lots of data because it can reveal the locations of highly concentrated data values and the shape of these high-concentration regions. These regions may be impossible to see otherwise.</p>&#13;
&#13;
<p>Another smoothing<a contenteditable="false" data-primary="y- and x-value axis smoothing" data-type="indexterm" id="id1341"/> approach that is often more informative smooths the y-values for points with a similar x-value. To explain, let’s group together runners with similar ages, using five-year increments: 20–25, 25–30, 30–35, and so on. Then, for each five-year bin of runners, we average their race times, plot the average time for each group, and connect the points to form a “curve”:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">times</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><code>&#13;
</code><code>    </code><span><code class="n">runners_over_17</code></span><span><code class="o">.</code></span><span><code class="n">assign</code></span><span><code class="p">(</code></span><span><code class="n">age_5yr</code></span><span><code class="o">=</code></span><span><code class="n">runners_over_17</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">age</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">/</code><code class="o">/</code></span><code> </code><span><code class="mi">5</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="mi">5</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">age_5yr</code><code class="s1">'</code></span><span><code class="p">)</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">time</code><code class="s1">'</code></span><span><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">mean</code></span><span><code class="p">(</code><code class="p">)</code></span><span><code class="o">.</code></span><span><code class="n">reset_index</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">line</code></span><span><code class="p">(</code></span><span><code class="n">times</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">age_5yr</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">time</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>        </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">time</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s2">"</code><code class="s2">Average race time (sec)</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">age_5yr</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s2">"</code><code class="s2">Runner age (5-yr)</code><code class="s2">"</code></span><span><code class="p">}</code><code class="p">,</code></span><code>&#13;
</code><code>        </code><span><code class="n">markers</code></span><span><code class="o">=</code></span><span><code class="kc">True</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>        </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in18.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>This plot shows once again that runners in the 25-to-40 age range have typical run times of about 5,400 seconds. It also shows that older runners took longer to complete the race on average (not really a surprise, but it wasn’t nearly as evident in the earlier plots). The dip in times for runners under age 20 and the flattening of the curve at age 80 may simply be the result of fewer and fitter runners in these groups. Another smoothing technique uses kernel smoothing similar to the KDE. We don’t go into the details here<a contenteditable="false" data-primary="" data-startref="ix_cherry_bloss" data-type="indexterm" id="id1342"/>.</p>&#13;
&#13;
<p>The binning and kernel smoothing techniques rely on a tuning parameter that specifies the width of the bin or the spread of the kernel, and we often need to specify this parameter when making a histogram, KDE, or smooth curve. This is the topic of the next section<a contenteditable="false" data-primary="" data-startref="ix_smooth_rel_trend" data-type="indexterm" id="id1343"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Smoothing Techniques Need Tuning" data-type="sect2"><div class="sect2" id="smoothing-techniques-need-tuning">&#13;
<h2>Smoothing Techniques Need Tuning</h2>&#13;
&#13;
<p>Now that we’ve seen how smoothing<a contenteditable="false" data-primary="tuning of smoothing techniques" data-type="indexterm" id="id1344"/><a contenteditable="false" data-primary="smoothing data for visualization" data-secondary="tuning of smoothing techniques" data-type="indexterm" id="id1345"/> is useful for plotting, we turn to the issue of tuning. For histograms, the width of the bins or, for equal-width bins, the number of bins affects the look of the histogram. The left histogram of longevity shown here has a few wide bins, and the right histogram has many narrow bins (see it larger <a href="https://oreil.ly/SmLYq">online</a>):</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in19.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>In both histograms, it’s hard to see the shape of the distribution. With a few wide bins (the plot on the left), we have oversmoothed the distribution, which makes it impossible to discern modes and tails. On the other hand, too many bins (the plot on the right) gives a plot that’s little better than a rug plot. KDE plots have a parameter called the <em>bandwidth</em> that works similarly to the bin width of a histogram.</p>&#13;
&#13;
<p>Most histogram<a contenteditable="false" data-primary="kernel density estimate (KDE)" data-type="indexterm" id="id1346"/><a contenteditable="false" data-primary="bandwidth parameter, KDE plots" data-type="indexterm" id="id1347"/> and KDE software automatically chooses the bin width for the histogram and the bandwidth for the kernel. However, these parameters often need a bit of fiddling to create the most useful plot. When you create visualizations that rely on tuning parameters, it’s important to try a few different values before settling on one.</p>&#13;
&#13;
<p>A different approach to data reduction is to examine quantiles. This is the topic of the next section<a contenteditable="false" data-primary="" data-startref="ix_bin_smooth" data-type="indexterm" id="id1348"/><a contenteditable="false" data-primary="" data-startref="ix_histo_plot2" data-type="indexterm" id="id1349"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Reducing Distributions to Quantiles" data-type="sect2"><div class="sect2" id="reducing-distributions-to-quantiles">&#13;
<h2>Reducing Distributions to Quantiles</h2>&#13;
&#13;
<p>We found<a contenteditable="false" data-primary="quantile–quantile (q–q) plot" data-type="indexterm" id="ix_quant_qq"/><a contenteditable="false" data-primary="smoothing data for visualization" data-secondary="reducing distributions to quantiles" data-type="indexterm" id="ix_smooth_quant"/><a contenteditable="false" data-primary="data distributions" data-secondary="reducing to quantiles" data-type="indexterm" id="ix_data_dist_quant"/> in <a class="reference internal" data-type="xref" href="ch10.html#ch-eda">Chapter 10</a> that while box plots<a contenteditable="false" data-primary="box plots, data distribution" data-type="indexterm" id="id1350"/> aren’t as informative as histograms, they can be useful when comparing the distributions of many groups at once. A box plot reduces the data to a few essential features based on the data quartiles. More generally, quantiles (the lower quartile, median, and upper quartile are the 25th, 50th, and 75th quantiles) can provide a useful reduction in the data when comparing <span class="keep-together">distributions</span>.</p>&#13;
&#13;
<p>When two distributions are roughly similar in shape, it can be hard to compare them with histograms. For instance, the histograms that follow show the price distributions for two- and four-bedroom houses in the San Francisco housing data. The distributions look roughly similar in shape. But a plot of their quantiles handily compares the distributions’ center, spread, and tails (see it larger <a href="https://oreil.ly/zVagW">online</a>):</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">histogram</code></span><span><code class="p">(</code></span><span><code class="n">sfh</code></span><span><code class="o">.</code></span><span><code class="n">query</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">br in [2, 4]</code><code class="s1">'</code></span><span><code class="p">)</code><code class="p">,</code></span><code>&#13;
</code><code>             </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">log_x</code></span><span><code class="o">=</code></span><span><code class="kc">True</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">facet_col</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">br</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>             </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s2">"</code><code class="s2">Sale price (USD)</code><code class="s2">"</code></span><span><code class="p">}</code><code class="p">,</code></span><code>&#13;
</code><code>             </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">700</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in20.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>We can compare quantiles with a <em>quantile–quantile</em> plot, called <em>q–q plot</em> for short. To make this plot, we first compute percentiles (also called quantiles) for both the two- and four-bedroom distributions of price:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">br2</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">sfh</code></span><span><code class="o">.</code></span><span><code class="n">query</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">br == 2</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">br4</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">sfh</code></span><span><code class="o">.</code></span><span><code class="n">query</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">br == 4</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">percs</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">arange</code></span><span><code class="p">(</code></span><span><code class="mi">1</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">100</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">1</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">perc2</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">percentile</code></span><span><code class="p">(</code></span><span><code class="n">br2</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">,</code></span><code> </code><span><code class="n">percs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">method</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">lower</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">perc4</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">percentile</code></span><span><code class="p">(</code></span><span><code class="n">br4</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">,</code></span><code> </code><span><code class="n">percs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">method</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">lower</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">perc_sfh</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">DataFrame</code></span><span><code class="p">(</code><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">percentile</code><code class="s1">'</code></span><span><code class="p">:</code></span><code> </code><span><code class="n">percs</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">br2</code><code class="s1">'</code></span><span><code class="p">:</code></span><code> </code><span><code class="n">perc2</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">br4</code><code class="s1">'</code></span><span><code class="p">:</code></span><code> </code><span><code class="n">perc4</code></span><span><code class="p">}</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">perc_sfh</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>percentile</th>&#13;
			<th>br2</th>&#13;
			<th>br4</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>1</td>&#13;
			<td>1.50e+05</td>&#13;
			<td>2.05e+05</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>2</td>&#13;
			<td>1.82e+05</td>&#13;
			<td>2.50e+05</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>3</td>&#13;
			<td>2.03e+05</td>&#13;
			<td>2.75e+05</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>96</strong></td>&#13;
			<td>97</td>&#13;
			<td>1.04e+06</td>&#13;
			<td>1.75e+06</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>97</strong></td>&#13;
			<td>98</td>&#13;
			<td>1.20e+06</td>&#13;
			<td>1.95e+06</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>98</strong></td>&#13;
			<td>99</td>&#13;
			<td>1.44e+06</td>&#13;
			<td>2.34e+06</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>99 rows × 3 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Then we plot the matching percentiles on a scatterplot. We usually also show the reference line y = x to help with the comparison:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">scatter</code></span><span><code class="p">(</code></span><span><code class="n">perc_sfh</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">br2</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">br4</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">log_x</code></span><span><code class="o">=</code></span><span><code class="kc">True</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">log_y</code></span><span><code class="o">=</code></span><span><code class="kc">True</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>                 </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">br2</code><code class="s1">'</code></span><span><code class="p">:</code></span><code> </code><span><code class="s1">'</code><code class="s1">Price of 2-bedroom house</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                         </code><span><code class="s1">'</code><code class="s1">br4</code><code class="s1">'</code></span><span><code class="p">:</code></span><code> </code><span><code class="s1">'</code><code class="s1">Price of 4-bedroom house</code><code class="s1">'</code></span><span><code class="p">}</code><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">add_trace</code></span><span><code class="p">(</code></span><span><code class="n">go</code></span><span><code class="o">.</code></span><span><code class="n">Scatter</code></span><span><code class="p">(</code></span><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="mf">1e5</code></span><span><code class="p">,</code></span><code> </code><span><code class="mf">2e6</code></span><span><code class="p">]</code><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="mf">1e5</code></span><span><code class="p">,</code></span><code> </code><span><code class="mf">2e6</code></span><span><code class="p">]</code><code class="p">,</code></span><code> </code><code>&#13;
</code><code>            </code><span><code class="n">mode</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">lines</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">line</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">dash</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">dash</code><code class="s1">'</code></span><span><code class="p">)</code><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_layout</code></span><span><code class="p">(</code></span><span><code class="n">showlegend</code></span><span><code class="o">=</code></span><span><code class="kc">False</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-80"><div class="figure"><img src="assets/leds_11in21.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>When the quantile points fall along a line, the variables have similarly shaped distributions. Lines parallel to the reference indicate a difference in center, lines with slopes other than 1 indicate a difference in spread, and curvature indicates a difference in shape. From the preceding q–q plot, we see that the distribution of price for four-bedroom houses is similar in shape to the two-bedroom distribution, except for a shift of about $100K and a slightly longer right tail (indicated by the upward bend for large values). Reading a q–q plot takes practice. Once you get the hang of it, though, it can be a handy way to compare distributions. Notice that the housing data have over 100,000 observations, and the q–q plot has reduced the data to 99 percentiles. This data reduction is quite useful. However, we don’t always want to use smoothers. This is the topic of the next section<a contenteditable="false" data-primary="" data-startref="ix_quant_qq" data-type="indexterm" id="id1351"/><a contenteditable="false" data-primary="" data-startref="ix_data_dist_quant" data-type="indexterm" id="id1352"/><a contenteditable="false" data-primary="" data-startref="ix_smooth_quant" data-type="indexterm" id="id1353"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="When Not to Smooth" data-type="sect2"><div class="sect2" id="when-not-to-smooth">&#13;
<h2>When Not to Smooth</h2>&#13;
&#13;
<p>Smoothing<a contenteditable="false" data-primary="smoothing data for visualization" data-secondary="when not to smooth" data-type="indexterm" id="ix_smooth_no"/><a contenteditable="false" data-primary="curse of dimensionality, data distribution" data-type="indexterm" id="id1354"/> and aggregating can help us see important features and relationships, but when we have only a handful of observations, smoothing techniques can be misleading. With just a few observations<a contenteditable="false" data-primary="rug plot, data distribution" data-type="indexterm" id="id1355"/>, we prefer rug plots over histograms, box plots, and density curves, and we use scatterplots rather than smooth curves and density contours. This may seem obvious, but when we have a large amount of data, the amount of data in a subgroup can quickly dwindle. This phenomenon is an example of the <em>curse of dimensionality</em>.</p>&#13;
&#13;
<p>One of the most common<a contenteditable="false" data-primary="box plots, data distribution" data-type="indexterm" id="id1356"/> misuses of smoothing happens with box plots. As an example, here is a collection of seven box plots of longevity, one for each of seven types of dog breed:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">box</code></span><span><code class="p">(</code></span><span><code class="n">dogs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">group</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">longevity</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>       </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">group</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s2">"</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">longevity</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s2">"</code><code class="s2">Longevity (yr)</code><code class="s2">"</code></span><span><code class="p">}</code><code class="p">,</code></span><code>&#13;
</code><code>       </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">500</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in22.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Some of these box plots have as few as two or three observations. The strip plot that follows is a preferable visualization:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">strip</code></span><span><code class="p">(</code></span><span><code class="n">dogs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">group</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">longevity</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>         </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">group</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s2">"</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">longevity</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s2">"</code><code class="s2">Longevity (yr)</code><code class="s2">"</code></span><span><code class="p">}</code><code class="p">,</code></span><code>&#13;
</code><code>         </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">400</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in23.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>In this plot, we can still compare the groups, but we also see the exact values in each group. Now we can tell that there are only three breeds in the non-sporting group; the impression of a skewed distribution, based on the box plot, reads too much into the shape of the box.</p>&#13;
&#13;
<p>This section<a contenteditable="false" data-primary="overplotting" data-type="indexterm" id="id1357"/> introduced the problem of overplotting, where we have overlapping points because of a large dataset. To address this issue, we introduced smoothing techniques that aggregate data. We saw two common examples of smoothing—<span class="keep-together">binning</span> and kernel smoothing—and applied them in the one- and two-dimensional settings. In one dimension, these are histograms and kernel density curves, respectively, and they both help us see the shape of a distribution. In two dimensions, we found it useful to smooth y-values while keeping x-values fixed in order to visualize trends. We addressed the need to tune the smoothing amount to get more informative histograms and density curves, and we cautioned against smoothing with too few data.</p>&#13;
&#13;
<p>There are many other ways to reduce overplotting in scatter<a contenteditable="false" data-primary="scatterplots, data distribution" data-type="indexterm" id="id1358"/> plots. For instance, we can make the dots partially transparent so that overlapping points appear darker. If many observations have the same values (like when longevity is rounded to the nearest year), then we can add a small amount of random noise to the values to reduce the amount of overplotting. This procedure<a contenteditable="false" data-primary="jittering, in scatterplots" data-type="indexterm" id="id1359"/> is called <em>jittering</em>, and it is used in the strip plot of longevity. Transparency and jittering are convenient for medium-sized data. However, they don’t work well for large datasets since plotting all the points still overwhelms the visualization.</p>&#13;
&#13;
<p>The quantile–quantile<a contenteditable="false" data-primary="kernel density estimate (KDE)" data-type="indexterm" id="id1360"/><a contenteditable="false" data-primary="quantile–quantile (q–q) plot" data-type="indexterm" id="id1361"/> plot we introduced offers one way to compare distributions with far fewer points; another is to use side-by-side box plots and yet another is to overlay KDE curves in the same plot. We often aim to compare distributions and relationships across subsets (or groups) of data, and we next discuss several design principles that facilitate meaningful comparisons for a variety of plot types<a contenteditable="false" data-primary="" data-startref="ix_smooth_no" data-type="indexterm" id="id1362"/><a contenteditable="false" data-primary="" data-startref="ix_smooth_vis" data-type="indexterm" id="id1363"/><a contenteditable="false" data-primary="" data-startref="ix_vis_smooth" data-type="indexterm" id="id1364"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Facilitating Meaningful Comparisons" data-type="sect1"><div class="sect1" id="ch-viz-comparisons">&#13;
<h1>Facilitating Meaningful Comparisons</h1>&#13;
&#13;
<p>The same data<a contenteditable="false" data-primary="visualization, data" data-secondary="clarity principles for plots" data-type="indexterm" id="ix_vis_clarity_plot"/> can be visualized in many different ways, and deciding which plot to make can be daunting. Generally speaking, our plot should help a reader make meaningful comparisons. In this section, we go over several useful principles that can improve the clarity of our plots.</p>&#13;
&#13;
<section data-pdf-bookmark="Emphasize the Important Difference" data-type="sect2"><div class="sect2" id="emphasize-the-important-difference">&#13;
<h2>Emphasize the Important Difference</h2>&#13;
&#13;
<p>Whenever we make a plot that compares groups, we consider whether the plot emphasizes the important difference. As a rule of thumb, it’s easier for readers to see differences when plotted objects are aligned in ways that make these comparisons easier to read. Let’s look at an example.</p>&#13;
&#13;
<p>The <a class="reference external" href="https://oreil.ly/b0YMJ">US Bureau of Labor Statistics</a> publishes<a contenteditable="false" data-primary="US Bureau of Labor Statistics income dataset" data-type="indexterm" id="ix_us_labor_stat"/> data on income. We took the 2020 median full-time-equivalent weekly earnings for people over age 25 and plotted them. We split people into groups by education level and sex:<sup><a data-type="noteref" href="ch11.html#id1365" id="id1365-marker">1</a></sup></p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">labels</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">{</code></span><span><code class="s2">"</code><code class="s2">educ</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">Education</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>          </code><span><code class="s2">"</code><code class="s2">income</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">Weekly earnings (USD)</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>          </code><span><code class="s2">"</code><code class="s2">gender</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">Sex</code><code class="s2">"</code></span><span><code class="p">}</code></span><code>&#13;
</code><span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">bar</code></span><span><code class="p">(</code></span><span><code class="n">earn</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">educ</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">income</code><code class="s2">"</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>             </code><span><code class="n">facet_col</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">gender</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="n">labels</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>             </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">450</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_layout</code></span><span><code class="p">(</code></span><span><code class="n">margin</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">t</code></span><span><code class="o">=</code></span><span><code class="mi">30</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-75"><div class="figure"><img src="assets/leds_11in24.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>These bar plots show that earnings increase with more education. But arguably, a more interesting comparison is between men and women of the same education level. We can group the bars differently to focus instead on this comparison:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">bar</code></span><span><code class="p">(</code></span><span><code class="n">earn</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">educ</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">income</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">color</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">gender</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>       </code><span><code class="n">barmode</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">group</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="n">labels</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>       </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">450</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-65"><div class="figure"><img src="assets/leds_11in25.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>This plot is much better; we can more easily compare the earnings of men and women for each level of education. However, we can make this difference even clearer using vertical alignment. Instead of bars, we use dots for groups of men and women that align vertically at each education level:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">line</code></span><span><code class="p">(</code></span><span><code class="n">earn</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">educ</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">income</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">symbol</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">gender</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>              </code><span><code class="n">color</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">gender</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="n">labels</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">450</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_traces</code></span><span><code class="p">(</code></span><span><code class="n">marker_size</code></span><span><code class="o">=</code></span><span><code class="mi">10</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-70"><div class="figure"><img src="assets/leds_11in26.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>This plot more clearly reveals an important difference: the earnings gap between men and women grows with education. We considered three plots that visualize the same data, but they differ in how readily we can see the message in the plot. We prefer the last one because it aligns the income differences vertically, making them easier to compare.</p>&#13;
&#13;
<p>Notice that in making all three plots, we ordered the education categories from the least to greatest number of years of education. This ordering makes sense because education level is ordinal. When we compare nominal categories, we use other approaches to ordering<a contenteditable="false" data-primary="" data-startref="ix_us_labor_stat" data-type="indexterm" id="id1366"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Ordering Groups" data-type="sect2"><div class="sect2" id="ordering-groups">&#13;
<h2>Ordering Groups</h2>&#13;
&#13;
<p>With ordinal features<a contenteditable="false" data-primary="ordering groups in visualizations" data-type="indexterm" id="ix_order_group"/>, we keep the categories in their natural order when we make plots, but the same principle does not apply for nominal features. Instead, we choose an ordering that helps us make comparisons. With bar plots, it’s a good practice to order the bars according to their height, while for box plots and strip plots, we typically order the boxes/strips according to medians.</p>&#13;
&#13;
<p>The two bar plots<a contenteditable="false" data-primary="dog breeds dataset" data-secondary="ordering groups" data-type="indexterm" id="id1367"/> that follow each compare the mean lifespan for types of dog breeds:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in27.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The plot on the left orders the bars alphabetically. We prefer the plot on the right because it orders the bars by longevity, which makes it easier to compare longevity across the categories. We don’t have to bounce back and forth or squint to guess whether herding breeds have a shorter lifespan than toy breeds.</p>&#13;
&#13;
<p>As another example, the following two sets of box plots each compare the distribution of sale price for houses in different cities in the San Francisco East Bay area:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in28.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>We prefer the plot on the right since it has boxes ordered according to the median price for each city. Again, this ordering makes it easier to compare distributions across groups, in this case cities. We see that the lower quartile and median price in Albany and Walnut Creek are roughly the same, but the prices in Walnut Creek have a greater right skew.</p>&#13;
&#13;
<p>When possible, ordering bars in a bar plot by height and boxes in a box plot by median makes it easier for us to make comparisons across groups. Another technique used for presenting grouped data is stacking. We describe stacking in the next section and provide examples to convince you to steer away from this sort of plot<a contenteditable="false" data-primary="" data-startref="ix_order_group" data-type="indexterm" id="id1368"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Avoid Stacking" data-type="sect2"><div class="sect2" id="avoid-stacking">&#13;
<h2>Avoid Stacking</h2>&#13;
&#13;
<p>The figure that follows shows a stacked bar<a contenteditable="false" data-primary="stacking in bar plots, avoiding in visualizations" data-type="indexterm" id="ix_stack_bar_plot"/><a contenteditable="false" data-primary="bar plots, data distribution" data-type="indexterm" id="ix_bar_plot_dist"/> plot in which there is one bar for each city and these bars are divided according to the proportion of houses sold that have from one to eight or more bedrooms. This is called a <em>stacked bar plot</em>. The bar plot is based on a cross-tabulation:</p>&#13;
&#13;
&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">br_crosstab</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th>br</th>&#13;
			<th>1.0</th>&#13;
			<th>2.0</th>&#13;
			<th>3.0</th>&#13;
			<th>4.0</th>&#13;
			<th>5.0</th>&#13;
			<th>6.0</th>&#13;
			<th>7.0</th>&#13;
			<th>8.0</th>&#13;
		</tr>&#13;
		<tr>&#13;
			<th>city</th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>Albany</strong></td>&#13;
			<td>1.21e-01</td>&#13;
			<td>0.56</td>&#13;
			<td>0.25</td>&#13;
			<td>0.05</td>&#13;
			<td>9.12e-03</td>&#13;
			<td>1.01e-03</td>&#13;
			<td>2.03e-03</td>&#13;
			<td>4.05e-03</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Berkeley</strong></td>&#13;
			<td>6.91e-02</td>&#13;
			<td>0.38</td>&#13;
			<td>0.31</td>&#13;
			<td>0.16</td>&#13;
			<td>4.44e-02</td>&#13;
			<td>1.42e-02</td>&#13;
			<td>6.48e-03</td>&#13;
			<td>7.23e-03</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>El Cerrito</strong></td>&#13;
			<td>1.81e-02</td>&#13;
			<td>0.34</td>&#13;
			<td>0.47</td>&#13;
			<td>0.14</td>&#13;
			<td>2.20e-02</td>&#13;
			<td>6.48e-03</td>&#13;
			<td>0.00e+00</td>&#13;
			<td>6.48e-04</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Piedmont</strong></td>&#13;
			<td>8.63e-03</td>&#13;
			<td>0.22</td>&#13;
			<td>0.40</td>&#13;
			<td>0.26</td>&#13;
			<td>9.50e-02</td>&#13;
			<td>1.29e-02</td>&#13;
			<td>7.19e-03</td>&#13;
			<td>1.44e-03</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Richmond</strong></td>&#13;
			<td>3.60e-02</td>&#13;
			<td>0.36</td>&#13;
			<td>0.42</td>&#13;
			<td>0.15</td>&#13;
			<td>2.52e-02</td>&#13;
			<td>7.21e-03</td>&#13;
			<td>7.72e-04</td>&#13;
			<td>7.72e-04</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Walnut Creek</strong></td>&#13;
			<td>1.16e-01</td>&#13;
			<td>0.35</td>&#13;
			<td>0.30</td>&#13;
			<td>0.18</td>&#13;
			<td>4.37e-02</td>&#13;
			<td>5.08e-03</td>&#13;
			<td>4.12e-04</td>&#13;
			<td>2.75e-04</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Each bar in the plot has the same height of 1 because the segments represent the proportion of houses with one or more bedrooms in a city and so add to 1 or 100% (see it in color <a href="https://oreil.ly/cIba_">online</a>):</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">bar</code></span><span><code class="p">(</code></span><span><code class="n">br_crosstab</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">450</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">300</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_layout</code></span><span><code class="p">(</code></span><span><code class="n">yaxis_title</code></span><span><code class="o">=</code></span><span><code class="kc">None</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">xaxis_title</code></span><span><code class="o">=</code></span><span><code class="kc">None</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                  </code><span><code class="n">legend_title</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2"># Bedrooms</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">show</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-75"><div class="figure"><img src="assets/leds_11in29.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p class="pagebreak-before less_space">It’s easy to compare<a contenteditable="false" data-primary="line plots, data distribution" data-type="indexterm" id="ix_line_plot"/> the proportion of one-bedroom houses in each of the cities by simply scanning across the top of the first segment in each column. But the comparison of four-bedroom houses is more difficult. The bottoms of the segments are not aligned horizontally, so our eyes must judge the lengths of segments that move up and down across the plot. This up-and-down movement<a contenteditable="false" data-primary="jiggling the baseline, stacked bar plot" data-type="indexterm" id="id1369"/> is called <em>jiggling the baseline</em>. (We recognize that with so many colors, this plot does not render well in grayscale, but our goal is to steer you away from plots like this one and the next, so we have kept all of the colors for those of you reading the online version.)</p>&#13;
&#13;
<p>Stacked<a contenteditable="false" data-primary="stacked line plot" data-type="indexterm" id="ix_stack_line_plot"/><a contenteditable="false" data-primary="CO₂ emissions for different countries dataset" data-type="indexterm" id="ix_co2_stack_line"/> line plots are even more difficult to read because we have to judge the gap between curves as they jiggle up and down. The following plot shows <a class="reference external" href="https://oreil.ly/kjk9N">carbon dioxide (CO<sub>2</sub>) emissions</a> from 1950 to 2012 for the 10 highest emitters (see it in color <a href="https://oreil.ly/VUyuz">online</a>):</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in30.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Since the lines are stacked on top of each other, it’s very hard to see how the emissions for a particular country have changed and it’s hard to compare countries. Instead, we can plot each country’s line without stacking, as the next plot illustrates (see it in color <a href="https://oreil.ly/erWuU">online</a>):</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in31.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Now it’s much easier to see changes for individual countries and to compare countries because we need judge only y-axis positions rather than short vertical segments with different baselines. We also used a log scale on the y-axis. We can now see that some countries have had flat rates of growth in CO<sub>2</sub> emissions, such as the United States and Japan, while others have increased much more quickly, like China and India, and Germany has slowed its CO<sub>2</sub> emissions. These aspects were nearly impossible to detect when each country’s baseline jiggled across the plot.</p>&#13;
&#13;
<p>In both of these plots, to make it easier to tell one country from the next, we have used different line types and colors. Choosing colors to facilitate comparisons relies on many considerations. This is the topic of the next section<a contenteditable="false" data-primary="" data-startref="ix_line_plot" data-type="indexterm" id="id1370"/><a contenteditable="false" data-primary="" data-startref="ix_stack_line_plot" data-type="indexterm" id="id1371"/><a contenteditable="false" data-primary="" data-startref="ix_co2_stack_line" data-type="indexterm" id="id1372"/><a contenteditable="false" data-primary="" data-startref="ix_bar_plot_dist" data-type="indexterm" id="id1373"/><a contenteditable="false" data-primary="" data-startref="ix_stack_bar_plot" data-type="indexterm" id="id1374"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Selecting a Color Palette" data-type="sect2"><div class="sect2" id="selecting-a-color-palette">&#13;
<h2>Selecting a Color Palette</h2>&#13;
&#13;
<p>Choosing<a contenteditable="false" data-primary="categorical data" data-secondary="color palette for" data-type="indexterm" id="id1375"/><a contenteditable="false" data-primary="numeric data" data-secondary="color palette for" data-type="indexterm" id="id1376"/><a contenteditable="false" data-primary="sequential color palette for numeric data" data-type="indexterm" id="id1377"/><a contenteditable="false" data-primary="color palette selection in visualizations" data-type="indexterm" id="id1378"/> colors also plays an important role in data visualization. We want to avoid overly bright or dark colors so that we don’t strain the reader’s eyes. We should also avoid color palettes that might be difficult for colorblind people—7% to 10% of people (mostly males) are red-green colorblind.</p>&#13;
&#13;
<p>For categorical data, we want to use a color palette that can clearly distinguish between categories. One example is shown at the top in <a class="reference internal" data-type="xref" href="#three-palettes">Figure 11-2</a>. From top to bottom, these palettes are qualitative for categorical data, diverging for numeric data where you want to draw attention to both large and small values, and sequential for numeric data where you want to emphasize either large or small values.</p>&#13;
&#13;
<figure><div class="figure" id="three-palettes"><img src="assets/leds_1102.png"/>&#13;
<h6><span class="label">Figure 11-2. </span>Three printer-friendly palettes from ColorBrewer 2.0 (see it in color <a href="https://oreil.ly/0ub2H">online</a>)</h6>&#13;
</div></figure>&#13;
&#13;
<p>For numeric data, we want to use a sequential color palette that emphasizes one side of the spectrum more than the other or a diverging color palette that equally emphasizes both ends of the spectrum and deemphasizes the middle. A sequential palette is shown at the bottom and a diverging palette is shown in the middle of <a class="reference internal" data-type="xref" href="#three-palettes">Figure 11-2</a>.</p>&#13;
&#13;
<p>We choose a sequential palette when we want to emphasize either low or high values, like cancer rates. We choose a diverging palette when we want to emphasize both extremes, like for two-party election results.</p>&#13;
&#13;
<p>It’s important to choose a perceptually uniform color palette. By this we mean that when a data value is doubled, the color in the visualization looks twice as colorful to the human eye. We also want to avoid colors that create an afterimage when we look from one part of the graph to another, colors of different intensities that make one attribute appear more important than another, and colors that colorblind people have trouble distinguishing between. We strongly recommend using a palette or a palette generator made specifically for data visualizations.</p>&#13;
&#13;
<p>Plots are meant to be examined for long periods of time, so we should choose colors that don’t impede the reader’s ability to carefully study a plot. Even more so, the use of color should not be gratuitous—colors should represent information. On a related note, people typically have trouble distinguishing between more than about seven colors, so we limit the number of colors in a plot. Finally, colors can appear quite different when printed on paper in grayscale than when viewed on a computer screen. When we choose colors, we keep in mind how our plots will be displayed.</p>&#13;
&#13;
<p>Making accurate comparisons in a visualization is such an important goal that researchers have studied how well people perceive differences in colors and other plotting features such as angles and lengths. This is the topic of the next section.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Guidelines for Comparisons in Plots" data-type="sect2"><div class="sect2" id="guidelines-for-comparisons-in-plots">&#13;
<h2>Guidelines for Comparisons in Plots</h2>&#13;
&#13;
<p>Researchers have studied how accurately people can read information displayed in different types of plots. They have found the following ordering, from most to least accurately judged:</p>&#13;
&#13;
<ul>&#13;
	<li>&#13;
	<p>Positions along a common scale, like in a rug plot, strip plot, or dot plot</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Positions on identical, nonaligned scales, like in a bar plot</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Length, like in a stacked bar plot</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Angle and slope, like in a pie chart</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Area, like in a stacked line plot or bubble chart</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Volume and density, like in a three-dimensional bar plot</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Color saturation and hue, like when overplotting with semitransparent points</p>&#13;
	</li>&#13;
</ul>&#13;
&#13;
<p>As an example<a contenteditable="false" data-primary="bar plots, data distribution" data-type="indexterm" id="id1379"/><a contenteditable="false" data-primary="pie charts, data distribution" data-type="indexterm" id="id1380"/><a contenteditable="false" data-primary="home sale prices example" data-type="indexterm" id="id1381"/>, here is a pie chart that shows the proportion of houses sold in San Francisco that have from one to eight or more bedrooms, and a bar chart with the same proportions:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in32.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>It’s hard to judge the angles in the pie chart, and the annotations with the actual percentages are needed. We also lose the natural ordering of the number of bedrooms. The bar chart doesn’t suffer from these issues.</p>&#13;
&#13;
<p>However, there are exceptions to any rule. Multiple pie charts with only two or three slices in each pie can provide effective visualizations. For example, a set of pie charts of the proportion of two-bedroom houses sold in each of six cities in the San Francisco East Bay Area, ordered according to the proportion, can be an impactful visualization. Yet, sticking with a bar chart will generally always be at least as clear as any pie chart.</p>&#13;
&#13;
<p>Given these guidelines, we recommend sticking to position and length for making comparisons. Readers can more accurately judge comparisons based on position or length, rather than angle, area, volume, or color. But, if we want to add additional information to a plot, we often use color, symbols, and line styles, in addition to position and length. We have shown several examples in this chapter.</p>&#13;
&#13;
<p>We next turn to the topic of data design and how to reflect the aspects of when, where, and how the data were collected in a visualization. This is a subtle but important topic. If we ignore the data scope, we can get very misleading plots<a contenteditable="false" data-primary="" data-startref="ix_vis_clarity_plot" data-type="indexterm" id="id1382"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Incorporating the Data Design" data-type="sect1"><div class="sect1" id="sec-viz-data-design">&#13;
<h1>Incorporating the Data Design</h1>&#13;
&#13;
<p>When we create a visualization<a contenteditable="false" data-primary="data scope" data-secondary="and data design" data-secondary-sortas="data design" data-type="indexterm" id="ix_scope_data_design"/><a contenteditable="false" data-primary="visualization, data" data-secondary="and data design" data-secondary-sortas="data design" data-type="indexterm" id="ix_vis_data_design"/><a contenteditable="false" data-primary="data design" data-type="indexterm" id="ix_data_design"/>, it’s important to consider the data scope, especially the data design (see <a class="reference internal" data-type="xref" href="ch02.html#ch-data-scope">Chapter 2</a>). Considering the question of how the data were collected can impact our plot choice and the comparisons we portray. These considerations include the time and place where the data were collected and the design used to select a sample. We look at a few examples of how the data scope can inform the visualizations we make.</p>&#13;
&#13;
<section data-pdf-bookmark="Data Collected Over Time" data-type="sect2"><div class="sect2" id="data-collected-over-time">&#13;
<h2>Data Collected Over Time</h2>&#13;
&#13;
<p>When data are collected<a contenteditable="false" data-primary="timestamps" data-type="indexterm" id="id1383"/><a contenteditable="false" data-primary="time, data collected over" data-type="indexterm" id="id1384"/><a contenteditable="false" data-primary="time series data, visualization" data-type="indexterm" id="id1385"/><a contenteditable="false" data-primary="times and dates" data-secondary="visualizing data category as time series" data-type="indexterm" id="id1386"/> over time, we typically make a line plot that puts timestamps on the x-axis and a feature of interest on the y-axis to look for trends in time. As an example, let’s revisit the data on San Francisco housing<a contenteditable="false" data-primary="home sale prices example" data-secondary="data collected over time" data-type="indexterm" id="id1387"/> prices. These data were collected from 2003 through 2008 and show the crash in 2008/2009 of the <a class="reference external" href="https://oreil.ly/PUPiQ">US housing bubble</a>. Since time is a key aspect of the scope of these data, let’s visualize sale price as a time series. Our earlier explorations showed that sale price is highly skewed, so let’s work with percentiles rather than averages. We plot the median price (this is a form of smoothing we saw earlier in this chapter):</p>&#13;
&#13;
<figure class="informal width-80"><div class="figure"><img src="assets/leds_11in33.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>This plot shows the rise in prices from 2003 to 2007 and the fall in 2008. But we can show more information by plotting a few additional percentiles instead of just the median. Let’s draw separate lines for the 10th, 30th, 50th (median), 70th, and 90th percentile sale prices. When we examine prices over time, we typically need to adjust for inflation so that the comparisons are on the same footing. In addition to adjusting for inflation, let’s plot the prices relative to the starting price in 2003 for each of the percentiles. This means that all the lines start at y = 1 in 2003. (A value of 1.5 for the 90th percentile in 2006 indicates that the sale price is 1.5 times the 90th percentile in 2003.) This normalization<a contenteditable="false" data-primary="normalization" data-secondary="home sale prices example" data-type="indexterm" id="id1388"/> lets us see how the housing crash affected home owners in the different parts of the market:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in34.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>When we follow the 10th percentile line plot over time, we see that it increases quickly in 2005, stays high relative to its 2003 value for a few years, and then drops earlier and more quickly than the other percentiles. This tells us that the less expensive houses, such as starter homes, suffered greater volatility and lost much more value in the housing market crash. In contrast, higher-end homes were affected less by the crash; at the end of 2008, the 90th percentile home prices were still higher than the 2003 prices. Applying this bit of domain knowledge helps reveal trends in the data that we might otherwise miss, and shows how we can use the data design to improve a visualization.</p>&#13;
&#13;
<p>The housing data are an example of observational data that form a complete census in a geographic region over a specific period of time. Next we consider another observational study where self-selection and the time period impact the visualization.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Observational Studies" data-type="sect2"><div class="sect2" id="observational-studies">&#13;
<h2>Observational Studies</h2>&#13;
&#13;
<p>We need to be particularly cautious with data<a contenteditable="false" data-primary="observational studies" data-type="indexterm" id="ix_obs_stud"/><a contenteditable="false" data-primary="Cherry Blossom race dataset" data-type="indexterm" id="ix_cherry_bloss2"/> that do not form a census or scientific sample. We should also take care with cross-sectional studies, whether from a census or scientific sample. For this example, we revisit the data from the Cherry Blossom 10-mile run. Earlier in this chapter, we made a smoothed curve to examine the relationship between race time and age. We reproduce this plot here to highlight a potential pitfall in interpretation:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in35.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>It’s tempting<a contenteditable="false" data-primary="cross-sectional versus longitudinal studies" data-type="indexterm" id="id1389"/><a contenteditable="false" data-primary="longitudinal versus cross-sectional studies" data-type="indexterm" id="id1390"/> to look at this plot and conclude that, for instance, a runner at age 60 can typically expect to take an additional 600 seconds to finish the run than when they were 40. However, this is a <em>cross-sectional</em> study, not a <em>longitudinal</em> study. The study does not follow people over time; instead, it gets a snapshot of a cross-section of people. The 60-year-old runners represented in the plot are different people than the 40-year-old runners. These two groups could be different in ways that affect the relationship between race time and age. As a group, the 60-year-olds in the race are likely to be fitter for their age than the 40-year-olds. In other words, the data design doesn’t let us make conclusions about individual runners. The visualization isn’t wrong, but we need to be careful about the conclusions we draw from it.</p>&#13;
&#13;
<p>The design is even more complex because we have race results from many years. Each year forms a cohort<a contenteditable="false" data-primary="cohort changes in data over time, accounting for" data-type="indexterm" id="id1391"/><a contenteditable="false" data-primary="times and dates" data-secondary="cohort changes in data over time" data-type="indexterm" id="id1392"/>, a group of racers, and from one year to the next, the cohort changes. We create a visualization that makes this message clear by comparing runners in different race years. Here, we’ve separately plotted lines for the runners in 1999, 2005, and 2010:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in36.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>We see that the median race times in 2010 are higher at every age group than the times for the runners in 2005, and in turn, the times are higher for the runners in 2005 than for the runners in 1999. It’s interesting that race times have slowed over the years. This is quite likely due to the increased popularity of the race, where there is higher participation from novice runners in more recent years. This example has shown how we need to be aware of the data scope when interpreting patterns. We also need to keep data scope in mind with scientific studies. This is the topic of the next section<a contenteditable="false" data-primary="" data-startref="ix_cherry_bloss2" data-type="indexterm" id="id1393"/><a contenteditable="false" data-primary="" data-startref="ix_obs_stud" data-type="indexterm" id="id1394"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Unequal Sampling" data-type="sect2"><div class="sect2" id="unequal-sampling">&#13;
<h2>Unequal Sampling</h2>&#13;
&#13;
<p>In a scientific study<a contenteditable="false" data-primary="samples and sampling" data-secondary="unequal" data-type="indexterm" id="id1395"/><a contenteditable="false" data-primary="unequal sampling" data-type="indexterm" id="id1396"/><a contenteditable="false" data-primary="DAWN (Drug Abuse Warning Network) survey" data-type="indexterm" id="id1397"/>, we must consider the sample design because it can impact our plots. Some samples draw individuals at unequal rates, and this needs to be accounted for in our visualizations. We saw an example of a scientific study in <a class="reference internal" data-type="xref" href="ch08.html#ch-files">Chapter 8</a> and <a class="reference internal" data-type="xref" href="ch09.html#ch-wrangling">Chapter 9</a>: the Drug Abuse Warning Network (DAWN) survey. These data are from a complex randomized study of drug-related emergency room visits, and each record comes with a weight that we must use in order to accurately represent the emergency room visits in the population. The two bar plots that follow show the distribution of the type of ER visit. (See them larger <a href="https://oreil.ly/LYAol">online</a>.) The one on the left doesn’t use the survey weights and the one on the right does:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in37.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>In the unweighted bar plot, the “Other” category is as frequent as the “Adverse reaction” category. However, when weighted, “Other” drops to about two-thirds of “Adverse reaction.” Ignoring sampling weights can give a misleading presentation of a distribution. Whether for a histogram, bar plot, box plot, two-dimensional contour, or smooth curve, we need to use the weights to get a representative plot. Another aspect of the data scope that can impact our choice of plots is where the data are collected, which is the topic of the next section.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Geographic Data" data-type="sect2"><div class="sect2" id="geographic-data">&#13;
<h2>Geographic Data</h2>&#13;
&#13;
<p>When our data<a contenteditable="false" data-primary="air quality sensors study" data-secondary="geographic data visualization" data-type="indexterm" id="id1398"/><a contenteditable="false" data-primary="maps to track geographic data" data-type="indexterm" id="id1399"/><a contenteditable="false" data-primary="geographic data" data-type="indexterm" id="id1400"/> contains geographic information like latitude and longitude, we should consider making a map, in addition to the typical plots. For example, the following map shows the locations for US air quality sensors, which is the focus of the case study in <a class="reference internal" data-type="xref" href="ch12.html#ch-pa">Chapter 12</a>:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in38.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Notice that there are many more points in California and the Eastern Seaboard. A simple histogram of air quality with data from all of these sensors would misrepresent the distribution of air quality in the US. To incorporate the spatial aspect into the distribution, we can add air quality measurements to the map with different color markers, and we can facet the histograms of air quality by location.</p>&#13;
&#13;
<p>In addition to plotting features like bars, color, and line styles, we also have the option to add text with contextual information to make our plot more informative. This is the topic of the next section<a contenteditable="false" data-primary="" data-startref="ix_vis_data_design" data-type="indexterm" id="id1401"/><a contenteditable="false" data-primary="" data-startref="ix_data_design" data-type="indexterm" id="id1402"/><a contenteditable="false" data-primary="" data-startref="ix_scope_data_design" data-type="indexterm" id="id1403"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Adding Context" data-type="sect1"><div class="sect1" id="ch-viz-context">&#13;
<h1>Adding Context</h1>&#13;
&#13;
<p>We have used text<a contenteditable="false" data-primary="visualization, data" data-secondary="adding context" data-type="indexterm" id="ix_vis_context"/><a contenteditable="false" data-primary="text" data-secondary="additions to visualization plots" data-type="indexterm" id="ix_text_vis"/><a contenteditable="false" data-primary="context information in visualization plots" data-type="indexterm" id="ix_context_plot"/> in our graphs throughout this chapter to provide meaningful axis labels that include units of measurement, tick-mark labels for categories, and titles. This is a good practice when sharing a visualization more broadly. A good goal is to include enough context in a plot that it can stand alone—a reader should be able to get the gist of the plot without needing to search for explanation elsewhere. That said, every element of a statistical graph should have a purpose. Superfluous<a contenteditable="false" data-primary="chartjunk" data-type="indexterm" id="id1404"/> text or plot features, often referred to as <em>chartjunk</em>, should be eliminated. In this section, we provide a brief overview of ways we can add helpful context to our plots and an example where we create a publication-ready plot by adding context.</p>&#13;
&#13;
<p>Text context<a contenteditable="false" data-primary="captions, text context in plots" data-type="indexterm" id="ix_cap_plot"/> includes <em>labels</em> and <em>captions</em>. It is a good practice to consistently use informative labels on tick marks and axes. For example, axis labels often benefit from including units of measurement. Graphs should contain titles and legends when needed. Informative labels are especially important for plots that other people will see and interpret. However, even when we’re doing exploratory data analysis just for us, we often want to include enough context that when we later return to an analysis we can easily figure out what we plotted.</p>&#13;
&#13;
<p>Captions serve several purposes. They describe what has been plotted and orient the reader. Captions also point out important features of the plot and comment on their implications. It’s OK for the caption to repeat information found in the text. Readers often skim a publication and focus on section headings and visualizations, so plot captions should be self-contained.</p>&#13;
&#13;
<p><em>Reference markers</em> bring additional context to the plotting region. Reference points and lines that provide benchmarks, historical values, and other external information help form comparisons and interpretations. For example, we often add a reference line with slope 1 to a quantile–quantile plot. We might also add a vertical line on a time-series plot to mark a special event, like a natural disaster.</p>&#13;
&#13;
<p>The following example demonstrates how to add these context elements to a plot.</p>&#13;
&#13;
<section class="pagebreak-before" data-pdf-bookmark="Example: 100m Sprint Times" data-type="sect2"><div class="sect2" id="example-100m-sprint-times">&#13;
<h2 class="less_space">Example: 100m Sprint Times</h2>&#13;
&#13;
<p>The following<a contenteditable="false" data-primary="100m sprint times dataset" data-primary-sortas="one hundred m sprint times dataset" data-type="indexterm" id="id1405"/> figure shows the race times in the men’s 100-meter sprint since 1968. These data include only races that were electronically timed and held outdoors in normal wind conditions, and the times included are only for those runners who came in under 10 seconds. The plot is a basic scatterplot showing race time against year. Beginning with this plot, we augment it to create a plot featured in a <a class="reference external" href="https://oreil.ly/pxHr4">FiveThirtyEight article</a> about the 100-meter sprint:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in39.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>When we want to prepare a plot for others to read, we consider the takeaway message. In this case, our main message is twofold: the best runners have been getting faster over the past 50 years, and Usain Bolt’s remarkable record time of 9.58 seconds set in 2009 remains untouched. (In fact, the second-best race time also belongs to Bolt.) We provide context to this plot by adding a title that directly states the main takeaway, units of measurement in the y-axis label, and annotations to key points in the scatterplot, including the two best race times that belong to Usain Bolt. In addition, we add a horizontal reference line at 10 seconds to clarify that only times below 10 seconds are plotted, and we use a special symbol for the world record time to draw the reader’s attention to this crucial point:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in40.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>These bits of context describe what we have plotted, help readers see the main takeaway, and point out several interesting features in the data. The plot can now be a useful part of a slideshow, technical report, or social media post. In our experience, people who look at our data analyses remember our plots, not paragraphs of text or equations. It’s important to go the extra mile and add context to the plots we prepare for others<a contenteditable="false" data-startref="ix_text_vis" data-type="indexterm" id="id1406"/><a contenteditable="false" data-startref="ix_cap_plot" data-type="indexterm" id="id1407"/><a contenteditable="false" data-startref="ix_context_plot" data-type="indexterm" id="id1408"/><a contenteditable="false" data-primary="" data-startref="ix_vis_context" data-type="indexterm" id="id1409"/>.</p>&#13;
&#13;
<p>In the next section, we move on to specifics on how to create plots using the <code>plotly</code> Python package.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Creating Plots Using plotly" data-type="sect1"><div class="sect1" id="ch-viz-plotly">&#13;
<h1>Creating Plots Using plotly</h1>&#13;
&#13;
<p>In this section<a contenteditable="false" data-primary="visualization, data" data-secondary="creating plots with plotly" data-type="indexterm" id="ix_vis_plotly_lib"/><a contenteditable="false" data-primary="plotly library" data-type="indexterm" id="ix_plotly_lib"/>, we cover the basics of the <code>plotly</code> Python package, the main tool we use in this book to create plots.</p>&#13;
&#13;
<p class="pagebreak-before less_space">The <code>plotly</code> package has several advantages over other plotting libraries. It creates interactive plots rather than static images. When you create a plot in <code>plotly</code>, you can pan and zoom to see parts of the plot that are too small to see normally. You can also hover over plot elements, like the symbols in a scatterplot, to see the raw data values. Also, <code>plotly</code> can save plots using the SVG file format, which means that images appear sharp even when zoomed in. If you’re reading this chapter in a PDF or paper copy of the book, we used this feature to render plot images. Finally, it has a simple “express” API for creating basic plots, which helps when you’re doing exploratory analysis and want to quickly create many plots.</p>&#13;
&#13;
<p>We go over the fundamentals of <code>plotly</code> in this section. We recommend using the <a class="reference external" href="https://plotly.com/python">official <code>plotly</code> documentation</a> if you encounter something that isn’t covered here.</p>&#13;
&#13;
<section data-pdf-bookmark="Figure and Trace Objects" data-type="sect2"><div class="sect2" id="figure-and-trace-objects">&#13;
<h2>Figure and Trace Objects</h2>&#13;
&#13;
<p>Every plot<a contenteditable="false" data-primary="Figure object" data-type="indexterm" id="id1410"/> in <code>plotly</code> is wrapped in a <code>Figure</code> object. <code>Figure</code> objects keep track of what to draw. For instance, a single <code>Figure</code> can draw a scatterplot on the left and a line plot on the right. <code>Figure</code> objects also keep track of the plot layout, which includes the plot’s size, title, legend, and annotations.</p>&#13;
&#13;
<p>The <code>plotly.express</code> module<a contenteditable="false" data-primary="plotly.express module" data-type="indexterm" id="id1411"/> provides a concise API for making plots:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="kn">import</code></span><code> </code><span><code class="nn">plotly</code><code class="nn">.</code><code class="nn">express</code></span><code> </code><span><code class="k">as</code></span><code> </code><span><code class="nn">px</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>We use <code>plotly.express</code> in the following<a contenteditable="false" data-primary="scatter() function" data-type="indexterm" id="id1412"/> code to make a scatterplot of weight against height for the data on dog breeds. Notice that the return value from <code>.scatter()</code> is a <code>Figure</code> object:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">scatter</code></span><span><code class="p">(</code></span><code>&#13;
</code><code>    </code><span><code class="n">dogs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">height</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">weight</code><code class="s2">"</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>    </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Height (cm)</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">weight</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Weight (kg)</code><code class="s2">"</code></span><span><code class="p">)</code><code class="p">,</code></span><code>&#13;
</code><code>    </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">,</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="vm">__class__</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
plotly.graph_objs._figure.Figure&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Displaying a <code>Figure</code> object renders it to the screen:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in41.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>This particular <code>Figure</code> holds one plot, but <code>Figure</code> objects can hold any number of plots. Here, we create a facet of three scatterplots:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="c1"># The plot titles are cut off; we'll fix them in the next snippet</code></span><code>&#13;
</code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">scatter</code></span><span><code class="p">(</code></span><span><code class="n">dogs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">height</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">weight</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>           </code><span><code class="n">facet_col</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">size</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>           </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Height (cm)</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">weight</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Weight (kg)</code><code class="s2">"</code></span><span><code class="p">)</code><code class="p">,</code></span><code>&#13;
</code><code>           </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">550</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in42.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>These three plots<a contenteditable="false" data-primary="facet plots" data-type="indexterm" id="id1413"/><a contenteditable="false" data-primary="functions" data-secondary="for faceted subplots" data-secondary-sortas=" faceted subplots" data-type="indexterm" id="id1414"/><a contenteditable="false" data-primary="Trace objects" data-type="indexterm" id="id1415"/> are stored in <code>Trace</code> objects. However, we try to avoid manipulating <code>Trace</code> objects manually. Instead, <code>plotly</code> provides functions that automatically create faceted subplots, like the <code>px.scatter</code> function we used here. Now that we have seen how to make a simple plot, we next show how to modify plots.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Modifying Layout" data-type="sect2"><div class="sect2" id="modifying-layout">&#13;
<h2>Modifying Layout</h2>&#13;
&#13;
<p>We often need to change<a contenteditable="false" data-primary="layout modification" data-type="indexterm" id="id1416"/><a contenteditable="false" data-primary="update_layout() method" data-type="indexterm" id="id1417"/> a figure’s layout. For instance, we might want to adjust the figure’s margins or the axis range. We can use the <code>Figure.update_layout()</code> method to do this. In the facet scatterplot that we made, the title is cut off because the plot doesn’t have large enough margins. We can correct this with <code>Figure.update_layout()</code>:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">scatter</code></span><span><code class="p">(</code></span><span><code class="n">dogs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">height</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">weight</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">facet_col</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">size</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Height (cm)</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">weight</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Weight (kg)</code><code class="s2">"</code></span><span><code class="p">)</code><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">550</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_layout</code></span><span><code class="p">(</code></span><span><code class="n">margin</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">t</code></span><span><code class="o">=</code></span><span><code class="mi">40</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in43.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The <code>.update_layout()</code> method lets us modify any property of a layout. This includes the plot title (<code>title</code>), margins (<code>margins</code> dictionary), and whether to display a legend (<code>showlegend</code>). The <code>plotly</code> documentation has the full list of <a class="reference external" href="https://oreil.ly/aBLxx">layout properties</a>.</p>&#13;
&#13;
<p><code>Figure</code> objects<a contenteditable="false" data-primary="update_yaxes() method" data-type="indexterm" id="id1418"/> also have <code>.update_xaxes()</code> and <code>.update_yaxes()</code> functions, which are similar to <code>.update_layout()</code>. These two functions let us modify properties of the axes, like the axis limits (<code>range</code>), number of ticks (<code>nticks</code>), and axis label (<code>title</code>). Here, we adjust the range of the y-axis and change the title on the x-axis. We also add a title to the plot and update the layout so that the title is not cut off:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">scatter</code></span><span><code class="p">(</code></span><code>&#13;
</code><code>    </code><span><code class="n">dogs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">weight</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">longevity</code><code class="s2">"</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>    </code><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Smaller dogs live longer</code><code class="s2">"</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>    </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">,</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_yaxes</code></span><span><code class="p">(</code></span><span><code class="nb">range</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="mi">5</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">18</code></span><span><code class="p">]</code><code class="p">,</code></span><code> </code><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Typical lifespan (yr)</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_xaxes</code></span><span><code class="p">(</code></span><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Average weight (kg)</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_layout</code></span><span><code class="p">(</code></span><span><code class="n">margin</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">t</code></span><span><code class="o">=</code></span><span><code class="mi">30</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_11in44.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The <code>plotly</code> package comes with many plotting methods; we describe several of them in the next section.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Plotting Functions" data-type="sect2"><div class="sect2" id="plotting-functions">&#13;
<h2>Plotting Functions</h2>&#13;
&#13;
<p>The <code>plotly</code> methods<a contenteditable="false" data-primary="functions" data-secondary="for plotting" data-secondary-sortas="plotting" data-type="indexterm" id="ix_func_plot"/> includes line plots, scatterplots, bar plots, box plots, and histograms. The API is similar for each type of plot. The dataframe is the first argument. Then we can specify a column of the dataframe to place on the x-axis and a column to place on the y-axis using the <code>x</code> and <code>y</code> keyword arguments.</p>&#13;
&#13;
<p>We begin with a line plot<a contenteditable="false" data-primary="Cherry Blossom race dataset" data-type="indexterm" id="id1419"/> of median time each year for the runners in the Cherry Blossom race:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">line</code></span><span><code class="p">(</code></span><span><code class="n">medians</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">time</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_11in45.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Next, we make<a contenteditable="false" data-primary="dog breeds dataset" data-secondary="plotting functions" data-type="indexterm" id="id1420"/> a bar plot of average longevity for different size dog breeds:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">lifespans</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">dogs</code></span><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">size</code><code class="s1">'</code></span><span><code class="p">)</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">longevity</code><code class="s1">'</code></span><span><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">mean</code></span><span><code class="p">(</code><code class="p">)</code></span><span><code class="o">.</code></span><span><code class="n">reset_index</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">bar</code></span><span><code class="p">(</code></span><span><code class="n">lifespans</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">size</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">longevity</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>       </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_11in46.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Plotting methods<a contenteditable="false" data-primary="facet plots" data-type="indexterm" id="id1421"/> in <code>plotly</code> also contain arguments for making facet plots. We can facet using color on the same plot, plotting symbol, or line style. Or we can facet into multiple subplots. Following are examples of each. We first make a scatterplot of height and weight of dog breeds and use different plotting symbols and colors to facet within the plot by size:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">scatter</code></span><span><code class="p">(</code></span><span><code class="n">dogs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">height</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">weight</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>                 </code><span><code class="n">color</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">size</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">symbol</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">size</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Height (cm)</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>                             </code><span><code class="n">weight</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Weight (kg)</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">size</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Size</code><code class="s2">"</code></span><span><code class="p">)</code><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_11in47.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The next plot shows side-by-side histograms of longevity for each breed size. Here we facet by columns:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">histogram</code></span><span><code class="p">(</code></span><span><code class="n">dogs</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">longevity</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">facet_col</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">size</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                   </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">550</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_layout</code></span><span><code class="p">(</code></span><span><code class="n">margin</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">t</code></span><span><code class="o">=</code></span><span><code class="mi">30</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_11in48.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>For the complete list of plotting functions, see the main documentation for <a class="reference external" href="https://oreil.ly/GxvpT"><code>plotly</code></a> or <a class="reference external" href="https://oreil.ly/DhU9j"><code>plotly.express</code></a>, the submodule of <code>plotly</code> that we primarily use in the book.</p>&#13;
&#13;
<p>To add context to a plot, we use the <code>plotly</code> annotation methods; these are described next<a contenteditable="false" data-primary="" data-startref="ix_func_plot" data-type="indexterm" id="id1422"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Annotations" data-type="sect2"><div class="sect2" id="annotations">&#13;
<h2>Annotations</h2>&#13;
&#13;
<p>The <code>Figure.add_annotation()</code> method<a contenteditable="false" data-primary="add_annotation() method" data-type="indexterm" id="id1423"/><a contenteditable="false" data-primary="annotations for plots" data-type="indexterm" id="id1424"/> places annotations on a <code>plotly</code> figure. These annotations are line segments with text and an optional arrow. The location of the arrow is set using the <code>x</code> and <code>y</code> parameters, and we can shift the text from its default position using the <code>ax</code> and <code>ay</code> parameters. Here, we annotate the scatter diagram with information about one of the points:</p>&#13;
&#13;
&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
	<code class="n">fig</code> <code class="o">=</code> <code class="n">px</code><code class="o">.</code><code class="n">scatter</code><code class="p">(</code><code class="n">dogs</code><code class="p">,</code> <code class="n">x</code><code class="o">=</code><code class="s1">'weight'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s1">'longevity'</code><code class="p">,</code>&#13;
					 <code class="n">labels</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">weight</code><code class="o">=</code><code class="s2">"Weight (kg)"</code><code class="p">,</code> &#13;
					 <code class="n">longevity</code><code class="o">=</code><code class="s2">"Typical lifespan (yr)"</code><code class="p">),</code>&#13;
					 <code class="n">width</code><code class="o">=</code><code class="mi">350</code><code class="p">,</code> <code class="n">height</code><code class="o">=</code><code class="mi">250</code><code class="p">)</code>&#13;
	&#13;
	<code class="n">fig</code><code class="o">.</code><code class="n">add_annotation</code><code class="p">(</code><code class="n">text</code><code class="o">=</code><code class="s1">'Chihuahuas live 16.5 years on average!'</code><code class="p">,</code>&#13;
					   <code class="n">x</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="mf">16.5</code><code class="p">,</code>&#13;
					   <code class="n">ax</code><code class="o">=</code><code class="mi">30</code><code class="p">,</code> <code class="n">ay</code><code class="o">=</code><code class="mi">5</code><code class="p">,</code>&#13;
					   <code class="n">xshift</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code>&#13;
					   <code class="n">xanchor</code><code class="o">=</code><code class="s1">'left'</code><code class="p">)</code>&#13;
	<code class="n">fig</code>&#13;
	</pre>&#13;
&#13;
<figure class="informal width-70"><div class="figure"><img src="assets/leds_11in49.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>This section covered the basics of creating plots using the <code>plotly</code> Python package. We introduced the <code>Figure</code> object, which is the object <code>plotly</code> uses to store plots and their layouts. We covered the basic plot types that <code>plotly</code> makes available, and a few ways to customize plots by adjusting the layout and axes and by adding annotations. In the next section, we briefly compare <code>plotly</code> to other common tools for creating visualizations in Python<a contenteditable="false" data-primary="" data-startref="ix_plotly_lib" data-type="indexterm" id="id1425"/><a contenteditable="false" data-primary="" data-startref="ix_vis_plotly_lib" data-type="indexterm" id="id1426"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Other Tools for Visualization" data-type="sect1"><div class="sect1" id="ch-viz-other-tools">&#13;
<h1>Other Tools for Visualization</h1>&#13;
&#13;
<p>There are many software packages and tools for creating data visualizations. In this book, we primarily use <code>plotly</code>. But it’s worth knowing about a few other commonly used tools. In this section, we compare <code>plotly</code> to <code>matplotlib</code> and to the grammar of graphics tools.</p>&#13;
&#13;
<section data-pdf-bookmark="matplotlib" data-type="sect2"><div class="sect2" id="matplotlib">&#13;
<h2>matplotlib</h2>&#13;
&#13;
<p>The library <a class="reference external" href="https://matplotlib.org/"><code>matplotlib</code></a> is one of the first data visualization<a contenteditable="false" data-primary="visualization, data" data-secondary="matplotlib library" data-type="indexterm" id="id1427"/><a contenteditable="false" data-primary="matplotlib library" data-type="indexterm" id="id1428"/> tools created for Python. Because of this, it is widely used and has a large ecosystem of packages. Notably, the built-in plotting methods for <code>pandas DataFrames</code> make plots using <code>matplotlib</code>. One popular package that builds on top of <code>matplotlib</code> is called <a class="reference external" href="https://seaborn.pydata.org"><code>seaborn</code></a>. Compared to <code>matplotlib</code> alone, <code>seaborn</code> provides a much simpler API to create statistical plots, like dot plots with confidence intervals. In fact, <code>seaborn</code>’s API was used as an inspiration for <code>plotly</code>’s API. If you look at <code>plotly</code> code and <code>seaborn</code> code side by side, you’ll find that the methods to create basic plots use similar code.</p>&#13;
&#13;
<p>One advantage of using <code>matplotlib</code> is its popularity. It’s relatively easy to find help creating or fine-tuning plots online because many existing projects use it. For this book, the main advantage of using <code>plotly</code> is that the plots we create are interactive. Plots in <code>matplotlib</code> are usually static images, which don’t allow for panning, zooming, or hovering over marks. Still, we expect that <code>matplotlib</code> will continue to be used for data analyses. In fact, several of the plots in this book were made using <code>seaborn</code> and <code>matplotlib</code> because <code>plotly</code> doesn’t yet support all the plots we want to make.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Grammar of Graphics" data-type="sect2"><div class="sect2" id="grammar-of-graphics">&#13;
<h2>Grammar of Graphics</h2>&#13;
&#13;
<p>The <a class="reference external" href="https://dl.acm.org/doi/book/10.5555/1088896">grammar of graphics</a> is a theory<a contenteditable="false" data-primary="Wilkinson, Lee" data-type="indexterm" id="id1429"/><a contenteditable="false" data-primary="visualization, data" data-secondary="grammar of graphics theory" data-type="indexterm" id="id1430"/><a contenteditable="false" data-primary="grammar of graphics theory" data-type="indexterm" id="id1431"/> developed by Lee Wilkinson for creating data visualizations. The basic idea is to use common building blocks for making plots. For instance, a bar plot and a dot plot are nearly identical, except that a bar plot draws rectangles and a dot plot draws points. This idea is captured in the grammar of graphics, which would say that a bar plot and a dot plot differ only in their “geometry” component. The grammar of graphics is an elegant system that we can use to describe nearly every kind of plot we wish to make.</p>&#13;
&#13;
<p>This system<a contenteditable="false" data-primary="Vega library, JavaScript" data-type="indexterm" id="id1432"/><a contenteditable="false" data-primary="ggplot2 library, R language" data-type="indexterm" id="id1433"/> is implemented in the popular plotting libraries <a class="reference external" href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a> for the R programming language and <a class="reference external" href="https://vega.github.io/vega"><code>Vega</code></a> for JavaScript. <a class="reference external" href="https://altair-viz.github.io"><code>Vega-Altair</code></a>, a Python package, provides a way to create <code>Vega</code> plots using Python, and we encourage interested readers to look over its documentation.</p>&#13;
&#13;
<p>Using a grammar<a contenteditable="false" data-primary="Vega-Altair library" data-type="indexterm" id="id1434"/> of graphics tool like <code>Vega-Altair</code> enables flexibility in visualizations. And like <code>plotly</code>, <code>altair</code> also creates interactive visualizations. However, the Python API for these tools can be less straightforward than <code>plotly</code>’s API. In this book, we don’t typically need plots outside of what <code>plotly</code> is capable of creating, so we have opted for <code>plotly</code>’s simpler API.</p>&#13;
&#13;
<p>There are many more plotting tools for Python that we’ve left out for brevity. But for the purposes of this book, relying on <code>plotly</code> provides a useful balance of interactivity and flexibility.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="ch-viz-summary">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>When we analyze a dataset, we use visualizations to uncover patterns in the data that are difficult to detect otherwise. Data visualization is an iterative process. We create a plot, then decide whether to make adjustments or choose an entirely new type of plot. This chapter covered principles that we use to make these decisions.</p>&#13;
&#13;
<p>We started by covering principles of scale, and saw how adjusting the scale by changing or transforming plot axes can reveal hidden structure in the data. We then discussed smoothing and aggregating techniques that help us work with large datasets that would otherwise result in overplotting. To facilitate meaningful comparisons, we applied principles of perception, like aligning baselines to make lines, bars, and points easier to compare. We showed how to take the data design into account to improve visualizations. And we saw how adding context to a plot helps a reader understand our message.</p>&#13;
&#13;
<p>After this chapter, you should be able to create a plot and understand what kinds of adjustments would make the plot more effective. As you learn how to make informative visualizations, be patient and iterate. None of us make the perfect plot on the first try, and as we make discoveries in an analysis, we continue to refine our plots. Then, when it comes time to present our findings to others, we sift through our work to get the few plots that best convince our future reader of the correctness and importance of our analysis. This can even lead to the creation of a new plot that better conveys our findings, which we iteratively develop<a contenteditable="false" data-primary="" data-startref="ix_vis_data_ch11" data-type="indexterm" id="id1435"/>.</p>&#13;
&#13;
<p>In the next chapter, we walk through an extended case study that combines everything we’ve learned in the book so far. We hope that you find yourself surprised by how much you can already do.</p>&#13;
</div></section>&#13;
<div data-type="footnotes"><p data-type="footnote" id="id1365"><sup><a href="ch11.html#id1365-marker">1</a></sup> US government surveys still collect data based on a binary definition of gender, but progress is being made. For example, starting in 2022, US citizens are allowed to select an “X” as their gender marker on their passport application.</p></div></div></section></body></html>