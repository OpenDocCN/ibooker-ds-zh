- en: Chapter 11\. Introduction to Moderation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: One of the most gratifying aspects of combining the causal and behavioral perspectives
    is that things that may seem entirely unrelated under one of them can turn out
    to be the exact same thing under the other. More simply put, when you have the
    right hammer, a lot of things *are indeed nails*.
  prefs: []
  type: TYPE_NORMAL
- en: 'So far, we’ve used causal diagrams to understand what drives behaviors on average:
    if temperature increases by one degree, keeping all the relevant other variables
    constant, by how much do sales of ice cream in C-Mart stands increase? But very
    often, we’re not just interested in that grand average, and we would like to break
    it down further:'
  prefs: []
  type: TYPE_NORMAL
- en: Does that number apply equally to the stands in Texas and Wisconsin? If not,
    this means our data shows an opportunity for *segmentation*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Does that number apply equally for chocolate and vanilla ice cream? If not,
    this means that there is an *interaction* between temperature and ice cream flavor.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Does that number apply equally at low and high temperatures? If not, this means
    that there is a *nonlinearity* in the effect of temperatures on sales.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The hammer we’ll see in this chapter is called moderation analysis by social
    scientists, and it will allow us to address these three types of questions in
    the exact same way.
  prefs: []
  type: TYPE_NORMAL
- en: In the first section after reviewing the data and packages for this chapter,
    we’ll do a tour of moderation and see how it can apply to a variety of behavioral
    situations. Because the math remains the same in all cases, I have gathered all
    practical and technical considerations to review in the last section.
  prefs: []
  type: TYPE_NORMAL
- en: Data and Packages
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The [GitHub folder for this chapter](https://oreil.ly/BehavioralDataAnalysisCh11)
    contains the CSV file *chap11-historical_data.csv* with the variables listed in
    [Table 11-1](#variables_in_our_data-id00084).
  prefs: []
  type: TYPE_NORMAL
- en: Table 11-1\. Variables in our data
  prefs: []
  type: TYPE_NORMAL
- en: '| Variable name | Variable description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| *Day* | Day index, 1-20 |'
  prefs: []
  type: TYPE_TB
- en: '| *Store* | Store index, 1-50 |'
  prefs: []
  type: TYPE_TB
- en: '| *Children* | Binary 0/1, whether the customer is accompanied by young children
    |'
  prefs: []
  type: TYPE_TB
- en: '| *Age* | Customer age, 20-80 |'
  prefs: []
  type: TYPE_TB
- en: '| *VisitDuration* | Duration of store visit in minutes, 3-103 |'
  prefs: []
  type: TYPE_TB
- en: '| *PlayArea* | Binary 0/1, store level, whether the store has a play area |'
  prefs: []
  type: TYPE_TB
- en: '| *GroceriesPurchases* | Amount spent on groceries purchases during visit in
    dollars, 0-324 |'
  prefs: []
  type: TYPE_TB
- en: In this chapter, we’ll only use the common packages so there are no chapter-specific
    ones.
  prefs: []
  type: TYPE_NORMAL
- en: Behavioral Varieties of Moderation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The formal definition of moderation is extremely simple: it’s the inclusion
    in a regression of a multiplication between two predictors. For example, I suggested
    earlier that sales of ice cream may increase more or less per degree of temperature
    in Texas and Wisconsin; this would be expressed mathematically as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '*IceCreamSales* = *β[t]*.*Temperature* + *β[s].State* + *β[ts]*.(*Temperature*
    * *State*)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Moderation can be used to understand all of the following behavioral phenomena,
    which we’ll review in turn:'
  prefs: []
  type: TYPE_NORMAL
- en: Segmentation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Interactions
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Nonlinearities (a.k.a. self-moderation)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Segmentation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Building relevant customer segments is a key task in marketing analytics, and
    more broadly business analytics. We’ll review how to do it with observational
    data, then with experimental data.
  prefs: []
  type: TYPE_NORMAL
- en: Segmenting observational data
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Our starting point will be a C-Mart example: the company has recently introduced
    play areas in some of its stores and is interested in understanding how it affected
    customer visit duration. Regression analysis supported by causal diagrams gives
    us an average causal effect: across all the customer visits in our data, what
    is the effect on visit duration of having a play area in the store? However, averages
    can be misleading and hide large differences between segments of our population.
    For example, it makes sense to assume that the presence of a play area influences
    visit duration more for customers with children. How should we account for that
    in our regression? You might think that simply including *Children* as another
    predictor of *VisitDuration* would do the trick, as in [Figure 11-1](#including_children_as_a_predictor_of_vi).'
  prefs: []
  type: TYPE_NORMAL
- en: '![Including Children as a predictor of VisitDuration](Images/BEDA_1101.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-1\. Including Children as a predictor of VisitDuration
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'The problem with that approach is that it accounts for the impact of *Children*
    on *VisitDuration*, *regardless of whether there is a play area or not*, and vice
    versa: when doing a regression, each variable is examined independently. Each
    coefficient is set such that overall residual distances are minimized, but the
    coefficients have to be the same for each variable regardless of the values of
    other variables. That means that the coefficient, and thus the measured effect,
    of *PlayArea* on *VisitDuration* is mathematically forced to be a weighted average
    of its effect for customers with and without children. Likewise, the effect of
    customers having children is measured as a weighted average of the effects when
    there is a play area present and when there is not. This can be confirmed by looking
    at the corresponding equations. The equation for the CD we just drew is shown
    in [Equation 11-1](#eqtn1) (including the constant coefficient *β*[0], which we
    usually omit for simplicity).'
  prefs: []
  type: TYPE_NORMAL
- en: Equation 11-1\.
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: '*VisitDuration* = *β*[0] + *β[p].PlayArea* + *β[c].Children*'
  prefs: []
  type: TYPE_NORMAL
- en: 'Because *PlayArea* and *Children* are both binary variables, we have four possible
    cases depending on whether each one of them is equal to 0 or 1:'
  prefs: []
  type: TYPE_NORMAL
- en: '*β*[0] is the average visit duration for customers without children in stores
    without a play area (which we’ll abbreviate as C = 0, P = 0 for brevity).'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*β*[0] + *β[c]* is the average visit duration for customers with children in
    stores without a play area (C = 1, P = 0).'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*β*[0] + *β[p]* is the average visit duration for customers without children
    in stores with a play area (C = 0, P = 1).'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*β*[0] + *β[p]* + *β[c]* is the average visit duration for customers with children
    in stores with a play area (C = 1, P = 1).'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'This means that whether a customer has children with them or not doesn’t affect
    the impact of adding a play area, as we can easily check:'
  prefs: []
  type: TYPE_NORMAL
- en: 'If *Children* = 0, the impact of adding a play area is:'
  prefs: []
  type: TYPE_NORMAL
- en: '*VisitDuration(C* = [0], *P* = 1) - *VisitDuration(C* = 0, *P* = 0) = (*β*[0]
    + *β[p]*) - (*β*[0]) = *β[p]*'
  prefs: []
  type: TYPE_NORMAL
- en: 'If *Children* = 1, the impact of adding a play area is:'
  prefs: []
  type: TYPE_NORMAL
- en: '*VisitDuration(C* = 1, *P* = 1) - *VisitDuration(C* = 1, *P* = 0) = (*β*[0]
    + *β[c]* + *β[p]*) - (*β*[0] + *β[c]*) = *β[p]*'
  prefs: []
  type: TYPE_NORMAL
- en: 'The difference between these two equations (i.e., how much *more* adding a
    play area increases visit duration for customers with children compared to customers
    without children) is by definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '[(*β*[0] + *β[c]* + *β[p]*) - (*β*[0])] - [(*β*[0] + *β[p]*) - (*β*[0])] =
    *β[p]* - *β[p]* = 0'
  prefs: []
  type: TYPE_NORMAL
- en: An equivalent way of looking at the problem is that we have four equations,
    with four corresponding averages, but only three coefficients. Once we have set
    *β*[0] , *β[c]*, and *β[p]* based on the first three equations, if it so happens
    that the average visit duration for (C = 1, P =1 ) is not equal to *β*[0] + *β[p]*
    + *β[c]*, we’re stuck. Our algorithm will do its best to find the values that
    minimize the error in our regression, but our estimates will be biased. Unfortunately,
    that’s precisely the case we’re trying to account for! In other words, simply
    adding *Children* as a variable in our regression doesn’t account for the interaction
    between *Children* and *PlayArea*. There is no way for us to determine through
    these equations whether the presence of a play area influences visit duration
    more for customers with children.
  prefs: []
  type: TYPE_NORMAL
- en: This is where moderation comes in. We can solve our problem by adding a fourth
    coefficient, for the interaction of *PlayArea* and *Children* (shown in [Equation
    11-2](#eqtn2)).
  prefs: []
  type: TYPE_NORMAL
- en: Equation 11-2\.
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: '*VisitDuration* = *β*[0] + *β[p].PlayArea* + *β[c].Children* + *β[i].(PlayArea*
    * *Children*)'
  prefs: []
  type: TYPE_NORMAL
- en: 'The equation for (C = 1, P = 1) becomes *VisitDuration* = *β*[0] + *β[p]* +
    *β[c]* + *β[i]* and we can adjust the coefficient *β[i]* to account for the interaction
    effect. Now we have:'
  prefs: []
  type: TYPE_NORMAL
- en: If *Children* = 0, the impact of adding a play area is (*β*[0] + *β[p]*) - (*β*[0])
    = *β[p]*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If *Children* = 1, the impact of adding a play area is (*β*[0] + *β[c]* + *β[p]*
    + *β[i]*) - (*β*[0] + *β[c]*) = *β[p]* + *β[i]*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The difference between these two equations is:'
  prefs: []
  type: TYPE_NORMAL
- en: '[(*β*[0] + *β[c]* + *β[p]* + *β[i]*) - (*β*[0])] - [(*β*[0] + *β[p]* + *β[i]*)
    - (*β*[0])] = *β[p]* + *β[i]* - *β[p]* = *β[i]*'
  prefs: []
  type: TYPE_NORMAL
- en: Adding a play area increases visit duration by *β[i]* minutes *more* for customers
    with children than for customers without children.
  prefs: []
  type: TYPE_NORMAL
- en: The multiplication term in [Equation 11-2](#eqtn2) is traditionally represented
    in a CD by an arrow ending in the middle of the original arrow ([Figure 11-2](#the_effect_of_playarea_on_visitduratio)).
    In that case, the variable *Children* is called the *moderator*, and the relationship
    between *PlayArea* and *VisitDuration* is *moderated*.
  prefs: []
  type: TYPE_NORMAL
- en: '![The effect of PlayArea on VisitDuration is moderated by the customers having
    children with them](Images/BEDA_1102.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-2\. The effect of PlayArea on VisitDuration is moderated by the customers
    having children with them
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Regression software recognizes moderation, and usually includes a shortcut:
    if you include only the product of two variables, the software will recognize
    that you want to calculate coefficients for the individual variables as well:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'When you use the shortcut described in the preceding, your software of choice
    will add *PlayArea* and *Children* as individual predictors of *VisitDuration*,
    and estimate [Equation 11-2](#eqtn2) as a result. Wouldn’t it be better to estimate
    instead the equation without *Children* as a separate term? That is:'
  prefs: []
  type: TYPE_NORMAL
- en: '*VisitDuration* = *β*[0] + *β[p].PlayArea* + *β[i].(PlayArea * Children)*'
  prefs: []
  type: TYPE_NORMAL
- en: 'Short answer: no. For more details, see reference works such as Hayes (2017),
    but basically for the coefficients to mean what you want them to, include in your
    regression the moderator and moderated variables as individual variables too,
    even if their coefficients are not economically or statistically significant.
    Don’t override your software to remove them; this is a feature, not a bug.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The coefficients in this regression match the averages for the four cases we’ve
    listed:'
  prefs: []
  type: TYPE_NORMAL
- en: The average visit duration for a customer without children in a store without
    a play area is *β*[0] , the coefficient for the intercept, i.e., 20 minutes.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The average visit duration for a customer without children in a store with a
    play area is *β*[0] + *β[p]*, the sum of the coefficients for the intercept and
    *PlayArea*, i.e., around 20 + 4 = 24 minutes.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The average visit duration for a customer with children in a store without a
    play area is *β*[0] + *β[c]*, the sum of the coefficients for the intercept and
    *Children*, i.e., around 20 + 10 = 30 minutes.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The average visit duration for a customer with children in a store with a play
    area is *β*[0] + *β[c]* + *β[p]* + *β[i]*, the sum of the coefficients for the
    intercept, *PlayArea*, *Children*, and the interaction term between *PlayArea*
    and *Children*, around 20 + 4 + 10 + 21 = 55 minutes.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In other words, having a play area has a big impact on the average visit duration
    of customers with children, and a much smaller but non-negligible impact on the
    average visit duration of customers without children (the relaxation of shopping
    tantrum-free, maybe).
  prefs: []
  type: TYPE_NORMAL
- en: This can be represented visually, as in [Figure 11-3](#visual_representation_of_moderation).
    The values for the *Children* variable are on the x-axis, and *VisitDuration*
    is on the y-axis, and we have two lines, one for each possible value of *PlayArea*.
    In other words, the four points at the extremities of the two lines represent
    the four cases we just saw, and their y values match the coefficients.
  prefs: []
  type: TYPE_NORMAL
- en: If there was no interaction effect between our two variables, the two lines
    would be parallel, as having a play area would shift the average visit duration
    upward by the same increment. The fact that they’re not parallel demonstrates
    that *PlayArea* has a bigger impact on customers with children.
  prefs: []
  type: TYPE_NORMAL
- en: '![Visual representation of moderation](Images/BEDA_1103.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-3\. Visual representation of moderation
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: If you want to connect this figure back to our math, the distance between the
    two points on the left (for C = 0) is equal to *β[p]* while the distance between
    the two points on the right (C = 1) is *β[p]* + *β[i]*.
  prefs: []
  type: TYPE_NORMAL
- en: Insights from moderation analysis allow us to better target our actions, e.g.,
    if C-Mart wants to determine in which stores to build play areas next. While the
    individual coefficient *β[p]* is relevant to determine if a play area would pay
    for itself in general, it is completely irrelevant for store prioritization. Choosing
    between stores requires determining the store and customer characteristics that
    have the strongest interactions with the *PlayArea* variable, and then determining
    which store would yield the highest “lift” from the addition of a play area.
  prefs: []
  type: TYPE_NORMAL
- en: Alternatively, in stores that already have a play area, moderation analysis
    would allow C-Mart to determine which potential customers to target with a mailing
    touting the presence of a play area.
  prefs: []
  type: TYPE_NORMAL
- en: Segmenting experimental data
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The process to segment experimental data is pretty much identical to the process
    we just used with observational data. Therefore I will not repeat the quantitative
    analyses and I’ll just point out some nuances and subtleties to keep in mind.
  prefs: []
  type: TYPE_NORMAL
- en: When running an experiment, we often care not only about measuring the average
    effect of the treatment in our sample, but also about determining groups for which
    the effect is particularly strong or weak. Sending a letter or training an employee
    can be costly; even if financial costs are negligible, as with emails, there might
    be intangible costs such as annoying a customer. As a result, we generally want
    to apply a treatment only to the people for which it works.
  prefs: []
  type: TYPE_NORMAL
- en: Beyond cost considerations, personalization is a key rationale for targeting
    specific messages or treatments to specific segments of our customer base. The
    very idea of personalized messaging is that individuals outside of the target
    segment will not react, or may even react negatively to the message. If you have
    a message that appeals to everyone, good for you, but that’s not personalization.
    For example, a coupon for pro ice-skating blades may annoy the vast majority of
    people who have no use for it. An ad targeting outdoorsy types may antagonize
    quiet bookworms and vice versa. Personalization means that you’re trading increasing
    effectiveness on a certain subgroup for decreased effectiveness on another one.
  prefs: []
  type: TYPE_NORMAL
- en: 'In marketing analytics, this approach is often referred to as “uplift” analysis
    or modeling, because we’re trying to identify the groups of customers for which
    a given campaign or treatment increases their propensity to take action the most
    (e.g., buying or voting), *regardless of their initial propensity*. That last
    point is often a source of confusion so it’s worth elaborating: identifying customers
    with a high propensity can have its uses, but it should not be used as a basis
    for targeting by itself.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s say you compare younger customers (below 30 years old) and older customers
    (above 60 years old):'
  prefs: []
  type: TYPE_NORMAL
- en: The first group has a probability to take action of 20% if they’re not emailed,
    and 40% if they’re emailed.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The second group has a probability to take action of 80% if they’re not emailed,
    and 90% if they’re emailed.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Emailing the first group, the younger customers, would be much more effective
    on average than emailing the second group, the older customers: it would increase
    by a larger number the total number of customers taking action.'
  prefs: []
  type: TYPE_NORMAL
- en: However, that fact can often be obscured in real life by the lack of a proper
    control group. If you were to email the second group only and compare their behavior
    with the rest of the population it would dramatically inflate the apparent effectiveness
    of the email campaign.
  prefs: []
  type: TYPE_NORMAL
- en: Mathematically, identifying a group with a high effectiveness of treatment means
    finding demographic variables that are moderators of the effect of the treatment
    variable on the effect of interest. In that sense, moderation analysis offers
    us a strong and unified conceptual framework to think about uplift analysis, personalization,
    and more generally targeting.
  prefs: []
  type: TYPE_NORMAL
- en: Interactions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The CD we drew to represent segmentation was asymmetrical: the variable *PlayArea*
    has an arrow going directly to *VisitDuration*, whereas the variable *Children*
    has an arrow going to the first arrow. However, our regression equation is perfectly
    symmetrical; nothing indicates which of the two variables is the moderator and
    which is moderated. Technically speaking, we could interpret [Equation 11-2](#eqtn2)
    to mean that *Children* is the cause and *PlayArea* is the moderator.'
  prefs: []
  type: TYPE_NORMAL
- en: Is one of these representations more “right” than the other? When we have an
    individual characteristic and a business or behavioral variable involved in moderation,
    as is the case here, we generally represent the individual characteristic (e.g.,
    having children) as the moderator, and refer to it as segmentation. That is, the
    effect of a play area is different between the segment of customers with children
    and the segment of customers without children.
  prefs: []
  type: TYPE_NORMAL
- en: On the other hand, if we have moderation between two variables of the same type,
    such as two individual characteristics or two business interventions, it doesn’t
    make sense to introduce an asymmetry between them. For example, we may imagine
    that having a play area and having a lounge area both increase visit duration
    independently (the play area for customers with children, and the lounge area
    for customers without children), but having the two together has a bigger effect
    than the sum of their individual effects, because customers with children can
    now use the lounge area. In such circumstances, we can represent moderation by
    joining arrows together as in [Figure 11-4](#representing_symmetrical_interactions),
    and refer to it as *interaction*.
  prefs: []
  type: TYPE_NORMAL
- en: '![Representing symmetrical interactions](Images/BEDA_1104.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-4\. Representing symmetrical interactions
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'The equation for this CD would be:'
  prefs: []
  type: TYPE_NORMAL
- en: '*VisitDuration* = *β*[0] + *β[p].PlayArea* + *β[l].LoungeArea* + *β[p][l].(PlayArea
    * LoungeArea*)'
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, the equation is exactly the same as for segmentation, and if
    we wanted we could call *LoungeArea* the moderator of the effect of *PlayArea*
    on *VisitDuration* (or vice versa). Conceptually, interactions let us think about
    situations where “the whole is more than the sum of the parts,” such as complementary
    behaviors.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: On a side note, it is my belief that some of the power of newer and more complex
    machine learning methods like random forests, XGBoost, or neural networks comes
    from their ability to capture such interactions. By including interactions in
    regression, we can reduce the performance gap while preserving the interpretability
    of causal relationships we have with regression.
  prefs: []
  type: TYPE_NORMAL
- en: Nonlinearities
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In many circumstances, the relationship between a cause and an effect is not
    linear. It may have what economists call “decreasing returns”: you get less and
    less bang for your buck. For example, a satisfied customer might buy more than
    an unsatisfied one, but an ecstatic customer might not buy that much more than
    a happy one. Sending one marketing email per month to a customer might increase
    purchases, but sending 11 emails instead of 10 probably doesn’t help much, as
    in the left panel of [Figure 11-5](#nonlinear_relationships_between_variabl).'
  prefs: []
  type: TYPE_NORMAL
- en: 'Conversely, a causal relationship may have increasing returns, such as the
    network effects touted by start-ups: the more properties AirCnC has on its website,
    the more customers it will attract; but then the wider its customer base, the
    higher the incentive for owners to offer their property on its website, and so
    on, as in the right panel of [Figure 11-5](#nonlinear_relationships_between_variabl).'
  prefs: []
  type: TYPE_NORMAL
- en: '![Nonlinear relationships between variables: left is decreasing returns while
    right is increasing returns](Images/BEDA_1105.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 11-5\. Nonlinear relationships between variables: left is decreasing
    returns while right is increasing returns'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Mathematically, the curve on the left is concave, and the curve on the right
    is convex. A common mistake is to believe that such relationships cannot be represented
    with linear regression. In reality, what matters for a regression to be “linear”
    is that the predicted variable has a linear relationship with the coefficients,
    not the variables. *Y* = *β*[1].e^(X[1]) + *β*[2].e^(X[2]) is a proper linear
    regression because multiplying each coefficient by 2 would multiply Y by 2\. Conversely,
    *Y* = *e*^(*β*[1])^(.X[1]) + *β*[2]*X*[2] is not a proper linear regression because
    Y does not have a linear relationship with the coefficients.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can address nonlinear relationships between variables by adding the explanatory
    variable taken to the square (i.e., a quadratic term). For example, we can model
    the relationship between marketing emails and purchases we just discussed as:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Purchases* = *β*[0] + *β*[1].Emails + *β*[2]*.Emails*²'
  prefs: []
  type: TYPE_NORMAL
- en: Adding a quadratic term can significantly improve the accuracy of a regression.
    In [Figure 11-6](#linear_left_parenthesisdashedright_pare), you can see that the
    solid curve, which represents the line of best fit for the linear regression with
    a quadratic term, is much closer to the data points than the dashed line, which
    represents a standard regression without a quadratic term. Here, additional monthly
    emails have a decreasing impact, which translates into the quadratic term having
    a negative coefficient in the regression.
  prefs: []
  type: TYPE_NORMAL
- en: '![Linear (dashed) and quadratic (solid) lines of best fit](Images/BEDA_1106.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-6\. Linear (dashed) and quadratic (solid) lines of best fit
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: However, a quadratic term is nothing more than an interaction between a variable
    and itself. In other words, a nonlinear causal relationship between two variables
    can be reframed as self-moderation ([Figure 11-7](#representing_self_moderation)).
  prefs: []
  type: TYPE_NORMAL
- en: '![Representing self-moderation](Images/BEDA_1107.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-7\. Representing self-moderation
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Conceptually, this means that adding an extra email per month has a different
    impact depending on the current business-as-usual number of emails sent.
  prefs: []
  type: TYPE_NORMAL
- en: 'The syntax in code to include self-moderation is:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'In both R and Python, this is done by using the identity function `I()`, which
    prevents the linear regression algorithm from trying to interpret the squared
    term and just passes it to the general solver. In R, a squared term is expressed
    with a caret,^([1](ch11.xhtml#idm45968143988536)) whereas in Python it is expressed
    with two multiplication symbols. This also implies that self-moderation is validated
    in exactly the same way as traditional moderation: we would build a Bootstrap
    confidence interval, and determine whether it includes zero and whether it is
    economically significant.'
  prefs: []
  type: TYPE_NORMAL
- en: 'To recap our exploration of moderation, we’ve seen three varieties of it, which
    are mathematically identical but have different interpretations based on the types
    of variables involved:'
  prefs: []
  type: TYPE_NORMAL
- en: Segmentation
  prefs: []
  type: TYPE_NORMAL
- en: In segmentation personal characteristics (e.g., demographic variables) moderate
    the effect of a business behavior, such as an experimental intervention (it is
    then known as uplift analysis).
  prefs: []
  type: TYPE_NORMAL
- en: Interaction
  prefs: []
  type: TYPE_NORMAL
- en: In interaction we observe moderation between variables of the same nature, such
    as two demographic or two behavioral variables.
  prefs: []
  type: TYPE_NORMAL
- en: Nonlinearities
  prefs: []
  type: TYPE_NORMAL
- en: With nonlinearities a variable self-moderates its causal impact on another variable.
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have a clear understanding of the behavioral interpretation of moderation,
    let’s turn to the details of its application.
  prefs: []
  type: TYPE_NORMAL
- en: How to Apply Moderation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'As we discussed in the previous section, moderation can be used to capture
    a variety of behavioral effects, simply by adding the product of two variables
    to a regression. In this section, we’ll turn to technical considerations:'
  prefs: []
  type: TYPE_NORMAL
- en: When to look for moderation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to validate it
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Moderated moderation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to interpret the coefficients for individual variables in a moderated regression
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When to Look for Moderation?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'With so many possible applications of moderation, it can be tempting to look
    for it everywhere, but as a second-order effect (i.e., an effect on an effect),
    moderation generally yields small coefficients and the risk of false positives
    is high. This is especially true with experimental data, where the motivation
    is strong to find a meaningful effect: “Sure, the average effect of the email
    campaign is almost null, but look at the response rate for thirty-year-old men
    in Kansas!”'
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s say that you’re getting started on analyzing observational data or designing
    an experiment. At what point should you be thinking about moderation, and how
    should you integrate it into your analyses? First, I’ll talk about the experimental
    design stage. The process for the data analysis stage is the same regardless of
    whether the data is observational or experimental in nature, so I’ll cover the
    two cases together after that. Finally, I’ll cover nonlinearities, which will
    be easy: because there is only one variable involved, you don’t really have to
    worry about potential risks and you can include nonlinearity liberally in your
    analyses.'
  prefs: []
  type: TYPE_NORMAL
- en: Including moderation in the experimental design stage
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'I’ll distinguish between two situations that will call for different approaches:'
  prefs: []
  type: TYPE_NORMAL
- en: The primary object of your analysis is the main effect, regardless of moderation,
    and moderation is a secondary object of your analysis.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Moderation is the primary object of your analysis.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'If you’re designing an experiment in which the primary goal is not to measure
    moderation, my recommendation will be simple: leverage the possibility of moderation
    to refine your theory of change, but do not try to adjust your sample size.'
  prefs: []
  type: TYPE_NORMAL
- en: In [Part IV](part04.xhtml#designing_and_analyzing_experiments), we saw that
    before running an experiment, you should make your theory of change explicit with
    the help of causal diagrams. In that case, the focus was on average causal effects,
    i.e., the average effect of an experimental treatment across the board, but in
    many cases, we can refine that logic through moderation.
  prefs: []
  type: TYPE_NORMAL
- en: In [Chapter 8](ch08.xhtml#experimental_design_the_basics), we designed an experiment
    where we sought to increase AirCnC’s booking rate by offering “1-click booking.”
    It is conceivable that this effect could be moderated by age ([Figure 11-8](#experimental_treatment_moderated_by_age)).
  prefs: []
  type: TYPE_NORMAL
- en: '![Experimental treatment moderated by age](Images/BEDA_1108.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-8\. Experimental treatment moderated by age
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'The behavioral logic of our theory of change was that the 1-click button would
    reduce the duration of the booking process, which itself impacts the probability
    of completing a booking. This means there are two possibilities in terms of moderation:
    age moderates the effect of the 1-click button on the booking duration, or it
    moderates the effect of booking duration on the probability of completing a booking,
    or both ([Figure 11-9](#age_may_moderate_two_causal_relationshi)).'
  prefs: []
  type: TYPE_NORMAL
- en: '![Age may moderate two causal relationships](Images/BEDA_1109.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-9\. Age may moderate two causal relationships
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Putting together our behavioral logic and a potential moderator is very powerful,
    because it allows us to think through the behavioral implications, and in some
    cases to run analyses, before our experiment takes place.
  prefs: []
  type: TYPE_NORMAL
- en: Let’s start with the first relationship on the left of the CD, between the 1-click
    button and the booking duration. We don’t have any data about the 1-click button
    in our historical data, so we can’t measure this moderation effect directly. However,
    if we see an (unconfounded) correlation in our historical data between age and
    booking duration, this lends some credence to the idea, because it suggests that
    the cognitive processes at play are affected by age. On the other hand, if age
    is not correlated with booking duration, moderation would rely on younger and
    older customers having different reactions to the button itself specifically.
    While not impossible, this is a “narrower” behavioral path, somewhat less likely
    per Occam’s Razor—the simplest explanation is generally the right one. More importantly,
    it is a testable behavioral path. For example, if you bring a sample of baby boomers
    into the UX lab and you find that they don’t trust a 1-click process because they
    want to go through all the steps, then moderation is very likely, and you can
    target your experiment to younger customers, or at least oversample them.
  prefs: []
  type: TYPE_NORMAL
- en: For the second relationship, between booking duration and booking completion,
    we have all the required variables in our historical data, which means we can
    confirm or disprove moderation before even running our experiment, with a much
    higher accuracy than with the limited sample size of a single experiment. Again,
    if we confirm the presence of moderation, we can adjust our experimental design
    accordingly (e.g., by targeting only younger or older customers, depending on
    the direction of moderation).
  prefs: []
  type: TYPE_NORMAL
- en: 'There is a broader takeaway here: by articulating the behavioral logic of an
    intervention, we can often expand the chain between our intervention and our effect
    of interest in the CD by identifying one or several mediators between them for
    which we already have data. We can then explore whether the relationship between
    mediator(s) and final effect is moderated. In addition, we can explore whether
    that relationship is self-moderated. In our example here, maybe the booking rate
    is unaffected by the booking duration up to a point, but then drops precipitously,
    e.g., customers don’t really care if booking takes 30 or 45 seconds, but bail
    out of the process en masse if it takes more than 2 minutes ([Figure 11-10](#the_relationship_between_the_mediator_a)).'
  prefs: []
  type: TYPE_NORMAL
- en: '![The relationship between the mediator and final effect is self-moderated](Images/BEDA_1110.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-10\. Relationship between the mediator and final effect is self-moderated
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: During that process of identifying moderators in your historical data, you’ll
    have to keep in mind that “correlation is not causation” applies, and the relationships
    you’re looking at might be confounded, as in [Figure 11-11](#income_is_a_confounder_of_the_relations).
  prefs: []
  type: TYPE_NORMAL
- en: '![Income is a confounder of the relationship between duration and booking rate](Images/BEDA_1111.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-11\. Income is a confounder of the relationship between duration and
    booking rate
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: In such a situation, the confounding effect of *Income* would bias the relationship
    between *Duration* and *Booking* compared to the real causal effect (which is
    what you would act upon through the 1-click button experiment). Therefore, you
    would need to control for the confounding effect when assessing moderation.
  prefs: []
  type: TYPE_NORMAL
- en: In the case of a variable like *Age* that is observable before our experimental
    allocation, we can use it directly for the allocation itself. For example, instead
    of drawing a random sample from our whole customer base, we can limit our experiment
    to customers under a certain age, where we expect the largest effect.
  prefs: []
  type: TYPE_NORMAL
- en: 'Obviously, we can’t observe *BookingDuration* before a customer starts the
    booking process, which means we can’t use it in the experimental allocation itself.
    However, we can try to identify proxies for the target variable: for example,
    maybe bookings tend to be longer on the weekend than on weekdays. We can then
    use these proxies to define our experimental population and, say, run our experiment
    only on weekend customers. This will work well if the proxy and the target variable
    are closely related, e.g., there are some shorter bookings as well over the weekend,
    but 90% of the longer-duration bookings happen over the weekend. Conversely, if
    the two variables are only loosely related, e.g., 60% of the longer-duration bookings
    happen over the weekend, the results observed in your experiment may not generalize
    well to longer-duration bookings on weekdays.'
  prefs: []
  type: TYPE_NORMAL
- en: This is all I recommend you do if moderation is not the primary focus of your
    experiment, i.e., you haven’t measured the unmoderated effect yet. That’s because
    the power to detect moderation and interactions is significantly lower than the
    power to detect the main effects, which means the sample size required to measure
    moderation would be significantly larger (think 10–20x larger or more). That’s
    a lot of time spent on the possibility of moderation for an average effect you
    haven’t even confirmed yet.
  prefs: []
  type: TYPE_NORMAL
- en: Therefore, I recommend that you run your first experiment with a focus on measuring
    accurately the average, unmoderated effect, and then measure moderation effects
    in the results. If you find any promising moderation effect, it will most likely
    have a large confidence interval that crosses zero, due to the fact that the experiment
    was not powered to capture it. If that moderation effect seems promising enough
    from an economic standpoint, run a second experiment powered to appropriately
    measure it.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you know the unmoderated effect size, you can decide to run an experiment
    dedicated to measuring or confirming moderation. The process for determining the
    appropriate sample size remains the same: you would set a target power and hypothesized/target
    effect sizes, then determine the proportion of false negatives in repeated simulations
    at different sample sizes, as we’ve done in previous power analyses. The only
    difference is that you would use your prior knowledge for the main effect size,
    and only set a target effect size for moderation.'
  prefs: []
  type: TYPE_NORMAL
- en: Including moderation in the data analysis stage
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You have some data on hand, either observational in nature or from an experiment
    you have run. How can you identify relevant moderation effects without running
    into false positives? You’ll have to do a fishing expedition, that is, try including
    a moderation term with one variable, then another, and so on. In the following,
    I’ll provide several guidelines to minimize the risk of false positives.
  prefs: []
  type: TYPE_NORMAL
- en: 'First, I’ll provide you with a rough but powerful sanity check when you’re
    looking to moderate the effect of a categorical variable on a numeric variable.
    The requirement of a numeric effect simply means that you’re looking at a linear
    and not a logistic regression. The requirement of a categorical cause may seem
    very restrictive, but it applies to all experimental assignments (i.e., the experimental
    assignment is always a binary or categorical variable). In addition, if your cause
    is numeric, you can discretize it for this purpose by taking its quartiles:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: The sanity check is to compare the standard deviation of the effect of interest
    across the groups defined by your cause of interest. If the standard deviation
    is meaningfully higher in the treatment group (for experimental data) or differs
    across groups (for observational data), this suggests the possible presence of
    moderation and you can proceed with your fishing expedition with reasonable confidence.
    If the standard deviations are similar across groups, this suggests that there
    is no moderation; you can still try a few potential moderators if you’d like,
    but you need to have a strong theoretical rationale for them.
  prefs: []
  type: TYPE_NORMAL
- en: 'What do “meaningfully higher” or “similar” mean in that context? If you want
    a rigorous justification, there are statistical tests you can run to help you
    determine if the observed difference is statistically unusual, such as the Brown–Forsythe
    test.^([2](ch11.xhtml#ch01fn28)) Personally, I would recommend simply eyeballing
    it: is the difference economically meaningful in relation to the difference in
    means across the groups?'
  prefs: []
  type: TYPE_NORMAL
- en: 'Going back to the example of play areas in C-Mart stores, the code would be
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: In the example here, a 10-minute difference in standard deviations is definitely
    something C-Mart would be interested in exploring, given that the difference in
    means across the groups is about 13 minutes.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Obviously, the risk of false positives increases with the number of categories.
    If your primary cause is state or profession, you’re likely to see some variations
    in standard deviations across the board, just out of randomness and special cases.
    Therefore, I would look at moderation for such a variable only if I had a pretty
    strong rationale in the first place.
  prefs: []
  type: TYPE_NORMAL
- en: One way to mitigate the risk of false positives and make any moderation you
    might find more meaningful is to replace your categorical variable by quartiles
    of a relevant numeric variable. For example, political leaning or average income
    for states, proportion of women or average level of education for profession.
    Saying that the 25% of states with the lowest average income have a lower standard
    deviation of purchases than the 25% of states with the highest average income
    is a much more robust and actionable insight than saying that California has a
    higher standard deviation than Mississippi.
  prefs: []
  type: TYPE_NORMAL
- en: Assuming your data passes this first sanity check, the second step is to establish
    upper bounds on moderated effects. The key intuition here is that moderation can
    only “redistribute” the average effect; it doesn’t increase it. A visual illustration
    will make this clearer, taking the example of *Children* as a potential moderator
    of the effect of *PlayArea* on *VisitDuration*. [Figure 11-12](#average_effect_of_a_play_area_across_cu)
    shows the average effect of a play area across our data (11.92 minutes), with
    the width of the bars representing the proportion of customers without and with
    children in our population.
  prefs: []
  type: TYPE_NORMAL
- en: '![Average effect of a play area across customers without and with children](Images/BEDA_1112.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-12\. Average effect of a play area across customers without and with
    children
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Let’s assume for a second that the presence of a play area has at worst a null
    effect on customers without children (i.e., it cannot have a negative effect),
    a plausible assumption from a behavioral perspective if the play area is appropriately
    soundproofed. This implies that, at most, the entire average effect is coming
    from customers with children, and moderation redistributes the entire area of
    the left bar to the right bar, as in [Figure 11-13](#average_effect_coming_entirely_from_cus).
  prefs: []
  type: TYPE_NORMAL
- en: '![Average effect coming entirely from customers with children](Images/BEDA_1113.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-13\. Average effect coming entirely from customers with children
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Under that “most extreme scenario,” let’s calculate the effect size in the
    group of customers with children. By definition of the average, we have:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Avg. effect size* = (*Sum of individual effect sizes*) / (*Total number of
    customers*)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s separate customers with and without children in the numerator:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Avg. effect size* = (*Sum of individual effect sizes for customers without
    children + sum of individual effect sizes for customer with children*) / (*Total
    number of* *customers*)'
  prefs: []
  type: TYPE_NORMAL
- en: 'If we assume no effect on customers without children, the first term in the
    numerator is equal to zero:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Avg. effect size* = (*Sum of individual effect sizes for customers with children*)
    / (*Total number of customers*)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s multiply both sides of the equation by the total number of customers:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Avg. effect size* * *Total number of customers* = *Sum of individual effect
    sizes for customers with children*'
  prefs: []
  type: TYPE_NORMAL
- en: 'And then divide both sides by the number of customers with children:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Avg. effect size* * *Total number of customers* / *N**umber of customers with
    children* = *Avg. effect size for customers with children*'
  prefs: []
  type: TYPE_NORMAL
- en: '*Avg. effect size* * *1* / *Proportion of customers with children* = *Avg.
    effect size for customers with children*'
  prefs: []
  type: TYPE_NORMAL
- en: 'Swapping left- and righthand sides for readability and plugging in the numbers
    from the preceding example, we get:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Avg. effect size for customers with children* = 11.92 * 1 / 0.387 = 30.8'
  prefs: []
  type: TYPE_NORMAL
- en: 'In other words, the average effect size for customers with children can be
    no higher than 30.8 additional minutes for *VisitDuration*, given the overall
    average effect size. If that number is too low to be of economic interest, then
    there is no point in measuring moderation between *PlayArea* and *Children*. Beyond
    that specific example, the formula *Avg. effect size/Proportion of customers in
    segment* can be applied to any potential moderator: if you have an equal split
    of men and women in your customer base, this means that at most, one gender has
    double the average effect and the other has no effect. Hoping that somehow one
    gender will have triple the average effect or that moderation will increase the
    effect for both genders is wishful thinking, and mathematically impossible. To
    put it another way, we tend to focus on groups with above-average effect sizes,
    for understandable reasons, but the counterpart has to be groups with below-average
    effect sizes.'
  prefs: []
  type: TYPE_NORMAL
- en: 'This means that your search for potential moderators should start with variables
    that have a strong behavioral rationale or have been found to be impactful in
    past analyses, and that generate subgroups large enough to matter. Beyond a certain
    degree of inequality in group sizes, the search becomes an exercise in futility:
    if you have a variable that splits your customer base 90%-10%, then even if the
    group representing 10% of your customer base shows no effect at all, this will
    increase at most the effect in the 90% group to 1 / 0.9 = 111% of the average
    effect, an increase of 11%.'
  prefs: []
  type: TYPE_NORMAL
- en: More broadly, moderation cannot save a mediocre average effect. It should only
    be sought to add a bit more oomph to your treatment; for example if you are at
    90% of the breakeven or target value for it, or if you are in a high-volume environment
    and you’re trying to extract any efficiency gains you can.
  prefs: []
  type: TYPE_NORMAL
- en: For each variable you want to test, the process is the same. First, run a regression
    with an interaction between the experimental treatment variable and the potential
    moderator. Then if you find an interaction effect large enough, confirm it by
    building a Bootstrap CI around the estimated effect.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are some rules, such as the Bonferroni correction, to reduce the risk
    of false positives when testing a large number of hypotheses in this fashion.
    I would not recommend them however, for two reasons:'
  prefs: []
  type: TYPE_NORMAL
- en: They generally rely, explicitly or implicitly, on the Null Hypothesis Statistical
    Testing framework with normality assumptions.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: They can be unduly conservative and unacceptably increase the risk of false
    negatives.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Instead, my recommendation would be to validate promising subgroups through
    follow-up experiments whenever possible. If a moderation effect is large enough
    to be of business value, then it should be considered large enough to warrant
    further validation. If you’re working with experimental data, repeating the experiment
    is conceptually straightforward. If you’re working with observational data, what
    experiment you should run may not be immediately clear. However, for your moderation
    effect to have any economic value, it must mean you’re planning to do something
    differently. Otherwise it’s just an interesting tidbit for cocktail parties. Whatever
    it is you would do differently, you can probably randomize it in some fashion,
    and now you have an experiment.
  prefs: []
  type: TYPE_NORMAL
- en: One key success factor in this process is to appropriately convey to business
    partners that the results of such repeated testing should be considered provisional
    hypotheses, not proven fact. They shouldn’t feel like you’ve failed to deliver
    when an experiment yields a null result because it was a long shot anyway. Also
    remember that due to the nature of the process, your final effect size is likely
    to be smaller than what you found in the first pass.
  prefs: []
  type: TYPE_NORMAL
- en: Nonlinearities
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Nonlinearities, a.k.a. self-moderation, represent a special case compared to
    other forms of moderation because, by definition, there is only one moderator
    under consideration, which limits the risk of false positives. In addition, the
    consequences of a false positive are typically limited, as long as you don’t draw
    inference outside of the range of data available. For example, if you were to
    measure the effect of income on purchases based mostly on customers with annual
    incomes between $25,000 and $75,000 and then draw inferences for customers with
    an annual income of $250,000, both the risks and consequences of a false positive
    are high (even without considering moderation, extrapolating that far out would
    be a terrible idea anyway).
  prefs: []
  type: TYPE_NORMAL
- en: Therefore, it’s mostly OK to routinely test your cause of interest for self-moderation
    if you have at least a few hundred rows in your data. The variable must also be
    numeric, because a categorical variable self-moderating would be nonsensical.
    You should then validate the self-moderation effect by building a Bootstrap confidence
    interval, as we’ll see a bit later in this section.
  prefs: []
  type: TYPE_NORMAL
- en: Beyond improving the fit of your regression and accounting for intuitive behavioral
    effects such as decreasing returns, including self-moderation in your regression
    can alert you to the presence of a hidden moderator.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s look at a C-Mart example: the relationship between visit duration and
    groceries purchases. It is conceivable that very short visits represent targeted
    shopping runs to buy a specific article whereas longer trips are more likely to
    be grocery runs. This would make the reason for a visit a confounder of the relationship
    between *VisitDuration* and *GroceriesPurchases* ([Figure 11-14](#reason_for_visit_is_a_confounder_of_the)).'
  prefs: []
  type: TYPE_NORMAL
- en: '![Reason for visit is a confounder of the relationship between VisitDuration
    and GroceriesPurchases](Images/BEDA_1114.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-14\. Reason for visit is a confounder of the relationship between
    VisitDuration and GroceriesPurchases
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: But at the same time, *VisitReason* might conceivably moderate the effect of
    *VisitDuration* on *GroceriesPurchases*. If you’re going to the store to grab
    a birthday gift or a hammer, keeping you in the store longer (e.g., by adding
    a play area) is unlikely to entice you to buy sun-dried tomatoes the way it might
    if you’re doing a grocery run ([Figure 11-15](#reason_for_visit_moderates_the_effect_o)).
  prefs: []
  type: TYPE_NORMAL
- en: '![Reason for visit moderates the effect of VisitDuration on GroceriesPurchases](Images/BEDA_1115.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-15\. Reason for visit moderates VisitDuration’s effect on GroceriesPurchases
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'If we were able to observe the reason for the visit, we would be able to add
    it to our CD, and it would become a straightforward case of confounding + moderation.
    Assuming that we can’t observe the reason for the visit, we’re left with the following
    observable facts:'
  prefs: []
  type: TYPE_NORMAL
- en: '*GroceriesPurchases* is positively correlated with *VisitDuration* (both because
    of a true effect and because of the confounding effect of reason for visit).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Increasing visit duration has a bigger impact on groceries purchases for longer
    visits than for shorter visits.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In other words, the relationship between *VisitDuration* and *GroceriesPurchases*
    exhibits nonlinearity. A self-moderation term would increase the accuracy of our
    regression, so we should include it.
  prefs: []
  type: TYPE_NORMAL
- en: More generally, whenever you have a variable that appears to self-moderate without
    a clear behavioral rationale, you should explore the possibility of a hidden variable
    that is both a cause and a moderator of that variable.
  prefs: []
  type: TYPE_NORMAL
- en: To recap, finding relevant moderators is an important part of behavioral analysis,
    but like most of our tools, it is often more art than science. In the experimental
    design stage, we can sharpen our behavioral logic by looking for moderated mediators
    in our historical data, or through UX testing of our treatment. In the data analysis
    stage, a fishing expedition can discover promising potential moderators; while
    Bootstrap confidence intervals help reduce the risk of false positives, follow-up
    experiments are ultimately your best guarantee of success. Conversely, self-moderation
    is safe to explore and include routinely.
  prefs: []
  type: TYPE_NORMAL
- en: Multiple Moderators
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For the sake of simplicity, so far I’ve only shown one moderator at a time,
    but an effect can have multiple moderators. Going from one to multiple moderators
    is straightforward; the main subtlety to keep in mind is whether the moderators
    are interacting with each other or not.
  prefs: []
  type: TYPE_NORMAL
- en: Parallel moderators
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Getting back to our C-Mart example, we could imagine that another demographic
    variable, *Age*, also separately moderates the effect of *PlayArea* on *VisitDuration*,
    as in [Figure 11-16](#the_effect_of_playarea_on_visitdurati).
  prefs: []
  type: TYPE_NORMAL
- en: '![The effect of PlayArea on VisitDuration has two moderators](Images/BEDA_1116.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-16\. Effect of PlayArea on VisitDuration has two moderators
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The corresponding regression equation is shown in [Equation 11-3](#eqtn3).
  prefs: []
  type: TYPE_NORMAL
- en: Equation 11-3\.
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: '*VisitDuration* = *β*[0] + *β[p].PlayArea* + *β[c].Children* + *β[a].Age* +
    *β[pc].(PlayArea* * Children) + *β[pa]*.(*PlayArea * Age*)'
  prefs: []
  type: TYPE_NORMAL
- en: Note that the equation includes an individual term for *Age*, even though there
    is no arrow going from *Age* to *VisitDuration*. The warning provided earlier
    still applies here, and you need to include all individual terms in your regression.
  prefs: []
  type: TYPE_NORMAL
- en: 'The interpretation of [Equation 11-3](#eqtn3) would be that:'
  prefs: []
  type: TYPE_NORMAL
- en: The impact of *PlayArea* on *VisitDuration* is different for customers with
    and without children.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The impact of *PlayArea* on *VisitDuration* is different for younger and older
    customers. These two moderating effects are independent of each other.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Age* is a numeric variable, so its interpretation must be adjusted accordingly:
    the coefficient for *PlayArea * Age* represents the difference in the effect of
    *PlayArea* on *VisitDuration* between customers who have a one-year age difference.
    Depending on the business problem at hand, we can either:'
  prefs: []
  type: TYPE_NORMAL
- en: Keep it in numeric format if we wanted to have a precise, causally grounded
    estimate of *VisitDuration*, for example to determine the increase in sales we
    should expect from adding a play area to a certain store.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Or make it categorical by “binning” it in an appropriate manner. For example,
    we could convert *Age* into brackets such as “less than 20,” “20 to 40,” “40+,”
    or any other breakdown, making the corresponding coefficients easier to interpret
    for segmentation purposes.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Taken together, *Children* and *Age* create a two-dimension demographic segmentation
    that allows us to compare the average visit duration of, say, a 28-year-old with
    children to a 45-year-old without children.
  prefs: []
  type: TYPE_NORMAL
- en: Because the two moderation effects are independent of each other, we would be
    able to validate each one of them independently by bootstrapping the regression
    for [Equation 11-3](#eqtn3) and looking at the confidence interval for each moderator
    (see the next subsection).
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'This also implies that there is no order between the two moderators, and they
    can be drawn interchangeably: in [Figure 11-16](#the_effect_of_playarea_on_visitdurati),
    *Children* comes first but *Age* could as well. It doesn’t matter.'
  prefs: []
  type: TYPE_NORMAL
- en: The logic of multiple moderators applies similarly for interactions between
    variables of the same nature. For example, we could have *Children* interact with
    both *Age* and *Gender* ([Figure 11-17](#age_and_gender_both_interact_with_child)).
  prefs: []
  type: TYPE_NORMAL
- en: '![Age and Gender both interact with Children](Images/BEDA_1117.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-17\. Age and Gender both interact with Children
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'The corresponding regression equation would be:'
  prefs: []
  type: TYPE_NORMAL
- en: '*VisitDuration* = *β*[0] + *β[c].Children* + *β[a].Age* + *β[g].Gender* + *β[ca]*.(*Children*
    * *Age*) + *β[cg]*.(*Children* * *Gender*)'
  prefs: []
  type: TYPE_NORMAL
- en: Finally, a regression can include multiple variables that each self-moderate.
    Here again, the analysis would proceed independently for each one of them.
  prefs: []
  type: TYPE_NORMAL
- en: Overall, it is very simple to add multiple independent moderators, but sometimes
    it also makes sense to assume that the moderators interact with each other, which
    we’ll now turn to.
  prefs: []
  type: TYPE_NORMAL
- en: Interacting moderators
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Looking at the effect of *PlayArea* on *VisitDuration*, it makes sense that
    it would be moderated both by *Children* and *Age*. But among customers with children,
    we may also imagine that the increase in visit duration depends on the age of
    the customer, e.g., if grandparents are less likely to drop off their grandchildren
    at the play area than parents are to drop off their children. In such a case,
    the moderating effect of *Children* on the effect of *PlayArea* on *VisitDuration*
    would itself be moderated by *Age*, which in social sciences is called “moderated
    moderation” ([Figure 11-18](#moderated_moderation)).
  prefs: []
  type: TYPE_NORMAL
- en: '![Moderated moderation](Images/BEDA_1118.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-18\. Moderated moderation
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: '[Figure 11-19](#moderated_moderation_across_different_a) shows the moderated
    moderation at play, with each subgraph representing an age group among our customers.
    We can see that going from younger to older customers, the impact of *Children*
    on the impact of *PlayArea* on *VisitDuration* decreases (quite a mouthful!),
    as the distance between the two points for C = 1 decreases across subgraphs.'
  prefs: []
  type: TYPE_NORMAL
- en: '![Moderated moderation across different age groups](Images/BEDA_1119.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-19\. Moderated moderation across different age groups
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'The corresponding equation would be as shown:'
  prefs: []
  type: TYPE_NORMAL
- en: '*VisitDuration* = *β*[0] + *β[p].PlayArea* + *β[c].Children* + *β[a].Age* +
    *β[pc]*.(*PlayArea * Children*) + *β[pa]*.(*PlayArea * Age*)+ *β[ca]*.(*Children
    * Age*)+ *β[pca]*.(PlayArea * Children * Age)'
  prefs: []
  type: TYPE_NORMAL
- en: 'This equation is identical to [Equation 11-3](#eqtn3) with the addition of
    a three-way term at the end. Let’s run the regression (note how I entered only
    the three-way interaction term in the regression and the software automatically
    adds all the individual variables and two-way interaction terms):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: The coefficient for our 3-way term, the last one in the output, is negative,
    as well as economically meaningful, and the 90%-CI is approximately [–0.1671 ;
    –0.1590], which is narrow enough to give us confidence it can’t be close to zero.
  prefs: []
  type: TYPE_NORMAL
- en: Moderated moderation obeys the same logic and rules as simple moderation. Therefore
    it is symmetric, meaning that we can interpret *Age* as moderating the moderating
    effect of *Children*, or we can see it as *Children* moderating the moderating
    effect of *Age*the last one in the output.
  prefs: []
  type: TYPE_NORMAL
- en: 'From a behavioral perspective, the interpretation of moderated moderation depends
    on whether the underlying logic is that of segmentation or interaction:'
  prefs: []
  type: TYPE_NORMAL
- en: We would interpret it as segmentation if we have two personal-characteristic
    variables moderating a business characteristic or business behavior. That was
    the case for instance with the play area, where *Children* and *Age* moderate
    the effect of the *PlayArea* variable. Intuitively, this means that we have a
    two-dimension segmentation where the moderating effect of a dimension is increasing
    or decreasing along the other dimension (e.g., the moderating effect of having
    children decreases when *Age* increases).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: With three variables of the same nature, we would interpret it as a three-way
    interaction between three variables, as in [Figure 11-20](#three_way_interaction_between_three_bus).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Three-way interaction between three business-characteristic variables](Images/BEDA_1120.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-20\. Three-way interaction between three business-characteristic variables
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The point of this distinction is not to be pedantic, but to remind you to keep
    track of your analysis goals. Finding and validating moderation between predictors
    in a regression is all well and good, but what are you going to do with that information?
    You can *change* business behaviors, and sometimes business characteristics, but
    you can only *target* customers’ personal characteristics. Similarly, if you find
    that a certain customer behavior moderates the effect of a business behavior (e.g.,
    a cross-selling email campaign works best on customers who have recently been
    in a store), that information could be used either to target the customers who
    have exhibited this behavior, or to encourage customers to have that behavior
    in the first place.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Technically speaking, moderated moderation could also apply to nonlinearities,
    by having a cube term (e.g., *Purchases* = *β*[0] + *β*[1]*.Emails* + *β*[2]*.Emails*²
    + *β*[3].*Emails*³), but that’s extremely rare and more of a curiosity devoid
    of practical applications.
  prefs: []
  type: TYPE_NORMAL
- en: At this point, you may have a budding or even full-fledged headache. Moderation
    can quickly get overly complex. I have shown you 3-way interactions to let you
    know that it’s a possibility, but I would not go down that path unless you have
    some reasonably strong preexisting behavioral rationale to do so. Beyond that,
    we could theoretically have 5-way or even 12-way interactions (“moderation of
    moderation of…”), but simply throwing in as many interaction terms as you can
    is a recipe for false positives and ultimately a dazzling but pointless model.
    A straightforward simple moderation is often all you need, and can add some significant
    oomph to your analysis at a reasonable cost in terms of added complexity.
  prefs: []
  type: TYPE_NORMAL
- en: Validating Moderation with Bootstrap
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: So far, we have only looked at the regression coefficients for moderation terms,
    and not at p-values. But like any other regression coefficient, our coefficients
    for moderation are subject to uncertainty and sampling variability. Uncertainty
    is all the more important to account for with moderation because it is a “second
    order” effect (i.e., an effect on an effect, not a direct effect on a variable);
    these are typically much smaller than “first order” effects.
  prefs: []
  type: TYPE_NORMAL
- en: Let’s get back to our example of play areas in C-Mart. Our estimated coefficient
    for the moderation between *PlayArea* and *Children* was *β[pc]* = 21\. As usual,
    we’ll use Bootstrap simulations to determine how certain we can be of the values
    we observed. Let’s start by drawing 1,000 random samples of 10,000 rows each from
    the historical data available to us, and running each time the same regression
    as in the previous section. The distribution of values for the interaction coefficient
    is displayed in [Figure 11-21](#distribution_of_bootstrapped_values_fo).
  prefs: []
  type: TYPE_NORMAL
- en: '![Distribution of bootstrapped values for interaction coefficient (1k samples
    of 10k rows)](Images/BEDA_1121.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-21\. Distribution of bootstrapped values for interaction coefficient
    (1k samples of 10k rows)
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'In [Chapter 7](ch07.xhtml#measuring_uncertainty_with_the_bootstra), we saw
    that increasing the number of samples increased the smoothness of the histogram
    and the accuracy of confidence interval estimates, and increasing the size of
    the samples reduced the dispersion of values. Whether we need to do either of
    these depends on the business question at hand:'
  prefs: []
  type: TYPE_NORMAL
- en: If the question is, “Is there any moderation whatsoever?” (i.e., Is the coefficient
    *β[pc]* different from zero?), then [Figure 11-21](#distribution_of_bootstrapped_values_fo)
    already allows us to answer unequivocally “yes” and there’s no need to dig deeper.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If the question is more uncertain, e.g., “How confident are we that the coefficient
    for moderation is above 20.5?” then we’ll have to increase the sample size. Right
    now, the histogram goes beyond 20.5 toward the left (and quite so). Each of the
    values lower than 20.5 represents a Bootstrap simulation where the coefficient
    for moderation was below that threshold. Let’s next increase the size of the Bootstrap
    samples to 200,000 rows ([Figure 11-22](#distribution_of_bootstrapped_values_f)).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Distribution of bootstrapped values for interaction coefficient (1k samples
    of 200k rows)](Images/BEDA_1122.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-22\. Distribution of bootstrapped values for interaction coefficient
    (1k samples of 200k rows)
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: As you can see, the values are now much more narrowly concentrated around 21,
    and safely away from 20.5\. That second simulation was enough to answer our business
    question.
  prefs: []
  type: TYPE_NORMAL
- en: In the present case, we have a grand total of about 600,000 rows in our historical
    data so after validating the code with a dry run, we could have jumped directly
    to that sample size without much inconvenience (remember that you should never
    use a Bootstrap sample size larger than the size of the data you’re drawing from).
    But what if your historical data had 10 or 100 million rows? Instead of answering
    your business question in a matter of minutes, you would have spent hours or days
    waiting for the results of simulating a thousand samples of that size; certainly,
    your final CI would be extremely narrow, for example [20.9999; 21.0001], but that
    would be a complete waste of time if the question is only, “Is it higher than
    20.5?” That’s why I wanted to show you the process of progressively increasing
    the Bootstrap sample size, instead of jumping directly to the size of your historical
    data.
  prefs: []
  type: TYPE_NORMAL
- en: 'To summarize, after running a small Bootstrap simulation to make sure that
    your code runs correctly, you should increase the number of samples or the sample
    size as needed to answer your business question. This iterative process has the
    added benefit of engaging your critical sense and preventing you from running
    the analysis on autopilot. This applies to all forms of moderation: segmentation
    (including of experimental data), interaction, and self-moderation.'
  prefs: []
  type: TYPE_NORMAL
- en: Interpreting Individual Coefficients
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: I mentioned several times in this chapter that the variables involved in moderation
    must also be included as individual variables in the regression, even if you don’t
    plan to use them or they don’t appear significant. If, however, you want to use
    them, there are some subtleties involved, that we’ll now review.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s start by comparing the following two regressions (including only *Age*
    beyond *PlayArea* for the sake of simplicity):'
  prefs: []
  type: TYPE_NORMAL
- en: '*VisitDuration* = *β*[0] + *β*[*p*0].*PlayArea* + *β*[*a*0].*Age*'
  prefs: []
  type: TYPE_NORMAL
- en: and
  prefs: []
  type: TYPE_NORMAL
- en: '*VisitDuration* = *β*[1] + *β*[*p*1].*PlayArea* + *β*[*a*1].*Age* + *β*[*pa*1].(*PlayArea
    * Age*)'
  prefs: []
  type: TYPE_NORMAL
- en: At first glance, it might seem that the interpretation of the second equation
    is identical to the first one, with the only addition of the moderation term.
    It is not. *β*[*p*0] and *β*[*p*1] are not equal and do not have the same meaning,
    and similarly for *β*[*a*0] and *β*[*a*1].
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s visualize the difference by drawing a sample of 1,000 data points for
    the sake of readability and representing them in the *Age * VisitDuration* plane
    (Figures [11-23](#sample_of_onecommazerozerozero_data_po) and [11-24](#sample_of_onecommazerozerozero_data_poi)).
    In both figures, there are two regression lines plotted: one for customers with
    a play area and one for customers with no play area.'
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 11-23](#sample_of_onecommazerozerozero_data_po) represents the first
    equation, without moderation. The two lines have the same slope, equal to *β*[*a*0]
    = -0.024, and the (constant) distance between the two lines is equal to *β*[*p*0]
    = 12.56.'
  prefs: []
  type: TYPE_NORMAL
- en: '![Sample of 1,000 data points and regression lines with a play area (full dots,
    solid line) and without (crosses, dashed line), without moderation term](Images/BEDA_1123.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-23\. Sample of 1,000 data points and regression lines with a play
    area (full dots, solid line) and without (crosses, dashed line), without moderation
    term
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: '[Figure 11-24](#sample_of_onecommazerozerozero_data_poi) shows the corresponding
    figure for the second equation. The lines are not parallel. This implies that
    we can’t just say, “*β*[*p*1] represents the vertical distance between two regression
    lines,” we have to state at which age we’re measuring that vertical distance.
    Similarly, we can’t just say that “*β*[*a*1] represents the slope of these regression
    lines,” we have to pick which of these lines we’re referring to (i.e., we have
    to state for which value of *PlayArea* we’re measuring that slope).'
  prefs: []
  type: TYPE_NORMAL
- en: This has important ramifications from a business perspective. If a business
    partner asks, “What is the impact of a play area on visit duration?” and you’re
    relying on the first equation, without a moderation term, you can answer, “That
    impact is equal to *β*[*p*0].” However, if you’ve determined that there is a significant
    moderation effect between the two variables and you want to rely on the second
    equation (as you should), your answer should really be the “well, it depends”
    that business partners dread.
  prefs: []
  type: TYPE_NORMAL
- en: 'Fortunately, this problem can easily be resolved with a little care, in two
    possible ways:'
  prefs: []
  type: TYPE_NORMAL
- en: Setting meaningful reference points
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Calculating effects at the level of business decisions
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Sample of 1,000 data points and regression lines with a play area (full dots,
    solid line) and without (crosses, dashed line), with moderation term](Images/BEDA_1124.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11-24\. Sample of 1,000 data points and regression lines with a play
    area (full dots, solid line) and without (crosses, dashed line), with moderation
    term
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Setting meaningful reference points
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The first solution is to set meaningful reference points for our variables.
    First let’s get back to our equation with moderation:'
  prefs: []
  type: TYPE_NORMAL
- en: '*VisitDuration* = *β*[1] + *β*[*p*1].*PlayArea* + *β*[*a*1].*Age* + *β*[*pa*1].(*PlayArea
    * Age*)'
  prefs: []
  type: TYPE_NORMAL
- en: 'If we set a customer’s age to zero, the expected visit duration for our newborn
    customer is *β*[1] without a play area and *β*[1] + *β*[p1] with a play area.
    Therefore *β*[p1] is truthfully the impact of a play area on visit duration for
    age zero. However, newborn customers are not our primary target and we can do
    better by normalizing the *Age* variable. A typical approach is to set it to the
    average age in our data set:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'Doing so reduces the coefficient for *PlayArea* from 15.85 to 12.56 and we
    can say, “The impact of a play area on visit duration is 12.56 additional minutes
    *for the average customer age in our data*.” Similarly, because *PlayArea* is
    a binary variable, *β*[*a*1] is by default the slope of the line for customers
    without a play area. You can change that by reversing the levels of *PlayArea*
    (i.e., setting 1 or “Y” as the default and 0 or “N” as the change, depending on
    how your binary variable is formulated):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: Changing the default level for *PlayArea* changes the coefficient for *β*[*a*1]
    from 0 to −0.07 (the slope of the upper solid line in [Figure 11-24](#sample_of_onecommazerozerozero_data_poi)).
  prefs: []
  type: TYPE_NORMAL
- en: 'How should you set the defaults for your variables? It depends on the business
    problem at hand as well as the nature of the variable:'
  prefs: []
  type: TYPE_NORMAL
- en: In some situations, the relevant default for a numeric variable is not the average,
    but the minimum, the maximum, or the average in a relevant subgroup (e.g., the
    average age of customers with children, or the average age of customers in stores
    with a play area as opposed to the global average). In particular, when you’re
    dealing with count variables such as number of children or number of calls, zero
    might be a better reference point than the average.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For binary variables, the relevant default is usually the status quo. Here for
    example, you would set the default for *PlayArea* to 0 if you’re considering adding
    new play areas, and to 1 if you’re considering some of the existing ones.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For categorical variables such as gender or state, unless there is a meaningful
    reference point, you can default to the most common category.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Setting meaningful reference points for all the variables involved in moderation
    has the advantage of computational simplicity and is often straightforward. However,
    it can get quickly cumbersome as the number of variables involved increases. Let’s
    imagine for example that we add an interaction between state and gender to our
    regression:'
  prefs: []
  type: TYPE_NORMAL
- en: '*VisitDuration* =*β*[1] + *β[p]*[1].*PlayArea* + *β[a]*[1].*Age* + *β[pa]*[1].(*PlayArea
    * Age*) + *β[g]*[1].*Gender* + *β[s]*[1].*State* + *β[gs]*[1].(*Gender * State*)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Now *β[p]*[1] is the impact of a play area for customers of the reference age
    and gender in the reference state. “The effect of a play area is 10 for female
    California customers of age 43” starts to be a mouthful and can become rather
    meaningless if the variables are not independent: the fact that we have more female
    than male customers, that we have more customers in California than in any other
    state, and that the overall average age is 43 doesn’t imply that we have a lot
    of 43-year-old female California customers, or any whatsoever for that matter.
    This brings us to the other solution, calculating the average effect in our sample.'
  prefs: []
  type: TYPE_NORMAL
- en: Calculating effects at the level of business decisions
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: From a scientific perspective, one of the main advantages of the previous approach
    is that it provides a single number for a coefficient, which can presumably be
    applied to completely different circumstances, or at least compared with the numbers
    obtained in other circumstances. However, the goal of applied analytics is not
    to measure things for the sake of measurement, but to guide business decisions
    (if you’re running a data analysis and you don’t know what possible decisions
    could come out of it, you need to have a conversation with your manager, because
    at least one of you is not doing their job correctly). Therefore, an alternative
    approach is to calculate the value of your effect variable of interest with and
    without that decision.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s imagine for example that the decision at hand for C-Mart is to pick the
    next store in which to set up a play area. To answer that question, we don’t need
    to determine the single “average” effect of a play area, and trying to do so would
    actually be counterproductive. Instead, for each store that doesn’t have a play
    area today, we can directly determine what would be the average additional visit
    duration if we added a play area. The process is as follows (the callout numbers
    are shared between R and Python):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: '[![1](Images/1.png)](#comarker111a)'
  prefs: []
  type: TYPE_NORMAL
- en: Run and save the model to use it for predictions.
  prefs: []
  type: TYPE_NORMAL
- en: '[![2](Images/2.png)](#comarker112a)'
  prefs: []
  type: TYPE_NORMAL
- en: Select the stores without a play area today.
  prefs: []
  type: TYPE_NORMAL
- en: '[![3](Images/3.png)](#comarker113a)'
  prefs: []
  type: TYPE_NORMAL
- en: Add the predicted visit duration under the current circumstances, `pred_dur0`.
  prefs: []
  type: TYPE_NORMAL
- en: '[![4](Images/4.png)](#comarker114a)'
  prefs: []
  type: TYPE_NORMAL
- en: Change the binary variable *PlayArea* from `0` to `1`.
  prefs: []
  type: TYPE_NORMAL
- en: '[![5](Images/5.png)](#comarker115a)'
  prefs: []
  type: TYPE_NORMAL
- en: Determine the predicted visit duration with the added play area, `pred_dur1`.
  prefs: []
  type: TYPE_NORMAL
- en: '[![6](Images/6.png)](#comarker116a)'
  prefs: []
  type: TYPE_NORMAL
- en: Calculate the difference between the two.
  prefs: []
  type: TYPE_NORMAL
- en: '[![7](Images/7.png)](#comarker117a)'
  prefs: []
  type: TYPE_NORMAL
- en: Aggregate at the store level, either by looking at the average or total additional
    duration (the average is more intuitive, but the total relates more directly to
    business outcomes by favoring larger stores).
  prefs: []
  type: TYPE_NORMAL
- en: 'We can then select the store(s) with the highest benefits of a play area. Crucially,
    you can check for yourself that centering numeric variables at the beginning of
    the process leads to the exact same final conclusions. Mathematically, that’s
    because we’re subtracting the same quantity from the two terms in a difference:'
  prefs: []
  type: TYPE_NORMAL
- en: (*VisitDuration*[*i*1] - *mean*(*VisitDuration*)) - (*VisitDuration*[*i*][0]
    - *mean*(*VisitDuration*)) = *VisitDuration[i]*[1] - *VisitDuration[i]*[0]
  prefs: []
  type: TYPE_NORMAL
- en: where *VisitDuration[i]*[1] and *VisitDuration[i]*[0] are the predicted visit
    duration, respectively with and without a play area (regardless of current conditions).
    Therefore, with a decision-centric perspective the reference points and centering,
    or lack thereof, are irrelevant and you don’t need to worry about that anymore.
  prefs: []
  type: TYPE_NORMAL
- en: 'To recap: adding a moderation term changes the value and interpretation of
    the individual coefficients for the variables involved. This happens because the
    very definition of moderation is that these coefficients are not the same “everywhere,”
    and moderation changes the baseline values at which they are measured. The individual
    coefficients must thus be interpreted either in relation to relevant reference
    points of the variables involved (which you can adjust through centering), or
    across our entire data set but in relation to the decision at hand.'
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: One of the key tenets of behavioral science is that “behavior is a function
    of the person and the environment.” That phrase is generally taken to mean that
    we can influence behaviors by changing the environment. That is certainly true
    but I also like to see it as a reminder that averages are just that, averages,
    and it behooves the diligent behavioral analyst to dig deeper with moderation
    analysis. In particular, I think that some of the recent failures to replicate
    classic psychology experiments would be best interpreted not as meaning that “there
    is no effect” but that “the effect is strongly moderated by population characteristics
    (i.e., the person) and experimental conditions (i.e., the environment).”
  prefs: []
  type: TYPE_NORMAL
- en: This may seem to be a matter of academic interest only, but it’s not. In business
    settings, many heated discussions where both sides have commandeered anecdotal
    supporting evidence can be usefully recast in terms of moderation. What is true
    on the East Coast may not be on the West Coast. A training program may be effective
    with inexperienced staff but not with experienced employees, or vice versa. By
    definition, a regression without moderation would not be able to shed light on
    either of these two cases.
  prefs: []
  type: TYPE_NORMAL
- en: 'This makes moderation analysis a very valuable, but often neglected, addition
    to the behavioral analytics tool belt. In this chapter, we saw that it can be
    applied both to observational and experimental data in a very simple way: add
    a multiplicative term between the two variables to your regression. In the next
    and last chapter, we’ll turn to another of the key behavioral data analysis tools,
    mediation.'
  prefs: []
  type: TYPE_NORMAL
- en: ^([1](ch11.xhtml#idm45968143988536-marker)) The caret is the symbol on the 6
    key of your keyboard.
  prefs: []
  type: TYPE_NORMAL
- en: ^([2](ch11.xhtml#ch01fn28-marker)) Available in R as the `bf.test()` function
    from the [`onewaytests` package](https://oreil.ly/iq7KN) and in Python as the
    `stats.levene()` function from the `scipy` package, with the parameter `center='median'`.
  prefs: []
  type: TYPE_NORMAL
