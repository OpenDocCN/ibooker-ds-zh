["```py\n# Load data from Ziebarth (2013)\nimport numpy as np\nimport pandas as pd\npath = \"https://github.com/causal-methods/Data/raw/master/\" \ndata = pd.read_stata(path + \"MS_data_all_years_regs.dta\")\ndata.head() \n```", "```py\n# Round 2 decimals\npd.set_option('precision', 2)\n\n# Restrict the sample to the year: 1929\ndf1929 = data[data.censusyear.isin([1929])]\n\nvars= ['log_total_output_value', 'log_wage_earners_total',\n       'log_hours_per_wage_earner']\n\ndf1929.loc[:, vars].groupby(df1929[\"st_louis_fed\"]).agg([np.size, np.mean]) \n```", "```py\n# Restrict sample to firms with 1 product\ndf1929_1 = df1929[df1929.num_products.isin([1])]\n\nper_unit = ['log_output_price_1', 'log_output_quantity_1']\n\ndf1929_1.loc[:, per_unit].groupby(df1929_1[\"st_louis_fed\"]).agg([np.size, np.mean]) \n```", "```py\n# Restrict the sample to the years: 1929 and 1931\ndf = data[data.censusyear.isin([1929, 1931])]\n\nvars = ['firmid', 'censusyear', 'log_total_output_value',\n        'st_louis_fed', 'industrycode', 'year_1931']\n\n# Drop missing values \ndf = df.dropna(subset=vars) \n```", "```py\ndf = df.set_index(['firmid', 'censusyear'])\ndf.head() \n```", "```py\n!pip install linearmodels \n```", "```py\nRequirement already satisfied: linearmodels in c:\\anaconda\\envs\\textbook\\lib\\site-packages (4.17)\nRequirement already satisfied: numpy>=1.15 in c:\\anaconda\\envs\\textbook\\lib\\site-packages (from linearmodels) (1.19.2) \n```", "```py\nWARNING: No metadata found in c:\\anaconda\\envs\\textbook\\lib\\site-packages\nERROR: Could not install packages due to an EnvironmentError: [Errno 2] No such file or directory: 'c:\\\\anaconda\\\\envs\\\\textbook\\\\lib\\\\site-packages\\\\numpy-1.19.2.dist-info\\\\METADATA' \n```", "```py\n# Mean Revenue for the Graphic\ntable = pd.crosstab(df['year_1931'], df['st_louis_fed'], \n        values=df['log_total_output_value'], aggfunc='mean')\n\n# Build Graphic\nimport plotly.graph_objects as go\nfig = go.Figure()\n\n# x axis\nyear = [1929, 1931]\n\n# Atlanta Line\nfig.add_trace(go.Scatter(x=year, y=table[0],\n                         name='Atlanta (Control)'))\n# St. Louis Line\nfig.add_trace(go.Scatter(x=year, y=table[1],\n                         name='St. Louis (Treatment)'))\n# Counterfactual\nend_point = (table[1][0] - table[0][0]) + table[0][1]\ncounter = [table[1][0], end_point]\nfig.add_trace(go.Scatter(x=year, y= counter,\n                         name='Counterfactual',\n                         line=dict(dash='dot') ))\n\n# Difference-in-Differences (DID) estimation\nfig.add_trace(go.Scatter(x=[1931, 1931],\n                         y=[table[1][1], end_point],\n                         name='$\\delta_1=0.2$',\n                         line=dict(dash='dashdot') ))\n\n# Labels\nfig.update_layout(title=\"Firm's Revenue during the Great Depression\",\n                  xaxis_type='category',\n                  xaxis_title='Year',\n                  yaxis_title='Log(Revenue)')\n\nfig.show() \n```", "```py\nfrom linearmodels import PanelOLS\n\nY = df['log_total_output_value']\ndf['const'] = 1\ndf['louis_1931'] = df['st_louis_fed']*df['year_1931']\n\n## Difference-in-Differences (DID) specification\ndd = ['const', 'st_louis_fed', 'year_1931', 'louis_1931']\n\ndif_in_dif = PanelOLS(Y, df[dd]).fit(cov_type='clustered',\n                                     cluster_entity=True)\nprint(dif_in_dif) \n```", "```py\nC:\\Anaconda\\envs\\textbook\\lib\\site-packages\\statsmodels\\tools\\_testing.py:19: FutureWarning:\n\npandas.util.testing is deprecated. Use the functions in the public API at pandas.testing instead. \n```", "```py\n PanelOLS Estimation Summary                             \n====================================================================================\nDep. Variable:     log_total_output_value   R-squared:                        0.0257\nEstimator:                       PanelOLS   R-squared (Between):              0.0145\nNo. Observations:                    1227   R-squared (Within):               0.2381\nDate:                    Fri, Nov 06 2020   R-squared (Overall):              0.0257\nTime:                            21:12:12   Log-likelihood                   -2135.5\nCov. Estimator:                 Clustered                                           \n                                            F-statistic:                      10.761\nEntities:                             938   P-value                           0.0000\nAvg Obs:                           1.3081   Distribution:                  F(3,1223)\nMin Obs:                           1.0000                                           \nMax Obs:                           2.0000   F-statistic (robust):             18.780\n                                            P-value                           0.0000\nTime periods:                           2   Distribution:                  F(3,1223)\nAvg Obs:                           613.50                                           \nMin Obs:                           575.00                                           \nMax Obs:                           652.00                                           \n\n                              Parameter Estimates                               \n================================================================================\n              Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI\n--------------------------------------------------------------------------------\nconst            10.781     0.0723     149.13     0.0000      10.639      10.923\nst_louis_fed     0.0945     0.1043     0.9057     0.3653     -0.1102      0.2991\nyear_1931       -0.3521     0.0853    -4.1285     0.0000     -0.5194     -0.1848\nlouis_1931      -0.1994     0.1237    -1.6112     0.1074     -0.4422      0.0434\n================================================================================ \n```", "```py\nC:\\Anaconda\\envs\\textbook\\lib\\site-packages\\linearmodels\\panel\\data.py:98: FutureWarning:\n\nis_categorical is deprecated and will be removed in a future version.  Use is_categorical_dtype instead \n```", "```py\nfrom math import exp\n1 - exp(dif_in_dif.params.louis_1931 ) \n```", "```py\n0.18076309464004925 \n```", "```py\nfirmFE = PanelOLS(Y, df[dd], entity_effects=True)\nprint(firmFE.fit(cov_type='clustered', cluster_entity=True)) \n```", "```py\n PanelOLS Estimation Summary                             \n====================================================================================\nDep. Variable:     log_total_output_value   R-squared:                        0.2649\nEstimator:                       PanelOLS   R-squared (Between):             -0.4554\nNo. Observations:                    1227   R-squared (Within):               0.2649\nDate:                    Fri, Nov 06 2020   R-squared (Overall):             -0.4266\nTime:                            21:12:12   Log-likelihood                   -202.61\nCov. Estimator:                 Clustered                                           \n                                            F-statistic:                      34.361\nEntities:                             938   P-value                           0.0000\nAvg Obs:                           1.3081   Distribution:                   F(3,286)\nMin Obs:                           1.0000                                           \nMax Obs:                           2.0000   F-statistic (robust):             31.245\n                                            P-value                           0.0000\nTime periods:                           2   Distribution:                   F(3,286)\nAvg Obs:                           613.50                                           \nMin Obs:                           575.00                                           \nMax Obs:                           652.00                                           \n\n                              Parameter Estimates                               \n================================================================================\n              Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI\n--------------------------------------------------------------------------------\nconst            9.9656     0.4511     22.091     0.0000      9.0777      10.854\nst_louis_fed     1.9842     1.0365     1.9144     0.0566     -0.0559      4.0243\nyear_1931       -0.3666     0.0657    -5.5843     0.0000     -0.4959     -0.2374\nlouis_1931      -0.1862     0.0982    -1.8965     0.0589     -0.3794      0.0071\n================================================================================\n\nF-test for Poolability: 6.8220\nP-value: 0.0000\nDistribution: F(937,286)\n\nIncluded effects: Entity \n```", "```py\nindustryFE = PanelOLS(Y, df[dd + ['industrycode']])\nprint(industryFE.fit(cov_type='clustered', cluster_entity=True)) \n```", "```py\n PanelOLS Estimation Summary                             \n====================================================================================\nDep. Variable:     log_total_output_value   R-squared:                        0.5498\nEstimator:                       PanelOLS   R-squared (Between):              0.5462\nNo. Observations:                    1227   R-squared (Within):               0.3913\nDate:                    Fri, Nov 06 2020   R-squared (Overall):              0.5498\nTime:                            21:12:12   Log-likelihood                   -1661.9\nCov. Estimator:                 Clustered                                           \n                                            F-statistic:                      29.971\nEntities:                             938   P-value                           0.0000\nAvg Obs:                           1.3081   Distribution:                 F(48,1178)\nMin Obs:                           1.0000                                           \nMax Obs:                           2.0000   F-statistic (robust):          4.791e+15\n                                            P-value                           0.0000\nTime periods:                           2   Distribution:                 F(48,1178)\nAvg Obs:                           613.50                                           \nMin Obs:                           575.00                                           \nMax Obs:                           652.00                                           \n\n                                 Parameter Estimates                                 \n=====================================================================================\n                   Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI\n-------------------------------------------------------------------------------------\nconst                 10.391     0.2249     46.201     0.0000      9.9497      10.832\nst_louis_fed         -0.1740     0.0805    -2.1610     0.0309     -0.3319     -0.0160\nyear_1931            -0.3163     0.0660    -4.7922     0.0000     -0.4458     -0.1868\nlouis_1931           -0.1533     0.0916    -1.6741     0.0944     -0.3331      0.0264\nindustrycode.1005    -0.1966     0.3637    -0.5407     0.5888     -0.9101      0.5169\nindustrycode.101      0.2349     0.2403     0.9775     0.3285     -0.2366      0.7064\nindustrycode.1014    -0.1667     1.0812    -0.1542     0.8775     -2.2880      1.9546\nindustrycode.103      1.5898     0.2938     5.4104     0.0000      1.0133      2.1663\nindustrycode.104      1.1349     0.2818     4.0280     0.0001      0.5821      1.6877\nindustrycode.105      0.9660     0.4191     2.3049     0.0213      0.1437      1.7882\nindustrycode.107      0.9374     0.3073     3.0502     0.0023      0.3344      1.5404\nindustrycode.110      0.2299     0.3447     0.6671     0.5049     -0.4463      0.9062\nindustrycode.111      2.8271     0.4097     6.9010     0.0000      2.0233      3.6308\nindustrycode.112      0.2676     0.4185     0.6394     0.5227     -0.5535      1.0888\nindustrycode.114      2.7559     0.4623     5.9612     0.0000      1.8489      3.6630\nindustrycode.116      0.4498     0.4351     1.0337     0.3015     -0.4039      1.3035\nindustrycode.117     -0.1337     0.5436    -0.2461     0.8057     -1.2002      0.9327\nindustrycode.118      0.1025     0.2483     0.4127     0.6799     -0.3847      0.5896\nindustrycode.119     -0.3121     0.2336    -1.3360     0.1818     -0.7705      0.1462\nindustrycode.1204    -0.0102     0.3031    -0.0338     0.9731     -0.6048      0.5844\nindustrycode.123      0.2379     0.7093     0.3354     0.7374     -1.1537      1.6295\nindustrycode.126      1.8847     0.4828     3.9039     0.0001      0.9375      2.8319\nindustrycode.128     -0.0025     0.5277    -0.0047     0.9963     -1.0377      1.0328\nindustrycode.1303     2.6410     0.2293     11.519     0.0000      2.1912      3.0908\nindustrycode.136      0.2537     0.2493     1.0178     0.3090     -0.2354      0.7428\nindustrycode.1410    -1.4091     0.2967    -4.7496     0.0000     -1.9912     -0.8270\nindustrycode.1502     1.4523     0.3858     3.7644     0.0002      0.6954      2.2093\nindustrycode.1604    -0.5652     0.4195    -1.3473     0.1781     -1.3882      0.2579\nindustrycode.1624    -1.0476     1.0108    -1.0365     0.3002     -3.0307      0.9355\nindustrycode.1640    -0.8320     0.3613    -2.3030     0.0215     -1.5409     -0.1232\nindustrycode.1676     0.5830     0.2512     2.3205     0.0205      0.0901      1.0759\nindustrycode.1677    -0.7025     0.2346    -2.9947     0.0028     -1.1627     -0.2422\nindustrycode.203     -0.6435     0.2241    -2.8712     0.0042     -1.0832     -0.2038\nindustrycode.210B     1.7535     0.2293     7.6482     0.0000      1.3037      2.2033\nindustrycode.216      2.7641     0.3549     7.7888     0.0000      2.0679      3.4604\nindustrycode.234a     1.6871     0.5410     3.1187     0.0019      0.6258      2.7485\nindustrycode.265      1.2065     0.4193     2.8774     0.0041      0.3838      2.0292\nindustrycode.266     -0.3244     0.2736    -1.1857     0.2360     -0.8612      0.2124\nindustrycode.304      1.2156     0.4982     2.4400     0.0148      0.2382      2.1930\nindustrycode.314      0.8008     0.2411     3.3211     0.0009      0.3277      1.2740\nindustrycode.317     -0.1470     0.2750    -0.5347     0.5930     -0.6866      0.3925\nindustrycode.515     -0.4623     0.2862    -1.6153     0.1065     -1.0238      0.0992\nindustrycode.518     -0.5243     0.2887    -1.8157     0.0697     -1.0908      0.0422\nindustrycode.520     -0.2234     0.2731    -0.8179     0.4136     -0.7592      0.3124\nindustrycode.614      1.8029     0.3945     4.5707     0.0000      1.0290      2.5768\nindustrycode.622      2.9239     0.2430     12.035     0.0000      2.4473      3.4006\nindustrycode.633      0.0122     1.5690     0.0078     0.9938     -3.0661      3.0906\nindustrycode.651      1.9170     0.8690     2.2060     0.0276      0.2121      3.6220\nindustrycode.652      2.5495     0.2211     11.531     0.0000      2.1158      2.9833\n===================================================================================== \n```", "```py\nfrom linearmodels import RandomEffects\nre = RandomEffects(Y, df[['const', 'st_louis_fed']])\nprint(re.fit(cov_type='clustered', cluster_entity=True)) \n```", "```py\n RandomEffects Estimation Summary                          \n====================================================================================\nDep. Variable:     log_total_output_value   R-squared:                        0.3689\nEstimator:                  RandomEffects   R-squared (Between):             -0.0001\nNo. Observations:                    1227   R-squared (Within):               0.0025\nDate:                    Fri, Nov 06 2020   R-squared (Overall):             -0.0027\nTime:                            21:12:13   Log-likelihood                   -1260.9\nCov. Estimator:                 Clustered                                           \n                                            F-statistic:                      716.04\nEntities:                             938   P-value                           0.0000\nAvg Obs:                           1.3081   Distribution:                  F(1,1225)\nMin Obs:                           1.0000                                           \nMax Obs:                           2.0000   F-statistic (robust):             0.5811\n                                            P-value                           0.4460\nTime periods:                           2   Distribution:                  F(1,1225)\nAvg Obs:                           613.50                                           \nMin Obs:                           575.00                                           \nMax Obs:                           652.00                                           \n\n                              Parameter Estimates                               \n================================================================================\n              Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI\n--------------------------------------------------------------------------------\nconst            10.518     0.0603     174.36     0.0000      10.399      10.636\nst_louis_fed     0.0721     0.0946     0.7623     0.4460     -0.1135      0.2577\n================================================================================ \n```"]