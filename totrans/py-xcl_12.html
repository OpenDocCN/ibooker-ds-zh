<html><head></head><body>
<p id="filepos1235764" class="calibre_"><span class="calibre2"><span class="bold"><span class="calibre_15">Chapter 9. Excel Automation</span></span></span></p><p class="calibre_16">So far, we’ve learned how to replace typical Excel tasks with pandas (<a href="index_split_013.html#filepos433190"><span class="calibre_7">Part II</span></a>) and how to use Excel files both as a data source as well as a file format for your reports (<a href="index_split_018.html#filepos863198"><span class="calibre_7">Part III</span></a>). This chapter kicks off <a href="index_split_023.html#filepos1235617"><span class="calibre_7">Part IV</span></a>, where we switch away from manipulating Excel <span class="italic">files</span> with the reader and writer packages and begin automating <a/>the Excel <span class="italic">application</span> with xlwings.</p><p class="calibre_6">The main <a id="filepos1236537"/>use case of xlwings is to build interactive applications where Excel spreadsheets act as the user interface, allowing you to call Python by clicking a button or calling a user-defined function—that’s the type of functionality that isn’t covered by the reader and writer packages. But that doesn’t mean that xlwings can’t be used to read and write files, as long as you are on either macOS or Windows and have Excel installed. One advantage that xlwings has in this area is the ability to truly edit Excel files, in all formats, without changing or losing any of the existing content or formatting. Another advantage is that you can read the cell values from an Excel workbook without the need to save it first. It can, however, also make perfect sense to use an Excel reader/writer package and xlwings together, as we will see when we pick up the reporting case study from <a href="index_split_019.html#filepos863345"><span class="calibre_7">Chapter 7</span></a> one more time.</p><p class="calibre_6">I’ll start this chapter by introducing you to the Excel object model as well as xlwings: we’ll first learn the basics like connecting to a workbook or reading and writing cell values before digging a bit deeper to understand how converters and options allow us to work with pandas DataFrames and NumPy arrays. We also look at how to interact with charts, pictures, and defined names before moving on to the last section, which explains how xlwings works under the hood: this will give you the required knowledge to make your scripts performant as well as work around missing functionality. From this chapter on, you will need to run the code samples on either Windows or macOS, as they depend on a local installation of Microsoft Excel.<a id="filepos1238292"/><a href="index_split_025.html#filepos1437419"><span class="calibre5"><span class="calibre_7">1</span></span></a></p><p id="filepos1238381" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Getting Started with xlwings</span></span></span></p><p class="calibre_6">One goal of xlwings<a id="filepos1238572"/> is to serve as a drop-in replacement for VBA, allowing you to interact with Excel from Python on Windows and macOS. Since Excel’s grid is the perfect layout to display Python’s data structures like nested lists, NumPy arrays, and pandas DataFrames, one of xlwings’ core features is to make reading and writing them from and to Excel as easy as possible. I’ll start this section by introducing you to Excel as a data viewer—this is useful when you are interacting with DataFrames in a Jupyter notebook. I’ll then explain the Excel object model before exploring it interactively with xlwings. To wrap this section up, I’ll show you how to call VBA code that you may still have in legacy workbooks. Since xlwings is part of Anaconda, we don’t need to install it manually.</p><p id="filepos1239368" class="calibre_17"><span class="calibre3"><span class="bold">Using Excel as Data Viewer</span></span></p><p class="calibre_6">You <a id="filepos1239513"/>probably noticed in the previous chapters that by default, Jupyter notebooks hide the majority of data for bigger DataFrames and only show the top and bottom rows as well as the first and last few columns. One way to get a better feeling for your data is to plot it—this allows you to spot outliers or other irregularities. Sometimes, however, it’s just really helpful to be able to scroll through a data table. After reading <a href="index_split_019.html#filepos863345"><span class="calibre_7">Chapter 7</span></a>, you know how to use the <tt class="calibre6">to_excel</tt> method on your DataFrame. While this works, it can be a bit cumbersome: you need to give the Excel file a name, find it on the file system, open it, and, after making changes to your DataFrame, you need to close the Excel file and run the whole process again. A better idea may be to run <tt class="calibre6">df.to_clipboard()</tt>, which copies the DataFrame <tt class="calibre6">df</tt> to the clipboard, allowing you to paste it into Excel, but there is an even simpler way—use the <tt class="calibre6">view</tt> function that comes with xlwings:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># First, let's import the packages that we"ll use in this chapter</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">import</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">datetime</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">as</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">dt</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">import</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">xlwings</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">as</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">xw</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">import</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">pandas</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">as</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">pd</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">import</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">numpy</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">as</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">np</span></span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Let's create a DataFrame based on pseudorandom numbers and</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># with enough rows that only the head and tail are shown</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">np</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">random</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">randn</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">100</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">5</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">),</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                          </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">f</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Trial {i}"</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">for</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">i</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_15">in</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[2]:      Trial 1   Trial 2   Trial 3   Trial 4   Trial 5<br class="calibre1"/>        0  -1.313877  1.164258 -1.306419 -0.529533 -0.524978<br class="calibre1"/>        1  -0.854415  0.022859 -0.246443 -0.229146 -0.005493<br class="calibre1"/>        2  -0.327510 -0.492201 -1.353566 -1.229236  0.024385<br class="calibre1"/>        3  -0.728083 -0.080525  0.628288 -0.382586 -0.590157<br class="calibre1"/>        4  -1.227684  0.498541 -0.266466  0.297261 -1.297985<br class="calibre1"/>        ..       ...       ...       ...       ...       ...<br class="calibre1"/>        95 -0.903446  1.103650  0.033915  0.336871  0.345999<br class="calibre1"/>        96 -1.354898 -1.290954 -0.738396 -1.102659  0.115076<br class="calibre1"/>        97 -0.070092 -0.416991 -0.203445 -0.686915 -1.163205<br class="calibre1"/>        98 -1.201963  0.471854 -0.458501 -0.357171  1.954585<br class="calibre1"/>        99  1.863610  0.214047 -1.426806  0.751906 -2.338352<br class="calibre1"/><br class="calibre1"/>        [100 rows x 5 columns]</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># View the DataFrame in Excel</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">xw</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">view</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><p class="calibre_32">The <tt class="calibre6">view</tt> function accepts all common Python objects, including numbers, strings, lists, dictionaries, tuples, NumPy arrays, and pandas DataFrames. By default, it opens a new workbook and pastes the object into cell A1 of the first sheet—it even adjusts the column widths by using Excel’s AutoFit functionality. Instead of opening a new workbook every time, you can also reuse the same one by providing the <tt class="calibre6">view</tt> function an xlwings <tt class="calibre6">sheet</tt> object as the second argument: <tt class="calibre6">xw.view(df, mysheet)</tt>. How you get access to such a <tt class="calibre6">sheet</tt> object and how it fits into the Excel object model <a id="filepos1248699"/>is what I will explain next.<a id="filepos1248734"/><a href="index_split_025.html#filepos1437838"><span class="calibre5"><span class="calibre_7">2</span></span></a></p><blockquote class="calibre_25"><span class="bold"><span class="calibre_29">MACOS: PERMISSIONS AND PREFERENCES</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">On macOS, make sure to run Jupyter notebooks and VS Code from an Anaconda Prompt (i.e., via Terminal) as shown in </span><a id="filepos1249144"/><a href="index_split_008.html#filepos96824"><span class="calibre5"><span class="calibre_7">Chapter 2</span></span></a><span class="calibre5">. This ensures that you will be greeted by two pop-ups when you use xlwings for the first time: the first one is “Terminal wants access to control System Events” and the second one is “Terminal wants access to control Microsoft Excel.” You will need to confirm both pop-ups to allow Python to automate Excel. In theory, these pop-ups should be triggered by any application from which you run xlwings code, but in practice, that’s often not the case, so running them via the Terminal will keep you out of trouble. Also, you’ll need to open Excel’s Preferences and uncheck “Show Workbook Gallery when opening Excel” under the General category. This opens Excel directly on an empty workbook instead of opening the gallery first, which would get in your way when you open a new Excel instance via xlwings.</span></blockquote><p id="filepos1250093" class="calibre_30"><span class="calibre3"><span class="bold">The Excel Object Model</span></span></p><p class="calibre_6">When <a id="filepos1250235"/>you work with Excel programmatically, you interact with its components like a workbook or a sheet. These components are organized in the <span class="italic">Excel object model</span>, a hierarchical structure that represents Excel’s graphical user interface (see <a href="#filepos1253700"><span class="calibre_7">Figure 9-1</span></a>). Microsoft largely uses the same object model with all programming languages they officially support, whether that’s VBA, Office Scripts (the JavaScript interface for Excel on the web), or C#. In contrast to the reader and writer packages from <a href="index_split_020.html#filepos959867"><span class="calibre_7">Chapter 8</span></a>, xlwings follows the Excel object model very closely, only with a breath of fresh air: for example, xlwings uses the names <tt class="calibre6">app</tt> instead of <tt class="calibre6">application</tt> and <tt class="calibre6">book</tt> instead of <tt class="calibre6">workbook</tt>:</p><div class="calibre_8"> </div><ul class="calibre_9"><li value="1" class="calibre_13"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">An <tt class="calibre6">app</tt> contains the <tt class="calibre6">books</tt> collection</blockquote></blockquote></blockquote></blockquote></li><li value="2" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">A <tt class="calibre6">book</tt> contains the <tt class="calibre6">sheets</tt> collection</blockquote></blockquote></blockquote></blockquote></li><li value="3" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">A <tt class="calibre6">sheet</tt> gives access to <tt class="calibre6">range</tt> objects and collections such as <tt class="calibre6">charts</tt></blockquote></blockquote></blockquote></blockquote></li><li value="4" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">A <tt class="calibre6">range</tt> contains one or more contiguous cells as its items</blockquote></blockquote></blockquote></blockquote></li></ul><p class="calibre_14">The dashed boxes <a id="filepos1252253"/>are <span class="italic">collections</span> and contain one or more objects of the same type. An <tt class="calibre6">app</tt> corresponds<a id="filepos1252360"/> to an Excel instance, i.e., an Excel application that runs as a separate process. Power users sometimes use multiple Excel instances in parallel to open the same workbook twice, for example, to calculate a workbook with different inputs in parallel. With the more recent versions of Excel, Microsoft made it slightly more complicated to open multiple instances of Excel manually: start Excel, then right-click on its icon in the Windows taskbar. In the appearing menu, left-click on the Excel entry while holding down the Alt key at the same time (make sure to keep the Alt key pressed until after you release your mouse button)—a pop-up will ask if you want to start a new instance of Excel. On macOS, there is no manual way of launching more than one instance of the same program but you can launch multiple Excel instances programmatically via xlwings, as we will see later. To summarize, an Excel instance is<a id="filepos1253282"/> a <span class="italic">sandboxed</span> environment, which means that one instance can’t communicate with the other one.<a id="filepos1253391"/><a href="index_split_025.html#filepos1438450"><span class="calibre5"><span class="calibre_7">3</span></span></a> The <tt class="calibre6">sheet</tt> object<a id="filepos1253502"/> gives you access to collections like charts, pictures, and defined names—topics that we will look into in the second section of this chapter.</p><p class="calibre_21"><img src="images/00006.jpg" id="filepos1253700" class="calibre_90"/>
</p><p class="calibre_23"><span class="calibre5"><span class="italic"><span class="calibre_15">Figure 9-1. The Excel object model as implemented by xlwings (excerpt)</span></span></span></p><blockquote class="calibre_39"><span class="bold">LANGUAGE AND REGIONAL SETTINGS</span></blockquote><blockquote class="calibre_27">This <a id="filepos1254107"/>book is based on the US-English version of Excel. I will occasionally refer to default names like “Book1” or “Sheet1,” which will be different if you use Excel in another language. For example, “Sheet1” is called “Feuille1” in French and “Hoja1” in Spanish. Also, the <span class="italic">list separator</span>, which is the separator that Excel uses in cell formulas, depends on your settings: I will be using the comma, but your version may require a semicolon or another character. For example, instead of writing <tt class="calibre6">=SUM(A1, A2)</tt>, you will need to write <tt class="calibre6">=SUMME(A1; A2)</tt> on a computer with German regional settings.</blockquote><blockquote class="calibre_27">On Windows, if<a id="filepos1254821"/> you wanted to change the list separator from a semicolon to a comma, you need to change it outside of Excel via your Windows settings: click on the Windows start button, search for Settings (or click the cog icon), then go to “Time &amp; Language” &gt; “Region &amp; language” &gt; “Additional date, time &amp; regional settings” where you finally click on “Region” &gt; “Change location.” Under “List separator,” you will be able to change it from a semicolon to a comma. Bear in mind that this only works if your “Decimal symbol” (in the same menu) is not also a comma. To override the system-wide decimal and thousands separators (but not the list separator), in Excel go to “Options” &gt; “Advanced,” where you will find the settings under “Editing Options.”</blockquote><blockquote class="calibre_27">On macOS, it<a id="filepos1255706"/> works similarly, except that you can’t change the list separator directly: under System Preferences of your macOS (not Excel), select Language &amp; Region. There, set a specific region either globally (under the General tab) or specifically for Excel (under the Apps<a id="filepos1255983"/> tab).</blockquote><p class="calibre_17">To get a feeling for the Excel object model, as usual, it’s best to play around with it interactively. Let’s start with <a id="filepos1256174"/>the <tt class="calibre6">Book</tt> class: it allows you to create new workbooks and connect to existing ones; see <a href="#filepos1256373"><span class="calibre_7">Table 9-1</span></a> for an overview.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos1256373" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 9-1. Working with Excel workbooks</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Command </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Description </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">xw.Book()</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Returns a  </span><span class="calibre5"><tt class="calibre6">book</tt></span><span class="calibre5"> object representing a new Excel workbook in the active Excel instance. If there is no active instance, Excel will be started.</span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">xw.Book("Book1")</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Returns a  </span><span class="calibre5"><tt class="calibre6">book</tt></span><span class="calibre5"> object representing an unsaved workbook with the name Book1 (name without file extension).</span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">xw.Book("Book1.xlsx")</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Returns a  </span><span class="calibre5"><tt class="calibre6">book</tt></span><span class="calibre5"> object representing a previously saved workbook with the name </span><span class="calibre5"><span class="italic">Book1.xlsx</span></span><span class="calibre5"> (name with file extension). The file has to be either open or in the current working directory.</span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">xw.Book(r"C:\path\Book1.xlsx")</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Returns a  </span><span class="calibre5"><tt class="calibre6">book</tt></span><span class="calibre5"> object of a previously saved workbook (full file path). The file can be open or closed. The leading </span><span class="calibre5"><tt class="calibre6">r</tt></span><span class="calibre5"> turns the string into a raw string so the backslashes (</span><span class="calibre5"><tt class="calibre6">\</tt></span><span class="calibre5">) of the path are interpreted literally on Windows (I introduced raw strings in </span><a href="index_split_015.html#filepos482650"><span class="calibre5"><span class="calibre_7">Chapter 5</span></span></a><span class="calibre5">). On macOS, the </span><span class="calibre5"><tt class="calibre6">r</tt></span><span class="calibre5"> isn’t required as file paths use forward slashes instead of backslashes.</span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">xw.books.active</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Returns a  </span><span class="calibre5"><tt class="calibre6">book</tt></span><span class="calibre5"> object representing the active workbook in the active Excel instance.</span></p></td></tr></table><p class="calibre_17">Let’s see how we can walk through the object model hierarchy from the <tt class="calibre6">book</tt> object down to the <tt class="calibre6">range</tt> object:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Create a new empty workbook and print its name. This is the</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># book we will use to run most of the code samples in this chapter.</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">xw</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">name</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[4]: 'Book2'</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">5</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Accessing the sheets collection</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheets</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[5]: Sheets([&lt;Sheet [Book2]Sheet1&gt;])</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Get a sheet object by index or name. You will need to adjust</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># "Sheet1" if your sheet is called differently.</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheets</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheets</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Sheet1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">7</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[7]: &lt;Range [Book2]Sheet1!$A$1&gt;</tt></span></blockquote><p class="calibre_32">With <a id="filepos1265312"/>the <tt class="calibre6">range</tt> object, we have arrived at the bottom of the hierarchy. The string that gets printed in between angle brackets gives you useful information about that object, but to do something, you usually use the object with an attribute, as the next sample shows:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">8</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Most common tasks: write values...</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                    </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A4"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Hello!"</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">9</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># ...and read values</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:B2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[9]: [[1.0, 2.0], [3.0, 4.0]]</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">10</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A4"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[10]: 'Hello!'</tt></span></blockquote><p class="calibre_32">As you can see, by default, the <tt class="calibre6">value</tt> attribute of an xlwings <tt class="calibre6">range</tt> object accepts and returns a nested list for two-dimensional ranges and a scalar for a single cell. Everything we’ve used so far is almost identical to VBA: assuming that <tt class="calibre6">book</tt> is a VBA or xlwings workbook object, respectively, this is how you access the <tt class="calibre6">value</tt> attribute from cells A1 to B2 in VBA and with xlwings:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Sheets</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:B2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Value</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># VBA</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheets</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:B2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># xlwings</span></span></tt></span></blockquote><p class="calibre_32">The differences are:</p><p class="calibre_6"><span class="italic">Attributes</span></p><blockquote class="calibre_18"><blockquote class="calibre_19">Python uses lowercase letters, potentially with underscores as suggested by PEP 8, Python’s style guide that I introduced in <a href="index_split_010.html#filepos178328"><span class="calibre_7">Chapter 3</span></a>.</blockquote></blockquote><p class="calibre_20"><span class="italic">Indexing</span></p><blockquote class="calibre_18"><blockquote class="calibre_19">Python uses square brackets and zero-based indices to access an element in the <tt class="calibre6">sheets</tt> collection.</blockquote></blockquote><p class="calibre_16"><a href="#filepos1273710"><span class="calibre_7">Table 9-2</span></a> gives you an overview of the strings that an xlwings <tt class="calibre6">range</tt> accepts.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos1273710" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 9-2. Strings to define a range in A1 notation</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Reference </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Description </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">"A1"</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">A Single Cell </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">"A1:B2"</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Cells from A1 to B2 </span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">"A:A"</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Column A </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">"A:B"</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Columns A to B </span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">"1:1"</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Row 1 </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">"1:2"</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Rows 1 to 2 </span></p></td></tr></table><p class="calibre_17">Indexing <a id="filepos1276198"/>and slicing work with xlwings <tt class="calibre6">range</tt> objects—watch the address in between angle brackets (the printed object representation) to see what cell range you end up with:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">11</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Indexing</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:B2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[11]: &lt;Range [Book2]Sheet1!$A$1&gt;</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">12</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Slicing</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:B2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[12]: &lt;Range [Book2]Sheet1!$B$1:$B$2&gt;</tt></span></blockquote><p class="calibre_32">Indexing corresponds to using the <tt class="calibre6">Cells</tt> property in VBA:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Sheets</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:B2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Cells</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># VBA</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheets</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:B2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># xlwings</span></span></tt></span></blockquote><p class="calibre_32">Instead of using <tt class="calibre6">range</tt> explicitly as an attribute of the <tt class="calibre6">sheet</tt> object, you can also get a <tt class="calibre6">range</tt> object by indexing and slicing <a id="filepos1281618"/>the <tt class="calibre6">sheet</tt> object. Using this with A1 notation will allow you to type less, and using this with integer indices makes the Excel sheet feel like a NumPy array:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">13</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Single cell: A1 notation</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[13]: &lt;Range [Book2]Sheet1!$A$1&gt;</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">14</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Multiple cells: A1 notation</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:B2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[14]: &lt;Range [Book2]Sheet1!$A$1:$B$2&gt;</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">15</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Single cell: indexing</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[15]: &lt;Range [Book2]Sheet1!$A$1&gt;</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">16</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Multiple cells: slicing</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[16]: &lt;Range [Book2]Sheet1!$A$1:$B$2&gt;</tt></span></blockquote><p class="calibre_32">Sometimes, however, it may be more intuitive to define a range by referring to the top-left and bottom-right cell of a range. The following samples refer to the cell ranges D10 and D10:F11, respectively, allowing you to understand the difference between indexing/slicing a <tt class="calibre6">sheet</tt> object and working with a <tt class="calibre6">range</tt> object:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">17</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># D10 via sheet indexing</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">9</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[17]: &lt;Range [Book2]Sheet1!$D$10&gt;</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">18</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># D10 via range object</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">((</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">10</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">))</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[18]: &lt;Range [Book2]Sheet1!$D$10&gt;</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">19</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># D10:F11 via sheet slicing</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">9</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">11</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[19]: &lt;Range [Book2]Sheet1!$D$10:$F$11&gt;</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">20</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># D10:F11 via range object</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">((</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">10</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">),</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">11</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">))</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[20]: &lt;Range [Book2]Sheet1!$D$10:$F$11&gt;</tt></span></blockquote><p class="calibre_32">Defining <tt class="calibre6">range</tt> objects with tuples is very similar to how the <tt class="calibre6">Cells</tt> property works in VBA, as the following comparison shows—this assumes again that <tt class="calibre6">book</tt> is either a VBA workbook object or an xlwings <tt class="calibre6">book</tt> object. Let’s first look at the VBA version:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">With</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Sheets</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>    </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">myrange</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Cells</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">10</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">),</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Cells</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">11</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">))</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">End</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">With</span></span></tt></span></blockquote><p class="calibre_32">This is equivalent to the following xlwings <a id="filepos1293849"/>expression:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">myrange</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheets</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">range</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">((</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">10</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">),</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">11</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">))</span></tt></span></blockquote><blockquote class="calibre_25"><span class="bold"><span class="calibre_29">ZERO VS. ONE-BASED INDICES</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">As a Python package, xlwings consistently uses zero-based indexing whenever you access elements via Python’s index or slice syntax, i.e., via square brackets. xlwings </span><a id="filepos1295706"/><span class="calibre5"><tt class="calibre6">range</tt></span><span class="calibre5"> objects, however, use Excel’s one-based row and column indices. Having the same row/column indices as Excel’s user interface may sometimes be beneficial. If you prefer to only ever use Python’s zero-based indexing, simply use the </span><span class="calibre5"><tt class="calibre6">sheet[row_selection, column_selection]</tt></span><span class="calibre5"> syntax.</span></blockquote><p class="calibre_16">The following sample shows you how to get from a <tt class="calibre6">range</tt> object (<tt class="calibre6">sheet1["A1"]</tt>) all the way up again to <a id="filepos1296280"/>the <tt class="calibre6">app</tt> object. Remember that the <tt class="calibre6">app</tt> object represents an Excel instance (the output in between angle brackets represents Excel’s process ID and will therefore be different on your machine):</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">21</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">app</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[21]: &lt;Excel App 9092&gt;</tt></span></blockquote><p class="calibre_32">Having arrived at the very top of the Excel object model, it’s a good moment to see how you can work with multiple Excel instances. You will need to use the <tt class="calibre6">app</tt> object explicitly if you want to open the same workbook in multiple Excel instances or if you specifically want to distribute your workbooks across different instances for performance reasons. Another common use case for working with an <tt class="calibre6">app</tt> object is to open your workbook in a hidden Excel instance: this allows you to run an xlwings script in the background without blocking you from doing other work in Excel in the meantime:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">22</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Get one app object from the open workbook</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># and create an additional invisible app instance</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">visible_app</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">app</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">invisible_app</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">xw</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">App</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">visible</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">False</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">23</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># List the book names that are open in each instance</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># by using a list comprehension</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">name</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">for</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_15">in</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">visible_app</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">books</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[23]: ['Book1', 'Book2']</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">24</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">name</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">for</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_15">in</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">invisible_app</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">books</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[24]: ['Book3']</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">25</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># An app key represents the process ID (PID)</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">xw</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">apps</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">keys</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[25]: [5996, 9092]</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">26</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># It can also be accessed via the pid attribute</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">xw</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">apps</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">active</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pid</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[26]: 5996</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">27</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Work with the book in the invisible Excel instance</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">invisible_book</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">invisible_app</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">books</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">invisible_book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheets</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">][</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Created by an invisible app."</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">28</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Save the Excel workbook in the xl directory</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">invisible_book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">save</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"xl/invisible.xlsx"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">29</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Quit the invisible Excel instance</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">invisible_app</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">quit</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_25"><span class="bold"><span class="calibre_29">MACOS: ACCESSING THE FILE SYSTEM PROGRAMMATICALLY</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">If you run the </span><a id="filepos1309403"/><span class="calibre5"><tt class="calibre6">save</tt></span><span class="calibre5"> command on macOS, you will get a Grant File Access pop-up in Excel that you will need to confirm by clicking the Select button before clicking on Grant Access. On macOS, Excel is </span><span class="calibre5"><span class="italic">sandboxed</span></span><span class="calibre5">, which means that your program can only access files and folders outside of the Excel app by confirming this prompt. Once confirmed, Excel will remember the locations and won’t bug you again when you run the script the next time.</span></blockquote><p class="calibre_16">If you have the same workbook open in two instances of Excel or if you want to specify in which Excel instance you want to open a workbook, you can’t use <tt class="calibre6">xw.Book</tt> anymore. Instead, you need to use <a id="filepos1310200"/>the <tt class="calibre6">books</tt> collection as laid out in <a href="#filepos1310515"><span class="calibre_7">Table 9-3</span></a>. Note that <tt class="calibre6">myapp</tt> stands for an xlwings <tt class="calibre6">app</tt> object. If you would replace <tt class="calibre6">myapp.books</tt> with <tt class="calibre6">xw.books</tt> instead, xlwings will use the active <tt class="calibre6">app</tt>.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos1310515" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 9-3. Working with the </span><span class="calibre5"><tt class="calibre6"><span class="italic">books</span></tt></span><span class="italic"> collection</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Command </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Description </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">myapp.books.add()</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Creates a new Excel workbook in the Excel instance that  </span><span class="calibre5"><tt class="calibre6">myapp</tt></span><span class="calibre5"> refers to and returns the corresponding </span><span class="calibre5"><tt class="calibre6">book</tt></span><span class="calibre5"> object.</span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">myapp.books.open(r"C:\path\Book.xlsx")</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Returns the  </span><span class="calibre5"><tt class="calibre6">book</tt></span><span class="calibre5"> if it’s already open, otherwise opens it first in the Excel instance that </span><span class="calibre5"><tt class="calibre6">myapp</tt></span><span class="calibre5"> refers to. Remember that the leading </span><span class="calibre5"><tt class="calibre6">r</tt></span><span class="calibre5"> turns the file path into a raw string to interpret the backslashes literally.</span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">myapp.books["Book1.xlsx"]</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Returns the  </span><span class="calibre5"><tt class="calibre6">book</tt></span><span class="calibre5"> object if it’s open. This will raise a </span><span class="calibre5"><tt class="calibre6">KeyError</tt></span><span class="calibre5"> if it isn’t open yet. Make sure to use the name and not the full path. Use this if you need to know if a workbook is already open in Excel.</span></p></td></tr></table><p class="calibre_17">Before we dive deeper into how xlwings can <span class="italic">replace</span> your VBA macros, let’s see how xlwings can <span class="italic">interact</span> with your existing VBA code: this can be useful if you have a lot of legacy code and don’t have the time to migrate <a id="filepos1313152"/>everything to Python.</p><p id="filepos1313184" class="calibre_17"><span class="calibre3"><span class="bold">Running VBA Code</span></span></p><p class="calibre_6">If <a id="filepos1313318"/>you have legacy Excel projects with lots of VBA code, it may be a lot of work to migrate everything to Python. In that case, you can use Python to run your VBA macros. The following sample uses the <span class="italic">vba.xlsm</span> file that you will find in the <span class="italic">xl</span> folder of the companion repo. It contains the following code in Module1:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">Function</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_62">MySum</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">x</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_15">As</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_61">Double</span></span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">y</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_15">As</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_61">Double</span></span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_15">As</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_61">Double</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>    </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">MySum</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">x</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">+</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">y</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">End</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">Function</span></span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">Sub</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_62">ShowMsgBox</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">msg</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_15">As</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_61">String</span></span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>    </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">MsgBox</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">msg</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">End</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">Sub</span></span></tt></span></blockquote><p class="calibre_32">To call these functions via Python, you first need to instantiate<a id="filepos1316702"/> an xlwings <tt class="calibre6">macro</tt> object that you subsequently call, making it feel as if it was a native Python function:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">30</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">vba_book</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">xw</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"xl/vba.xlsm"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">31</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Instantiate a macro object with the VBA function</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">mysum</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">vba_book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">macro</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Module1.MySum"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Call a VBA function</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">mysum</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">5</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[31]: 9.0</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">32</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># It works the same with a VBA Sub procedure</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">show_msgbox</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">vba_book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">macro</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Module1.ShowMsgBox"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">show_msgbox</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Hello xlwings!"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">33</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Close the book again (make sure to close the MessageBox first)</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">vba_book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">close</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><div class="mbp_pagebreak" id="calibre_pb_19"/>


<blockquote class="calibre_25"><span class="bold"><span class="calibre_29">DON’T STORE VBA FUNCTIONS IN SHEET AND THISWORKBOOK MODULES</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">If you store the VBA function </span><a id="filepos1322194"/><span class="calibre5"><tt class="calibre6">MySum</tt></span><span class="calibre5"> in the workbook module </span><span class="calibre5"><tt class="calibre6">ThisWorkbook</tt></span><span class="calibre5"> or a sheet module (e.g., </span><span class="calibre5"><tt class="calibre6">Sheet1</tt></span><span class="calibre5">), you have to refer to it as </span><span class="calibre5"><tt class="calibre6">ThisWorkbook.MySum</tt></span><span class="calibre5"> or </span><span class="calibre5"><tt class="calibre6">Sheet1.MySum</tt></span><span class="calibre5">. However, you won’t be able to access the function’s return value from Python, so make sure to store VBA functions in a standard VBA code module that you insert by right-clicking on the Modules folder in the VBA editor.</span></blockquote><p class="calibre_16">Now that you know how to interact with existing <a id="filepos1322929"/>VBA code, we can continue our exploration of xlwings by looking at how to use it with DataFrames, NumPy arrays, and collections like charts, pictures, and defined names.</p><p id="filepos1323109" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Converters, Options, and Collections</span></span></span></p><p class="calibre_6">In the introductory code samples of this chapter, we were already reading and writing a string and a nested list from and to Excel by using the <tt class="calibre6">value</tt> attribute of an xlwings <tt class="calibre6">range</tt> object. I’ll start this section by showing you how this works with pandas DataFrames before having a closer look at the <tt class="calibre6">options</tt> method that allows us to influence how xlwings reads and writes values. We move on with charts, pictures, and defined names, the collections that you usually access from a <tt class="calibre6">sheet</tt> object. Armed with these xlwings basics, we’ll have another look at the reporting case study from <a href="index_split_019.html#filepos863345"><span class="calibre_7">Chapter 7</span></a>.</p><p id="filepos1323983" class="calibre_17"><span class="calibre3"><span class="bold">Working with DataFrames</span></span></p><p class="calibre_6">Writing<a id="filepos1324128"/> a DataFrame to Excel is no different from writing a scalar or a nested list to Excel: simply assign the DataFrame to the top-left cell of an Excel range:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">34</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Mark"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">55</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Italy"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4.5</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Europe"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>               </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"John"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">33</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"USA"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6.7</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"America"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                           </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                    </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"score"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"continent"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                           </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1001</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1000</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">name</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"user_id"</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[34]:          name  age country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001     Mark   55   Italy    4.5    Europe<br class="calibre1"/>         1000     John   33     USA    6.7   America</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">35</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A6"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span></blockquote><p class="calibre_32">If, however, you would like to suppress the column headers and/or the index, use the <tt class="calibre6">options</tt> method like this:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">36</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"B10"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">header</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">False</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">False</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span></blockquote><p class="calibre_32">Reading Excel ranges as DataFrames requires you to provide the <tt class="calibre6">DataFrame</tt> class as the <tt class="calibre6">convert</tt> parameter in the <tt class="calibre6">options</tt> method. By default, it expects that your data has both a header and index, but you can again use the <tt class="calibre6">index</tt> and <tt class="calibre6">header</tt> parameters to change this. Instead of using the converter, you could also read in the values first as a nested list and then manually construct your DataFrame, but using the converter makes it quite a bit easier to handle the index and header.</p><blockquote class="calibre_25"><span class="bold"><span class="calibre_26">THE EXPAND METHOD</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">In the following code sample, I am introducing the </span><a id="filepos1333572"/><span class="calibre5"><tt class="calibre6">expand</tt></span><span class="calibre5"> method that makes it easy to read a contiguous block of cells, delivering the same range as if you were doing Shift+Ctrl+Down-Arrow+Right-Arrow in Excel, except that </span><span class="calibre5"><tt class="calibre6">expand</tt></span><span class="calibre5"> jumps over an empty cell in the top-left corner.</span></blockquote><blockquote class="calibre_91"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">37</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A6"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">expand</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[37]:          name   age country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001.0   Mark  55.0   Italy    4.5    Europe<br class="calibre1"/>         1000.0   John  33.0     USA    6.7   America</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">38</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># If you want the index to be an integer index,</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># you can change its data type</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">astype</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">int</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[38]:       name   age country  score continent<br class="calibre1"/>         1001  Mark  55.0   Italy    4.5    Europe<br class="calibre1"/>         1000  John  33.0     USA    6.7   America</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">39</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># By setting index=False, it will put all the values from Excel into</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># the data part of the DataFrame and will use the default index</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A6"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">expand</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">False</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[39]:    user_id  name   age country  score continent<br class="calibre1"/>         0   1001.0  Mark  55.0   Italy    4.5    Europe<br class="calibre1"/>         1   1000.0  John  33.0     USA    6.7   America</tt></span></blockquote><p class="calibre_32">Reading and writing DataFrames was<a id="filepos1340369"/> a first example of how converters and options work. How they are formally defined and how you use them with other data structures is what we will look into next.</p><p id="filepos1340542" class="calibre_17"><span class="calibre3"><span class="bold">Converters and Options</span></span></p><p class="calibre_6">As we have <a id="filepos1340690"/>just seen, the <tt class="calibre6">options</tt> method of the xlwings <tt class="calibre6">range</tt> object allows you to influence the way that values are read and written from and to Excel. That is, <tt class="calibre6">options</tt> are only evaluated when you call the <tt class="calibre6">value</tt> attribute on a <tt class="calibre6">range</tt> object. The syntax is as follows (<tt class="calibre6">myrange</tt> is an xlwings <tt class="calibre6">range</tt> object):</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">myrange</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">convert</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">None</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">option1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">option2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">...</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><p class="calibre_32"><a href="#filepos1343026"><span class="calibre_7">Table 9-4</span></a> shows the built-in converters, i.e., the values that the <tt class="calibre6">convert</tt> argument accepts. They are called <span class="italic">built-in</span> as xlwings offers a way to write your own converters, which could be useful if you have to repeatedly apply additional transformations before writing or after reading values—to see how it works, have a look at the <a href="https://oreil.ly/Ruw8v"><span class="calibre_7">xlwings docs</span></a>.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos1343026" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 9-4. Built-in converters</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Converter </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Description </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">dict</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Simple dictionaries without nesting, i.e., in the form  </span><span class="calibre5"><tt class="calibre6">{key1: value1, key2: value2, ...}</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">np.array</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">NumPy arrays, requires  </span><span class="calibre5"><tt class="calibre6">import numpy as np</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">pd.Series</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">pandas Series, requires  </span><span class="calibre5"><tt class="calibre6">import pandas as pd</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">pd.DataFrame</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">pandas DataFrame, requires  </span><span class="calibre5"><tt class="calibre6">import pandas as pd</tt></span></p></td></tr></table><p class="calibre_17">We have<a id="filepos1345103"/> already used the <tt class="calibre6">index</tt> and <tt class="calibre6">header</tt> options with the DataFrame example, but there are more<a id="filepos1345217"/> options available, as shown in <a href="#filepos1345335"><span class="calibre_7">Table 9-5</span></a>.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos1345335" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 9-5. Built-in options</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Option </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Description </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">empty</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">By default, empty cells are read as  </span><span class="calibre5"><tt class="calibre6">None</tt></span><span class="calibre5">. Change this by providing a value for </span><span class="calibre5"><tt class="calibre6">empty</tt></span><span class="calibre5">.</span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">date</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Accepts a function that is applied to values from date-formatted cells. </span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">number</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Accepts a function that is applied to numbers. </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">ndim</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><span class="italic">Number of dimensions</span></span><span class="calibre5">: when reading, use </span><span class="calibre5"><tt class="calibre6">ndim</tt></span><span class="calibre5"> to force the values of a range to arrive in a certain dimensionality. Must be either </span><span class="calibre5"><tt class="calibre6">None</tt></span><span class="calibre5">, </span><span class="calibre5"><tt class="calibre6">1</tt></span><span class="calibre5">, or </span><span class="calibre5"><tt class="calibre6">2</tt></span><span class="calibre5">. Can be used when reading values as lists or NumPy arrays.</span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">transpose</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Transposes the values, i.e., turns the columns into rows or vice versa. </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">index</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">To be used with pandas DataFrames and Series: when reading, use it to define whether the Excel range contains the index. Can be  </span><span class="calibre5"><tt class="calibre6">True</tt></span><span class="calibre5">/</span><span class="calibre5"><tt class="calibre6">False</tt></span><span class="calibre5"> or an integer. The integer defines how many columns should be turned into a </span><span class="calibre5"><tt class="calibre6">MultiIndex</tt></span><span class="calibre5">. For example, </span><span class="calibre5"><tt class="calibre6">2</tt></span><span class="calibre5"> will use the two left-most columns as index. When writing, you can decide if you want to write out the index by setting </span><span class="calibre5"><tt class="calibre6">index</tt></span><span class="calibre5"> to </span><span class="calibre5"><tt class="calibre6">True</tt></span><span class="calibre5"> or </span><span class="calibre5"><tt class="calibre6">False</tt></span><span class="calibre5">.</span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">header</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Works the same as  </span><span class="calibre5"><tt class="calibre6">index</tt></span><span class="calibre5">, but applied to the column headers.</span></p></td></tr></table><p class="calibre_17">Let’s have a closer look at <tt class="calibre6">ndim</tt>: by default, when you read in a single cell from Excel, you will get a scalar (e.g., a float or a string); when you read in a column or row, you will get a simple list; and finally, when you read in a two-dimensional range, you will get a nested (i.e., two-dimensional) list. This is not only consistent in itself, but it is also equivalent to how slicing works with NumPy arrays, as seen in <a href="index_split_014.html#filepos433313"><span class="calibre_7">Chapter 4</span></a>. The one-dimensional case is a special one: sometimes, a column may just be an edge case of what is otherwise a two-dimensional range. In this case, it makes sense to force a range to always arrive as a two-dimensional list by using <tt class="calibre6">ndim=2</tt>:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">40</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Horizontal range (one-dimensional)</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:B1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[40]: [1.0, 2.0]</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">41</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Vertical range (one-dimensional)</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:A2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[41]: [1.0, 3.0]</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">42</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Horizontal range (two-dimensional)</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:B1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">ndim</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[42]: [[1.0, 2.0]]</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">43</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Vertical range (two-dimensional)</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:A2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">ndim</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[43]: [[1.0], [3.0]]</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">44</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Using the NumPy array converter behaves the same:</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># vertical range leads to a one-dimensional array</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:A2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">np</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">array</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[44]: array([1., 3.])</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">45</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Preserving the column orientation</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:A2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">np</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">array</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">ndim</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[45]: array([[1.],<br class="calibre1"/>                [3.]])</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">46</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># If you need to write out a list vertically,</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># the "transpose" option comes in handy</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"D1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">transpose</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">True</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">100</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">200</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><p class="calibre_32">Use <tt class="calibre6">ndim=1</tt> to force the value of a single cell to be read as a list instead of a scalar. You won’t need <tt class="calibre6">ndim</tt> with pandas, as a DataFrame is always two-dimensional and a Series is always one-dimensional. Here is one more example showing how the <tt class="calibre6">empty</tt>, <tt class="calibre6">date</tt>, and <tt class="calibre6">number</tt> options work:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">47</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Write out some sample data</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A13"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">dt</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">datetime</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2020</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">),</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">None</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1.0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">48</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Read it back using the default options</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A13:C13"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[48]: [datetime.datetime(2020, 1, 1, 0, 0), None, 1.0]</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">49</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Read it back using non-default options</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A13:C13"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">empty</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"NA"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                   </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">dates</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">dt</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">date</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                   </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">numbers</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">int</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[49]: [datetime.date(2020, 1, 1), 'NA', 1]</tt></span></blockquote><p class="calibre_32">So far, we<a id="filepos1366895"/> have worked with the <tt class="calibre6">book</tt>, <tt class="calibre6">sheet</tt>, and <tt class="calibre6">range</tt> objects. Let’s now move on to learn how to deal with collections such as charts that you access from the <tt class="calibre6">sheet</tt> object!</p><p id="filepos1367107" class="calibre_17"><span class="calibre3"><span class="bold">Charts, Pictures, and Defined Names</span></span></p><p class="calibre_6">In this section, I’ll show you how to work with three collections that you access via the <tt class="calibre6">sheet</tt> or <tt class="calibre6">book</tt> object: charts, pictures, and defined names.<a id="filepos1367425"/><a href="#filepos1438843"><span class="calibre5"><span class="calibre_7">4</span></span></a> xlwings only supports the most basic chart functionality, but since you can work with templates, you may not even be missing much. And to compensate, xlwings allows you to embed Matplotlib plots as pictures—you may remember from <a href="index_split_015.html#filepos482650"><span class="calibre_7">Chapter 5</span></a> that Matplotlib is pandas’ default plotting backend. Let’s start by creating a first Excel chart!</p><p class="calibre_20"><span class="bold"><span class="calibre_5">Excel charts</span></span></p><p class="calibre_6">To<a id="filepos1368049"/> add a new chart, use the <tt class="calibre6">add</tt> method of the <tt class="calibre6">charts</tt> collection, and then set the chart type and source data:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">50</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A15"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">None</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"North"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"South"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Last Year"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">5</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"This Year"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">51</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">chart</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">charts</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">add</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">top</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A19"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">top</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                   </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">left</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A19"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">left</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">chart</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">chart_type</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"column_clustered"</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">chart</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">set_source_data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A15"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">expand</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">())</span></tt></span></blockquote><p class="calibre_32">This will produce the chart shown on the lefthand side of <a href="#filepos1388244"><span class="calibre_7">Figure 9-2</span></a>. To look up the available chart types, have a look<a id="filepos1374395"/> at the <a href="https://oreil.ly/2B58q"><span class="calibre_7">xlwings docs</span></a>. If you enjoy working with pandas plots more than with Excel charts, or if you want to use a chart type that is not available in Excel, xlwings has you covered—let’s see how!</p><p class="calibre_20"><span class="bold"><span class="calibre_5">Pictures: Matplotlib plots</span></span></p><p class="calibre_6">When<a id="filepos1374823"/> you use pandas’ default plotting backend, you are creating a Matplotlib plot. To bring such a plot over to Excel, you first need to get ahold of its <tt class="calibre6">figure</tt> object, which you provide as an argument to <tt class="calibre6">pictures.add</tt>—this will convert the plot into a picture and send it over to Excel:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">52</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Read in the chart data as DataFrame</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A15"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">expand</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[52]:            North  South<br class="calibre1"/>         Last Year    2.0    5.0<br class="calibre1"/>         This Year    3.0    6.0</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">53</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Enable Matplotlib by using the notebook magic command</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># and switch to the "seaborn" style</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">%</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">matplotlib</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">inline</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">import</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">matplotlib.pyplot</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">as</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">plt</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plt</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">style</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">use</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"seaborn"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">54</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># The pandas plot method returns an "axis" object from</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># where you can get the figure. "T" transposes the</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># DataFrame to bring the plot into the desired orientation</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">ax</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">T</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">bar</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">fig</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">ax</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">get_figure</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">55</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Send the plot to Excel</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pictures</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">add</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">fig</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">name</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"SalesPlot"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                    </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">top</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"H19"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">top</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                    </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">left</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"H19"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">left</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Let's scale the plot to 70%</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">width</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">height</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">width</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">*</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0.7</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">height</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">*</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0.7</span></tt></span></blockquote><p class="calibre_32">To update the picture with a new plot, simply use <a id="filepos1385886"/>the <tt class="calibre6">update</tt> method with another <tt class="calibre6">figure</tt> object—technically, this will replace the picture in Excel but will preserve all properties like the location, size, and name:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">56</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">ax</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">+</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">T</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">bar</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">update</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">ax</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">get_figure</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">())</span></tt></span></blockquote><p class="calibre_73"><img src="images/00059.jpg" id="filepos1388244" class="calibre_92"/>
</p><p class="calibre_23"><span class="calibre5"><span class="italic"><span class="calibre_15">Figure 9-2. An Excel chart (left) and Matplotlib plot (right)</span></span></span></p><p class="calibre_24"><a href="#filepos1388244"><span class="calibre_7">Figure 9-2</span></a> shows how the Excel chart and the Matplotlib plot compare after the <tt class="calibre6">update</tt> call.</p><blockquote class="calibre_25"><span class="bold"><span class="calibre_26">MAKE SURE THAT PILLOW IS INSTALLED</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">When working with pictures, make sure that </span><a id="filepos1388937"/><a href="https://oreil.ly/3HYkf"><span class="calibre5"><span class="calibre_7">Pillow</span></span></a><span class="calibre5">, Python’s go-to library for pictures, is installed: this will make sure that the pictures arrive in the correct size and proportion in Excel. Pillow is part of Anaconda, so if you use a different distribution, you’ll need to install it by either running </span><span class="calibre5"><tt class="calibre6">conda install pillow</tt></span><span class="calibre5"> or </span><span class="calibre5"><tt class="calibre6">pip install pillow</tt></span><span class="calibre5">. Note that </span><span class="calibre5"><tt class="calibre6">pictures.add</tt></span><span class="calibre5"> also accepts a path to a picture on disk instead of a Matplotlib figure.</span></blockquote><p class="calibre_16">Charts and pictures <a id="filepos1389691"/>are collections that are accessed via a <tt class="calibre6">sheet</tt> object. Defined names, the collection we are going to look at next, can be accessed from the <tt class="calibre6">sheet</tt> or the <tt class="calibre6">book</tt> object. Let’s see what difference this makes!</p><p class="calibre_20"><span class="bold"><span class="calibre_5">Defined names</span></span></p><p class="calibre_6">In Excel, <a id="filepos1390078"/>you create a <span class="italic">defined name</span> by assigning a name to a range, a formula, or a constant.<a id="filepos1390175"/><a href="#filepos1439272"><span class="calibre5"><span class="calibre_7">5</span></span></a> Assigning a name to a range is probably the most common case and called a <span class="italic">named range</span>. With a named range, you can refer to the Excel range in formulas and code by using a descriptive name rather than an abstract address in the form of <tt class="calibre6">A1:B2</tt>. Using them with xlwings makes your code more flexible and solid: reading and writing values from and to named ranges gives you the flexibility to restructure your workbook without having to adjust your Python code: a name sticks to the cell, even if you move it around by inserting a new row, for example. Defined names can be set on either the global book scope or the local sheet scope. The advantage of a name with sheet scope is that you could copy the sheet without running into conflicts with duplicate named ranges. In Excel, you add defined names manually by going to Formulas &gt; Define Name or by selecting a range, then writing the desired name into the Name Box—this is the text box to the left of the formula bar, where you see the cell address by default. Here is how you manage defined names with xlwings:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">57</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># The book scope is the default scope</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:B2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">name</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"matrix1"</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">58</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># For the sheet scope, prepend the sheet name with</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># an exclamation point</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"B10:E11"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">name</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Sheet1!matrix2"</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">59</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Now you can access the range by name</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"matrix1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[59]: &lt;Range [Book2]Sheet1!$A$1:$B$2&gt;</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">60</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># If you access the names collection via the "sheet1" object,</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># it contains only names with that sheet's scope</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">names</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[60]: [&lt;Name 'Sheet1!matrix2': =Sheet1!$B$10:$E$11&gt;]</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">61</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># If you access the names collection via the "book" object,</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># it contains all names, including book and sheet scope</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">names</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[61]: [&lt;Name 'matrix1': =Sheet1!$A$1:$B$2&gt;, &lt;Name 'Sheet1!matrix2':<br class="calibre1"/>          =Sheet1!$B$10:$E$11&gt;]</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">62</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Names have various methods and attributes.</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># You can, for example, get the respective range object.</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">names</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"matrix1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">refers_to_range</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[62]: &lt;Range [Book2]Sheet1!$A$1:$B$2&gt;</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">63</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># If you want to assign a name to a constant</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># or a formula, use the "add" method</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">names</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">add</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"EURUSD"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"=1.1151"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[63]: &lt;Name 'EURUSD': =1.1151&gt;</tt></span></blockquote><p class="calibre_32">Have a look at the generated defined names in Excel by opening the<a id="filepos1399895"/> Name Manager via Formulas &gt; Name Manager (see <a href="#filepos1400210"><span class="calibre_7">Figure 9-3</span></a>). Note that Excel on macOS doesn’t have a Name Manager—instead, go to Formulas &gt; Define Name, from where you will see the existing names.</p><p class="calibre_21"><img src="images/00014.jpg" id="filepos1400210" class="calibre_93"/>
</p><p class="calibre_23"><span class="calibre5"><span class="italic"><span class="calibre_15">Figure 9-3. Excel’s Name Manager after adding a few defined names via xlwings</span></span></span></p><p class="calibre_24">At this point, <a id="filepos1400526"/>you know how to work with the most commonly used components of an Excel workbook. This means that we can look at the reporting case study from <a href="index_split_019.html#filepos863345"><span class="calibre_7">Chapter 7</span></a> one more time: let’s see what changes when we bring xlwings into the picture!</p><p id="filepos1400825" class="calibre_17"><span class="calibre3"><span class="bold">Case Study (Re-Revisited): Excel Reporting</span></span></p><p class="calibre_6">Being<a id="filepos1400987"/> able to truly edit Excel files via xlwings enables us to work with template files that will be 100% preserved, no matter how complex they are or in which format they are stored—for example, you can easily edit an <span class="italic">xlsb</span> file, a case that is currently not supported by any of the writer packages we met in the previous chapter. When you look at <span class="italic">sales_report_openpxyl.py</span> in the companion repo, you will see that after preparing the <tt class="calibre6">summary</tt> DataFrame, we had to write almost forty lines of code to create one chart and style one DataFrame with OpenPyXL. With xlwings, you achieve the same in just six lines of code, as shown in <a href="#filepos1403182"><span class="calibre_7">Example 9-1</span></a>. Being able to handle the formatting in the Excel template will save you a lot of work. This, however, comes at a price: xlwings requires an installation of Excel to run—that’s usually fine if you have to create these reports infrequently on your own machine, but it may be less ideal if you try to create reports on a server as part of a web application.</p><p class="calibre_6">First, you need to make sure that your Microsoft Office license covers the installation on a server and second, Excel wasn’t made for unattended automation, which means that you may run into stability issues, especially if you need to generate many reports in a short amount of time. That being said, I have seen more than one client doing this successfully, so if you can’t use a writer package for whatever reason, running xlwings on a server may very well be an option worth exploring. Just make sure to run each script in a new Excel instance via <tt class="calibre6">app = xw.App()</tt> to ship around the typical stability issues.</p><p class="calibre_6">You will find the full xlwings script under <span class="italic">sales_report_xlwings.py</span> in the companion repository (the first half is the same as we used with OpenPyXL and XlsxWriter). It is also a perfect example for combining a reader package with xlwings: while pandas (via OpenPyXL and xlrd) is faster with reading many files from disk, xlwings makes it easier to fill in a preformatted <a id="filepos1403162"/>template.</p><p id="filepos1403182" class="calibre_6"><span class="italic">Example 9-1. sales_report_xlwings.py (second part only)</span></p><p class="calibre_63"><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Open the template, paste the data, autofit the columns</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># and adjust the chart source. Then save it under a different name.</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">template</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">xw</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">Book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">this_dir</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">/</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"xl"</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">/</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"sales_report_template.xlsx"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">template</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheets</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Sheet1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"B3"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">summary</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"B3"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">expand</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">autofit</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">charts</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Chart 1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">set_source_data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"B3"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">expand</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()[:</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">-</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">-</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">template</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">save</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">this_dir</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">/</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"sales_report_xlwings.xlsx"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></p><p class="calibre_24">When you run this script for the very first time on macOS (for example by opening it in VS Code and clicking the Run File button), you will have to again confirm a pop-up to grant access to the file system, something we’ve already come across earlier in this chapter.</p><p class="calibre_6">With formatted Excel templates, you can build beautiful Excel reports very quickly. You also get access to methods<a id="filepos1409291"/> like <tt class="calibre6">autofit</tt>, something that’s not available with the writer packages as it relies on calculations done by the Excel application: this allows you to properly set the width and height of your cells according to their content. <a href="#filepos1410076"><span class="calibre_7">Figure 9-4</span></a> shows you the upper part of the sales report as generated by xlwings with a customized table header as well as columns where the <tt class="calibre6">autofit</tt> method has been applied.</p><p class="calibre_6">When you <a id="filepos1409826"/>start using xlwings for more than just filling in a couple of cells in a template, it’s good to know a little bit about its internals: the next section looks at how xlwings works under the hood.</p><p class="calibre_21"><img src="images/00073.jpg" id="filepos1410076" class="calibre_94"/>
</p><p class="calibre_23"><span class="calibre5"><span class="italic"><span class="calibre_15">Figure 9-4. The table of the sales report based on a preformatted template</span></span></span></p><p id="filepos1410331" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Advanced xlwings Topics</span></span></span></p><p class="calibre_6">This section shows you how to make your xlwings code performant and how to work around missing functionality. To understand these topics, though, we first need to say a few words about the way xlwings communicates with Excel.</p><p id="filepos1410727" class="calibre_17"><span class="calibre3"><span class="bold">xlwings Foundations</span></span></p><p class="calibre_6">xlwings<a id="filepos1410868"/> depends on other Python packages to communicate with the automation mechanism of the respective operating system:</p><p class="calibre_6"><span class="italic">Windows</span></p><blockquote class="calibre_18"><blockquote class="calibre_19">On Windows, xlwings relies on the COM technology, short for <span class="italic">Component Object Model</span>. COM is a standard that allows two processes to communicate with each other—in our case Excel and Python. xlwings uses the Python package <a href="https://oreil.ly/tm7sK"><span class="calibre_7">pywin32</span></a> to handle the COM calls.</blockquote><a id="filepos1411455"/></blockquote><p class="calibre_20"><span class="italic">macOS</span></p><blockquote class="calibre_18"><blockquote class="calibre_19">On macOS, xlwings relies on <span class="italic">AppleScript</span>. AppleScript is Apple’s scripting language to automate scriptable applications—fortunately, Excel is such a scriptable application. To run AppleScript commands, xlwings uses the Python package <a href="https://oreil.ly/tIsDd"><span class="calibre_7">appscript</span></a>.</blockquote><a id="filepos1411927"/></blockquote><blockquote class="calibre_25"><span class="bold">WINDOWS: HOW TO PREVENT ZOMBIE PROCESSES</span></blockquote><blockquote class="calibre_27">When <a id="filepos1412114"/>you play around with xlwings on Windows, you will sometimes notice that Excel seems to be completely closed, yet when you open the Task Manager (right-click on the Windows taskbar, then select Task Manager), you will see Microsoft Excel under Background processes on the Processes tab. If you don’t see any tab, click on “More details” first. Alternatively, go to the Details tab, where you will see Excel listed as “EXCEL.EXE.” To terminate a zombie process, right-click the respective row and select “End task” to force Excel to close.</blockquote><blockquote class="calibre_27">Because these processes are <span class="italic">undead</span> rather than properly terminated, they are often called <span class="italic">zombie processes</span>. Leaving them around uses resources and can lead to undesired behavior: for example, files may be blocked or add-ins may not be properly loaded when you open a new instance of Excel. The reason why Excel sometimes doesn’t manage to shut down properly is that processes can only be terminated once there are no more COM references, e.g., in the form of an xlwings <tt class="calibre6">app</tt> object. Most commonly, you end up with an Excel zombie process after killing the Python interpreter as this prevents it from properly cleaning up the COM references. Consider this example on an Anaconda Prompt:</blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>(base)&gt; </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold">python</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>&gt;&gt;&gt; </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold">import xlwings as xw</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>&gt;&gt;&gt; </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold">app = xw.App()</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span></blockquote><blockquote class="calibre_31">Once the new Excel instance is running, quit it again via the Excel user interface: while Excel closes, the Excel process in the Task Manager will keep running. If you shut down the Python session properly by running <tt class="calibre6">quit()</tt> or by using the Ctrl+Z shortcut, the Excel process will eventually be shut down. If, however, you kill the Anaconda Prompt by clicking the “x” at the top right of the window, you will notice that the process sticks around as a zombie process. The same happens if you kill the Anaconda Prompt before closing Excel or if you kill it while it is running a Jupyter server and you hold an xlwings <tt class="calibre6">app</tt> object in one of the Jupyter notebook cells. To minimize the chances of ending up with Excel zombie processes, here are a few suggestions:</blockquote><div class="calibre_8"> </div><ul class="calibre_9"><li value="1" class="calibre_13"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">Run <tt class="calibre6">app.quit()</tt> from Python instead of closing Excel manually. This makes sure that the references are cleaned up properly.</blockquote></blockquote></blockquote></blockquote></li><li value="2" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">Don’t kill interactive Python sessions when you work with xlwings, e.g., if you run a Python REPL on an Anaconda Prompt, shut the Python interpreter down properly by running <tt class="calibre6">quit()</tt> or by using the Ctrl+Z shortcut. When you work with Jupyter notebooks, shut the server down by clicking on Quit on the web interface.</blockquote></blockquote></blockquote></blockquote></li><li value="3" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">With interactive Python sessions, it helps to avoid using the <tt class="calibre6">app</tt> object directly, e.g., by using <tt class="calibre6">xw.Book()</tt> instead of <tt class="calibre6">myapp.books.add()</tt>. This should properly terminate Excel even if the Python process is killed.</blockquote></blockquote></blockquote></blockquote></li></ul><p class="calibre_16">Now that you have an idea about the underlying technology of xlwings, let’s see how we can speed up slow scripts!</p><p id="filepos1416214" class="calibre_17"><span class="calibre3"><span class="bold">Improving Performance</span></span></p><p class="calibre_6">To <a id="filepos1416353"/>keep your xlwings scripts performant, there are a few strategies: the most important one is to keep cross-application calls to an absolute minimum. Using raw values can be another option, and finally, setting the right <tt class="calibre6">app</tt> properties may also help. Let’s go through these options one after another!</p><p class="calibre_20"><span class="bold"><span class="calibre_5">Minimize cross-application calls</span></span></p><p class="calibre_6">It’s <a id="filepos1416834"/>crucial to know that every cross-application call from Python to Excel is “expensive,” i.e., slow. Therefore, such calls should be reduced as much as possible. The easiest way to do this is by reading and writing entire Excel ranges instead of looping through individual cells. In the following example, we read and write 150 cells, first by looping through every cell and then by dealing with the entire range in one call:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">64</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Add a new sheet and write 150 values</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># to it to have something to work with</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet2</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">book</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheets</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">add</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">np</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">arange</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">150</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">reshape</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">30</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">5</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">65</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">%%</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">time</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># This makes 150 cross-application calls</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">for</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">cell</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_15">in</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:E30"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>             </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">cell</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">+=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Wall time: 909 ms</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">66</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">%%</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">time</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># This makes just two cross-application calls</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">values</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1:E30"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">np</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">array</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">values</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">+</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Wall time: 97.2 ms</tt></span></blockquote><p class="calibre_32">These numbers are even more extreme on macOS, where the second option is about 50 times faster than the first one on my machine.</p><p class="calibre_20"><span class="bold"><span class="calibre_5">Raw values</span></span></p><p class="calibre_6">xlwings was<a id="filepos1424751"/> primarily designed with a focus on convenience rather than speed. However, if you deal with huge cell ranges, you may run into situations where you can save time by skipping xlwings’ data cleaning step: xlwings loops through each value when you read and write data, for example, to align data types between Windows and macOS. By using the string <tt class="calibre6">raw</tt> as converter in the <tt class="calibre6">options</tt> method, you skip this step. While this should make all operations faster, the difference may not be significant unless you write large arrays on Windows. Using raw values, however, means that you cannot directly work with DataFrames anymore. Instead, you need to provide your values as nested lists or tuples. Also, you will need to provide the full address of the range you are writing to—providing the top-left cell isn’t enough anymore:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">67</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># With raw values, you must provide the full</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># target range, sheet["A35"] doesn't work anymore</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A35:B36"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"raw"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span></blockquote><p class="calibre_32"><span class="bold"><span class="calibre_5">App properties</span></span></p><p class="calibre_6">Depending on <a id="filepos1428002"/>the content of your workbook, changing the properties of your <tt class="calibre6">app</tt> objects can also help to make code run faster. Usually, you want to look at the following properties (<tt class="calibre6">myapp</tt> is an xlwings <tt class="calibre6">app</tt> object):</p><div class="calibre_8"> </div><ul class="calibre_9"><li value="1" class="calibre_13"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19"><tt class="calibre6">myapp.screen_updating = False</tt></blockquote></blockquote></blockquote></blockquote></li><li value="2" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19"><tt class="calibre6">myapp.calculation = "manual"</tt></blockquote></blockquote></blockquote></blockquote></li><li value="3" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19"><tt class="calibre6">myapp.display_alerts = False</tt></blockquote></blockquote></blockquote></blockquote></li></ul><p class="calibre_14">At the end of the script, make sure to set the attributes back to their original state. If you are on Windows, you may also see a slight performance improvement by running your script in a hidden Excel instance via <tt class="calibre6">xw.App(visible=False)</tt>.</p><p class="calibre_6">Now that you know how to keep <a id="filepos1429357"/>performance under control, let’s have a look at how to extend the functionality of xlwings.</p><p id="filepos1429461" class="calibre_17"><span class="calibre3"><span class="bold">How to Work Around Missing Functionality</span></span></p><p class="calibre_6">xlwings <a id="filepos1429624"/>provides a Pythonic interface for the most commonly used Excel commands and makes them work across Windows and macOS. There are, however, many methods and attributes of the Excel object model that are not yet covered natively by xlwings—but all is not lost! xlwings gives you access to the underlying pywin32 object on Windows and the appscript object on macOS by using the <tt class="calibre6">api</tt> attribute on any xlwings object. This way, you have access to the whole Excel object model, but in turn, you lose cross-platform compatibility. For example, assume you wanted to clear the formatting of a cell. Here is how you would go about this:</p><div class="calibre_8"> </div><ul class="calibre_9"><li value="1" class="calibre_13"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">Check if the method is available on the xlwings <tt class="calibre6">range</tt> object, e.g., by using the Tab key after putting a dot at the end of a <tt class="calibre6">range</tt> object in a Jupyter notebook, by running <tt class="calibre6">dir(sheet["A1"])</tt> or by searching the <a href="https://oreil.ly/EiXBc"><span class="calibre_7">xlwings API reference</span></a>. On VS Code, the available methods should be shown automatically in a tooltip.</blockquote></blockquote></blockquote></blockquote></li><li value="2" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">If the desired functionality is missing, use the <tt class="calibre6">api</tt> attribute to get the underlying object: on Windows, <tt class="calibre6">sheet["A1"].api</tt> will give you a pywin32 object and an on macOS, you will get an appscript object.</blockquote></blockquote></blockquote></blockquote></li><li value="3" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">Check Excel’s object model in the <a href="https://oreil.ly/UILPo"><span class="calibre_7">Excel VBA reference</span></a>. To clear the format of a range, you would end up under <a href="https://oreil.ly/kcEsw"><span class="calibre_7">Range.ClearFormats</span></a>.</blockquote></blockquote></blockquote></blockquote></li><li value="4" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">On Windows, in most cases, you can use the VBA method or property directly with your <tt class="calibre6">api</tt> object. If it is a method, make sure to add parentheses in Python: <tt class="calibre6">sheet["A1"].api.ClearFormats()</tt>. If you are doing this on macOS, things are more complicated as appscript uses a syntax that can be difficult to guess. Your best approach is to look at the developer guide that is part of the <a href="https://oreil.ly/YSS0Y"><span class="calibre_7">xlwings source code</span></a>. Clearing the cell formatting, however, is easy enough: just apply Python’s syntax rules on the method name by using lowercase characters with underscores: <tt class="calibre6">sheet["A1"].api.clear_formats()</tt>.</blockquote></blockquote></blockquote></blockquote></li></ul><p class="calibre_14">If you need to make sure that <tt class="calibre6">ClearFormats</tt> works across both platforms, you can do it as follows (<tt class="calibre6">darwin</tt> is the core of macOS and used as its name by <tt class="calibre6">sys.platform</tt>):</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">import</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">sys</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">if</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sys</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">platform</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">startswith</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"darwin"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">):</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>    </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A10"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">api</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">clear_formats</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">elif</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sys</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">platform</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">startswith</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"win"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">):</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>    </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sheet</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A10"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">api</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">ClearFormats</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><p class="calibre_32">In any case, it’s worth opening an issue on xlwings’ <a href="https://oreil.ly/kFkD0"><span class="calibre_7">GitHub repository</span></a> to have the functionality included in a <a id="filepos1435920"/>future version.</p><p id="filepos1435946" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Conclusion</span></span></span></p><p class="calibre_6">This chapter introduced you to the concept of Excel automation: via xlwings, you can use Python for tasks that you would traditionally do in VBA. We learned about the Excel object model and how xlwings allows you to interact with its components like the <tt class="calibre6">sheet</tt> and <tt class="calibre6">range</tt> objects. Equipped with this knowledge, we went back to the reporting case study from <a href="index_split_019.html#filepos863345"><span class="calibre_7">Chapter 7</span></a> and used xlwings to fill in a preformatted report template; this showed you that there is a case for using the reader packages and xlwings side by side. We also learned about the libraries that xlwings uses under the hood to understand how we can improve performance and work around missing functionality. My favorite xlwings feature is that it works equally well on macOS as it does on Windows. This is even more exciting as Power Query on macOS doesn’t have all the features of the Windows version yet: whatever is missing, you should be able to easily replace it with a combination of pandas and xlwings.</p><p class="calibre_6">Now that you know the xlwings basics, you are ready for the next chapter: there, we’re going to take the next step and call xlwings scripts from Excel itself, allowing you to build Excel tools that are powered by Python.</p><blockquote id="filepos1437419" class="calibre_33"><a href="index_split_024.html#filepos1238292"><span class="calibre5"><span class="calibre_7">1  </span></span></a><span class="calibre5"> On Windows, you need at least Excel 2007, and on macOS, you need at least Excel 2016. Alternatively, you can install the desktop version of Excel, which is part of your Microsoft 365 subscription. Check your subscription for details on how to do this.</span></blockquote><blockquote id="filepos1437838" class="calibre_27"><a href="index_split_024.html#filepos1248734"><span class="calibre5"><span class="calibre_7">2  </span></span></a><span class="calibre5"> Note that xlwings 0.22.0 introduced the </span><span class="calibre5"><tt class="calibre6">xw.load</tt></span><span class="calibre5"> function, which is similar to </span><span class="calibre5"><tt class="calibre6">xw.view</tt></span><span class="calibre5">, but works in the opposite direction: it allows you to load an Excel range easily into a Jupyter notebook as a pandas DataFrame, see </span><a href="https://oreil.ly/x7sTR"><span class="calibre5"><span class="calibre_7">the docs</span></span></a><span class="calibre5">.</span></blockquote><blockquote id="filepos1438450" class="calibre_27"><a href="index_split_024.html#filepos1253391"><span class="calibre5"><span class="calibre_7">3  </span></span></a><span class="calibre5"> See </span><a href="https://oreil.ly/L2FDT"><span class="calibre5"><span class="calibre_7">“What are Excel instances, and why is this important?”</span></span></a><span class="calibre5"> for more information about separate Excel instances.</span></blockquote><blockquote id="filepos1438843" class="calibre_27"><a href="#filepos1367425"><span class="calibre5"><span class="calibre_7">4  </span></span></a><span class="calibre5"> Another popular collection is </span><span class="calibre5"><tt class="calibre6">tables</tt></span><span class="calibre5">. To use them, you need at least xlwings 0.21.0; see the </span><a href="https://oreil.ly/H2Imd"><span class="calibre5"><span class="calibre_7">docs</span></span></a><span class="calibre5">.</span></blockquote><blockquote id="filepos1439272" class="calibre_27"><a href="#filepos1390175"><span class="calibre5"><span class="calibre_7">5  </span></span></a><span class="calibre5"> Defined names with formulas are also used for </span><span class="calibre5"><span class="italic">lambda functions</span></span><span class="calibre5">, a new way of defining user-defined functions without VBA or JavaScript, that Microsoft announced as a new feature for Microsoft 365 subscribers in December 2020.</span></blockquote><div class="mbp_pagebreak" id="calibre_pb_20"/>
</body></html>