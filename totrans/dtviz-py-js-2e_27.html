<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 21. The Menu Bar" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter_d3_ui">
<h1><span class="label">Chapter 21. </span>The Menu Bar</h1>
<p>The previous chapters showed how to build the visual components of our interactive Nobel Prize visualization, the time chart to display all Nobel Prize winners by year, a map to show geographic distributions, a list to display the currently selected winners, and a bar chart to compare absolute and per capita wins by country.<a data-primary="D3 library" data-secondary="menu bar for Nobel Prize visualization" data-type="indexterm" id="ix_D3menu"/><a data-primary="menu bar" data-secondary="creating for D3 Nobel Prize visualization" data-type="indexterm" id="ix_menu"/> In this chapter, we will see how the user interacts with the visualization by using selectors and buttons (see <a data-type="xref" href="#ui_target">Figure 21-1</a>) to create a filtered dataset that is then reflected by the visual components. For example, selecting Physics in the category-select box filters will display only Physics prize winners in the Nobel Prize visualization (Nobel-viz) elements. The filters in our menu bar are cumulative, so we can, for example, select only those female chemists from France to have won the Nobel Prize.<sup><a data-type="noteref" href="ch21.xhtml#idm45607736427392" id="idm45607736427392-marker">1</a></sup></p>
<figure><div class="figure" id="ui_target">
<img alt="dpj2 2101" height="167" src="assets/dpj2_2101.png" width="955"/>
<h6><span class="label">Figure 21-1. </span>This chapter’s target menu bar</h6>
</div></figure>
<p>In the sections ahead, I will show you how to use D3 to build the menu bar and how JavaScript callbacks are used to respond to user-driven changes.</p>
<section data-pdf-bookmark="Creating HTML Elements with D3" data-type="sect1"><div class="sect1" id="idm45607736424352">
<h1>Creating HTML Elements with D3</h1>
<p>Many people think of D3 as a specialized tool for creating SVG visualizations composed of graphical primitives such as lines and circles.<a data-primary="HTML" data-secondary="creating HTML elements with D3" data-type="indexterm" id="idm45607736423056"/><a data-primary="menu bar" data-secondary="creating for D3 Nobel Prize visualization" data-tertiary="creating HTML elements with D3" data-type="indexterm" id="idm45607736422112"/> Though D3 is great for this (the best there is), it’s equally at home creating conventional HTML elements such as tables or selector boxes. For tricky, data-driven HTML complexes like hierarchical menus, D3’s nested data-joins are an ideal way to create the DOM elements and the callbacks to deal with user selections.</p>
<p>We saw in <a data-type="xref" href="ch20.xhtml#chapter_d3_bios">Chapter 20</a> how easy it is to create <code>table</code> rows from a selected dataset or fill in the details of a biography box with a winner’s data. In this chapter, we’ll show how to populate selectors with options based on changing datasets and how to attach callback functions to user interface elements such as selectors and radio boxes.</p>
<div data-type="tip"><h6>Tip</h6>
<p>If you have stable HTML elements (e.g., a select box whose options are not dependent on changing data), it’s best to write them in HTML and then use D3 to attach any callback functions you need to deal with user input. As with CSS styling, you should do as much as possible in vanilla HTML. It keeps the codebase cleaner and is easier to understand by other devs and non-devs. In this chapter, I stretch this rule a bit to demonstrate the creation of HTML elements, but it’s pretty much always the way to go.</p>
</div>
</div></section>
<section data-pdf-bookmark="Building the Menu Bar" data-type="sect1"><div class="sect1" id="idm45607736417712">
<h1>Building the Menu Bar</h1>
<p>As discussed in <a data-type="xref" href="ch16.xhtml#html_skeleton">“The HTML Skeleton”</a>, our Nobel-viz is built on HTML <code>&lt;div&gt;</code> placeholders, fleshed out with JavaScript and D3.<a data-primary="D3 library" data-secondary="menu bar for Nobel Prize visualization" data-tertiary="building the menu bar" data-type="indexterm" id="ix_D3Menubld"/><a data-primary="HTML" data-secondary="skeleton for menu bar in D3 Nobel Prize visualization" data-type="indexterm" id="idm45607736413248"/><a data-primary="menu bar" data-secondary="creating for D3 Nobel Prize visualization" data-tertiary="HTML skeleton" data-type="indexterm" id="idm45607736412272"/> As shown in <a data-type="xref" href="#d3menu_skeleton">Example 21-1</a>, our menu bar is built on the <code>nobel-menu</code> <code>&lt;div&gt;</code>, placed above the main chart holder, and consists of three selector filters (by the winners’ category, gender, and country) and a couple of radio buttons to select the country prize-winning metric (absolute or per capita).</p>
<div data-type="example" id="d3menu_skeleton">
<h5><span class="label">Example 21-1. </span>The HTML skeleton for the menu bar</h5>
<pre data-code-language="html" data-type="programlisting"><code class="cm">&lt;!-- ... --&gt;</code>
<code class="p">&lt;</code><code class="nt">body</code><code class="p">&gt;</code>
<code class="cm">&lt;!-- ... --&gt;</code>
  <code class="cm">&lt;!-- THE PLACEHOLDERS FOR OUR VISUAL COMPONENTS  --&gt;</code>
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"nbviz"</code><code class="p">&gt;</code>
      <code class="cm">&lt;!-- BEGIN MENU BAR --&gt;</code>
      <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"nobel-menu"</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"cat-select"</code><code class="p">&gt;</code>
          Category
          <code class="p">&lt;</code><code class="nt">select</code><code class="p">&gt;&lt;/</code><code class="nt">select</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"gender-select"</code><code class="p">&gt;</code>
          Gender
          <code class="p">&lt;</code><code class="nt">select</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"All"</code><code class="p">&gt;</code>All<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"female"</code><code class="p">&gt;</code>Female<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"male"</code><code class="p">&gt;</code>Male<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
          <code class="p">&lt;/</code><code class="nt">select</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"country-select"</code><code class="p">&gt;</code>
          Country
          <code class="p">&lt;</code><code class="nt">select</code><code class="p">&gt;&lt;/</code><code class="nt">select</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">'metric-radio'</code><code class="p">&gt;</code>
          Number of Winners:<code class="ni">&amp;nbsp;</code>
          <code class="p">&lt;</code><code class="nt">form</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">label</code><code class="p">&gt;</code>absolute
              <code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"radio"</code> <code class="na">name</code><code class="o">=</code><code class="s">"mode"</code> <code class="na">value</code><code class="o">=</code><code class="s">"0"</code> <code class="na">checked</code><code class="p">&gt;</code>
            <code class="p">&lt;/</code><code class="nt">label</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">label</code><code class="p">&gt;</code>per-capita
              <code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"radio"</code> <code class="na">name</code><code class="o">=</code><code class="s">"mode"</code> <code class="na">value</code><code class="o">=</code><code class="s">"1"</code><code class="p">&gt;</code>
            <code class="p">&lt;/</code><code class="nt">label</code><code class="p">&gt;</code>
          <code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
      <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
      <code class="cm">&lt;!-- END MENU BAR  --&gt;</code>
  <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">'chart-holder'</code><code class="p">&gt;</code>
<code class="cm">&lt;!-- ... --&gt;</code>
<code class="p">&lt;/</code><code class="nt">body</code><code class="p">&gt;</code></pre></div>
<p>Now we’ll add the UI elements in turn, starting with the selector <span class="keep-together">filters</span>.</p>
<section data-pdf-bookmark="Building the Category Selector" data-type="sect2"><div class="sect2" id="idm45607736403328">
<h2>Building the Category Selector</h2>
<p>In order to build the category selector, we’re going to need a list of option strings. <a data-primary="menu bar" data-secondary="creating for D3 Nobel Prize visualization" data-tertiary="category selector" data-type="indexterm" id="idm45607736324496"/><a data-primary="category selector (menu bar for D3 visualization)" data-type="indexterm" id="idm45607736323280"/>Let’s create that list using the <code>CATEGORIES</code> list defined in <em>nbviz_core.js</em>:</p>
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code><code> </code><code class="nx">nbviz</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'./nbviz_core.mjs'</code><code>

</code><code class="kd">let</code><code> </code><code class="nx">catList</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">ALL_CATS</code><code class="p">]</code><code class="p">.</code><code class="nx">concat</code><code class="p">(</code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">CATEGORIES</code><code class="p">)</code><code> </code><a class="co" href="#callout_the_menu_bar_CO1-1" id="co_the_menu_bar_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_the_menu_bar_CO1-1" id="callout_the_menu_bar_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Creates the category selector’s list <code>['All Categories', 'Chemistry', 'Economics', …​ ]</code> by concatenating the list <code>['All Categories']</code> and the list <code>['Chemistry', 'Economics', …​ ]</code>.</p></dd>
</dl>
<p>We’re now going to use this category list to make the options tags. We’ll first use D3 to grab the <code>#cat-select</code> select tag:</p>
<pre data-code-language="js" data-type="programlisting"><code class="c1">//...</code>
    <code class="kd">let</code> <code class="nx">catSelect</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#cat-select select'</code><code class="p">);</code></pre>
<p>With <code>catSelect</code> to hand, let’s use a standard D3 data-join to turn our <code>catList</code> list of categories <a data-primary="option tags (HTML)" data-type="indexterm" id="idm45607736125664"/>into HTML <code>option</code> tags:</p>
<pre data-code-language="js" data-type="programlisting"><code class="nx">catSelect</code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'option'</code><code class="p">)</code><code>
   </code><code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="nx">catList</code><code class="p">)</code><code>
   </code><code class="p">.</code><code class="nx">join</code><code class="p">(</code><code class="s1">'option'</code><code class="p">)</code><code> </code><a class="co" href="#callout_the_menu_bar_CO2-1" id="co_the_menu_bar_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
   </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'value'</code><code class="p">,</code><code> </code><code class="nx">d</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">d</code><code class="p">)</code><code> </code><a class="co" href="#callout_the_menu_bar_CO2-2" id="co_the_menu_bar_CO2-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
   </code><code class="p">.</code><code class="nx">html</code><code class="p">(</code><code class="nx">d</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">d</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_the_menu_bar_CO2-1" id="callout_the_menu_bar_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>After data binding, append an <code>option</code> for each <code>catList</code> <span class="keep-together">member</span>.</p></dd>
<dt><a class="co" href="#co_the_menu_bar_CO2-2" id="callout_the_menu_bar_CO2-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We are setting  the <code>option</code>’s <code>value</code> attribute and text to a category (e.g., <code>&lt;option value="Peace"&gt;Peace&lt;/option&gt;</code>).</p></dd>
</dl>
<p>The result of the preceding <code>append</code> operations<a data-primary="append method (D3)" data-type="indexterm" id="idm45607736052336"/><a data-primary="DOM (Document Object Model)" data-secondary="cat-select DOM element for D3 visualization" data-type="indexterm" id="idm45607736019840"/> is the following <code>cat-select</code> DOM element:</p>
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"cat-select"</code><code class="p">&gt;</code>
  "Category "
  <code class="p">&lt;</code><code class="nt">select</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"All Categories"</code><code class="p">&gt;</code>All Categories<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"Chemistry"</code><code class="p">&gt;</code>Chemistry<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"Economics"</code><code class="p">&gt;</code>Economics<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"Literature"</code><code class="p">&gt;</code>Literature<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"Peace"</code><code class="p">&gt;</code>Peace<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"Physics"</code><code class="p">&gt;</code>Physics<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"Physiology or Medicine"</code><code class="p">&gt;</code>
    Physiology or Medicine<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
  <code class="p">&lt;/</code><code class="nt">select</code><code class="p">&gt;</code>
<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code></pre>
<p>Now that we have our selector, we can use D3’s <code>on</code> method <a data-primary="on method (D3)" data-type="indexterm" id="idm45607735984464"/>to attach an event-handler callback function, triggered when the selector is changed:</p>
<pre data-code-language="js" data-type="programlisting"><code class="nx">catSelect</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
        </code><code class="kd">let</code><code> </code><code class="nx">category</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">.</code><code class="nx">property</code><code class="p">(</code><code class="s1">'value'</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_the_menu_bar_CO3-1" id="co_the_menu_bar_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
        </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">filterByCategory</code><code class="p">(</code><code class="nx">category</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_the_menu_bar_CO3-2" id="co_the_menu_bar_CO3-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
        </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">onDataChange</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_the_menu_bar_CO3-3" id="co_the_menu_bar_CO3-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
    </code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_the_menu_bar_CO3-1" id="callout_the_menu_bar_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p><code>this</code> is the select tag, with the <code>value</code> property as the selected category option.</p></dd>
<dt><a class="co" href="#co_the_menu_bar_CO3-2" id="callout_the_menu_bar_CO3-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We call the <code>filterByCategory</code> method defined in <em>nbviz_core.js</em> to filter our dataset for prizes in the category selected.<a data-primary="filterByCategory method (JavaScript)" data-type="indexterm" id="idm45607735848256"/></p></dd>
<dt><a class="co" href="#co_the_menu_bar_CO3-3" id="callout_the_menu_bar_CO3-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p><code>onDataChange</code> triggers the visual-component update methods that will change to reflect our newly filtered dataset.<a data-primary="onDataChange method (JavaScript)" data-type="indexterm" id="idm45607735808976"/></p></dd>
</dl>
<p><a data-type="xref" href="#d3ui_select">Figure 21-2</a> is a schematic of our select callback. Selecting Physics calls the anonymous callback function attached to our selector’s change event. This function initiates the update of the Nobel-viz’s visual elements.</p>
<figure><div class="figure" id="d3ui_select">
<img alt="dpj2 2102" height="633" src="assets/dpj2_2102.png" width="1377"/>
<h6><span class="label">Figure 21-2. </span>The category select callback</h6>
</div></figure>
<p>Within the category selector’s callback,  we first call the <code>filterByCategory</code> method<sup><a data-type="noteref" href="ch21.xhtml#idm45607735804864" id="idm45607735804864-marker">2</a></sup> to select only the Physics winners and the <code>onDataChange</code> method to trigger an update of all the visual components. Where applicable, these will reflect the changed data. For example, the map’s distribution circular indicators will resize, vanishing in the case of countries with no Nobel Physics winners.</p>
</div></section>
<section data-pdf-bookmark="Adding the Gender Selector" data-type="sect2"><div class="sect2" id="idm45607736402736">
<h2>Adding the Gender Selector</h2>
<p>We have already added the HTML for our gender selector <a data-primary="menu bar" data-secondary="creating for D3 Nobel Prize visualization" data-tertiary="gender selector" data-type="indexterm" id="idm45607735802096"/><a data-primary="gender selector (menu bar for D3 visualization)" data-type="indexterm" id="idm45607735800752"/>and its options, in the menu bar’s description in <em>index.xhtml</em>:</p>
<pre data-code-language="html" data-type="programlisting"><code class="cm">&lt;!-- ... --&gt;</code>
        <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"gender-select"</code><code class="p">&gt;</code>
          Gender
          <code class="p">&lt;</code><code class="nt">select</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"All"</code><code class="p">&gt;</code>All<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"female"</code><code class="p">&gt;</code>Female<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="s">"male"</code><code class="p">&gt;</code>Male<code class="p">&lt;/</code><code class="nt">option</code><code class="p">&gt;</code>
          <code class="p">&lt;/</code><code class="nt">select</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
<code class="cm">&lt;!-- ... --&gt;</code></pre>
<p>All we need to do now is select the gender <code>select</code> tag and add a callback function to handle user selections. We can easily achieve this using D3’s <code>on</code> method:</p>
<pre data-code-language="js" data-type="programlisting"><code>    </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#gender-select select'</code><code class="p">)</code><code>
        </code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="kd">let</code><code> </code><code class="nx">gender</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">.</code><code class="nx">property</code><code class="p">(</code><code class="s1">'value'</code><code class="p">)</code><code class="p">;</code><code>
            </code><code class="k">if</code><code class="p">(</code><code class="nx">gender</code><code> </code><code class="o">===</code><code> </code><code class="s1">'All'</code><code class="p">)</code><code class="p">{</code><code>
                </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">genderDim</code><code class="p">.</code><code class="nx">filter</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_the_menu_bar_CO4-1" id="co_the_menu_bar_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
            </code><code class="p">}</code><code>
            </code><code class="k">else</code><code class="p">{</code><code>
                </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">genderDim</code><code class="p">.</code><code class="nx">filter</code><code class="p">(</code><code class="nx">gender</code><code class="p">)</code><code class="p">;</code><code>
            </code><code class="p">}</code><code>
            </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">onDataChange</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_the_menu_bar_CO4-1" id="callout_the_menu_bar_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Calling the gender dimension’s filter without an argument resets it to allow all genders.</p></dd>
</dl>
<p>First, we select the selector’s option value. We then use this value to filter the current dataset. Finally, we call <code>onDataChange</code> to trigger any changes to the Nobel-viz’s  visual components caused by the new dataset.</p>
<p>To place the gender <code>select</code> tag, we use a little CSS, giving it a left margin of 20 pixels:</p>
<pre data-code-language="css" data-type="programlisting"><code class="nf">#gender-select</code><code class="p">{</code><code class="k">margin-left</code><code class="o">:</code><code class="m">20px</code><code class="p">;}</code></pre>
</div></section>
<section data-pdf-bookmark="Adding the Country Selector" data-type="sect2"><div class="sect2" id="idm45607735647184">
<h2>Adding the Country Selector</h2>
<p>Adding the country selector is a little more involved than adding those of category and gender.<a data-primary="menu bar" data-secondary="creating for D3 Nobel Prize visualization" data-tertiary="country selector" data-type="indexterm" id="idm45607735605024"/><a data-primary="country selector (menu bar in D3 visualization)" data-type="indexterm" id="idm45607735603840"/> The distribution of Nobel Prizes by country has a long tail (see <a data-type="xref" href="ch17.xhtml#target_barchart">Figure 17-1</a>), with lots of countries having one or two prizes. We could include all of these in our selector, but it would make it rather long and cumbersome. A better way is to add groups for the single- and double-winning countries, keeping the number of select options manageable and adding a little narrative to the chart, namely the distributions of small winners over time, which might conceivably say something about changing trends in the Nobel Prize award allocation.<sup><a data-type="noteref" href="ch21.xhtml#idm45607735600416" id="idm45607735600416-marker">3</a></sup></p>
<p>In order to add our single- and double-country winner groups, we will need the crossfiltered country dimension to get the group sizes by country.<a data-primary="crossfiltered country dimension in menu bar for D3 visualization" data-type="indexterm" id="idm45607735599392"/> This means creating the country selector after our Nobel Prize dataset has loaded. To do this, we put it in an <code>nbviz.initUI</code> method, called in our main <em>nbviz_main.js</em> script after the crossfilter dimensions have been created (see <a data-type="xref" href="ch16.xhtml#crossfilter">“Filtering Data with Crossfilter”</a>).</p>
<p>The following code creates a selection list. Countries with three or more winners get their own selection slot, below the All Winners selection. Single- and double-country winners are added to their respective lists, which will be used to filter the dataset if the user selects the Single Winning Countries or Double Winning Countries from the selector’s options.</p>
<pre data-code-language="js" data-type="programlisting"><code class="kr">export</code><code> </code><code class="kd">let</code><code> </code><code class="nx">initMenu</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">{</code><code>
    </code><code class="kd">let</code><code> </code><code class="nx">ALL_WINNERS</code><code> </code><code class="o">=</code><code> </code><code class="s1">'All Winners'</code><code class="p">;</code><code>
    </code><code class="kd">let</code><code> </code><code class="nx">SINGLE_WINNERS</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Single Winning Countries'</code><code class="p">;</code><code>
    </code><code class="kd">let</code><code> </code><code class="nx">DOUBLE_WINNERS</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Double Winning Countries'</code><code class="p">;</code><code>

    </code><code class="kd">let</code><code> </code><code class="nx">nats</code><code> </code><code class="o">=</code><code> </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">countrySelectGroups</code><code> </code><code class="o">=</code><code> </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">countryDim</code><code>
        </code><code class="p">.</code><code class="nx">group</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">all</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_the_menu_bar_CO5-1" id="co_the_menu_bar_CO5-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
        </code><code class="p">.</code><code class="nx">sort</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">a</code><code class="p">,</code><code> </code><code class="nx">b</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">return</code><code> </code><code class="nx">b</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">-</code><code> </code><code class="nx">a</code><code class="p">.</code><code class="nx">value</code><code class="p">;</code><code> </code><code class="c1">// descending
</code><code>        </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>

    </code><code class="kd">let</code><code> </code><code class="nx">fewWinners</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="mi">1</code><code class="o">:</code><code class="p">[</code><code class="p">]</code><code class="p">,</code><code> </code><code class="mi">2</code><code class="o">:</code><code class="p">[</code><code class="p">]</code><code class="p">}</code><code class="p">;</code><code> </code><a class="co" href="#callout_the_menu_bar_CO5-2" id="co_the_menu_bar_CO5-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
    </code><code class="kd">let</code><code> </code><code class="nx">selectData</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="nx">ALL_WINNERS</code><code class="p">]</code><code class="p">;</code><code>

    </code><code class="nx">nats</code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">o</code><code class="p">)</code><code> </code><code class="p">{</code><code>
        </code><code class="k">if</code><code class="p">(</code><code class="nx">o</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">&gt;</code><code> </code><code class="mi">2</code><code class="p">)</code><code class="p">{</code><code> </code><a class="co" href="#callout_the_menu_bar_CO5-3" id="co_the_menu_bar_CO5-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
            </code><code class="nx">selectData</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">o</code><code class="p">.</code><code class="nx">key</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="p">}</code><code>
        </code><code class="k">else</code><code class="p">{</code><code>
            </code><code class="nx">fewWinners</code><code class="p">[</code><code class="nx">o</code><code class="p">.</code><code class="nx">value</code><code class="p">]</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">o</code><code class="p">.</code><code class="nx">key</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_the_menu_bar_CO5-4" id="co_the_menu_bar_CO5-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a><code>
        </code><code class="p">}</code><code>
    </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>

    </code><code class="nx">selectData</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code>
        </code><code class="nx">DOUBLE_WINNERS</code><code class="p">,</code><code>
        </code><code class="nx">SINGLE_WINNERS</code><code>
    </code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="c1">//...
</code><code class="p">}</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_the_menu_bar_CO5-1" id="callout_the_menu_bar_CO5-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Sorted group array of form (<code>{key:"United States", value:336}, …​</code>) where <code>value</code> is the number of winners from that country.</p></dd>
<dt><a class="co" href="#co_the_menu_bar_CO5-2" id="callout_the_menu_bar_CO5-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>An object with lists to store single and double winners.</p></dd>
<dt><a class="co" href="#co_the_menu_bar_CO5-3" id="callout_the_menu_bar_CO5-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Countries with more than two winners get their own slot in the <code>selectData</code> list.</p></dd>
<dt><a class="co" href="#co_the_menu_bar_CO5-4" id="callout_the_menu_bar_CO5-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></dt>
<dd><p>Single- and double-winning countries are added to their respective lists based on the group size (value) of 1 or 2.</p></dd>
</dl>
<p>Now that we have our <code>selectData</code> list with corresponding <code>fewWinners</code> arrays, we can use it to create the options for our country selector. We first use D3 to grab the country selector’s <code>select</code> tag and then add the options to it using standard data binding:</p>
<pre data-code-language="js" data-type="programlisting"><code class="kd">let</code> <code class="nx">countrySelect</code> <code class="o">=</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'#country-select select'</code><code class="p">);</code>

<code class="nx">countrySelect</code>
    <code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s2">"option"</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="nx">selectData</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">join</code><code class="p">(</code><code class="s2">"option"</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"value"</code><code class="p">,</code> <code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">d</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">html</code><code class="p">((</code><code class="nx">d</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">d</code><code class="p">);</code></pre>
<p>With our <code>selectData</code> options appended, the selector looks like <a data-type="xref" href="#d3ui_nats_select">Figure 21-3</a>.</p>
<figure><div class="figure" id="d3ui_nats_select">
<img alt="dpj2 2103" height="403" src="assets/dpj2_2103.png" width="601"/>
<h6><span class="label">Figure 21-3. </span>Selector for prizes by country</h6>
</div></figure>
<p>Now all we need is a callback function, triggered when an option is selected, to filter our main dataset by country. The following code shows how it’s done. First, we get the select’s <code>value</code> property (1), a country or one of <code>ALL_WINNERS</code>, <code>DOUBLE_WINNERS</code>, or <code>SINGLE_WINNERS</code>. We then construct a list of countries to send to our national filter method, <code>nbviz.filterByCountries</code> (defined in <em>nbviz_core.js</em>):</p>
<pre data-code-language="js" data-type="programlisting"><code class="nx">countrySelect</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="p">{</code><code>

        </code><code class="kd">let</code><code> </code><code class="nx">countries</code><code class="p">;</code><code>
        </code><code class="kd">let</code><code> </code><code class="nx">country</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">.</code><code class="nx">property</code><code class="p">(</code><code class="s1">'value'</code><code class="p">)</code><code class="p">;</code><code>

        </code><code class="k">if</code><code class="p">(</code><code class="nx">country</code><code> </code><code class="o">===</code><code> </code><code class="nx">ALL_WINNERS</code><code class="p">)</code><code class="p">{</code><code> </code><a class="co" href="#callout_the_menu_bar_CO6-1" id="co_the_menu_bar_CO6-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
            </code><code class="nx">countries</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code class="p">;</code><code>
        </code><code class="p">}</code><code>
        </code><code class="k">else</code><code> </code><code class="k">if</code><code class="p">(</code><code class="nx">country</code><code> </code><code class="o">===</code><code> </code><code class="nx">DOUBLE_WINNERS</code><code class="p">)</code><code class="p">{</code><code>
            </code><code class="nx">countries</code><code> </code><code class="o">=</code><code> </code><code class="nx">fewWinners</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">;</code><code>
        </code><code class="p">}</code><code>
        </code><code class="k">else</code><code> </code><code class="k">if</code><code class="p">(</code><code class="nx">country</code><code> </code><code class="o">===</code><code> </code><code class="nx">SINGLE_WINNERS</code><code class="p">)</code><code class="p">{</code><code>
            </code><code class="nx">countries</code><code> </code><code class="o">=</code><code> </code><code class="nx">fewWinners</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">;</code><code>
        </code><code class="p">}</code><code>
        </code><code class="k">else</code><code class="p">{</code><code>
            </code><code class="nx">countries</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="nx">country</code><code class="p">]</code><code class="p">;</code><code>
        </code><code class="p">}</code><code>

        </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">filterByCountries</code><code class="p">(</code><code class="nx">countries</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_the_menu_bar_CO6-2" id="co_the_menu_bar_CO6-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
        </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">onDataChange</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_the_menu_bar_CO6-3" id="co_the_menu_bar_CO6-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
    </code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_the_menu_bar_CO6-1" id="callout_the_menu_bar_CO6-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>These conditionals make a <code>countries</code> array, depending on the <code>country</code> string. This array is empty, single-valued, or with one of <code>fewWinners</code> arrays.</p></dd>
<dt><a class="co" href="#co_the_menu_bar_CO6-2" id="callout_the_menu_bar_CO6-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Calls <code>filterByCountries</code> to filter our main Nobel-winners dataset using the array of countries.</p></dd>
<dt><a class="co" href="#co_the_menu_bar_CO6-3" id="callout_the_menu_bar_CO6-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Triggers an update to all the Nobel-viz’s elements.</p></dd>
</dl>
<p>The <code>filterByCountries</code> function<a data-primary="filterByCountries function (JavaScript)" data-type="indexterm" id="idm45607735143264"/> is shown in <a data-type="xref" href="#d3ui_filter_by_countries">Example 21-2</a>. An empty <code>countryNames</code> argument resets the filter; otherwise, we filter the country dimension <code>countryDim</code> for all those countries in <code>countryNames</code> <img alt="1" height="12" src="assets/1.png" width="12"/>.</p>
<div data-type="example" id="d3ui_filter_by_countries">
<h5><span class="label">Example 21-2. </span>Filter by countries function</h5>
<pre data-code-language="js" data-type="programlisting"><code class="nx">nbviz</code><code class="p">.</code><code class="nx">filterByCountries</code><code> </code><code class="o">=</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="nx">countryNames</code><code class="p">)</code><code> </code><code class="p">{</code><code>

    </code><code class="k">if</code><code class="p">(</code><code class="o">!</code><code class="nx">countryNames</code><code class="p">.</code><code class="nx">length</code><code class="p">)</code><code class="p">{</code><code> </code><a class="co" href="#callout_the_menu_bar_CO7-1" id="co_the_menu_bar_CO7-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
        </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">countryDim</code><code class="p">.</code><code class="nx">filter</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
    </code><code class="k">else</code><code class="p">{</code><code>
        </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">countryDim</code><code class="p">.</code><code class="nx">filter</code><code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">name</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_the_menu_bar_CO7-2" id="co_the_menu_bar_CO7-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
            </code><code class="k">return</code><code> </code><code class="nx">countryNames</code><code class="p">.</code><code class="nx">indexOf</code><code class="p">(</code><code class="nx">name</code><code class="p">)</code><code> </code><code class="o">&gt;</code><code> </code><code class="o">-</code><code class="mi">1</code><code class="p">;</code><code>
        </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">if</code><code class="p">(</code><code class="nx">countryNames</code><code class="p">.</code><code class="nx">length</code><code> </code><code class="o">===</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">{</code><code> </code><a class="co" href="#callout_the_menu_bar_CO7-3" id="co_the_menu_bar_CO7-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
        </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">activeCountry</code><code> </code><code class="o">=</code><code> </code><code class="nx">countryNames</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
    </code><code class="k">else</code><code class="p">{</code><code>
        </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">activeCountry</code><code> </code><code class="o">=</code><code> </code><code class="kc">null</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_the_menu_bar_CO7-1" id="callout_the_menu_bar_CO7-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Resets the filter if the <code>countryNames</code> array is empty (the user chose All Countries).</p></dd>
<dt><a class="co" href="#co_the_menu_bar_CO7-2" id="callout_the_menu_bar_CO7-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Here, we create a filter function on our <code>crossfilter</code> country dimension, which returns <code>true</code> if a country is in the <code>countryNames</code> list (containing either a single country or all single or double winners).</p></dd>
<dt><a class="co" href="#co_the_menu_bar_CO7-3" id="callout_the_menu_bar_CO7-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Keeps a record of any single selected country in order—for example, to highlight it in the map and bar chart.</p></dd>
</dl></div>
<p>Now that we’ve built the filter selectors for our category, gender, and country dimensions, all we need to do is add the callback function to deal with changes to the prize-winning metric radio button.</p>
</div></section>
<section data-pdf-bookmark="Wiring Up the Metric Radio Button" data-type="sect2"><div class="sect2" id="idm45607735646592">
<h2>Wiring Up the Metric Radio Button</h2>
<p>The metric radio button has already been built<a data-primary="menu bar" data-secondary="creating for D3 Nobel Prize visualization" data-tertiary="wiring up the metric radio button" data-type="indexterm" id="idm45607734943904"/><a data-primary="HTML" data-secondary="for metric radio button in D3 visualization menu bar" data-secondary-sortas="metric" data-type="indexterm" id="idm45607734942704"/><a data-primary="radio button, wiring up to menu bar in D3 visualization" data-type="indexterm" id="idm45607734941488"/> in HTML, consisting of a form with <code>radio</code> inputs:</p>
<pre data-code-language="html" data-type="programlisting"><code>        </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">'metric-radio'</code><code class="p">&gt;</code><code>
          Number of Winners:</code><code class="ni">&amp;nbsp;</code><code> </code><a class="co" href="#callout_the_menu_bar_CO8-1" id="co_the_menu_bar_CO8-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
          </code><code class="p">&lt;</code><code class="nt">form</code><code class="p">&gt;</code><code>
            </code><code class="p">&lt;</code><code class="nt">label</code><code class="p">&gt;</code><code>absolute
              </code><code class="p">&lt;</code><code class="nt">input</code><code>
               </code><code class="na">type</code><code class="o">=</code><code class="s">"radio"</code><code> </code><code class="na">name</code><code class="o">=</code><code class="s">"mode"</code><code> </code><code class="na">value</code><code class="o">=</code><code class="s">"0"</code><code> </code><code class="na">checked</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_the_menu_bar_CO8-2" id="co_the_menu_bar_CO8-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
            </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">label</code><code class="p">&gt;</code><code>
            </code><code class="p">&lt;</code><code class="nt">label</code><code class="p">&gt;</code><code>per-capita
              </code><code class="p">&lt;</code><code class="nt">input</code><code> </code><code class="na">type</code><code class="o">=</code><code class="s">"radio"</code><code> </code><code class="na">name</code><code class="o">=</code><code class="s">"mode"</code><code> </code><code class="na">value</code><code class="o">=</code><code class="s">"1"</code><code class="p">&gt;</code><code>
            </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">label</code><code class="p">&gt;</code><code>
          </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">form</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_the_menu_bar_CO8-1" id="callout_the_menu_bar_CO8-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p><code>&amp;nbsp;</code> is used to create a nonbreaking space between the form and its label.</p></dd>
<dt><a class="co" href="#co_the_menu_bar_CO8-2" id="callout_the_menu_bar_CO8-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Inputs of type <code>radio</code> sharing the same name (<code>mode</code>, in this case) are grouped together, and activating one deactivates all others. They are differentiated by value (<code>0</code> and <code>1</code> in this case). Here we use the <code>checked</code> attribute to activate value <code>0</code> initially.</p></dd>
</dl>
<p>With the radio button form in place, we need only select all its inputs and add a callback function to deal with any button presses triggering a change:</p>
<pre data-code-language="js" data-type="programlisting"><code class="nx">d3</code><code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'#metric-radio input'</code><code class="p">)</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code><code> </code><code class="kd">function</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">{</code><code>
        </code><code class="kd">var</code><code> </code><code class="nx">val</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">.</code><code class="nx">property</code><code class="p">(</code><code class="s1">'value'</code><code class="p">)</code><code class="p">;</code><code>
        </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">valuePerCapita</code><code> </code><code class="o">=</code><code> </code><code class="nb">parseInt</code><code class="p">(</code><code class="nx">val</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_the_menu_bar_CO9-1" id="co_the_menu_bar_CO9-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
        </code><code class="nx">nbviz</code><code class="p">.</code><code class="nx">onDataChange</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
    </code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_the_menu_bar_CO9-1" id="callout_the_menu_bar_CO9-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Update the value of <code>valuePerCapita</code> before calling <code>onDataChange</code> and triggering a redraw of the visual elements.</p></dd>
</dl>
<p>We are storing the current state of the button with our <code>valuePerCapita</code> integer. When the user selects a radio box, this value is changed and a redraw with the new metric is triggered with <code>onDataChange</code>.</p>
<p>We now have the menu bar elements to our Nobel-viz, allowing users to refine the displayed dataset and drill down to subsets they are most curious about.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45607734781904">
<h1>Summary</h1>
<p>In this chapter, we saw how to add selectors and radio-button elements to our Nobel Prize visualization.<a data-primary="D3 library" data-secondary="menu bar for Nobel Prize visualization" data-startref="ix_D3Menubld" data-tertiary="building the menu bar" data-type="indexterm" id="idm45607734780448"/><a data-primary="menu bar" data-secondary="creating for D3 Nobel Prize visualization" data-startref="ix_menu" data-type="indexterm" id="idm45607734778960"/><a data-primary="D3 library" data-secondary="menu bar for Nobel Prize visualization" data-startref="ix_D3menu" data-type="indexterm" id="idm45607734744064"/> There are a number of other user interface HTML tags, such as button groups, groups of checkboxes, time pickers, and plain buttons.<sup><a data-type="noteref" href="ch21.xhtml#idm45607734742848" id="idm45607734742848-marker">4</a></sup> But implementing these controllers involves the same patterns as shown in this chapter. A list of data is used to append and insert DOM elements, setting properties where appropriate, and callback functions are bound to any change events. This is a very powerful method that plays very well with such D3 (and JS) idioms as method chaining and anonymous functions. It will quickly become a very natural part of your D3 workflow.</p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45607736427392"><sup><a href="ch21.xhtml#idm45607736427392-marker">1</a></sup> Remarkably, Marie Curie and her daughter Irène Joliot-Curie hold this distinction.</p><p data-type="footnote" id="idm45607735804864"><sup><a href="ch21.xhtml#idm45607735804864-marker">2</a></sup> Defined in the <em>nbviz_core.js</em> script.</p><p data-type="footnote" id="idm45607735600416"><sup><a href="ch21.xhtml#idm45607735600416-marker">3</a></sup> It does show that among single winners, the Nobel Prize for Peace predominates, followed by Literature.</p><p data-type="footnote" id="idm45607734742848"><sup><a href="ch21.xhtml#idm45607734742848-marker">4</a></sup> There are also native sliders in HTML5, where before one relied on jQuery plug-ins.</p></div></div></section></div></body></html>