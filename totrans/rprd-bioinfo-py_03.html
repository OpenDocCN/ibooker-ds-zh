<html><head></head><body><section data-pdf-bookmark="Chapter 2. Transcribing DNA into mRNA: Mutating Strings, Reading and Writing Files" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch02">&#13;
<h1><span class="label">Chapter 2. </span>Transcribing DNA into mRNA: Mutating Strings, Reading and Writing Files</h1>&#13;
&#13;
&#13;
<p>To express the proteins necessary to sustain life, regions of DNA must be transcribed into a form of RNA called <em>messenger RNA</em> (mRNA).<a data-primary="transcribing DNA into mRNA" data-secondary="about" data-type="indexterm" id="idm45963632246056"/><a data-primary="mRNA" data-secondary="about" data-type="indexterm" id="idm45963632245096"/><a data-primary="DNA" data-secondary="transcribing into mRNA" data-see="transcribing DNA into mRNA" data-type="indexterm" id="idm45963632244152"/><a data-primary="mRNA" data-secondary="transcribing from DNA" data-see="transcribing DNA into mRNA" data-type="indexterm" id="idm45963632242920"/>&#13;
While there are many fascinating biochemical differences between DNA and RNA, for our purposes the only difference is that all the characters <em>T</em> representing the base thymine<a data-primary="thymine (T)" data-type="indexterm" id="idm45963632240936"/><a data-primary="T (thymine)" data-type="indexterm" id="idm45963632240264"/> in a sequence of DNA need to be changed to the letter <em>U</em>, for uracil.<a data-primary="U (uracil)" data-type="indexterm" id="idm45963632238952"/><a data-primary="uracil (U)" data-type="indexterm" id="idm45963632238280"/>&#13;
As described on <a href="https://oreil.ly/9Dddm">the Rosalind RNA page</a>, the program I’ll show you how to write will accept a string of DNA like <code>ACGT</code> and print the transcribed mRNA <code>ACGU</code>.&#13;
I can use Python’s <code>str.replace()</code> function to accomplish this in one line:<a data-primary="transcribing DNA into mRNA" data-secondary="str.replace() to accomplish" data-type="indexterm" id="idm45963632235272"/><a data-primary="strings (str)" data-secondary="replace() function" data-type="indexterm" id="idm45963632234296"/><a data-primary="replace() function for strings" data-type="indexterm" id="idm45963632233352"/></p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; 'GATGGAACTTGACTACGTAAATT'.replace('T', 'U')&#13;
'GAUGGAACUUGACUACGUAAAUU'</pre>&#13;
&#13;
<p>You already saw in <a data-type="xref" href="ch01.html#ch01">Chapter 1</a> how to write a program to accept a DNA sequence from the command line or a file and print a result, so you won’t be learning much if you do that again.&#13;
I’ll make this program more interesting by tackling a very common pattern found in bioinformatics.&#13;
Namely, I’ll show how to process one or more input files and place the results in an output directory.<a data-primary="directory holding output from program" data-type="indexterm" id="ch2-outp"/><a data-primary="output from program" data-secondary="directory holding" data-type="indexterm" id="ch2-outp2"/>&#13;
For instance, it’s pretty common to get the results of a sequencing run back as a directory of files that need to be quality checked and filtered, with the cleaned sequences going into some new directory for your analysis.&#13;
Here the input files contain DNA sequences, one per line, and I’ll write the mRNA sequences into like-named files in an output directory.</p>&#13;
&#13;
<p>In this chapter, you will learn:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>How to write a program to require one or more file inputs</p>&#13;
</li>&#13;
<li>&#13;
<p>How to create directories</p>&#13;
</li>&#13;
</ul>&#13;
<div class="hard-pagebreak"/>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>How to read and write files</p>&#13;
</li>&#13;
<li>&#13;
<p>How to modify strings</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Getting Started" data-type="sect1"><div class="sect1" id="idm45963632222088">&#13;
<h1>Getting Started</h1>&#13;
&#13;
<p>It might help to try running one of the solutions first to see how your program should work.<a data-primary="transcribing DNA into mRNA" data-secondary="getting started" data-type="indexterm" id="idm45963632220712"/>&#13;
Start by changing into the <em>02_rna</em> directory and copying the first solution to the program <code>rna.py</code>:</p>&#13;
&#13;
<pre data-type="programlisting">$ cd 02_rna&#13;
$ cp solution1_str_replace.py rna.py</pre>&#13;
&#13;
<p>Request the usage for the program using the <code>-h</code> flag:<a data-primary="transcribing DNA into mRNA" data-secondary="input from files" data-type="indexterm" id="idm45963632216952"/><a data-primary="transcribing DNA into mRNA" data-secondary="output to directory" data-type="indexterm" id="idm45963632215992"/><a data-primary="input for program" data-secondary="multiple files" data-type="indexterm" id="idm45963632215032"/><a data-primary="arguments" data-secondary="positional" data-type="indexterm" id="idm45963632214088"/><a data-primary="arguments" data-secondary="optional" data-type="indexterm" id="idm45963632213144"/></p>&#13;
&#13;
<pre data-type="programlisting">$ ./rna.py -h&#13;
usage: rna.py [-h] [-o DIR] FILE [FILE ...] <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-1"><img alt="1" src="assets/1.png"/></a>&#13;
&#13;
Transcribe DNA into RNA&#13;
&#13;
positional arguments: <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-2" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-2"><img alt="2" src="assets/2.png"/></a>&#13;
  FILE                  Input DNA file&#13;
&#13;
optional arguments:&#13;
  -h, --help            show this help message and exit&#13;
  -o DIR, --out_dir DIR&#13;
                        Output directory (default: out) <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-3" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-3"><img alt="3" src="assets/3.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The arguments surrounded by square brackets (<code>[]</code>) are optional. The <code>[FILE ...]</code> syntax means that this argument can be repeated.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-2" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The input <code>FILE</code> argument(s) will be positional.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-3" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>The optional output directory has the default value of <code>out</code>.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The goal of the program is to process one or more files, each containing sequences of DNA.&#13;
Here is the first test input file:</p>&#13;
&#13;
<pre data-type="programlisting">$ cat tests/inputs/input1.txt&#13;
GATGGAACTTGACTACGTAAATT</pre>&#13;
&#13;
<p>Run the <code>rna.py</code> program with this input file, and note the output:</p>&#13;
&#13;
<pre data-type="programlisting">$ ./rna.py tests/inputs/input1.txt&#13;
Done, wrote 1 sequence in 1 file to directory "out".</pre>&#13;
&#13;
<p>Now there should be an <em>out</em> directory containing a file called <em>input1.txt</em>:</p>&#13;
&#13;
<pre data-type="programlisting">$ ls out/&#13;
input1.txt</pre>&#13;
&#13;
<p>The contents of that file should match the input DNA sequence but with all the <em>T</em>s changed to <em>U</em>s:</p>&#13;
&#13;
<pre data-type="programlisting">$ cat out/input1.txt&#13;
GAUGGAACUUGACUACGUAAAUU</pre>&#13;
&#13;
<p>You should run the program with multiple inputs and verify that you get multiple files in the output directory.&#13;
Here I will use all the test input files with an output directory called <em>rna</em>.&#13;
Notice how the summary text uses the correct singular/plurals for <em>sequence(s)</em> and <em>file(s)</em>:</p>&#13;
&#13;
<pre data-type="programlisting">$ ./rna.py --out_dir rna tests/inputs/*&#13;
Done, wrote 5 sequences in 3 files to directory "rna".</pre>&#13;
&#13;
<p>I can use the <code>wc</code> (word count) program with the <code>-l</code> option to count the <em>lines</em> in the output file and verify that five sequences were written to three files in the <em>rna</em> <span class="keep-together">directory:</span></p>&#13;
&#13;
<pre data-type="programlisting">$ wc -l rna/*&#13;
       1 rna/input1.txt&#13;
       2 rna/input2.txt&#13;
       2 rna/input3.txt&#13;
       5 total</pre>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Defining the Program’s Parameters" data-type="sect2"><div class="sect2" id="idm45963632181016">&#13;
<h2>Defining the Program’s Parameters</h2>&#13;
&#13;
<p>As you can see from the preceding usage, your program should accept the following parameters:<a data-primary="transcribing DNA into mRNA" data-secondary="parameters of program" data-type="indexterm" id="idm45963632179624"/><a data-primary="parameters" data-secondary="input files, output directory" data-type="indexterm" id="idm45963632178664"/><a data-primary="input for program" data-secondary="multiple files" data-tertiary="parameters" data-type="indexterm" id="idm45963632177704"/></p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>One or more positional arguments, which must be readable text files each containing strings of DNA to transcribe.</p>&#13;
</li>&#13;
<li>&#13;
<p>An optional <code>-o</code> or <code>--out_dir</code> argument that names an output directory to write the sequences of RNA into. The default should be <code>out</code>.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>You are free to write and structure your programs however you like (so long as they pass the tests), but I will always start a program using <strong><code>new.py</code></strong> and the structure I showed in the first chapter.&#13;
The <code>--force</code> flag indicates that the existing <code>rna.py</code> should be overwritten:<a data-primary="new.py for new Python programs" data-secondary="--force flag to overwrite" data-secondary-sortas="force flag to overwrite" data-type="indexterm" id="idm45963632170632"/></p>&#13;
&#13;
<pre data-type="programlisting">$ new.py --force -p "Transcribe DNA to RNA" rna.py&#13;
Done, see new script "rna.py".</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Defining an Optional Parameter" data-type="sect2"><div class="sect2" id="idm45963632168280">&#13;
<h2>Defining an Optional Parameter</h2>&#13;
&#13;
<p>Modify the <code>get_args()</code> function to accept the parameters described in the previous section.<a data-primary="parameters" data-secondary="optional parameter" data-type="indexterm" id="idm45963632166472"/><a data-primary="get_args()" data-secondary="optional parameter" data-type="indexterm" id="idm45963632165528"/>&#13;
To start, define the <code>out_dir</code> parameter.<a data-primary="transcribing DNA into mRNA" data-secondary="output to directory" data-tertiary="out_dir parameter" data-type="indexterm" id="idm45963632163976"/>&#13;
I suggest you change the <code>-a|--arg</code> option generated by <code>new.py</code> to this:</p>&#13;
&#13;
<pre data-type="programlisting">parser.add_argument('-o', <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-1"><img alt="1" src="assets/1.png"/></a>&#13;
                    '--out_dir', <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-2" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-2"><img alt="2" src="assets/2.png"/></a>&#13;
                    help='Output directory', <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-3" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-3"><img alt="3" src="assets/3.png"/></a>&#13;
                    metavar='DIR', <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-4" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-4"><img alt="4" src="assets/4.png"/></a>&#13;
                    type=str, <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-5" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-5"><img alt="5" src="assets/5.png"/></a>&#13;
                    default='out') <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-6" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-6"><img alt="6" src="assets/6.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>This is the short flag name. Short flags start with a single dash and are followed by a single character.<a data-primary="flags" data-secondary="short versus long flag names" data-type="indexterm" id="idm45963632145976"/><a data-primary="flags" data-secondary="one dash versus two" data-type="indexterm" id="idm45963632145016"/><a data-primary="dash (-)" data-secondary="flag names" data-type="indexterm" id="idm45963632144072"/><a data-primary="- (dash)" data-primary-sortas="# dash" data-secondary="flag names" data-type="indexterm" id="idm45963632143128"/></p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-2" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>This is the long flag name. Long flags start with two dashes and are followed by a more memorable string than the short flag. This will also be the name <code>argparse</code> will use to access the value.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-3" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>This will be incorporated into the usage statement to describe the argument.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-4" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>The <code>metavar</code> is a short description also shown in the usage.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-5" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>The default type of all arguments is <code>str</code> (string), so this is technically superfluous but still not a bad idea to document.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-6" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO2-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>The default value will be the string <code>out</code>. If you do not specify a <code>default</code> attribute when defining an option, the default value will be <code>None</code>.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Defining One or More Required Positional Parameters" data-type="sect2"><div class="sect2" id="idm45963632125048">&#13;
<h2>Defining One or More Required Positional Parameters</h2>&#13;
&#13;
<p>For the <code>FILE</code> value(s), I can modify the default <code>-f|--file</code> parameter to look like this:<a data-primary="parameters" data-secondary="positional parameters" data-type="indexterm" id="idm45963632122792"/><a data-primary="transcribing DNA into mRNA" data-secondary="input from files" data-type="indexterm" id="idm45963632121848"/></p>&#13;
&#13;
<pre data-type="programlisting">parser.add_argument('file', <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-1"><img alt="1" src="assets/1.png"/></a>&#13;
                    help='Input DNA file(s)', <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-2" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-2"><img alt="2" src="assets/2.png"/></a>&#13;
                    metavar='FILE', <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-3" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-3"><img alt="3" src="assets/3.png"/></a>&#13;
                    nargs='+', <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-4" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-4"><img alt="4" src="assets/4.png"/></a>&#13;
                    type=argparse.FileType('rt')) <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-5" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-5"><img alt="5" src="assets/5.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Remove the <code>-f</code> short flag and the two dashes from <code>--file</code> so that this becomes a <em>positional</em> argument called <code>file</code>. Optional parameters start with dashes, and positional ones do not.<a data-primary="- (dash)" data-primary-sortas="# dash" data-secondary="parameters" data-type="indexterm" id="idm45963632105368"/><a data-primary="dash (-)" data-secondary="parameters" data-type="indexterm" id="idm45963632104152"/></p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-2" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The <code>help</code> string indicates the argument should be one or more files containing DNA sequences.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-3" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>This string is printed in the short usage to indicate the argument is a file.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-4" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>This indicates the number of arguments. The <code>+</code> indicates that one or more values are required.<a data-primary="arguments" data-secondary="one or more values required" data-type="indexterm" id="idm45963632094152"/><a data-primary="transcribing DNA into mRNA" data-secondary="arguments" data-tertiary="number of" data-type="indexterm" id="idm45963632093192"/></p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-5" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO3-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>This is the actual type that <code>argparse</code> will enforce. I am requiring any value to be a readable text (<code>rt</code>) file.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using nargs to Define the Number of Arguments" data-type="sect2"><div class="sect2" id="idm45963632087864">&#13;
<h2>Using nargs to Define the Number of Arguments</h2>&#13;
&#13;
<p>I use <code>nargs</code> to describe the <em>number of arguments</em> to the program.<a data-primary="transcribing DNA into mRNA" data-secondary="arguments" data-tertiary="number of" data-type="indexterm" id="idm45963632085640"/><a data-primary="arguments" data-secondary="one or more values required" data-type="indexterm" id="idm45963632084408"/>&#13;
In addition to using an integer value to describe exactly how many values are allowed, I can use the three symbols shown in <a data-type="xref" href="#table_2.1">Table 2-1</a>.</p>&#13;
<table id="table_2.1">&#13;
<caption><span class="label">Table 2-1. </span>Possible values for <code>nargs</code></caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Symbol</th>&#13;
<th>Meaning</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>?</code></p></td>&#13;
<td><p>Zero or one</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>*</code></p></td>&#13;
<td><p>Zero or more</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>+</code></p></td>&#13;
<td><p>One or more</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>When you use <code>+</code> with <code>nargs</code>, <code>argparse</code> will provide the arguments as a list.&#13;
Even if there is just one argument, you will get a list containing one element.&#13;
You will never have an empty list because at least one argument is required.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using argparse.FileType() to Validate File Arguments" data-type="sect2"><div class="sect2" id="idm45963632071176">&#13;
<h2>Using argparse.FileType() to Validate File Arguments</h2>&#13;
&#13;
<p>The <code>argparse.FileType()</code> function is incredibly powerful, and using it can save you loads of time in validating file inputs.<a data-primary="transcribing DNA into mRNA" data-secondary="input from files" data-tertiary="validating File arguments" data-type="indexterm" id="idm45963632069320"/><a data-primary="input for program" data-secondary="multiple files" data-tertiary="validating File arguments" data-type="indexterm" id="idm45963632068072"/><a data-primary="file input" data-secondary="validating File arguments" data-type="indexterm" id="idm45963632066840"/><a data-primary="argparse" data-secondary="FileType() to validate File arguments" data-type="indexterm" id="idm45963632065880"/><a data-primary="FileType() to validate File arguments" data-type="indexterm" id="idm45963632064920"/>&#13;
When you define a parameter with this type, <code>argparse</code> will print an error message and halt the execution of the program if any of the arguments is not a file.&#13;
For instance, I would assume there is no file in your <em>02_dna</em> directory called <em>blargh</em>.&#13;
Notice the result when I pass that value:</p>&#13;
&#13;
<pre data-type="programlisting">$ ./rna.py blargh&#13;
usage: rna.py [-h] [-o DIR] FILE [FILE ...]&#13;
rna.py: error: argument FILE: can't open 'blargh': [Errno 2]&#13;
No such file or directory: 'blargh'</pre>&#13;
&#13;
<p>It’s not obvious here, but the program never made it out of the <code>get_args()</code> function because <code>argparse</code> did the following:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Detected that <em>blargh</em> is not a valid file</p>&#13;
</li>&#13;
<li>&#13;
<p>Printed the short usage statement</p>&#13;
</li>&#13;
<li>&#13;
<p>Printed a useful error message</p>&#13;
</li>&#13;
<li>&#13;
<p>Exited the program with a nonzero value</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>This is how a well-written program ought to work, detecting and rejecting bad arguments as soon as possible and notifying the user of the problems.&#13;
All this happened without my writing anything more than a good description of the kind of argument I wanted.&#13;
Again, the best code is code you never write (or as Elon Musk puts it, “The best part is no part, the best process is no process.”)<a data-primary="Musk, Elon" data-type="indexterm" id="idm45963632054904"/></p>&#13;
&#13;
<p>Because I am using the file <em>type</em>, the elements of the list will not be strings representing the filenames but will instead be open filehandles.<a data-primary="filehandle" data-secondary="parameters as" data-type="indexterm" id="idm45963632053224"/><a data-primary="transcribing DNA into mRNA" data-secondary="input from files" data-tertiary="filehandle" data-type="indexterm" id="idm45963632052280"/>&#13;
A <em>filehandle</em> is a mechanism to read and write the contents of a file.&#13;
I used a filehandle in the last chapter when the DNA argument was a filename.</p>&#13;
<div data-type="note" epub:type="note">&#13;
<p>The order in which you define these parameters in your source code does not matter in this instance. You can define options before or after positional parameters. The order only matters when you have multiple positional arguments—the first parameter will be for the first positional argument, the second parameter for the second positional argument, and so forth.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Defining the Args Class" data-type="sect2"><div class="sect2" id="idm45963632048488">&#13;
<h2>Defining the Args Class</h2>&#13;
&#13;
<p>Finally, I need a way to define the <code>Args</code> class that will represent the arguments:<a data-primary="transcribing DNA into mRNA" data-secondary="arguments" data-tertiary="class to represent" data-type="indexterm" id="idm45963632046696"/><a data-primary="classes" data-secondary="arguments represented by" data-type="indexterm" id="idm45963632045464"/></p>&#13;
&#13;
<pre data-type="programlisting">from typing import NamedTuple, List, TextIO <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-1"><img alt="1" src="assets/1.png"/></a>&#13;
&#13;
class Args(NamedTuple):&#13;
    """ Command-line arguments """&#13;
    files: List[TextIO] <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-2" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-2"><img alt="2" src="assets/2.png"/></a>&#13;
    out_dir: str <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-3" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-3"><img alt="3" src="assets/3.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>I’ll need two new imports from the <code>typing</code> module, <code>List</code> to describe a list, and <code>TextIO</code> for an open filehandle.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-2" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The <code>files</code> attribute will be a list of open filehandles.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-3" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO4-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>The <code>out_dir</code> attribute will be a string.</p></dd>&#13;
</dl>&#13;
&#13;
<p>I can use this class to create the return value from <code>get_args()</code>.&#13;
The following syntax uses positional notation such that the <code>file</code> is the first field and the <code>out_dir</code> is the second.&#13;
When there are one or two fields, I will tend to use the positional notation:</p>&#13;
&#13;
<pre data-type="programlisting">return Args(args.file, args.out_dir)</pre>&#13;
&#13;
<p>Explicitly using the field names is safer and arguably easier to read, and it will become vital when I have more fields:</p>&#13;
&#13;
<pre data-type="programlisting">return Args(files=args.file, out_dir=args.out_dir)</pre>&#13;
&#13;
<p>Now I have all the code to define, document, and validate the inputs.&#13;
Next, I’ll show how the rest of the program should work.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before" data-pdf-bookmark="Outlining the Program Using Pseudocode" data-type="sect2"><div class="sect2" id="idm45963632022072">&#13;
<h2>Outlining the Program Using Pseudocode</h2>&#13;
&#13;
<p>I’ll sketch out the basics of the program’s logic in the <code>main()</code> function using a mix of code and pseudocode<a data-primary="transcribing DNA into mRNA" data-secondary="pseudocode to outline program" data-type="indexterm" id="idm45963632019960"/><a data-primary="pseudocode to outline program" data-type="indexterm" id="idm45963632018984"/> to generally describe how to handle the input and output files.&#13;
Whenever you get stuck writing a new program, this approach can help you see <em>what</em> needs to be done.&#13;
Then you can figure out <em>how</em> to do it:</p>&#13;
&#13;
<pre data-type="programlisting">def main() -&gt; None:&#13;
    args = get_args()&#13;
&#13;
    if not os.path.isdir(args.out_dir): <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-1"><img alt="1" src="assets/1.png"/></a>&#13;
        os.makedirs(args.out_dir) <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-2" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-2"><img alt="2" src="assets/2.png"/></a>&#13;
&#13;
    num_files, num_seqs = 0, 0 <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-3" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-3"><img alt="3" src="assets/3.png"/></a>&#13;
    for fh in args.files: <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-4" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-4"><img alt="4" src="assets/4.png"/></a>&#13;
        # open an output file in the output directory <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-5" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-5"><img alt="5" src="assets/5.png"/></a>&#13;
        # for each line/sequence from the input file:&#13;
            # write the transcribed sequence to the output file&#13;
            # update the number of sequences processed&#13;
        # update the number of files processed&#13;
&#13;
    print('Done.') <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-6" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-6"><img alt="6" src="assets/6.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The <code>os.path.isdir()</code> function will report if the output directory exists.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-2" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The <code>os.makedirs()</code> function will create a directory path.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-3" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Initialize variables for the number of files and sequences written to use in the feedback you provide when the program exits.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-4" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Use a <code>for</code> loop to iterate the list of filehandles in <code>args.files</code>. The iterator variable <code>fh</code> helps remind me of the type.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-5" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>This is pseudocode describing the steps you need to do with each filehandle.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-6" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO5-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Print a summary for the user to let them know what happened.</p></dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note">&#13;
<p>The <code>os.makedirs()</code> function will create a directory and all the parent directories, while the <code>os.mkdir()</code> function will fail if the parent directories do not exist. I only ever use the first function in my code.</p>&#13;
</div>&#13;
&#13;
<p>If you think you know how to finish the program, feel free to proceed.&#13;
Be sure to run <strong><code>pytest</code></strong> (or <strong><code>make test</code></strong>) to ensure your code is correct.&#13;
Stick with me if you need a little more guidance on how to read and write files. I’ll tackle the pseudocode in the following sections.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Iterating the Input Files" data-type="sect2"><div class="sect2" id="idm45963631980840">&#13;
<h2>Iterating the Input Files</h2>&#13;
&#13;
<p><a data-primary="transcribing DNA into mRNA" data-secondary="input from files" data-tertiary="iterating input files" data-type="indexterm" id="idm45963631979688"/><a data-primary="input for program" data-secondary="multiple files" data-tertiary="iterating input files" data-type="indexterm" id="idm45963631978456"/><a data-primary="for loops" data-secondary="iterating input files" data-type="indexterm" id="idm45963631977240"/><a data-primary="iterables" data-secondary="for loops with" data-type="indexterm" id="idm45963631976296"/>&#13;
Remember that <code>args.files</code> is a <code>List[TextIO]</code>, meaning that it is a list of filehandles.&#13;
I can use a <code>for</code> loop to visit each element in any iterable in such a list:</p>&#13;
&#13;
<pre data-type="programlisting">for fh in args.files:</pre>&#13;
&#13;
<p>I’d like to stress here that I chose an iterator variable called <code>fh</code> because each value is a filehandle.&#13;
I sometimes see people who always use an iterator variable name like <code>i</code> or <code>x</code> with a <code>for</code> loop, but those are not descriptive variable <a data-primary="Karlton, Phil" data-type="indexterm" id="idm45963631970616"/>names.<sup><a data-type="noteref" href="ch02.html#idm45963631969784" id="idm45963631969784-marker">1</a></sup>&#13;
I’ll concede that it’s very common to use variable names like <code>n</code> (for <em>number</em>) or <code>i</code> (for <em>integer</em>) when iterating numbers like so:</p>&#13;
&#13;
<pre data-type="programlisting">for i in range(10):</pre>&#13;
&#13;
<p>And I will sometimes use <code>x</code> and <code>xs</code> (pronounced <em>exes</em>) to stand for <em>one</em> and <em>many</em> of some generic value:</p>&#13;
&#13;
<pre data-type="programlisting">for x in xs:</pre>&#13;
&#13;
<p>Otherwise, it’s very important to use variable names that accurately describe the thing they represent.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating the Output Filenames" data-type="sect2"><div class="sect2" id="idm45963631962104">&#13;
<h2>Creating the Output Filenames</h2>&#13;
&#13;
<p>Per the pseudocode, the first goal is to open an output file.<a data-primary="transcribing DNA into mRNA" data-secondary="output to directory" data-tertiary="output filenames created" data-type="indexterm" id="idm45963631960744"/>&#13;
For that, I need a filename that combines the name of the output directory with the <em>basename</em> of the input file.&#13;
That is, if the input file is <em>dna/input1.txt</em> and the output directory is <em>rna</em>, then the output file path should be <em>rna/input1.txt</em>.</p>&#13;
&#13;
<p>The <code>os</code> module is used to interact with the operating system (like Windows, macOS, or Linux), <a data-primary="os module" data-secondary="output to files in directory" data-type="indexterm" id="idm45963631956456"/><a data-primary="path module" data-type="indexterm" id="idm45963631955496"/>and the <code>os.path</code> module has many handy functions I can use, like the <code>os.path.dirname()</code> function to get the name of the directory from a file path and <code>os.path.basename()</code> to get the file’s name (see <a data-type="xref" href="#fig_2.1">Figure 2-1</a>):<a data-primary="os module" data-secondary="path.dirname" data-type="indexterm" id="idm45963631952392"/><a data-primary="os module" data-secondary="path.basename" data-type="indexterm" id="idm45963631951448"/><a data-primary="file input" data-secondary="path module" data-type="indexterm" id="idm45963631950504"/></p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; import os&#13;
&gt;&gt;&gt; os.path.dirname('./tests/inputs/input1.txt')&#13;
'./tests/inputs'&#13;
&gt;&gt;&gt; os.path.basename('./tests/inputs/input1.txt')&#13;
'input1.txt'</pre>&#13;
&#13;
<figure><div class="figure" id="fig_2.1">&#13;
<img alt="mpfb 0201" src="assets/mpfb_0201.png" width="250"/>&#13;
<h6><span class="label">Figure 2-1. </span>The <code>os.path</code> module contains useful functions like <code>dirname()</code> and <span class="keep-together"><code>basename()</code></span> to extract parts from a file’s path</h6>&#13;
</div></figure>&#13;
&#13;
<p>The new sequences will be written to an output file in <code>args.out_dir</code>.&#13;
I suggest you use the <code>os.path.join()</code> function with the <a data-primary="join() function for strings" data-type="indexterm" id="idm45963631943224"/><a data-primary="strings (str)" data-secondary="join() function" data-type="indexterm" id="idm45963631942536"/>basename of the input file to create the output filename, as shown in <a data-type="xref" href="#fig_2.2">Figure 2-2</a>.&#13;
This will ensure that the output filename works both on Unix and Windows, which use different path dividers—the slash (<code>/</code>) and backslash (<code>\</code>), respectively.&#13;
You may also want to investigate the <code>pathlib</code> module for similar functionality.</p>&#13;
&#13;
<figure><div class="figure" id="fig_2.2">&#13;
<img alt="mpfb 0202" src="assets/mpfb_0202.png"/>&#13;
<h6><span class="label">Figure 2-2. </span>The <code>os.path.join()</code> will create the output path by combining the output directory with the basename of the input file</h6>&#13;
</div></figure>&#13;
&#13;
<p>You can get the file’s path from the <code>fh.name</code> attribute of the filehandle:</p>&#13;
&#13;
<pre data-type="programlisting">for fh in args.files:&#13;
    out_file = os.path.join(args.out_dir, os.path.basename(fh.name))&#13;
    print(fh.name, '-&gt;', out_file)</pre>&#13;
&#13;
<p>Run your program to verify that it looks like this:</p>&#13;
&#13;
<pre data-type="programlisting">$ ./rna.py tests/inputs/*&#13;
tests/inputs/input1.txt -&gt; out/input1.txt&#13;
tests/inputs/input2.txt -&gt; out/input2.txt&#13;
tests/inputs/input3.txt -&gt; out/input3.txt</pre>&#13;
&#13;
<p>I’m taking baby steps toward what the program is supposed to do.&#13;
It’s very important to write just one or two lines of code and then run your program to see if it’s correct.&#13;
I often see students try to write many lines of code—whole programs, even—before they attempt to run them.&#13;
That never works out well.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Opening the Output Files" data-type="sect2"><div class="sect2" id="openingOutputFiles">&#13;
<h2>Opening the Output Files</h2>&#13;
&#13;
<p>Using this output filename, you need to <code>open()</code> the filehandle.<a data-primary="transcribing DNA into mRNA" data-secondary="output to directory" data-tertiary="opening output files" data-type="indexterm" id="idm45963631930248"/><a data-primary="filehandle" data-secondary="directory holding output files" data-type="indexterm" id="idm45963631929016"/><a data-primary="writing files" data-secondary="directory holding output files" data-type="indexterm" id="idm45963631928056"/>&#13;
I used this function in the first chapter to read DNA from an input file.&#13;
By default, <code>open()</code> will only allow me to read a file, but I need to write a file.&#13;
I can indicate that I want to open the file for writing by passing an optional second argument: the string <code>w</code> for <em>write</em>.</p>&#13;
<div data-type="warning" epub:type="warning">&#13;
<p>When you open an existing file with a mode of <code>w</code>, the file will be <em>overwritten</em>, <a data-primary="writing files" data-secondary="overwrite is default" data-type="indexterm" id="idm45963631923432"/>meaning its previous contents will be immediately and permanently lost. If needed, you can use the <code>os.path.isfile()</code> function to check if you’re opening an existing file.</p>&#13;
</div>&#13;
&#13;
<p>As shown in <a data-type="xref" href="#table_2.2">Table 2-2</a>, you can also use the values <code>r</code> for <em>read</em> (the default) and <code>a</code> to <em>append</em>, which allows you to open for writing more content at the end of an existing file.<a data-primary="open() function" data-secondary="write, read, append" data-type="indexterm" id="idm45963631918440"/></p>&#13;
<table id="table_2.2">&#13;
<caption><span class="label">Table 2-2. </span>File writing modes</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Mode</th>&#13;
<th>Meaning</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>w</code></p></td>&#13;
<td><p>Write</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>r</code></p></td>&#13;
<td><p>Read</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>a</code></p></td>&#13;
<td><p>Append</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p><a data-type="xref" href="#table_2.3">Table 2-3</a> shows that you can also read and write either text or raw bytes using the modes <code>t</code> and <code>b</code>, respectively.<a data-primary="open() function" data-secondary="text or raw bytes" data-type="indexterm" id="idm45963631906824"/><a data-primary="writing files" data-secondary="text or raw bytes" data-type="indexterm" id="idm45963631905880"/></p>&#13;
<table id="table_2.3">&#13;
<caption><span class="label">Table 2-3. </span>File content modes</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Mode</th>&#13;
<th>Meaning</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>t</code></p></td>&#13;
<td><p>Text</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>b</code></p></td>&#13;
<td><p>Bytes</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>You can combine these, for example using <code>rb</code> to <em>read bytes</em> and <code>wt</code> to <em>write text</em>, which is what I want here:</p>&#13;
&#13;
<pre data-type="programlisting">for fh in args.files:&#13;
    out_file = os.path.join(args.out_dir, os.path.basename(fh.name))&#13;
    out_fh = open(out_file, 'wt') <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO6-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO6-1"><img alt="1" src="assets/1.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO6-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO6-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Note that I named my variable <code>out_fh</code> to remind me this is the output filehandle.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Writing the Output Sequences" data-type="sect2"><div class="sect2" id="idm45963631888968">&#13;
<h2>Writing the Output Sequences</h2>&#13;
&#13;
<p>Looking at the pseudocode again, I have two levels of iterating—one for each filehandle of input, <a data-primary="transcribing DNA into mRNA" data-secondary="output to directory" data-tertiary="writing output sequences" data-type="indexterm" id="idm45963631887576"/><a data-primary="writing files" data-secondary="writing output sequences" data-type="indexterm" id="idm45963631886328"/>and then one for each line of DNA in the filehandles.&#13;
To read each line from an open filehandle, I can use another <code>for</code> loop:</p>&#13;
&#13;
<pre data-type="programlisting">for fh in args.files:&#13;
    for dna in fh:</pre>&#13;
&#13;
<p>The <em>input2.txt</em> file has two sequences, each ending with a newline:</p>&#13;
&#13;
<pre data-type="programlisting">$ cat tests/inputs/input2.txt&#13;
TTAGCCCAGACTAGGACTTT&#13;
AACTAGTCAAAGTACACC</pre>&#13;
&#13;
<p>To start, I’ll show you how to print each sequence to the console, then I’ll demonstrate how to use <code>print()</code> to write content to a filehandle.&#13;
<a data-type="xref" href="ch01.html#ch01">Chapter 1</a> mentions that the <code>print()</code> function will automatically append a newline (<code>\n</code> on Unix platforms and <code>\r\n</code> on Windows) unless I tell it not to.<a data-primary="print() function" data-secondary="newline at end" data-type="indexterm" id="idm45963631878984"/><a data-primary="newline at end" data-secondary="print() function adds" data-type="indexterm" id="idm45963631878040"/>&#13;
To avoid having two newlines from the following code, one from the sequence and one from <code>print()</code>, I can either use the <code>str.rstrip()</code> function to remove the newline from the sequence like this:<a data-primary="rstrip() function" data-type="indexterm" id="idm45963631875912"/><a data-primary="strings (str)" data-secondary="formatting" data-tertiary="removing trailing whitespace" data-type="indexterm" id="idm45963631875240"/><a data-primary="stripping white space from strings" data-type="indexterm" id="idm45963631874008"/></p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; fh = open('./tests/inputs/input2.txt')&#13;
&gt;&gt;&gt; for dna in fh:&#13;
...     print(dna.rstrip()) <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO7-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO7-1"><img alt="1" src="assets/1.png"/></a>&#13;
...&#13;
TTAGCCCAGACTAGGACTTT&#13;
AACTAGTCAAAGTACACC</pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO7-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO7-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Use <code>dna.rstrip()</code> to remove the trailing newline.</p></dd>&#13;
</dl>&#13;
&#13;
<p>or use the <code>end</code> option to <code>print()</code>:<a data-primary="print() function" data-secondary="end option" data-type="indexterm" id="idm45963631865352"/><a data-primary="print() function" data-secondary="newline at end" data-tertiary="end option to change" data-type="indexterm" id="idm45963631864408"/></p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; fh = open('./tests/inputs/input2.txt')&#13;
&gt;&gt;&gt; for dna in fh:&#13;
...     print(dna, end='') <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO8-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO8-1"><img alt="1" src="assets/1.png"/></a>&#13;
...&#13;
TTAGCCCAGACTAGGACTTT&#13;
AACTAGTCAAAGTACACC</pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO8-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO8-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Use the empty string at the end instead of a newline.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The goal is to transcribe each DNA sequence to RNA and write the result to <code>out_fh</code>.&#13;
In the introduction to this chapter, I suggested you could use the <code>str.replace()</code> function.&#13;
If you read <code>help(str.replace)</code> in the REPL, you’ll see that it will “Return a copy with all occurrences of substring old replaced by new”:</p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; dna = 'ACTG'&#13;
&gt;&gt;&gt; dna.replace('T', 'U')&#13;
'ACUG'</pre>&#13;
&#13;
<p>There are other ways to change the <em>T</em>s to <em>U</em>s that I will explore later.&#13;
First, I’d like to point out that strings in Python are immutable, meaning they cannot be changed in place.<a data-primary="strings (str)" data-secondary="immutable" data-type="indexterm" id="idm45963631852760"/><a data-primary="variables" data-secondary="strings immutable" data-seealso="strings (str)" data-type="indexterm" id="idm45963631851816"/><a data-primary="errors" data-secondary="strings immutable" data-type="indexterm" id="idm45963631850600"/>&#13;
That is, I could check to see if the letter <em>T</em> is in the DNA string and then use the <code>str.index()</code> function to find the location and try to overwrite it with the letter <em>U</em>, but this will raise an exception:</p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; dna = 'ACTG'&#13;
&gt;&gt;&gt; if 'T' in dna:&#13;
...     dna[dna.index('T')] = 'U'&#13;
...&#13;
Traceback (most recent call last):&#13;
  File "&lt;stdin&gt;", line 2, in &lt;module&gt;&#13;
TypeError: 'str' object does not support item assignment</pre>&#13;
&#13;
<p>Instead, I’ll use <code>str.replace()</code> to create a new string:<a data-primary="replace() function for strings" data-type="indexterm" id="idm45963631846216"/><a data-primary="strings (str)" data-secondary="replace() function" data-type="indexterm" id="idm45963631845528"/></p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; dna.replace('T', 'U')&#13;
'ACUG'&#13;
&gt;&gt;&gt; dna&#13;
'ACTG'</pre>&#13;
&#13;
<p>I need to write this new string into the <code>out_fh</code> output filehandle.&#13;
I have two options.&#13;
First, I can use the <code>print()</code> function’s <code>file</code> option to describe <em>where</em> to print the string.&#13;
Consult the <code>help(print)</code> documentation in the REPL:</p>&#13;
&#13;
<pre data-type="programlisting">print(...)&#13;
    print(value, ..., sep=' ', end='\n', file=sys.stdout, flush=False)&#13;
&#13;
    Prints the values to a stream, or to sys.stdout by default.&#13;
    Optional keyword arguments:&#13;
    file:  a file-like object (stream); defaults to the current sys.stdout. <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO9-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO9-1"><img alt="1" src="assets/1.png"/></a>&#13;
    sep:   string inserted between values, default a space.&#13;
    end:   string appended after the last value, default a newline.&#13;
    flush: whether to forcibly flush the stream.</pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO9-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO9-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>This is the option I need to print the string to the open filehandle.</p></dd>&#13;
</dl>&#13;
&#13;
<p>I need to use the <code>out_fh</code> filehandle as the <code>file</code> argument.&#13;
I want to point out that the default <code>file</code> value is <code>sys.stdout</code>.&#13;
On the command line, <code>STDOUT</code> (pronounced <em>standard out</em>) is the standard place for program output to appear, which is usually the console.<a data-primary="command line (Unix)" data-secondary="STDOUT" data-type="indexterm" id="idm45963631831304"/><a data-primary="STDOUT (standard out)" data-type="indexterm" id="idm45963631830360"/><a data-primary="Unix command line" data-secondary="STDOUT" data-type="indexterm" id="idm45963631829688"/><a data-primary="output from program" data-secondary="STDOUT" data-type="indexterm" id="idm45963631828744"/></p>&#13;
&#13;
<p>Another option is to use the <code>out_fh.write()</code> method of the filehandle itself, but note that this function <em>does not</em> append a newline.<a data-primary="write() method of filehandles" data-type="indexterm" id="idm45963631826392"/><a data-primary="newline at end" data-secondary="write() method does not add" data-type="indexterm" id="idm45963631825704"/>&#13;
It’s up to you to decide when to add newlines.&#13;
In the case of reading these sequences that are terminated with newlines, they are not needed.<a data-startref="ch2-outp" data-type="indexterm" id="idm45963631824456"/><a data-startref="ch2-outp2" data-type="indexterm" id="idm45963631823784"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Printing the Status Report" data-type="sect2"><div class="sect2" id="idm45963631822792">&#13;
<h2>Printing the Status Report</h2>&#13;
&#13;
<p>I almost always like to print something when my programs have finished running so I at least know they got to the end.<a data-primary="transcribing DNA into mRNA" data-secondary="status report printed at end" data-type="indexterm" id="idm45963631821384"/><a data-primary="status report printed at end of execution" data-secondary="writing files to directories" data-type="indexterm" id="idm45963631820408"/>&#13;
It may be something as simple as “Done!” Here, though, I’d like to know how many sequences in how many files were processed.&#13;
I also want to know where I can find the output, something that’s especially helpful if I forget the name of the default output directory.</p>&#13;
&#13;
<p>The tests expect that you will use proper grammar<sup><a data-type="noteref" href="ch02.html#idm45963631818520" id="idm45963631818520-marker">2</a></sup> to describe the numbers—for example, <em>1 sequence</em> and <em>1 file</em>:</p>&#13;
&#13;
<pre data-type="programlisting">$ ./rna.py tests/inputs/input1.txt&#13;
Done, wrote 1 sequence in 1 file to directory "out".</pre>&#13;
&#13;
<p>or <em>3 sequences</em> and <em>2 files</em>:</p>&#13;
&#13;
<pre data-type="programlisting">$ ./rna.py --out_dir rna tests/inputs/input[12].txt <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO10-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO10-1"><img alt="1" src="assets/1.png"/></a>&#13;
Done, wrote 3 sequences in 2 files to directory "rna".</pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO10-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO10-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The syntax <code>input[12].txt</code> is a way to say either 1 or 2 can occur, so <em>input1.txt</em> and <em>input2.txt</em> will both match.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using the Test Suite" data-type="sect2"><div class="sect2" id="idm45963631806904">&#13;
<h2>Using the Test Suite</h2>&#13;
&#13;
<p>You can run <strong><code>pytest -xv</code></strong> to run <em>tests/rna_test.py</em>.<a data-primary="transcribing DNA into mRNA" data-secondary="test suite" data-type="indexterm" id="idm45963631804584"/>&#13;
A passing test suite looks like this:</p>&#13;
&#13;
<pre data-type="programlisting">$ pytest -xv&#13;
======================= test session starts ========================&#13;
...&#13;
&#13;
tests/rna_test.py::test_exists PASSED                        [ 14%] <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-1"><img alt="1" src="assets/1.png"/></a>&#13;
tests/rna_test.py::test_usage PASSED                         [ 28%] <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-2" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-2"><img alt="2" src="assets/2.png"/></a>&#13;
tests/rna_test.py::test_no_args PASSED                       [ 42%] <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-3" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-3"><img alt="3" src="assets/3.png"/></a>&#13;
tests/rna_test.py::test_bad_file PASSED                      [ 57%] <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-4" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-4"><img alt="4" src="assets/4.png"/></a>&#13;
tests/rna_test.py::test_good_input1 PASSED                   [ 71%] <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-5" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-5"><img alt="5" src="assets/5.png"/></a>&#13;
tests/rna_test.py::test_good_input2 PASSED                   [ 85%]&#13;
tests/rna_test.py::test_good_multiple_inputs PASSED          [100%]&#13;
&#13;
======================== 7 passed in 0.37s =========================</pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The <code>rna.py</code> program exists.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-2" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The program prints a usage statement when requested.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-3" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>The program exits with an error when given no arguments.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-4" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>The program prints an error message when given a bad file argument.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-5" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO11-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>The next tests all verify that the program works properly given good inputs.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Generally speaking, I first write tests that try to break a program before giving it good input.&#13;
For instance, I want the program to fail when given no files or when given nonexistent files.&#13;
Just as the best detectives can think like criminals, I try to imagine all the ways to break my programs and test that they behave predictably under those circumstances.</p>&#13;
&#13;
<p>The first three tests are exactly as from <a data-type="xref" href="ch01.html#ch01">Chapter 1</a>.&#13;
For the fourth test, I pass a nonexistent file and expect a nonzero exit value along with the usage and the error message.&#13;
Note that the error specifically mentions the offending value, here the bad filename.&#13;
You should strive to create feedback that lets the user know exactly what the problem is and how to fix it:</p>&#13;
&#13;
<pre data-type="programlisting">def test_bad_file():&#13;
    """ Die on missing input """&#13;
&#13;
    bad = random_filename() <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-1"><img alt="1" src="assets/1.png"/></a>&#13;
    retval, out = getstatusoutput(f'{RUN} {bad}') <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-2" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-2"><img alt="2" src="assets/2.png"/></a>&#13;
    assert retval != 0 <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-3" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-3"><img alt="3" src="assets/3.png"/></a>&#13;
    assert re.match('usage:', out, re.IGNORECASE) <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-4" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-4"><img alt="4" src="assets/4.png"/></a>&#13;
    assert re.search(f"No such file or directory: '{bad}'", out) <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-5" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-5"><img alt="5" src="assets/5.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>This is a function I wrote to generate a string of random characters.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-2" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Run the program with this nonexistent file.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-3" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Make sure the exit value is not <code>0</code>.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-4" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Use a regular expression (<em>regex</em>) to look for the usage in the output.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-5" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO12-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Use another regex to look for the error message describing the bad input <span class="keep-together">filename.</span></p></dd>&#13;
</dl>&#13;
&#13;
<p>I haven’t introduced regular expressions yet, but they will become central to solutions I write later.&#13;
To see why they are useful, look at the output from the program when run with a bad file input:</p>&#13;
&#13;
<pre data-type="programlisting">$ ./rna.py dKej82&#13;
usage: rna.py [-h] [-o DIR] FILE [FILE ...]&#13;
rna.py: error: argument FILE: can't open 'dKej82':&#13;
[Errno 2] No such file or directory: 'dKej82'</pre>&#13;
&#13;
<p>Using the <code>re.match()</code> function, I am looking for a pattern of text starting at the beginning of the <code>out</code> text.&#13;
Using the <code>re.search()</code> function, I am looking for another pattern that occurs somewhere inside the <code>out</code> text.&#13;
I’ll have much more to say about regexes later.&#13;
For now, it’s enough to point out that they are very useful.</p>&#13;
&#13;
<p>I’ll show one last test that verifies the program runs correctly when provided good input.&#13;
There are many ways to write such a test, so don’t get the impression this is canon:</p>&#13;
&#13;
<pre data-type="programlisting">def test_good_input1():&#13;
    """ Runs on good input """&#13;
&#13;
    out_dir = 'out' <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-1"><img alt="1" src="assets/1.png"/></a>&#13;
    try: <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-2" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-2"><img alt="2" src="assets/2.png"/></a>&#13;
        if os.path.isdir(out_dir): <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-3" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-3"><img alt="3" src="assets/3.png"/></a>&#13;
            shutil.rmtree(out_dir) <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-4" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-4"><img alt="4" src="assets/4.png"/></a>&#13;
&#13;
        retval, out = getstatusoutput(f'{RUN} {INPUT1}') <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-5" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-5"><img alt="5" src="assets/5.png"/></a>&#13;
        assert retval == 0&#13;
        assert out == 'Done, wrote 1 sequence in 1 file to directory "out".'&#13;
        assert os.path.isdir(out_dir) <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-6" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-6"><img alt="6" src="assets/6.png"/></a>&#13;
        out_file = os.path.join(out_dir, 'input1.txt')&#13;
        assert os.path.isfile(out_file) <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-7" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-7"><img alt="7" src="assets/7.png"/></a>&#13;
        assert open(out_file).read().rstrip() == 'GAUGGAACUUGACUACGUAAAUU' <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-8" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-8"><img alt="8" src="assets/8.png"/></a>&#13;
&#13;
    finally: <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-9" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-9"><img alt="9" src="assets/9.png"/></a>&#13;
        if os.path.isdir(out_dir): <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-10" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-10"><img alt="10" src="assets/10.png"/></a>&#13;
            shutil.rmtree(out_dir)</pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>This is the default output directory name.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-2" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The <code>try</code>/<code>finally</code> blocks help to ensure cleanup when tests fail.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-3" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>See if the output directory has been left over from a previous run.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-4" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Use the <code>shutil.rmtree()</code> function to remove the directory and its contents.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-5" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Run the program with a known good input file.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-6" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Make sure the expected output directory was created.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-7" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Make sure the expected output file was created.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-8" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>Make sure the contents of the output file are correct.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-9" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-9"><img alt="9" src="assets/9.png"/></a></dt>&#13;
<dd><p>Even if something fails in the <code>try</code> block, this <code>finally</code> block will be run.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-10" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO13-10"><img alt="10" src="assets/10.png"/></a></dt>&#13;
<dd><p>Clean up the testing environment.</p></dd>&#13;
</dl>&#13;
&#13;
<p>I want to stress how important it is to check every aspect of what your program is supposed to do.&#13;
Here, the program should process some number of input files, create an output directory, and then place the processed data into files in the output directory.&#13;
I’m testing every one of those requirements using known input to verify that the expected output is created.</p>&#13;
&#13;
<p>There are a couple of other tests I won’t cover here as they are similar to what I’ve already shown, but I would encourage you to read the entire <em>tests/rna_test.py</em> program.&#13;
The first input file has one sequence.&#13;
The second input file has two sequences, and I use that to test that two sequences are written to the output file.&#13;
The third input file has two very long sequences.&#13;
By using these inputs individually and together, I try to test every aspect of my program that I can imagine.</p>&#13;
&#13;
<p>Although you can run the tests in <em>tests/rna_test.py</em> using <code>pytest</code>, I also urge you to use <code>pylint</code>, <code>flake8</code>, and <code>mypy</code> to check your program.&#13;
The <code>make test</code> shortcut can do this for you as it will execute <code>pytest</code> with the additional arguments to run those tools.&#13;
Your goal should be a completely clean test suite.</p>&#13;
<div data-type="tip">&#13;
<p>You may find that <code>pylint</code> will complain about variable names like <code>fh</code> being too short or not being <em>snake_case</em>, where lowercase words are joined with underscores. I have included a <em>pylintrc</em> configuration file in the top level of the GitHub repository. Copy this to the file <em>.pylintrc</em> in your home directory to silence these errors.</p>&#13;
</div>&#13;
&#13;
<p>You should have enough information and tests now to help you finish this program.&#13;
You’ll get the most benefit from this book if you try to write working programs on your own before you look at my solutions.&#13;
Once you have one working version, try to find other ways to solve it.&#13;
If you know about regular expressions, that’s a great solution.&#13;
If you don’t, I will demonstrate a version that uses them.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solutions" data-type="sect1"><div class="sect1" id="idm45963631683336">&#13;
<h1>Solutions</h1>&#13;
&#13;
<p>The following two solutions differ only in how I substitute the <em>T</em>s for <em>U</em>s.&#13;
The first uses the <code>str.replace()</code> method, and the second introduces regular expressions and uses the Python <code>re.sub()</code> function.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution 1: Using str.replace()" data-type="sect2"><div class="sect2" id="idm45963631679976">&#13;
<h2>Solution 1: Using str.replace()</h2>&#13;
&#13;
<p>Here is the entirety of one solution that uses the <code>str.replace()</code> method I discussed in the introduction to this chapter:<a data-primary="transcribing DNA into mRNA" data-secondary="solution 1 using str.replace" data-type="indexterm" id="idm45963631678136"/></p>&#13;
&#13;
<pre data-type="programlisting">#!/usr/bin/env python3&#13;
""" Transcribe DNA into RNA """&#13;
&#13;
import argparse&#13;
import os&#13;
from typing import NamedTuple, List, TextIO&#13;
&#13;
&#13;
class Args(NamedTuple):&#13;
    """ Command-line arguments """&#13;
    files: List[TextIO]&#13;
    out_dir: str&#13;
&#13;
&#13;
# --------------------------------------------------&#13;
def get_args() -&gt; Args:&#13;
    """ Get command-line arguments """&#13;
&#13;
    parser = argparse.ArgumentParser(&#13;
        description='Transcribe DNA into RNA',&#13;
        formatter_class=argparse.ArgumentDefaultsHelpFormatter)&#13;
&#13;
    parser.add_argument('file',&#13;
                        help='Input DNA file',&#13;
                        metavar='FILE',&#13;
                        type=argparse.FileType('rt'),&#13;
                        nargs='+')&#13;
&#13;
    parser.add_argument('-o',&#13;
                        '--out_dir',&#13;
                        help='Output directory',&#13;
                        metavar='DIR',&#13;
                        type=str,&#13;
                        default='out')&#13;
&#13;
    args = parser.parse_args()&#13;
&#13;
    return Args(args.file, args.out_dir)&#13;
&#13;
&#13;
# --------------------------------------------------&#13;
def main() -&gt; None:&#13;
    """ Make a jazz noise here """&#13;
&#13;
    args = get_args()&#13;
&#13;
    if not os.path.isdir(args.out_dir):&#13;
        os.makedirs(args.out_dir)&#13;
&#13;
    num_files, num_seqs = 0, 0 <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-1"><img alt="1" src="assets/1.png"/></a>&#13;
    for fh in args.files: <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-2" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-2"><img alt="2" src="assets/2.png"/></a>&#13;
        num_files += 1 <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-3" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-3"><img alt="3" src="assets/3.png"/></a>&#13;
        out_file = os.path.join(args.out_dir, os.path.basename(fh.name))&#13;
        out_fh = open(out_file, 'wt') <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-4" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-4"><img alt="4" src="assets/4.png"/></a>&#13;
&#13;
        for dna in fh: <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-5" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-5"><img alt="5" src="assets/5.png"/></a>&#13;
            num_seqs += 1 <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-6" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-6"><img alt="6" src="assets/6.png"/></a>&#13;
            out_fh.write(dna.replace('T', 'U')) <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-7" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-7"><img alt="7" src="assets/7.png"/></a>&#13;
&#13;
        out_fh.close() <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-8" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-8"><img alt="8" src="assets/8.png"/></a>&#13;
&#13;
    print(f'Done, wrote {num_seqs} sequence{"" if num_seqs == 1 else "s"} '&#13;
          f'in {num_files} file{"" if num_files == 1 else "s"} '&#13;
          f'to directory "{args.out_dir}".') <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-9" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-9"><img alt="9" src="assets/9.png"/></a>&#13;
&#13;
&#13;
# --------------------------------------------------&#13;
if __name__ == '__main__':&#13;
    main()</pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Initialize the counters for files and sequences.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-2" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Iterate the filehandles.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-3" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Increment the counter for files.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-4" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Open the output file for this input file.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-5" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Iterate the sequences in the input file.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-6" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Increment the counter for sequences.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-7" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Write the transcribed sequence to the output file.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-8" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>Close the output filehandle.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-9" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO14-9"><img alt="9" src="assets/9.png"/></a></dt>&#13;
<dd><p>Print the status. Note that I’m relying on Python’s implicit concatenation of adjacent strings to create one output string.<a data-primary="strings (str)" data-secondary="concatenation implicit in Python" data-type="indexterm" id="idm45963631632408"/><a data-primary="Python" data-secondary="string concatenation" data-type="indexterm" id="idm45963631631448"/><a data-primary="concatenation implicit in Python" data-type="indexterm" id="idm45963631630504"/></p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution 2: Using re.sub()" data-type="sect2"><div class="sect2" id="idm45963631629336">&#13;
<h2>Solution 2: Using re.sub()</h2>&#13;
&#13;
<p>I suggested earlier that you might explore how to use regular expressions to solve this.<a data-primary="transcribing DNA into mRNA" data-secondary="solution 2 using re.sub" data-type="indexterm" id="idm45963631627944"/><a data-primary="regular expressions (regexes)" data-secondary="transcribing DNA into mRNA" data-type="indexterm" id="idm45963631626984"/><a data-primary="regular expressions (regexes)" data-secondary="about" data-type="indexterm" id="idm45963631626008"/>&#13;
Regexes are a language for describing patterns of text.&#13;
They have been around for decades, long before Python was even invented.&#13;
Though they may seem somewhat daunting at first, regexes are well worth the effort to<a data-primary="regular expressions (regexes)" data-secondary="Mastering Regular Expressions book" data-type="indexterm" id="idm45963631624696"/><a data-primary="Mastering Regular Expressions (Friedl)" data-type="indexterm" id="idm45963631623720"/><a data-primary="Friedl, Jeffrey" data-type="indexterm" id="idm45963631623032"/><a data-primary="resources" data-secondary="Mastering Regular Expressions (Friedl)" data-type="indexterm" id="idm45963631622360"/> learn.<sup><a data-type="noteref" href="ch02.html#idm45963631621240" id="idm45963631621240-marker">3</a></sup></p>&#13;
&#13;
<p>To use regular expressions in Python, I must import the <code>re</code> module:</p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; import re</pre>&#13;
&#13;
<p>Previously, I used the <code>re.search()</code> function to look for a pattern of text inside another string.&#13;
For this program, the pattern I am looking for is the letter <em>T</em>, which I can write as a literal string:</p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; re.search('T', 'ACGT') <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO15-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO15-1"><img alt="1" src="assets/1.png"/></a>&#13;
&lt;re.Match object; span=(3, 4), match='T'&gt; <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO15-2" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO15-2"><img alt="2" src="assets/2.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO15-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO15-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Search for the pattern <code>T</code> inside the string <code>ACGT</code>.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO15-2" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO15-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Because <code>T</code> was found, the return value is a <code>Re.Match</code> object showing the location of the found pattern. A failed search would return <code>None</code>.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The <code>span=(3, 4)</code> reports the start and stop indexes where the pattern <code>T</code> is found.&#13;
I can use these positions to extract the substring using a slice:</p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; 'ACGT'[3:4]&#13;
'T'</pre>&#13;
&#13;
<p>But instead of just finding the <em>T</em>, I want to replace the string <code>T</code> with <code>U</code>.&#13;
As shown in <a data-type="xref" href="#fig_2.3">Figure 2-3</a>, the <code>re.sub()</code> (for <em>substitute</em>) function will do this.</p>&#13;
&#13;
<figure><div class="figure" id="fig_2.3">&#13;
<img alt="mpfb 0203" src="assets/mpfb_0203.png" width="250"/>&#13;
<h6><span class="label">Figure 2-3. </span>The <code>re.sub()</code> function will return a new string where all instances of a pattern have been replaced with a new string</h6>&#13;
</div></figure>&#13;
&#13;
<p>The result is a new string where the <em>T</em>s have all been replaced with <em>U</em>s:</p>&#13;
&#13;
<pre data-type="programlisting">&gt;&gt;&gt; re.sub('T', 'U', 'ACGT') <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO16-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO16-1"><img alt="1" src="assets/1.png"/></a>&#13;
'ACGU' <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO16-2" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO16-2"><img alt="2" src="assets/2.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO16-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO16-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Replace every <code>T</code> with <code>U</code> in the string <code>ACGT</code>.</p></dd>&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO16-2" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO16-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The result is a new string with the substitutions.</p></dd>&#13;
</dl>&#13;
&#13;
<p>To use this version, I can modify the inner <code>for</code> loop, as shown.&#13;
Note that I have chosen to use the <code>str.strip()</code> method to remove the newline terminating the input DNA string because <code>print()</code> will add a newline:</p>&#13;
&#13;
<pre data-type="programlisting">for dna in fh:&#13;
    num_seqs += 1&#13;
    print(re.sub('T', 'U', dna.rstrip()), file=out_fh) <a class="co" href="#callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO17-1" id="co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO17-1"><img alt="1" src="assets/1.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO17-1" id="callout_transcribing_dna_into_mrna__mutating_strings__reading_and_writing_files_CO17-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Remove the newline from <code>dna</code>, substitute all the <code>T</code>s with <code>U</code>s, and print the resulting string to the output filehandle.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Benchmarking" data-type="sect1"><div class="sect1" id="idm45963631572008">&#13;
<h1>Benchmarking</h1>&#13;
&#13;
<p>You might be curious to know which solution is faster.<a data-primary="transcribing DNA into mRNA" data-secondary="solutions benchmarked" data-type="indexterm" id="idm45963631570680"/><a data-primary="benchmarking the solutions" data-secondary="transcribing DNA into mRNA" data-type="indexterm" id="idm45963631569720"/><a data-primary="bash shell" data-secondary="benchmarking the solutions" data-type="indexterm" id="idm45963631568744"/><a data-primary="Unix command line" data-secondary="bash shell" data-see="bash shell" data-type="indexterm" id="idm45963631567784"/><a data-primary="command line (Unix)" data-secondary="bash shell" data-see="bash shell" data-type="indexterm" id="idm45963631566568"/>&#13;
Comparing the relative runtimes of programs is called <em>benchmarking</em>, and I’ll show you a simple way to compare these two solutions using some basic <code>bash</code> commands.&#13;
I’ll use the <em>./tests/inputs/input3.txt</em> file, as it is the largest test file.&#13;
I can write a <code>for</code> loop in <code>bash</code> with almost the same syntax as Python.&#13;
Note that I am using newlines in this command to make it more readable, and <code>bash</code> notes the line continuation with <code>&gt;</code>.&#13;
You can substitute semicolons (<code>;</code>) to write this on one line:</p>&#13;
&#13;
<pre data-type="programlisting">$ for py in ./solution*&#13;
&gt; do echo $py &amp;&amp; time $py ./tests/inputs/input3.txt&#13;
&gt; done&#13;
./solution1_str_replace.py&#13;
Done, wrote 2 sequences in 1 file to directory "out".&#13;
&#13;
real	0m1.539s&#13;
user	0m0.046s&#13;
sys	    0m0.036s&#13;
./solution2_re_sub.py&#13;
Done, wrote 2 sequences in 1 file to directory "out".&#13;
&#13;
real	0m0.179s&#13;
user	0m0.035s&#13;
sys	    0m0.013s</pre>&#13;
&#13;
<p>It would appear the second solution using regular expressions is faster, but I don’t have enough data to be sure.&#13;
I need a more substantial input file.&#13;
In the <em>02_rna</em> directory, you’ll find a program called <code>genseq.py</code> I wrote that will generate 1,000 sequences of 1,000,000 bases in a file called <em>seq.txt</em>.&#13;
You can, of course, modify the parameters:</p>&#13;
&#13;
<pre data-type="programlisting">$ ./genseq.py --help&#13;
usage: genseq.py [-h] [-l int] [-n int] [-o FILE]&#13;
&#13;
Generate long sequence&#13;
&#13;
optional arguments:&#13;
  -h, --help            show this help message and exit&#13;
  -l int, --len int     Sequence length (default: 1000000)&#13;
  -n int, --num int     Number of sequences (default: 100)&#13;
  -o FILE, --outfile FILE&#13;
                        Output file (default: seq.txt)</pre>&#13;
&#13;
<p>The file <em>seq.txt</em> that is generated using the defaults is about 95 MB.&#13;
Here’s how the programs do with a more realistic input file:</p>&#13;
&#13;
<pre data-type="programlisting">$ for py in ./solution*; do echo $py &amp;&amp; time $py seq.txt; done&#13;
./solution1_str_replace.py&#13;
Done, wrote 100 sequences in 1 file to directory "out".&#13;
&#13;
real	0m0.456s&#13;
user	0m0.372s&#13;
sys	0m0.064s&#13;
./solution2_re_sub.py&#13;
Done, wrote 100 sequences in 1 file to directory "out".&#13;
&#13;
real	0m3.100s&#13;
user	0m2.700s&#13;
sys	0m0.385s</pre>&#13;
&#13;
<p>It now appears that the first solution is faster.&#13;
For what it’s worth, I came up with several other solutions, all of which fared much worse than these two.&#13;
I thought I was creating more and more clever solutions that would ultimately lead to the best performance.&#13;
My pride was sorely wounded when what I thought was my best program turned out to be orders of magnitude slower than these two.&#13;
When you have assumptions, you should, as the saying goes, “Trust, but verify.”</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Going Further" data-type="sect1"><div class="sect1" id="idm45963631553896">&#13;
<h1>Going Further</h1>&#13;
&#13;
<p>Modify your program to print the lengths of the sequences to the output file rather than the transcribed RNA.&#13;
Have the final status report the maximum, minimum, and average sequence lengths.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Review" data-type="sect1"><div class="sect1" id="idm45963631552104">&#13;
<h1>Review</h1>&#13;
&#13;
<p>Key points from this chapter:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The <code>argparse.FileType</code> option will validate file arguments.</p>&#13;
</li>&#13;
<li>&#13;
<p>The <code>nargs</code> option to <code>argparse</code> allows you to define the number of valid arguments for a parameter.</p>&#13;
</li>&#13;
<li>&#13;
<p>The <code>os.path.isdir()</code> function can detect if a directory exists.</p>&#13;
</li>&#13;
<li>&#13;
<p>The <code>os.makedirs()</code> function will create a directory structure.</p>&#13;
</li>&#13;
<li>&#13;
<p>The <code>open()</code> function by default allows only reading files. The <code>w</code> option must be used to write to the filehandle, and the <code>a</code> option is for appending values to an existing file.</p>&#13;
</li>&#13;
<li>&#13;
<p>File handles can be opened with the <code>t</code> option for <em>text</em> (the default) or <code>b</code> for <em>bytes</em>, such as when reading image files.</p>&#13;
</li>&#13;
<li>&#13;
<p>Strings are immutable, and there are many methods to alter strings into new strings, including <code>str.replace()</code> and <code>re.sub()</code>.</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45963631969784"><sup><a href="ch02.html#idm45963631969784-marker">1</a></sup> As Phil Karlton says, “There are only two hard things in Computer Science: cache invalidation and naming things.”</p><p data-type="footnote" id="idm45963631818520"><sup><a href="ch02.html#idm45963631818520-marker">2</a></sup> Sorry, but I can’t stop being an English major.</p><p data-type="footnote" id="idm45963631621240"><sup><a href="ch02.html#idm45963631621240-marker">3</a></sup> <a class="orm:hideurl" href="https://oreil.ly/R7O1r"><em>Mastering Regular Expressions</em></a> by Jeffrey Friedl (O’Reilly, 2006) is one of the best books I’ve found.</p></div></div></section></body></html>