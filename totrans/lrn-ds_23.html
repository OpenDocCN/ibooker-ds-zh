<html><head></head><body><section data-pdf-bookmark="Chapter 18. Case Study: How to Weigh a Donkey" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch-donkey">&#13;
<h1><span class="label">Chapter 18. </span>Case Study: How to Weigh a Donkey</h1>&#13;
&#13;
<p>Donkeys play important<a contenteditable="false" data-primary="weighing a donkey case study" data-type="indexterm" id="ix_weigh_donk_stud"/><a contenteditable="false" data-primary="linear modeling" data-secondary="weighing a donkey case study" data-type="indexterm" id="ix_lin_mod_weigh"/> roles in rural Kenya. People need them to transport crops, water, and people and to plow fields. When a donkey gets sick, the veterinarian needs to figure out how much the donkey weighs in order to prescribe the right amount of medicine. But many vets in rural Kenya don’t have access to a scale, so they need to guess the donkey’s weight. Too little medicine can allow an infection to reemerge; too much medicine can cause a harmful overdose. There are over 1.8 million donkeys in Kenya, so it’s important to have a simple, accurate way to estimate the weight of a donkey.</p>&#13;
&#13;
<p>In this case<a contenteditable="false" data-primary="Milner, Kate" data-type="indexterm" id="id1775"/><a contenteditable="false" data-primary="Rougier, Jonathan" data-type="indexterm" id="id1776"/> study, we follow the work of <a class="reference external" href="https://doi.org/10.1111/j.1740-9713.2014.00768.x">Kate Milner and Jonathan Rougier</a> to create a model that veterinarians in the Kenyan countryside can use to make accurate estimates of a donkey’s weight. As usual, we walk through the steps of the data science lifecycle, but this time our work departs from the basics covered so far in this book. You can think of this case study as an opportunity to reflect on many of the core principles of working with data and to understand how they can be extended to address the context of the situation. We directly evaluate sources of measurement error, design a special loss function that reflects the concern about an overdose, build a model while keeping applicability top of mind, and evaluate model predictions using special criteria that are relative to the donkey’s size.</p>&#13;
&#13;
<p>We begin with the scope of the data.</p>&#13;
&#13;
&#13;
<section data-pdf-bookmark="Donkey Study Question and Scope" data-type="sect1"><div class="sect1" id="donkey-study-question-and-scope">&#13;
<h1>Donkey Study Question and Scope</h1>&#13;
&#13;
<p>Our motivating question<a contenteditable="false" data-primary="data scope" data-secondary="weighing the donkey example" data-type="indexterm" id="id1777"/><a contenteditable="false" data-primary="weighing a donkey case study" data-secondary="question and scope" data-type="indexterm" id="id1778"/> is: how can a vet accurately estimate the weight of a donkey when they’re out in the countryside without a scale? Let’s think about the information that is more readily available to them. They can carry a tape measure and find the size of the donkey in other dimensions, like its height. They can observe the animal’s sex, assess its general condition, and inquire about the donkey’s age. So we can refine our question to: how can a vet accurately predict the weight of a donkey from easy-to-get measurements?</p>&#13;
&#13;
<p>To address this more precise question, <a class="reference external" href="https://oreil.ly/uUyZj">The Donkey Sanctuary</a> carried out a study at 17 mobile deworming sites in rural Kenya.</p>&#13;
&#13;
<p>In terms of scope (<a class="reference internal" data-type="xref" href="ch02.html#ch-data-scope">Chapter 2</a>), the target population is the donkey population in rural Kenya. The access frame is the set of all donkeys that were brought into the de-worming sites. The sample consists of all donkeys brought to these sites between July 23 and August 11, 2010, with a few caveats: if there were too many donkeys to measure at a site, the scientists selected a subset of donkeys to measure, and any pregnant or visibly diseased donkeys were excluded from the study.</p>&#13;
&#13;
<p>To avoid accidentally weighing a donkey twice, each donkey was marked after weighing. To quantify the measurement error and assess repeatability of the weighing process, 31 donkeys were measured twice, without the staff knowing that a donkey was being reweighed.</p>&#13;
&#13;
<p>With this sampling process in mind, potential sources of bias<a contenteditable="false" data-primary="bias" data-secondary="donkey weight study sources" data-type="indexterm" id="id1779"/> for this data include:</p>&#13;
&#13;
<dl class="simple myst">&#13;
	<dt>Coverage bias</dt>&#13;
	<dd>&#13;
	<p>The 17 sites were located<a contenteditable="false" data-primary="coverage bias" data-type="indexterm" id="id1780"/> in the regions surrounding the Yatta district in eastern Kenya and the Naivasha district in the Rift Valley.</p>&#13;
	</dd>&#13;
	<dt>Selection bias</dt>&#13;
	<dd>&#13;
	<p>Only donkeys<a contenteditable="false" data-primary="selection bias" data-type="indexterm" id="id1781"/> brought to the sanctuary were enrolled in the study, and when there were too many donkeys at a site, a nonrandom sample was selected.</p>&#13;
	</dd>&#13;
	<dt>Measurement bias</dt>&#13;
	<dd>&#13;
	<p>In <a contenteditable="false" data-primary="measurement bias" data-type="indexterm" id="id1782"/>addition to measurement error, the scale might have a bias. Ideally, the scale(s) would be calibrated before and after use at a site (<a class="reference internal" data-type="xref" href="ch12.html#ch-pa">Chapter 12</a>).</p>&#13;
	</dd>&#13;
</dl>&#13;
&#13;
<p>Despite these potential sources of bias, the access frame seems reasonable for accessing donkeys from rural areas in Kenya that have owners looking after the health of their animals.</p>&#13;
&#13;
<p>Our next step is to clean the data.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Wrangling and Transforming" data-type="sect1"><div class="sect1" id="wrangling-and-transforming">&#13;
<h1>Wrangling and Transforming</h1>&#13;
&#13;
<p>We begin by taking a peek<a contenteditable="false" data-primary="weighing a donkey case study" data-secondary="wrangling and transforming" data-type="indexterm" id="ix_weigh_donk_wr"/> at the contents of our datafile. To do this, we open the file and examine the first few rows (<a class="reference internal" data-type="xref" href="ch08.html#ch-files">Chapter 8</a>):</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="kn">from</code></span><code> </code><span><code class="nn">pathlib</code></span><code> </code><span><code class="kn">import</code></span><code> </code><span><code class="n">Path</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="c1"># Create a Path pointing to our datafile</code></span><code>&#13;
</code><span><code class="n">insp_path</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">Path</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">data/donkeys.csv</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="k">with</code></span><code> </code><span><code class="n">insp_path</code></span><span><code class="o">.</code></span><span><code class="n">open</code></span><span><code class="p">(</code><code class="p">)</code></span><code> </code><span><code class="k">as</code></span><code> </code><span><code class="n">f</code></span><span><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="c1"># Display first five lines of file</code></span><code>&#13;
</code><code>    </code><span><code class="k">for</code></span><code> </code><span><code class="n">_</code></span><code> </code><span><code class="ow">in</code></span><code> </code><span><code class="nb">range</code></span><span><code class="p">(</code></span><span><code class="mi">5</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>        </code><span><code class="nb">print</code></span><span><code class="p">(</code></span><span><code class="n">f</code></span><span><code class="o">.</code></span><span><code class="n">readline</code></span><span><code class="p">(</code><code class="p">)</code><code class="p">,</code></span><code> </code><span><code class="n">end</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output stream highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
BCS,Age,Sex,Length,Girth,Height,Weight,WeightAlt&#13;
3,&lt;2,stallion,78,90,90,77,NA&#13;
2.5,&lt;2,stallion,91,97,94,100,NA&#13;
1.5,&lt;2,stallion,74,93,95,74,NA&#13;
3,&lt;2,female,87,109,96,116,NA&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Since the file is CSV-formatted, we can easily read it into a dataframe:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">donkeys</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">read_csv</code></span><span><code class="p">(</code></span><span><code class="s2">"</code><code class="s2">data/donkeys.csv</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">donkeys</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>BCS</th>&#13;
			<th>Age</th>&#13;
			<th>Sex</th>&#13;
			<th>Length</th>&#13;
			<th>Girth</th>&#13;
			<th>Height</th>&#13;
			<th>Weight</th>&#13;
			<th>WeightAlt</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>3.0</td>&#13;
			<td class="right">&lt;2</td>&#13;
			<td>stallion</td>&#13;
			<td class="right">78</td>&#13;
			<td class="right">90</td>&#13;
			<td class="right">90</td>&#13;
			<td class="right">77</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>2.5</td>&#13;
			<td class="right">&lt;2</td>&#13;
			<td>stallion</td>&#13;
			<td class="right">91</td>&#13;
			<td class="right">97</td>&#13;
			<td class="right">94</td>&#13;
			<td class="right">100</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>1.5</td>&#13;
			<td class="right">&lt;2</td>&#13;
			<td>stallion</td>&#13;
			<td class="right">74</td>&#13;
			<td class="right">93</td>&#13;
			<td class="right">95</td>&#13;
			<td class="right">74</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>541</strong></td>&#13;
			<td>2.5</td>&#13;
			<td class="right">10-15</td>&#13;
			<td>stallion</td>&#13;
			<td class="right">103</td>&#13;
			<td class="right">118</td>&#13;
			<td class="right">103</td>&#13;
			<td class="right">174</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>542</strong></td>&#13;
			<td>3.0</td>&#13;
			<td class="right">2-5</td>&#13;
			<td>stallion</td>&#13;
			<td class="right">91</td>&#13;
			<td class="right">112</td>&#13;
			<td class="right">100</td>&#13;
			<td class="right">139</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>543</strong></td>&#13;
			<td>3.0</td>&#13;
			<td class="right">5-10</td>&#13;
			<td>stallion</td>&#13;
			<td class="right">104</td>&#13;
			<td class="right">124</td>&#13;
			<td class="right">110</td>&#13;
			<td class="right">189</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>544 rows × 8 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Over five hundred donkeys participated in the survey, and eight measurements were made on each donkey. According to the documentation, the granularity is a single donkey (<a class="reference internal" data-type="xref" href="ch09.html#ch-wrangling">Chapter 9</a>). <a class="reference internal" data-type="xref" href="#tbl-donkey-codebook">Table 18-1</a> provides descriptions of the eight features.</p>&#13;
&#13;
<table id="tbl-donkey-codebook">&#13;
	<caption><span class="label">Table 18-1. </span><span>Donkey study codebook</span></caption>&#13;
	<thead>&#13;
		<tr>&#13;
			<th class="head">Feature</th>&#13;
			<th class="head">Data type</th>&#13;
			<th class="head">Feature type</th>&#13;
			<th class="head">Description</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td>BCS</td>&#13;
			<td>&#13;
			<p>float64</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Ordinal</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Body condition score: from 1 (emaciated) to 3 (healthy) to 5 (obese) in increments of 0.5.</p>&#13;
			</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td>Age</td>&#13;
			<td>&#13;
			<p>string</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Ordinal</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Age in years, under 2, 2–5, 5–10, 10–15, 15–20, and over 20 years</p>&#13;
			</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td>Sex</td>&#13;
			<td>&#13;
			<p>string</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Nominal</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Sex categories: stallion, gelding, female</p>&#13;
			</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td>Length</td>&#13;
			<td>&#13;
			<p>int64</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Numeric</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Body length (cm) from front leg elbow to back of pelvis</p>&#13;
			</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td>Girth</td>&#13;
			<td>&#13;
			<p>int64</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Numeric</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Body circumference (cm), measured just behind front legs</p>&#13;
			</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td>Height</td>&#13;
			<td>&#13;
			<p>int64</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Numeric</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Body height (cm) up to point where neck connects to back</p>&#13;
			</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td>Weight</td>&#13;
			<td>&#13;
			<p>int64</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Numeric</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Weight (kilogram)</p>&#13;
			</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td>WeightAlt</td>&#13;
			<td>&#13;
			<p>float64</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Numeric</p>&#13;
			</td>&#13;
			<td>&#13;
			<p>Second weight measurement taken on a subset of donkeys</p>&#13;
			</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<p><a class="reference internal" data-type="xref" href="#fig-donkeydiagram">Figure 18-1</a> is a stylized representation of a donkey as a cylinder with neck and legs appended. Height is measured from the ground to the base of the neck above the shoulders; girth is around the body, just behind the legs; and length is from the front elbow to the back of the pelvis.</p>&#13;
&#13;
<figure><div class="figure" id="fig-donkeydiagram"><img src="assets/leds_1801.png"/>&#13;
<h6><span class="label">Figure 18-1. </span>Diagram of a donkey’s girth, length, and height, characterized as measurements on a cylinder</h6>&#13;
</div></figure>&#13;
&#13;
<p>Our next step is to perform some quality checks on the data. In the previous section, we listed a few potential quality concerns based on scope. Next, we check the quality of the measurements and their distributions.</p>&#13;
&#13;
<p>Let’s start by comparing the two weight measurements made on the subset of donkeys to check on the consistency of the scale. We make a histogram of the difference between these two measurements for the 31 donkeys that were weighed twice:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">donkeys</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">donkeys</code></span><span><code class="o">.</code></span><span><code class="n">assign</code></span><span><code class="p">(</code></span><span><code class="n">difference</code></span><span><code class="o">=</code></span><span><code class="n">donkeys</code></span><span><code class="p">[</code></span><span><code class="s2">"</code><code class="s2">WeightAlt</code><code class="s2">"</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">-</code></span><code> </code><span><code class="n">donkeys</code></span><span><code class="p">[</code></span><span><code class="s2">"</code><code class="s2">Weight</code><code class="s2">"</code></span><span><code class="p">]</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">histogram</code></span><span><code class="p">(</code></span><span><code class="n">donkeys</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">difference</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">nbins</code></span><span><code class="o">=</code></span><span><code class="mi">15</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>    </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><code>&#13;
</code><code>        </code><span><code class="n">difference</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Differences of two weighings (kg)&lt;br&gt;on the same donkey</code><code class="s2">"</code></span><code>&#13;
</code><code>    </code><span><code class="p">)</code><code class="p">,</code></span><code>&#13;
</code><code>    </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">,</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-55"><div class="figure"><img src="assets/leds_18in01.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The measurements are all within 1 kg of each other, and the majority are exactly the same (to the nearest kilogram). This gives us confidence in the accuracy of the <span class="keep-together">measurements</span>.</p>&#13;
&#13;
<p>Next, we look for unusual values in the body condition score:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">donkeys</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS</code><code class="s1">'</code></span><span><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">value_counts</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
BCS&#13;
3.0    307&#13;
2.5    135&#13;
3.5     55&#13;
      ... &#13;
1.5      5&#13;
4.5      1&#13;
1.0      1&#13;
Name: count, Length: 8, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>From this output, we see that there’s only one emaciated (BCS = 1) and one obese (BCS = 4.5) donkey. Let’s look at the complete records for these two donkeys:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">donkeys</code></span><span><code class="p">[</code><code class="p">(</code></span><span><code class="n">donkeys</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="mf">1.0</code></span><span><code class="p">)</code></span><code> </code><span><code class="o">|</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">donkeys</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="mf">4.5</code></span><span><code class="p">)</code><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>BCS</th>&#13;
			<th>Age</th>&#13;
			<th>Sex</th>&#13;
			<th>Length</th>&#13;
			<th>Girth</th>&#13;
			<th>Height</th>&#13;
			<th>Weight</th>&#13;
			<th>WeightAlt</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>291</strong></td>&#13;
			<td>4.5</td>&#13;
			<td class="right">10-15</td>&#13;
			<td>female</td>&#13;
			<td class="right">107</td>&#13;
			<td>130</td>&#13;
			<td>106</td>&#13;
			<td>227</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>445</strong></td>&#13;
			<td>1.0</td>&#13;
			<td class="right">&gt;20</td>&#13;
			<td>female</td>&#13;
			<td class="right">97</td>&#13;
			<td>109</td>&#13;
			<td>102</td>&#13;
			<td>115</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Since these BCS values are extreme, we want to be cautious about including these two donkeys in our analysis<a contenteditable="false" data-primary="overfitting" data-type="indexterm" id="id1783"/><a contenteditable="false" data-primary="fitting the model" data-secondary="overfitting" data-type="indexterm" id="id1784"/>. We have only one donkey in each of these extreme categories, so our model might well not extend to donkeys with a BCS of 1 or 4.5. We remove these two records from the dataframe and note that our analysis may not extend to emaciated or obese donkeys. In general, we exercise caution in dropping records from a dataframe. Later, we may also decide to remove the five donkeys with a score of 1.5 if they appear anomalous in our analysis, but for now, we keep them in our dataframe. In general, we need a good reason to exclude data, and we should document these actions since they can impact our findings. Removing data can lead to over fitting, if we drop any record that disagrees with the model.</p>&#13;
&#13;
<p>We remove these two outliers<a contenteditable="false" data-primary="outliers" data-secondary="wrangling donkey weight study data" data-type="indexterm" id="id1785"/> next:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="k">def</code></span><code> </code><span><code class="nf">remove_bcs_outliers</code></span><span><code class="p">(</code></span><span><code class="n">donkeys</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="n">donkeys</code></span><span><code class="p">[</code><code class="p">(</code></span><span><code class="n">donkeys</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">&gt;</code><code class="o">=</code></span><code> </code><span><code class="mf">1.5</code></span><span><code class="p">)</code></span><code> </code><span><code class="o">&amp;</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">donkeys</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">&lt;</code><code class="o">=</code></span><code> </code><span><code class="mi">4</code></span><span><code class="p">)</code><code class="p">]</code></span><code> </code><code>&#13;
</code><code>&#13;
</code><span><code class="n">donkeys</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">read_csv</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">data/donkeys.csv</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>           </code><span><code class="o">.</code></span><span><code class="n">pipe</code></span><span><code class="p">(</code></span><span><code class="n">remove_bcs_outliers</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Now, we examine the distribution of values for weight to see if there are any issues with quality:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">histogram</code></span><span><code class="p">(</code></span><span><code class="n">donkeys</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Weight</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">nbins</code></span><span><code class="o">=</code></span><span><code class="mi">40</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>            </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">Weight</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s1">'</code><code class="s1">Weight (kg)</code><code class="s1">'</code></span><span><code class="p">}</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_18in02.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>It appears there is one very light donkey weighing less than 30 kg. Next, we check the relationship between weight and height to assess the quality of the data for analysis:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">scatter</code></span><span><code class="p">(</code></span><span><code class="n">donkeys</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Height</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Weight</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>          </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">Weight</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s1">'</code><code class="s1">Weight (kg)</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Height</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s1">'</code><code class="s1">Height (cm)</code><code class="s1">'</code></span><span><code class="p">}</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_18in03.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The small donkey is far from the main concentration of donkeys and would overly influence our models. For this reason, we exclude it. Again, we keep in mind that we may also want to exclude the one or two heavy donkeys if they appear to overly influence our future model fitting:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="k">def</code></span><code> </code><span><code class="nf">remove_weight_outliers</code></span><span><code class="p">(</code></span><span><code class="n">donkeys</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="n">donkeys</code></span><span><code class="p">[</code><code class="p">(</code></span><span><code class="n">donkeys</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Weight</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">&gt;</code><code class="o">=</code></span><code> </code><span><code class="mi">40</code></span><span><code class="p">)</code><code class="p">]</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">donkeys</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">read_csv</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">data/donkeys.csv</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>           </code><span><code class="o">.</code></span><span><code class="n">pipe</code></span><span><code class="p">(</code></span><span><code class="n">remove_bcs_outliers</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>           </code><span><code class="o">.</code></span><span><code class="n">pipe</code></span><span><code class="p">(</code></span><span><code class="n">remove_weight_outliers</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">donkeys</code></span><span><code class="o">.</code></span><span><code class="n">shape</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
(541, 8)&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>In summary, based on our cleaning and quality checks, we removed three anomalous observations from the dataframe. Now we’re nearly ready to begin our exploratory analysis. Before we proceed, we set aside some of our data as a test set.</p>&#13;
&#13;
<p>We talked about why it’s important to separate out a test set from the train set in <a class="reference internal" data-type="xref" href="ch16.html#ch-risk">Chapter 16</a>. A best practice is to separate out a test set early in the analysis, before we explore the data in detail, because in EDA, we begin to make decisions about what kinds of models to fit and what variables to use in the model. It’s important that our test set isn’t involved in these decisions so that it imitates how our model would perform with entirely new data.</p>&#13;
&#13;
<p>We divide our data into an 80/20 split, where we use 80% of the data to explore and build a model. Then we evaluate the model with the 20% that has been set aside. We use a simple random sample to split the dataframe into the test and train sets. To begin, we randomly shuffle the indices of the dataframe:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">random</code></span><span><code class="o">.</code></span><span><code class="n">seed</code></span><span><code class="p">(</code></span><span><code class="mi">42</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">n</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="nb">len</code></span><span><code class="p">(</code></span><span><code class="n">donkeys</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">indices</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">arange</code></span><span><code class="p">(</code></span><span><code class="n">n</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">random</code></span><span><code class="o">.</code></span><span><code class="n">shuffle</code></span><span><code class="p">(</code></span><span><code class="n">indices</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">n_train</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="nb">int</code></span><span><code class="p">(</code></span><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">round</code></span><span><code class="p">(</code><code class="p">(</code></span><span><code class="mf">0.8</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="n">n</code></span><span><code class="p">)</code><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Next, we assign the first 80% of the dataframe to the train set and the remaining 20% to the test set:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">train_set</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">donkeys</code></span><span><code class="o">.</code></span><span><code class="n">iloc</code></span><span><code class="p">[</code></span><span><code class="n">indices</code></span><span><code class="p">[</code><code class="p">:</code></span><span><code class="n">n_train</code></span><span><code class="p">]</code><code class="p">]</code></span><code>&#13;
</code><span><code class="n">test_set</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">donkeys</code></span><span><code class="o">.</code></span><span><code class="n">iloc</code></span><span><code class="p">[</code></span><span><code class="n">indices</code></span><span><code class="p">[</code></span><span><code class="n">n_train</code></span><span><code class="p">:</code><code class="p">]</code><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Now we’re ready to explore the training data and look for useful relationships and distributions that inform our modeling<a contenteditable="false" data-primary="" data-startref="ix_weigh_donk_wr" data-type="indexterm" id="id1786"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Exploring" data-type="sect1"><div class="sect1" id="exploring">&#13;
<h1>Exploring</h1>&#13;
&#13;
<p>Let’s look at the features<a contenteditable="false" data-primary="exploratory data analysis (EDA)" data-secondary="weighing a donkey case study" data-type="indexterm" id="ix_expl_weigh_donk"/><a contenteditable="false" data-primary="weighing a donkey case study" data-secondary="exploring" data-type="indexterm" id="ix_weigh_donk_stud_expl"/> in our dataframe for shapes and relationships that will help us make transformations and models (<a class="reference internal" data-type="xref" href="ch10.html#ch-eda">Chapter 10</a>). We start by looking at how the categorical features of age, sex, and body condition relate to weight:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">f1</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">box</code></span><span><code class="p">(</code></span><span><code class="n">train_set</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Age</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Weight</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>            </code><span><code class="n">category_orders</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">{</code></span><span><code class="s2">"</code><code class="s2">Age</code><code class="s2">"</code></span><span><code class="p">:</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">&lt;2</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">2-5</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">5-10</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>                                      </code><span><code class="s1">'</code><code class="s1">10-15</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">15-20</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">&gt;20</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">}</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">f2</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">box</code></span><span><code class="p">(</code></span><span><code class="n">train_set</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Sex</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Weight</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="c1"># We wrote the left_right function as a shorthand for plotly's make_subplots</code></span><code>&#13;
</code><span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">left_right</code></span><span><code class="p">(</code></span><span><code class="n">f1</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">f2</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">column_widths</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="mf">0.7</code></span><span><code class="p">,</code></span><code> </code><span><code class="mf">0.3</code></span><span><code class="p">]</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_xaxes</code></span><span><code class="p">(</code></span><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Age (yr)</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">row</code></span><span><code class="o">=</code></span><span><code class="mi">1</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">col</code></span><span><code class="o">=</code></span><span><code class="mi">1</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_xaxes</code></span><span><code class="p">(</code></span><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Sex</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">row</code></span><span><code class="o">=</code></span><span><code class="mi">1</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">col</code></span><span><code class="o">=</code></span><span><code class="mi">2</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_yaxes</code></span><span><code class="p">(</code></span><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Weight (kg)</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">row</code></span><span><code class="o">=</code></span><span><code class="mi">1</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">col</code></span><span><code class="o">=</code></span><span><code class="mi">1</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-75"><div class="figure"><img src="assets/leds_18in04.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">box</code></span><span><code class="p">(</code></span><span><code class="n">train_set</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">BCS</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Weight</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">points</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">all</code><code class="s2">"</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>             </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">Weight</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s1">'</code><code class="s1">Weight (kg)</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">BCS</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s1">'</code><code class="s1">Body condition score</code><code class="s1">'</code></span><span><code class="p">}</code><code class="p">,</code></span><code>&#13;
</code><code>             </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">550</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-75"><div class="figure"><img src="assets/leds_18in05.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Notice that we plotted the points as well as the boxes for the body condition score because we saw earlier that there are only a handful of observations with a score of 1.5, so we don’t want to read too much into a box plot with only a few data points (<a class="reference internal" data-type="xref" href="ch11.html#ch-viz">Chapter 11</a>). It appears that the median weight increases with the body condition score, but not in a simple linear fashion. On the other hand, weight distributions for the three sex categories appear roughly the same. As for age, once a donkey reaches five years, the distribution of weight doesn’t seem to change much. But donkeys under age 2 and donkeys from 2 to 5 years of age have lower weights in general.</p>&#13;
&#13;
<p>Next, let’s examine the quantitative variables. We plot all pairs of quantitative variables in the scatterplot matrix:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_18in06.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The height, length, and girth of donkeys all appear linearly associated with weight and with each other. This is not too surprising; given one of the donkey’s dimensions, we should have a good guess about the other dimensions. Girth appears most highly correlated with weight, and this is confirmed by the correlation coefficient matrix:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">train_numeric</code></span><span><code class="o">.</code></span><span><code class="n">corr</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Weight</th>&#13;
			<th>Length</th>&#13;
			<th>Girth</th>&#13;
			<th>Height</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>Weight</strong></td>&#13;
			<td>1.00</td>&#13;
			<td>0.78</td>&#13;
			<td>0.90</td>&#13;
			<td>0.71</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Length</strong></td>&#13;
			<td>0.78</td>&#13;
			<td>1.00</td>&#13;
			<td>0.66</td>&#13;
			<td>0.58</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Girth</strong></td>&#13;
			<td>0.90</td>&#13;
			<td>0.66</td>&#13;
			<td>1.00</td>&#13;
			<td>0.70</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Height</strong></td>&#13;
			<td>0.71</td>&#13;
			<td>0.58</td>&#13;
			<td>0.70</td>&#13;
			<td>1.00</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Our explorations uncovered several aspects of the data that may be relevant for modeling. We found that the donkey’s girth, length, and height all have linear associations with weight and with each other, and girth has the strongest linear relationship with weight. We also observed that the body condition score has a positive association with weight; the sex of the donkey does not appear related to weight; and neither does age for those donkeys over 5 years. In the next section, we use these findings to build our model<a contenteditable="false" data-primary="" data-startref="ix_expl_weigh_donk" data-type="indexterm" id="id1787"/><a contenteditable="false" data-primary="" data-startref="ix_weigh_donk_stud_expl" data-type="indexterm" id="id1788"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Modeling a Donkey’s Weight" data-type="sect1"><div class="sect1" id="modeling-a-donkeys-weight">&#13;
<h1>Modeling a Donkey’s Weight</h1>&#13;
&#13;
<p>We want to build a simple model<a contenteditable="false" data-primary="weighing a donkey case study" data-secondary="modeling" data-type="indexterm" id="ix_weigh_donk_stud_mod"/> for predicting the weight of a donkey. The model should be easy for a vet to implement in the field with only a hand calculator. The model should also be easy to interpret.</p>&#13;
&#13;
<p>We also want the model to depend on the vet’s situation—for example, whether they’re prescribing an antibiotic or an anesthetic. For brevity, we only consider the case of prescribing an anesthetic. Our first step is to choose a loss function that reflects this situation.</p>&#13;
&#13;
<section data-pdf-bookmark="A Loss Function for Prescribing Anesthetics" data-type="sect2"><div class="sect2" id="a-loss-function-for-prescribing-anesthetics">&#13;
<h2>A Loss Function for Prescribing Anesthetics</h2>&#13;
&#13;
<p>An overdose<a contenteditable="false" data-primary="loss functions" data-secondary="for prescribing anesthetics" data-secondary-sortas=" prescribing anesthetics" data-type="indexterm" id="id1789"/> of an anesthetic can be much worse than an underdose. It’s not hard for a vet to see when a donkey has too little anesthetic (it’ll complain), and the vet can give the donkey a bit more. On the other hand, too much anesthetic can have serious consequences and can even be fatal. Because of this, we want an asymmetric loss function: it should have a bigger loss for an overestimate of weight compared to an underestimate. This is in contrast to the other loss functions that we have used so far in this book, which have all been symmetric.</p>&#13;
&#13;
<p>We’ve created a loss function <code>anes_loss(x)</code> with this in mind:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="k">def</code></span><code> </code><span><code class="nf">anes_loss</code></span><span><code class="p">(</code></span><span><code class="n">x</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="n">w</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">x</code></span><code> </code><span><code class="o">&gt;</code><code class="o">=</code></span><code> </code><span><code class="mi">0</code></span><span><code class="p">)</code></span><code> </code><span><code class="o">+</code></span><code> </code><span><code class="mi">3</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">x</code></span><code> </code><span><code class="o">&lt;</code></span><code> </code><span><code class="mi">0</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">square</code></span><span><code class="p">(</code></span><span><code class="n">x</code></span><span><code class="p">)</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="n">w</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>The relative error is <span class="math notranslate nohighlight"><math> <mn>100</mn> <mo stretchy="false">(</mo> <mi>y</mi> <mo>−</mo> <mrow> <mover> <mi>y</mi> <mo stretchy="false">^</mo> </mover> </mrow> <mo stretchy="false">)</mo> <mrow> <mo>/</mo> </mrow> <mrow> <mover> <mi>y</mi> <mo stretchy="false">^</mo> </mover> </mrow> </math></span>, where <span class="math notranslate nohighlight"><math> <mi>y</mi> </math></span> is the true value and <span class="math notranslate nohighlight"><math> <mrow> <mover> <mi>y</mi> <mo stretchy="false">^</mo> </mover> </mrow> </math></span> is the prediction. We can demonstrate the asymmetry of the loss function with a plot:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_18in07.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Note that a value of –10 on the x-axis reflects an overestimate of 10%.</p>&#13;
&#13;
<p>Next, let’s fit a simple linear model using this loss function.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Fitting a Simple Linear Model" data-type="sect2"><div class="sect2" id="fitting-a-simple-linear-model">&#13;
<h2>Fitting a Simple Linear Model</h2>&#13;
&#13;
<p>We saw that girth<a contenteditable="false" data-primary="simple linear model" data-type="indexterm" id="ix_simp_lin_mod"/><a contenteditable="false" data-primary="fitting the model" data-secondary="simple linear model" data-type="indexterm" id="id1790"/> has the highest correlation with weight among the donkeys in our train set. So we fit a model of the form:</p>&#13;
&#13;
<div data-type="equation">&#13;
<div class="math notranslate nohighlight"><math display="block"> <msub> <mi>θ</mi> <mn>0</mn> </msub> <mo>+</mo> <msub> <mi>θ</mi> <mn>1</mn> </msub> <mtext>Girth</mtext> </math></div>&#13;
</div>&#13;
&#13;
<p>To find the best fit <span class="math notranslate nohighlight"><math> <msub> <mi>θ</mi> <mn>0</mn> </msub> </math></span> and <span class="math notranslate nohighlight"><math> <msub> <mi>θ</mi> <mn>1</mn> </msub> </math></span> to the data, we first create a design matrix that has girth and an intercept term. We also create the <span class="math notranslate nohighlight"><math> <mi>y</mi> </math></span> vector of observed donkey weights:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">X</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">train_set</code></span><span><code class="o">.</code></span><span><code class="n">assign</code></span><span><code class="p">(</code></span><span><code class="n">intr</code></span><span><code class="o">=</code></span><span><code class="mi">1</code></span><span><code class="p">)</code><code class="p">[</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">intr</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Girth</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">]</code></span><code>&#13;
</code><span><code class="n">y</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">train_set</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Weight</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><span><code class="n">X</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>intr</th>&#13;
			<th>Girth</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>230</strong></td>&#13;
			<td>1</td>&#13;
			<td>116</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>74</strong></td>&#13;
			<td>1</td>&#13;
			<td>117</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>354</strong></td>&#13;
			<td>1</td>&#13;
			<td>123</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>157</strong></td>&#13;
			<td>1</td>&#13;
			<td>123</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>41</strong></td>&#13;
			<td>1</td>&#13;
			<td>103</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>381</strong></td>&#13;
			<td>1</td>&#13;
			<td>106</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>433 rows × 2 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Now we want<a contenteditable="false" data-primary="minimize() method" data-type="indexterm" id="id1791"/> to find the <span class="math notranslate nohighlight"><math> <msub> <mi>θ</mi> <mn>0</mn> </msub> </math></span> and <span class="math notranslate nohighlight"><math> <msub> <mi>θ</mi> <mn>1</mn> </msub> </math></span> that minimize the average anesthetic loss over the data. To do this, we could use calculus as we did in <a class="reference internal" data-type="xref" href="ch15.html#ch-linear">Chapter 15</a>, but here we’ll instead use the <code>minimize</code> method from the <code>scipy</code> package, which performs a numerical optimization (see <a class="reference internal" data-type="xref" href="ch20.html#ch-gd">Chapter 20</a>):</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="kn">from</code></span><code> </code><span><code class="nn">scipy</code><code class="nn">.</code><code class="nn">optimize</code></span><code> </code><span><code class="kn">import</code></span><code> </code><span><code class="n">minimize</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="k">def</code></span><code> </code><span><code class="nf">training_loss</code></span><span><code class="p">(</code></span><span><code class="n">X</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="k">def</code></span><code> </code><span><code class="nf">loss</code></span><span><code class="p">(</code></span><span><code class="n">theta</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>        </code><span><code class="n">predicted</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">X</code></span><code> </code><span><code class="o">@</code></span><code> </code><span><code class="n">theta</code></span><code>&#13;
</code><code>        </code><span><code class="k">return</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">mean</code></span><span><code class="p">(</code></span><span><code class="n">anes_loss</code></span><span><code class="p">(</code></span><span><code class="mi">100</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">y</code></span><code> </code><span><code class="o">-</code></span><code> </code><span><code class="n">predicted</code></span><span><code class="p">)</code></span><code> </code><span><code class="o">/</code></span><code> </code><span><code class="n">predicted</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="n">loss</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">results</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">minimize</code></span><span><code class="p">(</code></span><span><code class="n">training_loss</code></span><span><code class="p">(</code></span><span><code class="n">X</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="p">)</code><code class="p">,</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">ones</code></span><span><code class="p">(</code></span><span><code class="mi">2</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">theta_hat</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">results</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">x</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell tag_hide-input docutils container">&#13;
<div class="cell_output docutils container">&#13;
<div class="output stream highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
After fitting:&#13;
θ₀ = -218.51&#13;
θ₁ =    3.16&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Let’s see how this simple model<a contenteditable="false" data-primary="errors" data-secondary="in donkey weight data analysis" data-secondary-sortas="donkey weight data analysis" data-type="indexterm" id="id1792"/> does. We can use the model to predict the donkey weights on our train set, then find the errors in the predictions. The residual plot that follows shows the model error as a percentage of the predicted value. It’s more important for the prediction errors to be small relative to the size of the donkey, since a 10 kg error is much worse for a 100 kg donkey than a 200 kg one. Thus, we find the relative error of each prediction:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">predicted</code> <code class="o">=</code> <code class="n">X</code> <code class="o">@</code> <code class="n">theta_hat</code>&#13;
<code class="n">resids</code> <code class="o">=</code> <code class="mi">100</code> <code class="o">*</code> <code class="p">(</code><code class="n">y</code> <code class="o">-</code> <code class="n">predicted</code><code class="p">)</code> <code class="o">/</code> <code class="n">predicted</code>&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Let’s examine a scatterplot of the relative errors:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">resid</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">({</code>&#13;
    <code class="s1">'Predicted weight (kg)'</code><code class="p">:</code> <code class="n">predicted</code><code class="p">,</code> <code class="s1">'Percent error'</code><code class="p">:</code> <code class="n">resids</code><code class="p">})</code>&#13;
<code class="n">px</code><code class="o">.</code><code class="n">scatter</code><code class="p">(</code><code class="n">resid</code><code class="p">,</code> <code class="n">x</code><code class="o">=</code><code class="s1">'Predicted weight (kg)'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s1">'Percent error'</code><code class="p">,</code>&#13;
           <code class="n">width</code><code class="o">=</code><code class="mi">350</code><code class="p">,</code> <code class="n">height</code><code class="o">=</code><code class="mi">250</code><code class="p">)</code>&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_18in08.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>With the simplest model, some of the predictions are off by 20% to 30%. Let’s see if a slightly more complicated model improves the predictions<a contenteditable="false" data-primary="" data-startref="ix_simp_lin_mod" data-type="indexterm" id="id1793"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Fitting a Multiple Linear Model" data-type="sect2"><div class="sect2" id="fitting-a-multiple-linear-model">&#13;
<h2>Fitting a Multiple Linear Model</h2>&#13;
&#13;
<p>Let’s consider additional models<a contenteditable="false" data-primary="multiple linear model" data-type="indexterm" id="id1794"/><a contenteditable="false" data-primary="fitting the model" data-secondary="multiple linear model" data-type="indexterm" id="id1795"/><a contenteditable="false" data-primary="linear modeling" data-secondary="fitting the model" data-type="indexterm" id="id1796"/> that incorporate the other numeric variables. We have three numeric variables that measure the donkey’s girth, length, and height, and there are seven total ways to combine these variables in a model:</p>&#13;
&#13;
<div class="cell tag_hide-input docutils container">&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
[['Girth'],&#13;
 ['Length'],&#13;
 ['Height'],&#13;
 ['Girth', 'Length'],&#13;
 ['Girth', 'Height'],&#13;
 ['Length', 'Height'],&#13;
 ['Girth', 'Length', 'Height']]&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>For each of these variable combinations, we can fit a model with our special loss function. Then we can look at how well each model does on the train set:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="k">def</code></span><code> </code><span><code class="nf">training_error</code></span><span><code class="p">(</code></span><span><code class="n">model</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="n">X</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">train_set</code></span><span><code class="o">.</code></span><span><code class="n">assign</code></span><span><code class="p">(</code></span><span><code class="n">intr</code></span><span><code class="o">=</code></span><span><code class="mi">1</code></span><span><code class="p">)</code><code class="p">[</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">intr</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="o">*</code></span><span><code class="n">model</code></span><span><code class="p">]</code><code class="p">]</code></span><code>&#13;
</code><code>    </code><span><code class="n">theta_hat</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">minimize</code></span><span><code class="p">(</code></span><span><code class="n">training_loss</code></span><span><code class="p">(</code></span><span><code class="n">X</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="p">)</code><code class="p">,</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">ones</code></span><span><code class="p">(</code></span><span><code class="n">X</code></span><span><code class="o">.</code></span><span><code class="n">shape</code></span><span><code class="p">[</code></span><span><code class="mi">1</code></span><span><code class="p">]</code><code class="p">)</code><code class="p">)</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">x</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code>    </code><span><code class="n">predicted</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">X</code></span><code> </code><span><code class="o">@</code></span><code> </code><span><code class="n">theta_hat</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">mean</code></span><span><code class="p">(</code></span><span><code class="n">anes_loss</code></span><span><code class="p">(</code></span><span><code class="mi">100</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">y</code></span><code> </code><span><code class="o">-</code></span><code> </code><span><code class="n">predicted</code></span><span><code class="p">)</code></span><span><code class="o">/</code></span><code> </code><span><code class="n">predicted</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">model_risks</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">[</code></span><code>&#13;
</code><code>    </code><span><code class="n">training_error</code></span><span><code class="p">(</code></span><span><code class="n">model</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="k">for</code></span><code> </code><span><code class="n">model</code></span><code> </code><span><code class="ow">in</code></span><code> </code><span><code class="n">models</code></span><code>&#13;
</code><span><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell tag_remove-input docutils container">&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>model</th>&#13;
			<th>mean_training_error</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>[Girth]</td>&#13;
			<td class="right">94.36</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>[Length]</td>&#13;
			<td class="right">200.55</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>[Height]</td>&#13;
			<td class="right">268.88</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3</strong></td>&#13;
			<td>[Girth, Length]</td>&#13;
			<td class="right">65.65</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>4</strong></td>&#13;
			<td>[Girth, Height]</td>&#13;
			<td class="right">86.18</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>5</strong></td>&#13;
			<td>[Length, Height]</td>&#13;
			<td class="right">151.15</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>6</strong></td>&#13;
			<td>[Girth, Length, Height]</td>&#13;
			<td class="right">63.44</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>As we stated earlier, the girth of the donkey is the single best predictor for weight. However, the combination of girth and length has an average loss that is quite a bit smaller than girth alone, and this particular two-variable model is nearly as good as the model that includes all three. Since we want a simple model, we select the two-variable model over the three-variable one.</p>&#13;
&#13;
<p>Next, we use feature engineering to incorporate categorical variables into the model, which improves our model.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Bringing Qualitative Features into the Model" data-type="sect2"><div class="sect2" id="bringing-qualitative-features-into-the-model">&#13;
<h2>Bringing Qualitative Features into the Model</h2>&#13;
&#13;
<p>In our exploratory<a contenteditable="false" data-primary="features and feature types" data-secondary="feature engineering" data-type="indexterm" id="ix_feat_feat_engin3"/><a contenteditable="false" data-primary="qualitative data and features" data-secondary="donkey weight modeling" data-type="indexterm" id="ix_qual_data_donk_weigh"/><a contenteditable="false" data-primary="feature engineering" data-secondary="qualitative features" data-type="indexterm" id="ix_feat_engin_qual_2"/> analysis, we found that the box plots of weight for a donkey’s body condition and age could contain useful information in predicting weight. Since these are categorical features, we can transform them into 0-1 variables with one-hot encoding, as explained in <a class="reference internal" data-type="xref" href="ch15.html#ch-linear">Chapter 15</a>.</p>&#13;
&#13;
<p>One-hot encoding<a contenteditable="false" data-primary="one-hot encoding" data-type="indexterm" id="ix_one_hot_enc2"/> lets us adjust the intercept term in the model for each combination of categories. Our current model includes the numeric variables girth and length:</p>&#13;
&#13;
<div data-type="equation">&#13;
<div class="math notranslate nohighlight"><math display="block"> <msub> <mi>θ</mi> <mn>0</mn> </msub> <mo>+</mo> <msub> <mi>θ</mi> <mn>1</mn> </msub> <mtext>Girth</mtext> <mo>+</mo> <msub> <mi>θ</mi> <mn>2</mn> </msub> <mtext>Length</mtext> </math></div>&#13;
</div>&#13;
&#13;
<p>If we cleaned up the age feature to consist of three categories—<code>Age&lt;2</code>, <code>Age2-5</code>, and <code>Age&gt;5</code>—a one-hot encoding of age creates three 0-1 features, one for each category. Including the one-hot-encoded feature in the model gives:</p>&#13;
&#13;
<div data-type="equation">&#13;
<div class="math notranslate nohighlight"><math display="block"> <mtable columnalign="right" columnspacing="0em" displaystyle="true" rowspacing="3pt"> <mtr> <mtd> <mtable columnalign="right left" columnspacing="0em" displaystyle="true" rowspacing="3pt"> <mtr> <mtd> <msub> <mi>θ</mi> <mn>0</mn> </msub> </mtd> <mtd> <mi/> <mo>+</mo> <msub> <mi>θ</mi> <mn>1</mn> </msub> <mtext>Girth </mtext> <mo>+</mo> <msub> <mi>θ</mi> <mn>2</mn> </msub> <mtext>Length </mtext> </mtd> </mtr> <mtr> <mtd/> <mtd> <mi/> <mo>+</mo> <msub> <mi>θ</mi> <mn>3</mn> </msub> <mtext>Age&lt;2 </mtext> <mo>+</mo> <msub> <mi>θ</mi> <mn>4</mn> </msub> <mtext>Age2-5 </mtext> </mtd> </mtr> </mtable> </mtd> </mtr> </mtable> </math></div>&#13;
</div>&#13;
&#13;
<p>In this model, <code>Age&lt;2</code> is 1 for a donkey younger than 2 and 0 otherwise. Similarly, <code>Age2-5</code> is 1 for a donkey between 2 and 5 years old and 0 otherwise.</p>&#13;
&#13;
<p>We can think of this model as fitting three linear models that are identical except for the size of the constant, since the model is equivalent to:</p>&#13;
&#13;
<div data-type="equation">&#13;
<div class="math notranslate nohighlight"><math display="block"> <mtable columnalign="right" columnspacing="0em" displaystyle="true" rowspacing="3pt"> <mtr> <mtd> <mtable columnalign="right left" columnspacing="0em" displaystyle="true" rowspacing="3pt"> <mtr> <mtd> <mo stretchy="false">(</mo> <msub> <mi>θ</mi> <mn>0</mn> </msub> <mo>+</mo> <msub> <mi>θ</mi> <mn>3</mn> </msub> <mo stretchy="false">)</mo> <mo>+</mo> <msub> <mi>θ</mi> <mn>1</mn> </msub> <mtext>Girth</mtext> <mo>+</mo> <msub> <mi>θ</mi> <mn>2</mn> </msub> <mtext>Length</mtext> </mtd> <mtd> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext>for a donkey under 2</mtext> </mtd> </mtr> <mtr> <mtd> <mo stretchy="false">(</mo> <msub> <mi>θ</mi> <mn>0</mn> </msub> <mo>+</mo> <msub> <mi>θ</mi> <mn>4</mn> </msub> <mo stretchy="false">)</mo> <mo>+</mo> <msub> <mi>θ</mi> <mn>1</mn> </msub> <mtext>Girth</mtext> <mo>+</mo> <msub> <mi>θ</mi> <mn>2</mn> </msub> <mtext>Length</mtext> </mtd> <mtd> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext>for a donkey between 2 and 4</mtext> </mtd> </mtr> <mtr> <mtd> <msub> <mi>θ</mi> <mn>0</mn> </msub> <mo>+</mo> <msub> <mi>θ</mi> <mn>1</mn> </msub> <mtext>Girth</mtext> <mo>+</mo> <msub> <mi>θ</mi> <mn>2</mn> </msub> <mtext>Length</mtext> </mtd> <mtd> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext> </mtext> <mtext>for a donkey over 5</mtext> </mtd> </mtr> </mtable> </mtd> </mtr> </mtable> </math></div>&#13;
</div>&#13;
&#13;
<p>Now let’s apply a one-hot encoding to all three of our categorical variables (body condition, age, and sex):</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">X_one_hot</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><code>&#13;
</code><code>    </code><span><code class="n">train_set</code></span><span><code class="o">.</code></span><span><code class="n">assign</code></span><span><code class="p">(</code></span><span><code class="n">intr</code></span><span><code class="o">=</code></span><span><code class="mi">1</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="p">[</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">intr</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Length</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Girth</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">BCS</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Age</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Sex</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">]</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">pipe</code></span><span><code class="p">(</code></span><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">get_dummies</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">columns</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Age</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Sex</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">drop</code></span><span><code class="p">(</code></span><span><code class="n">columns</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS_3.0</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Age_5-10</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Sex_female</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">)</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">X_one_hot</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe pagebreak-before less_space">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>intr</th>&#13;
			<th>Length</th>&#13;
			<th>Girth</th>&#13;
			<th>BCS_1.5</th>&#13;
			<th>...</th>&#13;
			<th>Age_&lt;2</th>&#13;
			<th>Age_&gt;20</th>&#13;
			<th>Sex_gelding</th>&#13;
			<th>Sex_stallion</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>230</strong></td>&#13;
			<td>1</td>&#13;
			<td class="right">101</td>&#13;
			<td>116</td>&#13;
			<td>0</td>&#13;
			<td>...</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
			<td>1</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>74</strong></td>&#13;
			<td>1</td>&#13;
			<td class="right">92</td>&#13;
			<td>117</td>&#13;
			<td>0</td>&#13;
			<td>...</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
			<td>1</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>354</strong></td>&#13;
			<td>1</td>&#13;
			<td class="right">103</td>&#13;
			<td>123</td>&#13;
			<td>0</td>&#13;
			<td>...</td>&#13;
			<td>0</td>&#13;
			<td>1</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>157</strong></td>&#13;
			<td>1</td>&#13;
			<td class="right">93</td>&#13;
			<td>123</td>&#13;
			<td>0</td>&#13;
			<td>...</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
			<td>1</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>41</strong></td>&#13;
			<td>1</td>&#13;
			<td class="right">89</td>&#13;
			<td>103</td>&#13;
			<td>0</td>&#13;
			<td>...</td>&#13;
			<td>1</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>381</strong></td>&#13;
			<td>1</td>&#13;
			<td class="right">86</td>&#13;
			<td>106</td>&#13;
			<td>0</td>&#13;
			<td>...</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
			<td>0</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>433 rows × 15 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>We dropped one dummy variable for each categorical feature. Since <code>BCS</code>, <code>Age</code>, and <code>Sex</code> have six, six, and three categories, respectively, we have added 12 dummy variables to the design matrix for a total of 15 columns, including the intercept term, girth, and length.</p>&#13;
&#13;
<p>Let’s see which categorical variables, if any, improve on our two-variable model. To do this, we can fit the model that includes the dummies from all three categorical features, along with girth and length:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">results</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">minimize</code></span><span><code class="p">(</code></span><span><code class="n">training_loss</code></span><span><code class="p">(</code></span><span><code class="n">X_one_hot</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="p">)</code><code class="p">,</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">ones</code></span><span><code class="p">(</code></span><span><code class="n">X_one_hot</code></span><span><code class="o">.</code></span><span><code class="n">shape</code></span><span><code class="p">[</code></span><span><code class="mi">1</code></span><span><code class="p">]</code><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">theta_hat</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">results</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">x</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">y_pred</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">X_one_hot</code></span><code> </code><span><code class="o">@</code></span><code> </code><span><code class="n">theta_hat</code></span><code>&#13;
</code><span><code class="n">training_error</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">mean</code></span><span><code class="p">(</code></span><span><code class="n">anes_loss</code></span><span><code class="p">(</code></span><span><code class="mi">100</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">y</code></span><code> </code><span><code class="o">-</code></span><code> </code><span><code class="n">y_pred</code></span><span><code class="p">)</code></span><span><code class="o">/</code></span><code> </code><span><code class="n">y_pred</code></span><span><code class="p">)</code><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="nb">print</code></span><span><code class="p">(</code></span><span><code class="sa">f</code></span><span><code class="s1">'</code><code class="s1">Training error: </code></span><span><code class="si">{</code></span><span><code class="n">training_error</code></span><span><code class="si">:</code></span><span><code class="s1">.2f</code></span><span><code class="si">}</code></span><span><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output stream highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
Training error: 51.47&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>According to average loss, this model does better than the previous model with only <code>Girth</code> and <code>Length</code>. But let’s try to make this model simpler while keeping its accuracy. To do this, we look at the coefficients for each of the dummy variables to see how close they are to 0 and to one another. In other words, we want to see how much the intercept might change if we include the coefficients in the model. A plot of the coefficients will make this comparison easy:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_18in09.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The coefficients confirm what we saw in the box plots. The coefficients for the sex of the donkey are close to zero, meaning that knowing the sex doesn’t really change the weight prediction. We also see that combining the age categories for donkeys over 5 years will simplify the model without losing much. Lastly, since there are so few donkeys with a body condition score of 1.5 and its coefficient is close to that of a BCS of 2, we are inclined to combine these two categories.</p>&#13;
&#13;
<p>We update the design matrix in view of these findings:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="k">def</code></span><code> </code><span><code class="nf">combine_bcs</code></span><span><code class="p">(</code></span><span><code class="n">X</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="n">new_bcs_2</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">X</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS_2.0</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">+</code></span><code> </code><span><code class="n">X</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS_1.5</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="n">X</code></span><span><code class="o">.</code></span><span><code class="n">assign</code></span><span><code class="p">(</code></span><span><code class="o">*</code><code class="o">*</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">BCS_2.0</code><code class="s1">'</code></span><span><code class="p">:</code></span><code> </code><span><code class="n">new_bcs_2</code></span><span><code class="p">}</code><code class="p">)</code></span><span><code class="o">.</code></span><span><code class="n">drop</code></span><span><code class="p">(</code></span><span><code class="n">columns</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS_1.5</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="k">def</code></span><code> </code><span><code class="nf">combine_age_and_sex</code></span><span><code class="p">(</code></span><span><code class="n">X</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="n">X</code></span><span><code class="o">.</code></span><span><code class="n">drop</code></span><span><code class="p">(</code></span><span><code class="n">columns</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Age_10-15</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Age_15-20</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Age_&gt;20</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                           </code><span><code class="s1">'</code><code class="s1">Sex_gelding</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Sex_stallion</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">X_one_hot_simple</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><code>&#13;
</code><code>    </code><span><code class="n">X_one_hot</code></span><span><code class="o">.</code></span><span><code class="n">pipe</code></span><span><code class="p">(</code></span><span><code class="n">combine_bcs</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">pipe</code></span><span><code class="p">(</code></span><span><code class="n">combine_age_and_sex</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>And then we fit the simpler model<a contenteditable="false" data-primary="" data-startref="ix_one_hot_enc2" data-type="indexterm" id="id1797"/>:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">results</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">minimize</code></span><span><code class="p">(</code></span><span><code class="n">training_loss</code></span><span><code class="p">(</code></span><span><code class="n">X_one_hot_simple</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="p">)</code><code class="p">,</code></span><code>&#13;
</code><code>                   </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">ones</code></span><span><code class="p">(</code></span><span><code class="n">X_one_hot_simple</code></span><span><code class="o">.</code></span><span><code class="n">shape</code></span><span><code class="p">[</code></span><span><code class="mi">1</code></span><span><code class="p">]</code><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">theta_hat</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">results</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">x</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><span><code class="n">y_pred</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">X_one_hot_simple</code></span><code> </code><span><code class="o">@</code></span><code> </code><span><code class="n">theta_hat</code></span><code>&#13;
</code><span><code class="n">training_error</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">mean</code></span><span><code class="p">(</code></span><span><code class="n">anes_loss</code></span><span><code class="p">(</code></span><span><code class="mi">100</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">y</code></span><code> </code><span><code class="o">-</code></span><code> </code><span><code class="n">y_pred</code></span><span><code class="p">)</code></span><span><code class="o">/</code></span><code> </code><span><code class="n">y_pred</code></span><span><code class="p">)</code><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><span><code class="nb">print</code></span><span><code class="p">(</code></span><span><code class="sa">f</code></span><span><code class="s1">'</code><code class="s1">Training error: </code></span><span><code class="si">{</code></span><span><code class="n">training_error</code></span><span><code class="si">:</code></span><span><code class="s1">.2f</code></span><span><code class="si">}</code></span><span><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output stream highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
Training error: 53.20&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p class="pagebreak-before less_space">The average error is close enough to that of the more complex model for us to settle on this simpler one. Let’s display the coefficients and summarize the model:</p>&#13;
&#13;
<div class="cell tag_remove-input docutils container">&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>var</th>&#13;
			<th>theta_hat</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>intr</td>&#13;
			<td class="right">-175.25</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Length</td>&#13;
			<td class="right">1.01</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Girth</td>&#13;
			<td class="right">1.97</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3</strong></td>&#13;
			<td>BCS_2.0</td>&#13;
			<td class="right">-6.33</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>4</strong></td>&#13;
			<td>BCS_2.5</td>&#13;
			<td class="right">-5.11</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>5</strong></td>&#13;
			<td>BCS_3.5</td>&#13;
			<td class="right">7.36</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>6</strong></td>&#13;
			<td>BCS_4.0</td>&#13;
			<td class="right">20.05</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>7</strong></td>&#13;
			<td>Age_2-5</td>&#13;
			<td class="right">-3.47</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>8</strong></td>&#13;
			<td>Age_&lt;2</td>&#13;
			<td class="right">-6.49</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Our model is roughly:</p>&#13;
&#13;
<div data-type="equation">&#13;
<div class="math notranslate nohighlight"><math display="block"> <mtext>Weight</mtext> <mo>≈</mo> <mo>−</mo> <mn>175</mn> <mo>+</mo> <mtext>Length</mtext> <mo>+</mo> <mn>2</mn> <mtext>Girth</mtext> </math></div>&#13;
</div>&#13;
&#13;
<p>After this initial approximation, we use the categorical features to make some <span class="keep-together">adjustments</span>:</p>&#13;
&#13;
<ul>&#13;
	<li>&#13;
	<p>BCS 2 or less? Subtract 6.5 kg.</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>BCS 2.5? Subtract 5.1 kg.</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>BCS 3.5? Add 7.4 kg.</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>BCS 4? Add 20 kg.</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Age under 2 years? Subtract 6.5 kg.</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Age between 2 and 5 years? Subtract 3.5 kg.</p>&#13;
	</li>&#13;
</ul>&#13;
&#13;
<p>This model seems quite simple to implement because after our initial estimate based on the length and girth of the donkey, we add or subtract a few numbers based on answers to a few yes/no questions. Let’s see how well the model does in predicting the weights of the donkeys in the test set<a contenteditable="false" data-primary="" data-startref="ix_qual_data_donk_weigh" data-type="indexterm" id="id1798"/><a contenteditable="false" data-primary="" data-startref="ix_feat_engin_qual_2" data-type="indexterm" id="id1799"/><a contenteditable="false" data-primary="" data-startref="ix_feat_feat_engin3" data-type="indexterm" id="id1800"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Model Assessment" data-type="sect2"><div class="sect2" id="model-assessment">&#13;
<h2>Model Assessment</h2>&#13;
&#13;
<p>Remember<a contenteditable="false" data-primary="weighing a donkey case study" data-secondary="assessment of model" data-type="indexterm" id="ix_weigh_donk_stud_ass"/> that we put aside 20% of our data before exploring and modeling with the remaining 80%. We are now ready to apply what we have learned from the training set to the test set. That is, we take our fitted model and use it to predict the weights of the donkeys in the test set. To do this, we need to prepare the test set. Our model uses the girth and length of the donkey, as well as dummy variables for the donkey’s age and body condition score. We apply all of our transformations on the train set to our test set:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">y_test</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">test_set</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Weight</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">X_test</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><code>&#13;
</code><code>    </code><span><code class="n">test_set</code></span><span><code class="o">.</code></span><span><code class="n">assign</code></span><span><code class="p">(</code></span><span><code class="n">intr</code></span><span><code class="o">=</code></span><span><code class="mi">1</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="p">[</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">intr</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Length</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Girth</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">BCS</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Age</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Sex</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">]</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">pipe</code></span><span><code class="p">(</code></span><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">get_dummies</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">columns</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Age</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Sex</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">drop</code></span><span><code class="p">(</code></span><span><code class="n">columns</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">BCS_3.0</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Age_5-10</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Sex_female</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">pipe</code></span><span><code class="p">(</code></span><span><code class="n">combine_bcs</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">pipe</code></span><span><code class="p">(</code></span><span><code class="n">combine_age_and_sex</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>We consolidate all of our manipulations of the design matrix to create the final version that we settled on in our modeling with the train set. Now we are ready to use the <span class="math notranslate nohighlight"><math> <mi>θ</mi> </math></span>s that we fitted with the train set to make weight predictions for those donkeys in the test set:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">y_pred_test</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">X_test</code></span><code> </code><span><code class="o">@</code></span><code> </code><span><code class="n">theta_hat</code></span><code>&#13;
</code><span><code class="n">test_set_error</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="mi">100</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">y_test</code></span><code> </code><span><code class="o">-</code></span><code> </code><span><code class="n">y_pred_test</code></span><span><code class="p">)</code></span><code> </code><span><code class="o">/</code></span><code> </code><span><code class="n">y_pred_test</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Then we can plot the relative prediction errors:</p>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_18in10.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Remember that positive relative error means underestimating weight, which is not as critical as overestimating weight. From this residual plot, we see that nearly all of the test set weights are within 10% of the predictions, and only one error that exceeds 10% errs on the side of overestimation. This makes sense given that our loss function penalized overestimation more.</p>&#13;
&#13;
<p>An alternative scatterplot that shows the actual and predicted values along with lines marking 10% error gives a different view:</p>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_18in11.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The 10% lines lie farther from the prediction line for larger weights.</p>&#13;
&#13;
<p>We’ve accomplished our goal! We have a model that uses easy-to-get measurements, is simple enough to explain on an instruction sheet, and makes predictions within 10% of the actual donkey weight. Next, we summarize this case study and reflect on our model<a contenteditable="false" data-primary="" data-startref="ix_weigh_donk_stud_ass" data-type="indexterm" id="id1801"/><a contenteditable="false" data-primary="" data-startref="ix_weigh_donk_stud_mod" data-type="indexterm" id="id1802"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="sec-donkey-summary">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>In this case study, we demonstrated the different purposes of modeling: description, inference, and prediction. For description, we sought a simple, understandable model. We handcrafted this model, beginning with our findings from the exploratory phase of the analysis. Every action we took to include a feature in the model, collapse categories, or transform a feature amounts to a decision we made while investigating the data.</p>&#13;
&#13;
<p>In modeling a natural phenomenon such as the weight of a donkey, we would ideally make use of physical and statistical models. In this case, the physical model is the representation of a donkey by a cylinder. An inquisitive reader might have pointed out that we could have used this representation directly to estimate the weight of a donkey (cylinder) from its length and girth (since girth is <span class="math notranslate nohighlight"><math> <mn>2</mn> <mi>π</mi> <mi>r</mi> </math></span>):</p>&#13;
&#13;
<div data-type="equation">&#13;
<div class="math notranslate nohighlight"><math display="block"> <mi>w</mi> <mi>e</mi> <mi>i</mi> <mi>g</mi> <mi>h</mi> <mi>t</mi> <mo>∝</mo> <mi>g</mi> <mi>i</mi> <mi>r</mi> <mi>t</mi> <msup> <mi>h</mi> <mn>2</mn> </msup> <mo>×</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mi>g</mi> <mi>t</mi> <mi>h</mi> </math></div>&#13;
</div>&#13;
&#13;
<p>This physical model suggests that the log-transformed weight is approximately linear in girth and length:</p>&#13;
&#13;
<div data-type="equation">&#13;
<div class="math notranslate nohighlight"><math display="block"> <mi>log</mi> <mo>⁡</mo> <mo stretchy="false">(</mo> <mi>w</mi> <mi>e</mi> <mi>i</mi> <mi>g</mi> <mi>h</mi> <mi>t</mi> <mo stretchy="false">)</mo> <mo>∝</mo> <mn>2</mn> <mi>log</mi> <mo>⁡</mo> <mo stretchy="false">(</mo> <mi>g</mi> <mi>i</mi> <mi>r</mi> <mi>t</mi> <mi>h</mi> <mo stretchy="false">)</mo> <mo>+</mo> <mi>log</mi> <mo>⁡</mo> <mo stretchy="false">(</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mi>g</mi> <mi>t</mi> <mi>h</mi> <mo stretchy="false">)</mo> </math></div>&#13;
</div>&#13;
&#13;
<p>Given this physical model, you might wonder why we did not use logarithmic or square transformations in fitting our model. We leave you to investigate such a model in greater detail. But generally, if the range of values measured is small, then the log function is roughly linear. To keep our model simple, we chose not to make these transformations given the strength of the statistical model seen by the high correlation between girth and weight.</p>&#13;
&#13;
<p>We did a lot of <em>data dredging</em> in this modeling exercise. We examined all possible models built from linear combinations of the numeric features, and we examined coefficients of dummy variables to decide whether to collapse categories. When we create models using an iterative approach like this, it is extremely important that we set aside data to assess the model. Evaluating the model on new data reassures us that the model we chose works well. The data that we set aside did not enter into any decision making when building the model, so it gives us a good sense of how well the model works for making predictions.</p>&#13;
&#13;
<p>We should keep the data scope and its potential biases described earlier in mind. Our model has done well on the test set, but the test and train sets come from the same data collection process. We expect our model to work well in practice as long as the scope remains the same for new data.</p>&#13;
&#13;
<p>Finally, this case study shows how fitting models is often a balance between simplicity and complexity and between physical and statistical models. A physical model can be a good starting point in modeling, and a statistical model can inform a physical model. As data scientists, we needed to make judgment calls at each step in the analysis. Modeling is both an art and a science<a contenteditable="false" data-primary="" data-startref="ix_lin_mod_weigh" data-type="indexterm" id="id1803"/><a contenteditable="false" data-primary="" data-startref="ix_weigh_donk_stud" data-type="indexterm" id="id1804"/>.</p>&#13;
&#13;
<p>This case study and several chapters preceding it have focused on fitting linear models. Next, we consider a different kind of modeling for the situation when the response variable we are explaining or predicting is qualitative, not quantitative.</p>&#13;
</div></section>&#13;
</div></section></body></html>