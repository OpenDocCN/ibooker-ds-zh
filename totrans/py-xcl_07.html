<html><head></head><body>
<p id="filepos482650" class="calibre_"><span class="calibre2"><span class="bold"><span class="calibre_15">Chapter 5. Data Analysis with pandas</span></span></span></p><p class="calibre_16">This chapter will introduce you to pandas, <a/>the <span class="italic">Python Data Analysis Library</span> or—how I like to put it—the Python-based spreadsheet with superpowers. It’s so powerful that some of the companies that I worked with have managed to get rid of Excel completely by replacing it with a combination of Jupyter notebooks and pandas. As a reader of this book, however, I assume you will keep Excel, in which case pandas will serve as an interface for getting data in and out of spreadsheets. pandas makes tasks that are particularly painful in Excel easier, faster, and less error-prone. Some of these tasks include getting big datasets from external sources and working with statistics, time series, and interactive charts. pandas’ most important superpowers are vectorization and data alignment. As we’ve already seen in the previous chapter with NumPy arrays, <a id="filepos483705"/>vectorization allows you to write concise, array-based code while data alignment makes sure that there is no data mismatch when you work with multiple datasets.</p><p class="calibre_6">This chapter covers the whole data analysis journey: it starts with cleaning and preparing data before it shows you how to make sense out of bigger datasets via aggregation, descriptive statistics, and visualization. At the end of the chapter, we’ll see how we can import and export data with pandas. But first things first—let’s get started with an introduction to pandas’ main data structures: DataFrame and Series!</p><p id="filepos484346" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">DataFrame and Series</span></span></span></p><p class="calibre_6">DataFrame <a id="filepos484520"/>and Series are the core data structures in pandas. In this section, I am introducing them with a focus on the main components of a DataFrame: index, columns, and data. A <span class="italic">DataFrame</span> is similar to a two-dimensional NumPy array, but it comes with column and row labels and each column can hold different data types. By extracting a single column or row from a DataFrame, you get a one-dimensional Series. Again, a <span class="italic">Series</span> is similar to a one-dimensional NumPy array with labels. When you look at the structure of a DataFrame in <a href="#filepos485286"><span class="calibre_7">Figure 5-1</span></a>, it won’t take a lot of imagination to see that DataFrames are going to be your Python-based spreadsheets.</p><p class="calibre_21"><img src="images/00069.jpg" id="filepos485286" class="calibre_70"/>
</p><p class="calibre_23"><span class="calibre5"><span class="italic"><span class="calibre_15">Figure 5-1. A pandas Series and DataFrame</span></span></span></p><p class="calibre_24">To<a id="filepos485550"/> show you how easy it is to transition from a spreadsheet to a DataFrame, <a id="filepos485631"/>consider the following Excel table in <a href="#filepos485969"><span class="calibre_7">Figure 5-2</span></a>, which shows participants of an online course with their score. You will find the corresponding file <span class="italic">course_participants.xlsx</span> in the <span class="italic">xl</span> folder of the companion repo.</p><p class="calibre_21"><img src="images/00077.jpg" id="filepos485969" class="calibre_71"/>
</p><p class="calibre_23"><span class="calibre5"><span class="italic"><span class="calibre_15">Figure 5-2. course_participants.xlsx</span></span></span></p><p class="calibre_24">To make this Excel table available in Python, start by importing pandas, then use <a id="filepos486309"/>its <tt class="calibre6">read_excel</tt> function, which returns a DataFrame:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">import</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">pandas</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">as</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">pd</span></span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">read_excel</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"xl/course_participants.xlsx"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[2]:    user_id   name  age  country  score continent<br class="calibre1"/>        0     1001   Mark   55    Italy    4.5    Europe<br class="calibre1"/>        1     1000   John   33      USA    6.7   America<br class="calibre1"/>        2     1002    Tim   41      USA    3.9   America<br class="calibre1"/>        3     1003  Jenny   12  Germany    9.0    Europe</tt></span></blockquote><blockquote class="calibre_25"><span class="bold"><span class="calibre_29">THE READ_EXCEL FUNCTION WITH PYTHON 3.9</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">If you are running </span><span class="calibre5"><tt class="calibre6">pd.read_excel</tt></span><span class="calibre5"> with Python 3.9 or above, make sure to use at least pandas 1.2 or you will get an error when reading </span><span class="calibre5"><span class="italic">xlsx</span></span><span class="calibre5"> files.</span></blockquote><p class="calibre_16">If you run this in a Jupyter notebook, the DataFrame will be nicely formatted as an HTML table, which makes it even closer to how the table looks in Excel. I will spend the whole of <a href="index_split_019.html#filepos863345"><span class="calibre_7">Chapter 7</span></a> on reading and writing Excel files with pandas, so this was only an introductory example to show you that spreadsheets and DataFrames are, indeed, <a id="filepos489337"/>very similar. Let’s now re-create this DataFrame from scratch without reading it from the Excel file: one way of creating a DataFrame<a id="filepos489479"/> is to provide the data as a nested list, along with values for <tt class="calibre6">columns</tt> and <tt class="calibre6">index</tt>:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Mark"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">55</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Italy"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4.5</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Europe"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>              </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"John"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">33</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"USA"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6.7</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"America"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>              </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Tim"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">41</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"USA"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3.9</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"America"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>              </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Jenny"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">12</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Germany"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">9.0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Europe"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                          </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                   </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"score"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"continent"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                          </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1001</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1000</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1002</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1003</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[3]:        name  age  country  score continent<br class="calibre1"/>        1001   Mark   55    Italy    4.5    Europe<br class="calibre1"/>        1000   John   33      USA    6.7   America<br class="calibre1"/>        1002    Tim   41      USA    3.9   America<br class="calibre1"/>        1003  Jenny   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">By calling<a id="filepos496964"/> the <tt class="calibre6">info</tt> method, you will get some basic information, most importantly the number of data points and the data types for each column:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">info</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">&lt;class 'pandas.core.frame.DataFrame'&gt;<br class="calibre1"/>Int64Index: 4 entries, 1001 to 1003<br class="calibre1"/>Data columns (total 5 columns):<br class="calibre1"/> #   Column     Non-Null Count  Dtype<br class="calibre1"/>---  ------     --------------  -----<br class="calibre1"/> 0   name       4 non-null      object<br class="calibre1"/> 1   age        4 non-null      int64<br class="calibre1"/> 2   country    4 non-null      object<br class="calibre1"/> 3   score      4 non-null      float64<br class="calibre1"/> 4   continent  4 non-null      object<br class="calibre1"/>dtypes: float64(1), int64(1), object(3)<br class="calibre1"/>memory usage: 192.0+ bytes</tt></span></blockquote><p class="calibre_32">If you are just interested in the data type of your columns, run <tt class="calibre6">df.dtypes</tt> instead. Columns with strings<a id="filepos498597"/> or mixed data types will have the data type <tt class="calibre6">object</tt>. <a id="filepos498666"/><a href="index_split_016.html#filepos767133"><span class="calibre5"><span class="calibre_7">1</span></span></a> Let us now have a closer look at the index and columns of a DataFrame.</p><p id="filepos498826" class="calibre_17"><span class="calibre3"><span class="bold">Index</span></span></p><p class="calibre_6">The<a id="filepos498949"/> row labels of a DataFrame are called <span class="italic">index</span>. If you don’t have a meaningful index, leave it away when constructing a DataFrame. pandas will then automatically create an integer index starting at zero. We saw this in the very first example when we read the DataFrame from the Excel file. An index will allow pandas to look up data faster and is essential for many common operations, e.g., combining two DataFrames. You access the index object like the following:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">5</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[5]: Int64Index([1001, 1000, 1002, 1003], dtype='int64')</tt></span></blockquote><p class="calibre_32">If it makes sense, give <a id="filepos500212"/>the index a name. Let’s follow the table in Excel, and give it the name <tt class="calibre6">user_id</tt>:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">name</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"user_id"</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[6]:           name  age  country  score continent<br class="calibre1"/>        user_id<br class="calibre1"/>        1001      Mark   55    Italy    4.5    Europe<br class="calibre1"/>        1000      John   33      USA    6.7   America<br class="calibre1"/>        1002       Tim   41      USA    3.9   America<br class="calibre1"/>        1003     Jenny   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">Unlike the primary key of a database, a DataFrame index can have duplicates, but looking up values may be slower in that case. To turn an index into a regular column <a id="filepos502052"/>use <tt class="calibre6">reset_index</tt>, and to set a new index <a id="filepos502108"/>use <tt class="calibre6">set_index</tt>. If you don’t want to lose your existing index when setting a new one, make sure to reset it first:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">7</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># "reset_index" turns the index into a column, replacing the</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># index with the default index. This corresponds to the DataFrame</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># from the beginning that we loaded from Excel.</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">reset_index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[7]:    user_id   name  age  country  score continent<br class="calibre1"/>        0     1001   Mark   55    Italy    4.5    Europe<br class="calibre1"/>        1     1000   John   33      USA    6.7   America<br class="calibre1"/>        2     1002    Tim   41      USA    3.9   America<br class="calibre1"/>        3     1003  Jenny   12  Germany    9.0    Europe</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">8</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># "reset_index" turns "user_id" into a regular column and</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># "set_index" turns the column "name" into the index</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">reset_index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">set_index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[8]:        user_id  age  country  score continent<br class="calibre1"/>        name<br class="calibre1"/>        Mark      1001   55    Italy    4.5    Europe<br class="calibre1"/>        John      1000   33      USA    6.7   America<br class="calibre1"/>        Tim       1002   41      USA    3.9   America<br class="calibre1"/>        Jenny     1003   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">By doing <tt class="calibre6">df.reset_index().set_index("name")</tt>, you are <a id="filepos505857"/>using <span class="italic">method chaining</span>: since <tt class="calibre6">reset_index()</tt> returns a DataFrame, you can directly call another DataFrame method without having to write out the intermediate result first.</p><blockquote class="calibre_25"><span class="bold"><span class="calibre_26">DATAFRAME METHODS RETURN COPIES</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">Whenever you call a method on a DataFrame in the form </span><a id="filepos506311"/><span class="calibre5"><tt class="calibre6">df.method_name()</tt></span><span class="calibre5">, you will get back a copy of the DataFrame with that method applied, leaving the original DataFrame untouched. We have just done that by calling </span><span class="calibre5"><tt class="calibre6">df.reset_index()</tt></span><span class="calibre5">. If you wanted to change the original DataFrame, you would have to assign the return value back to the original variable like the following:</span></blockquote><blockquote class="calibre_46"><blockquote class="calibre_19"><span class="calibre5"><tt class="calibre6">df = df.reset_index()</tt></span></blockquote></blockquote><blockquote class="calibre_31"><span class="calibre5">Since we are not doing this, it means that our variable </span><span class="calibre5"><tt class="calibre6">df</tt></span><span class="calibre5"> is still holding its original data. The next samples also call DataFrame methods, i.e., don’t change the original DataFrame.</span></blockquote><p class="calibre_16">To change the index, use <a id="filepos507287"/>the <tt class="calibre6">reindex</tt> method:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">9</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">reindex</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">([</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">999</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1000</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1001</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1004</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[9]:          name   age country  score continent<br class="calibre1"/>        user_id<br class="calibre1"/>        999       NaN   NaN     NaN    NaN       NaN<br class="calibre1"/>        1000     John  33.0     USA    6.7   America<br class="calibre1"/>        1001     Mark  55.0   Italy    4.5    Europe<br class="calibre1"/>        1004      NaN   NaN     NaN    NaN       NaN</tt></span></blockquote><p class="calibre_32">This is a first example of <a id="filepos509147"/>data alignment at work: <tt class="calibre6">reindex</tt> will take over all rows that match the new index and will introduce rows with missing values (<tt class="calibre6">NaN</tt>) where no information exists. Index elements that you leave away will be dropped. I will introduce <tt class="calibre6">NaN</tt> properly a bit later in this chapter. Finally, to sort an index, use<a id="filepos509482"/> the <tt class="calibre6">sort_index</tt> method:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">10</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sort_index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[10]:           name  age  country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1000      John   33      USA    6.7   America<br class="calibre1"/>         1001      Mark   55    Italy    4.5    Europe<br class="calibre1"/>         1002       Tim   41      USA    3.9   America<br class="calibre1"/>         1003     Jenny   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">If, instead, you want to sort the rows by one or more columns, use <tt class="calibre6">sort_values</tt>:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">11</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sort_values</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">([</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"continent"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[11]:           name  age  country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1000      John   33      USA    6.7   America<br class="calibre1"/>         1002       Tim   41      USA    3.9   America<br class="calibre1"/>         1003     Jenny   12  Germany    9.0    Europe<br class="calibre1"/>         1001      Mark   55    Italy    4.5    Europe</tt></span></blockquote><p class="calibre_32">The sample shows how to sort first by <tt class="calibre6">continent</tt>, then by <tt class="calibre6">age</tt>. If you wanted to sort by only one column, you could also provide the column name<a id="filepos512499"/> as a string:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">df.sort_values("continent")</tt></span></blockquote><p class="calibre_32">This has covered the basics of<a id="filepos512717"/> how indices work. Let’s now turn our attention to its horizontal equivalent, the DataFrame columns!</p><p id="filepos512830" class="calibre_17"><span class="calibre3"><span class="bold">Columns</span></span></p><p class="calibre_6">To<a id="filepos512954"/> get information about the columns of a DataFrame, run the following code:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">12</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[12]: Index(['name', 'age', 'country', 'score', 'continent'], dtype='object')</tt></span></blockquote><p class="calibre_32">If you don’t provide any column names when constructing a DataFrame, pandas will number the columns with integers starting at zero. With columns, however, this is almost never a good idea as columns represent variables and are therefore easy to name. You<a id="filepos514077"/> assign a name to the column headers in the same way we did it with the index:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">13</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">name</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"properties"</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[13]: properties   name  age  country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001         Mark   55    Italy    4.5    Europe<br class="calibre1"/>         1000         John   33      USA    6.7   America<br class="calibre1"/>         1002          Tim   41      USA    3.9   America<br class="calibre1"/>         1003        Jenny   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">If you don’t like the column names, <a id="filepos515814"/>rename them:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">14</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rename</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">{</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"First Name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">})</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[14]: properties First Name  Age  country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001             Mark   55    Italy    4.5    Europe<br class="calibre1"/>         1000             John   33      USA    6.7   America<br class="calibre1"/>         1002              Tim   41      USA    3.9   America<br class="calibre1"/>         1003            Jenny   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">If you want to<a id="filepos517912"/> delete columns, use the following syntax (the sample shows you how to drop columns and indices at the same time):</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">15</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">drop</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                 </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1000</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1003</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[15]: properties  age  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001         55    4.5    Europe<br class="calibre1"/>         1002         41    3.9   America</tt></span></blockquote><p class="calibre_32">The columns and the index of a DataFrame are both represented by an <tt class="calibre6">Index</tt> object, so you can change your columns into rows and vice versa by <a id="filepos520188"/>transposing your DataFrame:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">16</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">T</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Shortcut for df.transpose()</span></span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[16]: user_id       1001     1000     1002     1003<br class="calibre1"/>         properties<br class="calibre1"/>         name          Mark     John      Tim    Jenny<br class="calibre1"/>         age             55       33       41       12<br class="calibre1"/>         country      Italy      USA      USA  Germany<br class="calibre1"/>         score          4.5      6.7      3.9        9<br class="calibre1"/>         continent   Europe  America  America   Europe</tt></span></blockquote><p class="calibre_32">It’s worth remembering here that our DataFrame <tt class="calibre6">df</tt> is still unchanged, as we have never reassigned the returning DataFrame from the method calls back to the original <tt class="calibre6">df</tt> variable. If you would like to<a id="filepos521832"/> reorder the columns of a DataFrame, you could use the <tt class="calibre6">reindex</tt> method that we used with the index, but selecting the columns in the desired order is often more intuitive:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">17</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"continent"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"score"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[17]: properties continent  country   name  age  score<br class="calibre1"/>         user_id<br class="calibre1"/>         1001          Europe    Italy   Mark   55    4.5<br class="calibre1"/>         1000         America      USA   John   33    6.7<br class="calibre1"/>         1002         America      USA    Tim   41    3.9<br class="calibre1"/>         1003          Europe  Germany  Jenny   12    9.0</tt></span></blockquote><p class="calibre_32">This<a id="filepos524119"/> last example needs quite a few explanations: everything about <tt class="calibre6">loc</tt> and how data selection works is the topic of the next section.</p><p id="filepos524268" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Data Manipulation</span></span></span></p><p class="calibre_6">Real-world data hardly gets served on a silver platter, so before working with it, you need to clean it and bring it into a digestible form. We’ll begin this section by looking at how to select data from a DataFrame, how to change it, and how to deal with missing and duplicate data. We’ll then perform a few calculations with DataFrames and see how you work with text data. To wrap this section up, we’ll find out when pandas returns a view vs. a copy of the data. Quite a few concepts in this section are related to what we have already seen with NumPy arrays in the last chapter.</p><p id="filepos525021" class="calibre_17"><span class="calibre3"><span class="bold">Selecting Data</span></span></p><p class="calibre_6">Let’s <a id="filepos525158"/>start with accessing data by label and position before looking at other methods, including boolean indexing and selecting data by using a MultiIndex.</p><p class="calibre_20"><span class="bold"><span class="calibre_5">Selecting by label</span></span></p><p class="calibre_6">The<a id="filepos525461"/> most common way of accessing the data of a DataFrame is by referring to its labels. Use the attribute <tt class="calibre6">loc</tt>, which stands for <span class="italic">location</span>, to specify which rows and columns you want to retrieve:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">row_selection</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">column_selection</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><p class="calibre_32"><tt class="calibre6">loc</tt> supports the slice notation and therefore accepts a colon to select all rows or columns, respectively. Additionally, you can provide lists with labels as well as a single column or row name. Have a look at <a href="#filepos526726"><span class="calibre_7">Table 5-1</span></a> to see a few examples of how you select different parts from our sample DataFrame <tt class="calibre6">df</tt>.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos526726" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 5-1. Data selection by label</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Selection </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Return Data Type </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Example </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Single value </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Scalar </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.loc[1000, "country"]</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">One column (1d) </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Series </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.loc[:, "country"]</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">One column (2d) </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.loc[:, ["country"]]</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Multiple columns </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.loc[:, ["country", "age"]]</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Range of columns </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.loc[:, "name":"country"]</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">One row (1d) </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Series </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.loc[1000, :]</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">One row (2d) </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.loc[[1000], :]</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Multiple rows </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.loc[[1003, 1000], :]</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Range of rows </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.loc[1000:1002, :]</tt></span></p></td></tr></table><blockquote class="calibre_25"><span class="bold"><span class="calibre_29">LABEL SLICING HAS CLOSED INTERVALS</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">Using slice notation with labels is inconsistent with respect to how everything else in Python and pandas works: they </span><a id="filepos531987"/><span class="calibre5"><span class="italic">include</span></span><span class="calibre5"> the upper end.</span></blockquote><p class="calibre_16">Applying our knowledge from <a href="#filepos526726"><span class="calibre_7">Table 5-1</span></a>, let’s use <tt class="calibre6">loc</tt> to select scalars, Series, and DataFrames:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">18</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Using scalars for both row and column selection returns a scalar</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1001</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[18]: 'Mark'</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">19</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Using a scalar on either the row or column selection returns a Series</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1001</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1002</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[19]: user_id<br class="calibre1"/>         1001    55<br class="calibre1"/>         1002    41<br class="calibre1"/>         Name: age, dtype: int64</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">20</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Selecting multiple rows and columns returns a DataFrame</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1002</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[20]: properties  name country<br class="calibre1"/>         user_id<br class="calibre1"/>         1001        Mark   Italy<br class="calibre1"/>         1000        John     USA<br class="calibre1"/>         1002         Tim     USA</tt></span></blockquote><p class="calibre_32">It’s <a id="filepos536695"/>important for you to understand the difference between a DataFrame with one or more columns and a Series: even with a single column, DataFrames are two-dimensional, while Series are one-dimensional. Both DataFrame and Series have an index, but only the DataFrame has column headers. When you select a column as Series, the column header becomes the name of the Series. Many functions or methods will work on both Series and DataFrame, but when you perform arithmetic calculations, the behavior differs: with DataFrames, pandas aligns the data according to the column headers—more about that a little later in this chapter.</p><blockquote class="calibre_25"><span class="bold"><span class="calibre_26">SHORTCUT FOR COLUMN SELECTION</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">Since selecting columns is such a common operation, pandas offers a shortcut. Instead of:</span><a id="filepos537621"/></blockquote><blockquote class="calibre_46"><blockquote class="calibre_19"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">column_selection</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote></blockquote><blockquote class="calibre_31"><span class="calibre5">you can write:</span></blockquote><blockquote class="calibre_46"><blockquote class="calibre_19"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">column_selection</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote></blockquote><blockquote class="calibre_31"><span class="calibre5">For example, </span><span class="calibre5"><tt class="calibre6">df["country"]</tt></span><span class="calibre5"> returns a Series from our sample DataFrame and </span><span class="calibre5"><tt class="calibre6">df[["name", "country"]]</tt></span><span class="calibre5"> returns a DataFrame with two columns.</span><a id="filepos538911"/></blockquote><p class="calibre_16"><span class="bold"><span class="calibre_5">Selecting by position</span></span></p><p class="calibre_6">Selecting<a id="filepos539083"/> a subset of a DataFrame by position corresponds to what we did at the beginning of this chapter with NumPy arrays. With DataFrames, however, you have to use the <tt class="calibre6">iloc</tt> attribute, which stands for <span class="italic">integer location</span>:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">iloc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">row_selection</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">column_selection</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><p class="calibre_32">When using slices, you deal with the standard half-open intervals. <a href="#filepos540243"><span class="calibre_7">Table 5-2</span></a> gives you the same cases we looked at previously in <a href="#filepos526726"><span class="calibre_7">Table 5-1</span></a>.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos540243" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 5-2. Data selection by position</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Selection </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Return Data Type </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Example </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Single value </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Scalar </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.iloc[1, 2]</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">One column (1d) </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Series </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.iloc[:, 2]</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">One column (2d) </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.iloc[:, [2]]</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Multiple columns </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.iloc[:, [2, 1]]</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Range of columns </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.iloc[:, :3]</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">One row (1d) </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Series </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.iloc[1, :]</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">One row (2d) </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.iloc[[1], :]</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Multiple rows </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.iloc[[3, 1], :]</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Range of rows </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">DataFrame </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.iloc[1:3, :]</tt></span></p></td></tr></table><p class="calibre_17">Here is how you use <tt class="calibre6">iloc</tt>—again with the same samples that we used with <tt class="calibre6">loc</tt> before:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">21</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">iloc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Returns a Scalar</span></span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[21]: 'Mark'</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">22</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">iloc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Returns a Series</span></span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[22]: user_id<br class="calibre1"/>         1001    55<br class="calibre1"/>         1002    41<br class="calibre1"/>         Name: age, dtype: int64</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">23</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">iloc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Returns a DataFrame</span></span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[23]: properties  name country<br class="calibre1"/>         user_id<br class="calibre1"/>         1001        Mark   Italy<br class="calibre1"/>         1000        John     USA<br class="calibre1"/>         1002         Tim     USA</tt></span></blockquote><p class="calibre_32">Selecting data by label or position <a id="filepos549467"/>is not the only means to access a subset of your DataFrame. Another important way is to use boolean indexing; let’s see how it works!</p><p id="filepos549613" class="calibre_20"><span class="bold"><span class="calibre_5">Selecting by boolean indexing</span></span></p><p class="calibre_6">Boolean indexing<a id="filepos549780"/> refers to selecting subsets of a DataFrame with the help of a Series or a DataFrame whose data consists of only <tt class="calibre6">True</tt> or <tt class="calibre6">False</tt>. Boolean Series are used to select specific columns and rows of a DataFrame, while boolean DataFrames are used to select specific values across a whole DataFrame. Most commonly, you will use boolean indexing to filter the rows of a DataFrame. Think of it as the AutoFilter functionality in Excel. For example, this is how you filter your DataFrame so it only shows people who live in the USA and are older than 40 years:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">24</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">tf</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">&gt;</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">40</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">&amp;</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">==</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"USA"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">tf</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># This is a Series with only True/False</span></span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[24]: user_id<br class="calibre1"/>         1001    False<br class="calibre1"/>         1000    False<br class="calibre1"/>         1002     True<br class="calibre1"/>         1003    False<br class="calibre1"/>         dtype: bool</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">25</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">tf</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[25]: properties name  age country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1002        Tim   41     USA    3.9   America</tt></span></blockquote><p class="calibre_32">There are two things I need to explain here. First, due to technical limitations, you can’t use Python’s boolean operators from <a href="index_split_010.html#filepos178328"><span class="calibre_7">Chapter 3</span></a> with DataFrames. Instead, you need to use the symbols as <a id="filepos554159"/>shown in <a href="#filepos554254"><span class="calibre_7">Table 5-3</span></a>.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos554254" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 5-3. Boolean operators</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Basic Python Data Types </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> DataFrames and Series </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">and</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">&amp;</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">or</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">|</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">not</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">~</tt></span></p></td></tr></table><p class="calibre_17">Second, if you have more than one condition, make sure to put every boolean expression in between parentheses so <a id="filepos555852"/>operator precedence doesn’t get in your way: for example, <tt class="calibre6">&amp;</tt> has higher operator precedence than <tt class="calibre6">==</tt>. Therefore, without parentheses, the expression from the sample would be interpreted as:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">&gt;</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">40</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">&amp;</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">==</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"USA"</span></tt></span></blockquote><p class="calibre_32">If you want to filter the index, you can refer to it as <tt class="calibre6">df.index</tt>:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">26</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">&gt;</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1001</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[26]: properties   name  age  country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1002          Tim   41      USA    3.9   America<br class="calibre1"/>         1003        Jenny   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">For what you would use <a id="filepos558929"/>the <tt class="calibre6">in</tt> operator with basic Python data structures like lists, use <tt class="calibre6">isin</tt> with a Series. This is how you filter your DataFrame to participants from Italy and Germany:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">27</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">isin</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">([</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Italy"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Germany"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]),</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[27]: properties   name  age  country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001         Mark   55    Italy    4.5    Europe<br class="calibre1"/>         1003        Jenny   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">While you use <tt class="calibre6">loc</tt> to provide a boolean Series, DataFrames offer a special syntax without <tt class="calibre6">loc</tt> to select values given the full DataFrame of booleans:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">boolean_df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><p class="calibre_32">This is especially helpful if you have DataFrames that consist of only numbers. Providing a DataFrame of booleans returns the DataFrame with <tt class="calibre6">NaN</tt> wherever the boolean DataFrame is <tt class="calibre6">False</tt>. Again, a more detailed discussion of <tt class="calibre6">NaN</tt> will follow shortly. Let’s start by creating a new sample DataFrame called <tt class="calibre6">rainfall</tt> that consists of only numbers:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">28</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># This could be the yearly rainfall in millimeters</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">{</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"City 1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">300.1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">100.2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                       </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"City 2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">400.3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">300.4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                       </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"City 3"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1000.5</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1100.6</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]})</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[28]:    City 1  City 2  City 3<br class="calibre1"/>         0   300.1   400.3  1000.5<br class="calibre1"/>         1   100.2   300.4  1100.6</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">29</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">&lt;</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">400</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[29]:    City 1  City 2  City 3<br class="calibre1"/>         0    True   False   False<br class="calibre1"/>         1    True    True   False</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">30</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">&lt;</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">400</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[30]:    City 1  City 2  City 3<br class="calibre1"/>         0   300.1     NaN     NaN<br class="calibre1"/>         1   100.2   300.4     NaN</tt></span></blockquote><p class="calibre_32">Note that in this example, I have used a dictionary to construct a new DataFrame—this is often convenient if the data already exists in that form. Working with booleans in this way is most commonly used to filter out specific values such as<a id="filepos567453"/> outliers.</p><p class="calibre_6">To wrap up the data selection part, I will introduce a special type of index called the MultiIndex.</p><p class="calibre_20"><span class="bold"><span class="calibre_5">Selecting by using a MultiIndex</span></span></p><p class="calibre_6">A <span class="italic">MultiIndex</span> is<a id="filepos567793"/> an index with more than one level. It allows you to hierarchically group your data and gives you easy access to subsets. For example, if you set the index of our sample DataFrame <tt class="calibre6">df</tt> to a combination of <tt class="calibre6">continent</tt> and <tt class="calibre6">country</tt>, you can easily select all rows with a certain continent:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">31</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># A MultiIndex needs to be sorted</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df_multi</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">reset_index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">set_index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">([</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"continent"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df_multi</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df_multi</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sort_index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df_multi</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[31]: properties         user_id   name  age  score<br class="calibre1"/>         continent country<br class="calibre1"/>         America   USA         1000   John   33    6.7<br class="calibre1"/>                   USA         1002    Tim   41    3.9<br class="calibre1"/>         Europe    Germany     1003  Jenny   12    9.0<br class="calibre1"/>                   Italy       1001   Mark   55    4.5</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">32</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df_multi</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Europe"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[32]: properties  user_id   name  age  score<br class="calibre1"/>         country<br class="calibre1"/>         Germany        1003  Jenny   12    9.0<br class="calibre1"/>         Italy          1001   Mark   55    4.5</tt></span></blockquote><p class="calibre_32">Note that pandas prettifies the output of a MultiIndex by not repeating the leftmost index level (the continents) for each row. Instead, it only prints the continent when it changes. Selecting over multiple index levels is done by providing a tuple:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">33</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df_multi</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Europe"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Italy"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">),</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[33]: properties         user_id  name  age  score<br class="calibre1"/>         continent country<br class="calibre1"/>         Europe    Italy       1001  Mark   55    4.5</tt></span></blockquote><p class="calibre_32">If you want to selectively<a id="filepos573635"/> reset part of a MultiIndex, provide the level as an argument. Zero is the first column from the left:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">34</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df_multi</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">reset_index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">level</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[34]: properties continent  user_id   name  age  score<br class="calibre1"/>         country<br class="calibre1"/>         USA          America     1000   John   33    6.7<br class="calibre1"/>         USA          America     1002    Tim   41    3.9<br class="calibre1"/>         Germany       Europe     1003  Jenny   12    9.0<br class="calibre1"/>         Italy         Europe     1001   Mark   55    4.5</tt></span></blockquote><p class="calibre_32">While we won’t manually create a MultiIndex in this book, there are certain operations like <tt class="calibre6">groupby</tt>, which will cause pandas to return a DataFrame with a MultiIndex, so it’s good to know what it is. We will meet <tt class="calibre6">groupby</tt> later in this chapter.</p><p class="calibre_6">Now that you know various <a id="filepos575571"/>ways to <span class="italic">select</span> data, it’s time to learn how you <span class="italic">change</span> data.</p><p id="filepos575658" class="calibre_17"><span class="calibre3"><span class="bold">Setting Data</span></span></p><p class="calibre_6">The<a id="filepos575788"/> easiest way to change the data of a DataFrame is by assigning values to certain elements using the <tt class="calibre6">loc</tt> or <tt class="calibre6">iloc</tt> attributes. This is the starting point of this section before we turn to other ways of manipulating existing DataFrames: replacing values and adding new columns.</p><p class="calibre_20"><span class="bold"><span class="calibre_5">Setting data by label or position</span></span></p><p class="calibre_6">As<a id="filepos576247"/> pointed out earlier in this chapter, when you call DataFrame methods like <tt class="calibre6">df.reset_index()</tt>, the method will always be applied to a copy, leaving the original DataFrame untouched. However, assigning values via <a id="filepos576473"/>the <tt class="calibre6">loc</tt> and <tt class="calibre6">iloc</tt> attributes changes the original DataFrame. Since I want to leave our DataFrame <tt class="calibre6">df</tt> untouched, I am working with a copy here that I am calling <tt class="calibre6">df2</tt>. If you want to change a single value, do the following:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">35</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Copy the DataFrame first to leave the original untouched</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">copy</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">36</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1000</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"JOHN"</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[36]: properties   name  age  country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001         Mark   55    Italy    4.5    Europe<br class="calibre1"/>         1000         JOHN   33      USA    6.7   America<br class="calibre1"/>         1002          Tim   41      USA    3.9   America<br class="calibre1"/>         1003        Jenny   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">You can also change multiple values at the same time. One way to change the score of the users with ID 1000 and 1001 is to use a list:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">37</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1000</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1001</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"score"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[37]: properties   name  age  country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001         Mark   55    Italy    4.0    Europe<br class="calibre1"/>         1000         JOHN   33      USA    3.0   America<br class="calibre1"/>         1002          Tim   41      USA    3.9   America<br class="calibre1"/>         1003        Jenny   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">Changing data by position via<a id="filepos581974"/>
<tt class="calibre6">iloc</tt> works the same way. Let’s now move on to see how you change the data by using boolean indexing.</p><p class="calibre_20"><span class="bold"><span class="calibre_5">Setting data by boolean indexing</span></span></p><p class="calibre_6">Boolean <a id="filepos582259"/>indexing, which we used to filter rows, can also be used to assign values in a DataFrame. Imagine that you need to anonymize all names of people who are below 20 years old or from the USA:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">38</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">tf</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">&lt;</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">20</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">|</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">==</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"USA"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">tf</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"xxx"</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[38]: properties  name  age  country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001        Mark   55    Italy    4.0    Europe<br class="calibre1"/>         1000         xxx   33      USA    3.0   America<br class="calibre1"/>         1002         xxx   41      USA    3.9   America<br class="calibre1"/>         1003         xxx   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">Sometimes, you have a dataset where you need to replace certain values across the board, i.e., not specific to certain columns. In that case, make use of the special syntax again and provide the whole DataFrame with booleans like this (the sample makes use again of the <tt class="calibre6">rainfall</tt> DataFrame):</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">39</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Copy the DataFrame first to leave the original untouched</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall2</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">copy</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[39]:    City 1  City 2  City 3<br class="calibre1"/>         0   300.1   400.3  1000.5<br class="calibre1"/>         1   100.2   300.4  1100.6</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">40</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Set the values to 0 wherever they are below 400</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall2</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">&lt;</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">400</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[40]:    City 1  City 2  City 3<br class="calibre1"/>         0     0.0   400.3  1000.5<br class="calibre1"/>         1     0.0     0.0  1100.6</tt></span></blockquote><p class="calibre_32">If you just want to replace a value with another one, there is an easier way to do it, as I will show you<a id="filepos589159"/> next.</p><p class="calibre_20"><span class="bold"><span class="calibre_5">Setting data by replacing values</span></span></p><p class="calibre_6">If<a id="filepos589332"/> you want to replace a certain value across your entire DataFrame or selected columns, use <a id="filepos589430"/>the <tt class="calibre6">replace</tt> method:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">41</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">replace</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"USA"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"U.S."</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[41]: properties  name  age  country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001        Mark   55    Italy    4.0    Europe<br class="calibre1"/>         1000         xxx   33     U.S.    3.0   America<br class="calibre1"/>         1002         xxx   41     U.S.    3.9   America<br class="calibre1"/>         1003         xxx   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">If, instead, you only wanted to act on the <tt class="calibre6">country</tt> column, you could use this syntax instead:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">replace</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">({</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">{</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"USA"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"U.S."</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">}})</span></tt></span></blockquote><p class="calibre_32">In this case, since <tt class="calibre6">USA</tt> only turns up in the <tt class="calibre6">country</tt> column, it yields the same result as the previous sample. To wrap this section up, let’s see how you can add additional columns to a DataFrame.</p><p class="calibre_20"><span class="bold"><span class="calibre_5">Setting data by adding a new column</span></span></p><p class="calibre_6">To <a id="filepos592331"/>add a new column to a DataFrame, assign values to a new column name. For example, you could add a new column to a DataFrame by using a scalar or list:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">42</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"discount"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"price"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">49.9</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">49.9</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">99.9</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">99.9</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[42]: properties  name  age  country  score continent  discount  price<br class="calibre1"/>         user_id<br class="calibre1"/>         1001        Mark   55    Italy    4.0    Europe         0   49.9<br class="calibre1"/>         1000         xxx   33      USA    3.0   America         0   49.9<br class="calibre1"/>         1002         xxx   41      USA    3.9   America         0   99.9<br class="calibre1"/>         1003         xxx   12  Germany    9.0    Europe         0   99.9</tt></span></blockquote><p class="calibre_32">Adding a new column often involves vectorized calculations:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">43</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">copy</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Let's start with a fresh copy</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"birth year"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2021</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">-</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[43]: properties   name  age  country  score continent  birth year<br class="calibre1"/>         user_id<br class="calibre1"/>         1001         Mark   55    Italy    4.5    Europe        1966<br class="calibre1"/>         1000         John   33      USA    6.7   America        1988<br class="calibre1"/>         1002          Tim   41      USA    3.9   America        1980<br class="calibre1"/>         1003        Jenny   12  Germany    9.0    Europe        2009</tt></span></blockquote><p class="calibre_32">I will show you more about calculating with DataFrames in a moment, but before we get there, do you remember that I have used <tt class="calibre6">NaN</tt> a few times already? The next section will finally give you more context around the topic of missing<a id="filepos598654"/> data.</p><p id="filepos598671" class="calibre_17"><span class="calibre3"><span class="bold">Missing Data</span></span></p><p class="calibre_6">Missing data<a id="filepos598810"/> can be a problem as it has the potential to bias the results of your data analysis, thereby making your conclusions less robust. Nevertheless, it’s very common to have gaps in your datasets that you will have to deal with. In Excel, you usually have to deal with empty cells or <tt class="calibre6">#N/A</tt> errors, but pandas uses NumPy’s <tt class="calibre6">np.nan</tt> for missing data, displayed as <tt class="calibre6">NaN</tt>. <tt class="calibre6">NaN</tt> is the floating-point standard for <span class="italic">Not-a-Number</span>. For timestamps, <tt class="calibre6">pd.NaT</tt> is used instead, and for text, pandas uses <tt class="calibre6">None</tt>. Using <tt class="calibre6">None</tt> or <tt class="calibre6">np.nan</tt>, you can introduce missing values:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">44</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">copy</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Let's start with a fresh copy</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1000</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"score"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">None</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1003</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">None</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[44]: properties  name   age country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001        Mark  55.0   Italy    4.5    Europe<br class="calibre1"/>         1000        John  33.0     USA    NaN   America<br class="calibre1"/>         1002         Tim  41.0     USA    3.9   America<br class="calibre1"/>         1003        None   NaN    None    NaN      None</tt></span></blockquote><p class="calibre_32">To clean a DataFrame, you often want to<a id="filepos602631"/> remove rows with missing data. This is as simple as:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">45</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">dropna</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[45]: properties  name   age country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001        Mark  55.0   Italy    4.5    Europe<br class="calibre1"/>         1002         Tim  41.0     USA    3.9   America</tt></span></blockquote><p class="calibre_32">If, however, you only want to remove rows where <span class="italic">all</span> values are missing, use the <tt class="calibre6">how</tt> parameter:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">46</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">dropna</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">how</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"all"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[46]: properties  name   age country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001        Mark  55.0   Italy    4.5    Europe<br class="calibre1"/>         1000        John  33.0     USA    NaN   America<br class="calibre1"/>         1002         Tim  41.0     USA    3.9   America</tt></span></blockquote><p class="calibre_32">To get a boolean DataFrame or Series depending on whether there is <tt class="calibre6">NaN</tt> or not, <a id="filepos605310"/>use <tt class="calibre6">isna</tt>:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">47</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">isna</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[47]: properties   name    age  country  score  continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001        False  False    False  False      False<br class="calibre1"/>         1000        False  False    False   True      False<br class="calibre1"/>         1002        False  False    False  False      False<br class="calibre1"/>         1003         True   True     True   True       True</tt></span></blockquote><p class="calibre_32">To fill missing values, <a id="filepos606608"/>use <tt class="calibre6">fillna</tt>. For example, to replace <tt class="calibre6">NaN</tt> in the score column with its mean (I will introduce descriptive statistics like <tt class="calibre6">mean</tt> shortly):</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">48</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">fillna</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">({</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"score"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"score"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">mean</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()})</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[48]: properties  name   age country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001        Mark  55.0   Italy    4.5    Europe<br class="calibre1"/>         1000        John  33.0     USA    4.2   America<br class="calibre1"/>         1002         Tim  41.0     USA    3.9   America<br class="calibre1"/>         1003        None   NaN    None    4.2      None</tt></span></blockquote><p class="calibre_32">Missing data <a id="filepos608614"/>isn’t the only condition that requires us to clean our dataset. The same is true for duplicate data, so let’s see what our options are!</p><p id="filepos608764" class="calibre_17"><span class="calibre3"><span class="bold">Duplicate Data</span></span></p><p class="calibre_6">Like<a id="filepos608897"/> missing data, duplicates negatively impact the reliability of your analysis. To get rid of duplicate rows, use<a id="filepos609015"/> the <tt class="calibre6">drop_duplicates</tt> method. Optionally, you can provide a subset of the columns as argument:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">49</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">drop_duplicates</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">([</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"continent"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[49]: properties   name  age  country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1001         Mark   55    Italy    4.5    Europe<br class="calibre1"/>         1000         John   33      USA    6.7   America<br class="calibre1"/>         1003        Jenny   12  Germany    9.0    Europe</tt></span></blockquote><p class="calibre_32">By default, this will leave the first occurrence. To find out if a certain column contains duplicates or to get its unique values, use the following two commands (use <tt class="calibre6">df.index</tt> instead of <tt class="calibre6">df["country"]</tt> if you wanted to run this on the index instead):</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">50</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">is_unique</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[50]: False</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">51</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">unique</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[51]: array(['Italy', 'USA', 'Germany'], dtype=object)</tt></span></blockquote><p class="calibre_32">And finally, to understand which rows are duplicates, use<a id="filepos612773"/> the <tt class="calibre6">duplicated</tt> method, which returns a boolean Series: by default, it uses the parameter <tt class="calibre6">keep="first"</tt>, which keeps the first occurrence and marks only duplicates with <tt class="calibre6">True</tt>. By setting the parameter <tt class="calibre6">keep=False</tt>, it will return <tt class="calibre6">True</tt> for all rows, including its first occurrence, making it easy to get a DataFrame with all duplicate rows. In the following example, we look at the <tt class="calibre6">country</tt> column for duplicates, but in reality, you often look at the index or entire rows. In this case, you’d have to use <tt class="calibre6">df.index.duplicated()</tt> or <tt class="calibre6">df.duplicated()</tt> instead:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">52</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># By default, it marks only duplicates as True, i.e.</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># without the first occurrence</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">duplicated</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[52]: user_id<br class="calibre1"/>         1001    False<br class="calibre1"/>         1000    False<br class="calibre1"/>         1002     True<br class="calibre1"/>         1003    False<br class="calibre1"/>         Name: country, dtype: bool</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">53</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># To get all rows where "country" is duplicated, use</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># keep=False</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">duplicated</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">keep</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">False</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">),</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[53]: properties  name  age country  score continent<br class="calibre1"/>         user_id<br class="calibre1"/>         1000        John   33     USA    6.7   America<br class="calibre1"/>         1002         Tim   41     USA    3.9   America</tt></span></blockquote><p class="calibre_32">Once you <a id="filepos617033"/>have cleaned your DataFrames by removing missing and duplicate data, you might want to perform some arithmetic operations—the next section gives you an introduction to how this works.</p><p id="filepos617229" class="calibre_17"><span class="calibre3"><span class="bold">Arithmetic Operations</span></span></p><p class="calibre_6">Like<a id="filepos617369"/> NumPy arrays, DataFrames and Series make use of <a id="filepos617425"/>vectorization. For example, to add a number to every value in the <tt class="calibre6">rainfall</tt> DataFrame, simply do the following:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">54</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[54]:    City 1  City 2  City 3<br class="calibre1"/>         0   300.1   400.3  1000.5<br class="calibre1"/>         1   100.2   300.4  1100.6</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">55</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">+</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">100</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[55]:    City 1  City 2  City 3<br class="calibre1"/>         0   400.1   500.3  1100.5<br class="calibre1"/>         1   200.2   400.4  1200.6</tt></span></blockquote><p class="calibre_32">However, the true power of pandas is its <a id="filepos619204"/>automatic <span class="italic">data alignment</span> mechanism: when you use arithmetic operators with more than one DataFrame, pandas automatically aligns them by their columns and row indices. Let’s create a second DataFrame with some of the same row and column labels. We then build the sum:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">56</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">more_rainfall</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">100</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">200</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">300</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">400</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                      </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                      </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"City 1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"City 4"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">more_rainfall</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[56]:    City 1  City 4<br class="calibre1"/>         1     100     200<br class="calibre1"/>         2     300     400</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">57</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">+</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">more_rainfall</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[57]:    City 1  City 2  City 3  City 4<br class="calibre1"/>         0     NaN     NaN     NaN     NaN<br class="calibre1"/>         1   200.2     NaN     NaN     NaN<br class="calibre1"/>         2     NaN     NaN     NaN     NaN</tt></span></blockquote><p class="calibre_32">The index and columns of the resulting DataFrame are the union of the indices and columns of the two DataFrames: the fields that have a value in both DataFrames show the sum, while the rest of the DataFrame shows <tt class="calibre6">NaN</tt>. This may be something you have to get used to if you come from Excel, where empty cells are automatically turned into zeros when you use them in arithmetic operations. To get the same behavior as in Excel, use the <tt class="calibre6">add</tt> method with a <tt class="calibre6">fill_value</tt> to <a id="filepos624230"/>replace <tt class="calibre6">NaN</tt> values with zeros:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">58</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">add</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">more_rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">fill_value</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[58]:    City 1  City 2  City 3  City 4<br class="calibre1"/>         0   300.1   400.3  1000.5     NaN<br class="calibre1"/>         1   200.2   300.4  1100.6   200.0<br class="calibre1"/>         2   300.0     NaN     NaN   400.0</tt></span></blockquote><p class="calibre_32">This works accordingly for the other arithmetic operators <a id="filepos625775"/>as shown in <a href="#filepos625873"><span class="calibre_7">Table 5-4</span></a>.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos625873" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 5-4. Arithmetic operators</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Operator </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Method </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">*</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">mul</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">+</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">add</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">-</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">sub</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">/</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">div</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">**</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">pow</tt></span></p></td></tr></table><p class="calibre_17">When <a id="filepos628066"/>you have a DataFrame and a Series in your calculation, by default the Series is <a id="filepos628153"/>broadcast along the index:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">59</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># A Series taken from a row</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[59]: City 1     100.2<br class="calibre1"/>         City 2     300.4<br class="calibre1"/>         City 3    1100.6<br class="calibre1"/>         Name: 1, dtype: float64</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">60</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">+</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[60]:    City 1  City 2  City 3<br class="calibre1"/>         0   400.3   700.7  2101.1<br class="calibre1"/>         1   200.4   600.8  2201.2</tt></span></blockquote><p class="calibre_32">Hence, to add a Series column-wise, you need to use the <tt class="calibre6">add</tt> method with an explicit <tt class="calibre6">axis</tt> argument:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">61</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># A Series taken from a column</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"City 2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[61]: 0    400.3<br class="calibre1"/>         1    300.4<br class="calibre1"/>         Name: City 2, dtype: float64</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">62</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">add</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"City 2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">axis</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[62]:    City 1  City 2  City 3<br class="calibre1"/>         0   700.4   800.6  1400.8<br class="calibre1"/>         1   400.6   600.8  1401.0</tt></span></blockquote><p class="calibre_32">While this <a id="filepos633672"/>section is about DataFrames with numbers and how they behave in arithmetic operations, the next section shows your options when it comes to manipulating text in DataFrames.</p><p id="filepos633855" class="calibre_17"><span class="calibre3"><span class="bold">Working with Text Columns</span></span></p><p class="calibre_6">As we<a id="filepos634000"/> have seen at the beginning of this chapter, columns with text or mixed data types have the data type <tt class="calibre6">object</tt>. To perform operations on columns with text strings, use the <tt class="calibre6">str</tt> attribute that gives you access to Python’s string methods. We have already met a few string methods in <a href="index_split_010.html#filepos178328"><span class="calibre_7">Chapter 3</span></a>, but it won’t hurt to have a look at the available methods in the <a href="https://oreil.ly/-e7SC"><span class="calibre_7">Python docs</span></a>. For example, to remove leading and trailing white space, <a id="filepos634575"/>use the <tt class="calibre6">strip</tt> method; to make all first letters capitalized, there is <a id="filepos634661"/>the <tt class="calibre6">capitalize</tt> method. Chaining these together will clean up messy text columns that are often the result of manual data entry:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">63</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Let's create a new DataFrame</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">users</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">" mArk "</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"JOHN  "</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Tim"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">" jenny"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                              </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">users</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[63]:      name<br class="calibre1"/>         0   mArk<br class="calibre1"/>         1  JOHN<br class="calibre1"/>         2     Tim<br class="calibre1"/>         3   jenny</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">64</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">users_cleaned</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">users</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">str</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">strip</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">str</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">capitalize</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">users_cleaned</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[64]: 0     Mark<br class="calibre1"/>         1     John<br class="calibre1"/>         2      Tim<br class="calibre1"/>         3    Jenny<br class="calibre1"/>         Name: name, dtype: object</tt></span></blockquote><p class="calibre_32">Or, to find all names that start with a “J”:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">65</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">users_cleaned</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">str</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">startswith</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"J"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[65]: 0    False<br class="calibre1"/>         1     True<br class="calibre1"/>         2    False<br class="calibre1"/>         3     True<br class="calibre1"/>         Name: name, dtype: bool</tt></span></blockquote><p class="calibre_32">The string methods are easy to use, but sometimes you may need to manipulate a DataFrame in a way that isn’t built-in. In that case, create your own function and apply it to your DataFrame, as the next section shows.</p><p id="filepos640942" class="calibre_17"><span class="calibre3"><span class="bold">Applying a Function</span></span></p><p class="calibre_6">DataFrames <a id="filepos641087"/>offer the <tt class="calibre6">applymap</tt> method, which will apply a function to every individual element, something that is useful if there are no NumPy ufuncs available. For example, there are no ufuncs for <a id="filepos641289"/>string formatting, so we can format every element of a DataFrame like so:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">66</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[66]:    City 1  City 2  City 3<br class="calibre1"/>         0   300.1   400.3  1000.5<br class="calibre1"/>         1   100.2   300.4  1100.6</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">67</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">def</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_62">format_string</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">x</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">):</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>             </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">return</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">f</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"{x:,.2f}"</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">68</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Note that we pass in the function without calling it,</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># i.e., format_string and not format_string()!</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">applymap</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">format_string</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[68]:    City 1  City 2    City 3<br class="calibre1"/>         0  300.10  400.30  1,000.50<br class="calibre1"/>         1  100.20  300.40  1,100.60</tt></span></blockquote><p class="calibre_32">To break this down: the following f-string returns <tt class="calibre6">x</tt> as a string: <tt class="calibre6">f"{x}"</tt>. To add formatting, append a colon to the variable followed by the formatting string <tt class="calibre6">,.2f</tt>. The comma is the thousands separator and <tt class="calibre6">.2f</tt> means <span class="italic">fixed-point notation with two digits following the decimal point</span>. To get more details about how to format strings, please refer to the <a href="https://oreil.ly/NgsG8"><span class="calibre_7">Format Specification Mini-Language</span></a>, which is part of the<a id="filepos645020"/> Python documentation.</p><p class="calibre_6">For this sort of use case, <span class="italic">lambda expressions</span> (see sidebar) are<a id="filepos645164"/> widely used as they allow you to write the same in a single line without having to define a separate function. With lambda expressions, we can rewrite the previous example as the following:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">69</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">applymap</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">lambda</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">x</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">f</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"{x:,.2f}"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[69]:    City 1  City 2    City 3<br class="calibre1"/>         0  300.10  400.30  1,000.50<br class="calibre1"/>         1  100.20  300.40  1,100.60</tt></span></blockquote><blockquote class="calibre_25"><span class="bold">LAMBDA EXPRESSIONS</span></blockquote><blockquote class="calibre_27">Python allows you to define a function in a single line via <span class="italic">lambda expressions</span>. Lambda expressions are anonymous functions, which means that it is a function without a name. Consider this function:</blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">def</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_62">function_name</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">arg1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">arg2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">...</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">):</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>    </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">return</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">return_value</span></tt></span></blockquote><blockquote class="calibre_31">This function can be rewritten as a lambda expression like this:</blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">lambda</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">arg1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">arg2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">...</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">return_value</span></tt></span></blockquote><blockquote class="calibre_31">In essence, you replace <tt class="calibre6">def</tt> with <tt class="calibre6">lambda</tt>, leave away the <tt class="calibre6">return</tt> keyword and the function name, and put everything on one line. As we saw with the <tt class="calibre6">applymap</tt> method, this can be really convenient in this case as we don’t need to define a function for something that’s just being used a single time.</blockquote><p class="calibre_17">I have<a id="filepos649303"/> now mentioned all the important data manipulation methods, but before we move on, it’s important to understand when pandas uses a view of a DataFrame and when it uses a copy.</p><p id="filepos649491" class="calibre_17"><span class="calibre3"><span class="bold">View vs. Copy</span></span></p><p class="calibre_6">You <a id="filepos649623"/>may remember from the previous chapter that slicing NumPy arrays returns a view. With DataFrames, it’s unfortunately more complicated: it isn’t always easily predictable whether <tt class="calibre6">loc</tt> and <tt class="calibre6">iloc</tt> return views or copies, which makes it one of the more confusing topics. Since it’s a big difference whether you are changing the view or a copy of a DataFrame, pandas raises the following warning regularly when it thinks that you are setting the data in an unintended way: <tt class="calibre6">SettingWithCopyWarning</tt>. To circumvent this rather cryptic warning, here is some advice:</p>

<div class="calibre_8"> </div><ul class="calibre_9"><li value="1" class="calibre_13"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">Set values on the original DataFrame, not on a DataFrame that has been sliced off another DataFrame</blockquote></blockquote></blockquote></blockquote></li><li value="2" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">If you want to have an independent DataFrame after slicing, make an explicit copy:</blockquote></blockquote></blockquote></blockquote><blockquote class="calibre_46"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">selection</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"continent"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">copy</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote></blockquote></blockquote></blockquote></li></ul><p class="calibre_32">While things are complicated with <tt class="calibre6">loc</tt> and <tt class="calibre6">iloc</tt>, it’s worth remembering that <span class="italic">all</span> DataFrame methods such as <tt class="calibre6">df.dropna()</tt> or <tt class="calibre6">df.sort_values("column_name")</tt>
<span class="italic">always</span> return a copy.</p><p class="calibre_6">So far, we’ve mostly worked with one DataFrame at a time. The next section shows you various ways to combine multiple DataFrames into one, a very common task for which pandas offers powerful tools.</p><p id="filepos652519" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Combining DataFrames</span></span></span></p><p class="calibre_6">Combining different datasets in Excel can be a cumbersome task and typically involves a lot of <tt class="calibre6">VLOOKUP</tt> formulas. Fortunately, combining DataFrames is one of pandas’ killer features where its data alignment capabilities will make your life really easy, thereby greatly reducing the possibility of introducing errors. Combining and merging DataFrames can be done in various ways; this section looks at just the most common cases using <tt class="calibre6">concat</tt>, <tt class="calibre6">join</tt>, and <tt class="calibre6">merge</tt>. While they have an overlap, each function makes a specific task very simple. I will start with the <tt class="calibre6">concat</tt> function, then explain the different options with <tt class="calibre6">join</tt>, and conclude by introducing <tt class="calibre6">merge</tt>, the most generic function of the three.</p><p id="filepos653446" class="calibre_17"><span class="calibre3"><span class="bold">Concatenating</span></span></p><p class="calibre_6">To <a id="filepos653577"/>simply glue multiple DataFrames together, the <tt class="calibre6">concat</tt> function is your best friend. As you can tell by the name of the function, this process has the technical name <span class="italic">concatenation</span>. By default, <tt class="calibre6">concat</tt> glues DataFrames together along the rows and aligns the columns automatically. In the following example, I create another DataFrame, <tt class="calibre6">more_users</tt>, and attach it to the bottom of our sample DataFrame <tt class="calibre6">df</tt>:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">70</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">15</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"France"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4.1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Becky"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>               </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">44</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Canada"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6.1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Leanne"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">more_users</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                   </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"age"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"score"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"name"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                   </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1000</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1011</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">more_users</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[70]:       age country  score    name<br class="calibre1"/>         1000   15  France    4.1   Becky<br class="calibre1"/>         1011   44  Canada    6.1  Leanne</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">71</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">concat</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">([</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">more_users</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">axis</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">0</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[71]:         name  age  country  score continent<br class="calibre1"/>         1001    Mark   55    Italy    4.5    Europe<br class="calibre1"/>         1000    John   33      USA    6.7   America<br class="calibre1"/>         1002     Tim   41      USA    3.9   America<br class="calibre1"/>         1003   Jenny   12  Germany    9.0    Europe<br class="calibre1"/>         1000   Becky   15   France    4.1       NaN<br class="calibre1"/>         1011  Leanne   44   Canada    6.1       NaN</tt></span></blockquote><p class="calibre_32">Note that you now have duplicate index elements, as <tt class="calibre6">concat</tt> glues the data together on the indicated axis (rows) and only aligns the data on the other one (columns), thereby matching the column names automatically—even if they are not in the same order in the two DataFrames! If you want to glue two DataFrames together along the columns, set <tt class="calibre6">axis=1</tt>:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">72</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>               </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">5</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">more_categories</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"quizzes"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"logins"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                        </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1000</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2000</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">more_categories</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[72]:       quizzes  logins<br class="calibre1"/>         1000        3       4<br class="calibre1"/>         2000        5       6</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">73</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">concat</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">([</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">more_categories</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">axis</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[73]:        name   age  country  score continent  quizzes  logins<br class="calibre1"/>         1000   John  33.0      USA    6.7   America      3.0     4.0<br class="calibre1"/>         1001   Mark  55.0    Italy    4.5    Europe      NaN     NaN<br class="calibre1"/>         1002    Tim  41.0      USA    3.9   America      NaN     NaN<br class="calibre1"/>         1003  Jenny  12.0  Germany    9.0    Europe      NaN     NaN<br class="calibre1"/>         2000    NaN   NaN      NaN    NaN       NaN      5.0     6.0</tt></span></blockquote><p class="calibre_32">The special and very useful feature of <tt class="calibre6">concat</tt> is that it accepts more than two DataFrames. We will use this in the next chapter to make a single DataFrame out of multiple CSV files:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">concat</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">([</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">...</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span></blockquote><p class="calibre_32">On the<a id="filepos667519"/> other hand, <tt class="calibre6">join</tt> and <tt class="calibre6">merge</tt> only work with two DataFrames, as we’ll see next.</p><p id="filepos667627" class="calibre_17"><span class="calibre3"><span class="bold">Joining and Merging</span></span></p><p class="calibre_6">When<a id="filepos667765"/> you <span class="italic">join</span> two DataFrames, you combine the columns of each DataFrame into a new DataFrame while deciding what happens with the rows by relying on set theory. If you have worked with relational databases before, it’s the same concept as the <tt class="calibre6">JOIN</tt> clause in SQL queries. <a href="#filepos668317"><span class="calibre_7">Figure 5-3</span></a> shows how the four join types (that is the inner, left, right, and outer join) work by using two sample DataFrames, <tt class="calibre6">df1</tt> and <tt class="calibre6">df2</tt>.</p><p class="calibre_21"><img src="images/00002.jpg" id="filepos668317" class="calibre_72"/>
</p><p class="calibre_23"><span class="calibre5"><span class="italic"><span class="calibre_15">Figure 5-3. Join types</span></span></span></p><p class="calibre_24">With <tt class="calibre6">join</tt>, pandas uses the indices of both DataFrames to align the rows. An <span class="italic">inner join</span> returns<a id="filepos668671"/> a DataFrame with only those rows where the indices overlap. A <span class="italic">left join</span> takes<a id="filepos668763"/> all the rows from the left DataFrame <tt class="calibre6">df1</tt> and matches the rows from the right DataFrame <tt class="calibre6">df2</tt> on the index. Where <tt class="calibre6">df2</tt> doesn’t have a matching row, pandas will fill in <tt class="calibre6">NaN</tt>. The left join corresponds to the <tt class="calibre6">VLOOKUP</tt> case in Excel. The <span class="italic">right join</span> takes <a id="filepos669071"/>all rows from the right table <tt class="calibre6">df2</tt> and matches them with rows from <tt class="calibre6">df1</tt> on the index. And finally, the <span class="italic">outer join</span>, <a id="filepos669216"/>which is short for <span class="italic">full outer join</span>, takes the union of indices from both DataFrames and matches the values where it can. <a href="#filepos669531"><span class="calibre_7">Table 5-5</span></a> is the equivalent of <a href="#filepos668317"><span class="calibre_7">Figure 5-3</span></a> in text form.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos669531" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 5-5. Join types</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Type </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Description </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">inner</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Only rows whose index exists in both DataFrames </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">left</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">All rows from the left DataFrame, matching rows from the right DataFrame </span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">right</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">All rows from the right DataFrame, matching rows from the left DataFrame </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">outer</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">The union of row indices from both DataFrames </span></p></td></tr></table><p class="calibre_17">Let’s see how this works in practice, bringing the examples from <a href="#filepos668317"><span class="calibre_7">Figure 5-3</span></a> to life:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">74</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df1</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">5</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">6</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                            </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"A"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"B"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df1</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[74]:    A  B<br class="calibre1"/>         0  1  2<br class="calibre1"/>         1  3  4<br class="calibre1"/>         2  5  6</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">75</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">10</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">20</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">30</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">40</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                            </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"C"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"D"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">3</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[75]:     C   D<br class="calibre1"/>         1  10  20<br class="calibre1"/>         3  30  40</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">76</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">join</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">how</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"inner"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[76]:    A  B   C   D<br class="calibre1"/>         1  3  4  10  20</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">77</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">join</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">how</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"left"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[77]:    A  B     C     D<br class="calibre1"/>         0  1  2   NaN   NaN<br class="calibre1"/>         1  3  4  10.0  20.0<br class="calibre1"/>         2  5  6   NaN   NaN</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">78</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">join</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">how</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"right"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[78]:      A    B   C   D<br class="calibre1"/>         1  3.0  4.0  10  20<br class="calibre1"/>         3  NaN  NaN  30  40</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">79</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">join</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">how</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"outer"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[79]:      A    B     C     D<br class="calibre1"/>         0  1.0  2.0   NaN   NaN<br class="calibre1"/>         1  3.0  4.0  10.0  20.0<br class="calibre1"/>         2  5.0  6.0   NaN   NaN<br class="calibre1"/>         3  NaN  NaN  30.0  40.0</tt></span></blockquote><p class="calibre_32">If you want to join on one or more DataFrame columns instead of relying on the index, <a id="filepos682873"/>use <tt class="calibre6">merge</tt> instead of <tt class="calibre6">join</tt>. <tt class="calibre6">merge</tt> accepts the <tt class="calibre6">on</tt> argument to provide one or more columns as <a id="filepos683007"/>the <span class="italic">join condition</span>: these columns, which have to exist on both DataFrames, are used to match the rows:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">80</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Add a column called "category" to both DataFrames</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"category"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"a"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"b"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"c"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"category"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"c"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"b"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">81</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df1</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[81]:    A  B category<br class="calibre1"/>         0  1  2        a<br class="calibre1"/>         1  3  4        b<br class="calibre1"/>         2  5  6        c</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">82</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[82]:     C   D category<br class="calibre1"/>         1  10  20        c<br class="calibre1"/>         3  30  40        b</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">83</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">merge</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">how</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"inner"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">on</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"category"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[83]:    A  B category   C   D<br class="calibre1"/>         0  3  4        b  30  40<br class="calibre1"/>         1  5  6        c  10  20</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">84</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">merge</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">how</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"left"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">on</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"category"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[84]:    A  B category     C     D<br class="calibre1"/>         0  1  2        a   NaN   NaN<br class="calibre1"/>         1  3  4        b  30.0  40.0<br class="calibre1"/>         2  5  6        c  10.0  20.0</tt></span></blockquote><p class="calibre_32">Since <tt class="calibre6">join</tt> and <tt class="calibre6">merge</tt> accept quite a few optional arguments to accommodate more complex scenarios, I invite you to have a look at the <a href="https://oreil.ly/OZ4WV"><span class="calibre_7">official documentation</span></a> to learn more about<a id="filepos690380"/> them.</p><p class="calibre_6">You know now how to manipulate one or more DataFrames, which brings us to the next step in our data analysis journey: making sense of data.</p><p id="filepos690581" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Descriptive Statistics and Data Aggregation</span></span></span></p><p class="calibre_6">One way to make sense of big datasets is to compute a descriptive statistic like the sum or the mean on either the whole dataset or on meaningful subsets. This section starts by looking at how this works with pandas before it introduces two ways to aggregate data into subsets: the <tt class="calibre6">groupby</tt> method and the <tt class="calibre6">pivot_table</tt> function.</p><p id="filepos691116" class="calibre_17"><span class="calibre3"><span class="bold">Descriptive Statistics</span></span></p><p class="calibre_6"><span class="italic">Descriptive statistics</span> allows <a id="filepos691290"/>you to summarize datasets by using quantitative measures. For example, the number of data points is a simple descriptive statistic. Averages like mean, median, or mode are other popular examples. DataFrames and Series allow you to access descriptive statistics conveniently via methods like <tt class="calibre6">sum</tt>, <tt class="calibre6">mean</tt>, and <tt class="calibre6">count</tt>, to name just a few. You will meet many of them throughout this book, and the full list is available via the <a href="https://oreil.ly/t2q9Q"><span class="calibre_7">pandas documentation</span></a>. By default, they return a Series along <tt class="calibre6">axis=0</tt>, which means you get the statistic of the columns:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">85</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[85]:    City 1  City 2  City 3<br class="calibre1"/>         0   300.1   400.3  1000.5<br class="calibre1"/>         1   100.2   300.4  1100.6</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">86</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">mean</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[86]: City 1     200.15<br class="calibre1"/>         City 2     350.35<br class="calibre1"/>         City 3    1050.55<br class="calibre1"/>         dtype: float64</tt></span></blockquote><p class="calibre_32">If you want the statistic per row, provide the <tt class="calibre6">axis</tt> argument:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">87</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rainfall</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">mean</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">axis</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[87]: 0    566.966667<br class="calibre1"/>         1    500.400000<br class="calibre1"/>         dtype: float64</tt></span></blockquote><p class="calibre_32">By default, missing values are not included in descriptive statistics like <tt class="calibre6">sum</tt> or <tt class="calibre6">mean</tt>. This is in line with how Excel treats empty cells, so using Excel’s <tt class="calibre6">AVERAGE</tt> formula on a range with empty cells will give you the same result as the <tt class="calibre6">mean</tt> method applied on a Series with the same numbers and <tt class="calibre6">NaN</tt> values instead of empty cells.</p><p class="calibre_6">Getting a <a id="filepos695190"/>statistic across all rows of a DataFrame is sometimes not good enough and you need more granular information—the mean per category, for example. Let’s see how it’s done!</p><p id="filepos695376" class="calibre_17"><span class="calibre3"><span class="bold">Grouping</span></span></p><p class="calibre_6">Using<a id="filepos695504"/> our sample DataFrame <tt class="calibre6">df</tt> again, let’s find out the average score per continent! To do this, you first group the rows by continent and subsequently apply<a id="filepos695674"/> the <tt class="calibre6">mean</tt> method, which will calculate the mean <span class="italic">per group</span>. All nonnumeric columns are automatically excluded:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">88</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">groupby</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">([</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"continent"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">mean</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[88]: properties   age  score<br class="calibre1"/>         continent<br class="calibre1"/>         America     37.0   5.30<br class="calibre1"/>         Europe      33.5   6.75</tt></span></blockquote><p class="calibre_32">If you include more than one column, the resulting DataFrame will have a hierarchical index—the MultiIndex we met earlier on:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">89</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">groupby</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">([</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"continent"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"country"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">mean</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[89]: properties         age  score<br class="calibre1"/>         continent country<br class="calibre1"/>         America   USA       37    5.3<br class="calibre1"/>         Europe    Germany   12    9.0<br class="calibre1"/>                   Italy     55    4.5</tt></span></blockquote><p class="calibre_32">Instead of <tt class="calibre6">mean</tt>, you can use most of the descriptive statistics that pandas offers and if you want to use your own function, use<a id="filepos698880"/> the <tt class="calibre6">agg</tt> method. For example, here is how you get the difference between the maximum and minimum value per group:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">90</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">groupby</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">([</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"continent"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">agg</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">lambda</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">x</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">x</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">max</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">-</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">x</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">min</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">())</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[90]: properties  age  score<br class="calibre1"/>         continent<br class="calibre1"/>         America       8    2.8<br class="calibre1"/>         Europe       43    4.5</tt></span></blockquote><p class="calibre_32">A popular way to get statistics per group in Excel is to use pivot tables. They introduce a second dimension and are great to look at your data from different perspectives. pandas has a pivot table functionality, too, as we will see next.</p><p id="filepos701398" class="calibre_17"><span class="calibre3"><span class="bold">Pivoting and Melting</span></span></p><p class="calibre_6">If <a id="filepos701536"/>you are using pivot tables in Excel, you will have no trouble applying pandas’ <tt class="calibre6">pivot_table</tt> function, as it works in largely the same way. The data in the following DataFrame is organized similarly to how records are typically stored in a database; each row shows a sales transaction for a specific fruit in a certain region:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">91</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Oranges"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"North"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">12.30</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                 </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Apples"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"South"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">10.55</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                 </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Oranges"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"South"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">22.00</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                 </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Bananas"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"South"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">5.90</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                 </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Bananas"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"North"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">31.30</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                 </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Oranges"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"North"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">13.10</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sales</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                              </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Fruit"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Region"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Revenue"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sales</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[91]:      Fruit Region  Revenue<br class="calibre1"/>         0  Oranges  North    12.30<br class="calibre1"/>         1   Apples  South    10.55<br class="calibre1"/>         2  Oranges  South    22.00<br class="calibre1"/>         3  Bananas  South     5.90<br class="calibre1"/>         4  Bananas  North    31.30<br class="calibre1"/>         5  Oranges  North    13.10</tt></span></blockquote><p class="calibre_32">To create a pivot table, you provide the DataFrame as the first argument to the <tt class="calibre6">pivot_table</tt> function. <tt class="calibre6">index</tt> and <tt class="calibre6">columns</tt> define which column of the DataFrame will become the pivot table’s row and column labels, respectively. <tt class="calibre6">values</tt> are going to be aggregated into the data part of the resulting DataFrame by using <a id="filepos708364"/>the <tt class="calibre6">aggfunc</tt>, a function that can be provided as a string or NumPy ufunc. And finally, <tt class="calibre6">margins</tt> correspond to <tt class="calibre6">Grand Total</tt> in Excel, i.e., if you leave <tt class="calibre6">margins</tt> and <tt class="calibre6">margins_name</tt> away, the <tt class="calibre6">Total</tt> column and row won’t be shown:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">92</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pivot</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pivot_table</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">sales</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Fruit"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Region"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">values</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Revenue"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">aggfunc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"sum"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                                </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">margins</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_58">True</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">margins_name</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Total"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pivot</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[92]: Region   North  South  Total<br class="calibre1"/>         Fruit<br class="calibre1"/>         Apples     NaN  10.55  10.55<br class="calibre1"/>         Bananas   31.3   5.90  37.20<br class="calibre1"/>         Oranges   25.4  22.00  47.40<br class="calibre1"/>         Total     56.7  38.45  95.15</tt></span></blockquote><p class="calibre_32">In summary, pivoting your data means to take the unique values of a column (<tt class="calibre6">Region</tt> in our case) and turn them into the column headers of the pivot table, thereby aggregating the values from another column. This makes it easy to read off summary information across the dimensions of interest. In our pivot table, you instantly see that there were no apples sold in the north region and that in the south region, most revenues come from oranges. If you want to go the other way around and turn the column headers into the values of a single column, use <tt class="calibre6">melt</tt>. In <a id="filepos712684"/>that sense, <tt class="calibre6">melt</tt> is the opposite of the <tt class="calibre6">pivot_table</tt> function:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">93</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">melt</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pivot</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">iloc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">-</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,:</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">-</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">1</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">reset_index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(),</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                 </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">id_vars</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Fruit"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                 </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value_vars</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"North"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"South"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">value_name</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Revenue"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[93]:      Fruit Region  Revenue<br class="calibre1"/>         0   Apples  North      NaN<br class="calibre1"/>         1  Bananas  North    31.30<br class="calibre1"/>         2  Oranges  North    25.40<br class="calibre1"/>         3   Apples  South    10.55<br class="calibre1"/>         4  Bananas  South     5.90<br class="calibre1"/>         5  Oranges  South    22.00</tt></span></blockquote><p class="calibre_32">Here, I am providing our pivot table as the input, but I am using <tt class="calibre6">iloc</tt> to get rid of the total row and column. I also reset the index so that all information is available as regular columns. I then provide <tt class="calibre6">id_vars</tt> to indicate the identifiers and <tt class="calibre6">value_vars</tt> to define which columns I want to “unpivot.” Melting can be useful if you want to prepare the data so it can be stored back to a database that expects it in this format.</p><p class="calibre_6">Working <a id="filepos716422"/>with aggregated statistics helps you understand your data, but nobody likes to read a page full of numbers. To make information easily understandable, nothing works better than creating visualizations, which is our next topic. While Excel uses the<a id="filepos716676"/> term <span class="italic">charts</span>, pandas generally refers to them as <span class="italic">plots</span>. I will use these terms interchangeably in this book.</p><p id="filepos716809" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Plotting</span></span></span></p><p class="calibre_6">Plotting allows <a id="filepos716977"/>you to visualize the findings of your data analysis and may well be the most important step in the whole process. For plotting, we’re going to use two libraries: we start by looking at Matplotlib, pandas’ default plotting library, before we focus on Plotly, a modern plotting library that gives us a more interactive experience in Jupyter notebooks.</p><p id="filepos717341" class="calibre_17"><span class="calibre3"><span class="bold">Matplotlib</span></span></p><p class="calibre_6">Matplotlib is<a id="filepos717479"/> a plotting package that has been around for a long time and is included in the Anaconda distribution. With it, you can generate plots in a variety of formats, including vector graphics for high-quality printing. When you call <a id="filepos717713"/>the <tt class="calibre6">plot</tt> method of a DataFrame, pandas will produce a Matplotlib plot by default.</p><p class="calibre_6">To use Matplotlib in a Jupyter notebook, you need to first run one of two magic commands (see the sidebar <a href="#filepos726690"><span class="calibre_7">“Magic Commands”</span></a>): <tt class="calibre6">%matplotlib inline</tt> or <tt class="calibre6">%matplotlib notebook</tt>. They configure the notebook so that plots can be displayed in the notebook itself. The latter command adds a bit more interactivity, allowing you to change the size or zoom factor of the chart. Let’s get started and create a first plot with pandas and Matplotlib (see <a href="#filepos726089"><span class="calibre_7">Figure 5-4</span></a>):</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">94</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">import</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">numpy</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_35">as</span></span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="bold"><span class="calibre_64">np</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">%</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">matplotlib</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">inline</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Or %matplotlib notebook</span></span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">95</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">DataFrame</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">np</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">random</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">rand</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">4</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">*</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">100000</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                             </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Q1"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Q2"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Q3"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Q4"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">],</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                             </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"East"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"West"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"North"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"South"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">])</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">index</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">name</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Quarters"</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">columns</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">name</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Region"</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[95]: Region            East          West         North         South<br class="calibre1"/>         Quarters<br class="calibre1"/>         Q1        23254.220271  96398.309860  16845.951895  41671.684909<br class="calibre1"/>         Q2        87316.022433  45183.397951  15460.819455  50951.465770<br class="calibre1"/>         Q3        51458.760432   3821.139360  77793.393899  98915.952421<br class="calibre1"/>         Q4        64933.848496   7600.277035  55001.831706  86248.512650</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">96</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span><span class="calibre5"><tt class="calibre6">  </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Shortcut for data.plot.line()</span></span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[96]: &lt;AxesSubplot:xlabel='Quarters'&gt;</tt></span></blockquote><p class="calibre_73"><img src="images/00008.jpg" id="filepos726089" class="calibre_74"/>
</p><p class="calibre_23"><span class="calibre5"><span class="italic"><span class="calibre_15">Figure 5-4. Matplotlib plot</span></span></span></p><p class="calibre_24">Note that in this example, I have used a NumPy array to construct a pandas DataFrame. Providing NumPy arrays allows you to leverage NumPy’s constructors that we met in the last chapter; here, we use NumPy to generate a pandas DataFrame based on pseudorandom numbers. Therefore, when you run the sample on your end, you will get different values.</p><blockquote id="filepos726690" class="calibre_39"><span class="bold">MAGIC COMMANDS</span></blockquote><blockquote class="calibre_27">The <tt class="calibre6">%matplotlib inline</tt> command <a id="filepos726866"/>we used to make Matplotlib work properly with Jupyter notebooks is a <span class="italic">magic command</span>. Magic commands are a set of simple commands that cause a Jupyter notebook cell to behave in a certain way or make cumbersome tasks so easy that it almost feels like magic. You write magic commands in cells like Python code, but they either start with <tt class="calibre6">%%</tt> or <tt class="calibre6">%</tt>. Commands that affect the whole cell start with <tt class="calibre6">%%</tt>, and commands that only affect a single line in a cell start with <tt class="calibre6">%</tt>.</blockquote><blockquote class="calibre_27">We will see more magic commands in the next chapters, but if you want to list all currently available magic commands, run <tt class="calibre6">%lsmagic</tt>, and for a detailed description, run <tt class="calibre6">%magic</tt>.</blockquote><p class="calibre_17">Even if you use the magic command <tt class="calibre6">%matplotlib notebook</tt>, you will probably notice that Matplotlib was originally designed for static plots rather than for an interactive experience <a id="filepos727877"/>on a web page. That’s why we’re going to use Plotly next, a plotting library designed for the web.</p><p id="filepos727990" class="calibre_17"><span class="calibre3"><span class="bold">Plotly</span></span></p><p class="calibre_6">Plotly is<a id="filepos728120"/> a JavaScript-based library and can—since version 4.8.0—be used as a pandas plotting backend with great interactivity: you can easily zoom in, click on the legend to select or deselect a category, and get tooltips with more info about the data point you’re hovering over. Plotly is not included in the Anaconda installation, so if you haven’t <a id="filepos728478"/>installed it yet, do so now by running the following command:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>(base)&gt; </tt></span><span class="calibre5"><tt class="calibre6"><span class="bold">conda install plotly</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/></tt></span></blockquote><p class="calibre_32">Once you run the following cell, the plotting backend of the whole notebook will be set to Plotly and if you would rerun the previous cell, it would also be rendered as a Plotly chart. For Plotly, instead of running a magic command, you just need to set it as backend before being able to plot Figures <a href="#filepos731078"><span class="calibre_7">5-5</span></a> and <a href="#filepos732496"><span class="calibre_7">5-6</span></a>:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">97</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Set the plotting backend to Plotly</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">options</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plotting</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">backend</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"plotly"</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">98</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><p class="calibre_73"><img src="images/00016.jpg" id="filepos731078" class="calibre_75"/>
</p><p class="calibre_23"><span class="calibre5"><span class="italic"><span class="calibre_15">Figure 5-5. Plotly line plot</span></span></span></p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">99</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># Display the same data as bar plot</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>         </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">data</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">plot</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">bar</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">barmode</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"group"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><p class="calibre_73"><img src="images/00021.jpg" id="filepos732496" class="calibre_75"/>
</p><p class="calibre_23"><span class="calibre5"><span class="italic"><span class="calibre_15">Figure 5-6. Plotly bar plot</span></span></span></p><blockquote class="calibre_25"><span class="bold"><span class="calibre_29">DIFFERENCES IN PLOTTING BACKENDS</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">If you use Plotly as plotting backend, you’ll need to check the accepted arguments of the plot methods directly on the Plotly docs. For example, you can take a look at the </span><span class="calibre5"><tt class="calibre6">barmode=group</tt></span><span class="calibre5"> argument in </span><a href="https://oreil.ly/Ekurd"><span class="calibre5"><span class="calibre_7">Plotly’s bar charts documentation</span></span></a><span class="calibre5">.</span></blockquote><p class="calibre_16">pandas and the underlying plotting libraries offer a wealth of chart types and options to format the charts in almost any desired way. It’s also possible to arrange multiple plots into a series of subplots. As an overview, <a href="#filepos733705"><span class="calibre_7">Table 5-6</span></a> shows the available<a id="filepos733673"/> plot types.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos733705" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 5-6. pandas plot types</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Type </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Description </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">line</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Line Chart, default when running  </span><span class="calibre5"><tt class="calibre6">df.plot()</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">bar</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Vertical bar chart </span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">barh</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Horizontal bar chart </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">hist</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Histogram </span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">box</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Box plot </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">kde</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Density plot, can also be used via  </span><span class="calibre5"><tt class="calibre6">density</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">area</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Area chart </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">scatter</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Scatter plot </span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">hexbin</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Hexagonal bin plots </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">pie</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Pie chart </span></p></td></tr></table><p class="calibre_17">On top of that, pandas offers some higher-level plotting tools and techniques that are made up of multiple individual components. For details, <a id="filepos737814"/>see the <a href="https://oreil.ly/FxYg9"><span class="calibre_7">pandas visualization documentation</span></a>.</p><blockquote class="calibre_39"><span class="bold">OTHER PLOTTING LIBRARIES</span></blockquote><blockquote class="calibre_27">The <a id="filepos738084"/>scientific visualization landscape in Python is very active, and besides Matplotlib and Plotly, there are many other high-quality options to choose from that may be the better option for certain use cases:</blockquote><blockquote class="calibre_27"><span class="italic">Seaborn</span></blockquote><blockquote class="calibre_18"><blockquote class="calibre_19"><a href="https://oreil.ly/a3U1t"><span class="calibre_7">Seaborn</span></a> is built on top of Matplotlib. It improves the default style and adds additional plots like heatmaps, which often simplify your work: you can create advanced statistical plots with only a few lines of code.</blockquote><a id="filepos738741"/></blockquote><blockquote class="calibre_1"><span class="italic">Bokeh</span></blockquote><blockquote class="calibre_18"><blockquote class="calibre_19"><a href="https://docs.bokeh.org"><span class="calibre_7">Bokeh</span></a> is similar to Plotly in technology and functionality: it’s based on JavaScript and therefore also works great for interactive charts in Jupyter notebooks. Bokeh is included in Anaconda.</blockquote><a id="filepos739170"/></blockquote><blockquote class="calibre_1"><span class="italic">Altair</span></blockquote><blockquote class="calibre_18"><blockquote class="calibre_19"><a href="https://oreil.ly/t06t7"><span class="calibre_7">Altair</span></a> is a library for statistical visualizations based on the <a href="https://oreil.ly/RN6A7"><span class="calibre_7">Vega project</span></a>. Altair is also JavaScript-based and offers some interactivity like zooming.</blockquote><a id="filepos739626"/></blockquote><blockquote class="calibre_1"><span class="italic">HoloViews</span></blockquote><blockquote class="calibre_18"><blockquote class="calibre_19"><a href="https://holoviews.org"><span class="calibre_7">HoloViews</span></a> is another JavaScript-based package that focuses on making data analysis and visualization easy. With a few lines of code, you can achieve complex statistical plots.</blockquote><a id="filepos740040"/></blockquote><p class="calibre_16">We will create<a id="filepos740115"/> more plots in the next chapter to analyze time series, but before we get there, let’s wrap this chapter up by learning how we can import and export data with pandas!</p><p id="filepos740294" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Importing and Exporting DataFrames</span></span></span></p><p class="calibre_6">So far, <a id="filepos740480"/>we constructed DataFrames from scratch using nested lists, dictionaries, or NumPy arrays. These techniques are important to know, but typically, the data is already available and you simply need to turn it into a DataFrame. To do this, pandas offers various reader functions. But even if you need to access a proprietary system for which pandas doesn’t offer a built-in reader, you often have a Python package to connect to that system, and once you have the data, it’s easy enough to turn it into a DataFrame. In Excel, data import is the type of work you would usually handle with Power Query.</p><p class="calibre_6">After analyzing and changing your dataset, you might want to push the results back into a database or export it to a CSV file or—given the title of the book—present it in an Excel workbook to your manager. To export pandas DataFrames, use one of the exporter methods that DataFrames offer. <a href="#filepos741567"><span class="calibre_7">Table 5-7</span></a> shows an overview of the most common import and export methods.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos741567" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 5-7. Importing and exporting DataFrames</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Data format/system </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Import: pandas (pd) function </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Export: DataFrame (df) method </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">CSV files </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">pd.read_csv</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.to_csv</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">JSON </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">pd.read_json</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.to_json</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">HTML </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">pd.read_html</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.to_html</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Clipboard </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">pd.read_clipboard</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.to_clipboard</tt></span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Excel files </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">pd.read_excel</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.to_excel</tt></span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">SQL Databases </span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">pd.read_sql</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.to_sql</tt></span></p></td></tr></table><p class="calibre_17">We will meet <tt class="calibre6">pd.read_sql</tt> and <tt class="calibre6">pd.to_sql</tt> in <a href="index_split_027.html#filepos1487255"><span class="calibre_7">Chapter 11</span></a>, where we will use them as part of a case study. And since I am going to dedicate the whole of <a href="index_split_019.html#filepos863345"><span class="calibre_7">Chapter 7</span></a> to the topic of reading and writing Excel files with pandas, I will focus on importing and exporting CSV files in this section. Let’s start with exporting an existing DataFrame!</p><p id="filepos745685" class="calibre_17"><span class="calibre3"><span class="bold">Exporting CSV Files</span></span></p><p class="calibre_6">If you <a id="filepos745826"/>need to pass a DataFrame to a colleague who might not use Python or pandas, passing it in the form of a CSV file is usually a good idea: pretty much every program knows how to import them. To export our sample DataFrame <tt class="calibre6">df</tt> to a CSV file, use the <tt class="calibre6">to_csv</tt> method:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">100</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">df</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">to_csv</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"course_participants.csv"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><p class="calibre_32">If you wanted to store the file in a different directory, supply the full path as a raw string, e.g., <tt class="calibre6">r"C:\path\to\desired\location\msft.csv"</tt>.</p><blockquote class="calibre_25"><span class="bold"><span class="calibre_26">USE RAW STRINGS FOR FILE PATHS ON WINDOWS</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">In strings, the backslash is used to escape certain characters. That’s why to work with file paths on Windows, you either need to use double backslashes (</span><a id="filepos747454"/><span class="calibre5"><tt class="calibre6">C:\\path\\to\\file.csv</tt></span><span class="calibre5">) or prefix the string with an </span><span class="calibre5"><tt class="calibre6">r</tt></span><span class="calibre5"> to turn it into a </span><span class="calibre5"><span class="italic">raw string</span></span><span class="calibre5"> that interprets the characters literally. This isn’t an issue on macOS or Linux, as they use forward slashes in paths.</span></blockquote><p class="calibre_16">By providing only the file name as I do, it will produce the file <span class="italic">course_participants.csv</span> in the same directory as the notebook with the following content:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">user_id,name,age,country,score,continent<br class="calibre1"/>1001,Mark,55,Italy,4.5,Europe<br class="calibre1"/>1000,John,33,USA,6.7,America<br class="calibre1"/>1002,Tim,41,USA,3.9,America<br class="calibre1"/>1003,Jenny,12,Germany,9.0,Europe</tt></span></blockquote><p class="calibre_32">Now that you know how to<a id="filepos748395"/> use the <tt class="calibre6">df.to_csv</tt> method, let’s see how importing a CSV file works!</p><p id="filepos748485" class="calibre_17"><span class="calibre3"><span class="bold">Importing CSV Files</span></span></p><p class="calibre_6">Importing<a id="filepos748628"/> a local CSV file is as easy as providing its path to the <tt class="calibre6">read_csv</tt> function. <span class="italic">MSFT.csv</span> is a CSV file that I downloaded from Yahoo! Finance and it contains the daily historical stock prices for Microsoft—you’ll find it in the companion repository, in the <span class="italic">csv</span> folder:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">101</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">msft</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">read_csv</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"csv/MSFT.csv"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><p class="calibre_32">Often, you will need to supply a few more parameters to <tt class="calibre6">read_csv</tt> than just the file name. For example, <tt class="calibre6">sep</tt> allows you to tell pandas what separator or delimiter the CSV file uses in case it isn’t the default comma. We will use a few more parameters in the next chapter, but for the full overview, have a look at the <a href="https://oreil.ly/2GMhW"><span class="calibre_7">pandas documentation</span></a>.</p><p class="calibre_6">Now that we are dealing with big DataFrames with many thousands of rows, typically the first thing is to run <a id="filepos750501"/>the <tt class="calibre6">info</tt> method to get a summary of the DataFrame. Next, you may want to take a peek at the first and last few rows of the DataFrame using the <tt class="calibre6">head</tt> and <tt class="calibre6">tail</tt> methods. These methods return five rows by default, but this can be changed by providing the desired number of rows as an argument. You can also run the <tt class="calibre6">describe</tt> method to get some basic statistics:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">102</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">msft</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">info</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">&lt;class 'pandas.core.frame.DataFrame'&gt;<br class="calibre1"/>RangeIndex: 8622 entries, 0 to 8621<br class="calibre1"/>Data columns (total 7 columns):<br class="calibre1"/> #   Column     Non-Null Count  Dtype<br class="calibre1"/>---  ------     --------------  -----<br class="calibre1"/> 0   Date       8622 non-null   object<br class="calibre1"/> 1   Open       8622 non-null   float64<br class="calibre1"/> 2   High       8622 non-null   float64<br class="calibre1"/> 3   Low        8622 non-null   float64<br class="calibre1"/> 4   Close      8622 non-null   float64<br class="calibre1"/> 5   Adj Close  8622 non-null   float64<br class="calibre1"/> 6   Volume     8622 non-null   int64<br class="calibre1"/>dtypes: float64(5), int64(1), object(1)<br class="calibre1"/>memory usage: 471.6+ KB</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">103</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># I am selecting a few columns because of space issues</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>          </tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># You can also just run: msft.head()</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>          </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">msft</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Date"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Adj Close"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Volume"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">head</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[103]:          Date  Adj Close      Volume<br class="calibre1"/>          0  1986-03-13   0.062205  1031788800<br class="calibre1"/>          1  1986-03-14   0.064427   308160000<br class="calibre1"/>          2  1986-03-17   0.065537   133171200<br class="calibre1"/>          3  1986-03-18   0.063871    67766400<br class="calibre1"/>          4  1986-03-19   0.062760    47894400</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">104</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">msft</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Date"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Adj Close"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Volume"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">tail</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[104]:             Date   Adj Close    Volume<br class="calibre1"/>          8620  2020-05-26  181.570007  36073600<br class="calibre1"/>          8621  2020-05-27  181.809998  39492600</tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">105</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">msft</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Adj Close"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Volume"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">describe</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">()</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[105]:          Adj Close        Volume<br class="calibre1"/>          count  8622.000000  8.622000e+03<br class="calibre1"/>          mean     24.921952  6.030722e+07<br class="calibre1"/>          std      31.838096  3.877805e+07<br class="calibre1"/>          min       0.057762  2.304000e+06<br class="calibre1"/>          25%       2.247503  3.651632e+07<br class="calibre1"/>          50%      18.454313  5.350380e+07<br class="calibre1"/>          75%      25.699224  7.397560e+07<br class="calibre1"/>          max     187.663330  1.031789e+09</tt></span></blockquote><p class="calibre_32"><tt class="calibre6">Adj Close</tt> stands for <span class="italic">adjusted close price</span> and corrects the stock price for corporate actions such as stock splits. <tt class="calibre6">Volume</tt> is the number of stocks that were traded. I have summarized the various <a id="filepos758459"/>DataFrame exploration methods we’ve seen in this chapter in <a href="#filepos758607"><span class="calibre_7">Table 5-8</span></a>.</p><p class="calibre1" style="margin:0pt; border:0pt; height:1em"> </p><table valign="top" id="filepos758607" class="calibre_47"><caption valign="top" class="calibre_48"><span class="italic">Table 5-8. DataFrame exploration methods and attributes</span></caption><tr valign="top" class="calibre_49"><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> DataFrame (df) Method/Attribute </span></span><span class="bold">
</span></th><th valign="top" class="calibre_50"><span class="calibre5"><span class="bold"> Description </span></span><span class="bold">
</span></th></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.info()</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Provides number of data points, index type, dtype, and memory usage. </span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.describe()</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Provides basic statistics including count, mean, std, min, max, and percentiles. </span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.head(n=5)</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Returns the first  </span><span class="calibre5"><span class="italic">n</span></span><span class="calibre5"> rows of the DataFrame.</span></p></td></tr><tr valign="top" class="calibre_52"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.tail(n=5)</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Returns the last  </span><span class="calibre5"><span class="italic">n</span></span><span class="calibre5"> rows of the DataFrame.</span></p></td></tr><tr valign="top" class="calibre_49"><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5"> </span><span class="calibre5"><tt class="calibre6">df.dtypes</tt></span></p></td><td class="calibre_51"><span class="calibre5"> </span><p class="calibre_6"><span class="calibre5">Returns the dtype of each column. </span></p></td></tr></table><p class="calibre_17">The <tt class="calibre6">read_csv</tt> function also accepts a URL instead of a local CSV file. This is how you read the CSV file directly from the companion repo:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">106</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic"><span class="calibre_43"># The line break in the URL is only to make it fit on the page</span></span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>          </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">url</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"https://raw.githubusercontent.com/fzumstein/"</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>                 </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"python-for-excel/1st-edition/csv/MSFT.csv"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>          </tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">msft</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">=</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">pd</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">read_csv</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">url</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><span class="calibre_36">In</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">107</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]:</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">msft</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">loc</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[:,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">[</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Date"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Adj Close"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">,</span></tt></span><span class="calibre5"><tt class="calibre6">
</tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_38">"Volume"</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">]]</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_5">.</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_36">head</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">(</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_37">2</span></tt></span><span class="calibre5"><tt class="calibre6"><span class="calibre_15">)</span></tt></span></blockquote><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6">Out[107]:          Date  Adj Close      Volume<br class="calibre1"/>          0  1986-03-13   0.062205  1031788800<br class="calibre1"/>          1  1986-03-14   0.064427   308160000</tt></span></blockquote><p class="calibre_32">We’ll continue with this dataset and<a id="filepos764876"/> the <tt class="calibre6">read_csv</tt> function in the next chapter about time series, where we will turn the <tt class="calibre6">Date</tt> column into a <tt class="calibre6">DatetimeIndex</tt>.</p><p id="filepos765032" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Conclusion</span></span></span></p><p class="calibre_6">This chapter was packed with new concepts and tools to analyze datasets in pandas. We learned how to load CSV files, how to deal with missing or duplicate data, and how to make use of descriptive statistics. We also saw how easy it is to turn your DataFrames into interactive plots. While it may take a while to digest everything, it probably won’t take long before you will understand the immense power you are gaining by adding pandas to your tool belt. Along the way, we compared pandas to the following Excel functionality:</p><p class="calibre_6"><span class="italic">AutoFilter functionality</span></p><blockquote class="calibre_18"><blockquote class="calibre_19">See <a href="index_split_015.html#filepos549613"><span class="calibre_7">“Selecting by boolean indexing”</span></a>.</blockquote></blockquote><p class="calibre_20"><span class="italic">VLOOKUP formula</span></p><blockquote class="calibre_18"><blockquote class="calibre_19">See <a href="#filepos667627"><span class="calibre_7">“Joining and Merging”</span></a>.</blockquote></blockquote><p class="calibre_20"><span class="italic">Pivot Table</span></p><blockquote class="calibre_18"><blockquote class="calibre_19">See <a href="#filepos701398"><span class="calibre_7">“Pivoting and Melting”</span></a>.</blockquote></blockquote><p class="calibre_20"><span class="italic">Power Query</span></p><blockquote class="calibre_18"><blockquote class="calibre_19">This is a combination of <a href="#filepos740294"><span class="calibre_7">“Importing and Exporting DataFrames”</span></a>, <a href="index_split_015.html#filepos524268"><span class="calibre_7">“Data Manipulation”</span></a>, and <a href="#filepos652519"><span class="calibre_7">“Combining DataFrames”</span></a>.</blockquote></blockquote><p class="calibre_16">The next chapter is about time series analysis, the functionality that led to broad adoption of pandas by the financial industry. Let’s see why this part of pandas has such an edge over Excel!</p><blockquote id="filepos767133" class="calibre_33"><a href="index_split_015.html#filepos498666"><span class="calibre5"><span class="calibre_7">1  </span></span></a><span class="calibre5"> pandas 1.0.0 introduced a dedicated </span><span class="calibre5"><tt class="calibre6">string</tt></span><span class="calibre5"> data type to make some operations easier and more consistent with text. As it is still experimental, I am not going to make use of it in this book.</span></blockquote><div class="mbp_pagebreak" id="calibre_pb_13"/>
</body></html>