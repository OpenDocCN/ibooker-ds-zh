- en: Chapter 8\. Data Cleaning
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第八章 数据清洗
- en: A universal problem when working with data is understanding the completeness
    of your data. Data engineering depends on the ability to clean, process, and visualize
    data. Now that you’re familiar with the basic functionality of and integration
    of data with notebook-based code editors, either locally in a Jupyter Notebook
    or in the cloud with Google Colab, it’s time to learn how to clean your data.
    Data is frequently incomplete (missing), inconsistently formatted, or otherwise
    inaccurate—problems often called *messy data. Data cleaning* is the process of
    addressing these problems and preparing the data for analysis.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 处理数据时的一个通用问题是了解数据的完整性。数据工程依赖于清理、处理和可视化数据的能力。现在你已经熟悉了将数据与基于笔记本的代码编辑器集成的基本功能，无论是在本地使用Jupyter
    Notebook还是在云端使用Google Colab，现在是学习如何清理你的数据的时候了。数据经常是不完整的（缺失），格式不一致，或者其他方面不准确——通常称为*杂乱的数据。数据清洗*是解决这些问题并准备数据进行分析的过程。
- en: In this chapter, we’ll explore some publicly available datasets, finding and
    cleaning up messes with a few packages that you can load into a Colab notebook.
    You’re going to work with NYPD_Complaint_Data_Historic, a dataset from the open
    data portal for New York City, [NYC Open Data](https://oreil.ly/W8sNI), updated
    on July 7, 2021\. I filtered the data for 2020 to make it a little more manageable
    for viewing and manipulating. You can filter the data based on your data question
    and [export it as a CSV file](https://oreil.ly/7J4Kj). This chapter will show
    you how to manage, remove, update, and consolidate data and process it with a
    few useful Python packages. Data analysis is only as accurate as the quality of
    the dataset or database, and this chapter will provide tools to assess and address
    common inconsistencies.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一章中，我们将探索一些公开可用的数据集，使用一些可以加载到Colab笔记本中的包来找到并清理杂乱的数据。你将使用来自纽约市开放数据门户[NYC Open
    Data](https://oreil.ly/W8sNI)，更新于2021年7月7日的NYPD_Complaint_Data_Historic数据集。我筛选了2020年的数据，以便更容易查看和操作。你可以根据你的数据问题筛选数据并[导出为CSV文件](https://oreil.ly/7J4Kj)。本章将向你展示如何管理、删除、更新和
    consoldate 数据，并用一些有用的Python包来处理数据。数据分析的准确性取决于数据集或数据库的质量，这一章将提供工具来评估和解决常见的不一致性问题。
- en: Checking for Missing Data
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检查缺失数据
- en: If you’ve ever participated in a data competition, like those available on [Kaggle](https://www.kaggle.com),
    you may have noticed that the datasets are engineered to help you focus your attention
    on a specific task, such as building a visualization. Often, the data has already
    been cleaned for you. Real life is a little more complicated, and missing data
    is a persistent problem. Let’s see how you can make your data world a little tidier.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你曾经参加过数据竞赛，比如在[Kaggle](https://www.kaggle.com)上提供的那些竞赛，你可能会注意到数据集被设计成帮助你集中注意力解决特定任务，比如构建可视化。通常情况下，数据已经被清理过了。现实生活要复杂一些，缺失数据是一个持续存在的问题。让我们看看你如何让你的数据世界变得更加整洁。
- en: With spreadsheets and tabular data formats, evaluating the shape of your data
    is a straightforward task. A little bit of scrolling can easily reveal rows and/or
    columns that are missing data. When you review datasets for patterns of missing
    data, you are actually evaluating them for *nullity,* or the presence of null
    data (missing values). Geospatial analysis, like analysis in general, often involves
    multiple tables, so it’s important to learn how to identify patterns in the data
    residing between these tabular datasets.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 使用电子表格和表格数据格式，评估数据的形状是一项直截了当的任务。稍微滚动一下就可以轻松地发现缺少数据的行和/或列。当你审查数据集以查找缺失数据的模式时，实际上是在评估它们的*空值*，或者说空数据（缺失值）的存在。地理空间分析，像一般的分析一样，通常涉及多个表格，因此学会如何识别这些表格数据之间的数据模式非常重要。
- en: Uploading to Colab
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 上传至Colab
- en: I am using [Google Colab](https://oreil.ly/J8wam) for this example, but feel
    free to use whatever environment you prefer. Upload the [NYPD Complaint Data Historic](https://oreil.ly/kv3Pe)
    CSV file to your notebook and click the dots next to the filename. This will give
    you the path to include in the notebook ([Figure 8-1](#uploading_a_file_to_colab)).
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 我在这个例子中使用了[Google Colab](https://oreil.ly/J8wam)，但你可以使用任何你喜欢的环境。将[NYPD Complaint
    Data Historic](https://oreil.ly/kv3Pe) CSV文件上传到你的笔记本上，并点击文件名旁边的点。这将为你提供包含在笔记本中的路径（参见[图8-1](#uploading_a_file_to_colab)）。
- en: '![Uploading a file to Colab](assets/pgda_0801.png)'
  id: totrans-8
  prefs: []
  type: TYPE_IMG
  zh: '![上传文件至Colab](assets/pgda_0801.png)'
- en: Figure 8-1\. Uploading a file to Colab
  id: totrans-9
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图8-1 上传文件至Colab
- en: '[Missingno](https://oreil.ly/ps5JI) is a Python library that detects missing
    values in a dataset and visualizes how they are distributed within the dataframe,
    which makes it easier to spot patterns.^([1](ch08.xhtml#ch01fn11)) Missingno has
    NumPy, pandas, SciPy, matplotlib, and seaborn running under the hood, bringing
    familiarity to the underlying code snippets. Install missingno:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '[Missingno](https://oreil.ly/ps5JI)是一个Python库，用于检测数据集中的缺失值，并可视化它们在数据框架中的分布，这样可以更容易地发现模式。^([1](ch08.xhtml#ch01fn11))
    Missingno在底层运行时依赖NumPy、pandas、SciPy、matplotlib和seaborn，这使得底层代码片段更加熟悉。安装missingno：'
- en: '[PRE0]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Depending on the size of your dataset, you can adjust the sample size. Here
    I’ve set the sample to `1000`. Importing the Python library pandas will allow
    you to begin a little data cleaning and preparation along the way:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 根据数据集大小的不同，您可以调整样本大小。这里我设置了样本为 `1000`。导入Python库pandas将帮助您进行一些数据清洗和准备工作：
- en: '[PRE1]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Once you upload the dataset, you will need to review the data dictionary to
    see what the column headings indicate.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您上传数据集，您将需要查看数据字典，了解列标题表示的内容。
- en: The columns listed in our dataframe are shown in [Table 8-1](#data_dictionary_for_the_nypd_complaint).
    CMPLNT_NUM appears to be the key identifier for each row. This is important because
    each row is a record of one incident in the dataset.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我们数据框架中列出的列显示在[表 8-1](#data_dictionary_for_the_nypd_complaint)中。CMPLNT_NUM似乎是每行的关键标识符。这一点很重要，因为每行都是数据集中一个事件的记录。
- en: Table 8-1\. Data dictionary for the NYPD Complaint dataset
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 表8-1\. 纽约市警察局投诉数据集数据字典
- en: '| Field name | Description |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| Field name | 描述 |'
- en: '| --- | --- |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| CMPLNT_NUM | Randomly generated persistent ID for each complaint |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| CMPLNT_NUM | 每个投诉的随机生成的持久标识符 |'
- en: '| CMPLNT_FR_DT | Exact date of occurrence for the reported event (or starting
    date of occurrence, if CMPLNT_TO_DT exists) |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| CMPLNT_FR_DT | 报告事件发生的确切日期（或者如果存在CMPLNT_TO_DT，则为事件开始日期） |'
- en: '| CMPLNT_FR_TM | Exact time of occurrence for the reported event (or starting
    time of occurrence, if CMPLNT_TO_TM exists) |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| CMPLNT_FR_TM | 报告事件发生的确切时间（或者如果存在CMPLNT_TO_TM，则为事件开始时间） |'
- en: '| CMPLNT_TO_DT | Ending date of occurrence for the reported event, if exact
    time of occurrence is unknown |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '| CMPLNT_TO_DT | 如果确切时间不明确，则报告事件结束日期 |'
- en: '| CMPLNT_TO_TM | Ending time of occurrence for the reported event, if exact
    time of occurrence is unknown |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
  zh: '| CMPLNT_TO_TM | 如果确切时间不明确，则报告事件结束时间 |'
- en: '| ADDR_PCT_CD | Precinct in which the incident occurred |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| ADDR_PCT_CD | 发生事件的警区 |'
- en: '| RPT_DT | Date event was reported to police |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| RPT_DT | 向警察报告事件的日期 |'
- en: '| KY_CD | Three-digit offense classification code |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| KY_CD | 三位数的犯罪分类代码 |'
- en: '| OFNS_DESC | Description of offense corresponding with the key code |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| OFNS_DESC | 与关键代码对应的犯罪描述 |'
- en: '| PD_CD | Three-digit internal classification code (more granular than the
    key code) |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| PD_CD | 三位数的内部分类代码（比关键代码更详细） |'
- en: '| PD_DESC | Description of internal classification corresponding with the PD
    code (more granular than the offense description) |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| PD_DESC | 与PD代码对应的内部分类描述（比犯罪描述更详细） |'
- en: '| CRM_ATPT_CPTD_CD | Indicator of whether the crime was successfully completed,
    attempted but failed, or interrupted prematurely |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '| CRM_ATPT_CPTD_CD | 犯罪行为是否成功完成、尝试但失败、或过早中断的指示符 |'
- en: '| LAW_CAT_CD | Level of offense: felony, misdemeanor, or violation |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| LAW_CAT_CD | 犯罪级别：重罪、轻罪或违规行为 |'
- en: '| BORO_NM | Name of the borough in which the incident occurred |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| BORO_NM | 事件发生的市区名称 |'
- en: '| LOC_OF_OCCUR_DESC | Specific location of occurrence in or around the premises:
    inside, opposite of, front of, or rear of |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| LOC_OF_OCCUR_DESC | 发生地点具体描述：内部、相对于、前部或后部 |'
- en: '| PREM_TYP_DESC | Specific description of the premises: grocery store, residence,
    street, etc. |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| PREM_TYP_DESC | 场所的具体描述：杂货店、住宅、街道等 |'
- en: '| JURIS_DESC | Description of the jurisdiction code |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| JURIS_DESC | 管辖区代码的描述 |'
- en: '| JURISDICTION_CODE | Jurisdiction responsible for the incident: either internal,
    like Police (0), Transit (1), and Housing (2), or external (3), like Correction,
    Port Authority, etc. |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| JURISDICTION_CODE | 事件责任管辖区：可以是内部机构，如警察（0）、运输（1）和住房（2），也可以是外部（3），如矫正局、港务局等。
    |'
- en: '| PARKS_NM | Name of New York City park, playground, or greenspace of occurrence,
    if applicable (state parks are not included) |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| PARKS_NM | 如果适用，纽约市公园、游乐场或绿地发生事件的名称（不包括州立公园） |'
- en: '| HADEVELOPT | Name of New York City Housing Authority housing development
    of occurrence, if applicable |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| HADEVELOPT | 如果适用，纽约市住房管理局发生事件的住房开发项目名称 |'
- en: '| HOUSING_PSA | Development-level code |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| HOUSING_PSA | 发展级别代码 |'
- en: '| X_COORD_CD | *x*-coordinate for New York State Plane Coordinate System, Long
    Island Zone, NAD 83, units feet (FIPS 3104) |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| X_COORD_CD | 纽约州平面坐标系统的*x*坐标，长岛区，NAD 83，单位为英尺（FIPS 3104） |'
- en: '| Y_COORD_CD | *y*-coordinate for New York State Plane Coordinate System, Long
    Island Zone, NAD 83, units feet (FIPS 3104) |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| Y_COORD_CD | 纽约州平面坐标系统的*y*坐标，长岛区，NAD 83，单位为英尺（FIPS 3104） |'
- en: '| SUSP_AGE_GROUP | Suspect’s age group |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| SUSP_AGE_GROUP | 嫌疑人年龄组 |'
- en: '| SUSP_RACE | Suspect’s race description |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| SUSP_RACE | 嫌疑人种族描述 |'
- en: '| SUSP_SEX | Suspect’s sex description |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| SUSP_SEX | 嫌疑人性别描述 |'
- en: '| TRANSIT_DISTRICT | Transit district in which the offense occurred |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| TRANSIT_DISTRICT | 事件发生的运输区 |'
- en: '| Latitude | Midblock latitude coordinate for Global Coordinate System, WGS
    1984, decimal degrees (EPSG 4326) |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| Latitude | 全球坐标系统的中部纬度坐标，WGS 1984，十进制度数（EPSG 4326） |'
- en: '| Longitude | Midblock longitude coordinate for Global Coordinate System, WGS
    1984, decimal degrees (EPSG 4326) |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '| Longitude | 全球坐标系统的中部经度坐标，WGS 1984，十进制度数（EPSG 4326） |'
- en: '| Lat_Lon | Geospatial location point (latitude and longitude combined) |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| Lat_Lon | 地理空间位置点（纬度和经度的组合） |'
- en: '| PATROL_BORO | The name of the patrol borough in which the incident occurred
    |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '| PATROL_BORO | 事件发生的巡逻区名称 |'
- en: '| STATION_NAME | Transit station name |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '| STATION_NAME | 运输站名称 |'
- en: '| VIC_AGE_GROUP | Victim’s age group |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '| VIC_AGE_GROUP | 受害人年龄组 |'
- en: '| VIC_RACE | Victim’s race description |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '| VIC_RACE | 受害人种族描述 |'
- en: '| VIC_SEX | Victim’s sex description |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
  zh: '| VIC_SEX | 受害人性别描述 |'
- en: The variables in a dataset need to be called exactly as they are presented in
    the dataframe. If they are all capitalized or separated by underscores, you need
    to be sure to copy them (or you can rename them similarly to how you renamed the
    columns in the census data in [Chapter 7](ch07.xhtml#geopandas_and_spatial_statistics)).
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 数据集中的变量需要确切地按照数据框中呈现的方式命名。如果它们全部大写或用下划线分隔，您需要确保复制它们（或者可以类似地重命名它们，就像您在[第7章](ch07.xhtml#geopandas_and_spatial_statistics)中重命名人口普查数据列一样）。
- en: Next, there are other considerations to examine in a dataset.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，还有其他需要在数据集中考虑的问题。
- en: Nulls and Non-Nulls
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 空值和非空值
- en: You’ll first need to examine the dataset for missing values. Start by quickly
    reviewing the data with pandas features such as `NYPD.info()` and `NYPD.describe()`
    (see Figures [8-2](#dataframe_summary_of_nypddotinfoleft_pa) and [8-4](#the_dfdotdescribeleft_parenthesisright)).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 您首先需要检查数据集中的缺失值。通过使用像`NYPD.info()`和`NYPD.describe()`这样的pandas功能快速查看数据（参见图表[8-2](#dataframe_summary_of_nypddotinfoleft_pa)和[8-4](#the_dfdotdescribeleft_parenthesisright)）。
- en: 'Using `.info()` can show you column names, the number of non-nulls, and data
    types (`Dtype`):'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`.info()`可以显示列名、非空值数和数据类型（`Dtype`）：
- en: '[PRE2]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The range index in this dataset is 1,115 entries; therefore, any columns with
    fewer than 1,115 values are missing data. The column non-null count allows you
    to view missing data and decide which columns have not captured enough data to
    provide insights.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个数据集中，范围索引有1115条记录；因此，任何具有少于1115个值的列都存在缺失数据。列的非空计数可以帮助您查看缺失的数据，并决定哪些列未捕捉到足够的数据以提供洞察。
- en: This dataset’s [documentation](https://oreil.ly/nhqvO) states that the null
    values are likely attributable to changes in department forms and to data being
    collected inconsistently. In addition, if information was unavailable for 2020
    (the year I selected to filter the data) or was unknown at the point of collection,
    it was classified as Unknown/Not Available/Not Reported. It is important to read
    the supporting documentation to discover the limits of the data, which might in
    turn limit the questions you can usefully ask.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 该数据集的[文档](https://oreil.ly/nhqvO)指出，空值可能归因于部门表格的变更和数据收集的不一致性。此外，如果2020年（我选择用来过滤数据的年份）的信息不可用或在收集时不明确，则将其分类为未知/不可用/未报告。重要的是要阅读支持文档，以了解数据的限制，这可能会限制您能够有用地提出的问题。
- en: Data Types
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据类型
- en: One of your top priorities in data cleaning should be examining the data type
    of each column in your dataset. The most common data types, which you should definitely
    be familiar with, are [boolean, integer, float, object, and datetime](https://oreil.ly/WLzh0).
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 数据清洗中的首要任务之一应该是检查数据集中每一列的数据类型。最常见的数据类型包括[布尔值、整数、浮点数、对象和日期时间](https://oreil.ly/WLzh0)，您应该对这些类型非常熟悉。
- en: 'The most problematic of these data types is the object. Python objects can
    include a wide variety of data types. Most often they are strings, but you should
    know that they can also include integers, floats, lists, and dictionaries. In
    the pandas library, different data types are detected and classified as NaN (the
    default marker for “not a number”) or NaT for missing datetimes. The output of
    `NYPD.info` includes the data type (`Dtype`), or you can use the `dtypes` DataFrame
    attribute by appending it with a dot: `NYPD.dtypes`.'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 这些数据类型中最棘手的是对象。Python对象可以包含各种数据类型。它们通常是字符串，但您应该知道它们还可以包括整数、浮点数、列表和字典。在pandas库中，不同的数据类型被检测并分类为NaN（默认标记为“不是数字”）或NaT表示缺少日期时间数据。`NYPD.info`的输出包括数据类型（`Dtype`），或者您可以使用`dtypes`
    DataFrame属性，通过在其后添加点号来使用`NYPD.dtypes`。
- en: Metadata
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 元数据
- en: 'You can also return information about the shape of the data. This, along with
    the data type information, is what we call *metadata*, or data about your data.
    To see the shape of the NYPD data, run:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以返回有关数据形状的信息。这与数据类型信息一起被称为*元数据*，或者称为数据的数据。要查看NYPD数据的形状，请运行：
- en: '[PRE3]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'For simplicity in this example, I filtered the data at the source to include
    only 2020 data so that we are working with a smaller number of records: 1,115
    entries ([Figure 8-2](#dataframe_summary_of_nypddotinfoleft_pa)).'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 简化起见，在此示例中，我在源数据中筛选了仅包含2020年数据，以便我们处理较少的记录：1,115条记录（图[8-2](#dataframe_summary_of_nypddotinfoleft_pa)）。
- en: '![Dataframe summary of NYPD.info()](assets/pgda_0802.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![NYPD.info()的数据框摘要](assets/pgda_0802.png)'
- en: Figure 8-2\. Dataframe summary of `NYPD.info()`
  id: totrans-70
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图8-2\. `NYPD.info()`的数据框摘要
- en: 'The exact time of each complaint’s occurrence, or CMPLNT_FR_TM, is listed as
    an object or string in [Figure 8-2](#dataframe_summary_of_nypddotinfoleft_pa).
    Pandas will often guess the type of data in a column when a datetime or other
    data type is assigned as a string or object. This is often complicated by defaults
    such as the `low_memory=True` argument. Large files are “chunked,” and the file
    often generates columns with multiple dtypes. I would resist simply switching
    arguments to `False`, however. It is much more efficient to simply change the
    `dtype` manually, as shown in the following code cell:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 每次投诉发生的确切时间，或者CMPLNT_FR_TM，在图[8-2](#dataframe_summary_of_nypddotinfoleft_pa)中列出为对象或字符串。当datetime或其他数据类型被分配为字符串或对象时，Pandas通常会猜测列中的数据类型。这通常会由于`low_memory=True`等默认设置而变得复杂。大文件会被“分块”，并且该文件通常会生成包含多个数据类型的列。我建议您不要简单地将参数切换为`False`。手动更改`dtype`更为高效，如下面的代码单元格所示：
- en: '[PRE4]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '`NYPD.head()` will update the columns you retain and confirm that your “dropped”
    columns no longer appear in the dataframe.'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '`NYPD.head()`将更新您保留的列，并确认您的“删除”列不再显示在数据帧中。'
- en: You can eliminate columns with incomplete data if they are not relevant to what
    you are interested in exploring. However, I strongly discourage you from *deleting*
    data. Often, the reason for some data being missing is as compelling or significant
    as the data selected for inclusion.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 如果不与您感兴趣的探索相关，您可以删除具有不完整数据的列。但我强烈建议您不要*删除*数据。通常，数据缺失的原因和选择包含的数据一样引人注目或重要。
- en: Let’s try this out by identifying a few sample columns to drop from the dataframe.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过识别几个样本列来尝试这个功能从数据帧中删除。
- en: Summary Statistics
  id: totrans-76
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要统计
- en: You can examine *summary statistics*, or statistics that summarize your sample
    data, using `.describe()`.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用`.describe()`查看*摘要统计*，或者汇总您的样本数据的统计信息。
- en: Look at row counts for another opportunity to identify missing data of the different
    features in the dataframe. In the output of `df.describe()`, the NaN values are
    excluded so that you can see the actual distribution of the data as well as the
    count of values in each column.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 查看行计数是识别数据帧中不同特征缺失数据的另一个机会。在`df.describe()`的输出中，排除了NaN值，因此您可以看到数据的实际分布以及每列中值的计数。
- en: Measures of Central Tendency
  id: totrans-79
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 中心趋势测量
- en: A normal distribution is when the mean, mode, and median are all the same value.
    A *probability* distribution, or *measure of central tendency*, describes the
    central value in a distribution when the distribution is not normal, as shown
    in [Figure 8-3](#a_review_of_measures_of_central_tendenc).
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 正态分布是指平均值、众数和中位数都是相同的值。*概率*分布或*中心趋势测量*描述了分布中的中心值，当分布不正常时，如图[8-3](#a_review_of_measures_of_central_tendenc)所示。
- en: '![A review of measures of central tendency](assets/pgda_0803.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![中心趋势测量回顾](assets/pgda_0803.png)'
- en: Figure 8-3\. A review of measures of central tendency
  id: totrans-82
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 8-3\. 中心趋势测量的回顾
- en: There are also certain measures that can indicate the presence of skewed distributions
    and outliers. [Figure 8-4](#the_dfdotdescribeleft_parenthesisright) is a snapshot
    of [Energy and Water Data Disclosure for Local Law 84 2021 (Data for Calendar
    Year 2020)](https://oreil.ly/vOcv7), a large dataset that examines energy and
    water usage in private buildings in New York City. The median or second quartile
    (Q2), the 50% measure in the table, indicates the *median value*, the point at
    which half the values are above and half the values are below.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 还有一些指标可以表明数据分布的偏斜程度和异常值的存在。 [图 8-4](#the_dfdotdescribeleft_parenthesisright)
    是[2021年能源和水数据披露法律84号（2020年日历年数据）](https://oreil.ly/vOcv7)的一个快照，这是一份详细考察纽约市私人建筑物能源和水使用情况的大型数据集。表中的中位数或第二四分位数（Q2），即表中的50%指标，表示*中位数值*，即一半数值在其上方，一半数值在其下方。
- en: '![The df.describe() function provides descriptive statistics for columns with
    numerical data](assets/pgda_0804.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![df.describe() 函数提供了数值数据列的描述性统计信息](assets/pgda_0804.png)'
- en: Figure 8-4\. The `df.describe()` function provides descriptive statistics for
    columns with numerical data
  id: totrans-85
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 8-4\. `df.describe()` 函数提供了数值数据列的描述性统计信息。
- en: A quick way to look at the shape of your data is to observe where the Q2, or
    median, is located. If you look at the second column in [Figure 8-4](#the_dfdotdescribeleft_parenthesisright),
    you can determine if the value of the median is closer to 25% or 75%. If it is
    closer to 25% or Q1, the data is right-skewed, meaning that 25% of the values
    are below the value for Q1\. Think of Q1 as values between the minimum value and
    the median. The Q3 value is between the median and the maximum values, indicating
    that 75% of the reported values will be below the Q3\. This will result in data
    with a left skew.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 快速查看数据形状的一种方法是观察Q2或中位数的位置。如果查看 [图 8-4](#the_dfdotdescribeleft_parenthesisright)
    中的第二列，您可以确定中位数的值更接近25%还是75%。如果更接近25%或Q1，则数据右偏，意味着有25%的值低于Q1值。将Q1视为最小值和中位数之间的值。Q3的值位于中位数和最大值之间，指示75%的报告值将低于Q3。这将导致数据具有左偏。
- en: 'You can have a quick view of the numeric values in your dataset with a `df.describe()`
    function.  Enter the code snippet into your notebook to view below:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过 `df.describe()` 函数快速查看数据集中的数值值。将以下代码段输入到您的笔记本中以查看：
- en: '[PRE5]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Plotting a histogram makes it easier to visualize the shape of the data. There
    is a right-sided tail, or positive skew, as shown in [Figure 8-5](#visualization_of_distribution_of_the_da).
    This indicates that the mean is greater than the median, which is greater than
    the mode.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 绘制直方图有助于更好地可视化数据的形状。如 [图 8-5](#visualization_of_distribution_of_the_da) 所示，存在右偏尾或正偏态。这表明均值大于中位数，中位数大于众数。
- en: '![Visualization of distribution of the data](assets/pgda_0805.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![数据分布的可视化](assets/pgda_0805.png)'
- en: Figure 8-5\. Visualization of distribution of the data
  id: totrans-91
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 8-5\. 数据分布的可视化
- en: 'Let’s return to the NYPD data. We can visualize the data and see its distribution:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回到NYPD数据。我们可以可视化数据并查看其分布：
- en: '[PRE6]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The visualization also indicates a rightward skew of the data in the distribution
    of complaint types ([Figure 8-5](#visualization_of_distribution_of_the_da)).
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 可视化还显示了投诉类型数据的右偏分布（见 [图 8-5](#visualization_of_distribution_of_the_da)）。
- en: '[Figure 8-6](#nypddotisnaleft_parenthesisright_parent) is simply a tally of
    how many values are missing in each column. Knowing when records are missing before
    analyzing data provides a level of transparency, and it’s critical to communicate
    that information when you share your data visualizations.'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 8-6](#nypddotisnaleft_parenthesisright_parent) 简单统计了数据集中每一列缺失的数值。在分析数据之前了解记录缺失的时机提供了透明度，并且在分享数据可视化时，传达这些信息至关重要。'
- en: '![NYPD.isna().sum() lists missing values tally for columns in dataset](assets/pgda_0806.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![NYPD.isna().sum() 列出了数据集中每一列的缺失值统计](assets/pgda_0806.png)'
- en: Figure 8-6\. `NYPD.isna().sum()` lists missing values tally for columns in dataset
  id: totrans-97
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 8-6\. `NYPD.isna().sum()` 列出了数据集中每一列的缺失值统计。
- en: '`NYPD.isna()` returns the dataframe with Boolean values indicating missing
    values, as shown in [Figure 8-7](#dataframe_nypddotisnaleft_parenthesisri). In
    computation, Boolean values have only two possible values: `True` and `False`,
    often represented as `1` and `0`. `True` in this case indicates missing data.
    At a glance, you can see where the data is missing.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '`NYPD.isna()` 返回带有布尔值指示缺失值的数据框，如 [图 8-7](#dataframe_nypddotisnaleft_parenthesisri)
    所示。在计算中，布尔值只有两个可能的值：`True` 和 `False`，通常表示为 `1` 和 `0`。在这种情况下，`True` 表示缺失数据。一目了然，您可以看到数据缺失的位置。'
- en: '![Dataframe NYPD.isna()](assets/pgda_0807.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![数据框 NYPD.isna()](assets/pgda_0807.png)'
- en: Figure 8-7\. Dataframe `NYPD.isna()`
  id: totrans-100
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 8-7\. 数据框 `NYPD.isna()`
- en: These are just a few of the options available for exploring a dataframe and
    understanding the scope of the completeness or nullity of the data.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 这些只是探索数据框并了解数据完整性或空值范围的几个选项。
- en: Now that you’ve found your missing data, what should you do next?
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经找到了缺失数据，接下来该怎么办？
- en: Replacing Missing Values
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 替换缺失值
- en: 'An additional reason for examining the dataframe is to review missing values
    and identify how they’re characterized. Once you know how missing values are recorded
    in the table, you can replace them with a variable of your selection, for example
    `NaN`, `unknown`, or another value of interest, using the `na_values` parameter:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 检查数据框的另一个原因是查看缺失值并确定它们的特征。一旦您知道表中如何记录缺失值，您就可以使用 `na_values` 参数将它们替换为您选择的变量，例如
    `NaN`、`unknown` 或其他感兴趣的值：
- en: '[PRE7]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Exploring the dataset often reveals inconsistent reporting of missing values
    in the data tables. The code snippet will query alternative variables, such as
    `?` and `999`.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 探索数据集通常会发现数据表中缺失值报告的不一致性。代码片段将查询替代变量，如 `?` 和 `999`。
- en: Visualizing Data with Missingno
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Missingno 可视化数据
- en: In this section, we’ll work with missingno again. Missingno can convert tabular
    data matrices into B*oolean masks*, so called because *masking* returns data based
    on certain criteria of the underlying manipulated data. The data returns a True/False
    Boolean according to the indicated criteria. In computation, Boolean values have
    only two possible values. Missingno marks cells that contain data as `True` and
    empty cells as `False`. It can visualize these in a *nullity matrix* ([Figure 8-8](#nullity_matrix_for_the_nypd_complaint_d)),
    a chart that uses white spaces to visually represent missing data and reveal patterns.
    Where data is present, it will be shaded.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将再次使用 Missingno。Missingno 可以将表格数据矩阵转换为布尔掩码，因为 *掩码* 基于底层操作数据的某些标准返回数据。数据根据指定标准返回
    True/False 布尔值。在计算中，布尔值只有两个可能的值。Missingno 将包含数据的单元格标记为 `True`，空单元格标记为 `False`。它可以将这些数据可视化为
    *空值矩阵*（[图 8-8](#nullity_matrix_for_the_nypd_complaint_d)），这种图表使用空白空间来直观表示缺失数据并显示模式。数据存在的地方将被阴影化。
- en: '![Nullity matrix for the NYPD Complaint dataset](assets/pgda_0808.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![纽约警察局投诉数据集的空值矩阵](assets/pgda_0808.png)'
- en: Figure 8-8\. Nullity matrix for the NYPD Complaint dataset
  id: totrans-110
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 8-8\. 纽约警察局投诉数据集的空值矩阵
- en: In [Figure 8-8](#nullity_matrix_for_the_nypd_complaint_d), each column represents
    a feature in the data, and each row represents an observation. The sparkline at
    the far right of the matrix shows how much data is missing in each record.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [图 8-8](#nullity_matrix_for_the_nypd_complaint_d) 中，每列代表数据中的一个特征，每行代表一个观察结果。矩阵右侧的小火花线显示了每个记录中缺失数据的量。
- en: 'Do you see any patterns in the missing data here? I notice that the fourth
    and fifth bars, which represent complaint ending dates and times, have the same
    pattern: when one of those two values is missing, the other one is too. You can
    use `msno.bar` to display the same information as a column instead of a simplified
    matrix:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 您在这里看到了任何缺失数据模式吗？我注意到第四和第五栏，即投诉结束日期和时间，具有相同的模式：当这两个值中的一个缺失时，另一个也缺失。您可以使用 `msno.bar`
    将相同信息显示为列，而不是简化的矩阵。
- en: '[PRE8]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The height of the bar equals the nullity, or level of missing data ([Figure 8-9](#nullity_shown_by_column)).
    Taller columns indicate that the value is complete (not missing data) or almost
    complete.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 柱的高度等于空值或缺失数据的级别（[图 8-9](#nullity_shown_by_column)）。较高的柱表示值完整（没有缺失数据）或几乎完整。
- en: '![Nullity shown by column](assets/pgda_0809.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![通过列显示的空值](assets/pgda_0809.png)'
- en: Figure 8-9\. Nullity shown by column
  id: totrans-116
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 8-9\. 通过列显示的空值
- en: Evaluating `msno.heatmap(NYPD)` examines *nullity correlation*, or the absence
    or presence of a variable, and how strongly this affects the presence of the other
    variable. Correlation is measured on a scale from –1 to 1, as shown in [Figure 8-10](#heatmap_of_nullity_data_left_parenthesi).
    *Zero correlation* means that the presence of one variable appears to be unrelated
    to whether another variable is present; a correlation score of 1 means that one
    variable appears whenever the other is present. Negative values indicate *negative
    correlation:* the presence of one variable indicates that the other variable will
    not be present.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 评估 `msno.heatmap(NYPD)` 可以检查 *空值相关性*，即变量的存在或缺失以及这如何强烈地影响另一个变量的存在。相关性的度量范围为 –1
    到 1，如图 8-10 所示。*零相关* 意味着一个变量的存在似乎与另一个变量的存在无关；相关分数为 1 表示一个变量在另一个存在时也存在。负值表示 *负相关*：一个变量的存在意味着另一个变量不会存在。
- en: '![Heatmap of nullity data (NYPD)](assets/pgda_0810.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![空值数据热图（NYPD）](assets/pgda_0810.png)'
- en: Figure 8-10\. Heatmap of nullity data (NYPD)
  id: totrans-119
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 8-10\. 空值数据热图（NYPD）
- en: 'Values that are either always present or never present are not visualized in
    the heatmap. For example, there are two columns—RPT_DT (the date of the report
    to police) and JURIS_DESC (jurisdiction description)—that report no missing data,
    and they are not visualized in the heatmap. Other values that don’t appear to
    be measuring anything might be generated from erroneous data. A closer examination
    of the data might reveal something of interest. Pay attention to values that are
    below 1: the value of –0.3 in [Figure 8-10](#heatmap_of_nullity_data_left_parenthesi),
    for instance, is worth a closer look. For example, a value of less than –1 means
    the correlation is almost 100% negative.'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 始终存在或从不存在的值不会在热图中可视化。例如，有两列——RPT_DT（报告给警察的日期）和 JURIS_DESC（辖区描述）——报告没有缺失数据，它们不会在热图中可视化。其他似乎不测量任何内容的值可能是由错误数据生成的。对数据的更详细检查可能会发现一些有趣的东西。请注意小于
    1 的值：例如，[图 8-10](#heatmap_of_nullity_data_left_parenthesi) 中的 –0.3 值值得更仔细地观察。例如，小于
    –1 的值表示相关性几乎是 100% 的负相关。
- en: '*Dendrograms*, or tree diagrams, are branching diagrams that visually represent
    relationships between different groups. The branches are called *clades*, and
    the terminal ends are called *leaves*. The arrangement of the clades tells us
    which leaves are most similar to one another based on how close together they
    are. The height of the branch points indicates how similar or different they are
    from one another: the greater the height, the greater the difference. The closer
    to 0 the groupings are in the dendrogram, the more closely the presence of nulls
    in one column is related to the presence or absence of nulls in the other columns.'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '*树状图*，或称树状图，是一种分支图，用于直观地表示不同组之间的关系。分支称为 *类群*，末端称为 *叶子*。类群的排列告诉我们哪些叶子最相似，基于它们的接近程度。分支点的高度指示它们之间的相似性或差异性：高度越大，差异性越大。树状图中分组的越接近
    0，表示一列中的空值出现与其他列的空值出现或缺失有更密切的关系。'
- en: The [*scipy.cluster.hierarchy.dendrogram*](https://oreil.ly/3Pxln) composes
    clusters by drawing a U-shaped link that joins clades. The dendrogram’s orientation
    defaults to top-down if there are 50 or fewer columns and to left-right when there
    are more than 50.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '[*scipy.cluster.hierarchy.dendrogram*](https://oreil.ly/3Pxln) 通过绘制连接类群的 U
    形链接来组成聚类。如果列数少于 50，则树状图的方向默认为自上而下；如果列数超过 50，则默认为左右方向。'
- en: In [Figure 8-11](#dendrogram_relationships_in_nypd_datase), the columns denoting
    the race and sex of the suspect (SUSP_RACE and SUSP_SEX) are more similar to each
    other than are the columns denoting suspect age group and transit district (SUSP_AGE_GROUP
    and TRANSIT_DISTRICT).
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在[图 8-11](#dendrogram_relationships_in_nypd_datase) 中，表示嫌疑人种族和性别的列（SUSP_RACE
    和 SUSP_SEX）比表示嫌疑人年龄组和转运区（SUSP_AGE_GROUP 和 TRANSIT_DISTRICT）的列更相似。
- en: '![Dendrogram relationships in NYPD dataset](assets/pgda_0811.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![NYPD 数据集中的树状图关系](assets/pgda_0811.png)'
- en: Figure 8-11\. Dendrogram relationships in NYPD dataset
  id: totrans-125
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 8-11\. NYPD 数据集中的树状图关系
- en: 'To view hierarchical clustering, write the following code snippet into your
    code cell:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看层次聚类，请将以下代码片段写入代码单元格中：
- en: '[PRE9]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Dendrograms are useful when focusing on the distribution of data within the
    dataset. The hierarchical clustering quantitatively estimates the relationship
    of each data point to every other point in the dataset. Cluster distance is on
    the vertical axis, and the distinct data points are shown horizontally. The highest
    level of granularity is at the level of the data sample, and the dendrogram is
    a way to visualize this quickly.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在关注数据集内数据分布时，树形图是非常有用的。层次聚类定量估计每个数据点与数据集中的每个其他点的关系。聚类距离在垂直轴上，不同的数据点水平显示。数据样本的最高粒度在数据样本水平上，树形图是一种快速可视化的方法。
- en: Mapping Patterns
  id: totrans-129
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 映射模式
- en: QGIS is an additional way to view data and look for patterns in the data. The
    data in [Figure 8-12](#visualizing_nypd_filtered_crime_data_on) is filtered to
    show only burglaries in order to help guide additional insights based on location.
    Let’s look at how to generate such a map.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: QGIS 是查看数据和查找数据模式的另一种方式。[图 8-12](#visualizing_nypd_filtered_crime_data_on)中的数据被筛选，仅显示入室盗窃案，以帮助根据位置指导额外洞察。让我们看看如何生成这样的地图。
- en: '![Visualizing NYPD filtered crime data on a map](assets/pgda_0812.png)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![在地图上可视化 NYPD 筛选后的犯罪数据](assets/pgda_0812.png)'
- en: Figure 8-12\. Visualizing NYPD filtered crime data on a map
  id: totrans-132
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 8-12\. 在地图上可视化 NYPD 筛选后的犯罪数据
- en: Latitude and Longitude
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 纬度和经度
- en: 'The dataset has Latitude and Longitude columns. You can convert these to point
    out features, then use GeoPandas to create a map. Let’s use the same file to import
    data and add a shapefile. First, import pandas:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 数据集有纬度和经度列。你可以将它们转换为指出特征的点，然后使用 GeoPandas 创建地图。让我们使用相同的文件导入数据并添加一个 shapefile。首先，导入
    pandas：
- en: '[PRE10]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Next, `read_csv` reads the datafile into your notebook:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，`read_csv` 将数据文件读入你的笔记本：
- en: '[PRE11]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Upload the file directly to Google Colab if that’s what you’re using. You can
    modify the `df` variable to whatever you prefer. The `df.head()` function will
    return the first rows in each column:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是 Google Colab，可以直接上传文件。你可以将 `df` 变量修改为任何你喜欢的内容。`df.head()` 函数将返回每列的前几行：
- en: '[PRE12]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: As a best practice, make sure to capture spellings and capitalizations exactly
    as they appear in your data, and always list longitude before latitude when writing
    code.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 作为最佳实践，请确保精确捕获数据中出现的拼写和大写，编写代码时始终将经度列在纬度列之前。
- en: Shapefiles
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Shapefiles
- en: You will use the Python library [Shapely](https://oreil.ly/KE75Y) for *computational
    geometry,* or working with geometric objects like points, curves, and surfaces.
    When uploading a shapefile, be sure to upload all of the files associated with
    the shapefile (they’ll have the extensions *.dbf*, *.shx*, and *.prj*) into the
    same directory. The shapefile in [Figure 8-13](#nyc_open_data_borough_boundaries)
    is from [NYC Open Data Borough Boundaries](https://oreil.ly/LYjNT).
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 你将使用 Python 库 [Shapely](https://oreil.ly/KE75Y) 进行*计算几何*，或处理诸如点、曲线和曲面等几何对象。上传
    shapefile 时，请确保将与 shapefile 相关的所有文件（它们将具有 *.dbf*、*.shx* 和 *.prj* 扩展名）上传到同一目录中。[图 8-13](#nyc_open_data_borough_boundaries)中的
    shapefile 来自[NYC 开放数据区界](https://oreil.ly/LYjNT)。
- en: '![NYC Open Data borough boundaries](assets/pgda_0813.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![NYC 开放数据区界](assets/pgda_0813.png)'
- en: Figure 8-13\. NYC Open Data borough boundaries
  id: totrans-144
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 8-13\. NYC 开放数据区界
- en: 'First, import your libraries and packages:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，导入你的库和包：
- en: '[PRE13]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Tip
  id: totrans-147
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: Python libraries are often abbreviated in code. You’ve seen that pandas is abbreviated
    as `pd` and GeoPandas as `gpd`. You will notice `plt` used for matplotlib—don’t
    mistake this for part of a function or argument.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: Python 库在代码中通常被缩写。你已经看到 pandas 被缩写为 `pd`，而 GeoPandas 被缩写为 `gpd`。请注意，`plt` 用于
    matplotlib —— 不要误以为它是函数或参数的一部分。
- en: 'Now Python simply needs to know how to apply the coordinates in a defined space—so
    you need to define it:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 现在 Python 只需要知道如何在定义的空间中应用坐标 —— 所以你需要定义它：
- en: '[PRE14]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: GeoPandas is a *Cartesian coordinate reference system,* which means that each
    point is defined by a pair of numerical coordinates, such as latitude and longitude
    in our example. It assigns geographic data to pandas objects. The GeoPandas dataframe
    has been created from defining our CRS and combining our Longitude and Latitude
    columns. The `Point` function in Shapely uses the Longitude and Latitude columns
    to create a new column labeled geometry in [Figure 8-14](#adding_a_new_columncomma_geometry).
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: GeoPandas 是*笛卡尔坐标参考系统*，这意味着每个点由一对数字坐标定义，比如我们示例中的纬度和经度。它将地理数据分配给 pandas 对象。GeoPandas
    数据框从定义我们的 CRS 和组合我们的经度和纬度列而创建。Shapely 中的 `Point` 函数使用经度和纬度列创建一个名为几何的新列，如[图 8-14](#adding_a_new_columncomma_geometry)所示。
- en: '![Adding a new column, geometry](assets/pgda_0814.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![添加新列，几何图形](assets/pgda_0814.png)'
- en: Figure 8-14\. Adding a new column, geometry
  id: totrans-153
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 8-14\. 添加新列，几何图形
- en: 'In the preceding code cell, we defined `geo_df`, and now we can view the newly
    created geometry column:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 在前述代码单元格中，我们定义了`geo_df`，现在我们可以查看新创建的几何列：
- en: '[PRE15]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Here I have enlarged the `figsize` for better visibility, but it will load
    more quickly at a smaller size. The default units are inches, but [conversions
    are available](https://oreil.ly/1PeVm) for centimeters and pixels as well. The
    `street_map` is assigned to the axes as that is where we assigned our shapefile:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 这里我扩大了`figsize`以便更好地查看，但在较小的尺寸下加载速度会更快。默认单位是英寸，但也可以进行[厘米和像素的转换](https://oreil.ly/1PeVm)。`street_map`被分配给轴，因为这是我们分配形状文件的位置：
- en: '[PRE16]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '[Figure 8-15](#geopandas_dataframe_visualized_on_a_map) is a map created from
    a GeoPandas dataframe. You can filter and edit the reported incidents to create
    a more tailored map. (Refer to the [Jupyter Notebook](https://oreil.ly/9ADWy)
    for additional options.) The `plt.xlim` and `plt.ylim` commands let you select
    a specific boundary to further edit your projection.'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 8-15](#geopandas_dataframe_visualized_on_a_map) 是从 GeoPandas 数据框创建的地图。您可以过滤和编辑报告的事件，以创建更具针对性的地图。（参考[Jupyter
    Notebook](https://oreil.ly/9ADWy)获取更多选项。）`plt.xlim` 和 `plt.ylim` 命令可让您选择特定的边界来进一步编辑您的投影。'
- en: 'If you would like to select a type of crime from the dataset, use the `df.loc`
    function to locate all instances. Here is an example showing burglaries:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想从数据集中选择一种犯罪类型，请使用`df.loc`函数来定位所有实例。以下是一个显示入室盗窃的示例：
- en: '[PRE17]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Or perhaps you want to list a few different offenses:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 或者您可能希望列出几种不同的违法行为：
- en: '[PRE18]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Or a combination of parameters:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 或者一组不同的参数：
- en: '[PRE19]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![GeoPandas dataframe visualized on a map of New York City boroughs](assets/pgda_0815.png)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![GeoPandas在纽约市各区地图上可视化的数据框](assets/pgda_0815.png)'
- en: Figure 8-15\. GeoPandas dataframe visualized on a map of New York City boroughs
  id: totrans-166
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 8-15\. GeoPandas 在纽约市各区地图上可视化的数据框
- en: Experiment with asking different questions!
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试提出不同的问题！
- en: Summary
  id: totrans-168
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: You have learned a variety of methods useful for cleaning your data. This is
    important, especially when working with open source data. For example, community-level
    data is often entered manually, and misspellings, missing dates, and the absence
    of geometry variables can limit the utility of these valuable resources.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 您已学习了一系列在清理数据时非常有用的方法。这一点尤为重要，特别是在处理开放源码数据时。例如，社区级别的数据通常是手动输入的，拼写错误、缺少日期和几何变量的缺失可能会限制这些宝贵资源的实用性。
- en: '^([1](ch08.xhtml#ch01fn11-marker)) Bilogur, Aleksey. 2018\. “Missingno: A Missing
    Data Visualization Suite.” *Journal of Open Source Software* 3 (22): 547\. [*https://doi.org/10.21105/joss.00547*](https://doi.org/10.21105/joss.00547)'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: '^([1](ch08.xhtml#ch01fn11-marker)) Bilogur, Aleksey. 2018\. “Missingno: A Missing
    Data Visualization Suite.” *Journal of Open Source Software* 3 (22): 547\. [*https://doi.org/10.21105/joss.00547*](https://doi.org/10.21105/joss.00547)'
