<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 11. Introduction to Moderation"><div class="chapter" id="introduction_to_moderation">
<h1><span class="label">Chapter 11. </span>Introduction to Moderation</h1>

<p>One of the most gratifying aspects of combining the causal and behavioral perspectives is that things that may seem entirely unrelated under one of them can turn out to be the exact same thing under the other. More simply put, when you have the right hammer, a lot of things <em>are indeed nails</em>.</p>

<p>So far, we’ve used causal diagrams to understand what drives behaviors on average: if temperature increases by one degree, keeping all the relevant other variables constant, by how much do sales of ice cream in C-Mart stands increase? But very often, we’re not just interested in that grand average, and we would like to break it down further:<a contenteditable="false" data-primary="moderation analysis" data-secondary="about questions addressed" data-type="indexterm" id="idm45968144536872"/></p>

<ul>
	<li>
	<p>Does that number apply equally to the stands in Texas and Wisconsin? If not, this means our data shows an opportunity for <em>segmentation</em>.<a contenteditable="false" data-primary="segmentation" data-secondary="example" data-type="indexterm" id="idm45968144533816"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="segmentation" data-tertiary="example" data-type="indexterm" id="idm45968144532408"/></p>
	</li>
	<li>
	<p>Does that number apply equally for chocolate and vanilla ice cream? If not, this means that there is an <em>interaction</em> between temperature and ice cream flavor.<a contenteditable="false" data-primary="interactions" data-secondary="example" data-type="indexterm" id="idm45968144529352"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="interactions" data-tertiary="example" data-type="indexterm" id="idm45968144502552"/></p>
	</li>
	<li>
	<p>Does that number apply equally at low and high temperatures? If not, this means that there is a <em>nonlinearity</em> in the effect of temperatures on sales.<a contenteditable="false" data-primary="nonlinearity in effects" data-secondary="example" data-type="indexterm" id="idm45968144499512"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="nonlinearity in effects" data-tertiary="example" data-type="indexterm" id="idm45968144498136"/></p>
	</li>
</ul>

<p>The hammer we’ll see in this chapter is called moderation analysis by social scientists, and it will allow us to address these three types of questions in the exact same way.</p>

<p>In the first section after reviewing the data and packages for this chapter, we’ll do a tour of moderation and see how it can apply to a variety of behavioral situations. Because the math remains the same in all cases, I have gathered all practical and technical considerations to review in the last section.</p>

<section data-type="sect1" data-pdf-bookmark="Data and Packages"><div class="sect1" id="data_and_libraries-id00027">
<h1>Data and Packages</h1>

<p>The <a href="https://oreil.ly/BehavioralDataAnalysisCh11">GitHub folder for this chapter</a> <a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="data and packages" data-type="indexterm" id="idm45968144491960"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="data and packages for example" data-type="indexterm" id="idm45968144490264"/><a contenteditable="false" data-primary="GitHub" data-secondary="moderation analysis data" data-type="indexterm" id="idm45968144488872"/>contains the CSV file <em>chap11-historical_data.csv</em> with the variables listed in <a data-type="xref" href="#variables_in_our_data-id00084">Table 11-1</a>.</p>

<table class="border" id="variables_in_our_data-id00084">
	<caption><span class="label">Table 11-1. </span>Variables in our data</caption>
	<thead>
		<tr>
			<th>Variable name</th>
			<th>Variable description</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td><em>Day</em></td>
			<td>Day index, 1-20</td>
		</tr>
		<tr>
			<td><em>Store</em></td>
			<td>Store index, 1-50</td>
		</tr>
		<tr>
			<td><em>Children</em></td>
			<td>Binary 0/1, whether the customer is accompanied by young children</td>
		</tr>
		<tr>
			<td><em>Age</em></td>
			<td>Customer age, 20-80</td>
		</tr>
		<tr>
			<td><em>VisitDuration</em></td>
			<td>Duration of store visit in minutes, 3-103</td>
		</tr>
		<tr>
			<td><em>PlayArea</em></td>
			<td>Binary 0/1, store level, whether the store has a play area</td>
		</tr>
		<tr>
			<td><em>GroceriesPurchases</em></td>
			<td>Amount spent on groceries purchases during visit in dollars, 0-324</td>
		</tr>
	</tbody>
</table>

<p>In this chapter, we’ll only use the common packages so there are no chapter-specific ones.</p>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Behavioral Varieties of Moderation"><div class="sect1" id="behavioral_varieties_of_moderation">
<h1>Behavioral Varieties of Moderation</h1>

<p>The formal definition of moderation is extremely simple: <a contenteditable="false" data-primary="moderation analysis" data-secondary="definition" data-type="indexterm" id="idm45968144469688"/><a contenteditable="false" data-primary="regression" data-secondary="moderation definition" data-type="indexterm" id="idm45968144468312"/>it’s the inclusion in a regression of a multiplication between two predictors. For example, I suggested earlier that sales of ice cream may increase more or less per degree of temperature in Texas and Wisconsin; this would be expressed mathematically as follows:</p>

<div data-type="equation">
<p><em>IceCreamSales</em> = <em>β<sub>t</sub></em>.<em>Temperature</em> + <em>β<sub>s</sub>.State</em> + <em>β<sub>ts</sub></em>.(<em>Temperature</em> * <em>State</em>)</p>
</div>

<p>Moderation can be used to understand all of the following behavioral phenomena, which we’ll review in turn:</p>

<ul>
	<li>
	<p>Segmentation</p>
	</li>
	<li>
	<p>Interactions</p>
	</li>
	<li>
	<p>Nonlinearities (a.k.a. self-moderation)</p>
	</li>
</ul>

<section class="pagebreak-before" data-type="sect2" data-pdf-bookmark="Segmentation"><div class="sect2" id="segmentation">
<h2 class="less_space">Segmentation</h2>

<p>Building relevant customer segments is a key task in marketing<a contenteditable="false" data-primary="moderation analysis" data-secondary="segmentation" data-tertiary="about" data-type="indexterm" id="idm45968144455160"/><a contenteditable="false" data-primary="segmentation" data-secondary="about" data-type="indexterm" id="idm45968144453432"/> analytics, and more broadly business analytics. We’ll review how to do it with observational data, then with experimental data.</p>

<section data-type="sect3" data-pdf-bookmark="Segmenting observational data"><div class="sect3" id="segmenting_observational_data">
<h3>Segmenting observational data</h3>

<p>Our starting point will be a C-Mart example: <a contenteditable="false" data-primary="moderation analysis" data-secondary="segmentation" data-tertiary="segmenting observational data" data-type="indexterm" id="idm45968144449320"/><a contenteditable="false" data-primary="segmentation" data-secondary="segmenting observational data" data-type="indexterm" id="idm45968144447768"/><a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="segmenting observational data" data-type="indexterm" id="idm45968144446376"/>the company has recently introduced play areas in some of its stores and is interested in understanding how it affected customer visit duration. Regression analysis supported by causal diagrams gives us an average causal effect: across all the customer visits in our data, what is the effect on visit duration of having a play area in the store? However, averages can be misleading and hide large differences between segments of our population. For example, it makes sense to assume that the presence of a play area influences visit duration more for customers with children. How should we account for that in our regression? You might think that simply including <em>Children</em> as another predictor of <em>VisitDuration</em> would do the trick, as in <a data-type="xref" href="#including_children_as_a_predictor_of_vi">Figure 11-1</a>.</p>

<figure><div id="including_children_as_a_predictor_of_vi" class="figure"><img alt="Including Children as a predictor of VisitDuration" src="Images/BEDA_1101.png" width="1157" height="283"/>
<h6><span class="label">Figure 11-1. </span>Including Children as a predictor of VisitDuration</h6>
</div></figure>

<p>The problem with that approach is that it accounts for the impact of <em>Children</em> on <em>VisitDuration</em>, <em>regardless of whether there is a play area or not</em>, and vice versa: when doing a regression, each variable is examined independently. Each coefficient is set such that overall residual distances are minimized, but the coefficients have to be the same for each variable regardless of the values of other variables. That means that the coefficient, and thus the measured effect, of <em>PlayArea</em> on <em>VisitDuration</em> is mathematically forced to be a weighted average of its effect for customers with and without children. Likewise, the effect of customers having children is measured as a weighted average of the effects when there is a play area present and when there is not. This can be confirmed by looking at the corresponding equations. The equation for the CD we just drew is shown in <a data-type="xref" href="#eqtn1">Equation 11-1</a> (including the constant coefficient <em>β</em><sub>0</sub>, which we usually omit for simplicity).</p>

<div class="pagebreak-before less_space" data-type="equation" id="eqtn1">
<h5><span class="label">Equation 11-1. </span> </h5>

<p><em>VisitDuration</em> = <em>β</em><sub>0</sub> + <em>β<sub>p</sub>.PlayArea</em> + <em>β<sub>c</sub>.Children</em></p>
</div>

<p>Because <em>PlayArea</em> and <em>Children</em> are both binary variables, we have four possible cases depending on whether each one of them is equal to 0 or 1:</p>

<ol>
	<li>
	<p><em>β</em><sub>0</sub> is the average visit duration for customers without children in stores without a play area (which we’ll abbreviate as C = 0, P = 0 for brevity).</p>
	</li>
	<li>
	<p><em>β</em><sub>0</sub> + <em>β<sub>c</sub></em> is the average visit duration for customers with children in stores without a play area (C = 1, P = 0).</p>
	</li>
	<li>
	<p><em>β</em><sub>0</sub> + <em>β<sub>p</sub></em> is the average visit duration for customers without children in stores with a play area (C = 0, P = 1).</p>
	</li>
	<li>
	<p><em>β</em><sub>0</sub> + <em>β<sub>p</sub></em> + <em>β<sub>c</sub></em> is the average visit duration for customers with children in stores with a play area (C = 1, P = 1).</p>
	</li>
</ol>

<p>This means that whether a customer has children with them or not doesn’t affect the impact of adding a play area, as we can easily check:</p>

<p>If <em>Children</em> = 0, the impact of adding a play area is:</p>

<div data-type="equation">
<p><em>VisitDuration(C</em> = <sub>0</sub>, <em>P</em> = 1) - <em>VisitDuration(C</em> = 0, <em>P</em> = 0) = (<em>β</em><sub>0</sub> + <em>β<sub>p</sub></em>) - (<em>β</em><sub>0</sub>) = <em>β<sub>p</sub></em></p>
</div>

<p>If <em>Children</em> = 1, the impact of adding a play area is:</p>

<div data-type="equation">
<p><em>VisitDuration(C</em> = 1, <em>P</em> = 1) - <em>VisitDuration(C</em> = 1, <em>P</em> = 0) = (<em>β</em><sub>0</sub> + <em>β<sub>c</sub></em> + <em>β<sub>p</sub></em>) - (<em>β</em><sub>0</sub> + <em>β<sub>c</sub></em>) = <em>β<sub>p</sub></em></p>
</div>

<p>The difference between these two equations (i.e., how much <em>more</em> adding a play area increases visit duration for customers with children compared to customers without children) is by definition:</p>

<div data-type="equation">
<p>[(<em>β</em><sub>0</sub> + <em>β<sub>c</sub></em> + <em>β<sub>p</sub></em>) - (<em>β</em><sub>0</sub>)] - [(<em>β</em><sub>0</sub> + <em>β<sub>p</sub></em>) - (<em>β</em><sub>0</sub>)] = <em>β<sub>p</sub></em> - <em>β<sub>p</sub></em> = 0</p>
</div>

<p>An equivalent way of looking at the problem is that we have four equations, with four corresponding averages, but only three coefficients. Once we have set <em>β</em><sub>0</sub> , <em>β<sub>c</sub></em>, and <em>β<sub>p</sub></em> based on the first three equations, if it so happens that the average visit duration for (C = 1, P =1 ) is not equal to <em>β</em><sub>0</sub> + <em>β<sub>p</sub></em> + <em>β<sub>c</sub></em>, we’re stuck. Our algorithm will do its best to find the values that minimize the error in our regression, but our estimates will be biased. Unfortunately, that’s precisely the case we’re trying to account for! In other words, simply adding <em>Children</em> as a variable in our regression doesn’t account for the interaction between <em>Children</em> and <em>PlayArea</em>. There is no way for us to determine through these equations whether the presence of a play area influences visit duration more for customers with children.</p>

<p>This is where moderation comes in. We can solve our problem by adding a fourth coefficient, for the interaction of <em>PlayArea</em> and <em>Children</em> (shown in <a data-type="xref" href="#eqtn2">Equation 11-2</a>).</p>

<div data-type="equation" id="eqtn2">
<h5><span class="label">Equation 11-2. </span> </h5>

<p><em>VisitDuration</em> = <em>β</em><sub>0</sub> + <em>β<sub>p</sub>.PlayArea</em> + <em>β<sub>c</sub>.Children</em> + <em>β<sub>i</sub>.(PlayArea</em> * <em>Children</em>)</p>
</div>

<p>The equation for (C = 1, P = 1) becomes <em>VisitDuration</em> = <em>β</em><sub>0</sub> + <em>β<sub>p</sub></em> + <em>β<sub>c</sub></em> + <em>β<sub>i</sub></em> and we can adjust the coefficient <em>β<sub>i</sub></em> to account for the interaction effect. Now we have:</p>

<ul>
	<li>
	<p>If <em>Children</em> = 0, the impact of adding a play area is (<em>β</em><sub>0</sub> + <em>β<sub>p</sub></em>) - (<em>β</em><sub>0</sub>) = <em>β<sub>p</sub></em>.</p>
	</li>
	<li>
	<p>If <em>Children</em> = 1, the impact of adding a play area is (<em>β</em><sub>0</sub> + <em>β<sub>c</sub></em> + <em>β<sub>p</sub></em> + <em>β<sub>i</sub></em>) - (<em>β</em><sub>0</sub> + <em>β<sub>c</sub></em>) = <em>β<sub>p</sub></em> + <em>β<sub>i</sub></em>.</p>
	</li>
</ul>

<p>The difference between these two equations is:</p>

<div data-type="equation">
<p>[(<em>β</em><sub>0</sub> + <em>β<sub>c</sub></em> + <em>β<sub>p</sub></em> + <em>β<sub>i</sub></em>) - (<em>β</em><sub>0</sub>)] - [(<em>β</em><sub>0</sub> + <em>β<sub>p</sub></em> + <em>β<sub>i</sub></em>) - (<em>β</em><sub>0</sub>)] = <em>β<sub>p</sub></em> + <em>β<sub>i</sub></em> - <em>β<sub>p</sub></em> = <em>β<sub>i</sub></em></p>
</div>

<p>Adding a play area increases visit duration by <em>β<sub>i</sub></em> minutes <em>more</em> for customers with children than for customers without children.</p>

<p>The multiplication term in <a data-type="xref" href="#eqtn2">Equation 11-2</a> is traditionally represented in a CD by an arrow ending in the middle of the original arrow (<a data-type="xref" href="#the_effect_of_playarea_on_visitduratio">Figure 11-2</a>). In that case, the variable <em>Children</em> is called the <em>moderator</em>, and the relationship between <em>PlayArea</em> and <em>VisitDuration</em> is <em>moderated</em>.</p>

<figure><div id="the_effect_of_playarea_on_visitduratio" class="figure"><img alt="The effect of PlayArea on VisitDuration is moderated by the customers having children with them" src="Images/BEDA_1102.png" width="1052" height="393"/>
<h6><span class="label">Figure 11-2. </span>The effect of PlayArea on VisitDuration is moderated by the customers having children with them</h6>
</div></figure>

<p>Regression software recognizes moderation, and usually includes a shortcut: if you include only the product of two variables, the software will recognize that you want to calculate coefficients for the individual variables as well:<a contenteditable="false" data-primary="Python" data-secondary="moderation analysis" data-tertiary="segmentation" data-type="indexterm" id="idm45968144341416"/><a contenteditable="false" data-primary="R" data-secondary="moderation analysis" data-tertiary="segmentation" data-type="indexterm" id="idm45968144339768"/></p>

<pre data-code-language="python" data-type="programlisting">
<code class="c1">## Python (output not shown)</code>
<code class="n">ols</code><code class="p">(</code><code class="s2">"duration~play_area * children"</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">hist_data_df</code><code class="p">)</code><code class="o">.</code><code class="n">fit</code><code class="p">()</code><code class="o">.</code><code class="n">summary</code><code class="p">()</code></pre>

<pre data-code-language="r" data-type="programlisting">
<code class="c1">## R</code>
<code class="o">&gt;</code> <code class="nf">summary</code><code class="p">(</code><code class="nf">lm</code><code class="p">(</code><code class="n">duration</code><code class="o">~</code><code class="n">play_area</code> <code class="o">*</code> <code class="n">children</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">hist_data</code><code class="p">))</code>
<code class="kc">...</code>
<code class="n">Coefficients</code><code class="o">:</code>
                     <code class="n">Estimate</code> <code class="n">Std.</code> <code class="n">Error</code> <code class="n">t</code> <code class="n">value</code> <code class="nf">Pr</code><code class="p">(</code><code class="o">&gt;|</code><code class="n">t</code><code class="o">|</code><code class="p">)</code>    
<code class="p">(</code><code class="n">Intercept</code><code class="p">)</code>          <code class="m">19.98760</code>    <code class="m">0.01245</code>  <code class="m">1605.5</code>   <code class="o">&lt;</code><code class="m">2e-16</code> <code class="o">***</code>
<code class="n">play_area1</code>            <code class="m">3.95907</code>    <code class="m">0.02097</code>   <code class="m">188.8</code>   <code class="o">&lt;</code><code class="m">2e-16</code> <code class="o">***</code>
<code class="n">children1</code>            <code class="m">10.01527</code>    <code class="m">0.02017</code>   <code class="m">496.6</code>   <code class="o">&lt;</code><code class="m">2e-16</code> <code class="o">***</code>
<code class="n">play_area1</code><code class="o">:</code><code class="n">children1</code> <code class="m">20.98663</code>    <code class="m">0.03343</code>   <code class="m">627.8</code>   <code class="o">&lt;</code><code class="m">2e-16</code> <code class="o">***</code>
<code class="kc">...</code></pre>

<div data-type="note" epub:type="note"><h6>Note</h6>
<p>When you use the shortcut described in the preceding, your software of choice will add <em>PlayArea</em> and <em>Children</em> as individual predictors of <em>VisitDuration</em>, and estimate <a data-type="xref" href="#eqtn2">Equation 11-2</a> as a result. Wouldn’t it be better to estimate instead the equation without <em>Children</em> as a separate term? That is:</p>

<p><em>VisitDuration</em> = <em>β</em><sub>0</sub> + <em>β<sub>p</sub>.PlayArea</em> + <em>β<sub>i</sub>.(PlayArea * Children)</em></p>

<p>Short answer: no. For more details, see reference works such as Hayes (2017), but basically for the coefficients to mean what you want them to, include in your regression the moderator and moderated variables as individual variables too, even if their coefficients are not economically or statistically significant. Don’t override your software to remove them; this is a feature, not a bug.</p>
</div>

<p>The coefficients in this regression match the averages for the four cases we’ve listed:</p>

<ul>
	<li>
	<p>The average visit duration for a customer without children in a store without a play area is <em>β</em><sub>0</sub> , the coefficient for the intercept, i.e., 20 minutes.</p>
	</li>
	<li>
	<p>The average visit duration for a customer without children in a store with a play area is <em>β</em><sub>0</sub> + <em>β<sub>p</sub></em>, the sum of the coefficients for the intercept and <em>PlayArea</em>, i.e., around 20 + 4 = 24 minutes.</p>
	</li>
	<li>
	<p>The average visit duration for a customer with children in a store without a play area is <em>β</em><sub>0</sub> + <em>β<sub>c</sub></em>, the sum of the coefficients for the intercept and <em>Children</em>, i.e., around 20 + 10 = 30 minutes.</p>
	</li>
	<li>
	<p>The average visit duration for a customer with children in a store with a play area is <em>β</em><sub>0</sub> + <em>β<sub>c</sub></em> + <em>β<sub>p</sub></em> + <em>β<sub>i</sub></em>, the sum of the coefficients for the intercept, <em>PlayArea</em>, <span class="keep-together"><em>Children</em></span>, and the interaction term between <em>PlayArea</em> and <em>Children</em>, around 20 + 4 + 10 + 21 = 55 minutes.</p>
	</li>
</ul>

<p>In other words, having a play area has a big impact on the average visit duration of customers with children, and a much smaller but non-negligible impact on the average visit duration of customers without children (the relaxation of shopping tantrum-free, maybe).</p>

<p>This can be represented visually, as in <a data-type="xref" href="#visual_representation_of_moderation">Figure 11-3</a>. The values for the <em>Children</em> variable are on the x-axis, and <em>VisitDuration</em> is on the y-axis, and we have two lines, one for each possible value of <em>PlayArea</em>. In other words, the four points at the extremities of the two lines represent the four cases we just saw, and their y values match the coefficients.</p>

<p>If there was no interaction effect between our two variables, the two lines would be parallel, as having a play area would shift the average visit duration upward by the same increment. The fact that they’re not parallel demonstrates that <em>PlayArea</em> has a bigger impact on customers with children.</p>

<figure><div id="visual_representation_of_moderation" class="figure"><img alt="Visual representation of moderation" src="Images/BEDA_1103.png" width="1887" height="1158"/>
<h6><span class="label">Figure 11-3. </span>Visual representation of moderation</h6>
</div></figure>

<p>If you want to connect this figure back to our math, the distance between the two points on the left (for C = 0) is equal to <em>β<sub>p</sub></em> while the distance between the two points on the right (C = 1) is <em>β<sub>p</sub></em> + <em>β<sub>i</sub></em>.</p>

<p>Insights from moderation analysis allow us to better target our actions, e.g., if C-Mart wants to determine in which stores to build play areas next. While the individual coefficient <em>β<sub>p</sub></em> is relevant to determine if a play area would pay for itself in general, it is completely irrelevant for store prioritization. Choosing between stores requires determining the store and customer characteristics that have the strongest interactions with the <em>PlayArea</em> variable, and then determining which store would yield the highest “lift” from the addition of a play area.</p>

<p>Alternatively, in stores that already have a play area, moderation analysis would allow C-Mart to determine which potential customers to target with a mailing touting the presence of a play area.</p>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Segmenting experimental data"><div class="sect3" id="segmenting_experimental_data">
<h3>Segmenting experimental data</h3>

<p>The process to segment experimental data is pretty much<a contenteditable="false" data-primary="moderation analysis" data-secondary="segmentation" data-tertiary="segmenting experimental data" data-type="indexterm" id="idm45968144178712"/><a contenteditable="false" data-primary="segmentation" data-secondary="segmenting experimental data" data-type="indexterm" id="idm45968144177000"/> identical to the process we just used with observational data. Therefore I will not repeat the quantitative analyses and I’ll just point out some nuances and subtleties to keep in mind.</p>

<p>When running an experiment, we often care not only about measuring the average effect of the treatment in our sample, but also about determining groups for which the effect is particularly strong or weak. Sending a letter or training an employee can be costly; even if financial costs are negligible, as with emails, there might be intangible costs such as annoying a customer. <a contenteditable="false" data-primary="segmentation" data-secondary="personalization" data-type="indexterm" id="idm45968144174456"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="segmentation" data-tertiary="personalization" data-type="indexterm" id="idm45968144173080"/><a contenteditable="false" data-primary="personalized messaging" data-type="indexterm" id="idm45968144171432"/>As a result, we generally want to apply a treatment only to the people for which it works.</p>

<p>Beyond cost considerations, personalization is a key rationale for targeting specific messages or treatments to specific segments of our customer base. The very idea of personalized messaging is that individuals outside of the target segment will not react, or may even react negatively to the message. If you have a message that appeals to everyone, good for you, but that’s not personalization. For example, a coupon for pro ice-skating blades may annoy the vast majority of people who have no use for it. An ad targeting outdoorsy types may antagonize quiet bookworms and vice versa. Personalization means that you’re trading increasing effectiveness on a certain subgroup for decreased effectiveness on another one.</p>

<p>In marketing analytics, this approach is often referred to <a contenteditable="false" data-primary="uplift analysis" data-type="indexterm" id="idm45968144168520"/><a contenteditable="false" data-primary="segmentation" data-secondary="personalization" data-tertiary="uplift analysis" data-type="indexterm" id="idm45968144167416"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="segmentation" data-tertiary="uplift analysis" data-type="indexterm" id="idm45968144165768"/><a contenteditable="false" data-primary="actions" data-secondary="uplift analysis" data-type="indexterm" id="idm45968144164120"/>as “uplift” analysis or modeling, because we’re trying to identify the groups of customers for which a given campaign or treatment increases their propensity to take action the most (e.g., buying or voting), <em>regardless of their initial propensity</em>. That last point is often a source of confusion so it’s worth elaborating: identifying customers with a high propensity can have its uses, but it should not be used as a basis for targeting by itself.</p>

<p>Let’s say you compare younger customers (below 30 years old) and older customers (above 60 years old):</p>

<ul class="pagebreak-before less_space">
	<li>
	<p>The first group has a probability to take action of 20% if they’re not emailed, and 40% if they’re emailed.</p>
	</li>
	<li>
	<p>The second group has a probability to take action of 80% if they’re not emailed, and 90% if they’re emailed.</p>
	</li>
</ul>

<p>Emailing the first group, the younger customers, would be much more effective on average than emailing the second group, the older customers: it would increase by a larger number the total number of customers taking action.</p>

<p>However, that fact can often be obscured in real life by the lack of a proper control group. If you were to email the second group only and compare their behavior with the rest of the population it would dramatically inflate the apparent effectiveness of the email campaign.</p>

<p>Mathematically, identifying a group with <a contenteditable="false" data-primary="demographic variables" data-secondary="high effectiveness of treatment" data-type="indexterm" id="idm45968144156632"/><a contenteditable="false" data-primary="personal characteristics in human behavior" data-secondary="high effectiveness of treatment" data-type="indexterm" id="idm45968144155240"/>a high effectiveness of treatment means finding demographic variables that are moderators of the effect of the treatment variable on the effect of interest. In that sense, moderation analysis offers us a strong and unified conceptual framework to think about uplift analysis, personalization, and more generally targeting.</p>
</div></section>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Interactions"><div class="sect2" id="interactions">
<h2>Interactions</h2>

<p>The CD we drew to represent segmentation was asymmetrical: the variable <em>PlayArea</em> has an arrow going directly to <em>VisitDuration</em>, whereas the variable <em>Children</em> has an arrow going to the first arrow.<a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="interactions" data-type="indexterm" id="idm45968144149816"/><a contenteditable="false" data-primary="interactions" data-secondary="moderation analysis" data-type="indexterm" id="idm45968144148200"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="interactions" data-type="indexterm" id="idm45968144146824"/> However, our regression equation is perfectly symmetrical; nothing indicates which of the two variables is the moderator and which is moderated. Technically speaking, we could interpret <a data-type="xref" href="#eqtn2">Equation 11-2</a> to mean that <em>Children</em> is the cause and <em>PlayArea</em> is the moderator.</p>

<p>Is one of these representations more “right” than the other? When we have an individual characteristic and a business or behavioral variable involved in moderation, as is the case here, we generally represent the individual characteristic (e.g., having children) as the moderator, and refer to it as segmentation. That is, the effect of a play area is different between the segment of customers with children and the segment of customers without children.</p>

<p>On the other hand, if we have moderation between two variables of the same type, such as two individual characteristics or two business interventions, it doesn’t make sense to introduce an asymmetry between them. For example, we may imagine that having a play area and having a lounge area both increase visit duration independently (the play area for customers with children, and the lounge area for customers without children), but having the two together has a bigger effect than the sum of their individual effects, because customers with children can now use the lounge area. In such circumstances, we can represent moderation by joining arrows together as in <a data-type="xref" href="#representing_symmetrical_interactions">Figure 11-4</a>, and refer to it as <em>interaction</em>.</p>

<figure><div id="representing_symmetrical_interactions" class="figure"><img alt="Representing symmetrical interactions" src="Images/BEDA_1104.png" width="1157" height="283"/>
<h6><span class="label">Figure 11-4. </span>Representing symmetrical interactions</h6>
</div></figure>

<p>The equation for this CD would be:</p>

<div data-type="equation">
<p><em>VisitDuration</em> = <em>β</em><sub>0</sub> + <em>β<sub>p</sub>.PlayArea</em> + <em>β<sub>l</sub>.LoungeArea</em> + <em>β<sub>p</sub><sub>l</sub>.(PlayArea * LoungeArea</em>)</p>
</div>

<p>As you can see, the equation is exactly the same as for segmentation, and if we wanted we could call <em>LoungeArea</em> the moderator of the effect of <em>PlayArea</em> on <em>VisitDuration</em> (or vice versa). Conceptually, interactions let us think about situations where “the whole is more than the sum of the parts,” such as complementary behaviors.</p>

<div data-type="note" epub:type="note"><h6>Note</h6>
<p>On a side note, it is my belief that some of the power of newer and more complex<a contenteditable="false" data-primary="interactions" data-secondary="machine learning capturing" data-type="indexterm" id="idm45968144112488"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="interactions" data-tertiary="machine learning capturing" data-type="indexterm" id="idm45968144111000"/> machine learning methods like random forests, XGBoost, or neural networks comes from their ability to capture such interactions. By including interactions in regression, we can reduce the performance gap while preserving the interpretability of causal relationships we have with regression.</p>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Nonlinearities"><div class="sect2" id="nonlinearities-id00056">
<h2>Nonlinearities</h2>

<p>In many circumstances, the relationship between a cause and an effect is not linear.<a contenteditable="false" data-primary="nonlinearity in effects" data-secondary="about" data-type="indexterm" id="idm45968144106584"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="nonlinearity in effects" data-tertiary="about" data-type="indexterm" id="idm45968144105208"/> It may have what economists call “decreasing returns”: you get less and less bang for your buck. For example, a satisfied customer might buy more than an unsatisfied one, but an ecstatic customer might not buy that much more than a happy one. Sending one marketing email per month to a customer might increase purchases, but sending 11 emails instead of 10 probably doesn’t help much, as in the left panel of <a data-type="xref" href="#nonlinear_relationships_between_variabl">Figure 11-5</a>.</p>

<p>Conversely, a causal relationship may have increasing returns, such as the network effects touted by start-ups: the more properties AirCnC has on its website, the more customers it will attract; but then the wider its customer base, the higher the incentive for owners to offer their property on its website, and so on, as in the right panel of <a data-type="xref" href="#nonlinear_relationships_between_variabl">Figure 11-5</a>.</p>

<figure><div id="nonlinear_relationships_between_variabl" class="figure"><img alt="Nonlinear relationships between variables: left is decreasing returns while right is increasing returns" src="Images/BEDA_1105.png" width="1906" height="1166"/>
<h6><span class="label">Figure 11-5. </span>Nonlinear relationships between variables: left is decreasing returns while right is increasing returns</h6>
</div></figure>

<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Mathematically, the curve on the left is concave, and the curve on the right is convex. <a contenteditable="false" data-primary="linear regression" data-secondary="nonlinear relationships via" data-type="indexterm" id="idm45968144096600"/><a contenteditable="false" data-primary="nonlinearity in effects" data-secondary="linear regression representing" data-type="indexterm" id="idm45968144095304"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="nonlinearity in effects" data-tertiary="linear regression representing" data-type="indexterm" id="idm45968144093912"/><a contenteditable="false" data-primary="effects nonlinear" data-see="nonlinearity in effects" data-type="indexterm" id="idm45968144092248"/>A common mistake is to believe that such relationships cannot be represented with linear regression. In reality, what matters for a regression to be “linear” is that the predicted variable has a linear relationship with the coefficients, not the variables. <em>Y</em> = <em>β</em><sub>1</sub>.e<sup>X<sub>1</sub></sup> + <em>β</em><sub>2</sub>.e<sup>X<sub>2</sub></sup> is a proper linear regression because multiplying each coefficient by 2 would multiply Y by 2. Conversely, <em>Y</em> = <em>e</em><sup><em>β</em><sub>1</sub></sup><sup>.X<sub>1</sub></sup> + <em>β</em><sub>2</sub><em>X</em><sub>2</sub> is not a proper linear regression because Y does not have a linear relationship with the coefficients.</p>
</div>

<p>We can address nonlinear relationships between variables by adding the explanatory variable taken to the square (i.e., a quadratic term). For example, we can model the relationship between marketing emails and purchases we just discussed as:</p>

<div data-type="equation">
<p><em>Purchases</em> = <em>β</em><sub>0</sub> + <em>β</em><sub>1</sub>.Emails + <em>β</em><sub>2</sub><em>.Emails</em><sup>2</sup></p>
</div>

<p>Adding a quadratic term can significantly improve the accuracy of a regression. In <a data-type="xref" href="#linear_left_parenthesisdashedright_pare">Figure 11-6</a>, you can see that the solid curve, which represents the line of best fit for the linear regression with a quadratic term, is much closer to the data points than the dashed line, which represents a standard regression without a quadratic term. Here, additional monthly emails have a decreasing impact, which translates into the quadratic term having a negative coefficient in the regression.</p>

<figure><div id="linear_left_parenthesisdashedright_pare" class="figure"><img alt="Linear (dashed) and quadratic (solid) lines of best fit" src="Images/BEDA_1106.png" width="1906" height="1166"/>
<h6><span class="label">Figure 11-6. </span>Linear (dashed) and quadratic (solid) lines of best fit</h6>
</div></figure>

<p>However, a quadratic term is nothing more than an interaction between a variable and itself. <a contenteditable="false" data-primary="self-moderation of nonlinearity" data-type="indexterm" id="idm45968144074392"/><a contenteditable="false" data-primary="nonlinearity in effects" data-secondary="self-moderation of" data-type="indexterm" id="idm45968144073320"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="nonlinearity in effects" data-tertiary="self-moderation of nonlinearity" data-type="indexterm" id="idm45968144071944"/>In other words, a nonlinear causal relationship between two variables can be reframed as self-moderation (<a data-type="xref" href="#representing_self_moderation">Figure 11-7</a>).</p>

<figure><div id="representing_self_moderation" class="figure"><img alt="Representing self-moderation" src="Images/BEDA_1107.png" width="1157" height="180"/>
<h6><span class="label">Figure 11-7. </span>Representing self-moderation</h6>
</div></figure>

<p>Conceptually, this means that adding an extra email per month has a different impact depending on the current business-as-usual number of emails sent.</p>

<p>The syntax in code to include self-moderation is:<a contenteditable="false" data-primary="Python" data-secondary="moderation analysis" data-tertiary="self-moderation" data-type="indexterm" id="idm45968144066152"/><a contenteditable="false" data-primary="R" data-secondary="moderation analysis" data-tertiary="self-moderation" data-type="indexterm" id="idm45968144064504"/></p>

<pre data-code-language="r" data-type="programlisting">
<code class="c1">## R </code>
<code class="nf">summary</code><code class="p">(</code><code class="nf">lm</code><code class="p">(</code><code class="n">Purchases</code> <code class="o">~</code> <code class="n">Emails</code> <code class="o">+</code> <code class="nf">I</code><code class="p">(</code><code class="n">Emails^2</code><code class="p">),</code> <code class="n">data</code><code class="o">=</code><code class="n">dat</code><code class="p">))</code></pre>

<pre data-code-language="python" data-type="programlisting">
<code class="c1">## Python</code>
<code class="n">model</code> <code class="o">=</code> <code class="n">ols</code><code class="p">(</code><code class="s2">"Purchases ~ Emails + I(Emails**2)"</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">dat_df</code><code class="p">)</code>
<code class="k">print</code><code class="p">(</code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">()</code><code class="o">.</code><code class="n">summary</code><code class="p">())</code></pre>

<p>In both R and Python, this is done by using <a contenteditable="false" data-primary="identity function I()" data-type="indexterm" id="idm45968144032568"/><a contenteditable="false" data-primary="R" data-secondary="moderation analysis" data-tertiary="identity function I()" data-type="indexterm" id="idm45968144031592"/><a contenteditable="false" data-primary="Python" data-secondary="moderation analysis" data-tertiary="identity function I()" data-type="indexterm" id="idm45968143990952"/>the identity function <code>I()</code>, which prevents the linear regression algorithm from trying to interpret the squared term and just passes it to the general solver. In R, a squared term is expressed with a caret,<sup><a data-type="noteref" id="idm45968143988536-marker" href="ch11.xhtml#idm45968143988536">1</a></sup> whereas in Python it is expressed with two multiplication symbols. This also implies that self-moderation is validated in exactly the same way as traditional moderation: we would build a Bootstrap confidence interval, and determine whether it includes zero and whether it is economically significant.</p>

<p>To recap our exploration of moderation, we’ve seen <a contenteditable="false" data-primary="moderation analysis" data-secondary="about questions addressed" data-type="indexterm" id="idm45968143987144"/>three varieties of it, which are mathematically identical but have different interpretations based on the types of variables involved:</p>

<dl>
	<dt>Segmentation</dt>
	<dd>
	<p>In segmentation personal characteristics<a contenteditable="false" data-primary="segmentation" data-secondary="about" data-type="indexterm" id="idm45968143983736"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="segmentation" data-tertiary="about" data-type="indexterm" id="idm45968143982360"/> (e.g., demographic variables) moderate the effect of a business behavior, such as an experimental intervention (it is then known as uplift analysis).</p>
	</dd>
	<dt>Interaction</dt>
	<dd>
	<p>In interaction we observe <a contenteditable="false" data-primary="interactions" data-secondary="moderation analysis" data-type="indexterm" id="idm45968143979112"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="interactions" data-type="indexterm" id="idm45968143977736"/>moderation between variables of the same nature, such as two demographic or two behavioral variables.</p>
	</dd>
	<dt>Nonlinearities</dt>
	<dd>
	<p>With nonlinearities a variable self-moderates its causal impact on <a contenteditable="false" data-primary="moderation analysis" data-secondary="nonlinearity in effects" data-tertiary="about" data-type="indexterm" id="idm45968143974808"/><a contenteditable="false" data-primary="nonlinearity in effects" data-secondary="about" data-type="indexterm" id="idm45968143973160"/>another <span class="keep-together">variable.</span></p>
	</dd>
</dl>

<p>Now that we have a clear understanding of the behavioral interpretation of moderation, let’s turn to the details of its application.</p>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="How to Apply Moderation"><div class="sect1" id="how_to_apply_moderation">
<h1>How to Apply Moderation</h1>

<p>As we discussed in the previous section, moderation can be used to capture a variety of behavioral effects, simply by adding the product of two variables to a regression. In this section, we’ll turn to technical considerations:</p>

<ul>
	<li>
	<p>When to look for moderation</p>
	</li>
	<li>
	<p>How to validate it</p>
	</li>
	<li>
	<p>Moderated moderation</p>
	</li>
	<li>
	<p>How to interpret the coefficients for individual variables in a moderated <span class="keep-together">regression</span></p>
	</li>
</ul>

<section data-type="sect2" data-pdf-bookmark="When to Look for Moderation?"><div class="sect2" id="when_to_look_for_moderationquestion_mar">
<h2>When to Look for Moderation?</h2>

<p>With so many possible applications of moderation, <a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="when to look for moderation" data-type="indexterm" id="ch11-wtlfm"/><a contenteditable="false" data-primary="false positive probability" data-secondary="moderation increasing" data-type="indexterm" id="idm45968143944728"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="false positives risk increased" data-type="indexterm" id="idm45968143943384"/>it can be tempting to look for it everywhere, but as a second-order effect (i.e., an effect on an effect), moderation generally yields small coefficients and the risk of false positives is high. This is especially true with experimental data, where the motivation is strong to find a meaningful effect: “Sure, the average effect of the email campaign is almost null, but look at the response rate for thirty-year-old men in Kansas!”</p>

<p>Let’s say that you’re getting started on analyzing observational data or designing an experiment. At what point should you be thinking about moderation, and how should you integrate it into your analyses? First, I’ll talk about the experimental design stage. The process for the data analysis stage is the same regardless of whether the data is observational or experimental in nature, so I’ll cover the two cases together after that. Finally, I’ll cover nonlinearities, which will be easy: because there is only one variable involved, you don’t really have to worry about potential risks and you can include nonlinearity liberally in your analyses.</p>

<section data-type="sect3" data-pdf-bookmark="Including moderation in the experimental design stage"><div class="sect3" id="including_moderation_in_the_experimenta">
<h3>Including moderation in the experimental design stage</h3>

<p>I’ll distinguish between two situations that will call for different approaches:<a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="experimental design stage" data-type="indexterm" id="ch11-exds"/></p>

<ul>
	<li>
	<p>The primary object of your analysis is the main effect, regardless of moderation, and moderation is a secondary object of your analysis.</p>
	</li>
	<li>
	<p>Moderation is the primary object of your analysis.</p>
	</li>
</ul>

<p>If you’re designing an experiment in which the primary goal is not to measure moderation, my recommendation will be simple: leverage the possibility of moderation to refine your theory of change, but do not try to adjust your sample size.</p>

<p>In <a data-type="xref" href="part04.xhtml#designing_and_analyzing_experiments">Part IV</a>, we saw that before running an experiment, you should make your theory of change explicit with the help of causal diagrams. In that case, the focus was on average causal effects, i.e., the average effect of an experimental treatment across the board, but in many cases, we can refine that logic through moderation.</p>

<p>In <a data-type="xref" href="ch08.xhtml#experimental_design_the_basics">Chapter 8</a>, <a contenteditable="false" data-primary="random assignment" data-secondary="age moderating 1-click booking" data-type="indexterm" id="idm45968143929416"/>we designed an experiment where we sought to increase AirCnC’s booking rate by offering “1-click booking.” It is conceivable that this effect could be moderated by age (<a data-type="xref" href="#experimental_treatment_moderated_by_age">Figure 11-8</a>).</p>

<figure><div id="experimental_treatment_moderated_by_age" class="figure"><img alt="Experimental treatment moderated by age" src="Images/BEDA_1108.png" width="1157" height="392"/>
<h6><span class="label">Figure 11-8. </span>Experimental treatment moderated by age</h6>
</div></figure>

<p>The behavioral logic of our theory of change <a contenteditable="false" data-primary="theory of change (ToC)" data-secondary="behavioral logic" data-tertiary="moderator plus" data-type="indexterm" id="idm45968143924280"/><a contenteditable="false" data-primary="behavioral logic" data-secondary="moderator plus" data-type="indexterm" id="idm45968143922632"/>was that the 1-click button would reduce the duration of the booking process, which itself impacts the probability of completing a booking. This means there are two possibilities in terms of moderation: age moderates the effect of the 1-click button on the booking duration, or it moderates the effect of booking duration on the probability of completing a booking, or both (<a data-type="xref" href="#age_may_moderate_two_causal_relationshi">Figure 11-9</a>).</p>

<figure><div id="age_may_moderate_two_causal_relationshi" class="figure"><img alt="Age may moderate two causal relationships" src="Images/BEDA_1109.png" width="1350" height="392"/>
<h6><span class="label">Figure 11-9. </span>Age may moderate two causal relationships</h6>
</div></figure>

<p>Putting together our behavioral logic and a potential moderator is very powerful, because it allows us to think through the behavioral implications, and in some cases to run analyses, before our experiment takes place.</p>

<p>Let’s start with the first relationship on the left of the CD, between the 1-click button and the booking duration. We don’t have any data about the 1-click button in our historical data, so we can’t measure this moderation effect directly. However, if we see an (unconfounded) correlation in our historical data between age and booking duration, this lends some credence to the idea, because it suggests that the cognitive processes at play are affected by age. On the other hand, if age is not correlated with booking duration, moderation would rely on younger and older customers having different reactions to the button itself specifically. While not impossible, this is a “narrower” behavioral path, somewhat less likely per Occam’s Razor—the simplest explanation is generally the right one. More importantly, it is a testable behavioral path. For example, if you bring a sample of baby boomers into the UX lab and you find that they don’t trust a 1-click process because they want to go through all the steps, then moderation is very likely, and you can target your experiment to younger customers, or at least oversample them.</p>

<p>For the second relationship, between booking duration and booking completion, we have all the required variables in our historical data, which means we can confirm or disprove moderation before even running our experiment, with a much higher accuracy than with the limited sample size of a single experiment. Again, if we confirm the presence of moderation, we can adjust our experimental design accordingly (e.g., by targeting only younger or older customers, depending on the direction of <span class="keep-together">moderation).</span></p>

<p>There is a broader takeaway here: by articulating the behavioral logic of an intervention, we can often expand the chain between our intervention and our effect of interest in the CD by identifying one or several mediators between them for which we already have data. We can then explore whether the relationship between mediator(s) and final effect is moderated. In addition, we can explore whether that relationship is self-moderated. In our example here, maybe the booking rate is unaffected by the booking duration up to a point, but then drops precipitously, e.g., customers don’t really care if booking takes 30 or 45 seconds, but bail out of the process en masse if it takes more than 2 minutes (<a data-type="xref" href="#the_relationship_between_the_mediator_a">Figure 11-10</a>).</p>

<figure><div id="the_relationship_between_the_mediator_a" class="figure"><img alt="The relationship between the mediator and final effect is self-moderated" src="Images/BEDA_1110.png" width="1350" height="164"/>
<h6><span class="label">Figure 11-10. </span>Relationship between the mediator and final effect is self-moderated</h6>
</div></figure>

<div data-type="note" epub:type="note"><h6>Note</h6>
<p>During that process of identifying moderators in your historical data, <a contenteditable="false" data-primary="correlation" data-secondary="causation implied" data-tertiary="identifying moderators in historical data" data-type="indexterm" id="idm45968143909368"/><a contenteditable="false" data-primary="causes" data-secondary="correlation implying causation" data-tertiary="identifying moderators in historical data" data-type="indexterm" id="idm45968143907448"/>you’ll have to keep in mind that “correlation is not causation” applies, and the relationships you’re looking at might be confounded, as in <a data-type="xref" href="#income_is_a_confounder_of_the_relations">Figure 11-11</a>.</p>
</div>

<figure><div id="income_is_a_confounder_of_the_relations" class="figure"><img alt="Income is a confounder of the relationship between duration and booking rate" src="Images/BEDA_1111.png" width="1350" height="417"/>
<h6><span class="label">Figure 11-11. </span>Income is a confounder of the relationship between duration and booking rate</h6>
</div></figure>

<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In such a situation, the confounding effect of <em>Income</em> would bias the relationship between <em>Duration</em> and <em>Booking</em> compared to the real causal effect (which is what you would act upon through the 1-click button experiment). Therefore, you would need to control for the confounding effect when assessing moderation.</p>
</div>

<p>In the case of a variable like <em>Age</em> that is observable before our experimental allocation, we can use it directly for the allocation itself. For example, instead of drawing a random sample from our whole customer base, we can limit our experiment to customers under a certain age, where we expect the largest effect.</p>

<p>Obviously, we can’t observe <em>BookingDuration</em> before a customer starts the booking process, which means we can’t use it in the experimental allocation itself. However, we can try to identify proxies for the target variable: for example, maybe bookings tend to be longer on the weekend than on weekdays. We can then use these proxies to define our experimental population and, say, run our experiment only on weekend customers. This will work well if the proxy and the target variable are closely related, e.g., there are some shorter bookings as well over the weekend, but 90% of the longer-duration bookings happen over the weekend. Conversely, if the two variables are only loosely related, e.g., 60% of the longer-duration bookings happen over the weekend, the results observed in your experiment may not generalize well to longer-duration bookings on weekdays.</p>

<p>This is all I recommend you do if moderation is not the primary focus of your experiment, i.e., you haven’t measured the unmoderated effect yet. That’s because the power to detect moderation and interactions is significantly lower than the power to detect the main effects, which means the sample size required to measure moderation would be significantly larger (think 10–20x larger or more). That’s a lot of time spent on the possibility of moderation for an average effect you haven’t even confirmed yet.</p>

<p>Therefore, I recommend that you run your first experiment with a focus on measuring accurately the average, unmoderated effect, and then measure moderation effects in the results. If you find any promising moderation effect, it will most likely have a large confidence interval that crosses zero, due to the fact that the experiment was not powered to capture it. If that moderation effect seems promising enough from an economic standpoint, run a second experiment powered to appropriately measure it.</p>

<p>Once you know the unmoderated effect size, you can decide to run an experiment dedicated to measuring or confirming moderation. The process for determining the appropriate sample size remains the same: you would set a target power and hypothesized/target effect sizes, then determine the proportion of false negatives in repeated simulations at different sample sizes, as we’ve done in previous power analyses. The only difference is that you would use your prior knowledge for the main effect size, and only set a target effect size for moderation.<a contenteditable="false" data-primary="" data-startref="ch11-exds" data-type="indexterm" id="idm45968143893960"/></p>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Including moderation in the data analysis stage"><div class="sect3" id="including_moderation_in_the_data_analys">
<h3>Including moderation in the data analysis stage</h3>

<p>You have some data on hand, either observational in nature or from an experiment you have run. <a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="data analysis stage" data-type="indexterm" id="ch11-datan"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="false positives risk increased" data-type="indexterm" id="idm45968143888600"/><a contenteditable="false" data-primary="false positive probability" data-secondary="moderation increasing" data-type="indexterm" id="idm45968143886936"/>How can you identify relevant moderation effects without running into false positives? You’ll have to do a fishing expedition, that is, try including a moderation term with one variable, then another, and so on. In the following, I’ll provide several guidelines to minimize the risk of false positives.</p>

<p>First, I’ll provide you with a rough but powerful sanity check <a contenteditable="false" data-primary="numeric variables" data-secondary="relationships with categorical" data-tertiary="moderating the effect" data-type="indexterm" id="idm45968143884680"/><a contenteditable="false" data-primary="categorical variables" data-secondary="relationships between numeric and" data-tertiary="moderating the effect" data-type="indexterm" id="idm45968143882936"/><a contenteditable="false" data-primary="linear regression" data-secondary="numeric effects" data-type="indexterm" id="idm45968143881272"/><a contenteditable="false" data-primary="regression" data-secondary="numeric effects" data-type="indexterm" id="idm45968143879896"/>when you’re looking to moderate the effect of a categorical variable on a numeric variable. The requirement of a numeric effect simply means that you’re looking at a linear and not a logistic regression. The requirement of a categorical cause may seem very restrictive, but it applies to all experimental assignments (i.e., the experimental assignment is always a binary or categorical variable). In addition, if your cause is numeric, you can discretize it for this purpose by taking its quartiles:<a contenteditable="false" data-primary="R" data-secondary="moderation analysis" data-tertiary="quartiles for numeric causes" data-type="indexterm" id="idm45968143877880"/><a contenteditable="false" data-primary="Python" data-secondary="moderation analysis" data-tertiary="quartiles for numeric causes" data-type="indexterm" id="idm45968143876216"/><a contenteditable="false" data-primary="quartiles for numeric causes" data-type="indexterm" id="idm45968143874552"/><a contenteditable="false" data-primary="causes" data-secondary="quartiles for numeric causes" data-type="indexterm" id="idm45968143873432"/></p>

<pre data-code-language="r" data-type="programlisting">
<code class="c1">## R</code>
<code class="n">hist_data</code> <code class="o">&lt;-</code> <code class="n">hist_data</code> <code class="o">%&gt;%</code> <code class="nf">mutate</code><code class="p">(</code><code class="n">age_quart</code> <code class="o">=</code> <code class="nf">ntile</code><code class="p">(</code><code class="n">age</code><code class="p">,</code> <code class="m">4</code><code class="p">))</code></pre>

<pre data-code-language="python" data-type="programlisting">
<code class="c1">## Python</code>
<code class="n">hist_data_df</code><code class="p">[</code><code class="s1">'age_quart'</code><code class="p">]</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">cut</code><code class="p">(</code><code class="n">hist_data_df</code><code class="p">[</code><code class="s1">'age'</code><code class="p">],</code> <code class="mi">4</code><code class="p">,</code> 
                                   <code class="n">labels</code><code class="o">=</code><code class="p">[</code><code class="s1">'q4'</code><code class="p">,</code> <code class="s1">'q3'</code><code class="p">,</code> <code class="s1">'q2'</code><code class="p">,</code> <code class="s1">'q1'</code><code class="p">],</code>
                                   <code class="n">include_lowest</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code></pre>

<p>The sanity check is to <a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="standard deviation comparison" data-type="indexterm" id="idm45968143759944"/><a contenteditable="false" data-primary="standard deviation comparison in moderation" data-type="indexterm" id="idm45968143799624"/>compare the standard deviation of the effect of interest across the groups defined by your cause of interest. If the standard deviation is meaningfully higher in the treatment group (for experimental data) or differs across groups (for observational data), this suggests the possible presence of moderation and you can proceed with your fishing expedition with reasonable confidence. If the standard deviations are similar across groups, this suggests that there is no moderation; you can still try a few potential moderators if you’d like, but you need to have a strong theoretical rationale for them.</p>

<p>What do “meaningfully higher” or “similar” mean in that context? If you want a rigorous justification, there are statistical tests you can run to help you determine if the observed difference is statistically unusual, such as the Brown–Forsythe test.<sup><a data-type="noteref" id="ch01fn28-marker" href="ch11.xhtml#ch01fn28">2</a></sup> Personally, I would recommend simply eyeballing it: is the difference economically meaningful in relation to the difference in means across the groups?</p>

<p class="pagebreak-before less_space">Going back to the example of play areas in C-Mart stores, the code would be<a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="when to apply moderation" data-type="indexterm" id="idm45968143792440"/><a contenteditable="false" data-primary="R" data-secondary="moderation analysis" data-tertiary="standard deviation of effect" data-type="indexterm" id="idm45968143790760"/><a contenteditable="false" data-primary="Python" data-secondary="moderation analysis" data-tertiary="standard deviation of effect" data-type="indexterm" id="idm45968143789096"/> as <span class="keep-together">follows:</span></p>

<pre data-code-language="r" data-type="programlisting">
<code class="c1">## R (output not shown)</code>
<code class="o">&gt;</code> <code class="n">hist_data</code> <code class="o">%&gt;%</code> <code class="nf">group_by</code><code class="p">(</code><code class="n">play_area</code><code class="p">)</code> <code class="o">%&gt;%</code> <code class="nf">summarize</code><code class="p">(</code><code class="n">mean</code> <code class="o">=</code> <code class="nf">mean</code><code class="p">(</code><code class="n">duration</code><code class="p">),</code> 
                                               <code class="n">sd</code> <code class="o">=</code> <code class="nf">sd</code><code class="p">(</code><code class="n">duration</code><code class="p">))</code></pre>

<pre data-code-language="python" data-type="programlisting">
<code class="c1">## Python</code>
 <code class="n">hist_data_df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'play_area'</code><code class="p">)</code><code class="o">.</code><code class="n">agg</code><code class="p">(</code><code class="n">M</code> <code class="o">=</code> <code class="p">(</code><code class="s1">'duration'</code><code class="p">,</code> <code class="k">lambda</code> <code class="n">x</code><code class="p">:</code> <code class="n">x</code><code class="o">.</code><code class="n">mean</code><code class="p">()),</code>
    <code class="n">SD</code> <code class="o">=</code> <code class="p">(</code><code class="s1">'duration'</code><code class="p">,</code> <code class="k">lambda</code> <code class="n">x</code><code class="p">:</code> <code class="n">x</code><code class="o">.</code><code class="n">std</code><code class="p">()))</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">22</code><code class="p">]:</code> 
                   <code class="n">M</code>         <code class="n">SD</code>
<code class="n">play_area</code>                      
<code class="mi">0</code>          <code class="mf">23.803928</code>   <code class="mf">6.970786</code>
<code class="mi">1</code>          <code class="mf">36.360939</code>  <code class="mf">17.111469</code></pre>

<p>In the example here, a 10-minute difference in standard deviations is definitely something C-Mart would be interested in exploring, given that the difference in means across the groups is about 13 minutes.</p>

<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Obviously, the risk of false positives increases<a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="false positives risk increased" data-type="indexterm" id="idm45968143659272"/><a contenteditable="false" data-primary="false positive probability" data-secondary="moderation increasing" data-type="indexterm" id="idm45968143657688"/> with the number of categories. If your primary cause is state or profession, you’re likely to see some variations in standard deviations across the board, just out of randomness and special cases. Therefore, I would look at moderation for such a variable only if I had a pretty strong rationale in the first place.</p>

<p>One way to mitigate the risk of false positives and make any moderation you might find more meaningful is to replace your categorical variable by quartiles of a relevant numeric variable. For example, political leaning or average income for states, proportion of women or average level of education for profession. Saying that the 25% of states with the lowest average income have a lower standard deviation of purchases than the 25% of states with the highest average income is a much more robust and actionable insight than saying that California has a higher standard deviation than <span class="keep-together">Mississippi.</span></p>
</div>

<p class="pagebreak-before less_space">Assuming your data passes this first sanity check, the second step is to <a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="upper bounds on moderated effects" data-type="indexterm" id="idm45968143653272"/><a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="average effect redistributed" data-type="indexterm" id="ch11-avgred"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="average effect redistributed" data-type="indexterm" id="idm45968143649800"/>establish upper bounds on moderated effects. The key intuition here is that moderation can only “redistribute” the average effect; it doesn’t increase it. A visual illustration will make this clearer, taking the example of <em>Children</em> as a potential moderator of the effect of <em>PlayArea</em> on <em>VisitDuration</em>. <a data-type="xref" href="#average_effect_of_a_play_area_across_cu">Figure 11-12</a> shows the average effect of a play area across our data (11.92 minutes), with the width of the bars representing the proportion of customers without and with children in our population.</p>

<figure><div id="average_effect_of_a_play_area_across_cu" class="figure"><img alt="Average effect of a play area across customers without and with children" src="Images/BEDA_1112.png" width="1906" height="1158"/>
<h6><span class="label">Figure 11-12. </span>Average effect of a play area across customers without and with children</h6>
</div></figure>

<p>Let’s assume for a second that the presence of a play area has at worst a null effect on customers without children (i.e., it cannot have a negative effect), a plausible assumption from a behavioral perspective if the play area is appropriately soundproofed. This implies that, at most, the entire average effect is coming from customers with children, and moderation redistributes the entire area of the left bar to the right bar, as in <a data-type="xref" href="#average_effect_coming_entirely_from_cus">Figure 11-13</a>.</p>

<figure><div id="average_effect_coming_entirely_from_cus" class="figure"><img alt="Average effect coming entirely from customers with children" src="Images/BEDA_1113.png" width="1906" height="1158"/>
<h6><span class="label">Figure 11-13. </span>Average effect coming entirely from customers with children</h6>
</div></figure>

<p>Under that “most extreme scenario,” let’s <a contenteditable="false" data-primary="effect sizes" data-secondary="calculating" data-type="indexterm" id="idm45968143639400"/><a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="effect size calculations" data-type="indexterm" id="idm45968143638024"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="effect size calculations" data-type="indexterm" id="idm45968143636344"/>calculate the effect size in the group of customers with children. By definition of the average, we have:</p>

<div data-type="equation">
<p><em>Avg. effect size</em> = (<em>Sum of individual effect sizes</em>) / (<em>Total number of customers</em>)</p>
</div>

<p>Let’s separate customers with and without children in the numerator:</p>

<div data-type="equation">
<p><em>Avg. effect size</em> = (<em>Sum of individual effect sizes for customers without children + sum of individual effect sizes for customer with children</em>) / (<em>Total number of</em> <span class="keep-together"><em>customers</em>)</span></p>
</div>

<p>If we assume no effect on customers without children, the first term in the numerator is equal to zero:</p>

<div data-type="equation">
<p><em>Avg. effect size</em> = (<em>Sum of individual effect sizes for customers with children</em>) / (<em>Total number of customers</em>)</p>
</div>

<p>Let’s multiply both sides of the equation by the total number of customers:</p>

<div data-type="equation">
<p><em>Avg. effect size</em> * <em>Total number of customers</em> = <em>Sum of individual effect sizes for customers with children</em></p>
</div>

<p>And then divide both sides by the number of customers with children:</p>

<div data-type="equation">
<p><em>Avg. effect size</em> * <em>Total number of customers</em> / <em>N</em><em>umber of customers with children</em> = <em>Avg. effect size for customers with children</em></p>
</div>

<div data-type="equation">
<p><em>Avg. effect size</em> * <em>1</em> / <em>Proportion of customers with children</em> = <em>Avg. effect size for customers with children</em></p>
</div>

<p>Swapping left- and righthand sides for readability and plugging in the numbers from the preceding example, we get:</p>

<div data-type="equation">
<p><em>Avg. effect size for customers with children</em> = 11.92 * 1 / 0.387 = 30.8</p>
</div>

<p>In other words, the average effect size for customers with children can be no higher than 30.8 additional minutes for <em>VisitDuration</em>, given the overall average effect size. If that number is too low to be of economic interest, then there is no point in measuring moderation between <em>PlayArea</em> and <em>Children</em>. Beyond that specific example, the formula <em>Avg. effect size/Proportion of customers in segment</em> can be applied to any potential moderator: if you have an equal split of men and women in your customer base, this means that at most, one gender has double the average effect and the other has no effect. Hoping that somehow one gender will have triple the average effect or that moderation will increase the effect for both genders is wishful thinking, and mathematically impossible. To put it another way, we tend to focus on groups with above-average effect sizes, for understandable reasons, but the counterpart has to be groups with below-average effect sizes.</p>

<p>This means that your search for potential moderators should start with variables that have a strong behavioral rationale or have been found to be impactful in past analyses, and that generate subgroups large enough to matter. Beyond a certain degree of inequality in group sizes, the search becomes an exercise in futility: if you have a variable that splits your customer base 90%-10%, then even if the group representing 10% of your customer base shows no effect at all, this will increase at most the effect in the 90% group to 1 / 0.9 = 111% of the average effect, an increase of 11%.</p>

<p>More broadly, moderation cannot save a mediocre average effect. It should only be sought to add a bit more oomph to your treatment; for example if you are at 90% of the breakeven or target value for it, or if you are in a high-volume environment and you’re trying to extract any efficiency gains you can.<a contenteditable="false" data-primary="" data-startref="ch11-avgred" data-type="indexterm" id="idm45968143580200"/></p>

<p>For each variable you want to test, the process is the same. First, run a regression with an interaction between the experimental treatment variable and the potential moderator. Then if you find an interaction effect large enough, confirm it by building a Bootstrap CI around the estimated effect.</p>

<p>There are some rules, such as the Bonferroni correction, <a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="false positives risk increased" data-type="indexterm" id="idm45968143577672"/><a contenteditable="false" data-primary="false positive probability" data-secondary="moderation increasing" data-type="indexterm" id="idm45968143575928"/>to reduce the risk of false positives when testing a large number of hypotheses in this fashion. I would not recommend them however, for two reasons:</p>

<ol>
	<li>
	<p>They generally rely, explicitly or implicitly, on the Null Hypothesis Statistical Testing framework with normality assumptions.</p>
	</li>
	<li>
	<p>They can be unduly conservative and unacceptably increase the risk of false <span class="keep-together">negatives.</span></p>
	</li>
</ol>

<p>Instead, my recommendation would be to validate promising subgroups through follow-up experiments whenever possible. If a moderation effect is large enough to be of business value, then it should be considered large enough to warrant further validation. If you’re working with experimental data, repeating the experiment is conceptually straightforward. If you’re working with observational data, what experiment you should run may not be immediately clear. However, for your moderation effect to have any economic value, it must mean you’re planning to do something differently. Otherwise it’s just an interesting tidbit for cocktail parties. Whatever it is you would do differently, you can probably randomize it in some fashion, and now you have an experiment.</p>

<p>One key success factor in this process is to appropriately convey to business partners that the results of such repeated testing should be considered provisional hypotheses, not proven fact. They shouldn’t feel like you’ve failed to deliver when an experiment yields a null result because it was a long shot anyway. Also remember that due to the nature of the process, your final effect size is likely to be smaller than what you found in the first pass.<a contenteditable="false" data-primary="" data-startref="ch11-datan" data-type="indexterm" id="idm45968143569080"/></p>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Nonlinearities"><div class="sect3" id="nonlinearities">
<h3>Nonlinearities</h3>

<p>Nonlinearities, a.k.a. self-moderation, represent a special case compared to other forms of moderation because, by definition, <a contenteditable="false" data-primary="moderation analysis" data-secondary="nonlinearity in effects" data-tertiary="false positives risk limited" data-type="indexterm" id="idm45968143566024"/><a contenteditable="false" data-primary="false positive probability" data-secondary="moderation increasing" data-tertiary="self-moderation limiting" data-type="indexterm" id="idm45968143564360"/><a contenteditable="false" data-primary="self-moderation of nonlinearity" data-secondary="false positives risk limited" data-type="indexterm" id="idm45968143562680"/><a contenteditable="false" data-primary="nonlinearity in effects" data-secondary="moderation self-positive effects limited" data-type="indexterm" id="idm45968143561272"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="self-moderation false positives risk limited" data-type="indexterm" id="idm45968143559800"/>there is only one moderator under consideration, which limits the risk of false positives. In addition, the consequences of a false positive are typically limited, as long as you don’t draw inference outside of the range of data available. For example, if you were to measure the effect of income on purchases based mostly on customers with annual incomes between $25,000 and $75,000 and then draw inferences for customers with an annual income of $250,000, both the risks and consequences of a false positive are high (even without considering moderation, extrapolating that far out would be a terrible idea anyway).</p>

<p>Therefore, it’s mostly OK to routinely test your cause of interest for self-moderation if you have at least a few hundred rows in your data. The variable must also be numeric, because a categorical variable self-moderating would be nonsensical. You should then validate the self-moderation effect by building a Bootstrap confidence interval, as we’ll see a bit later in this section.</p>

<p>Beyond improving the fit of your regression and accounting for intuitive behavioral effects such as decreasing returns, <a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="self-moderation alerting to hidden moderator" data-type="indexterm" id="idm45968143555976"/><a contenteditable="false" data-primary="nonlinearity in effects" data-secondary="self-moderation alerting to hidden moderator" data-type="indexterm" id="idm45968143554280"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="applying" data-tertiary="self-moderation alerting to hidden moderator" data-type="indexterm" id="idm45968143552872"/>including self-moderation in your regression can alert you to the presence of a hidden moderator.</p>

<p>Let’s look at a C-Mart example: the relationship between visit duration and groceries purchases. It is conceivable that very short visits represent targeted shopping runs to buy a specific article whereas longer trips are more likely to be grocery runs. This would make the reason for a visit a confounder of the relationship between <em>VisitDuration</em> and <em>GroceriesPurchases</em> (<a data-type="xref" href="#reason_for_visit_is_a_confounder_of_the">Figure 11-14</a>).</p>

<figure><div id="reason_for_visit_is_a_confounder_of_the" class="figure"><img alt="Reason for visit is a confounder of the relationship between VisitDuration and GroceriesPurchases" src="Images/BEDA_1114.png" width="1350" height="393"/>
<h6><span class="label">Figure 11-14. </span>Reason for visit is a confounder of the relationship between VisitDuration and GroceriesPurchases</h6>
</div></figure>

<p>But at the same time, <em>VisitReason</em> might conceivably moderate the effect of <em>VisitDuration</em> on <em>GroceriesPurchases</em>. If you’re going to the store to grab a birthday gift or a hammer, keeping you in the store longer (e.g., by adding a play area) is unlikely to entice you to buy sun-dried tomatoes the way it might if you’re doing a grocery run (<a data-type="xref" href="#reason_for_visit_moderates_the_effect_o">Figure 11-15</a>).</p>

<figure><div id="reason_for_visit_moderates_the_effect_o" class="figure"><img alt="Reason for visit moderates the effect of VisitDuration on GroceriesPurchases" src="Images/BEDA_1115.png" width="1350" height="393"/>
<h6><span class="label">Figure 11-15. </span>Reason for visit moderates VisitDuration’s effect on GroceriesPurchases</h6>
</div></figure>

<p>If we were able to observe the reason for the visit, we would be able to add it to our CD, and it would become a straightforward case of confounding + moderation. Assuming that we can’t observe the reason for the visit, we’re left with the following observable facts:</p>

<ul>
	<li>
	<p><em>GroceriesPurchases</em> is positively correlated with <em>VisitDuration</em> (both because of a true effect and because of the confounding effect of reason for visit).</p>
	</li>
	<li>
	<p>Increasing visit duration has a bigger impact on groceries purchases for longer visits than for shorter visits.</p>
	</li>
</ul>

<p>In other words, the relationship between <em>VisitDuration</em> and <em>GroceriesPurchases</em> exhibits nonlinearity. A self-moderation term would increase the accuracy of our regression, so we should include it.</p>

<p>More generally, whenever you have a variable that appears to self-moderate without a clear behavioral rationale, you should explore the possibility of a hidden variable that is both a cause and a moderator of that variable.</p>

<p>To recap, finding relevant moderators is an important part of behavioral analysis, but like most of our tools, it is often more art than science. In the experimental design stage, we can sharpen our behavioral logic by looking for moderated mediators in our historical data, or through UX testing of our treatment. In the data analysis stage, a fishing expedition can discover promising potential moderators; while Bootstrap confidence intervals help reduce the risk of false positives, follow-up experiments are ultimately your best guarantee of success. Conversely, self-moderation is safe to explore and include routinely.</p>
</div></section>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Multiple Moderators"><div class="sect2" id="multiple_moderators">
<h2>Multiple Moderators</h2>

<p>For the sake of simplicity, so far I’ve only shown one moderator at a time, but an effect can have multiple moderators. Going from one to multiple moderators is straightforward; the main subtlety to keep in mind is whether the moderators are interacting with each other or not.</p>

<section data-type="sect3" data-pdf-bookmark="Parallel moderators"><div class="sect3" id="parallel_moderators">
<h3>Parallel moderators</h3>

<p>Getting back to our C-Mart example, we could imagine that<a contenteditable="false" data-primary="moderation analysis" data-secondary="multiple moderators" data-tertiary="parallel moderators" data-type="indexterm" id="ch11-paramm"/><a contenteditable="false" data-primary="parallel moderators" data-type="indexterm" id="ch11-paramm2"/><a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="parallel multiple moderators" data-type="indexterm" id="ch11-paramm3"/><a contenteditable="false" data-primary="regression" data-secondary="parallel multiple moderators" data-type="indexterm" id="idm45968143524280"/> another demographic variable, <em>Age</em>, also separately moderates the effect of <em>PlayArea</em> on <em>VisitDuration</em>, as in <a data-type="xref" href="#the_effect_of_playarea_on_visitdurati">Figure 11-16</a>.</p>

<figure><div id="the_effect_of_playarea_on_visitdurati" class="figure"><img alt="The effect of PlayArea on VisitDuration has two moderators" src="Images/BEDA_1116.png" width="1052" height="393"/>
<h6><span class="label">Figure 11-16. </span>Effect of PlayArea on VisitDuration has two moderators</h6>
</div></figure>

<p>The corresponding regression equation is shown in <a data-type="xref" href="#eqtn3">Equation 11-3</a>.</p>

<div data-type="equation" id="eqtn3">
<h5><span class="label">Equation 11-3. </span> </h5>

<p><em>VisitDuration</em> = <em>β</em><sub>0</sub> + <em>β<sub>p</sub>.PlayArea</em> + <em>β<sub>c</sub>.Children</em> + <em>β<sub>a</sub>.Age</em> + <em>β<sub>pc</sub>.(PlayArea</em> * Children) + <em>β<sub>pa</sub></em>.(<em>PlayArea * Age</em>)</p>
</div>

<p>Note that the equation includes an individual term for <em>Age</em>, even though there is no arrow going from <em>Age</em> to <em>VisitDuration</em>. The warning provided earlier still applies here, and you need to include all individual terms in your regression.</p>

<p>The interpretation of <a data-type="xref" href="#eqtn3">Equation 11-3</a> would be that:</p>

<ul>
	<li>
	<p>The impact of <em>PlayArea</em> on <em>VisitDuration</em> is different for customers with and without children.</p>
	</li>
	<li>
	<p>The impact of <em>PlayArea</em> on <em>VisitDuration</em> is different for younger and older customers. These two moderating effects are independent of each other.</p>
	</li>
</ul>

<p><em>Age</em> is a numeric variable, so its interpretation must be adjusted accordingly: the coefficient for <em>PlayArea * Age</em> represents the difference in the effect of <em>PlayArea</em> on <em>VisitDuration</em> between customers who have a one-year age difference. Depending on the business problem at hand, we can either:</p>

<ul>
	<li>
	<p>Keep it in numeric format if we wanted to have a precise, causally grounded estimate of <em>VisitDuration</em>, for example to determine the increase in sales we should expect from adding a play area to a certain store.</p>
	</li>
	<li>
	<p>Or make it categorical by “binning” it in an appropriate manner. For example, we could convert <em>Age</em> into brackets such as “less than 20,” “20 to 40,” “40+,” or any other breakdown, making the corresponding coefficients easier to interpret for segmentation purposes.</p>
	</li>
</ul>

<p>Taken together, <em>Children</em> and <em>Age</em> create a two-dimension demographic segmentation that allows us to compare the average visit duration of, say, a 28-year-old with children to a 45-year-old without children.</p>

<p>Because the two moderation effects are independent of each other, we would be able to validate each one of them independently by bootstrapping the regression for <a data-type="xref" href="#eqtn3">Equation 11-3</a> and looking at the confidence interval for each moderator (see the next <span class="keep-together">subsection).</span></p>

<div class="pagebreak-before less_space" data-type="note" epub:type="note"><h6>Note</h6>
<p>This also implies that there is no order between the two moderators, and they can be drawn interchangeably: in <a data-type="xref" href="#the_effect_of_playarea_on_visitdurati">Figure 11-16</a>, <em>Children</em> comes first but <em>Age</em> could as well. It doesn’t matter.</p>
</div>

<p>The logic of multiple moderators applies similarly for interactions between variables of the same nature. For example, we could have <em>Children</em> interact with both <em>Age</em> and <em>Gender</em> (<a data-type="xref" href="#age_and_gender_both_interact_with_child">Figure 11-17</a>).</p>

<figure><div id="age_and_gender_both_interact_with_child" class="figure"><img alt="Age and Gender both interact with Children" src="Images/BEDA_1117.png" width="1052" height="393"/>
<h6><span class="label">Figure 11-17. </span>Age and Gender both interact with Children</h6>
</div></figure>

<p>The corresponding regression equation would be:</p>

<div data-type="equation">
<p><em>VisitDuration</em> = <em>β</em><sub>0</sub> + <em>β<sub>c</sub>.Children</em> + <em>β<sub>a</sub>.Age</em> + <em>β<sub>g</sub>.Gender</em> + <em>β<sub>ca</sub></em>.(<em>Children</em> * <em>Age</em>) + <em>β<sub>cg</sub></em>.(<em>Children</em> * <em>Gender</em>)</p>
</div>

<p>Finally, a regression can include multiple variables that each self-moderate. Here again, the analysis would proceed independently for each one of them.</p>

<p>Overall, it is very simple to add multiple independent moderators, but sometimes it also makes sense to assume that the moderators interact with each other, which we’ll now turn to.<a contenteditable="false" data-primary="" data-startref="ch11-paramm" data-type="indexterm" id="idm45968143474088"/><a contenteditable="false" data-primary="" data-startref="ch11-paramm2" data-type="indexterm" id="idm45968143472712"/><a contenteditable="false" data-primary="" data-startref="ch11-paramm3" data-type="indexterm" id="idm45968143471336"/></p>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Interacting moderators"><div class="sect3" id="interacting_moderators">
<h3>Interacting moderators</h3>

<p>Looking at the effect of <em>PlayArea</em> on <em>VisitDuration</em>, it <a contenteditable="false" data-primary="moderation analysis" data-secondary="multiple moderators" data-tertiary="interacting moderators" data-type="indexterm" id="ch11-inter"/><a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="interacting moderators" data-type="indexterm" id="ch11-inter2"/><a contenteditable="false" data-primary="interactions" data-secondary="interacting moderators" data-type="indexterm" id="ch11-inter3"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="multiple moderators" data-tertiary="moderated moderation" data-type="indexterm" id="ch11-inter4"/><a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="moderated moderation" data-type="indexterm" id="ch11-inter5"/>makes sense that it would be moderated both by <em>Children</em> and <em>Age</em>. But among customers with children, we may also imagine that the increase in visit duration depends on the age of the customer, e.g., if grandparents are less likely to drop off their grandchildren at the play area than parents are to drop off their children. In such a case, the moderating effect of <em>Children</em> on the effect of <em>PlayArea</em> on <em>VisitDuration</em> would itself be moderated by <em>Age</em>, which in social sciences is called “moderated moderation” (<a data-type="xref" href="#moderated_moderation">Figure 11-18</a>).</p>

<figure><div id="moderated_moderation" class="figure"><img alt="Moderated moderation" src="Images/BEDA_1118.png" width="1052" height="393"/>
<h6><span class="label">Figure 11-18. </span>Moderated moderation</h6>
</div></figure>

<p><a data-type="xref" href="#moderated_moderation_across_different_a">Figure 11-19</a> shows the moderated moderation at play, with each subgraph representing an age group among our customers. We can see that going from younger to older customers, the impact of <em>Children</em> on the impact of <em>PlayArea</em> on <em>VisitDuration</em> decreases (quite a mouthful!), as the distance between the two points for C = 1 decreases across subgraphs.</p>

<figure><div id="moderated_moderation_across_different_a" class="figure"><img alt="Moderated moderation across different age groups" src="Images/BEDA_1119.png" width="1887" height="1158"/>
<h6><span class="label">Figure 11-19. </span>Moderated moderation across different age groups</h6>
</div></figure>

<p>The corresponding equation would be as shown:</p>

<div data-type="equation">
<p><em>VisitDuration</em> = <em>β</em><sub>0</sub> + <em>β<sub>p</sub>.PlayArea</em> + <em>β<sub>c</sub>.Children</em> + <em>β<sub>a</sub>.Age</em> + <em>β<sub>pc</sub></em>.(<em>PlayArea * Children</em>) + <em>β<sub>pa</sub></em>.(<em>PlayArea * Age</em>)+ <em>β<sub>ca</sub></em>.(<em>Children * Age</em>)+ <em>β<sub>pca</sub></em>.(PlayArea * Children * Age)</p>
</div>

<p>This equation is identical to <a data-type="xref" href="#eqtn3">Equation 11-3</a> with the addition of a three-way term at the end. Let’s run the regression (note how I entered only the three-way interaction term in the regression and the software automatically adds all the individual variables and two-way interaction terms):<a contenteditable="false" data-primary="R" data-secondary="moderation analysis" data-tertiary="moderated moderation" data-type="indexterm" id="idm45968143435960"/><a contenteditable="false" data-primary="Python" data-secondary="moderation analysis" data-tertiary="moderated moderation" data-type="indexterm" id="idm45968143434312"/></p>

<pre data-code-language="r" data-type="programlisting">
<code class="c1">## R (output not shown)</code>
<code class="o">&gt;</code> <code class="nf">summary</code><code class="p">(</code><code class="nf">lm</code><code class="p">(</code><code class="n">duration</code><code class="o">~</code><code class="n">play_area</code> <code class="o">*</code> <code class="n">children</code> <code class="o">*</code> <code class="n">age</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">hist_data</code><code class="p">))</code></pre>

<pre data-code-language="python" data-type="programlisting">
<code class="c1">## Python</code>
<code class="n">ols</code><code class="p">(</code><code class="s2">"duration~play_area * children * age"</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">hist_data_df</code><code class="p">)</code><code class="o">.</code><code class="n">fit</code><code class="p">()</code><code class="o">.</code><code class="n">summary</code><code class="p">()</code>

<code class="o">...</code>
                        <code class="n">coef</code>     <code class="n">std</code> <code class="n">err</code>    <code class="n">t</code>        <code class="n">P</code><code class="o">&gt;|</code><code class="n">t</code><code class="o">|</code>    <code class="p">[</code><code class="mf">0.025</code>   <code class="mf">0.975</code><code class="p">]</code>
<code class="o">-----------------------------------------------------------------------------</code>
<code class="n">Intercept</code>              <code class="mf">20.0166</code>    <code class="mf">0.037</code>  <code class="mf">534.906</code>    <code class="mf">0.000</code>    <code class="mf">19.943</code>    <code class="mf">20.090</code>
<code class="n">play_area</code>               <code class="mf">3.9110</code>    <code class="mf">0.063</code>   <code class="mf">62.014</code>    <code class="mf">0.000</code>     <code class="mf">3.787</code>     <code class="mf">4.035</code>
<code class="n">children</code>                <code class="mf">9.9983</code>    <code class="mf">0.061</code>  <code class="mf">165.012</code>    <code class="mf">0.000</code>     <code class="mf">9.880</code>    <code class="mf">10.117</code>
<code class="n">play_area</code><code class="p">:</code><code class="n">children</code>     <code class="mf">29.1638</code>    <code class="mf">0.101</code>  <code class="mf">290.105</code>    <code class="mf">0.000</code>    <code class="mf">28.967</code>    <code class="mf">29.361</code>
<code class="n">age</code>                    <code class="o">-</code><code class="mf">0.0006</code>    <code class="mf">0.001</code>   <code class="o">-</code><code class="mf">0.820</code>    <code class="mf">0.412</code>    <code class="o">-</code><code class="mf">0.002</code>     <code class="mf">0.001</code>
<code class="n">play_area</code><code class="p">:</code><code class="n">age</code>           <code class="mf">0.0010</code>    <code class="mf">0.001</code>    <code class="mf">0.806</code>    <code class="mf">0.420</code>    <code class="o">-</code><code class="mf">0.001</code>     <code class="mf">0.003</code>
<code class="n">children</code><code class="p">:</code><code class="n">age</code>            <code class="mf">0.0003</code>    <code class="mf">0.001</code>    <code class="mf">0.297</code>    <code class="mf">0.767</code>    <code class="o">-</code><code class="mf">0.002</code>     <code class="mf">0.003</code>
<code class="n">play_area</code><code class="p">:</code><code class="n">children</code><code class="p">:</code><code class="n">age</code> <code class="o">-</code><code class="mf">0.1637</code>    <code class="mf">0.002</code>  <code class="o">-</code><code class="mf">86.139</code>    <code class="mf">0.000</code>    <code class="o">-</code><code class="mf">0.167</code>    <code class="o">-</code><code class="mf">0.160</code>
<code class="o">...</code></pre>

<p>The coefficient for our 3-way term, the last one in the output, is negative, as well as economically meaningful, and the 90%-CI is approximately [–0.1671 ; –0.1590], which is narrow enough to give us confidence it can’t be close to zero.</p>

<p>Moderated moderation obeys the same logic and rules as simple moderation. Therefore it is symmetric, meaning that we can interpret <em>Age</em> as moderating the moderating effect of <em>Children</em>, or we can see it as <em>Children</em> moderating the moderating effect of <em>Age</em>the last one in the output.</p>

<p>From a behavioral perspective, the interpretation of moderated moderation depends on whether the underlying logic is that of segmentation or interaction:<a contenteditable="false" data-primary="moderation analysis" data-secondary="multiple moderators" data-tertiary="moderated moderation as segmentation" data-type="indexterm" id="idm45968143245272"/><a contenteditable="false" data-primary="segmentation" data-secondary="moderated moderation as" data-type="indexterm" id="idm45968143243672"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="multiple moderators" data-tertiary="moderated moderation as interaction" data-type="indexterm" id="idm45968143242296"/><a contenteditable="false" data-primary="interactions" data-secondary="moderated moderation as" data-type="indexterm" id="idm45968143240632"/></p>

<ul>
	<li>
	<p>We would interpret it as segmentation if we have two personal-characteristic variables moderating a business characteristic or business behavior. That was the case for instance with the play area, where <em>Children</em> and <em>Age</em> moderate the effect of the <em>PlayArea</em> variable. Intuitively, this means that we have a two-dimension segmentation where the moderating effect of a dimension is increasing or decreasing along the other dimension (e.g., the moderating effect of having children decreases when <em>Age</em> increases).</p>
	</li>
	<li>
	<p>With three variables of the same nature, we would interpret it as a three-way interaction between three variables, as in <a data-type="xref" href="#three_way_interaction_between_three_bus">Figure 11-20</a>.</p>
	</li>
</ul>

<figure><div id="three_way_interaction_between_three_bus" class="figure"><img alt="Three-way interaction between three business-characteristic variables" src="Images/BEDA_1120.png" width="749" height="477"/>
<h6><span class="label">Figure 11-20. </span>Three-way interaction between three business-characteristic variables</h6>
</div></figure>

<p>The point of this distinction is not to be pedantic, but to remind you to keep track of your analysis goals. Finding and validating moderation between predictors in a regression is all well and good, but what are you going to do with that information? You can <em>change</em> business behaviors, and sometimes business characteristics, but you can only <em>target</em> customers’ personal characteristics. Similarly, if you find that a certain customer behavior moderates the effect of a business behavior (e.g., a cross-selling email campaign works best on customers who have recently been in a store), that information could be used either to target the customers who have exhibited this behavior, or to encourage customers to have that behavior in the first place.</p>

<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Technically speaking, moderated moderation<a contenteditable="false" data-primary="nonlinearity in effects" data-secondary="moderated moderation applying to" data-type="indexterm" id="idm45968143427032"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="nonlinearity in effects" data-tertiary="moderated moderation applying to" data-type="indexterm" id="idm45968143227432"/> could also apply to nonlinearities, by having a cube term (e.g., <em>Purchases</em> = <em>β</em><sub>0</sub> + <em>β</em><sub>1</sub><em>.Emails</em> + <em>β</em><sub>2</sub><em>.Emails</em><sup>2</sup> + <em>β</em><sub>3</sub>.<em>Emails</em><sup>3</sup>), but that’s extremely rare and more of a curiosity devoid of practical applications.</p>
</div>

<p>At this point, you may have a budding or even full-fledged headache. Moderation can quickly get overly complex. I have shown you 3-way interactions to let you know that it’s a possibility, but I would not go down that path unless you have some reasonably strong preexisting behavioral rationale to do so. Beyond that, we could theoretically have 5-way or even 12-way interactions (“moderation of moderation of…”), but simply throwing in as many interaction terms as you can is a recipe for false positives and ultimately a dazzling but pointless model. A straightforward simple moderation is often all you need, and can add some significant oomph to your analysis at a reasonable cost in terms of added complexity.<a contenteditable="false" data-primary="" data-startref="ch11-wtlfm" data-type="indexterm" id="idm45968143219592"/><a contenteditable="false" data-primary="" data-startref="ch11-inter" data-type="indexterm" id="idm45968143218216"/><a contenteditable="false" data-primary="" data-startref="ch11-inter2" data-type="indexterm" id="idm45968143216840"/><a contenteditable="false" data-primary="" data-startref="ch11-inter3" data-type="indexterm" id="idm45968143215464"/><a contenteditable="false" data-primary="" data-startref="ch11-inter4" data-type="indexterm" id="idm45968143214088"/><a contenteditable="false" data-primary="" data-startref="ch11-inter5" data-type="indexterm" id="idm45968143212712"/></p>
</div></section>
</div></section>

<section class="pagebreak-before" data-type="sect2" data-pdf-bookmark="Validating Moderation with Bootstrap"><div class="sect2" id="validating_moderation_with_bootstrap">
<h2 class="less_space">Validating Moderation with Bootstrap</h2>

<p>So far, we have only looked at the regression coefficients for moderation terms, and not at p-values. <a contenteditable="false" data-primary="Bootstrap" data-secondary="moderation analysis validation" data-type="indexterm" id="ch11-valbt"/><a contenteditable="false" data-primary="moderation analysis" data-secondary="validating with Bootstrap" data-type="indexterm" id="ch11-valbt2"/><a contenteditable="false" data-primary="uncertainty" data-secondary="moderation second-order effect" data-type="indexterm" id="idm45968143205448"/><a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="validating with Bootstrap" data-type="indexterm" id="ch11-valbt3"/>But like any other regression coefficient, our coefficients for moderation are subject to uncertainty and sampling variability. Uncertainty is all the more important to account for with moderation because it is a “second order” effect (i.e., an effect on an effect, not a direct effect on a variable); these are typically much smaller than “first order” effects.</p>

<p>Let’s get back to our example of play areas in C-Mart. Our estimated coefficient for the moderation between <em>PlayArea</em> and <em>Children</em> was <em>β<sub>pc</sub></em> = 21. As usual, we’ll use Bootstrap simulations to determine how certain we can be of the values we observed. Let’s start by drawing 1,000 random samples of 10,000 rows each from the historical data available to us, and running each time the same regression as in the previous section. The distribution of values for the interaction coefficient is displayed <a contenteditable="false" data-primary="histograms" data-secondary="Bootstrap validating moderation" data-type="indexterm" id="idm45968143198808"/>in <a data-type="xref" href="#distribution_of_bootstrapped_values_fo">Figure 11-21</a>.</p>

<figure><div id="distribution_of_bootstrapped_values_fo" class="figure"><img alt="Distribution of bootstrapped values for interaction coefficient (1k samples of 10k rows)" src="Images/BEDA_1121.png" width="1903" height="1166"/>
<h6><span class="label">Figure 11-21. </span>Distribution of bootstrapped values for interaction coefficient (1k samples of 10k rows)</h6>
</div></figure>

<p>In <a data-type="xref" href="ch07.xhtml#measuring_uncertainty_with_the_bootstra">Chapter 7</a>, we saw that increasing the number of samples increased the smoothness of the histogram and the accuracy of confidence interval estimates, and increasing the size of the samples reduced the dispersion of values. Whether we need to do either of these depends on the business question at hand:</p>

<ul>
	<li>
	<p>If the question is, “Is there any moderation whatsoever?” (i.e., Is the coefficient <em>β<sub>pc</sub></em> different from zero?), then <a data-type="xref" href="#distribution_of_bootstrapped_values_fo">Figure 11-21</a> already allows us to answer unequivocally “yes” and there’s no need to dig deeper.</p>
	</li>
	<li>
	<p>If the question is more uncertain, e.g., “How confident are we that the coefficient for moderation is above 20.5?” then we’ll have to increase the sample size. Right now, the histogram goes beyond 20.5 toward the left (and quite so). Each of the values lower than 20.5 represents a Bootstrap simulation where the coefficient for moderation was below that threshold. Let’s next increase the size of the Bootstrap samples to 200,000 rows (<a data-type="xref" href="#distribution_of_bootstrapped_values_f">Figure 11-22</a>).</p>
	</li>
</ul>

<figure><div id="distribution_of_bootstrapped_values_f" class="figure"><img alt="Distribution of bootstrapped values for interaction coefficient (1k samples of 200k rows)" src="Images/BEDA_1122.png" width="1903" height="1166"/>
<h6><span class="label">Figure 11-22. </span>Distribution of bootstrapped values for interaction coefficient (1k samples of 200k rows)</h6>
</div></figure>

<p>As you can see, the values are now much more narrowly concentrated around 21, and safely away from 20.5. That second simulation was enough to answer our business question.</p>

<p>In the present case, we have a grand total of about 600,000 rows in our historical data so after validating the code with a dry run, we could have jumped directly to that sample size without much inconvenience (remember that you should never use a Bootstrap sample size larger than the size of the data you’re drawing from). But what if your historical data had 10 or 100 million rows? Instead of answering your business question in a matter of minutes, you would have spent hours or days waiting for the results of simulating a thousand samples of that size; certainly, your final CI would be extremely narrow, for example [20.9999; 21.0001], but that would be a complete waste of time if the question is only, “Is it higher than 20.5?” That’s why I wanted to show you the process of progressively increasing the Bootstrap sample size, instead of jumping directly to the size of your historical data.</p>

<p>To summarize, after running a small Bootstrap simulation to make sure that your code runs correctly, you should increase the number of samples or the sample size as needed to answer your business question. This iterative process has the added benefit of engaging your critical sense and preventing you from running the analysis on autopilot. This applies to all forms of moderation: segmentation (including of experimental data), interaction, and self-moderation.<a contenteditable="false" data-primary="" data-startref="ch11-valbt" data-type="indexterm" id="idm45968143181976"/><a contenteditable="false" data-primary="" data-startref="ch11-valbt2" data-type="indexterm" id="idm45968143180600"/><a contenteditable="false" data-primary="" data-startref="ch11-valbt3" data-type="indexterm" id="idm45968143179224"/></p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Interpreting Individual Coefficients"><div class="sect2" id="interpreting_individual_coefficients">
<h2>Interpreting Individual Coefficients</h2>

<p>I mentioned several times in this chapter that the <a contenteditable="false" data-primary="moderation analysis" data-secondary="interpreting individual coefficients" data-type="indexterm" id="ch11-indco"/><a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="interpreting individual coefficients" data-type="indexterm" id="ch11-indco2"/>variables involved in moderation must also be included as individual variables in the regression, even if you don’t plan to use them or they don’t appear significant. If, however, you want to use them, there are some subtleties involved, that we’ll now review.</p>

<p>Let’s start by comparing the following two regressions (including only <em>Age</em> beyond <em>PlayArea</em> for the sake of simplicity):</p>

<div data-type="equation">
<p><em>VisitDuration</em> = <em>β</em><sub>0</sub> + <em>β</em><sub><em>p</em>0</sub>.<em>PlayArea</em> + <em>β</em><sub><em>a</em>0</sub>.<em>Age</em></p>
</div>

<p>and</p>

<div data-type="equation">
<p><em>VisitDuration</em> = <em>β</em><sub>1</sub> + <em>β</em><sub><em>p</em>1</sub>.<em>PlayArea</em> + <em>β</em><sub><em>a</em>1</sub>.<em>Age</em> + <em>β</em><sub><em>pa</em>1</sub>.(<em>PlayArea * Age</em>)</p>
</div>

<p>At first glance, it might seem that the interpretation of the second equation is identical to the first one, with the only addition of the moderation term. It is not. <em>β</em><sub><em>p</em>0</sub> and <em>β</em><sub><em>p</em>1</sub> are not equal and do not have the same meaning, and similarly for <em>β</em><sub><em>a</em>0</sub> and <em>β</em><sub><em>a</em>1</sub>.</p>

<p>Let’s visualize the difference by drawing a sample of 1,000 data points for the sake of readability and representing them in the <em>Age * VisitDuration</em> plane (Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#sample_of_onecommazerozerozero_data_po">11-23</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#sample_of_onecommazerozerozero_data_poi">11-24</a>). In both figures, there are two regression lines plotted: one for customers with a play area and one for customers with no play area.</p>

<p><a data-type="xref" href="#sample_of_onecommazerozerozero_data_po">Figure 11-23</a> represents the first equation, without moderation. The two lines have the same slope, equal to <em>β</em><sub><em>a</em>0</sub> = -0.024, and the (constant) distance between the two lines is equal to <em>β</em><sub><em>p</em>0</sub> = 12.56.</p>

<figure><div id="sample_of_onecommazerozerozero_data_po" class="figure"><img alt="Sample of 1,000 data points and regression lines with a play area (full dots, solid line) and without (crosses, dashed line), without moderation term" src="Images/BEDA_1123.png" width="1887" height="1166"/>
<h6><span class="label">Figure 11-23. </span>Sample of 1,000 data points and regression lines with a play area (full dots, solid line) and without (crosses, dashed line), without moderation term</h6>
</div></figure>

<p><a data-type="xref" href="#sample_of_onecommazerozerozero_data_poi">Figure 11-24</a> shows the corresponding figure for the second equation. The lines are not parallel. This implies that we can’t just say, “<em>β</em><sub><em>p</em>1</sub> represents the vertical distance between two regression lines,” we have to state at which age we’re measuring that vertical distance. Similarly, we can’t just say that “<em>β</em><sub><em>a</em>1</sub> represents the slope of these regression lines,” we have to pick which of these lines we’re referring to (i.e., we have to state for which value of <em>PlayArea</em> we’re measuring that slope).</p>

<p>This has important ramifications from a business perspective. If a business partner asks, “What is the impact of a play area on visit duration?” and you’re relying on the first equation, without a moderation term, you can answer, “That impact is equal to <em>β</em><sub><em>p</em>0</sub>.” However, if you’ve determined that there is a significant moderation effect between the two variables and you want to rely on the second equation (as you should), your answer should really be the “well, it depends” that business partners dread.</p>

<p>Fortunately, this problem can easily be resolved with a little care, in two possible ways:<a contenteditable="false" data-primary="R" data-secondary="moderation analysis" data-tertiary="interpreting individual coefficients" data-type="indexterm" id="ch11-indivco"/><a contenteditable="false" data-primary="Python" data-secondary="moderation analysis" data-tertiary="interpreting individual coefficients" data-type="indexterm" id="ch11-indivco2"/></p>

<ul>
	<li>
	<p>Setting meaningful reference points</p>
	</li>
	<li>
	<p>Calculating effects at the level of business decisions</p>
	</li>
</ul>

<figure><div id="sample_of_onecommazerozerozero_data_poi" class="figure"><img alt="Sample of 1,000 data points and regression lines with a play area (full dots, solid line) and without (crosses, dashed line), with moderation term" src="Images/BEDA_1124.png" width="1887" height="1166"/>
<h6><span class="label">Figure 11-24. </span>Sample of 1,000 data points and regression lines with a play area (full dots, solid line) and without (crosses, dashed line), with moderation term</h6>
</div></figure>

<section data-type="sect3" data-pdf-bookmark="Setting meaningful reference points"><div class="sect3" id="setting_meaningful_reference_points">
<h3>Setting meaningful reference points</h3>

<p>The first solution is to set meaningful reference points<a contenteditable="false" data-primary="moderation analysis" data-secondary="interpreting individual coefficients" data-tertiary="setting meaningful reference points" data-type="indexterm" id="idm45968143107848"/><a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="setting meaningful reference points" data-type="indexterm" id="idm45968143106040"/> for our variables. First let’s get back to our equation with moderation:</p>

<div data-type="equation">
<p><em>VisitDuration</em> = <em>β</em><sub>1</sub> + <em>β</em><sub><em>p</em>1</sub>.<em>PlayArea</em> + <em>β</em><sub><em>a</em>1</sub>.<em>Age</em> + <em>β</em><sub><em>pa</em>1</sub>.(<em>PlayArea * Age</em>)</p>
</div>

<p>If we set a customer’s age to zero, the expected visit duration for our newborn customer is <em>β</em><sub>1</sub> without a play area and <em>β</em><sub>1</sub> + <em>β</em><sub>p1</sub> with a play area. Therefore <em>β</em><sub>p1</sub> is truthfully the impact of a play area on visit duration for age zero. However, newborn customers are not our primary target and we can do better by normalizing the <em>Age</em> variable. A typical approach is to set it to the average age in our data set:<a contenteditable="false" data-primary="R" data-secondary="moderation analysis" data-tertiary="setting meaningful reference points" data-type="indexterm" id="idm45968143093464"/><a contenteditable="false" data-primary="Python" data-secondary="moderation analysis" data-tertiary="setting meaningful reference points" data-type="indexterm" id="idm45968143091704"/></p>

<pre data-code-language="r" data-type="programlisting">
<code class="c1">## R</code>
<code class="o">&gt;</code> <code class="n">centered_data</code> <code class="o">&lt;-</code> <code class="n">hist_data</code> <code class="o">%&gt;%</code> <code class="nf">mutate</code><code class="p">(</code><code class="n">age</code> <code class="o">=</code> <code class="n">age</code> <code class="o">-</code> <code class="nf">mean</code><code class="p">(</code><code class="n">age</code><code class="p">))</code></pre>

<pre data-code-language="python" data-type="programlisting">
<code class="c1">## Python</code>
<code class="n">centered_data_df</code> <code class="o">=</code> <code class="n">hist_data_df</code><code class="o">.</code><code class="n">copy</code><code class="p">()</code>
<code class="n">centered_data_df</code><code class="p">[</code><code class="s1">'age'</code><code class="p">]</code> <code class="o">=</code> <code class="n">centered_data_df</code><code class="p">[</code><code class="s1">'age'</code><code class="p">]</code> \
    <code class="o">.</code><code class="n">subtract</code><code class="p">(</code><code class="n">centered_data_df</code><code class="p">[</code><code class="s1">'age'</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">())</code></pre>

<p>Doing so reduces the coefficient for <em>PlayArea</em> from 15.85 to 12.56 and we can say, “The impact of a play area on visit duration is 12.56 additional minutes <em>for the average customer age in our data</em>.” Similarly, because <em>PlayArea</em> is a binary variable, <em>β</em><sub><em>a</em>1</sub> is by default the slope of the line for customers without a play area. You can change that by reversing the levels of <em>PlayArea</em> (i.e., setting 1 or “Y” as the default and 0 or “N” as the change, depending on how your binary variable is formulated):</p>

<pre data-code-language="r" data-type="programlisting">
<code class="c1">## R</code>
<code class="o">&gt;</code> <code class="n">centered_data</code> <code class="o">&lt;-</code> <code class="n">hist_data</code> <code class="o">%&gt;%</code>
    <code class="nf">mutate</code><code class="p">(</code><code class="n">play_area</code> <code class="o">=</code> <code class="nf">factor</code><code class="p">(</code><code class="n">play_area</code><code class="p">,</code> <code class="n">levels</code><code class="o">=</code><code class="nf">c</code><code class="p">(</code><code class="s">'1'</code><code class="p">,</code><code class="s">'0'</code><code class="p">)))</code></pre>

<pre data-code-language="python" data-type="programlisting">
<code class="c1">## Python</code>
<code class="n">centered_data_df</code><code class="p">[</code><code class="s1">'play_area'</code><code class="p">]</code> <code class="o">=</code> <code class="n">centered_data_df</code><code class="p">[</code><code class="s1">'play_area'</code><code class="p">]</code></pre>

<p>Changing the default level for <em>PlayArea</em> changes the coefficient for <em>β</em><sub><em>a</em>1</sub> from 0 to −0.07 (the slope of the upper solid line in <a data-type="xref" href="#sample_of_onecommazerozerozero_data_poi">Figure 11-24</a>).</p>

<p>How should you set the defaults for your variables? It depends on the business problem at hand as well as the nature of the variable:</p>

<ul>
	<li>
	<p>In some situations, the relevant default for a numeric variable is not the average, but the minimum, the maximum, or the average in a relevant subgroup (e.g., the average age of customers with children, or the average age of customers in stores with a play area as opposed to the global average). In particular, when you’re dealing with count variables such as number of children or number of calls, zero might be a better reference point than the average.</p>
	</li>
	<li>
	<p>For binary variables, the relevant default is usually the status quo. Here for example, you would set the default for <em>PlayArea</em> to 0 if you’re considering adding new play areas, and to 1 if you’re considering some of the existing ones.</p>
	</li>
	<li>
	<p>For categorical variables such as gender or state, unless there is a meaningful reference point, you can default to the most common category.</p>
	</li>
</ul>

<p>Setting meaningful reference points for all the variables involved in moderation has the advantage of computational simplicity and is often straightforward. However, it can get quickly cumbersome as the number of variables involved increases. Let’s imagine for example that we add an interaction between state and gender to our regression:</p>

<div data-type="equation">
<p><em>VisitDuration</em> =<em>β</em><sub>1</sub> + <em>β<sub>p</sub></em><sub>1</sub>.<em>PlayArea</em> + <em>β<sub>a</sub></em><sub>1</sub>.<em>Age</em> + <em>β<sub>pa</sub></em><sub>1</sub>.(<em>PlayArea * Age</em>) + <em>β<sub>g</sub></em><sub>1</sub>.<em>Gender</em> + <em>β<sub>s</sub></em><sub>1</sub>.<em>State</em> + <em>β<sub>gs</sub></em><sub>1</sub>.(<em>Gender * State</em>)</p>
</div>

<p class="pagebreak-before less_space">Now <em>β<sub>p</sub></em><sub>1</sub> is the impact of a play area for customers of the reference age and gender in the reference state. “The effect of a play area is 10 for female California customers of age 43” starts to be a mouthful and can become rather meaningless if the variables are not independent: the fact that we have more female than male customers, that we have more customers in California than in any other state, and that the overall average age is 43 doesn’t imply that we have a lot of 43-year-old female California customers, or any whatsoever for that matter. This brings us to the other solution, calculating the average effect in our sample.</p>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Calculating effects at the level of business decisions"><div class="sect3" id="calculating_effects_at_the_level_of_bus">
<h3>Calculating effects at the level of business decisions</h3>

<p>From a scientific perspective, one of the main advantages of the previous approach<a contenteditable="false" data-primary="moderation analysis" data-secondary="interpreting individual coefficients" data-tertiary="calculating effects at decision level" data-type="indexterm" id="idm45968142892360"/><a contenteditable="false" data-primary="C-Mart fictional supermarket chain" data-secondary="moderation analysis" data-tertiary="calculating effects at decision level" data-type="indexterm" id="idm45968142890776"/> is that it provides a single number for a coefficient, which can presumably be applied to completely different circumstances, or at least compared with the numbers obtained in other circumstances. However, the goal of applied analytics is not to measure things for the sake of measurement, but to guide business decisions (if you’re running a data analysis and you don’t know what possible decisions could come out of it, you need to have a conversation with your manager, because at least one of you is not doing their job correctly). Therefore, an alternative approach is to calculate the value of your effect variable of interest with and without that decision.</p>

<p>Let’s imagine for example that the decision at hand for C-Mart is to pick the next store in which to set up a play area. To answer that question, we don’t need to determine the single “average” effect of a play area, and trying to do so would actually be counterproductive. Instead, for each store that doesn’t have a play area today, we can directly determine what would be the average additional visit duration if we added a play area. The process is as follows (the callout numbers are shared between R and Python):</p>

<pre data-code-language="python" data-type="programlisting">
<code class="c1">## Python (output not shown)</code><code>
</code><code class="k">def</code><code> </code><code class="nf">business_metric_fun</code><code class="p">(</code><code class="n">dat_df</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">model</code><code> </code><code class="o">=</code><code>  </code><code class="n">ols</code><code class="p">(</code><code class="s2">"</code><code class="s2">duration~play_area * (children + age)</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="n">data</code><code class="o">=</code><code class="n">dat_df</code><code class="p">)</code><code> </code><a class="co" id="comarker111a" href="#c01"><img alt="1" src="Images/1.png" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">res</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">disp</code><code class="o">=</code><code class="mi">0</code><code class="p">)</code><code>
</code><code>    </code><code class="n">action_dat_df</code><code> </code><code class="o">=</code><code> </code><code class="n">dat_df</code><code class="p">[</code><code class="n">dat_df</code><code class="o">.</code><code class="n">play_area</code><code> </code><code class="o">==</code><code> </code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">copy</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" id="comarker112a" href="#c02"><img alt="2" src="Images/2.png" width="12" height="12"/></a><code>          </code><code>
</code><code>    </code><code class="n">action_dat_df</code><code class="p">[</code><code class="s1">'</code><code class="s1">pred_dur0</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">res</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">action_dat_df</code><code class="p">)</code><code> </code><a class="co" id="comarker113a" href="#c03"><img alt="3" src="Images/3.png" width="12" height="12"/></a><code>  </code><code>
</code><code>    </code><code class="n">action_dat_df</code><code class="o">.</code><code class="n">play_area</code><code> </code><code class="o">=</code><code> </code><code class="mi">1</code><code> </code><a class="co" id="comarker114a" href="#c04"><img alt="4" src="Images/4.png" width="12" height="12"/></a><code>                                  </code><code>
</code><code>    </code><code class="n">action_dat_df</code><code class="p">[</code><code class="s1">'</code><code class="s1">pred_dur1</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">res</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">action_dat_df</code><code class="p">)</code><code> </code><a class="co" id="comarker115a" href="#c05"><img alt="5" src="Images/5.png" width="12" height="12"/></a><code>        </code><code>
</code><code>    </code><code class="n">action_dat_df</code><code class="p">[</code><code class="s1">'</code><code class="s1">pred_dur_diff</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code>\</code><code>  </code><a class="co" id="comarker116a" href="#c06"><img alt="6" src="Images/6.png" width="12" height="12"/></a><code>                           </code><code>
</code><code>        </code><code class="n">action_dat_df</code><code class="o">.</code><code class="n">pred_dur1</code><code> </code><code class="o">-</code><code> </code><code class="n">action_dat_df</code><code class="o">.</code><code class="n">pred_dur0</code><code>
</code><code>    </code><code class="n">action_res_df</code><code> </code><code class="o">=</code><code> </code><code class="n">action_dat_df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">store_id</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code> </code><code>\</code><code>  </code><a class="co" id="comarker117a" href="#c07"><img alt="7" src="Images/7.png" width="12" height="12"/></a><code>  </code><code>
</code><code>        </code><code class="o">.</code><code class="n">agg</code><code class="p">(</code><code class="n">mean_dur_diff</code><code class="o">=</code><code class="p">(</code><code class="s1">'</code><code class="s1">pred_dur_diff</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">mean</code><code class="s1">'</code><code class="p">)</code><code class="p">,</code><code> </code><code>
</code><code>             </code><code class="n">tot_dur_diff</code><code class="o">=</code><code class="p">(</code><code class="s1">'</code><code class="s1">pred_dur_diff</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">sum</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">action_res_df</code><code>
</code><code class="n">action_res_df</code><code> </code><code class="o">=</code><code> </code><code class="n">business_metric_fun</code><code class="p">(</code><code class="n">hist_data_df</code><code class="p">)</code><code>
</code><code class="n">action_res_df</code><code class="o">.</code><code class="n">describe</code><code class="p">(</code><code class="p">)</code></pre>

<pre data-code-language="r" data-type="programlisting">
<code class="c1">## R</code><code>
</code><code class="n">business_metric_fun</code><code> </code><code class="o">&lt;-</code><code> </code><code class="nf">function</code><code class="p">(</code><code class="n">dat</code><code class="p">)</code><code class="p">{</code><code>
  </code><code class="n">mod_model</code><code> </code><code class="o">&lt;-</code><code> </code><code class="nf">lm</code><code class="p">(</code><code class="n">duration</code><code class="o">~</code><code class="n">play_area</code><code> </code><code class="o">*</code><code> </code><code class="p">(</code><code class="n">children</code><code> </code><code class="o">+</code><code> </code><code class="n">age</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">data</code><code class="o">=</code><code class="n">dat</code><code class="p">)</code><code> </code><a class="co" id="comarker111c" href="#c01"><img alt="1" src="Images/1.png" width="12" height="12"/></a><code> 
  </code><code class="n">action_dat</code><code> </code><code class="o">&lt;-</code><code> </code><code class="n">dat</code><code> </code><code class="o">%&gt;%</code><code>
    </code><code class="nf">filter</code><code class="p">(</code><code class="n">play_area</code><code> </code><code class="o">==</code><code> </code><code class="m">0</code><code class="p">)</code><code> </code><a class="co" id="comarker112c" href="#c02"><img alt="2" src="Images/2.png" width="12" height="12"/></a><code>   
  </code><code class="n">action_dat</code><code> </code><code class="o">&lt;-</code><code> </code><code class="n">action_dat</code><code> </code><code class="o">%&gt;%</code><code>
    </code><code class="nf">mutate</code><code class="p">(</code><code class="n">pred_dur0</code><code> </code><code class="o">=</code><code> </code><code class="nf">predict</code><code class="p">(</code><code class="n">mod_model</code><code class="p">,</code><code> </code><code class="n">action_dat</code><code class="p">)</code><code class="p">)</code><code> </code><code class="o">%&gt;%</code><code>  </code><a class="co" id="comarker113c" href="#c03"><img alt="3" src="Images/3.png" width="12" height="12"/></a><code>
    </code><code class="nf">mutate</code><code class="p">(</code><code class="n">play_area</code><code> </code><code class="o">=</code><code> </code><code class="nf">factor</code><code class="p">(</code><code class="s">'</code><code class="s">1'</code><code class="p">,</code><code> </code><code class="n">levels</code><code class="o">=</code><code class="nf">c</code><code class="p">(</code><code class="s">'</code><code class="s">0'</code><code class="p">,</code><code> </code><code class="s">'</code><code class="s">1'</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" id="comarker114c" href="#c04"><img alt="4" src="Images/4.png" width="12" height="12"/></a><code>  
  </code><code class="n">action_dat</code><code> </code><code class="o">&lt;-</code><code> </code><code class="n">action_dat</code><code> </code><code class="o">%&gt;%</code><code>
    </code><code class="nf">mutate</code><code class="p">(</code><code class="n">pred_dur1</code><code> </code><code class="o">=</code><code> </code><code class="nf">predict</code><code class="p">(</code><code class="n">mod_model</code><code class="p">,</code><code> </code><code class="n">action_dat</code><code class="p">)</code><code class="p">)</code><code> </code><code class="o">%&gt;%</code><code> </code><a class="co" id="comarker115c" href="#c05"><img alt="5" src="Images/5.png" width="12" height="12"/></a><code>
    </code><code class="nf">mutate</code><code class="p">(</code><code class="n">pred_dur_diff</code><code> </code><code class="o">=</code><code> </code><code class="n">pred_dur1</code><code> </code><code class="o">-</code><code> </code><code class="n">pred_dur0</code><code class="p">)</code><code> </code><code class="o">%&gt;%</code><code>  </code><a class="co" id="comarker116c" href="#c06"><img alt="6" src="Images/6.png" width="12" height="12"/></a><code> 
    </code><code class="n">dplyr</code><code class="o">::</code><code class="nf">group_by</code><code class="p">(</code><code class="n">store_id</code><code class="p">)</code><code> </code><code class="o">%&gt;%</code><code>  </code><a class="co" id="comarker117c" href="#c07"><img alt="7" src="Images/7.png" width="12" height="12"/></a><code>   
    </code><code class="nf">summarise</code><code class="p">(</code><code class="n">mean_d</code><code> </code><code class="o">=</code><code> </code><code class="nf">mean</code><code class="p">(</code><code class="n">pred_dur_diff</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">sum_d</code><code> </code><code class="o">=</code><code> </code><code class="nf">sum</code><code class="p">(</code><code class="n">pred_dur_diff</code><code class="p">)</code><code class="p">)</code><code>
  </code><code class="nf">return</code><code class="p">(</code><code class="n">action_dat</code><code class="p">)</code><code class="p">}</code><code>
</code><code class="n">action_summ_dat</code><code> </code><code class="o">&lt;-</code><code> </code><code class="nf">business_metric_fun</code><code class="p">(</code><code class="n">hist_data</code><code class="p">)</code><code>
</code><code class="nf">summary</code><code class="p">(</code><code class="n">action_summ_dat</code><code class="p">)</code><code>

    </code><code class="n">store_id</code><code>      </code><code class="n">mean_d</code><code>          </code><code class="n">sum_d</code><code>       
 </code><code class="m">3</code><code>      </code><code class="o">:</code><code> </code><code class="m">1</code><code>   </code><code class="n">Min.</code><code>   </code><code class="o">:</code><code class="m">10.41</code><code>   </code><code class="n">Min.</code><code>   </code><code class="o">:</code><code class="m">109941</code><code>  
 </code><code class="m">4</code><code>      </code><code class="o">:</code><code> </code><code class="m">1</code><code>   </code><code class="m">1</code><code class="n">st</code><code> </code><code class="n">Qu.</code><code class="o">:</code><code class="m">11.26</code><code>   </code><code class="m">1</code><code class="n">st</code><code> </code><code class="n">Qu.</code><code class="o">:</code><code class="m">129817</code><code>  
 </code><code class="m">5</code><code>      </code><code class="o">:</code><code> </code><code class="m">1</code><code>   </code><code class="n">Median</code><code> </code><code class="o">:</code><code class="m">11.80</code><code>   </code><code class="n">Median</code><code> </code><code class="o">:</code><code class="m">143079</code><code>  
 </code><code class="m">7</code><code>      </code><code class="o">:</code><code> </code><code class="m">1</code><code>   </code><code class="n">Mean</code><code>   </code><code class="o">:</code><code class="m">11.95</code><code>   </code><code class="n">Mean</code><code>   </code><code class="o">:</code><code class="m">144616</code><code>  
 </code><code class="m">8</code><code>      </code><code class="o">:</code><code> </code><code class="m">1</code><code>   </code><code class="m">3</code><code class="n">rd</code><code> </code><code class="n">Qu.</code><code class="o">:</code><code class="m">12.25</code><code>   </code><code class="m">3</code><code class="n">rd</code><code> </code><code class="n">Qu.</code><code class="o">:</code><code class="m">155481</code><code>  
 </code><code class="m">9</code><code>      </code><code class="o">:</code><code> </code><code class="m">1</code><code>   </code><code class="n">Max.</code><code>   </code><code class="o">:</code><code class="m">14.43</code><code>   </code><code class="n">Max.</code><code>   </code><code class="o">:</code><code class="m">207647</code><code>  
 </code><code class="p">(</code><code class="n">Other</code><code class="p">)</code><code class="o">:</code><code class="m">27</code></pre>

<dl class="calloutlist">
	<dt><a class="co" id="c01" href="#comarker111a"><img alt="1" src="Images/1.png" width="12" height="12"/></a></dt>
	<dd>
	<p>Run and save the model to use it for predictions.</p>
	</dd>
	<dt><a class="co" id="c02" href="#comarker112a"><img alt="2" src="Images/2.png" width="12" height="12"/></a></dt>
	<dd>
	<p>Select the stores without a play area today.</p>
	</dd>
	<dt><a class="co" id="c03" href="#comarker113a"><img alt="3" src="Images/3.png" width="12" height="12"/></a></dt>
	<dd>
	<p>Add the predicted visit duration under the current circumstances, <code>pred_dur0</code>.</p>
	</dd>
	<dt><a class="co" id="c04" href="#comarker114a"><img alt="4" src="Images/4.png" width="12" height="12"/></a></dt>
	<dd>
	<p>Change the binary variable <em>PlayArea</em> from <code>0</code> to <code>1</code>.</p>
	</dd>
	<dt><a class="co" id="c05" href="#comarker115a"><img alt="5" src="Images/5.png" width="12" height="12"/></a></dt>
	<dd>
	<p>Determine the predicted visit duration with the added play area, <code>pred_dur1</code>.</p>
	</dd>
	<dt><a class="co" id="c06" href="#comarker116a"><img alt="6" src="Images/6.png" width="12" height="12"/></a></dt>
	<dd>
	<p>Calculate the difference between the two.</p>
	</dd>
	<dt><a class="co" id="c07" href="#comarker117a"><img alt="7" src="Images/7.png" width="12" height="12"/></a></dt>
	<dd>
	<p>Aggregate at the store level, either by looking at the average or total additional duration (the average is more intuitive, but the total relates more directly to business outcomes by favoring larger stores).</p>
	</dd>
</dl>

<p>We can then select the store(s) with the highest benefits of a play area. Crucially, you can check for yourself that centering numeric variables at the beginning of the process leads to the exact same final conclusions. Mathematically, that’s because we’re subtracting the same quantity from the two terms in a difference:</p>

<div data-type="equation">
<p>(<em>VisitDuration</em><sub><em>i</em>1</sub> - <em>mean</em>(<em>VisitDuration</em>)) - (<em>VisitDuration</em><sub><em>i</em></sub><sub>0</sub> - <em>mean</em>(<em>VisitDuration</em>)) = <em>VisitDuration<sub>i</sub></em><sub>1</sub> - <em>VisitDuration<sub>i</sub></em><sub>0</sub></p>
</div>

<p>where <em>VisitDuration<sub>i</sub></em><sub>1</sub> and <em>VisitDuration<sub>i</sub></em><sub>0</sub> are the predicted visit duration, respectively with and without a play area (regardless of current conditions). Therefore, with a decision-centric perspective the reference points and centering, or lack thereof, are irrelevant and you don’t need to worry about that anymore.</p>

<p>To recap: adding a moderation term changes the value and interpretation of the individual coefficients for the variables involved. This happens because the very definition of moderation is that these coefficients are not the same “everywhere,” and moderation changes the baseline values at which they are measured. The individual coefficients must thus be interpreted either in relation to relevant reference points of the variables involved (which you can adjust through centering), or across our entire data set but in relation to the decision at hand.<a contenteditable="false" data-primary="" data-startref="ch11-indco" data-type="indexterm" id="idm45968142378808"/><a contenteditable="false" data-primary="" data-startref="ch11-indco2" data-type="indexterm" id="idm45968142377432"/><a contenteditable="false" data-primary="" data-startref="ch11-indivco" data-type="indexterm" id="idm45968142376056"/><a contenteditable="false" data-primary="" data-startref="ch11-indivco2" data-type="indexterm" id="idm45968142374680"/></p>
</div></section>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Conclusion"><div class="sect1" id="conclusion-id00016">
<h1>Conclusion</h1>

<p>One of the key tenets of behavioral science is that “behavior is a function of the person and the environment.” That phrase is generally taken to mean that we can influence behaviors by changing the environment. That is certainly true but I also like to see it as a reminder that averages are just that, averages, and it behooves the diligent behavioral analyst to dig deeper with moderation analysis. In particular, I think that some of the recent failures to replicate classic psychology experiments would be best interpreted not as meaning that “there is no effect” but that “the effect is strongly moderated by population characteristics (i.e., the person) and experimental conditions (i.e., the environment).”</p>

<p>This may seem to be a matter of academic interest only, but it’s not. In business settings, many heated discussions where both sides have commandeered anecdotal supporting evidence can be usefully recast in terms of moderation. What is true on the East Coast may not be on the West Coast. A training program may be effective with inexperienced staff but not with experienced employees, or vice versa. By definition, a regression without moderation would not be able to shed light on either of these two cases.</p>

<p>This makes moderation analysis a very valuable, but often neglected, addition to the behavioral analytics tool belt. In this chapter, we saw that it can be applied both to observational and experimental data in a very simple way: add a multiplicative term between the two variables to your regression. In the next and last chapter, we’ll turn to another of the key behavioral data analysis tools, mediation.</p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45968143988536"><sup><a href="ch11.xhtml#idm45968143988536-marker">1</a></sup> The caret is the symbol on the 6 key of your keyboard.</p><p data-type="footnote" id="ch01fn28"><sup><a href="ch11.xhtml#ch01fn28-marker">2</a></sup> Available in R as the <code>bf.test()</code> function from the <a href="https://oreil.ly/iq7KN"><code>onewaytests</code> package</a> and in Python as the <code>stats.levene()</code> function from the <code>scipy</code> package, with the parameter <code>center='median'</code>.</p></div></div></section></div></body></html>