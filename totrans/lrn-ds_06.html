<html><head></head><body><section data-pdf-bookmark="Chapter 5. Case Study: Why Is My Bus Always Late?" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch-bus">&#13;
<h1><span class="label">Chapter 5. </span>Case Study: Why Is My Bus Always Late?</h1>&#13;
&#13;
<p>Jake VanderPlas’s blog, <a class="reference external" href="http://jakevdp.github.io">Pythonic Perambulations</a>, offers a great<a contenteditable="false" data-primary="lifecycle, data science" data-secondary="bus arrival times case study" data-type="indexterm" id="ix_lifecycle_bus_time_arriv"/><a contenteditable="false" data-primary="bus arrival times dataset" data-type="indexterm" id="ix_bus_time_arriv"/><a contenteditable="false" data-primary="waiting time paradox (bus arrival)" data-type="indexterm" id="id801"/><a contenteditable="false" data-primary="Pythonic Perambulations (VanderPlas)" data-type="indexterm" id="id802"/><a contenteditable="false" data-primary="VanderPlas, Jake" data-type="indexterm" id="id803"/> example of what it’s like to be a modern data scientist. As data scientists, we see data in our work, daily routines, and personal lives, and we tend to be curious about what insights these data might bring to our understanding of the world. In this first case study, we borrow from one of the posts on Pythonic Perambulations, <a class="reference external" href="https://oreil.ly/W8Ih5">“The Waiting Time Paradox, or, Why Is My Bus Always Late?”</a>, to model waiting for a bus on a street corner in Seattle. We touch on each stage of the data lifecycle, but in this first case study, our focus is on the process of thinking about the question, data, and model, rather than on data structures and modeling techniques. A constant model and simulation study get us a long way toward understanding the issues.</p>&#13;
&#13;
<p>VanderPlas’s post was inspired by his experience waiting for the bus. The wait always seemed longer than expected. This experience did not match the reasoning that if a bus comes every 10 minutes and you arrive at the stop at a random time, then, on average, the wait should be about 5 minutes. Armed with data provided by the Washington State Transportation Center, the author was able to investigate this phenomenon. We do the same.</p>&#13;
&#13;
<p>We apply concepts introduced in earlier chapters, beginning with the general question, Why is my bus always late?, and refining this question to one that is closer to our goal and that we can investigate with data. We then consider the data scope, such as how these data were collected and potential sources of biases, and we prepare the data for analysis. Our understanding of the data scope helps us design a model for waiting at a bus stop, which we simulate to study this phenomenon.</p>&#13;
&#13;
&#13;
<section data-pdf-bookmark="Question and Scope" data-type="sect1"><div class="sect1" id="question-and-scope">&#13;
<h1>Question and Scope</h1>&#13;
&#13;
<p>Our original question<a contenteditable="false" data-primary="bus arrival times dataset" data-secondary="question and scope" data-type="indexterm" id="id804"/> comes from the experience of a regular bus rider wondering why their bus is always late. We are not looking for actual reasons for its lateness, like a traffic jam or maintenance delay. Instead, we want to study patterns in the actual arrival times of buses at a stop, compared to their scheduled times. This information will help us better understand what it’s like to wait for the bus.</p>&#13;
&#13;
<p>Bus lines differ across the world and even across a city, so we narrow our investigation to one bus stop in the city of Seattle. The data we have are for the stops of Seattle’s Rapid Ride lines C, D, and E at 3rd Avenue and Pike Street. The Washington State Transportation Center has provided times for all of the actual and scheduled stop times of these three bus lines between March 26 and May 27, 2016.</p>&#13;
&#13;
<p>Considering our narrowed scope to buses at one particular stop over a two-month period and our access to all of the administrative data collected in this window of time, the population, access frame, and sample are one and the same. Yet, we can imagine that our analysis might prove useful for other locations in and beyond Seattle and for other times of the year. If we are lucky, the ideas that we uncover, or the approach that we take, can be useful to others. For now, we keep a narrowed focus.</p>&#13;
&#13;
<p>Let’s take a look at these data to better understand their structure.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Data Wrangling" data-type="sect1"><div class="sect1" id="data-wrangling">&#13;
<h1>Data Wrangling</h1>&#13;
&#13;
<p>Before<a contenteditable="false" data-primary="bus arrival times dataset" data-secondary="wrangling data" data-type="indexterm" id="ix_bus_time_arriv_data_w"/> we start our analysis, we check the quality of the data, simplify the structure where possible, and derive new measurements that might help us in our analysis. We cover these types of operations in <a class="reference internal" data-type="xref" href="ch09.html#ch-wrangling">Chapter 9</a>, so don’t worry about the details of the code for now. Instead, focus on the differences between the data tables as we clean the data. We start by loading the data into Python.</p>&#13;
&#13;
&#13;
&#13;
<p>The first few rows in the data table are shown here:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">bus</code></span><span><code class="o">.</code></span><span><code class="n">head</code></span><span><code class="p">(</code></span><span><code class="mi">3</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>OPD_DATE</th>&#13;
			<th>VEHICLE_ID</th>&#13;
			<th>RTE</th>&#13;
			<th>DIR</th>&#13;
			<th>...</th>&#13;
			<th>STOP_ID</th>&#13;
			<th>STOP_NAME</th>&#13;
			<th>SCH_STOP_TM</th>&#13;
			<th>ACT_STOP_TM</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>2016-03-26</td>&#13;
			<td>6201</td>&#13;
			<td>673</td>&#13;
			<td>S</td>&#13;
			<td>...</td>&#13;
			<td>431</td>&#13;
			<td>3RD AVE &amp; PIKE ST (431)</td>&#13;
			<td>01:11:57</td>&#13;
			<td>01:13:19</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>2016-03-26</td>&#13;
			<td>6201</td>&#13;
			<td>673</td>&#13;
			<td>S</td>&#13;
			<td>...</td>&#13;
			<td>431</td>&#13;
			<td>3RD AVE &amp; PIKE ST (431)</td>&#13;
			<td>23:19:57</td>&#13;
			<td>23:16:13</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>2016-03-26</td>&#13;
			<td>6201</td>&#13;
			<td>673</td>&#13;
			<td>S</td>&#13;
			<td>...</td>&#13;
			<td>431</td>&#13;
			<td>3RD AVE &amp; PIKE ST (431)</td>&#13;
			<td>21:19:57</td>&#13;
			<td>21:18:46</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>3 rows × 9 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>(The raw data are available as comma-separated values in a file, which we have loaded into this table; see <a class="reference internal" data-type="xref" href="ch08.html#ch-files">Chapter 8</a> for details on this process.)</p>&#13;
&#13;
<p>It looks like some of the columns in the table might be redundant, like the columns labeled <code>STOP_ID</code> and <code>STOP_NAME</code>. We can find the number of unique values and their counts to confirm this:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">bus</code></span><span><code class="p">[</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">STOP_ID</code><code class="s1">'</code></span><span><code class="p">,</code></span><span><code class="s1">'</code><code class="s1">STOP_NAME</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">value_counts</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
STOP_ID  STOP_NAME              &#13;
578      3RD AVE &amp; PIKE ST (578)    19599&#13;
431      3RD AVE &amp; PIKE ST (431)    19318&#13;
dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>There are two <code>3RD <span class="pre">AVE</span> <span class="pre">&amp;</span> <span class="pre">PIKE</span> <span class="pre">ST</span></code> names for the stop. We wonder whether they are related to the direction of the bus, which we can check against the possible combinations of direction, stop ID, and stop name:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">bus</code></span><span><code class="p">[</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">DIR</code><code class="s1">'</code></span><span><code class="p">,</code></span><span><code class="s1">'</code><code class="s1">STOP_ID</code><code class="s1">'</code></span><span><code class="p">,</code></span><span><code class="s1">'</code><code class="s1">STOP_NAME</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">value_counts</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
DIR  STOP_ID  STOP_NAME              &#13;
N    578      3RD AVE &amp; PIKE ST (578)    19599&#13;
S    431      3RD AVE &amp; PIKE ST (431)    19318&#13;
dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Indeed, the northern direction corresponds to stop ID 578 and the southern direction corresponds to stop ID 431. Since we are looking at only one stop in our analysis, we don’t really need anything more than the direction.</p>&#13;
&#13;
<p>We can also check the number of unique route names:</p>&#13;
&#13;
<div class="cell tag_hide-input docutils container">&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
673    13228&#13;
674    13179&#13;
675    12510&#13;
Name: RTE, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>These routes are numbered and don’t match the names C, D, and E from the original description of the problem. This issue involves another aspect of data wrangling: we need to dig up information that connects the route letters and numbers. We can get this info from the Seattle transit site. Yet another part of wrangling is to translate data values into ones that are easier to understand, so we replace the route numbers with their letters:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="k">def</code></span><code> </code><span><code class="nf">clean_stops</code></span><span><code class="p">(</code></span><span><code class="n">bus</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="n">bus</code></span><span><code class="o">.</code></span><span><code class="n">assign</code></span><span><code class="p">(</code></span><code>&#13;
</code><code>        </code><span><code class="n">route</code></span><span><code class="o">=</code></span><span><code class="n">bus</code></span><span><code class="p">[</code></span><span><code class="s2">"</code><code class="s2">RTE</code><code class="s2">"</code></span><span><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">replace</code></span><span><code class="p">(</code><code class="p">{</code></span><span><code class="mi">673</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">C</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">674</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">D</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">675</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">E</code><code class="s2">"</code></span><span><code class="p">}</code><code class="p">)</code><code class="p">,</code></span><code>&#13;
</code><code>        </code><span><code class="n">direction</code></span><span><code class="o">=</code></span><span><code class="n">bus</code></span><span><code class="p">[</code></span><span><code class="s2">"</code><code class="s2">DIR</code><code class="s2">"</code></span><span><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">replace</code></span><span><code class="p">(</code><code class="p">{</code></span><span><code class="s2">"</code><code class="s2">N</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">northbound</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="s2">"</code><code class="s2">S</code><code class="s2">"</code></span><span><code class="p">:</code></span><code> </code><span><code class="s2">"</code><code class="s2">southbound</code><code class="s2">"</code></span><span><code class="p">}</code><code class="p">)</code><code class="p">,</code></span><code>&#13;
</code><code>    </code><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>We can also create new columns in the table that help us in our investigations. For example, we can use the scheduled and actual arrival times to calculate how late a bus is. Doing this requires some work with date and time formats, which is covered in <a class="reference internal" data-type="xref" href="ch09.html#ch-wrangling">Chapter 9</a>.</p>&#13;
&#13;
<p>Let’s examine the values of this new quantity to make sure that our calculations are correct:</p>&#13;
&#13;
<div class="cell tag_remove-input docutils container">&#13;
<div class="cell_output docutils container">&#13;
<div class="output stream highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
 smallest amount late: -12.87 minutes&#13;
 greatest amount late:  150.28 minutes&#13;
 median amount late:    0.52 minutes&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>It’s a bit surprising that there are negative values for how late a bus is, but this just means the bus arrived earlier than scheduled. While the median lateness is only about half a minute, some of the buses are 2.5 hours late! Let’s take a look at the histogram of how many minutes late the buses are:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">histogram</code></span><span><code class="p">(</code></span><span><code class="n">bus</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">minutes_late</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">nbins</code></span><span><code class="o">=</code></span><span><code class="mi">120</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">450</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">300</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>             </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">minutes_late</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s1">'</code><code class="s1">Minutes late</code><code class="s1">'</code></span><span><code class="p">}</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-75"><div class="figure"><img src="assets/leds_05in01.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>We saw a similarly shaped histogram in <a class="reference internal" data-type="xref" href="ch04.html#ch-modeling">Chapter 4</a>. The distribution of how late the buses are is highly skewed to the right, but many arrive close to on time.</p>&#13;
&#13;
<p>Finally, we conclude our wrangling by creating a simplified version of the data table. Since we only need to keep track of the route, direction, scheduled and actual arrival time, and how late the bus is, we create a smaller table and give the columns names that are a bit easier to read:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre class="pagebreak-before less_space" data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">bus</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">bus</code></span><span><code class="p">[</code><code class="p">[</code></span><span><code class="s2">"</code><code class="s2">route</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="s2">"</code><code class="s2">direction</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="s2">"</code><code class="s2">scheduled</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="s2">"</code><code class="s2">actual</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="s2">"</code><code class="s2">minutes_late</code><code class="s2">"</code></span><span><code class="p">]</code><code class="p">]</code></span><code>&#13;
</code><span><code class="n">bus</code></span><span><code class="o">.</code></span><span><code class="n">head</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>route</th>&#13;
			<th>direction</th>&#13;
			<th>scheduled</th>&#13;
			<th>actual</th>&#13;
			<th>minutes_late</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>C</td>&#13;
			<td>southbound</td>&#13;
			<td>2016-03-26 01:11:57</td>&#13;
			<td>2016-03-26 01:13:19</td>&#13;
			<td class="right">1.37</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>C</td>&#13;
			<td>southbound</td>&#13;
			<td>2016-03-26 23:19:57</td>&#13;
			<td>2016-03-26 23:16:13</td>&#13;
			<td class="right">-3.73</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>C</td>&#13;
			<td>southbound</td>&#13;
			<td>2016-03-26 21:19:57</td>&#13;
			<td>2016-03-26 21:18:46</td>&#13;
			<td class="right">-1.18</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3</strong></td>&#13;
			<td>C</td>&#13;
			<td>southbound</td>&#13;
			<td>2016-03-26 19:04:57</td>&#13;
			<td>2016-03-26 19:01:49</td>&#13;
			<td class="right">-3.13</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>4</strong></td>&#13;
			<td>C</td>&#13;
			<td>southbound</td>&#13;
			<td>2016-03-26 16:42:57</td>&#13;
			<td>2016-03-26 16:42:39</td>&#13;
			<td class="right">-0.30</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>These table manipulations are covered in <a class="reference internal" data-type="xref" href="ch06.html#ch-pandas">Chapter 6</a>.</p>&#13;
&#13;
<p>Before we begin to model bus lateness, we want to explore and learn more about these data. We do that next.<a contenteditable="false" data-primary="" data-startref="ix_bus_time_arriv_data_w" data-type="indexterm" id="id805"/></p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Exploring Bus Times" data-type="sect1"><div class="sect1" id="exploring-bus-times">&#13;
<h1>Exploring Bus Times</h1>&#13;
&#13;
<p>We learned<a contenteditable="false" data-primary="exploratory data analysis (EDA)" data-secondary="bus arrival times dataset" data-type="indexterm" id="ix_expl_bus_time_arriv"/><a contenteditable="false" data-primary="bus arrival times dataset" data-secondary="exploring phase" data-type="indexterm" id="ix_bus_time_arriv_exp"/> a lot about the data as we cleaned and simplified it, but before we begin to model wait time, we want to dig deeper to better understand the phenomenon of bus lateness. We narrowed our focus to the bus activity at one stop (3rd Avenue and Pike Street) over a two-month period. And we saw that the distribution of the lateness of a bus is skewed to the right, with some buses being very late indeed. In this exploratory phase, we might ask:</p>&#13;
&#13;
<ul>&#13;
	<li>&#13;
	<p>Does the distribution of lateness look the same for all three bus lines?</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Does it matter whether the bus is traveling north or south?</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>How does the time of day relate to how late the bus is?</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Are the buses scheduled to arrive at regular intervals throughout the day?</p>&#13;
	</li>&#13;
</ul>&#13;
&#13;
<p>Answering these questions helps us better determine how to model.</p>&#13;
&#13;
<p>Recall from <a class="reference internal" data-type="xref" href="ch04.html#ch-modeling">Chapter 4</a> that we found the median time a bus was late was 3/4 of a minute. But this doesn’t match the median we calculated for all bus routes and directions (1/2 a minute). Let’s check whether that could be due to the focus on northbound line C buses in that chapter. Let’s create histograms of lateness for each of the six combinations of bus line and direction to address this question and the first two questions on our list:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_05in02.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The scale on the y-axis is proportion (or density). This scale makes it easier to compare the histograms since we are not misled by different counts in the groups. The range on the x-axis is the same across the six plots, making it easier to detect the different center and spread of the distributions. (These notions are described in <span class="keep-together"><a class="reference internal" data-type="xref" href="ch11.html#ch-viz">Chapter 11</a></span>.)</p>&#13;
&#13;
<p>The northbound and southbound distributions are different for each line. When we dig deeper into the context, we learn that line C originates in the north and the other two lines originate in the south. The histograms imply there is greater variability in arrival times in the second half of the bus routes, which makes sense to us since delays get compounded as the day progresses.</p>&#13;
&#13;
<p>Next, to explore lateness by time of day, we need to derive a new quantity: the hour of the day that the bus is scheduled to arrive. Given the variation in route and direction that we just saw in bus lateness, we again create separate plots for each route and direction:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_05in03.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>Indeed, there does appear to be a rush-hour effect, and it seems worse for the evening rush hour compared to the morning. The northbound C line looks to be the most impacted.</p>&#13;
&#13;
<p>Lastly, to examine the scheduled frequency of the buses, we need to compute the intervals between scheduled bus times. We create a new column in our table that contains the time between the scheduled arrival times for the northbound C buses:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">minute</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">Timedelta</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">1 minute</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">bus_c_n</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><code>&#13;
</code><code>    </code><span><code class="n">bus</code></span><span><code class="p">[</code><code class="p">(</code></span><span><code class="n">bus</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">route</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="s1">'</code><code class="s1">C</code><code class="s1">'</code></span><span><code class="p">)</code></span><code> </code><span><code class="o">&amp;</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">bus</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">direction</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="s1">'</code><code class="s1">northbound</code><code class="s1">'</code></span><span><code class="p">)</code><code class="p">]</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">sort_values</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">scheduled</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">assign</code></span><span><code class="p">(</code></span><span><code class="n">sched_inter</code></span><span><code class="o">=</code></span><span><code class="k">lambda</code></span><code> </code><span><code class="n">x</code></span><span><code class="p">:</code></span><code> </code><span><code class="n">x</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">scheduled</code><code class="s1">'</code></span><span><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">diff</code></span><span><code class="p">(</code><code class="p">)</code></span><code> </code><span><code class="o">/</code></span><code> </code><span><code class="n">minute</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">bus_c_n</code></span><span><code class="o">.</code></span><span><code class="n">head</code></span><span><code class="p">(</code></span><span><code class="mi">3</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>route</th>&#13;
			<th>direction</th>&#13;
			<th>scheduled</th>&#13;
			<th>actual</th>&#13;
			<th>minutes_late</th>&#13;
			<th>sched_inter</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>19512</strong></td>&#13;
			<td>C</td>&#13;
			<td>northbound</td>&#13;
			<td>2016-03-26 00:00:25</td>&#13;
			<td>2016-03-26 00:05:01</td>&#13;
			<td class="right">4.60</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>19471</strong></td>&#13;
			<td>C</td>&#13;
			<td>northbound</td>&#13;
			<td>2016-03-26 00:30:25</td>&#13;
			<td>2016-03-26 00:30:19</td>&#13;
			<td class="right">-0.10</td>&#13;
			<td>30.0</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>19487</strong></td>&#13;
			<td>C</td>&#13;
			<td>northbound</td>&#13;
			<td>2016-03-26 01:05:25</td>&#13;
			<td>2016-03-26 01:10:15</td>&#13;
			<td class="right">4.83</td>&#13;
			<td>35.0</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Let’s examine a histogram of the distribution of inter-arrival times of these buses:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">histogram</code></span><span><code class="p">(</code></span><span><code class="n">bus_c_n</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">sched_inter</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><code>&#13;
</code><code>                   </code><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Bus line C, northbound</code><code class="s2">"</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                   </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">450</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">300</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_xaxes</code></span><span><code class="p">(</code></span><span><code class="nb">range</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="mi">0</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">40</code></span><span><code class="p">]</code><code class="p">,</code></span><code> </code><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Time between consecutive buses</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_layout</code></span><span><code class="p">(</code></span><span><code class="n">margin</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">t</code></span><span><code class="o">=</code></span><span><code class="mi">40</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-75"><div class="figure"><img src="assets/leds_05in04.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>We see that the buses are scheduled to arrive at different intervals throughout the day. In this two-month period, about 1,500 of the buses are scheduled to arrive 12 minutes apart and about 1,400 are supposed to arrive 15 minutes after the previous bus.</p>&#13;
&#13;
<p>We have learned a lot in our exploration of the data and are in a better position to fit a model. Most notably, if we want to get a clear picture of the experience of waiting for a bus, we need to take into account the scheduled interval between buses, as well as the bus line and direction<a contenteditable="false" data-startref="ix_bus_time_arriv_exp" data-type="indexterm" id="id806"/><a contenteditable="false" data-primary="" data-startref="ix_expl_bus_time_arriv" data-type="indexterm" id="id807"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Modeling Wait Times" data-type="sect1"><div class="sect1" id="modeling-wait-times">&#13;
<h1>Modeling Wait Times</h1>&#13;
&#13;
<p>We are interested in modeling<a contenteditable="false" data-primary="bus arrival times dataset" data-secondary="modeling wait times" data-type="indexterm" id="ix_bus_time_arriv_mod"/> the experience of someone waiting at a bus stop. We could develop a complex model that involves the intervals between scheduled arrivals, the bus line, and direction. Instead, we take a simpler approach and narrow the focus to one line, one direction, and one scheduled interval. We examine the northbound C line stops that are scheduled to arrive 12 minutes apart:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">bus_c_n_12</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">bus_c_n</code></span><span><code class="p">[</code></span><span><code class="n">bus_c_n</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">sched_inter</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="mi">12</code></span><span><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Both the complex and the narrow approaches are legitimate, but we do not yet have the tools to approach the complex model (see <a class="reference internal" data-type="xref" href="ch15.html#ch-linear">Chapter 15</a> for more details on <span class="keep-together">modeling</span>).</p>&#13;
&#13;
<p>So far, we have examined the distribution of the number of minutes the bus is late. We create another histogram of this delay for the subset of data that we are analyzing (northbound C line stops that are scheduled to arrive 12 minutes after the previous bus):</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">histogram</code></span><span><code class="p">(</code></span><span><code class="n">bus_c_n_12</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">minutes_late</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                   </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">minutes_late</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s1">'</code><code class="s1">Minutes late</code><code class="s1">'</code></span><span><code class="p">}</code><code class="p">,</code></span><code>&#13;
</code><code>                   </code><span><code class="n">nbins</code></span><span><code class="o">=</code></span><span><code class="mi">120</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">450</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">300</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">add_annotation</code></span><span><code class="p">(</code></span><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="mi">20</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="mi">150</code></span><span><code class="p">,</code></span><code>  </code><span><code class="n">showarrow</code></span><span><code class="o">=</code></span><span><code class="kc">False</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>  </code><span><code class="n">text</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Line C, northbound&lt;br&gt;Scheduled arrivals: 12 minutes apart</code><code class="s2">"</code></span><code> </code><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_xaxes</code></span><span><code class="p">(</code></span><span><code class="nb">range</code></span><span><code class="o">=</code></span><span><code class="p">[</code></span><span><code class="o">-</code></span><span><code class="mi">13</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">40</code></span><span><code class="p">]</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">show</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-75"><div class="figure"><img src="assets/leds_05in05.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>And let’s calculate the minimum, maximum, and median lateness:</p>&#13;
&#13;
<div class="cell tag_hide-input docutils container">&#13;
<div class="cell_output docutils container">&#13;
<div class="output stream highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
smallest amount late:  -10.20 minutes&#13;
greatest amount late:  57.00 minutes&#13;
median amount late:    -0.50 minutes&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Interestingly, the northbound buses on the C line that are 12 minutes apart are more often early than not!</p>&#13;
&#13;
<p>Now let’s revisit our question to confirm that we are on track for answering it. A summary of how late the buses are does not quite address the experience of the person waiting for the bus. When someone arrives at a bus stop, they need to wait for the next bus to arrive. <a class="reference internal" data-type="xref" href="#busdiagram">Figure 5-1</a> shows an idealization of time passing as passengers and buses arrive at the bus stop. If people are arriving at the bus stop at random times, notice that they are more likely to arrive in a time interval where the bus is delayed because there’s a longer interval between buses. This arrival pattern is an example of size-biased sampling. So to answer the question of what people experience when waiting for a bus, we need to do more than summarize how late the bus is.</p>&#13;
&#13;
<figure><div class="figure" id="busdiagram"><img src="assets/leds_0501.png"/>&#13;
<h6><span class="label">Figure 5-1. </span>Idealized timeline with buses arriving (rectangles), passengers arriving (circles), and time the rider waits for the next bus to arrive (curly brackets)</h6>&#13;
</div></figure>&#13;
&#13;
<p>We can design a simulation<a contenteditable="false" data-primary="simulation studies" data-secondary="bus wait times" data-type="indexterm" id="ix_sim_stud_bus"/> that mimics waiting for a bus over the course of one day, using the ideas from <a class="reference internal" data-type="xref" href="ch03.html#ch-theory-datadesign">Chapter 3</a>. To do this, we set up a string of scheduled bus arrivals that are 12 minutes apart from 6 a.m. to midnight:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">scheduled</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="mi">12</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">arange</code></span><span><code class="p">(</code></span><span><code class="mi">91</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">scheduled</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
array([   0,   12,   24, ..., 1056, 1068, 1080])&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Then, for each scheduled arrival, we simulate its actual arrival time by adding a random number of minutes each bus is late. To do this, we choose the minutes late from the distribution of observed lateness of the actual buses. Notice how we have incorporated the real data in our simulation study by using the distribution of actual delays of the buses that are 12 minutes apart:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">minutes_late</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">bus_c_n_12</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">minutes_late</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><span><code class="n">actual</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">scheduled</code></span><code> </code><span><code class="o">+</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">random</code></span><span><code class="o">.</code></span><span><code class="n">choice</code></span><span><code class="p">(</code></span><span><code class="n">minutes_late</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">size</code></span><span><code class="o">=</code></span><span><code class="mi">91</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">replace</code></span><span><code class="o">=</code></span><span><code class="kc">True</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>We need to sort these arrival times because when a bus is super late, another may well come along before it:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">actual</code></span><span><code class="o">.</code></span><span><code class="n">sort</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">actual</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
array([  -1.2 ,   25.37,   32.2 , ..., 1051.02, 1077.  , 1089.43])&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>We also need to simulate the arrival of people at the bus stop at random times throughout the day. We can use another, different urn model for the passenger arrivals. For the passengers, we put a marble in the urn with a time on it. These run from time 0, which stands for 6 a.m., to the arrival of the last bus at midnight, which is 1,068 minutes past 6 a.m. To match the way the bus times are measured in our data, we make the times 1/100th of a minute apart:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">pass_arrival_times</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">arange</code></span><span><code class="p">(</code></span><span><code class="mi">100</code></span><span><code class="o">*</code></span><span><code class="mi">1068</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">pass_arrival_times</code></span><code> </code><span><code class="o">/</code></span><code> </code><span><code class="mi">100</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
array([   0.  ,    0.01,    0.02, ..., 1067.97, 1067.98, 1067.99])&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Now we can simulate the arrival of, say, five hundred people at the bus stop throughout the day. We draw five hundred times from this urn, replacing the marbles between draws:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">sim_arrival_times</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><code>&#13;
</code><code>    </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">random</code></span><span><code class="o">.</code></span><span><code class="n">choice</code></span><span><code class="p">(</code></span><span><code class="n">pass_arrival_times</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">size</code></span><span><code class="o">=</code></span><span><code class="mi">500</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">replace</code></span><span><code class="o">=</code></span><span><code class="kc">True</code></span><span><code class="p">)</code></span><code> </code><span><code class="o">/</code></span><code> </code><span><code class="mi">100</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">sim_arrival_times</code></span><span><code class="o">.</code></span><span><code class="n">sort</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">sim_arrival_times</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
array([   2.06,    3.01,    8.54, ..., 1064.  , 1064.77, 1066.42])&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>To find out how long each individual waits, we look for the soonest bus to arrive after their sampled time. The difference between these two times (the sampled time of the person and the soonest bus arrival after that) is how long the person waits:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">i</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">searchsorted</code></span><span><code class="p">(</code></span><span><code class="n">actual</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">sim_arrival_times</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">side</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">right</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">sim_wait_times</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">actual</code></span><span><code class="p">[</code></span><span><code class="n">i</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">-</code></span><code> </code><span><code class="n">sim_arrival_times</code></span><code>&#13;
</code><span><code class="n">sim_wait_times</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
array([23.31, 22.36, 16.83, ..., 13.  , 12.23, 10.58])&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>We can set up a complete simulation where we simulate, say, two hundred days of bus arrivals, and for each day, we simulate five hundred people arriving at the bus stop at random times throughout the day. In total, that’s 100,000 simulated wait times:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">sim_wait_times</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">[</code><code class="p">]</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="k">for</code></span><code> </code><span><code class="n">day</code></span><code> </code><span><code class="ow">in</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">arange</code></span><span><code class="p">(</code></span><span><code class="mi">0</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">200</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">1</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="n">bus_late</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">random</code></span><span><code class="o">.</code></span><span><code class="n">choice</code></span><span><code class="p">(</code></span><span><code class="n">minutes_late</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">size</code></span><span><code class="o">=</code></span><span><code class="mi">91</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">replace</code></span><span><code class="o">=</code></span><span><code class="kc">True</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="n">actual</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">scheduled</code></span><code> </code><span><code class="o">+</code></span><code> </code><span><code class="n">bus_late</code></span><code>&#13;
</code><code>    </code><span><code class="n">actual</code></span><span><code class="o">.</code></span><span><code class="n">sort</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="n">sim_arrival_times</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><code>&#13;
</code><code>        </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">random</code></span><span><code class="o">.</code></span><span><code class="n">choice</code></span><span><code class="p">(</code></span><span><code class="n">pass_arrival_times</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">size</code></span><span><code class="o">=</code></span><span><code class="mi">500</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">replace</code></span><span><code class="o">=</code></span><span><code class="kc">True</code></span><span><code class="p">)</code></span><code> </code><span><code class="o">/</code></span><code> </code><span><code class="mi">100</code></span><code>&#13;
</code><code>    </code><span><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="n">sim_arrival_times</code></span><span><code class="o">.</code></span><span><code class="n">sort</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="n">i</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">searchsorted</code></span><span><code class="p">(</code></span><span><code class="n">actual</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">sim_arrival_times</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">side</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">right</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>    </code><span><code class="n">sim_wait_times</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">append</code></span><span><code class="p">(</code></span><span><code class="n">sim_wait_times</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">actual</code></span><span><code class="p">[</code></span><span><code class="n">i</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">-</code></span><code> </code><span><code class="n">sim_arrival_times</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Let’s make a histogram of these simulated wait times to examine the distribution:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">histogram</code></span><span><code class="p">(</code></span><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="n">sim_wait_times</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">nbins</code></span><span><code class="o">=</code></span><span><code class="mi">40</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                   </code><span><code class="n">histnorm</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">probability density</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                   </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">450</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">300</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_xaxes</code></span><span><code class="p">(</code></span><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Simulated wait times for 100,000 passengers</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_yaxes</code></span><span><code class="p">(</code></span><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">proportion</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">show</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_05in06.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>As we expect, we find a skewed distribution. We can model this with a constant where we use absolute loss to select the best constant. We saw in <a class="reference internal" data-type="xref" href="ch04.html#ch-modeling">Chapter 4</a> that absolute loss gives us the median wait time:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="nb">print</code></span><span><code class="p">(</code></span><span><code class="sa">f</code></span><span><code class="s2">"</code><code class="s2">Median wait time: </code></span><span><code class="si">{</code></span><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">median</code></span><span><code class="p">(</code></span><span><code class="n">sim_wait_times</code></span><span><code class="p">)</code></span><span><code class="si">:</code></span><span><code class="s2">.2f</code></span><span><code class="si">}</code></span><span><code class="s2"> minutes</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output stream highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
Median wait time: 6.49 minutes&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>The median of about six and a half minutes doesn’t seem too long. While our model captures the typical wait time, we also want to provide an estimate of the variability in the process. This topic is covered in <a class="reference internal" data-type="xref" href="ch17.html#ch-inf-pred-theory">Chapter 17</a>. We can compute the upper quartile of wait times to give us a sense of variability:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="nb">print</code></span><span><code class="p">(</code></span><span><code class="sa">f</code></span><span><code class="s2">"</code><code class="s2">Upper quartile: </code></span><span><code class="si">{</code></span><span><code class="n">np</code></span><span><code class="o">.</code></span><span><code class="n">quantile</code></span><span><code class="p">(</code></span><span><code class="n">sim_wait_times</code></span><span><code class="p">,</code></span><code> </code><span><code class="mf">0.75</code></span><span><code class="p">)</code></span><span><code class="si">:</code></span><span><code class="s2">.2f</code></span><span><code class="si">}</code></span><span><code class="s2"> minutes</code><code class="s2">"</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output stream highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
Upper quartile: 10.62 minutes&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>The upper quartile is quite large. It’s undoubtedly memorable when you have to wait more than 10 minutes for a bus that is supposed to arrive every 12 minutes, and this happens one in four times you take the bus<a contenteditable="false" data-primary="" data-startref="ix_sim_stud_bus" data-type="indexterm" id="id808"/><a contenteditable="false" data-primary="" data-startref="ix_bus_time_arriv_mod" data-type="indexterm" id="id809"/>!</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="sec-bus-summary">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>In our first case study, we have traversed the full lifecycle of data modeling. It might strike you that such a simple question is not immediately answerable with the data collected. We needed to combine the data of scheduled and actual arrival times of buses with a simulation study of riders arriving at the bus stop at random times to uncover the riders’ waiting experience.</p>&#13;
&#13;
<p>This simulation simplified many of the real patterns in bus riding. We focused on one bus line traveling in one direction with buses arriving at 12-minute intervals. Further, the exploration of the data revealed that the patterns in lateness correlated with the time of day, which we have not accounted for in our analysis. Nonetheless, our findings can still be useful. For example, they confirm that the typical wait time is longer than half the scheduled interval. And the distribution of wait times has a long right tail, meaning a rider’s experience may well be impacted by the variability in the <span class="keep-together">process</span>.</p>&#13;
&#13;
<p>We also saw how deriving new quantities, such as how late a bus is and the time between buses, and exploring the data can be useful in modeling. Our histograms showed that the particular line and direction of the bus matter and they need to be accounted for. We also discovered that the schedules change throughout the day, with many buses arriving 10, 12, and 15 minutes after another, and some arriving more frequently or more separated. This observation further informed the modeling stage<a contenteditable="false" data-primary="" data-startref="ix_bus_time_arriv" data-type="indexterm" id="id810"/><a contenteditable="false" data-primary="" data-startref="ix_lifecycle_bus_time_arriv" data-type="indexterm" id="id811"/>.</p>&#13;
&#13;
<p>Finally, we used data tools, such as the <code>pandas</code> and <code>plotly</code> libraries, that will be covered in later chapters. Our focus here was not on how to manipulate tables or how to create a plot. Instead, we focused on the lifecycle, connecting questions to data to modeling to conclusions. In the next chapter, we turn to the practicalities of working with data tables.</p>&#13;
</div></section>&#13;
</div></section></body></html>