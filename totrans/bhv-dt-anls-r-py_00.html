<html><head></head><body><div id="sbo-rt-content"><section data-type="preface" epub:type="preface" data-pdf-bookmark="Preface"><div class="preface" id="preface">
<h1>Preface</h1>
<blockquote data-type="epigraph" epub:type="epigraph">
<p>Statistics is a subject of amazingly many uses and surprisingly few effective practitioners.</p>
<p data-type="attribution">Bradley Efron and R. J. Tibshirani, <em>An Introduction to the Bootstrap</em> (1993)<a contenteditable="false" data-type="indexterm" data-primary="An Introduction to the Bootstrap (Efron and Tibshirani)" data-primary-sortas="Introduction to the Bootstrap" id="idm45968170754344"/><a contenteditable="false" data-type="indexterm" data-primary="Efron, Bradley" id="idm45968170752792"/><a contenteditable="false" data-type="indexterm" data-primary="Tibshirani, R. J." id="idm45968172098712"/></p>
</blockquote>
<p>Welcome to <em>Behavioral Data Analysis with R and Python</em>! That we live in the age of data has become a platitude. Engineers now routinely use data from sensors on machines and turbines to predict when these will fail and do preventive maintenance. Similarly, marketers use troves of data, from your demographic information to your past purchases, to determine which ad to serve you and when. As the phrase goes, “Data is the new oil,” and algorithms are the new combustion engine powering our economy forward.</p>
<p>Most books on analytics, machine learning, and data science implicitly presume that the problems that engineers and marketers are trying to solve can be handled with the same approaches and tools. Sure, the variables have different names and there is some domain-specific knowledge to acquire, but k-means clustering is k-means clustering, whether you’re clustering data about turbines or posts on social media. By adopting machine learning tools wholesale this way, businesses have often been able to accurately predict behaviors, but at the expense of a deeper and richer understanding of what’s actually going on. This has fed into the criticism of data science models as “black boxes.”</p>
<p>Instead of aiming for accurate but opaque predictions, this book strives to answer the question, “What drives behavior?” If we decide to send an email to prospective customers, will they buy a subscription to our service <em>as a result of the email</em>? And which groups of customers should receive the email? Do older customers tend to purchase different products <em>because</em> they’re older? What is the impact of customer experience on loyalty and retention? By shifting our perspective from predicting behaviors to explaining them and measuring their causes, we’ll be able to break the curse of “correlation is not causation,” which has prevented generations of analysts from being confident in the results of their models.</p>
<p>This shift won’t come from the introduction of new analytical tools: <a contenteditable="false" data-type="indexterm" data-primary="regression" data-secondary="about book" id="idm45968171833560"/>we’ll use only two data analysis tools: good old linear regression and its logistic sibling. These two are intrinsically more readable than other types of models. Certainly, this often comes at the cost of a lower predictive accuracy (i.e., they make more and larger errors in prediction), but that doesn’t matter for our purpose here of measuring relationships between variables.</p>
<p>Instead we’ll spend a lot of time learning to make sense of data. In my role as a data science interviewer, I have seen many candidates who can use sophisticated machine learning algorithms but haven’t developed a strong sense for data: they have little intuition for what’s going on in their data apart from what their algorithms tell them.</p>
<p>I believe that you can develop that intuition, and along the way increase the value and outcomes of your analytics projects—often dramatically—by adopting the following:<a contenteditable="false" data-type="indexterm" data-primary="data" data-secondary="about intuition" id="idm45968171830376"/><a contenteditable="false" data-type="indexterm" data-primary="causal-behavioral framework" data-secondary="about" id="idm45968172040584"/><a contenteditable="false" data-type="indexterm" data-primary="intuition" data-secondary="about data" id="idm45968172039240"/></p>
<ul>
<li><p>A behavioral science mindset, which sees data not as an end in itself but as a lens into the psychology and behaviors of human beings</p></li>
<li><p>A causal analytics toolkit, which allows us to confidently say that one thing causes another and to determine how strong that relationship is</p></li>
</ul>
<p>While each of these can provide great benefits on its own, I believe that they are natural complements that are best used together. Given that “a behavioral science mindset using a causal analytics toolkit” is a bit of a mouthful, I’ll call it instead a causal-behavioral approach or framework. This framework has an added benefit: it applies equally to experimental and historical data while leveraging the differences between them. This contrasts with traditional analytics, which handles them with completely different tools (e.g., ANOVA and T-test for experimental data) and data science, which doesn’t treat experimental data differently from historical data.</p>
<section data-type="sect1" data-pdf-bookmark="Who This Book Is For"><div class="sect1" id="who_this_book_is_for">
<h1>Who This Book Is For</h1>
<p>If you’re analyzing data in a business with R or Python, this book is for you. I use the word “business” loosely to mean any for-profit, nonprofit, or governmental organization where correct insights and actionable conclusions driving action are what <span class="keep-together">matters.</span></p>
<p>In terms of math and stats background, it doesn’t matter whether you are a business analyst building monthly forecasts, a UX researcher looking at click-through behaviors, or a data scientist building machine learning models. This book has one fundamental prerequisite: you need to be at least somewhat familiar with linear and logistic regression. If you understand regression, you can follow the argument of this book and reap great benefits from it. On the other side of the spectrum, I believe even expert data scientists with PhDs in statistics or computer science will find the <span class="keep-together">material</span> new and useful, provided they are not already specialists in behavioral or causal analytics.</p>
<p>In terms of programming background, you need to be able to read and write code in R or Python, ideally both. I will not show you how to define a function or how to manipulate data structures such as data frames or pandas. <a contenteditable="false" data-type="indexterm" data-primary="Python for Data Analysis (McKinney)" id="idm45968158848696"/><a contenteditable="false" data-type="indexterm" data-primary="resources for information" data-secondary="Python for Data Analysis book" id="idm45968158847624"/><a contenteditable="false" data-type="indexterm" data-primary="resources for information" data-secondary="R for Data Science book" id="idm45968158846312"/><a contenteditable="false" data-type="indexterm" data-primary="McKinney, Wes" id="idm45968170548648"/><a contenteditable="false" data-type="indexterm" data-primary="R for Data Science (Grolemund and Wickham)" id="idm45968170547544"/><a contenteditable="false" data-type="indexterm" data-primary="Grolemund, Garrett" id="idm45968170546472"/><a contenteditable="false" data-type="indexterm" data-primary="Wickham, Hadley" id="idm45968170545368"/>There are already excellent books doing a better job of it than I would (e.g., <a class="orm:hideurl" href="https://www.oreilly.com/library/view/python-for-data/9781491957653/"><em>Python for Data Analysis</em></a> by Wes McKinney (O’Reilly) and <a class="orm:hideurl" href="https://www.oreilly.com/library/view/r-for-data/9781491910382/"><em>R for Data Science</em></a> by Garrett Grolemund and Hadley Wickham (O’Reilly)). If you’ve read any of these books, taken an introductory class, or used at least one of the two languages at work, then you’ll be equipped for the material here. Similarly, I will usually not present and discuss the code used to create the numerous figures in the book, although it will be in the book’s GitHub.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Who This Book Is Not For"><div class="sect1" id="who_this_book_is_not_for">
<h1>Who This Book Is Not For</h1>
<p>If you’re in academia or a field that requires you to follow academic norms (e.g., pharmaceutical trials), this book might still be of interest to you—but the recipes I’m describing might get you in trouble with your advisor/editor/manager.</p>
<p>This book is <em>not</em> an overview of conventional behavioral data analysis methods, such as T-test or ANOVA. <a contenteditable="false" data-type="indexterm" data-primary="regression" data-secondary="about book" id="idm45968171891256"/>I have yet to encounter a situation where regression was less effective than these methods for providing an answer to a business question, which is why I’m deliberately restraining this book to linear and logistic regression. <a contenteditable="false" data-type="indexterm" data-primary="Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow (Géron)" id="idm45968171889512"/><a contenteditable="false" data-type="indexterm" data-primary="Géron, Aurélien" id="idm45968171888440"/>If you want to learn other methods, you’ll have to look elsewhere (e.g., <a class="orm:hideurl" href="https://www.oreilly.com/library/view/hands-on-machine-learning/9781492032632/"><em>Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</em></a> (O’Reilly) by Aurélien Géron for machine learning algorithms).</p>
<p>Understanding and changing behaviors in applied settings<a contenteditable="false" data-type="indexterm" data-primary="causal-behavioral framework" data-secondary="about" id="idm45968171885160"/> requires both data analysis and qualitative skills. This book focuses squarely on the former, primarily for reasons of space. <a contenteditable="false" data-type="indexterm" data-primary="Nudge: Improving Decisions About Health, Wealth, and Happiness (Thaler and Sunstein)" id="idm45968171927752"/><a contenteditable="false" data-type="indexterm" data-primary="resources for information" data-secondary="Nudge: Improving Decisions book" id="idm45968171926680"/><a contenteditable="false" data-type="indexterm" data-primary="Thaler, Richard" id="idm45968171925272"/><a contenteditable="false" data-type="indexterm" data-primary="Sunstein, Cass" id="idm45968171924168"/><a contenteditable="false" data-type="indexterm" data-primary="Designing for Behavior Change: Applying Psychology and Behavioral Economics (Wendel)" id="idm45968171923064"/><a contenteditable="false" data-type="indexterm" data-primary="Wendel, Stephen" data-secondary="Designing for Behavior Change book" id="idm45968171921992"/>In addition, there are already excellent books that cover the latter, such as <em>Nudge: Improving Decisions About Health, Wealth, and Happiness</em> (Penguin) by Richard Thaler and Cass Sunstein and <a class="orm:hideurl" href="https://www.oreilly.com/library/view/designing-for-behavior/9781492056027/"><em>Designing for Behavior Change: Applying Psychology and Behavioral Economics</em></a> (O’Reilly) by Stephen Wendel. Nonetheless, I’ll provide an introduction to behavioral science concepts so that you can apply the tools from this book even if you’re new to the field.</p>
<p>Finally, if you’re completely new to data analysis in R or Python, this is not the book for you. I recommend starting with some of the excellent introductions out there, such as the ones mentioned in this section.</p>
</div></section>
<section data-type="sect1" class="pagebreak-before" data-pdf-bookmark="R and Python Code"><div class="sect1" id="r_and_python_code">
<h1 class="less_space">R and Python Code</h1>
<p>Why R <em>and</em> Python? Why not whichever of the two is superior? <a contenteditable="false" data-type="indexterm" data-primary="R" data-secondary="about R versus Python" id="idm45968172223032"/><a contenteditable="false" data-type="indexterm" data-primary="Python" data-secondary="about R versus Python" id="idm45968172221656"/>The “R versus Python” debate is still alive and kicking on the Internet. It is also, in my humble opinion, mostly irrelevant. The reality is that you’ll have to use whatever language is used in your organization, period. I once worked in a healthcare company where, for historical and regulatory reasons, SAS was the dominant language. I regularly used R and Python for my own analyses, but since I couldn’t avoid dealing with the legacy SAS code, I taught myself as much SAS as I needed during my first month there. Unless you spend your entire career in a company that doesn’t use R or Python, you’ll most likely end up picking up some basics in both anyway, so you might as well embrace bilingualism. I have yet to encounter anyone who stated that “learning to read code in [the other language] was a waste of my time.”</p>
<p>Assuming that you have the good luck of being in an organization that uses both, which language should you work with? I think it really depends on your context and the tasks you have to do. For example, I personally prefer doing exploratory data analysis (EDA) in R, but I find that Python is much easier to use for webscraping. I advise choosing based on the specifics of your job and relying on up-to-date information: both languages are constantly improving, and what was true for a previous version of R or Python may not be true for the current version. For example, Python is becoming a much friendlier environment for EDA than it once was. Your energy is better spent on learning both than on scouring forums to pick the best of the two.</p>
<section data-type="sect2" data-pdf-bookmark="Code Environments"><div class="sect2" id="code_environments">
<h2>Code Environments</h2>
<p>At the beginning of each chapter, I’ll call out the R and Python packages<a contenteditable="false" data-type="indexterm" data-primary="code" data-secondary="book coding conventions" id="idm45968171938024"/><a contenteditable="false" data-type="indexterm" data-primary="book coding conventions" id="idm45968171936552"/><a contenteditable="false" data-type="indexterm" data-primary="R" data-secondary="about packages" id="idm45968171935448"/><a contenteditable="false" data-type="indexterm" data-primary="Python" data-secondary="about packages" id="idm45968171934072"/><a contenteditable="false" data-type="indexterm" data-primary="packages" data-secondary="about standard packages" id="idm45968171932696"/><a contenteditable="false" data-type="indexterm" data-primary="GitHub" data-secondary="about standard packages" id="idm45968171931320"/><a contenteditable="false" data-type="indexterm" data-primary="Bootstrap" data-secondary="about package required" id="idm45968171929944"/> that need to be loaded specifically for that chapter. In addition, I’ll also be using a few standard packages across the entire book; to avoid repetition, these are called out only here (they are already included in all the scripts on GitHub). You should always start your code with them as well as with a few parameter settings:<a contenteditable="false" data-type="indexterm" data-primary="random seed via set.seed()" id="idm45968172030376"/><a contenteditable="false" data-type="indexterm" data-primary="set.seed() for random seed" id="idm45968172029304"/><a contenteditable="false" data-type="indexterm" data-primary="scientific number notation canceled" id="idm45968172028232"/><a contenteditable="false" data-type="indexterm" data-primary="code" data-secondary="about packages and parameters" id="idm45968172027160"/><a contenteditable="false" data-type="indexterm" data-primary="pandas imported as pd" id="idm45968172025768"/><a contenteditable="false" data-type="indexterm" data-primary="NumPy" data-secondary="importing as np" id="idm45968172024664"/></p>
<pre data-type="programlisting" data-code-language="r"><code class="c1">## R</code>
<code class="nf">library</code><code class="p">(</code><code class="n">tidyverse</code><code class="p">)</code>
<code class="nf">library</code><code class="p">(</code><code class="n">boot</code><code class="p">)</code> <code class="c1">#Required for Bootstrap simulations</code>
<code class="nf">library</code><code class="p">(</code><code class="n">rstudioapi</code><code class="p">)</code> <code class="c1">#To load data from local folder</code>
<code class="nf">library</code><code class="p">(</code><code class="n">ggpubr</code><code class="p">)</code> <code class="c1">#To generate multi-plots</code>

<code class="c1"># Setting the random seed will ensure reproducibility of random numbers</code>
<code class="nf">set.seed</code><code class="p">(</code><code class="m">1234</code><code class="p">)</code>
<code class="c1"># I personally find the default scientific number notation (i.e. with </code>
<code class="c1"># exponents) less readable in results, so I cancel it </code>
<code class="nf">options</code><code class="p">(</code><code class="n">scipen</code><code class="o">=</code><code class="m">10</code><code class="p">)</code>

<code class="c1">## Python</code>
<code class="n">import</code> <code class="n">pandas</code> <code class="n">as</code> <code class="n">pd</code>
<code class="n">import</code> <code class="n">numpy</code> <code class="n">as</code> <code class="n">np</code>
<code class="n">import</code> <code class="n">statsmodels.formula.api</code> <code class="n">as</code> <code class="n">smf</code>
<code class="n">from</code> <code class="n">statsmodels.formula.api</code> <code class="n">import</code> <code class="n">ols</code>
<code class="n">import</code> <code class="n">matplotlib.pyplot</code> <code class="n">as</code> <code class="n">plt</code> <code class="c1"># For graphics</code>
<code class="n">import</code> <code class="n">seaborn</code> <code class="n">as</code> <code class="n">sns</code> <code class="c1"># For graphics</code></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Code Conventions"><div class="sect2" id="code_conventions">
<h2>Code Conventions</h2>
<p>I use R in RStudio. R 4.0 was launched while I was writing this book and I have adopted it to keep the book as current as possible.<a contenteditable="false" data-type="indexterm" data-primary="R" data-secondary="about book version" id="idm45968171708568"/><a contenteditable="false" data-type="indexterm" data-primary="RStudio" id="idm45968171707192"/></p>
<p>R code is written in a code font with a comment indicating the language used, like this:</p>
<pre data-type="programlisting" data-code-language="r"><code class="c1">## R</code>
<code class="o">&gt;</code> <code class="n">x</code> <code class="o">&lt;-</code> <code class="m">3</code>
<code class="o">&gt;</code> <code class="n">x</code>
<code class="p">[</code><code class="m">1</code><code class="p">]</code> <code class="m">3</code></pre>
<p>I use Python in Anaconda’s Spyder. <a contenteditable="false" data-type="indexterm" data-primary="Anaconda Spyder" id="idm45968170812088"/><a contenteditable="false" data-type="indexterm" data-primary="Spyder (Anaconda)" id="idm45968170811112"/><a contenteditable="false" data-type="indexterm" data-primary="Python" data-secondary="about book version" id="idm45968170810040"/>The “Python 2.0 vs. 3.0” discussion is hopefully behind us (at least for new code; legacy code can be a different story), and I’ll be using Python 3.7. The convention for Python code is somewhat similar to the one for R:</p>
<pre data-type="programlisting" data-code-language="python"><code class="c1">## Python</code>
<code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="n">x</code> <code class="o">=</code> <code class="mi">3</code>
<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">x</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="mi">3</code></pre>
<p>We’ll often look at the output of regressions. It can be quite verbose, with a lot of diagnostics that are not relevant to the arguments of this book. You shouldn’t disregard them in real life, but that’s a matter better covered in other books. Therefore, I’ll abbreviate the output like this:<a contenteditable="false" data-type="indexterm" data-primary="regression" data-secondary="about book output" id="idm45968171297544"/></p>
<pre data-type="programlisting" data-code-language="r"><code class="c1">## R</code>
<code class="o">&gt;</code> <code class="n">model1</code> <code class="o">&lt;-</code> <code class="nf">lm</code><code class="p">(</code><code class="n">icecream_sales</code> <code class="o">~</code> <code class="n">temps</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">stand_dat</code><code class="p">)</code>
<code class="o">&gt;</code> <code class="nf">summary</code><code class="p">(</code><code class="n">model1</code><code class="p">)</code>

<code class="kc">...</code>
<code class="n">Coefficients</code><code class="o">:</code>
             <code class="n">Estimate</code> <code class="n">Std.</code> <code class="n">Error</code> <code class="n">t</code> <code class="n">value</code> <code class="nf">Pr</code><code class="p">(</code><code class="o">&gt;|</code><code class="n">t</code><code class="o">|</code><code class="p">)</code>    
<code class="p">(</code><code class="n">Intercept</code><code class="p">)</code> <code class="m">-4519.055</code>    <code class="m">454.566</code>  <code class="m">-9.941</code>   <code class="o">&lt;</code><code class="m">2e-16</code> <code class="o">***</code>
<code class="n">temps</code>        <code class="m">1145.320</code>      <code class="m">7.826</code> <code class="m">146.348</code>   <code class="o">&lt;</code><code class="m">2e-16</code> <code class="o">***</code>
<code class="kc">...</code>
</pre>
<pre data-type="programlisting" data-code-language="python">
<code class="c1">## Python </code>
<code class="n">model1</code> <code class="o">=</code> <code class="n">ols</code><code class="p">(</code><code class="s2">"icecream_sales ~ temps"</code><code class="p">,</code> <code class="n">data</code><code class="o">=</code><code class="n">stand_data_df</code><code class="p">)</code>
<code class="k">print</code><code class="p">(</code><code class="n">model1</code><code class="o">.</code><code class="n">fit</code><code class="p">()</code><code class="o">.</code><code class="n">summary</code><code class="p">())</code>

<code class="o">...</code>     
                 <code class="n">coef</code>    <code class="n">std</code> <code class="n">err</code>          <code class="n">t</code>      <code class="n">P</code><code class="o">&gt;|</code><code class="n">t</code><code class="o">|</code>      <code class="p">[</code><code class="mf">0.025</code>      <code class="mf">0.975</code><code class="p">]</code>
<code class="o">------------------------------------------------------------------------------</code>
<code class="n">Intercept</code>  <code class="o">-</code><code class="mf">4519.0554</code>    <code class="mf">454.566</code>     <code class="o">-</code><code class="mf">9.941</code>      <code class="mf">0.000</code>   <code class="o">-</code><code class="mf">5410.439</code>   <code class="o">-</code><code class="mf">3627.672</code>
<code class="n">temps</code>       <code class="mf">1145.3197</code>      <code class="mf">7.826</code>    <code class="mf">146.348</code>      <code class="mf">0.000</code>    <code class="mf">1129.973</code>    <code class="mf">1160.666</code>
<code class="o">...</code></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Functional-Style Programming 101"><div class="sect2" id="functional_style_programming_onezeroone">
<h2>Functional-Style Programming 101</h2>
<p>One of the steps of going from beginner to intermediate level as a programmer<a contenteditable="false" data-type="indexterm" data-primary="functional-style programming" id="idm45968168519752"/><a contenteditable="false" data-type="indexterm" data-primary="code" data-secondary="about functional-style programming" id="idm45968168518712"/> is to stop writing scripts in which your code is just a long succession of instructions and to structure your code into functions instead. In this book, we’ll write and reuse functions across chapters, such as the following ones to build Bootstrap confidence<a contenteditable="false" data-type="indexterm" data-primary="confidence intervals (CI)" data-secondary="Bootstrap" data-tertiary="code" id="idm45968168516968"/><a contenteditable="false" data-type="indexterm" data-primary="Python" data-secondary="confidence intervals" data-tertiary="Bootstrap code" id="idm45968168515352"/><a contenteditable="false" data-type="indexterm" data-primary="R" data-secondary="confidence intervals" data-tertiary="Bootstrap code" id="idm45968168513704"/><a contenteditable="false" data-type="indexterm" data-primary="Python" data-secondary="Bootstrap" data-tertiary="confidence intervals" id="idm45968168512056"/><a contenteditable="false" data-type="indexterm" data-primary="R" data-secondary="Bootstrap" data-tertiary="confidence intervals" id="idm45968168510408"/><a contenteditable="false" data-type="indexterm" data-primary="Bootstrap" data-secondary="confidence intervals" data-tertiary="code" id="idm45968168508760"/> <span class="keep-together">intervals:</span></p>
<pre data-type="programlisting" data-code-language="r"><code class="c1">## R</code>
<code class="n">boot_CI_fun</code> <code class="o">&lt;-</code> <code class="nf">function</code><code class="p">(</code><code class="n">dat</code><code class="p">,</code> <code class="n">metric_fun</code><code class="p">,</code> <code class="n">B</code><code class="o">=</code><code class="m">20</code><code class="p">,</code> <code class="n">conf.level</code><code class="o">=</code><code class="m">0.9</code><code class="p">){</code>
  
  <code class="n">boot_vec</code> <code class="o">&lt;-</code> <code class="nf">sapply</code><code class="p">(</code><code class="m">1</code><code class="o">:</code><code class="n">B</code><code class="p">,</code> <code class="nf">function</code><code class="p">(</code><code class="n">x</code><code class="p">){</code>
    <code class="nf">cat</code><code class="p">(</code><code class="s">"bootstrap iteration "</code><code class="p">,</code> <code class="n">x</code><code class="p">,</code> <code class="s">"\n"</code><code class="p">)</code>
    <code class="nf">metric_fun</code><code class="p">(</code><code class="nf">slice_sample</code><code class="p">(</code><code class="n">dat</code><code class="p">,</code> <code class="n">n</code> <code class="o">=</code> <code class="nf">nrow</code><code class="p">(</code><code class="n">dat</code><code class="p">),</code> <code class="n">replace</code> <code class="o">=</code> <code class="kc">TRUE</code><code class="p">))})</code>
  <code class="n">boot_vec</code> <code class="o">&lt;-</code> <code class="nf">sort</code><code class="p">(</code><code class="n">boot_vec</code><code class="p">,</code> <code class="n">decreasing</code> <code class="o">=</code> <code class="kc">FALSE</code><code class="p">)</code>
  <code class="n">offset</code> <code class="o">=</code> <code class="nf">round</code><code class="p">(</code><code class="n">B</code> <code class="o">*</code> <code class="p">(</code><code class="m">1</code> <code class="o">-</code> <code class="n">conf.level</code><code class="p">)</code> <code class="o">/</code> <code class="m">2</code><code class="p">)</code>
  <code class="n">CI</code> <code class="o">&lt;-</code> <code class="nf">c</code><code class="p">(</code><code class="n">boot_vec</code><code class="p">[</code><code class="n">offset</code><code class="p">],</code> <code class="n">boot_vec</code><code class="p">[</code><code class="n">B</code><code class="m">+1</code><code class="o">-</code><code class="n">offset</code><code class="p">])</code>
  <code class="nf">return</code><code class="p">(</code><code class="n">CI</code><code class="p">)</code>
<code class="p">}</code>
</pre>
<pre data-type="programlisting" data-code-language="python">
<code class="c1">## Python </code>
<code class="k">def</code> <code class="nf">boot_CI_fun</code><code class="p">(</code><code class="n">dat_df</code><code class="p">,</code> <code class="n">metric_fun</code><code class="p">,</code> <code class="n">B</code> <code class="o">=</code> <code class="mi">20</code><code class="p">,</code> <code class="n">conf_level</code> <code class="o">=</code> <code class="mi">9</code><code class="o">/</code><code class="mi">10</code><code class="p">):</code>
  
  <code class="n">coeff_boot</code> <code class="o">=</code> <code class="p">[]</code>
  
  <code class="c1"># Calculate coeff of interest for each simulation</code>
  <code class="k">for</code> <code class="n">b</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="n">B</code><code class="p">):</code>
      <code class="k">print</code><code class="p">(</code><code class="s2">"beginning iteration number "</code> <code class="o">+</code> <code class="nb">str</code><code class="p">(</code><code class="n">b</code><code class="p">)</code> <code class="o">+</code> <code class="s2">"</code><code class="se">\n</code><code class="s2">"</code><code class="p">)</code>
      <code class="n">boot_df</code> <code class="o">=</code> <code class="n">dat_df</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s2">"rep_ID"</code><code class="p">)</code><code class="o">.</code><code class="n">sample</code><code class="p">(</code><code class="n">n</code><code class="o">=</code><code class="mi">1200</code><code class="p">,</code> <code class="n">replace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>
      <code class="n">coeff</code> <code class="o">=</code> <code class="n">metric_fun</code><code class="p">(</code><code class="n">boot_df</code><code class="p">)</code>
      <code class="n">coeff_boot</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">coeff</code><code class="p">)</code>
  
  <code class="c1"># Extract confidence interval</code>
  <code class="n">coeff_boot</code><code class="o">.</code><code class="n">sort</code><code class="p">()</code>
  <code class="n">offset</code> <code class="o">=</code> <code class="nb">round</code><code class="p">(</code><code class="n">B</code> <code class="o">*</code> <code class="p">(</code><code class="mi">1</code> <code class="o">-</code> <code class="n">conf_level</code><code class="p">)</code> <code class="o">/</code> <code class="mi">2</code><code class="p">)</code>
  <code class="n">CI</code> <code class="o">=</code> <code class="p">[</code><code class="n">coeff_boot</code><code class="p">[</code><code class="n">offset</code><code class="p">],</code> <code class="n">coeff_boot</code><code class="p">[</code><code class="o">-</code><code class="p">(</code><code class="n">offset</code><code class="o">+</code><code class="mi">1</code><code class="p">)]]</code>
      
  <code class="k">return</code> <code class="n">CI</code></pre>
<p>Functions also have the added advantage of limiting incomprehension spillovers: even if you don’t understand how the preceding functions work, you can still take for granted that they return confidence intervals and follow the rest of the reasoning, postponing a deeper dive into their code until later.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Using Code Examples"><div class="sect2" id="using_code_examples">
<h2>Using Code Examples</h2>

<p>Supplemental material (code examples, etc.) is available for download<a contenteditable="false" data-type="indexterm" data-primary="code" data-secondary="supplemental material online" id="idm45968167323464"/><a contenteditable="false" data-type="indexterm" data-primary="resources for information" data-secondary="book supplemental material online" id="idm45968167322120"/><a contenteditable="false" data-type="indexterm" data-primary="book coding conventions" data-secondary="supplemental material online" id="idm45968167320808"/><a contenteditable="false" data-type="indexterm" data-primary="GitHub" data-secondary="book code examples" id="idm45968167319464"/> at <a href="https://oreil.ly/BehavioralDataAnalysis"><em>https://oreil.ly/BehavioralDataAnalysis</em></a>.</p>

<p>If you have a technical question or a problem using the code examples, please send email to <a class="email" href="mailto:bookquestions@oreilly.com"><em>bookquestions@oreilly.com</em></a>.</p>
<p>This book is here to help you get your job done. In general, if example code is offered with this book, you may use it in your programs and documentation. You do not need to contact us for permission unless you’re reproducing a significant portion of the code. For example, writing a program that uses several chunks of code from this book does not require permission. Selling or distributing examples from O’Reilly books does require permission. Answering a question by citing this book and quoting example code does not require permission. Incorporating a significant amount of example code from this book into your product’s documentation does require <span class="keep-together">permission.</span></p>
<p>We appreciate, but do not require, attribution. An attribution usually includes the title, author, publisher, and ISBN. For example: “<em>Behavioral Data Analysis with R and Python</em>, by Florent Buisson (O’Reilly). Copyright 2021 Florent Buisson, 978-1-492-06137-3.”</p>
<p>If you feel your use of code examples falls outside fair use or the permission given above, feel free to contact us at <a href="mailto:permissions@oreilly.com"><em>permissions@oreilly.com</em></a>.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Navigating This Book"><div class="sect1" id="navigating_this_book">
<h1>Navigating This Book</h1>
<p>The core intuition of the book is the<a contenteditable="false" data-type="indexterm" data-primary="data" data-secondary="about intuition" id="idm45968167309272"/><a contenteditable="false" data-type="indexterm" data-primary="causal-behavioral framework" data-secondary="about" id="idm45968167307896"/><a contenteditable="false" data-type="indexterm" data-primary="intuition" data-secondary="about data" id="idm45968167306552"/> idea that effective data analysis relies on a constant back and forth between three things:</p>
<ul>
<li><p>Actual behaviors in the real world and related psychological phenomena, such as intentions, thoughts, and emotions</p></li>
<li><p>Causal analytics and especially causal diagrams</p></li>
<li><p>Data</p></li>
</ul>
<p>The book is split into five parts:</p>
<dl>
<dt><a data-type="xref" data-xrefstyle="part-num-title" href="part01.xhtml#understanding_behaviors">Part I, <em>Understanding Behaviors</em></a></dt>
<dd><p>This part sets the stage with the causal-behavioral framework and the connections between behaviors, causal reasoning, and data.</p></dd>
<dt><a data-type="xref" data-xrefstyle="part-num-title" href="part02.xhtml#causal_diagrams_and_deconfounding">Part II, <em>Causal Diagrams and Deconfounding</em></a></dt>
<dd><p>This part introduces the concept of confounding and explains how causal diagrams allow us to deconfound our data analyses.</p></dd>
<dt><a data-type="xref" data-xrefstyle="part-num-title" href="part03.xhtml#robust_data_analysis">Part III, <em>Robust Data Analysis</em></a></dt>
<dd><p>Here we explore tools for missing data and introduce Bootstrap simulations, as we’ll rely extensively on Bootstrap confidence intervals in the rest of the book. <a contenteditable="false" data-type="indexterm" data-primary="data" data-secondary="about human behavioral data" id="idm45968167295256"/>Data that is small, incomplete, or irregularly shaped (e.g., with multiple peaks or outliers) is not a new problem, but it can be especially acute with behavioral data.</p></dd>
<dt><a data-type="xref" data-xrefstyle="part-num-title" href="part04.xhtml#designing_and_analyzing_experiments">Part IV, <em>Designing and Analyzing Experiments</em></a></dt>
<dd><p>In this part, we’ll discuss how to design and analyze experiments.</p></dd>
<dt><a data-type="xref" data-xrefstyle="part-num-title" href="part05.xhtml#advanced_tools_in_behavioral_data_analy">Part V, <em>Advanced Tools in Behavioral <span class="keep-together">Data Analysis</span></em></a></dt>
<dd><p>Finally, we bring everything together to explore moderation, mediation, and instrumental variables.</p></dd>
</dl>
<p>The various parts of the book build somewhat on each other, and consequently I recommend reading them in order, at least for your first pass.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Conventions Used in This Book"><div class="sect1" id="_conventions_used_in_this_book">
<h1>Conventions Used in This Book</h1>
<p>The following typographical conventions are used in this book:</p>
<dl>
<dt><em>Italic</em></dt>
<dd>
<p>Indicates new terms, URLs, email addresses, filenames, and file extensions.</p>
</dd>
<dt><code>Constant width</code></dt>
<dd>
<p>Used for program listings, as well as within paragraphs to refer to program elements such as variable or function names, databases, data types, environment variables, statements, and keywords.</p>
</dd>
<dt><strong><code>Constant width bold</code></strong></dt>
<dd>
<p>Shows commands or other text that should be typed literally by the user.</p>
</dd>
<dt><em><code>Constant width italic</code></em></dt>
<dd>
<p>Shows text that should be replaced with user-supplied values or by values determined by context.</p>
</dd>
</dl>
<div data-type="tip"><h6>Tip</h6>
<p>This element signifies a tip or suggestion.</p>
</div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This element signifies a general note.</p>
</div>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>This element indicates a warning or caution.</p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="O’Reilly Online Learning"><div class="sect1" id="_safari_books_online">
<h1>O’Reilly Online Learning</h1>
<div data-type="note" epub:type="note" class="ormenabled"><h6>Note</h6>
<p>For more than 40 years, <a href="http://oreilly.com" class="orm:hideurl"><em class="hyperlink">O’Reilly Media</em></a> has provided technology and business training, knowledge, and insight to help companies succeed.</p>
</div>
<p>Our unique network of experts and innovators share their knowledge and expertise through books, articles, and our online learning platform. O’Reilly’s online learning platform gives you on-demand access to live training courses, in-depth learning paths, interactive coding environments, and a vast collection of text and video from O’Reilly and 200+ other publishers. For more information, visit <a href="http://oreilly.com" class="orm:hideurl"><em>http://oreilly.com</em></a>.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="How to Contact Us"><div class="sect1" id="_how_to_contact_us">
<h1>How to Contact Us</h1>
<p>Please address comments and questions concerning this book to the publisher:</p>
<ul class="simplelist">
  <li>O’Reilly Media, Inc.</li>
  <li>1005 Gravenstein Highway North</li>
  <li>Sebastopol, CA 95472</li>
  <li>800-998-9938 (in the United States or Canada)</li>
  <li>707-829-0515 (international or local)</li>
  <li>707-829-0104 (fax)</li>
</ul>
<p>You can access the web page for this book, which lists errata,  examples, and additional information at <a href="https://oreil.ly/Behavioral_Data_Analysis_with_R_and_Python"><em>https://oreil.ly/Behavioral_Data_Analysis_with_R_and_Python</em></a>.</p>
<!--Don't forget to update the link above.-->
<p>Email <a class="email" href="mailto:bookquestions@oreilly.com"><em>bookquestions@oreilly.com</em></a> to comment or ask technical questions about this book.</p>

<p>For news and information about our books and courses, visit <a href="http://oreilly.com"><em>http://oreilly.com</em></a>.</p>
<p>Find us on Facebook: <a href="http://facebook.com/oreilly"><em>http://facebook.com/oreilly</em></a></p>
<p>Follow us on Twitter: <a href="http://twitter.com/oreillymedia"><em>http://twitter.com/oreillymedia</em></a></p>
<p>Watch us on YouTube: <a href="http://youtube.com/oreillymedia"><em>http://youtube.com/oreillymedia</em></a></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Acknowledgments"><div class="sect1" id="acknowledgments">
<h1>Acknowledgments</h1>
<p>Authors often thank their spouses for their patience and call out especially insightful reviewers. I have been blessed with having both in the same person. I don’t think anyone else would have dared or managed to send me back to the drawing board so many times, and this book is tremendously better for it. So my first thanks goes to my life and thought partner.</p>
<p>Several of my colleagues and fellow behavioral scientists have been generous enough to devote their time to reading and commenting on an earlier draft. This book is all the better for it. Thank you (in reverse alphabetical order) Jean Utke, Jessica Jakubowski, Chinmaya Gupta, and Phaedra Daipha!</p>
<p>A special thank goes to Bethany Winkel for her help with the writing.</p>
<p>I now cringe at how rough and confusing the very first drafts were. My development editor and technical reviewers patiently prodded me all the way to where the book is now, sharing their wealth of perspective and expertise. Thank you Gary O’Brien, and thank you Xuan Yin, Shannon White, Jason Stanley, Matt LeMay, and Andreas <span class="keep-together">Kaltenbrunner.</span></p>
</div></section>
</div></section></div></body></html>