- en: '9 Time series data: Analysis'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 9 时间序列数据：分析
- en: This chapter covers
  id: totrans-1
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Analyzing time series data to answer a research question
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析时间序列数据以回答研究问题
- en: Uncovering hidden depth in seemingly simple time series
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 揭示看似简单的时间序列中的隐藏深度
- en: Evaluating whether a time series dataset is appropriate for forecasting
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评估时间序列数据集是否适合进行预测
- en: Examining the constituent parts of a time series
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 检查时间序列的组成部分
- en: Building a forecasting model
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 建立预测模型
- en: 'In this chapter, we continue exploring the value of time series data. In chapter
    8, we explored raw time series data and decided which records to keep before analyzing
    the time series further. This chapter is about the second part of the process:
    analyzing time series data to look for patterns, as well as decomposition and
    forecasting. We will first recap the project brief from the previous chapter and
    summarize the work done so far before continuing with the analysis.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们继续探讨时间序列数据的价值。在第8章中，我们探讨了原始时间序列数据，并在进一步分析时间序列之前决定保留哪些记录。本章是关于流程的第二部分：分析时间序列数据以寻找模式，以及分解和预测。我们首先回顾上一章的项目概述，并总结到目前为止已完成的工作，然后再继续分析。
- en: '9.1 Project 6 revisited: Analyzing time series to improve cycling infrastructure'
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.1 项目6回顾：分析时间序列以改善自行车基础设施
- en: We prepared our data, and it is ready for analysis. But before we start the
    analysis, let’s recap the problem statement and the data dictionary from the previous
    chapter. The data is available for you to attempt the project yourself at [https://davidasboth.com/book-code](https://davidasboth.com/book-code).
    You will find the files that you can use for the project, as well as the example
    solution in the form of a Jupyter notebook. The notebook for this chapter picks
    up where chapter 8 left off.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经准备好了数据，它已准备好进行分析。但在我们开始分析之前，让我们回顾一下上一章的问题陈述和数据字典。数据可在[https://davidasboth.com/book-code](https://davidasboth.com/book-code)上供您尝试项目使用。您将找到可用于项目的文件，以及以Jupyter笔记本形式的示例解决方案。本章的笔记本从第8章结束的地方继续。
- en: 9.1.1 Problem statement
  id: totrans-10
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 9.1.1 问题陈述
- en: You have been hired to work on a new government initiative, Bikes4Britain, which
    aims to improve cycling infrastructure in the United Kingdom. The aim of the first
    phase of the project is to identify the most suitable places around the country
    to improve infrastructure for cyclists. Specifically, your stakeholders are looking
    for recommendations of places with either already existing or increasing cycling
    traffic. They want to start with open data sources and have identified the road
    traffic statistics of the Department for Transport (the homepage is [https://roadtraffic.dft.gov.uk](https://roadtraffic.dft.gov.uk))
    as a way to measure cycling traffic across the country.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 您被雇佣参与一项新的政府倡议，Bikes4Britain，该倡议旨在改善英国的自行车基础设施。项目的第一阶段目标是确定全国最适合改善自行车基础设施的地方。具体来说，您的利益相关者正在寻找既有或正在增加自行车交通流量的地方的建议。他们希望从公开数据源开始，并已将交通部（主页为[https://roadtraffic.dft.gov.uk](https://roadtraffic.dft.gov.uk)）的公路交通统计数据作为衡量全国自行车交通量的方式。
- en: 'NOTE:  The dataset we will use in this project to look for patterns and make
    recommendations was originally taken from [https://roadtraffic.dft.gov.uk/downloads](https://roadtraffic.dft.gov.uk/downloads).
    Thank you to the Department for Transport for making this data available under
    the Open Government Licence.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：我们将在本项目中用于寻找模式和提出建议的数据集最初来源于[https://roadtraffic.dft.gov.uk/downloads](https://roadtraffic.dft.gov.uk/downloads)。感谢交通部在开放政府许可下提供这些数据。
- en: The data we are using from the Department for Transport’s statistics is the
    raw count data. This is a record of raw counts of vehicles that passed a particular
    counting location at various times. Some of the datasets are too high-level, such
    as area-level annual summaries, and some of them are estimates, such as the estimated
    annual average daily flows data (AADFs). The raw count dataset contains data at
    the most granular level, and we can always aggregate it to higher levels (e.g.,
    annual values) if needed.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从交通部统计数据中使用的数据是原始计数数据。这是记录在不同时间通过特定计数位置的车辆原始计数。一些数据集过于高级，例如区域层面的年度汇总，而另一些则是估计值，例如估计的年度平均每日流量数据（AADFs）。原始计数数据集包含最细粒度的数据，如果需要，我们总是可以将其聚合到更高的层次（例如年度值）。
- en: 9.1.2 Data dictionary
  id: totrans-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 9.1.2 数据字典
- en: The data dictionary document, originally obtained from [https://mng.bz/4ajw](https://mng.bz/4ajw),
    is included in the project files, and table 9.1 shows the columns in detail.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 数据字典文档，最初从[https://mng.bz/4ajw](https://mng.bz/4ajw)获取，包含在项目文件中，表9.1详细显示了列。
- en: Table 9.1 The data dictionary, showing all column definitions
  id: totrans-16
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表9.1 数据字典，显示所有列定义
- en: '| Column name | Definition |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| 列名称 | 定义 |'
- en: '| --- | --- |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `Count_point_id`  | A unique reference for the road link that links the AADFs
    to the road network  |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| `Count_point_id`  | 将AADFs与道路网络连接的唯一参考 |'
- en: '| `Direction_of_travel`  | Direction of travel  |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| `Direction_of_travel`  | 行驶方向 |'
- en: '| `Year`  | Counts are shown for each year from 2000 onwards  |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| `Year`  | 从2000年开始的每年计数 |'
- en: '| `Count_date`  | The date when the actual count took place  |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '| `Count_date`  | 实际计数发生的日期 |'
- en: '| `Hour`  | The time when the counts in question took place where 7 represents
    between 7 a.m. and 8 a.m. and 17 represents between 5 p.m. and 6 p.m.  |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
  zh: '| `Hour`  | 计数发生的时间，其中7代表早上7点到8点，17代表下午5点到6点 |'
- en: '| `Region_id`  | Website region identifier  |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| `Region_id`  | 网站区域标识符 |'
- en: '| `Region_name`  | The name of the region that the CP sits within  |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| `Region_name`  | CP所在的区域名称 |'
- en: '| `Region_ons_code`  | The Office for National Statistics code identifier for
    the region  |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| `Region_ons_code`  | 该区域的国家统计局代码标识符 |'
- en: '| `Local_authority_id`  | Website local authority identifier  |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| `Local_authority_id`  | 网站地方当局标识符 |'
- en: '| `Local_authority_name`  | The local authority that the CP sits within  |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| `Local_authority_name`  | CP所在的当地当局 |'
- en: '| `Local_authority_code`  | The Office for National Statistics code identifier
    for the local authority  |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| `Local_authority_code`  | 国家统计局的地方当局代码标识符 |'
- en: '| `Road_name`  | The road name (for instance, M25 or A3)  |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '| `Road_name`  | 路名（例如，M25或A3） |'
- en: '| `Road_category`  | The classification of the road type (see data definitions
    for the full list)  |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| `Road_category`  | 路类型的分类（请参阅数据定义以获取完整列表） |'
- en: '| `Road_type`  | Whether the road is a ‘major’ or ‘minor’ road  |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| `Road_type`  | 路是“主要”还是“次要”道路 |'
- en: '| `Start_junction_road_name`  | The road name of the start junction of the
    link  |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| `Start_junction_road_name`  | 链接的起点交汇处的道路名称 |'
- en: '| `End_junction_road_name`  | The road name of the end junction of the link  |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| `End_junction_road_name`  | 链接的终点交汇处的道路名称 |'
- en: '| `Easting`  | Easting coordinates of the CP location  |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| `Easting`  | CP位置的东经坐标 |'
- en: '| `Northing`  | Northing coordinates of the CP location  |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| `Northing`  | CP位置的北纬坐标 |'
- en: '| `Latitude`  | Latitude of the CP location  |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| `Latitude`  | CP位置的纬度 |'
- en: '| `Longitude`  | Longitude of the CP location  |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| `Longitude`  | CP位置的经度 |'
- en: '| `Link_length_km`  | Total length of the network road link for that CP (in
    kilometers)  |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| `Link_length_km`  | 该CP的网络道路链接总长度（以公里为单位） |'
- en: '| `Link_length_miles`  | Total length of the network road link for that CP
    (in miles)  |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| `Link_length_miles`  | 该CP的网络道路链接总长度（以英里为单位） |'
- en: '| `Pedal_cycles`  | Counts for pedal cycles  |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| `Pedal_cycles`  | 自行车的计数 |'
- en: '| `Two_wheeled_motor_vehicles`  | Counts for two-wheeled motor vehicles  |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| `Two_wheeled_motor_vehicles`  | 两轮机动车辆的计数 |'
- en: '| `Cars_and_taxis`  | Counts for cars and taxis  |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| `Cars_and_taxis`  | 汽车和出租车的计数 |'
- en: '| `Buses_and_coaches`  | Counts for buses and coaches  |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| `Buses_and_coaches`  | 公共汽车和长途汽车的计数 |'
- en: '| `LGVs`  | Counts for LGVs  |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| `LGVs`  | LGVs的计数 |'
- en: '| `HGVs_2_rigid_axle`  | Counts for two-rigid axle HGVs  |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| `HGVs_2_rigid_axle`  | 两轴刚性轴重货车计数 |'
- en: '| `HGVs_3_rigid_axle`  | Counts for three-rigid axle HGVs  |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '| `HGVs_3_rigid_axle`  | 三轴刚性轴重货车的计数 |'
- en: '| `HGVs_4_or_more_rigid_axle`  | Counts for four or more rigid axle HGVs  |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| `HGVs_4_or_more_rigid_axle`  | 四轴或更多刚性轴重货车的计数 |'
- en: '| `HGVs_3_or_4_articulated_axle`  | Counts for three- or four-articulated axle
    HGVs  |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '| `HGVs_3_or_4_articulated_axle`  | 三轴或四轴铰接轴重货车的计数 |'
- en: '| `HGVs_5_articulated_axle`  | Counts for five-articulated axle HGVs  |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '| `HGVs_5_articulated_axle`  | 五轴铰接轴重货车的计数 |'
- en: '| `HGVs_6_articulated_axle`  | Counts for six-articulated axle HGVs  |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '| `HGVs_6_articulated_axle`  | 六轴铰接轴重货车的计数 |'
- en: '| `All_HGVs`  | Counts for all HGVs  |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '| `All_HGVs`  | 所有HGVs的计数 |'
- en: '| `All_motor_vehicles`  | Counts for all motor vehicles  |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
  zh: '| `All_motor_vehicles`  | 所有机动车辆的计数 |'
- en: In the example solution, we will use a smaller, cleaned, and filtered version
    of the raw data as a starting point, which we created in chapter 8\. This has
    the same structure as the raw data, so the data dictionary in table 9.1 is still
    applicable.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在示例解决方案中，我们将使用一个较小的、清洗过的和过滤过的原始数据版本作为起点，这是我们在第8章中创建的。它具有与原始数据相同的结构，因此表9.1中的数据字典仍然适用。
- en: 9.1.3 Desired outcomes
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 9.1.3 预期成果
- en: The output of the project is a recommendation of which area, or areas, to concentrate
    initial efforts on. These might be areas that already have a lot of high cycle
    traffic, or they might be areas where cycling is on the rise or forecasted to
    have high cycling demand in the future. Our recommendation will likely contain
    suggestions to incorporate additional datasets to continue the analysis. There
    is probably more that we would like to know about these areas before any infrastructure
    work is undertaken, and we should outline this additional work to our stakeholders.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 项目的输出是对哪些区域或哪些区域应集中初始努力的推荐。这些可能是已经有大量高自行车交通的区域，或者可能是自行车正在兴起或预计未来将有高自行车需求的区域。我们的建议可能包含建议纳入额外的数据集以继续分析。在开始任何基础设施工作之前，我们可能还想了解这些区域更多的情况，我们应该向利益相关者概述这项额外的工作。
- en: The output of the example solution from the chapter 8 was an intermediate dataset,
    which was cleaned and filtered for analysis. The output of the part of the analysis
    covered by this chapter will be the conclusions and recommendations we set out.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 第8章示例解决方案的输出是一个中间数据集，该数据集经过清理和过滤以供分析。本章涵盖的分析部分的输出将是我们所提出的结论和建议。
- en: 9.2 Where should cycling infrastructure improvements be focused?
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.2 应该将自行车基础设施改进的重点放在哪里？
- en: Before we start analyzing our time series data, let’s recap the work we did
    in the previous chapter to prepare the data for analysis. Figure 9.1 shows the
    diagram of the work done so far, highlighting where alternative decisions could
    have been made.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始分析时间序列数据之前，让我们回顾一下上一章中为准备数据以供分析所做的工作。图9.1显示了到目前为止所做的工作的流程图，突出显示了可能做出的替代决策。
- en: '![figure](../Images/9-1.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-1.png)'
- en: Figure 9.1 Diagram of the process of preparing time series data to be ready
    for analysis
  id: totrans-61
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.1 准备时间序列数据以供分析的流程图
- en: Now, it’s time to look at an example walk-through of the analysis portion of
    the project. As always, I strongly recommend attempting the project yourself first.
    The example solution will be more relevant if you have your own analysis to compare
    it to. It bears repeating that the solution is not the solution, just one series
    of decisions you could make and conclusions you could reach along the way. Use
    it to generate more ideas and gain a different perspective on how you could have
    approached the same project brief.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，是时候查看项目分析部分的示例流程了。一如既往，我强烈建议您首先尝试自己完成项目。如果您有自己的分析来与之比较，示例解决方案将更加相关。需要重申的是，解决方案不是唯一的解决方案，而是一系列可能的决策和结论，您可以在过程中做出和达到。利用它来产生更多想法，并从不同的角度看待您如何处理相同的项目概述。
- en: 9.2.1 Analysis of time series data
  id: totrans-63
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 9.2.1 时间序列数据分析
- en: So far, we have cleaned up our raw traffic data and filtered it down so that
    we have a long, complete time series of traffic counts. Now it’s time to focus
    our efforts on the problem at hand by looking specifically at cycling.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经清理了原始交通数据，并对其进行过滤，以便我们有一个长而完整的时间序列交通计数。现在，通过具体查看自行车情况，是时候将我们的努力集中在手头的问题上了。
- en: Calculating distributions in time series data
  id: totrans-65
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 计算时间序列数据中的分布
- en: At the end of chapter 8, we exported the data to a Parquet file to separate
    the data cleaning from the analysis. This section, therefore, begins with reading
    the same exported data again.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在第8章结束时，我们将数据导出为Parquet文件，以将数据清理与分析分离。因此，本节从再次读取相同导出数据开始。
- en: 'We know that in the data, there was a single day in each calendar year when
    measurements took place. We want to look at long-term trends, so the hourly granularity
    introduces noise that we want to remove by summarizing data annually. Let’s start
    there. The following code does this, and a sample of the output is shown in figure
    9.2:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 我们知道在数据中，每年只有一个日历日进行了测量。我们想查看长期趋势，因此按小时粒度引入的噪声是我们想通过按年度汇总数据来移除的。让我们从这里开始。以下代码执行此操作，输出样本如图9.2所示：
- en: '[PRE0]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![figure](../Images/9-2.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-2.png)'
- en: Figure 9.2 A snapshot of annual counts of cycles at each location
  id: totrans-70
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.2 每个位置的年度自行车计数快照
- en: 'This data is now one row per location ID per calendar year. Figure 9.2 shows
    a location with cycling traffic, but there is a possible problem; many of the
    location IDs might barely have any cycling traffic. To check this, we will look
    at the distribution of the total number of bicycles seen per location ID across
    all years. First, we will aggregate the data again to remove the annual values
    and be left with one row per location ID. This data is created using the following
    code and shown in figure 9.3:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 现在的数据是每个日历年度每个位置ID一行。图9.2显示了一个有自行车交通的位置，但可能存在一个问题；许多位置ID可能几乎没有自行车交通。为了检查这一点，我们将查看所有年份中每个位置ID看到的自行车总数分布。首先，我们将再次聚合数据以删除年度值，并留下每个位置ID一行。这些数据是通过以下代码创建的，并显示在图9.3中：
- en: '[PRE1]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![figure](../Images/9-3.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-3.png)'
- en: Figure 9.3 Total number of bicycles seen per location ID
  id: totrans-74
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.3 每个位置ID看到的自行车总数
- en: 'Now, we can investigate the distribution of these values to get a feel for
    just how many locations have little or no cycling traffic. We anticipate the data
    to be heavily skewed to the right, meaning most values are likely to be around
    zero with a long tail of higher values. To account for this, we will add more
    bins to the histogram to hopefully better understand the spread of the data. The
    following code creates the histogram presented in figure 9.4:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以调查这些值的分布，以了解有多少位置有少量或没有自行车交通。我们预计数据将严重右偏，这意味着大多数值可能都接近零，而高值有一个长长的尾巴。为了解决这个问题，我们将向直方图添加更多区间，以希望更好地理解数据的分布。以下代码创建了图9.4中显示的直方图：
- en: '[PRE2]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![figure](../Images/9-4.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-4.png)'
- en: Figure 9.4 Distribution of total cycling traffic
  id: totrans-78
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.4 总自行车交通量的分布
- en: 'As expected, a lot of locations have recorded almost no cycling traffic. Let’s
    focus on locations with over a certain amount of total cycling traffic. How do
    we know what value to use as a cutoff (i.e., consider only locations with over
    X bikes seen over time)? We should understand the quartiles of these values to
    get a sense of what cutoff values would constitute the top 25% or 50% of the data.
    The following code does this, and the output is shown in figure 9.5:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 如预期的那样，许多位置记录的自行车交通量几乎为零。让我们关注那些总自行车交通量超过一定数量的位置。我们如何知道应该使用什么值作为截止点（即，只考虑在一段时间内看到超过X辆自行车的位置）？我们应该了解这些值的四分位数，以了解构成数据前25%或50%的截止值。以下代码执行了此操作，输出结果如图9.5所示：
- en: '[PRE3]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![figure](../Images/9-5.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-5.png)'
- en: Figure 9.5 Descriptive statistics for the total cycling traffic values
  id: totrans-82
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.5 总自行车交通值的描述性统计
- en: This tells us that half of the locations have recorded 216 or more bicycles
    in total. Since we have focused on locations with at least 10 years of coverage,
    this translates to between 10 and 20 bicycles on average per measurement date.
    Whether that is enough traffic to warrant investigation and recommendations will
    depend on the business, so for this problem, we will make an assumption about
    what level of traffic is high enough for us to focus on.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 这告诉我们，一半的位置记录的总自行车数量为216辆或更多。由于我们专注于至少有10年覆盖范围的位置，这相当于平均每个测量日期有10到20辆自行车。这是否足以证明需要进行调查和提出建议，将取决于业务，因此对于这个问题，我们将假设一个足够高的交通水平，以便我们能够关注。
- en: 'Before we start cutting this data down, let’s understand it a bit more. Where,
    for example, is the most cycling traffic? The following code produces the output
    in figure 9.6 and shows the top 10 location IDs by cycling traffic:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始削减这些数据之前，让我们更深入地了解它。例如，哪里是自行车交通最繁忙的地方？以下代码生成图9.6中的输出，并显示了按自行车交通量排名前10的位置ID：
- en: '[PRE4]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![figure](../Images/9-6.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-6.png)'
- en: Figure 9.6 Top 10 location IDs by total cycling traffic
  id: totrans-87
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.6 总自行车交通量最高的前10个位置ID
- en: We have a location with over 19,000 bicycles recorded and many more with thousands.
    Personally, I like to put more context around tables like this, so let’s examine
    the specific location ID at the top of this table.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有一个记录超过19,000辆自行车的位置，还有更多位置记录了数千辆。我个人喜欢在表格周围添加更多上下文，所以让我们来检查这个表格顶部的具体位置ID。
- en: Investigating individual data points for more context
  id: totrans-89
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 调查单个数据点以获取更多上下文
- en: 'Because our data contains many columns, we can use the trick of transposing
    it to show it as a single column instead. The following code does this, and we
    can review a single row of data as a vertical table, as shown in figure 9.7\.
    For space reasons, some of the final columns are omitted from the figure but are
    present in the solution notebook:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们的数据包含许多列，我们可以使用转置的技巧将其显示为单列。以下代码实现了这一点，我们可以像图9.7所示那样，将单行数据作为垂直表格来查看。由于空间原因，图中的某些最终列被省略了，但它们存在于解决方案笔记本中：
- en: '[PRE5]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![figure](../Images/9-7.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-7.png)'
- en: Figure 9.7 The location ID with the highest cycling traffic (part of a single
    row of data transposed as a column)
  id: totrans-93
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.7 具有最高骑行交通量的位置ID（数据表中一整行数据转置为列的一部分）
- en: This is a minor road of some sort in Islington, which is a borough in North
    London. Specifically, which road this relates to is not mentioned. There are `Road_name`
    and `Road_category` columns that should tell us more, but they are not informative
    here. Let’s look at the data dictionary to understand what these specific values
    mean. As a reminder, the data dictionary is included in the chapter’s materials
    as a PDF. Table 9.2 shows the values we can expect in the `Road_category` column.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一条位于北伦敦伊兹灵顿的某种次要道路，伊兹灵顿是伦敦的一个区。具体是哪条道路没有提及。有`Road_name`和`Road_category`列应该能告诉我们更多信息，但在这里它们并不提供信息。让我们查看数据字典来了解这些特定值的意义。作为提醒，数据字典包含在该章节的材料中，作为PDF文件。表9.2显示了`Road_category`列中我们可以预期的值。
- en: Table 9.2 Data dictionary for the `Road_category` column
  id: totrans-95
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表9.2 `Road_category`列的数据字典
- en: '| Category | Category description |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| 类别 | 类别描述 |'
- en: '| --- | --- |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| PM  | M or class A principal motorway  |'
  id: totrans-98
  prefs: []
  type: TYPE_TB
  zh: '| PM  | M或A级主要公路  |'
- en: '| PA  | Class A principal road  |'
  id: totrans-99
  prefs: []
  type: TYPE_TB
  zh: '| PA  | A级主要道路  |'
- en: '| TM  | M or class A trunk motorway  |'
  id: totrans-100
  prefs: []
  type: TYPE_TB
  zh: '| TM  | M或A级干线公路  |'
- en: '| TA  | Class A trunk road  |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
  zh: '| TA  | A级干线道路  |'
- en: '| M  | Minor road  |'
  id: totrans-102
  prefs: []
  type: TYPE_TB
  zh: '| M  | 次要道路  |'
- en: '| MB  | Class B road  |'
  id: totrans-103
  prefs: []
  type: TYPE_TB
  zh: '| MB  | B级道路  |'
- en: '| MCU  | Class C or unclassified road  |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '| MCU  | C级或未分类道路  |'
- en: From this, we can gather that the top cycling location is a very minor or unclassified
    road. A note in the data dictionary says, “Unclassified roads (referred to as
    ‘U’ in datasets) include residential roads both in urban and rural situations,”
    so this is likely a residential road since Islington is not a rural location.
    These are the pieces of additional context you have as an analyst if you have
    relevant domain knowledge. If in doubt, ask a domain expert.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 从这里，我们可以得出结论，最热门的骑行地点是一条非常次要或未分类的道路。数据字典中的一条注释说，“未分类道路（在数据集中称为‘U’）包括城市和农村地区的住宅道路，”因此这很可能是条住宅道路，因为伊兹灵顿不是一个农村地区。这些就是作为分析师你所拥有的额外背景信息，如果你有相关的领域知识的话。如果有疑问，请咨询领域专家。
- en: If we really want to understand a particular location in the data, we have latitude
    and longitude coordinates we can use. The values for this location are `(51.52988,`
    `-0.106402)`, which, when put into a map, show the map point displayed in figure
    9.8.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们真的想了解数据中的特定位置，我们可以使用纬度和经度坐标。这个位置的值是`(51.52988,` `-0.106402)`，当输入到地图中时，显示图9.8中显示的地图点。
- en: '![figure](../Images/9-8.png)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-8.png)'
- en: Figure 9.8 The OpenStreetMap location with the highest cycling traffic
  id: totrans-108
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.8 具有最高骑行交通量的OpenStreetMap位置
- en: 'Activity: Bring your data to life'
  id: totrans-109
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 活动内容：让你的数据生动起来
- en: In this project, whenever you want to find out more about a location ID, you
    can find it on a map with its coordinates. I encourage you to find opportunities
    to do so and even look at them with Google Street View, for example. As analysts,
    we don’t often get the chance to add this much context to our data points, so
    we should make the most of it!
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个项目中，无论何时你想了解更多关于位置ID的信息，你都可以在带有其坐标的地图上找到它。我鼓励你寻找这样的机会，甚至可以用谷歌街景等工具查看它们。作为分析师，我们很少有机会给我们的数据点添加这么多背景信息，所以我们应该充分利用这一点！
- en: Without knowing more about this particular location, we can only guess why it
    has by far the highest cycling traffic in the data. Some ideas include
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在不了解这个特定位置更多情况的情况下，我们只能猜测为什么它在数据中具有最高的骑行交通量。一些想法包括
- en: It could simply be that the bicycle shop visible on the map, “Symphony Cycling,”
    is on this street.
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这可能仅仅是因为地图上可见的自行车店“交响乐自行车店”就在这条街上。
- en: This area might be particularly high in cyclists, but perhaps there is nothing
    special about this residential street, and any surrounding street would have yielded
    similar results.
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这个区域可能特别适合骑行者，但也许这条住宅街道并没有什么特别之处，任何周围的街道都可能产生类似的结果。
- en: This might be a popular shortcut for cyclists looking to avoid the traffic on
    the surrounding larger roads on their cycling commute.
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这可能是寻求避免周围较大道路交通的骑行者的一个流行捷径。
- en: There might be some bias around how counting points are chosen in the first
    place. Perhaps this location was chosen *because* of its high cycling traffic.
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在最初选择计数点时可能存在一些偏差。也许这个位置是因为其高自行车交通而被选择的*原因*。
- en: 'Whatever the reason, this poses many interesting questions, one of which is,
    is all cycling traffic on minor roads, or are there major roads of interest in
    the data? To answer this question, we will join the total cycling data back to
    the raw data and find locations where the total amount of cycling is at least
    X, where X is a value we set. Let’s see whether there were any major roads with
    over 1,000 bikes seen in total. The following code does this and produces the
    result in figure 9.9:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 无论原因如何，这提出了许多有趣的问题，其中之一是，所有的自行车交通都在次要道路上，还是数据中存在有意义的重大道路？为了回答这个问题，我们将总自行车数据重新与原始数据连接，并找到总自行车量至少为X的位置，其中X是我们设定的值。让我们看看是否有任何看到总共有超过1000辆自行车的重大道路。以下代码执行此操作，并在图9.9中产生结果：
- en: '[PRE6]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '#1 Converts the cycling totals to a DataFrame before joining to the raw traffic
    data'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 在与原始交通数据连接之前将自行车总数转换为DataFrame'
- en: '![figure](../Images/9-9.png)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/9-9.png)'
- en: Figure 9.9 No rows returned when looking for major roads with over 1,000 bikes
    seen in total
  id: totrans-120
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.9 查找看到总共有超过1000辆自行车的重大道路时没有返回任何行
- en: 'This tells us that there are no instances of major roads where over 1000 bikes
    are seen in total. What if we lower that threshold to 100? This means major roads
    with only 5–10 bikes seen in a given day on average. The following code does this
    and produces the result in figure 9.10:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 这告诉我们，没有看到超过1000辆自行车的重大道路实例。如果我们把那个阈值降低到100呢？这意味着在给定的一天平均只看到5-10辆自行车的重大道路。以下代码执行此操作，并在图9.10中产生结果：
- en: '[PRE7]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![figure](../Images/9-10.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/9-10.png)'
- en: Figure 9.10 Traffic data for locations on major roads with over 100 total bikes
    seen
  id: totrans-124
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.10 看到总共有超过100辆自行车的重大道路上的交通数据
- en: Even when we only consider 100 bikes in total, there does not seem to be bike
    traffic on major roads, at least not in the cut-down version of the data we are
    using. It is therefore likely that, in this analysis, we will not focus on recommending
    improvements to the cycling infrastructure along major roads. However, perhaps
    the lack of cycling traffic is an interesting finding itself—something to discuss
    with our stakeholders as a deeper investigation into how cyclists are having to
    circumvent major roads may be interesting to them.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 即使当我们只考虑总共100辆自行车时，似乎在主要道路上没有看到自行车交通，至少在我们使用的简化版数据中是这样。因此，在这个分析中，我们可能不会专注于建议改善主要道路上的自行车基础设施。然而，自行车交通的缺失本身可能是一个有趣的发现——我们可以与我们的利益相关者讨论，因为对自行车如何绕行主要道路的更深入调查可能对他们来说很有趣。
- en: Let’s add our investigation into the distribution of cycling traffic to our
    analysis diagram, the latest version of which is shown in figure 9.11.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将对自行车交通分布的调查添加到我们的分析图中，其最新版本如图9.11所示。
- en: '![figure](../Images/9-11.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/9-11.png)'
- en: Figure 9.11 The analysis so far, up to investigating the distribution of cycling
    traffic
  id: totrans-128
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.11 到目前为止的分析，直到调查自行车交通的分布
- en: Focusing on the data at hand, let’s now start looking at locations of interest
    based on their cycling traffic patterns, starting with locations where cycling
    has increased since data was first captured.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 专注于手头的资料，现在让我们开始根据它们的自行车交通模式查看感兴趣的位置，从数据首次捕获以来自行车量增加的位置开始。
- en: Finding time series that contain upward trends
  id: totrans-130
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 寻找包含上升趋势的时间序列
- en: Our first step is to define what we mean by “on the rise.” Do we want to see
    cycling increase year-on-year consistently for a location to qualify? Since we
    only have a day’s worth of data each year, there will be noise, so this criterion
    might be too strict. Let’s look for locations where the latest measurement figure
    was higher than the first. It’s a crude proxy for “increase in cycling,” but we
    can filter the data down to the locations with the largest increase.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的第一步是定义我们所说的“上升”。我们是否希望看到某个地点的自行车年复一年持续增长才能符合条件？由于我们每年只有一天的数据，所以会有噪声，因此这个标准可能过于严格。让我们寻找最新测量值高于第一个值的地点。这是“自行车增加”的粗略代理，但我们可以将数据过滤到增长最大的地点。
- en: 'To achieve this, we need to take the rows for each location ID separately,
    ensure they are in chronological order, and then take the difference between the
    first and last rows. We should calculate both absolute and percentage changes
    to sanity-check our results. We also need to account for division by zero errors
    when calculating percentage change. The following code calculates both absolute
    and percentage change between the first and last values for each location, ending
    up with the dataset shown in figure 9.12:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 为了实现这一点，我们需要分别对每个位置ID的行进行处理，确保它们按时间顺序排列，然后计算第一行和最后一行之间的差异。我们应该计算绝对变化和百分比变化以验证我们的结果。在计算百分比变化时，还需要考虑除以零的错误。以下代码计算了每个位置的第一行和最后一行之间的绝对变化和百分比变化，最终得到如图9.12所示的数据库：
- en: '[PRE8]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '#1 Defines a function to calculate the difference between the first and last
    values encountered in a group'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 定义一个函数来计算组中遇到的第一行和最后一行之间的差异'
- en: '#2 Defines a function to calculate the change as a percentage'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 定义一个函数来计算百分比变化'
- en: '#3 Accounts for division-by-zero errors'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 考虑除以零的错误'
- en: '#4 Applies these two functions to every location ID group'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 将这两个函数应用于每个位置ID组'
- en: '![figure](../Images/9-12.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-12.png)'
- en: Figure 9.12 Absolute and percentage difference of cycling totals for each location
  id: totrans-139
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.12 每个位置自行车总数的绝对和百分比差异
- en: 'We have a variety of results here. There will be infinite values where the
    first measurement date yielded no bicycles, as well as instances of both positive
    and negative change over time. Before investigating this table further, it’s a
    good idea to verify our calculations. Let’s look at one of the locations and see
    if the raw data supports the change values we calculated. The following code does
    this to produce the result in figure 9.13:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们有各种结果。当第一个测量日期没有自行车时，将会有无限大的值，以及随着时间的推移出现正负变化的情况。在进一步调查这个表格之前，验证我们的计算是一个好主意。让我们看看其中一个位置，看看原始数据是否支持我们计算的变化值。以下代码执行此操作，生成如图9.13所示的结果：
- en: '[PRE9]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![figure](../Images/9-13.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-13.png)'
- en: Figure 9.13 Raw annual cycling data for location 900056
  id: totrans-143
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.13 位置900056的原始年度自行车数据
- en: 'We found that in 2007, there were 24 bicycles encountered and only 14 in 2019,
    which is a reduction of 42%, which figure 9.12 also shows. We can spot-check a
    few more examples to convince ourselves that our calculations are correct. Then,
    we can look at some of the highest increases in cycling traffic in percentage
    terms. The following code does this and produces the table in figure 9.14:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 我们发现，在2007年，遇到了24辆自行车，而在2019年只有14辆，减少了42%，如图9.12所示。我们可以检查更多示例，以使我们确信我们的计算是正确的。然后，我们可以查看一些百分比变化最大的自行车流量增加情况。以下代码执行此操作，并生成如图9.14所示的表格：
- en: '![figure](../Images/9-14.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-14.png)'
- en: Figure 9.14 The locations with the highest percentage change in cycling
  id: totrans-146
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.14 自行车百分比变化最高的位置
- en: '[PRE10]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '#1 Removes infinity values from consideration'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 从考虑中移除无穷大值'
- en: Warning  When encountering division-by-zero scenarios, make sure you understand
    how your chosen tool represents infinity. In `pandas,` we use `np.inf`, a specific
    value from the `numpy` library. It is considered greater than all other integers
    when sorting, so in this instance, we make sure to remove those rows from consideration
    before sorting.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 警告  当遇到除以零的情况时，请确保您了解您选择的工具如何表示无穷大。在`pandas`中，我们使用`np.inf`，这是`numpy`库中的一个特定值。在排序时，它被认为大于所有其他整数，因此在这种情况下，我们确保在排序之前从考虑中移除这些行。
- en: 'We have some interesting cases to investigate. It’s time to plot these time
    series rather than relying on numeric calculations to determine interesting patterns.
    The following code produces the plot in figure 9.15\. I have included only a few
    of the time series for clarity:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有一些有趣的情况需要调查。是时候绘制这些时间序列图，而不是依赖数值计算来确定有趣的模式了。以下代码生成了如图9.15所示的图表。为了清晰起见，我只包括了一些时间序列：
- en: '[PRE11]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![figure](../Images/9-15.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-15.png)'
- en: Figure 9.15 Some locations with the highest increase in cycling traffic
  id: totrans-153
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.15 自行车流量增加最多的几个位置
- en: This shows that there are genuine increases in cycling traffic at various locations.
    We should, however, look at this problem from different angles because the nature
    of our data—the fact that we count vehicles on a single day each year—is such
    that all values are subject to bias. There could be special events such as road
    closures, public holidays, or just varying patterns across weekdays that could
    explain these increases. Let’s add this latest step to our growing analysis diagram,
    shown in figure 9.16.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 这表明在各个地点确实有自行车交通量的真实增长。然而，我们应该从不同的角度来审视这个问题，因为我们的数据性质——每年只在某一天计数车辆的事实——意味着所有数值都存在偏差。可能有特殊事件，如道路关闭、公共假日，或者只是工作日之间的不同模式，这些都可以解释这些增长。让我们将这一最新步骤添加到我们不断增长的分析图中，如图9.16所示。
- en: '![figure](../Images/9-16.png)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-16.png)'
- en: Figure 9.16 The analysis process, including the latest step of finding locations
    with cycling on the rise
  id: totrans-156
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.16显示了分析过程，包括最新步骤，即寻找自行车交通量上升的地点
- en: Another angle we could consider is finding locations where cycling makes up
    a significant percentage of overall traffic.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个我们可以考虑的角度是寻找自行车在总体交通中占较大比例的地点。
- en: Identifying time series with certain characteristics
  id: totrans-158
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 识别具有特定特征的时间序列
- en: 'Let’s look at how we can calculate cycling as a percentage of overall traffic.
    We’ve been using the `Pedal_cycles` column to count cyclists and `All_motor_vehicles`
    to count all traffic. However, the phrase “motor vehicles” suggests that perhaps
    bikes aren’t included. This is something we need to verify before calculating
    anything. The data dictionary in table 8.1 doesn’t answer this question as it
    just says that the column measures “counts for all motor vehicles.” Fortunately,
    the PDF version includes more information. Page 10 contains a section called “Types
    of vehicle,” under which there is the following: “All motor vehicles: All vehicles
    except pedal cycles.” Figure 9.17 shows the relevant section of the document.'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何计算自行车在总体交通中的百分比。我们一直在使用`Pedal_cycles`列来计数骑自行车的人，以及`All_motor_vehicles`来计数所有交通。然而，“机动车”这个短语暗示可能自行车不包括在内。在计算任何东西之前，我们需要验证这一点。表8.1中的数据字典没有回答这个问题，因为它只是说该列测量“所有机动车的计数。”幸运的是，PDF版本包含了更多信息。第10页包含一个名为“车辆类型”的部分，其中包含以下内容：“所有机动车：除自行车外的所有车辆。”图9.17显示了文档的相关部分。
- en: '![figure](../Images/9-17.png)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-17.png)'
- en: Figure 9.17 A screenshot of the part of the data dictionary referring to what
    “all motor vehicles” means
  id: totrans-161
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.17显示数据字典中关于“所有机动车”含义的部分的截图
- en: 'As suspected, to get the total number of vehicles seen, including bikes, we
    need to add those columns together. We also want to weight recent observations,
    so we will only take the last date for each location point. In some cases, this
    may be a few years in the past, but it will at least give us only the most recent
    data. The steps in the following code are as follows:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 如预期的那样，为了得到包括自行车在内的总车辆数，我们需要将这些列相加。我们还想对近期观察结果进行加权，因此我们只取每个位置点的最后日期。在某些情况下，这可能是在几年前，但至少会给我们提供最新的数据。以下代码中的步骤如下：
- en: Filter the traffic data to the *last observed date for each location ID.*
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将交通数据过滤到每个位置ID的*最后观察日期*。
- en: '*Calculate the total traffic* by adding the relevant columns together.'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过将相关列相加来*计算总交通量*。
- en: '*Group the data by location ID* to reduce the granularity to one row per location.'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按位置ID*分组数据*以减少粒度，使每个位置只有一行。
- en: '*Sum* the total traffic column and the bikes column.'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将总交通列和自行车列的数值*求和*。
- en: '*Calculate cycling as a percentage* for each location.'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为每个位置*计算自行车百分比*。
- en: 'What follows is Python code for this, and a snapshot of the resulting dataset
    is shown in figure 9.18:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是用于此目的的Python代码，以及结果数据集的快照，如图9.18所示：
- en: '[PRE12]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![figure](../Images/9-18.png)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-18.png)'
- en: Figure 9.18 Total traffic and cycling as an absolute and percentage value for
    each location
  id: totrans-171
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.18显示了每个位置的绝对值和百分比总交通量和自行车交通量
- en: Figure 9.18 shows each location ID, the most recent year for which we have data,
    and the traffic calculations, including the percentage of traffic attributed to
    cycling. We can already notice some locations with a high percentage of cycling
    traffic. Let’s investigate one of those examples in more detail. We will zoom
    in on just the first row from figure 9.18 and identify its location. The output
    is shown in figure 9.19.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.18显示了每个地点的ID、我们拥有的最新数据年份以及交通计算，包括归因于骑行的交通百分比。我们已经开始注意到一些骑行交通百分比高的地点。让我们更详细地研究其中的一个例子。我们将放大图9.18中的第一行并确定其位置。输出显示在图9.19中。
- en: '[PRE13]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![figure](../Images/9-19.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-19.png)'
- en: Figure 9.19 A specific location with a high cycling traffic percentage
  id: totrans-175
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.19 骑行交通百分比高的特定地点
- en: If we looked at this point on a map, we would find the same location we saw
    in figure 9.7\. This is in fact the same suburban street in Islington, North London,
    that had the highest volume of cycling traffic in absolute terms. It’s useful
    to see the same result verified from a different angle.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们在地图上查看这个点，我们会找到与图9.7中看到相同的地点。这实际上是位于伦敦北部的伊兹灵顿的同一条郊区街道，其绝对骑行交通量最高。看到从不同角度验证的相同结果是有用的。
- en: NOTE  Take a minute to look into some of the other locations that came up with
    high cycling traffic in the table produced in figure 9.6\. Do you notice any patterns?
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：花一分钟时间查看图9.6中产生的表格中出现的其他一些骑行交通量高的地点。你注意到任何模式吗？
- en: Looking at some of these locations, we see they all seem to be small suburban
    streets, perhaps being used as commuting shortcuts. Figure 9.20 shows the process
    so far, highlighting the fact that we are doing some investigations in parallel,
    with the results coming together at the end.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 观察一些这些地点，我们发现它们似乎都是小型的郊区街道，可能被用作通勤捷径。图9.20显示了到目前为止的过程，突出了我们正在进行一些并行调查，结果将在最后汇总。
- en: '![figure](../Images/9-20.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-20.png)'
- en: Figure 9.20 The current state of the analysis
  id: totrans-180
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.20 分析的当前状态
- en: Following our train of thought about some of these top locations, commuter pathways
    seem like a useful avenue to explore further, so let’s move our focus to that.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在思考这些热门地点的过程中，通勤路径似乎是一个值得进一步探索的有用途径，因此让我们将焦点转移到那里。
- en: Identifying temporal patterns within time series
  id: totrans-182
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 在时间序列中识别时间模式
- en: 'To investigate commuting patterns, we will do two things:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 为了调查通勤模式，我们将做两件事：
- en: Look at the most popular times of day for cycling at each location. In other
    words, what hour(s) of the day do people cycle the most?
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查看每个地点骑行最繁忙的时间。换句话说，人们一天中什么时候骑行最多？
- en: Once we understand this, we will identify locations where cycling traffic is
    highest during commuting hours.
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一旦我们理解了这一点，我们将确定在通勤高峰时段骑行交通量最高的地点。
- en: The first item requires us to calculate the average cycling traffic per hour.
    We can decide whether to average the results across all years of data or keep
    focusing on only the latest figures. Both approaches have pros and cons. Averaging
    across the entire data will negate possible changes in behavior over time if people
    don’t commute by bicycle the same way they did 10–20 years ago. Using only the
    most recent data means we amplify any particular biases that may have occurred
    that year (e.g., road closures that were otherwise not present). We still want
    to bias toward recency, so we will go with the latter option. A more sophisticated
    idea might be to perform a weighted average over time, weighting recent measurements
    higher than older ones.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 第一项要求我们计算每小时平均的骑行交通量。我们可以决定是否将结果平均到所有年份的数据中，或者只关注最新的数据。这两种方法都有其优缺点。在整个数据上平均可能会否定人们通勤方式在10-20年内可能发生的变化。仅使用最近的数据意味着我们放大了那一年可能发生的任何特定偏差（例如，原本不存在的道路封闭）。我们仍然希望偏向近期，因此我们将选择后者。一个更复杂的方法可能是对时间进行加权平均，将最近的数据赋予更高的权重。
- en: 'What does this particular calculation process look like? We will perform the
    following steps:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 这个特定的计算过程看起来是什么样子？我们将执行以下步骤：
- en: '*Filter the cycling data to the most recent year for each location *—This will
    give us an up-to-date view on cycling patterns.'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*将骑行数据过滤到每个地点最近的一年*—这将给我们一个关于骑行模式的最新视角。'
- en: '*Calculate the percentage of bike traffic that occurred in each hour of the
    day —*Using a percentage means comparable results regardless of the popularity
    of the location.'
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*计算每天每小时发生的自行车交通量的百分比—*使用百分比意味着无论位置的热门程度如何，结果都是可比较的。'
- en: '*Visualize the distribution of these percentage values by hour —*Using our
    “start at the end” approach, we imagine the final visualization. In this case,
    it will be a series of box plots, each representing an hour of the day and individual
    points representing the percentage of bike traffic in that hour of the day for
    a location.'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*通过小时可视化这些百分比值的分布—*使用我们的“从结果开始”方法，我们想象最终的可视化。在这种情况下，它将是一系列箱线图，每个代表一天中的某个小时，而单独的点代表该小时某个位置的自行车交通量的百分比。'
- en: From a technical perspective, the tricky point here is the first step. We need
    to count the total amount of cycling traffic per location while simultaneously
    comparing hourly values to that daily total. This requires us to have both hourly
    and daily values side by side. If you are a SQL user, this would be achieved with
    a *window function* using the `PARTITION` `BY` keyword. In `pandas`, we need to
    do something slightly different, in fact, so different that we can enlist the
    help of our favorite LLM.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 从技术角度来看，这里的难点在于第一步。我们需要同时计算每个位置的交通总量，并比较每小时值与每日总量的值。这要求我们同时拥有每小时和每日的值。如果您是SQL用户，这将通过使用带有`PARTITION
    BY`关键字的`窗口函数`来实现。在`pandas`中，我们需要做一些稍微不同的事情，实际上，我们可以求助于我们最喜欢的LLM。
- en: I asked ChatGPT how to achieve this, and its first result suggested calculating
    hourly and daily totals separately and then joining the two tables by location
    ID. This is a perfectly good approach, but I specifically asked about using a
    window function-like approach. Figure 9.21 shows the part of the conversation
    where I steered ChatGPT to the result I wanted.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 我询问ChatGPT如何实现这一点，它的第一个结果建议分别计算每小时和每日的总数，然后通过位置ID将两个表连接起来。这是一个非常好的方法，但我特别询问了使用类似窗口函数的方法。图9.21显示了我在引导ChatGPT到达我想要的结果的部分对话。
- en: '![figure](../Images/9-21.png)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/9-21.png)'
- en: Figure 9.21 A snippet of a conversation with ChatGPT about window functions
    in `pandas`
  id: totrans-194
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.21：关于`pandas`中窗口函数与ChatGPT对话的片段
- en: 'Therefore, we can use the `transform` method to achieve the desired result,
    which is to create a column alongside the raw data that captures the total daily
    cycling traffic for each location ID. Let’s first filter our traffic to include
    only the most recent date for each location:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们可以使用`transform`方法来实现所需的结果，即在原始数据旁边创建一个列，以捕捉每个位置ID的每日自行车交通总量。让我们首先过滤我们的交通数据，仅包括每个位置的最近日期：
- en: '[PRE14]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'We will now aggregate this `traffic_max_dates` DataFrame to one row per location
    per hour. The following code does this and produces the output in figure 9.22:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将`traffic_max_dates` DataFrame聚合为每小时的每位置一行。以下代码执行此操作，并在图9.22中产生输出：
- en: '[PRE15]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![figure](../Images/9-22.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/9-22.png)'
- en: Figure 9.22 Hourly cycling traffic per location for only the latest date for
    each location
  id: totrans-200
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.22：仅针对每个位置的最新日期的每小时自行车交通量
- en: 'Now, we need to create a column to measure total cycling traffic alongside
    this data to be able to calculate the percentage of cycling traffic attributable
    to each hour of the day for each location. This is where we use the trick that
    ChatGPT has shown us. The following code adds this column and calculates the percentage
    of traffic per hour, resulting in the data in figure 9.23:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要创建一个列来测量与这些数据并行的总自行车交通量，以便能够计算每个位置每天每个小时的自行车交通量的百分比。这就是我们使用ChatGPT向我们展示的技巧的地方。以下代码添加了这个列并计算了每小时的交通百分比，结果如图9.23所示：
- en: '[PRE16]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '#1 Transform calculates the total amount of traffic per location ID, so we
    can add it as an extra column without requiring an additional join.'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 Transform计算每个位置ID的交通总量，因此我们可以将其作为额外列添加，而无需额外的连接。'
- en: '![figure](../Images/9-23.png)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/9-23.png)'
- en: Figure 9.23 Hourly data with additional percentage calculations appended
  id: totrans-205
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.23：附加了额外百分比计算的每小时数据
- en: 'This is an instance where we want to verify those daily counts and percentage
    values before continuing. Let’s look at that first example, location 900056\.
    First, we calculate the latest date for that location from the raw data to ensure
    we have the right data:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个我们需要在继续之前验证那些每日计数和百分比值的例子。让我们先看看第一个例子，位置900056。首先，我们从原始数据中计算该位置的最新日期，以确保我们有正确的数据：
- en: '[PRE17]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'The output is `2019-05-20,` which tallies with the table in figure 9.23\. Now,
    we want to look at all the raw data for that location ID and date to see whether
    the total cycling count really was 14 and, therefore, whether the percentages
    are also correct. The following code finds the raw data, which is shown in figure
    9.24:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 输出结果是`2019-05-20`，这与图9.23中的表格相符。现在，我们想查看该位置ID和日期的所有原始数据，以查看总自行车计数是否真的是14，因此百分比是否也是正确的。以下代码找到了原始数据，如图9.24所示：
- en: '[PRE18]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![figure](../Images/9-24.png)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-24.png)'
- en: Figure 9.24 Raw data used to verify calculations of hourly cycling traffic percentages
  id: totrans-211
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.24 用于验证每小时自行车交通百分比计算的原始数据
- en: 'From this raw data, we can notice that adding up the `Pedal_cycles` column
    matches the total, and the percentages in the `hourly_pct` column are also correct.
    To summarize, we found that around a third of cycling traffic at this location
    is seen between 5 p.m. and 6 p.m., and the rest is scattered throughout the day.
    We can use this data across all location IDs to identify what percentage of cycling
    traffic is seen at different hours of the day in the box plot we imagined earlier.
    The following code creates the box plot shown in figure 9.25:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 从这些原始数据中，我们可以注意到将“Pedal_cycles”列相加的总数与总数相符，而“hourly_pct”列中的百分比也是正确的。总结一下，我们发现在这个地点，大约三分之一的自行车交通出现在下午5点到6点之间，其余的则分散在一天中的其他时间。我们可以使用这些数据覆盖所有位置ID，以确定在一天中的不同时段内，我们想象中的箱线图中看到的自行车交通流量的百分比。以下代码创建了图9.25所示的箱线图：
- en: '[PRE19]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![figure](../Images/9-25.png)'
  id: totrans-214
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-25.png)'
- en: Figure 9.25 Box plots showing how cycling traffic is distributed throughout
    the hours of the day
  id: totrans-215
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.25 箱线图显示一天中自行车交通的分布情况
- en: There is a lot of noise and outliers in these box plots, but if we focus on
    the median lines, the middles of the boxes, we notice that there is a rise in
    traffic approaching 5 p.m. as well as a peak at 8 a.m. followed by a sharp drop.
    This tells us that there is a commuting pattern in the data as a higher percentage
    of cycling traffic occurs between 8 a.m. and 9 a.m., as well as between 5 p.m.
    and 6 p.m. The closeness of the medians between 3 p.m. and 6 p.m. also suggests
    that while people generally commute *to* *work* at the same time, the times at
    which people commute *from* *work* vary more.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 这些箱线图中有很多噪声和异常值，但如果我们关注中位数线，即箱子的中间，我们会注意到交通量在下午5点附近有所上升，以及上午8点的峰值随后急剧下降。这告诉我们数据中存在通勤模式，因为上午8点到9点以及下午5点到6点之间的自行车交通量百分比更高。下午3点到6点之间中位数之间的接近性也表明，尽管人们通常在相同的时间通勤去工作，但人们通勤下班的时间差异更大。
- en: 'Equipped with this knowledge, we can now find locations where the highest percentage
    of cycling traffic occurs during commuting hours. We can think of these as “commuting
    hotspots”—areas where a significant proportion of cycling traffic is commute driven.
    We already have data aggregated at the hourly level, shown in figure 9.23, so
    from that, we can find the hour with the highest cycling traffic for each cycling
    location. There are a couple of edge cases to make decisions on first:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有了这些知识，我们现在可以找到通勤时段中自行车交通流量最高的地点。我们可以将这些地点视为“通勤热点”——在这些区域，自行车交通流量中有很大一部分是由通勤引起的。我们已经有按小时汇总的数据，如图9.23所示，因此我们可以从中找到每个自行车地点的最高自行车交通流量时段。有几个边缘情况需要首先做出决策：
- en: What happens if all cycling traffic is zero? We should probably output a missing
    value to show that this particular operation doesn’t make sense for that location.
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果所有自行车交通量都是零会发生什么？我们可能需要输出一个缺失值来表示这个特定操作对该位置没有意义。
- en: What if there are multiple hours with the same amount of cycling traffic? We
    could either take the first or last hour we encounter the maximum value or average
    the results somehow. Averaging two different hours of the day doesn’t sound meaningful,
    so we will make the decision to use the first hour where we encounter the maximum
    value. That is, if the highest cycling traffic is at 8 a.m. and 1 p.m., we output
    8 a.m.
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果有多个小时的自行车交通量相同，我们可以选择第一个或最后一个遇到最大值的小时，或者以某种方式平均结果。平均一天中的两个不同小时似乎没有意义，因此我们将决定使用遇到最大值的第一个小时。也就是说，如果最高的自行车交通量出现在上午8点和下午1点，我们将输出上午8点。
- en: 'The following code defines a function to calculate the highest hour for a given
    group, that is, a single location ID, then uses it to create a dataset with one
    row per location ID containing the hour in which cycling traffic was highest in
    the last recorded measurement year. A snapshot of this aggregated data is shown
    in figure 9.26:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码定义了一个函数来计算给定组的最高小时，即单个地点ID，然后使用它创建一个包含每个地点ID在最后记录的测量年中自行车交通最高的小时的数据集。这个聚合数据的快照如图9.26所示：
- en: '[PRE20]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![figure](../Images/9-26.png)'
  id: totrans-222
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-26.png)'
- en: Figure 9.26 Highest hour of cycling traffic per location ID
  id: totrans-223
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.26 每个地点ID的自行车交通最高小时
- en: 'We may find a few instances of missing values where the lowest and highest
    cycling volume was the same, including when it was zero throughout. In figure
    9.26, however, we see examples of an actual highest hour being output. One scenario
    we need to account for is cases where we need a tiebreak because the highest cycling
    traffic occurred in multiple hours. The following code retrieves raw data for
    such an example, which is shown in figure 9.27:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可能会发现一些缺失值的情况，其中最低和最高的自行车交通量相同，包括整个周期都是零的情况。然而，在图9.26中，我们看到实际最高小时被输出的例子。我们需要考虑的一个场景是，当最高自行车交通量发生在多个小时时，我们需要解决平局的情况。以下代码检索了这样一个示例的原始数据，如图9.27所示：
- en: '[PRE21]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![figure](../Images/9-27.png)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-27.png)'
- en: Figure 9.27 Hourly data for location 941463 showing that both hour values 8
    and 16 had the highest cycling traffic
  id: totrans-227
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.27 展示了地点941463的小时数据，其中8点和16点的小时值都有最高的自行车交通量
- en: Because, inside our function, we sorted our data in ascending order of cycling
    traffic, and in ascending order by hour, we returned the earliest instance of
    encountering the highest traffic. We may choose to do something about this explicitly
    or accept that there may be a slight bias toward earlier times when calculating
    which hour is the busiest by location. We will do the latter in this instance
    because the occurrence of a tie is likely not that common.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 因为在我们的函数内部，我们是按照自行车交通量的升序以及小时的升序来排序数据的，并且返回了遇到最高交通量的最早实例。我们可能选择明确地处理这个问题，或者接受在计算哪个小时是某个地点最繁忙时可能存在对早期时间的轻微偏差。在这个例子中，我们将选择后者，因为发生平局的可能性不太常见。
- en: 'If we look at the distribution of the busiest hours, we will be able to see
    at what time most locations have their cycling traffic peaks. The following code
    creates the histogram shown in figure 9.28:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们观察最繁忙时段的分布，我们就能看到大多数地方自行车交通高峰出现在什么时间。以下代码创建了图9.28所示的直方图：
- en: '[PRE22]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '![figure](../Images/9-28.png)'
  id: totrans-231
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-28.png)'
- en: Figure 9.28 Distribution of peak cycling hours across locations
  id: totrans-232
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.28 各地点自行车高峰时段的分布
- en: 'This plot reinforces the idea that most locations have their peak cycling traffic
    during commuter hours. Let’s summarize what we’ve learned so far about cycling
    patterns:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 这个图表加强了这样一个观点：大多数地点的自行车交通高峰发生在通勤时段。让我们总结一下到目前为止关于自行车模式学到的东西：
- en: There is variation in cycling trends, but most importantly, there are multiple
    locations with increased cycling traffic over time.
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自行车趋势存在变化，但最重要的是，随着时间的推移，有多个地点的自行车交通量有所增加。
- en: There is also variation in what percentage of traffic is cycling, but crucially,
    there are locations where cycling is the majority of traffic.
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在自行车交通的百分比上也有变化，但关键的是，有一些地方自行车交通是主要交通方式。
- en: There is also variation in when people cycle, but there are locations with commuting
    patterns of cycling traffic.
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 人们骑自行车的时间也有变化，但有一些地方的自行车交通通勤模式。
- en: Following on from that, there are locations where commuting hours are the busiest
    for cycling.
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在此基础上，还有一些地方的通勤时段是自行车交通最繁忙的时段。
- en: Each of these criteria could be used to find places of interest with respect
    to cycling. How do we decide which criterion makes sense?
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 这些标准中的每一个都可以用来找到与自行车相关的兴趣点。我们如何决定哪个标准是有意义的？
- en: Note  If you’re interested in examples of where “deciding what is best” is the
    primary goal, see chapter 4, which is all about choosing the right metrics.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：如果你对“决定什么最好”是主要目标的例子感兴趣，请参阅第4章，该章节全部关于选择正确的指标。
- en: We would need to use domain knowledge and talk to stakeholders to get a true
    sense of this, but for now, there doesn’t seem to be a good reason not to use
    all these criteria. Because we are trying to filter our locations down to the
    ones of most interest, let’s try finding locations that match all those criteria,
    specifically,
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要使用领域知识并与利益相关者交谈，以获得对这个问题的真正理解，但到目前为止，似乎没有不使用所有这些标准的良好理由。因为我们试图将我们的地点过滤到最感兴趣的几个，所以让我们尝试找到符合所有这些标准的地点，特别是，
- en: Locations where the percentage of cycling traffic is high, that is, at least
    X%, where we have to define X
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 骑自行车交通百分比高的地点，即至少X%，其中我们必须定义X
- en: Locations where there has been an increase in cycling traffic, that is, an increase
    of at least Y% where we have to define Y
  id: totrans-242
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 骑自行车交通有所增加的地点，即至少增加Y%，其中我们必须定义Y
- en: Locations where cycling is used for commuting, that is, peak cycling traffic
    is either 8 a.m.–9 a.m. or 5 p.m.–6 p.m.
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 骑自行车用于通勤的地点，即高峰骑自行车交通是在早上8点到9点或下午5点到6点之间
- en: If applying all these criteria yields too few results, we can always broaden
    them by looking for afternoon commuting times between 4 p.m. and 7 p.m., for example.
    Before combining our results to find cycling locations of interest, let’s recap
    the process. Figure 9.29 shows the latest state of the analysis.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 如果应用所有这些标准导致结果过少，我们总是可以通过寻找下午4点到7点之间的通勤时间来扩大范围，例如。在我们将结果组合起来寻找感兴趣的骑自行车地点之前，让我们回顾一下这个过程。图9.29显示了分析的最新状态。
- en: '![figure](../Images/9-29.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-29.png)'
- en: Figure 9.29 The analysis process just before we combine our results into final
    recommendations
  id: totrans-246
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.29 在我们将结果组合成最终建议之前的分析过程
- en: Let’s apply the different criteria we determined we would use to select locations
    of interest and see if we find anything.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们应用我们确定将用于选择地点的不同标准，看看我们是否能找到什么。
- en: Combining criteria to identify time series of interest
  id: totrans-248
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 结合标准以识别感兴趣的时序
- en: To find locations that match multiple criteria, we could either perform a single,
    large query with multiple filters or create filtered versions of each criterion
    and combine them at the end. We will prefer the latter approach because it allows
    us to investigate each subset separately. This might be useful if we find nothing
    is returned and want to investigate which criterion is too strict and yields no
    results.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 要找到符合多个标准的地点，我们可以执行一个包含多个过滤器的单一、大型查询，或者为每个标准创建过滤版本并在最后将它们组合起来。我们更倾向于后者，因为它允许我们单独调查每个子集。如果我们什么都没有找到，想要调查哪个标准过于严格导致没有结果，这可能是有用的。
- en: 'Let’s first filter the locations to keep only those with a significant percentage
    of traffic being cycling. How do we know what percentage to use as a cutoff? We
    haven’t actually looked at the distribution of this percentage yet, so we’ll start
    there, and the resulting histogram will show us where the majority of the data
    lies. The following code creates the histogram in figure 9.30, which we will use
    to make this decision. We will use a DataFrame we have already created, which
    we called `annual_bike_traffic`, that contains the percentage of traffic attributed
    to cycling in the latest year:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们先过滤地点，只保留那些有相当比例的交通是骑自行车的。我们如何知道使用什么百分比作为截止点？我们实际上还没有查看这个百分比的分布，所以我们将从这里开始，生成的直方图将显示数据的大多数所在位置。以下代码创建了图9.30中的直方图，我们将用它来做这个决定。我们将使用我们已创建的DataFrame，我们称之为`annual_bike_traffic`，它包含最新年份中分配给骑自行车的交通百分比：
- en: '[PRE23]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![figure](../Images/9-30.png)'
  id: totrans-252
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-30.png)'
- en: Figure 9.30 Distribution of the percentage of traffic due to cycling at each
    location
  id: totrans-253
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.30 每个地点因骑自行车而产生的交通百分比分布
- en: 'This histogram shows that most locations have under 10% of their traffic due
    to cycling. That feels like a good cutoff to distinguish areas of significant
    cycling traffic. The following code implements this filter and creates a filtered
    list of location IDs, a snapshot of which is shown in figure 9.31:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 这个直方图显示，大多数地点的交通中骑自行车的比例不到10%。这感觉像是一个很好的截止点来区分有显著骑自行车交通的区域。以下代码实现了这个过滤器并创建了一个过滤后的地点ID列表，其中一部分在图9.31中显示：
- en: '[PRE24]'
  id: totrans-255
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![figure](../Images/9-31.png)'
  id: totrans-256
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-31.png)'
- en: Figure 9.31 Location IDs with significant cycling traffic
  id: totrans-257
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.31 有显著骑自行车交通的地点ID
- en: 'This shows there are 38 locations with at least 10% of traffic due to cycling.
    Now, we want to create a similar list of locations, but this time, locations that
    had at least a Y% increase in cycling between the first and last dates we measured.
    The value for Y will be somewhat arbitrary, and we may decide to tweak it if we
    want to return more locations. We will start with 50% and see what that gets us.
    The following code creates this filtered list, which yields a list of numbers
    similar to that shown in figure 9.31\. Again, we already have the underlying values
    calculated from a previous DataFrame, `cycling_diffs`:'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 这表明有38个位置至少有10%的交通是由于骑自行车造成的。现在，我们想要创建一个类似的位置列表，但这次是那些在第一个和最后一个测量日期之间至少有Y%自行车增长的位置。Y的值将有些任意，如果我们想返回更多位置，我们可能会决定调整它。我们将从50%开始，看看能得到什么。以下代码创建了这个过滤后的列表，它产生了一个类似于图9.31所示的数字列表。同样，我们已经从之前的DataFrame
    `cycling_diffs`中计算出了底层值：
- en: '[PRE25]'
  id: totrans-259
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '#1 We need to exclude infinity values, so they don’t show up in calculations.'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 我们需要排除无穷大值，以免它们出现在计算中。'
- en: 'The result of this code tells us there are 230 such locations. Finally, we
    will create a third list of locations, which will be locations where the highest
    commuting time is either 8 a.m.–9 a.m. or 5 p.m.–6 p.m. The following code does
    this using the `highest_hours` DataFrame created earlier:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码的结果告诉我们有230个这样的位置。最后，我们将创建第三个位置列表，这将是在最高上下班时间要么是上午8点到9点，要么是下午5点到6点的位置。以下代码使用之前创建的`highest_hours`
    DataFrame来完成这项工作：
- en: '[PRE26]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: The output is a list of 195 locations. We now have three lists of locations
    to combine. What we want to know is which location IDs appear in all three lists.
    In Python, we can do this quite easily using set theory. In this case, a *set*
    is the specific mathematical concept of a collection of unique elements.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 输出是一个包含195个位置的列表。我们现在有三个位置列表需要合并。我们想知道哪些位置ID出现在所有三个列表中。在Python中，我们可以通过集合理论非常容易地做到这一点。在这种情况下，一个*集合*是包含唯一元素的特定数学概念。
- en: Tip  If you’re a Python user, whenever you encounter problems with unique values,
    consider whether using sets is appropriate. They’re often a fast and simple way
    to get a complex result, such as finding values that appear in two or more collections.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 提示：如果您是Python用户，每当您遇到唯一值问题时，考虑是否使用集合是合适的。它们通常是快速简单获得复杂结果的方法，例如找到出现在两个或更多集合中的值。
- en: By converting our lists into sets, we can calculate the *intersection* of the
    sets, that is, elements that appear in both sets. You can think of this as finding
    the center of a Venn diagram of three circles, as illustrated in figure 9.32.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 通过将我们的列表转换为集合，我们可以计算集合的*交集*，即同时出现在两个集合中的元素。您可以将其视为找到三个圆的维恩图中心，如图9.32所示。
- en: '![figure](../Images/9-32.png)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-32.png)'
- en: Figure 9.32 Illustration of identifying locations with multiple criteria using
    set theory
  id: totrans-267
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.32 使用集合理论识别具有多个标准的位置的说明
- en: 'The following code converts our lists to sets and performs the intersection
    of all three to discover whether there are any overlaps. The result is shown in
    figure 9.33:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码将我们的列表转换为集合，并执行所有三个集合的交集，以发现是否有任何重叠。结果如图9.33所示：
- en: '[PRE27]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '#1 Converts the first list to a set'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 将第一个列表转换为集合'
- en: '#2 Finds the intersection between two of the sets'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 在两个集合之间找到交集'
- en: '#3 Finds the intersection between this result and the third set'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 在这个结果和第三个集合之间找到交集'
- en: '![figure](../Images/9-33.png)'
  id: totrans-273
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-33.png)'
- en: Figure 9.33 The list of the final locations of interest
  id: totrans-274
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.33 最终感兴趣的位置列表
- en: 'It looks like our criteria weren’t too restrictive, and we have some results—11,
    to be precise. These locations all have a significant percentage of traffic due
    to cycling, at least a 50% increase in cycling volume over time, and they have
    peaks at commuting times. It’s time to dig into these results and understand what
    locations they relate to. Let’s look these location IDs up in the raw traffic
    data, extract only location information, and limit each location to a single row.
    We will also sort the results by region and local authority to better see where
    these top locations are geographically. The following code does all this and produces
    the table in figure 9.34:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来我们的标准并不太严格，我们有一些结果——确切地说，是11个。这些位置都有由于骑自行车造成的显著百分比交通，自行车数量在时间上至少增加了50%，并且在上下班高峰时段有峰值。是时候深入研究这些结果并了解它们与哪些位置相关了。让我们在原始交通数据中查找这些位置ID，提取仅位置信息，并将每个位置限制为单行。我们还将按地区和地方当局对结果进行排序，以便更好地看到这些顶级位置在地理上的分布。以下代码执行所有这些操作，并产生了图9.34中的表格：
- en: '[PRE28]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '![figure](../Images/9-34.png)'
  id: totrans-277
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-34.png)'
- en: Figure 9.34 Information about the top cycling locations
  id: totrans-278
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.34 顶级自行车地点信息
- en: There are locations scattered throughout the country. Unsurprisingly, perhaps,
    there are quite a few in London, but results stretch from Bristol in the southwest
    all the way to Edinburgh up north in Scotland. Once we go through and verify these
    locations to make sure none of them are just artifacts in the data, we are ready
    to present our preliminary findings to our stakeholders. However, before we summarize
    our findings, let’s take a detour into forecasting since that is one of the ways
    in which time series data can be powerful.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 这些地点遍布全国。不出所料，伦敦有很多，但结果从西南部的布里斯托尔一直延伸到苏格兰北部的爱丁堡。一旦我们逐一验证这些地点，确保它们都不是数据中的伪象，我们就可以向我们的利益相关者展示我们的初步发现。然而，在我们总结我们的发现之前，让我们先了解一下预测，因为这是时间序列数据可以发挥强大作用的方式之一。
- en: Forecasting time series
  id: totrans-280
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 时间序列预测
- en: We have enough to show stakeholders and start thinking about further work, but
    in the spirit of this being a time series problem, we should consider how well
    we can forecast cycling trends based on the available data. This would help us
    identify locations where we expect cycling to increase significantly soon, as
    well as open up other opportunities, such as proactive traffic management.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有足够的资料向利益相关者展示并开始考虑进一步的工作，但鉴于这是一个时间序列问题，我们应该考虑我们如何根据可用数据预测自行车趋势。这将帮助我们确定我们预计自行车将很快显著增加的地点，以及开辟其他机会，例如主动交通管理。
- en: 'To successfully forecast a time series, we typically need it to obey some properties:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 要成功预测一个时间序列，我们通常需要它遵循一些属性：
- en: '*The time series should be at consistent intervals.* We’ve already achieved
    this by creating an annual time series and removing the specific date component
    because measurements were not usually taken on the same day each year.'
  id: totrans-283
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*时间序列应保持一致的时间间隔。* 我们已经通过创建年度时间序列并移除特定的日期成分来实现这一点，因为每年的测量通常不在同一天进行。'
- en: '*The time series should have no gaps.* We filtered down our time series to
    ensure this was the case.'
  id: totrans-284
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*时间序列应无间断。* 我们已经过滤了我们的时间序列，以确保这一点。'
- en: '*There should be as many full cycles of data as possible.* In the case of annual
    data, we don’t necessarily have cycles, so in our case, this just means the more
    data we have, the better.'
  id: totrans-285
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*数据应尽可能包含尽可能多的完整周期。* 在年度数据的情况下，我们不一定有周期，所以在这种情况下，这意味着我们拥有的数据越多，越好。'
- en: '*There are other properties, such as stationarity, that some models require
    the time series to exhibit.* This is not exhaustive, though, since other models
    can account for this automatically.'
  id: totrans-286
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*还有一些其他属性，例如平稳性，某些模型要求时间序列展示出来。* 虽然这不是详尽的，因为其他模型可以自动处理这一点。'
- en: 'To see whether our time series can be successfully forecasted, let’s examine
    one of them in more detail. Let’s choose a time series that exhibits a trend,
    that is, one of the time series from our “biggest increases” list that has the
    greatest possible coverage. The following code calculates the coverage of these
    time series and produces the table in figure 9.35, from which we will choose our
    sample:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 为了检验我们的时间序列是否可以成功预测，让我们更详细地考察其中之一。让我们选择一个表现出趋势的时间序列，即我们“最大增长”列表中具有最大可能覆盖范围的时间序列。以下代码计算了这些时间序列的覆盖范围，并生成了图9.35中的表格，我们将从中选择我们的样本：
- en: '[PRE29]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '![figure](../Images/9-35.png)'
  id: totrans-289
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-35.png)'
- en: Figure 9.35 Locations with the biggest increase in cycling and with their coverage
    calculated
  id: totrans-290
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.35 自行车增长最大的地点及其覆盖范围计算
- en: 'Some of these locations have as much as 19 years of data, and we will pick
    one of those to investigate. We will arbitrarily use the first location in that
    list to test our ability to forecast these location-level time series. The following
    code takes the raw data for that location and creates a single annual time series
    of cycling volumes for us to use. The resulting time series is shown in figure
    9.36:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 这些地点中有些有长达19年的数据，我们将从中选择一个进行调查研究。我们将随意使用该列表中的第一个地点来测试我们预测这些地点级时间序列的能力。以下代码为该地点提取原始数据，并为我们创建了一个单一年度自行车量的时间序列。该时间序列如图9.36所示：
- en: '[PRE30]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '![figure](../Images/9-36.png)'
  id: totrans-293
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-36.png)'
- en: Figure 9.36 The cycling time series for location 996188
  id: totrans-294
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.36 地点996188的自行车时间序列
- en: 'One Python-specific aspect to notice is that the index of the series is an
    integer, whereas to make time series manipulation easier, it should be a date.
    The following code fixes that and allows us to plot the time series, as shown
    in figure 9.37:'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的一个Python特定方面是，序列的索引是一个整数，而为了使时间序列操作更容易，它应该是一个日期。以下代码解决了这个问题，并允许我们绘制时间序列，如图9.37所示：
- en: '[PRE31]'
  id: totrans-296
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '![figure](../Images/9-37.png)'
  id: totrans-297
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-37.png)'
- en: Figure 9.37 Cycling traffic time series at a specific location
  id: totrans-298
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.37特定位置的骑行交通时间序列
- en: We have a time series of 19 annual values with an upward trend. We often want
    to see if a time series has seasonality, that is, patterns that repeat at the
    same point along the time series, but this makes less sense in the context of
    annual values.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有一组19年的年度值时间序列，呈现上升趋势。我们经常想要查看时间序列是否存在季节性，即沿时间序列在相同点重复出现的模式，但在年度值的背景下这不太有意义。
- en: To understand the individual components of a time series, we can *decompose*
    the series into trend, seasonal, and residual components. Trend tells us whether
    there is a long-term change in the average of the values, that is, whether the
    values are moving in a particular direction. Seasonality is the regularly occurring
    movements that depend on where in the time series we are. Residuals are what is
    left after we have taken both trend and seasonality into account. Unexpectedly
    high residuals mean there was something unusual about a time series at that point,
    which cannot be explained by its underlying trend and seasonal patterns alone.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 为了理解时间序列的各个组成部分，我们可以将序列分解为趋势、季节和残差成分。趋势告诉我们平均值是否有长期变化，也就是说，值是否向特定方向移动。季节性是依赖于我们在时间序列中的位置的定期运动。残差是在考虑了趋势和季节性之后剩下的部分。意外的高残差意味着在这一点上时间序列有某些异常，这不能仅由其基本趋势和季节性模式来解释。
- en: In Python, the `statsmodels` module has various time series methods, including
    decomposition, which we will apply to our time series. We will implement STL (seasonal
    and trend decomposition using LOESS [locally estimated scatterplot smoothing]),
    and attempt to extract the trend, seasonal, and residual components of a time
    series. With a lot of these methods, we need to pick some parameter values that
    will alter the results. In the case of STL, we need to pick the period, how much
    smoothing to apply to the trend, and how many observations constitute a season.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 在Python中，`statsmodels`模块有各种时间序列方法，包括分解，我们将将其应用于我们的时间序列。我们将实现STL（使用LOESS进行季节和趋势分解[局部估计散点图平滑]），并尝试提取时间序列的趋势、季节和残差成分。在许多这些方法中，我们需要选择一些将改变结果的参数值。在STL的情况下，我们需要选择周期、对趋势应用多少平滑以及构成季节的观测数。
- en: In our case, we have annual data with no clear, regular seasonal pattern. As
    annual time series are a special case for some of these methods, we can turn to
    our AI tools for further guidance. The documentation of the library we’re using
    may also contain hints on how to choose parameter values. In this instance, I
    asked ChatGPT to advise on picking these values for an annual time series with
    no real seasonality. A portion of its response is shown in figure 9.38.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的案例中，我们拥有没有明显、规律季节性模式的年度数据。由于年度时间序列是这些方法中的一些特殊案例，我们可以求助于我们的AI工具以获得进一步指导。我们使用的库的文档也可能包含有关如何选择参数值的提示。在这种情况下，我要求ChatGPT就选择一个没有真实季节性的年度时间序列的这些值提供建议。其部分响应如图9.38所示。
- en: '![figure](../Images/9-38.png)'
  id: totrans-303
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-38.png)'
- en: Figure 9.38 ChatGPT’s response regarding the parameters in the STL decomposition
    method
  id: totrans-304
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.38 ChatGPT关于STL分解方法参数的响应
- en: 'This answer suggests that in cases where there is no clear seasonality, choosing
    parameter values will come down to what fits the problem best. It recommends a
    low value for the seasonal parameter and to favor default values where possible.
    We will set the period to `2` and seasonal to `3` and examine the output. The
    code is as follows and produces the decomposition plot shown in figure 9.39:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 这个答案建议，在没有明显季节性的情况下，选择参数值将取决于最适合问题的方案。它建议季节性参数选择一个低值，并在可能的情况下优先考虑默认值。我们将周期设置为`2`，季节性设置为`3`，并检查输出。代码如下，并生成如图9.39所示的分解图：
- en: '[PRE32]'
  id: totrans-306
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '![figure](../Images/9-39.png)'
  id: totrans-307
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-39.png)'
- en: Figure 9.39 Seasonal decomposition of a single time series
  id: totrans-308
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.39单个时间序列的季节分解
- en: This plot shows us (from top to bottom) the raw data, the trend component, the
    seasonal patterns, and the residuals. In the trend component, we find a smoothed
    version of the time series, which looks like a fairly steady rise throughout,
    perhaps leveling out at the end. Because we set a low smoothing value, the seasonal
    component mimics the peaks seen in the raw data. This is to reinforce the idea
    that there might not be a repeated seasonal variation, but there are distinct
    peaks to investigate. The residuals start off larger at the beginning and seem
    consistently centered around zero afterward. The peak we encounter around 2002
    is unexpected if we were to simply model the series using the trend and seasonal
    variation, which tells us there are external factors that make the start of this
    series less predictable.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 这个图示从上到下展示了原始数据、趋势成分、季节性模式和残差。在趋势成分中，我们发现时间序列的一个平滑版本，看起来整体呈稳步上升，可能到结尾时趋于平稳。因为我们设置了较低的平滑值，季节性成分模仿了原始数据中的峰值。这是为了强化这样一个观点：可能不存在重复的季节性变化，但有明显的峰值需要调查。残差在开始时较大，之后似乎始终围绕零值中心。我们在2002年左右遇到的峰值，如果我们仅仅使用趋势和季节性变化来建模这个序列，将会是出乎意料的，这告诉我们存在外部因素使得这个序列的开始部分更难以预测。
- en: All in all, we have learned that the time series seems mostly predictable, apart
    from perhaps around 2002\. Our next step is to build a forecasting model. If we
    had domain expertise, we could investigate possible reasons behind the higher
    residuals around 2002 and build those reasons in as additional variables. For
    now, we will use a standard forecasting method, ARIMA, to predict cycling traffic
    in the next couple of years.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 总的来说，我们了解到时间序列似乎大部分是可以预测的，除了可能在2002年左右。我们的下一步是构建一个预测模型。如果我们有领域专业知识，我们可以调查2002年左右残差较高的可能原因，并将这些原因作为额外的变量构建进去。目前，我们将使用标准的预测方法ARIMA来预测未来几年的自行车交通流量。
- en: 'Auto-regressive integrated moving average, or ARIMA, is another method that
    requires the user to choose certain parameters. Ideally, this is done automatically
    based on what combination of parameters produces the most accurate model. If you
    are an R user, you might have used R’s `auto.arima` method. There are equivalents
    in Python, such as the one in the `pmdarima` module, which we will use here. The
    following code calculates the best ARIMA model on the available data and then
    plots its predicted values against the observed values. The plot is shown in figure
    9.40:'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 自回归积分移动平均，或ARIMA，是另一种需要用户选择某些参数的方法。理想情况下，这是基于哪种参数组合产生最准确模型而自动完成的。如果你是R用户，你可能已经使用过R的`auto.arima`方法。在Python中也有等效的方法，例如`pmdarima`模块中的方法，我们在这里将使用它。以下代码在可用数据上计算最佳ARIMA模型，然后将其预测值与观察值进行对比绘图。该图示在图9.40中展示：
- en: '[PRE33]'
  id: totrans-312
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '#1 Automatically finds the best ARIMA model'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 自动找到最佳的ARIMA模型'
- en: '#2 Calculates predictions on the training data'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 在训练数据上计算预测值'
- en: '#3 Forecasts three time points ahead'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 预测三个时间点的前瞻值'
- en: '#4 Combines predicted and forecasted values into a single time series for plotting'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 将预测值和预测值合并为单一时间序列进行绘图'
- en: '![figure](../Images/9-40.png)'
  id: totrans-317
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-40.png)'
- en: Figure 9.40 Actual vs. predicted values for a particular location’s time series
  id: totrans-318
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.40 某特定位置时间序列的实际值与预测值对比
- en: What does this plot tell us?
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 这个图示告诉我们什么？
- en: The ARIMA model misses a couple of peaks and tries to correct for them, which
    is especially clear around 2002\.
  id: totrans-320
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ARIMA模型错过了一些峰值并试图纠正它们，这在2002年左右尤为明显。
- en: Because the ARIMA model is somewhat self-correcting, it tries to match the observed
    data’s shape.
  id: totrans-321
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于ARIMA模型具有一定的自我纠正能力，它试图匹配观察到的数据的形状。
- en: The unexpected flatline between 2008 and 2012 also takes ARIMA by surprise,
    as does the subsequent peak in 2013\.
  id: totrans-322
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 2008年至2012年之间的意外平稳线也令ARIMA模型感到惊讶，2013年的后续峰值也是如此。
- en: Ultimately, there isn’t enough future information to go on, and ARIMA reverts
    to predicting average behavior into the future by predicting a drop and then a
    peak.
  id: totrans-323
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最终，由于缺乏足够的前瞻性信息，ARIMA模型会回归到通过预测下降然后达到峰值来预测未来的平均行为。
- en: This is a particularly difficult forecasting problem because we don’t have a
    lot of data, and there are not a lot of patterns to exploit, apart from the slightly
    rising trend. The fact that we only have measurements from a single day each year
    is an added difficulty. The best that ARIMA can do for us is predict average behavior
    in line with the more recent data points. To improve this forecast, ideally, we
    would have more historical data and additional variables that could help predict
    changes in cycling traffic.
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个特别困难的预测问题，因为我们没有很多数据，而且除了略微上升的趋势外，没有很多模式可以利用。我们每年只从单一天进行测量的事实增加了难度。ARIMA能为我们做的最好的事情是根据最近的数据点预测平均行为。为了改善这个预测，理想情况下，我们会有更多的历史数据和额外的变量，这些变量可以帮助预测自行车交通的变化。
- en: That being said, we could still run this forecasting code on all our cycling
    time series, and for those that have recent data, we could look at the forecast
    for the next time point. If these forecasts remain high compared to previous values,
    we could use that to identify time series with an upward trend. This might be
    a more sophisticated way to find locations with increased cycling because locations
    where cycling is in decline after a mid-series peak might be filtered out more
    successfully. However, as it stands, it doesn’t look like we would gain much for
    our recommendations, so it’s finally time to draw some conclusions and think about
    next steps.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 话虽如此，我们仍然可以在所有自行车时间序列上运行这个预测代码，对于那些有最新数据的，我们可以查看下一个时间点的预测。如果这些预测与之前的值相比仍然很高，我们可以利用这一点来识别具有上升趋势的时间序列。这可能是一种更复杂的方法来找到自行车交通增加的地方，因为那些在系列中期达到峰值后自行车交通量下降的地方可能会被更成功地过滤掉。然而，就目前来看，我们似乎不会从我们的建议中获得太多，所以现在是时候得出一些结论并考虑下一步了。
- en: Before proceeding to the conclusion, let’s look at the final diagram that documents
    the analysis. There were three parallel investigations into how we could narrow
    down the data to locations of interest. Each of them came with a decision about
    cutoffs (e.g., what percentage increase we treat as significant). These decision
    points are combined into one on the diagram because we made them together at the
    final stage, but they represent three separate decisions we needed to make. Figure
    9.41 shows the final path we took during our analysis.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 在得出结论之前，让我们看一下记录分析的最终图。我们对如何缩小数据到感兴趣的位置进行了三项并行调查。每一项都伴随着关于截止点的决定（例如，我们将多少百分比的增加视为有意义的）。这些决策点在图上合并为一个，因为我们是在最终阶段一起做出的，但它们代表了我们需要做出的三个单独的决定。图9.41显示了我们在分析过程中采取的最终路径。
- en: '![figure](../Images/9-41.png)'
  id: totrans-327
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/9-41.png)'
- en: Figure 9.41 The final analysis diagram
  id: totrans-328
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图9.41 最终分析图
- en: Let’s now take our findings and summarize them into conclusions and recommendations.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将我们的发现总结成结论和建议。
- en: 9.2.2 Project conclusions and recommendations
  id: totrans-330
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 9.2.2 项目结论和建议
- en: Let’s remind ourselves of our initial aims. The first phase of the project we
    are supporting is to identify the most suitable places around the country to improve
    infrastructure for cyclists. This meant finding places with already significant
    or increasing cycling traffic. Let’s also remind ourselves about what we ended
    up doing and the decisions we decided to make along the way.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回顾一下我们的初始目标。我们支持的项目第一阶段是确定全国范围内最适合改善自行车基础设施的地方。这意味着要找到已经具有显著或正在增加的自行车交通流量的地方。让我们也回顾一下我们最终做了什么，以及我们在过程中做出的决定。
- en: The output of our analysis would be the 11 locations identified as meeting multiple
    criteria for being relevant to our aims. We could present these as a list or even
    as points on a map. In fact, map visualizations would be a great way to bring
    the data story to life here. The important thing would be to discuss these findings
    with our domain experts.
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 我们分析的结果是确定了11个符合多个标准、与我们目标相关的地方。我们可以将这些地点以列表形式呈现，甚至作为地图上的点。实际上，地图可视化将是一个使数据故事生动起来的好方法。重要的是要与我们的领域专家讨论这些发现。
- en: As for further work, this would be informed by our stakeholder conversations,
    but some directions we could go from here include
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 至于进一步的工作，这将由我们的利益相关者对话来指导，但我们可以从这里出发的方向包括
- en: '*Revisiting some of our choices and assumptions*—One decision we made was to
    remove the time series that did not have enough coverage. However, we ended up
    not making use of forecasting, so if we relax this coverage criterion and allow
    shorter time series, we might find additional locations of interest.'
  id: totrans-334
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*回顾我们的选择和假设*——我们做出的一个决定是移除覆盖范围不足的时间序列。然而，我们最终没有使用预测，所以如果我们放宽这个覆盖范围标准，允许更短的时间序列，我们可能会发现更多感兴趣的位置。'
- en: '*Including additional datasets in the analysis*—Cross-referencing our findings
    with data about special events, road closures, or even weather would give us a
    better picture of locations with organically increasing cycling traffic and which
    locations have increases that are likely caused by external factors.'
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*在分析中包含额外的数据集*——将我们的发现与关于特殊事件、道路关闭或甚至天气的数据进行交叉引用，将为我们提供有关有机增长自行车交通的位置以及哪些位置的增长可能是由于外部因素造成的更清晰的画面。'
- en: '*Visualizing data geographically*—This could also help pinpoint places where
    there are multiple locations of interest in close proximity. For example, three
    of our recommended locations of interest were in the borough of Lambeth. This
    sort of insight would be even easier to arrive at if locations were plotted on
    a map.'
  id: totrans-336
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*地理数据可视化*——这也有助于确定在近距离内有多个感兴趣位置的地方。例如，我们推荐的三个感兴趣的位置都在兰贝思区。如果将这些位置绘制在地图上，这种洞察力将更容易得出。'
- en: 'Activity: Further project ideas with this data'
  id: totrans-337
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 活动：使用这些数据的进一步项目想法
- en: 'Consider some other research questions you could answer with this data that
    are unrelated to the project in this chapter. Here are some ideas to get you started:'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑一些其他的研究问题，你可以用这些数据回答，这些问题与本章的项目无关。以下是一些帮助你开始的想法：
- en: What happens when you compare traffic patterns at different levels of geography,
    such as regional or local authority level?
  id: totrans-339
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当你比较不同地理级别的交通模式时，会发生什么，比如地区或地方当局级别？
- en: How are traffic patterns different for different types of vehicles? Where are
    the hotspots for, say, cars versus buses versus heavy-goods vehicles (HGVs)?
  id: totrans-340
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不同类型的车辆的交通模式有何不同？例如，汽车、公交车和重型货车（HGVs）的热点在哪里？
- en: Based on the available data, which part of the country is most in need of additional
    road infrastructure?
  id: totrans-341
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据可用数据，哪个国家的哪个部分最需要额外的道路基础设施？
- en: If you’ve ever been interested in geospatial data analysis, this is an opportunity
    to experiment with it. The Department for Transport website contains shape files,
    which contain locations for the major road network and can be used for geospatial
    analysis and visualization. You can find them at [https://roadtraffic.dft.gov.uk/downloads](https://roadtraffic.dft.gov.uk/downloads).
  id: totrans-342
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你曾经对地理空间数据分析感兴趣，这是一个实验它的机会。交通部网站包含形状文件，其中包含主要道路网络的位置，可用于地理空间分析和可视化。您可以在[https://roadtraffic.dft.gov.uk/downloads](https://roadtraffic.dft.gov.uk/downloads)找到它们。
- en: '9.3 Closing thoughts: Time series'
  id: totrans-343
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.3 收尾思考：时间序列
- en: There are two aspects of time series data you could target if you want to learn
    more. The first is getting familiar with the time series tools in your chosen
    toolbox. In Python, this might be understanding the various date and time-related
    data types in the `pandas` library or exploring some of the statistical methods
    in `statsmodels`. Understanding how dates and times are represented in your toolbox
    is vital to successfully manipulate this kind of data. For example, at some point,
    you will encounter time data across multiple time zones. This is a complex and
    frustrating aspect of working with time data and one that it is handy to be prepared
    for.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想了解更多关于时间序列数据的信息，你可以针对两个方面的数据。第一个是熟悉你选择的工具箱中的时间序列工具。在Python中，这可能意味着理解`pandas`库中的各种日期和时间相关数据类型，或者探索`statsmodels`中的某些统计方法。了解你的工具箱中日期和时间的表示方式对于成功操作这类数据至关重要。例如，你会在某个时候遇到跨越多个时区的时间数据。这是处理时间数据的一个复杂且令人沮丧的方面，而且提前做好准备是很有用的。
- en: 'The other angle you could take for further learning is to dive deeper into
    forecasting. There are many complex algorithms now to do accurate forecasting,
    but my recommendation is usually to start simple. Methods for time series forecasting
    have been around for decades in domains such as econometrics, long before the
    phrase “data science” even existed. To this end, I usually recommend the book
    *Forecasting: Principles and Practice* by Hyndman and Athanasopoulos (2021), available
    for free at [https://otexts.com/fpp3](https://otexts.com/fpp3). It is an excellent
    resource to walk you through the basics of forecasting, with code samples in R.
    Python translations are also available, such as [https://github.com/zgana/fpp3-python-readalong](https://github.com/zgana/fpp3-python-readalong).'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个你可以采取的深入学习角度是深入研究预测。现在有许多复杂的算法可以进行准确的预测，但我的建议通常是先从简单开始。时间序列预测的方法在计量经济学等领域已经存在了几十年，甚至在“数据科学”这个短语出现之前。为此，我通常推荐Hyndman和Athanasopoulos（2021）所著的《预测：原理与实践》一书，可在[https://otexts.com/fpp3](https://otexts.com/fpp3)免费获取。这是一本优秀的资源，可以引导你了解预测的基础知识，其中包含R语言的代码示例。Python的翻译版本也可用，例如[https://github.com/zgana/fpp3-python-readalong](https://github.com/zgana/fpp3-python-readalong)。
- en: Only after this sort of introductory material do I recommend diving into a more
    complex, deeper tool, such as Facebook’s Prophet library ([https://facebook.github.io/prophet](https://facebook.github.io/prophet)).
    In the end, this is the sort of tool you would turn to in practice when attempting
    to forecast a time series, but knowing the fundamentals makes it easier to tailor
    your methods to your specific problem and understand why your forecasts might
    go wrong from time to time.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 只有在了解了这类入门材料之后，我才推荐深入研究更复杂、更深入的工具，例如Facebook的Prophet库([https://facebook.github.io/prophet](https://facebook.github.io/prophet))。最终，这是在实践中尝试预测时间序列时你会转向的工具，但了解基础知识会使你更容易根据具体问题调整你的方法，并理解为什么你的预测有时会出错。
- en: 9.3.1 Skills for working with time series data for any project
  id: totrans-347
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 9.3.1 适用于任何项目的时间序列数据处理技能
- en: Let’s recap the skills required to explore, manipulate, and analyze time series
    data. These skills, which are applicable to any time series data project, include
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回顾探索、操作和分析时间序列数据所需的能力。这些能力适用于任何时间序列数据项目，包括
- en: Investigating time series data for completeness (e.g., are time series measured
    at different locations, or do all locations have the same amount of data?)
  id: totrans-349
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调查时间序列数据以检查完整性（例如，时间序列是在不同位置测量的，还是所有位置都有相同数量的数据？）
- en: Establishing the granularity of the time series (i.e., is it hourly, daily,
    or weekly? Are there, in fact, multiple time series in the data, e.g., at different
    locations?)
  id: totrans-350
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定时间序列的粒度（即，它是按小时、每日还是每周？数据中实际上是否存在多个时间序列，例如，在不同的位置？）
- en: Understanding the coverage of the data (i.e., what period does the data cover?)
  id: totrans-351
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解数据的覆盖范围（即，数据覆盖了哪个时间段？）
- en: Investigating whether the time series has gaps
  id: totrans-352
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调查时间序列是否存在缺失值
- en: Reshaping time series data to be at a different level of granularity (e.g.,
    summarizing hourly data at a daily level)
  id: totrans-353
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调整时间序列数据以具有不同的粒度级别（例如，将每小时数据汇总到每日级别）
- en: Visualizing time series with appropriate charts (i.e., most often, line charts)
  id: totrans-354
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用适当的图表（即，通常是折线图）可视化时间序列
- en: Calculating the distribution of the repeated measurement (e.g., for “Number
    of bikes seen in an hour,” what are the typical hourly counts?)
  id: totrans-355
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计算重复测量的分布（例如，“每小时看到的自行车数量”，典型的每小时计数是多少？）
- en: Diving down to the individual data point level to investigate anomalies
  id: totrans-356
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 深入到单个数据点级别以调查异常
- en: Decomposing a time series to identify whether it has a trend or seasonality
  id: totrans-357
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将时间序列分解以确定它是否有趋势或季节性
- en: Identifying temporal patterns within time series (e.g., cycling locations with
    a high level of traffic in the morning)
  id: totrans-358
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在时间序列中识别时间模式（例如，早上交通流量高的循环位置）
- en: Finding time series of interest based on multiple criteria
  id: totrans-359
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据多个标准查找感兴趣的时间序列
- en: Forecasting a time series into the future to predict future trends
  id: totrans-360
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将时间序列预测到未来以预测未来趋势
- en: Summary
  id: totrans-361
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Time series analysis can reveal temporal patterns, such as peak times of activity
    or areas of growth.
  id: totrans-362
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间序列分析可以揭示时间模式，例如活动高峰时间或增长区域。
- en: Time series can be decomposed to investigate trends and seasonal behaviors separately.
  id: totrans-363
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间序列可以分解以分别研究趋势和季节性行为。
- en: Forecasting time series relies on having enough past data points with no gaps.
  id: totrans-364
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预测时间序列依赖于有足够的历史数据点且没有缺失值。
- en: You can determine whether a time series can be forecasted successfully by building
    and evaluating a forecasting model.
  id: totrans-365
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以通过构建和评估一个预测模型来确定一个时间序列是否可以被成功预测。
