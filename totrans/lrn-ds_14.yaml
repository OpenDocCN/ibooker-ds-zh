- en: Chapter 11\. Data Visualization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第11章 数据可视化
- en: As data scientists, we create data visualizations in order to understand our
    data and explain our analyses to other people. A plot should have a message, and
    it’s our job to communicate this message as clearly as possible.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 作为数据科学家，我们创建数据可视化是为了理解我们的数据，并向其他人解释我们的分析。图表应该传达一个信息，我们的工作是尽可能清晰地传达这个信息。
- en: In [Chapter 10](ch10.html#ch-eda), we connected the choice of a statistical
    graph to the kind of data being plotted; we also introduced many standard plots
    and showed how to read them. In this chapter, we discuss the principles of effective
    data visualization that make it easier for our audience to grasp the message in
    our plot. We talk about how to choose scales for axes, handle large amounts of
    data with smoothing and aggregation, facilitate meaningful comparisons, incorporate
    study design, and add contextual information. We also show how to create plots
    using `plotly`, a popular package for plotting in Python.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第10章](ch10.html#ch-eda)中，我们将统计图的选择与所绘制数据的类型联系起来；我们还介绍了许多标准图，并展示了如何解读它们。在本章中，我们讨论了有效数据可视化的原则，这些原则使得观众更容易理解我们图中的信息。我们讨论了如何选择轴的刻度，如何通过平滑和聚合处理大量数据，如何进行有意义的比较，如何融入研究设计，并添加上下文信息。我们还展示了如何使用`plotly`这一流行的Python绘图包来创建图表。
- en: One tricky part about writing a chapter on data visualization is that software
    packages for visualization change all the time, so any code we display can quickly
    get out of date. Because of this, some books avoid code entirely. We instead strike
    a balance, where we cover high-level data visualization principles that are broadly
    useful. Then we separately include practical plotting code to implement these
    principles. When new software becomes available, readers can still use our principles
    to guide the creation of their visualizations.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 撰写关于数据可视化的一章的一个棘手之处在于，可视化软件包经常变动，因此我们展示的任何代码可能很快就会过时。由于这个原因，一些书籍完全避免使用代码。我们相反地取得了平衡，覆盖了广泛有用的高级数据可视化原则。然后我们单独包含实际的绘图代码来实现这些原则。当新软件可用时，读者仍然可以使用我们的原则来指导他们的可视化创建。
- en: Choosing Scale to Reveal Structure
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 选择比例以揭示结构
- en: 'In [Chapter 10](ch10.html#ch-eda), we explored prices for houses sold in the
    San Francisco Bay Area between 2003 and 2009\. Let’s revisit that example and
    take a look at a histogram of sale prices:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第10章](ch10.html#ch-eda)中，我们探讨了2003年至2009年间旧金山湾区房屋销售价格。让我们重新看一下这个例子，并看一看销售价格的直方图：
- en: '[PRE0]'
  id: totrans-6
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![](assets/leds_11in01.png)'
  id: totrans-7
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in01.png)'
- en: While this plot accurately displays the data, most of the visible bins are crammed
    into the left side of the plot. This makes it hard to understand the distribution
    of prices.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这个图准确地显示了数据，但大部分可见的箱子都挤在图的左侧。这使得理解价格分布变得困难。
- en: Through data visualization, we want to reveal important features of the data,
    like the shape of a distribution and the relationship between two or more features.
    As this example shows, after we produce an initial plot, there are still other
    aspects we need to consider. In this section, we cover *principles of scale* that
    help us decide how to adjust the axis limits, place tick marks, and apply transformations.
    We begin by examining when and how we might adjust a plot to reduce empty space;
    in other words, we try to fill the data region of our plot with data.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 通过数据可视化，我们希望展示数据的重要特征，如分布的形状和两个或更多特征之间的关系。正如这个例子所示，当我们生成初始图后，仍然有其他方面需要考虑。在本节中，我们涵盖了帮助我们决定如何调整轴限制、放置刻度标记和应用变换的*比例原则*。我们首先检查何时以及如何调整图形以减少空白区域；换句话说，我们试图用数据填充我们图的数据区域。
- en: Filling the Data Region
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 填充数据区域
- en: As we can see from the histogram of sale prices, it’s hard to read a distribution
    when most of the data appear in a small portion of the plotting region. When this
    happens, important features of the data, like multiple modes and skewness, can
    be obscured. A similar issue happens for scatterplots. When all the points are
    bunched together in the corner of a scatterplot, it’s hard to see the shape of
    the distribution and therefore glean any insights the shape would impart.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们从销售价格直方图中看到的那样，当大部分数据出现在绘图区域的一个小部分时，读取分布就变得困难了。当这种情况发生时，数据的重要特征，如多模式和偏斜，可能会被掩盖。散点图也存在类似问题。当所有点都挤在散点图的一个角落时，很难看到分布的形状，因此也很难从形状中获得任何见解。
- en: This issue can crop up when there are a few unusually large observations. In
    order to get a better view of the main portion of the data, we can drop those
    observations from the plot by adjusting the x- or y-axis limits, or we can remove
    the outlier values from the data before plotting. In either case, we mention this
    exclusion in the caption or on the plot itself.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 当存在少数异常大的观测时会出现这个问题。为了更好地观察数据的主要部分，我们可以通过调整 x 或 y 轴的限制删除这些观测值，或者在绘制前从数据中删除异常值。无论哪种情况，我们都会在标题或图表本身中提到这种排除。
- en: 'Let’s use this idea to improve the histogram of sale prices. In the side-by-side
    plots that follow, we clip the data by changing the limits of the x-axis. On the
    left, we’ve excluded houses that cost over $2 million. The shape of the distribution
    for the bulk of the houses is much clearer in this plot. For instance, we can
    more easily observe the skewness and a smaller secondary mode. On the right, we
    separately show detail in the long right tail of the distribution (see it larger
    [online](https://oreil.ly/lVDrE)):'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们利用这个想法来改善销售价格的直方图。在接下来的并列图中，我们通过改变 x 轴的限制来裁剪数据。在左图中，我们排除了价格超过 $2 百万的房屋。这样做使得大部分房屋分布的形状在图中更加清晰。例如，我们可以更容易地观察到偏斜和较小的次要模式。在右图中，我们分别展示了分布长尾右侧的详细信息（在线查看更大的[版本](https://oreil.ly/lVDrE)）：
- en: '![](assets/leds_11in02.png)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in02.png)'
- en: Notice that the x-axis in the left plot includes 0, but the x-axis in the right
    plot begins at $2M. We consider when to include or exclude 0 on an axis next.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 左图的 x 轴包含 0，但右图的 x 轴从 $2M 开始。我们考虑下一步在轴上是否包含或排除 0。
- en: Including Zero
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 包含零
- en: We often don’t need to include 0 on an axis, especially if including it makes
    it difficult to fill the data region. For example, let’s make a scatterplot of
    average longevity plotted against average height for dog breeds. (This dataset
    was first introduced in [Chapter 10](ch10.html#ch-eda); it includes several features
    for 172 breeds.)
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通常不需要在轴上包含 0，特别是如果包含它会使填充数据区域变得困难。例如，让我们制作一个反映狗品种平均寿命与平均身高关系的散点图。（此数据集首次在[第10章](ch10.html#ch-eda)介绍；它包含172种品种的多个特征。）
- en: '![](assets/leds_11in03.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in03.png)'
- en: The x-axis of the plot on the left starts at 10 cm since all dogs are at least
    that tall, and similarly, the y-axis begins at 6 years. The scatterplot on the
    right includes 0 on both axes. This pushes the data up to the top of the data
    region and leaves empty space that doesn’t help us see the linear relationship.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 左图的 x 轴从 10 厘米开始，因为所有狗至少有这么高，类似地，y 轴从 6 年开始。右侧的散点图在两个轴上都包含 0。这将数据推到数据区域的顶部，并留下不利于我们看到线性关系的空白空间。
- en: 'There are some cases where we usually want to include 0\. For bar charts, including
    0 is important so that the heights of the bars directly relate to the data values.
    As an example, we’ve created two bar charts that compare the longevity of dog
    breeds. The left plot includes 0, but the right plot doesn’t:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在柱状图中，通常需要包含 0，这样柱子的高度直接与数据值相关联。例如，我们创建了两个比较狗品种寿命的柱状图。左图包含 0，而右图不包含：
- en: '![](assets/leds_11in04.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in04.png)'
- en: It’s easy to incorrectly conclude from the right plot that small breeds live
    twice as long as large breeds.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 从右图可以轻易地错误地得出小品种的寿命是大品种的两倍的结论。
- en: 'We also typically want to include 0 when working with proportions, since proportions
    range from 0 to 1\. The following plot shows the proportion of breeds in each
    type:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理比例时，我们通常也希望包含 0，因为比例范围从 0 到 1。下图显示了每种类型中品种的比例：
- en: '![](assets/leds_11in05.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in05.png)'
- en: In both the bar and dot plots, including 0 makes it easier for you to accurately
    compare the relative sizes of the categories.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在柱状图和散点图中，包含 0 使您能够更准确地比较各类别的相对大小。
- en: Earlier, when we adjusted axes, we essentially dropped data from our plotting
    region. While this is a useful strategy when a handful of observations are unusually
    large (or small), it is less effective with skewed distributions. In this situation,
    we often need to transform the data to gain a better view of its shape.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 早些时候，当我们调整轴时，实际上是从绘图区域中删除了数据。虽然当少数观测值异常大（或小）时这是一个有用的策略，但在偏斜分布中效果较差。在这种情况下，我们通常需要转换数据以更好地了解其形状。
- en: Revealing Shape Through Transformations
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 通过变换显示形状
- en: Another common way to adjust scale is to transform the data or the plot’s axes.
    We use transformations for skewed data so that it is easier to inspect the distribution.
    And when the transformation produces a symmetric distribution, the symmetry carries
    with it useful properties for modeling (see [Chapter 15](ch15.html#ch-linear)).
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种常见的调整比例的方法是转换数据或图的轴。我们使用变换来处理偏斜的数据，以便更容易检查分布。当变换产生对称分布时，对称性带有有用的建模属性（参见[第15章](ch15.html#ch-linear)）。
- en: 'There are multiple ways to transform data, but the log transformation tends
    to be especially useful. For instance, in the following charts we reproduced two
    histograms of San Francisco house sale prices. The top histogram is the original
    data. For the histogram below, we took the log (base 10) of the prices before
    plotting:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 有多种方法可以转换数据，但对数变换往往特别有用。例如，在下面的图表中，我们重新生成了旧金山房屋销售价格的两个直方图。顶部直方图是原始数据。对于下面的直方图，我们在绘制前对价格取了对数（以10为底）：
- en: '![](assets/leds_11in06.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in06.png)'
- en: The log transformation makes the distribution of prices more symmetric. Now
    we can more easily see important features of the distribution, like the mode at
    around <math><msup><mn>10</mn> <mrow><mn>5.85</mn></mrow></msup></math> , which
    is about 700,000, and the secondary mode near <math><msup><mn>10</mn> <mrow><mn>5.55</mn></mrow></msup></math>
    , or 350,000.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 对数变换使得价格分布更对称。现在我们可以更轻松地看到分布的重要特征，如大约 <math><msup><mn>10</mn> <mrow><mn>5.85</mn></mrow></msup></math>
    处的模式，约为70万美元，以及次要模式接近 <math><msup><mn>10</mn> <mrow><mn>5.55</mn></mrow></msup></math>
    处，即35万美元。
- en: 'The downside of using the log transform is that the actual values aren’t as
    intuitive—in this example, we needed to convert the values back to dollars to
    understand the sale price. Therefore, we often favor transforming the axis to
    a log scale, rather than the data. This way, we can see the original values on
    the axis:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 使用对数变换的缺点是实际值不那么直观——在这个例子中，我们需要将值转换回美元才能理解销售价格。因此，我们通常更喜欢将轴变换为对数刻度，而不是数据本身。这样，我们可以在轴上看到原始的值：
- en: '![](assets/leds_11in07.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in07.png)'
- en: This histogram with its log-scaled x-axis essentially shows the same shape as
    the histogram of the transformed data. But since the axis is displayed in the
    original units, we can directly read off the location of the modes in dollars.
    Note that the bins get narrower to the right because the bin widths are equal
    on the USD scale but plotted on the log USD scale. Also note that <math><mi>μ</mi></math>
    on the y-axis is <math><msup><mn>10</mn> <mrow><mo>−</mo> <mn>6</mn></mrow></msup></math>
    .
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 具有对数刻度 x 轴的直方图基本上显示了与转换数据的直方图相同的形状。但由于在美元刻度上的箱子宽度相等，但在对数美元刻度上绘制，所以右侧的箱子变窄了。还要注意，y
    轴上的 <math><mi>μ</mi></math> 是 <math><msup><mn>10</mn> <mrow><mo>−</mo> <mn>6</mn></mrow></msup></math>
    。
- en: 'The log transform can also reveal shape in scatterplots. Here, we’ve plotted
    building size on the x-axis and lot size on the y-axis. It’s hard to see the shape
    in this plot since many of the points are crammed along the bottom of the data
    region:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 对数变换还可以显示散点图中的形状。在这里，我们将建筑物大小绘制在 x 轴上，地块大小绘制在 y 轴上。在这个图中很难看出形状，因为许多点都挤在数据区域的底部：
- en: '![](assets/leds_11in08.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in08.png)'
- en: 'However, when we use a log scale for both the x- and y-axes, the shape of the
    relationship is much easier to see:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，当我们同时使用对数刻度的 x 轴和 y 轴时，关系的形状更容易看出：
- en: '[PRE1]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![](assets/leds_11in09.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in09.png)'
- en: With the transformed axes, we can see that the lot size increases roughly linearly
    with building size (on the log scale). The log transformation pulls large values—values
    that are orders of magnitude larger than others—in toward the center. This transformation
    can help fill the data region and uncover hidden structure, as we saw for both
    the distribution of house price and the relationship between house size and lot
    size.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 通过变换后的坐标轴，我们可以看到在对数尺度上，地块大小随建筑物大小大致呈线性增加。对数变换将大值——比其他值大几个数量级的值——拉向中心。这种变换有助于填充数据区域并揭示隐藏的结构，就像我们在房价分布和房屋尺寸与地块大小之间的关系中所看到的那样。
- en: In addition to setting the limits of an axis and transforming an axis, we also
    want to consider the aspect ratio of the plot—the length compared to the width.
    Adjusting the aspect ratio is called *banking*, and in the next section, we show
    how banking can help reveal relationships between features.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 除了设置轴的限制和变换轴外，我们还要考虑绘图的纵横比—长度与宽度的比例。调整纵横比称为*银行业务*，在下一节中，我们将展示如何通过银行业务来帮助揭示特征之间的关系。
- en: Banking to Decipher Relationships
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解读关系
- en: 'With scatterplots, we try to choose scales so that the relationship between
    the two features roughly follows a 45-degree line. This scaling is called *banking
    to 45 degrees*. It makes it easier to see shape and trends because our eyes can
    more easily pick up deviations from a line this way. As an example of this, we’ve
    reproduced the plot that shows longevity of dog breeds against height:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 对于散点图，我们尝试选择刻度，使得两个特征之间的关系大致沿着45度线。这种缩放称为*银行业务向45度*。这样做是因为我们的眼睛更容易观察到与直线偏离的情况和趋势。例如，我们重现了显示狗品种寿命与身高关系的图：
- en: '[PRE2]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![](assets/leds_11in10.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in10.png)'
- en: The scatterplot has been banked to 45 degrees, and we can more easily see how
    the data roughly follow a line and where they deviate a bit at the extremes.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 散点图已经银行业务向45度，我们更容易看到数据大致沿直线分布以及它们在极端情况下的偏离。
- en: While banking to 45 degrees helps us see whether or not the data follow a linear
    relationship, when there is clear curvature it can be hard to figure out the form
    of the relationship. When this happens, we try transformations that will get the
    data to fall along a straight line (see, for example, [Figure 11-1](#example-transforms)).
    The log transformation can be useful in uncovering the general form of curvilinear
    relationships.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 当银行业务向45度倾斜有助于我们判断数据是否遵循线性关系时，当存在明显的曲率时，很难弄清楚关系的形式。在这种情况下，我们尝试能够使数据沿直线分布的变换（例如，请参阅[图11-1](#example-transforms)）。对数变换在揭示曲线关系的一般形式时非常有用。
- en: Revealing Relationships Through Straightening
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 透过拉直揭示关系
- en: 'We often use scatter plots to look at the relationship between two features.
    For instance, here we’ve plotted height against weight for the dog breeds:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 我们经常使用散点图来观察两个特征之间的关系。例如，在这里我们绘制了狗品种的身高与体重的关系：
- en: '[PRE3]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![](assets/leds_11in11.png)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in11.png)'
- en: We see that taller dogs weigh more, but this relationship isn’t linear.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到更高的狗体重更重，但这种关系并非线性的。
- en: 'When it looks like two variables have a nonlinear relationship, it’s useful
    to try applying a log scale to the x-axis, y-axis, or both. Let’s look for a linear
    relationship in the scatterplot with transformed axes. Here we re-created the
    plot of weight by height for dog breeds, but this time we applied a log scale
    to the y-axis:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 当看起来两个变量之间存在非线性关系时，尝试应用对数尺度到 x 轴、y 轴或两者都是有用的。让我们在变换轴的散点图中寻找线性关系。这里我们重新绘制了狗品种的体重与身高的图，但这次我们将对
    y 轴应用了对数尺度：
- en: '[PRE4]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](assets/leds_11in12.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in12.png)'
- en: This plot shows a roughly linear relationship, and in this case, we say that
    there’s a log–linear relationship between dog weight and height.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 这个图显示了大致线性的关系，在这种情况下，我们称狗的体重和身高之间存在对数-线性关系。
- en: In general, when we see a linear relationship after transforming one or both
    axes, we can use [Table 11-1](#tab-transform-rels) to reveal what relationship
    the original variables have (in the table, a and b are constants). We make these
    transformations because it is easier for us to see if points fall along a line
    than to see if they follow a power law compared to an exponential.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，当我们看到变换一个或两个轴后呈现线性关系时，我们可以使用[表11-1](#tab-transform-rels)来揭示原始变量的关系（在表中，a
    和 b 是常数）。我们进行这些变换是因为这样更容易看出点是否沿着一条线分布，而不是看它们是否遵循幂律或指数律。
- en: Table 11-1\. Relationships between two variables when transformations are applied
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 表11-1。应用变换时两个变量之间的关系
- en: '| x-axis | y-axis | Relationship | Also known as |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| x 轴 | y 轴 | 关系 | 也称为'
- en: '| --- | --- | --- | --- |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| No transform | No transform | Linear: <math><mi>y</mi> <mo>=</mo> <mi>a</mi>
    <mi>x</mi> <mo>+</mo> <mi>b</mi></math> | Linear |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| 无转换 | 无转换 | 线性：<math><mi>y</mi> <mo>=</mo> <mi>a</mi> <mi>x</mi> <mo>+</mo>
    <mi>b</mi></math> | 线性 |'
- en: '| Log–scale | No transform | Log: <math><mi>y</mi> <mo>=</mo> <mi>a</mi> <mi>log</mi>
    <mo>⁡</mo> <mi>x</mi> <mo>+</mo> <mi>b</mi></math> | Linear–log |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| 对数尺度 | 无转换 | 对数：<math><mi>y</mi> <mo>=</mo> <mi>a</mi> <mi>log</mi> <mo>⁡</mo>
    <mi>x</mi> <mo>+</mo> <mi>b</mi></math> | 线性-对数 |'
- en: '| No transform | Log–scale | Exponential: <math><mi>y</mi> <mo>=</mo> <mi>b</mi>
    <msup><mi>a</mi> <mi>x</mi></msup></math> | Log–linear |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| 无变换 | 对数比例 | 指数： <math><mi>y</mi> <mo>=</mo> <mi>b</mi> <msup><mi>a</mi>
    <mi>x</mi></msup></math> | 对数-线性 |'
- en: '| Log–scale | Log–scale | Power: <math><mi>y</mi> <mo>=</mo> <mi>b</mi> <msup><mi>x</mi>
    <mi>a</mi></msup></math> | Log–log |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| 对数比例 | 对数比例 | 功率： <math><mi>y</mi> <mo>=</mo> <mi>b</mi> <msup><mi>x</mi>
    <mi>a</mi></msup></math> | 对数-对数 |'
- en: As [Table 11-1](#tab-transform-rels) shows, the log transform can reveal several
    common types of relationships. Because of this, the log transform is considered
    the jackknife of transformations. As another, albeit artificial, example, the
    leftmost plot in [Figure 11-1](#example-transforms) reveals a curvilinear relationship
    between *x* and *y*. The middle plot shows a different curvilinear relationship
    between *log(y)* and *x*; this plot also appears nonlinear. A further log transformation,
    at the far right, displays a plot of *log(y)* against *log(x)*. This plot confirms
    that the data have a log–log (or power) relationship because the transformed points
    fall along a line.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 如[表 11-1](#tab-transform-rels)所示，对数变换可以揭示几种常见类型的关系。正因如此，对数变换被认为是变换的利器。作为另一个虽然是人为的例子，[图 11-1](#example-transforms)中最左边的图显示了*x*和*y*之间的曲线关系。中间的图显示了*log(y)*和*x*之间不同的曲线关系；该图看起来也是非线性的。进一步的对数变换，最右边显示了*log(y)*对*log(x)*的图。这个图证实了数据具有对数-对数（或者功率）关系，因为变换后的点沿着一条直线分布。
- en: '![](assets/leds_1101.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_1101.png)'
- en: Figure 11-1\. Scatterplots showing how log transforms can “straighten” a curvilinear
    relationship between two variables
  id: totrans-67
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 11-1\. 散点图展示了对数变换如何“拉直”两个变量之间的曲线关系
- en: Adjusting scale is an important practice in data visualization. While the log
    transform is versatile, it doesn’t handle all situations where skew or curvature
    occurs. For example, at times the values are all roughly the same order of magnitude
    and the log transformation has little impact. Another transformation to consider
    is the square root transformation, which is often useful for count data.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 调整比例是数据可视化中的重要实践。虽然对数变换很灵活，但并不适用于所有呈现偏斜或曲率的情况。例如，有时值都大致相同数量级，对数变换影响有限。另一个需要考虑的变换是平方根变换，通常适用于计数数据。
- en: In the next section, we look at principles of smoothing, which we use when we
    need to visualize lots of data.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将探讨平滑的原则，这是在需要可视化大量数据时使用的方法。
- en: Smoothing and Aggregating Data
  id: totrans-70
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 平滑和聚合数据
- en: 'When we have lots of data, we often don’t want to plot all of the individual
    data points. The following scatter plot shows data from [Cherry Blossom](https://www.cherryblossom.org),
    an annual 10-mile race that takes place in Washington, DC, in April, when the
    cherry trees are in bloom. These data were scraped from the race’s website and
    include official times and other information for all registered male runners from
    1999 to 2012\. We’ve plotted the runners’ ages on the x-axis and race times on
    the y-axis:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们有大量数据时，通常不想绘制所有单个数据点。以下散点图展示了来自[樱花](https://www.cherryblossom.org)的数据，这是每年四月份在华盛顿特区举办的一场10英里长的比赛，当时樱花盛开。这些数据来自比赛网站，包括1999年至2012年所有注册男性跑步者的官方时间和其他信息。我们将跑步者的年龄绘制在x轴上，比赛时间绘制在y轴上：
- en: '![](assets/leds_11in13.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in13.png)'
- en: This scatterplot contains over 70,000 points. With so many points, many of them
    overlap. This is a common problem called *overplotting*. In this case, overplotting
    prevents us from seeing how time and age are related. About the only thing that
    we can see in this plot is a group of very young runners, which points to possible
    issues with data quality. To address overplotting, we use smoothing techniques
    that aggregate data before plotting.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 这个散点图包含超过70,000个数据点。由于数据点过多，很多点会重叠在一起。这是一个常见的问题，称为*过度绘制*。在这种情况下，过度绘制使我们无法看到时间和年龄之间的关系。在这个图中，我们唯一能看到的是一群非常年轻的跑步者，这可能指向数据质量存在问题。为了解决过度绘制的问题，我们使用平滑技术在绘图前聚合数据。
- en: Smoothing Techniques to Uncover Shape
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 平滑技术揭示形状
- en: 'The histogram is a familiar type of plot that uses smoothing. A histogram aggregates
    data values by putting points into bins and plotting one bar for each bin. Smoothing
    here means that we cannot differentiate the location of individual points in a
    bin: the points are smoothly allocated across their bins. With histograms, the
    area of a bin corresponds to the percentage (or count or proportion) of points
    in the bin. (Often the bins are equal in width, and we take a shortcut to label
    the height of a bin as the proportion.)'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图是一种熟悉的平滑绘图类型。直方图通过将点放入bin中并绘制每个bin的条形来汇总数据值。这里的平滑意味着我们不能区分bin中各个点的位置：点被平滑地分配到它们的bin中。对于直方图，bin的面积对应于bin中点的百分比（或计数或比例）。（通常bin宽度相等，我们采取一种简便的方式将bin的高度标记为比例。）
- en: 'The following histogram plots the distribution of lifespans for dog breeds:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的直方图显示了狗品种寿命的分布：
- en: '![](assets/leds_11in14.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in14.png)'
- en: Above this histogram is a rug plot that draws a single line for every data value.
    We can see in the tallest bin that even a small amount of data can cause overplotting
    in the rug plot. By smoothing out the points in the rug plot, the histogram reveals
    the general shape of the distribution. In this case, we see that many breeds have
    a longevity of about 12 years. For more on how to read and interpret histograms,
    see [Chapter 10](ch10.html#ch-eda).
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个直方图上方是一个折线图，为每个数据值绘制一条线。我们可以看到在最高的bin中，即使少量数据也会导致折线图的重叠。通过平滑处理折线图的点，直方图显示了分布的一般形状。在这种情况下，我们看到许多品种的寿命约为12年。有关如何阅读和解释直方图的更多信息，请参见[第10章](ch10.html#ch-eda)。
- en: 'Another common smoothing technique is *kernel density estimation* (KDE). A
    KDE plot shows the distribution using a smooth curve rather than bars. In the
    following plot, we show the same histogram of dog longevity with a KDE curve overlaid.
    The KDE curve has a similar shape as the histogram:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种常见的平滑技术是*核密度估计*（KDE）。KDE图使用平滑曲线而不是柱状图显示分布。在下面的图中，我们展示了同一狗寿命直方图，并覆盖了一个KDE曲线。KDE曲线与直方图具有类似的形状：
- en: '![](assets/leds_11in15.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in15.png)'
- en: It might come as a surprise to think of a histogram as a smoothing method. Both
    the KDE and histogram aim to help us see important features in the distribution
    of values. Similar smoothing techniques can be used with scatterplots. This is
    the topic of the next section.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 把直方图看作平滑方法可能会让人惊讶。KDE和直方图都旨在帮助我们看到值分布中的重要特征。类似的平滑技术也可以用于散点图。这是下一节的主题。
- en: Smoothing Techniques to Uncover Relationships and Trends
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 揭示关系和趋势的平滑技术
- en: 'We can find high-density regions of a scatterplot by binning data, like in
    a histogram. The following plot remakes the earlier scatterplot of the Cherry
    Blossom race times against age. This plot uses hexagonal bins to aggregate points
    together, and then shades the hexagons based on how many points fall in them:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过分bin数据来找到散点图的高密度区域，就像直方图一样。下面的图重新绘制了樱花大赛时间与年龄的散点图。这张图使用了六边形bin将点聚合在一起，并根据落入其中的点数对六边形进行了阴影处理：
- en: '[PRE5]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![](assets/leds_11in16.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in16.png)'
- en: Notice the high-density region in the 25-to-40 age group, signified by the dark
    region in the plot. The plot shows us that many of the runners in this age range
    complete the race in around 5,000 seconds (about 80 minutes). (Note that we drop
    the dubious young runners from this plot.) We can also see upward curvature in
    the region corresponding to the 40-to-60 age group, which indicates that these
    runners are generally slower than those in the 25-to-40 age group. This plot is
    similar to a heat map, where the higher-density regions are conveyed through hotter
    or brighter colors.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 注意在25到40岁组中的高密度区域，通过图中的深色区域表示。图表告诉我们，许多这个年龄段的跑者大约在5,000秒（约80分钟）内完成比赛。（请注意，我们从这个图中删除了年轻跑者的数据。）我们还可以看到40到60岁组对应区域的向上曲率，这表明这些跑者通常比25到40岁组的跑者慢。这张图类似于热图，其中高密度区域通过更热或更亮的颜色传达。
- en: 'Kernel density estimation also works in two dimensions. When we use KDE in
    two dimensions, we typically plot the contours of the resulting three-dimensional
    shape, and we read the plot like a topographical map:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 核密度估计在二维中也适用。当我们在二维中使用KDE时，通常绘制结果三维形状的轮廓线图，并像读取地形图一样解读图形：
- en: '[PRE6]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](assets/leds_11in17.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in17.png)'
- en: This two-dimensional KDE gives similar insights as the shaded squares of the
    previous plot. We see a high concentration of runners in the 25-to-40 age group,
    and these runners have times that appear to be roughly 5,000 seconds. Smoothing
    lets us get a better picture when there’s lots of data because it can reveal the
    locations of highly concentrated data values and the shape of these high-concentration
    regions. These regions may be impossible to see otherwise.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 这个二维KDE提供了与前一图中阴影区域相似的见解。我们看到25到40岁年龄组的跑步者高度集中，这些跑步者的时间大约为5,000秒左右。平滑使我们在数据量大时能够更清楚地看到整体情况，因为它可以显示高度集中数据值的位置和这些高集中区域的形状。否则这些区域可能无法看到。
- en: 'Another smoothing approach that is often more informative smooths the y-values
    for points with a similar x-value. To explain, let’s group together runners with
    similar ages, using five-year increments: 20–25, 25–30, 30–35, and so on. Then,
    for each five-year bin of runners, we average their race times, plot the average
    time for each group, and connect the points to form a “curve”:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种经常更具信息性的平滑方法是对具有相似x值的点的y值进行平滑处理。简单来说，我们将具有相似年龄的跑步者分组，使用五年递增：20–25、25–30、30–35等。然后，对于每个五年的跑步者组，我们计算其平均比赛时间，绘制每组的平均时间，并连接点以形成一个“曲线”：
- en: '[PRE7]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](assets/leds_11in18.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in18.png)'
- en: This plot shows once again that runners in the 25-to-40 age range have typical
    run times of about 5,400 seconds. It also shows that older runners took longer
    to complete the race on average (not really a surprise, but it wasn’t nearly as
    evident in the earlier plots). The dip in times for runners under age 20 and the
    flattening of the curve at age 80 may simply be the result of fewer and fitter
    runners in these groups. Another smoothing technique uses kernel smoothing similar
    to the KDE. We don’t go into the details here.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 这幅图再次显示，年龄在25到40岁之间的跑步者典型的跑步时间约为5,400秒。它还显示，老年跑步者平均完成比赛时间较长（这并不令人意外，但在早期的图表中没有那么明显）。年龄在20岁以下的跑步者时间的下降和80岁时曲线的平坦可能仅仅是这些组别中跑步者较少且更健壮的结果。另一种平滑技术使用与KDE类似的核平滑。我们这里不详细介绍。
- en: The binning and kernel smoothing techniques rely on a tuning parameter that
    specifies the width of the bin or the spread of the kernel, and we often need
    to specify this parameter when making a histogram, KDE, or smooth curve. This
    is the topic of the next section.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 分箱和核平滑技术依赖于一个调整参数，该参数指定箱的宽度或核的扩展，并且在制作直方图、KDE或平滑曲线时通常需要指定此参数。这是下一节的主题。
- en: Smoothing Techniques Need Tuning
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 平滑技术需要调整
- en: 'Now that we’ve seen how smoothing is useful for plotting, we turn to the issue
    of tuning. For histograms, the width of the bins or, for equal-width bins, the
    number of bins affects the look of the histogram. The left histogram of longevity
    shown here has a few wide bins, and the right histogram has many narrow bins (see
    it larger [online](https://oreil.ly/SmLYq)):'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经看到平滑在绘图中的用处，我们转向调整的问题。对于直方图，箱宽度或者对于等宽箱，箱的数量会影响直方图的外观。这里显示的长寿左直方图有几个宽箱子，而右侧直方图有许多窄箱子（在线上查看更大图像[online](https://oreil.ly/SmLYq)）：
- en: '![](assets/leds_11in19.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in19.png)'
- en: In both histograms, it’s hard to see the shape of the distribution. With a few
    wide bins (the plot on the left), we have oversmoothed the distribution, which
    makes it impossible to discern modes and tails. On the other hand, too many bins
    (the plot on the right) gives a plot that’s little better than a rug plot. KDE
    plots have a parameter called the *bandwidth* that works similarly to the bin
    width of a histogram.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在两个直方图中，很难看出分布的形状。在几个宽箱子（左图）中，我们对分布进行了过度平滑处理，这使得无法分辨模式和尾部。另一方面，太多的箱子（右图）给出的图像与地毯图相差无几。KDE图中有一个称为*带宽*的参数，其作用类似于直方图的箱宽度。
- en: Most histogram and KDE software automatically chooses the bin width for the
    histogram and the bandwidth for the kernel. However, these parameters often need
    a bit of fiddling to create the most useful plot. When you create visualizations
    that rely on tuning parameters, it’s important to try a few different values before
    settling on one.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数直方图和KDE软件会自动选择直方图的箱宽度和核的带宽。然而，这些参数通常需要一点调整才能创建最有用的图形。当您创建依赖调整参数的可视化时，重要的是在最终确定一个参数值之前尝试几种不同的值。
- en: A different approach to data reduction is to examine quantiles. This is the
    topic of the next section.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 数据减少的另一种不同方法是检查分位数。这是下一节的主题。
- en: Reducing Distributions to Quantiles
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 减少分布到分位数
- en: We found in [Chapter 10](ch10.html#ch-eda) that while box plots aren’t as informative
    as histograms, they can be useful when comparing the distributions of many groups
    at once. A box plot reduces the data to a few essential features based on the
    data quartiles. More generally, quantiles (the lower quartile, median, and upper
    quartile are the 25th, 50th, and 75th quantiles) can provide a useful reduction
    in the data when comparing distributions.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在第10章中我们发现，虽然箱线图不如直方图信息丰富，但在一次比较多个组的分布时它们是有用的。箱线图基于数据的四分位数将数据减少到几个基本特征。更一般地，分位数（下四分位数、中位数和上四分位数分别是第25、50和75个分位数）在比较分布时可以提供有用的数据缩减。
- en: 'When two distributions are roughly similar in shape, it can be hard to compare
    them with histograms. For instance, the histograms that follow show the price
    distributions for two- and four-bedroom houses in the San Francisco housing data.
    The distributions look roughly similar in shape. But a plot of their quantiles
    handily compares the distributions’ center, spread, and tails (see it larger [online](https://oreil.ly/zVagW)):'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 当两个分布在形状上大致相似时，用直方图可能很难比较它们。例如，以下直方图展示了旧金山房屋数据中两卧室和四卧室房屋价格的分布。这些分布在形状上看起来大致相似。但是它们的分位数图可以方便地比较分布的中心、传播和尾部（在线上更大地查看[在线](https://oreil.ly/zVagW)）：
- en: '[PRE8]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](assets/leds_11in20.png)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in20.png)'
- en: 'We can compare quantiles with a *quantile–quantile* plot, called *q–q plot*
    for short. To make this plot, we first compute percentiles (also called quantiles)
    for both the two- and four-bedroom distributions of price:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以用*分位数-分位数*图来比较，简称为*q-q图*。为了制作这种图，我们首先计算价格的两卧室和四卧室分布的百分位数（也称为分位数）：
- en: '[PRE9]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '|   | percentile | br2 | br4 |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '|   | 百分位数 | br2 | br4 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '--- | --- | --- | --- |'
- en: '| **0** | 1 | 1.50e+05 | 2.05e+05 |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| **0** | 1 | 1.50e+05 | 2.05e+05 |'
- en: '| **1** | 2 | 1.82e+05 | 2.50e+05 |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| **1** | 2 | 1.82e+05 | 2.50e+05 |'
- en: '| **2** | 3 | 2.03e+05 | 2.75e+05 |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| **2** | 3 | 2.03e+05 | 2.75e+05 |'
- en: '| **...** | ... | ... | ... |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '| **...** | ... | ... | ... |'
- en: '| **96** | 97 | 1.04e+06 | 1.75e+06 |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '| **96** | 97 | 1.04e+06 | 1.75e+06 |'
- en: '| **97** | 98 | 1.20e+06 | 1.95e+06 |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '| **97** | 98 | 1.20e+06 | 1.95e+06 |'
- en: '| **98** | 99 | 1.44e+06 | 2.34e+06 |'
  id: totrans-117
  prefs: []
  type: TYPE_TB
  zh: '| **98** | 99 | 1.44e+06 | 2.34e+06 |'
- en: '[PRE10]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Then we plot the matching percentiles on a scatterplot. We usually also show
    the reference line y = x to help with the comparison:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 然后在散点图上绘制匹配的百分位数。通常我们也会显示参考线y = x来帮助比较：
- en: '[PRE11]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](assets/leds_11in21.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in21.png)'
- en: When the quantile points fall along a line, the variables have similarly shaped
    distributions. Lines parallel to the reference indicate a difference in center,
    lines with slopes other than 1 indicate a difference in spread, and curvature
    indicates a difference in shape. From the preceding q–q plot, we see that the
    distribution of price for four-bedroom houses is similar in shape to the two-bedroom
    distribution, except for a shift of about $100K and a slightly longer right tail
    (indicated by the upward bend for large values). Reading a q–q plot takes practice.
    Once you get the hang of it, though, it can be a handy way to compare distributions.
    Notice that the housing data have over 100,000 observations, and the q–q plot
    has reduced the data to 99 percentiles. This data reduction is quite useful. However,
    we don’t always want to use smoothers. This is the topic of the next section.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 当分位点沿直线分布时，变量具有类似形状的分布。与参考线平行的线表示中心的差异，斜率不为1的线表示传播的差异，而曲线表示形状的差异。从前述的分位数图中，我们看到四卧室房屋价格的分布在形状上与两卧室的分布类似，除了大约10万美元的偏移和稍长的右尾（对大值的上升弯曲指示）。阅读分位数图需要练习。一旦你掌握了技巧，它可以是比较分布的一种便捷方式。注意，房屋数据有超过10万个观察值，而分位数图将数据减少到99个百分位数。这种数据缩减非常有用。然而，我们并不总是想使用平滑处理器。这是下一节的主题。
- en: When Not to Smooth
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 当不进行平滑处理时
- en: Smoothing and aggregating can help us see important features and relationships,
    but when we have only a handful of observations, smoothing techniques can be misleading.
    With just a few observations, we prefer rug plots over histograms, box plots,
    and density curves, and we use scatterplots rather than smooth curves and density
    contours. This may seem obvious, but when we have a large amount of data, the
    amount of data in a subgroup can quickly dwindle. This phenomenon is an example
    of the *curse of dimensionality*.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 平滑和聚合可以帮助我们看到重要的特征和关系，但是当我们只有少数观测时，平滑技术可能会误导我们。只有少数观测时，我们更喜欢地毯图而不是直方图、箱线图和密度曲线，而是使用散点图而不是平滑曲线和密度轮廓。这似乎是显而易见的，但是当我们有大量数据时，子组中的数据量可能会迅速减少。这种现象是
    *维度诅咒* 的一个例子。
- en: 'One of the most common misuses of smoothing happens with box plots. As an example,
    here is a collection of seven box plots of longevity, one for each of seven types
    of dog breed:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 平滑最常见的误用之一发生在箱线图中。例如，这是寿命的七个箱线图的集合，每个箱线图代表一种狗品种：
- en: '[PRE12]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![](assets/leds_11in22.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in22.png)'
- en: 'Some of these box plots have as few as two or three observations. The strip
    plot that follows is a preferable visualization:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 其中一些箱线图只有两到三个观测值。接下来的条形图是一种更可取的可视化方法：
- en: '[PRE13]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![](assets/leds_11in23.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in23.png)'
- en: In this plot, we can still compare the groups, but we also see the exact values
    in each group. Now we can tell that there are only three breeds in the non-sporting
    group; the impression of a skewed distribution, based on the box plot, reads too
    much into the shape of the box.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个图中，我们仍然可以比较各组，但我们也可以看到每组中的确切值。现在我们可以看出非运动组中只有三个品种；基于箱线图的偏斜分布的印象过于看重箱线的形状。
- en: This section introduced the problem of overplotting, where we have overlapping
    points because of a large dataset. To address this issue, we introduced smoothing
    techniques that aggregate data. We saw two common examples of smoothing—binning
    and kernel smoothing—and applied them in the one- and two-dimensional settings.
    In one dimension, these are histograms and kernel density curves, respectively,
    and they both help us see the shape of a distribution. In two dimensions, we found
    it useful to smooth y-values while keeping x-values fixed in order to visualize
    trends. We addressed the need to tune the smoothing amount to get more informative
    histograms and density curves, and we cautioned against smoothing with too few
    data.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 本节介绍了由于大型数据集而产生重叠点的过绘制问题。为了解决这个问题，我们介绍了聚合数据的平滑技术。我们看到了平滑的两个常见示例—分箱和核平滑—并将它们应用于一维和二维设置中。在一维中，这些是直方图和核密度曲线，它们都帮助我们看到分布的形状。在二维中，我们发现在保持
    x 值不变的同时平滑 y 值是有用的，以可视化趋势。我们解决了需要调整平滑量以获得更多信息的直方图和密度曲线，并警告不要用太少的数据进行平滑处理。
- en: There are many other ways to reduce overplotting in scatter plots. For instance,
    we can make the dots partially transparent so that overlapping points appear darker.
    If many observations have the same values (like when longevity is rounded to the
    nearest year), then we can add a small amount of random noise to the values to
    reduce the amount of overplotting. This procedure is called *jittering*, and it
    is used in the strip plot of longevity. Transparency and jittering are convenient
    for medium-sized data. However, they don’t work well for large datasets since
    plotting all the points still overwhelms the visualization.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多其他减少散点图中的重叠的方法。例如，我们可以使点部分透明，以便重叠点显示更暗。如果许多观测值具有相同的值（例如当寿命四舍五入到最接近的年份时），那么我们可以向值添加少量随机噪声，以减少重叠的数量。这个过程称为
    *jittering*，它用于寿命的条形图。透明度和 jittering 对于中等大小的数据很方便。但是，它们对于大型数据集效果不佳，因为绘制所有点仍然会压倒可视化。
- en: The quantile–quantile plot we introduced offers one way to compare distributions
    with far fewer points; another is to use side-by-side box plots and yet another
    is to overlay KDE curves in the same plot. We often aim to compare distributions
    and relationships across subsets (or groups) of data, and we next discuss several
    design principles that facilitate meaningful comparisons for a variety of plot
    types.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 我们介绍的分位数图为比较具有远少于点数的分布提供了一种方法；另一种方法是使用并排箱线图，还有一种方法是在同一图中叠加 KDE 曲线。我们经常旨在比较数据子集（或组）之间的分布和关系，接下来我们将讨论几种促进各种图类型的有意义比较的设计原则。
- en: Facilitating Meaningful Comparisons
  id: totrans-135
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 促进有意义的比较
- en: The same data can be visualized in many different ways, and deciding which plot
    to make can be daunting. Generally speaking, our plot should help a reader make
    meaningful comparisons. In this section, we go over several useful principles
    that can improve the clarity of our plots.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 同样的数据可以用许多不同的方式进行可视化，决定制作哪种图表可能令人生畏。一般来说，我们的图表应该帮助读者进行有意义的比较。在本节中，我们讨论了几个有用的原则，可以提高图表的清晰度。
- en: Emphasize the Important Difference
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 强调重要的差异
- en: Whenever we make a plot that compares groups, we consider whether the plot emphasizes
    the important difference. As a rule of thumb, it’s easier for readers to see differences
    when plotted objects are aligned in ways that make these comparisons easier to
    read. Let’s look at an example.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 每当我们制作一个比较不同群体的图表时，我们都会考虑图表是否突出了重要的差异。一般来说，当图表中的对象以使比较更容易阅读的方式对齐时，读者更容易看到差异。让我们看一个例子。
- en: The [US Bureau of Labor Statistics](https://oreil.ly/b0YMJ) publishes data on
    income. We took the 2020 median full-time-equivalent weekly earnings for people
    over age 25 and plotted them. We split people into groups by education level and
    sex:^([1](ch11.html#id1365))
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '[美国劳工统计局](https://oreil.ly/b0YMJ)发布了有关收入的数据。我们以2020年全职等效周收入的中位数为基础，对超过25岁的人群按教育水平和性别进行了分组：^([1](ch11.html#id1365))'
- en: '[PRE14]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![](assets/leds_11in24.png)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in24.png)'
- en: 'These bar plots show that earnings increase with more education. But arguably,
    a more interesting comparison is between men and women of the same education level.
    We can group the bars differently to focus instead on this comparison:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 这些条形图显示，随着教育程度的提高，收入也增加。但可以说，一个更有趣的比较是相同教育水平下男女之间的比较。我们可以以不同的方式分组条形图，以便集中在这种比较上：
- en: '[PRE15]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](assets/leds_11in25.png)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in25.png)'
- en: 'This plot is much better; we can more easily compare the earnings of men and
    women for each level of education. However, we can make this difference even clearer
    using vertical alignment. Instead of bars, we use dots for groups of men and women
    that align vertically at each education level:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 这个图更好；我们可以更容易地比较每个教育水平男性和女性的收入。然而，我们可以通过垂直对齐进一步明确这种差异。我们不再使用条形，而是在每个教育水平上使用点来代表男性和女性群体：
- en: '[PRE16]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![](assets/leds_11in26.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in26.png)'
- en: 'This plot more clearly reveals an important difference: the earnings gap between
    men and women grows with education. We considered three plots that visualize the
    same data, but they differ in how readily we can see the message in the plot.
    We prefer the last one because it aligns the income differences vertically, making
    them easier to compare.'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 这个图更清晰地显示了一个重要的差异：男性和女性的收入差距随着教育程度的提高而扩大。我们考虑了三个可视化同一数据的图表，但它们在传达信息的方式上有所不同。我们更喜欢最后一个，因为它将收入差异垂直对齐，更易于比较。
- en: Notice that in making all three plots, we ordered the education categories from
    the least to greatest number of years of education. This ordering makes sense
    because education level is ordinal. When we compare nominal categories, we use
    other approaches to ordering.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，在制作所有三个图表时，我们按照教育水平从少到多的顺序对教育类别进行了排序。这种排序是有意义的，因为教育水平是有序的。当我们比较名义类别时，我们使用其他排序方法。
- en: Ordering Groups
  id: totrans-150
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分组顺序
- en: With ordinal features, we keep the categories in their natural order when we
    make plots, but the same principle does not apply for nominal features. Instead,
    we choose an ordering that helps us make comparisons. With bar plots, it’s a good
    practice to order the bars according to their height, while for box plots and
    strip plots, we typically order the boxes/strips according to medians.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 对于有序特征，当我们制作图表时，我们保持类别的自然顺序，但对于名义特征，这个原则不适用。相反，我们选择一种有助于比较的顺序。在条形图中，按照高度排序条形是一个好的做法，而对于箱线图和条带图，通常按照中位数的顺序排列箱子/条带。
- en: 'The two bar plots that follow each compare the mean lifespan for types of dog
    breeds:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 后面的两个条形图各自比较了不同狗品种的平均寿命：
- en: '![](assets/leds_11in27.png)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in27.png)'
- en: The plot on the left orders the bars alphabetically. We prefer the plot on the
    right because it orders the bars by longevity, which makes it easier to compare
    longevity across the categories. We don’t have to bounce back and forth or squint
    to guess whether herding breeds have a shorter lifespan than toy breeds.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 左边的图按字母顺序排列了条形，我们更喜欢右边的图，因为它按寿命的顺序排列了条形，这样更容易比较各个类别的寿命。我们不需要来回跳跃或眯起眼睛去猜测牧群犬是否比玩具犬寿命更短。
- en: 'As another example, the following two sets of box plots each compare the distribution
    of sale price for houses in different cities in the San Francisco East Bay area:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 作为另一个例子，以下两组箱线图比较了旧金山东湾地区不同城市的房屋销售价格分布：
- en: '![](assets/leds_11in28.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in28.png)'
- en: We prefer the plot on the right since it has boxes ordered according to the
    median price for each city. Again, this ordering makes it easier to compare distributions
    across groups, in this case cities. We see that the lower quartile and median
    price in Albany and Walnut Creek are roughly the same, but the prices in Walnut
    Creek have a greater right skew.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 我们更喜欢右侧的图表，因为它按每个城市的中位数价格排序了箱子。同样，这种排序使得更容易比较组（在这种情况下是城市）之间的分布。我们看到Albany和Walnut
    Creek的下四分位数和中位数价格大致相同，但是Walnut Creek的价格有更大的右偏。
- en: When possible, ordering bars in a bar plot by height and boxes in a box plot
    by median makes it easier for us to make comparisons across groups. Another technique
    used for presenting grouped data is stacking. We describe stacking in the next
    section and provide examples to convince you to steer away from this sort of plot.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在可能的情况下，按高度排序条形图中的条和箱线图中的箱子，使得我们更容易比较不同组之间的数据。用于呈现分组数据的另一种技术是堆叠。我们将在下一节介绍堆叠，并提供示例以说服您远离这种类型的图表。
- en: Avoid Stacking
  id: totrans-159
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 避免堆积
- en: 'The figure that follows shows a stacked bar plot in which there is one bar
    for each city and these bars are divided according to the proportion of houses
    sold that have from one to eight or more bedrooms. This is called a *stacked bar
    plot*. The bar plot is based on a cross-tabulation:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来的图示是一个堆积条形图，其中每个城市都有一根条形，并按照销售房屋中卧室数从一到八个或更多的比例进行划分。这称为*堆积条形图*。条形图基于一个交叉制表：
- en: '[PRE17]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '| br | 1.0 | 2.0 | 3.0 | 4.0 | 5.0 | 6.0 | 7.0 | 8.0 |'
  id: totrans-162
  prefs: []
  type: TYPE_TB
  zh: '| br | 1.0 | 2.0 | 3.0 | 4.0 | 5.0 | 6.0 | 7.0 | 8.0 |'
- en: '| --- | --- | --- | --- | --- | --- | --- | --- | --- |'
  id: totrans-163
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- | --- | --- | --- |'
- en: '| city |   |   |   |   |   |   |   |   |'
  id: totrans-164
  prefs: []
  type: TYPE_TB
  zh: '| city |   |   |   |   |   |   |   |   |'
- en: '| --- | --- | --- | --- | --- | --- | --- | --- | --- |'
  id: totrans-165
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- | --- | --- | --- |'
- en: '| **Albany** | 1.21e-01 | 0.56 | 0.25 | 0.05 | 9.12e-03 | 1.01e-03 | 2.03e-03
    | 4.05e-03 |'
  id: totrans-166
  prefs: []
  type: TYPE_TB
  zh: '| **Albany** | 1.21e-01 | 0.56 | 0.25 | 0.05 | 9.12e-03 | 1.01e-03 | 2.03e-03
    | 4.05e-03 |'
- en: '| **Berkeley** | 6.91e-02 | 0.38 | 0.31 | 0.16 | 4.44e-02 | 1.42e-02 | 6.48e-03
    | 7.23e-03 |'
  id: totrans-167
  prefs: []
  type: TYPE_TB
  zh: '| **Berkeley** | 6.91e-02 | 0.38 | 0.31 | 0.16 | 4.44e-02 | 1.42e-02 | 6.48e-03
    | 7.23e-03 |'
- en: '| **El Cerrito** | 1.81e-02 | 0.34 | 0.47 | 0.14 | 2.20e-02 | 6.48e-03 | 0.00e+00
    | 6.48e-04 |'
  id: totrans-168
  prefs: []
  type: TYPE_TB
  zh: '| **El Cerrito** | 1.81e-02 | 0.34 | 0.47 | 0.14 | 2.20e-02 | 6.48e-03 | 0.00e+00
    | 6.48e-04 |'
- en: '| **Piedmont** | 8.63e-03 | 0.22 | 0.40 | 0.26 | 9.50e-02 | 1.29e-02 | 7.19e-03
    | 1.44e-03 |'
  id: totrans-169
  prefs: []
  type: TYPE_TB
  zh: '| **Piedmont** | 8.63e-03 | 0.22 | 0.40 | 0.26 | 9.50e-02 | 1.29e-02 | 7.19e-03
    | 1.44e-03 |'
- en: '| **Richmond** | 3.60e-02 | 0.36 | 0.42 | 0.15 | 2.52e-02 | 7.21e-03 | 7.72e-04
    | 7.72e-04 |'
  id: totrans-170
  prefs: []
  type: TYPE_TB
  zh: '| **Richmond** | 3.60e-02 | 0.36 | 0.42 | 0.15 | 2.52e-02 | 7.21e-03 | 7.72e-04
    | 7.72e-04 |'
- en: '| **Walnut Creek** | 1.16e-01 | 0.35 | 0.30 | 0.18 | 4.37e-02 | 5.08e-03 |
    4.12e-04 | 2.75e-04 |'
  id: totrans-171
  prefs: []
  type: TYPE_TB
  zh: '| **Walnut Creek** | 1.16e-01 | 0.35 | 0.30 | 0.18 | 4.37e-02 | 5.08e-03 |
    4.12e-04 | 2.75e-04 |'
- en: 'Each bar in the plot has the same height of 1 because the segments represent
    the proportion of houses with one or more bedrooms in a city and so add to 1 or
    100% (see it in color [online](https://oreil.ly/cIba_)):'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 绘图中的每个条形的高度都相同，因为段代表城市中一卧室或更多卧室的房屋比例，因此总和为1或100%（在线查看[详细信息](https://oreil.ly/cIba_)）：
- en: '[PRE18]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![](assets/leds_11in29.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in29.png)'
- en: It’s easy to compare the proportion of one-bedroom houses in each of the cities
    by simply scanning across the top of the first segment in each column. But the
    comparison of four-bedroom houses is more difficult. The bottoms of the segments
    are not aligned horizontally, so our eyes must judge the lengths of segments that
    move up and down across the plot. This up-and-down movement is called *jiggling
    the baseline*. (We recognize that with so many colors, this plot does not render
    well in grayscale, but our goal is to steer you away from plots like this one
    and the next, so we have kept all of the colors for those of you reading the online
    version.)
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 通过简单地扫描每列第一个片段顶部，很容易比较每个城市一卧室房屋的比例。但是，比较四卧室房屋就更加困难。由于段的底部水平不对齐，我们必须用眼睛判断绘图中上下移动的段长度。这种上下移动称为*基线摆动*。（我们意识到，由于颜色过多，这个图在灰度中显示效果不佳，但我们的目标是引导你远离这样的图表，所以对于在线阅读的读者，我们保留了所有的颜色。）
- en: 'Stacked line plots are even more difficult to read because we have to judge
    the gap between curves as they jiggle up and down. The following plot shows [carbon
    dioxide (CO[2]) emissions](https://oreil.ly/kjk9N) from 1950 to 2012 for the 10
    highest emitters (see it in color [online](https://oreil.ly/VUyuz)):'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 堆叠线图更难阅读，因为我们必须判断曲线之间的间隙，而它们上下摇晃。下图显示了1950年至2012年排放量最高的10个国家的[二氧化碳（CO[2]）排放](https://oreil.ly/kjk9N)（在线查看颜色[online](https://oreil.ly/VUyuz)）：
- en: '![](assets/leds_11in30.png)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in30.png)'
- en: 'Since the lines are stacked on top of each other, it’s very hard to see how
    the emissions for a particular country have changed and it’s hard to compare countries.
    Instead, we can plot each country’s line without stacking, as the next plot illustrates
    (see it in color [online](https://oreil.ly/erWuU)):'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这些线条是堆叠在一起的，很难看出特定国家的排放量如何变化，也很难比较各个国家。相反，我们可以绘制每个国家的线条，而不是堆叠，如下图所示（在线查看颜色[online](https://oreil.ly/erWuU)）：
- en: '![](assets/leds_11in31.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in31.png)'
- en: Now it’s much easier to see changes for individual countries and to compare
    countries because we need judge only y-axis positions rather than short vertical
    segments with different baselines. We also used a log scale on the y-axis. We
    can now see that some countries have had flat rates of growth in CO[2] emissions,
    such as the United States and Japan, while others have increased much more quickly,
    like China and India, and Germany has slowed its CO[2] emissions. These aspects
    were nearly impossible to detect when each country’s baseline jiggled across the
    plot.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 现在查看单个国家的变化以及比较国家变得更加容易，因为我们只需要判断y轴位置而不是具有不同基线的短垂直段。我们还在y轴上使用了对数刻度。现在我们可以看到，一些国家的二氧化碳排放率增长缓慢，例如美国和日本，而其他国家的增长速度更快，如中国和印度，而德国减缓了其二氧化碳排放。在每个国家的基线在图中摇晃时，几乎不可能检测到这些方面。
- en: In both of these plots, to make it easier to tell one country from the next,
    we have used different line types and colors. Choosing colors to facilitate comparisons
    relies on many considerations. This is the topic of the next section.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在这两个图中，为了更容易区分各个国家，我们使用了不同的线型和颜色。选择颜色以促进比较依赖于许多考虑因素。这是下一节的主题。
- en: Selecting a Color Palette
  id: totrans-182
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 选择调色板
- en: Choosing colors also plays an important role in data visualization. We want
    to avoid overly bright or dark colors so that we don’t strain the reader’s eyes.
    We should also avoid color palettes that might be difficult for colorblind people—7%
    to 10% of people (mostly males) are red-green colorblind.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 选择颜色在数据可视化中也起着重要作用。我们希望避免使用过亮或过暗的颜色，以免给读者的眼睛带来压力。我们还应避免对色盲人士可能困难的调色板——7%到10%的人（主要是男性）是红绿色盲。
- en: For categorical data, we want to use a color palette that can clearly distinguish
    between categories. One example is shown at the top in [Figure 11-2](#three-palettes).
    From top to bottom, these palettes are qualitative for categorical data, diverging
    for numeric data where you want to draw attention to both large and small values,
    and sequential for numeric data where you want to emphasize either large or small
    values.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 对于分类数据，我们希望使用一种可以清楚区分类别的调色板。图11-2中的顶部展示了一个示例（参见[Figure 11-2](#three-palettes)）。从上到下，这些调色板用于分类数据的定性，用于数值数据的分散调色板，其中希望吸引对大值和小值的注意力，以及用于数值数据的顺序调色板，其中希望强调大或小值。
- en: '![](assets/leds_1102.png)'
  id: totrans-185
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_1102.png)'
- en: Figure 11-2\. Three printer-friendly palettes from ColorBrewer 2.0 (see it in
    color [online](https://oreil.ly/0ub2H))
  id: totrans-186
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图11-2. 来自ColorBrewer 2.0的三种适合打印的调色板（在线查看颜色[online](https://oreil.ly/0ub2H)）
- en: For numeric data, we want to use a sequential color palette that emphasizes
    one side of the spectrum more than the other or a diverging color palette that
    equally emphasizes both ends of the spectrum and deemphasizes the middle. A sequential
    palette is shown at the bottom and a diverging palette is shown in the middle
    of [Figure 11-2](#three-palettes).
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 对于数值数据，我们希望使用顺序调色板，强调光谱的一侧而不是另一侧，或者使用分散调色板，两端平衡强调，中间淡化。图11-2显示了顺序调色板位于底部，分散调色板位于中间（参见[Figure 11-2](#three-palettes)）：
- en: We choose a sequential palette when we want to emphasize either low or high
    values, like cancer rates. We choose a diverging palette when we want to emphasize
    both extremes, like for two-party election results.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们想要强调低或高值（如癌症率）时，我们选择一个顺序调色板。当我们想要强调两个极端（如两党选举结果）时，我们选择一个分散调色板。
- en: It’s important to choose a perceptually uniform color palette. By this we mean
    that when a data value is doubled, the color in the visualization looks twice
    as colorful to the human eye. We also want to avoid colors that create an afterimage
    when we look from one part of the graph to another, colors of different intensities
    that make one attribute appear more important than another, and colors that colorblind
    people have trouble distinguishing between. We strongly recommend using a palette
    or a palette generator made specifically for data visualizations.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 选择感知统一的颜色调色板非常重要。这意味着当数据值加倍时，可视化中的颜色在人眼中看起来会变得两倍鲜艳。我们还希望避免颜色会在我们从图表的一个部分看向另一个部分时产生余像，不同强度的颜色会使一个属性看起来比另一个属性更重要，以及色盲人士难以区分的颜色。我们强烈建议使用专为数据可视化制作的调色板或调色板生成器。
- en: Plots are meant to be examined for long periods of time, so we should choose
    colors that don’t impede the reader’s ability to carefully study a plot. Even
    more so, the use of color should not be gratuitous—colors should represent information.
    On a related note, people typically have trouble distinguishing between more than
    about seven colors, so we limit the number of colors in a plot. Finally, colors
    can appear quite different when printed on paper in grayscale than when viewed
    on a computer screen. When we choose colors, we keep in mind how our plots will
    be displayed.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 图表应该被长时间检查，因此我们应该选择不妨碍读者仔细研究图表的颜色。更重要的是，颜色的使用不应是多余的——颜色应该代表信息。相关的是，人们通常很难区分超过七种颜色，因此我们限制图表中颜色的数量。最后，颜色在纸上打印时可能与在计算机屏幕上查看时相差很大。在选择颜色时，我们考虑我们的图表将如何显示。
- en: Making accurate comparisons in a visualization is such an important goal that
    researchers have studied how well people perceive differences in colors and other
    plotting features such as angles and lengths. This is the topic of the next section.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 在可视化中进行准确的比较是如此重要，以至于研究人员已经研究了人们感知颜色和其他绘图特征（如角度和长度）差异的程度。这是下一节的主题。
- en: Guidelines for Comparisons in Plots
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 绘图比较的指南
- en: 'Researchers have studied how accurately people can read information displayed
    in different types of plots. They have found the following ordering, from most
    to least accurately judged:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 研究人员研究了人们在不同类型的图表中读取信息的准确度。他们发现以下排序，从最准确到最不准确：
- en: Positions along a common scale, like in a rug plot, strip plot, or dot plot
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 沿着共同刻度的位置，比如在地毯图、条带图或点图中
- en: Positions on identical, nonaligned scales, like in a bar plot
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在相同但非对齐刻度上的位置，比如在条形图中
- en: Length, like in a stacked bar plot
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 长度，在堆叠条形图中
- en: Angle and slope, like in a pie chart
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 角度和斜率，在饼图中
- en: Area, like in a stacked line plot or bubble chart
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 面积，在堆叠线图或气泡图中
- en: Volume and density, like in a three-dimensional bar plot
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 体积和密度，在三维条形图中
- en: Color saturation and hue, like when overplotting with semitransparent points
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 颜色的饱和度和色调，比如在使用半透明点进行重叠绘制时
- en: 'As an example, here is a pie chart that shows the proportion of houses sold
    in San Francisco that have from one to eight or more bedrooms, and a bar chart
    with the same proportions:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，这是一个显示旧金山售出的房屋中拥有从一到八个或更多卧室比例的饼图，以及具有相同比例的条形图：
- en: '![](assets/leds_11in32.png)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in32.png)'
- en: It’s hard to judge the angles in the pie chart, and the annotations with the
    actual percentages are needed. We also lose the natural ordering of the number
    of bedrooms. The bar chart doesn’t suffer from these issues.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在饼图中很难判断角度，需要用实际百分比进行注释。我们还失去了卧室数量的自然顺序。条形图没有这些问题。
- en: However, there are exceptions to any rule. Multiple pie charts with only two
    or three slices in each pie can provide effective visualizations. For example,
    a set of pie charts of the proportion of two-bedroom houses sold in each of six
    cities in the San Francisco East Bay Area, ordered according to the proportion,
    can be an impactful visualization. Yet, sticking with a bar chart will generally
    always be at least as clear as any pie chart.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，任何规则都有例外。每个饼图中只有两个或三个片段的多个饼图可以提供有效的可视化效果。例如，一组饼图显示旧金山东湾地区六个城市中每个城市售出的两卧室房屋的比例，按比例排序，可以产生深远的可视化效果。然而，坚持使用条形图通常至少和任何饼图一样清晰。
- en: Given these guidelines, we recommend sticking to position and length for making
    comparisons. Readers can more accurately judge comparisons based on position or
    length, rather than angle, area, volume, or color. But, if we want to add additional
    information to a plot, we often use color, symbols, and line styles, in addition
    to position and length. We have shown several examples in this chapter.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 根据这些准则，我们建议在进行比较时坚持使用位置和长度。读者可以更准确地根据位置或长度来判断比较，而不是角度、面积、体积或颜色。但是，如果我们想向图表添加额外信息，通常会使用颜色、符号和线型，除了位置和长度。我们在本章中展示了几个例子。
- en: We next turn to the topic of data design and how to reflect the aspects of when,
    where, and how the data were collected in a visualization. This is a subtle but
    important topic. If we ignore the data scope, we can get very misleading plots.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来我们转向数据设计的话题，讨论如何在可视化中反映数据收集的时间、地点和方式的方面。这是一个微妙但重要的话题。如果忽略数据的范围，我们可能会得到非常误导人的图表。
- en: Incorporating the Data Design
  id: totrans-207
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结合数据设计
- en: When we create a visualization, it’s important to consider the data scope, especially
    the data design (see [Chapter 2](ch02.html#ch-data-scope)). Considering the question
    of how the data were collected can impact our plot choice and the comparisons
    we portray. These considerations include the time and place where the data were
    collected and the design used to select a sample. We look at a few examples of
    how the data scope can inform the visualizations we make.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们创建可视化时，考虑数据的范围尤为重要，特别是数据设计（见[第二章](ch02.html#ch-data-scope)）。考虑数据收集方式的问题可以影响我们的图表选择和所描绘的比较。这些考虑包括数据收集的时间和地点，以及用于选择样本的设计。我们看几个例子，展示数据范围如何影响我们所做的可视化。
- en: Data Collected Over Time
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据随时间的收集
- en: 'When data are collected over time, we typically make a line plot that puts
    timestamps on the x-axis and a feature of interest on the y-axis to look for trends
    in time. As an example, let’s revisit the data on San Francisco housing prices.
    These data were collected from 2003 through 2008 and show the crash in 2008/2009
    of the [US housing bubble](https://oreil.ly/PUPiQ). Since time is a key aspect
    of the scope of these data, let’s visualize sale price as a time series. Our earlier
    explorations showed that sale price is highly skewed, so let’s work with percentiles
    rather than averages. We plot the median price (this is a form of smoothing we
    saw earlier in this chapter):'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 当数据随时间收集时，我们通常制作一条线图，将时间戳放在 x 轴上，将感兴趣的特征放在 y 轴上，以便观察时间趋势。例如，让我们重新审视旧金山房价数据。这些数据从2003年到2008年收集，展示了2008/2009年美国房地产泡沫的崩溃（[美国房地产泡沫](https://oreil.ly/PUPiQ)）。由于时间是这些数据范围的关键方面，让我们将销售价格可视化为时间序列。我们之前的探索显示销售价格高度偏斜，所以让我们使用百分位数而不是平均数。我们绘制中位数价格（这是我们在本章早些时候看到的一种平滑形式）：
- en: '![](assets/leds_11in33.png)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in33.png)'
- en: 'This plot shows the rise in prices from 2003 to 2007 and the fall in 2008\.
    But we can show more information by plotting a few additional percentiles instead
    of just the median. Let’s draw separate lines for the 10th, 30th, 50th (median),
    70th, and 90th percentile sale prices. When we examine prices over time, we typically
    need to adjust for inflation so that the comparisons are on the same footing.
    In addition to adjusting for inflation, let’s plot the prices relative to the
    starting price in 2003 for each of the percentiles. This means that all the lines
    start at y = 1 in 2003\. (A value of 1.5 for the 90th percentile in 2006 indicates
    that the sale price is 1.5 times the 90th percentile in 2003.) This normalization
    lets us see how the housing crash affected home owners in the different parts
    of the market:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 此图显示了2003年到2007年价格的上升和2008年的下降。但是，我们可以通过绘制几个额外的百分位数线来展示更多信息，而不仅仅是中位数。让我们为第10、30、50（中位数）、70和90百分位数的销售价格分别绘制不同的线条。当我们随时间检查价格时，通常需要校正通货膨胀，以便比较处于相同基础上。除了通货膨胀调整外，让我们将价格相对于2003年的起始价格进行绘制，每个百分位数的起始值为y
    = 1。 （2006年90百分位数的值为1.5表明，销售价格是2003年90百分位数的1.5倍）。这种归一化方法使我们能够看到住房市场不同部分的房屋危机如何影响房主：
- en: '![](assets/leds_11in34.png)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in34.png)'
- en: When we follow the 10th percentile line plot over time, we see that it increases
    quickly in 2005, stays high relative to its 2003 value for a few years, and then
    drops earlier and more quickly than the other percentiles. This tells us that
    the less expensive houses, such as starter homes, suffered greater volatility
    and lost much more value in the housing market crash. In contrast, higher-end
    homes were affected less by the crash; at the end of 2008, the 90th percentile
    home prices were still higher than the 2003 prices. Applying this bit of domain
    knowledge helps reveal trends in the data that we might otherwise miss, and shows
    how we can use the data design to improve a visualization.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们随时间跟踪第10百分位线的折线图时，我们发现它在2005年迅速上升，在接下来的几年里相对于2003年的值保持较高水平，然后比其他百分位数更早更快地下降。这告诉我们，较便宜的房屋，如起始家庭住房，在房地产市场崩溃中遭受了更大的波动并且损失了更多的价值。相比之下，高端住房受到的冲击较小；在2008年底，第90百分位数的房价仍高于2003年的价格。应用这一领域知识有助于揭示我们可能会忽略的数据趋势，并展示如何利用数据设计来改善可视化。
- en: The housing data are an example of observational data that form a complete census
    in a geographic region over a specific period of time. Next we consider another
    observational study where self-selection and the time period impact the visualization.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 住房数据是一个关于特定时期内特定地理区域的完全普查的观察数据的例子。接下来，我们考虑另一个观察性研究，其中自我选择和时间段影响了可视化效果。
- en: Observational Studies
  id: totrans-216
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 观察性研究
- en: 'We need to be particularly cautious with data that do not form a census or
    scientific sample. We should also take care with cross-sectional studies, whether
    from a census or scientific sample. For this example, we revisit the data from
    the Cherry Blossom 10-mile run. Earlier in this chapter, we made a smoothed curve
    to examine the relationship between race time and age. We reproduce this plot
    here to highlight a potential pitfall in interpretation:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要特别小心那些不构成人口普查或科学样本的数据。我们也应该注意横断面研究，无论是来自人口普查还是科学样本。在这个例子中，我们重新审视了樱花10英里赛的数据。在本章的早些时候，我们制作了一个平滑曲线来研究赛时与年龄之间的关系。我们在这里再次重现这个图表，以突显解释可能存在的潜在陷阱：
- en: '![](assets/leds_11in35.png)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in35.png)'
- en: It’s tempting to look at this plot and conclude that, for instance, a runner
    at age 60 can typically expect to take an additional 600 seconds to finish the
    run than when they were 40\. However, this is a *cross-sectional* study, not a
    *longitudinal* study. The study does not follow people over time; instead, it
    gets a snapshot of a cross-section of people. The 60-year-old runners represented
    in the plot are different people than the 40-year-old runners. These two groups
    could be different in ways that affect the relationship between race time and
    age. As a group, the 60-year-olds in the race are likely to be fitter for their
    age than the 40-year-olds. In other words, the data design doesn’t let us make
    conclusions about individual runners. The visualization isn’t wrong, but we need
    to be careful about the conclusions we draw from it.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 诱人的是，看到这张图表可能会得出结论，例如，60岁的跑步者通常比40岁时需要额外花费600秒来完成比赛。然而，这是一个*横断面*研究，而不是*纵向*研究。该研究并未随时间跟踪人们的变化；相反，它获取了一个人群的横截面。在图表中代表60岁跑步者的人与代表40岁跑步者的人是不同的。这两组人可能在影响赛时与年龄关系的方式上有所不同。作为一个群体，比赛中的60岁老人可能比40岁的老人更适合他们的年龄。换句话说，数据设计不允许我们对个体跑步者做出结论。这个可视化并没有错，但我们在从中得出结论时需要小心。
- en: 'The design is even more complex because we have race results from many years.
    Each year forms a cohort, a group of racers, and from one year to the next, the
    cohort changes. We create a visualization that makes this message clear by comparing
    runners in different race years. Here, we’ve separately plotted lines for the
    runners in 1999, 2005, and 2010:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 这个设计更加复杂，因为我们有多年的比赛结果。每一年形成一个队列，一个选手组，而从一年到下一年，队列会改变。我们通过比较不同年份的选手来清晰地传达这个信息。在这里，我们分别画出了1999年、2005年和2010年的选手线路图：
- en: '![](assets/leds_11in36.png)'
  id: totrans-221
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in36.png)'
- en: We see that the median race times in 2010 are higher at every age group than
    the times for the runners in 2005, and in turn, the times are higher for the runners
    in 2005 than for the runners in 1999\. It’s interesting that race times have slowed
    over the years. This is quite likely due to the increased popularity of the race,
    where there is higher participation from novice runners in more recent years.
    This example has shown how we need to be aware of the data scope when interpreting
    patterns. We also need to keep data scope in mind with scientific studies. This
    is the topic of the next section.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到2010年每个年龄组的中位数比2005年的跑步者更高，而2005年的跑步者的时间比1999年的跑步者更高。有趣的是，随着比赛的增加，尤其是近年来新手跑步者的参与增加，比赛时间逐年放缓。这个例子显示了我们在解释模式时需要注意数据范围。在科学研究中，我们也需要牢记数据范围。这是下一节的主题。
- en: Unequal Sampling
  id: totrans-223
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 不均匀抽样
- en: 'In a scientific study, we must consider the sample design because it can impact
    our plots. Some samples draw individuals at unequal rates, and this needs to be
    accounted for in our visualizations. We saw an example of a scientific study in
    [Chapter 8](ch08.html#ch-files) and [Chapter 9](ch09.html#ch-wrangling): the Drug
    Abuse Warning Network (DAWN) survey. These data are from a complex randomized
    study of drug-related emergency room visits, and each record comes with a weight
    that we must use in order to accurately represent the emergency room visits in
    the population. The two bar plots that follow show the distribution of the type
    of ER visit. (See them larger [online](https://oreil.ly/LYAol).) The one on the
    left doesn’t use the survey weights and the one on the right does:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 在科学研究中，我们必须考虑样本设计，因为它可能影响我们的图表。一些样本以不均等的速率抽取个体，这需要在我们的可视化中进行考虑。我们在[第8章](ch08.html#ch-files)和[第9章](ch09.html#ch-wrangling)中看到了科学研究的例子：药物滥用警告网络（DAWN）调查。这些数据来自于关于药物相关急诊访问的复杂随机研究，每个记录都带有一个权重，我们必须使用这些权重来准确地代表人口中的急诊访问情况。接下来的两个条形图显示了急诊访问类型的分布。可以在[在线链接](https://oreil.ly/LYAol)上查看更大的版本。左侧的图表未使用调查权重，右侧的图表使用了：
- en: '![](assets/leds_11in37.png)'
  id: totrans-225
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in37.png)'
- en: In the unweighted bar plot, the “Other” category is as frequent as the “Adverse
    reaction” category. However, when weighted, “Other” drops to about two-thirds
    of “Adverse reaction.” Ignoring sampling weights can give a misleading presentation
    of a distribution. Whether for a histogram, bar plot, box plot, two-dimensional
    contour, or smooth curve, we need to use the weights to get a representative plot.
    Another aspect of the data scope that can impact our choice of plots is where
    the data are collected, which is the topic of the next section.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 在未加权的条形图中，“其他”类别与“不良反应”类别一样频繁。然而，加权后，“其他”类别下降到“不良反应”的约三分之二。忽略抽样权重可能会导致分布的误导性呈现。无论是直方图、条形图、箱线图、二维轮廓还是光滑曲线，我们都需要使用权重来获得代表性的图表。数据范围的另一个影响我们图表选择的方面是数据收集的地点，这是下一节的主题。
- en: Geographic Data
  id: totrans-227
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 地理数据
- en: 'When our data contains geographic information like latitude and longitude,
    we should consider making a map, in addition to the typical plots. For example,
    the following map shows the locations for US air quality sensors, which is the
    focus of the case study in [Chapter 12](ch12.html#ch-pa):'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们的数据包含像纬度和经度这样的地理信息时，除了典型的图表外，我们应该考虑制作地图。例如，下图展示了美国空气质量传感器的位置，这是[第12章](ch12.html#ch-pa)案例研究的重点：
- en: '![](assets/leds_11in38.png)'
  id: totrans-229
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in38.png)'
- en: Notice that there are many more points in California and the Eastern Seaboard.
    A simple histogram of air quality with data from all of these sensors would misrepresent
    the distribution of air quality in the US. To incorporate the spatial aspect into
    the distribution, we can add air quality measurements to the map with different
    color markers, and we can facet the histograms of air quality by location.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 注意加利福尼亚州和东海岸有更多的数据点。使用所有这些传感器数据的简单空气质量直方图会误代表美国的空气质量分布。为了将空间因素纳入分布中，我们可以使用不同颜色的标记将空气质量测量添加到地图上，并且可以按位置分面显示空气质量的直方图。
- en: In addition to plotting features like bars, color, and line styles, we also
    have the option to add text with contextual information to make our plot more
    informative. This is the topic of the next section.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 除了绘制条形、颜色和线条样式等特征外，我们还可以选择添加文本以提供背景信息，从而使我们的图表更具信息性。这是下一节的主题。
- en: Adding Context
  id: totrans-232
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加背景信息
- en: We have used text in our graphs throughout this chapter to provide meaningful
    axis labels that include units of measurement, tick-mark labels for categories,
    and titles. This is a good practice when sharing a visualization more broadly.
    A good goal is to include enough context in a plot that it can stand alone—a reader
    should be able to get the gist of the plot without needing to search for explanation
    elsewhere. That said, every element of a statistical graph should have a purpose.
    Superfluous text or plot features, often referred to as *chartjunk*, should be
    eliminated. In this section, we provide a brief overview of ways we can add helpful
    context to our plots and an example where we create a publication-ready plot by
    adding context.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们在图表中使用文本来提供包括测量单位的有意义的轴标签、用于类别的刻度标签和标题。在广泛分享可视化时，这是一个良好的实践。一个好的目标是在图中包含足够的上下文，使其能够独立存在——读者应该能够理解图的主要内容，而不需要到处寻找解释。尽管如此，统计图的每个元素都应该有一个目的。多余的文本或图表功能，通常称为*图表垃圾*，应该被消除。在本节中，我们提供了如何通过添加上下文来创建一个出版准备好的图表的简要概述。
- en: Text context includes *labels* and *captions*. It is a good practice to consistently
    use informative labels on tick marks and axes. For example, axis labels often
    benefit from including units of measurement. Graphs should contain titles and
    legends when needed. Informative labels are especially important for plots that
    other people will see and interpret. However, even when we’re doing exploratory
    data analysis just for us, we often want to include enough context that when we
    later return to an analysis we can easily figure out what we plotted.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 文本上下文包括*标签*和*标题*。在刻度标记和轴上一贯使用信息丰富的标签是一个良好的做法。例如，轴标签通常受益于包含测量单位。当需要时，图表应包含标题和图例。信息丰富的标签对于其他人会看到和解释的图表尤为重要。然而，即使在进行我们自己的探索性数据分析时，我们通常也希望包含足够的上下文，以便在稍后返回分析时，我们能够轻松地理解我们绘制了什么。
- en: Captions serve several purposes. They describe what has been plotted and orient
    the reader. Captions also point out important features of the plot and comment
    on their implications. It’s OK for the caption to repeat information found in
    the text. Readers often skim a publication and focus on section headings and visualizations,
    so plot captions should be self-contained.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 标题起到了几个作用。它们描述了绘制的内容并指导读者。标题还指出了图的重要特征并评论了它们的含义。标题中重复文本中的信息是可以接受的。读者通常会快速浏览出版物并关注章节标题和可视化内容，因此图的标题应该是自包含的。
- en: '*Reference markers* bring additional context to the plotting region. Reference
    points and lines that provide benchmarks, historical values, and other external
    information help form comparisons and interpretations. For example, we often add
    a reference line with slope 1 to a quantile–quantile plot. We might also add a
    vertical line on a time-series plot to mark a special event, like a natural disaster.'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: '*参考标记*为绘图区域带来了额外的背景信息。提供基准、历史值和其他外部信息的参考点和参考线帮助进行比较和解释。例如，我们经常在分位数-分位数图上添加斜率为1的参考线。我们还可能在时间序列图上添加垂直线以标记特殊事件，如自然灾害。'
- en: The following example demonstrates how to add these context elements to a plot.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的例子演示了如何向绘图添加这些上下文元素。
- en: 'Example: 100m Sprint Times'
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 例子：100米短跑时间
- en: 'The following figure shows the race times in the men’s 100-meter sprint since
    1968\. These data include only races that were electronically timed and held outdoors
    in normal wind conditions, and the times included are only for those runners who
    came in under 10 seconds. The plot is a basic scatterplot showing race time against
    year. Beginning with this plot, we augment it to create a plot featured in a [FiveThirtyEight
    article](https://oreil.ly/pxHr4) about the 100-meter sprint:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图显示了自1968年以来男子100米短跑的比赛时间。这些数据仅包括在正常风条件下、使用电子计时的户外比赛，并且仅包括在10秒内完成比赛的选手的时间。图表是一个基本的散点图，显示了时间与年份的关系。从这张图开始，我们对其进行了增强，以创建一幅出现在[FiveThirtyEight文章](https://oreil.ly/pxHr4)中的图表。
- en: '![](assets/leds_11in39.png)'
  id: totrans-240
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in39.png)'
- en: 'When we want to prepare a plot for others to read, we consider the takeaway
    message. In this case, our main message is twofold: the best runners have been
    getting faster over the past 50 years, and Usain Bolt’s remarkable record time
    of 9.58 seconds set in 2009 remains untouched. (In fact, the second-best race
    time also belongs to Bolt.) We provide context to this plot by adding a title
    that directly states the main takeaway, units of measurement in the y-axis label,
    and annotations to key points in the scatterplot, including the two best race
    times that belong to Usain Bolt. In addition, we add a horizontal reference line
    at 10 seconds to clarify that only times below 10 seconds are plotted, and we
    use a special symbol for the world record time to draw the reader’s attention
    to this crucial point:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们想要准备一张图形供他人阅读时，我们考虑的是主要信息。在这种情况下，我们的主要信息是双重的：在过去的50年中，最佳选手们的速度越来越快，而乌塞恩·博尔特在2009年创下的9.58秒的非凡记录至今未被打破（事实上，第二快的比赛时间也属于博尔特）。我们通过添加直接陈述主要信息的标题、y轴标签中的测量单位以及散点图中关键点的注释来提供这张图形的背景信息。此外，我们添加了一个水平参考线，在10秒以下的时间中仅绘制时间，以澄清世界纪录时间使用特殊符号来引起读者的注意。
- en: '![](assets/leds_11in40.png)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in40.png)'
- en: These bits of context describe what we have plotted, help readers see the main
    takeaway, and point out several interesting features in the data. The plot can
    now be a useful part of a slideshow, technical report, or social media post. In
    our experience, people who look at our data analyses remember our plots, not paragraphs
    of text or equations. It’s important to go the extra mile and add context to the
    plots we prepare for others.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 这些背景信息描述了我们所绘制的内容，帮助读者看到主要信息，并指出数据中几个有趣的特征。现在，这张图可以成为幻灯片、技术报告或社交媒体帖子的有用部分。根据我们的经验，查看我们的数据分析的人记住我们的图形，而不是段落文本或方程式。为他人准备的图形添加背景信息是非常重要的。
- en: In the next section, we move on to specifics on how to create plots using the
    `plotly` Python package.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将详细介绍如何使用 `plotly` Python 包创建图形。
- en: Creating Plots Using plotly
  id: totrans-245
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 `plotly` 创建图形
- en: In this section, we cover the basics of the `plotly` Python package, the main
    tool we use in this book to create plots.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们介绍了使用 `plotly` Python 包的基础知识，这是我们在本书中创建图形所使用的主要工具。
- en: The `plotly` package has several advantages over other plotting libraries. It
    creates interactive plots rather than static images. When you create a plot in
    `plotly`, you can pan and zoom to see parts of the plot that are too small to
    see normally. You can also hover over plot elements, like the symbols in a scatterplot,
    to see the raw data values. Also, `plotly` can save plots using the SVG file format,
    which means that images appear sharp even when zoomed in. If you’re reading this
    chapter in a PDF or paper copy of the book, we used this feature to render plot
    images. Finally, it has a simple “express” API for creating basic plots, which
    helps when you’re doing exploratory analysis and want to quickly create many plots.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: '`plotly` 包相比其他绘图库有几个优点。它创建的是交互式图形而不是静态图像。当你在 `plotly` 中创建一个图形时，你可以平移和缩放，以查看通常太小以至于看不见的图形部分。你还可以悬停在图形元素上，比如散点图中的符号，以查看原始数据值。此外，`plotly`
    可以使用 SVG 文件格式保存图形，这意味着即使放大后图像仍然清晰。如果你在 PDF 或书本的纸质副本中阅读本章节，我们使用了这个功能来渲染图形图像。最后，它有一个简单的“express”
    API，用于创建基本图形，这在进行探索性分析并想快速创建多个图形时非常有帮助。'
- en: We go over the fundamentals of `plotly` in this section. We recommend using
    the [official `plotly` documentation](https://plotly.com/python) if you encounter
    something that isn’t covered here.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们介绍了 `plotly` 的基础知识。如果你在这里遇到未涵盖的内容，我们建议查阅[官方 `plotly` 文档](https://plotly.com/python)。
- en: Figure and Trace Objects
  id: totrans-249
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 图形和轨迹对象
- en: Every plot in `plotly` is wrapped in a `Figure` object. `Figure` objects keep
    track of what to draw. For instance, a single `Figure` can draw a scatterplot
    on the left and a line plot on the right. `Figure` objects also keep track of
    the plot layout, which includes the plot’s size, title, legend, and annotations.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 每个 `plotly` 中的图形都包装在一个 `Figure` 对象中。`Figure` 对象跟踪要绘制的内容。例如，一个单独的 `Figure` 可以在左侧绘制散点图，在右侧绘制线图。`Figure`
    对象还跟踪图形的布局，包括图形的大小、标题、图例和注释。
- en: 'The `plotly.express` module provides a concise API for making plots:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '`plotly.express` 模块提供了一个简洁的 API 来制作图形：'
- en: '[PRE19]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'We use `plotly.express` in the following code to make a scatterplot of weight
    against height for the data on dog breeds. Notice that the return value from `.scatter()`
    is a `Figure` object:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在以下代码中使用 `plotly.express` 制作了一张关于狗品种体重与身高的散点图。请注意，`.scatter()` 的返回值是一个 `Figure`
    对象：
- en: '[PRE20]'
  id: totrans-254
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '[PRE21]'
  id: totrans-255
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Displaying a `Figure` object renders it to the screen:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 显示 `Figure` 对象将其渲染到屏幕上：
- en: '[PRE22]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '![](assets/leds_11in41.png)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in41.png)'
- en: 'This particular `Figure` holds one plot, but `Figure` objects can hold any
    number of plots. Here, we create a facet of three scatterplots:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 这个特定的 `Figure` 包含了一个图表，但是 `Figure` 对象可以包含任意数量的图表。在这里，我们创建了一个包含三个散点图的分面图：
- en: '[PRE23]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![](assets/leds_11in42.png)'
  id: totrans-261
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in42.png)'
- en: These three plots are stored in `Trace` objects. However, we try to avoid manipulating
    `Trace` objects manually. Instead, `plotly` provides functions that automatically
    create faceted subplots, like the `px.scatter` function we used here. Now that
    we have seen how to make a simple plot, we next show how to modify plots.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 这三个图表存储在 `Trace` 对象中。但是，我们尽量避免手动操作 `Trace` 对象。相反，`plotly` 提供了自动创建分面子图的函数，例如我们这里使用的
    `px.scatter` 函数。现在我们已经看到如何制作简单的图表，接下来我们展示如何修改图表。
- en: Modifying Layout
  id: totrans-263
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 修改布局
- en: 'We often need to change a figure’s layout. For instance, we might want to adjust
    the figure’s margins or the axis range. We can use the `Figure.update_layout()`
    method to do this. In the facet scatterplot that we made, the title is cut off
    because the plot doesn’t have large enough margins. We can correct this with `Figure.update_layout()`:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 我们经常需要更改图表的布局。例如，我们可能想调整图表的边距或轴范围。我们可以使用 `Figure.update_layout()` 方法来实现这一点。在我们制作的分面散点图中，标题被裁剪，因为图表的边距不够大。我们可以通过
    `Figure.update_layout()` 来更正这个问题：
- en: '[PRE24]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![](assets/leds_11in43.png)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in43.png)'
- en: The `.update_layout()` method lets us modify any property of a layout. This
    includes the plot title (`title`), margins (`margins` dictionary), and whether
    to display a legend (`showlegend`). The `plotly` documentation has the full list
    of [layout properties](https://oreil.ly/aBLxx).
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: '`.update_layout()` 方法允许我们修改布局的任何属性。这包括图表标题 (`title`)、边距 (`margins` 字典) 和是否显示图例
    (`showlegend`)。`plotly` 文档中列出了完整的 [布局属性](https://oreil.ly/aBLxx)。'
- en: '`Figure` objects also have `.update_xaxes()` and `.update_yaxes()` functions,
    which are similar to `.update_layout()`. These two functions let us modify properties
    of the axes, like the axis limits (`range`), number of ticks (`nticks`), and axis
    label (`title`). Here, we adjust the range of the y-axis and change the title
    on the x-axis. We also add a title to the plot and update the layout so that the
    title is not cut off:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: '`Figure` 对象还具有 `.update_xaxes()` 和 `.update_yaxes()` 函数，与 `.update_layout()`
    类似。这两个函数允许我们修改轴的属性，如轴限制 (`range`)、刻度数 (`nticks`) 和轴标签 (`title`)。在这里，我们调整了 y 轴的范围，并更改了
    x 轴的标题。我们还为图表添加了标题，并更新了布局，以避免标题被裁剪：'
- en: '[PRE25]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '![](assets/leds_11in44.png)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in44.png)'
- en: The `plotly` package comes with many plotting methods; we describe several of
    them in the next section.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: '`plotly` 包提供了许多绘图方法；我们在下一节中描述了其中几种。'
- en: Plotting Functions
  id: totrans-272
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 绘图函数
- en: The `plotly` methods includes line plots, scatterplots, bar plots, box plots,
    and histograms. The API is similar for each type of plot. The dataframe is the
    first argument. Then we can specify a column of the dataframe to place on the
    x-axis and a column to place on the y-axis using the `x` and `y` keyword arguments.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: '`plotly` 方法包括折线图、散点图、条形图、箱线图和直方图。每种类型的绘图方法的 API 都类似。数据帧是第一个参数。然后我们可以使用 `x`
    和 `y` 关键字参数指定数据帧的列放置在 x 轴和 y 轴上。'
- en: 'We begin with a line plot of median time each year for the runners in the Cherry
    Blossom race:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先制作了每年樱花赛跑者的中位时间折线图：
- en: '[PRE26]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '![](assets/leds_11in45.png)'
  id: totrans-276
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in45.png)'
- en: 'Next, we make a bar plot of average longevity for different size dog breeds:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们制作不同大小狗品种的平均寿命条形图：
- en: '[PRE27]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '![](assets/leds_11in46.png)'
  id: totrans-279
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in46.png)'
- en: 'Plotting methods in `plotly` also contain arguments for making facet plots.
    We can facet using color on the same plot, plotting symbol, or line style. Or
    we can facet into multiple subplots. Following are examples of each. We first
    make a scatterplot of height and weight of dog breeds and use different plotting
    symbols and colors to facet within the plot by size:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: '`plotly` 中的绘图方法还包含用于制作分面图的参数。我们可以根据颜色、绘图符号或线条样式在同一图表中进行分面，或者将其分为多个子图。以下是每种方式的示例。我们首先制作了一个关于狗品种身高和体重的散点图，并使用不同的绘图符号和颜色来进行分面：'
- en: '[PRE28]'
  id: totrans-281
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '![](assets/leds_11in47.png)'
  id: totrans-282
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in47.png)'
- en: 'The next plot shows side-by-side histograms of longevity for each breed size.
    Here we facet by columns:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个图显示了每个品种大小寿命的并列直方图。这里我们按列进行分面：
- en: '[PRE29]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '![](assets/leds_11in48.png)'
  id: totrans-285
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in48.png)'
- en: For the complete list of plotting functions, see the main documentation for
    [`plotly`](https://oreil.ly/GxvpT) or [`plotly.express`](https://oreil.ly/DhU9j),
    the submodule of `plotly` that we primarily use in the book.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取绘图函数的完整列表，请参阅[`plotly`](https://oreil.ly/GxvpT)的主要文档或[`plotly.express`](https://oreil.ly/DhU9j)，这是我们在本书中主要使用的`plotly`子模块。
- en: To add context to a plot, we use the `plotly` annotation methods; these are
    described next.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 要为图表添加背景信息，我们使用`plotly`的注释方法；接下来将对此进行描述。
- en: Annotations
  id: totrans-288
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 注释
- en: 'The `Figure.add_annotation()` method places annotations on a `plotly` figure.
    These annotations are line segments with text and an optional arrow. The location
    of the arrow is set using the `x` and `y` parameters, and we can shift the text
    from its default position using the `ax` and `ay` parameters. Here, we annotate
    the scatter diagram with information about one of the points:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: '`Figure.add_annotation()`方法在`plotly`图表上放置注释。这些注释是带有文本和可选箭头的线段。箭头的位置使用`x`和`y`参数设置，我们可以使用`ax`和`ay`参数将文本从其默认位置移动。在这里，我们使用信息注释散点图的一个点：'
- en: '[PRE30]'
  id: totrans-290
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '![](assets/leds_11in49.png)'
  id: totrans-291
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/leds_11in49.png)'
- en: This section covered the basics of creating plots using the `plotly` Python
    package. We introduced the `Figure` object, which is the object `plotly` uses
    to store plots and their layouts. We covered the basic plot types that `plotly`
    makes available, and a few ways to customize plots by adjusting the layout and
    axes and by adding annotations. In the next section, we briefly compare `plotly`
    to other common tools for creating visualizations in Python.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 本节介绍了使用`plotly` Python包创建图表的基础知识。我们介绍了`Figure`对象，这是`plotly`用来存储图表及其布局的对象。我们讨论了`plotly`提供的基本图表类型，以及通过调整布局和坐标轴以及添加注释来自定义图表的几种方式。在下一节中，我们将简要比较`plotly`与Python中其他常见的可视化工具。
- en: Other Tools for Visualization
  id: totrans-293
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他可视化工具
- en: There are many software packages and tools for creating data visualizations.
    In this book, we primarily use `plotly`. But it’s worth knowing about a few other
    commonly used tools. In this section, we compare `plotly` to `matplotlib` and
    to the grammar of graphics tools.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多软件包和工具可用于创建数据可视化。在本书中，我们主要使用`plotly`。但值得了解的是其他几种常用工具。在本节中，我们将`plotly`与`matplotlib`和图形语法工具进行比较。
- en: matplotlib
  id: totrans-295
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[matplotlib](https://matplotlib.org/)'
- en: The library [`matplotlib`](https://matplotlib.org/) is one of the first data
    visualization tools created for Python. Because of this, it is widely used and
    has a large ecosystem of packages. Notably, the built-in plotting methods for
    `pandas DataFrames` make plots using `matplotlib`. One popular package that builds
    on top of `matplotlib` is called [`seaborn`](https://seaborn.pydata.org). Compared
    to `matplotlib` alone, `seaborn` provides a much simpler API to create statistical
    plots, like dot plots with confidence intervals. In fact, `seaborn`’s API was
    used as an inspiration for `plotly`’s API. If you look at `plotly` code and `seaborn`
    code side by side, you’ll find that the methods to create basic plots use similar
    code.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: '[`matplotlib`](https://matplotlib.org/)库是为Python创建的最早的数据可视化工具之一。因此，它被广泛使用，并拥有大量的软件包生态系统。值得注意的是，用于`pandas
    DataFrames`的内置绘图方法使用`matplotlib`。在`matplotlib`之上构建的一个流行包被称为[`seaborn`](https://seaborn.pydata.org)。与仅使用`matplotlib`相比，`seaborn`提供了一个更简单的API来创建统计图，例如带有置信区间的点图。事实上，`seaborn`的API启发了`plotly`的API。如果你将`plotly`和`seaborn`的代码并排比较，你会发现创建基本图表的方法使用了相似的代码。'
- en: One advantage of using `matplotlib` is its popularity. It’s relatively easy
    to find help creating or fine-tuning plots online because many existing projects
    use it. For this book, the main advantage of using `plotly` is that the plots
    we create are interactive. Plots in `matplotlib` are usually static images, which
    don’t allow for panning, zooming, or hovering over marks. Still, we expect that
    `matplotlib` will continue to be used for data analyses. In fact, several of the
    plots in this book were made using `seaborn` and `matplotlib` because `plotly`
    doesn’t yet support all the plots we want to make.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`matplotlib`的一个优势是其流行性。因为许多现有项目使用它，因此在线获取帮助来创建或调整图表相对容易。对于本书而言，使用`plotly`的主要优势是我们创建的图表是交互式的。`matplotlib`中的图表通常是静态图像，不支持平移、缩放或悬停在标记上。尽管如此，我们预计`matplotlib`仍将继续用于数据分析。事实上，本书中的几个图表是使用`seaborn`和`matplotlib`制作的，因为`plotly`尚未支持我们想要制作的所有图表。
- en: Grammar of Graphics
  id: totrans-298
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 图形语法
- en: The [grammar of graphics](https://dl.acm.org/doi/book/10.5555/1088896) is a
    theory developed by Lee Wilkinson for creating data visualizations. The basic
    idea is to use common building blocks for making plots. For instance, a bar plot
    and a dot plot are nearly identical, except that a bar plot draws rectangles and
    a dot plot draws points. This idea is captured in the grammar of graphics, which
    would say that a bar plot and a dot plot differ only in their “geometry” component.
    The grammar of graphics is an elegant system that we can use to describe nearly
    every kind of plot we wish to make.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: '[图形语法](https://dl.acm.org/doi/book/10.5555/1088896)是由李·威尔金森（Lee Wilkinson）为创建数据可视化而开发的理论。其基本思想是使用常见的构建块来制作图表。例如，柱状图和点图几乎是相同的，唯一的区别在于柱状图绘制矩形，而点图绘制点。这个想法被体现在图形语法中，它会说柱状图和点图只在它们的“几何”组件上有所不同。图形语法是一个优雅的系统，我们可以使用它来描述几乎我们想要制作的每一种图表。'
- en: This system is implemented in the popular plotting libraries [`ggplot2`](https://ggplot2.tidyverse.org)
    for the R programming language and [`Vega`](https://vega.github.io/vega) for JavaScript.
    [`Vega-Altair`](https://altair-viz.github.io), a Python package, provides a way
    to create `Vega` plots using Python, and we encourage interested readers to look
    over its documentation.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 这个系统在流行的绘图库[`ggplot2`](https://ggplot2.tidyverse.org)（用于R编程语言）和[`Vega`](https://vega.github.io/vega)（用于JavaScript）中实现。[`Vega-Altair`](https://altair-viz.github.io)，一个Python包，提供了一种使用Python创建`Vega`图表的方法，我们鼓励感兴趣的读者阅读其文档。
- en: Using a grammar of graphics tool like `Vega-Altair` enables flexibility in visualizations.
    And like `plotly`, `altair` also creates interactive visualizations. However,
    the Python API for these tools can be less straightforward than `plotly`’s API.
    In this book, we don’t typically need plots outside of what `plotly` is capable
    of creating, so we have opted for `plotly`’s simpler API.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 使用像`Vega-Altair`这样的图形语法工具可以实现可视化的灵活性。像`plotly`一样，`altair`也创建交互式可视化。然而，这些工具的Python
    API可能没有`plotly`的API那么直接。在本书中，我们通常不需要`plotly`无法创建的图表，因此我们选择了`plotly`更简单的API。
- en: There are many more plotting tools for Python that we’ve left out for brevity.
    But for the purposes of this book, relying on `plotly` provides a useful balance
    of interactivity and flexibility.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 为了简洁起见，我们略去了Python中许多其他绘图工具。但对于本书的目的，依赖于`plotly`提供了交互性和灵活性的有用平衡。
- en: Summary
  id: totrans-303
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: When we analyze a dataset, we use visualizations to uncover patterns in the
    data that are difficult to detect otherwise. Data visualization is an iterative
    process. We create a plot, then decide whether to make adjustments or choose an
    entirely new type of plot. This chapter covered principles that we use to make
    these decisions.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们分析数据集时，我们使用可视化来发现数据中难以以其他方式检测到的模式。数据可视化是一个迭代的过程。我们创建一个图，然后决定是否进行调整或选择一个全新的图表类型。本章介绍了我们用来做出这些决策的原则。
- en: We started by covering principles of scale, and saw how adjusting the scale
    by changing or transforming plot axes can reveal hidden structure in the data.
    We then discussed smoothing and aggregating techniques that help us work with
    large datasets that would otherwise result in overplotting. To facilitate meaningful
    comparisons, we applied principles of perception, like aligning baselines to make
    lines, bars, and points easier to compare. We showed how to take the data design
    into account to improve visualizations. And we saw how adding context to a plot
    helps a reader understand our message.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先介绍了规模的原则，并看到通过改变或转换绘图轴来调整比例尺可以揭示数据中隐藏的结构。然后，我们讨论了平滑和聚合技术，这些技术帮助我们处理大型数据集，否则会导致过度绘制。为了进行有意义的比较，我们应用了知觉原则，例如调整基线以使线条、柱状图和点易于比较。我们展示了如何考虑数据设计来改进可视化效果。并且我们看到，为绘图添加上下文有助于读者理解我们的信息。
- en: After this chapter, you should be able to create a plot and understand what
    kinds of adjustments would make the plot more effective. As you learn how to make
    informative visualizations, be patient and iterate. None of us make the perfect
    plot on the first try, and as we make discoveries in an analysis, we continue
    to refine our plots. Then, when it comes time to present our findings to others,
    we sift through our work to get the few plots that best convince our future reader
    of the correctness and importance of our analysis. This can even lead to the creation
    of a new plot that better conveys our findings, which we iteratively develop.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一章之后，你应该能够创建一个图表，并理解哪些调整能使图表更有效。当你学会如何制作信息丰富的可视化时，请保持耐心并进行迭代。我们没有人能在第一次尝试时做出完美的图表，在分析中我们发现了新的东西时，我们会继续改进我们的图表。然后，在向他人展示我们的发现时，我们会筛选出少数几个最能说服我们未来读者分析正确性和重要性的图表。这甚至可能会导致创建一个更好地传达我们发现的新图表，我们会进行迭代开发。
- en: In the next chapter, we walk through an extended case study that combines everything
    we’ve learned in the book so far. We hope that you find yourself surprised by
    how much you can already do.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将通过一个扩展案例研究来展示我们迄今为止在书中学到的一切。我们希望你会对自己已经能做到的事情感到惊讶。
- en: ^([1](ch11.html#id1365-marker)) US government surveys still collect data based
    on a binary definition of gender, but progress is being made. For example, starting
    in 2022, US citizens are allowed to select an “X” as their gender marker on their
    passport application.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](ch11.html#id1365-marker)) 美国政府调查仍然根据性别的二元定义收集数据，但进展正在取得。例如，从2022年开始，美国公民可以在他们的护照申请中选择“X”作为他们的性别标记。
