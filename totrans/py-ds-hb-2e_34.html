<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 30. Customizing Colorbars" data-type="chapter" epub:type="chapter"><div class="chapter" id="section-0407-customizing-colorbars">
<h1><span class="label">Chapter 30. </span>Customizing Colorbars</h1>
<p><a data-primary="colorbars" data-secondary="customizing" data-type="indexterm" id="ix_ch30-asciidoc0"/><a data-primary="Matplotlib" data-secondary="colorbar customization" data-type="indexterm" id="ix_ch30-asciidoc1"/><a data-primary="plotting" data-secondary="colorbars" data-type="indexterm" id="ix_ch30-asciidoc2"/>Plot legends identify discrete labels of discrete points. For continuous
labels based on the color of points, lines, or regions, a labeled
colorbar can be a great tool. In Matplotlib, a colorbar is drawn as a
separate axes that can provide a key for the meaning of colors in a
plot. Because the book is printed in black and white, this chapter has
an accompanying
<a href="https://oreil.ly/PDSH_GitHub">online supplement</a>
where you can view the figures in full color. We’ll start by
setting up the notebook for plotting and importing the functions we will
use:</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">matplotlib.pyplot</code> <code class="k">as</code> <code class="nn">plt</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">use</code><code class="p">(</code><code class="s1">'seaborn-white'</code><code class="p">)</code></pre>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="o">%</code><code class="k">matplotlib</code> inline
        <code class="kn">import</code> <code class="nn">numpy</code> <code class="k">as</code> <code class="nn">np</code></pre>
<p>As we have seen several times already, the simplest colorbar can be
created with the <code>plt.colorbar</code> function (see <a data-type="xref" href="#fig_0407-customizing-colorbars_files_in_output_5_0">Figure 30-1</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">x</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">linspace</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="mi">1000</code><code class="p">)</code>
        <code class="n">I</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">sin</code><code class="p">(</code><code class="n">x</code><code class="p">)</code> <code class="o">*</code> <code class="n">np</code><code class="o">.</code><code class="n">cos</code><code class="p">(</code><code class="n">x</code><code class="p">[:,</code> <code class="n">np</code><code class="o">.</code><code class="n">newaxis</code><code class="p">])</code>

        <code class="n">plt</code><code class="o">.</code><code class="n">imshow</code><code class="p">(</code><code class="n">I</code><code class="p">)</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">colorbar</code><code class="p">();</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Full-color figures are available in the <a href="https://oreil.ly/PDSH_GitHub">supplemental materials on GitHub</a>.</p>
</div>
<p>We’ll now discuss a few ideas for customizing these
colorbars and using them effectively in various situations.</p>
<figure class="width-60"><div class="figure" id="fig_0407-customizing-colorbars_files_in_output_5_0">
<img alt="output 5 0" height="392" src="assets/output_5_0.png" width="600"/>
<h6><span class="label">Figure 30-1. </span>A simple colorbar legend</h6>
</div></figure>
<section data-pdf-bookmark="Customizing Colorbars" data-type="sect1"><div class="sect1" id="ch_0407-customizing-colorbars_customizing-colorbars">
<h1>Customizing Colorbars</h1>
<p><a data-primary="colorbars" data-secondary="colormap selection" data-type="indexterm" id="ix_ch30-asciidoc3"/><a data-primary="colormap" data-type="indexterm" id="ix_ch30-asciidoc4"/>The colormap can be specified using the <code>cmap</code> argument to the plotting
function that is creating the visualization (see <a data-type="xref" href="#fig_0407-customizing-colorbars_files_in_output_8_0">Figure 30-2</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">plt</code><code class="o">.</code><code class="n">imshow</code><code class="p">(</code><code class="n">I</code><code class="p">,</code> <code class="n">cmap</code><code class="o">=</code><code class="s1">'Blues'</code><code class="p">);</code></pre>
<figure class="width-55"><div class="figure" id="fig_0407-customizing-colorbars_files_in_output_8_0">
<img alt="output 8 0" height="392" src="assets/output_8_0.png" width="600"/>
<h6><span class="label">Figure 30-2. </span>A blue-scale colormap</h6>
</div></figure>
<p>The names of available colormaps are in the <code>plt.cm</code> namespace; using
IPython’s tab completion feature will give you a full list
of built-in possibilities:</p>
<pre>plt.cm.&lt;TAB&gt;</pre>
<p>But being <em>able</em> to choose a colormap is just the first step: more
important is how to <em>decide</em> among the possibilities! The choice turns
out to be much more subtle than you might initially expect.</p>
<section data-pdf-bookmark="Choosing the Colormap" data-type="sect2"><div class="sect2" id="ch_0407-customizing-colorbars_choosing-the-colormap">
<h2>Choosing the Colormap</h2>
<p>A full treatment of color choice within visualizations is beyond the
scope of this book, but for entertaining reading on this subject and
others, see the article
<a href="https://oreil.ly/g4GLV">“Ten
Simple Rules for Better Figures”</a> by Nicholas Rougier, Michael
Droettboom, and Philip Bourne. Matplotlib’s online
documentation also has an
<a href="https://oreil.ly/Ll1ir">interesting
discussion</a> of colormap choice.</p>
<p>Broadly, you should be aware of three different categories of colormaps:</p>
<dl>
<dt><em>Sequential colormaps</em></dt>
<dd>
<p>These are made up of one continuous sequence
of colors (e.g., <code>binary</code> or 
<span class="keep-together"><code>viridis</code></span>).</p>
</dd>
<dt><em>Divergent colormaps</em></dt>
<dd>
<p>These usually contain two distinct colors,
which show positive and negative deviations from a mean (e.g., <code>RdBu</code> or
<code>PuOr</code>).</p>
</dd>
<dt><em>Qualitative colormaps</em></dt>
<dd>
<p>These mix colors with no particular sequence
(e.g., <code>rainbow</code> or <code>jet</code>).</p>
</dd>
</dl>
<p><a data-primary="jet colormap" data-type="indexterm" id="idm45858757586832"/>The <code>jet</code> colormap, which was the default in Matplotlib prior to version
2.0, is an example of a qualitative colormap. Its status as the default
was quite unfortunate, because qualitative maps are often a poor choice
for representing quantitative data. Among the problems is the fact that
qualitative maps usually do not display any uniform progression in
brightness as the scale increases.</p>
<p>We can see this by converting the <code>jet</code> colorbar into black and white
(see <a data-type="xref" href="#fig_0407-customizing-colorbars_files_in_output_12_0">Figure 30-3</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">5</code><code class="p">]:</code> <code class="kn">from</code> <code class="nn">matplotlib.colors</code> <code class="kn">import</code> <code class="n">LinearSegmentedColormap</code>

        <code class="k">def</code> <code class="nf">grayscale_cmap</code><code class="p">(</code><code class="n">cmap</code><code class="p">):</code>
            <code class="sd">"""Return a grayscale version of the given colormap"""</code>
            <code class="n">cmap</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">cm</code><code class="o">.</code><code class="n">get_cmap</code><code class="p">(</code><code class="n">cmap</code><code class="p">)</code>
            <code class="n">colors</code> <code class="o">=</code> <code class="n">cmap</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="n">cmap</code><code class="o">.</code><code class="n">N</code><code class="p">))</code>

            <code class="c1"># Convert RGBA to perceived grayscale luminance</code>
            <code class="c1"># cf. http://alienryderflex.com/hsp.xhtml</code>
            <code class="n">RGB_weight</code> <code class="o">=</code> <code class="p">[</code><code class="mf">0.299</code><code class="p">,</code> <code class="mf">0.587</code><code class="p">,</code> <code class="mf">0.114</code><code class="p">]</code>
            <code class="n">luminance</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">dot</code><code class="p">(</code><code class="n">colors</code><code class="p">[:,</code> <code class="p">:</code><code class="mi">3</code><code class="p">]</code> <code class="o">**</code> <code class="mi">2</code><code class="p">,</code> <code class="n">RGB_weight</code><code class="p">))</code>
            <code class="n">colors</code><code class="p">[:,</code> <code class="p">:</code><code class="mi">3</code><code class="p">]</code> <code class="o">=</code> <code class="n">luminance</code><code class="p">[:,</code> <code class="n">np</code><code class="o">.</code><code class="n">newaxis</code><code class="p">]</code>

            <code class="k">return</code> <code class="n">LinearSegmentedColormap</code><code class="o">.</code><code class="n">from_list</code><code class="p">(</code>
                <code class="n">cmap</code><code class="o">.</code><code class="n">name</code> <code class="o">+</code> <code class="s2">"_gray"</code><code class="p">,</code> <code class="n">colors</code><code class="p">,</code> <code class="n">cmap</code><code class="o">.</code><code class="n">N</code><code class="p">)</code>


        <code class="k">def</code> <code class="nf">view_colormap</code><code class="p">(</code><code class="n">cmap</code><code class="p">):</code>
            <code class="sd">"""Plot a colormap with its grayscale equivalent"""</code>
            <code class="n">cmap</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">cm</code><code class="o">.</code><code class="n">get_cmap</code><code class="p">(</code><code class="n">cmap</code><code class="p">)</code>
            <code class="n">colors</code> <code class="o">=</code> <code class="n">cmap</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="n">cmap</code><code class="o">.</code><code class="n">N</code><code class="p">))</code>

            <code class="n">cmap</code> <code class="o">=</code> <code class="n">grayscale_cmap</code><code class="p">(</code><code class="n">cmap</code><code class="p">)</code>
            <code class="n">grayscale</code> <code class="o">=</code> <code class="n">cmap</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="n">cmap</code><code class="o">.</code><code class="n">N</code><code class="p">))</code>

            <code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">2</code><code class="p">),</code>
                                   <code class="n">subplot_kw</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">xticks</code><code class="o">=</code><code class="p">[],</code> <code class="n">yticks</code><code class="o">=</code><code class="p">[]))</code>
            <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">imshow</code><code class="p">([</code><code class="n">colors</code><code class="p">],</code> <code class="n">extent</code><code class="o">=</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">1</code><code class="p">])</code>
            <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">imshow</code><code class="p">([</code><code class="n">grayscale</code><code class="p">],</code> <code class="n">extent</code><code class="o">=</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">1</code><code class="p">])</code></pre>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">6</code><code class="p">]:</code> <code class="n">view_colormap</code><code class="p">(</code><code class="s1">'jet'</code><code class="p">)</code></pre>
<figure><div class="figure" id="fig_0407-customizing-colorbars_files_in_output_12_0">
<img alt="output 12 0" height="528" src="assets/output_12_0.png" width="600"/>
<h6><span class="label">Figure 30-3. </span>The <code>jet</code> colormap and its uneven luminance scale</h6>
</div></figure>
<p>Notice the bright stripes in the grayscale image. Even in full color,
this uneven brightness means that the eye will be drawn to certain
portions of the color range, which will potentially emphasize
unimportant parts of the dataset. <a data-primary="viridis colormap" data-type="indexterm" id="idm45858757318544"/>It’s better to use a
colormap such as <code>viridis</code> (the default as of Matplotlib 2.0), which is
specifically constructed to have an even brightness variation across the
range; thus, it not only plays well with our color perception, but also
will translate well to grayscale printing (see <a data-type="xref" href="#fig_0407-customizing-colorbars_files_in_output_14_0">Figure 30-4</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">7</code><code class="p">]:</code> <code class="n">view_colormap</code><code class="p">(</code><code class="s1">'viridis'</code><code class="p">)</code></pre>
<figure><div class="figure" id="fig_0407-customizing-colorbars_files_in_output_14_0">
<img alt="output 14 0" height="395" src="assets/output_14_0.png" width="600"/>
<h6><span class="label">Figure 30-4. </span>The viridis colormap and its even luminance scale</h6>
</div></figure>
<p><a data-primary="RdBu colormap" data-type="indexterm" id="idm45858757255408"/>For other situations, such as showing positive and negative deviations
from some mean, dual-color colorbars such as <code>RdBu</code> (<em>Red–Blue</em>) are
helpful. However, as you can see in <a data-type="xref" href="#fig_0407-customizing-colorbars_files_in_output_16_0">Figure 30-5</a>,
it’s important to note that the positive/negative
information will be lost upon translation to grayscale!</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">8</code><code class="p">]:</code> <code class="n">view_colormap</code><code class="p">(</code><code class="s1">'RdBu'</code><code class="p">)</code></pre>
<figure><div class="figure" id="fig_0407-customizing-colorbars_files_in_output_16_0">
<img alt="output 16 0" height="398" src="assets/output_16_0.png" width="600"/>
<h6><span class="label">Figure 30-5. </span>The <code>RdBu</code> colormap and its luminance</h6>
</div></figure>
<p>We’ll see examples of using some of these colormaps as we
continue.</p>
<p>There are a large number of colormaps available in Matplotlib; to see a
list of them, you can use IPython to explore the <code>plt.cm</code> submodule. For
a more principled approach to colors in Python, you can refer to the
tools and documentation within the Seaborn library (see
<a data-type="xref" href="ch36.xhtml#section-0414-visualization-with-seaborn">Chapter 36</a>).</p>
</div></section>
<section data-pdf-bookmark="Color Limits and Extensions" data-type="sect2"><div class="sect2" id="ch_0407-customizing-colorbars_color-limits-and-extensions">
<h2>Color Limits and Extensions</h2>
<p><a data-primary="colorbars" data-secondary="color limits and extensions" data-type="indexterm" id="idm45858757219424"/>Matplotlib allows for a large range of colorbar customization. The
colorbar itself is simply an instance of <code>plt.Axes</code>, so all of the axes
and tick formatting tricks we’ve seen so far are applicable.
The colorbar has some interesting flexibility: for example, we can
narrow the color limits and indicate the out-of-bounds values with a
triangular arrow at the top and bottom by setting the <code>extend</code> property.
This might come in handy, for example, if displaying an image that is
subject to noise (see <a data-type="xref" href="#fig_0407-customizing-colorbars_files_in_output_19_0">Figure 30-6</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">9</code><code class="p">]:</code> <code class="c1"># make noise in 1% of the image pixels</code>
        <code class="n">speckles</code> <code class="o">=</code> <code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">random</code><code class="p">(</code><code class="n">I</code><code class="o">.</code><code class="n">shape</code><code class="p">)</code> <code class="o">&lt;</code> <code class="mf">0.01</code><code class="p">)</code>
        <code class="n">I</code><code class="p">[</code><code class="n">speckles</code><code class="p">]</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">normal</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="n">np</code><code class="o">.</code><code class="n">count_nonzero</code><code class="p">(</code><code class="n">speckles</code><code class="p">))</code>

        <code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mf">3.5</code><code class="p">))</code>

        <code class="n">plt</code><code class="o">.</code><code class="n">subplot</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">imshow</code><code class="p">(</code><code class="n">I</code><code class="p">,</code> <code class="n">cmap</code><code class="o">=</code><code class="s1">'RdBu'</code><code class="p">)</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">colorbar</code><code class="p">()</code>

        <code class="n">plt</code><code class="o">.</code><code class="n">subplot</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">2</code><code class="p">)</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">imshow</code><code class="p">(</code><code class="n">I</code><code class="p">,</code> <code class="n">cmap</code><code class="o">=</code><code class="s1">'RdBu'</code><code class="p">)</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">colorbar</code><code class="p">(</code><code class="n">extend</code><code class="o">=</code><code class="s1">'both'</code><code class="p">)</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">clim</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code></pre>
<figure><div class="figure" id="fig_0407-customizing-colorbars_files_in_output_19_0">
<img alt="output 19 0" height="398" src="assets/output_19_0.png" width="600"/>
<h6><span class="label">Figure 30-6. </span>Specifying colormap extensions<sup><a data-type="noteref" href="ch30.xhtml#idm45858757122240" id="idm45858757122240-marker">1</a></sup></h6>
</div></figure>
<p>Notice that in the left panel, the default color limits respond to the
noisy pixels, and the range of the noise completely washes out the
pattern we are interested in. In the right panel, we manually set the
color limits and add extensions to indicate values that are above or
below those limits. The result is a much more useful visualization of
our data.</p>
</div></section>
<section data-pdf-bookmark="Discrete Colorbars" data-type="sect2"><div class="sect2" id="ch_0407-customizing-colorbars_discrete-colorbars">
<h2>Discrete Colorbars</h2>
<p><a data-primary="colorbars" data-secondary="discrete" data-type="indexterm" id="idm45858757118672"/>Colormaps are by default continuous, but sometimes you’d
like to represent discrete values. The easiest way to do this is to use
the <code>plt.cm.get_cmap</code> function and pass the name of a suitable colormap
along with the number of desired bins (see <a data-type="xref" href="#fig_0407-customizing-colorbars_files_in_output_22_0">Figure 30-7</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">10</code><code class="p">]:</code> <code class="n">plt</code><code class="o">.</code><code class="n">imshow</code><code class="p">(</code><code class="n">I</code><code class="p">,</code> <code class="n">cmap</code><code class="o">=</code><code class="n">plt</code><code class="o">.</code><code class="n">cm</code><code class="o">.</code><code class="n">get_cmap</code><code class="p">(</code><code class="s1">'Blues'</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">colorbar</code><code class="p">(</code><code class="n">extend</code><code class="o">=</code><code class="s1">'both'</code><code class="p">)</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">clim</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">);</code></pre>
<figure><div class="figure" id="fig_0407-customizing-colorbars_files_in_output_22_0">
<img alt="output 22 0" height="398" src="assets/output_22_0.png" width="600"/>
<h6><span class="label">Figure 30-7. </span>A discretized colormap</h6>
</div></figure>
<p>The discrete version of a colormap can be used just like any other
colormap.<a data-startref="ix_ch30-asciidoc4" data-type="indexterm" id="idm45858756963280"/><a data-startref="ix_ch30-asciidoc3" data-type="indexterm" id="idm45858756962576"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Example: Handwritten Digits" data-type="sect1"><div class="sect1" id="ch_0407-customizing-colorbars_example-handwritten-digits">
<h1>Example: Handwritten Digits</h1>
<p><a data-primary="colorbars" data-secondary="handwritten digit example" data-type="indexterm" id="ix_ch30-asciidoc5"/>As an example of where this can be applied, let’s look at an
interesting visualization of some handwritten digits from the digits
dataset, included in Scikit-Learn; it consists of nearly 2,000
<math alttext="8 times 8">
<mrow>
<mn>8</mn>
<mo>×</mo>
<mn>8</mn>
</mrow>
</math> thumbnails showing various handwritten digits.</p>
<p>For now, let’s start by downloading the digits dataset and
visualizing several of the example images with <code>plt.imshow</code> (see <a data-type="xref" href="#fig_0407-customizing-colorbars_files_in_output_25_0">Figure 30-8</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="c1"># load images of the digits 0 through 5 and visualize several of them</code>
         <code class="kn">from</code> <code class="nn">sklearn.datasets</code> <code class="kn">import</code> <code class="n">load_digits</code>
         <code class="n">digits</code> <code class="o">=</code> <code class="n">load_digits</code><code class="p">(</code><code class="n">n_class</code><code class="o">=</code><code class="mi">6</code><code class="p">)</code>

         <code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">8</code><code class="p">,</code> <code class="mi">8</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>
         <code class="k">for</code> <code class="n">i</code><code class="p">,</code> <code class="n">axi</code> <code class="ow">in</code> <code class="nb">enumerate</code><code class="p">(</code><code class="n">ax</code><code class="o">.</code><code class="n">flat</code><code class="p">):</code>
             <code class="n">axi</code><code class="o">.</code><code class="n">imshow</code><code class="p">(</code><code class="n">digits</code><code class="o">.</code><code class="n">images</code><code class="p">[</code><code class="n">i</code><code class="p">],</code> <code class="n">cmap</code><code class="o">=</code><code class="s1">'binary'</code><code class="p">)</code>
             <code class="n">axi</code><code class="o">.</code><code class="n">set</code><code class="p">(</code><code class="n">xticks</code><code class="o">=</code><code class="p">[],</code> <code class="n">yticks</code><code class="o">=</code><code class="p">[])</code></pre>
<figure class="width-90"><div class="figure" id="fig_0407-customizing-colorbars_files_in_output_25_0">
<img alt="output 25 0" height="438" src="assets/output_25_0.png" width="600"/>
<h6><span class="label">Figure 30-8. </span>Sample of handwritten digits data</h6>
</div></figure>
<p>Because each digit is defined by the hue of its 64 pixels, we can
consider each digit to be a point lying in 64-dimensional space: each
dimension represents the brightness of one pixel. <a data-primary="dimensionality reduction" data-type="indexterm" id="idm45858756901440"/><a data-primary="unsupervised learning" data-secondary="dimensionality reduction" data-type="indexterm" id="idm45858756900768"/>Visualizing such
high-dimensional data can be difficult, but one way to approach this
task is to use a <em>dimensionality reduction</em> technique such as manifold
learning to reduce the dimensionality of the data while maintaining the
relationships of interest. Dimensionality reduction is an example of
unsupervised machine learning, and we will discuss it in more detail in
<a data-type="xref" href="ch37.xhtml#section-0501-what-is-machine-learning">Chapter 37</a>.</p>
<p>Deferring the discussion of these details, let’s take a look
at a two-dimensional manifold learning projection of the digits data
(see <a data-type="xref" href="ch46.xhtml#section-0510-manifold-learning">Chapter 46</a> for
details):</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="c1"># project the digits into 2 dimensions using Isomap</code>
         <code class="kn">from</code> <code class="nn">sklearn.manifold</code> <code class="kn">import</code> <code class="n">Isomap</code>
         <code class="n">iso</code> <code class="o">=</code> <code class="n">Isomap</code><code class="p">(</code><code class="n">n_components</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code> <code class="n">n_neighbors</code><code class="o">=</code><code class="mi">15</code><code class="p">)</code>
         <code class="n">projection</code> <code class="o">=</code> <code class="n">iso</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">digits</code><code class="o">.</code><code class="n">data</code><code class="p">)</code></pre>
<p>We’ll use our discrete colormap to view the results, setting
the <code>ticks</code> and <code>clim</code> to improve the aesthetics of the resulting
colorbar (see <a data-type="xref" href="#fig_0407-customizing-colorbars_files_in_output_29_0">Figure 30-9</a>).</p>
<pre data-code-language="ipython" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">13</code><code class="p">]:</code> <code class="c1"># plot the results</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">scatter</code><code class="p">(</code><code class="n">projection</code><code class="p">[:,</code> <code class="mi">0</code><code class="p">],</code> <code class="n">projection</code><code class="p">[:,</code> <code class="mi">1</code><code class="p">],</code> <code class="n">lw</code><code class="o">=</code><code class="mf">0.1</code><code class="p">,</code>
                     <code class="n">c</code><code class="o">=</code><code class="n">digits</code><code class="o">.</code><code class="n">target</code><code class="p">,</code> <code class="n">cmap</code><code class="o">=</code><code class="n">plt</code><code class="o">.</code><code class="n">cm</code><code class="o">.</code><code class="n">get_cmap</code><code class="p">(</code><code class="s1">'plasma'</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">colorbar</code><code class="p">(</code><code class="n">ticks</code><code class="o">=</code><code class="nb">range</code><code class="p">(</code><code class="mi">6</code><code class="p">),</code> <code class="n">label</code><code class="o">=</code><code class="s1">'digit value'</code><code class="p">)</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">clim</code><code class="p">(</code><code class="o">-</code><code class="mf">0.5</code><code class="p">,</code> <code class="mf">5.5</code><code class="p">)</code></pre>
<figure><div class="figure" id="fig_0407-customizing-colorbars_files_in_output_29_0">
<img alt="output 29 0" height="565" src="assets/output_29_0.png" width="600"/>
<h6><span class="label">Figure 30-9. </span>Manifold embedding of handwritten digit pixels</h6>
</div></figure>
<p>The projection also gives us some insights on the relationships within
the dataset: for example, the ranges of 2 and 3 nearly overlap in this
projection, indicating that some handwritten 2s and 3s are difficult to
distinguish, and may be more likely to be confused by an automated
classification algorithm. Other values, like 0 and 1, are more distantly
separated, and may be less likely to be confused<a data-startref="ix_ch30-asciidoc5" data-type="indexterm" id="idm45858756725744"/>.<a data-startref="ix_ch30-asciidoc2" data-type="indexterm" id="idm45858756724912"/><a data-startref="ix_ch30-asciidoc1" data-type="indexterm" id="idm45858756724208"/><a data-startref="ix_ch30-asciidoc0" data-type="indexterm" id="idm45858756723536"/></p>
<p>We’ll return to manifold learning and digit classification
in <a data-type="xref" href="part05.xhtml#section-0500-machine-learning">Part V</a>.</p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45858757122240"><sup><a href="ch30.xhtml#idm45858757122240-marker">1</a></sup> A full-size version of this figure can be found on <a href="https://oreil.ly/PDSH_GitHub">GitHub</a>.</p></div></div></section></div></body></html>