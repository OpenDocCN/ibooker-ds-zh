<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 4. Geospatial Analytics in the Cloud: Google Earth Engine and Other Tools" data-type="chapter" epub:type="chapter"><div class="chapter" id="geospatial_analytics_in_the_cloud_googl">
<h1><span class="label">Chapter 4. </span>Geospatial Analytics in the Cloud: <span class="keep-together">Google Earth Engine and Other Tools</span></h1>
<p>How do you access geospatial data? <a contenteditable="false" data-primary="cloud, geospatial analytics in" data-type="indexterm" id="ix_cld"/>Although data professionals with enterprise accounts may not think about the limitations of personal computing and relying on open source data, the rest of us often work within limits. Geospatial analysis in the cloud has narrowed the divide, since that means we no longer need to store large volumes of data locally. Never before has the general public had open source access to geospatial data on such a global scale. This chapter will show you where to find data for exploration and learning.</p>
<p>Space programs in the US and around the world have gathered data from satellites and sensors for decades, but only recently have we had the capacity to manipulate that data in real time for analysis.<a contenteditable="false" data-primary="EarthExplorer" data-type="indexterm" id="idm45433743060720"/><a contenteditable="false" data-primary="USGS Landsat maps" data-type="indexterm" id="idm45433741825520"/><a contenteditable="false" data-primary="Landsat" data-type="indexterm" id="idm45433742559872"/> The USGS hosts <a href="https://oreil.ly/OnxdN">EarthExplorer</a> (Landsat), and the <a href="https://oreil.ly/gnY7c">Copernicus Open Access Hub</a> provides data from European Space Agency (ESA) Sentinel satellites. <a contenteditable="false" data-primary="Copernicus Open Access Hub (European Space Agency)" data-type="indexterm" id="idm45433741781600"/><a contenteditable="false" data-primary="European Space Agency (ESA), Copernicus Open Access Hub" data-type="indexterm" id="idm45433741780592"/>Landsat high-resolution satellite images enable us to evaluate and measure environmental change, understand the impact of climate science and agricultural practices, and respond to natural disasters across time and space, to name a few examples. The advent of free satellite images has enabled decision makers from economically challenged areas across the world to bring insights into view and focus on solutions.</p>
<p><em>Spatial analysis</em> includes methods and tools applied to location data, in which the results vary based on the location or frame analyzing the object.<a contenteditable="false" data-primary="spatial analysis" data-type="indexterm" id="idm45433741779520"/> It is essentially “location-specific” analysis. This can be as simple as locating the nearest subway station or asking how many green spaces or parks are in a community, or as complex as revealing patterns in transportation accessibility or health outcomes. <em>Spatial algorithms</em> are a method of solving a problem by listing and executing sequential instructions integrated with geographic properties, used for analysis, modeling, and prediction.<a contenteditable="false" data-primary="spatial algorithms" data-type="indexterm" id="idm45433741849808"/></p>
<p>GIS solve spatial problems that rely on location information like latitude, longitude, and projection. <a contenteditable="false" data-primary="GIS" data-type="indexterm" id="idm45433742218208"/>Spatial information answers “where” questions: where on the Earth’s surface did something occur?</p>
<p>Imagine, for example, stepping out of your hotel on 41st and Madison Avenue in Manhattan. You search in your mapping app for where you might purchase a coat, since the weather is dramatically colder than you anticipated. Instantly, the locations of apparel stores populate your screen.</p>
<p>Or on the marketing side, say you work for an outdoor provision company, producing top-of-the-line outerwear for the discerning customer. You could use geospatial information to answer questions like: Where do your potential customers live, visit, or travel? Would a potential retail location nearby be a profitable marketing decision? How far would potential customers travel? What is the mean income within each of the locations you are considering? These <em>where</em> components exist in retail and commercial environments, the military, climate science, and health care, to name a few examples.</p>
<p>Attributes are another<a contenteditable="false" data-primary="attributes" data-secondary="spatial" data-type="indexterm" id="idm45433742073568"/> important component of spatially referenced data. <em>Spatial attributes</em> are <a contenteditable="false" data-primary="spatial attributes" data-type="indexterm" id="idm45433742072928"/>bounded in space; these could include a community boundary or infrastructure, such as a roadway or metro station, usually represented by a polygon. Spatially referenced data can also have nonspatial attributes, such as the income of residents in a certain location, and can provide context for the location intelligence.</p>
<p>The <em>I</em> in GIS is increasingly being stored in the cloud. <a contenteditable="false" data-primary="GIS" data-secondary="cloud storage of data" data-type="indexterm" id="idm45433742071424"/>Today your laptop can access petabytes of information made available by geospatial analytics processing services in the cloud. <a contenteditable="false" data-primary="GEE" data-see="Google Earth Engine" data-type="indexterm" id="idm45433742072544"/><a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-type="indexterm" id="idm45433741768880"/>This chapter will explore one of those services: <a href="https://oreil.ly/ukyb0">Google Earth Engine (GEE)</a>.</p>
<p>In 2007, Jim Gray, a computer scientist at Microsoft until he was lost at sea later that year, was quite prescient when he said: “For data analysis, one possibility is to move the data to you, but the other possibility is to move your query to the data. You can either move your questions or the data. Often it turns out to be more efficient to move the questions than to move the data.” That’s the basic principle behind doing geospatial analytics in the cloud.</p>
<p>In this chapter, you’ll use GEE to perform a variety of tasks associated with geographic properties in spatial environments. We’ll also take a quick look at another tool that integrates with Python: Leafmap. By the end of the chapter, you’ll have enough familiarity with these interfaces to follow along with later chapters and eventually launch your own independent project.</p>
<section data-pdf-bookmark="Google Earth Engine Setup" data-type="sect1"><div class="sect1" id="google_earth_engine_setup">
<h1>Google Earth Engine Setup</h1>
<p>But first, you’ll need to create your work environments.<a contenteditable="false" data-primary="Jupyter Notebooks" data-type="indexterm" id="idm45433742416864"/><a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="setup" data-type="indexterm" id="idm45433742415696"/> The Jupyter Notebooks for this chapter are available on <a href="https://oreil.ly/SbS0R">GitHub</a>. You can open them up and follow along or experiment with the code and explore separately when time permits. The instructions for installing the necessary packages and resources will be covered as well.</p>
<p>The GEE archive contains more than 60 <em>petabytes</em> of satellite imagery and remote sensing and geospatial data—all freely available, preprocessed, and easy to access. Imagine trying to download all that to your laptop! GEE’s algorithms allow the public to create interactive applications or data products in the cloud. You just need to apply for a free <a href="https://oreil.ly/xVOCN">Google Earth Engine account</a> (which comes with 250 gigabytes of storage) and authenticate within either the terminal or notebook when you are granted access. Follow these steps:</p>
<pre data-type="programlisting">
To authorize access needed by Earth Engine, open the following URL 
<strong>in</strong> a web browser <strong>and</strong> follow the instructions:
https://accounts.google.com/o/oauth2/auth?client_id=xxx
The authorization workflow will generate a code, which you should paste 
<strong>in</strong> the box below
Enter verification code: code will be here

Successfully saved authorization token.</pre>
<p>GEE will send you a unique link and verification code. Paste the code into the box and hit Enter.</p>
</div></section>
<section data-pdf-bookmark="Using the GEE Console and geemap" data-type="sect1"><div class="sect1" id="using_the_gee_console_and_geemap">
<h1>Using the GEE Console and geemap</h1>
<p>The GEE console is a quick resource for locating images and running the code. But Python isn’t GEE’s native language: the GEE code editor is designed for writing and executing scripts in JavaScript.<a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="using GEE console and geemap" data-type="indexterm" id="ix_cldGEEconmap"/><a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="using GEE console and geemap" data-type="indexterm" id="ix_GEEconmap"/><a contenteditable="false" data-primary="JavaScript in Google Earth Engine" data-type="indexterm" id="idm45433741752032"/> Its Javascript API has a robust IDE, extensive documentation, and interactive visualization functionality, and none of that is natively available for Python. <a contenteditable="false" data-primary="geemap package (Python)" data-type="indexterm" id="idm45433741743184"/>To access the full spectrum of interactivity in a Python environment, you will need to use <a href="https://geemap.org">geemap</a>, a Python package for interacting with GEE created by <a href="https://oreil.ly/bGQq1">Dr. Qiusheng Wu</a>.</p>
<p>Fortunately, you can use the extensive GEE catalog to locate and visualize data with a single click, with limited or no JavaScript expertise. You can find your way around the interface and generate maps simply by scrolling through the Scripts tab. Each code script allows you to run JavaScript code and generate maps. But if you’re seeking autonomy to build your own maps and engage interactively, you’ll want to use geemap.<a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="using GEE console and geemap" data-tertiary="GEE catalog" data-type="indexterm" id="idm45433741740960"/> The GEE catalog (pictured in <a data-type="xref" href="#the_gee_console">Figure 4-1</a>) contains useful information you will need when deciding how to interact with data in geemap.</p>
<figure><div class="figure" id="the_gee_console"><img alt="The GEE console" height="1476" src="assets/pgda_0401.png" width="1454"/>
<h6><span class="label">Figure 4-1. </span>The GEE catalog</h6>
</div></figure>
<p>Look through the Earth Engine Data Catalog, find a dataset <a href="https://oreil.ly/yAow0">collection</a>, and scroll down the page.<a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="using GEE console and geemap" data-tertiary="pasting JavaScript code into GEE console" data-type="indexterm" id="idm45433741728880"/> At the bottom, you will notice that the JavaScript code is provided. Simply copy and paste it into the console, as shown in <a data-type="xref" href="#google_earth_engine_ide">Figure 4-2</a>.</p>
<p><a data-type="xref" href="#google_earth_engine_ide">Figure 4-2</a> shows what is generated when you paste the code into the console and select Run from the list of options in the center panel. For example, the data from <a data-type="xref" href="#the_gee_console">Figure 4-1</a> generates USGS Landsat 8 Level 2, Collection 2, Tier 1, identified as <code>ee.ImageCollection("LANDSAT/LC08/C02/T1_L2")</code>.</p>
<figure><div class="figure" id="google_earth_engine_ide"><img alt="Google Earth Engine IDE" height="1942" src="assets/pgda_0402.png" width="3360"/>
<h6><span class="label">Figure 4-2. </span>Google Earth Engine IDE</h6>
</div></figure>
<p>Let’s learn how to generate GEE images using Python scripts in a Jupyter Notebook. geemap even has a tool that will convert JavaScript code to Python right in your Jupyter Notebook.<a contenteditable="false" data-primary="Python" data-secondary="generating GEE images using Python scripts in Jupyter Notebook" data-type="indexterm" id="idm45433741987872"/><a contenteditable="false" data-primary="Jupyter Notebooks" data-secondary="using Python scripts in" data-type="indexterm" id="idm45433741797904"/></p>
<p>Jupyter Notebook is a separate entity from your Python environments. It was originally named for its ability to to interact with three different coding languages, Julia, Python, and R, but it has expanded well beyond its original capabilities. You have to tell the system which version of Python you want. The <em>kernel</em> is how the Notebook and Python communicate.</p>
<p>Installing geemap will create a console in a Notebook environment similar to what you see in the GEE console but with the Python API instead of JavaScript. Once you set up a Conda environment, you will be able to interact with GEE within a Jupyter Notebook. First, you will need to download the required packages and libraries.</p>
<section data-pdf-bookmark="Creating a Conda Environment" data-type="sect2"><div class="sect2" id="creating_a_conda_environment">
<h2>Creating a Conda Environment</h2>
<p><a href="https://www.anaconda.com">Anaconda</a> is a popular platform-agnostic distribution manager for Python and other programming languages that installs and manages Conda packages.<a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="using GEE console and geemap" data-tertiary="creating a Conda environment" data-type="indexterm" id="idm45433741770144"/><a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="using GEE console and geemap" data-tertiary="creating a Conda environment" data-type="indexterm" id="idm45433741715440"/><a contenteditable="false" data-primary="Anaconda (distribution manager)" data-type="indexterm" id="idm45433741713984"/><a contenteditable="false" data-primary="Conda environment, creating" data-type="indexterm" id="idm45433741713008"/> You could think of Anaconda as storage for all of your data science tools. Conda manages your packages and tools, allowing you to upload new tools as needed and to customize your work environment.</p>
<p>Conda packages are stored in the Anaconda repository or the cloud, so you don’t need additional tools for installation. Conda allows you to make as many <span class="keep-together">environments</span> as you need with your preferred version of Python.<a contenteditable="false" data-primary="Miniconda" data-type="indexterm" id="idm45433741724048"/> You also have the option of downloading a leaner version of Anaconda called <a href="https://oreil.ly/nh0LE">Miniconda</a>, which I prefer, regardless of your operating system. Both are straightforward installations. I recommend the Miniconda installation instructions in <a href="https://oreil.ly/nPTlh">this tutorial by Ted Petrou</a>.</p>
</div></section>
<section data-pdf-bookmark="Opening the Jupyter Notebook" data-type="sect2"><div class="sect2" id="opening_the_jupyter_notebook">
<h2>Opening the Jupyter Notebook</h2>
<p>Jupyter Notebooks are open source, interactive, web-based tools. <a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="using GEE console and geemap" data-tertiary="opening Jupyter Notebook" data-type="indexterm" id="idm45433741705760"/><a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="using GEE console and geemap" data-tertiary="opening Jupyter Notebook" data-type="indexterm" id="idm45433741702800"/><a contenteditable="false" data-primary="Jupyter Notebooks" data-secondary="accessing and opening" data-type="indexterm" id="idm45433741701248"/>They run in your browser and don’t require any additional downloads. You can access the Jupyter Notebook for this chapter on <a href="https://oreil.ly/SbS0R">GitHub</a>: the filename is <em>4 Geospatial Analytics in the Cloud</em>. You can find and configure the installed <em>nbextensions</em> in the file menu of your Notebook. <a contenteditable="false" data-primary="nbextensions (Jupyter Notebook)" data-type="indexterm" id="idm45433741698336"/>These are handy plug-ins that add more functionality to your Jupyter Notebook environment.</p>
</div></section>
<section data-pdf-bookmark="Installing geemap and Other Packages" data-type="sect2"><div class="sect2" id="installing_geemap_and_other_packages">
<h2>Installing geemap and Other Packages</h2>
<p>Once you’ve installed your Conda environment, you can open your terminal or command prompt to install geemap. <a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="using GEE console and geemap" data-tertiary="installing geemap and other packages" data-type="indexterm" id="ix_GEEconmapinsgeemp"/><a contenteditable="false" data-primary="geemap package (Python)" data-secondary="installing geemap and other packages" data-type="indexterm" id="ix_geempinstl"/><a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="using GEE console and geemap" data-tertiary="installing geemap and other packages" data-type="indexterm" id="ix_cldGEEconmapinstl"/>Execute the following code line by line to activate your work environment. Here, I’ve named my geospatial environment <code>gee</code>:</p>
<pre data-type="programlisting">
conda create -n gee python=<span>3.9</span>
conda activate gee
conda install geemap -c conda-forge
conda install cartopy -c conda-forge
conda install jupyter_contrib_nbextensions -c conda-forge
jupyter contrib nbextension install --user</pre>
<p>Notice that I specified the version of Python to include in the environment.<a contenteditable="false" data-primary="Python" data-secondary="specifying version for geospatial environment" data-type="indexterm" id="idm45433741685536"/> I’ve done this because there are still some dependencies that aren’t ready for the latest version of Python. That is one important reason why environments are useful: you will receive a warning if there are compatibility conflicts, and you can create an environment using the version that will avoid those conflicts. </p>
<p>This install also includes Cartopy, a Python <a contenteditable="false" data-primary="Cartopy package (Python)" data-type="indexterm" id="idm45433741984464"/>package for geospatial data processing; <code>jupyter_contrib_nbextensions</code>, a package for expanded functionality; and <code>contrib_nbextensions</code>, which will add styles to the Jupyter configuration.</p>
<p>Now that you’ve installed the packages into your environment, whenever you open a new session, you will only need to run <code>import geemap</code> in a code cell. The environment is now visible when you activate, shown here as <code>(gee)</code>:</p>
<pre data-type="programlisting">
(gee) M<span>acBook-Pro<span>-8</span>:~ bonnymcclain$ conda list</span></pre>
<p>This environment will contain all of the associated packages as well as their dependencies. You can create different environments (abbreviated as <code>env</code>) that include the dependencies and packages unique to each project.</p>
<p>The <code>conda list</code> command will show you which packages are installed in the active environment. This following is a snippet of what loads for me when I execute the command:</p>
<pre data-type="programlisting">
# packages in environment at /Users/bonnymcclain/opt/miniconda3/envs/geo:
#
# Name                         Version                 Build    Channel
aiohttp                        3.7.4          py38h96a0964_0    conda-forge
anyio                          3.1.0          py38h50d1736_0    conda-forge
appnope                        0.1.2          py38h50d1736_1    conda-forge
argon2-cffi                    20.1.0         py38h5406a74_2    conda-forge
async-timeout                  3.0.1                 py_1000    conda-forge
async_generator                1.10                     py_0    conda-forge
attrs                          21.2.0           pyhd8ed1ab_0    conda-forge
backcall                       0.2.0            pyh9f0ad1d_0    conda-forge
backports                      1.0                      py_2    conda-forge
backports.functools_lru_cache  1.6.4            pyhd8ed1ab_0    conda-forge
beautifulsoup4                 4.9.3            pyhb0f4dca_0    conda-forge
bleach                         3.3.0            pyh44b312d_0    conda-forge
bqplot                         0.12.27          pyhd8ed1ab_0    conda-forge
branca                         0.4.2            pyhd8ed1ab_0    conda-forge
brotlipy                       0.7.0       py38h5406a74_1001    conda-forge
bzip2                          1.0.8              h0d85af4_4    conda-forge
c-ares                         1.17.1             h0d85af4_1    conda-forge
ca-certificates                2020.12.5          h033912b_0    conda-forge
cachetools                     4.2.2            pyhd8ed1ab_0    conda-forge
cartopy                        0.19.0.post1   py38h4be4431_0    conda-forge
certifi                        2020.12.5      py38h50d1736_1    conda-forge
cffi                           1.14.5         py38ha97d567_0    conda-forge
chardet                        4.0.0          py38h50d1736_1    conda-forge
click                          8.0.1          py38h50d1736_0    conda-forge
colour                         0.1.5                    py_0    conda-forge
geemap                         0.8.16           pyhd8ed1ab_0    conda-forge
<strong>...</strong></pre>
<p>This is helpful in case your code throws an error due to a missing dependency. Run <code>conda list</code>; you should see the versions listed as well. Running <code>conda env list</code> will display any environments you already have installed.</p>
<p>I install <a contenteditable="false" data-primary="kernel" data-secondary="installing for geospatial environment" data-type="indexterm" id="idm45433741718128"/>a kernel (a part of the operating system running in your environment) for each environment that I activate:</p>
<pre data-type="programlisting">
conda install ipykernel</pre>
<p>Now you can add the kernel to your environment—in this case, <code><em>&lt;your environment name&gt;</em></code> is <code>gee</code>:</p>
<pre data-type="programlisting">
python -m ipykernel install --user --name myenv --display-name 
<span>"&lt;your environment name&gt;"</span></pre>
<p>Your local computer has to access files. The <code>import</code> statement will add the package as a Python <em>object</em> (that is, a collection of data and methods) into the currently running instance of the program.<a contenteditable="false" data-primary="import statement" data-type="indexterm" id="idm45433741666080"/></p>
<p>Open your Terminal and write <code><strong>jupyter notebook</strong></code> into the console. A Notebook should open in your browser. You will need to import the required libraries into the Notebook. <a contenteditable="false" data-primary="Jupyter Notebooks" data-secondary="importing required libraries" data-type="indexterm" id="idm45433741664592"/>You can see them listed in the code shell.<a contenteditable="false" data-primary="os library" data-type="indexterm" id="idm45433741662976"/><a contenteditable="false" data-primary="operating system, accessing when running Python" data-type="indexterm" id="idm45433741662000"/> Recall that <code>os</code> allows you to access the operating system where you are running Python, <code>ee</code> is the Earth Engine <a contenteditable="false" data-primary="ee (Earth Engine) library" data-type="indexterm" id="idm45433741675184"/>library, and <code>geemap</code> allows you to interface via Python. You’ll import these libraries using the <code>import</code> function:</p>
<pre data-type="programlisting">
import os
import ee
import geemap
#geemap.update_package()</pre>
<p>The central component of a computer operating system is the <em>kernel</em>. The kernel is specific to each programming language, and the default kernel depends on what version of Python you are running in your Notebook.<a contenteditable="false" data-primary="kernel" data-secondary="restarting after update" data-type="indexterm" id="idm45433741656752"/></p>
<p>You will need to restart the kernel for the update to take effect. Select Kernel from the menu and scroll to the option to rerun. You are now ready to begin working in the Notebook.</p>
<p>Note the hash symbol (#) in the last line of the previous code block.<a contenteditable="false" data-primary="comments (Python)" data-type="indexterm" id="idm45433741987488"/> In Python code, the hash symbol denotes a <em>comment</em>, or a line of the code that won’t run. When you want to run that line of code, delete the hash symbol. To make sure you are using an updated geemap package, <em>uncomment</em> that last line (that is, remove the # in the last row) before running the code. Once you update geemap, you can once again insert the hash, since you won’t need to update the package every time you run the code. You may also add commented text to include any clarifying details. You will see this practice in many of the code blocks in this book.<a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="using GEE console and geemap" data-startref="ix_GEEconmapinsgeemp" data-tertiary="installing geemap and other packages" data-type="indexterm" id="idm45433741986320"/><a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="using GEE console and geemap" data-startref="ix_cldGEEconmapinstl" data-tertiary="installing geemap and other packages" data-type="indexterm" id="idm45433742632464"/><a contenteditable="false" data-primary="geemap package (Python)" data-secondary="installing geemap and other packages" data-startref="ix_geempinstl" data-type="indexterm" id="idm45433741647056"/><a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="using GEE console and geemap" data-startref="ix_cldGEEconmap" data-type="indexterm" id="idm45433741645472"/><a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="using GEE console and geemap" data-startref="ix_GEEconmap" data-type="indexterm" id="idm45433741643888"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Navigating geemap" data-type="sect1"><div class="sect1" id="navigating_geemap">
<h1>Navigating geemap</h1>
<p>I mentioned objects earlier.<a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="navigating geemap" data-type="indexterm" id="ix_cldnavgee"/> Python focuses on objects, instead of what you may be familiar with as <em>functions</em> in other programming languages, so it’s known as an <em>object-oriented</em> programming language.<a contenteditable="false" data-primary="object-oriented programming languages" data-type="indexterm" id="idm45433741636928"/><a contenteditable="false" data-primary="geemap package (Python)" data-secondary="navigating" data-type="indexterm" id="ix_geempnav"/></p>
<p>You may recall from earlier chapters that a <em>class</em> is like a blueprint of a building<a contenteditable="false" data-primary="classes" data-secondary="Python" data-type="indexterm" id="idm45433741633136"/>  The building is the object, but many buildings can be built from a set of blueprints, right? The object in a specific line of code is an <em>instance</em> of the class much in the same way that a building is an <em>instance</em> of those blueprints.<a contenteditable="false" data-primary="instances (class)" data-type="indexterm" id="idm45433741656512"/><a contenteditable="false" data-primary="instantiation" data-type="indexterm" id="idm45433741629680"/><a contenteditable="false" data-primary="objects" data-secondary="creating" data-type="indexterm" id="idm45433741628576"/> Creating the object is called <em>instantiation</em>.</p>
<p>The next code block is declaring an object instance, which I’m calling <code>m</code><code>ap</code>, and defining the attributes and methods in <code>geemap.Map()</code>. You can set your variable to anything you would like, but be consistent. I suggest keeping it simple but informative and practical. You’ll access the attributes of objects using the object name <code>map</code>. geemap defaults to a world map (as of this writing). If you prefer to center your map in a specific place, you can indicate where using latitude/longitude (lat/lon) coordinates and a zoom level. <a contenteditable="false" data-primary="zoom levels" data-secondary="in geemap" data-secondary-sortas="geemap" data-type="indexterm" id="idm45433743036608"/>The following will center your map on the US:</p>
<pre data-type="programlisting">
map = geemap.Map(center=(<span>40</span>, <span>-100</span>), zoom=<span>4</span>)
map</pre>
<section data-pdf-bookmark="Layers and Tools" data-type="sect2"><div class="sect2" id="layers_and_tools">
<h2>Layers and Tools</h2>
<p><a data-type="xref" href="#the_layers_and_tools_menu">Figure 4-3</a> shows the Layers and Tools menu on the far right of the map. <a contenteditable="false" data-primary="geemap package (Python)" data-secondary="navigating" data-tertiary="Layers and Tools" data-type="indexterm" id="ix_geempnavLayToo"/><a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="navigating geemap" data-tertiary="Layers and Tools" data-type="indexterm" id="ix_cldnavgeeLayToo"/><a contenteditable="false" data-primary="layers" data-secondary="Layers and Tools menu in geemap" data-type="indexterm" id="ix_layrgeemp"/><a contenteditable="false" data-primary="Tools menu in geemap" data-type="indexterm" id="ix_toolgeemp"/>Each layer of a map is actually its own database that holds collections of geographic data. These might include roads, buildings, streams, or lakes, all represented as collections of points, lines, and/or polygons in vector data or imagery represented from raster data. The Layers icon will show you the different layers in your map. You can change their opacity, toggle layers on and off, and examine other attributes. Enter the following code to render a map in your notebook:</p>
<pre data-type="programlisting">
<span>map = geemap.Map(center =(40, -100), zoom=4)</span>
map.basemap()
map</pre>
<figure><div class="figure" id="the_layers_and_tools_menu"><img alt="The Layers and Tools menu" height="518" src="assets/pgda_0403.png" width="822"/>
<h6><span class="label">Figure 4-3. </span>The Layers and Tools menu</h6>
</div></figure>
<p>Click the different options to see how they customize the map.</p>
<p>The globe icon (on the far left in <a data-type="xref" href="#searching_location_data_using_gee_asset">Figure 4-4</a>) is the search location/data function. This is where you can find data to load onto your map by entering a name and address or a set of lat/lon coordinates or by searching and importing data. We will explore more of these options as we build a few map layers, and I’ll show you some shortcuts to help you navigate the mapping canvas.</p>
<figure><div class="figure" id="searching_location_data_using_gee_asset"><img alt="Searching location data using GEE asset ID (Landsat/LC08/C01) in the import window" height="348" src="assets/pgda_0404.png" width="1024"/>
<h6><span class="label">Figure 4-4. </span>Searching location data using GEE asset ID (Landsat/LC08/C01) in the import window</h6>
</div></figure>
<p>You can access USGS Landsat maps by entering the search parameters in geemap. Select “data” and enter a few terms into the search bar. <a contenteditable="false" data-primary="Landsat" data-secondary="accessing maps in geemaps" data-type="indexterm" id="idm45433741631392"/><a contenteditable="false" data-primary="USGS Landsat maps" data-secondary="accessing with geemap" data-type="indexterm" id="idm45433741599488"/>Again, exploring GEE may help to identify maps of interest. You can call them to your own project here by name. Once you select a Landsat collection and select the asset ID, click the import button (seen in blue in <a data-type="xref" href="#searching_location_data_using_gee_asset">Figure 4-4</a>).</p>
<p>To see available arguments and additional customization options, place your cursor within the parentheses of <code>geemap.Map()</code> and hit Shift + Tab. The text below the map in <a data-type="xref" href="#a_basemap_in_gee_with_docstring">Figure 4-5</a> should now be visible. Here you can read information about available arguments and additional steps for further customization of the map.<a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="using GEE console and geemap" data-tertiary="basemap in GEE with docstring" data-type="indexterm" id="idm45433742824800"/></p>
<figure><div class="figure" id="a_basemap_in_gee_with_docstring"><img alt="A basemap in GEE with docstring" height="838" src="assets/pgda_0405.png" width="1211"/>
<h6><span class="label">Figure 4-5. </span>A basemap in GEE with docstring</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Basemaps" data-type="sect2"><div class="sect2" id="basemaps">
<h2>Basemaps</h2>
<p>Revisit <a data-type="xref" href="#the_layers_and_tools_menu">Figure 4-3</a> for a moment, and look on the far right for a dropdown menu. <a contenteditable="false" data-primary="Tools menu in geemap" data-startref="ix_toolgeemp" data-type="indexterm" id="idm45433741587664"/><a contenteditable="false" data-primary="layers" data-secondary="Layers and Tools menu in geemap" data-startref="ix_layrgeemp" data-type="indexterm" id="idm45433741586192"/><a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="navigating geemap" data-startref="ix_cldnavgeeLayToo" data-tertiary="Layers and Tools" data-type="indexterm" id="idm45433741584576"/><a contenteditable="false" data-primary="geemap package (Python)" data-secondary="navigating" data-startref="ix_geempnavLayToo" data-tertiary="Layers and Tools" data-type="indexterm" id="idm45433741582688"/><a contenteditable="false" data-primary="basemaps" data-secondary="in geemaps package" data-secondary-sortas="geemaps" data-type="indexterm" id="idm45433741580768"/><a contenteditable="false" data-primary="geemap package (Python)" data-secondary="navigating" data-tertiary="basemaps" data-type="indexterm" id="idm45433741579120"/><a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="navigating geemap" data-tertiary="basemaps" data-type="indexterm" id="idm45433741577472"/>This menu contains a dictionary of available <em>basemaps</em>: basic maps that serve as the foundation for your data exploration. The Jupyter Notebook lets you scroll through available basemaps without writing code.</p>
<p>Depending on your data question or the nature of the data, you may want to show different geospatial information. For example, if you are interested in showing <em>hydrography</em> (the physical characteristics and navigability of bodies of water), you likely won’t select a basemap that depicts major roadways and highways. Basemaps are stored as raster or vector tiles for expediency and performance.<a contenteditable="false" data-primary="TileLayer" data-type="indexterm" id="idm45433741575136"/> The basemap dictionary interacts with a <em>TileLayer</em>, allowing connections with map services such as NASA’s <a href="https://oreil.ly/AOwFm">Global Imagery Browse Services (GIBS)</a> and <a href="https://oreil.ly/1Ti4J">OpenStreetMap</a>.</p>
<p>The geemap package <a contenteditable="false" data-primary=" ipyleaflet library" data-type="indexterm" id="idm45433741651168"/>brings all the analytic functionality of GEE into <em>ipyleaflet,</em> an interactive library that brings mapping into your notebook, allowing the dynamic updates you see in the maps as you update locations and zoom levels. The default map in geemap is the Google Maps global view. You’re going to use OSM as your basemap next, so run:</p>
<pre data-type="programlisting">
add_google_map = False</pre>
<p>Advanced users have the option of creating their own TileLayer, but a variety of other default basemaps are freely available in the <a href="https://oreil.ly/HJJbT">ipyleaflet map and basemaps</a> resource.</p>
<p>Now that you know how to load a map into your Notebook, let’s get brave and start experimenting. The goal is for you to get curious and feel comfortable navigating the Jupyter Notebook and selecting different tools.<a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="navigating geemap" data-startref="ix_cldnavgee" data-type="indexterm" id="idm45433742299760"/><a contenteditable="false" data-primary="geemap package (Python)" data-secondary="navigating" data-startref="ix_geempnav" data-type="indexterm" id="idm45433741575696"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Exploring the Landsat 9 Image Collection" data-type="sect1"><div class="sect1" id="exploring_the_landsat_nine_image_collec">
<h1>Exploring the Landsat 9 Image Collection</h1>
<p>We have been working <a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="exploring Landsat 9 image collection" data-type="indexterm" id="ix_cldLndst9"/>with <a contenteditable="false" data-primary="Jupyter Notebooks" data-secondary="exploring Landsat 9 image collection" data-type="indexterm" id="ix_JpyNbkLndimg"/>Landsat data, so let’s look at the <a contenteditable="false" data-primary="Landsat" data-secondary="exploring Landsat 9 image collection" data-type="indexterm" id="ix_Lndsat"/>Landsat 9 data, which was first released in early 2022 and still rolling out as of this writing. To see how much of the dataset is available, run the following code:</p>
<pre data-type="programlisting">
collection = ee.ImageCollection('LANDSAT/LC09/C02/T1_L2')
print(collection.size().getInfo())</pre>
<p>This outputs: <code>106919</code>.</p>
<p>The collection includes 106,919 images—and is still increasing!</p>
<p>For comparison, the Landsat/LC08/C02/T1_L2 collection contains 1,351,632 images. By the time this book is published, the number of Landsat 9 images will be vastly larger. You can calculate the median value of all matching bands to reduce the size of the image collection:</p>
<pre data-type="programlisting">
median = collection.median()</pre>
</div></section>
<section data-pdf-bookmark="Working with Spectral Bands" data-type="sect1"><div class="sect1" id="working_with_spectral_bands">
<h1>Working with Spectral Bands</h1>
<p>As you learned in <a data-type="xref" href="ch01.xhtml#introduction_to_geospatial_analytics">Chapter 1</a>, <em>spectral bands</em> are like bins of different types of light. <a contenteditable="false" data-primary="Landsat" data-secondary="exploring Landsat 9 image collection" data-tertiary="working with spectral bands" data-type="indexterm" id="ix_Lndsatspbnd"/><a contenteditable="false" data-primary="spectral bands" data-type="indexterm" id="ix_spctbnd"/>Reflected light is captured as bands of light energy in a range of different wavelengths or colors. Think of the electromagnetic spectrum. Each section of the spectrum is actually a band. The information about bands in this section is intended to highlight where to locate the data to enter into the code to access the correct information. The <a href="https://oreil.ly/NN6Eq">bands</a> collected by Landsat 8 apply to Landsat 9. You will need this data to apply <em>scaling factors</em>, or comparisons of <a contenteditable="false" data-primary="scaling factors" data-type="indexterm" id="idm45433741648736"/>linear distances that adjust for distortion of areas and angles based on the map projection (also covered in <a data-type="xref" href="ch01.xhtml#introduction_to_geospatial_analytics">Chapter 1</a>). Remember, the Earth is shaped as an ellipsoid, not a perfect sphere! We derive scaling factors from the Scale and the Offset, as shown in <a data-type="xref" href="#band_characteristics_of_landsat_eightso">Figure 4-6</a>.</p>
<figure><div class="figure" id="band_characteristics_of_landsat_eightso"><img alt="Band characteristics of Landsat 8/9 data" height="1344" src="assets/pgda_0406.png" width="1437"/>
<h6><span class="label">Figure 4-6. </span>Band characteristics of Landsat 8/9 data</h6>
</div></figure>
<p>The USGS provides guidance on which spectral bands are best for different types of research. You can learn <a href="https://oreil.ly/vTrFF">more about the science</a> and explore <a href="https://oreil.ly/HdXC0">common Landsat band combinations</a>.</p>
<p>You’ll import <em>ee.ImageCollection</em> into your Jupyter Notebook and add it as a data layer to your map. You’ll then create a composite image from all of the images. This will yield the median value of the spectral bands.</p>
<p>In Python, we define functions by the keyword <code>def</code>. <a contenteditable="false" data-primary="Python" data-secondary="defining functions" data-type="indexterm" id="idm45433743036736"/><a contenteditable="false" data-primary="functions" data-secondary="defining in Python" data-type="indexterm" id="idm45433748433840"/>In the following code, the function name is <code>apply_scale_factors</code>, followed by the parameter <code>(image)</code>:</p>
<pre data-type="programlisting">
<strong>def <span>apply_scale_factors</span></strong>(image):
   opticalBands = image.select(<span>'SR_B.*'</span>).multiply(<span>0.0000275</span>).add(<span>-0.2</span>)
   thermalBands = image.select(<span>'ST_B.*'</span>).multiply(<span>0.00341802</span>).add(<span>149.0</span>)
   <strong>return</strong> image.addBands(opticalBands, <strong>None</strong>, <strong>True</strong>).addBands(thermalBands, <strong>None</strong>, 
   <strong>True</strong>)</pre>
<p>The asterisk (*) tells the function that you want to select multiple bands that meet the defined search requirements. Landsat’s sensors are the Operational Land Imager (OLI) and Thermal Infrared Sensor (TIRS). <a contenteditable="false" data-primary="OLI (Operational Land Imager)" data-type="indexterm" id="idm45433741607840"/><a contenteditable="false" data-primary="Operational Land Imager (OLI)" data-type="indexterm" id="idm45433741605952"/><a contenteditable="false" data-primary="Thermal Infrared Sensor (TIRS)" data-type="indexterm" id="idm45433741604432"/>The OLI produces spectral bands 1 through 9, and TIRS consists of two thermal bands: SR_B and ST_B.</p>
<p>The colon (:) signals where the function body begins.<a contenteditable="false" data-primary="return statements" data-type="indexterm" id="idm45433741596688"/> Inside the function body, which is indented, the <code>return</code> statement determines the value to be returned. After the function definition is complete, calling the function with an argument returns a value:</p>
<pre data-type="programlisting">
dataset = apply_scale_factors(median)</pre>
<p>To understand why you would want to pick and choose certain bands, think of them as having a spectral signature. Natural color bands use SR_B4 for red, SR_B3 for green, and SR_B2 for blue. Green indicates healthy vegetation, brown is less healthy, whitish gray typically indicates urban features, and water will appear dark blue or black.</p>
<p>The near-infrared (NIR) composite uses NIR (SR_B5), red (SR_B4), and green (SR_B3). Areas in red have better vegetation health, dark areas are water, and urban areas are white. So include these as your visualization parameters:</p>
<pre data-type="programlisting">
<span>vis_natural = {
 </span>  'bands'<span>: [</span>'SR_B4'<span>,</span> 'SR_B3'<span>,</span> 'SR_B2'<span>],
 </span>  'min'<span>:</span> 0.0<span>,
 </span>  'max'<span>:</span> 0.3<span>,
}

vis_nir = {
 </span>  'bands'<span>: [</span>'SR_B5'<span>,</span> 'SR_B4'<span>,</span> 'SR_B3'<span>],
 </span>  'min'<span>:</span> 0.0<span>,
 </span>  'max'<span>:</span> 0.3<span>,
}</span></pre>
<p>Now add them as data layers to your map:</p>
<pre data-type="programlisting">
Map.addLayer(dataset, vis_natural, <span>'True color (432)'</span>)
Map.addLayer(dataset, vis_nir, <span>'Color infrared (543)'</span>)
Map</pre>
<p>In <a data-type="xref" href="#different_band_combinations_of_landsat">Figure 4-7</a>, I toggled the infrared layer off so you can see the other bands more clearly. There appears to be cloud cover as well. Landsat 9 resamples every 16 days, so it will look different when you view it.</p>
<figure><div class="figure" id="different_band_combinations_of_landsat"><img alt="Different band combinations of Landsat 8/9" height="1060" src="assets/pgda_0407.png" width="2798"/>
<h6><span class="label">Figure 4-7. </span>Different band combinations of Landsat 8/9</h6>
</div></figure>
<p>If you hover your cursor over the toolbar icon, you will see the Layers menu appear. You can change the opacity of any maps and deselect any layers you don’t want to view in the Layers menu. You can also click the gear icon to explore attributes. You can also specify the minimum and maximum values to display. Stretching the data spreads the pixel values, and you can experiment with different values. Your data will show the range of the bands, and you can decide which values you want to display:</p>
<pre data-type="programlisting">
<span>vis_params = [
 </span>  {'bands'<span>: [</span>'SR_B4'<span>,</span> 'SR_B3'<span>,</span> 'SR_B2'<span>],</span> 'min'<span>:</span> 0<span>,</span> 'max'<span>:</span> 0.3<span>},
 </span>  {'bands'<span>: [</span>'SR_B5'<span>,</span> 'SR_B4'<span>,</span> 'SR_B3'<span>],</span> 'min'<span>:</span> 0<span>,</span> 'max'<span>:</span> 0.3<span>},
 </span>  {'bands'<span>: [</span>'SR_B7'<span>,</span> 'SR_B6'<span>,</span> 'SR_B4'<span>],</span> 'min'<span>:</span> 0<span>,</span> 'max'<span>:</span> 0.3<span>},
 </span>  {'bands'<span>: [</span>'SR_B6'<span>,</span> 'SR_B5'<span>,</span> 'SR_B2'<span>],</span> 'min'<span>:</span> 0<span>,</span> 'max'<span>:</span> 0.3<span>},
]</span></pre>
<p>To add labels <a contenteditable="false" data-primary="labels" data-secondary="adding to layers" data-type="indexterm" id="idm45433741499120"/>for these layers, create a list of labels:</p>
<pre data-type="programlisting">
<span>labels = [
 </span>  'Natural Color (4, 3, 2)'<span>,
 </span>  'Color Infrared (5, 4, 3)'<span>,
 </span>  'Short-Wave Infrared (7, 6 4)'<span>,
 </span>  'Agriculture (6, 5, 2)'<span>,
]</span></pre>
<p>Then assign a label to each layer:</p>
<pre data-type="programlisting">
geemap.linked_maps(
   rows=<span>2</span>,
   cols=<span>2</span>,
   height=<span>"400px"</span>,
   center=[<span>-3.4653</span>, <span>-62.2159</span>],
   zoom=<span>4</span>,
   ee_objects=[dataset],
   vis_params=vis_params,
   labels=labels,
   label_position=<span>"topright"</span>,
)</pre>
<p>Examining two more parameters in <a data-type="xref" href="#landsat_band_combinations">Figure 4-8</a>, you can also see shortwave infrared. Here, darker green indicates dense vegetation, urban areas are shown in blue, healthy vegetation is green, and bare earth is magenta.</p>
<figure><div class="figure" id="landsat_band_combinations"><img alt="Landsat band combinations" height="1200" src="assets/pgda_0408.png" width="2720"/>
<h6><span class="label">Figure 4-8. </span>Landsat band combinations</h6>
</div></figure>
<p>Let’s apply <a contenteditable="false" data-primary="Jupyter Notebooks" data-secondary="exploring Landsat 9 image collection" data-startref="ix_JpyNbkLndimg" data-type="indexterm" id="idm45433741486256"/>your <a contenteditable="false" data-primary="Landsat" data-secondary="exploring Landsat 9 image collection" data-startref="ix_Lndsatspbnd" data-tertiary="working with spectral bands" data-type="indexterm" id="idm45433741484512"/>introduction to<a contenteditable="false" data-primary="spectral bands" data-startref="ix_spctbnd" data-type="indexterm" id="idm45433741482496"/> GEE and geemap to begin exploring.<a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="exploring Landsat 9 image collection" data-startref="ix_cldLndst9" data-type="indexterm" id="idm45433741480672"/><a contenteditable="false" data-primary="Landsat" data-secondary="exploring Landsat 9 image collection" data-startref="ix_Lndsat" data-type="indexterm" id="idm45433741479024"/></p>
</div></section>
<section data-pdf-bookmark="The National Land Cover Database Basemap" data-type="sect1"><div class="sect1" id="the_national_land_cover_database_basema">
<h1>The National Land Cover Database Basemap</h1>
<p>The <a href="https://oreil.ly/xNJul">National Land Cover Database (NLCD)</a> tracks land cover in the US. <a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="using GEE console and geemap" data-tertiary="National Land Cover Database basemap" data-type="indexterm" id="ix_GEEconmapNLCD"/><a contenteditable="false" data-primary="National Land Cover Database (NLCD) basemap" data-type="indexterm" id="ix_NLCDbsmap"/>It is freely available in the <a href="https://oreil.ly/1IuYF">Earth Engine Data Catalog</a> and is updated every five years.<a contenteditable="false" data-primary="Earth Engine Data Catalog" data-type="indexterm" id="idm45433741470128"/><a contenteditable="false" data-primary="land cover data" data-type="indexterm" id="idm45433741468832"/> <em>Land cover</em> data includes spatial reference and land surface characteristics, such as tree canopy cover (which we explored in the last chapter), impervious surfaces, and additional patterns of biodiversity and climate changes.<a contenteditable="false" data-primary="impervious land cover" data-type="indexterm" id="idm45433741602336"/> <em>Impervious land cover</em> means nonnatural surfaces, such as asphalt, concrete, or other manmade layers, that limit the natural penetration of rainwater into soil. This information can help predict which areas may be more prone to flooding during heavy rains.<a contenteditable="false" data-primary="NLCD" data-see="National Land Cover Database basemap" data-type="indexterm" id="idm45433741464976"/></p>
<p>In this section, you’ll use NLCD data to perform a Landsat-based examination of the imperviousness data layer (for urban classes) and of decision-tree classification (for the rest). We won’t be doing a full activity here, just a quick orientation, but I encourage you to explore more.</p>
<section data-pdf-bookmark="Accessing the Data" data-type="sect2"><div class="sect2" id="accessing_the_data-id00001">
<h2>Accessing the Data</h2>
<p>Navigate to the <a href="https://oreil.ly/oWZcr">Earth Engine Data Catalog</a> and scroll to NLCD_Releases/2019_REL/NLCD or the National Land Cover Database, as shown in <a data-type="xref" href="#the_earth_engine_data_catalog">Figure 4-9</a>. Earlier we noted that you can simply add this data to the map, but there are a few more options here that I want to show you. Copy the JavaScript code and place it on your clipboard.</p>
<figure><div class="figure" id="the_earth_engine_data_catalog"><img alt="The Earth Engine Data Catalog" height="1240" src="assets/pgda_0409.png" width="1218"/>
<h6><span class="label">Figure 4-9. </span>The Earth Engine Data Catalog</h6>
</div></figure>
<p>The NLCD catalog provides a wealth of information, including date ranges for collection, the data source, an image snippet, a data description, information about the multispectral bands, and image properties.</p>
<p>In geemap, generate<a contenteditable="false" data-primary="geemap package (Python)" data-secondary="generating default map of the world" data-type="indexterm" id="idm45433741466896"/> a default map of the world:</p>
<pre data-type="programlisting">
map = geemap.Map()  
map</pre>
<p class="pagebreak-before less_space">Next, select the convert JavaScript icon. <a contenteditable="false" data-primary="Python" data-secondary="converting JavaScript to  using geemap" data-type="indexterm" id="idm45433741457504"/><a contenteditable="false" data-primary="JavaScript in Google Earth Engine" data-secondary="converting to Python using geemap" data-type="indexterm" id="idm45433741456160"/><a contenteditable="false" data-primary="geemap package (Python)" data-secondary="converting JavaScript to Python" data-type="indexterm" id="idm45433741454848"/>The box shown in <a data-type="xref" href="#the_earth_engine_data_catalog">Figure 4-9</a> will pop up. Paste the JavaScript code from the catalog into the box. Follow the instructions in the code comments that populate in the pop-up shown in <a data-type="xref" href="#using_geemap_to_convert_a_script_from_j">Figure 4-10</a>:</p>
<pre data-type="programlisting">
// Import the NLCD collection.
var dataset = ee.ImageCollection(<span>'USGS/NLCD_RELEASES/2019_REL/NLCD'</span>);

// The collection contains images <strong>for</strong> multiple years <strong>and</strong> regions <strong>in</strong> the USA.
print(<span>'Products:'</span>, dataset.aggregate_array(<span>'system:index'</span>));

// Filter the collection to the <span>2016</span> product.
var nlcd2016 = dataset.filter(ee.Filter.eq(<span>'system:index'</span>, <span>'2016'</span>)).first();

// Each product has multiple bands <strong>for</strong> describing aspects of land cover.
print(<span>'Bands:'</span>, nlcd2016.bandNames());

// Select the land cover band.
var landcover = nlcd2016.select(<span>'landcover'</span>);

// Display land cover on the map.
Map.setCenter(<span>-95</span>, <span>38</span>, <span>5</span>);
Map.addLayer(landcover, null, <span>'Landcover'</span>);</pre>
<p>Once you hit Convert, you will see the code update from JavaScript to Python, as shown in <a data-type="xref" href="#using_geemap_to_convert_a_script_from_j">Figure 4-10</a>.</p>
<figure><div class="figure" id="using_geemap_to_convert_a_script_from_j"><img alt="Using geemap to convert a script from JavaScript to Python" height="599" src="assets/pgda_0410.png" width="1552"/>
<h6><span class="label">Figure 4-10. </span>Using geemap to convert a script from JavaScript to Python</h6>
</div></figure>
<p>If the code does not update into a new cell in your Jupyter Notebook, you can cut and paste it into a new cell and run the cell. The image will now appear as your map.</p>
<p>Now let’s include the default NLCD legend. <a contenteditable="false" data-primary="legends" data-secondary="default in NLCD" data-type="indexterm" id="idm45433741451376"/>Select the landcover layer. To discover which legends are available as defaults, run the <code>builtin_legend</code> function:</p>
<pre data-type="programlisting">
legends = geemap.builtin_legends
for legend in legends:
    print(legend)</pre>
<p>The NLCD’s legend will be listed as an option. Select it to add it to your map.</p>
</div></section>
<section data-pdf-bookmark="Building a Custom Legend" data-type="sect2"><div class="sect2" id="building_a_custom_legend">
<h2>Building a Custom Legend</h2>
<p>While the NLCD offers a built-in legend option, many datasets<a contenteditable="false" data-primary="legends" data-secondary="custom, building in NLCD" data-type="indexterm" id="idm45433741431344"/> do not—and even when they do, these legends don’t always offer exactly what you need. Thus, it’s helpful to be able to create your own map legend. Let’s look at how to do that now.</p>
<p>The classes in a dataset usually correspond to the categories you’d want in a legend. Fortunately, you can convert a class table to a legend.<a contenteditable="false" data-primary="classes" data-secondary="NLCD dataset" data-type="indexterm" id="idm45433741461584"/></p>
<p>If your data is from the GEE data catalog, you can find a class table there.<a contenteditable="false" data-primary="geemap package (Python)" data-secondary="building custom legend for NLCD basemap" data-type="indexterm" id="idm45433741428672"/> Then use the following code (or find this code cell in your Jupyter Notebook) and copy the text from the class table into it:</p>
<pre data-type="programlisting">
<span>map = geemap.Map()

legend_dict = {
   </span> '11 Open Water'<span>:</span> '466b9f'<span>,
   </span> '12 Perennial Ice/Snow'<span>:</span> 'd1def8'<span>,
   </span> '21 Developed, Open Space'<span>:</span> 'dec5c5'<span>,
   </span> '22 Developed, Low Intensity'<span>:</span> 'd99282'<span>,
   </span> '23 Developed, Medium Intensity'<span>:</span> 'eb0000'<span>,
   </span> '24 Developed High Intensity'<span>:</span> 'ab0000'<span>,
   </span> '31 Barren Land (Rock/Sand/Clay)'<span>:</span> 'b3ac9f'<span>,
   </span> '41 Deciduous Forest'<span>:</span> '68ab5f'<span>,
   </span> '42 Evergreen Forest'<span>:</span> '1c5f2c'<span>,
   </span> '43 Mixed Forest'<span>:</span> 'b5c58f'<span>,
   </span> '51 Dwarf Scrub'<span>:</span> 'af963c'<span>,
   </span> '52 Shrub/Scrub'<span>:</span> 'ccb879'<span>,
   </span> '71 Grassland/Herbaceous'<span>:</span> 'dfdfc2'<span>,
   </span> '72 Sedge/Herbaceous'<span>:</span> 'd1d182'<span>,
   </span> '73 Lichens'<span>:</span> 'a3cc51'<span>,
   </span> '74 Moss'<span>:</span> '82ba9e'<span>,
   </span> '81 Pasture/Hay'<span>:</span> 'dcd939'<span>,
   </span> '82 Cultivated Crops'<span>:</span> 'ab6c28'<span>,
   </span> '90 Woody Wetlands'<span>:</span> 'b8d9eb'<span>,
   </span> '95 Emergent Herbaceous Wetlands'<span>:</span> '6c9fb8'<span>
}

landcover = ee.Image(</span>'USGS/NLCD/NLCD2019'<span>).select(</span>'landcover'<span>)
Map.addLayer(landcover, {},</span> 'NLCD Land Cover'<span>)

Map.add_legend(legend_title=</span>"NLCD Land Cover Classification"<span>, 
   legend_dict=legend_dict)
Map</span></pre>
<p>You can find more info on building and customizing legends manually in the <a href="https://geemap.org">geemap documentation</a>.</p>
<p>Now you can explore your map and dig deeper into your areas of interest. What questions do you want to ask of this map? Take some time to explore. There are many different ways to customize your maps with a broad selection of tools!</p>
<p>The <a href="https://oreil.ly/3Q25Z">GEE catalog</a> is extensive. <a contenteditable="false" data-primary="GEE catalog" data-type="indexterm" id="idm45433741463568"/>As you explore different databases and datasets using the skills you’ve learned here, you will be able to work with raster and vector data as well as upload your own data sources.<a contenteditable="false" data-primary="geemap package (Python)" data-secondary="handy functions, list in GitHub" data-type="indexterm" id="idm45433741402800"/> A list of handy additional functions in geemap is available on the <a href="https://geemap.org/usage">geemap GitHub page</a>. However, I’d also like to introduce you to an alternative to GEE.<a contenteditable="false" data-primary="Google Earth Engine (GEE)" data-secondary="using GEE console and geemap" data-startref="ix_GEEconmapNLCD" data-tertiary="National Land Cover Database basemap" data-type="indexterm" id="idm45433741399008"/><a contenteditable="false" data-primary="National Land Cover Database (NLCD) basemap" data-startref="ix_NLCDbsmap" data-type="indexterm" id="idm45433741397104"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Leafmap: An Alternative to Google Earth Engine" data-type="sect1"><div class="sect1" id="leafmap_an_alternative_to_google_earth">
<h1>Leafmap: An Alternative to Google Earth Engine</h1>
<p>Visualizing geospatial data outside of GEE does not have to be limiting!<a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="Leafmap alternative to Google Earth Engine" data-type="indexterm" id="ix_cldLeafMp"/> If you don’t have access to a GEE account or aren’t interested in working with GEE, consider using Leafmap. <a contenteditable="false" data-primary="Leafmap" data-type="indexterm" id="ix_Leafmp"/>Leafmap is a Python package that lets you visualize interactive geospatial data in your Jupyter Notebook environment.<a contenteditable="false" data-primary="Jupyter Notebooks" data-secondary="Leafmap Python package for visualizing interactive geospatial data in" data-type="indexterm" id="idm45433741391376"/> It is based on the geemap package you have already experienced, but as you will see in this section, Leafmap provides access to geospatial data outside the GEE platform. Its GUI reduces the amount of coding you need to do. It has a variety of open source packages at its core.</p>
<p>Leafmap works with many different plotting backends<em>,</em> including ipyleaflet<em>.</em> (A <em>backend</em>, in this context, is internal code that runs on a server and receives client requests.) Users don’t see backends, but they are always operating nonetheless.</p>
<p>You can access the Jupyter Notebook Leafmap with the <a href="https://oreil.ly/9ADWy">GitHub link</a>. Follow the <a href="https://oreil.ly/f2Ztx">Leafmap documentation</a> for specific installation instructions depending on your version of Python. (If you aren’t sure what version you have, enter <code><strong>python</strong></code> in the terminal, and it will output the number of the version you have installed. This is important to remember in case you run into issues with your installation of packages.)</p>
<p>You can set up a new environment to work with Leafmap. <a contenteditable="false" data-primary="Conda environment, creating" data-type="indexterm" id="idm45433741401824"/>I originally created the Conda environment shown in the following code with Python 3.8, but it is likely to work with later versions.<a contenteditable="false" data-primary="basemaps" data-secondary="installing in Leafmap" data-type="indexterm" id="idm45433741382144"/> I named this environment <code>geo</code> because it is running in a different version of Python:</p>
<pre data-type="programlisting">
<span>conda create -n geo python=<span>3.8</span>
conda activate geo
conda install geopandas
conda install leafmap -c conda-forge
conda install mamba -c conda-forge
mamba install leafmap xarray_leaflet -c conda-forge</span>
conda install jupyter_contrib_nbextensions -c conda-forge
pip install keplergl</pre>
<p class="pagebreak-before less_space">As before, to open the Notebook, type <code><strong>jupyter notebook</strong></code> and hit Enter. Now enter the following code into the Notebook to reveal something similar to <a data-type="xref" href="#installing_basemaps_in_leafmap">Figure 4-11</a>:</p>
<pre data-type="programlisting">
from ipyleaflet <strong>import</strong> *
m = Map(center=[48.8566, 2.3522], zoom=10, height=600, widescreen=False,
basemaps=basemaps.Stamen.Terrain)
m</pre>
<figure><div class="figure" id="installing_basemaps_in_leafmap"><img alt="Installing basemaps in Leafmap" height="801" src="assets/pgda_0411.png" width="1669"/>
<h6><span class="label">Figure 4-11. </span>Installing basemaps in Leafmap</h6>
</div></figure>
<p>Changing the basemap <a contenteditable="false" data-primary="basemaps" data-secondary="changing in Leafmap" data-type="indexterm" id="idm45433741372096"/>is as easy as placing your cursor inside the basemap parentheses and selecting Tab on the keyboard. <a data-type="xref" href="#changing_basemaps_in_leafmap">Figure 4-12</a> shows the options that become available. Esri is the selected basemap here, but you can scroll up and down until you find a suitable one. Be sure to explore. Once you type <code><strong>Esri</strong></code>, options will populate.</p>
<figure><div class="figure" id="changing_basemaps_in_leafmap"><img alt="Changing basemaps in Leafmap" height="773" src="assets/pgda_0412.png" width="1669"/>
<h6><span class="label">Figure 4-12. </span>Changing basemaps in Leafmap</h6>
</div></figure>
<p>Another useful tool is the ability to preset your zoom levels.<a contenteditable="false" data-primary="zoom levels" data-secondary="preset in Leafmap" data-type="indexterm" id="idm45433741365008"/> When you run the cell in your Notebook, you will have the option of sliding between different zoom levels:</p>
<pre data-type="programlisting">
m.interact(zoom=(<span>5</span>,<span>10</span>,<span>1</span>))</pre>
<p><a data-type="xref" href="#zoom_levels_in_leafmap">Figure 4-13</a> shows the output.</p>
<figure><div class="figure" id="zoom_levels_in_leafmap"><img alt="Zoom levels in Leafmap" height="996" src="assets/pgda_0413.png" width="1793"/>
<h6><span class="label">Figure 4-13. </span>Zoom levels in Leafmap</h6>
</div></figure>
<p>You can also provide a reference by inserting a minimap into your larger map, as shown in <a data-type="xref" href="#a_map_within_a_map_the_minimap_function">Figure 4-14</a>. <a contenteditable="false" data-primary="minimap, inserting into larger map in Leafmap" data-type="indexterm" id="idm45433741358624"/>To do so, enter the following code:</p>
<pre data-type="programlisting">
minimap = Map(
    zoom_control=<strong>False</strong>, attribution_control=<strong>False</strong>, 
    zoom=<span>5</span>, center=m.center, basemap=basemaps.Stamen.Terrain
)
minimap.layout.width = <span>'200px'</span>
minimap.layout.height = <span>'200px'</span>
link((minimap, <span>'center'</span>), (m, <span>'center'</span>))
minimap_control = WidgetControl(widget=minimap, position=<span>'bottomleft'</span>)
m.add_control(minimap_control)</pre>
<p>The minimap shown in <a data-type="xref" href="#a_map_within_a_map_the_minimap_function">Figure 4-14</a> will appear, helping users stay oriented in a larger context.</p>
<figure><div class="figure" id="a_map_within_a_map_the_minimap_function"><img alt="A map within a map: the minimap function in Leafmap" height="409" src="assets/pgda_0414.png" width="975"/>
<h6><span class="label">Figure 4-14. </span>A map within a map: the minimap function in Leafmap</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="summary-id00017">
<h1>Summary</h1>
<p>This chapter explored Google Earth Engine and some related tools, libraries, and packages that you can use to answer geospatial questions, and it introduced you to an alternative tool, Leafmap. <a contenteditable="false" data-primary="cloud, geospatial analytics in" data-secondary="Leafmap alternative to Google Earth Engine" data-startref="ix_cldLeafMp" data-type="indexterm" id="idm45433741346832"/>This chapter and its associated Notebooks will be a handy reference for the projects you’ll do in the next chapter. You have rendered visualizations and created maps on the canvas. Next, you will begin analyzing these relationships and exploring tools to do some advanced analysis of your geospatial data.<a contenteditable="false" data-primary="cloud, geospatial analytics in" data-startref="ix_cld" data-type="indexterm" id="idm45433741343664"/></p>
</div></section>
</div></section></div></body></html>