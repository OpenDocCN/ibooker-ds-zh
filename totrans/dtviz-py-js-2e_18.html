<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 13. RESTful Data with Flask" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter_delivery_restful">
<h1><span class="label">Chapter 13. </span>RESTful Data with Flask</h1>
<p>In <a data-type="xref" href="ch12.xhtml#sect_flask_api">“A Simple Data API with Flask”</a>, we saw how to build a very simple data API with Flask and Dataset. <a data-primary="RESTful APIs" data-type="indexterm" id="idm45607759688656"/>For many simple data visualizations this kind of quick and dirty API is fine, but as the data demands become more advanced it helps to have an API that respects some conventions for retrieval and, sometimes, creation, update and delete.<sup><a data-type="noteref" href="ch13.xhtml#idm45607759687920" id="idm45607759687920-marker">1</a></sup>  In <a data-type="xref" href="ch05.xhtml#getting_data_webapis">“Using Python to Consume Data from a Web API”</a>, we covered
the types of web API and why RESTful<sup><a data-type="noteref" href="ch13.xhtml#idm45607759685936" id="idm45607759685936-marker">2</a></sup> APIs are acquiring a well-deserved prominence. In this chapter, we’ll see how easy it is to combine a few Flask libraries into a flexible RESTful API.<a data-primary="Flask" data-secondary="creating a RESTful API" data-type="indexterm" id="ix_FlskREST"/><a data-primary="RESTful APIs" data-secondary="creating with Flask" data-type="indexterm" id="ix_RESTflsk"/></p>
<section data-pdf-bookmark="The Tools for a RESTful Job" data-type="sect1"><div class="sect1" id="idm45607759681760">
<h1>The Tools for a RESTful Job</h1>
<p>As seen in <a data-type="xref" href="ch12.xhtml#sect_flask_api">“A Simple Data API with Flask”</a>, the basics of a data API are pretty simple.<a data-primary="Flask" data-secondary="creating a RESTful API" data-tertiary="tools for" data-type="indexterm" id="idm45607759679424"/><a data-primary="RESTful APIs" data-secondary="creating with Flask" data-tertiary="tools for" data-type="indexterm" id="idm45607759678336"/> It needs a server, which accepts HTTP requests such as GET to retrieve or more advanced verbs like POST (to add) or DELETE.<a data-primary="HTTP" data-secondary="requests" data-type="indexterm" id="idm45607759677120"/> These requests are on routes like <code>api/winners</code> that are then dealt with by functions provided. In these functions data is retrieved from a backend database, possibly filtered using data parameters (e.g., strings like <code>?category=comic&amp;name=Groucho</code> appended to the URL calls). This data then needs to be returned or serialized in some requested format, pretty much always JSON-based. For this round trip of data, the Flask/Python ecosystem provides some perfect libraries:</p>
<ul class="pagebreak-before">
<li>
<p>Flask to do the server work</p>
</li>
<li>
<p><a href="https://oreil.ly/NVldl">Flask SQLAlchemy</a>, a Flask extension that integrates <a href="https://sqlalchemy.org">SQLAlchemy</a>, our preferred Python SQL library with object-relational mapper (ORM)</p>
</li>
<li>
<p><a href="https://oreil.ly/Vbgq3">Flask-Marshmallow</a>, a Flask extension that adds support for <a href="https://oreil.ly/AIySU">marshmallow</a>, a powerful Python library for object serialization</p>
</li>
</ul>
<p>You can install the required extensions with <code>pip</code>:</p>
<pre data-code-language="bash" data-type="programlisting">$ pip install Flask-SQLALchemy flask-marshmallow marshmallow-sqlalchemy</pre>
</div></section>
<section data-pdf-bookmark="Creating the Database" data-type="sect1"><div class="sect1" id="idm45607760024672">
<h1>Creating the Database</h1>
<p>In <a data-type="xref" href="ch09.xhtml#sect_saving_cleaned_dataset">“Saving the Cleaned Datasets”</a>, we saw how easy it is to save a pandas DataFrame to SQL using the <code>to_sql</code> method.<a data-primary="RESTful APIs" data-secondary="creating with Flask" data-tertiary="creating the database" data-type="indexterm" id="idm45607759654304"/> This is a very convenient way to store a DataFrame, but the table produced lacks a <a href="https://oreil.ly/x4OM6">primary key field</a>, which uniquely specifies a table row. <a data-primary="primary key" data-type="indexterm" id="idm45607759652800"/>It’s good form to have a primary key, and for the purposes of creating or deleting rows via our Web API, is pretty much essential. For this reason we’ll create our SQL table by another route.<a data-primary="databases" data-secondary="SQLite" data-tertiary="creating for RESTful API" data-type="indexterm" id="idm45607759651968"/></p>
<p>First, we build an SQLite database with SQLAlchemy, adding a primary-key ID to the winners table:<a data-primary="SQLAlchemy" data-secondary="creating SQLite database for RESTful API" data-type="indexterm" id="idm45607765297280"/></p>
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code><code> </code><code class="nn">sqlalchemy</code><code> </code><code class="kn">import</code><code> </code><code class="n">Column</code><code class="p">,</code><code> </code><code class="n">Integer</code><code class="p">,</code><code> </code><code class="n">String</code><code class="p">,</code><code> </code><code class="n">Text</code><code>
</code><code class="kn">from</code><code> </code><code class="nn">sqlalchemy</code><code class="nn">.</code><code class="nn">ext</code><code class="nn">.</code><code class="nn">declarative</code><code> </code><code class="kn">import</code><code> </code><code class="n">declarative_base</code><code>
</code><code class="kn">from</code><code> </code><code class="nn">sqlalchemy</code><code class="nn">.</code><code class="nn">orm</code><code> </code><code class="kn">import</code><code> </code><code class="n">sessionmaker</code><code>
</code><code>
</code><code class="n">Base</code><code> </code><code class="o">=</code><code> </code><code class="n">declarative_base</code><code class="p">(</code><code class="p">)</code><code>
</code><code>
</code><code>
</code><code class="k">class</code><code> </code><code class="nc">Winner</code><code class="p">(</code><code class="n">Base</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">__tablename__</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">winners</code><code class="s1">'</code><code>
</code><code>    </code><code class="nb">id</code><code> </code><code class="o">=</code><code> </code><code class="n">Column</code><code class="p">(</code><code class="n">Integer</code><code class="p">,</code><code> </code><code class="n">primary_key</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO1-1" id="co_restful_data_with_flask_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>    </code><code class="n">category</code><code> </code><code class="o">=</code><code> </code><code class="n">Column</code><code class="p">(</code><code class="n">String</code><code class="p">)</code><code>
</code><code>    </code><code class="n">country</code><code> </code><code class="o">=</code><code> </code><code class="n">Column</code><code class="p">(</code><code class="n">String</code><code class="p">)</code><code>
</code><code>    </code><code class="n">date_of_birth</code><code> </code><code class="o">=</code><code> </code><code class="n">Column</code><code class="p">(</code><code class="n">String</code><code class="p">)</code><code> </code><code class="c1"># string form dates</code><code>
</code><code>    </code><code class="n">date_of_death</code><code> </code><code class="o">=</code><code> </code><code class="n">Column</code><code class="p">(</code><code class="n">String</code><code class="p">)</code><code>
</code><code>    </code><code class="c1"># ...</code><code>
</code><code>
</code><code class="c1"># create SQLite database and start a session</code><code>
</code><code class="n">engine</code><code> </code><code class="o">=</code><code> </code><code class="n">sqlalchemy</code><code class="o">.</code><code class="n">create_engine</code><code class="p">(</code><code class="s1">'</code><code class="s1">sqlite:///data/nobel_winners_cleaned_api.db</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="n">Base</code><code class="o">.</code><code class="n">metadata</code><code class="o">.</code><code class="n">create_all</code><code class="p">(</code><code class="n">engine</code><code class="p">)</code><code>
</code><code class="n">Session</code><code> </code><code class="o">=</code><code> </code><code class="n">sessionmaker</code><code class="p">(</code><code class="n">bind</code><code class="o">=</code><code class="n">engine</code><code class="p">)</code><code>
</code><code class="n">session</code><code> </code><code class="o">=</code><code> </code><code class="n">Session</code><code class="p">(</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO1-1" id="callout_restful_data_with_flask_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>We specify the all-important primary key to disambiguate our winners.</p></dd>
</dl>
<p>Note that we are  going to store the dates as strings to limit any problems serializing datetime objects. We’ll convert those DataFrame columns before committing the rows to the database:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code><code class="p">[</code><code class="s1">'date_of_birth'</code><code class="p">]</code> <code class="o">=</code> <code class="n">df</code><code class="p">[</code><code class="s1">'date_of_birth'</code><code class="p">]</code><code class="o">.</code><code class="n">astype</code><code class="p">(</code><code class="nb">str</code><code class="p">)</code>
<code class="n">df</code><code class="p">[</code><code class="s1">'date_of_death'</code><code class="p">]</code> <code class="o">=</code> <code class="n">dl</code><code class="p">[</code><code class="s1">'date_of_death'</code><code class="p">]</code><code class="o">.</code><code class="n">astype</code><code class="p">(</code><code class="nb">str</code><code class="p">)</code>
<code class="n">df</code><code class="o">.</code><code class="n">date_of_birth</code>
<code class="c1">#0      1927-10-08</code>
<code class="c1">#4      1829-07-26</code>
<code class="c1">#5      1862-08-29</code>
<code class="o">..</code></pre>
<p>We can now iterate through our DataFrame’s rows, adding them to the database as dictionary records and then commit all of them, relatively efficiently,  as one transaction:</p>
<pre data-code-language="python" data-type="programlisting"><code class="k">for</code> <code class="n">d</code> <code class="ow">in</code> <code class="n">df_tosql</code><code class="o">.</code><code class="n">to_dict</code><code class="p">(</code><code class="n">orient</code><code class="o">=</code><code class="s1">'records'</code><code class="p">):</code>
    <code class="n">session</code><code class="o">.</code><code class="n">add</code><code class="p">(</code><code class="n">Winner</code><code class="p">(</code><code class="o">**</code><code class="n">d</code><code class="p">))</code>
<code class="n">session</code><code class="o">.</code><code class="n">commit</code><code class="p">()</code></pre>
<p>With our well-formed database to hand, let’s see how to easily serve it with Flask.</p>
</div></section>
<section data-pdf-bookmark="A Flask RESTful Data Server" data-type="sect1"><div class="sect1" id="idm45607759661584">
<h1>A Flask RESTful Data Server</h1>
<p>This will be a standard Flask server, similar to the one seen in <a data-type="xref" href="ch12.xhtml#sect_serving_data_with_flask">“Serving Data with Flask”</a>. <a data-primary="RESTful APIs" data-secondary="creating with Flask" data-tertiary="Flask RESTful data server" data-type="indexterm" id="ix_RESTFlsksrvr"/><a data-primary="Flask" data-secondary="creating a RESTful API" data-tertiary="Flask RESTful data server" data-type="indexterm" id="ix_FlskRESTsrv"/>First, we import the standard Flask modules along with the SQLALchemy and marshmallow extensions and create our Flask app:</p>
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">flask</code> <code class="kn">import</code> <code class="n">Flask</code><code class="p">,</code> <code class="n">request</code><code class="p">,</code> <code class="n">jsonify</code>
<code class="kn">from</code> <code class="nn">flask_sqlalchemy</code> <code class="kn">import</code> <code class="n">SQLAlchemy</code>
<code class="kn">from</code> <code class="nn">flask_marshmallow</code> <code class="kn">import</code> <code class="n">Marshmallow</code>

<code class="c1"># Init app</code>
<code class="n">app</code> <code class="o">=</code> <code class="n">Flask</code><code class="p">(</code><code class="vm">__name__</code><code class="p">)</code></pre>
<p>Now some database-specific declarations, initializing SQLAlchemy with the Flask app:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">app</code><code class="o">.</code><code class="n">config</code><code class="p">[</code><code class="s1">'SQLALCHEMY_DATABASE_URI'</code><code class="p">]</code> <code class="o">=</code>\
    <code class="s1">'sqlite:///data/nobel_winners_cleaned_api_test.db'</code>

<code class="n">db</code> <code class="o">=</code> <code class="n">SQLAlchemy</code><code class="p">(</code><code class="n">app</code><code class="p">)</code></pre>
<p>We can now use the <code>db</code> instance to define our winners table, subclassed from the base declarative model. This matches the schema used to create the winners table in the last section:</p>
<pre data-code-language="python" data-type="programlisting"><code class="k">class</code> <code class="nc">Winner</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">Model</code><code class="p">):</code>
    <code class="n">__tablename__</code> <code class="o">=</code> <code class="s1">'winners'</code>
    <code class="nb">id</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">Integer</code><code class="p">,</code> <code class="n">primary_key</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code>
    <code class="n">category</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">String</code><code class="p">)</code>
    <code class="n">country</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">String</code><code class="p">)</code>
    <code class="n">date_of_birth</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">String</code><code class="p">)</code>
    <code class="n">date_of_death</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">String</code><code class="p">)</code>
    <code class="n">gender</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">String</code><code class="p">)</code>
    <code class="n">link</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">String</code><code class="p">)</code>
    <code class="n">name</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">String</code><code class="p">)</code>
    <code class="n">place_of_birth</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">String</code><code class="p">)</code>
    <code class="n">place_of_death</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">String</code><code class="p">)</code>
    <code class="n">text</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">Text</code><code class="p">)</code>
    <code class="n">year</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">Integer</code><code class="p">)</code>
    <code class="n">award_age</code> <code class="o">=</code> <code class="n">db</code><code class="o">.</code><code class="n">Column</code><code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">Integer</code><code class="p">)</code>

    <code class="k">def</code> <code class="fm">__repr__</code><code class="p">(</code><code class="bp">self</code><code class="p">):</code>
        <code class="k">return</code> <code class="s2">"&lt;Winner(name='</code><code class="si">%s</code><code class="s2">', category='</code><code class="si">%s</code><code class="s2">', year='</code><code class="si">%s</code><code class="s2">')&gt;"</code>\
            <code class="o">%</code> <code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">name</code><code class="p">,</code> <code class="bp">self</code><code class="o">.</code><code class="n">category</code><code class="p">,</code> <code class="bp">self</code><code class="o">.</code><code class="n">year</code><code class="p">)</code></pre>
<section data-pdf-bookmark="Serializing with marshmallow" data-type="sect2"><div class="sect2" id="idm45607759231808">
<h2>Serializing with marshmallow</h2>
<p>marshmallow is a really useful little Python library that does one job and does it well.<a data-primary="marshmallow library" data-type="indexterm" id="idm45607759230320"/> To quote <a href="https://oreil.ly/kLTVF">the documentation</a>:</p>
<blockquote>
<p>marshmallow is an ORM/ODM/framework-agnostic library for converting complex
datatypes, such as objects, to and from native Python datatypes.</p></blockquote>
<p>marshmallow uses Schemas, similar to SQLALchemy’s, to enable deserializing input data to app-level objects and validation of that input data.<a data-primary="schemas" data-secondary="use in marshmallow" data-type="indexterm" id="idm45607759046992"/><a data-primary="serialization with marshmallow" data-type="indexterm" id="idm45607759046016"/> For our purposes here its key asset is its ability to take data from our SQLite database, provided by SQLAlchemy, and turn it into JSON-compliant data.</p>
<p>To use Flask-Marshmallow we first create a marshmallow instance (<code>ma</code>), initialized with the Flask app. <a data-primary="Flask-Marshmallow, using" data-type="indexterm" id="idm45607759044448"/>We then use this to create a marshmallow schema, using the SQLAlchemy <code>Winner</code> model as its base. The schema also has a <code>fields</code> property that allows you to specify which (database) fields to serialize:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">ma</code><code> </code><code class="o">=</code><code> </code><code class="n">Marshmallow</code><code class="p">(</code><code class="n">app</code><code class="p">)</code><code>
</code><code>
</code><code class="k">class</code><code> </code><code class="nc">WinnerSchema</code><code class="p">(</code><code class="n">ma</code><code class="o">.</code><code class="n">Schema</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="k">class</code><code> </code><code class="nc">Meta</code><code class="p">:</code><code>
</code><code>        </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">Winner</code><code>
</code><code>        </code><code class="n">fields</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="s1">'</code><code class="s1">category</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">date_of_birth</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">date_of_death</code><code class="s1">'</code><code class="p">,</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO2-1" id="co_restful_data_with_flask_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>                  </code><code class="s1">'</code><code class="s1">gender</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">link</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">place_of_birth</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">place_of_death</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                  </code><code class="s1">'</code><code class="s1">text</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">award_age</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>
</code><code class="n">winner_schema</code><code> </code><code class="o">=</code><code> </code><code class="n">WinnerSchema</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO2-2" id="co_restful_data_with_flask_CO2-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code class="n">winners_schema</code><code> </code><code class="o">=</code><code> </code><code class="n">WinnerSchema</code><code class="p">(</code><code class="n">many</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO2-1" id="callout_restful_data_with_flask_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The database fields to serialize.</p></dd>
<dt><a class="co" href="#co_restful_data_with_flask_CO2-2" id="callout_restful_data_with_flask_CO2-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We declare two schema instances, one for returning single records and one for multiple records.<a data-primary="RESTful APIs" data-secondary="creating with Flask" data-startref="ix_RESTFlsksrvr" data-tertiary="Flask RESTful data server" data-type="indexterm" id="idm45607758921536"/><a data-primary="Flask" data-secondary="creating a RESTful API" data-startref="ix_FlskRESTsrv" data-tertiary="Flask RESTful data server" data-type="indexterm" id="idm45607758920048"/></p></dd>
</dl>
</div></section>
</div></section>
<section data-pdf-bookmark="Adding our RESTful API Routes" data-type="sect1"><div class="sect1" id="idm45607758918288">
<h1>Adding our RESTful API Routes</h1>
<p>Now the backbone is in place, let’s craft a few Flask routes to define a small RESTful API.<a data-primary="routing" data-secondary="adding routes to RESTful API" data-type="indexterm" id="ix_rte"/><a data-primary="RESTful APIs" data-secondary="creating with Flask" data-tertiary="adding routes" data-type="indexterm" id="ix_RESTFlskrt"/> For a first test, we’ll make a route that returns all the Nobel winners in our database table:</p>
<pre data-code-language="python" data-type="programlisting"><code class="nd">@app</code><code class="o">.</code><code class="n">route</code><code class="p">(</code><code class="s1">'</code><code class="s1">/winners/</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="k">def</code><code> </code><code class="nf">winner_list</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">all_winners</code><code> </code><code class="o">=</code><code> </code><code class="n">Winner</code><code class="o">.</code><code class="n">query</code><code class="o">.</code><code class="n">all</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO3-1" id="co_restful_data_with_flask_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>    </code><code class="n">result</code><code> </code><code class="o">=</code><code> </code><code class="n">winners_schema</code><code class="o">.</code><code class="n">jsonify</code><code class="p">(</code><code class="n">all_winners</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO3-2" id="co_restful_data_with_flask_CO3-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">result</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO3-1" id="callout_restful_data_with_flask_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Database query for all rows in the winners table.</p></dd>
<dt><a class="co" href="#co_restful_data_with_flask_CO3-2" id="callout_restful_data_with_flask_CO3-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>The marshmallow schema for many rows takes the all-winners result and serializes it to JSON.</p></dd>
</dl>
<p>We’ll test the API with some command-line curl:</p>
<pre data-code-language="bash" data-type="programlisting">$ curl http://localhost:5000/winners/
<code class="o">[</code>
  <code class="o">{</code>
    <code class="s2">"award_age"</code>: <code class="m">57</code>,
    <code class="s2">"category"</code>: <code class="s2">"Physiology or Medicine"</code>,
    <code class="s2">"country"</code>: <code class="s2">"Argentina"</code>,
    <code class="s2">"date_of_birth"</code>: <code class="s2">"1927-10-08"</code>,
    <code class="s2">"date_of_death"</code>: <code class="s2">"2002-03-24"</code>,
    <code class="s2">"gender"</code>: <code class="s2">"male"</code>,
    <code class="s2">"link"</code>: <code class="s2">"http://en.wikipedia.org/wiki/C%C3%A9sar_Milstein"</code>,
    <code class="s2">"name"</code>: <code class="s2">"C\u00e9sar Milstein"</code>,
    <code class="s2">"place_of_birth"</code>: <code class="s2">"Bah\u00eda Blanca ,  Argentina"</code>,
    <code class="s2">"place_of_death"</code>: <code class="s2">"Cambridge , England"</code>,
    <code class="s2">"text"</code>: <code class="s2">"C\u00e9sar Milstein , Physiology or Medicine, 1984"</code>,
    <code class="s2">"year"</code>: <code class="m">1984</code>
  <code class="o">}</code>,
  <code class="o">{</code>
    <code class="s2">"award_age"</code>: <code class="m">80</code>,
    <code class="s2">"category"</code>: <code class="s2">"Peace"</code>,  ...
  <code class="o">}</code>...
<code class="o">]</code></pre>
<p>So we now have an API endpoint to return all the winners. What about being able to retrieve individuals by ID (our primary key for the winners table)? To do this, we retrieve the ID from the API call, using Flask’s route pattern-matching, and use it to make a specific database query. We then serialize this to JSON using our single-row marshmallow schema:</p>
<pre data-code-language="python" data-type="programlisting"><code class="nd">@app</code><code class="o">.</code><code class="n">route</code><code class="p">(</code><code class="s1">'</code><code class="s1">/winners/&lt;id&gt;/</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="k">def</code><code> </code><code class="nf">winner_detail</code><code class="p">(</code><code class="nb">id</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">winner</code><code> </code><code class="o">=</code><code> </code><code class="n">Winner</code><code class="o">.</code><code class="n">query</code><code class="o">.</code><code class="n">get_or_404</code><code class="p">(</code><code class="nb">id</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO4-1" id="co_restful_data_with_flask_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>    </code><code class="n">result</code><code> </code><code class="o">=</code><code> </code><code class="n">winner_schema</code><code class="o">.</code><code class="n">jsonify</code><code class="p">(</code><code class="n">winner</code><code class="p">)</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">result</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO4-1" id="callout_restful_data_with_flask_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Flask-SQLAlchemy provides a default 404 error message, which can be serialized to JSON by marshmallow if the query is invalid.<a data-primary="Flask-SQLAlchemy" data-type="indexterm" id="idm45607758689008"/></p></dd>
</dl>
<p>Testing with curl shows the expected single JSON object returned:</p>
<pre data-code-language="bash" data-type="programlisting">$ curl http://localhost:5000/winners/10/
<code class="o">{</code>
  <code class="s2">"award_age"</code>: <code class="m">60</code>,
  <code class="s2">"category"</code>: <code class="s2">"Chemistry"</code>,
  <code class="s2">"country"</code>: <code class="s2">"Belgium"</code>,
  <code class="s2">"date_of_birth"</code>: <code class="s2">"1917-01-25"</code>,
  <code class="s2">"date_of_death"</code>: <code class="s2">"2003-05-28"</code>,
  <code class="s2">"gender"</code>: <code class="s2">"male"</code>,
  <code class="s2">"link"</code>: <code class="s2">"http://en.wikipedia.org/wiki/Ilya_Prigogine"</code>,
  <code class="s2">"name"</code>: <code class="s2">"Ilya Prigogine"</code>,
  <code class="s2">"place_of_birth"</code>: <code class="s2">"Moscow ,  Russia"</code>,
  <code class="s2">"place_of_death"</code>: <code class="s2">"Brussels ,  Belgium"</code>,
  <code class="s2">"text"</code>: <code class="s2">"Ilya Prigogine ,  born in Russia , Chemistry, 1977"</code>,
  <code class="s2">"year"</code>: <code class="m">1977</code>
<code class="o">}</code></pre>
<p>Being able to retrieve all the winners on a single API call isn’t particularly useful. <a data-primary="filtering data" data-secondary="filters for database queries in RESTful API" data-type="indexterm" id="idm45607758633696"/><a data-primary="URL query strings" data-type="indexterm" id="idm45607758629296"/>Let’s add the ability to filter those results with some arguments provided on the request. These arguments are the ones found on the URL query string, starting with a <code>?</code> and separated by <code>&amp;</code>s, which follows the endpoint, e.g., <code>http://nobel.net/api/winners?category=Physics&amp;year=1980</code>.  Flask provides a <code>request.args</code> object that has a <code>to_dict</code> method, returning a dictionary of URL arguments.<sup><a data-type="noteref" href="ch13.xhtml#idm45607758626448" id="idm45607758626448-marker">3</a></sup> We can use this to specify our data table filters, which can be applied as key-value pairs using SQLAlchemy’s <code>to_filter</code> method, which can be applied to queries.<a data-primary="to_filter method (SQLAlchemy)" data-type="indexterm" id="idm45607758625248"/> Here’s a simple implementation:</p>
<pre data-code-language="python" data-type="programlisting"><code class="nd">@app</code><code class="o">.</code><code class="n">route</code><code class="p">(</code><code class="s1">'</code><code class="s1">/winners/</code><code class="s1">'</code><code class="p">)</code><code>
</code><code class="k">def</code><code> </code><code class="nf">winner_list</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">valid_filters</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">category</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">gender</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO5-1" id="co_restful_data_with_flask_CO5-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>    </code><code class="n">filters</code><code> </code><code class="o">=</code><code> </code><code class="n">request</code><code class="o">.</code><code class="n">args</code><code class="o">.</code><code class="n">to_dict</code><code class="p">(</code><code class="p">)</code><code>
</code><code>
</code><code>    </code><code class="n">args</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="n">name</code><code class="p">:</code><code> </code><code class="n">value</code><code> </code><code class="k">for</code><code> </code><code class="n">name</code><code class="p">,</code><code> </code><code class="n">value</code><code> </code><code class="ow">in</code><code> </code><code class="n">filters</code><code class="o">.</code><code class="n">items</code><code class="p">(</code><code class="p">)</code><code>
</code><code>            </code><code class="k">if</code><code> </code><code class="n">name</code><code> </code><code class="ow">in</code><code> </code><code class="n">valid_filters</code><code class="p">}</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO5-2" id="co_restful_data_with_flask_CO5-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>    </code><code class="c1"># This for loop does the same job as the dict</code><code>
</code><code>    </code><code class="c1"># comprehension above</code><code>
</code><code>    </code><code class="c1"># args = {}</code><code>
</code><code>    </code><code class="c1"># for vf in valid_filters:</code><code>
</code><code>    </code><code class="c1">#     if vf in filters:</code><code>
</code><code>    </code><code class="c1">#         args[vf] = filters.get(vf)</code><code>
</code><code>    </code><code class="n">app</code><code class="o">.</code><code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="sa">f</code><code class="s1">'</code><code class="s1">Filtering with the fields: </code><code class="si">{</code><code class="n">args</code><code class="si">}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>    </code><code class="n">all_winners</code><code> </code><code class="o">=</code><code> </code><code class="n">Winner</code><code class="o">.</code><code class="n">query</code><code class="o">.</code><code class="n">filter_by</code><code class="p">(</code><code class="o">*</code><code class="o">*</code><code class="n">args</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO5-3" id="co_restful_data_with_flask_CO5-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code>    </code><code class="n">result</code><code> </code><code class="o">=</code><code> </code><code class="n">winners_schema</code><code class="o">.</code><code class="n">jsonify</code><code class="p">(</code><code class="n">all_winners</code><code class="p">)</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">result</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO5-1" id="callout_restful_data_with_flask_CO5-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>These are the fields we will allow filtering on.</p></dd>
<dt><a class="co" href="#co_restful_data_with_flask_CO5-2" id="callout_restful_data_with_flask_CO5-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We iterate through the filter fields provided and use the valid ones to create our filter dictionary. Here we use a Python <a href="https://oreil.ly/wmy3c">dictionary comprehension</a> to construct the <code>args</code> dictionary.<a data-primary="dictionary comprehension" data-type="indexterm" id="idm45607758464016"/></p></dd>
<dt><a class="co" href="#co_restful_data_with_flask_CO5-3" id="callout_restful_data_with_flask_CO5-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Use Python’s dictionary unpacking to specify method parameters.</p></dd>
</dl>
<p>Let’s test our filtering abilty with curl, using the <code>-d</code> (data) arguments to specify our query parameters:</p>
<pre data-code-language="bash" data-type="programlisting">$ curl -d <code class="nv">category</code><code class="o">=</code>Physics -d <code class="nv">year</code><code class="o">=</code><code class="m">1933</code> --get http://localhost:5000/winners/

<code class="o">[</code>
  <code class="o">{</code>
    <code class="s2">"award_age"</code>: <code class="m">31</code>,
    <code class="s2">"category"</code>: <code class="s2">"Physics"</code>,
    <code class="s2">"country"</code>: <code class="s2">"United Kingdom"</code>,
    <code class="s2">"date_of_birth"</code>: <code class="s2">"1902-08-08"</code>,
    <code class="s2">"date_of_death"</code>: <code class="s2">"1984-10-20"</code>,
    <code class="s2">"gender"</code>: <code class="s2">"male"</code>,
    <code class="s2">"link"</code>: <code class="s2">"http://en.wikipedia.org/wiki/Paul_Dirac"</code>,
    <code class="s2">"name"</code>: <code class="s2">"Paul Dirac"</code>,
    <code class="s2">"place_of_birth"</code>: <code class="s2">"Bristol , England"</code>,
    <code class="s2">"place_of_death"</code>: <code class="s2">"Tallahassee, Florida , US"</code>,
    <code class="s2">"text"</code>: <code class="s2">"Paul Dirac , Physics, 1933"</code>,
    <code class="s2">"year"</code>: <code class="m">1933</code>
  <code class="o">}</code>,
  <code class="o">{</code>
    <code class="s2">"award_age"</code>: <code class="m">46</code>,
    <code class="s2">"category"</code>: <code class="s2">"Physics"</code>,
    <code class="s2">"country"</code>: <code class="s2">"Austria"</code>,
    <code class="s2">"date_of_birth"</code>: <code class="s2">"1887-08-12"</code>,
    <code class="s2">"date_of_death"</code>: <code class="s2">"1961-01-04"</code>,
    <code class="s2">"gender"</code>: <code class="s2">"male"</code>,
    <code class="s2">"link"</code>: <code class="s2">"http://en.wikipedia.org/wiki/Erwin_Schr%C3%B6dinger"</code>,
    <code class="s2">"name"</code>: <code class="s2">"Erwin Schr\u00f6dinger"</code>,
    <code class="s2">"place_of_birth"</code>: <code class="s2">"Erdberg, Vienna, Austria"</code>,
    <code class="s2">"place_of_death"</code>: <code class="s2">"Vienna, Austria"</code>,
    <code class="s2">"text"</code>: <code class="s2">"Erwin Schr\u00f6dinger , Physics, 1933"</code>,
    <code class="s2">"year"</code>: <code class="m">1933</code>
  <code class="o">}</code>
<code class="o">]</code></pre>
<p>We now have fairly fine-grained filtering on our winners dataset, and for many data visualizations, that would be enough to provide a large, user-driven dataset, fetching data from the RESTful API as required. The ability to post or create data entries from the API or a web form is one of those requirements that crops up now and again and is a good <em>to know</em>. It means you can use the API as a central data pool and add to it from various locations.  It’s also very easy to do with Flask and our extensions.</p>
<section data-pdf-bookmark="Posting Data to the API" data-type="sect2"><div class="sect2" id="idm45607758402176">
<h2>Posting Data to the API</h2>
<p>Flask routes take an optional <code>methods</code> argument, which specifies the HTTP verbs accepted. The GET verb is the default, but by setting it to POST we can post data to this route with the packet available on the <code>request</code> object, in this case as JSON encoded data.<a data-primary="posting data to RESTful API" data-type="indexterm" id="idm45607758340208"/><a data-primary="POST method (HTTP)" data-type="indexterm" id="idm45607758339488"/></p>
<p>We add another <code>/winners</code> endpoint, with a <code>methods</code> array containing <code>POST</code>, then use the JSON data to make a <code>winner_data</code> dict that is used to create an entry in the winners table. This is then added to the database session and finally committed. The new entry is returned using marshmallow’s serializing:</p>
<pre data-code-language="python" data-type="programlisting"><code class="nd">@app</code><code class="o">.</code><code class="n">route</code><code class="p">(</code><code class="s1">'/winners/'</code><code class="p">,</code> <code class="n">methods</code><code class="o">=</code><code class="p">[</code><code class="s1">'POST'</code><code class="p">])</code>
<code class="k">def</code> <code class="nf">add_winner</code><code class="p">():</code>
    <code class="n">valid_fields</code> <code class="o">=</code> <code class="n">winner_schema</code><code class="o">.</code><code class="n">fields</code>

    <code class="n">winner_data</code> <code class="o">=</code> <code class="p">{</code><code class="n">name</code><code class="p">:</code> <code class="n">value</code> <code class="k">for</code> <code class="n">name</code><code class="p">,</code>
                   <code class="n">value</code> <code class="ow">in</code> <code class="n">request</code><code class="o">.</code><code class="n">json</code><code class="o">.</code><code class="n">items</code><code class="p">()</code> <code class="k">if</code> <code class="n">name</code> <code class="ow">in</code> <code class="n">valid_fields</code><code class="p">}</code>
    <code class="n">app</code><code class="o">.</code><code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="sa">f</code><code class="s2">"Creating a winner with these fields: </code><code class="si">{</code><code class="n">winner_data</code><code class="si">}</code><code class="s2">"</code><code class="p">)</code>
    <code class="n">new_winner</code> <code class="o">=</code> <code class="n">Winner</code><code class="p">(</code><code class="o">**</code><code class="n">winner_data</code><code class="p">)</code>
    <code class="n">db</code><code class="o">.</code><code class="n">session</code><code class="o">.</code><code class="n">add</code><code class="p">(</code><code class="n">new_winner</code><code class="p">)</code>
    <code class="n">db</code><code class="o">.</code><code class="n">session</code><code class="o">.</code><code class="n">commit</code><code class="p">()</code>
    <code class="k">return</code> <code class="n">winner_schema</code><code class="o">.</code><code class="n">jsonify</code><code class="p">(</code><code class="n">new_winner</code><code class="p">)</code></pre>
<p>Testing with curl returns the expected result:</p>
<pre data-code-language="bash" data-type="programlisting"><code>$</code><code> </code><code>curl</code><code> </code><code>http://localhost:5000/winners/</code><code> </code><code class="se">\
</code><code>    </code><code>-X</code><code> </code><code>POST</code><code> </code><code class="se">\
</code><code>    </code><code>-H</code><code> </code><code class="s2">"Content-Type: application/json"</code><code> </code><code class="se">\
</code><code>    </code><code>-d</code><code> </code><code class="s1">'{"category":"Physics","year":2021,
         "name":"Syukuro Manabe","country":"Japan"}'</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO6-1" id="co_restful_data_with_flask_CO6-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code class="o">{</code><code>
  </code><code class="s2">"award_age"</code><code>:</code><code> </code><code>null,</code><code>
  </code><code class="s2">"category"</code><code>:</code><code> </code><code class="s2">"Physics"</code><code>,</code><code>
  </code><code class="s2">"country"</code><code>:</code><code> </code><code class="s2">"Japan"</code><code>,</code><code>
  </code><code class="s2">"date_of_birth"</code><code>:</code><code> </code><code>null,</code><code>
  </code><code class="s2">"date_of_death"</code><code>:</code><code> </code><code>null,</code><code>
  </code><code class="s2">"gender"</code><code>:</code><code> </code><code>null,</code><code>
  </code><code class="s2">"link"</code><code>:</code><code> </code><code>null,</code><code>
  </code><code class="s2">"name"</code><code>:</code><code> </code><code class="s2">"Syukuro Manabe"</code><code>,</code><code>
  </code><code class="s2">"place_of_birth"</code><code>:</code><code> </code><code>null,</code><code>
  </code><code class="s2">"place_of_death"</code><code>:</code><code> </code><code>null,</code><code>
  </code><code class="s2">"text"</code><code>:</code><code> </code><code>null,</code><code>
  </code><code class="s2">"year"</code><code>:</code><code> </code><code class="m">2021</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO6-1" id="callout_restful_data_with_flask_CO6-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The input data is a JSON encoded string.</p></dd>
</dl>
<p>Perhaps more useful for data management is an API endpoint enabling a winner’s data to be updated. For this we can use the HTTP PATCH verb called on an individual URL.<a data-primary="PATCH method (HTTP)" data-type="indexterm" id="idm45607758111536"/> As with the POST to create a new winner, we cycle through the <code>request.json</code> dictionary and use any valid fields, in this case all available to marshmallow’s serializer, to update the attributes of the winner by ID:</p>
<pre data-code-language="python" data-type="programlisting"><code class="nd">@app</code><code class="o">.</code><code class="n">route</code><code class="p">(</code><code class="s1">'/winners/&lt;id&gt;/'</code><code class="p">,</code> <code class="n">methods</code><code class="o">=</code><code class="p">[</code><code class="s1">'PATCH'</code><code class="p">])</code>
<code class="k">def</code> <code class="nf">update_winner</code><code class="p">(</code><code class="nb">id</code><code class="p">):</code>
    <code class="n">winner</code> <code class="o">=</code> <code class="n">Winner</code><code class="o">.</code><code class="n">query</code><code class="o">.</code><code class="n">get_or_404</code><code class="p">(</code><code class="nb">id</code><code class="p">)</code>
    <code class="n">valid_fields</code> <code class="o">=</code> <code class="n">winner_schema</code><code class="o">.</code><code class="n">fields</code>
    <code class="n">winner_data</code> <code class="o">=</code> <code class="p">{</code><code class="n">name</code><code class="p">:</code> <code class="n">value</code> <code class="k">for</code> <code class="n">name</code><code class="p">,</code> <code class="n">value</code>
                    <code class="ow">in</code> <code class="n">request</code><code class="o">.</code><code class="n">json</code><code class="o">.</code><code class="n">items</code><code class="p">()</code> <code class="k">if</code> <code class="n">name</code> <code class="ow">in</code> <code class="n">valid_fields</code><code class="p">}</code>
    <code class="n">app</code><code class="o">.</code><code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="sa">f</code><code class="s2">"Updating a winner with these fields: </code><code class="si">{</code><code class="n">winner_data</code><code class="si">}</code><code class="s2">"</code><code class="p">)</code>
    <code class="k">for</code> <code class="n">k</code><code class="p">,</code> <code class="n">v</code> <code class="ow">in</code> <code class="n">winner_data</code><code class="o">.</code><code class="n">items</code><code class="p">():</code>
        <code class="nb">setattr</code><code class="p">(</code><code class="n">winner</code><code class="p">,</code> <code class="n">k</code><code class="p">,</code> <code class="n">v</code><code class="p">)</code>
    <code class="n">db</code><code class="o">.</code><code class="n">session</code><code class="o">.</code><code class="n">commit</code><code class="p">()</code>
    <code class="k">return</code> <code class="n">winner_schema</code><code class="o">.</code><code class="n">jsonify</code><code class="p">(</code><code class="n">winner</code><code class="p">)</code></pre>
<p>Here we use this API patch point to update, for the purposes of demonstration,  the name and prize year of a Nobel winner:</p>
<pre data-code-language="bash" data-type="programlisting"><code>$</code><code> </code><code>curl</code><code> </code><code>http://localhost:5000/winners/3/</code><code> </code><code class="se">\
</code><code>    </code><code>-X</code><code> </code><code>PATCH</code><code> </code><code class="se">\
</code><code>    </code><code>-H</code><code> </code><code class="s2">"Content-Type: application/json"</code><code> </code><code class="se">\
</code><code>    </code><code>-d</code><code> </code><code class="s1">'{"name":"Morris Maeterlink","year":"1912"}'</code><code>
</code><code class="o">{</code><code>
  </code><code class="s2">"award_age"</code><code>:</code><code> </code><code class="m">49</code><code>,</code><code>
  </code><code class="s2">"category"</code><code>:</code><code> </code><code class="s2">"Literature"</code><code>,</code><code>
  </code><code class="s2">"country"</code><code>:</code><code> </code><code class="s2">"Belgium"</code><code>,</code><code>
  </code><code class="s2">"date_of_birth"</code><code>:</code><code> </code><code class="s2">"1862-08-29"</code><code>,</code><code>
  </code><code class="s2">"date_of_death"</code><code>:</code><code> </code><code class="s2">"1949-05-06"</code><code>,</code><code>
  </code><code class="s2">"gender"</code><code>:</code><code> </code><code class="s2">"male"</code><code>,</code><code>
  </code><code class="s2">"link"</code><code>:</code><code> </code><code class="s2">"http://en.wikipedia.org/wiki/Maurice_Maeterlinck"</code><code>,</code><code>
  </code><code class="s2">"name"</code><code>:</code><code> </code><code class="s2">"Morris Maeterlink"</code><code>,</code><code>
  </code><code class="s2">"place_of_birth"</code><code>:</code><code> </code><code class="s2">"Ghent ,  Belgium"</code><code>,</code><code>
  </code><code class="s2">"place_of_death"</code><code>:</code><code> </code><code class="s2">"Nice ,  France"</code><code>,</code><code>
  </code><code class="s2">"text"</code><code>:</code><code> </code><code class="s2">"Maurice Maeterlinck , Literature, 1911"</code><code>,</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO7-1" id="co_restful_data_with_flask_CO7-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
  </code><code class="s2">"year"</code><code>:</code><code> </code><code class="m">1912</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO7-1" id="callout_restful_data_with_flask_CO7-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The original details.</p></dd>
</dl>
<p>At this point we have built a useful, targeted API able to fetch data according to fine-grained filters and update or create winners. If you wanted to add more endpoints covering a few more database tables, the Flask routing boilerplate and associated methods can get a little messy. Flask MethodViews provide a way of encapsulating our endpoint API calls in a single class instance, making things cleaner and more extendible. It’s easy to transfer our existing API to MethodViews and the reduced cognitive load will pay off as your APIs get more involved.<a data-primary="routing" data-secondary="adding routes to RESTful API" data-startref="ix_rte" data-type="indexterm" id="idm45607757871520"/><a data-primary="RESTful APIs" data-secondary="creating with Flask" data-startref="ix_RESTFlskrt" data-tertiary="adding routes" data-type="indexterm" id="idm45607757870416"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Extending the API with MethodViews" data-type="sect1"><div class="sect1" id="idm45607758917824">
<h1>Extending the API with MethodViews</h1>
<p>We can reuse the bulk of our API’s code, and shifting it to MethodViews loses a pleasing amount of boilerplate too.<a data-primary="Flask" data-secondary="creating a RESTful API" data-tertiary="extending the API with MethodViews" data-type="indexterm" id="ix_FlskRESText"/><a data-primary="RESTful APIs" data-secondary="creating with Flask" data-tertiary="extending the API with MethodViews" data-type="indexterm" id="ix_RESTFlskext"/><a data-primary="MethodViews" data-type="indexterm" id="ix_MthVw"/><a data-primary="HTTP methods" data-secondary="encapsulation in MethodViews" data-type="indexterm" id="idm45607757835088"/> MethodViews encapsulate endpoints and their associated HTTP verbs (GET, POST, etc.) in a single class instance, which can be easily extended and adapted. To shift our winners table to a dedicated resource, we can just lift the existing Flask route methods into a <code>MethodView</code> class and make a few minor adjustments. <a data-primary="routing" data-secondary="using MethodViews in RESTful API" data-type="indexterm" id="idm45607757833728"/>First, we’ll need to import the <code>MethodView</code> class:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1">#...</code>
<code class="kn">from</code> <code class="nn">flask.views</code> <code class="kn">import</code> <code class="n">MethodView</code>
<code class="c1">#...</code></pre>
<p>The SQLAlchemy model and marshmallow schemas don’t need changing. Now we create a <code>MethodView</code> instance for our winners collection with methods for the relevant HTTP verbs. We can reuse the existing route methods. We then use the Flask app’s <code>add_url_rule</code> method to provide an endpoint, which the view will handle:</p>
<pre data-code-language="python" data-type="programlisting"><code class="k">class</code> <code class="nc">WinnersListView</code><code class="p">(</code><code class="n">MethodView</code><code class="p">):</code>

    <code class="k">def</code> <code class="nf">get</code><code class="p">(</code><code class="bp">self</code><code class="p">):</code>
        <code class="n">valid_filters</code> <code class="o">=</code> <code class="p">(</code><code class="s1">'year'</code><code class="p">,</code> <code class="s1">'category'</code><code class="p">,</code> <code class="s1">'gender'</code><code class="p">,</code> <code class="s1">'country'</code><code class="p">,</code> <code class="s1">'name'</code><code class="p">)</code>
        <code class="n">filters</code> <code class="o">=</code> <code class="n">request</code><code class="o">.</code><code class="n">args</code><code class="o">.</code><code class="n">to_dict</code><code class="p">()</code>
        <code class="n">args</code> <code class="o">=</code> <code class="p">{</code><code class="n">name</code><code class="p">:</code> <code class="n">value</code> <code class="k">for</code> <code class="n">name</code><code class="p">,</code> <code class="n">value</code> <code class="ow">in</code> <code class="n">filters</code><code class="o">.</code><code class="n">items</code><code class="p">()</code>
                <code class="k">if</code> <code class="n">name</code> <code class="ow">in</code> <code class="n">valid_filters</code><code class="p">}</code>
        <code class="n">app</code><code class="o">.</code><code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="s1">'Filtering with the </code><code class="si">%s</code><code class="s1"> fields'</code> <code class="o">%</code> <code class="p">(</code><code class="nb">str</code><code class="p">(</code><code class="n">args</code><code class="p">)))</code>
        <code class="n">all_winners</code> <code class="o">=</code> <code class="n">Winner</code><code class="o">.</code><code class="n">query</code><code class="o">.</code><code class="n">filter_by</code><code class="p">(</code><code class="o">**</code><code class="n">args</code><code class="p">)</code>
        <code class="n">result</code> <code class="o">=</code> <code class="n">winners_schema</code><code class="o">.</code><code class="n">jsonify</code><code class="p">(</code><code class="n">all_winners</code><code class="p">)</code>
        <code class="k">return</code> <code class="n">result</code>

    <code class="k">def</code> <code class="nf">post</code><code class="p">(</code><code class="bp">self</code><code class="p">):</code>
        <code class="n">valid_fields</code> <code class="o">=</code> <code class="n">winner_schema</code><code class="o">.</code><code class="n">fields</code>
        <code class="n">winner_data</code> <code class="o">=</code> <code class="p">{</code><code class="n">name</code><code class="p">:</code> <code class="n">value</code> <code class="k">for</code> <code class="n">name</code><code class="p">,</code>
                       <code class="n">value</code> <code class="ow">in</code> <code class="n">request</code><code class="o">.</code><code class="n">json</code><code class="o">.</code><code class="n">items</code><code class="p">()</code> <code class="k">if</code> <code class="n">name</code> <code class="ow">in</code> <code class="n">valid_fields</code><code class="p">}</code>
        <code class="n">app</code><code class="o">.</code><code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="s2">"Creating a winner with these fields: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code>
                        <code class="nb">str</code><code class="p">(</code><code class="n">winner_data</code><code class="p">))</code>
        <code class="n">new_winner</code> <code class="o">=</code> <code class="n">Winner</code><code class="p">(</code><code class="o">**</code><code class="n">winner_data</code><code class="p">)</code>
        <code class="n">db</code><code class="o">.</code><code class="n">session</code><code class="o">.</code><code class="n">add</code><code class="p">(</code><code class="n">new_winner</code><code class="p">)</code>
        <code class="n">db</code><code class="o">.</code><code class="n">session</code><code class="o">.</code><code class="n">commit</code><code class="p">()</code>
        <code class="k">return</code> <code class="n">winner_schema</code><code class="o">.</code><code class="n">jsonify</code><code class="p">(</code><code class="n">new_winner</code><code class="p">)</code>

<code class="n">app</code><code class="o">.</code><code class="n">add_url_rule</code><code class="p">(</code><code class="s2">"/winners/"</code><code class="p">,</code>
                 <code class="n">view_func</code><code class="o">=</code><code class="n">WinnersListView</code><code class="o">.</code><code class="n">as_view</code><code class="p">(</code><code class="s2">"winners_list_view"</code><code class="p">))</code></pre>
<p>To create HTTP methods for individual table entries follows the same pattern. We’ll add a delete method for good measure. Successful HTTP deletes should return the 204 (no content) HTTP code and an empty content package:</p>
<pre data-code-language="python" data-type="programlisting"><code class="k">class</code><code> </code><code class="nc">WinnerView</code><code class="p">(</code><code class="n">MethodView</code><code class="p">)</code><code class="p">:</code><code>
</code><code>
</code><code>    </code><code class="k">def</code><code> </code><code class="nf">get</code><code class="p">(</code><code class="bp">self</code><code class="p">,</code><code> </code><code class="n">winner_id</code><code class="p">)</code><code class="p">:</code><code>
</code><code>        </code><code class="n">winner</code><code> </code><code class="o">=</code><code> </code><code class="n">Winner</code><code class="o">.</code><code class="n">query</code><code class="o">.</code><code class="n">get_or_404</code><code class="p">(</code><code class="n">winner_id</code><code class="p">)</code><code>
</code><code>        </code><code class="n">result</code><code> </code><code class="o">=</code><code> </code><code class="n">winner_schema</code><code class="o">.</code><code class="n">jsonify</code><code class="p">(</code><code class="n">winner</code><code class="p">)</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">result</code><code>
</code><code>
</code><code>    </code><code class="k">def</code><code> </code><code class="nf">patch</code><code class="p">(</code><code class="bp">self</code><code class="p">,</code><code> </code><code class="n">winner_id</code><code class="p">)</code><code class="p">:</code><code>
</code><code>        </code><code class="n">winner</code><code> </code><code class="o">=</code><code> </code><code class="n">Winner</code><code class="o">.</code><code class="n">query</code><code class="o">.</code><code class="n">get_or_404</code><code class="p">(</code><code class="n">winner_id</code><code class="p">)</code><code>
</code><code>        </code><code class="n">valid_fields</code><code> </code><code class="o">=</code><code> </code><code class="n">winner_schema</code><code class="o">.</code><code class="n">fields</code><code>
</code><code>        </code><code class="n">winner_data</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="n">name</code><code class="p">:</code><code> </code><code class="n">value</code><code> </code><code class="k">for</code><code> </code><code class="n">name</code><code class="p">,</code><code>
</code><code>                       </code><code class="n">value</code><code> </code><code class="ow">in</code><code> </code><code class="n">request</code><code class="o">.</code><code class="n">json</code><code class="o">.</code><code class="n">items</code><code class="p">(</code><code class="p">)</code><code> </code><code class="k">if</code><code> </code><code class="n">name</code><code> </code><code class="ow">in</code><code> </code><code class="n">valid_fields</code><code class="p">}</code><code>
</code><code>        </code><code class="n">app</code><code class="o">.</code><code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="s2">"</code><code class="s2">Updating a winner with these fields: </code><code class="si">%s</code><code class="s2">"</code><code> </code><code class="o">%</code><code>
</code><code>                        </code><code class="nb">str</code><code class="p">(</code><code class="n">winner_data</code><code class="p">)</code><code class="p">)</code><code>
</code><code>        </code><code class="k">for</code><code> </code><code class="n">k</code><code class="p">,</code><code> </code><code class="n">v</code><code> </code><code class="ow">in</code><code> </code><code class="n">winner_data</code><code class="o">.</code><code class="n">items</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code>
</code><code>            </code><code class="nb">setattr</code><code class="p">(</code><code class="n">winner</code><code class="p">,</code><code> </code><code class="n">k</code><code class="p">,</code><code> </code><code class="n">v</code><code class="p">)</code><code>
</code><code>        </code><code class="n">db</code><code class="o">.</code><code class="n">session</code><code class="o">.</code><code class="n">commit</code><code class="p">(</code><code class="p">)</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">winner_schema</code><code class="o">.</code><code class="n">jsonify</code><code class="p">(</code><code class="n">winner</code><code class="p">)</code><code>
</code><code>
</code><code>    </code><code class="k">def</code><code> </code><code class="nf">delete</code><code class="p">(</code><code class="bp">self</code><code class="p">,</code><code> </code><code class="n">winner_id</code><code class="p">)</code><code class="p">:</code><code>
</code><code>        </code><code class="n">winner</code><code> </code><code class="o">=</code><code> </code><code class="n">Winner</code><code class="o">.</code><code class="n">query</code><code class="o">.</code><code class="n">get_or_404</code><code class="p">(</code><code class="n">winner_id</code><code class="p">)</code><code>
</code><code>        </code><code class="n">db</code><code class="o">.</code><code class="n">session</code><code class="o">.</code><code class="n">delete</code><code class="p">(</code><code class="n">winner</code><code class="p">)</code><code>
</code><code>        </code><code class="n">db</code><code class="o">.</code><code class="n">session</code><code class="o">.</code><code class="n">commit</code><code class="p">(</code><code class="p">)</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="s1">'</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="mi">204</code><code>
</code><code>
</code><code class="n">app</code><code class="o">.</code><code class="n">add_url_rule</code><code class="p">(</code><code class="s2">"</code><code class="s2">/winners/&lt;winner_id&gt;</code><code class="s2">"</code><code class="p">,</code><code>
</code><code>                 </code><code class="n">view_func</code><code class="o">=</code><code class="n">WinnerView</code><code class="o">.</code><code class="n">as_view</code><code class="p">(</code><code class="s2">"</code><code class="s2">winner_view</code><code class="s2">"</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO8-1" id="co_restful_data_with_flask_CO8-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO8-1" id="callout_restful_data_with_flask_CO8-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The named, pattern-matched arguments are passed to all the MethodViews methods.</p></dd>
</dl>
<p>Let’s use curl to delete one of our winners, specifying a verbose output:</p>
<pre data-type="programlisting">$ curl http://localhost:5000/winners/858 -X DELETE -v
*   Trying 127.0.0.1...
* Connected to localhost (127.0.0.1) port 5000 (#0)
&gt; DELETE /winners/858 HTTP/1.1
&gt; Host: localhost:5000
&gt; User-Agent: curl/7.47.0
&gt; Accept: */*
&gt;
* HTTP 1.0, assume close after body
&lt; HTTP/1.0 204 NO CONTENT
&lt; Content-Type: application/json
&lt; Server: Werkzeug/2.0.2 Python/3.8.9
&lt; Date: Sun, 27 Mar 2022 15:35:51 GMT
&lt;
* Closing connection 0</pre>
<p>By using MethodViews on dedicated endpoints, we cut out a lot of Flask’s routing boilerplate and make the codebase easier to work with and extend. By way of example, let’s see how to add a very handy API feature, the ability to paginate or chunk data.<a data-primary="Flask" data-secondary="creating a RESTful API" data-startref="ix_FlskRESText" data-tertiary="extending the API with MethodViews" data-type="indexterm" id="idm45607757347840"/><a data-primary="MethodViews" data-startref="ix_MthVw" data-type="indexterm" id="idm45607757346352"/><a data-primary="RESTful APIs" data-secondary="creating with Flask" data-startref="ix_RESTFlskext" data-tertiary="extending the API with MethodViews" data-type="indexterm" id="idm45607757345408"/></p>
</div></section>
<section data-pdf-bookmark="Paginating the Data Returns" data-type="sect1"><div class="sect1" id="idm45607757868336">
<h1>Paginating the Data Returns</h1>
<p>If you have large datasets and anticipate large result sets, the ability to receive that data in paginated chunks is a very useful API feature; for many use cases, a vital one.<a data-primary="pagination, data returns from RESTful API" data-type="indexterm" id="ix_pagi"/><a data-primary="RESTful APIs" data-secondary="creating with Flask" data-tertiary="paginating data returns" data-type="indexterm" id="ix_RESTFlskpag"/></p>
<p>SQLAlchemy has a handy <code>paginate</code> method that can be called on queries to return pages of data of a specified page size. <a data-primary="SQLAlchemy" data-secondary="paginating data returns" data-type="indexterm" id="idm45607757338912"/>To add pagination to our winners API, we just need to add a couple of query parameters to specify the page and page size. We’ll use <code>_page</code> and <code>_page-size</code> and prefix them with an underscore to distinguish them from any filter queries we may apply.</p>
<p>Here’s the adapted <code>get</code> method:</p>
<pre data-code-language="python" data-type="programlisting"><code class="k">class</code><code> </code><code class="nc">WinnersListView</code><code class="p">(</code><code class="n">MethodView</code><code class="p">)</code><code class="p">:</code><code>
</code><code>
</code><code>    </code><code class="k">def</code><code> </code><code class="nf">get</code><code class="p">(</code><code class="bp">self</code><code class="p">)</code><code class="p">:</code><code>
</code><code>        </code><code class="n">valid_filters</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="s1">'</code><code class="s1">year</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">category</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">gender</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>        </code><code class="n">filters</code><code> </code><code class="o">=</code><code> </code><code class="n">request</code><code class="o">.</code><code class="n">args</code><code class="o">.</code><code class="n">to_dict</code><code class="p">(</code><code class="p">)</code><code>
</code><code>        </code><code class="n">args</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="n">name</code><code class="p">:</code><code> </code><code class="n">value</code><code> </code><code class="k">for</code><code> </code><code class="n">name</code><code class="p">,</code><code> </code><code class="n">value</code><code> </code><code class="ow">in</code><code> </code><code class="n">filters</code><code class="o">.</code><code class="n">items</code><code class="p">(</code><code class="p">)</code><code>
</code><code>                </code><code class="k">if</code><code> </code><code class="n">name</code><code> </code><code class="ow">in</code><code> </code><code class="n">valid_filters</code><code class="p">}</code><code>
</code><code>
</code><code>        </code><code class="n">app</code><code class="o">.</code><code class="n">logger</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="sa">f</code><code class="s1">'</code><code class="s1">Filtering with the </code><code class="si">{</code><code class="n">args</code><code class="si">}</code><code class="s1"> fields</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>
</code><code>        </code><code class="n">page</code><code> </code><code class="o">=</code><code> </code><code class="n">request</code><code class="o">.</code><code class="n">args</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s2">"</code><code class="s2">_page</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="nb">type</code><code class="o">=</code><code class="nb">int</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO9-1" id="co_restful_data_with_flask_CO9-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>        </code><code class="n">per_page</code><code> </code><code class="o">=</code><code> </code><code class="n">request</code><code class="o">.</code><code class="n">args</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s2">"</code><code class="s2">_per-page</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="mi">20</code><code class="p">,</code><code> </code><code class="nb">type</code><code class="o">=</code><code class="nb">int</code><code class="p">)</code><code>
</code><code>
</code><code>        </code><code class="n">winners</code><code> </code><code class="o">=</code><code> </code><code class="n">Winner</code><code class="o">.</code><code class="n">query</code><code class="o">.</code><code class="n">filter_by</code><code class="p">(</code><code class="o">*</code><code class="o">*</code><code class="n">args</code><code class="p">)</code><code class="o">.</code><code class="n">paginate</code><code class="p">(</code><code class="n">page</code><code class="p">,</code><code> </code><code class="n">per_page</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO9-2" id="co_restful_data_with_flask_CO9-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>        </code><code class="n">winners_dumped</code><code> </code><code class="o">=</code><code> </code><code class="n">winners_schema</code><code class="o">.</code><code class="n">dump</code><code class="p">(</code><code class="n">winners</code><code class="o">.</code><code class="n">items</code><code class="p">)</code><code>
</code><code>
</code><code>        </code><code class="n">results</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code>
</code><code>            </code><code class="s2">"</code><code class="s2">results</code><code class="s2">"</code><code class="p">:</code><code> </code><code class="n">winners_dumped</code><code class="p">,</code><code>
</code><code>            </code><code class="s2">"</code><code class="s2">filters</code><code class="s2">"</code><code class="p">:</code><code> </code><code class="n">args</code><code class="p">,</code><code>
</code><code>            </code><code class="s2">"</code><code class="s2">pagination</code><code class="s2">"</code><code class="p">:</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO9-3" id="co_restful_data_with_flask_CO9-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code>            </code><code class="p">{</code><code>
</code><code>                </code><code class="s2">"</code><code class="s2">count</code><code class="s2">"</code><code class="p">:</code><code> </code><code class="n">winners</code><code class="o">.</code><code class="n">total</code><code class="p">,</code><code>
</code><code>                </code><code class="s2">"</code><code class="s2">page</code><code class="s2">"</code><code class="p">:</code><code> </code><code class="n">page</code><code class="p">,</code><code>
</code><code>                </code><code class="s2">"</code><code class="s2">per_page</code><code class="s2">"</code><code class="p">:</code><code> </code><code class="n">per_page</code><code class="p">,</code><code>
</code><code>                </code><code class="s2">"</code><code class="s2">pages</code><code class="s2">"</code><code class="p">:</code><code> </code><code class="n">winners</code><code class="o">.</code><code class="n">pages</code><code class="p">,</code><code>
</code><code>            </code><code class="p">}</code><code class="p">,</code><code>
</code><code>        </code><code class="p">}</code><code>
</code><code>
</code><code>        </code><code class="n">make_pagination_links</code><code class="p">(</code><code class="s1">'</code><code class="s1">winners</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">results</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO9-4" id="co_restful_data_with_flask_CO9-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a><code>
</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">jsonify</code><code class="p">(</code><code class="n">results</code><code class="p">)</code><code>
</code><code>    </code><code class="c1"># ...</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO9-1" id="callout_restful_data_with_flask_CO9-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The pagination parameters with sensible defaults.</p></dd>
<dt><a class="co" href="#co_restful_data_with_flask_CO9-2" id="callout_restful_data_with_flask_CO9-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Here we use SQLAlchemy’s <code>paginate</code> method with our <code>page</code> and <code>per_page</code> pagination variables.</p></dd>
<dt><a class="co" href="#co_restful_data_with_flask_CO9-3" id="callout_restful_data_with_flask_CO9-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>We return our paginated results and anything else that makes sense. In the <code>pagination</code> dict we provide useful feedback—the page being returned and the size of the total dataset.</p></dd>
<dt><a class="co" href="#co_restful_data_with_flask_CO9-4" id="callout_restful_data_with_flask_CO9-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></dt>
<dd><p>We’ll use this function to add some handy URLs to fetch previous or next pages.</p></dd>
</dl>
<p>By convention it’s useful to return URL endpoints for previous and next pages, to allow easy consumption of the total dataset. We have a little <code>make_pagination_links</code> function for this, which adds these convenient URLs to the pagination dictionary. We’ll use Python’s <em>urllib</em> library to construct our URL’s query string:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1">#...</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">urllib</code><code class="nn">.</code><code class="nn">parse</code><code>
</code><code class="c1">#...</code><code>
</code><code class="k">def</code><code> </code><code class="nf">make_pagination_links</code><code class="p">(</code><code class="n">url</code><code class="p">,</code><code> </code><code class="n">results</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">pag</code><code> </code><code class="o">=</code><code> </code><code class="n">results</code><code class="p">[</code><code class="s1">'</code><code class="s1">pagination</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>    </code><code class="n">query_string</code><code> </code><code class="o">=</code><code> </code><code class="n">urllib</code><code class="o">.</code><code class="n">parse</code><code class="o">.</code><code class="n">urlencode</code><code class="p">(</code><code class="n">results</code><code class="p">[</code><code class="s1">'</code><code class="s1">filters</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO10-1" id="co_restful_data_with_flask_CO10-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>
</code><code>    </code><code class="n">page</code><code> </code><code class="o">=</code><code> </code><code class="n">pag</code><code class="p">[</code><code class="s1">'</code><code class="s1">page</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>    </code><code class="k">if</code><code> </code><code class="n">page</code><code> </code><code class="o">&gt;</code><code> </code><code class="mi">1</code><code class="p">:</code><code>
</code><code>        </code><code class="n">prev_page</code><code> </code><code class="o">=</code><code> </code><code class="n">url</code><code> </code><code class="o">+</code><code> </code><code class="s1">'</code><code class="s1">?_page=</code><code class="si">%d</code><code class="s1">&amp;_per-page=</code><code class="si">%d</code><code class="si">%s</code><code class="s1">'</code><code> </code><code class="o">%</code><code> </code><code class="p">(</code><code class="n">page</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code>
</code><code>                                                        </code><code class="n">pag</code><code class="p">[</code><code class="s1">'</code><code class="s1">per_page</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                                        </code><code class="n">query_string</code><code class="p">)</code><code>
</code><code>    </code><code class="k">else</code><code class="p">:</code><code>
</code><code>        </code><code class="n">prev_page</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">'</code><code>
</code><code>
</code><code>    </code><code class="k">if</code><code> </code><code class="n">page</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">pag</code><code class="p">[</code><code class="s1">'</code><code class="s1">pages</code><code class="s1">'</code><code class="p">]</code><code class="p">:</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO10-2" id="co_restful_data_with_flask_CO10-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>        </code><code class="n">next_page</code><code> </code><code class="o">=</code><code> </code><code class="n">url</code><code> </code><code class="o">+</code><code> </code><code class="s1">'</code><code class="s1">?_page=</code><code class="si">%d</code><code class="s1">&amp;_per-page=</code><code class="si">%d</code><code class="si">%s</code><code class="s1">'</code><code> </code><code class="o">%</code><code> </code><code class="p">(</code><code class="n">page</code><code class="o">+</code><code class="mi">1</code><code class="p">,</code><code>
</code><code>                                                        </code><code class="n">pag</code><code class="p">[</code><code class="s1">'</code><code class="s1">per_page</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                                        </code><code class="n">query_string</code><code class="p">)</code><code>
</code><code>    </code><code class="k">else</code><code class="p">:</code><code>
</code><code>        </code><code class="n">next_page</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">'</code><code>
</code><code>
</code><code>    </code><code class="n">pag</code><code class="p">[</code><code class="s1">'</code><code class="s1">prev_page</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">prev_page</code><code>
</code><code>    </code><code class="n">pag</code><code class="p">[</code><code class="s1">'</code><code class="s1">next_page</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">next_page</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO10-1" id="callout_restful_data_with_flask_CO10-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>We’ll remake our query string from the filter queries, e.g., <code>&amp;category=Chemistry&amp;year=1976</code>. <em>urllib</em>’s parse module turns the filters dict into a correctly formatted URL query.</p></dd>
<dt><a class="co" href="#co_restful_data_with_flask_CO10-2" id="callout_restful_data_with_flask_CO10-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Add previous and next page URLs where applicable, appending any filter queries to the result.</p></dd>
</dl>
<p>Let’s use curl to test our paginated data. We’ll add a filter to get all the Nobel Prize–winning physicists:</p>
<pre data-type="programlisting">$ curl -d category=Physics  --get http://localhost:5000/winners/

{
  "filters": {
    "category": "Physics"
  },
  "pagination": {
    "count": 201,
    "next_page": "?_page=2&amp;_per-page=20&amp;category=Physics", <a class="co" href="#callout_restful_data_with_flask_CO11-1" id="co_restful_data_with_flask_CO11-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a>
    "page": 1,
    "pages": 11,
    "per_page": 20,
    "prev_page": ""
  },
  "results": [ <a class="co" href="#callout_restful_data_with_flask_CO11-2" id="co_restful_data_with_flask_CO11-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a>
    {
      "award_age": 81,
      "category": "Physics",
      "country": "Belgium",
      "date_of_birth": "1932-11-06",
      "date_of_death": "NaT",
      "gender": "male",
      "link": "http://en.wikipedia.org/wiki/Fran%C3%A7ois_Englert",
      "name": "Fran\u00e7ois Englert",
      "place_of_birth": "Etterbeek ,  Brussels ,  Belgium",
      "place_of_death": null,
      "text": "Fran\u00e7ois Englert , Physics, 2013",
      "year": 2013
    },
    {
      "award_age": 37,
      "category": "Physics",
      "country": "Denmark",
      "date_of_birth": "1885-10-07",
      "date_of_death": "1962-11-18",
      "gender": "male",
      "link": "http://en.wikipedia.org/wiki/Niels_Bohr",
      "name": "Niels Bohr",
    ...
    }]}</pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO11-1" id="callout_restful_data_with_flask_CO11-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>This is a first page, so no previous pages are available, but the next page’s URL is provided to allow easy consumption of the data.</p></dd>
<dt><a class="co" href="#co_restful_data_with_flask_CO11-2" id="callout_restful_data_with_flask_CO11-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>A results array containing the first 20 physicists in the winners table.</p></dd>
</dl>
<p>With powerful libraries like marshmallow integrated as Flask extensions, it’s easy enough to roll your own API without needing to resort to a dedicated RESTful Flask library which, experience suggests, might not be around too long.<a data-primary="pagination, data returns from RESTful API" data-startref="ix_pagi" data-type="indexterm" id="idm45607756708784"/><a data-primary="RESTful APIs" data-secondary="creating with Flask" data-startref="ix_RESTFlskpag" data-tertiary="paginating data returns" data-type="indexterm" id="idm45607756707936"/></p>
</div></section>
<section data-pdf-bookmark="Deploying the API Remotely with Heroku" data-type="sect1"><div class="sect1" id="idm45607757343360">
<h1>Deploying the API Remotely with Heroku</h1>
<p>Having a local development data server like the one we just built is great for prototyping, testing data flow, and all number of dataviz things dealing with datasets too large to comfortably be consumed as a JSON (or equivalent) file.<a data-primary="Flask" data-secondary="creating a RESTful API" data-tertiary="deploying API remotely with Heroku" data-type="indexterm" id="ix_FlskRESTdep"/><a data-primary="Heroku, deploying RESTful API remotely via" data-type="indexterm" id="ix_Hrok"/><a data-primary="RESTful APIs" data-secondary="creating with Flask" data-tertiary="deploying API remotely with Heroku" data-type="indexterm" id="ix_RESTFlskdep"/> But it does mean that anyone trying out visualization needs to run a local data server, which is just one more thing to think about. This is where it can be very useful to put the data server on the web as a remote resource. There are various ways this can be done, but possibly the favorite among Pythonistas, including myself, is <a href="https://oreil.ly/V4Q6h">Heroku</a>, a cloud service that makes deploying a Flask server pretty trivial. Let’s demo this by putting our Nobel data server on the web.</p>
<p>First, you’ll need to create a <a href="https://signup.heroku.com">free Heroku account</a>. You’ll then need to install the <a href="https://oreil.ly/wutXG">Heroku client tools</a> for your OS.</p>
<p>With the tools installed, you can log into Heroku by running <code>login</code> from the command line:</p>
<pre data-type="programlisting">$ heroku login
heroku: Press any key to open up the browser to login or q to exit
 ›   Warning: If browser does not open, visit
 ›   https://cli-auth.heroku.com/auth/browser/***
heroku: Waiting for login...
Logging in... done
Logged in as me@example.com</pre>
<p>Now you’re logged in, we’re going to create a Heroku app and deploy it to the web. First, we create an app directory (<em>heroku_api</em>) and put our Flask API <em>api_rest.py</em> file in it. We’ll also need a Procfile, a <em>requirements.txt</em> file, and the <code>nobel_winners_cleaned_api.db</code> SQLite database to be served:</p>
<pre data-type="programlisting">heroku_api
├── api_rest.py
├── data
│   ├── nobel_winners_cleaned_api.db
├── Procfile
└── requirements.txt</pre>
<p>The Procfile is used by Heroku to know what and how to deploy. In this case we’re going to use Python’s <a href="https://oreil.ly/yBTdb">Gunicorn WSGI HTTP server</a> to negotiate web traffic with our Flask app and run it as a Heroku app. The Procfile looks like this:</p>
<pre data-type="programlisting">web: gunicorn api_rest:app</pre>
<p>As well as the Procfile, Heroku needs to know the Python libraries to install for the app. These are found in the <em>requirements.txt</em> file:</p>
<pre data-type="programlisting">Flask==2.0.2
gunicorn==20.1.0
Flask-Cors==3.0.10
flask-marshmallow==0.14.0
Flask-SQLAlchemy==2.5.1
Jinja2==3.0.1
marshmallow==3.15.0
marshmallow-sqlalchemy==0.28.0
SQLAlchemy==1.4.26
Werkzeug==2.0.2</pre>
<p>With the Heroku config files in place, we can create a Heroku app by running <code>create</code> from the command line.</p>
<p>We’ll now use <code>git</code> to initialize a Git directory and add the existing files:</p>
<pre data-type="programlisting">$ git init
$ git add .
$ git commit -m "First commit"</pre>
<p>With <code>git</code> initialized, we just create our Heroku app:<sup><a data-type="noteref" href="ch13.xhtml#idm45607756688512" id="idm45607756688512-marker">4</a></sup></p>
<pre data-type="programlisting">$ heroku create flask-rest-pyjs2</pre>
<p>To deploy to Heroku is now just a <code>git push</code> away:</p>
<pre data-type="programlisting">$ git push heroku master</pre>
<p>Every time you make changes to the local codebase, just push them to Heroku and the site will update.</p>
<p>Let’s test the API with curl by getting the first page of the Physics winners:</p>
<pre data-type="programlisting"> $ curl -d category=Physics --get
                       https://flask-rest-pyjs2.herokuapp.com/winners/
{"filters":{"category":"Physics"},"pagination":{"count":201,
"next_page":"winners/?_page=2&amp;_per-page=20&amp;category=Physics","page":1,
"pages":11,"per_page":20,"prev_page":""},"results":[{"award_age":81,
"category":"Physics","country":"Belgium","date_of_birth":"1932-11-06",
"date_of_death":"NaT","gender":"male","link":"http://en.wikipedia.org/wiki/
Fran%C3%A7ois_Englert","name":"Fran\u00e7ois Englert", ... }</pre>
<section data-pdf-bookmark="CORS" data-type="sect2"><div class="sect2" id="idm45607756683984">
<h2>CORS</h2>
<p>In order to consume the API from a web browser, we’ll need to handle <a href="https://oreil.ly/ECpu0">Cross-Origin Resource Sharing (CORS)</a> constraints on server data requests. <a data-primary="CORS (Cross-Origin Resource Sharing)" data-type="indexterm" id="idm45607756682224"/><a data-primary="Cross-Origin Resource Sharing (CORS)" data-type="indexterm" id="idm45607756681616"/>We’ll use a Flask CORS extension and run it in default, allowing requests from any domain to access the data server. This just requires adding a couple of lines to our Flask app:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># ...</code>
<code class="kn">from</code> <code class="nn">flask_cors</code> <code class="kn">import</code> <code class="n">CORS</code>
<code class="c1"># Init app</code>
<code class="n">app</code> <code class="o">=</code> <code class="n">Flask</code><code class="p">(</code><code class="vm">__name__</code><code class="p">)</code>
<code class="n">CORS</code><code class="p">(</code><code class="n">app</code><code class="p">)</code></pre>
<p>The <a href="https://oreil.ly/bCKME">Flask-CORS library</a> can be used to specify which domains are allowed to access which resources.<a data-primary="Flask-CORS library" data-type="indexterm" id="idm45607756657248"/> We’re allowing general access here.</p>
</div></section>
<section data-pdf-bookmark="Consuming the API Using JavaScript" data-type="sect2"><div class="sect2" id="idm45607756656224">
<h2>Consuming the API Using JavaScript</h2>
<p>To use the data server from a web app/page, we just use <code>fetch</code> to request the data. <a data-primary="JavaScript" data-secondary="consuming API deployed remotely with Heroku" data-type="indexterm" id="idm45607756654176"/>This example consumes all the paginated data by continuing to fetch pages until the <code>next_page</code> property is an empty string:</p>
<pre data-code-language="js" data-type="programlisting"><code class="kd">let</code><code> </code><code class="nx">data</code><code>
</code><code class="nx">async</code><code> </code><code class="kd">function</code><code> </code><code class="nx">init</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">{</code><code>
  </code><code class="nx">data</code><code> </code><code class="o">=</code><code> </code><code class="nx">await</code><code> </code><code class="nx">getData</code><code class="p">(</code><code class="s1">'winners/?category=Physics&amp;country=United States'</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO12-1" id="co_restful_data_with_flask_CO12-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`</code><code class="si">${</code><code class="nx">data</code><code class="p">.</code><code class="nx">length</code><code class="si">}</code><code class="sb"> US Physics winners:</code><code class="sb">`</code><code class="p">,</code><code> </code><code class="nx">data</code><code class="p">)</code><code>
  </code><code class="c1">// Send the data to a suitable charting function
</code><code>  </code><code class="nx">drawChart</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code><code>
</code><code class="p">}</code><code>

</code><code class="nx">init</code><code class="p">(</code><code class="p">)</code><code>

</code><code class="nx">async</code><code> </code><code class="kd">function</code><code> </code><code class="nx">getData</code><code class="p">(</code><code class="nx">ep</code><code class="o">=</code><code class="s1">'winners/?category=Physics'</code><code class="p">)</code><code class="p">{</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO12-1" id="co_restful_data_with_flask_CO12-2"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
  </code><code class="kd">let</code><code> </code><code class="nx">API_URL</code><code> </code><code class="o">=</code><code> </code><code class="s1">'https://flask-rest-pyjs2.herokuapp.com/'</code><code>
  </code><code class="kd">let</code><code> </code><code class="nx">data</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>
  </code><code class="k">while</code><code class="p">(</code><code class="kc">true</code><code class="p">)</code><code> </code><code class="p">{</code><code>
    </code><code class="kd">let</code><code> </code><code class="nx">response</code><code> </code><code class="o">=</code><code> </code><code class="nx">await</code><code> </code><code class="nx">fetch</code><code class="p">(</code><code class="nx">API_URL</code><code> </code><code class="o">+</code><code> </code><code class="nx">ep</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO12-2" id="co_restful_data_with_flask_CO12-3"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
    </code><code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">res</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_restful_data_with_flask_CO12-3" id="co_restful_data_with_flask_CO12-4"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
    </code><code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code><code> </code><code class="o">=&gt;</code><code> </code><code class="p">{</code><code>
      </code><code class="k">return</code><code> </code><code class="nx">data</code><code>
    </code><code class="p">}</code><code class="p">)</code><code>

    </code><code class="nx">ep</code><code> </code><code class="o">=</code><code> </code><code class="nx">response</code><code class="p">.</code><code class="nx">pagination</code><code class="p">.</code><code class="nx">next_page</code><code>
    </code><code class="nx">data</code><code> </code><code class="o">=</code><code> </code><code class="nx">data</code><code class="p">.</code><code class="nx">concat</code><code class="p">(</code><code class="nx">response</code><code class="p">.</code><code class="nx">results</code><code class="p">)</code><code> </code><code class="c1">// add the page results
</code><code>    </code><code class="k">if</code><code class="p">(</code><code class="o">!</code><code class="nx">ep</code><code class="p">)</code><code> </code><code class="k">break</code><code> </code><code class="c1">// no next-page so break out of the loop
</code><code>  </code><code class="p">}</code><code>
  </code><code class="k">return</code><code> </code><code class="nx">data</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_restful_data_with_flask_CO12-1" id="callout_restful_data_with_flask_CO12-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The data coming from the server is asynchronous, so we use async functions to consume it.</p></dd>
<dt><a class="co" href="#co_restful_data_with_flask_CO12-3" id="callout_restful_data_with_flask_CO12-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p><a href="https://oreil.ly/EWHec"><code>await</code></a> waits for the asynchronous Promise to resolve itself, providing its value.</p></dd>
<dt><a class="co" href="#co_restful_data_with_flask_CO12-4" id="callout_restful_data_with_flask_CO12-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>We convert the response data to JSON, passing it on the next <code>then</code> call, which returns the server data.</p></dd>
</dl>
<p>The JS call outputs the expected result to console:</p>
<pre data-type="programlisting">89 US Physics winners:
[{
    award_age: 42
    category: "Physics"
    country: "United States"
    date_of_birth: "1969-12-16"
    date_of_death: "NaT"
    gender: "male"
    link: "http://en.wikipedia.org/wiki/Adam_G._Riess"
    name: "Adam G. Riess"
    place_of_birth: "Washington, D.C., United States"
    place_of_death: null
    text: "Adam G. Riess , Physics, 2011"
    year: 2011
  }, ...
}]</pre>
<p>We now have a web-based RESTful data API that can be accessed from anywhere (subject to our CORS restrictions). As you’ve seen, the low overhead and ease of use make Heroku hard to beat. It’s been going a while and has become a very refined setup.<a data-primary="Flask" data-secondary="creating a RESTful API" data-startref="ix_FlskRESTdep" data-tertiary="deploying API remotely with Heroku" data-type="indexterm" id="idm45607756490384"/><a data-primary="Heroku, deploying RESTful API remotely via" data-startref="ix_Hrok" data-type="indexterm" id="idm45607756488896"/><a data-primary="RESTful APIs" data-secondary="creating with Flask" data-startref="ix_RESTFlskdep" data-tertiary="deploying API remotely with Heroku" data-type="indexterm" id="idm45607756487984"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45607756705696">
<h1>Summary</h1>
<p>I hope this chapter has demonstrated that with a handful of powerful extensions it’s easy to roll your own RESTful API. It would take a lot more work and a few tests to make it industrial standard, but for most dataviz assignments this API would provide the ability to deal with large datasets and allow the user free exploration. At the very least it shows how easy it is to throw together a development server, allowing you to quickly test out visualization approaches for user-refined datasets. Dashboards is one area where this kind of remote fetching of data is expected.</p>
<p>The ability to easily deploy the API remotely with Heroku means large datasets can be sliced and diced without having to run local data servers—perfect for demonstrating ambitious dataviz to clients or colleagues.<a data-primary="Flask" data-secondary="creating a RESTful API" data-startref="ix_FlskREST" data-type="indexterm" id="idm45607756422816"/><a data-primary="RESTful APIs" data-secondary="creating with Flask" data-startref="ix_RESTflsk" data-type="indexterm" id="idm45607756421728"/></p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45607759687920"><sup><a href="ch13.xhtml#idm45607759687920-marker">1</a></sup> These create, read, update and delete methods form the <a href="https://oreil.ly/0AkAw">CRUD acronym</a>.</p><p data-type="footnote" id="idm45607759685936"><sup><a href="ch13.xhtml#idm45607759685936-marker">2</a></sup> Essentially, RESTful means resources being identified by a stateless, cacheable URI/URL and manipulated by HTTP verbs such as GET or POST. See <a href="https://oreil.ly/l0QhB">Wikipedia’s take</a> and this <a href="https://oreil.ly/6zxhv">Stack Overflow thread</a> for a little debate.</p><p data-type="footnote" id="idm45607758626448"><sup><a href="ch13.xhtml#idm45607758626448-marker">3</a></sup> Technically URL query strings form a multidictionary, which allows multiple occurrences of the same key. For the purposes of our API we expect to have only one instance of each key, making conversion to a dictionary fine.</p><p data-type="footnote" id="idm45607756688512"><sup><a href="ch13.xhtml#idm45607756688512-marker">4</a></sup> You can do this from the Heroku dashboard and then use <code>git remote - &lt;app_name&gt;</code> to attach the current Git directory to the app.</p></div></div></section></div></body></html>