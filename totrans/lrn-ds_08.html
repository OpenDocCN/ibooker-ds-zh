<html><head></head><body><section data-pdf-bookmark="Chapter 6. Working with Dataframes Using pandas" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch-pandas">&#13;
<h1><span class="label">Chapter 6. </span>Working with Dataframes Using pandas</h1>&#13;
&#13;
<p>Data scientists<a contenteditable="false" data-primary="dataframes" data-type="indexterm" id="ix_dataframe_ch6"/> work with data stored in tables. This chapter introduces <em>dataframes</em>, one of the most widely used ways to represent data tables. We also introduce <code>pandas</code>, the standard Python package for working with dataframes. Here is an example of a dataframe that holds information about popular dog breeds:</p>&#13;
&#13;
<div class="cell tag_remove-input docutils container">&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>grooming</th>&#13;
			<th>food_cost</th>&#13;
			<th>kids</th>&#13;
			<th>size</th>&#13;
		</tr>&#13;
		<tr>&#13;
			<th>breed</th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>Labrador Retriever</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
			<td>high</td>&#13;
			<td>medium</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>German Shepherd</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
			<td>medium</td>&#13;
			<td>large</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Beagle</strong></td>&#13;
			<td>daily</td>&#13;
			<td>324.0</td>&#13;
			<td>high</td>&#13;
			<td>small</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Golden Retriever</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
			<td>high</td>&#13;
			<td>medium</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Yorkshire Terrier</strong></td>&#13;
			<td>daily</td>&#13;
			<td>324.0</td>&#13;
			<td>low</td>&#13;
			<td>small</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Bulldog</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
			<td>medium</td>&#13;
			<td>medium</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Boxer</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
			<td>high</td>&#13;
			<td>medium</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>In a dataframe, each row represents a single record—in this case, a single dog breed. Each column represents a feature about the record—for example, the grooming column represents how often each dog breed needs to be groomed.</p>&#13;
&#13;
<p>Dataframes have labels<a contenteditable="false" data-primary="labels, dataframes" data-type="indexterm" id="id812"/> for both columns and rows. For instance, this dataframe has a column labeled grooming and a row labeled German Shepherd. The columns and rows of a dataframe are ordered—we can refer to the Labrador Retriever row as the first row of the dataframe.</p>&#13;
&#13;
<p>Within a column, data have the same type. For instance, the cost of food contains numbers, and the size of the dog consists of categories. But data types can be different within a row.</p>&#13;
&#13;
<p>Because of these properties, dataframes enable all sorts of useful operations.</p>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Data scientists<a contenteditable="false" data-primary="data types" data-secondary="programming versus data science types" data-type="indexterm" id="id813"/> often find themselves working with people from different backgrounds who use different terms. For instance, computer scientists say that the columns of a dataframe represent <em>features</em> of the data, while statisticians call them <em>variables</em> instead.</p>&#13;
&#13;
<p>Other times, people use the same term to refer to slightly different ideas. <em>Data types</em> in a programming<a contenteditable="false" data-primary="data types" data-secondary="in dataframe structure" data-secondary-sortas="dataframe structure" data-type="indexterm" id="id814"/> sense refers to how a computer stores data internally. For instance, the <code>size</code> column has a string data type in Python. But from a statistical point of view, the type of the <code>size</code> column is ordered categorical data (ordinal data). We talk more about this specific distinction in <a class="reference internal" data-type="xref" href="ch10.html#ch-eda">Chapter 10</a>.</p>&#13;
</div>&#13;
&#13;
<p>In this chapter, we introduce common dataframe operations<a contenteditable="false" data-primary="pandas library" data-seealso="dataframes; scikit-learn" data-type="indexterm" id="id815"/>. Data scientists use the <code>pandas</code> library when working with dataframes in Python. First, we explain the main objects that <code>pandas</code> provides: the <code>DataFrame</code> and <code>Series</code> classes. Then we show how to use <code>pandas</code> to perform common data manipulation tasks, like slicing, filtering, sorting, grouping, and joining.</p>&#13;
&#13;
&#13;
<section data-pdf-bookmark="Subsetting" data-type="sect1"><div class="sect1" id="ch-pandas-subsetting">&#13;
<h1>Subsetting</h1>&#13;
&#13;
<p>This section introduces operations<a contenteditable="false" data-primary="filtering data" data-secondary="dataframe subsetting" data-type="indexterm" id="id816"/><a contenteditable="false" data-primary="dataframes" data-secondary="filtering" data-type="indexterm" id="id817"/><a contenteditable="false" data-primary="dataframes" data-secondary="slicing" data-type="indexterm" id="id818"/><a contenteditable="false" data-primary="slicing" data-secondary="dataframes" data-type="indexterm" id="id819"/> for taking subsets of dataframes. When data scientists first read in a dataframe, they often want to subset the specific data that they plan to use. For example, a data scientist can <em>slice</em> out the 10 relevant features from a dataframe with hundreds of columns. Or they can <em>filter</em> a dataframe to remove rows with incomplete data. For the rest of this chapter, we demonstrate dataframe operations using a dataframe of baby names.</p>&#13;
&#13;
<section data-pdf-bookmark="Data Scope and Question" data-type="sect2"><div class="sect2" id="data-scope-and-question">&#13;
<h2>Data Scope and Question</h2>&#13;
&#13;
<p>There’s a <a class="reference external" href="https://oreil.ly/qL1dt">2021 <em>New York Times</em> article</a> that talks<a contenteditable="false" data-primary="dataframes" data-secondary="subsetting" data-type="indexterm" id="ix_df_subset_ch6"/><a contenteditable="false" data-primary="subsetting, dataframes" data-secondary="data scope and question" data-type="indexterm" id="ix_subset_df_scope_q"/><a contenteditable="false" data-primary="data scope" data-secondary="subsetting" data-type="indexterm" id="ix_data_scope_subset"/> about Prince Harry and Meghan Markle’s unique choice for their new baby daughter’s name: Lilibet. The article has an interview with Pamela Redmond, an expert on baby names, who talks about interesting trends in how people name their kids. For example, she says that names that start with the letter L have become very popular in recent years, while names that start with the letter J were most popular in the 1970s and 1980s. Are these claims reflected in data? We can use <code>pandas</code> to find out.</p>&#13;
&#13;
<p>First, we import<a contenteditable="false" data-primary="pandas library" data-secondary="importing (pd)" data-type="indexterm" id="id820"/> the package as <code>pd</code>, the canonical abbreviation:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="kn">import</code></span><code> </code><span><code class="nn">pandas</code></span><code> </code><span><code class="k">as</code></span><code> </code><span><code class="nn">pd</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>We have a dataset of baby names<a contenteditable="false" data-primary="Dataframe object" data-type="indexterm" id="id821"/><a contenteditable="false" data-primary="pd.Dataframe object" data-type="indexterm" id="id822"/><a contenteditable="false" data-primary="read_csv function" data-type="indexterm" id="id823"/><a contenteditable="false" data-primary="comma-separated value (CSV) file format" data-type="indexterm" id="id824"/><a contenteditable="false" data-primary="CSV (comma-separated value) file format" data-type="indexterm" id="id825"/> stored in a comma-separated values (CSV) file called <em>babynames.csv</em>. We use the <code>pd.read_csv</code> function to read the file as a <code>pandas.DataFrame</code> object:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">read_csv</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">babynames.csv</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">baby</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020719</strong></td>&#13;
			<td>Verona</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020720</strong></td>&#13;
			<td>Vertie</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020721</strong></td>&#13;
			<td>Wilma</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
<pre>2020722 rows × 4 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>The data in the <code>baby</code> table comes from the <a class="reference external" href="https://oreil.ly/EhTlP">US Social Security Administration (SSA)</a>, which records the baby name and birth sex for birth certificate purposes. The SSA makes the baby names data available on its website. We’ve loaded this data into the <code>baby</code> table.</p>&#13;
&#13;
<p>The SSA website has a <a class="reference external" href="https://oreil.ly/jzCVF">page</a> that describes the data in more detail. We won’t go in depth in this chapter about the data’s limitations, but we’ll point out this relevant information from the website:</p>&#13;
&#13;
<blockquote>&#13;
<div>&#13;
<p>All names are from Social Security card applications for births that occurred in the United States after 1879. Note that many people born before 1937 never applied for a Social Security card, so their names are not included in our data. For others who did apply, our records may not show the place of birth, and again their names are not included in our data.</p>&#13;
&#13;
<p>All data are from a 100% sample of our records on Social Security card applications as of March 2021.</p>&#13;
</div>&#13;
</blockquote>&#13;
&#13;
<p>It’s also important to point out that at the time of this writing, the SSA dataset only provides the binary options of male and female. We hope that in the future, national datasets like this one will provide more inclusive options<a contenteditable="false" data-primary="" data-startref="ix_subset_df_scope_q" data-type="indexterm" id="id826"/><a contenteditable="false" data-primary="" data-startref="ix_data_scope_subset" data-type="indexterm" id="id827"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Dataframes and Indices" data-type="sect2"><div class="sect2" id="dataframes-and-indices">&#13;
<h2>Dataframes and Indices</h2>&#13;
&#13;
<p>Let’s examine<a contenteditable="false" data-primary="subsetting, dataframes" data-secondary="dataframes and indices" data-type="indexterm" id="ix_subset_df_indices"/><a contenteditable="false" data-primary="dataframes" data-secondary="and indices" data-secondary-sortas="indices" data-type="indexterm" id="ix_df_indices"/> the <code>baby</code> dataframe in more detail. A dataframe has rows and columns. Every row and column has a label, as highlighted in <a class="reference internal" data-type="xref" href="#fig-baby-labels">Figure 6-1</a>.</p>&#13;
&#13;
<figure><div class="figure" id="fig-baby-labels"><img alt="baby-labels" src="assets/leds_0601.png"/>&#13;
<h6><span class="label">Figure 6-1. </span>The <code>baby</code> dataframe has labels for both rows and columns (boxed)</h6>&#13;
</div></figure>&#13;
&#13;
<p>By default, <code>pandas</code> assigns row labels<a contenteditable="false" data-primary="numbers, dataframe labels as" data-type="indexterm" id="id828"/><a contenteditable="false" data-primary="strings" data-secondary="dataframe labels as" data-type="indexterm" id="id829"/> as incrementing numbers starting from 0. In this case, the data at the row labeled <code>0</code> and column labeled <code>Name</code> has the data <code>'Liam'</code>.</p>&#13;
&#13;
<p>Dataframes can also have strings as row labels. <a class="reference internal" data-type="xref" href="#fig-dog-labels">Figure 6-2</a> shows a dataframe of dog data where the row labels are strings.</p>&#13;
&#13;
<figure><div class="figure" id="fig-dog-labels"><img alt="dog-labels" src="assets/leds_0602.png"/>&#13;
<h6><span class="label">Figure 6-2. </span>Row labels in dataframes can also be strings, as in this example, in which each row is labeled using the dog breed name</h6>&#13;
</div></figure>&#13;
&#13;
<p>The row labels have a special name. We call them<a contenteditable="false" data-primary="index of dataframe, rows as" data-type="indexterm" id="id830"/> the <em>index</em> of a dataframe, and <code>pandas</code> stores the row labels in a special <code>pd.Index</code> object. We won’t discuss the <code>pd.Index</code> object since it’s less common to manipulate the index itself. For now, it’s important to remember that even though the index looks like a column of data, the index really represents row labels, not data. For instance, the dataframe of dog breeds has four columns of data, not five, since the index doesn’t count as a column<a contenteditable="false" data-primary="" data-startref="ix_df_indices" data-type="indexterm" id="id831"/><a contenteditable="false" data-primary="" data-startref="ix_subset_df_indices" data-type="indexterm" id="id832"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Slicing" data-type="sect2"><div class="sect2" id="slicing">&#13;
<h2>Slicing</h2>&#13;
&#13;
<p><em>Slicing</em> is an operation<a contenteditable="false" data-primary="subsetting, dataframes" data-secondary="slicing" data-type="indexterm" id="ix_subset_df_slice"/><a contenteditable="false" data-primary="dataframes" data-secondary="slicing" data-type="indexterm" id="ix_df_slice"/><a contenteditable="false" data-primary="slicing" data-secondary="dataframes" data-type="indexterm" id="ix_slice_df"/><a contenteditable="false" data-primary="loc property" data-type="indexterm" id="ix_loc_prop"/><a contenteditable="false" data-primary="iloc property" data-type="indexterm" id="id833"/> that creates a new dataframe by taking a subset of rows or columns out of another dataframe. Think about slicing a tomato—slices can go both vertically and horizontally. To take slices of a dataframe in <code>pandas</code>, we use the <code>.loc</code> and <code>.iloc</code> properties. Let’s start with <code>.loc</code>.</p>&#13;
&#13;
<p>Here’s the full <code>baby</code> dataframe:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020719</strong></td>&#13;
			<td>Verona</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020720</strong></td>&#13;
			<td>Vertie</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020721</strong></td>&#13;
			<td>Wilma</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
<pre>2020722 rows × 4 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p><code>.loc</code> lets us select rows and columns using their labels. For example, to get the data in the row labeled <code>1</code> and column labeled <code>Name</code>:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="c1">#        The first argument is the row label</code></span><code>&#13;
</code><span><code class="c1">#        ↓</code></span><code>&#13;
</code><span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">loc</code></span><span><code class="p">[</code></span><span><code class="mi">1</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><span><code class="c1">#            ↑</code></span><code>&#13;
</code><span><code class="c1">#            The second argument is the column label</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
'Noah'&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>Notice that <code>.loc</code> needs square brackets; running <code>baby.loc(1, <span class="pre">'Name')</span></code> will result in an error.</p>&#13;
</div>&#13;
&#13;
<p>To slice out multiple rows or columns, we can use Python slice syntax instead of individual values:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">loc</code></span><span><code class="p">[</code></span><span><code class="mi">0</code></span><span><code class="p">:</code></span><span><code class="mi">3</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div>&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3</strong></td>&#13;
			<td>Elijah</td>&#13;
			<td>M</td>&#13;
			<td>13034</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>To get an entire column of data, we can pass an empty slice as the first argument:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">loc</code></span><span><code class="p">[</code><code class="p">:</code><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
0          19659&#13;
1          18252&#13;
2          14147&#13;
           ...  &#13;
2020719        5&#13;
2020720        5&#13;
2020721        5&#13;
Name: Count, Length: 2020722, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Notice that the output of this doesn’t look like a dataframe, and it’s not. Selecting out a single row or column of a dataframe produces a <code>pd.Series</code> object:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">counts</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">loc</code></span><span><code class="p">[</code><code class="p">:</code><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><span><code class="n">counts</code></span><span><code class="o">.</code></span><span><code class="vm">__class__</code></span><span><code class="o">.</code></span><span><code class="vm">__name__</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
'Series'&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>What’s the difference<a contenteditable="false" data-primary="Dataframe object" data-type="indexterm" id="id834"/><a contenteditable="false" data-primary="pd.Dataframe object" data-type="indexterm" id="id835"/><a contenteditable="false" data-primary="pd.Series object" data-type="indexterm" id="id836"/><a contenteditable="false" data-primary="Series object" data-type="indexterm" id="id837"/> between a <code>pd.Series</code> object and a <code>pd.DataFrame</code> object? Essentially, a <code>pd.DataFrame</code> is two-dimensional—it has rows and columns and represents a table of data. A <code>pd.Series</code> is one-dimensional—it represents a list of data. <code>pd.Series</code> and <code>pd.DataFrame</code> objects have many methods in common, but they really represent two different things. Confusing the two can cause bugs and confusion.</p>&#13;
&#13;
<p>To select specific columns of a dataframe, pass a list into <code>.loc</code>. Here’s the original dataframe:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020719</strong></td>&#13;
			<td>Verona</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020720</strong></td>&#13;
			<td>Vertie</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020721</strong></td>&#13;
			<td>Wilma</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
<pre>2020722 rows × 4 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="c1"># And here's the dataframe with only Name and Year columns</code></span><code>&#13;
</code><span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">loc</code></span><span><code class="p">[</code><code class="p">:</code><code class="p">,</code></span><code> </code><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">]</code></span><code>&#13;
</code><span><code class="c1">#           └──────┬───────┘</code></span><code>&#13;
</code><span><code class="c1">#         list of column labels</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020719</strong></td>&#13;
			<td>Verona</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020720</strong></td>&#13;
			<td>Vertie</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020721</strong></td>&#13;
			<td>Wilma</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
<pre>2020722 rows × 2 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Selecting columns is very common, so there’s a shorthand:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="c1"># Shorthand for baby.loc[:, 'Name']</code></span><code>&#13;
</code><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
0            Liam&#13;
1            Noah&#13;
2          Oliver&#13;
            ...  &#13;
2020719    Verona&#13;
2020720    Vertie&#13;
2020721     Wilma&#13;
Name: Name, Length: 2020722, dtype: object&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="c1"># Shorthand for baby.loc[:, ['Name', 'Count']]</code></span><code>&#13;
</code><span><code class="n">baby</code></span><span><code class="p">[</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Count</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>19659</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>18252</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>14147</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020719</strong></td>&#13;
			<td>Verona</td>&#13;
			<td>5</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020720</strong></td>&#13;
			<td>Vertie</td>&#13;
			<td>5</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020721</strong></td>&#13;
			<td>Wilma</td>&#13;
			<td>5</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>2020722 rows × 2 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Slicing using <code>.iloc</code> works similarly<a contenteditable="false" data-primary="iloc property" data-startref="ix_loc_prop" data-type="indexterm" id="id838"/> to <code>.loc</code>, except that <code>.iloc</code> uses the <em>positions</em> of rows and columns rather than labels. It’s easiest to show the difference between <code>.iloc</code> and <code>.loc</code> when the dataframe index has strings, so for demonstration purposes, let’s look at a dataframe with information on dog breeds:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">dogs</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">read_csv</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">dogs.csv</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">index_col</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">breed</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">dogs</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>grooming</th>&#13;
			<th>food_cost</th>&#13;
			<th>kids</th>&#13;
			<th>size</th>&#13;
		</tr>&#13;
		<tr>&#13;
			<th>breed</th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>Labrador Retriever</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
			<td>high</td>&#13;
			<td>medium</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>German Shepherd</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
			<td>medium</td>&#13;
			<td>large</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Beagle</strong></td>&#13;
			<td>daily</td>&#13;
			<td>324.0</td>&#13;
			<td>high</td>&#13;
			<td>small</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Golden Retriever</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
			<td>high</td>&#13;
			<td>medium</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Yorkshire Terrier</strong></td>&#13;
			<td>daily</td>&#13;
			<td>324.0</td>&#13;
			<td>low</td>&#13;
			<td>small</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Bulldog</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
			<td>medium</td>&#13;
			<td>medium</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Boxer</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
			<td>high</td>&#13;
			<td>medium</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>To get the first three rows and the first two columns by position, use <code>.iloc</code>:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">dogs</code></span><span><code class="o">.</code></span><span><code class="n">iloc</code></span><span><code class="p">[</code></span><span><code class="mi">0</code></span><span><code class="p">:</code></span><span><code class="mi">3</code></span><span><code class="p">,</code></span><code> </code><span><code class="mi">0</code></span><span><code class="p">:</code></span><span><code class="mi">2</code></span><span><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>grooming</th>&#13;
			<th>food_cost</th>&#13;
		</tr>&#13;
		<tr>&#13;
			<th>breed</th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>Labrador Retriever</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>German Shepherd</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Beagle</strong></td>&#13;
			<td>daily</td>&#13;
			<td>324.0</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>The same operation using <code>.loc</code> requires us to use the dataframe labels:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">dogs</code></span><span><code class="o">.</code></span><span><code class="n">loc</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Labrador Retriever</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s1">'</code><code class="s1">Beagle</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">grooming</code><code class="s1">'</code></span><span><code class="p">:</code></span><span><code class="s1">'</code><code class="s1">food_cost</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>grooming</th>&#13;
			<th>food_cost</th>&#13;
		</tr>&#13;
		<tr>&#13;
			<th>breed</th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>Labrador Retriever</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>German Shepherd</strong></td>&#13;
			<td>weekly</td>&#13;
			<td>466.0</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>Beagle</strong></td>&#13;
			<td>daily</td>&#13;
			<td>324.0</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Next, we’ll look at filtering rows<a contenteditable="false" data-primary="" data-startref="ix_slice_df" data-type="indexterm" id="id839"/><a contenteditable="false" data-primary="" data-startref="ix_subset_df_slice" data-type="indexterm" id="id840"/><a contenteditable="false" data-startref="ix_loc_prop" data-type="indexterm" id="id841"/><a contenteditable="false" data-primary="" data-startref="ix_df_slice" data-type="indexterm" id="id842"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Filtering Rows" data-type="sect2"><div class="sect2" id="filtering-rows">&#13;
<h2>Filtering Rows</h2>&#13;
&#13;
<p>So far, we’ve shown how to use <code>.loc</code> and <code>.iloc</code> to slice a dataframe using labels and positions.</p>&#13;
&#13;
<p>However, data scientists<a contenteditable="false" data-primary="filtering data" data-secondary="dataframe subsetting" data-type="indexterm" id="ix_filter_data"/><a contenteditable="false" data-primary="subsetting, dataframes" data-secondary="filtering rows" data-type="indexterm" id="ix_subset_df_filter"/><a contenteditable="false" data-primary="dataframes" data-secondary="filtering" data-type="indexterm" id="ix_df_filter"/> often want to <em>filter</em> rows—they want to take subsets of rows using some criteria. Let’s say we want to find the most popular baby names in 2020. To do this, we can filter rows to keep only the rows where the <code>Year</code> is 2020.</p>&#13;
&#13;
<p>To filter, we’d like to check whether each value in the <code>Year</code> column is equal to 1970 and then keep only those rows.</p>&#13;
&#13;
<p>To compare<a contenteditable="false" data-primary="slicing" data-secondary="dataframes" data-type="indexterm" id="id843"/><a contenteditable="false" data-primary="slicing" data-secondary="and filtering" data-secondary-sortas="filtering" data-type="indexterm" id="id844"/><a contenteditable="false" data-primary="slicing" data-secondary="numpy array" data-type="indexterm" id="id845"/><a contenteditable="false" data-primary="dataframes" data-secondary="slicing" data-type="indexterm" id="id846"/><a contenteditable="false" data-primary="filtering data" data-secondary="and slicing" data-secondary-sortas="slicing" data-type="indexterm" id="id847"/><a contenteditable="false" data-primary="boolean conditions" data-secondary="filtering a dataframe" data-type="indexterm" id="id848"/> each value in <code>Year</code>, we slice out the column and make a boolean comparison (this is similar to what we’d do with a <code>numpy</code> array). Here’s the dataframe for <span class="keep-together">reference</span>:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020719</strong></td>&#13;
			<td>Verona</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020720</strong></td>&#13;
			<td>Vertie</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020721</strong></td>&#13;
			<td>Wilma</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>2020722 rows × 4 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="c1"># Get a Series with the Year data</code></span><code>&#13;
</code><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
0          2020&#13;
1          2020&#13;
2          2020&#13;
           ... &#13;
2020719    1880&#13;
2020720    1880&#13;
2020721    1880&#13;
Name: Year, Length: 2020722, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="c1"># Compare with 2020</code></span><code>&#13;
</code><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="mi">2020</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
0           True&#13;
1           True&#13;
2           True&#13;
           ...  &#13;
2020719    False&#13;
2020720    False&#13;
2020721    False&#13;
Name: Year, Length: 2020722, dtype: bool&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Notice that a boolean<a contenteditable="false" data-primary="Series object" data-type="indexterm" id="id849"/><a contenteditable="false" data-primary="pd.Series object" data-type="indexterm" id="id850"/> comparison on a <code>Series</code> gives a <code>Series</code> of booleans. This is nearly equivalent to writing:</p>&#13;
&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">is_2020</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">[</code><code class="p">]</code></span><code>&#13;
</code><span><code class="k">for</code></span><code> </code><span><code class="n">value</code></span><code> </code><span><code class="ow">in</code></span><code> </code><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="n">is_2020</code></span><span><code class="o">.</code></span><span><code class="n">append</code></span><span><code class="p">(</code></span><span><code class="n">value</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="mi">2020</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>But the boolean comparison is easier to write and much faster to execute than a <code>for</code> loop.</p>&#13;
&#13;
<p>Now we tell <code>pandas</code> to keep only the rows where the comparison evaluated to <code>True</code>:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">loc</code></span><span><code class="p">[</code></span><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="mi">2020</code></span><span><code class="p">,</code></span><code> </code><span><code class="p">:</code><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>31267</strong></td>&#13;
			<td>Zylynn</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>31268</strong></td>&#13;
			<td>Zynique</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>31269</strong></td>&#13;
			<td>Zynlee</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>31270 rows × 4 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
	<p>Passing a <code>Series</code> of booleans into <code>.loc</code> only keeps rows where the <code>Series</code> has a <code>True</code> value.</p>&#13;
</div>&#13;
&#13;
<p>Filtering has a shorthand. This computes the same table as the preceding snippet without using <code>.loc</code>:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="mi">2020</code></span><span><code class="p">]</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>31267</strong></td>&#13;
			<td>Zylynn</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>31268</strong></td>&#13;
			<td>Zynique</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>31269</strong></td>&#13;
			<td>Zynlee</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>31270 rows × 4 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Finally, to find the most common names in 2020, sort the dataframe by <code>Count</code> in descending order. Wrapping a long expression in parentheses lets us easily add line breaks to make it more readable:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="p">(</code></span><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="mi">2020</code></span><span><code class="p">]</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">sort_values</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">ascending</code></span><span><code class="o">=</code></span><span><code class="kc">False</code></span><span><code class="p">)</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">head</code></span><span><code class="p">(</code></span><span><code class="mi">7</code></span><span><code class="p">)</code></span><code> </code><span><code class="c1"># take the first seven rows</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>13911</strong></td>&#13;
			<td>Emma</td>&#13;
			<td>F</td>&#13;
			<td>15581</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>13912</strong></td>&#13;
			<td>Ava</td>&#13;
			<td>F</td>&#13;
			<td>13084</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3</strong></td>&#13;
			<td>Elijah</td>&#13;
			<td>M</td>&#13;
			<td>13034</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>13913</strong></td>&#13;
			<td>Charlotte</td>&#13;
			<td>F</td>&#13;
			<td>13003</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>We see that Liam, Noah, and Emma were the most popular baby names in 2020<a contenteditable="false" data-primary="" data-startref="ix_subset_df_filter" data-type="indexterm" id="id851"/><a contenteditable="false" data-primary="" data-startref="ix_df_filter" data-type="indexterm" id="id852"/><a contenteditable="false" data-primary="" data-startref="ix_filter_data" data-type="indexterm" id="id853"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Example: How Recently Has Luna Become a Popular Name?" data-type="sect2"><div class="sect2" id="example-how-recently-has-luna-become-a-popular-name">&#13;
<h2>Example: How Recently Has Luna Become a Popular Name?</h2>&#13;
&#13;
<p>The <em>New York Times</em> article<a contenteditable="false" data-primary="subsetting, dataframes" data-secondary="Luna as popular name example" data-type="indexterm" id="ix_subset_df_luna"/><a contenteditable="false" data-primary="slicing" data-secondary="and filtering" data-secondary-sortas="filtering" data-type="indexterm" id="ix_slice_filt_luna"/><a contenteditable="false" data-primary="filtering data" data-secondary="and slicing" data-secondary-sortas="slicing" data-type="indexterm" id="ix_filter_df_luna"/><a contenteditable="false" data-primary="slicing" data-secondary="dataframes" data-type="indexterm" id="ix_slice_df_luna"/><a contenteditable="false" data-primary="dataframes" data-secondary="slicing" data-type="indexterm" id="ix_df_slice_luna"/> mentions that the name Luna was almost nonexistent before 2000 but has since grown to become a very popular name for girls. When exactly did Luna become popular? We can check this using slicing and filtering. When approaching a data manipulation task, we recommend breaking the problem down into smaller steps. For example, we could think:</p>&#13;
&#13;
<ol class="arabic simple">&#13;
	<li>&#13;
	<p>Filter: keep only rows with <code>'Luna'</code> in the <code>Name</code> column.</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Filter: keep only rows with <code>'F'</code> in the <code>Sex</code> column.</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Slice: keep the <code>Count</code> and <code>Year</code> columns.</p>&#13;
	</li>&#13;
</ol>&#13;
&#13;
<p>Now it’s a matter of translating each step into code:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">luna</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="s1">'</code><code class="s1">Luna</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="c1"># [1]</code></span><code>&#13;
</code><span><code class="n">luna</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">luna</code></span><span><code class="p">[</code></span><span><code class="n">luna</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Sex</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="s1">'</code><code class="s1">F</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>     </code><span><code class="c1"># [2]</code></span><code>&#13;
</code><span><code class="n">luna</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">luna</code></span><span><code class="p">[</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">]</code></span><code>      </code><span><code class="c1"># [3]</code></span><code>&#13;
</code><span><code class="n">luna</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>13923</strong></td>&#13;
			<td>7770</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>45366</strong></td>&#13;
			<td>7772</td>&#13;
			<td>2019</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>77393</strong></td>&#13;
			<td>6929</td>&#13;
			<td>2018</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2014083</strong></td>&#13;
			<td>17</td>&#13;
			<td>1883</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2018187</strong></td>&#13;
			<td>18</td>&#13;
			<td>1881</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020223</strong></td>&#13;
			<td>15</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>128 rows × 2 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>In this book, we use a library<a contenteditable="false" data-primary="plotly library" data-type="indexterm" id="id854"/> called <code>plotly</code> for plotting. We won’t cover plotting in depth here since we talk more about it in <a class="reference internal" data-type="xref" href="ch11.html#ch-viz">Chapter 11</a>. For now, we use <code>px.line()</code> to make a simple line plot:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">line</code></span><span><code class="p">(</code></span><span><code class="n">luna</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_06in01.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>It’s just as the article says. Luna wasn’t popular at all until the year 2000 or so. In other words, if someone tells you that their name is Luna, you can take a pretty good guess at their age even without any other information about them!</p>&#13;
&#13;
<p>Just for fun, here’s the same plot for the name Siri:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">siri</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">query</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">Name == </code><code class="s1">"</code><code class="s1">Siri</code><code class="s1">"</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><code>        </code><span><code class="o">.</code></span><span><code class="n">query</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">Sex == </code><code class="s1">"</code><code class="s1">F</code><code class="s1">"</code><code class="s1">'</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">line</code></span><span><code class="p">(</code></span><span><code class="n">siri</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_06in02.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
	<p>Using <code>.query</code> is similar to using <code>.loc</code> with a boolean series. <code>query()</code> has more restrictions on filtering but can be convenient as a shorthand. </p>&#13;
</div>&#13;
&#13;
<p>Why might the popularity have dropped so suddenly after 2010? Well, Siri happens to be the name of Apple’s voice assistant and was introduced in 2011. Let’s draw a line for the year 2011 and take a look:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">line</code></span><span><code class="p">(</code></span><span><code class="n">siri</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Year</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">Count</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">add_vline</code></span><span><code class="p">(</code></span><code>&#13;
</code><code>    </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="mi">2011</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">line_color</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">red</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">line_dash</code></span><span><code class="o">=</code></span><span><code class="s2">"</code><code class="s2">dashdot</code><code class="s2">"</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">line_width</code></span><span><code class="o">=</code></span><span><code class="mi">4</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">opacity</code></span><span><code class="o">=</code></span><span><code class="mf">0.7</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_06in03.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>It looks like parents don’t want their kids to be confused when other people say “Hey Siri” to their phones.</p>&#13;
&#13;
<p>In this section, we introduced dataframes in <code>pandas</code>. We covered the common ways that data scientists subset dataframes—slicing with labels and filtering using a boolean condition. In the next section, we explain how to aggregate rows together<a contenteditable="false" data-primary="" data-startref="ix_subset_df_luna" data-type="indexterm" id="id855"/><a contenteditable="false" data-primary="" data-startref="ix_slice_df_luna" data-type="indexterm" id="id856"/><a contenteditable="false" data-primary="" data-startref="ix_slice_filt_luna" data-type="indexterm" id="id857"/><a contenteditable="false" data-primary="" data-startref="ix_df_slice_luna" data-type="indexterm" id="id858"/><a contenteditable="false" data-primary="" data-startref="ix_filter_df_luna" data-type="indexterm" id="id859"/>.<a contenteditable="false" data-primary="" data-startref="ix_df_subset_ch6" data-type="indexterm" id="id860"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Aggregating" data-type="sect1"><div class="sect1" id="ch-pandas-aggregating">&#13;
<h1>Aggregating</h1>&#13;
&#13;
<p>This section introduces operations<a contenteditable="false" data-primary="dataframes" data-secondary="aggregating" data-type="indexterm" id="ix_de_agg"/><a contenteditable="false" data-primary="pivoting" data-type="indexterm" id="id861"/><a contenteditable="false" data-primary="aggregation" data-secondary="in dataframes" data-secondary-sortas="dataframes" data-type="indexterm" id="ix_agg_df"/> for aggregating rows in a dataframe. Data scientists aggregate rows together to make summaries of data. For instance, a dataset containing daily sales can be aggregated to show monthly sales instead. This section introduces <em>grouping</em> and <em>pivoting</em>, two common operations for aggregating data.</p>&#13;
&#13;
<p>We work with the baby names data, as introduced in the previous section:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">read_csv</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">babynames.csv</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">baby</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020719</strong></td>&#13;
			<td>Verona</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020720</strong></td>&#13;
			<td>Vertie</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020721</strong></td>&#13;
			<td>Wilma</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>2020722 rows × 4 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<section data-pdf-bookmark="Basic Group-Aggregate" data-type="sect2"><div class="sect2" id="basic-group-aggregate">&#13;
<h2>Basic Group-Aggregate</h2>&#13;
&#13;
<p>Let’s say we want to find<a contenteditable="false" data-primary="grouping in data tables" data-secondary="dataframes" data-type="indexterm" id="ix_grp_dtable_df"/><a contenteditable="false" data-primary="group-aggregate" data-type="indexterm" id="ix_grp_agg"/><a contenteditable="false" data-primary="aggregation" data-secondary="basic group-aggregate" data-type="indexterm" id="ix_agg_grp"/> out the total number of babies born as recorded in this data. This is simply the sum of the <code>Count</code> column:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">sum</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
352554503&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Summing up the name counts is one simple way to aggregate the data—it combines data from multiple rows.</p>&#13;
&#13;
<p>But let’s say we instead want to answer a more interesting question: are US births trending upward over time? To answer this question, we can sum the <code>Count</code> column within each year rather than taking the sum over the entire dataset. In other words, we split the data into groups based on <code>Year</code>, then sum the <code>Count</code> values within each group. This process is depicted in <a class="reference internal" data-type="xref" href="#fig-groupby-births">Figure 6-3</a>.</p>&#13;
&#13;
<figure><div class="figure" id="fig-groupby-births"><img alt="fig:groupby-births" src="assets/leds_0603.png"/>&#13;
<h6><span class="label">Figure 6-3. </span>A depiction of grouping and then aggregating for example data</h6>&#13;
</div></figure>&#13;
&#13;
<p class="pagebreak-before less_space">We call this operation <em>grouping</em> followed by <em>aggregating</em>. In <code>pandas</code>, we write:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">)</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">sum</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
Year&#13;
1880     194419&#13;
1881     185772&#13;
1882     213385&#13;
         ...   &#13;
2018    3487193&#13;
2019    3437438&#13;
2020    3287724&#13;
Name: Count, Length: 141, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Notice that the code<a contenteditable="false" data-primary="groupby() function" data-type="indexterm" id="id862"/> is nearly the same as the nongrouped version, except that it starts with a call to <code>.groupby('Year')</code>.</p>&#13;
&#13;
<p>The result<a contenteditable="false" data-primary="Series object" data-type="indexterm" id="id863"/><a contenteditable="false" data-primary="pd.Series object" data-type="indexterm" id="id864"/> is a <code>pd.Series</code> with the total number of babies born for each year in the data. Notice that the index of this series contains the unique <code>Year</code> values. Now we can plot the counts over time:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">counts_by_year</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">)</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">sum</code></span><span><code class="p">(</code><code class="p">)</code></span><span><code class="o">.</code></span><span><code class="n">reset_index</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">line</code></span><span><code class="p">(</code></span><span><code class="n">counts_by_year</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_06in04.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>What do we see in this plot? First, we notice that there seem to be suspiciously few babies born before 1920. One likely explanation is that the SSA was created in 1935, so its data for prior births could be less complete.</p>&#13;
&#13;
<p>We also notice the dip when World War II began in 1939, and the postwar baby boomer era from 1946 to 1964.</p>&#13;
&#13;
<p>Here’s the basic recipe for grouping in <code>pandas</code>:</p>&#13;
&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="p">(</code></span><span><code class="n">baby</code></span><code>                </code><span><code class="c1"># the dataframe</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>    </code><span><code class="c1"># column(s) to group</code></span><code>&#13;
</code><code> </code><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>           </code><span><code class="c1"># column(s) to aggregate</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">sum</code></span><span><code class="p">(</code><code class="p">)</code></span><code>              </code><span><code class="c1"># how to aggregate</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
&#13;
<section data-pdf-bookmark="Example: Using .value_counts()" data-type="sect3"><div class="sect3" id="example-using-value-counts">&#13;
<h3>Example: Using .value_counts()</h3>&#13;
&#13;
<p>One of the more common<a contenteditable="false" data-primary="value_counts() method" data-type="indexterm" id="id865"/> dataframe tasks is to count the number of times every unique item in a column appears. For example, we might be interested in the number of times each name appears in the following <code>classroom</code> dataframe:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">classroom</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>name</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Eden</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Sachit</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Eden</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3</strong></td>&#13;
			<td>Sachit</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>4</strong></td>&#13;
			<td>Sachit</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>5</strong></td>&#13;
			<td>Luke</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>One way to do this is to use our grouping<a contenteditable="false" data-primary="size() aggregation method" data-type="indexterm" id="id866"/> recipe with the <code>.size()</code> aggregation <span class="keep-together">function</span>:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="p">(</code></span><span><code class="n">classroom</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><code> </code><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">size</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
name&#13;
Eden      2&#13;
Luke      1&#13;
Sachit    3&#13;
Name: name, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>This operation is so common that <code>pandas</code> provides a shorthand—the <code>.value_counts()</code> method for <code>pd.Series</code> objects:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">classroom</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">name</code><code class="s1">'</code></span><span><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">value_counts</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
name&#13;
Sachit    3&#13;
Eden      2&#13;
Luke      1&#13;
Name: count, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>By default, the <code>.value_counts()</code> method will sort the resulting series from highest to lowest number, making it convenient to see the most and least common values. We point out this method because we use it often in other chapters of the book<a contenteditable="false" data-primary="" data-startref="ix_agg_grp" data-type="indexterm" id="id867"/><a contenteditable="false" data-primary="" data-startref="ix_grp_agg" data-type="indexterm" id="id868"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Grouping on Multiple Columns" data-type="sect2"><div class="sect2" id="grouping-on-multiple-columns">&#13;
<h2>Grouping on Multiple Columns</h2>&#13;
&#13;
<p>We pass multiple columns<a contenteditable="false" data-primary="multiple columns, grouping on" data-type="indexterm" id="ix_multi_col_grp"/><a contenteditable="false" data-primary="aggregation" data-secondary="multiple columns, grouping on" data-type="indexterm" id="ix_agg_multi_col"/><a contenteditable="false" data-primary="groupby() function" data-type="indexterm" id="id869"/> into <code>.groupby</code> as a list to group by multiple columns at once. This is useful when we need to further subdivide our groups. For example, we can group by both year and sex to see how many male and female babies were born over time:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">counts_by_year_and_sex</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">baby</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Sex</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">)</code></span><code> </code><span><code class="c1"># Arg to groupby is a list of column names</code></span><code>&#13;
</code><code> </code><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">sum</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">counts_by_year_and_sex</code></span><code> </code><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
Year  Sex&#13;
1880  F        83929&#13;
      M       110490&#13;
1881  F        85034&#13;
              ...   &#13;
2019  M      1785527&#13;
2020  F      1581301&#13;
      M      1706423&#13;
Name: Count, Length: 282, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Notice how the code closely follows the grouping recipe.</p>&#13;
&#13;
<p>The <code>counts_by_year_and_sex</code> series has what we call a multilevel index with two levels, one for each column that was grouped. It’s a bit easier to see if we convert the series to a dataframe. The result only has one column:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">counts_by_year_and_sex</code></span><span><code class="o">.</code></span><span><code class="n">to_frame</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th>Count</th>&#13;
		</tr>&#13;
		<tr>&#13;
			<th>Year</th>&#13;
			<th>Sex</th>&#13;
			<th> </th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td rowspan="2"><strong>1880</strong></td>&#13;
			<td><strong>F</strong></td>&#13;
			<td class="right">83929</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>M</strong></td>&#13;
			<td class="right">110490</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1881</strong></td>&#13;
			<td><strong>F</strong></td>&#13;
			<td class="right">85034</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2019</strong></td>&#13;
			<td><strong>M</strong></td>&#13;
			<td class="right">1785527</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td rowspan="2"><strong>2020</strong></td>&#13;
			<td><strong>F</strong></td>&#13;
			<td class="right">1581301</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>M</strong></td>&#13;
			<td class="right">1706423</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>282 rows × 1 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>There are two levels to the index because we grouped by two columns. It can be a bit tricky to work with multilevel indices, so we can reset the index to go back to a dataframe with a single index:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">counts_by_year_and_sex</code></span><span><code class="o">.</code></span><span><code class="n">reset_index</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Year</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>1880</td>&#13;
			<td>F</td>&#13;
			<td class="right">83929</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>1880</td>&#13;
			<td>M</td>&#13;
			<td class="right">110490</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>1881</td>&#13;
			<td>F</td>&#13;
			<td class="right">85034</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>279</strong></td>&#13;
			<td>2019</td>&#13;
			<td>M</td>&#13;
			<td class="right">1785527</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>280</strong></td>&#13;
			<td>2020</td>&#13;
			<td>F</td>&#13;
			<td class="right">1581301</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>281</strong></td>&#13;
			<td>2020</td>&#13;
			<td>M</td>&#13;
			<td class="right">1706423</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>282 rows × 3 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Custom Aggregation Functions" data-type="sect2"><div class="sect2" id="custom-aggregation-functions">&#13;
<h2>Custom Aggregation Functions</h2>&#13;
&#13;
<p>After grouping<a contenteditable="false" data-primary="grouping in data tables" data-secondary="custom functions" data-type="indexterm" id="ix_grp_cust_func"/><a contenteditable="false" data-primary="aggregation" data-secondary="custom aggregation functions" data-type="indexterm" id="ix_agg_cust"/><a contenteditable="false" data-primary="custom aggregation functions, pandas" data-type="indexterm" id="ix_cust_agg_func"/><a contenteditable="false" data-primary="sum() method, aggregation" data-type="indexterm" id="id870"/>, <code>pandas</code> gives us flexible ways to aggregate the data. So far, we’ve seen how to use <code>.sum()</code> after grouping:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="p">(</code></span><span><code class="n">baby</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><code> </code><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">sum</code></span><span><code class="p">(</code><code class="p">)</code></span><code> </code><span><code class="c1"># aggregate by summing</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
Year&#13;
1880     194419&#13;
1881     185772&#13;
1882     213385&#13;
         ...   &#13;
2018    3487193&#13;
2019    3437438&#13;
2020    3287724&#13;
Name: Count, Length: 141, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p><code>pandas</code> also supplies other aggregation functions, like <code>.mean()</code>, <code>.size()</code>, and <code>.first()</code>. Here’s the same grouping using <code>.max()</code>:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="p">(</code></span><span><code class="n">baby</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><code> </code><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">max</code></span><span><code class="p">(</code><code class="p">)</code></span><code> </code><span><code class="c1"># aggregate by taking the max within each group</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
Year&#13;
1880     9655&#13;
1881     8769&#13;
1882     9557&#13;
        ...  &#13;
2018    19924&#13;
2019    20555&#13;
2020    19659&#13;
Name: Count, Length: 141, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>But sometimes <code>pandas</code> doesn’t have the exact aggregation<a contenteditable="false" data-primary="agg(fn) method" data-type="indexterm" id="id871"/> function we want to use. In these cases, we can define and use a custom aggregation function. <code>pandas</code> lets us do this through <code>.agg(fn)</code>, where <code>fn</code> is a function that we define.</p>&#13;
&#13;
<p>For instance, if we want to find the difference between the largest and smallest values within each group (the range of the data), we could first define a function called <code>data_range</code>, then pass that function into <code>.agg()</code>. The input to this function is a <code>pd.Series</code> object containing a single column of data. It gets called once for each group:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="k">def</code></span><code> </code><span><code class="nf">data_range</code></span><span><code class="p">(</code></span><span><code class="n">counts</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="n">counts</code></span><span><code class="o">.</code></span><span><code class="n">max</code></span><span><code class="p">(</code><code class="p">)</code></span><code> </code><span><code class="o">-</code></span><code> </code><span><code class="n">counts</code></span><span><code class="o">.</code></span><span><code class="n">min</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="p">(</code></span><span><code class="n">baby</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><code> </code><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">agg</code></span><span><code class="p">(</code></span><span><code class="n">data_range</code></span><span><code class="p">)</code></span><code> </code><span><code class="c1"># aggregate using custom function</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
Year&#13;
1880     9650&#13;
1881     8764&#13;
1882     9552&#13;
        ...  &#13;
2018    19919&#13;
2019    20550&#13;
2020    19654&#13;
Name: Count, Length: 141, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>We start by defining a <code>count_unique</code> function that counts the number of unique values in a series. Then we pass that function into <code>.agg()</code>. Since this function is short, we could use a lambda instead:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="k">def</code></span><code> </code><span><code class="nf">count_unique</code></span><span><code class="p">(</code></span><span><code class="n">s</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="nb">len</code></span><span><code class="p">(</code></span><span><code class="n">s</code></span><span><code class="o">.</code></span><span><code class="n">unique</code></span><span><code class="p">(</code><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">unique_names_by_year</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">baby</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><code> </code><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">agg</code></span><span><code class="p">(</code></span><span><code class="n">count_unique</code></span><span><code class="p">)</code></span><code> </code><span><code class="c1"># aggregate using the custom count_unique function</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">unique_names_by_year</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
Year&#13;
1880     1889&#13;
1881     1829&#13;
1882     2012&#13;
        ...  &#13;
2018    29619&#13;
2019    29417&#13;
2020    28613&#13;
Name: Name, Length: 141, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">line</code></span><span><code class="p">(</code></span><span><code class="n">unique_names_by_year</code></span><span><code class="o">.</code></span><span><code class="n">reset_index</code></span><span><code class="p">(</code><code class="p">)</code><code class="p">,</code></span><code>&#13;
</code><code>        </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>        </code><span><code class="n">labels</code></span><span><code class="o">=</code></span><span><code class="p">{</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">:</code></span><code> </code><span><code class="s1">'</code><code class="s1"># unique names</code><code class="s1">'</code></span><span><code class="p">}</code><code class="p">,</code></span><code>&#13;
</code><code>        </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_06in05.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>We see that the number of unique names has generally increased over time, even though the number of babies born annually has plateaued since the 1960s<a contenteditable="false" data-primary="" data-startref="ix_grp_cust_func" data-type="indexterm" id="id872"/><a contenteditable="false" data-primary="" data-startref="ix_agg_cust" data-type="indexterm" id="id873"/><a contenteditable="false" data-primary="" data-startref="ix_cust_agg_func" data-type="indexterm" id="id874"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Pivoting" data-type="sect2"><div class="sect2" id="pivoting">&#13;
<h2>Pivoting</h2>&#13;
&#13;
<p>Pivoting<a contenteditable="false" data-primary="pivoting" data-type="indexterm" id="ix_pivot_ch6"/><a contenteditable="false" data-primary="aggregation" data-secondary="pivoting" data-type="indexterm" id="ix_agg_pivot"/><a contenteditable="false" data-primary="grouping in data tables" data-secondary="and pivoting" data-secondary-sortas="pivoting" data-type="indexterm" id="id875"/> is essentially a convenient way to arrange the results of a group and aggregation when grouping with two columns. Earlier in this section we grouped the baby names data by year and sex:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">counts_by_year_and_sex</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">baby</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Sex</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">)</code></span><code> </code><code>&#13;
</code><code> </code><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">sum</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">counts_by_year_and_sex</code></span><span><code class="o">.</code></span><span><code class="n">to_frame</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
			<th>Count</th>&#13;
		</tr>&#13;
		<tr>&#13;
			<th>Year</th>&#13;
			<th>Sex</th>&#13;
			<th> </th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td rowspan="2"><strong>1880</strong></td>&#13;
			<td><strong>F</strong></td>&#13;
			<td class="right">83929</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>M</strong></td>&#13;
			<td class="right">110490</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1881</strong></td>&#13;
			<td><strong>F</strong></td>&#13;
			<td class="right">85034</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2019</strong></td>&#13;
			<td><strong>M</strong></td>&#13;
			<td class="right">1785527</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td rowspan="2"><strong>2020</strong></td>&#13;
			<td><strong>F</strong></td>&#13;
			<td class="right">1581301</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>M</strong></td>&#13;
			<td class="right">1706423</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>282 rows × 1 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>This produces<a contenteditable="false" data-primary="pd.Series object" data-type="indexterm" id="id876"/><a contenteditable="false" data-primary="Series object" data-type="indexterm" id="id877"/> a <code>pd.Series</code> with the counts. We can also imagine the same data with the <code>Sex</code> index level “pivoted” to the columns of a dataframe. It’s easier to see with an example:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">mf_pivot</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">pivot_table</code></span><span><code class="p">(</code></span><code>&#13;
</code><code>    </code><span><code class="n">baby</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>    </code><span><code class="n">index</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>   </code><span><code class="c1"># Column to turn into new index</code></span><code>&#13;
</code><code>    </code><span><code class="n">columns</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Sex</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>  </code><span><code class="c1"># Column to turn into new columns</code></span><code>&#13;
</code><code>    </code><span><code class="n">values</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="c1"># Column to aggregate for values</code></span><code>&#13;
</code><code>    </code><span><code class="n">aggfunc</code></span><span><code class="o">=</code></span><span><code class="nb">sum</code></span><span><code class="p">)</code></span><code>    </code><span><code class="c1"># Aggregation function</code></span><code>&#13;
</code><span><code class="n">mf_pivot</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th>Sex</th>&#13;
			<th>F</th>&#13;
			<th>M</th>&#13;
		</tr>&#13;
		<tr>&#13;
			<th>Year</th>&#13;
			<th> </th>&#13;
			<th> </th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>1880</strong></td>&#13;
			<td>83929</td>&#13;
			<td>110490</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1881</strong></td>&#13;
			<td>85034</td>&#13;
			<td>100738</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1882</strong></td>&#13;
			<td>99699</td>&#13;
			<td>113686</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2018</strong></td>&#13;
			<td>1676884</td>&#13;
			<td>1810309</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2019</strong></td>&#13;
			<td>1651911</td>&#13;
			<td>1785527</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020</strong></td>&#13;
			<td>1581301</td>&#13;
			<td>1706423</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>141 rows × 2 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
	<p>As we can see in <code>mf_pivot</code> table, dataframe indexes can also be named. To read the output, it’s important to notice that the dataframe has two columns, M and F, stored in an index named Sex. Likewise, the dataframe has 141 rows, each with their own label. These labels are stored in an index named Year. Here, Sex and Year are the names of the dataframe indexes, and are not row or column labels themselves.</p>&#13;
</div>&#13;
&#13;
<p>Notice that the data values are identical in the pivot table and the table produced with <code>.groupby()</code>; the values are just arranged differently. Pivot tables are useful for quickly summarizing data using two attributes and are often seen in articles and papers.</p>&#13;
&#13;
<p>The <code>px.line()</code> function<a contenteditable="false" data-primary="px.line() function" data-type="indexterm" id="id878"/> also happens to work well with pivot tables, since the function draws one line for each column of data in the table:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">line</code></span><span><code class="p">(</code></span><span><code class="n">mf_pivot</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_traces</code></span><span><code class="p">(</code></span><span><code class="n">selector</code></span><span><code class="o">=</code></span><span><code class="mi">1</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">line_dash</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">dashdot</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_yaxes</code></span><span><code class="p">(</code></span><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Value</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_06in06.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>This section covered common<a contenteditable="false" data-primary="pivot_table() function" data-type="indexterm" id="id879"/> ways to aggregate data in <code>pandas</code> using the <code>.groupby()</code> function with one or more columns, or using the <code>pd.pivot_table()</code> function. In the next section, we’ll explain how to join dataframes together<a contenteditable="false" data-primary="" data-startref="ix_agg_pivot" data-type="indexterm" id="id880"/><a contenteditable="false" data-primary="" data-startref="ix_pivot_ch6" data-type="indexterm" id="id881"/><a contenteditable="false" data-primary="" data-startref="ix_agg_df" data-type="indexterm" id="id882"/><a contenteditable="false" data-primary="" data-startref="ix_de_agg" data-type="indexterm" id="id883"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Joining" data-type="sect1"><div class="sect1" id="joining">&#13;
<h1>Joining</h1>&#13;
&#13;
<p>Data<a contenteditable="false" data-primary="joining" data-type="indexterm" id="ix_join_ch6"/><a contenteditable="false" data-primary="dataframes" data-secondary="joining" data-type="indexterm" id="ix_df_join"/> scientists very frequently want to <em>join</em> two or more dataframes together in order to connect data values across dataframes. For instance, an online bookstore might have one dataframe with the books each user has ordered and a second dataframe with the genres of each book. By joining the two dataframes together, the data scientist can see what genres each user prefers.</p>&#13;
&#13;
<p>We’ll continue looking at the baby names data. We’ll use joins to check some trends mentioned in the <a class="reference external" href="https://oreil.ly/qL1dt"><em>New York Times</em> article about baby names</a>. The article talks about how certain categories of names have become more or less popular over time. For instance, it mentions that mythological names like Julius and Cassius have become popular, while baby boomer names like Susan and Debbie have become less popular. How has the popularity of these categories changed over time?</p>&#13;
&#13;
<p>We’ve taken the names and categories in the <em>NYT</em> article and put them in a small dataframe:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">nyt</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">read_csv</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">nyt_names.csv</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">nyt</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>nyt_name</th>&#13;
			<th>category</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Lucifer</td>&#13;
			<td>forbidden</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Lilith</td>&#13;
			<td>forbidden</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Danger</td>&#13;
			<td>forbidden</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>20</strong></td>&#13;
			<td>Venus</td>&#13;
			<td>celestial</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>21</strong></td>&#13;
			<td>Celestia</td>&#13;
			<td>celestial</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>22</strong></td>&#13;
			<td>Skye</td>&#13;
			<td>celestial</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>23 rows × 2 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>To see how popular the categories of names are, we join the <code>nyt</code> dataframe with the <code>baby</code> dataframe to get the name counts from <code>baby</code>:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">read_csv</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">babynames.csv</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">baby</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020719</strong></td>&#13;
			<td>Verona</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020720</strong></td>&#13;
			<td>Vertie</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020721</strong></td>&#13;
			<td>Wilma</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>2020722 rows × 4 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>For intuition, we can imagine going down each row in <code>baby</code> and asking: is this name in the <code>nyt</code> table? If so, then add the value in the <code>category</code> column to the row. This is the basic idea behind a join. Let’s look at a few examples on smaller dataframes first.</p>&#13;
&#13;
<section data-pdf-bookmark="Inner Joins" data-type="sect2"><div class="sect2" id="inner-joins">&#13;
<h2>Inner Joins</h2>&#13;
&#13;
<p>We start by making<a contenteditable="false" data-primary="joining" data-secondary="inner joins" data-type="indexterm" id="ix_join_inner"/><a contenteditable="false" data-primary="inner joins" data-type="indexterm" id="ix_inner_join"/> smaller versions of the <code>baby</code> and <code>nyt</code> tables so that it’s easier to see what happens when we join tables together:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">nyt_small</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>nyt_name</th>&#13;
			<th>category</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Karen</td>&#13;
			<td>boomer</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Julius</td>&#13;
			<td>mythology</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Freya</td>&#13;
			<td>mythology</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class=" pagebreak-before less_space">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby_small</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td class="right">18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Julius</td>&#13;
			<td>M</td>&#13;
			<td class="right">960</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Karen</td>&#13;
			<td>M</td>&#13;
			<td class="right">6</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3</strong></td>&#13;
			<td>Karen</td>&#13;
			<td>F</td>&#13;
			<td class="right">325</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>4</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>F</td>&#13;
			<td class="right">305</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>To join tables<a contenteditable="false" data-primary="merge() method, joining tables" data-type="indexterm" id="id884"/> in <code>pandas</code>, we’ll use the <code>.merge()</code> method:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby_small</code></span><span><code class="o">.</code></span><span><code class="n">merge</code></span><span><code class="p">(</code></span><span><code class="n">nyt_small</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">left_on</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>        </code><span><code class="c1"># column in left table to match</code></span><code>&#13;
</code><code>                 </code><span><code class="n">right_on</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">nyt_name</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>   </code><span><code class="c1"># column in right table to match</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
			<th>nyt_name</th>&#13;
			<th>category</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Julius</td>&#13;
			<td>M</td>&#13;
			<td class="right">960</td>&#13;
			<td>2020</td>&#13;
			<td>Julius</td>&#13;
			<td>mythology</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Karen</td>&#13;
			<td>M</td>&#13;
			<td class="right">6</td>&#13;
			<td>2020</td>&#13;
			<td>Karen</td>&#13;
			<td>boomer</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Karen</td>&#13;
			<td>F</td>&#13;
			<td class="right">325</td>&#13;
			<td>2020</td>&#13;
			<td>Karen</td>&#13;
			<td>boomer</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Notice that the new table has the columns of both the <code>baby_small</code> and <code>nyt_small</code> tables. The rows with the name <code>Noah</code> are gone. And the remaining rows have their matching <code>category</code> from <code>nyt_small</code>.</p>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Readers<a contenteditable="false" data-primary="join() method" data-type="indexterm" id="id885"/> should also be aware that <code>pandas</code> has a <code>.join()</code> method for joining two dataframes together. However, the <code>.merge()</code> method has more flexibility for how the dataframes are joined, which is why we focus on <code>.merge()</code>. We encourage readers to consult the <code>pandas</code> documentation for the exact difference between the two.</p>&#13;
</div>&#13;
&#13;
<p>When we join two tables together, we tell <code>pandas</code> the column(s) from each table that we want to use to make the join (the <code>left_on</code> and <code>right_on</code> arguments). <code>pandas</code> matches rows together when the values in the joining columns match, as shown in <a class="reference internal" data-type="xref" href="#fig-inner-join">Figure 6-4</a>.</p>&#13;
&#13;
<figure><div class="figure" id="fig-inner-join"><img alt="inner-join" src="assets/leds_0604.png"/>&#13;
<h6><span class="label">Figure 6-4. </span>To join, <code>pandas</code> matches rows using the values in the <code>Name</code> and <code>nyt_name</code> columns, dropping rows that don’t have matching values</h6>&#13;
</div></figure>&#13;
&#13;
<p>By default, <code>pandas</code> does an <em>inner join</em>. If either table has rows that don’t have matches in the other table, <code>pandas</code> drops those rows from the result. In this case, the <code>Noah</code> rows in <code>baby_small</code> don’t have matches in <code>nyt_small</code>, so they are dropped. Also, the <code>Freya</code> row in <code>nyt_small</code> doesn’t have matches in <code>baby_small</code>, so it’s dropped as well. Only the rows with a match in both tables stay in the final result<a contenteditable="false" data-primary="" data-startref="ix_join_inner" data-type="indexterm" id="id886"/><a contenteditable="false" data-primary="" data-startref="ix_inner_join" data-type="indexterm" id="id887"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Left, Right, and Outer Joins" data-type="sect2"><div class="sect2" id="left-right-and-outer-joins">&#13;
<h2>Left, Right, and Outer Joins</h2>&#13;
&#13;
<p>We sometimes<a contenteditable="false" data-primary="joining" data-secondary="left, right, outer joins" data-type="indexterm" id="ix_join_lro"/><a contenteditable="false" data-primary="left joins" data-type="indexterm" id="id888"/> want to keep rows without a match instead of dropping them entirely. There are other types of joins—left, right, and outer—that keep rows even when they don’t have a match.</p>&#13;
&#13;
<p>In a <em>left join</em>, rows in the left table without a match are kept in the final result, as shown in <a class="reference internal" data-type="xref" href="#fig-left-join">Figure 6-5</a>.</p>&#13;
&#13;
<figure><div class="figure" id="fig-left-join"><img alt="left-join" src="assets/leds_0605.png"/>&#13;
<h6><span class="label">Figure 6-5. </span>In a left join, rows in the left table that don’t have matching values are kept</h6>&#13;
</div></figure>&#13;
&#13;
<p>To do a left join<a contenteditable="false" data-primary="merge() method, joining tables" data-type="indexterm" id="id889"/> in <code>pandas</code>, use <code>how='left'</code> in the call to <code>.merge()</code>:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby_small</code></span><span><code class="o">.</code></span><span><code class="n">merge</code></span><span><code class="p">(</code></span><span><code class="n">nyt_small</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">left_on</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>        </code><code>&#13;
</code><code>                 </code><span><code class="n">right_on</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">nyt_name</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">how</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">left</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>           </code><span><code class="c1"># left join instead of inner</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
			<th>nyt_name</th>&#13;
			<th>category</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td class="right">18252</td>&#13;
			<td>2020</td>&#13;
			<td>NaN</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Julius</td>&#13;
			<td>M</td>&#13;
			<td class="right">960</td>&#13;
			<td>2020</td>&#13;
			<td>Julius</td>&#13;
			<td>mythology</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Karen</td>&#13;
			<td>M</td>&#13;
			<td class="right">6</td>&#13;
			<td>2020</td>&#13;
			<td>Karen</td>&#13;
			<td>boomer</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3</strong></td>&#13;
			<td>Karen</td>&#13;
			<td>F</td>&#13;
			<td class="right">325</td>&#13;
			<td>2020</td>&#13;
			<td>Karen</td>&#13;
			<td>boomer</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>4</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>F</td>&#13;
			<td class="right">305</td>&#13;
			<td>2020</td>&#13;
			<td>NaN</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Notice that the <code>Noah</code> rows are kept in the final table. Since those rows didn’t have a match in the <code>nyt_small</code> dataframe, the join leaves <code>NaN</code> values in the <code>nyt_name</code> and <code>category</code> columns. Also, notice that the <code>Freya</code> row in <code>nyt_small</code> is still dropped.</p>&#13;
&#13;
<p>A <em>right join</em> works<a contenteditable="false" data-primary="right joins" data-type="indexterm" id="id890"/> similarly to the left join, except that nonmatching rows in the right table are kept instead of the left table:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby_small</code></span><span><code class="o">.</code></span><span><code class="n">merge</code></span><span><code class="p">(</code></span><span><code class="n">nyt_small</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">left_on</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>        </code><code>&#13;
</code><code>                 </code><span><code class="n">right_on</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">nyt_name</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">how</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">right</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
			<th>nyt_name</th>&#13;
			<th>category</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Karen</td>&#13;
			<td>M</td>&#13;
			<td class="right">6.0</td>&#13;
			<td>2020.0</td>&#13;
			<td>Karen</td>&#13;
			<td>boomer</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Karen</td>&#13;
			<td>F</td>&#13;
			<td class="right">325.0</td>&#13;
			<td>2020.0</td>&#13;
			<td>Karen</td>&#13;
			<td>boomer</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Julius</td>&#13;
			<td>M</td>&#13;
			<td class="right">960.0</td>&#13;
			<td>2020.0</td>&#13;
			<td>Julius</td>&#13;
			<td>mythology</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3</strong></td>&#13;
			<td>NaN</td>&#13;
			<td>NaN</td>&#13;
			<td>NaN</td>&#13;
			<td>NaN</td>&#13;
			<td>Freya</td>&#13;
			<td>mythology</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Finally, an <em>outer join</em> keeps<a contenteditable="false" data-primary="outer join" data-type="indexterm" id="id891"/> rows from both tables even when they don’t have a match:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby_small</code></span><span><code class="o">.</code></span><span><code class="n">merge</code></span><span><code class="p">(</code></span><span><code class="n">nyt_small</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">left_on</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>        </code><code>&#13;
</code><code>                 </code><span><code class="n">right_on</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">nyt_name</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>                 </code><span><code class="n">how</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">outer</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
			<th>nyt_name</th>&#13;
			<th>category</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td class="right">18252.0</td>&#13;
			<td>2020.0</td>&#13;
			<td>NaN</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>F</td>&#13;
			<td class="right">305.0</td>&#13;
			<td>2020.0</td>&#13;
			<td>NaN</td>&#13;
			<td>NaN</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Julius</td>&#13;
			<td>M</td>&#13;
			<td class="right">960.0</td>&#13;
			<td>2020.0</td>&#13;
			<td>Julius</td>&#13;
			<td>mythology</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3</strong></td>&#13;
			<td>Karen</td>&#13;
			<td>M</td>&#13;
			<td class="right">6.0</td>&#13;
			<td>2020.0</td>&#13;
			<td>Karen</td>&#13;
			<td>boomer</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>4</strong></td>&#13;
			<td>Karen</td>&#13;
			<td>F</td>&#13;
			<td class="right">325.0</td>&#13;
			<td>2020.0</td>&#13;
			<td>Karen</td>&#13;
			<td>boomer</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>5</strong></td>&#13;
			<td>NaN</td>&#13;
			<td>NaN</td>&#13;
			<td>NaN</td>&#13;
			<td>NaN</td>&#13;
			<td>Freya</td>&#13;
			<td>mythology</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Example: Popularity of NYT Name Categories" data-type="sect2"><div class="sect2" id="example-popularity-of-nyt-name-categories">&#13;
<h2>Example: Popularity of NYT Name Categories</h2>&#13;
&#13;
<p>Now let’s return to the full<a contenteditable="false" data-primary="NYT name categories, popularity of" data-type="indexterm" id="ix_nyt_baby_name"/><a contenteditable="false" data-primary="joining" data-secondary="NYT name categories example" data-type="indexterm" id="ix_join_baby_names"/> dataframes <code>baby</code> and <code>nyt</code>. <code>.head()</code> slices out the first few rows, which is convenient for saving space:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">head</code></span><span><code class="p">(</code></span><span><code class="mi">2</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">nyt</code></span><span><code class="o">.</code></span><span><code class="n">head</code></span><span><code class="p">(</code></span><span><code class="mi">2</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>nyt_name</th>&#13;
			<th>category</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Lucifer</td>&#13;
			<td>forbidden</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Lilith</td>&#13;
			<td>forbidden</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>We want to know how the popularity of name categories in <code>nyt</code> has changed over time. To answer this question:</p>&#13;
&#13;
<ol class="arabic simple">&#13;
	<li>&#13;
	<p>Inner join <code>baby</code> with <code>nyt</code>.</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Group the table by <code>category</code> and <code>Year</code>.</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Aggregate the counts using a sum:</p>&#13;
	</li>&#13;
</ol>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-ipython3 notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">cate_counts</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><code>&#13;
</code><code>    </code><span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">merge</code></span><span><code class="p">(</code></span><span><code class="n">nyt</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">left_on</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">right_on</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">nyt_name</code><code class="s1">'</code></span><span><code class="p">)</code></span><code> </code><span><code class="c1"># [1]</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">category</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">)</code></span><code>                       </code><span><code class="c1"># [2]</code></span><code>&#13;
</code><code>    </code><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>                                            </code><span><code class="c1"># [3]</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">sum</code></span><span><code class="p">(</code><code class="p">)</code></span><code>                                               </code><span><code class="c1"># [3]</code></span><code>&#13;
</code><code>    </code><span><code class="o">.</code></span><span><code class="n">reset_index</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">cate_counts</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>category</th>&#13;
			<th>Year</th>&#13;
			<th>Count</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>boomer</td>&#13;
			<td>1880</td>&#13;
			<td>292</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>boomer</td>&#13;
			<td>1881</td>&#13;
			<td>298</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>boomer</td>&#13;
			<td>1882</td>&#13;
			<td>326</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>647</strong></td>&#13;
			<td>mythology</td>&#13;
			<td>2018</td>&#13;
			<td>2944</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>648</strong></td>&#13;
			<td>mythology</td>&#13;
			<td>2019</td>&#13;
			<td>3320</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>649</strong></td>&#13;
			<td>mythology</td>&#13;
			<td>2020</td>&#13;
			<td>3489</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>650 rows × 3 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p class="pagebreak-before less_space">Now we can plot the popularity of <code>boomer</code> names and <code>mythology</code> names:</p>&#13;
&#13;
<figure class="informal width-75"><div class="figure"><img src="assets/leds_06in07.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>As the <em>NYT</em> article claims, baby boomer names have become less popular since 2000, while mythology names have become more popular.</p>&#13;
&#13;
<p>We can also plot the popularities of all the categories at once. Take a look at the following plots and see whether they support the claims made in the <em>New York Times</em> article:</p>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_06in08.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>In this section, we introduced joins for dataframes. When joining dataframes together, we match rows using the <code>.merge()</code> function. It’s important to consider the type of join (inner, left, right, or outer) when joining dataframes. In the next section, we’ll explain how to transform values in a dataframe<a contenteditable="false" data-primary="" data-startref="ix_nyt_baby_name" data-type="indexterm" id="id892"/><a contenteditable="false" data-primary="" data-startref="ix_join_baby_names" data-type="indexterm" id="id893"/><a contenteditable="false" data-primary="" data-startref="ix_join_lro" data-type="indexterm" id="id894"/><a contenteditable="false" data-primary="" data-startref="ix_df_join" data-type="indexterm" id="id895"/><a contenteditable="false" data-primary="" data-startref="ix_join_ch6" data-type="indexterm" id="id896"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Transforming" data-type="sect1"><div class="sect1" id="transforming">&#13;
<h1>Transforming</h1>&#13;
&#13;
<p>Data<a contenteditable="false" data-primary="transformations" data-type="indexterm" id="ix_transf_ch6"/><a contenteditable="false" data-primary="dataframes" data-secondary="transforming" data-type="indexterm" id="ix_df_transf"/> scientists transform dataframe columns when they need to change each value in a feature in the same way. For example, if a feature contains heights of people in feet, a data scientist might want to transform the heights to centimeters. In this section, we’ll introduce <em>apply</em>, an operation that transforms columns of data using a user-defined function:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">pd</code></span><span><code class="o">.</code></span><span><code class="n">read_csv</code></span><span><code class="p">(</code></span><span><code class="s1">'</code><code class="s1">babynames.csv</code><code class="s1">'</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">baby</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
			<td>2020</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020719</strong></td>&#13;
			<td>Verona</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020720</strong></td>&#13;
			<td>Vertie</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020721</strong></td>&#13;
			<td>Wilma</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>2020722 rows × 4 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>In the baby names <em>New York Times</em> article, Pamela mentions that names starting with the letter L or K became popular after 2000. On the other hand, names starting with the letter J peaked in popularity in the 1970s and 1980s and dropped off in popularity since. We can verify these claims using the <code>baby</code> dataset.</p>&#13;
&#13;
<p>We approach this problem using the following steps:</p>&#13;
&#13;
<ol class="arabic simple">&#13;
	<li>&#13;
	<p>Transform the <code>Name</code> column into a new column that contains the first letters of each value in <code>Name</code>.</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Group the dataframe by the first letter and year.</p>&#13;
	</li>&#13;
	<li>&#13;
	<p>Aggregate the name counts by summing.</p>&#13;
	</li>&#13;
</ol>&#13;
&#13;
<p>To complete the first step, we’ll <em>apply</em> a function to the <code>Name</code> column.</p>&#13;
&#13;
<section data-pdf-bookmark="Apply" data-type="sect2"><div class="sect2" id="apply">&#13;
<h2>Apply</h2>&#13;
&#13;
<p><code>pd.Series</code> objects<a contenteditable="false" data-primary="apply() method" data-type="indexterm" id="ix_apply_meth"/><a contenteditable="false" data-primary="len function" data-type="indexterm" id="id897"/><a contenteditable="false" data-primary="transformations" data-secondary="apply() method" data-type="indexterm" id="ix_transf_apply"/> contain an <code>.apply()</code> method that takes in a function and applies it to each value in the series. For instance, to find the lengths of each name, we apply the <code>len</code> function:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">names</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Name</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><span><code class="n">names</code></span><span><code class="o">.</code></span><span><code class="n">apply</code></span><span><code class="p">(</code></span><span><code class="nb">len</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
0          4&#13;
1          4&#13;
2          6&#13;
          ..&#13;
2020719    6&#13;
2020720    6&#13;
2020721    5&#13;
Name: Name, Length: 2020722, dtype: int64&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>To extract the first letter of each name, we define a custom function and pass it into <code>.apply()</code>. The argument to the function is an individual value in the series:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="k">def</code></span><code> </code><span><code class="nf">first_letter</code></span><span><code class="p">(</code></span><span><code class="n">string</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="n">string</code></span><span><code class="p">[</code></span><span><code class="mi">0</code></span><span><code class="p">]</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="n">names</code></span><span><code class="o">.</code></span><span><code class="n">apply</code></span><span><code class="p">(</code></span><span><code class="n">first_letter</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_plain highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
0          L&#13;
1          N&#13;
2          O&#13;
          ..&#13;
2020719    V&#13;
2020720    V&#13;
2020721    W&#13;
Name: Name, Length: 2020722, dtype: object&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Using <code>.apply()</code> is similar to using a <code>for</code> loop. The preceding code is roughly equivalent to writing:</p>&#13;
&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">result</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">[</code><code class="p">]</code></span><code>&#13;
</code><span><code class="k">for</code></span><code> </code><span><code class="n">name</code></span><code> </code><span><code class="ow">in</code></span><code> </code><span><code class="n">names</code></span><span><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="n">result</code></span><span><code class="o">.</code></span><span><code class="n">append</code></span><span><code class="p">(</code></span><span><code class="n">first_letter</code></span><span><code class="p">(</code></span><span><code class="n">name</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>Now we can assign the first letters to a new column in the dataframe:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">letters</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">baby</code></span><span><code class="o">.</code></span><span><code class="n">assign</code></span><span><code class="p">(</code></span><span><code class="n">Firsts</code></span><span><code class="o">=</code></span><span><code class="n">names</code></span><span><code class="o">.</code></span><span><code class="n">apply</code></span><span><code class="p">(</code></span><span><code class="n">first_letter</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code><span><code class="n">letters</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Name</th>&#13;
			<th>Sex</th>&#13;
			<th>Count</th>&#13;
			<th>Year</th>&#13;
			<th>Firsts</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>Liam</td>&#13;
			<td>M</td>&#13;
			<td>19659</td>&#13;
			<td>2020</td>&#13;
			<td>L</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>Noah</td>&#13;
			<td>M</td>&#13;
			<td>18252</td>&#13;
			<td>2020</td>&#13;
			<td>N</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>Oliver</td>&#13;
			<td>M</td>&#13;
			<td>14147</td>&#13;
			<td>2020</td>&#13;
			<td>O</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020719</strong></td>&#13;
			<td>Verona</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
			<td>V</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020720</strong></td>&#13;
			<td>Vertie</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
			<td>V</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2020721</strong></td>&#13;
			<td>Wilma</td>&#13;
			<td>F</td>&#13;
			<td>5</td>&#13;
			<td>1880</td>&#13;
			<td>W</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>2020722 rows × 5 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>To create a new column in a dataframe, you might also encounter this syntax:</p>&#13;
&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Firsts</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">names</code></span><span><code class="o">.</code></span><span><code class="n">apply</code></span><span><code class="p">(</code></span><span><code class="n">first_letter</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>This mutates<a contenteditable="false" data-primary="assign() method" data-type="indexterm" id="id898"/><a contenteditable="false" data-primary="dataframes" data-secondary="mutating" data-type="indexterm" id="id899"/><a contenteditable="false" data-primary="mutating dataframes" data-type="indexterm" id="id900"/> the <code>baby</code> table by adding a new column called <code>Firsts</code>. In the preceding code, we use <code>.assign()</code>, which doesn’t mutate the <code>baby</code> table itself; it creates a new dataframe instead. Mutating dataframes isn’t wrong but can be a common source of bugs. Because of this, we’ll mostly use <code>.assign()</code> in this book.<a contenteditable="false" data-startref="ix_transf_apply" data-type="indexterm" id="id901"/><a contenteditable="false" data-primary="" data-startref="ix_apply_meth" data-type="indexterm" id="id902"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Example: Popularity of “L” Names" data-type="sect2"><div class="sect2" id="example-popularity-of-l-names">&#13;
<h2>Example: Popularity of “L” Names</h2>&#13;
&#13;
<p>Now<a contenteditable="false" data-primary="transformations" data-secondary="L names, popularity of" data-type="indexterm" id="ix_transf_lnames"/> we can use the <code>letters</code> dataframe to see the popularity of first letters over time:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">letter_counts</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="p">(</code></span><span><code class="n">letters</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">groupby</code></span><span><code class="p">(</code><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Firsts</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">)</code></span><code>&#13;
</code><code> </code><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">]</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">sum</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><code> </code><span><code class="o">.</code></span><span><code class="n">reset_index</code></span><span><code class="p">(</code><code class="p">)</code></span><code>&#13;
</code><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">letter_counts</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output text_html">&#13;
<div>&#13;
<table class="dataframe">&#13;
	<thead>&#13;
		<tr>&#13;
			<th> </th>&#13;
			<th>Firsts</th>&#13;
			<th>Year</th>&#13;
			<th>Count</th>&#13;
		</tr>&#13;
	</thead>&#13;
	<tbody>&#13;
		<tr>&#13;
			<td><strong>0</strong></td>&#13;
			<td>A</td>&#13;
			<td>1880</td>&#13;
			<td>16740</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>1</strong></td>&#13;
			<td>A</td>&#13;
			<td>1881</td>&#13;
			<td>16257</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>2</strong></td>&#13;
			<td>A</td>&#13;
			<td>1882</td>&#13;
			<td>18790</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>...</strong></td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
			<td>...</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3638</strong></td>&#13;
			<td>Z</td>&#13;
			<td>2018</td>&#13;
			<td>55996</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3639</strong></td>&#13;
			<td>Z</td>&#13;
			<td>2019</td>&#13;
			<td>55293</td>&#13;
		</tr>&#13;
		<tr>&#13;
			<td><strong>3640</strong></td>&#13;
			<td>Z</td>&#13;
			<td>2020</td>&#13;
			<td>54011</td>&#13;
		</tr>&#13;
	</tbody>&#13;
</table>&#13;
&#13;
<pre>3641 rows × 3 columns</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">line</code></span><span><code class="p">(</code></span><span><code class="n">letter_counts</code></span><span><code class="o">.</code></span><span><code class="n">loc</code></span><span><code class="p">[</code></span><span><code class="n">letter_counts</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Firsts</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="s1">'</code><code class="s1">L</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">,</code></span><code>&#13;
</code><code>              </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Popularity of </code><code class="s1">"</code><code class="s1">L</code><code class="s1">"</code><code class="s1"> names</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>              </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_layout</code></span><span><code class="p">(</code></span><span><code class="n">margin</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">t</code></span><span><code class="o">=</code></span><span><code class="mi">30</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal width-60"><div class="figure"><img src="assets/leds_06in09.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The plot shows that L names were popular in the 1960s, dipped in the decades after, but have indeed resurged in popularity since 2000.</p>&#13;
&#13;
<p>What about J names?</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="n">fig</code></span><code> </code><span><code class="o">=</code></span><code> </code><span><code class="n">px</code></span><span><code class="o">.</code></span><span><code class="n">line</code></span><span><code class="p">(</code></span><span><code class="n">letter_counts</code></span><span><code class="o">.</code></span><span><code class="n">loc</code></span><span><code class="p">[</code></span><span><code class="n">letter_counts</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Firsts</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">==</code></span><code> </code><span><code class="s1">'</code><code class="s1">J</code><code class="s1">'</code></span><span><code class="p">]</code><code class="p">,</code></span><code>&#13;
</code><code>              </code><span><code class="n">x</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">y</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Count</code><code class="s1">'</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">title</code></span><span><code class="o">=</code></span><span><code class="s1">'</code><code class="s1">Popularity of </code><code class="s1">"</code><code class="s1">J</code><code class="s1">"</code><code class="s1"> names</code><code class="s1">'</code></span><span><code class="p">,</code></span><code>&#13;
</code><code>              </code><span><code class="n">width</code></span><span><code class="o">=</code></span><span><code class="mi">350</code></span><span><code class="p">,</code></span><code> </code><span><code class="n">height</code></span><span><code class="o">=</code></span><span><code class="mi">250</code></span><span><code class="p">)</code></span><code>&#13;
</code><span><code class="n">fig</code></span><span><code class="o">.</code></span><span><code class="n">update_layout</code></span><span><code class="p">(</code></span><span><code class="n">margin</code></span><span><code class="o">=</code></span><span><code class="nb">dict</code></span><span><code class="p">(</code></span><span><code class="n">t</code></span><span><code class="o">=</code></span><span><code class="mi">30</code></span><span><code class="p">)</code><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<figure class="informal"><div class="figure"><img src="assets/leds_06in10.png"/>&#13;
&#13;
</div></figure>&#13;
&#13;
<p>The <em>NYT</em> article says that J names were popular in the 1970s and ’80s. The plot agrees and shows that they have become less popular since 2000<a contenteditable="false" data-primary="" data-startref="ix_transf_lnames" data-type="indexterm" id="id903"/>.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="The Price of Apply" data-type="sect2"><div class="sect2" id="the-price-of-apply">&#13;
<h2>The Price of Apply</h2>&#13;
&#13;
<p>The power<a contenteditable="false" data-primary="transformations" data-secondary="apply() method" data-type="indexterm" id="id904"/><a contenteditable="false" data-primary="numeric data" data-secondary="and apply() method" data-secondary-sortas="apply() method" data-type="indexterm" id="id905"/> of <code>.apply()</code> is its flexibility—you can call it with any function that takes in a single data value and outputs a single data value.</p>&#13;
&#13;
<p>Its flexibility<a contenteditable="false" data-primary="pd.Series object" data-type="indexterm" id="id906"/><a contenteditable="false" data-primary="Series object" data-type="indexterm" id="id907"/><a contenteditable="false" data-primary="vectorized operators versus apply() method" data-type="indexterm" id="id908"/><a contenteditable="false" data-primary="optimization" data-secondary="apply() method issue for pandas" data-type="indexterm" id="id909"/> has a price, though. Using <code>.apply()</code> can be slow, since <code>pandas</code> can’t optimize arbitrary functions. For example, using <code>.apply()</code> for numeric calculations is much slower than using vectorized operations directly on <code>pd.Series</code> objects:</p>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="o">%</code><code class="o">%</code></span><span><code class="n">timeit</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="c1"># Calculate the decade using vectorized operators</code></span><code>&#13;
</code><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code></span><code> </code><span><code class="o">/</code><code class="o">/</code></span><code> </code><span><code class="mi">10</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="mi">10</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output stream highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
9.66 ms ± 755 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell docutils container">&#13;
<div class="cell_input docutils container">&#13;
<div class="highlight-python notranslate">&#13;
<div class="highlight">&#13;
<pre data-code-language="python" data-type="programlisting">&#13;
<span><code class="o">%</code><code class="o">%</code></span><span><code class="n">timeit</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="k">def</code></span><code> </code><span><code class="nf">decade</code></span><span><code class="p">(</code></span><span><code class="n">yr</code></span><span><code class="p">)</code><code class="p">:</code></span><code>&#13;
</code><code>    </code><span><code class="k">return</code></span><code> </code><span><code class="n">yr</code></span><code> </code><span><code class="o">/</code><code class="o">/</code></span><code> </code><span><code class="mi">10</code></span><code> </code><span><code class="o">*</code></span><code> </code><span><code class="mi">10</code></span><code>&#13;
</code><code>&#13;
</code><span><code class="c1"># Calculate the decade using apply</code></span><code>&#13;
</code><span><code class="n">baby</code></span><span><code class="p">[</code></span><span><code class="s1">'</code><code class="s1">Year</code><code class="s1">'</code></span><span><code class="p">]</code></span><span><code class="o">.</code></span><span><code class="n">apply</code></span><span><code class="p">(</code></span><span><code class="n">decade</code></span><span><code class="p">)</code></span><code>&#13;
</code></pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<div class="cell_output docutils container">&#13;
<div class="output stream highlight-myst-ansi notranslate">&#13;
<div class="highlight">&#13;
<pre data-type="programlisting">&#13;
658 ms ± 49.6 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)&#13;
</pre>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
</div>&#13;
&#13;
<p>The version using <code>.apply()</code> is 30 times slower! For numeric operations in particular, we recommend operating on <code>pd.Series</code> objects directly.</p>&#13;
&#13;
<p>In this section, we introduced data transformations. To transform values in a dataframe, we commonly use the <code>.apply()</code> and <code>.assign()</code> functions. In the next section, we’ll compare dataframes with other ways to represent and manipulate data tables.<a contenteditable="false" data-primary="" data-startref="ix_df_transf" data-type="indexterm" id="id910"/><a contenteditable="false" data-primary="" data-startref="ix_transf_ch6" data-type="indexterm" id="id911"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="How Are Dataframes Different from Other Data Representations?" data-type="sect1"><div class="sect1" id="how-are-dataframes-different-from-other-data-representations">&#13;
<h1>How Are Dataframes Different from Other <span class="keep-together">Data Representations?</span></h1>&#13;
&#13;
<p>Dataframes are just one way to represent data stored in a table. In practice, data scientists encounter many other types of data tables, like spreadsheets, matrices, and relations. In this section, we’ll compare and contrast the dataframe with other representations to explain why dataframes have become so widely used for data analysis. We’ll also point out scenarios where other representations might be more <span class="keep-together">appropriate</span>.</p>&#13;
&#13;
<section data-pdf-bookmark="Dataframes and Spreadsheets" data-type="sect2"><div class="sect2" id="dataframes-and-spreadsheets">&#13;
<h2>Dataframes and Spreadsheets</h2>&#13;
&#13;
<p>Spreadsheets<a contenteditable="false" data-primary="spreadsheets" data-secondary="versus dataframes" data-type="indexterm" id="id912"/><a contenteditable="false" data-primary="dataframes" data-secondary="versus spreadsheets" data-secondary-sortas="spreadsheets" data-type="indexterm" id="id913"/> are computer applications in which users can enter data in a grid and use formulas to perform calculations. One well-known example today is Microsoft Excel, although spreadsheets date back to at least 1979 with <a class="reference external" href="https://doi.org/10.1109/MAHC.2007.4338439">VisiCalc</a>. Spreadsheets make it easy to see and directly manipulate data since spreadsheet formulas can automatically recalculate results whenever the data change. In contrast, dataframe code typically needs to be manually rerun when datasets are updated. These properties make spreadsheets highly popular—by <a class="reference external" href="https://doi.org/10.1109/VLHCC.2005.34">a 2005 estimate</a>, there are over 55 million spreadsheet users compared to 3 million professional programmers in industry.</p>&#13;
&#13;
<p>Dataframes have several key advantages over spreadsheets. Writing dataframe code in a computational notebook like Jupyter naturally produces a data lineage. Someone who opens the notebook can see the input files for the notebook and how the data were changed. Spreadsheets do not make a data lineage visible; if a person manually edits data values in a cell, it can be difficult for future users to see which values were manually edited and how they were edited. Dataframes can handle larger datasets than spreadsheets, and users can also use distributed programming tools to work with huge datasets that would be very hard to load into a spreadsheet.</p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Dataframes and Matrices" data-type="sect2"><div class="sect2" id="dataframes-and-matrices">&#13;
<h2>Dataframes and Matrices</h2>&#13;
&#13;
<p>A matrix<a contenteditable="false" data-primary="matrices" data-secondary="versus dataframes" data-secondary-sortas="dataframes" data-type="indexterm" id="id914"/><a contenteditable="false" data-primary="dataframes" data-secondary="versus matrices" data-secondary-sortas="matrices" data-type="indexterm" id="id915"/> is a two-dimensional array of data used primarily for linear algebra operations. In this next example, <span class="math notranslate nohighlight"><math> <mrow> <mi mathvariant="bold">X</mi> </mrow> </math></span> is a matrix with three rows and two columns:</p>&#13;
&#13;
<div data-type="equation">&#13;
<div class="math notranslate nohighlight"><math display="block"> <mtable columnalign="right" columnspacing="0em" displaystyle="true" rowspacing="3pt"> <mtr> <mtd> <mtable displaystyle="true" rowspacing="3pt"> <mtr> <mtd> <mrow> <mi mathvariant="bold">X</mi> </mrow> <mo>=</mo> <mrow> <mo>[</mo> <mtable columnalign="center" columnspacing="1em" rowspacing="4pt"> <mtr> <mtd> <mn>1</mn> </mtd> <mtd> <mn>0</mn> </mtd> </mtr> <mtr> <mtd> <mn>0</mn> </mtd> <mtd> <mn>4</mn> </mtd> </mtr> <mtr> <mtd> <mn>0</mn> </mtd> <mtd> <mn>0</mn> </mtd> </mtr> </mtable> <mo>]</mo> </mrow> </mtd> </mtr> </mtable> </mtd> </mtr> </mtable> </math></div>&#13;
</div>&#13;
&#13;
<p>Matrices<a contenteditable="false" data-primary="transposed matrix" data-type="indexterm" id="id916"/> are mathematical objects defined by the operators that they allow. For instance, matrices can be added or multiplied together. Matrices also have a transpose. These operators have very useful properties that data scientists rely on for statistical modeling.</p>&#13;
&#13;
<p>One important difference between a matrix and a dataframe is that when matrices are treated as mathematical objects, they can only contain numbers. Dataframes, on the other hand, can also have other types of data, like text. This makes dataframes more useful for loading and processing raw data that may contain all kinds of data types. In practice, data scientists often load data into dataframes, then manipulate the data into matrix form. In this book, we’ll generally use dataframes for exploratory data analysis and data cleaning, then process the data into matrices for machine learning models.</p>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Data<a contenteditable="false" data-primary="data types" data-secondary="and dataframe versus matrix" data-secondary-sortas="dataframe versus matrix" data-type="indexterm" id="id917"/><a contenteditable="false" data-primary="numpy arrays" data-type="indexterm" id="id918"/> scientists refer to matrices not only as mathematical objects but also as program objects. For instance, the R programming language has a matrix object, while in Python we could represent a matrix using a two-dimensional <code>numpy</code> array. Matrices as implemented in Python and R can contain other data types besides numbers, but they lose mathematical properties when doing so. This is yet another example of how domains can refer to different things with the same term.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Dataframes and Relations" data-type="sect2"><div class="sect2" id="dataframes-and-relations">&#13;
<h2>Dataframes and Relations</h2>&#13;
&#13;
<p>A relation<a contenteditable="false" data-primary="relations" data-secondary="versus dataframes" data-secondary-sortas="dataframes" data-type="indexterm" id="id919"/><a contenteditable="false" data-primary="SQL (structured query language)" data-secondary="dataframes versus relations" data-type="indexterm" id="id920"/><a contenteditable="false" data-primary="PostgreSQL" data-type="indexterm" id="id921"/><a contenteditable="false" data-primary="relational database management systems (RDBMs)" data-type="indexterm" id="id922"/><a contenteditable="false" data-primary="dataframes" data-secondary="versus relations" data-secondary-sortas="relations" data-type="indexterm" id="id923"/> is a data table representation used in database systems, especially SQL systems like SQLite and PostgreSQL. (We cover relations and SQL in <a class="reference internal" data-type="xref" href="ch07.html#ch-sql">Chapter 7</a>.) Relations share many similarities with dataframes; both use rows to represent records and columns to represent features. Both have column names, and data within a column have the same type.</p>&#13;
&#13;
<p>One key advantage of dataframes is that they don’t <em>require</em> rows to represent records and columns to represent features. Many times, raw data don’t come in a convenient format that can directly be put into a relation. In these scenarios, data scientists use the dataframe to load and process data since dataframes are more flexible in this regard. Often, data scientists will load raw data into a dataframe, then process the data into a format that can easily be stored in a relation.</p>&#13;
&#13;
<p>One key advantage that relations have over dataframes is that relations are used by relational database systems like <a class="reference external" href="https://oreil.ly/3zXyH">PostgreSQL</a>, which have highly useful features for data storage and management. Consider a data scientist at a company that runs a large social media website. The database might hold data that is far too large to read into a <code>pandas</code> dataframe all at once; instead, data scientists use SQL queries to subset and aggregate data since database systems are more capable of handling large datasets. Also, website users constantly update their data by making posts, uploading pictures, and editing their profiles. Here, database systems let data scientists reuse their existing SQL queries to update their analyses with the latest data rather than having to repeatedly download large CSV files.<a contenteditable="false" data-primary="" data-startref="ix_dataframe_ch6" data-type="indexterm" id="id924"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="sec-pandas-summary">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>In this chapter, we explained what dataframes are, why they’re useful, and how to work with them using <code>pandas</code> code. Subsetting, aggregating, joining, and transforming are useful in nearly every data analysis. We’ll rely on these operations often in the rest of the book, especially in Chapters <a class="reference internal" data-type="xref" data-xrefstyle="select:labelnumber" href="ch08.html#ch-files">8</a>, <a class="reference internal" data-type="xref" data-xrefstyle="select:labelnumber" href="ch09.html#ch-wrangling">9</a>, and <a class="reference internal" data-type="xref" data-xrefstyle="select:labelnumber" href="ch10.html#ch-eda">10</a>.</p>&#13;
</div></section>&#13;
</div></section></body></html>