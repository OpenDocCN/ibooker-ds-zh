<html><head></head><body>
<p id="filepos7451" class="calibre_"><span class="calibre2"><span class="bold"><span class="calibre_15">Preface</span></span></span></p><p class="calibre_16">Microsoft is running a feedback forum for Excel on <a href="https://oreil.ly/y1XwU"><span class="calibre_7">UserVoice</span></a> where everybody can submit a new idea for others to vote on. The top voted feature request is “Python as an Excel scripting language,” and it has roughly twice as many votes as the second most voted feature request. Though nothing really happened since the idea was added in 2015, Excel users were fueled with new hope at the end of 2020 when Guido van Rossum, the creator of Python, <a href="https://oreil.ly/N1_7N"><span class="calibre_7">tweeted</span></a> that his “retirement was boring” and he would join Microsoft. If his move has any influence on the integration of Excel and Python, I don’t know. I do know, however, what makes this combination so compelling and how you can start using Excel and Python together—today. And this is, in a nutshell, what this book is about.</p><p class="calibre_6">The main driving force behind the <span class="italic">Python for Excel</span> story is the fact that we are living in a world of data. Nowadays, huge datasets are available to everybody and about everything. Often, these datasets are so big that they don’t fit into a spreadsheet anymore. A few years ago, this may have been referred to <a id="filepos8884"/>as <span class="italic">big data</span>, but nowadays, a dataset of a few million rows is really nothing special. Excel has evolved to cope with that trend: it introduced <a id="filepos9041"/>Power Query to load and clean datasets that don’t fit into a spreadsheet and <a id="filepos9127"/>Power Pivot, an add-in to perform data analysis on these datasets and present the results. Power Query is based on the <a id="filepos9253"/>Power Query M formula language (M), while Power Pivot defines formulas by using<a id="filepos9339"/> Data Analysis Expressions (DAX). If you also want to automate a few things in your Excel file, then you would use Excel’s built-in automation language, <a id="filepos9501"/>Visual Basic for Applications (VBA). That is, for something fairly simple, you can end up using VBA, M, and DAX. One issue with this is that all these languages only serve you in the Microsoft world, most prominently in Excel and Power BI (I will introduce Power BI briefly in <a href="index_split_007.html#filepos32075"><span class="calibre_7">Chapter 1</span></a>).</p><p class="calibre_6">Python, <a id="filepos9905"/>on the other hand, is a general-purpose programming language that has become one of the most popular choices amongst analysts and data scientists. If you use Python with Excel, you are able to use a programming language that is good at all aspects of the story, whether that’s automating Excel, accessing and preparing datasets, or performing data analysis and visualization tasks. Most importantly, you can reuse your Python skills outside of Excel: if you need to scale up your computing power, you could easily move your quantitative model, simulation, or machine learning application to the cloud, where practically unconstrained computing resources are waiting for <a id="filepos10584"/>you.</p><p id="filepos10599" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Why I Wrote This Book</span></span></span></p><p class="calibre_6">Through my work on xlwings, the Excel automation package that we will meet in <a href="index_split_023.html#filepos1235617"><span class="calibre_7">Part IV</span></a> of this book, I am in close contact with many users who use Python for Excel—whether that’s via the <a href="https://oreil.ly/ZJQkB"><span class="calibre_7">issue tracker</span></a> on GitHub, a question on <a href="https://stackoverflow.com"><span class="calibre_7">StackOverflow</span></a> or at a physical event like a meetup or a conference.</p><p class="calibre_6">On a regular basis, I am asked to recommend resources to get started with Python. While there is certainly no shortage of Python introductions, they are often either too general (nothing about data analysis) or too specific (full scientific introductions). However, Excel users tend to be somewhere in the middle: they certainly work with data, but a full scientific introduction may be too technical. They also often have specific requirements and questions that aren’t answered in any of the existing material. Some of these questions are:</p><div class="calibre_8"> </div><ul class="calibre_9"><li value="1" class="calibre_13"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">Which Python-Excel package do I need for which task?</blockquote></blockquote></blockquote></blockquote></li><li value="2" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">How do I move my Power Query database connection over to Python?</blockquote></blockquote></blockquote></blockquote></li><li value="3" class="calibre_10"><blockquote class="calibre_18"><blockquote class="calibre4"><blockquote class="calibre4"><blockquote class="calibre_19">What’s the equivalent of Excel’s AutoFilter or pivot table in Python?</blockquote></blockquote></blockquote></blockquote></li></ul><p class="calibre_14">I wrote this book to get you from zero Python knowledge to be able to automate your Excel-centric tasks and leverage Python’s data analysis and scientific computing tools in Excel without any detours.</p><div class="mbp_pagebreak" id="calibre_pb_3"/>


<p id="filepos12953" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Who This Book Is For</span></span></span></p><p class="calibre_6">If you are an advanced Excel user who wants to beat the limits of Excel with a modern programming language, this book is for you. Most typically, this means that you spend hours every month downloading, cleaning, and copy/pasting big amounts of data into mission-critical spreadsheets. While there are different ways to overcome Excel’s limits, this book will focus on how to use Python for this task.</p><p class="calibre_6">You should have a basic understanding of programming: it helps if you have already written a function or a for loop (no matter in which programming language) and have an idea about what an integer or a string is. You might even be able to master this book if you are used to writing complex cell formulas or have experience with tweaking recorded VBA macros. You are not expected to have any Python-specific experience, though, as there are introductions to all the tools that we will use including an introduction to Python itself.</p><p class="calibre_6">If you are a seasoned VBA developer, you will find regular comparisons between Python and VBA that will allow you to ship around the common gotchas and hit the ground running.</p><p class="calibre_6">This book can also be helpful if you are a Python developer and need to learn about the different ways that Python can deal with the Excel application and Excel files to be able to pick the right package given the requirements of your business users.</p><div class="mbp_pagebreak" id="calibre_pb_4"/>


<p id="filepos14647" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">How This Book Is Organized</span></span></span></p><p class="calibre_6">In this book, I will show you all aspects of the <span class="italic">Python for Excel</span> story split into four parts:</p><p class="calibre_6"><a href="index_split_006.html#filepos31953"><span class="italic"><span class="calibre_7">Part I: Introduction to Python</span></span></a></p><blockquote class="calibre_18"><blockquote class="calibre_19">This part starts by looking into the reasons why Python is such an enjoyable companion for Excel before introducing the tools we’ll be using in this book: the Anaconda Python distribution, Visual Studio Code, and Jupyter notebooks. This part will also teach you enough Python to be able to master the rest of this book.</blockquote></blockquote><p class="calibre_20"><a href="index_split_013.html#filepos433190"><span class="italic"><span class="calibre_7">Part II: Introduction to pandas</span></span></a></p><blockquote class="calibre_18"><blockquote class="calibre_19">pandas is Python’s go-to library for data analysis. We will learn how to replace Excel workbooks with a combination of Jupyter notebooks and pandas. Usually, pandas code is both easier to maintain and more efficient than an Excel workbook, and you can work with datasets that don’t fit into a spreadsheet. Unlike Excel, pandas allows you to run your code wherever you want, including the cloud.</blockquote></blockquote><p class="calibre_20"><a href="index_split_018.html#filepos863198"><span class="italic"><span class="calibre_7">Part III: Reading and Writing Excel Files without Excel</span></span></a></p><blockquote class="calibre_18"><blockquote class="calibre_19">This part is about manipulating Excel files by using one of the following Python packages: pandas, OpenPyXL, XlsxWriter, pyxlsb, xlrd, and xlwt. These packages are able to read and write Excel workbooks directly on disk and as such replace the Excel application: as you don’t require an installation of Excel, they work on any platform that Python supports, including Windows, macOS, and Linux. A typical use case for a reader package is to read in data from Excel files that you receive every morning from an external company or system and store their contents in a database. A typical use case for a writer package is to provide the functionality behind the famous “Export to Excel” button that you find in almost every application.</blockquote></blockquote><p class="calibre_20"><a href="index_split_023.html#filepos1235617"><span class="italic"><span class="calibre_7">Part IV: Programming the Excel Application with xlwings</span></span></a></p><blockquote class="calibre_18"><blockquote class="calibre_19">In this part, we’ll see how we can use Python with the xlwings package to automate the Excel application rather than reading and writing Excel files on disk. Therefore, this part requires you to have a local installation of Excel. We will learn how to open Excel workbooks and manipulate them in front of our eyes. In addition to reading and writing files via Excel, we will build interactive Excel tools: these allow us to click a button to have Python perform something that you may have done previously with VBA macros, such as a computationally expensive calculation. We’ll also learn how to write user-defined functions<a href="#filepos31598"><span class="calibre5"><span class="calibre_7">1</span></span></a> (UDFs) in Python instead of VBA.</blockquote><a id="filepos18058"/></blockquote><p class="calibre_16">It’s important to understand the fundamental difference between <a id="filepos18185"/>reading and writing Excel <span class="italic">files</span> (<a href="index_split_018.html#filepos863198"><span class="calibre_7">Part III</span></a>) and programming the Excel <span class="italic">application</span> (<a href="index_split_023.html#filepos1235617"><span class="calibre_7">Part IV</span></a>) as visualized in <a href="#filepos18540"><span class="calibre_7">Figure P-1</span></a>.</p><p class="calibre_21"><img src="images/00027.jpg" id="filepos18540" class="calibre_22"/>
</p><p class="calibre_23"><span class="calibre5"><span class="italic"><span class="calibre_15">Figure P-1. Reading and writing Excel files (Part III) vs. programming Excel (Part IV)</span></span></span></p><p class="calibre_24">Since <a href="index_split_018.html#filepos863198"><span class="calibre_7">Part III</span></a> doesn’t require an installation of Excel, everything works on all platforms that Python supports, mainly Windows, macOS, and Linux. <a href="index_split_023.html#filepos1235617"><span class="calibre_7">Part IV</span></a>, however, will only work on those platforms that Microsoft Excel supports, i.e., Windows and macOS, as the code relies on a local installation of Microsoft Excel.</p><p id="filepos19282" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Python and Excel Versions</span></span></span></p><p class="calibre_6">This <a id="filepos19456"/>book is based on Python 3.8, which is the Python version that comes with the latest version of the Anaconda Python distribution at the time of this writing. If you want to use a newer version of Python, follow the instructions on the <a href="https://xlwings.org/book"><span class="calibre_7">book’s home page</span></a>, but make sure that you don’t use an older version. I will occasionally make a comment if something changes with Python 3.9.</p><p class="calibre_6">This<a id="filepos19959"/> book also expects you to use a modern version of Excel, meaning at least Excel 2007 on Windows and Excel 2016 on macOS. The locally installed version of Excel that comes with the Microsoft 365 subscription will also work perfectly—in fact, I even recommend it, as it has the latest features that you won’t find in other versions of Excel. It was also the version I used to write this book, so if you use another version of Excel, you might sometimes see a small difference in the name or location of a menu <a id="filepos20478"/>item.</p><p id="filepos20494" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Conventions Used in This Book</span></span></span></p><p class="calibre_6">The following typographical conventions are used in this book:</p><p class="calibre_6"><span class="italic">Italic</span></p><blockquote class="calibre_18"><blockquote class="calibre_19">Indicates new terms, URLs, email addresses, filenames, and file extensions.</blockquote></blockquote><p class="calibre_20"><tt class="calibre6"><span class="italic">Constant width</span></tt></p><blockquote class="calibre_18"><blockquote class="calibre_19">Used for program listings, as well as within paragraphs to refer to program elements such as variable or function names, databases, data types, environment variables, statements, and keywords.</blockquote></blockquote><p class="calibre_20"><tt class="calibre6"><span class="italic"><span class="bold">Constant width bold</span></span></tt></p><blockquote class="calibre_18"><blockquote class="calibre_19">Shows commands or other text that should be typed literally by the user.</blockquote></blockquote><p class="calibre_20"><tt class="calibre6"><span class="italic">Constant width italic</span></tt></p><blockquote class="calibre_18"><blockquote class="calibre_19">Shows text that should be replaced with user-supplied values or by values determined by context.</blockquote></blockquote><blockquote class="calibre_25"><span class="bold"><span class="calibre_26">TIP</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">This element signifies a tip or suggestion.</span></blockquote><blockquote class="calibre_28"><span class="bold"><span class="calibre_26">NOTE</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">This element signifies a general note.</span></blockquote><blockquote class="calibre_28"><span class="bold"><span class="calibre_29">WARNING</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">This element indicates a warning or caution.</span></blockquote><p id="filepos22519" class="calibre_30"><span class="calibre3"><span class="bold"><span class="calibre_7">Using Code Examples</span></span></span></p><p class="calibre_6">I am maintaining a <a href="https://xlwings.org/book"><span class="calibre_7">web page</span></a> with additional information to help you with this book. Make sure to check it out, especially if you run into an issue.</p><p class="calibre_6">Supplemental material (code examples, exercises, etc.) is available for download at <a href="https://github.com/fzumstein/python-for-excel"><span class="italic"><span class="calibre_7">https://github.com/fzumstein/python-for-excel</span></span></a>. To download this companion repository, click on the green Code button, then select Download ZIP. Once downloaded, right-click the file on Windows and select Extract All to unzip the contained files into a folder. On macOS, simply double-click the file to unzip. If you know how to work with Git, you could also use Git to clone the repository to your local hard disk. You can put the folder anywhere you want, but I will refer to it occasionally as follows in this book:</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>C:\Users\</tt></span><span class="calibre5"><tt class="calibre6"><span class="italic">username</span></tt></span><span class="calibre5"><tt class="calibre6">\python-for-excel<br class="calibre1"/></tt></span></blockquote><p class="calibre_32">By simply downloading and unzipping the ZIP file on Windows, you’ll end up with a folder structure similar to this one (note the repeated folder names):</p><blockquote class="calibre_31"><span class="calibre5"><tt class="calibre6"><br class="calibre1"/>C:\...\Downloads\python-for-excel-1st-edition\python-for-excel-1st-edition<br class="calibre1"/></tt></span></blockquote><p class="calibre_32">Copying the contents of this folder into one you create under <span class="italic">C:\Users\&lt;username&gt;\python-for-excel</span> might make it easier for you to follow along. The same remarks are true for macOS, i.e., copy the files to <span class="italic">/Users/&lt;username&gt;/python-for-excel</span>.</p><p class="calibre_6">If you have a technical question or a problem using the code examples, please send an email to <a href="mailto:bookquestions@oreilly.com"><span class="italic"><span class="calibre_7">bookquestions@oreilly.com</span></span></a>.</p><p class="calibre_6">This book is here to help you get your job done. In general, if example code is offered with this book, you may use it in your programs and documentation. You do not need to contact us for permission unless you’re reproducing a significant portion of the code. For example, writing a program that uses several chunks of code from this book does not require permission. Selling or distributing examples from O’Reilly books does require permission. Answering a question by citing this book and quoting example code does not require permission. Incorporating a significant amount of example code from this book into your product’s documentation does require permission.</p><p class="calibre_6">We appreciate, but generally do not require, attribution. An attribution usually includes the title, author, publisher, and ISBN. For example: “<span class="italic">Python for Excel</span> by Felix Zumstein (O’Reilly). Copyright 2021 Zoomer Analytics LLC, 978-1-492-08100-5.”</p><p class="calibre_6">If you feel your use of code examples falls outside fair use or the permission given above, feel free to contact us at <a href="mailto:permissions@oreilly.com"><span class="italic"><span class="calibre_7">permissions@oreilly.com</span></span></a>.</p><p id="filepos26099" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">O’Reilly Online Learning</span></span></span></p><blockquote class="calibre_25"><span class="bold"><span class="calibre_26">NOTE</span></span></blockquote><blockquote class="calibre_27"><span class="calibre5">For more than 40 years, </span><a href="http://oreilly.com"><span class="calibre5"><span class="italic"><span class="calibre_7">O’Reilly Media</span></span></span></a><span class="calibre5"> has provided technology and business training, knowledge, and insight to help companies succeed.</span></blockquote><p class="calibre_16">Our unique network of experts and innovators share their knowledge and expertise through books, articles, and our online learning platform. O’Reilly’s online learning platform gives you on-demand access to live training courses, in-depth learning paths, interactive coding environments, and a vast collection of text and video from O’Reilly and 200+ other publishers. For more information, visit <a href="http://oreilly.com"><span class="italic"><span class="calibre_7">http://oreilly.com</span></span></a>.</p><p id="filepos27203" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">How to Contact Us</span></span></span></p><p class="calibre_6">Please address comments and questions concerning this book to the publisher:</p><div class="calibre_8"> </div><ul class="calibre_9"><li value="1" class="calibre_10">O’Reilly Media, Inc.</li><li value="2" class="calibre_11">1005 Gravenstein Highway North</li><li value="3" class="calibre_11">Sebastopol, CA 95472</li><li value="4" class="calibre_11">800-998-9938 (in the United States or Canada)</li><li value="5" class="calibre_11">707-829-0515 (international or local)</li><li value="6" class="calibre_11">707-829-0104 (fax)</li></ul><p class="calibre_17">We have a web page for this book, where we list errata, examples, and any additional information. You can access this page at <a href="https://oreil.ly/py4excel"><span class="italic"><span class="calibre_7">https://oreil.ly/py4excel</span></span></a>.</p><p class="calibre_6">Email <a href="mailto:bookquestions@oreilly.com"><span class="italic"><span class="calibre_7">bookquestions@oreilly.com</span></span></a> to comment or ask technical questions about this book.</p><p class="calibre_6">For more information about our books, courses, conferences, and news, see our website at <a href="http://www.oreilly.com"><span class="italic"><span class="calibre_7">http://www.oreilly.com</span></span></a>.</p><p class="calibre_6">Find us on Facebook: <a href="http://facebook.com/oreilly"><span class="italic"><span class="calibre_7">http://facebook.com/oreilly</span></span></a>.</p><p class="calibre_6">Follow us on Twitter: <a href="http://twitter.com/oreillymedia"><span class="italic"><span class="calibre_7">http://twitter.com/oreillymedia</span></span></a>.</p><p class="calibre_6">Watch us on YouTube: <a href="http://www.youtube.com/oreillymedia"><span class="italic"><span class="calibre_7">http://www.youtube.com/oreillymedia</span></span></a>.</p><p id="filepos29274" class="calibre_17"><span class="calibre3"><span class="bold"><span class="calibre_7">Acknowledgments</span></span></span></p><p class="calibre_6">As a first-time author, I am incredibly grateful for the help I got from so many people along the way—they made this journey a lot easier for me!</p><p class="calibre_6">At O’Reilly, I would like to thank my editor, Melissa Potter, who did a great job in keeping me motivated and on schedule and who helped me to bring this book into a readable form. I’d also like to thank Michelle Smith, who worked with me on the initial book proposal, and Daniel Elfanbaum, who never tired of answering my technical questions.</p><p class="calibre_6">A big thank you goes to all my colleagues, friends, and clients who invested many hours in reading the earliest forms of my drafts. Their feedback was crucial to making the book easier to understand, and some of the case studies are inspired by real-world Excel problems that they shared with me. My thanks go to Adam Rodriguez, Mano Beeslar, Simon Schiegg, Rui Da Costa, Jürg Nager, and Christophe de Montrichard.</p><p class="calibre_6">I also got helpful feedback from readers of the Early Release version that was published on the O’Reilly online learning platform. Thank you Felipe Maion, Ray Doue, Kolyu Minevski, Scott Drummond, Volker Roth, and David Ruggles!</p><p class="calibre_6">I was very lucky that the book got reviewed by highly qualified tech reviewers and I really appreciate the hard work they put in under a lot of time pressure. Thanks for all your help, Jordan Goldmeier, George Mount, Andreas Clenow, Werner Brönnimann, and Eric Moreira!</p><p class="calibre_6">Special thanks go to Björn Stiel, who wasn’t just a tech reviewer, but from whom I also learned many of the things I am writing about in this book. I’ve enjoyed working with you these past few years!</p><p class="calibre_6">Last but not least, I’d like to extend my gratitude to Eric Reynolds, who merged his ExcelPython project into the xlwings code base in 2016. He also redesigned the whole package from scratch, making my horrible API from the early days a thing of the past. Thank you very much!</p><blockquote id="filepos31598" class="calibre_33"><a href="#filepos18058"><span class="calibre5"><span class="calibre_7">1  </span></span></a><span class="calibre5"> Microsoft has started to use the term </span><span class="calibre5"><span class="italic">custom functions</span></span><span class="calibre5"> instead of UDFs. In this book, I will continue to call them UDFs.</span></blockquote><div class="mbp_pagebreak" id="calibre_pb_5"/>
</body></html>