- en: Chapter 2\. Essential Facilities for Spatial Analysis
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[Chapter 1](ch01.xhtml#introduction_to_geospatial_analytics) covered the complexity
    of mapping a three-dimensional (3D) globe to a two-dimensional (2D) coordinate
    system. This often requires an understanding of how to select an appropriate map
    projection depending on the area you are interested in viewing or analyzing. You
    learned how 3D coordinates on the surface of the Earth can be converted to 2D
    coordinates. For that, the concepts of *geoid* and *ellipsoid* were introduced.
    You also saw a variety of map projections in [Chapter 1](ch01.xhtml#introduction_to_geospatial_analytics),
    and I discussed how to choose an appropriate one for a given area—for example,
    selecting a projection that minimizes distortion over the area you are viewing.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: What happens to topographical features that are below or above the Earth’s surface?
    Geospatial tools are also able to analyze these features spatially as well as
    time-series data, which is often described as a *fourth dimension*.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: You may have noticed the term *GIS* doing a lot of the heavy lifting when learning
    about spatial literacy, but in reality there are multiple integrated concepts
    contributing at the systems level. I have discussed the *spatial data framework,*
    where spatial locations are identified on the Earth’s surface. This is fundamental
    for building a comprehensive (and reliable) reference system for geocoding and
    mapping data.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, you will continue to build on your spatial literacy skills
    with three brief sample projects in QGIS. First, you will download and customize
    the QGIS dashboard. Then I’ll introduce simple Python scripting as you explore
    data from the NYC Open Data portal. The Mapping Inequality project will provide
    an opportunity to explore historical data and download the data for analysis in
    QGIS. This will help you familiarize yourself with QGIS and introduce you to important
    concepts, including uploading vector data layers, filtering datasets, and writing
    Python scripts in the console.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: Exploring Spatial Data in QGIS
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: I mentioned QGIS in the previous chapter, and although you will work with it
    extensively in [Chapter 3](ch03.xhtml#qgis_exploring_pyqgis_and_native_algori),
    you’ll get your feet wet in this chapter by using QGIS and Python to explore publicly
    available datasets and discuss some key concepts of spatial literacy.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: QGIS is a free and open source GIS. A *GIS*, which you might recall stands for
    “geographic information system,” is a complete application or system of tools
    for working with geospatial data. Once you download the software, you will have
    access to these tools. Python is available as a plug-in and is easily installed.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: Installing QGIS
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To follow along, please install QGIS. You can download and install the software
    at the [QGIS Project’s website](https://qgis.org/en/site). (Look for the long-term
    repositories for stability, identified as “LTR” on the site. Detailed installation
    instructions are in the [User Guide](https://oreil.ly/mgycA).) Your dashboard
    will resemble the one shown in [Figure 2-1](#qgis_dashboard_showing_the_browser_left)
    once you add a few panels to the view.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 要进行操作，请安装 QGIS。您可以在[QGIS 项目网站](https://qgis.org/en/site)上下载并安装软件。（请寻找标识为“LTR”的长期存储库以获得稳定版。详细的安装说明在[用户指南](https://oreil.ly/mgycA)中。）一旦您添加了几个面板到视图中，您的仪表板将类似于[图 2-1](#qgis_dashboard_showing_the_browser_left)
    所示的样子。
- en: '![QGIS dashboard showing the Browser (A), Layers (B), Processing Toolbox (C),
    and Layer Styling (D) panels](assets/pgda_0201.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![QGIS 仪表板显示浏览器（A）、图层（B）、处理工具箱（C）和图层样式（D）面板](assets/pgda_0201.png)'
- en: Figure 2-1\. QGIS dashboard showing the (A) Browser, (B) Layers, (C) Processing
    Toolbox, and (D) Layer Styling panels
  id: totrans-11
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 2-1\. QGIS 仪表板显示（A）浏览器、（B）图层、（C）处理工具箱和（D）图层样式面板
- en: '[Figure 2-1](#qgis_dashboard_showing_the_browser_left) shows the (a) Browser,
    (b) Layers, (c) Processing Toolbox, and (d) Layer Styling panels (unselected in
    the lower right corner). The Browser allows you to view your computer file system
    and upload data into the QGIS Layers panel or drag files directly onto the canvas.
    The Processing Toolbox has several tools to explore; you will be using the Python
    scripting tool in a later exercise in the chapter. Last, the Layer Styling panel
    provides customization for points on a map, transparency of levels, and color
    schemes (among its many features). In the last exercise in the chapter, you will
    assign a color scheme to a map legend describing grades of perceived desirability
    of neighborhood communities.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 2-1](#qgis_dashboard_showing_the_browser_left) 显示（a）浏览器、（b）图层、（c）处理工具箱和（d）图层样式面板（右下角未选择）。浏览器允许您查看计算机文件系统，并将数据上传到
    QGIS 图层面板或直接拖放文件到画布上。处理工具箱有几个工具可以探索；在本章后续的 Python 脚本工具练习中将使用。最后，图层样式面板提供了地图上点的定制选项，透明级别和颜色方案（在其众多功能中）。在本章的最后一个练习中，您将为地图图例分配一个描述社区感知可取性等级的颜色方案。'
- en: Customizing your dashboard is relatively straightforward. Select View from the
    menu at the top of your screen and scroll down to Panels. [Figure 2-2](#customizing_your_dashboard_with_display)
    shows the checked options that have been added to the console. You can move them
    around according to your preference by selecting them individually and moving
    them to the desired location.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 自定义您的仪表板相对直观。从屏幕顶部的菜单中选择“视图”，然后向下滚动到“面板”。[图 2-2](#customizing_your_dashboard_with_display)
    显示了已添加到控制台的选项。您可以通过逐个选择它们并将其移动到所需位置来按照您的偏好移动它们。
- en: '![Customizing your dashboard with display options, such as panels](assets/pgda_0202.png)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![使用显示选项（如面板）自定义您的仪表板](assets/pgda_0202.png)'
- en: Figure 2-2\. Customizing your dashboard with display options, such as panels
  id: totrans-15
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 2-2\. 使用显示选项（如面板）自定义您的仪表板
- en: Adding Basemaps to QGIS
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加底图到 QGIS
- en: Adding additional basemaps is one last customization that will help enhance
    your work environment. Basemaps are reference maps that add context to the data
    layers. Your XYZ Tiles folder (scroll down in your lefthand Browser panel) will
    currently appear empty. To add basemaps, navigate to the [GitHub page of Qiusheng
    Wu](https://oreil.ly/SH2p6), Assistant Professor of Geography at the University
    of Tennessee, Knoxville. Click on the raw file to download it directly to the
    Downloads folder. You can opt for a different location, but you will have to recall
    where it is located to upload it to the Python console. [Figure 2-3](#the_executable_file_for_downloading_bas)
    is a snippet of the screen you will see.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 添加额外的底图是最后一项定制工作，将有助于增强您的工作环境。底图是参考地图，可为数据图层增添背景信息。您的 XYZ Tiles 文件夹（在左侧浏览器面板中向下滚动）目前为空。要添加底图，请访问田纳西大学助理教授吴秋生的[GitHub页面](https://oreil.ly/SH2p6)。单击原始文件以直接下载到下载文件夹。您可以选择不同的位置，但需要记住其位置以便将其上传到Python控制台。[图 2-3](#the_executable_file_for_downloading_bas)
    是您将看到的屏幕片段。
- en: '![The executable file for downloading basemaps to QGIS](assets/pgda_0203.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![下载底图到 QGIS 的可执行文件](assets/pgda_0203.png)'
- en: Figure 2-3\. The executable file for downloading basemaps to QGIS
  id: totrans-19
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 2-3\. 下载底图到 QGIS 的可执行文件
- en: Right-click in the text and save the file to your Downloads folder as a *.py*
    script ([Figure 2-4](#saving_the_python_script_to_your_downlo)).
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: '![Saving the Python script to your Downloads folder](assets/pgda_0204.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
- en: Figure 2-4\. Saving the Python script to your Downloads folder
  id: totrans-22
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Your script is now saved to your local computer. There are multiple locations
    to open the Python Console in QGIS, indicated by the Python icon. [Figure 2-5](#installing_the_python_plug_in_to_qgis)
    highlights the console icon in the Plugins menu at the top of the dashboard.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: '![Installing the Python plug-in to QGIS](assets/pgda_0205.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
- en: Figure 2-5\. Installing the Python plug-in to QGIS
  id: totrans-25
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The Python Console is where you can enter a few line-by-line commands or click
    the Show Editor button on the menu to enter Python scripts or snippets of code.
    The code snippets are run from the editor. The Python code editor has a save option
    if you are writing longer scripts. This feature is a reason you may decide to
    run code in the editor as opposed to simply dragging layers onto canvas.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: Click the icon of a pad of paper with a pencil to open the scripting window.
    When you select the green + symbol, you can navigate to the location of the downloaded
    script. Hit the run icon (a little green arrow symbol), and the code will run
    in the console ([Figure 2-6](#run_the_script_and_the_basemaps_will_po)). You will
    now see available basemaps populating the XYZ Tile folder. Drag them directly
    onto the canvas to view them. Be sure to reorder the basemap when adding layers
    to the canvas. You will want the data layers to be at the top of the Layers panel.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: '![Run the script and the basemaps will populate the XYZ Tiles folder](assets/pgda_0206.png)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
- en: Figure 2-6\. Run the script and the basemaps will populate the XYZ Tiles folder
  id: totrans-29
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: QGIS has a powerful programming interface that allows you to extend its core
    functionality and write scripts to automate your tasks in Python scripting language.
    Even if you are new to programming, learning a little bit of Python and navigating
    this interface will enable you to be much more productive in your geospatial data
    work.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: Exploring Data Resources
  id: totrans-31
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This book mainly uses data resources that I first used in my training or in
    projects, updated with the latest reported data. You can access the resources
    directly from my [GitHub page](https://oreil.ly/SbS0R). I want to be certain you
    can access the datasets no matter what operating system you use. QGIS has a wide
    variety of tools that make this straightforward.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-33
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'If you are an advanced user and would like to replace the datasets in this
    book with local data or data that reflects your personal or professional interests,
    here are a few suggestions:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: You will want a healthy mix of urban and rural locations with different types
    of roads, boundaries, water features, and topographies.
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When given a choice, I prefer recent data, but for instructional purposes, I
    defer to sources with the widest variety of attributes.
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Don’t forget to save your data in the GeoPackage file format so you will be
    able to continue exploring.
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you are creating a raster file of your region, locate the extent coordinates
    of your largest layer.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Visualizing Environmental Complaints in New York City
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can see an example of how geography is represented in QGIS in [Figure 2-7](#the_dohmh_indoor_environmental_complain).
    The points represent indoor environmental complaints received by the Department
    of Health and Mental Hygiene (DOHMH) in New York City. The data in this image
    is from [NYC Open Data](https://oreil.ly/QGsn5), a resource for free public data
    from city agencies and other partners. This particular dataset can be downloaded
    from the [GitHub repository accompanying this book](https://oreil.ly/9ADWy).
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: '![The DOHMH Indoor Environmental Complaint dataset shown in the QGIS interface;
    the left panel is the Browser, and the right panel is the canvas](assets/pgda_0207.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
- en: Figure 2-7\. The DOHMH Indoor Environmental Complaint dataset shown in the QGIS
    interface; the left panel is the Browser, and the right panel is the canvas
  id: totrans-42
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Uploading Data to QGIS
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You have a few options to upload the data into QGIS. Using the Browser panel,
    select the Home folder (circled in [Figure 2-7](#the_dohmh_indoor_environmental_complain)),
    navigate to your Downloads folder, and select the dataset file that you downloaded.
    You can drag shapefiles (*.shp*) into the view from the Browser directly onto
    the canvas (the right panel).
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: What you are observing in [Figure 2-7](#the_dohmh_indoor_environmental_complain)
    are the 311 information hotline calls made within New York City during a certain
    period of time. Initially, you don’t know much about the nature of the calls or
    how the data could be filtered for better insights.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
- en: Uploading files with the Data Source Manager
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The Data Source Manager (circled in [Figure 2-8](#using_the_data_source_manager_to_upload))
    is the first option, and my preferred one, for uploading data from *.csv* files.
    If your data has a geometry column, as this one does (see the Latitude and Longitude
    columns in the Sample Data window in [Figure 2-8](#using_the_data_source_manager_to_upload)),
    you can select them in the X field (longitude) and Y field (latitude) and add
    the data to the Layers panel in your console.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: Until you confirm or edit the delimited file with geometric attributes, it will
    not be considered spatial. This option is preferred for *.csv* files because,
    although QGIS often recognizes geometric attributes instinctually, you may need
    to change data types manually in the column headings.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: '![Using the Data Source Manager to upload delimited text files](assets/pgda_0208.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
- en: Figure 2-8\. Using the Data Source Manager to upload delimited text files
  id: totrans-50
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Adding data as a vector layer
  id: totrans-51
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You also have the option of adding the dataset as a vector layer, as shown in
    [Figure 2-9](#adding_data_as_a_vector_layer). This works well for GeoJSON and
    a variety of other data formats. QGIS can detect most types of geometries. I prefer
    this method when working with PostgreSQL databases, as it simplifies the process
    of updating files stored outside of QGIS.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding data as a vector layer](assets/pgda_0209.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
- en: Figure 2-9\. Adding data as a vector layer
  id: totrans-54
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Right-click on a data file in the Layers panel and you will see an option to
    view the Attribute Table (shown as a snapshot in [Figure 2-10](#examining_the_attribute_table_to_determ)).
    The Attribute Table is useful for reviewing the columns available as well as the
    format of the geometry (Latitude and Longitude). A small but important detail
    is to match the case of column headers when writing code to avoid errors when
    running your scripts.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: '![Examining the Attribute Table to determine geometry columns](assets/pgda_0210.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
- en: Figure 2-10\. Examining the Attribute Table to determine geometry columns
  id: totrans-57
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: You can also customize your basemaps now that you have uploaded the additional
    basemaps to QGIS (as shown in [Figure 2-11](#adding_the_data_layer_and_the_openstree)).
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding the data layer and the OpenStreetMap basemap from XYZ Tiles](assets/pgda_0211.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
- en: Figure 2-11\. Adding the data layer and the OpenStreetMap basemap from XYZ Tiles
  id: totrans-60
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Setting the Project CRS
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: QGIS will attempt to assign a project coordinate reference system (CRS), as
    seen in [Figure 2-12](#setting_the_crs_layer_epsgfourthreetwos). You can  change
    it in the Layer CRS window, visible when clicking the data in the Layers panel.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: '![Setting the CRS Layer EPSG:4326—WGS84](assets/pgda_0212.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
- en: Figure 2-12\. Setting the CRS Layer EPSG:4326—WGS84
  id: totrans-64
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Now that the CRS layer is selected, you can hover over points in the map for
    additional information. Select the Identify Features icon (the small “i” inside
    a blue circle), then select a point on the map.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: You will explore many of these geospatial and nongeospatial features a little
    later on when we begin working in the Python Console.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: Using the Query Editor to Filter Data
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let’s say that our research question here is: w*here are Manhattan residents
    reporting issues concerning asbestos?* Asbestos levels are important to monitor
    because asbestos is a known carcinogen when released into the atmosphere. QGIS
    has a built-in query builder that can help familiarize you with datasets. Right-click
    on the dataset in the Layers panel and choose Filter.'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: When you click on a field, it will populate in the Provider Specific Filter
    Expression console, shown in [Figure 2-13](#filtering_data_by_incident_type_and_loc).
    Select the Sample option under Values to view the sample data. Add an Operator
    and click the Test button at the bottom of the console. You will see how many
    rows have been returned. You can add more filters to the data or click OK and
    load the updated dataset to your canvas. Scrolling through the Fields and selecting
    Sample will provide information for exploring in the console.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 当您点击字段时，它将填充在提供者特定过滤表达式控制台中，如[图2-13](#filtering_data_by_incident_type_and_loc)所示。在值下选择示例选项以查看示例数据。添加一个操作符并点击控制台底部的测试按钮。您将看到返回的行数。您可以向数据添加更多过滤器，或者点击确定并将更新后的数据集加载到您的画布中。通过浏览字段并选择示例，可以提供在控制台中探索的信息。
- en: '![Filtering data by incident type and location](assets/pgda_0213.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![根据事件类型和位置过滤数据](assets/pgda_0213.png)'
- en: Figure 2-13\. Filtering data by incident type and location
  id: totrans-71
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图2-13\. 根据事件类型和位置过滤数据
- en: The canvas in [Figure 2-14](#the_canvas_updated_with_a_new_query_to) has been
    filtered to show only asbestos complaints. There are additional options to filter
    based on Complaint_Status and Date, if you want to explore!
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '[图2-14](#the_canvas_updated_with_a_new_query_to)中的画布已过滤，仅显示石棉投诉。如果您想要探索，还有基于投诉状态和日期的其他过滤选项！'
- en: What follows is a brief introduction to the Python Console in QGIS. You will
    run some code and even generate a template script in the Processing Toolbox.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是关于QGIS中Python控制台的简要介绍。您将运行一些代码，甚至可以在处理工具箱中生成一个模板脚本。
- en: '![The canvas updated with a new query to show asbestos complaints](assets/pgda_0214.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![更新后的画布，显示石棉投诉](assets/pgda_0214.png)'
- en: Figure 2-14\. The canvas updated with a new query to show asbestos complaints
  id: totrans-75
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图2-14\. 更新后的画布，显示石棉投诉的新查询
- en: Visualizing Population Data
  id: totrans-76
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 可视化人口数据
- en: Whether you are planning on making maps professionally or for personal use,
    finding great data resources can be a challenge. [Natural Earth](https://www.naturalearthdata.com)
    is a public-domain dataset available through collaboration and support from volunteers
    and the North American Cartographic Information Society (NACIS).
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 无论您是专业制作地图还是个人使用，寻找优质的数据资源都可能是一个挑战。[Natural Earth](https://www.naturalearthdata.com)是一个公共领域数据集，通过志愿者和北美地图学信息协会（NACIS）的支持和协作可用。
- en: 'Its freely available vector and raster data—in shapefile and TIFF format, respectively—all
    use the EPSG:4326 projection, also known as the WGS84 projection. Additionally,
    you can choose how detailed the data is for downloading. The more detailed data,
    1:10 m,^([1](ch02.xhtml#ch01fn6)) will be the most resource intensive, with 1:50
    m and 1:110 m providing moderate and coarse levels of detail. This relationship
    is described as a representative fraction scale: 1 unit on the map (such as inches
    or centimeters) represents the equivalent units on the ground. In our example,
    1:50,000,000 means 1 cm = 50 km or 1 inch = 790 miles. In the left panel in [Figure 2-15](#population_data_by_python_console_windo),
    you see the Browser window. Once you download the dataset, it can be uploaded
    from the Browser window and brought directly onto the canvas (in the right panel).
    Drag the shapefile (*.shp*) into view. The points represent populated places in
    the world. The attributes associated with each symbol include capitals, major
    cities, and towns, for example. The shaded polygons represent urban areas.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 它的免费可用矢量和栅格数据——分别以shapefile和TIFF格式提供，都使用EPSG:4326投影，也被称为WGS84投影。此外，您可以选择下载数据的详细程度。更详细的数据，1:10米^([1](ch02.xhtml#ch01fn6))将消耗最多资源，而1:50米和1:110米则提供中等和粗略级别的详细信息。这种关系被描述为代表性分数比例尺：地图上的1单位（如英寸或厘米）表示地面上的等价单位。在我们的示例中，1:50,000,000意味着1厘米=50公里或1英寸=790英里。在[图2-15](#population_data_by_python_console_windo)的左侧面板中，您可以看到浏览器窗口。下载数据集后，可以从浏览器窗口上传并直接将其放置在画布上（在右侧面板）。将shapefile（*.shp*）拖入视图中。点表示世界上的有人居住的地方。与每个符号相关联的属性包括首都、大城市和城镇等。
- en: '![Population Data by Python Console window (QGIS)](assets/pgda_0215.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![Python控制台窗口中的人口数据（QGIS）](assets/pgda_0215.png)'
- en: Figure 2-15\. Population data by Python Console window (QGIS)
  id: totrans-80
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图2-15\. Python控制台窗口中的人口数据（QGIS）
- en: Once the data is on the canvas, you can begin to query in the Python Console.
    To expand the console, select the icon on the left (under the red arrow on the
    left). Code will run when you select the green button (under the red arrow on
    the right). When running a single line of code, the >>> console is fine. When
    I am iterating over multiple lines of code, I use the editor (the panel on the
    lower right).
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 当数据在画布上时，您可以在 Python 控制台中进行查询。要展开控制台，请选择左侧的图标（位于左侧的红色箭头下方）。选择右侧红色箭头下方的绿色按钮后，代码将运行。当运行单行代码时，>>>
    控制台很好用。当我需要迭代多行代码时，我使用编辑器（位于右下角的面板）。
- en: The QGIS Python Console
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: QGIS Python 控制台
- en: 'You can also upload data to the canvas using the Python Console. Add the vector
    layer to your local computer: select Layer >> Add Layer >> Add Vector Layer. Copy
    the path from there or, if you know your directory and the name of the file, you
    can enter it directly.'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用 Python 控制台将数据上传到画布。将矢量图层添加到本地计算机：选择图层 >> 添加图层 >> 添加矢量图层。从那里复制路径，或者如果您知道您的目录和文件名，则可以直接输入。
- en: Create a variable called `uri` (or whatever you prefer; I like `uri`, which
    stands for *uniform resource identifier—*a character string for identifying resources).
    You are storing the string that describes the path or source of the data. This
    will be one of the three parameters you see below in the code snippet for the
    `iface.addVectorLayer` function. The second parameter is the layer name you choose,
    and `ogr` is the provider key (representing the OGR Simple Features Library, today
    known only by its acronym). Other examples of provider keys include *postgres*
    and *delimited text*.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个名为 `uri` 的变量（或任何您喜欢的名字；我喜欢 `uri`，它代表*统一资源标识符*—用于标识资源的字符字符串）。您正在存储描述数据路径或源的字符串。这将是
    `iface.addVectorLayer` 函数代码片段中看到的三个参数之一。第二个参数是您选择的图层名称，`ogr` 是提供者关键字（代表 OGR 简单要素库，今天仅以其首字母缩写称呼）。其他提供者关键字的示例包括*postgres*和*分隔文本*。
- en: 'Write this code into the Python Console, substituting your own username as
    it appears in your filepath:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 将以下代码写入 Python 控制台，用您的用户名替换您在文件路径中的出现位置：
- en: '[PRE0]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Run the script, and the canvas populates with the data points. You can also
    query populations in the editor:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 运行脚本，画布将填充数据点。您还可以在编辑器中查询人口：
- en: '[PRE1]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The indentations in your code are important for delineating code that is part
    of a function; you will get an error if you forget to include them when required.
    You can see code examples in the editor in [Figure 2-15](#population_data_by_python_console_windo),
    in the [Python documentation](https://oreil.ly/aPqZE), and in the [PyQGIS Developer
    Cookbook](https://oreil.ly/XFgS7) online reference. The code result displays in
    the left window. When you successfully run the code, you will see the output available
    for scrolling.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 您代码中的缩进对于标识作为函数一部分的代码非常重要；如果在必要时忘记包含它们，将会出现错误。您可以在 [图 2-15](#population_data_by_python_console_windo)
    中的编辑器中查看代码示例，在 [Python 文档](https://oreil.ly/aPqZE) 中查看，也可以在线参考 [PyQGIS 开发者手册](https://oreil.ly/XFgS7)
    中的代码。代码结果显示在左窗口中。当您成功运行代码时，您将看到可供滚动查看的输出。
- en: 'When writing code in the editor, comment out any code you do not want to run
    again (by starting the line with #), as each time you run the cell it will generate
    output. Remember to use your own filepath. If the points are not styled to your
    taste, you can use the Layer Styling panel or write Python code into the console.'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在编辑器中编写代码时，请注释掉不想再次运行的任何代码（以#开头的行），因为每次运行单元格时都会生成输出。记得使用您自己的文件路径。如果点的样式不符合您的口味，您可以使用图层样式面板或在控制台中编写
    Python 代码。
- en: 'A renderer modifies how the data is displayed in a data layer. Next, run the
    following code and adjust the `setSize` parameter to your liking:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 渲染器修改数据层中数据的显示方式。接下来，运行以下代码，并根据您的喜好调整 `setSize` 参数：
- en: '[PRE2]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The `triggerRepaint` function will update the map. If you don’t call this function,
    the map won’t update until you run the canvas again.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '`triggerRepaint` 函数将更新地图。如果不调用此函数，地图在再次运行画布之前将不会更新。'
- en: 'The Class [`QgsSimpleMarkerSymbolLayerBase`](https://oreil.ly/gxOJ9) modifies
    the shape, size, angle, and scale method of parameters, with many shape options
    available (listed in the [documentation](https://oreil.ly/5zu3W)). Enter the following
    code to change the shape of the point from a circle to a star:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 类 [`QgsSimpleMarkerSymbolLayerBase`](https://oreil.ly/gxOJ9) 修改参数的形状、大小、角度和比例方法，提供多种形状选项（列在[文档](https://oreil.ly/5zu3W)中）。输入以下代码以将点的形状从圆形更改为星形：
- en: '[PRE3]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'More advanced scripting options are available in the Processing Toolbox. If
    you scroll down to the Python Scripts icon, you will see any saved scripts listed
    under Example Scripts. If you select the Python icon at the top of the Processing
    Toolbox, you will see four options: Create New Script, Create New Script From
    Template, Open Existing Script, and Add Script to Toolbox.'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: Select Create New Script From Template. Run the script (see the log in [Figure 2-16](#python_scripting_window_rendering_a_map)),
    and the output layer will show in the Layers Panel as a new layer.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: '![Python scripting window rendering a map](assets/pgda_0216.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
- en: Figure 2-16\. Python scripting window rendering a map
  id: totrans-99
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Loading a Raster Layer
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The data you are using is from the [QGIS sample data repository](https://oreil.ly/3fZQh).
    The steps for loading a raster layer are similar to those for loading a vector
    layer. The biggest differences are that we are now using a *.tif* file, and the
    provider parameter is now `gdal` (from the Geospatial Data Abstraction Library,
    which we’ll discuss in [Chapter 9](ch09.xhtml#exploring_the_geospatial_data_abstracti))
    instead of `ogr`:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'It can be helpful to use `if` statements in determining if the code run is
    successful. The `print` statement is indented and will be run when the specific
    condition holds:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Following is an example of raster statistics you can run in the console, and
    many more are available in the [QGIS documentation](https://oreil.ly/OKP96):'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The output is shown in [Figure 2-17](#adding_a_raster_layer_to_the_canvas)
    and here:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: This indicates the pixel values and the *extent,* or actual dimensions, of the
    layer we are viewing.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding a raster layer to the canvas](assets/pgda_0217.png)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
- en: Figure 2-17\. Adding a raster layer to the canvas
  id: totrans-111
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Redlining: Mapping Inequalities'
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'I’ll end this chapter with a powerful visualization that demonstrates the value
    of place and location when considering a data question. The [Mapping Inequality:
    Redlining in New Deal America](https://oreil.ly/LOcDk) research project presents
    data from the [Home Owners’ Loan Corporation (HOLC)](https://oreil.ly/M4kIq),
    a federal foreclosure-prevention program introduced in 1933 as part of President
    Franklin Delano Roosevelt’s New Deal. Here’s how the site introduces the data:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: HOLC staff members, using data and evaluations organized by local real estate
    professionals—lenders, developers, and real estate appraisers—in each city, assigned
    grades to residential neighborhoods that reflected their “mortgage security” that
    would then be visualized on color-coded maps. Neighborhoods receiving the highest
    grade of “A”—colored green on the maps—were deemed minimal risks for banks and
    other mortgage lenders when they were determining who should receive loans and
    which areas in the city were safe investments. Those receiving the lowest grade
    of “D,” colored red, were considered “hazardous.”
  id: totrans-114
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: This practice, called redlining, locked existing land-use systems into place.
    Areas outside of the best classifications (green or blue) were more likely to
    flood (due to more asphalt covering the ground), to have fewer parks and limited
    treelines, and to be closer to garbage dumps and interstate freeways.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 这种做法称为红线划定，将现有的土地利用系统锁定在原地。最佳分类（绿色或蓝色）之外的地区更有可能发生洪水（由于更多的沥青覆盖地面）、拥有较少的公园和有限的绿化带，更靠近垃圾堆和州际高速公路。
- en: The project’s website allows you to select a city and explore maps. I spend
    a lot of time in New York City, so I selected Manhattan in the screenshot in [Figure 2-18](#redlining_a_map_of_holc_neighborhood_gr).
    I have walked the neighborhoods of New York City for many years, watching economic
    investments into neighborhoods once widely considered too dangerous to roam. The
    1930s redlining maps highlighted the neighborhoods that surround Central Park
    as “still desirable” and “best”—as long as they weren’t too close to Harlem and
    other primarily Black neighborhoods.^([2](ch02.xhtml#ch01fn7)) Although mortgage-security
    redlining is no longer a government-sponsored practice, the land-use systems in
    many of these areas are still locked in and are often explored as foundational
    to research directed toward environmental racism.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 该项目的网站允许您选择一个城市并浏览地图。我在纽约市花了很多时间，所以在[图 2-18](#redlining_a_map_of_holc_neighborhood_gr)的截图中选择了曼哈顿。多年来，我在纽约市的各个社区漫步，目睹了曾被广泛认为太危险的社区的经济投资。1930年代的红线地图将围绕中央公园的社区突出为“仍然理想”和“最佳”——只要它们不靠近哈林和其他主要黑人社区即可。^([2](ch02.xhtml#ch01fn7))尽管抵押证券红线政策不再是政府支持的做法，但许多这些地区的土地利用系统仍然受到限制，并且常常被探讨为环境种族主义研究的基础。
- en: '![](assets/pgda_0218.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/pgda_0218.png)'
- en: 'Figure 2-18\. Redlining: a map of HOLC neighborhood grades in 1930s Manhattan,
    generated with the Mapping Inequality project’s online tool'
  id: totrans-118
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 2-18\. 红线划定：1930年代曼哈顿的HOLC社区等级地图，由Mapping Inequality项目的在线工具生成
- en: The data can be downloaded and uploaded to QGIS. Add the shapefiles by dragging
    them from the Browser panel onto the canvas. To update the colored polygons according
    to HOLC grade, use the Layer Styling panel, as shown in [Figure 2-19](#styling_the_shapefiles_by_holc_grade),
    to select Categorized as a format and `holc_grade` as the value, then each color
    as the symbol (selected individually for each value by clicking on each square).
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 可以下载数据并上传到 QGIS。通过将 shapefile 从浏览器面板拖放到画布上添加 shapefile。要根据 HOLC 等级更新彩色多边形，请使用图层样式面板，如[图
    2-19](#styling_the_shapefiles_by_holc_grade)，选择分类格式，并将`holc_grade`作为值，然后每个颜色作为符号（通过单击每个方块单独选择）。
- en: '![Styling the shapefiles by HOLC grade](assets/pgda_0219.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![根据HOLC等级进行shapefile样式设定](assets/pgda_0219.png)'
- en: Figure 2-19\. Styling the shapefiles by HOLC grade
  id: totrans-121
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 2-19\. 根据HOLC等级进行shapefile样式设定
- en: '[Figure 2-20](#qgis_attribute_table_for_mapcomma_which) shows the New York
    City map and attribute table displayed in QGIS. Saving the layer as a file will
    make it available for other maps, where you can examine the persistent impact
    of redlining.'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 2-20](#qgis_attribute_table_for_mapcomma_which)显示了在 QGIS 中显示的纽约市地图和属性表。将图层保存为文件，可用于其他地图，您可以检查红线的持久影响。'
- en: '![QGIS attribute table for map, which includes the attributes state, city,
    holc_grade, neighborhood, and area](assets/pgda_0220.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![包括`state`、`city`、`holc_grade`、`neighborhood`和`area`等属性的QGIS地图属性表](assets/pgda_0220.png)'
- en: Figure 2-20\. QGIS attribute table for map, which includes the attributes `state`,
    `city`, `holc_grade`, `neighborhood`, and `area`
  id: totrans-124
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 2-20\. QGIS 地图属性表，包括`state`、`city`、`holc_grade`、`neighborhood`和`area`等属性。
- en: 'Redlined areas were—and are—also more likely to be *urban heat islands*: artificial
    or natural locations with higher temperatures than the city average. Neighborhoods
    with more greenery, fewer impervious surfaces covering the ground, or fewer industrial
    or large buildings tend to absorb sun more easily than neighborhoods full of concrete,
    so they are cooler in the summer. Cooler neighborhoods are shown in yellow in
    [Figure 2-21](#urban_heat_islandscomma_calculated_with), and the warmer areas
    are indicated by orange and red. The red circle in [Figure 2-21](#urban_heat_islandscomma_calculated_with)
    depicts a concentration of higher surface temperatures that maps to HOLC red and
    yellow grades from the 1930s. The satellite images often capture urban clusters
    on Earth examining the LandScan urban extant and associated temperatures.'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 红线区域在过去和现在更可能成为*城市热岛*：人工或自然的位置比城市平均温度更高。拥有更多绿色植被、较少覆盖地面的不透水表面或较少工业或大型建筑的社区往往比充斥混凝土的社区更容易吸收阳光，因此在夏季更凉爽。在[图
    2-21](#urban_heat_islandscomma_calculated_with)中，较凉爽的社区以黄色显示，较暖的区域以橙色和红色表示。[图
    2-21](#urban_heat_islandscomma_calculated_with)中的红色圆圈显示了映射到1930年代HOLC红色和黄色等级的高表面温度集中区域。卫星图像经常捕捉地球上的城市集群，检查LandScan城市扩展及相关温度。
- en: '![Urban heat islands, calculated with mean average between 2003 and 2018\.
    Data source: Earth Engine Data Catalog](assets/pgda_0221.png)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![城市热岛，计算从 2003 年到 2018 年的平均值。数据来源：Earth Engine Data Catalog](assets/pgda_0221.png)'
- en: 'Figure 2-21\. Urban heat islands, calculated with mean average between 2003
    and 2018\. Data source: [Earth Engine Data Catalog](https://oreil.ly/Fw1tg)'
  id: totrans-127
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 2-21\. 城市热岛，计算从 2003 年到 2018 年的平均值。数据来源：[Earth Engine Data Catalog](https://oreil.ly/Fw1tg)
- en: Summary
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 概要
- en: In this chapter, you were introduced to QGIS and its Python Console. You learned
    how to load *.csv* and delimited files, shapefiles, and raster data. QGIS has
    a robust query editor, but often you can execute the same tasks in the Python
    Console or editor. You also got a taste for how bringing data together into a
    map can help you explore complex research questions. Publicly available geospatial
    datasets can be powerful decision-resource tools for exploring societal harms
    and benefits as well as frameworks for evaluating potential risks in the public
    and private sector. This book will provide a window into the scale of the resources
    available and show you how to interact and explore location intelligence to draw
    out deeper insights and bigger questions.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您已经了解了 QGIS 及其 Python 控制台。您学习了如何加载 *.csv* 和分隔文件、shapefile 和栅格数据。QGIS 拥有强大的查询编辑器，但通常您可以在
    Python 控制台或编辑器中执行相同的任务。您还尝试了如何将数据整合到地图中，以帮助您探索复杂的研究问题。公开可用的地理空间数据集可以成为探索社会伤害和利益的强大决策资源工具，也是评估公共和私营部门潜在风险框架的基础。本书将为您展示可用资源的规模，并指导您如何交互和探索位置智能，以获取更深层次的洞察和更大的问题。
- en: In the next chapter, you will learn more about PyQGIS, the Python language of
    QGIS.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，您将更多地了解 PyQGIS，即 QGIS 的 Python 语言。
- en: ^([1](ch02.xhtml#ch01fn6-marker)) The scale of a map is the ratio of a distance
    on the map to the corresponding distance on the ground. For reference, *1:10 m*
    means that 1 unit on your map (screen) is equal to 10,000,000 units. 1 m on the
    map = 10,000,000 m. Read more about [Map Scales](https://oreil.ly/LJFbr) at the
    US Geological Survey Information Center.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](ch02.xhtml#ch01fn6-marker)) 地图比例尺是地图上某一距离与地面对应距离的比率。作为参考，*1:10 m* 表示您地图上的
    1 单位（屏幕上）等于 10,000,000 单位。地图上的 1 米 = 10,000,000 米。更多关于[地图比例尺](https://oreil.ly/LJFbr)的信息请参见美国地质调查信息中心。
- en: '^([2](ch02.xhtml#ch01fn7-marker)) To learn more, see Mitchell, Bruce, and Franco,
    Juan. 2018\. *HOLC ‘Redlining’ Maps: The Persistent Structure of Segregation and
    Economic Inequality.* National Community Reinvestment Coalition. [*https://ncrc.org/holc*](https://ncrc.org/holc).'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '^([2](ch02.xhtml#ch01fn7-marker)) 要了解更多信息，请参阅 Mitchell, Bruce, 和 Franco, Juan.
    2018\. *HOLC ‘Redlining’ Maps: The Persistent Structure of Segregation and Economic
    Inequality.* National Community Reinvestment Coalition. [*https://ncrc.org/holc*](https://ncrc.org/holc).'
