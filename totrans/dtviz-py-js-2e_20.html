<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 14. Bringing Your Charts to the Web with Matplotlib and Plotly" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter_web_presentations">
<h1><span class="label">Chapter 14. </span>Bringing Your Charts to the Web with Matplotlib and Plotly</h1>
<p>In this chapter, we’ll see how to bring the fruits of your pandas data cleaning and exploration to the web. <a data-primary="web presentations" data-type="indexterm" id="ix_webpres"/>Often a good static visualization is a great way to present data, and we’ll start by showing how you can use Matplotlib to do just that. Sometimes user interaction can really enrich a data visualization—we’ll see how Python’s Plotly library can be used to create interactive visualizations in a Jupyter notebook and transfer these, user interactions (UI) and all, to a web page.</p>
<p>We’ll also see how learning Plotly’s Python library gives you competence with a native JavaScript library, which can really extend the possibilities of your web dataviz. We’ll demonstrate this by creating some simple JS UIs to update our native Plotly charts.</p>
<section data-pdf-bookmark="Static Charts with Matplotlib" data-type="sect1"><div class="sect1" id="idm45607756406432">
<h1>Static Charts with Matplotlib</h1>
<p>Often the best chart for the job is a static chart where full editorial control lies with the creator.<a data-primary="Matplotlib" data-secondary="static charts with" data-type="indexterm" id="ix_Matpstcht"/><a data-primary="web presentations" data-secondary="static charts with Matplotlib" data-type="indexterm" id="ix_webpresMpl"/> One of Matplotlib’s strengths is its ability to produce print-quality charts in a comprehensive range of formats, from high-definition web PNGs to SVG renderings, with vector primitives that scale perfectly with document size.</p>
<p>For web graphics the ubiquitous, recommended <a data-primary="PNG (portable network graphics) format" data-type="indexterm" id="idm45607756402064"/>format is the portable network graphics (PNG) format which, as the name suggests, was designed for the job. Let’s select a few charts from our Nobel exploration (see <a data-type="xref" href="ch11.xhtml#chapter_pandas_exploring">Chapter 11</a>) and deliver them to the web as PNGs, making a little presentation on the way.</p>
<p>In <a data-type="xref" href="ch11.xhtml#sect_national_trends">“National Trends”</a>, we saw that measuring national prize hauls by absolute numbers gave a very different picture of a per-capita measurement, taking into account population sizes. We produced a couple of bar charts showing this. Now let’s turn this exploratory find into a presentation. We’ll use vertical bar charts to make the country names easier to read.</p>
<p>We take the Matplotlib axis returned by the pandas plot method and use it to make a few adaptations, changing its face color to light gray (#eee) and adding a label or two:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">ax</code><code> </code><code class="o">=</code><code> </code><code class="n">df_countries</code><code class="p">[</code><code class="n">df_countries</code><code class="o">.</code><code class="n">nobel_wins</code><code> </code><code class="o">&gt;</code><code> </code><code class="mi">2</code><code class="p">]</code><code>\</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>    </code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="n">by</code><code class="o">=</code><code class="s1">'</code><code class="s1">nobel_wins_per_capita</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">ascending</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code><code>\
</code><code>    </code><code class="o">.</code><code class="n">nobel_wins_per_capita</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'</code><code class="s1">barh</code><code class="s1">'</code><code class="p">,</code><code>\</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>        </code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">5</code><code class="p">,</code><code> </code><code class="mi">10</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">title</code><code class="o">=</code><code class="s2">"</code><code class="s2">Relative prize numbers</code><code class="s2">"</code><code class="p">)</code><code>
</code><code class="n">ax</code><code class="o">.</code><code class="n">set_xlabel</code><code class="p">(</code><code class="s2">"</code><code class="s2">Nobel prizes per capita</code><code class="s2">"</code><code class="p">)</code><code>
</code><code class="n">ax</code><code class="o">.</code><code class="n">set_facecolor</code><code class="p">(</code><code class="s2">"</code><code class="s2">#eee</code><code class="s2">"</code><code class="p">)</code><code>
</code><code class="n">plt</code><code class="o">.</code><code class="n">tight_layout</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-3" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code class="n">plt</code><code class="o">.</code><code class="n">savefig</code><code class="p">(</code><code class="s2">"</code><code class="s2">country_relative_prize_numbers.png</code><code class="s2">"</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Threshold for countries with at least three prizes.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We want a horizontal bar chart of kind <code>barh</code>.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-3" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO1-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Using the <code>tight_layout</code> method reduces the chances of chart elements being lost in the saved figure.</p></dd>
</dl>
<p>We perform the same operation for the absolute numbers, producing two horizontal bar chart PNGs.<a data-primary="horizontal bar charts" data-secondary="adapting for web presentation" data-type="indexterm" id="idm45607756310624"/> To present these on the web, we’ll use some of the HTML and CSS taught in <a data-type="xref" href="ch04.xhtml#chapter_webdev101">Chapter 4</a>:</p>
<pre data-code-language="html" data-type="programlisting"><code class="cm">&lt;!-- index.xhtml --&gt;</code><code>
</code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"main"</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="nt">h1</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">'title'</code><code class="p">&gt;</code><code>The Nobel Prize</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">h1</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="nt">h2</code><code class="p">&gt;</code><code>A few exploratory nuggets</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">h2</code><code class="p">&gt;</code><code>

  </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"intro"</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code>Some nuggets of data mined from a dataset of Nobel prize
     winners (2016).</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

  </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"container"</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">"by-country-container"</code><code class="p">&gt;</code><code>

    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"info-box"</code><code class="p">&gt;</code><code>
      </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code>These two charts compare Nobel prize winners by
         country. [...] that Sweden, winner by a relative
          metric, hosts the prize.</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"chart-wrapper"</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">"by-country"</code><code class="p">&gt;</code><code>

      </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"chart"</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="nt">img</code><code> </code><code class="na">src</code><code class="o">=</code><code class="s">"images/country_absolute_prize_numbers.png"</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO2-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
         </code><code class="na">alt</code><code class="o">=</code><code class="s">""</code><code class="p">&gt;</code><code>
      </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

      </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"chart"</code><code class="p">&gt;</code><code>
        </code><code class="p">&lt;</code><code class="nt">img</code><code> </code><code class="na">src</code><code class="o">=</code><code class="s">"images/country_relative_prize_numbers.png"</code><code>
         </code><code class="na">alt</code><code class="o">=</code><code class="s">""</code><code class="p">&gt;</code><code>
      </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO2-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The images are in a subdirectory relative to <em>index.xhtml</em></p></dd>
</dl>
<p>After title, subtitle, and intro, we have a main container, within which there is a chart-wrapper <code>div</code> with two charts and an information box.</p>
<p>We’ll use a little CSS to size, position, and style the content.<a data-primary="CSS" data-secondary="sizing, positioning, and styling static chart for the web" data-type="indexterm" id="idm45607756122944"/> The key CSS is the use of flex-boxes to distribute the charts and info-box in a row and make them of equal width by giving the chart-wrapper a flex weight of two and the info-box a flex weight of one:<a data-primary="flex-boxes" data-type="indexterm" id="idm45607756121872"/></p>
<pre data-code-language="css" data-type="programlisting"><code class="nt">html</code><code class="o">,</code><code>
</code><code class="nt">body</code><code> </code><code class="p">{</code><code>
  </code><code class="k">height</code><code class="o">:</code><code> </code><code class="m">100%</code><code class="p">;</code><code>
  </code><code class="k">font-family</code><code class="o">:</code><code> </code><code class="n">Georgia</code><code class="o">,</code><code> </code><code class="nb">serif</code><code class="p">;</code><code>
  </code><code class="k">background</code><code class="o">:</code><code> </code><code class="m">#fff1e5</code><code class="p">;</code><code>
  </code><code class="k">font-size</code><code class="o">:</code><code> </code><code class="m">1.2em</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="nt">h1</code><code class="nc">.title</code><code> </code><code class="p">{</code><code>
  </code><code class="k">font-size</code><code class="o">:</code><code> </code><code class="m">2.1em</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="nc">.main</code><code> </code><code class="p">{</code><code>
  </code><code class="k">padding</code><code class="o">:</code><code> </code><code class="m">10px</code><code class="p">;</code><code>
  </code><code class="k">padding-bottom</code><code class="o">:</code><code> </code><code class="m">100px</code><code class="p">;</code><code>
  </code><code class="k">min-width</code><code class="o">:</code><code> </code><code class="m">800px</code><code class="p">;</code><code>
  </code><code class="k">max-width</code><code class="o">:</code><code> </code><code class="m">1200px</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="nc">.container</code><code> </code><code class="p">{</code><code>
  </code><code class="k">display</code><code class="o">:</code><code> </code><code class="nb">flex</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="nc">.chart-wrapper</code><code> </code><code class="p">{</code><code>
  </code><code class="k">display</code><code class="o">:</code><code> </code><code class="nb">flex</code><code class="p">;</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO3-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
  </code><code class="k">flex</code><code class="o">:</code><code> </code><code class="m">2</code><code class="p">;</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO3-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO3-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code class="p">}</code><code>

</code><code class="nc">.chart</code><code> </code><code class="p">{</code><code>
  </code><code class="k">flex</code><code class="o">:</code><code> </code><code class="m">1</code><code class="p">;</code><code>
  </code><code class="k">padding</code><code class="o">:</code><code> </code><code class="m">0</code><code> </code><code class="m">1.5em</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="nc">.chart</code><code> </code><code class="nt">img</code><code> </code><code class="p">{</code><code>
  </code><code class="k">max-height</code><code class="o">:</code><code> </code><code class="m">600px</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="nc">.info-box</code><code> </code><code class="p">{</code><code>
  </code><code class="k">font-family</code><code class="o">:</code><code> </code><code class="nb">sans-serif</code><code class="p">;</code><code>
  </code><code class="k">flex</code><code class="o">:</code><code> </code><code class="m">1</code><code class="p">;</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO3-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO3-3"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
  </code><code class="k">font-size</code><code class="o">:</code><code> </code><code class="m">0.7em</code><code class="p">;</code><code>
  </code><code class="k">padding</code><code class="o">:</code><code> </code><code class="m">0</code><code> </code><code class="m">1.5em</code><code class="p">;</code><code>
  </code><code class="k">background</code><code class="o">:</code><code> </code><code class="m">#ffebd9</code><code class="p">;</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO3-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The chart and info-box children of this container are under flex control.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO3-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO3-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Chart-wrapper is twice the width of the info-box.</p></dd>
</dl>
<p><a data-type="xref" href="#webpres_nobel_pngs">Figure 14-1</a> (left) shows the resulting web page.</p>
<figure><div class="figure" id="webpres_nobel_pngs">
<img alt="dpj2 1401" height="910" src="assets/dpj2_1401.png" width="1593"/>
<h6><span class="label">Figure 14-1. </span>A couple of static charts</h6>
</div></figure>
<section data-pdf-bookmark="Adapting to Screen Sizes" data-type="sect2"><div class="sect2" id="idm45607755928624">
<h2>Adapting to Screen Sizes</h2>
<p>One challenge for modern web development and associated dataviz is adapting to the many devices now used to access the web.<a data-primary="Matplotlib" data-secondary="static charts with" data-tertiary="adapting to screen sizes" data-type="indexterm" id="idm45607755927088"/><a data-primary="web presentations" data-secondary="static charts with Matplotlib" data-tertiary="adapting to screen sizes" data-type="indexterm" id="idm45607755925872"/><a data-primary="screen sizes, adapting Matplotlib static charts to" data-type="indexterm" id="idm45607755877952"/> Much of the time the ability of smartphones and tablets to pan and pinch/zoom means the same visualization can be used on all devices. Making visualizations adaptable is not easy and suffers from combinatorial explosion quite quickly. Often a compromise composition is the best way to proceed.</p>
<p>But there are occasions where an easy win is achievable using the CSS <code>media</code> property to adapt style to device screen size, usually using changing screen width to trigger the use of specialized styles.<a data-primary="media property (CSS)" data-type="indexterm" id="idm45607755876448"/><a data-primary="CSS" data-secondary="media property, adapting chart style to screen sizes" data-type="indexterm" id="idm45607755875840"/> We’ll use the Nobel web page we just created to demonstrate this.</p>
<p>The default chart layout in <a data-type="xref" href="#webpres_nobel_pngs">Figure 14-1</a> is fine for most laptop or PC screens, but as the width of the device is reduced, the charts and info-box become a little cluttered and the info-box elongates to contain the text.<a data-primary="flex-boxes" data-secondary="sizing static charts for different screens" data-type="indexterm" id="idm45607755873648"/> By triggering a flex-box change at a set width of 1,000 pixels, we can make the visualization easier to consume on a small screen device.</p>
<p>Here we add a media-screen trigger to apply a different <code>flex-direction</code> value to devices 1,000 or less pixels wide. Rather than displaying info-box and charts in a row, we display them in a column and reverse the order to put the info-box on the bottom. The result is shown in <a data-type="xref" href="#webpres_nobel_pngs">Figure 14-1</a> (right):</p>
<pre data-code-language="css" data-type="programlisting"><code class="c">/* When the browser is 1000 pixels wide or less */</code>
<code class="k">@media</code> <code class="nt">screen</code> <code class="nt">and</code> <code class="p">(</code><code class="k">max-width</code><code class="o">:</code> <code class="m">1000px</code><code class="p">)</code> <code class="p">{</code>
  <code class="nf">#by-country-container</code> <code class="p">{</code>
    <code class="k">flex-direction</code><code class="o">:</code> <code class="n">column</code><code class="o">-</code><code class="n">reverse</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>
<section data-pdf-bookmark="Using Remote Images or Assets" data-type="sect2"><div class="sect2" id="idm45607755851968">
<h2>Using Remote Images or Assets</h2>
<p>You can use remote assets such as Dropbox or Google-hosted images by getting their shared link and using it as the image source.<a data-primary="images" data-secondary="remote, using with Matplotlib static charts" data-type="indexterm" id="idm45607755845360"/><a data-primary="Matplotlib" data-secondary="static charts with" data-tertiary="using remote images or assets" data-type="indexterm" id="idm45607755844448"/><a data-primary="remote images or assets, using with Matplotlib static charts" data-type="indexterm" id="idm45607755843264"/><a data-primary="web presentations" data-secondary="static charts with Matplotlib" data-tertiary="using remote images or assets" data-type="indexterm" id="idm45607755842624"/> For example, the following <code>img</code> tags use Dropbox images for <a data-type="xref" href="#webpres_nobel_pngs">Figure 14-1</a> rather than locally hosted ones:</p>
<pre data-code-language="html" data-type="programlisting">      <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"chart"</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">img</code> <code class="na">src</code><code class="o">=</code><code class="s">"https://www.dropbox.com/s/422ugyhvfc0zg99/</code>
<code class="s">        country_absolute_prize_numbers.png?raw=1"</code> <code class="na">alt</code><code class="o">=</code><code class="s">""</code><code class="p">&gt;</code>
      <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>

      <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"chart"</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">img</code> <code class="na">src</code><code class="o">=</code><code class="s">"https://www.dropbox.com/s/n6rfr9kvuvir7gi/</code>
<code class="s">        country_relative_prize_numbers.png?raw=1"</code> <code class="na">alt</code><code class="o">=</code><code class="s">""</code><code class="p">&gt;</code>
      <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code></pre>
</div></section>
</div></section>
<section data-pdf-bookmark="Charting with Plotly" data-type="sect1"><div class="sect1" id="idm45607756405840">
<h1>Charting with Plotly</h1>
<p>For static charts, presented as PNGs or SVGs, Matplotlib is eminently customizable, though its API could be more intuitive.<a data-primary="Matplotlib" data-secondary="static charts with" data-startref="ix_Matpstcht" data-type="indexterm" id="idm45607755749440"/><a data-primary="web presentations" data-secondary="static charts with Matplotlib" data-startref="ix_webpresMpl" data-type="indexterm" id="idm45607755748192"/><a data-primary="web presentations" data-secondary="charting with Plotly" data-type="indexterm" id="ix_webpresPlt"/><a data-primary="Plotly charting library" data-type="indexterm" id="ix_Pltly"/> But if you want your charts to have any dynamic/interactive elements, for example the ability to change or filter the dataset with buttons or selectors, then you will need a different charting library, and this is where Plotly<sup><a data-type="noteref" href="ch14.xhtml#idm45607755786208" id="idm45607755786208-marker">1</a></sup> comes in.<a data-primary="Plotly charting library" data-secondary="dynamic/interactive elements in charts" data-type="indexterm" id="idm45607755784992"/></p>
<p><a href="https://plotly.com/python">Plotly</a> is a Python- (and other languages) based charting library that, like Matplotlib, can be used during interactive Jupyter notebook sessions. It offers a wide range of chart forms, some of which aren’t found in the Matplotlib stable, and is arguably easier to configure than Matploblib. For this reason alone it’s a useful tool to have, but where Plotly shines is its ability to export these charts, along with any scripted interactive widgets, to the web.</p>
<p>As mentioned, user interactions and dynamic charts are often surplus to requirements, but even in this case Plotly has some nice value-adds like tool-tipped information which, for example, gives specific information about a bar-group on mouse-over.</p>
<section data-pdf-bookmark="Basic Charts" data-type="sect2"><div class="sect2" id="idm45607755782592">
<h2>Basic Charts</h2>
<p>Let’s see how Plotly does things by replicating one of the Matploblib charts from <a data-type="xref" href="ch11.xhtml#sect_hist_trends">“Historical Trends in Prize Distribution”</a>. <a data-primary="Plotly charting library" data-secondary="basic charts" data-type="indexterm" id="idm45607755736928"/><a data-primary="web presentations" data-secondary="charting with Plotly" data-tertiary="basic charts" data-type="indexterm" id="idm45607755736080"/><a data-primary="DataFrames" data-secondary="creating from Nobel Prize winners dataset showing regional totals" data-type="indexterm" id="idm45607755734992"/>First, we’ll create a DataFrame from the Nobel Prize dataset showing cumulative prizes for three geographical regions:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">new_index</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">Index</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="mi">1901</code><code class="p">,</code> <code class="mi">2015</code><code class="p">),</code> <code class="n">name</code><code class="o">=</code><code class="s1">'year'</code><code class="p">)</code>

<code class="n">by_year_nat_sz</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">([</code><code class="s1">'year'</code><code class="p">,</code> <code class="s1">'country'</code><code class="p">])</code>\
    <code class="o">.</code><code class="n">size</code><code class="p">()</code><code class="o">.</code><code class="n">unstack</code><code class="p">()</code><code class="o">.</code><code class="n">reindex</code><code class="p">(</code><code class="n">new_index</code><code class="p">)</code><code class="o">.</code><code class="n">fillna</code><code class="p">(</code><code class="mi">0</code><code class="p">)</code>

<code class="c1"># Our continental country list created by selecting the biggest</code>
<code class="c1"># two or three winners in the three continents compared.</code>
<code class="n">regions</code> <code class="o">=</code> <code class="p">[</code>
<code class="p">{</code><code class="s1">'label'</code><code class="p">:</code><code class="s1">'N. America'</code><code class="p">,</code>
<code class="s1">'countries'</code><code class="p">:[</code><code class="s1">'United States'</code><code class="p">,</code> <code class="s1">'Canada'</code><code class="p">]},</code>
<code class="p">{</code><code class="s1">'label'</code><code class="p">:</code><code class="s1">'Europe'</code><code class="p">,</code>
<code class="s1">'countries'</code><code class="p">:[</code><code class="s1">'United Kingdom'</code><code class="p">,</code> <code class="s1">'Germany'</code><code class="p">,</code> <code class="s1">'France'</code><code class="p">]},</code>
<code class="p">{</code><code class="s1">'label'</code><code class="p">:</code><code class="s1">'Asia'</code><code class="p">,</code>
<code class="s1">'countries'</code><code class="p">:[</code><code class="s1">'Japan'</code><code class="p">,</code> <code class="s1">'Russia'</code><code class="p">,</code> <code class="s1">'India'</code><code class="p">]}</code>
<code class="p">]</code>
<code class="c1"># Creates a new column with a region label for each dict in the</code>
<code class="c1"># regions list, summing its countries members.</code>
<code class="k">for</code> <code class="n">region</code> <code class="ow">in</code> <code class="n">regions</code><code class="p">:</code>
    <code class="n">by_year_nat_sz</code><code class="p">[</code><code class="n">region</code><code class="p">[</code><code class="s1">'label'</code><code class="p">]]</code> <code class="o">=</code>\
    <code class="n">by_year_nat_sz</code><code class="p">[</code><code class="n">region</code><code class="p">[</code><code class="s1">'countries'</code><code class="p">]]</code><code class="o">.</code><code class="n">sum</code><code class="p">(</code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code>
<code class="c1"># Creates a new DataFrame using the cumulative sum of the</code>
<code class="c1"># new region columns.</code>
<code class="n">df_regions</code> <code class="o">=</code> <code class="n">by_year_nat_sz</code><code class="p">[[</code><code class="n">r</code><code class="p">[</code><code class="s1">'label'</code><code class="p">]</code> <code class="k">for</code> <code class="n">r</code> <code class="ow">in</code> <code class="n">regions</code><code class="p">]]</code><code class="o">.</code>\
    <code class="n">cumsum</code><code class="p">()</code></pre>
<p class="pagebreak-before">This gives us a <code>df_regions</code> DataFrame with columnar cumulative sums:</p>
<pre data-type="programlisting">df_regions
country  N. America  Europe  Asia
year
1901            0.0     4.0   0.0
1902            0.0     7.0   0.0
1903            0.0    10.0   0.0
1904            0.0    13.0   1.0
1905            0.0    15.0   1.0
...             ...     ...   ...
2010          327.0   230.0  36.0
2011          333.0   231.0  36.0
...</pre>
</div></section>
<section data-pdf-bookmark="Plotly Express" data-type="sect2"><div class="sect2" id="idm45607755729888">
<h2>Plotly Express</h2>
<p>Plotly provides an <a href="https://oreil.ly/bJRlf"><code>express</code> module</a> that enables fast chart sketches, great for exploratory iteration in a notebook. <a data-primary="Plotly charting library" data-secondary="Plotly Express" data-type="indexterm" id="idm45607755566448"/><a data-primary="web presentations" data-secondary="charting with Plotly" data-tertiary="Plotly Express" data-type="indexterm" id="idm45607755565472"/><a data-primary="DataFrames" data-secondary="use in Plotly Express charts" data-type="indexterm" id="idm45607755564256"/><a data-primary="line chart, creating from DataFrame using Plotly Express" data-type="indexterm" id="idm45607755563344"/>This module has high-level objects for line charts, bar charts, etc. and can take pandas DataFrames as arguments interpreting columnar data.<sup><a data-type="noteref" href="ch14.xhtml#idm45607755562576" id="idm45607755562576-marker">2</a></sup> The regional DataFrame we just created can be used directly by Plotly Express to build a line chart in a couple of lines. This produces the chart in <a data-type="xref" href="#plotly_lines">Figure 14-2</a> (left):</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># load the express module</code>
<code class="kn">import</code> <code class="nn">plotly.express</code> <code class="k">as</code> <code class="nn">px</code>
<code class="c1"># use the line method with a suitable DataFrame</code>
<code class="n">fig</code> <code class="o">=</code> <code class="n">px</code><code class="o">.</code><code class="n">line</code><code class="p">(</code><code class="n">df_regions</code><code class="p">)</code>
<code class="n">fig</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>
<figure><div class="figure" id="plotly_lines">
<img alt="dpj2 1402" height="655" src="assets/dpj2_1402.png" width="1438"/>
<h6><span class="label">Figure 14-2. </span>Cumulative prizes with Plotly</h6>
</div></figure>
<p>Note the row index label that is used for the x-axis by default and the tooltip that appears on mouse-over showing, in this case, information about the line section.</p>
<p>Another thing to note is that the legend label is taken from the grouping index, in this case <code>country</code>. We can easily fix this by relabeling it to something more sensible, in this case <code>Regions</code>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">fig</code><code> </code><code class="o">=</code><code> </code><code class="n">px</code><code class="o">.</code><code class="n">line</code><code class="p">(</code><code class="n">df_regions</code><code class="p">,</code><code> </code><code class="n">labels</code><code class="o">=</code><code class="p">{</code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">Regions</code><code class="s1">'</code><code class="p">}</code><code class="p">)</code><code>
</code><code>      </code><code class="n">line_dash</code><code class="o">=</code><code class="s1">'</code><code class="s1">country</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">line_dash_sequence</code><code class="o">=</code><code class="p">[</code><code class="s1">'</code><code class="s1">solid</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">dash</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">dot</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO4-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code class="p">)</code><code>
</code><code class="n">fig</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO4-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Plotly colors the lines by default, but in order to distinguish them in the print version of this book, we can adjust their styles. To do this, we set the <code>line_dash</code> argument to the country group and the <code>line_dash_sequence</code> to the line styles we want.<sup><a data-type="noteref" href="ch14.xhtml#idm45607755439968" id="idm45607755439968-marker">3</a></sup></p></dd>
</dl>
<p>Plotly Express is easy to use and brings some novel charts into play.<sup><a data-type="noteref" href="ch14.xhtml#idm45607755437280" id="idm45607755437280-marker">4</a></sup> For quick data sketches it competes with pandas’s Matplotlib wrapper, which works directly on DataFrames. But if you want more control over your plots and to really exploit Plotly’s advantages, I recommend focusing on using Plotly figures and graph-objects. This API is more complex but significantly more powerful. It is also mirrored by the JavaScript API, which means you’re essentially learning two libraries—a very useful thing as we’ll see later in the chapter.</p>
</div></section>
<section data-pdf-bookmark="Plotly Graph-Objects" data-type="sect2"><div class="sect2" id="idm45607755435712">
<h2>Plotly Graph-Objects</h2>
<p>Using Plotly graph-objects involves a little more boilerplate code, but the pattern is essentially the same whether creating bar charts, violin plots, maps, etc. <a data-primary="Plotly charting library" data-secondary="graph-objects" data-type="indexterm" id="idm45607755434144"/><a data-primary="web presentations" data-secondary="charting with Plotly" data-tertiary="Plotly graph-objects" data-type="indexterm" id="idm45607755398416"/><a data-primary="graph-objects (Plotly)" data-type="indexterm" id="idm45607755397328"/>The idea is to use an array of graph-objects such as scattered points (lines in line mode), bars, candles, boxes, etc., as data for the figure. A <code>layout</code> object is used to provide other chart features.</p>
<p>The following code produces the chart in <a data-type="xref" href="#plotly_lines">Figure 14-2</a> (right). Note the customized tooltip on mouse-over:</p>
<pre data-code-language="python" data-type="programlisting"><code class="kn">import</code><code> </code><code class="nn">plotly</code><code class="nn">.</code><code class="nn">graph_objs</code><code> </code><code class="k">as</code><code> </code><code class="nn">go</code><code>
</code><code>
</code><code>
</code><code class="n">traces</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code class="k">for</code><code> </code><code class="n">region</code><code> </code><code class="ow">in</code><code> </code><code class="n">regions</code><code class="p">:</code><code>
</code><code>    </code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="n">region</code><code class="p">[</code><code class="s1">'</code><code class="s1">label</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>    </code><code class="n">traces</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code>
</code><code>        </code><code class="n">go</code><code class="o">.</code><code class="n">Scatter</code><code class="p">(</code><code>
</code><code>            </code><code class="n">x</code><code class="o">=</code><code class="n">df_regions</code><code class="o">.</code><code class="n">index</code><code class="p">,</code><code> </code><code class="c1"># years</code><code>
</code><code>            </code><code class="n">y</code><code class="o">=</code><code class="n">df_regions</code><code class="p">[</code><code class="n">name</code><code class="p">]</code><code class="p">,</code><code> </code><code class="c1"># cum. prizes</code><code>
</code><code>            </code><code class="n">name</code><code class="o">=</code><code class="n">name</code><code class="p">,</code><code>
</code><code>            </code><code class="n">mode</code><code class="o">=</code><code class="s2">"</code><code class="s2">lines</code><code class="s2">"</code><code class="p">,</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>            </code><code class="n">hovertemplate</code><code class="o">=</code><code class="sa">f</code><code class="s2">"</code><code class="si">{</code><code class="n">name</code><code class="si">}</code><code class="s2">&lt;br&gt;%</code><code class="se">{{</code><code class="s2">x</code><code class="se">}}</code><code class="s2">&lt;br&gt;$%</code><code class="se">{{</code><code class="s2">y</code><code class="se">}}</code><code class="s2">&lt;extra&gt;&lt;/extra&gt;</code><code class="s2">"</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-3" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code>            </code><code class="n">line</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code class="n">dash</code><code class="o">=</code><code class="p">[</code><code class="s1">'</code><code class="s1">solid</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">dash</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">dot</code><code class="s1">'</code><code class="p">]</code><code class="p">[</code><code class="nb">len</code><code class="p">(</code><code class="n">traces</code><code class="p">)</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-4" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a><code>
</code><code>        </code><code class="p">)</code><code>
</code><code>    </code><code class="p">)</code><code>
</code><code class="n">layout</code><code> </code><code class="o">=</code><code> </code><code class="n">go</code><code class="o">.</code><code class="n">Layout</code><code class="p">(</code><code class="n">height</code><code class="o">=</code><code class="mi">600</code><code class="p">,</code><code> </code><code class="n">width</code><code class="o">=</code><code class="mi">600</code><code class="p">,</code><code>\</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-5" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-5"><img alt="5" height="12" src="assets/5.png" width="12"/></a><code>
</code><code>    </code><code class="n">xaxis_title</code><code class="o">=</code><code class="s2">"</code><code class="s2">year</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="n">yaxis_title</code><code class="o">=</code><code class="s2">"</code><code class="s2">cumulative prizes</code><code class="s2">"</code><code class="p">)</code><code>
</code><code class="n">fig</code><code> </code><code class="o">=</code><code> </code><code class="n">go</code><code class="o">.</code><code class="n">Figure</code><code class="p">(</code><code class="n">traces</code><code class="p">,</code><code> </code><code class="n">layout</code><code class="p">)</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-6" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-6"><img alt="6" height="12" src="assets/6.png" width="12"/></a><code>
</code><code class="n">fig</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>We’ll create an array of line graph-objects to use as our figure’s data.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>In line mode scatter objects points are connected.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-3" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>You can provide an HTML string template that will appear on mouse-hover. <code>x</code> and <code>y</code> variables at that point are provided.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-4" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></dt>
<dd><p>The <code>Scatter</code> object has a <em>line</em> property that allows you to set various line properties like color, line style, line shape, etc.<sup><a data-type="noteref" href="ch14.xhtml#idm45607755224832" id="idm45607755224832-marker">5</a></sup> In order to distinguish our lines in the black-and-white print book, we want to set their style. To do this we use the size (<code>len</code>) of the <code>traces</code> array as an index to an array of styles, setting the line styles in sequence.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-5" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-5"><img alt="5" height="12" src="assets/5.png" width="12"/></a></dt>
<dd><p>As well as data, we provide a <code>layout</code> object, defining things like the chart’s dimension, x-axis titles, and much more.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-6" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO5-6"><img alt="6" height="12" src="assets/6.png" width="12"/></a></dt>
<dd><p>Create a figure using our array of graph-objects and the layout.</p></dd>
</dl>
</div></section>
<section data-pdf-bookmark="Mapping with Plotly" data-type="sect2"><div class="sect2" id="idm45607755211072">
<h2>Mapping with Plotly</h2>
<p>Another of Plotly’s big strengths is its mapping libraries and particularly its ability to integrate the <a href="https://oreil.ly/965Zv">Mapbox ecosystem</a>, one of the most powerful tile-based mapping resources for the web.
Mapbox’s tiling system is fast and efficient and opens up the possibility of ambitious mapping visualizations.<a data-primary="Mapbox" data-type="indexterm" id="idm45607755147024"/><a data-primary="web presentations" data-secondary="charting with Plotly" data-tertiary="mapping with Plotly" data-type="indexterm" id="ix_webpresPltmap"/><a data-primary="Plotly charting library" data-secondary="mapping with" data-type="indexterm" id="ix_Pltlymap"/><a data-primary="mapping with Plotly" data-type="indexterm" id="ix_mapPlt"/></p>
<p>Let’s demonstrate some Plotly mapping using our Nobel Prize dataset and aiming to visualize the global distribution of prizes.</p>
<p>First, we’ll make a DataFrame with the prizes tallies by category for the winning countries and add a <code>Total</code> column by aggregating the category numbers:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df_country_category</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">groupby</code><code class="p">([</code><code class="s1">'country'</code><code class="p">,</code> <code class="s1">'category'</code><code class="p">])</code>\
    <code class="o">.</code><code class="n">size</code><code class="p">()</code><code class="o">.</code><code class="n">unstack</code><code class="p">()</code>
<code class="n">df_country_category</code><code class="p">[</code><code class="s1">'Total'</code><code class="p">]</code> <code class="o">=</code> <code class="n">df_country_category</code><code class="o">.</code><code class="n">sum</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>
<code class="n">df_country_category</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code> <code class="c1"># top three rows</code>
<code class="c1">#category   Chemistry  Economics  Literature  Peace  Physics  \</code>
<code class="c1">#country</code>
<code class="c1">#Argentina        1.0        NaN         NaN    2.0      NaN</code>
<code class="c1">#Australia        NaN        1.0         1.0    NaN      1.0</code>
<code class="c1">#Austria          3.0        1.0         1.0    2.0      4.0</code>
<code class="c1">#</code>
<code class="c1">#category   Physiology or Medicine  Total</code>
<code class="c1">#country</code>
<code class="c1">#Argentina                     2.0    5.0</code>
<code class="c1">#Australia                     6.0    9.0</code>
<code class="c1">#Austria                       4.0   15.0</code></pre>
<p>We’ll use that <code>Total</code> column to threshold the rows, limiting the countries to those that have won the Nobel at least three times. We’ll make a copy of this slice to avoid any pandas DataFrame errors if trying to change a view:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df_country_category</code> <code class="o">=</code> <code class="n">df_country_category</code><code class="o">.</code>\
    <code class="n">loc</code><code class="p">[</code><code class="n">df_country_category</code><code class="o">.</code><code class="n">Total</code> <code class="o">&gt;</code> <code class="mi">2</code><code class="p">]</code><code class="o">.</code><code class="n">copy</code><code class="p">()</code>
<code class="n">df_country_category</code></pre>
<p>With the prize tallies by country to hand we need some geographical data, namely the coordinates of the centroids (centers) of the countries.<a data-primary="Geopy library" data-type="indexterm" id="idm45607755093088"/> This is an opportunity to demo <a href="https://github.com/geopy/geopy">Geopy</a>, a cool little Python library that does just that job, among many geographical others.</p>
<p>First, install with <code>pip</code> or equivalent:</p>
<pre data-type="programlisting">!pip install geopy</pre>
<p>Now we can use the <code>Nominatim</code> module to provide locations based on our country name strings. <a data-primary="Nominatim" data-type="indexterm" id="idm45607755036160"/>We create a geolocator by providing a user-agent string:</p>
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">geopy.geocoders</code> <code class="kn">import</code> <code class="n">Nominatim</code>

<code class="n">geolocator</code> <code class="o">=</code> <code class="n">Nominatim</code><code class="p">(</code><code class="n">user_agent</code><code class="o">=</code><code class="s2">"nobel_prize_app"</code><code class="p">)</code></pre>
<p>Using the geolocator, we can loop through a few countries in the DataFrame index to show the geo date available:</p>
<pre data-code-language="python" data-type="programlisting"><code class="k">for</code> <code class="n">name</code> <code class="ow">in</code> <code class="n">df_country_category</code><code class="o">.</code><code class="n">index</code><code class="p">[:</code><code class="mi">5</code><code class="p">]:</code>
    <code class="n">location</code> <code class="o">=</code> <code class="n">geolocator</code><code class="o">.</code><code class="n">geocode</code><code class="p">(</code><code class="n">name</code><code class="p">)</code>
    <code class="nb">print</code><code class="p">(</code><code class="s2">"Name: "</code><code class="p">,</code> <code class="n">name</code><code class="p">)</code>
    <code class="nb">print</code><code class="p">(</code><code class="s2">"Coords: "</code><code class="p">,</code> <code class="p">(</code><code class="n">location</code><code class="o">.</code><code class="n">latitude</code><code class="p">,</code> <code class="n">location</code><code class="o">.</code><code class="n">longitude</code><code class="p">))</code>
    <code class="nb">print</code><code class="p">(</code><code class="s2">"Raw details: "</code><code class="p">,</code> <code class="n">location</code><code class="o">.</code><code class="n">raw</code><code class="p">)</code>
<code class="c1">#Name:  Argentina</code>
<code class="c1">#Coords:  (-34.9964963, -64.9672817)</code>
<code class="c1">#Raw details:  {'place_id': 284427148, 'licence': 'Data ©</code>
<code class="c1">#OpenStreetMap contributors, ODbL 1.0. https://osm.org/</code>
<code class="c1">#copyright', 'osm_type': 'relation', 'osm_id': 286393,</code>
<code class="c1">#'boundingbox': ['-55.1850761', '-21.7808568', '-73.5605371',</code>
<code class="c1">#[...] }</code></pre>
<p>Let’s add geographic latitude (<code>Lat</code>) and longitude (<code>Lon</code>) columns to our DataFrame using our geolocator:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">lats</code> <code class="o">=</code> <code class="p">{}</code>
<code class="n">lons</code> <code class="o">=</code> <code class="p">{}</code>
<code class="k">for</code> <code class="n">name</code> <code class="ow">in</code> <code class="n">df_country_category</code><code class="o">.</code><code class="n">index</code><code class="p">:</code>
    <code class="n">location</code> <code class="o">=</code> <code class="n">geolocator</code><code class="o">.</code><code class="n">geocode</code><code class="p">(</code><code class="n">name</code><code class="p">)</code>
    <code class="k">if</code> <code class="n">location</code><code class="p">:</code>
        <code class="n">lats</code><code class="p">[</code><code class="n">name</code><code class="p">]</code> <code class="o">=</code> <code class="n">location</code><code class="o">.</code><code class="n">latitude</code>
        <code class="n">lons</code><code class="p">[</code><code class="n">name</code><code class="p">]</code> <code class="o">=</code> <code class="n">location</code><code class="o">.</code><code class="n">longitude</code>
    <code class="k">else</code><code class="p">:</code>
        <code class="nb">print</code><code class="p">(</code><code class="s2">"No coords for </code><code class="si">%s</code><code class="s2">"</code><code class="o">%</code><code class="n">name</code><code class="p">)</code>

<code class="n">df_country_category</code><code class="o">.</code><code class="n">loc</code><code class="p">[:,</code><code class="s1">'Lat'</code><code class="p">]</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">Series</code><code class="p">(</code><code class="n">lats</code><code class="p">)</code>
<code class="n">df_country_category</code><code class="o">.</code><code class="n">loc</code><code class="p">[:,</code><code class="s1">'Lon'</code><code class="p">]</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">Series</code><code class="p">(</code><code class="n">lons</code><code class="p">)</code>
<code class="n">df_country_category</code>
<code class="c1">#category   Chemistry  Economics  Literature  Peace  Physics  \</code>
<code class="c1">#country</code>
<code class="c1">#Argentina        1.0        NaN         NaN    2.0      NaN</code>
<code class="c1">#Australia        NaN        1.0         1.0    NaN      1.0</code>
<code class="c1">#</code>
<code class="c1">#category   Physiology or Medicine  Total        Lat         Lon</code>
<code class="c1">#country</code>
<code class="c1">#Argentina                     2.0    5.0 -34.996496  -64.967282</code>
<code class="c1">#Australia                     6.0    9.0 -24.776109  134.755000</code></pre>
<p>We’re going to use some map markers to reflect the prize numbers for various countries. We want the size of the circle to reflect the prize sum, so we will need a little function to get the appropriate radius. We’ll have a <code>scale</code> parameter to allow hand-tweaking of the marker size:</p>
<pre data-code-language="python" data-type="programlisting"><code class="k">def</code> <code class="nf">calc_marker_radius</code><code class="p">(</code><code class="n">size</code><code class="p">,</code> <code class="n">scale</code><code class="o">=</code><code class="mi">5</code><code class="p">):</code>
    <code class="k">return</code> <code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">size</code><code class="o">/</code><code class="n">np</code><code class="o">.</code><code class="n">pi</code><code class="p">)</code> <code class="o">*</code> <code class="n">scale</code></pre>
<p>As with the basic charts, there is a Plotly Express mapping option, which allows for fast map creation using a pandas DataFrame. Express has a dedicated <code>scatter_mapbox</code> method that returns a figure object. Here we use this figure to make some updates to the map layout, using one of the free map styles (carto-positron) provided by Plotly (see <a data-type="xref" href="#img_map_plotly_express">Figure 14-3</a>):</p>
<pre data-code-language="python" data-type="programlisting"><code class="kn">import</code><code> </code><code class="nn">plotly</code><code class="nn">.</code><code class="nn">express</code><code> </code><code class="k">as</code><code> </code><code class="nn">px</code><code>
</code><code class="n">init_notebook_mode</code><code class="p">(</code><code class="n">connected</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code><code>
</code><code>
</code><code class="n">size</code><code> </code><code class="o">=</code><code> </code><code class="n">df_country_category</code><code class="p">[</code><code class="s1">'</code><code class="s1">Total</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">apply</code><code class="p">(</code><code class="n">calc_marker_radius</code><code class="p">,</code><code> </code><code class="n">args</code><code class="o">=</code><code class="p">(</code><code class="mi">16</code><code class="p">,</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code class="n">fig</code><code> </code><code class="o">=</code><code> </code><code class="n">px</code><code class="o">.</code><code class="n">scatter_mapbox</code><code class="p">(</code><code class="n">df_country_category</code><code class="p">,</code><code> </code><code class="n">lat</code><code class="o">=</code><code class="s2">"</code><code class="s2">Lat</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="n">lon</code><code class="o">=</code><code class="s2">"</code><code class="s2">Lon</code><code class="s2">"</code><code class="p">,</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>                        </code><code class="n">hover_name</code><code class="o">=</code><code class="n">df_country_category</code><code class="o">.</code><code class="n">index</code><code class="p">,</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-3" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code>                        </code><code class="n">hover_data</code><code class="o">=</code><code class="p">[</code><code class="s1">'</code><code class="s1">Total</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                        </code><code class="n">color_discrete_sequence</code><code class="o">=</code><code class="p">[</code><code class="s2">"</code><code class="s2">olive</code><code class="s2">"</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                        </code><code class="n">zoom</code><code class="o">=</code><code class="mf">0.7</code><code class="p">,</code><code> </code><code class="n">size</code><code class="o">=</code><code class="n">size</code><code class="p">)</code><code>
</code><code class="n">fig</code><code class="o">.</code><code class="n">update_layout</code><code class="p">(</code><code class="n">mapbox_style</code><code class="o">=</code><code class="s2">"</code><code class="s2">carto-positron</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="n">width</code><code class="o">=</code><code class="mi">800</code><code class="p">,</code><code> </code><code class="n">height</code><code class="o">=</code><code class="mi">450</code><code class="p">)</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-4" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a><code>
</code><code class="n">fig</code><code class="o">.</code><code class="n">update_layout</code><code class="p">(</code><code class="n">margin</code><code class="o">=</code><code class="p">{</code><code class="s2">"</code><code class="s2">r</code><code class="s2">"</code><code class="p">:</code><code class="mi">0</code><code class="p">,</code><code class="s2">"</code><code class="s2">t</code><code class="s2">"</code><code class="p">:</code><code class="mi">0</code><code class="p">,</code><code class="s2">"</code><code class="s2">l</code><code class="s2">"</code><code class="p">:</code><code class="mi">0</code><code class="p">,</code><code class="s2">"</code><code class="s2">b</code><code class="s2">"</code><code class="p">:</code><code class="mi">0</code><code class="p">}</code><code class="p">)</code><code>
</code><code class="n">fig</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Create an array of sizes for the radii of the circular markers.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>The mapbox takes an array of latitudes and longitudes for marker placement, as well as our calculated <code>size</code> array. Zoom indicates the position of the camera above the Earth with 0.7 as a standard global default.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-3" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p><code>hover_name</code> gives the title of the mouse-over tooltip and data any extra info we want, in this case the <code>Total</code> column.<a data-primary="mapping style tile-sets (Plotly)" data-type="indexterm" id="idm45607754575600"/></p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-4" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO6-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></dt>
<dd><p>Plotly provides a number of free-to-use <a href="https://oreil.ly/NbTg1">mapping style tile-sets</a>.</p></dd>
</dl>
<figure><div class="figure" id="img_map_plotly_express">
<img alt="dpj2 1403" height="600" src="assets/dpj2_1403.png" width="1067"/>
<h6><span class="label">Figure 14-3. </span>Fast mapping with Plotly Express</h6>
</div></figure>
<p>As with basic <a data-primary="graph-objects (Plotly)" data-secondary="mapping with" data-type="indexterm" id="idm45607754506672"/>charts Plotly also offers a more powerful data+layout mapping option that follows the familiar recipe, creating an array of charts <em>traces</em> and a layout to specify things like legend boxes, titles, map zoom, etc. Here’s how to make our Nobel map:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">mapbox_access_token</code><code> </code><code class="o">=</code><code> </code><code class="s2">"</code><code class="s2">pk.eyJ1Ij...JwFsbg</code><code class="s2">"</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO7-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO7-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>
</code><code class="n">df_cc</code><code> </code><code class="o">=</code><code> </code><code class="n">df_country_category</code><code>
</code><code>
</code><code class="n">site_lat</code><code> </code><code class="o">=</code><code> </code><code class="n">df_cc</code><code class="o">.</code><code class="n">Lat</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO7-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO7-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code class="n">site_lon</code><code> </code><code class="o">=</code><code> </code><code class="n">df_cc</code><code class="o">.</code><code class="n">Lon</code><code>
</code><code class="n">totals</code><code> </code><code class="o">=</code><code> </code><code class="n">df_cc</code><code class="o">.</code><code class="n">Total</code><code>
</code><code class="n">locations_name</code><code> </code><code class="o">=</code><code> </code><code class="n">df_cc</code><code class="o">.</code><code class="n">index</code><code>
</code><code>
</code><code class="n">layout</code><code> </code><code class="o">=</code><code> </code><code class="n">go</code><code class="o">.</code><code class="n">Layout</code><code class="p">(</code><code>
</code><code>    </code><code class="n">title</code><code class="o">=</code><code class="s1">'</code><code class="s1">Nobel prize totals by country</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>    </code><code class="n">hovermode</code><code class="o">=</code><code class="s1">'</code><code class="s1">closest</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>    </code><code class="n">showlegend</code><code class="o">=</code><code class="kc">False</code><code class="p">,</code><code>
</code><code>    </code><code class="n">margin</code><code> </code><code class="o">=</code><code class="p">{</code><code class="s1">'</code><code class="s1">l</code><code class="s1">'</code><code class="p">:</code><code class="mi">0</code><code class="p">,</code><code class="s1">'</code><code class="s1">t</code><code class="s1">'</code><code class="p">:</code><code class="mi">0</code><code class="p">,</code><code class="s1">'</code><code class="s1">b</code><code class="s1">'</code><code class="p">:</code><code class="mi">0</code><code class="p">,</code><code class="s1">'</code><code class="s1">r</code><code class="s1">'</code><code class="p">:</code><code class="mi">0</code><code class="p">}</code><code class="p">,</code><code>
</code><code>    </code><code class="n">mapbox</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code>
</code><code>        </code><code class="n">accesstoken</code><code class="o">=</code><code class="n">mapbox_access_token</code><code class="p">,</code><code>
</code><code>        </code><code class="c1"># we can set map details here including center, pitch and bearing..</code><code>
</code><code>        </code><code class="c1"># try playing  with these.</code><code>
</code><code class="c1">#         bearing=0,</code><code>
</code><code class="c1"># #         center=dict(</code><code>
</code><code class="c1"># #             lat=38,</code><code>
</code><code class="c1"># #             lon=-94</code><code>
</code><code class="c1"># #         ),</code><code>
</code><code class="c1">#         pitch=0,</code><code>
</code><code>        </code><code class="n">zoom</code><code class="o">=</code><code class="mf">0.7</code><code class="p">,</code><code>
</code><code>        </code><code class="n">style</code><code class="o">=</code><code class="s1">'</code><code class="s1">light</code><code class="s1">'</code><code>
</code><code>    </code><code class="p">)</code><code class="p">,</code><code>
</code><code>    </code><code class="n">width</code><code class="o">=</code><code class="mi">875</code><code class="p">,</code><code> </code><code class="n">height</code><code class="o">=</code><code class="mi">450</code><code>
</code><code class="p">)</code><code>
</code><code>
</code><code class="n">traces</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code>
</code><code>            </code><code class="n">go</code><code class="o">.</code><code class="n">Scattermapbox</code><code class="p">(</code><code>
</code><code>            </code><code class="n">lat</code><code class="o">=</code><code class="n">site_lat</code><code class="p">,</code><code>
</code><code>            </code><code class="n">lon</code><code class="o">=</code><code class="n">site_lon</code><code class="p">,</code><code>
</code><code>            </code><code class="n">mode</code><code class="o">=</code><code class="s1">'</code><code class="s1">markers</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>            </code><code class="n">marker</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code>
</code><code>                </code><code class="n">size</code><code class="o">=</code><code class="n">totals</code><code class="o">.</code><code class="n">apply</code><code class="p">(</code><code class="n">calc_marker_radius</code><code class="p">,</code><code> </code><code class="n">args</code><code class="o">=</code><code class="p">(</code><code class="mi">7</code><code class="p">,</code><code class="p">)</code><code class="p">)</code><code class="p">,</code><code>
</code><code>                </code><code class="n">color</code><code class="o">=</code><code class="s1">'</code><code class="s1">olive</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                </code><code class="n">opacity</code><code class="o">=</code><code class="mf">0.8</code><code>
</code><code>            </code><code class="p">)</code><code class="p">,</code><code>
</code><code>            </code><code class="n">text</code><code class="o">=</code><code class="p">[</code><code class="sa">f</code><code class="s1">'</code><code class="si">{</code><code class="n">locations_name</code><code class="p">[</code><code class="n">i</code><code class="p">]</code><code class="si">}</code><code class="s1"> won </code><code class="si">{</code><code class="nb">int</code><code class="p">(</code><code class="n">x</code><code class="p">)</code><code class="si">}</code><code class="s1"> total prizes</code><code class="s1">'</code><code>\
</code><code>                </code><code class="k">for</code><code> </code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">x</code><code> </code><code class="ow">in</code><code> </code><code class="nb">enumerate</code><code class="p">(</code><code class="n">totals</code><code class="p">)</code><code class="p">]</code><code class="p">,</code><code>
</code><code>            </code><code class="n">hoverinfo</code><code class="o">=</code><code class="s1">'</code><code class="s1">text</code><code class="s1">'</code><code>
</code><code>             </code><code class="p">)</code><code>
</code><code class="p">]</code><code>
</code><code>
</code><code class="n">fig</code><code> </code><code class="o">=</code><code> </code><code class="n">go</code><code class="o">.</code><code class="n">Figure</code><code class="p">(</code><code class="n">traces</code><code class="p">,</code><code> </code><code class="n">layout</code><code class="o">=</code><code class="n">layout</code><code class="p">)</code><code>
</code><code class="n">fig</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO7-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO7-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Plotly offers a number of free, open-streetmap-based mapsets, but to use Mapbox-specific layers, you need to get a <a href="https://oreil.ly/7zzug">Mapbox access token</a>. These tokens are free to use for personal use.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO7-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO7-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We’ll store the DataFrame’s columns and index in a more user-friendly form.</p></dd>
</dl>
<p class="pagebreak-before">The map produced is shown in <a data-type="xref" href="#img_map_plotly">Figure 14-4</a> (left). Note the customized tooltip, produced on mouse-over. <a data-type="xref" href="#img_map_plotly">Figure 14-4</a> (right) shows the result of some user interaction, panning and zooming to highlight European prize distributions.</p>
<figure><div class="figure" id="img_map_plotly">
<img alt="dpj2 1404" height="611" src="assets/dpj2_1404.png" width="1701"/>
<h6><span class="label">Figure 14-4. </span>Mapping with Plotly’s graph-objects</h6>
</div></figure>
<p>Let’s extend the map to add some custom controls, using buttons to select prize categories to visualize.<a data-primary="mapping with Plotly" data-startref="ix_mapPlt" data-type="indexterm" id="idm45607754484128"/><a data-primary="web presentations" data-secondary="charting with Plotly" data-startref="ix_webpresPltmap" data-tertiary="mapping with Plotly" data-type="indexterm" id="idm45607754483152"/><a data-primary="Plotly charting library" data-secondary="mapping with" data-startref="ix_Pltlymap" data-type="indexterm" id="idm45607754481664"/></p>
</div></section>
<section data-pdf-bookmark="Adding Custom Controls with Plotly" data-type="sect2"><div class="sect2" id="sect_plotly_ui">
<h2>Adding Custom Controls with Plotly</h2>
<p>One of the cool features of Plotly’s interactive maps is the ability to add <a href="https://oreil.ly/xo62V">custom controls</a> in Python that can be ported to the web as HTML+JS controls. <a data-primary="mapping with Plotly" data-secondary="adding custom controls to the map" data-type="indexterm" id="ix_mapPltctrl"/><a data-primary="controls, custom, adding to Plotly map" data-type="indexterm" id="ix_ctrlcus"/><a data-primary="web presentations" data-secondary="charting with Plotly" data-tertiary="adding custom controls" data-type="indexterm" id="ix_webpresPltctrl"/><a data-primary="Plotly charting library" data-secondary="adding custom controls with" data-type="indexterm" id="ix_Pltlycusctrl"/>The control API is a little clunky, in my opinion, and limited to a small set of controls, but the ability to add dataset selectors, sliders, filters, and the like is a great asset. Here we’ll add a few buttons to our Nobel map, allowing the user to filter the dataset by category.</p>
<p>Before proceeding we need to replace the non-numbers from the prizes by country and category DataFrame with zero to avoid Plotly labeling errors.  You can see these in the first two rows:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df_country_category</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code>
<code class="c1"># Out:</code>
<code class="c1">#  category   Chemistry  Economics  Literature  Peace  Physics  \</code>
<code class="c1"># country</code>
<code class="c1"># Argentina        1.0        NaN         NaN    2.0      NaN</code>
<code class="c1"># Australia        NaN        1.0         1.0    NaN      1.0</code></pre>
<p>A single line of pandas fills these <code>NaN</code>s with zero, making the change in place:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df_country_category</code><code class="o">.</code><code class="n">fillna</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="n">inplace</code><code class="o">=</code><code class="kc">True</code><code class="p">)</code></pre>
<p>This will involve a slightly different Plotly pattern than the one used up to now. We’ll first create our figure with <code>layout</code> and then add the data traces using <code>add_trace</code> by iterating through the Nobel categories, adding buttons to the <code>button</code> array as we go.</p>
<p>We’ll then add these buttons to the layout using its <code>update</code> method:</p>
<pre data-code-language="python" data-type="programlisting"><code class="c1"># ...</code><code>
</code><code class="n">categories</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">Total</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Chemistry</code><code class="s1">'</code><code class="p">,</code><code>   </code><code class="s1">'</code><code class="s1">Economics</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Literature</code><code class="s1">'</code><code class="p">,</code><code>\
</code><code>    </code><code class="s1">'</code><code class="s1">Peace</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">Physics</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">Physiology or Medicine</code><code class="s1">'</code><code class="p">,</code><code class="p">]</code><code>
</code><code class="c1"># ...</code><code>
</code><code class="n">colors</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">#1b9e77</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">#d95f02</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">#7570b3</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">#e7298a</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">#66a61e</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">#e6ab02</code><code class="s1">'</code><code class="p">,</code><code class="s1">'</code><code class="s1">#a6761d</code><code class="s1">'</code><code class="p">]</code><code>
</code><code class="n">buttons</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>
</code><code class="c1"># ... DEFINE LAYOUT AS BEFORE</code><code>
</code><code class="n">fig</code><code> </code><code class="o">=</code><code> </code><code class="n">go</code><code class="o">.</code><code class="n">Figure</code><code class="p">(</code><code class="n">layout</code><code class="o">=</code><code class="n">layout</code><code class="p">)</code><code>
</code><code class="n">default_category</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">Total</code><code class="s1">'</code><code>
</code><code>
</code><code class="k">for</code><code> </code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">category</code><code> </code><code class="ow">in</code><code> </code><code class="nb">enumerate</code><code class="p">(</code><code class="n">categories</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code class="n">visible</code><code> </code><code class="o">=</code><code> </code><code class="kc">False</code><code>
</code><code>    </code><code class="k">if</code><code> </code><code class="n">category</code><code> </code><code class="o">==</code><code> </code><code class="n">default_category</code><code class="p">:</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
</code><code>        </code><code class="n">visible</code><code> </code><code class="o">=</code><code> </code><code class="kc">True</code><code>
</code><code>    </code><code class="n">fig</code><code class="o">.</code><code class="n">add_trace</code><code class="p">(</code><code>
</code><code>        </code><code class="n">go</code><code class="o">.</code><code class="n">Scattermapbox</code><code class="p">(</code><code>
</code><code>            </code><code class="n">lat</code><code class="o">=</code><code class="n">site_lat</code><code class="p">,</code><code>
</code><code>            </code><code class="n">lon</code><code class="o">=</code><code class="n">site_lon</code><code class="p">,</code><code>
</code><code>            </code><code class="n">mode</code><code class="o">=</code><code class="s1">'</code><code class="s1">markers</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>            </code><code class="n">marker</code><code class="o">=</code><code class="nb">dict</code><code class="p">(</code><code>
</code><code>                </code><code class="n">size</code><code class="o">=</code><code class="n">df_cc</code><code class="p">[</code><code class="n">category</code><code class="p">]</code><code class="o">.</code><code class="n">apply</code><code class="p">(</code><code class="n">calc_marker_radius</code><code class="p">,</code><code> </code><code class="n">args</code><code class="o">=</code><code class="p">(</code><code class="mi">7</code><code class="p">,</code><code class="p">)</code><code class="p">)</code><code class="p">,</code><code>
</code><code>                </code><code class="n">color</code><code class="o">=</code><code class="n">colors</code><code class="p">[</code><code class="n">i</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                </code><code class="n">opacity</code><code class="o">=</code><code class="mf">0.8</code><code>
</code><code>            </code><code class="p">)</code><code class="p">,</code><code>
</code><code>            </code><code class="n">text</code><code class="o">=</code><code class="p">[</code><code class="sa">f</code><code class="s1">'</code><code class="si">{</code><code class="n">locations_name</code><code class="p">[</code><code class="n">i</code><code class="p">]</code><code class="si">}</code><code class="s1"> prizes for </code><code class="si">{</code><code class="n">category</code><code class="si">}</code><code class="s1">: </code><code class="si">{</code><code class="nb">int</code><code class="p">(</code><code class="n">x</code><code class="p">)</code><code class="si">}</code><code class="s1">'</code><code>\
</code><code>                  </code><code class="k">for</code><code> </code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">x</code><code> </code><code class="ow">in</code><code> </code><code class="nb">enumerate</code><code class="p">(</code><code class="n">df_cc</code><code class="p">[</code><code class="n">category</code><code class="p">]</code><code class="p">)</code><code class="p">]</code><code class="p">,</code><code>
</code><code>            </code><code class="n">hoverinfo</code><code class="o">=</code><code class="s1">'</code><code class="s1">text</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>            </code><code class="n">visible</code><code class="o">=</code><code class="n">visible</code><code>
</code><code>             </code><code class="p">)</code><code class="p">,</code><code>
</code><code>    </code><code class="p">)</code><code>
</code><code>    </code><code class="c1"># We start with a mask array of Boolean False, one for each category (inc. Total)</code><code>
</code><code>    </code><code class="c1"># In Python [True] * 3 == [True, True, True]</code><code>
</code><code>    </code><code class="n">mask</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="kc">False</code><code class="p">]</code><code> </code><code class="o">*</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">categories</code><code class="p">)</code><code>
</code><code>    </code><code class="c1"># We now set the mask index corresponding to the current category to True</code><code>
</code><code>    </code><code class="c1"># i.e. button 'Chemistry' has mask [False, True, False, False, False, False]</code><code>
</code><code>    </code><code class="n">mask</code><code class="p">[</code><code class="n">categories</code><code class="o">.</code><code class="n">index</code><code class="p">(</code><code class="n">category</code><code class="p">)</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="kc">True</code><code>
</code><code>    </code><code class="c1"># Now we can use that Boolean mask to add a button to our button list</code><code>
</code><code>    </code><code class="n">buttons</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code>
</code><code>            </code><code class="nb">dict</code><code class="p">(</code><code>
</code><code>                </code><code class="n">label</code><code class="o">=</code><code class="n">category</code><code class="p">,</code><code>
</code><code>                </code><code class="n">method</code><code class="o">=</code><code class="s2">"</code><code class="s2">update</code><code class="s2">"</code><code class="p">,</code><code>
</code><code>                </code><code class="n">args</code><code class="o">=</code><code class="p">[</code><code class="p">{</code><code class="s2">"</code><code class="s2">visible</code><code class="s2">"</code><code class="p">:</code><code> </code><code class="n">mask</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
</code><code>            </code><code class="p">)</code><code class="p">,</code><code>
</code><code>    </code><code class="p">)</code><code>
</code><code>
</code><code>
</code><code class="n">fig</code><code class="o">.</code><code class="n">layout</code><code class="o">.</code><code class="n">update</code><code class="p">(</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-3" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code>    </code><code class="n">updatemenus</code><code class="o">=</code><code class="p">[</code><code>
</code><code>        </code><code class="nb">dict</code><code class="p">(</code><code>
</code><code>            </code><code class="nb">type</code><code class="o">=</code><code class="s2">"</code><code class="s2">buttons</code><code class="s2">"</code><code class="p">,</code><code>
</code><code>            </code><code class="n">direction</code><code class="o">=</code><code class="s2">"</code><code class="s2">down</code><code class="s2">"</code><code class="p">,</code><code>
</code><code>            </code><code class="n">active</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code><code>
</code><code>            </code><code class="n">x</code><code class="o">=</code><code class="mf">0.0</code><code class="p">,</code><code>
</code><code>            </code><code class="n">xanchor</code><code class="o">=</code><code class="s1">'</code><code class="s1">left</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>            </code><code class="n">y</code><code class="o">=</code><code class="mf">0.65</code><code class="p">,</code><code>
</code><code>            </code><code class="n">showactive</code><code class="o">=</code><code class="kc">True</code><code class="p">,</code><code> </code><code class="c1"># show the last button clicked</code><code>
</code><code>            </code><code class="n">buttons</code><code class="o">=</code><code class="n">buttons</code><code>
</code><code>        </code><code class="p">)</code><code>
</code><code>    </code><code class="p">]</code><code>
</code><code class="p">)</code><code>
</code><code>
</code><code class="n">fig</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The category marker sets are initially invisible—only the default <code>Total</code> is shown.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We use the mask to set a visibility array for this button that will only make the associated category data markers visible.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-3" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO8-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>We now add the buttons to our layout, adjusting direction (down) and positioning using <code>x</code> and <code>y</code> to place the center of the button group vertically, with the button-box anchored on the left.</p></dd>
</dl>
<p>Clicking on a button (see <a data-type="xref" href="#img_map_plotly_buttons">Figure 14-5</a>) shows the data markers associated with that category by applying the button’s visibility mask. While this feels a little awkward, it is a solid way to filter the data by button-press. Unlike the JavaScript+HTML controls we’ll look at later in the chapter, there’s not a lot you can do in the way of styling to the buttons.<a data-primary="mapping with Plotly" data-secondary="adding custom controls to the map" data-startref="ix_mapPltctrl" data-type="indexterm" id="idm45607753653104"/><a data-primary="controls, custom, adding to Plotly map" data-startref="ix_ctrlcus" data-type="indexterm" id="idm45607753651920"/><a data-primary="web presentations" data-secondary="charting with Plotly" data-startref="ix_webpresPltctrl" data-tertiary="adding custom controls" data-type="indexterm" id="idm45607753651008"/><a data-primary="Plotly charting library" data-secondary="adding custom controls with" data-startref="ix_Pltlycusctrl" data-type="indexterm" id="idm45607753667424"/><a data-primary="Plotly charting library" data-startref="ix_Pltly" data-type="indexterm" id="idm45607753666240"/><a data-primary="web presentations" data-secondary="charting with Plotly" data-startref="ix_webpresPlt" data-type="indexterm" id="idm45607753665296"/></p>
<figure><div class="figure" id="img_map_plotly_buttons">
<img alt="dpj2 1405" height="600" src="assets/dpj2_1405.png" width="1167"/>
<h6><span class="label">Figure 14-5. </span>Adding custom controls to a Plotly map</h6>
</div></figure>
</div></section>
</div></section>
<section class="pagebreak-before less_space" data-pdf-bookmark="From Notebook to Web with Plotly" data-type="sect1"><div class="sect1" id="idm45607754174752">
<h1>From Notebook to Web with Plotly</h1>
<p>Now we’ve got our Plotly charts displaying in the notebook, let’s see how to transfer them to a little web presentation. <a data-primary="web presentations" data-secondary="transferring charts from notebook to web with Plotly" data-type="indexterm" id="ix_webprestrnsf"/><a data-primary="Plotly charting library" data-secondary="transferring charts from notebook to web" data-type="indexterm" id="ix_Pltlytrnsf"/>We’re going to use the <code>plot</code> function from Plotly’s <code>offline</code> module to generated the embeddable HTML+JS required, so let’s first import it:<a data-primary="HTML" data-secondary="embeddable, generating with Plotly for charts" data-type="indexterm" id="idm45607754266480"/><a data-primary="JavaScript" data-secondary="embeddable, generating with Plotly to transfer charts to the web" data-type="indexterm" id="ix_JSPltly"/></p>
<pre data-code-language="python" data-type="programlisting"><code class="kn">from</code> <code class="nn">plotly.offline</code> <code class="kn">import</code> <code class="n">plot</code></pre>
<p>Using <code>plot</code>, we can create an embeddable string from the figure that can be lifted straight to the web. It contains the necessary HTML and JavaScript tags to bootstrap Plotly’s JavaScript library and create the chart:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">embed_string</code> <code class="o">=</code> <code class="n">plot</code><code class="p">(</code><code class="n">fig</code><code class="p">,</code> <code class="n">output_type</code><code class="o">=</code><code class="s1">'div'</code><code class="p">,</code> <code class="n">include_plotlyjs</code><code class="o">=</code><code class="s2">"cdn"</code><code class="p">)</code>
<code class="n">embed_string</code>
<code class="c1">#'&lt;div&gt;                        &lt;script type="text/javascript"&gt;window.PlotlyConfig</code>
<code class="c1">#= {MathJaxConfig: \'local\'};&lt;/script&gt;\n        &lt;script src="https://cdn.plot.ly/</code>
<code class="c1">#plotly-2.9.0.min.js"&gt;&lt;/script&gt;                &lt;div</code>
<code class="c1">#id="195b2d71-f59d-4f8a-a40a-3b8c797a918b" class="plotly-graph-div"</code>
<code class="c1">#style="height:600px; width:600px;"&gt;&lt;/div&gt;            &lt;script type="text/</code>
<code class="c1">#javascript"&gt; [...]    &lt;/script&gt;</code>
<code class="c1">#&lt;/div&gt;'</code></pre>
<p>If we tidy up that string we see it breaks down to four components, an HTML <code>div</code> tag with the chart’s ID and some JavaScript, containing the <code>newPlot</code> call with data and layout passed in as parameters:</p>
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code>
  <code class="cm">&lt;!-- (1) JavaScript Plotly config, placed with JavaScript (.js) file --&gt;</code>
  <code class="p">&lt;</code><code class="nt">script</code> <code class="na">type</code><code class="o">=</code><code class="s">"text/javascript"</code><code class="p">&gt;</code><code class="nb">window</code><code class="p">.</code><code class="nx">PlotlyConfig</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">{</code><code class="nx">MathJaxConfig</code><code class="o">:</code><code class="w"> </code><code class="s1">'local'</code><code class="p">};</code><code class="w"/>
<code class="w">  </code><code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
  <code class="cm">&lt;!-- (2) Place bottom of HTML file to import the Plotly library</code>
<code class="cm">           from the cloud (content delivery network) --&gt;</code>
  <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"https://cdn.plot.ly/plotly-2.9.0.min.js"</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
  <code class="cm">&lt;!-- create a content div for the chart, with ID tag (to be inflated)</code>
<code class="cm">     (3) !! Put this div in the HTML section of the code-pen !! --&gt;</code>
  <code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"4dbeae4f-ed9b-4dc1-9c69-d4bb2a20eaa7"</code> <code class="na">class</code><code class="o">=</code><code class="s">"plotly-graph-div"</code>
       <code class="na">style</code><code class="o">=</code><code class="s">"height:100%; width:100%;"</code><code class="p">&gt;&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>

  <code class="p">&lt;</code><code class="nt">script</code> <code class="na">type</code><code class="o">=</code><code class="s">"text/javascript"</code><code class="p">&gt;</code><code class="w"/>
<code class="w">    </code><code class="c1">// (4) Everything within this tag goes to a JavaScript (.js) file --&gt;</code><code class="w"/>
<code class="w">    </code><code class="nb">window</code><code class="p">.</code><code class="nx">PLOTLYENV</code><code class="o">=</code><code class="nb">window</code><code class="p">.</code><code class="nx">PLOTLYENV</code><code class="w"> </code><code class="o">||</code><code class="w"> </code><code class="p">{};</code><code class="w"/>
<code class="w">    </code><code class="c1">// Grab the 'div' tag above by ID and call Plotly's JS API on it, using the</code><code class="w"/>
<code class="w">    </code><code class="c1">// embedded data and annotations</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"4dbeae4f-ed9b-4dc1-9c69-d4bb2a20eaa7"</code><code class="p">))</code><code class="w"/>
<code class="w">    </code><code class="p">{</code><code class="w">                    </code><code class="nx">Plotly</code><code class="p">.</code><code class="nx">newPlot</code><code class="p">(</code><code class="s2">"4dbeae4f-ed9b-4dc1-9c69-d4bb2a20eaa7"</code><code class="p">,</code><code class="w"/>
<code class="w">                      </code><code class="p">[{</code><code class="s2">"mode"</code><code class="o">:</code><code class="s2">"lines"</code><code class="p">,</code><code class="s2">"name"</code><code class="o">:</code><code class="s2">"Korea, South"</code><code class="p">,</code><code class="w"/>
<code class="w">                      </code><code class="s2">"x"</code><code class="o">:</code><code class="w"> </code><code class="p">[</code><code class="mf">0</code><code class="p">,</code><code class="mf">1</code><code class="p">,</code><code class="mf">2</code><code class="p">,</code><code class="mf">3</code><code class="p">,</code><code class="mf">4</code><code class="p">,</code><code class="mf">5</code><code class="p">,</code><code class="mf">6</code><code class="p">,</code><code class="mf">7</code><code class="p">,</code><code class="mf">8</code><code class="p">,</code><code class="mf">9</code><code class="p">,</code><code class="mf">10</code><code class="p">,</code><code class="mf">11</code><code class="p">,</code><code class="mf">12</code><code class="p">,...]}])</code><code class="w"/>
<code class="w">                </code><code class="p">};</code><code class="w"/>
<code class="w">  </code><code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code></pre>
<p>Although we could just paste the HTML+JS into a web page and see the chart rendered, it’s better practice to separate JS and HTML concerns. First, we place the chart div in a little web page with a few headers, add some containers for info-boxes, etc.:</p>
<pre data-code-language="html" data-type="programlisting"><code class="cm">&lt;!-- index.xhtml --&gt;</code><code>
</code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"main"</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="nt">h1</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">'title'</code><code class="p">&gt;</code><code>The Nobel Prize</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">h1</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="nt">h2</code><code class="p">&gt;</code><code>From notebook to the web with Plotly</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">h2</code><code class="p">&gt;</code><code>

  </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"intro"</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code>Some nuggets of data mined [...]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

  </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"container"</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">"by-country-container"</code><code class="p">&gt;</code><code>

    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"info-box"</code><code class="p">&gt;</code><code>
      </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code>This chart shows the cumulative Nobel prize wins by region, taking the
       two or three highest winning countries from each.[...]</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"chart-wrapper"</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">"by-country"</code><code class="p">&gt;</code><code>
      </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">"bd54c166-3733-4b20-9bb9-694cfff4a48e"</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO9-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO9-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
      </code><code class="na">class</code><code class="o">=</code><code class="s">"plotly-graph-div"</code><code> </code><code class="na">style</code><code class="o">=</code><code class="s">"height:100%; width:100%;"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">scr</code><code class="o">=</code><code class="s">"scripts/plotly_charts.js"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">src</code><code class="o">=</code><code class="s">"https://cdn.plot.ly/plotly-2.9.0.min.js"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO9-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO9-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO9-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO9-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The <code>div</code> container produced by Plotly with an ID corresponding to the JavaScripted chart.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO9-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO9-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>The <code>script</code> tag produced by Plotly to import the JS charting library.</p></dd>
</dl>
<p>We take the content of the remaining two JavaScript tags and place it in a <em>plotly_charts.js</em> JS file:</p>
<pre data-code-language="js" data-type="programlisting"><code class="c1">// scripts/plotly_charts.js
</code><code>  </code><code class="nb">window</code><code class="p">.</code><code class="nx">PLOTLYENV</code><code class="o">=</code><code class="nb">window</code><code class="p">.</code><code class="nx">PLOTLYENV</code><code> </code><code class="o">||</code><code> </code><code class="p">{</code><code class="p">}</code><code class="p">;</code><code>
  </code><code class="k">if</code><code> </code><code class="p">(</code><code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"bd54c166-3733-4b20-9bb9-694cfff4a48e"</code><code class="p">)</code><code class="p">)</code><code class="p">{</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
    </code><code class="nx">Plotly</code><code class="p">.</code><code class="nx">newPlot</code><code class="p">(</code><code class="s2">"bd54c166-3733-4b20-9bb9-694cfff4a48e"</code><code class="p">,</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
      </code><code class="p">[</code><code class="p">{</code><code class="s2">"hovertemplate"</code><code class="o">:</code><code class="s2">"N. America&lt;br&gt;%{x}&lt;br&gt;$%{y}&lt;extra&gt;&lt;/extra&gt;"</code><code class="p">,</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-3" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
        </code><code class="s2">"mode"</code><code class="o">:</code><code class="s2">"lines"</code><code class="p">,</code><code class="s2">"name"</code><code class="o">:</code><code class="s2">"N. America"</code><code class="p">,</code><code>
        </code><code class="s2">"x"</code><code class="o">:</code><code class="p">[</code><code class="mi">1901</code><code class="p">,</code><code class="mi">1902</code><code class="p">,</code><code class="mi">1903</code><code class="p">,</code><code class="mi">1904</code><code class="p">,</code><code class="mi">1905</code><code class="p">,</code><code class="mi">1906</code><code class="p">,</code><code class="mi">1907</code><code class="p">,</code><code class="mi">1908</code><code class="p">,</code><code class="mi">1909</code><code class="p">,</code><code class="mi">1910</code><code class="p">,</code><code class="mi">1911</code><code class="p">,</code><code class="mi">1912</code><code class="p">,</code><code class="mi">1913</code><code class="p">,</code><code>
             </code><code class="mi">1914</code><code class="p">,</code><code class="mi">1915</code><code class="p">,</code><code class="mi">1916</code><code class="p">,</code><code class="mi">1917</code><code class="p">,</code><code class="mi">1918</code><code class="p">,</code><code class="mi">1919</code><code class="p">,</code><code class="mi">1920</code><code class="p">,</code><code class="mi">1921</code><code class="p">,</code><code class="mi">1922</code><code class="p">,</code><code class="p">...</code><code class="p">]</code><code>
      </code><code class="p">}</code><code class="p">]</code><code class="p">)</code><code>
  </code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>Checks that the <code>div</code> with correct ID is present.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Plotly’s <code>newPlot</code> method will build the chart in the identified container.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-3" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO10-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>An array of chart-objects, in this case containing all the data (<code>x</code> and <code>y</code> arrays) necessary to transfer the chart from notebook to web page.</p></dd>
</dl>
<p>On page load the Plotly library’s <code>newPlot</code> method is run using the embedding data and layout and the chart built with JS in the <code>div</code> container specified by ID. This produces the web page shown in <a data-type="xref" href="#img_plotly_to_web">Figure 14-6</a>.</p>
<figure><div class="figure" id="img_plotly_to_web">
<img alt="dpj2 1406" height="734" src="assets/dpj2_1406.png" width="1226"/>
<h6><span class="label">Figure 14-6. </span>From notebook to web with Plotly</h6>
</div></figure>
<p>All charts produced in Python with Plotly can be transferred to the web in this way. If you plan on using more than a couple, I recommend having separate JS files for each chart as the embedded data can lead to very long files.<a data-primary="JavaScript" data-secondary="embeddable, generating with Plotly to transfer charts to the web" data-startref="ix_JSPltly" data-type="indexterm" id="idm45607752989216"/><a data-primary="web presentations" data-secondary="transferring charts from notebook to web with Plotly" data-startref="ix_webprestrnsf" data-type="indexterm" id="idm45607752988128"/><a data-primary="Plotly charting library" data-secondary="transferring charts from notebook to web" data-startref="ix_Pltlytrnsf" data-type="indexterm" id="idm45607752987040"/></p>
</div></section>
<section data-pdf-bookmark="Native JavaScript Charts with Plotly" data-type="sect1"><div class="sect1" id="sect_native_JS_Plotly">
<h1>Native JavaScript Charts with Plotly</h1>
<p>Being able to easily shift a favored chart from notebook to web is great, but if you need to make refinements it involves moving back and forth from notebook to webdev.<a data-primary="web presentations" data-secondary="native JavaScript charts with Plotly" data-type="indexterm" id="ix_webpresJSPltly"/><a data-primary="Plotly charting library" data-secondary="producing native JavaScript charts with" data-type="indexterm" id="ix_PltlyJScht"/><a data-primary="JavaScript" data-secondary="native JavaScript charts with Plotly" data-type="indexterm" id="ix_JSntvPltly"/> This can get annoying after a while. One really cool thing about Plotly is that you are learning a JavaScript charting library for free, as it were. The Python and JS figure patterns are very similar, so it’s easy to both convert chart code from Python to JS and start writing JS charts from scratch. Let’s demonstrate this by converting a seaborn chart to JavaScripted Plotly.</p>
<p>In <a data-type="xref" href="ch11.xhtml#sect_age_at_time_of_award">“Age at Time of Award”</a>, we produced some violin plots using seaborn. To transfer these to the web, we’ll first need some data. <a data-primary="JSON" data-secondary="converting dataset to and pasting in JavaScript file" data-type="indexterm" id="idm45607752979504"/>One useful method for shifting small datasets is to convert a refined dataset to JSON and just copy the string produced, pasting it into a JS file and then parsing the string to a JS object. First, we use pandas to create a small dataset with only the <code>award_age</code> and <code>gender</code> columns, then produce the required JSON array of objects:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df_select</code> <code class="o">=</code> <code class="n">df</code><code class="p">[[</code><code class="s1">'gender'</code><code class="p">,</code> <code class="s1">'award_age'</code><code class="p">]]</code>
<code class="n">df_select</code><code class="o">.</code><code class="n">to_json</code><code class="p">(</code><code class="n">orient</code><code class="o">=</code><code class="s1">'records'</code><code class="p">)</code>
<code class="c1">#'[{"gender":"male","award_age":57},{"gender":"male","award_age":80},</code>
<code class="c1">#{"gender":"male","award_age":49},{"gender":"male","award_age":59},</code>
<code class="c1">#{"gender":"male","award_age":49},{"gender":"male","award_age":46},...}]'</code></pre>
<p>We can take the JSON string, paste it into a JS file, and use the built-in JSON library to parse the string into a JS array of objects:</p>
<pre data-code-language="js" data-type="programlisting"><code class="kd">let</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="s1">'[{"gender":"male","award_age":57}</code>
<code class="s1">'</code><code class="p">,{</code><code class="s2">"gender"</code><code class="o">:</code><code class="s2">"male"</code><code class="p">,</code><code class="s2">"award_age"</code><code class="o">:</code><code class="mi">80</code><code class="p">},</code><code class="s1">'</code>
<code class="s1">'</code><code class="p">{</code><code class="s2">"gender"</code><code class="o">:</code><code class="s2">"male"</code><code class="p">,</code><code class="s2">"award_age"</code><code class="o">:</code><code class="mi">49</code><code class="p">},{</code><code class="s2">"gender"</code><code class="o">:</code><code class="s2">"male"</code><code class="p">,</code><code class="s2">"award_age"</code><code class="o">:</code><code class="mi">59</code><code class="p">},</code><code class="s1">'</code>
<code class="s1">'</code><code class="p">{</code><code class="s2">"gender"</code><code class="o">:</code><code class="s2">"male"</code><code class="p">,</code><code class="s2">"award_age"</code><code class="o">:</code><code class="mi">48</code><code class="p">},</code> <code class="p">...</code> <code class="p">]</code><code class="err">'</code><code class="p">)</code></pre>
<p>With the <a data-primary="HTML" data-secondary="chart container for native JavaScript chart in Plotly" data-type="indexterm" id="idm45607752946112"/>data to hand, we’ll need a little HTML scaffold with a chart container, ID <code>award_age</code>,  to contain the Plotly chart:</p>
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"main"</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="nt">h1</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">'title'</code><code class="p">&gt;</code><code>The Nobel Prize</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">h1</code><code class="p">&gt;</code><code>
  </code><code class="cm">&lt;!-- ... --&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"chart-wrapper"</code><code class="p">&gt;</code><code>
      </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">'chart'</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">'award_age'</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO11-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO11-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">src</code><code class="o">=</code><code class="s">"https://cdn.plot.ly/plotly-2.9.0.min.js"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO11-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO11-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>We’ll use this container’s ID to tell Plotly where to build the chart.</p></dd>
</dl>
<p>We can now build our first JS-native Plotly chart. The pattern matches that seen with the Python Plotly plots in our notebook. First, we create a data array (<code>traces</code>) with some chart-objects, then a layout to provide titles, labels, colors, etc. Then we use <code>newPlot</code> to build the chart. The main difference with Python is that the first parameter of <code>newPlot</code> is the ID of the container within which to build the chart:</p>
<pre data-code-language="js" data-type="programlisting"><code class="kd">var</code><code> </code><code class="nx">traces</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">{</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
  </code><code class="nx">type</code><code class="o">:</code><code> </code><code class="s1">'violin'</code><code class="p">,</code><code>
  </code><code class="nx">x</code><code class="o">:</code><code> </code><code class="nx">data</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">d</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">gender</code><code class="p">)</code><code class="p">,</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
  </code><code class="nx">y</code><code class="o">:</code><code> </code><code class="nx">data</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">d</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">award_age</code><code class="p">)</code><code class="p">,</code><code>
  </code><code class="nx">points</code><code class="o">:</code><code> </code><code class="s1">'none'</code><code class="p">,</code><code>
  </code><code class="nx">box</code><code class="o">:</code><code> </code><code class="p">{</code><code>
    </code><code class="nx">visible</code><code class="o">:</code><code> </code><code class="kc">true</code><code>
  </code><code class="p">}</code><code class="p">,</code><code>
  </code><code class="nx">line</code><code class="o">:</code><code> </code><code class="p">{</code><code>
    </code><code class="nx">color</code><code class="o">:</code><code> </code><code class="s1">'green'</code><code class="p">,</code><code>
  </code><code class="p">}</code><code class="p">,</code><code>
  </code><code class="nx">meanline</code><code class="o">:</code><code> </code><code class="p">{</code><code>
    </code><code class="nx">visible</code><code class="o">:</code><code> </code><code class="kc">true</code><code>
  </code><code class="p">}</code><code class="p">,</code><code>
</code><code class="p">}</code><code class="p">]</code><code>

</code><code class="kd">var</code><code> </code><code class="nx">layout</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code>
  </code><code class="nx">title</code><code class="o">:</code><code> </code><code class="s2">"Nobel Prize Violin Plot"</code><code class="p">,</code><code>
  </code><code class="nx">yaxis</code><code class="o">:</code><code> </code><code class="p">{</code><code>
    </code><code class="nx">zeroline</code><code class="o">:</code><code> </code><code class="kc">false</code><code>
  </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nx">Plotly</code><code class="p">.</code><code class="nx">newPlot</code><code class="p">(</code><code class="s1">'award_age'</code><code class="p">,</code><code> </code><code class="nx">traces</code><code class="p">,</code><code> </code><code class="nx">layout</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-3" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>As per the usual Plotly pattern, we first create an array of chart-objects.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We use the JS array’s <code>map</code> method with shorthand arrow functions to produce arrays of winners’ genders and ages.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-3" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO12-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Plotly will render the chart to our <code>div</code> container with ID <code>'award_age'</code>.</p></dd>
</dl>
<p>The violin<a data-primary="violin plots" data-secondary="using Plotly JavaScript" data-type="indexterm" id="idm45607752639616"/> chart produced is shown in <a data-type="xref" href="#img_plotly_violin">Figure 14-7</a>.</p>
<figure><div class="figure" id="img_plotly_violin">
<img alt="dpj2 1407" height="733" src="assets/dpj2_1407.png" width="1218"/>
<h6><span class="label">Figure 14-7. </span>Violin plot with Plotly JS</h6>
</div></figure>
<p class="pagebreak-before">As you can see, the Plotly’s JS API matches the Python one and is, if anything, more succinct. Separating data delivery from chart construction makes the codebase much easier to work with and means tweaking and refinement don’t require a return to the Python API. For small data sketches, parsing JSON strings gets the job done fast.</p>
<p>But if you want to have larger datasets to hand and to really leverage the power of the JS web context, the standard data delivery is through JSON files.<sup><a data-type="noteref" href="ch14.xhtml#idm45607752586880" id="idm45607752586880-marker">6</a></sup> For datasets of a few megabytes, this offers the most flexibility for datavizzers.</p>
<section data-pdf-bookmark="Fetching JSON Files" data-type="sect2"><div class="sect2" id="idm45607752585952">
<h2>Fetching JSON Files</h2>
<p>Another way of getting data to your web pages is to export a DataFrame to JSON and then use JavaScript to fetch it, do any necessary further processing, and then pass it on to a native JS chart library (or D3).<a data-primary="JSON" data-secondary="exporting DataFrame to JSON and passing it to JavaScript for processing" data-type="indexterm" id="idm45607752584320"/> This is a very flexible workflow and provides the most freedom for JS data visualizations.</p>
<p>The separation of powers, allowing Python to focus on its data-processing strength and JavaScript its superior data-visualizing ability, provides a dataviz sweet spot and is the most common way of producing ambitious web dataviz.</p>
<p>First, we’ll save our Nobel winners DataFrame to JSON using the dedicated method. Generally we’ll want the data in the form of arrays of objects, which requires an <code>orient</code> parameter of <code>'records'</code>:</p>
<pre data-code-language="python" data-type="programlisting"><code class="n">df</code><code class="o">.</code><code class="n">to_json</code><code class="p">(</code><code class="s1">'nobel_winners.json'</code><code class="p">,</code> <code class="n">orient</code><code class="o">=</code><code class="s1">'records'</code><code class="p">)</code></pre>
<p>With the JSON dataset to hand, lets use it to produce a Plotly chart using the JavaScript API as in the previous section. We’ll need a little HTML, including an ID’ed container to build the chart in and a script link to import our JS code:</p>
<pre data-code-language="html" data-type="programlisting"><code class="cm">&lt;!-- index.xhtml --&gt;</code><code>
</code><code class="p">&lt;</code><code class="nt">link</code><code> </code><code class="na">rel</code><code class="o">=</code><code class="s">"stylesheet"</code><code> </code><code class="na">href</code><code class="o">=</code><code class="s">"styles/index.css"</code><code class="p">&gt;</code><code>

</code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"main"</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="nt">h1</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">'title'</code><code class="p">&gt;</code><code>The Nobel Prize</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">h1</code><code class="p">&gt;</code><code>
  </code><code class="cm">&lt;!-- ... --&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"chart-wrapper"</code><code class="p">&gt;</code><code>
      </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">'chart'</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">'gender-category'</code><code class="p">&gt;</code><code> </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO13-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO13-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">src</code><code class="o">=</code><code class="s">"https://cdn.plot.ly/plotly-2.9.0.min.js"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">src</code><code class="o">=</code><code class="s">"https://cdnjs.cloudflare.com/ajax/libs/d3/7.4.2/d3.min.js"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code><code>
</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">src</code><code class="o">=</code><code class="s">"scripts/index.js"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO13-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO13-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO13-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO13-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>We’ll use the ID to tell Plotly where to build the chart.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO13-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO13-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Import the index JS file from scripts folder.</p></dd>
</dl>
<p>In our JS entry point we use D3’s <code>json</code> utility method to import the Nobel winners dataset and convert it to an array of JS objects.<a data-primary="D3 library" data-secondary="converting JSON to JavaScript objects" data-type="indexterm" id="idm45607752454672"/> We then hand off the data to a <code>makeChart</code> function where Plotly will work its magic:</p>
<pre data-code-language="js" data-type="programlisting"><code class="c1">// scripts/index.js</code>
<code class="nx">d3</code><code class="p">.</code><code class="nx">json</code><code class="p">(</code><code class="s1">'data/nobel_winners.json'</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"Dataset: "</code><code class="p">,</code> <code class="nx">data</code><code class="p">)</code>
  <code class="nx">makeChart</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code>
<code class="p">})</code></pre>
<p>The console shows our array of winners:</p>
<pre data-type="programlisting">[
  {category: 'Physiology or Medicine', country: 'Argentina',
   date_of_birth: -1332806400000, date_of_death: 1016928000000,
   gender: 'male', …},
  {category: 'Peace', country: 'Belgium',
   date_of_birth: -4431715200000, date_of_death: -1806278400000,
   gender: 'male', …}
   [...]
]</pre>
<p>In the <code>makeChart</code> function we use D3’s very handy <a href="https://oreil.ly/wLVAZ">rollup method</a> to group our Nobel dataset by gender and category, and then provide the group sizes by taking the length of the arrays of members returned:<a data-primary="D3 library" data-secondary="rollup method" data-type="indexterm" id="idm45607752395840"/></p>
<pre data-code-language="js" data-type="programlisting"><code class="kd">function</code><code> </code><code class="nx">makeChart</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code><code> </code><code class="p">{</code><code>
  </code><code class="kd">let</code><code> </code><code class="nx">cat_groups</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">rollup</code><code class="p">(</code><code class="nx">data</code><code class="p">,</code><code> </code><code class="nx">v</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">v</code><code class="p">.</code><code class="nx">length</code><code class="p">,</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
                      </code><code class="nx">d</code><code class="o">=&gt;</code><code class="nx">d</code><code class="p">.</code><code class="nx">gender</code><code class="p">,</code><code> </code><code class="nx">d</code><code class="o">=&gt;</code><code class="nx">d</code><code class="p">.</code><code class="nx">category</code><code class="p">)</code><code>
  </code><code class="kd">let</code><code> </code><code class="nx">male</code><code> </code><code class="o">=</code><code> </code><code class="nx">cat_groups</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'male'</code><code class="p">)</code><code>
  </code><code class="kd">let</code><code> </code><code class="nx">female</code><code> </code><code class="o">=</code><code> </code><code class="nx">cat_groups</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'female'</code><code class="p">)</code><code>
  </code><code class="kd">let</code><code> </code><code class="nx">categories</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">...</code><code class="nx">male</code><code class="p">.</code><code class="nx">keys</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code class="p">.</code><code class="nx">sort</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>

  </code><code class="kd">let</code><code> </code><code class="nx">traceM</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code>
    </code><code class="nx">y</code><code class="o">:</code><code> </code><code class="nx">categories</code><code class="p">,</code><code>
    </code><code class="nx">x</code><code class="o">:</code><code> </code><code class="nx">categories</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">c</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">male</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="nx">c</code><code class="p">)</code><code class="p">)</code><code class="p">,</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-3" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
    </code><code class="nx">name</code><code class="o">:</code><code> </code><code class="s2">"male prize total"</code><code class="p">,</code><code>
    </code><code class="nx">type</code><code class="o">:</code><code> </code><code class="s1">'bar'</code><code class="p">,</code><code>
    </code><code class="nx">orientation</code><code class="o">:</code><code> </code><code class="s1">'h'</code><code>
  </code><code class="p">}</code><code>
    </code><code class="kd">let</code><code> </code><code class="nx">traceF</code><code class="o">=</code><code> </code><code class="p">{</code><code>
    </code><code class="nx">y</code><code class="o">:</code><code> </code><code class="nx">categories</code><code class="p">,</code><code>
    </code><code class="nx">x</code><code class="o">:</code><code> </code><code class="nx">categories</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">c</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">female</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="nx">c</code><code class="p">)</code><code class="p">)</code><code class="p">,</code><code>
    </code><code class="nx">name</code><code class="o">:</code><code> </code><code class="s2">"female prize total"</code><code class="p">,</code><code>
    </code><code class="nx">type</code><code class="o">:</code><code> </code><code class="s1">'bar'</code><code class="p">,</code><code>
    </code><code class="nx">orientation</code><code class="o">:</code><code> </code><code class="s1">'h'</code><code>
  </code><code class="p">}</code><code>

  </code><code class="kd">let</code><code> </code><code class="nx">traces</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="nx">traceM</code><code class="p">,</code><code> </code><code class="nx">traceF</code><code class="p">]</code><code>
  </code><code class="kd">let</code><code> </code><code class="nx">layout</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="nx">barmode</code><code class="o">:</code><code> </code><code class="s1">'group'</code><code class="p">,</code><code> </code><code class="nx">margin</code><code class="o">:</code><code> </code><code class="p">{</code><code class="nx">l</code><code class="o">:</code><code class="mi">160</code><code class="p">}</code><code class="p">}</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-4" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a><code>

  </code><code class="nx">Plotly</code><code class="p">.</code><code class="nx">newPlot</code><code class="p">(</code><code class="s1">'gender-category'</code><code class="p">,</code><code> </code><code class="nx">traces</code><code class="p">,</code><code> </code><code class="nx">layout</code><code class="p">)</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>From the array of winner objects, <code>rollup</code> groups by gender, then category, and then gives the array size/length of the resulting groups as a JS Map: <code>{male: {Physics: 199, Economics: 74, ...}, female: {...}}</code>.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We use the JS <code>...</code> <a href="https://oreil.ly/ZsIzM">spread operator</a> to produce an array from the category keys, which is then sorted to produce our horizontal bar chart’s y values.<a data-primary="spread operator (…​) in Java Script" data-type="indexterm" id="idm45607752159248"/></p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-3" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>We map the sorted categories to their group values to provide the bar chart heights.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-4" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO14-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></dt>
<dd><p>We increase the left margin for our horizontal bar chart to accommodate long labels.</p></dd>
</dl>
<p>The bar chart produced is shown in <a data-type="xref" href="#img_plotly_barchart">Figure 14-8</a>. With the full Nobel winners dataset available, it’s easy to spin off a whole range of charts without having to switch context from Python to JS. The Plotly API is pretty intuitive and discoverable, making it a great addition to the dataviz toolset. Let’s see how easy it is to extend it with a few HTML+JS custom controls.<a data-primary="web presentations" data-secondary="native JavaScript charts with Plotly" data-startref="ix_webpresJSPltly" data-type="indexterm" id="idm45607752152736"/><a data-primary="Plotly charting library" data-secondary="producing native JavaScript charts with" data-startref="ix_PltlyJScht" data-type="indexterm" id="idm45607752077328"/><a data-primary="JavaScript" data-secondary="native JavaScript charts with Plotly" data-startref="ix_JSntvPltly" data-type="indexterm" id="idm45607752076240"/></p>
<figure><div class="figure" id="img_plotly_barchart">
<img alt="dpj2 1408" height="762" src="assets/dpj2_1408.png" width="822"/>
<h6><span class="label">Figure 14-8. </span>Bar chart with Plotly JS</h6>
</div></figure>
</div></section>
</div></section>
<section data-pdf-bookmark="User-Driven Plotly with JavaScript and HTML" data-type="sect1"><div class="sect1" id="idm45607752985488">
<h1>User-Driven Plotly with JavaScript and HTML</h1>
<p>As we saw in <a data-type="xref" href="#sect_plotly_ui">“Adding Custom Controls with Plotly”</a>, Plotly allows you to add custom controls such as buttons or dropdowns in Python, which can be transferred to the web as JS-driven HTML controls.<a data-primary="web presentations" data-secondary="user-driven Plotly with JavaScript and HTML" data-type="indexterm" id="ix_webpresusrPlt"/><a data-primary="Plotly charting library" data-secondary="user-driven Plotly with JavaScript and HTML" data-type="indexterm" id="ix_Pltlyusr"/> Although this is a really useful feature of Plotly, it is a little limited, particularly in terms of placement and styling of these widgets. An alternative way to update Plotly web charts is to use native JS+HTML controls to change the charts, filtering the datasets or adapting the styling. It turns out this is pretty easy to do and, with a little JS know-how, it represents a more flexible and powerful control setup.<a data-primary="JavaScript" data-secondary="native JavaScript controls to manipulate Plotly chart" data-type="indexterm" id="ix_JSctrl"/></p>
<p>Let’s demonstrate some JS custom control using one of the charts we just built in <a data-type="xref" href="#sect_native_JS_Plotly">“Native JavaScript Charts with Plotly”</a>. We’ll add a dropdown to allow the user to change the x-axis group shown. The two obvious options are the existing breakdown by gender and one grouping the ages by prize category.<a data-primary="HTML" data-secondary="dropdown (select) for Plotly chart" data-type="indexterm" id="idm45607752066720"/></p>
<p>First, we’ll add an HTML dropdown (<code>select</code>) to the page and center it using some  flex-box CSS:</p>
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"main"</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="nt">h1</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">'title'</code><code class="p">&gt;</code><code>The Nobel Prize</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">h1</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="nt">h2</code><code class="p">&gt;</code><code>From notebook to the web with Plotly</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">h2</code><code class="p">&gt;</code><code>

  </code><code class="cm">&lt;!-- ... --&gt;</code><code>
  </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"container"</code><code class="p">&gt;</code><code>
  </code><code class="cm">&lt;!-- ... --&gt;</code><code>
    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"chart-wrapper"</code><code class="p">&gt;</code><code>
      </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">'chart'</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">'violin-group'</code><code class="p">&gt;</code><code> </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>
  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

  </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">"chart-controls"</code><code class="p">&gt;</code><code>

    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">"nobel-group-select-holder"</code><code class="p">&gt;</code><code>
      </code><code class="p">&lt;</code><code class="nt">label</code><code> </code><code class="na">for</code><code class="o">=</code><code class="s">"nobel-group"</code><code class="p">&gt;</code><code>Group:</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">label</code><code class="p">&gt;</code><code>
      </code><code class="p">&lt;</code><code class="nt">select</code><code> </code><code class="na">name</code><code class="o">=</code><code class="s">"nobel-group"</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">"nobel-group"</code><code class="p">&gt;</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">select</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO15-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO15-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>

</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO15-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO15-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>This <code>select</code> tag with contain <code>option</code> tags that will be added with JS and D3.</p></dd>
</dl>
<p>A little CSS will center any controls in the <code>controls</code> container and adapt the font style:<a data-primary="CSS" data-secondary="centering controls in Plotly chart and adapting font style" data-type="indexterm" id="idm45607751956576"/></p>
<pre data-code-language="css" data-type="programlisting"><code class="nf">#chart-controls</code> <code class="p">{</code>
  <code class="k">display</code><code class="o">:</code> <code class="nb">flex</code><code class="p">;</code>
  <code class="k">justify-content</code><code class="o">:</code> <code class="nb">center</code><code class="p">;</code>
  <code class="k">font-family</code><code class="o">:</code> <code class="nb">sans-serif</code><code class="p">;</code>
  <code class="k">font-size</code><code class="o">:</code> <code class="m">0.7em</code><code class="p">;</code>
  <code class="k">margin</code><code class="o">:</code> <code class="m">20px</code> <code class="m">0</code><code class="p">;</code>
<code class="p">}</code>

<code class="nt">select</code> <code class="p">{</code>
  <code class="k">padding</code><code class="o">:</code> <code class="m">2px</code><code class="p">;</code>
<code class="p">}</code></pre>
<p>Now that we’ve some HTML to build upon, we’ll use some JS and D3 to add the <code>select</code> tags to our group controls. But first we’ll adapt the Plotly charting function to allow it to be updated with new groups. The JSON data is imported as before, but now the data is stored as a local variable and used to update a Plotly violin chart. This <code>updateChart</code> function uses Plotly’s <a href="https://oreil.ly/tayov"><code>update</code> method</a> to create the plot. This works like <code>newPlot</code> but is intended to be called when data or layout changes, efficiently redrawing the plot to reflect any changes.</p>
<p>We also have a new <code>selectedGroup</code> variable, which will be used in the dropdown <code>select</code> to change the field being plotted:</p>
<pre data-code-language="js" data-type="programlisting"><code class="kd">let</code><code> </code><code class="nx">data</code><code>
</code><code class="nx">d3</code><code class="p">.</code><code class="nx">json</code><code class="p">(</code><code class="s2">"data/nobel_winners.json"</code><code class="p">)</code><code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="p">(</code><code class="nx">_data</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="p">{</code><code>
  </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">_data</code><code class="p">)</code><code class="p">;</code><code>
  </code><code class="nx">data</code><code> </code><code class="o">=</code><code> </code><code class="nx">_data</code><code>
  </code><code class="nx">updateChart</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>

</code><code class="kd">let</code><code> </code><code class="nx">selectedGroup</code><code> </code><code class="o">=</code><code> </code><code class="s1">'gender'</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>

</code><code class="kd">function</code><code> </code><code class="nx">updateChart</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">{</code><code>
  </code><code class="kd">var</code><code> </code><code class="nx">traces</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code>
    </code><code class="p">{</code><code>
      </code><code class="nx">type</code><code class="o">:</code><code> </code><code class="s2">"violin"</code><code class="p">,</code><code>
      </code><code class="nx">x</code><code class="o">:</code><code> </code><code class="nx">data</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">d</code><code class="p">[</code><code class="nx">selectedGroup</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-2"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
      </code><code class="nx">y</code><code class="o">:</code><code> </code><code class="nx">data</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">d</code><code class="p">.</code><code class="nx">award_age</code><code class="p">)</code><code class="p">,</code><code>
      </code><code class="nx">points</code><code class="o">:</code><code> </code><code class="s2">"none"</code><code class="p">,</code><code>
      </code><code class="nx">box</code><code class="o">:</code><code> </code><code class="p">{</code><code>
        </code><code class="nx">visible</code><code class="o">:</code><code> </code><code class="kc">true</code><code>
      </code><code class="p">}</code><code class="p">,</code><code>
      </code><code class="nx">line</code><code class="o">:</code><code> </code><code class="p">{</code><code>
        </code><code class="nx">color</code><code class="o">:</code><code> </code><code class="s2">"green"</code><code>
      </code><code class="p">}</code><code class="p">,</code><code>
      </code><code class="nx">meanline</code><code class="o">:</code><code> </code><code class="p">{</code><code>
        </code><code class="nx">visible</code><code class="o">:</code><code> </code><code class="kc">true</code><code>
      </code><code class="p">}</code><code>
    </code><code class="p">}</code><code>
  </code><code class="p">]</code><code class="p">;</code><code>

  </code><code class="kd">var</code><code> </code><code class="nx">layout</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code>
    </code><code class="nx">title</code><code class="o">:</code><code> </code><code class="s2">"Age distributions of the Nobel prizewinners"</code><code class="p">,</code><code>
    </code><code class="nx">yaxis</code><code class="o">:</code><code> </code><code class="p">{</code><code>
      </code><code class="nx">zeroline</code><code class="o">:</code><code> </code><code class="kc">false</code><code>
    </code><code class="p">}</code><code class="p">,</code><code>
    </code><code class="nx">xaxis</code><code class="o">:</code><code> </code><code class="p">{</code><code>
      </code><code class="nx">categoryorder</code><code class="o">:</code><code> </code><code class="s1">'category ascending'</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-3"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
    </code><code class="p">}</code><code>
  </code><code class="p">}</code><code class="p">;</code><code>

  </code><code class="nx">Plotly</code><code class="p">.</code><code class="nx">update</code><code class="p">(</code><code class="s2">"violin-group"</code><code class="p">,</code><code> </code><code class="nx">traces</code><code class="p">,</code><code> </code><code class="nx">layout</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-3" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-4"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The <code>selectedGroup</code> variable allows the x-axis group to be changed by the user.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-3" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>We want the prize groups to be presented in alphabetical order (starting with <em>Chemistry</em>), so make this change to the layout.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-4" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO16-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>In place of <code>newPlot</code> we call <code>update</code>, which has the same signature but is used to reflect changes to data (<code>traces</code>) or layout.</p></dd>
</dl>
<p>With the <code>updateChart</code> method to hand, we now need to add the select options and a callback function to be called when the user changes the prize group:</p>
<pre data-code-language="js" data-type="programlisting"><code class="kd">let</code><code> </code><code class="nx">availableGroups</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'gender'</code><code class="p">,</code><code> </code><code class="s1">'category'</code><code class="p">]</code><code>
</code><code class="nx">availableGroups</code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="p">(</code><code class="nx">g</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="p">{</code><code>
  </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s2">"#nobel-group"</code><code class="p">)</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-1" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a><code>
    </code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"option"</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">property</code><code class="p">(</code><code class="s2">"selected"</code><code class="p">,</code><code> </code><code class="nx">g</code><code> </code><code class="o">===</code><code> </code><code class="nx">selectedGroup</code><code class="p">)</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-2" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a><code>
    </code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"value"</code><code class="p">,</code><code> </code><code class="nx">g</code><code class="p">)</code><code>
    </code><code class="p">.</code><code class="nx">text</code><code class="p">(</code><code class="nx">g</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>

</code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s2">"#nobel-group"</code><code class="p">)</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s2">"change"</code><code class="p">,</code><code> </code><code class="kd">function</code><code> </code><code class="p">(</code><code class="nx">e</code><code class="p">)</code><code> </code><code class="p">{</code><code>
  </code><code class="nx">selectedGroup</code><code> </code><code class="o">=</code><code> </code><code class="nx">d3</code><code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">.</code><code class="nx">property</code><code class="p">(</code><code class="s2">"value"</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-3" id="co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a><code>
  </code><code class="nx">updateChart</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-1" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>For each of the available groups, we use D3 to select the dropdown by ID and append an <code>&lt;option&gt;</code> tag with text and value set to the group string.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-2" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>This ensures that the initial selection is the value of <code>selectedGroup</code> by setting the <code>selected</code> attribute to true.</p></dd>
<dt><a class="co" href="#co_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-3" id="callout_bringing_your_charts_to_the_web_with_matplotlib_and_plotly_CO17-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>We use D3 to add a callback function when a selection is made. Here we get the value of the option (<em>gender</em> or <em>category</em>) and use it to set the <code>selectedGroup</code> variable. We then update the chart to reflect this change.</p></dd>
</dl>
<p>With the wiring now complete, we have a group dropdown that changes the violin plot to reflect the group chosen. <a data-type="xref" href="#img_plotly_controls_js">Figure 14-9</a> shows the result of selecting the prize category group. Note that Plotly helpfully rotates the category group labels to prevent overlap.</p>
<figure><div class="figure" id="img_plotly_controls_js">
<img alt="dpj2 1409" height="675" src="assets/dpj2_1409.png" width="1014"/>
<h6><span class="label">Figure 14-9. </span>Adding a dropdown to control Plotly</h6>
</div></figure>
<p>We’ll be seeing more HTML controls in action in later chapters where buttons and radio-boxes are demoed. Creating controls in JS is a lot more flexible than the Python-driven options at the cost of a small amount of web-dev fu.</p>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45607752072816">
<h1>Summary</h1>
<p>In this chapter, we’ve seen how to turn the best charts from your notebook explorations into a web presentation.<a data-primary="JavaScript" data-secondary="native JavaScript controls to manipulate Plotly chart" data-startref="ix_JSctrl" data-type="indexterm" id="idm45607751441072"/><a data-primary="web presentations" data-secondary="user-driven Plotly with JavaScript and HTML" data-startref="ix_webpresusrPlt" data-type="indexterm" id="idm45607751439984"/><a data-primary="Plotly charting library" data-secondary="user-driven Plotly with JavaScript and HTML" data-startref="ix_Pltlyusr" data-type="indexterm" id="idm45607751438896"/> There are many options available, from static PNGs, with maybe some extra Matplotlib styling, to interactive Plotly charts, using custom JavaScript controls. Data can be embedded in the Plotly chart calls, produced using Plotly’s offline library, or imported as a JSON string (nice for data sketches) or file.</p>
<p>Plotly is a good charting library, and in learning the Python API you pretty much learn the JS API as well—a big plus. For conventional and some specialized (e.g., machine learning) charts, it’s a great option. For anything a little more bespoke or complex, D3 offers a lot more power, as we’ll see in the upcoming chapters.<a data-primary="web presentations" data-startref="ix_webpres" data-type="indexterm" id="idm45607751437296"/></p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45607755786208"><sup><a href="ch14.xhtml#idm45607755786208-marker">1</a></sup> <a href="https://bokeh.org">Bokeh</a> is a worthy alternative.</p><p data-type="footnote" id="idm45607755562576"><sup><a href="ch14.xhtml#idm45607755562576-marker">2</a></sup> You can easily transpose your DataFrames to the required columnar form using the DataFrame’s <code>T</code> operator.</p><p data-type="footnote" id="idm45607755439968"><sup><a href="ch14.xhtml#idm45607755439968-marker">3</a></sup> See <a class="bare" href="https://oreil.ly/zUyxK"><em class="hyperlink">https://oreil.ly/zUyxK</em></a> for Plotly’s line style options.</p><p data-type="footnote" id="idm45607755437280"><sup><a href="ch14.xhtml#idm45607755437280-marker">4</a></sup> See <a href="https://plotly.com/python">the Plotly site</a> for some demos.</p><p data-type="footnote" id="idm45607755224832"><sup><a href="ch14.xhtml#idm45607755224832-marker">5</a></sup> See <a class="bare" href="https://oreil.ly/8UDgA"><em class="hyperlink">https://oreil.ly/8UDgA</em></a> for further details.</p><p data-type="footnote" id="idm45607752586880"><sup><a href="ch14.xhtml#idm45607752586880-marker">6</a></sup> For more advanced, user-driven dataviz with large datasets, a data server with API is another route.</p></div></div></section></div></body></html>