# 前言

在过去的 20 年中，我大部分工作时间都在使用 SQL 处理数据。在这些年里，我在涵盖广泛的消费者和企业之间行业的科技公司工作过。在此期间，数据量大幅增加，我使用的技术也取得了长足的进步。数据库比以往任何时候都更快，用于传达数据意义的报告和可视化工具也更加强大。然而，有一件事情始终保持非常稳定，那就是 SQL 仍然是我工具箱中的重要组成部分。

我记得第一次学习 SQL 的时候。我开始我的职业生涯是在金融领域，那里主要使用电子表格，我擅长编写公式和记忆所有的键盘快捷键。有一天，我完全陷入其中，Ctrl 和 Alt 同时点击键盘上的每一个键，只是想看看会发生什么（然后为同事们制作了一个备忘单）。那既是乐趣，也是生存：我越快地处理电子表格，我就越有可能在午夜前完成工作，从而可以回家休息睡觉。电子表格的掌握让我在下一份工作中站稳了脚跟，这是一家初创公司，我在那里第一次接触了数据库和 SQL。

我的工作的一部分是在电子表格中处理库存数据，由于早期互联网规模的原因，数据集有时会有数万行。当时对我来说，这就是所谓的“大数据”。我习惯于在电脑的 CPU 在运行 vlookup 魔法时去喝杯咖啡或吃午餐。有一天，我的经理休假了，让我去管理他在笔记本电脑上用 Access 构建的数据仓库。刷新数据涉及一系列步骤：在门户网站上运行 SQL 查询，将结果 csv 文件加载到数据库中，然后刷新电子表格报告。在第一次成功加载后，我开始摸索，尝试理解其工作原理，并缠着工程师们教我如何修改 SQL 查询。

我一直对数据着迷，即使当我觉得可能会改变职业方向时，我也一直在做数据方面的工作。操控数据，回答问题，帮助同事更高效地工作，通过数据集了解企业和世界，这些工作从未停止过给我带来乐趣和挑战。

当我开始使用 SQL 时，学习资源并不多。我找到了一本关于基本语法的书，一夜之间读完，然后大部分时间通过试错来学习。在我学习的那些日子里，我直接查询生产数据库，由于我过于雄心勃勃（或更可能只是写得不好），有几次把网站搞垮了。幸运的是，我的技能逐渐提升，多年来我学会了从数据表中向前推导，从所需的输出向后推导，解决技术和逻辑挑战，并编写能够返回正确数据的查询。最终，我设计并建立了数据仓库，从不同的来源收集数据，避免了瘫痪关键生产数据库的风险。在编写 SQL 查询之前，我学到了很多关于何时以及如何聚合数据，以及何时保留数据在更原始的形式中的经验。

我和其他同一时间接触数据的人交流心得后发现，我们大多数人都是以同样的临时方式学习的。幸运的是，我们中的一些人有同行，可以分享技术。大多数 SQL 文本要么只是介绍性和基础性的（这些绝对有其存在的必要性！），要么针对数据库开发人员。对于专注于分析工作的高级 SQL 用户而言，能够提供的资源很少。知识往往被锁定在个人或小团队中。本书的目标之一是改变这种情况，为从事 SQL 解决常见分析问题的实践者提供参考，并希望激发使用您可能之前没有见过的技术进行数据研究的新探索。

# 本书中使用的约定

本书中使用以下排版约定：

*Italic*

表示新术语、网址、电子邮件地址、文件名、文件扩展名和关键字。

`Constant width`

用于程序列表，以及在段落内引用程序元素，如变量或函数名称、数据库、环境变量和语句。

**`Constant width bold`**

显示用户应直接输入的命令或其他文本。

*`Constant width italic`*

显示应由用户提供的值或由上下文确定的值替换的文本。

###### Tip

这个元素表示提示或建议。

###### 注意

这个元素表示一般注释。

###### 警告

这个元素表示警告或注意事项。

# 使用代码示例

补充材料（代码示例、练习等）可从[*https://github.com/cathytanimura/sql_book*](https://github.com/cathytanimura/sql_book)下载。

如果您有技术问题或在使用代码示例时遇到问题，请发送电子邮件至*bookquestions@oreilly.com*。

本书旨在帮助您完成工作。一般来说，如果本书提供了示例代码，您可以在程序和文档中使用它。除非您复制了代码的大部分，否则无需联系我们寻求许可。例如，编写一个使用本书中多个代码片段的程序不需要许可。销售或分发 O’Reilly 图书中的示例需要许可。引用本书回答问题并引用示例代码无需许可。将本书中大量示例代码整合到产品文档中需要许可。

我们感谢您的引用，但通常不要求。引用通常包括标题、作者、出版商和 ISBN。例如：“*SQL for Data Analysis* by Cathy Tanimura (O’Reilly). Copyright 2021 Cathy Tanimura, 978-1-492-08878-3.”

如果您觉得您使用的代码示例超出了合理使用范围或上述授权，请随时通过*permissions@oreilly.com*联系我们。

# O’Reilly 在线学习

###### 注意

40 多年来，[*O’Reilly Media*](http://oreilly.com)提供技术和商业培训、知识和见解，帮助公司取得成功。

我们独特的专家和创新者网络通过图书、文章和我们的在线学习平台分享他们的知识和专业知识。O’Reilly 的在线学习平台让您随时访问现场培训课程、深度学习路径、交互式编码环境以及来自 O’Reilly 和其他 200 多个出版商的大量文本和视频。欲了解更多信息，请访问[*http://oreilly.com*](http://oreilly.com)。

# 如何联系我们

请将关于本书的评论和问题发送至出版商：

+   O’Reilly Media, Inc.

+   1005 Gravenstein Highway North

+   Sebastopol, CA 95472

+   800-998-9938（美国或加拿大）

+   707-829-0515（国际或本地）

+   707-829-0104（传真）

我们为本书设置了一个网页，列出勘误、示例和任何额外信息。您可以访问[*https://oreil.ly/sql-data-analysis*](https://oreil.ly/sql-data-analysis)。

通过电子邮件*bookquestions@oreilly.com*进行有关本书的评论或技术问题询问。

有关我们的图书和课程的新闻和信息，请访问[*http://oreilly.com*](http://oreilly.com)。

在 Facebook 上找到我们：[*http://facebook.com/oreilly*](http://facebook.com/oreilly)

关注我们的 Twitter 账号：[*http://twitter.com/oreillymedia*](http://twitter.com/oreillymedia)

在 YouTube 上观看我们：[*http://www.youtube.com/oreillymedia*](http://www.youtube.com/oreillymedia)

# 致谢

这本书的完成离不开 O'Reilly 的许多人的努力。Andy Kwan 邀请我参与这个项目。Amelia Blevins 和 Shira Evans 指导了我整个过程，并提供了有益的反馈意见。Kristen Brown 负责推动书的生产过程。Arthur Johnson 提升了文本的质量和清晰度，并让我对 SQL 关键词有了更深入的思考。

多年来，许多同事在我学习 SQL 的旅程中起到了重要作用，我感激他们的教程、技巧和分享的代码，以及多年来一起头脑风暴解决分析问题的时光。Sharon Lin 让我看到了正则表达式的魅力。Elyse Gordon 给了我许多写书的建议。Dave Hoch 和我们关于实验分析的对话启发了第七章。Star Chamber 的 Dan、Jim 和 Stu 一直是我最喜欢的技术狂人。我也感激多年来提出艰难问题的所有同事们——当这些问题得到回答后，他们又提出了更艰难的问题。

我要感谢我的丈夫 Rick，儿子 Shea，女儿们 Lily 和 Fiona，以及妈妈 Janet，他们给予了我爱和鼓励，最重要的是给了我时间完成这本书。Amy、Halle、Jessi 和 Slack 的这群人在我写作和疫情封锁的几个月里保持了我的理智和欢笑。
