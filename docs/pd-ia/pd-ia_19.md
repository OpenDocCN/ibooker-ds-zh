# 附录 C. NumPy 快速入门

开源 NumPy（数值 Python）库是 pandas 的依赖项，它公开了一个强大的`ndarray`对象，用于存储同质、*n*-维数组。这听起来有点复杂，所以让我们分解一下。*数组*是有序值集合，类似于 Python 列表。*同质*意味着数组中的值具有相同的数据类型。*n*-维意味着数组可以持有任意数量的维度。（我们将在 C.1 节中讨论维度。）NumPy 是由数据科学家 Travis Oliphant 开发的，他创立了 Anaconda 公司，该公司构建了我们用来设置开发环境的 Python 发行版。

我们可以使用 NumPy 生成任何大小和形状的随机数据集；事实上，官方的 pandas 文档广泛地这样做。对库的基本了解将有助于我们更好地理解 pandas 的底层机制。

## C.1 维度

*维度*指的是从数据结构中提取单个值所需的参考点数量。考虑一个给定日期多个城市温度的集合：

|  | 温度 |
| --- | --- |
| 纽约 | 38 |
| 芝加哥 | 36 |
| 旧金山 | 51 |
| 迈阿密 | 73 |

如果我要求您在这个数据集中查找一个特定的温度，您只需要一个参考点：城市的名称（例如“旧金山”）或其顺序（例如“列表中的第三个城市”）。因此，这个表格描述了一个一维数据集。

将此表与多个城市在多个日子温度的数据集进行比较：

|  | 星期一 | 星期二 | 星期三 | 星期四 | 星期五 |
| --- | --- | --- | --- | --- | --- |
| 纽约 | 38 | 41 | 35 | 32 | 35 |
| 芝加哥 | 36 | 39 | 31 | 27 | 25 |
| 旧金山 | 51 | 52 | 50 | 49 | 53 |
| 迈阿密 | 73 | 74 | 72 | 71 | 74 |

现在您需要多少个参考点才能从这个数据集中提取一个特定的值？答案是 2。我们需要一个城市和一周中的某一天（例如“星期四的旧金山”）或行号和列号（例如“第 3 行第 4 列”）。城市或工作日本身不足以作为标识符，因为它们都与数据集中的多个值相关联。城市和工作日的组合（或等价的行和列）将结果过滤到一个值；因此，这个数据集是二维的。

数据集的行数和列数不影响其维度数。一个有 100 万行和 100 万列的表格仍然是二维的。我们仍然需要一个行位置和列位置的组合来提取一个值。

每增加一个参考点，就增加一个维度。我们可能会收集两周的温度数据：

第一周

|  | 星期一 | 星期二 | 星期三 | 星期四 | 星期五 |
| --- | --- | --- | --- | --- | --- |
| 纽约 | 38 | 41 | 35 | 32 | 35 |
| 芝加哥 | 36 | 39 | 31 | 27 | 25 |
| 旧金山 | 51 | 52 | 50 | 49 | 53 |
| 迈阿密 | 73 | 74 | 72 | 71 | 74 |

第二周

|  | 星期一 | 星期二 | 星期三 | 星期四 | 星期五 |
| --- | --- | --- | --- | --- | --- |
| 纽约 | 40 | 42 | 38 | 36 | 28 |
| 芝加哥 | 32 | 28 | 25 | 31 | 25 |
| 旧金山 | 49 | 55 | 54 | 51 | 48 |
| 迈阿密 | 75 | 78 | 73 | 76 | 71 |

城市和星期几已不再足够提取单个值。我们现在需要三个参考点（星期、城市和日期），因此我们可以将这个数据集分类为三维的。

## C.2 ndarray 对象

让我们先创建一个新的 Jupyter Notebook 并导入 NumPy 库，该库通常被分配别名`np`：

```
In  [1] import numpy as np
```

NumPy 擅长生成随机和非随机数据。让我们从一项简单的挑战开始：创建一个连续的数字范围。

### C.2.1 使用 arange 方法生成数字范围

`arange`函数返回一个一维`ndarray`对象，包含一系列连续的数值。当我们用单个参数调用`arange`时，NumPy 将`0`设置为下限，范围开始的位置。第一个参数将设置上限，范围结束的数字。上限是不包含的；NumPy 将到达那个值但不包括它。例如，一个`3`的参数将产生一个包含值`0`、`1`和`2`的`ndarray`：

```
In  [2] np.arange(3)

Out [2] array([0, 1, 2])
```

我们也可以向`arange`传递两个参数，这将声明范围的上下限。下限是包含的；范围将包括其值。端点是不包含的。在下一个示例中，请注意 NumPy 包含`2`但不包含`6`：

```
In  [3] np.arange(2, 6)

Out [3] array([2, 3, 4, 5])
```

`arange`的前两个参数对应于`start`和`stop`关键字参数。我们可以明确写出关键字参数。前面的和后面的代码示例产生相同的数组：

```
In  [4] np.arange(start = 2, stop = 6)

Out [4] array([2, 3, 4, 5])
```

`arange`函数的可选第三个参数`step`设置两个值之间的间隔。从数学的角度来考虑这个概念可能会有所帮助。从下限开始，并加上间隔值，直到达到上限。下一个示例创建一个从`0`到`111`（不包含）的间隔为 10 的范围：

```
In  [5] np.arange(start = 0, stop = 111, step = 10)

Out [5] array([  0,  10,  20,  30,  40,  50,  60,  70,  80,  90, 100, 110])
```

让我们将最后一个`ndarray`保存到`tens`变量中：

```
In  [6] tens = np.arange(start = 0, stop = 111, step = 10)
```

现在`tens`变量指向一个包含 12 个数字的`ndarray`对象。

### C.2.2 ndarray 对象上的属性

NumPy 库的`ndarray`对象有一套自己的属性和方法。作为提醒，*属性*是属于对象的数据的一部分。*方法*是我们可以向对象发送的命令。

`shape`属性返回一个元组，包含数组的维度。`shape`元组的长度等于`ndarray`的维度数。以下输出表明`tens`是一个包含 12 个值的一维数组：

```
In  [7] tens.shape

Out [7] (12,)
```

我们还可以使用`ndim`属性来询问`ndarray`的维度数：

```
In  [8] tens.ndim

Out [8] 1
```

`size`属性返回数组中的元素数量：

```
In  [9] tens.size

Out [9] 12
```

接下来，让我们看看我们如何可以操作数组中 12 个元素的形状。

### C.2.3 reshape 方法

目前，我们的 12 个元素的`tens` `ndarray`是一维的。我们可以通过一个参考点访问任何元素，即它在数组中的位置：

```
In  [10] tens

Out [10] array([  0,  10,  20,  30,  40,  50,  60,  70,  80,  90, 100,
         110])
```

我们可能想要将现有的一个维度数组转换成具有不同形状的多维度数组。假设我们的 12 个值代表在 4 天内捕获的 3 次每日测量值。在 4 x 3 的形状中思考数据比在 12 x 1 的形状中更容易。

`reshape` 方法使用其参数返回具有指定形状的新 `ndarray` 对象。下一个示例将 `tens` 变形为一个新的二维数组，具有 4 行 3 列：

```
In  [11] tens.reshape(4, 3)

Out [11] array([[  0,  10,  20],
                [ 30,  40,  50],
                [ 60,  70,  80],
                [ 90, 100, 110]])
```

传递给 `reshape` 的参数数量将等于新 `ndarray` 的维度数：

```
In  [12] tens.reshape(4, 3).ndim

Out [12] 2
```

我们必须确保参数的乘积等于原始数组中的元素数量。值 4 和 3 是有效的参数，因为它们的乘积是 12，而 `tens` 有 12 个值。另一个有效示例是具有 2 行 6 列的二维数组：

```
In  [13] tens.reshape(2, 6)

Out [13] array([[  5,  15,  25,  35,  45,  55],
                [ 65,  75,  85,  95, 105, 115]])
```

如果 NumPy 无法将原始数组变形为所需的形状，则会引发 `ValueError` 异常。在下一个示例中，库无法将 `tens` 中的 12 个值拟合到 2 x 5 的数组中：

```
In  [14] tens.reshape(2, 5)

Out [14]

---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-68-5b9588276555> in <module>
----> 1 tens.reshape(2, 5)

ValueError: cannot reshape array of size 12 into shape (2,5)
```

`ndarray` 能否存储超过两个维度的数据？当然可以。让我们通过传递第三个参数给 `reshape` 来看看它是如何工作的。下一个示例将一维的 `tens` 数组形状调整为 2 x 3 x 2 的三维数组：

```
In  [15] tens.reshape(2, 3, 2)

Out [15] array([[[  5,  15],
                 [ 25,  35],
                 [ 45,  55]],

                [[ 65,  75],
                 [ 85,  95],
                 [105, 115]]])
```

让我们访问新数组上的 `ndim` 属性。数据结构确实有三个维度：

```
In  [16] tens.reshape(2, 3, 2).ndim

Out [16] 3
```

我们也可以传递 `-1` 作为 `reshape` 的参数来表示一个未知维度。NumPy 将推断出在该维度中填充的正确值数。下一个示例传递了 `2` 和 `-1` 作为参数。NumPy 计算出新的二维数组应该具有 2 x 6 的形状：

```
In  [17] tens.reshape(2, -1)

Out [17] array([[  0,  10,  20,  30,  40,  50],
                [ 60,  70,  80,  90, 100, 110]])
```

在下一个示例中，库计算返回的 `ndarray` 应该具有 2 x 3 x 2 的形状：

```
In  [18] tens.reshape(2, -1, 2)

Out [18] array([[[  0,  10],
                 [ 20,  30],
                 [ 40,  50]],

                [[ 60,  70],
                 [ 80,  90],
                 [100, 110]]])
```

我们只能将一个未知维度传递给 `reshape` 方法调用。

`reshape` 方法返回一个新的 `ndarray` 对象。原始数组不会被修改。因此，我们的 `tens` 数组仍然保持其原始的 1 x 12 形状。

### C.2.4 `randint` 函数

`randint` 函数生成一个或多个介于某个范围内的随机数。当传递单个参数时，它返回一个介于 `0` 到该值之间的随机整数。下一个示例返回一个介于 `0` 和 `5`（不包括 `5`）之间的随机值：

```
In  [19] np.random.randint(5)

Out [19] 3
```

我们可以向 `randint` 传递两个参数来声明一个包含下限（包括）和上限（不包括）的范围。NumPy 将在该范围内选择一个数字：

```
In  [20] np.random.randint(1, 10)

Out [20] 9
```

如果我们想要生成一个随机整数数组呢？我们可以传递第三个参数给 `randint` 来指定所需的数组形状。我们可以传递一个单个整数或一个单元素列表来创建一个一维数组：

```
In  [21] np.random.randint(1, 10, 3)

Out [21] array([4, 6, 3])

In  [22] np.random.randint(1, 10, [3])

Out [22] array([9, 1, 6])
```

要创建一个多维 `ndarray`，我们传递一个列表来指定每个维度中的值数。以下示例填充了一个 3 x 5 的二维数组，其中的值介于 `1` 和 `10`（不包括 `10`）之间：

```
In  [23] np.random.randint(1, 10, [3, 5])

Out [23] array([[2, 9, 8, 8, 7],
                [9, 8, 7, 3, 2],
                [4, 4, 5, 3, 9]])
```

你可以在列表中提供任意数量的值来创建具有更多维度的 `ndarrays`。例如，一个包含三个值的列表将创建一个三维数组。

### C.2.5 `randn` 函数

`randn` 函数返回一个包含从标准正态分布中随机值的 `ndarray`。函数的每个连续参数设置一个维度中要存储的值的数量。如果我们传递一个参数，`ndarray` 将有一个维度。下一个示例创建了一个 1 x 3（1 行 3 列）的数组：

```
In  [24] np.random.randn(3)

Out [24] array([-1.04474993,  0.46965268, -0.74204863])
```

如果我们向 `randn` 函数传递两个参数，`ndarray` 将有两个维度，依此类推。下一个示例创建了一个 2 x 4 的二维数组：

```
In  [25] np.random.randn(2, 4)

Out [25] array([[-0.35139565,  1.15677736,  1.90854535,  0.66070779],
                [-0.02940895, -0.86612595,  1.41188378, -1.20965709]])
```

下一个示例创建了一个形状为 2 x 4 x 3 的三维数组。我们可以将这个形状视为两个数据集，每个数据集都有四行和三列：

```
In  [26] np.random.randn(2, 4, 3)

Out [26] array([[[ 0.38281118,  0.54459183,  1.49719148],
                 [-0.03987083,  0.42543538,  0.11534431],
                 [-1.38462105,  1.54316814,  1.26342648],
                 [ 0.6256691 ,  0.51487132,  0.40268548]],

                [[-0.24774185, -0.64730832,  1.65089833],
                 [ 0.30635744,  0.21157744, -0.5644958 ],
                 [ 0.35393732,  1.80357335,  0.63604068],
                 [-1.5123853 ,  1.20420021,  0.22183476]]])
```

`rand` 函数族是生成虚假数值数据的一个惊人的方法。我们还可以创建不同类型和类别的虚假数据，例如姓名、地址或信用卡。有关该主题的更多信息，请参阅附录 D。

## C.3 `nan` 对象

NumPy 库使用一个特殊的 `nan` 对象来表示缺失或无效的值。缩写 `nan` 代表 *not a number*，这是一个通用的通用术语，用于表示缺失数据。在我们将包含缺失值的数据集导入 pandas 的过程中，本书中会频繁地遇到 `nan`。目前，我们可以直接通过 `np` 包的顶层属性访问 `nan` 对象：

```
In  [27] np.nan

Out [27] nan
```

一个 `nan` 对象不等于任何值：

```
In  [28] np.nan == 5

Out [28] False
```

一个 `nan` 值也不等于另一个 `nan`。从 NumPy 的角度来看，`nan` 值是缺失或缺失的。我们不能确定它们是否相同，所以我们假设它们是不同的。

```
In  [29] np.nan == np.nan

Out [29] False
```

就这些了！这些是关于 NumPy 库最重要的细节，pandas 在其底层使用它。

在你的空闲时间，浏览一下 pandas 文档（[`pandas.pydata.org/docs/user_guide/10min.html`](https://pandas.pydata.org/docs/user_guide/10min.html)）。你可能会看到许多使用 NumPy 生成随机数据的示例。
