# 第五章。数据分析堆栈

到本书的这一部分，你已经精通分析的关键原则和方法，在Excel中学习了它们。这一章作为本书后续部分的插曲，你将把这些已有的知识转化为使用R和Python。

本章将进一步说明统计学、数据分析和数据科学的学科，并深入探讨Excel、R和Python如何在我称之为*数据分析堆栈*中发挥作用。

# 统计学与数据分析与数据科学

本书的重点是帮助你掌握数据分析的原则。但正如你所见，统计学对分析非常核心，以至于很难界定一个领域的结束和另一个的开始。为了加深困惑，你可能还对数据科学如何融入其中感兴趣。让我们花一点时间来明确这些区别。

## 统计学

统计学首先关注收集、分析和呈现数据的方法。我们从该领域借用了*很多*，例如，我们根据样本对总体做出推断，并使用直方图和散点图等图表描述数据的分布和关系。

到目前为止，我们使用的大多数测试和技术都来自统计学，例如线性回归和独立样本t检验。数据分析与统计学的区别不一定在于*方法*，而在于*目的*。

## 数据分析

在数据分析中，我们不太关心分析数据的方法，而更关心使用结果来达到某些外部目标。这些目标可以是不同的：例如，你已经看到，虽然一些关系可能在统计上显著，但它们对业务可能没有实质性的意义。

数据分析也关注实施这些洞察力所需的技术。例如，我们可能需要清洗数据集、设计仪表板，并迅速高效地传播这些资产。尽管本书的重点是分析的*统计*基础，但还有其他*计算*和*技术*基础需要注意，这些将在本章后面讨论。

## 商业分析

特别是，数据分析用于指导和实现业务目标，协助业务利益相关者；分析专业人员通常既参与业务运营，又参与信息技术。术语*商业分析*经常用来描述这种职责的结合。

一个数据或商业分析项目的例子可能是分析电影租赁数据。基于探索性数据分析，分析师可能假设喜剧片在假日周末销售特别好。与产品经理或其他业务利益相关者合作，他们可能会进行小型实验来收集并进一步测试这一假设。这个工作流程的要素应该从本书的前几章中听起来很熟悉。

## 数据科学

最后，还有数据科学：另一个与统计学有不可分割联系的领域，但专注于独特的结果。

数据科学家在工作中通常也会考虑业务目标，但其范围与数据分析有很大不同。回到我们的电影租赁例子，数据科学家可能会构建一个基于算法的系统，根据与他们相似的顾客租用的电影来推荐电影给个人。构建和部署这样的系统需要相当的工程技能。虽然说数据科学家与业务没有真正的联系是不公平的，但他们通常与工程或信息技术更加密切相关。

## 机器学习

总结这种区别，我们可以说，数据分析关注于*描述*和*解释*数据关系，而数据科学则关注于构建*预测*系统和产品，通常使用机器学习技术。

*机器学习*是构建算法的实践，这些算法通过更多数据的输入而改进，而无需明确编程来做到这一点。例如，银行可能会部署机器学习来检测客户是否会违约。随着输入更多数据，算法可能会在数据中找到模式和关系，并用它们来更好地预测违约的可能性。机器学习模型可以提供令人难以置信的预测准确性，并且可以在各种场景中使用。尽管如此，构建复杂的机器学习算法往往很诱人，但简单的算法足以胜任，这可能导致难以解释和依赖模型。

机器学习超出了本书的范围；要了解一个很棒的概述，请查看Aurélien Géron的[*《Python深度学习》*](https://oreil.ly/nHMsC)，第二版（O'Reilly）。这本书主要使用Python编写，所以最好先完成本书的[第三部分](part03.html#part-3)。

## 有别于但不排斥

尽管统计学、数据分析和数据科学之间的区别很重要，但我们不应让它们产生不必要的边界。在任何这些学科中，分类和连续依赖变量之间的差异都是有意义的。所有这些都使用假设检验来构建问题。我们应感谢统计学，因为它使我们能够用通俗的术语处理数据。

数据分析和数据科学角色常常交错。事实上，在本书中，你已经学习了核心数据科学技术的基础：线性回归。简言之，这些领域的联系远比分歧多。尽管本书侧重于数据分析，但你已经准备好探索它们所有；一旦学习了R和Python，你将更加深入地理解它们。

现在，我们已经用统计学和数据科学的语境来解释了数据分析，让我们为Excel、R、Python和其他你可能在分析中学习的工具做同样的事情。

# 数据分析堆栈的重要性

在了解任何单一工具的技术知识之前，分析专业人士应具备根据每个工具的优缺点选择和配对*不同*工具的能力。

网页开发者或数据库管理员常常提到他们用来完成工作的“堆栈”工具。我们可以借鉴这个概念来帮助进行数据分析。当某个工具或“堆栈”的一部分不足时，重点不应该是责备它的不足，而是选择不同的工具或不同的“堆栈”。换句话说，我们应该把这些不同的“堆栈”看作是互补而不是替代品。

[图5-1](#data-analytics-stack-image)是我对数据分析堆栈的四个切片的概念化。这只是组织中使用的数据工具的一个极度简化版本；绘制端到端的分析管道可能会变得复杂。这些切片按照数据由信息技术部门存储和维护的地方（数据库）到由业务终端用户使用和探索的地方（电子表格）的顺序排列。这些切片可以一起使用来制定解决方案。

![数据分析堆栈](assets/aina_0501.png)

###### 图5-1\. 数据分析堆栈

让我们花些时间来探索堆栈的每个切片。我会从对典型读者最熟悉到最不熟悉的顺序来介绍这些切片。

## 电子表格

我不会花太多时间来介绍电子表格是什么以及它们的工作原理；你现在对它们已经非常熟悉了。这些原则也适用于其他电子表格应用程序，如Google表格、LibreOffice等；在本书中我们专注于Excel，所以我会在这里强调它。你已经看到电子表格可以将分析活跃起来，并且是探索性数据分析的好工具。这种易用性和灵活性使得电子表格成为向最终用户分发数据的理想工具。

但这种灵活性既是优点也是缺点。你是否曾经建立过一个电子表格模型，你最终得出一个数字，几个小时后重新打开文件却莫名其妙地得到了另一个数字？有时候感觉就像在电子表格中玩打地鼠游戏；很难隔离分析的某一层而不影响其他层。

一个设计良好的数据产品看起来类似于图5-2所示的内容：

+   原始数据是由分析完全独立和未经处理的。

+   然后数据经过必要的清理和分析处理。

+   任何生成的图表或表格都是孤立的输出。

![输入、处理、输出](assets/aina_0502.png)

###### 图5-2\. 输入、处理、输出

尽管在电子表格中有原则要遵循这种方法，但这些层往往变成一锅杂乱的汤：用户可能直接在原始数据上写入，或者在计算堆叠计算的基础上构建计算，达到这样一个程度：很难追踪指向特定单元格的所有引用。即使有一个坚实的工作簿设计，也很难实现输入-处理-输出模型的最终目标，即*可重现性*。这里的思想是，给定相同的输入和处理，每次都会获得相同的输出。显然，当由于容易出错的步骤、笨拙的计算或其他原因，无法保证每次打开文件时都会获得相同的结果时，工作簿就不可重现。

混乱或不可重现的工作簿已经在从食品服务到金融监管的各个领域引发了恐怖故事：要了解令人恐惧的概况，请查看[欧洲电子表格风险兴趣小组](https://oreil.ly/gWWw3)的这篇文章。也许你所做的分析并不像交易债券或发表具有开创性的学术研究那样具有高风险。但没有人喜欢缓慢、容易出错并产生不可靠结果的过程。但是，足够多的末日预言；正如我希望不断强调的那样，Excel和其他电子表格在分析中有其合适的位置。让我们看看一些有助于在Excel中构建清洁、可重现工作流程的工具。

### VBA

通常情况下，通过将分析的每个步骤记录为代码来实现计算的可重现性，这些代码可以保存并在以后快速重新执行。Excel确实有一个内置的编程语言Visual Basic for Applications (VBA)。

尽管VBA确实允许将过程记录为代码，但它缺乏许多完整统计编程语言的功能：特别是专业分析的大量免费包。此外，微软已经基本上放弃了VBA，将资源转移到其新的Office Scripts语言上，作为内置的Excel自动化工具，以及JavaScript和Python（如果传言属实的话）。

### 现代 Excel

我将使用这个术语来指代微软从Excel 2010开始向Excel发布的围绕商业智能(BI)的一系列工具。这些工具非常强大且易于使用，它们打破了关于Excel可以做什么和不能做什么的许多神话。让我们来看看构成现代 Excel 的三个应用程序：

+   Power Query是一种从各种来源提取数据、转换数据，然后加载到Excel中的工具。这些数据源可以是*.csv*文件，也可以是关系数据库，并且可以包含许多百万条记录：虽然仍然可能是真的，即使Excel工作簿本身只能包含大约一百万行，但如果通过Power Query读取，它可以包含超过该限制的几倍。

    更好的是，Power Query 借助微软的 M 编程语言 *完全可复现*。用户可以通过菜单添加和编辑步骤，生成 M 代码，或者自己编写代码。Power Query 是 Excel 的一大亮点；它不仅打破了先前对工作簿数据流量限制的约束，还使得数据的检索和操作完全可复现。

+   Power Pivot 是 Excel 的关系数据建模工具。我们将在本章稍后讨论关系数据模型时，深入了解它们。

+   最后，Power View 是在 Excel 中创建交互式图表和可视化的工具。这对构建仪表板特别有帮助。

如果你的角色高度依赖于 Excel 进行分析和报告，我强烈建议你花些时间了解现代 Excel。关于 Excel 的很多负面声音，比如不能处理超过百万行数据或无法处理多样化数据源，这些说法在最新版本中都已不再成立。

尽管如此，这些工具并不一定是用来进行统计分析的，而是在其他分析角色中提供帮助，比如构建报告和传播数据。幸运的是，通过与像 R 和 Python 这样的工具混合使用，可以在 Power Query 和 Power Pivot 的基础上构建出色的数据产品。

尽管 Excel 在演进过程中带来了诸多好处，但由于过度使用可能导致的不幸，它在分析界并不受欢迎。这让我们不禁要问：*为什么 Excel 首先会被过度使用呢？* 因为商业用户缺乏更好的替代方案和资源，所以他们将其视为一个直观、灵活的存储和分析数据的工具。

我认为，如果你无法击败他们，那就加入他们：Excel *是* 一个探索和与数据互动的好工具。甚至，借助其最新的功能，它已成为构建可复现的数据清洗工作流程和关系数据模型的重要工具。但是，有些分析功能并不是 Excel 擅长的，比如存储关键数据、在多平台上分发仪表板和报告，以及进行高级统计分析。对于这些功能，让我们来看看其他选择。

## 数据库

数据库，特别是 *关系型* 数据库，在分析领域算是相对古老的技术，起源可以追溯到上世纪70年代初。关系数据库的基本构建单元是你之前见过的东西：*表格*。[图 5-3](#database-table) 就是这样一个例子：我们已经用统计术语 *变量* 和 *观测* 来指代这样一个表格的列和行。它们在数据库的语言中分别称为 *字段* 和 *记录*。

![数据分析技术栈](assets/aina_0503.png)

###### 图 5-3\. 标记的数据库表

如果你被要求连接[图5-4](#data-relationships)中的数据，你可以使用Excel的`VLOOKUP()`函数，使用共享列作为“查找字段”从一个表传输数据到另一个表。这方面还有很多内容，但这是*关系数据模型*的核心：通过表之间的关系来有效存储和管理数据。我喜欢称呼`VLOOKUP()`为Excel的*胶带*，因为它能够连接数据集。如果`VLOOKUP()`是胶带，那么关系数据模型就是焊接工。

![关系数据库中字段和表之间的关系](assets/aina_0504.png)

###### 图5-4\. 关系数据库中字段和表之间的关系

关系数据库管理系统（Relational Database Management System，RDBMS）旨在利用这一基本概念进行大规模数据存储和检索。当你在商店下订单或者订阅邮件列表时，数据很可能会经过RDBMS。虽然建立在相同的概念上，但Power Pivot的用例更多地用于商业智能分析和报告，而不是全功能的RDBMS。

结构化查询语言（Structured Query Language，或SQL）传统上用于与数据库进行交互。这是分析领域中另一个至关重要的主题，超出了我们书本的范围；如果想要一个很好的介绍，请查看艾伦·博洛的《[*学习 SQL*](https://oreil.ly/UvnI5)》，第三版（O’Reilly）。请记住，“SQL”（或“sequel”）作为语言名称通常被泛用，根据感兴趣的关系数据库管理系统（RDBMS），存在多个“方言”。像微软或者甲骨文等一些系统是专有的；而像PostgreSQL或SQLite这样的系统则是开源的。

SQL可以执行的经典操作的首字母缩写是*CRUD*，即Create、Read、Update、Delete。作为数据分析师，你最典型地会涉及从数据库中*读取*数据，而不是更改它。对于这些操作，不同平台上SQL方言的差异将是微不足道的。

## 商业智能平台

这是一系列工具中涵盖最广泛、可能也是最模糊的一部分。在这里，我指的是企业工具，允许用户收集、建模和显示数据。数据仓库工具如MicroStrategy和SAP BusinessObjects在这里有所涉及，因为它们是为自助式数据收集和分析而设计的工具。但是它们通常在可视化和交互式仪表盘构建方面有所限制。

这就是像Power BI、Tableau和Looker这样的工具派上用场的地方。这些几乎都是专有的平台，允许用户使用最少的编码来构建数据模型、仪表盘和报告。重要的是，它们使得跨组织传播和更新信息变得容易；这些资源通常甚至以各种格式部署到平板电脑和智能手机上。许多组织已将其例行报告和仪表盘创建从电子表格转移到这些商业智能工具中。

尽管商业智能平台有诸多优点，但它们在处理和可视化数据的方式上往往缺乏灵活性。为了简单适用于业务用户且难以破解，它们通常缺乏老练的数据分析人员在任务中所需的功能。此外，它们也可能价格昂贵，单用户年许可证的价格可能高达几百甚至几千美元。

根据你对 Excel 的了解，值得指出的是，现代 Excel 的元素（Power Query、Power Pivot、Power View）也适用于 Power BI。更重要的是，可以使用 R 和 Python 代码在 Power BI 中构建可视化。其他商业智能系统也具有类似的功能；我之前专注于 Excel，现在转向 Power BI。

## 数据编程语言

这就带我们来到最后一个方面：数据编程语言。我指的是完全由脚本编写的用于数据分析的软件应用程序。许多分析专家在他们的工具栈中没有这一部分也能做出卓越的工作。此外，许多供应商工具正朝着低代码或无代码解决方案迈进，用于复杂的分析。

尽管如此，我强烈建议你学习编程。这将增强你对数据处理工作原理的理解，并使你对工作流程具有比依赖图形用户界面（GUI）或点对点软件更全面的控制。

对于数据分析，两种开源编程语言非常适合：R 和 Python，因此本书的其余部分重点介绍这两种语言。每种语言都包含大量免费的包，旨在帮助处理从社交媒体自动化到地理空间分析的各种任务。学习这些语言将打开进入高级分析和数据科学领域的大门。如果你认为 Excel 是探索和分析数据的强大工具，那么等你掌握了 R 和 Python 的技巧之后，你会发现更强大的功能。

此外，这些工具非常适合可重现的研究。回想一下[图 5-2](#input-process-output)和我们在 Excel 中分步骤分析中发现的困难。作为编程语言，R 和 Python 记录了分析中采取的所有步骤。这种工作流程通过首先从外部源读取数据，*然后*在该数据的副本上操作，保持了原始数据的完整性。该工作流程还使跟踪文件的更改和贡献变得更容易，这个过程被称为*版本控制*，将在[第 14 章](ch14.html#conclusion)中讨论。

R 和 Python 是开源软件应用程序，这意味着它们的源代码对任何人都是自由可用的，可以进行构建、分发或贡献。这与专有的 Excel 完全不同。开源和专有系统各有其优缺点。在 R 和 Python 的情况下，允许任何人在源代码上自由开发已经促进了丰富的包和应用程序生态系统的形成。这也降低了新手参与的门槛。

尽管如此，我们常常发现关键的开源基础设施部分是由开发者在业余时间中免费维护的。依赖于没有商业保证的基础设施的持续发展和维护可能并不理想。有办法来减少这种风险；实际上，许多公司专门支持、维护和增强开源系统。你将在我们后续关于R和Python的讨论中看到这种关系；也许你会感到惊讶，通过提供基于自由可用代码的服务是完全可能赚钱的。

栈中的“数据编程语言”部分可能具有最陡的学习曲线：毕竟，这实际上是在学习一门新语言。学习*一个*这样的语言可能听起来像是一种挑战，那么你将如何学习两种呢？

首先，在本书开头我们提到过，你并不是从零开始。你已经有了扎实的编程和数据处理知识。所以，要淡定地接受你确实已经学会了如何编码……某种程度上。

###### 小贴士

对于数据编程语言，多语言能力是有好处的，就像口头语言一样。在实际层面上，雇主可能会使用其中任何一种，所以涵盖多个领域是明智的。但你学习两者不只是为了打勾：每种语言都有其独特的特点，你可能会发现在特定用例中更容易使用其中一种。正如考虑到栈的不同部分是互补而不是替代品一样，对于同一部分的工具也是如此。

# 结论

数据分析师常常在犹豫他们应该专注学习或成为专家的工具。我建议不要成为任何一个单一工具的专家，而是要足够熟悉每个栈的不同工具，以便进行上下文化和选择。从这个角度看，声称一个栈的一部分低于另一个栈是没有多少意义的。它们应该是互补而不是替代品。

实际上，许多最强大的分析产品来自于*组合*栈的部分。例如，你可以使用Python自动化生成基于Excel的报告，或者从关系数据库管理系统中提取数据到BI平台的仪表板中。虽然这些用例超出了本书的范围，但对我们的讨论来说，重点是：*不要忽视Excel*。你在R和Python中的技能只会为Excel的价值栈增添力量。

在本书中，我们专注于电子表格（Excel）和数据编程语言（R和Python）。这些工具特别适用于数据分析的统计角色，正如我们讨论过的，它们与传统统计学和数据科学有一定的重叠。但正如我们也讨论过的那样，分析不仅涉及纯粹的统计分析，关系数据库和BI工具对这些任务也很有帮助。一旦你熟悉了本书中的主题，请考虑用我在本章早些时候提到的标题来丰富你的数据分析堆栈知识。

# 接下来是什么

思考数据分析和数据分析应用的大局观后，让我们深入探索新工具。

我们将从R开始，因为我认为对Excel用户来说，它更自然地跳入数据编程的起点。你将学会如何用R进行与Excel相同的EDA和假设检验，这将使你在更高级的分析中处于一个很好的位置。然后你将用Python做同样的事情。在每个阶段，我将帮助你将所学的与已知的联系起来，这样你就能看到许多概念实际上是多么熟悉。我们在[第6章](ch06.html#first-steps-r)再见。

# 练习

本章比较概念化，没有练习。我鼓励你在拓展到其他分析领域并将它们联系起来时再回顾这一章节。当你在工作中或浏览社交媒体或行业出版物时遇到新的数据工具，请问自己它涵盖哪些堆栈，是否开源等等。
