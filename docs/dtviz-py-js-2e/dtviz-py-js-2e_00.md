# 序言

本书的首要目标是描述一种数据可视化（dataviz）工具链，在互联网时代开始主导。这个工具链的指导原则是，无论您从数据中挖掘出多少见解，都应该在Web浏览器上找到它们的家园。在Web上意味着您可以轻松选择将您的dataviz分发给少数人（使用身份验证或限制在本地网络）或整个世界。这是互联网的重大理念，也是dataviz正在快速接受的理念。这意味着dataviz的未来涉及JavaScript，这是Web浏览器唯一的一级语言。但JavaScript尚未具备处理原始数据所需的数据处理堆栈，这意味着数据可视化不可避免地是多语言的事务。我希望本书能够支持我的观点，即Python是JavaScript在浏览器可视化中的自然补充语言的支持者。

尽管这本书很庞大（这一事实现在作者最为深切地感受到），但它必须非常选择性地撰写，留出了许多真正酷炫的Python和JavaScript数据可视化工具，重点是那些提供最佳构建模块的工具。我未能覆盖的有用库的数量反映了Python和JavaScript数据科学生态系统的巨大活力。即使在书写过程中，也在不断推出出色的新Python和JavaScript库，并且这个步伐还在继续。

所有的数据可视化本质上都是转变的，展示从数据集的一种反映（HTML 表格和列表）到更现代、引人入胜、互动性更强、基本上是基于浏览器的方式，为工作环境中介绍关键数据可视化工具提供了一个很好的方式。挑战在于将基本的维基百科诺贝尔奖获奖者列表转化为现代、互动式、基于浏览器的可视化。因此，同样的数据集以更易访问、引人入胜的形式呈现。

从未加工的数据到相当丰富的用户驱动可视化的旅程，决定了选择最佳工具的方式。首先，我们需要获取我们的数据集。通常这是由同事或客户提供的，但为了增加挑战并学习一些非常重要的数据可视化技能，我们学习如何使用Python强大的Scrapy库从网络（维基百科的诺贝尔奖页面）*抓取*数据集。然后需要对这些未加工的数据集进行精炼和探索，而Python的pandas生态系统是最好的选择之一。连同Matplotlib的支持，并通过Jupyter笔记本驱动，pandas正成为这种法庭数据工作的黄金标准。随着干净的数据被存储（使用SQLAlchemy和SQLLite）和探索，可以将精心挑选的数据故事可视化。我介绍了使用Matplotlib和Plotly将Python生成的静态和动态图表嵌入网页的方法。但是对于更雄心勃勃的项目，基于JavaScript的D3是网页的终极数据可视化库。我们在使用D3的同时，探索了如何制作我们的招牌诺贝尔数据可视化作品。

本书是一个工具集合的集合，以创建诺贝尔奖可视化作品为引导叙事。如果需要时，您应该能够随时查阅相关章节；本书的不同部分都是独立的，因此您可以在需要时快速复习您学到的内容。

本书分为五个部分。第一部分介绍了基础的Python和JavaScript数据可视化工具包，而接下来的四部分展示了如何检索原始数据、清理数据、探索数据，最终将其转换为现代网络可视化。现在让我们总结每个部分的关键教训。

## 第一部分：基础工具包

我们的基础工具包包括：

+   一种连接Python和JavaScript的语言学习桥梁。这旨在平滑两种语言之间的过渡，突出它们的许多相似之处，并为现代数据可视化的双语过程铺平道路。随着最新JavaScript的出现^([1](preface01.xhtml#idm45607823284352))，Python和JavaScript之间有更多共同之处，使得在它们之间切换变得更少压力。

+   能够轻松读取和写入关键数据格式（例如JSON和CSV）和数据库（包括SQL和NoSQL）是Python的一大优势。我们看到在Python中传递数据的简易程度，可以在进行格式转换和数据库更改的同时移动数据。这种数据的流动是任何数据可视化工具链的主要润滑剂。

+   我们涵盖了开始制作现代、交互式、基于浏览器的数据可视化所需的基本网页开发（webdev）技能。通过专注于[单页应用程序](https://oreil.ly/yqv6C)的概念而不是构建整个网站，我们将传统的网页开发最小化，并将重点放在使用JavaScript编程您的可视化创作上。对可扩展矢量图形（SVG）的介绍，这是D3可视化的主要构建块，为我们在[第五部分](part05.xhtml#part_viz)中创建诺贝尔奖可视化做好了准备。

## 第二部分：获取您的数据

在本书的这一部分中，我们将看看如何使用Python从Web获取数据，假设数据可视化者没有提供一个好的、干净的数据文件：

+   如果你幸运的话，一个干净的文件以易于使用的数据格式（即JSON或CSV）出现在一个开放的URL上，只需简单的HTTP请求即可获得。或者，可能有一个专用的web API 用于您的数据集，有幸是一个符合REST原则的API。作为示例，我们将介绍如何使用Twitter API（通过Python的Tweepy库）。我们还将看到如何使用Google表格，这是数据可视化中广泛使用的数据共享资源。

+   当感兴趣的数据以人类可读形式出现在Web上时，情况就会变得更加复杂，通常以HTML表格、列表或分层内容块的形式存在。在这种情况下，您必须诉诸于*抓取*，获取原始HTML内容，然后使用解析器使其嵌入内容可用。我们将看到如何使用Python的轻量级Beautiful Soup抓取库以及功能更丰富、更重量级的Scrapy，这是Python抓取界的最大明星。

## 第三部分：使用pandas清理和探索数据

在这一部分中，我们将把pandas，Python强大的程序化电子表格，用于清理和探索数据集的问题。我们首先看到pandas是Python的NumPy生态系统的一部分，它利用了非常快速、功能强大的低级数组处理库的强大功能，同时使其易于访问。重点是使用pandas清理然后探索我们的诺贝尔奖数据集：

+   大多数数据，即使来自官方的Web API，也是脏的。使其变得干净和可用将占据您作为数据可视化者的时间，这可能比您预期的要多得多。以诺贝尔数据集为例，我们逐步清理它，寻找可疑的日期、异常的数据类型、缺失的字段以及所有需要在您开始探索和转换数据为可视化之前清理的常见污垢。

+   有了我们手头的干净（尽可能的）诺贝尔奖数据集，我们看到使用pandas和Matplotlib交互式地探索数据是多么容易，轻松创建内联图表，以各种方式切片数据，并一般地了解数据，同时寻找您想通过可视化呈现的那些有趣的信息。

## 第四部分：交付数据

在这部分中，我们看到使用Flask创建最小数据API是多么简单，以便静态地和动态地将数据传递到Web浏览器：

首先，我们看到如何使用Flask提供静态文件，然后如何自己制作基本数据API，从本地数据库中提供数据。Flask的简洁性使您能够在Python数据处理结果和它们最终在浏览器上可视化之间创建一个非常薄的数据服务层。

开源软件的优点在于，你通常可以找到比你自己解决问题更好的、易于使用的库。在本部分的第二章中，我们看到如何使用Python的最佳库（如Flask）轻松创建强大、灵活的RESTful API，准备好在网上提供你的数据。我们还介绍了如何使用Python爱好者喜爱的Heroku轻松在线部署这个数据服务器。

## 第五部分：使用D3和Plotly可视化您的数据

在本部分的第一章中，我们看到如何将你通过pandas驱动的探索所得的成果（如图表或地图）放在它们应该呆的地方——网页上。Matplotlib可以生成符合出版标准的静态图表，而Plotly则为用户提供了控制和动态图表的功能。我们看到如何直接从Jupyter笔记本中获取Plotly图表并将其放入网页中。

本书涵盖D3的部分是最具挑战性的，但你很可能最终会被雇佣来构建它所产生的多元素可视化。D3的乐趣之一在于可以轻松在网上找到[大量示例](https://oreil.ly/AIWkI)，但其中大多数示范了单一技术，很少展示如何编排多个视觉元素。在这些D3章节中，我们看到如何在用户过滤诺贝尔奖数据集或更改获奖指标（绝对或人均）时，同步更新时间线（显示所有诺贝尔奖）、地图、条形图和列表。

掌握这些章节中展示的核心主题应该能让你释放想象力，并通过实践学习。我建议选择一些与你心中有关的数据，并围绕它设计一个D3的作品。

# 第二版

当O’Reilly给我提供了撰写本书第二版的机会时，我有些犹豫。第一版的规模超出了预期，更新和扩展它可能需要大量工作。然而，经过审视所涉及的库的现状以及Python和JavaScript数据可视化生态系统的变化后，明显大部分使用的库（如Scrapy、NumPy、pandas）仍然是可靠的选择，只需要进行较小的更新。

D3是变化最大的库，但这些变化使D3更易于使用和教学。JavaScript模块也牢固地存在，使代码更清晰，更符合Python爱好者的习惯。

有几个Python库似乎不再是可靠的选择，其中一些已被弃用。第一版书中对MongoDB，一个NoSQL数据库进行了相当广泛的处理。我现在认为，传统的SQL更适合数据可视化工作，而最小的基于文件的、无服务器的SQLite如果需要数据库，则代表了数据可视化的一个甜蜜点。

不打算用另一个Python库替换已弃用的RESTful数据服务器，我认为从头开始构建一个简单的服务器会更有教育意义，演示一些出色的Python库的使用，比如marshmallow，这些库在许多数据可视化场景中非常有用。

利用更新书籍的时间，我决定使用第一版书中的数据集，演示如何使用Matplotlib和pandas进行探索和分析，并专注于将所有库更新到它们当前（截至2022年中）的版本。这使得有时间专注于新材料，其中最重要的是一章专门介绍Python的Plotly库，该库允许您轻松将探索性工作从Jupyter笔记本转移到具有用户交互的Web演示中。这种方法的一个特别优势是Mapbox地图的可用性，这是一个丰富的地图生态系统。

第二版的主要目标是：

+   使所有库保持最新。

+   以删除和/或替换未经时间考验的库。

+   通过Python和JavaScript数据可视化快速发展的世界中的变化建议添加一些新材料。

我认为数据可视化工具链的隐喻仍然适用，并且从未处理的原始网络数据到探索性数据可视化驱动的分析再到精美的网络可视化的转换流水线，仍然是学习这项工作的关键工具的良好方式。

# 本书使用的约定

本书使用以下排版约定：

*斜体*

指示新术语、网址、电子邮件地址、文件名和文件扩展名。

`Constant width`

用于程序列表，以及段落内引用程序元素，如变量或函数名、数据库、数据类型、环境变量、语句和关键字。

**`Constant width bold`**

显示用户应按字面意义输入的命令或其他文本。

*`Constant width italic`*

显示应由用户提供的值或由上下文确定的值替换的文本。

###### 提示

此元素表示提示或建议。

###### 注意

此元素表示一般说明。

###### 警告

此元素表示警告或注意。

# 使用代码示例

补充材料（代码示例、练习等）可从[*https://github.com/Kyrand/dataviz-with-python-and-js-ed-2*](https://github.com/Kyrand/dataviz-with-python-and-js-ed-2)下载。

这本书旨在帮助您完成工作。一般来说，如果此书提供示例代码，您可以在自己的程序和文档中使用它。除非您复制了大部分代码，否则无需征得我们的许可。例如，编写一个使用此书中多个代码片段的程序不需要许可。售卖或分发包含O'Reilly书籍示例的CD-ROM需要许可。引用本书并引用示例代码回答问题不需要许可。将此书的大量示例代码整合到您产品的文档中需要许可。

我们感谢您的赞誉，但并不要求署名。典型的署名通常包括标题、作者、出版商和ISBN。例如：“*使用Python和JavaScript进行数据可视化*，第二版，作者Kyran Dale（O'Reilly出版）。版权所有2023年Kyran Dale Limited，978-1-098-11187-8。”

如果您认为您使用的示例代码超出了合理使用或上述许可，请随时联系我们[*permissions@oreilly.com*](mailto:permissions@oreilly.com)。

# O'Reilly在线学习

###### 注意

40多年来，[*O'Reilly Media*](https://oreilly.com)提供技术和商业培训、知识和见解，帮助公司取得成功。

我们独特的专家和创新者网络通过书籍、文章以及我们的在线学习平台分享他们的知识和专长。O'Reilly的在线学习平台为您提供按需访问的现场培训课程、深入学习路径、交互式编码环境，以及来自O'Reilly和200多个其他出版商的大量文本和视频。有关更多信息，请访问[*https://oreilly.com*](https://oreilly.com)。

# 如何联系我们

请将有关此书的评论和问题发送至出版商：

+   O'Reilly Media, Inc.

+   1005 Gravenstein Highway North

+   Sebastopol, CA 95472

+   800-998-9938（美国或加拿大）

+   707-829-0515（国际或本地）

+   707-829-0104（传真）

我们为这本书创建了一个网页，列出勘误、示例和任何额外信息。您可以访问[*https://oreil.ly/dvpj_2e*](https://oreil.ly/dvpj_2e)。

发送电子邮件至[*bookquestions@oreilly.com*](mailto:bookquestions@oreilly.com)，以评论或询问有关本书的技术问题。

有关我们的书籍和课程的新闻和信息，请访问[*https://oreilly.com*](https://oreilly.com)。

在LinkedIn上找到我们：[*https://linkedin.com/company/oreilly-media*](https://linkedin.com/company/oreilly-media)

在Twitter上关注我们：[*https://twitter.com/oreillymedia*](https://twitter.com/oreillymedia)

在YouTube上观看我们：[*https://www.youtube.com/oreillymedia*](https://www.youtube.com/oreillymedia)

# 致谢

首先要感谢Meghan Blanchette，她开始推动这本书的进展，并在最初的艰难章节中起到了重要作用。接下来是Dawn Schanafelt掌舵并完成了大部分必要的编辑工作。Kristen Brown在出版过程中表现出色，得益于Gillian McGarvey顽强的剪辑工作。与如此才华横溢、敬业的专业人士一起工作是一种荣誉和特权——也是一种教育：如果当时我知道现在所知道的，写这本书就会容易得多。这不是一直都这样吗？

非常感谢Amy Zielinski使作者看起来比他应得的更好。

本书受益于一些非常有帮助的反馈。非常感谢Christophe Viau、Tom Parslow、Peter Cook、Ian Macinnes和Ian Ozsvald。

在撰写本书初期发布时，我还要感谢那些勇敢的缺陷猎手们。截至目前，他们是Douglas Kelley、Pavel Suk、Brigham Hausman、Marco Hemken、Noble Kennamer、Manfredi Biasutti、Matthew Maldonado和Geert Bauwens。

## 第二版

主要的感谢必须归功于Shira Evans，她从构思到实现都给予了本书极大的帮助。Gregory Hyman在及早发布时给予了我及时的反馈和帮助。再次，我很幸运有Kristen Brown完成本书的出版工作。

我也要感谢我的技术审阅者Jordan Goldmeier、Drew Winstel和Jess Males提供的宝贵建议。

^([1](preface01.xhtml#idm45607823284352-marker)) 基于[ECMAScript](https://oreil.ly/0uwuN)有许多JavaScript版本，但最重要的版本是[ECMAScript 6](https://oreil.ly/owrsZ)，它提供了大部分新功能。
