# 前言

-   在不断发展的商业世界中，一个令人着迷的概念被称为*分析工程*。它迅速成为热门话题，受到经理们的追捧，由 IT 公司呈现，并受到用户的欣赏，因为他们对其提供的可能性感到惊叹。但在兴奋之余，许多人并不知道分析工程究竟是什么。他们认为这是关于创建数据管道、设计令人惊艳的可视化和使用先进算法。哦，他们错了多么！

你可以把这个非凡的分析工程世界想象成细致入微的侦探夏洛克·福尔摩斯与天才工程师托尼·斯塔克（更为人所知的钢铁侠）的结合。想象一下夏洛克·福尔摩斯出色的解决问题的能力与钢铁侠尖端技术的结合。这种组合定义了分析技术的真正力量和潜力。

-   但要小心：如果你认为分析工程仅限于数据管道和可视化，那么你错过了夏洛克·福尔摩斯的深刻演绎思维，他代表了数据分析师或业务分析师所带来的贡献。这个领域是分析调查与软件工程师或数据工程师的技术相结合的地方，由托尼·斯塔克代表。

-   暂停一下，思考一下数据在你的业务中的重要性。你为什么寻求它？答案在于追求知识。分析技术被用来将原始数据转化为可行动派见解，这些见解作为明智决策的基础。它是一个强大的支持系统，提供揭示你业务实际情况的事实。然而，它不会替你做决策，而是提供你需要的信息，帮助你的业务取得成功。

-   在你投入到创建令人印象深刻的钢铁侠分析技术装备之前，接受夏洛克·福尔摩斯的智慧。利用他敏锐的观察力来识别和理解你所面临挑战的核心。不要被视觉化和算法的吸引力所迷惑，只因他人对其着迷。记住，分析工程不仅仅是技术：它是一个管理工具，只有与组织的战略和目标保持一致，它才会成功。确保你的关键绩效指标与你业务的实际情况保持一致，这将确保你的分析工程努力的结果准确、有影响力，并且不会让你失望。

-   分析工程的伟大冒险并不是从构建数据管道或选择先进算法开始。不，朋友，它始于对你组织知识空白的深刻反省。弄清楚为什么那些知识重要，以及如何利用它来推动你的业务成功。将分析的变革力量作为你的指南，它将在广阔的数据海洋中指引你通向成功的道路。

在追求分析工程的过程中，请永远记住福尔摩斯的故事。当一辆简朴的自行车足以胜任时，不要建造一架奢华的飞机。让问题的复杂性和其上下文的细微差别指导你的努力。记住，分析不仅仅是技术，它是管理的灯塔，是一种必须用目的和精准性使用的无价工具。让它成为你通往成功之路上的不变伴侣。

# 为什么我们写这本书

在今天信息丰富的时代，由于技术的快速增长和创新的不懈追求，重要的知识、概念和技术往往会在其中变得模糊。在这种动态变革期间，一些重要的概念有时会被无意间忽视。这种忽视并不是因为它们的相关性在减弱，而是因为进步的速度太快。

在数据管理的背景下，经常被忽视的一个基本概念就是数据建模。值得注意的是，数据建模包括各种方法，包括 Kimball、概念、逻辑和物理建模等。我们意识到在这种多样化的景观中强调数据建模的重要性的紧迫性，这也是我们撰写本书的一个关键原因。在这些页面中，我们旨在揭示数据建模的复杂性和各个维度，以及它如何支撑更广泛的分析工程领域。

随着时间的推移，数据建模在确保稳固的数据管理系统中的重要性逐渐从大众意识中淡化。这并非因为它变得过时，而是由于行业关注焦点的转移。新词汇、工具和方法涌现出来，使得基本原则变得不那么重要。传统实践向承诺快速和高效的现代解决方案转变，有时导致基础强度的丧失。

分析工程的兴起导致了一次复苏。这不仅仅是一个充满花哨词汇的趋势，而是对商业智能领域原则的回归。不同之处在于，现代工具、基础设施和技术现在可用于更有效地实施这些原则。

那么，为什么我们觉得有必要记录我们的思想呢？主要有两个原因。首先，强调像数据建模这样的成熟概念的持久价值和重要性至关重要。尽管这些方法可能已经存在一段时间了，但它们为现代技术的发展提供了坚实的基础。我们的第二个意图是强调分析工程不是独立的实体，而是从商业智能的遗产自然演变而来的。通过整合这两者，组织可以构建更具弹性的数据价值链，确保其数据不仅广泛而且可操作，从而最终提高其效用。

本书不仅仅是对过去的情感回顾或对现在的评论。它是未来的蓝图。我们的目标是帮助组织重新审视其基础，欣赏旧技术和新技术的优势，并将它们整合为全面的数据管理方法。我们将深入探讨数据建模和转换的细节，解释其重要性，并探讨它如何与现代分析工程工具互动。我们旨在为读者提供全面的理解，使他们能够加强其数据管理流程并充分利用其数据的潜力。

# 读者对象

本书旨在为处理复杂数据管理和分析世界的专业人士、学生和爱好者而设计。无论您是一位经验丰富的老将回忆起数据建模的基本原则，还是一位渴望理解从商业智能到现代分析工程转变的初学分析师，我们的叙述都确保清晰和方向明确。

寻求加强其数据处理流程的组织将在本书讨论的结合了成熟原则和现代工具的方法中找到巨大价值。简言之，如果您希望通过将过去的优势与现在的创新相结合来充分利用您的数据，本书将为您提供指导。

# 本书的组织结构

我们将本书分为六章：

第一章，“分析工程”

本章追溯了数据管理从传统的基于 SQL 的系统发展到诸如 Apache Airflow 和 dbt 等创新工具的演变，每一种工具都改变了我们处理和查看数据的方式。分析工程师角色连接数据工程和分析，确保我们的洞察可靠且可操作。尽管工具和角色发生了变化，但数据的重要性和价值仍然至关重要。然而，挑战依然存在，例如数据质量、高效存储以及在 Redshift 等平台上优化计算资源的任务负载平衡，或者在 Snowflake 上设计具有适当大小仓库的高效作业。数据建模，即通过结构化数据反映现实场景，是这些解决方案的核心。

第二章，“用于分析的数据建模”

本章深入探讨了在当今以分析驱动的景观中数据建模的关键作用。我们将调查它如何帮助构建有效分析的数据结构，并探讨数据规范化在减少重复性方面的重要性。虽然我们强调规范化的重要性，但值得注意的是，各种建模方法（如 Kimball 和 One Big Table）根据特定的用例提倡不同的方法，包括去规范化。通过理解这些基本原则，并考虑建模方法的广泛谱系，分析师可以有效地探索数据，确保获得实质性的洞察和明智的决策。在没有强大的数据模型的情况下，无论是按照上下文规范化还是去规范化，分析过程可能会不一致和不准确。

第三章，“SQL 用于分析”

本章探讨了作为首选分析语言的 SQL 的持久力量。我们将从数据库的基础和 SQL 作为与数据库交互的主要语言开始。我们的旅程将涵盖视图在简化查询中的有用性，窗口函数在高级计算中的强大功能，以及通用表达式在优化复杂查询中的灵活性。我们还将讨论 SQL 在分布式数据处理中的作用，并以 SQL 在机器学习模型训练中的激动人心的应用结束。

第四章，“使用 dbt 进行数据转换”

本章详细探讨了 dbt 在初步介绍之外的内容。我们将审视 dbt 在数据分析生命周期中的关键角色，并演示它如何将原始数据转换为结构化和可访问的模型。我们的探索将遍历 dbt 项目结构，讨论模型构建、文档编制和测试等功能，同时提供有关 dbt 文件的洞察，包括 YAML 文件。在本章结束时，您将全面了解 dbt，能够将其无缝整合到您的分析工作流程中。

第五章，“dbt 高级主题”

本章中，我们将深入探讨 dbt 的高级方面。除了视图或表之外，我们还将讨论 dbt 中模型的各种实现方式，包括使用临时模型、数据快照以及实现增量模型以避免常规全量数据加载。此外，我们还将提升我们的分析代码，专注于通过 Jinja、宏和包等技术来优化其效率，以保持 DRY（不重复自己）。最后，我们还将介绍 dbt 语义层，它在原始数据和有意义的洞察之间起着关键作用的桥梁角色。

第六章，“构建端到端分析工程用例”

此结束章节汇总了您在使用 dbt 和 SQL 进行分析工程学习过程中所学到的所有内容。在深入探讨前几章节中的概念、技术和最佳实践之后，我们现在将通过从头开始设计一个完整的分析工程用例，采用 dbt 和 SQL 的能力来实施和部署一个全面的分析解决方案。数据建模将成为焦点。我们的目标是通过整合前几章的见解来演示一个完整的分析工作流程，从数据摄取到报告。在这个过程中，我们将克服普遍存在的挑战，并提供有效应对策略。

# 本书使用的约定

本书使用以下排版约定：

*斜体*

表示新术语、URL、电子邮件地址、文件名及文件扩展名。

`常量宽度`

用于程序清单，以及在段落内引用程序元素，如变量或函数名、数据库、数据类型、环境变量、语句和关键字。

**`常量宽度粗体`**

显示用户应该按字面输入的命令或其他文本。

*`常量宽度斜体`*

显示应由用户提供的值或由上下文确定的值替换的文本。

###### 提示

此元素表示提示或建议。

###### 注

此元素表示一般注释。

# 使用代码示例

补充材料（代码示例、练习等）可在[*https://github.com/helder-russa/dbt-analytics-engineer*](https://github.com/helder-russa/dbt-analytics-engineer)下载。

如果您在使用代码示例时遇到技术问题或困惑，请发送电子邮件至*bookquestions@oreilly.com*。

本书旨在帮助您完成工作。通常情况下，如果本书提供了示例代码，您可以在自己的程序和文档中使用它。除非您复制了代码的大部分内容，否则不需要联系我们以获得许可。例如，编写一个使用本书多个代码片段的程序不需要许可。销售或分发 O’Reilly 图书中的示例代码需要许可。通过引用本书并引用示例代码来回答问题不需要许可。将本书大量示例代码整合到您产品的文档中需要许可。

我们感谢，但通常不需要署名。署名通常包括标题、作者、出版商和 ISBN。例如：“*SQL 与 dbt 的分析工程*，作者 Rui Machado 和 Hélder Russa（O’Reilly）。版权所有 2024 Rui Pedro Machado 和 Hélder Russa，978-1-098-14238-4。”

如果您认为您使用的代码示例超出了合理使用范围或上述许可的范围，请随时通过*permissions@oreilly.com*与我们联系。

# O’Reilly 在线学习

###### 注

40 多年来，[*O’Reilly Media*](https://oreilly.com)已经为企业提供技术和业务培训、知识和见解，帮助它们取得成功。

我们独特的专家和创新者网络通过图书、文章和我们的在线学习平台分享他们的知识和专业知识。O’Reilly 的在线学习平台为您提供按需访问实时培训课程、深入学习路径、交互式编码环境，以及来自 O’Reilly 和其他 200 多家出版商的广泛文本和视频。欲了解更多信息，请访问[*https://oreilly.com*](https://oreilly.com)。

# 如何联系我们

请将有关本书的评论和问题发送至出版商：

+   O’Reilly Media, Inc.

+   Gravenstein Highway North 1005

+   Sebastopol, CA 95472

+   800-889-8969（美国或加拿大）

+   707-829-7019（国际或本地）

+   707-829-0104（传真）

+   *support@oreilly.com*

+   [*https://www.oreilly.com/about/contact.html*](https://www.oreilly.com/about/contact.html)

我们为本书创建了一个网页，列出勘误、示例和任何额外信息。您可以访问此页面：[*https://oreil.ly/analytics-engineering-SQL-dbt*](https://oreil.ly/analytics-engineering-SQL-dbt)。

有关我们的图书和课程的新闻和信息，请访问[*https://oreilly.com*](https://oreilly.com)。

在 LinkedIn 上找到我们：[*https://linkedin.com/company/oreilly-media*](https://linkedin.com/company/oreilly-media)

在 Twitter 上关注我们：[*https://twitter.com/oreillymedia*](https://twitter.com/oreillymedia)

在 YouTube 上观看我们：[*https://youtube.com/oreillymedia*](https://youtube.com/oreillymedia)

# 致谢

我想特别向我的妻子 Ana 和我的两个可爱女儿 Mimi 和 Magui 发送一条特别的信息。你们每天都激励着我相信自己，并坚定不移地追求我的梦想，因为我为自己取得的成就，也是为了我们。最重要的是，我希望向我的女儿们展示，只要我们有决心，任何事情都是可能的。最后，我需要感谢我的朋友和合作者 Hélder，因为他的坚韧和不屈不挠让这个梦想得以实现。

Rui Machado

我想要感谢我的（未来的）妻子一直以来的陪伴。在最艰难的时刻，她的耐心和鼓励是我坚强的支柱。同时，特别感谢我的父母。没有他们的支持和努力，我肯定无法继续我的学业和追逐梦想，也就不可能完成这本书。再次真心感谢他们。最后，感谢所有给予我支持的匿名和非匿名的朋友们，以及合作者 Rui，他们的积极反馈和建设性意见极大丰富了本书的内容。

Hélder Russa
