# 前言

Apache Spark 的漫长前辈系列，从 MPI（消息传递接口）到 MapReduce，使得编写能够利用大规模资源的程序成为可能，同时抽象了分布式系统的繁琐细节。数据处理需求推动了这些框架的发展，事实上，大数据领域与这些框架的相关性如此之深，以至于其范围由这些框架能处理的内容来定义。Spark 最初的承诺是将这一点推向更远——使编写分布式程序感觉像编写常规程序一样。

Spark 的流行崛起与 Python 数据（PyData）生态系统的兴起相吻合。因此，Spark 的 Python API——PySpark，在过去几年中显著增长了其流行度。尽管 PyData 生态系统最近出现了一些分布式编程选项，但 Apache Spark 仍然是跨行业和领域处理大数据集的最受欢迎选择之一。由于最近努力将 PySpark 与其他 PyData 工具集成，学习这个框架可以帮助您显著提高作为数据科学从业者的生产力。

我们认为教授数据科学的最佳方式是通过示例。为此，我们编写了一本应用程序书籍，试图涉及大规模分析中最常见的算法、数据集和设计模式之间的互动。这本书不打算从头到尾阅读：选择一个看起来像您正在尝试完成的任务的页面或者简单激发您兴趣的章节，从那里开始。

# 为什么我们现在写这本书？

Apache Spark 在 2020 年经历了一个重大版本升级——版本 3.0。最大的改进之一是引入了 Spark 自适应执行。这一特性消除了调整和优化的大部分复杂性。我们在书中没有提及它，因为在 Spark 3.2 及更高版本中默认开启，因此您自动获得了这些好处。

生态系统的变化，再加上 Spark 的最新主要版本发布，使得这一版本显得及时。与之前选择 Scala 的《高级分析与 Spark》不同，我们将使用 Python。在适当时，我们将涵盖最佳实践并与更广泛的 Python 数据科学生态系统集成。所有章节都已更新为使用最新的 PySpark API。新增了两个章节，并对多个章节进行了重大改写。我们不会涵盖 Spark 的流处理和图形库。随着 Spark 进入新的成熟和稳定时代，我们希望这些改变能使这本书成为未来几年内有用的分析资源。

# 本书的组织方式

第一章 将 Spark 和 PySpark 放在数据科学和大数据分析的更广泛背景下进行了介绍。之后，每一章都包括了使用 PySpark 进行的自包含分析。第二章 通过数据清洗的应用案例介绍了 PySpark 和 Python 中的数据处理基础。接下来的几章深入探讨了使用 Spark 进行机器学习的核心内容，应用了一些最常见的算法在经典应用中。剩下的章节则更多地涉及一些稍微特别的应用场景，例如通过文本中的潜在语义关系查询维基百科，分析基因组数据，以及识别相似图像。

这本书并非关于 PySpark 的优缺点。它也不是关于其他几件事情。它介绍了 Spark 编程模型以及 Spark 的 Python API，PySpark 的基础知识。然而，它并不试图成为 Spark 的参考资料或者提供所有 Spark 的细节和技巧的全面指南。它也不是机器学习、统计学或线性代数的参考书，尽管很多章节在使用这些内容之前会提供一些背景知识。

相反，这本书将帮助读者了解如何使用 PySpark 处理大规模数据进行复杂分析的实际感受，覆盖整个流程：不仅仅是构建和评估模型，还包括数据清洗、预处理和探索，同时关注将结果转化为生产应用。我们认为通过示例来教学是最好的方式。

这里有一些本书将处理的任务示例：

预测森林覆盖

我们通过使用决策树来预测森林覆盖类型，使用相关特征如位置和土壤类型（见第四章）。

查询维基百科的类似条目

我们通过使用 NLP（自然语言处理）技术识别条目之间的关系，并通过查询维基百科语料库来进行处理（见第六章）。

理解纽约出租车的利用率

我们通过执行时间和地理空间分析来计算出租车等待时间的平均值作为位置的函数（见第七章）。

降低投资组合的风险

我们使用蒙特卡洛模拟来评估投资组合的财务风险（见第九章）。

在可能的情况下，我们尽量不仅仅提供“解决方案”，而是演示完整的数据科学工作流程，包括所有的迭代、死胡同和重新启动。本书将有助于更熟悉 Python、Spark 和机器学习及数据分析。然而，这些都是为了更大的目标服务，我们希望本书最重要的是教会您如何处理类似前述任务。每章，大约 20 页，将尝试尽可能接近演示如何构建这些数据应用的一部分。

# 本书使用的约定

本书使用以下印刷约定：

*斜体*

指示新术语，URL，电子邮件地址，文件名和文件扩展名。

`常量宽度`

用于程序清单，以及在段落内引用程序元素，例如变量或函数名称，数据库，数据类型，环境变量，语句和关键字。

**`常量宽度粗体`**

显示用户应按字面输入的命令或其他文本。

*`常量宽度斜体`*

显示应由用户提供值或由上下文确定值的文本。

此元素表示提示或建议。

此元素表示一般注释。

此元素表示警告或注意事项。

# 使用代码示例

附加材料（代码示例，练习等）可在[*https://github.com/sryza/aas*](https://github.com/sryza/aas)下载。

如果您有技术问题或在使用示例代码时遇到问题，请发送电子邮件至*bookquestions@oreilly.com*。

本书旨在帮助您完成工作。通常情况下，如果本书提供了示例代码，您可以在您的程序和文档中使用它。除非您要复制代码的大部分内容，否则无需联系我们以获得许可。例如，编写一个使用本书多个代码片段的程序不需要许可。销售或分发来自 O’Reilly 书籍的示例代码需要许可。引用本书并引用示例代码回答问题不需要许可。将本书大量示例代码整合到您产品的文档中需要许可。

我们感谢您的支持，但不要求署名。署名通常包括书名、作者、出版商和 ISBN 号。例如：“*使用 PySpark 进行高级分析*，作者 Akash Tandon、Sandy Ryza、Uri Laserson、Sean Owen 和 Josh Wills（O’Reilly）。版权 2022 年 Akash Tandon，978-1-098-10365-1。”

如果您认为您使用的代码示例超出了公平使用范围或上述授权，请随时与我们联系，邮箱为*permissions@oreilly.com*。

# O’Reilly 在线学习

在超过 40 年的时间里，[*O’Reilly Media*](https://oreilly.com)已经为公司提供了技术和商业培训、知识和洞察力，帮助公司取得成功。

我们独特的专家和创新者网络通过书籍、文章以及我们的在线学习平台分享他们的知识和专长。O’Reilly 的在线学习平台为您提供按需访问的现场培训课程、深入学习路径、交互式编码环境，以及来自 O’Reilly 和其他 200 多家出版商的大量文本和视频。欲了解更多信息，请访问[*https://oreilly.com*](https://oreilly.com)。

# 如何联系我们

有关本书的评论和问题，请联系出版商：

+   O’Reilly Media, Inc.

+   Gravenstein Highway North 1005 号

+   加利福尼亚州塞巴斯托波尔，95472

+   800-998-9938（美国或加拿大）

+   707-829-0515（国际或本地）

+   707-829-0104（传真）

我们为本书设有一个网页，列出勘误、示例以及任何额外信息。您可以访问该页面 [*https://oreil.ly/adv-analytics-pyspark*](https://oreil.ly/adv-analytics-pyspark)。

发送电子邮件至 *bookquestions@oreilly.com* 进行评论或提出有关本书的技术问题。

关于我们书籍和课程的新闻和信息，请访问[*https://oreilly.com*](https://oreilly.com)。

在 LinkedIn 上找到我们：[*https://linkedin.com/company/oreilly-media*](https://linkedin.com/company/oreilly-media)

在 Twitter 上关注我们：[*https://twitter.com/oreillymedia*](https://twitter.com/oreillymedia)

在 YouTube 上观看我们：[*https://youtube.com/oreillymedia*](https://youtube.com/oreillymedia)

# 致谢

毫无疑问，如果没有 Apache Spark 和 MLlib 的存在，你不会读到这本书。我们要感谢建造和开源它的团队以及为其增添内容的数百名贡献者。

我们要感谢所有花费大量时间审阅上一版书籍内容的专家们：Michael Bernico、Adam Breindel、Ian Buss、Parviz Deyhim、Jeremy Freeman、Chris Fregly、Debashish Ghosh、Juliet Hougland、Jonathan Keebler、Nisha Muktewar、Frank Nothaft、Nick Pentreath、Kostas Sakellis、Tom White、Marcelo Vanzin，还有再次感谢 Juliet Hougland。谢谢大家！我们真心感激。这大大提高了结果的结构和质量。

Sandy 还要感谢 Jordan Pinkus 和 Richard Wang 对风险章节背后理论的帮助。

感谢 Jeff Bleiel 和 O’Reilly 在出版这本书并把它送到你手中的经验和大力支持。
