# 前置材料

## 前言

数据科学始于数据。我们收集数据。我们准备数据。我们使用数据在预测模型中。数据越好，模型越好，无论是基于传统统计学还是机器学习。

通过从原始数据和度量中创建新的数据和度量，通过操作数据，我们提高了模型性能和效率。这是特征工程的工作。

可视化帮助我们从数据中学习。它们展示了变量之间的关系。它们提出了有用的转换。它们指向数据中的建模问题、异常值和异常模式。

将这些放在一起——数据准备、特征工程和可视化——你就有了 Gary Sutton 的*Statistics Slam Dunk: Statistical analysis with R on real NBA data*的精髓。Sutton 借鉴了许多职业篮球的例子，为体育分析和数据科学提供了对探索性数据分析的全面介绍。

由于其众多包和工具，R 是这本书的明显选择。我们期待 Sutton 的工作会受到 R 爱好者的欢迎，尤其是那些希望从基础 R 过渡到`tidyverse`函数的人。R 编程的机制在*Statistics Slam Dunk*中得到了很好的说明。

许多人一直在等待 Dean Oliver 的*Basketball on Paper*的续集，Sutton 的书代表了这一方向的第一步。篮球涉及持续的活动，而不是有明显的开始和结束时间的比赛。篮球提出了从显然是团队努力中提取个人绩效指标的困难。解决篮球分析的特定问题始于篮球数据。

随着我们从一章跳到另一章，没有规定的顺序，我们听到 Sutton 说：“这里有关于美国职业篮球联赛中球员和球队的数据。让我们探索这些数据，看看概率论和统计学（以及经济学）的基本概念如何应用于这项运动。”通过精心设计的例子，他教我们关于建模最佳实践、经典推断、约束优化、处理异常值的方法、帕累托原则和 80-20 规则、主客场球队裁判偏见、防守是否赢得冠军、球员薪资支出转化为胜利记录的程度（除了纽约尼克斯队），以及表示收入不平等的基尼系数和洛伦兹曲线、随机性、蒙特霍尔问题，以及“手感热”的神话。这是一次有趣的旅程，值得体育迷和分析员一同体验。

相关的指标和大量的数据是当今体育领域以数据分析为导向的竞争优势的关键。无情的分析在经理和教练做出关于团队组成和比赛策略的决定时，以及为从准确预测比赛结果中受益的人提供服务时，都发挥着作用。从数据到决策或从数据到行动意味着用数据编程。真相在代码中——而且萨顿提供了大量的代码来证明这一点。

——托马斯·W·米勒博士

西北大学数据科学项目主任

《体育分析与数据科学：用方法和模型赢得比赛》一书的作者

## 前言

《统计学扣篮》至少是以下三个因素的交汇点。

首先，我非常想提高自己的 R 编程技能。作为一个组织的领导者，我花费时间指导和管理我的员工的工作，移除他们的障碍和其他挑战，制定目标，创建和交付高层演示，招聘（有时解雇）员工，准备和传达绩效评估，计算和分配年度薪酬调整和奖金，等等。换句话说，没有多余的时间来编写自己的代码，因此无法维持，更不用说提高我的编程技能了。

其次，我想满足一些我的求知欲。例如，我读过布赖恩·克里斯蒂安和汤姆·格里菲斯写的《算法改变生活：人类决策的计算机科学》中关于最优停止的内容；詹姆斯·苏罗维基的《群体的智慧》中关于大众智慧与专业人士和其他专家的比较；纳西姆·尼古拉斯·塔勒布关于幂律和林迪效应的内容，最著名的是在《随机之愚》、《黑天鹅》、《反脆弱》和《置身事内》中；以及吹捧休息带来绩效和生产率提升的案例研究，比如午睡和周五休息，以产生绩效和生产率提升。一路上，我一直想知道这些概念在职业篮球（我多年来在竞争性和非竞争性篮球中都有所涉猎，同时，作为一个年轻人，我对这项运动也有求知欲）中效果如何。此外，我对防守赢得冠军、比赛在第四节赢得、以及 NBA 薪资上限创造赛季内和赛季间平衡持长期怀疑态度，我想了解数据说了什么。最后，我想确定统计分析是否可以证明摆烂是有道理的，或者是否可以揭示裁判或官员的偏见。

第三，尽管我渴望（或需要？）提高自己的 R 技能，但我仍然相信我有值得传授给别人的专业知识和经验。

我最初的想法是将每一章组织成两个大致相等的部分：前半部分会用通俗易懂的语言总结我的发现，后半部分则大致相当于代码审查。会有适合每个人的内容！当我开始写我的书稿时，我最终意识到我实际上在写两本书……其中一本书的挑战性就足够大了。虽然我针对的是技术和非技术读者，但我的书可能没有足够的焦点来吸引任何人。从根本上说，我知道我在写一本编程和统计学书籍；我随后相应地重构了手稿，并更新了我的提案。

尽管如此，*统计扣篮大赛*与其他类似书籍不同。毕竟，我从一开始的总体目标就是写一本不同的书，这本书不能轻易与之前的手册相比较。每一章从开始到结束都像是一个真实世界的数据科学或统计学项目。

回到过去，我开始使用 SAS，但后来看到未来在于开源技术。我记不清为什么或如何选择了 R……而且从未回头——你也不应该。

## 致谢

虽然我的名字在封面上，但写书实际上是一个团队的努力。我想感谢以下人员，不仅是因为他们使这一切成为可能，还因为他们的贡献让*统计扣篮大赛*比原本更好：

+   首先和最重要的是，我的开发编辑，伊恩·豪，他让我保持专注，提供了极好的建议，并在我需要额外指导时总是可用（这经常发生）。

+   马兰·巴塞，曼宁的出版商，以及安迪·沃尔德伦，采购编辑，他们相信我，并接受了我关于这本书的异想天开的想法。

+   罗希特·戈斯瓦米，我的技术编辑，他提供了敏锐的见解，并鼓励我在这里展示的许多方法上进行详细阐述。当他建议我用`pivot_longer()`和`pivot_wider()`函数替换`gather()`和`spread()`函数时，他似乎特别高兴。罗希特是 Quansight Labs 的软件工程师，也是冰岛大学科学学院由 Rannis 资助的博士研究员。他是 rOpenSci 的活跃审稿人，并维护 R 的“软件工艺”课程。他博士研究的大部分工作集中在 R 工作流程以及使用`Rcpp`和`Cpp11`包与编译的 C++和 Fortran 的绑定。

+   艾利·梅约斯特，技术校对员，他检查了我的代码，并确保一切按设计工作。

+   亚历克斯·德拉戈萨夫列维奇，我的审稿编辑，他获得了审稿人并协调了同行评审流程。

+   保罗·韦尔斯和他的团队——特别是凯西·罗森兰、朱莉·麦克尼和梅洛迪·多拉布——在曼宁生产过程中出色地运行了*统计扣篮大赛*。

+   评审员们，他们投入了许多“空闲”时间阅读手稿并提供宝贵的反馈：Ayush Bihani、Bob Quintus、Chen Sun、Christian Sutton、David Cronkite、David Jacobs、Eli Mayost、George Carter、Giri Swaminathan、Jan Pieter Herweijer、John Williams、Juan Delgado、Kim Lokøy、Lachman Dhalliwal、Mark Graham、Maxim Volgin、Oliver Korten、Ravi Kiran Bamidi、Sander Zegveld、Simone Sguazza、Sleiman Salameh、Stefano Ongarello 和 Ulrich Gauger。

+   感谢托马斯·米勒博士为撰写前言并教我关于约束优化的知识（见第四章）。

+   在 Manning 早期访问计划（MEAP）期间购买书籍的参与者，他们提出了明智的问题，并指出了错别字和其他错误。

此外，对于那些“无声的英雄”表示感谢也是理所当然的，他们没有名声或金钱回报，却创建和分享数据集。他们是后续一切真正的推动者。

最后，我必须感谢我的妻子，Liane，她容忍了我情绪的波动（这些波动与我的非线性进展高度相关）以及我在整个旅程中的一般不可用。

## 关于这本书

*统计扣篮*与其他编程手册相当不同。其他类似的书通常按技术或方法组织；例如，可能会有关于常见数据处理操作的章节，另一章关于线性回归，另一章关于创建基本图表，等等。

没有什么是错的。然而，在现实世界中，没有数据处理项目、线性回归项目或数据可视化项目。*统计扣篮*是项目驱动的：从加载包到导入数据，再到数据处理、探索、可视化、测试和建模，每个章节都执行从零到预定义终点的所有操作。*统计扣篮*教你如何从始至终思考、设置和运行一个数据科学或统计项目。

第一，这是最重要的。第二，*统计扣篮*贯穿整个 NBA 数据集，试图在每一章中找到一些有用和相关的信息，这些信息应该可以转移到您自己的世界中。我的希望是*统计扣篮*是一种更有趣、更有效的学习 R 的方法。

### 应该阅读这本书的人

毋庸置疑，对 R 语言或至少对其他统计编程语言的一些先前接触将有助于您充分利用这本书。此外，对基本统计概念的基础知识、数据可视化的背景和最佳实践，以及甚至对篮球游戏的基本理解和一些对基本篮球统计数据的熟悉，都将是有益的。

然而，《统计学灌篮》假设的内容非常少。R 和 RStudio，R 的集成开发环境（IDE），都是免费下载的。《统计学灌篮》假设你可以下载软件，然后通过点击几次“下一步”来安装它。否则，每个操作都将以最适合那些在 R 或统计学方面几乎没有背景的本科生和研究生、有一定 R 经验但希望提升技能的初级或中级数据科学家和数据分析师，以及从其他编程语言过渡过来的数据科学家和数据分析师的详细程度进行解释。

话虽如此，对于已经熟悉 R 语言的读者来说，《统计学灌篮》中也有足够的内容。如果你熟悉 R，那么《统计学灌篮》将帮助你进一步巩固关键统计概念，展示如何创建主流之外的引人入胜的图形内容，并介绍你尚未接触过的包及其函数。

对于数据敏感的篮球迷以及那些在篮球领域工作的人来说，这本书的研究成果肯定会引起他们的兴趣——但你必须筛选数百行代码和辅助文本才能到达那里。你不需要对篮球运动有丝毫了解就能充分利用这本书，就像你不需要成为园艺学家才能使用鸢尾花数据集（它随 R 软件捆绑提供，并且比其他任何数据集更常用于展示各种技术）一样。关于篮球和数据集的任何你需要知道的内容都将详细解释。

### 这本书的组织方式：一个路线图

《统计学灌篮》分为 20 章。几乎每一章都是一个独立的项目或故事，有开始、结束和中间的情节。以第五章为例，我们检查和测试了勤奋对胜负的影响。每个操作都进行了详细解释和演示，从加载包、导入数据，到探索和整理数据，再到开发模型。

话虽如此，以下是按章节划分的概述：

+   第一章基本上是一种介绍。到结束时，你应该不仅感到舒适，而且对在 R 上投资学习感到兴奋。这一章没有包含任何代码。

+   第二章展示了如何最好地处理数据集，计算基本统计数据，以及可视化结果。你还将学习如何加载包、导入数据、整理和总结数据，以及使用内置和包装函数的组合来创建引人入胜的图形内容。

+   第三章是在前一章建立的基础上构建的。你将学习如何可视化均值和中位数，创建一个称为桑基图的流程图，设置和估计期望值分析，以及执行一个无监督学习问题，即层次聚类。

+   第四章演示了如何设置并完成一个约束优化问题。你还将学习如何最好地可视化数据分布，并在 R 代码中添加注释。

+   第五章演示了如何识别数据中的异常值，运行并解释正态性统计测试，计算并可视化连续变量之间的相关性，开发多重线性回归并解释结果，以及开发决策树并绘制相同的内容。

+   第六章展示了如何对数据集进行子集化，分离和连接数据集，以及重命名和转换变量，以及其他数据整理操作。此外，你还将学习如何应用许多数据可视化的最佳实践，包括一些小细节，这些细节可能会对你的观众产生重大影响。

+   第七章演示了如何运行、解释和可视化 t 检验，以及运行和解释补充效应量测试。

+   第八章介绍了最优停止规则，通常被称为 37%规则。此外，你还将学习如何从子字符串创建派生变量；创建频率表；向在`ggplot2`中创建的视觉图中添加主题，`ggplot2`是本书中使用的顶级图形包；将图像导入并嵌入到其他`ggplot2`内容中；以及在`ggplot2`折线图中添加多个趋势线。

+   第九章详细讨论了排列和组合——如何区分一个与另一个，以及如何计算相同的内容。你还将学习如何创建令人惊叹的、尽管有些不典型但仍然能够快速而引人入胜的视觉内容，包括小面板图、气球图和马赛克图；运行并解释分类数据的显著性统计测试；以及运行并解释相同数据的补充效应量测试。

+   第十章展示了如何计算成对连续变量之间的相关系数；执行相关测试；创建相关图、点图和棒棒糖图；通过转换和连接修改标签；以及处理数据中的缺失值。

+   第十一章演示了如何执行另一种无监督学习问题，即 K-means 聚类。你将学习如何计算和可视化竞争最优聚类数量，创建聚类，并绘制相同的内容。你还将学习如何创建克利夫兰点图，这是一种可能不典型但仍然能够快速而引人入胜的另一种可视化类型。

+   第十二章介绍了基尼系数以及如何使用洛伦兹曲线可视化不平等。你还将接触到显著性测试和效应量测试。

+   第十三章再次演示了如何计算和解释基尼系数，但使用的是与上一章不同的数据集。你还将学习如何创建替代的洛伦兹曲线，进行 t 检验（再次）和 F 检验，以及进行在先前章节中未展示的其他效应量测试。还包括有关创建`for`循环和编写你自己的函数的章节。

+   第十四章可能是书中最重和最技术性的章节。你将学习如何运行相关性测试并解释其结果；开发方差分析（ANOVA）模型；开发逻辑回归；理解并区分概率、优势比和对数优势；创建接收者操作特征（ROC）曲线；以及创建相当不寻常的箱线图。

+   第十五章主要致力于讨论 80-20 法则和创建帕累托图的替代方法。你还将学习如何创建小提琴图和成对直方图。

+   第十六章主要讨论了当其他人可能看到因果关系时的情况。你将了解拉普拉斯的后继法则，如何模拟抛硬币，以及如何将`ggplot2`对象插入到其他`ggplot2`对象中（一个非常酷的功能）。

+   第十七章以对三个竞争性的自动化探索性数据分析包的连续演示开始。还介绍了可以应用于`ggplot2`条形图的先进功能和美学技术。

+   第十八章介绍了几种统计分散性的度量，并讨论了为什么或如何最好地使用它们。你还将学习如何计算客户流失率以及如何创建金字塔图。

+   第十九章介绍了几种数据标准化或归一化的方法，并讨论了为什么以及如何应用它们。你还将学习如何着色数据框并突出观察结果，以及如何比较两个数据集的内容。

+   第二十章是对第二章至第十九章之间应用的技术进行回顾，并总结这些技术沿途产生的结果。这不是逐章重述，而是一个对本书中经常涵盖的九个学习领域的关键发现进行整合，包括聚类分析、显著性检验、效应量检验、建模、运筹学、概率、统计分散性、标准化以及汇总统计和可视化。

这显然是对这些章节的高层次描述。"Statistics Slam Dunk" 展示了许多前述列表中没有提到的数据处理操作——例如，如何删除列或行；如何将数据从长格式转换为宽格式或反之；如何按组总结数据；如何从条件逻辑创建段；以及如何操作日期格式，仅举几例。"Statistics Slam Dunk" 还包含大约 300 个可视化效果和大约 40 种图表类型，其中大多数是在 `ggplot2` 或 `ggplot2` 扩展中开发的。通常，让听众理解其他技术或方法的结果的最佳和最有效的方式是通过创建图形内容。创建引人入胜的可视化可能很困难。采用最佳实践并应用细节处理（添加标题和副标题、添加字幕、注释你的可视化、重新格式化标签、操作坐标轴等）有时可能更加困难。几乎每个 "Statistics Slam Dunk" 章节都教授这些技术的一些子集。

### 关于代码

代码与文本交织在一起。通常情况下，代码会先被解释，然后是对结果的总结或讨论。书中出现了许多函数，包括内置的和打包的；因此，随着函数和代码的重复，解释性文本逐渐减少，假设你已经阅读了前面的章节。然而，当你认为需要提醒时，你将定期遇到详尽的重复。本书中的源代码以 `fixed-width` `font` `like` `this` 的格式呈现，以与普通文本区分开来。在许多情况下，原始源代码已被重新格式化；我们添加了换行并重新调整了缩进，以适应书中的页面空间。

您可以从本书的 liveBook（在线）版本中获取可执行的代码片段，链接为 [`livebook.manning.com/book/statistics-slam-dunk`](https://livebook.manning.com/book/statistics-slam-dunk)。代码和数据集可在以下 GitHub 位置找到：[`github.com/garysutton/statisticsplaybook`](https://github.com/garysutton/statisticsplaybook)。书中脚本的完整代码也可从 Manning 网站下载：[www.manning.com/books/statistics-slam-dunk](https://www.manning.com/books/statistics-slam-dunk)。

### liveBook 讨论论坛

购买《统计学扣篮》包括免费访问 liveBook，Manning 的在线阅读平台。使用 liveBook 的独特讨论功能，您可以在全球范围内或针对特定章节或段落附加评论。为自己做笔记、提出和回答技术问题，以及从作者和其他用户那里获得帮助都非常简单。要访问论坛，请访问[`livebook.manning.com/book/statistics-slam-dunk/discussion`](https://livebook.manning.com/book/statistics-slam-dunk/discussion)。您还可以在[`livebook.manning.com/discussion`](https://livebook.manning.com/discussion)了解更多关于 Manning 的论坛和行为的规则。

Manning 对我们读者的承诺是提供一个场所，在这里个人读者之间以及读者与作者之间可以进行有意义的对话。这不是对作者参与特定数量活动的承诺，作者对论坛的贡献仍然是自愿的（且未付费）。我们建议您尝试向作者提出一些挑战性的问题，以免他的兴趣转移！只要这本书还在印刷中，论坛和先前讨论的存档将可通过出版社的网站访问。

## 关于作者

![Sutton](img/Sutton.png)

Gary Sutton 在多个垂直领域建立了并领导了表现优异的商业智能和分析组织，在这些组织中，R 语言是统计分析、预测建模和其他定量洞察的首选编程语言。Sutton 先生在南加州大学获得了本科学位，在乔治·华盛顿大学获得了硕士学位，并在西北大学获得了第二个硕士学位，主修数据科学。他是一位热心的读者，前铁人三项运动员，以及前篮球运动员。

## 关于封面插图

《统计学扣篮》封面上的图像是“Homme Koraik”，或“Koryaks Man”，取自 Jacques Grasset de Saint-Sauveur 的收藏，1788 年出版。每一幅插图都是手工精心绘制和着色的。

在那些日子里，仅凭人们的服饰就能轻易地识别出他们居住的地方以及他们的职业或社会地位。Manning 通过基于几个世纪前丰富多样的地域文化的书封面来庆祝计算机行业的创新精神和主动性，这些文化通过像这样的一些收藏品中的图片被重新呈现出来。
