- en: 2 Encoding geographies
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2 编码地理信息
- en: This chapter covers
  id: totrans-1
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: How to use the results-driven approach to tackle a real problem
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用以结果为导向的方法来解决实际问题
- en: Making analytical decisions in the face of uncertainty
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在不确定的情况下做出分析决策
- en: Now that you have been introduced to the results-driven approach, let’s apply
    it to a real data science task. We will tackle a real-world problem and apply
    the results-driven method to it. It is a template for approaching the other projects
    and any other project you encounter in the future.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经了解了以结果为导向的方法，让我们将其应用于一个真实的数据科学任务。我们将解决一个现实世界的问题，并应用以结果为导向的方法。这是一个处理其他项目和未来遇到的任何其他项目的模板。
- en: All the projects and data are available at [https://davidasboth.com/book-code](https://davidasboth.com/book-code)
    for you to attempt them yourself. There, you will find both the dataset for the
    project and the same example solution presented in the chapter in the form of
    a Jupyter notebook.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 所有项目和数据都可在[https://davidasboth.com/book-code](https://davidasboth.com/book-code)找到，供你尝试。在那里，你可以找到项目所需的数据集以及章节中展示的相同示例解决方案，以Jupyter笔记本的形式呈现。
- en: A note on Jupyter notebooks
  id: totrans-6
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 关于Jupyter笔记本的注意事项
- en: Jupyter is a development environment that allows the mixing of code and accompanying
    text in the form of notebooks. Notebook files let you read the text and run the
    code directly within the document. They are popular for education and data analysis.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Jupyter是一个允许以笔记本形式混合代码和相关文本的开发环境。笔记本文件允许你在文档中直接阅读文本并运行代码。它们在教育和数据分析中很受欢迎。
- en: The notebooks accompanying the book collect the code snippets from each chapter
    into a single document where the code is also runnable. Sites such as GitHub even
    let you view the notebooks in the browser without requiring Jupyter to be installed.
    See the appendix for instructions on how to install Python to run the code yourself.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 伴随本书的笔记本收集了每一章的代码片段，并将其整合成一个可运行的单一文档。例如，GitHub这样的网站甚至允许你在浏览器中查看笔记本，无需安装Jupyter。请参阅附录，了解如何安装Python以运行代码。
- en: For this chapter’s project, let’s examine an example task that analysts encounter,
    which at first glance might seem simple enough—encoding geography.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本章的项目，让我们考察分析师遇到的一个示例任务，乍一看可能足够简单——编码地理信息。
- en: '2.1 Project 1: Identifying customer geographies'
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.1 项目1：识别客户地理信息
- en: Let’s look at the project in which we will extract location information from
    free text to better understand our customer base. As an analyst for ProWidget
    Systems, a UK-based B2B (business-to-business) retailer, you’ve been asked to
    report on spending volumes for London-based customers versus those based in the
    rest of the United Kingdom. The board has supplied a high-level data extract containing
    all customers’ addresses and their total spending to date. They want to know
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看我们将从中提取位置信息的项目，以更好地了解我们的客户基础。作为ProWidget Systems（一家位于英国的B2B（企业对企业）零售商）的分析师，你被要求报告伦敦客户的支出量与英国其他地区的客户相比。董事会提供了一份包含所有客户地址及其迄今为止总支出的高级数据摘要。他们想知道
- en: Which UK cities are currently underserved
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哪些英国城市目前服务不足
- en: Whether their customers are primarily London based
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们的客户是否主要是伦敦基地
- en: If this were a sanitized tutorial, your data would likely have a column called
    `city`, and your task would be more about the technical steps required to group
    the data by city and summarize it using an appropriate metric. Perhaps you would
    take the total spending from all London-based customers and compare it against
    the same figure from other major cities in the United Kingdom or all data where
    the `city` column is not London. Perhaps you would choose to show the distribution
    instead to get a more detailed picture of the difference. Either way, your choice
    is more about the specific *technical* steps required to get an answer.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这是一个经过净化的教程，你的数据可能有一个名为`city`的列，你的任务将更多关于按城市分组数据并使用适当的指标进行总结所需的技术步骤。也许你会从所有伦敦客户的总支出中提取数据，并将其与其他英国主要城市或所有`city`列不是伦敦的数据进行比较。也许你会选择显示分布，以获得更详细的差异图。无论如何，你的选择更多关于获取答案所需的具体*技术*步骤。
- en: 'Compare this to answering the same question as an analyst in a real business.
    For instance, in this project, the available data is not organized cleanly enough
    to have a `city` column: we only have a single `customer` `address` column, which
    may or may not contain the city somewhere within it. The address data for this
    project comes from Companies House, an executive agency sponsored by the UK government’s
    Department for Business and Trade. The original public data, which I modified
    for this exercise, is available at [https://mng.bz/mGxr](https://mng.bz/mGxr).'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 将此与作为真实业务中的分析师回答相同问题进行比较。例如，在这个项目中，可用的数据组织得不够整洁，以至于没有`城市`列：我们只有一个包含客户地址的`客户`列，该地址可能包含也可能不包含城市信息。这个项目的地址数据来自英国政府商业和贸易部赞助的执行机构公司注册处。我修改了原始的公开数据，用于这个练习，可在[https://mng.bz/mGxr](https://mng.bz/mGxr)找到。
- en: Before doing any analysis, we need to decide how to identify what city an address
    relates to. We will follow the results-driven process laid out in chapter 1 to
    do this and get an answer for our stakeholders.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行任何分析之前，我们需要决定如何识别一个地址与哪个城市相关。我们将遵循第1章中概述的结果导向过程来完成这项工作，并为我们的利益相关者获得一个答案。
- en: 'Real business case: Finding new leads with address data'
  id: totrans-17
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 真实业务案例：利用地址数据寻找新线索
- en: As a data scientist, one data-driven tool I built was a map of all our customers
    combined with a list of all companies in the United Kingdom that were in a relevant
    industry to be our potential customers. The sales team used this map to identify
    prospective customers in the local area whenever they went to visit an existing
    customer.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一名数据科学家，我构建的一个数据驱动工具是我们所有客户的地图与所有可能成为潜在客户的英国相关行业的公司名单的结合。销售团队使用这张地图在访问现有客户时识别当地地区的潜在客户。
- en: The project involved combining our own customer data with the government’s official
    public list of companies, and the bulk of the work was sanitizing address data
    in both lists so they could be compared, which is why that is the topic of this
    chapter.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 该项目涉及将我们自己的客户数据与政府官方的公司公开名单相结合，大部分工作是对两个列表中的地址数据进行清理，以便进行比较，这也是本章的主题。
- en: 2.1.1 Data dictionary
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.1.1 数据字典
- en: The first step in understanding what’s in a dataset is to read the data dictionary
    or ask for one if it wasn’t provided. You may ultimately need to write one yourself.
    One of the ways the real world differs from this book’s projects is that I provide
    well-documented data dictionaries. Don’t get used to it! Table 2.1 shows the data
    dictionary for the supplied data, and figure 2.1 shows a snapshot of the first
    few rows.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 理解数据集中有什么的第一步是阅读数据字典，或者如果未提供，则请求一个。你最终可能需要自己编写一个。现实世界与本书项目的一个区别是，我提供了详细的数据字典。不要习惯它！表2.1显示了提供数据的数据字典，图2.1显示了数据的前几行的快照。
- en: '![figure](../Images/2-1.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-1.png)'
- en: Figure 2.1 A snapshot of the first few rows of customer address data
  id: totrans-23
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.1 客户地址数据的前几行的快照
- en: Table 2.1 Data dictionary for the customer address dataset
  id: totrans-24
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表2.1 客户地址数据集的数据字典
- en: '| Column | Definition |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| 列 | 定义 |'
- en: '| --- | --- |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `company_id`  | A unique identifier for each customer company in the dataset  |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| `company_id`  | 数据集中每个客户公司的唯一标识符  |'
- en: '| `address`  | A single field to store the customer address  |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| `address`  | 存储客户地址的单个字段  |'
- en: '| `total_spend`  | The total amount this customer has spent to date (in GBP)  |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| `total_spend`  | 到目前为止，这位客户花费的总金额（以英镑计）  |'
- en: Now that we have our problem statement and have seen the available data, it
    is time to start our results-driven process to arrive at a solution.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经明确了问题陈述并看到了可用的数据，是时候开始我们的以结果为导向的过程，以找到解决方案。
- en: '2.2 An example solution: Finding London'
  id: totrans-31
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.2 一个示例解决方案：寻找伦敦
- en: 'In this section, I will dive into an example solution, focusing on the steps
    of the results-driven approach, as well as the details of solving the problem.
    You may wish to attempt this problem yourself before going further or use this
    chapter to get a feel for the structure of the rest of the projects. As for most
    solutions I provide, the code itself will be written in Python, primarily using
    the `pandas` library. While code snippets will be used to explain the example
    solution, I will focus discussions on the conceptual solution and less on the
    code specifics. The solution will have three parts: setting up the problem statement
    and the data, creating the first iteration of a solution, and reviewing the work
    and deciding on further steps.'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我将深入一个示例解决方案，重点关注结果驱动方法的步骤以及解决问题的细节。在继续之前，你可能希望尝试这个问题，或者使用本章来了解其余项目的结构。至于我提供的多数解决方案，代码本身将用Python编写，主要使用`pandas`库。虽然将使用代码片段来解释示例解决方案，但我将重点讨论概念解决方案，而不是代码的具体细节。解决方案将分为三个部分：设置问题和数据，创建解决方案的第一迭代，以及审查工作并决定下一步。
- en: 2.2.1 Setting ourselves up for success
  id: totrans-33
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.2.1 为成功做好准备
- en: '![figure](../Images/2-unnumb-1.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-unnumb-1.png)'
- en: The first step is to ensure we understand the problem. In this case, we know
    we need to use our customer address data to calculate the total spending by city
    across the United Kingdom and come up with an answer for how London customers
    compare with the rest of the country. If we encountered multiple metrics in the
    data, such as the number of transactions a customer has made or how long they
    have been a customer, we would need to clarify the purpose of the question with
    our stakeholders so that we know which metrics to focus on.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是确保我们理解了问题。在这种情况下，我们知道我们需要使用我们的客户地址数据来计算英国的总支出，并找出伦敦客户与该国其他地区相比的答案。如果我们遇到多个指标，例如客户进行的交易数量或他们作为客户的时长，我们需要与我们的利益相关者澄清问题的目的，以便我们知道应该关注哪些指标。
- en: In this case, the data provided does not contain this ambiguity; it is clear
    we are focusing on spending patterns across two predefined geographic areas. However,
    had our stakeholders asked us about which areas are underserved in general, we
    would also seek to understand whether we should look at data at a city level or
    a different level of granularity.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，提供的数据不包含这种歧义；很明显，我们关注的是两个预定义地理区域的支出模式。然而，如果我们的利益相关者询问我们哪些地区普遍服务不足，我们也会寻求了解是否应该查看城市层面的数据或不同粒度的数据。
- en: '![figure](../Images/2-unnumb-2.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-unnumb-2.png)'
- en: 'The crucial step in any analysis is to think of where we are going. What form
    will a minimum viable answer take? In this example, our stakeholders have two
    questions:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 任何分析中的关键步骤是考虑我们将走向何方。最小可行答案将采取什么形式？在这个例子中，我们的利益相关者有两个问题：
- en: '*Are different cities underserved?* This requires us to calculate total customer
    spending by city and find cities with the lowest customer spending.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*不同城市是否服务不足？* 这需要我们按城市计算总客户支出，并找出客户支出最低的城市。'
- en: '*How does London compare to the rest of the United Kingdom?* This can then
    be answered from the output of the first answer.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*伦敦与其他英国地区相比如何？* 这可以从第一个答案的输出中得到回答。'
- en: For a minimum viable answer to exist, we need to add a `city` column to our
    data, which we will extract from the address. This will allow us to have a breakdown
    of spending by city, meaning we could take the row for London and compare it against
    the rest of the table. As for the final output, a table or a bar chart will suffice
    for both cases. It may seem obvious, but knowing the exact format of our output
    will guide us toward a relevant solution, which is a table containing one row
    per city and an associated total spending figure.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 为了存在一个最小可行答案，我们需要在我们的数据中添加一个`城市`列，我们将从地址中提取它。这将使我们能够按城市细分支出，这意味着我们可以将伦敦的行与表格中的其余部分进行比较。至于最终输出，表格或条形图对于这两种情况都足够了。这看起来可能很明显，但了解我们输出的确切格式将引导我们找到相关的解决方案，即包含每个城市一行及其相关总支出金额的表格。
- en: '*![figure](../Images/2-unnumb-3.png)'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '*![figure](../Images/2-unnumb-3.png)'
- en: To tackle any analytical question, we need to know what data is required to
    answer it. To get city-level customer figures, we need data on which city each
    customer belongs to. This requires that each customer record has a `city` column,
    or at least some sort of address data, against it. We know in this case that an
    address field has been provided, so we have sufficient data to attempt the problem,
    even if we are unsure at this stage whether we can get a satisfactory answer.
    In this step, we also decide on additional data sources we might need. In this
    case, it might be to enhance the accuracy of our address data. Our first iteration
    should usually focus on the data we already have, and additional data sources
    can be considered in future iterations.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决任何分析问题，我们需要知道回答该问题需要哪些数据。为了获得城市级别的客户数据，我们需要知道每个客户属于哪个城市的数据。这要求每个客户记录都有一个`城市`列，或者至少有一些地址数据。我们知道在这种情况下，已经提供了地址字段，所以我们有足够的数据尝试解决这个问题，即使我们不确定在这个阶段是否可以得到令人满意的答案。在这个步骤中，我们还决定可能需要的额外数据源。在这种情况下，可能需要提高我们地址数据的准确性。我们的第一次迭代通常应该专注于我们已有的数据，而额外的数据源可以在未来的迭代中考虑。
- en: '![figure](../Images/2-unnumb-4.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-unnumb-4.png)'
- en: The step of acquiring data should not be underestimated. Entire data science
    initiatives have failed because the data science team never received any usable
    data to analyze. The obstacles to obtaining data are not technical but organizational,
    and it is one aspect of the real world we won’t simulate. Throughout the projects,
    you will not need to find any data yourself; it will be provided. It will not
    always be easy to clean, but you will not spend any time emailing someone in your
    organization and hoping for their goodwill to send you a data extract!
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 获取数据的步骤不应被低估。整个数据科学项目可能因为数据科学团队从未收到任何可用的数据来分析而失败。获取数据的障碍不是技术性的，而是组织性的，这是我们不会在现实世界中模拟的一个方面。在整个项目中，你不需要自己寻找任何数据；它将被提供。它可能不会总是容易清理，但你不会花时间去给组织中的某个人发邮件，希望他们的善意能发送给你数据提取！
- en: 2.2.2 Creating the first iteration of a solution
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.2.2 创建解决方案的第一迭代
- en: '![figure](../Images/2-unnumb-5.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-unnumb-5.png)'
- en: 'By this point, we have established the problem statement and obtained all necessary
    data. It is now time to explore the dataset before extracting the city component
    of each address and summarizing customer spending data by city. Let’s start by
    importing the necessary libraries and reading in the data:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经建立了问题陈述并获得了所有必要的数据。现在是时候在提取每个地址的城市成分和按城市汇总客户消费数据之前探索数据集了。让我们先导入必要的库并读取数据：
- en: '[PRE0]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The output is `(100000, 3)`, meaning we have a total of 100,000 rows of data
    and the three columns we saw in the data dictionary. Before extracting any city
    data, we should check for missing values.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 输出是 `(100000, 3)`，这意味着我们总共有100,000行数据，以及我们在数据字典中看到的三列。在提取任何城市数据之前，我们应该检查缺失值。
- en: Investigating missing values
  id: totrans-51
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 调查缺失值
- en: 'Depending on your tool of choice, attempting to extract data from empty addresses
    may yield errors. The output of the following code snippet is shown in figure
    2.2:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 根据你选择的工具，尝试从空地址中提取数据可能会产生错误。以下代码片段的输出显示在图2.2中：
- en: '[PRE1]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![figure](../Images/2-2.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-2.png)'
- en: Figure 2.2 A table showing the number of missing values per column
  id: totrans-55
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.2 展示每列缺失值的数量
- en: 'We can see there are 968 missing addresses, which is just under 1% of our rows.
    Since we have no way of knowing the addresses of those missing customers just
    from the data provided, we can safely drop these rows:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到有968个缺失的地址，这大约是行总数的1%。由于我们无法仅从提供的数据中知道那些缺失客户的地址，我们可以安全地删除这些行：
- en: '[PRE2]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: What percentage of rows is acceptable to drop will depend on the context, but
    losing 1% due to missing key information is fine. If, say, 10% of our customers
    had missing addresses, we might want to examine why.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 可以接受的行缺失百分比将取决于上下文，但由于缺失关键信息而丢失1%是可以接受的。如果我们有10%的客户地址缺失，我们可能想调查一下原因。
- en: However, this is a point where analyses might diverge. The missing address data
    could either be kept and categorized simply as “Other” or, if we had more customer-related
    data, we may choose to spend the time looking up a customer’s address elsewhere
    to get a more complete dataset.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这是一个分析可能分叉的点。缺失的地址数据可以保留并简单地分类为“其他”，或者如果我们有更多与客户相关的数据，我们可能选择花时间在其他地方查找客户的地址，以获得更完整的数据集。
- en: There are many places in an analysis where there is no definitive right decision,
    only different decisions based on different assumptions. Because of this, your
    analysis will diverge from mine at various points. Figure 2.3 illustrates this
    branching of possible paths in a diagram, which I will use heavily to reiterate
    this point.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在分析中，有许多地方没有明确的正确决策，只有基于不同假设的不同决策。正因为如此，你的分析将在多个地方与我分叉。图2.3通过图表展示了可能的路径分支，我将大量使用这个图表来重申这一点。
- en: '![figure](../Images/2-3.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-3.png)'
- en: Figure 2.3 The first step of the analysis and its alternative paths visualized
  id: totrans-62
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.3 分析的第一步及其替代路径的可视化
- en: 'There are two types of shapes: steps and decisions. Steps represent sequential
    tasks to be undertaken in the analysis. These come from the original action plan
    but may also be informed by what we find in the data. Decisions represent places
    where the analysis might diverge, depending on the assumptions and choices made.
    Your analysis will not necessarily contain the same steps or the same decisions
    as mine.'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 形状有两种类型：步骤和决策。步骤代表在分析中需要执行的顺序任务。这些步骤来自原始行动计划，但也可能受到我们在数据中发现的信息的影响。决策代表分析可能因假设和选择而分叉的地方。你的分析不一定包含与我相同的步骤或决策。
- en: 'While we are exploring our columns, we should also check if our `total_spend`
    column contains any strange values, such as negatives. The output of the following
    code snippet is shown in figure 2.4:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们在探索我们的列时，我们还应该检查我们的`total_spend`列是否包含任何奇怪值，例如负值。以下代码片段的输出显示在图2.4中：
- en: '[PRE3]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![figure](../Images/2-4.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-4.png)'
- en: Figure 2.4 Summary statistics of the `total_spend` column
  id: totrans-67
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.4 `total_spend`列的汇总统计
- en: 'As the figure shows, the values range from 0 to just under £12,000 with no
    negative values. Now that we have seen our data, we need to decide on an approach
    to extract the information about cities. Let’s think back to our two stakeholder
    questions: “Are different cities underserved?” and “How does London compare to
    the rest of the United Kingdom?” The second question is a subset of the first.
    That is, once you have a dataset of customer spending by city, it is easy to compare
    London against other cities. To solve one question means solving the other, so
    if we start by focusing on identifying addresses in London first, we can find
    the nuances and edge cases of how addresses are represented.'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 如上图所示，数值范围从0到略低于12,000英镑，没有负值。现在我们已经看到了我们的数据，我们需要决定一个方法来提取有关城市的信息。让我们回顾一下我们的两个利益相关者问题：“不同的城市是否被服务不足？”以及“伦敦与其他英国地区相比如何？”第二个问题是第一个问题的子集。也就是说，一旦你有了按城市划分的客户消费数据集，比较伦敦与其他城市就很容易了。解决一个问题意味着解决另一个问题，所以如果我们首先专注于识别伦敦的地址，我们就可以找到地址表示的细微差别和边缘情况。
- en: Extracting city column from addresses
  id: totrans-69
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 从地址中提取城市列
- en: 'Before deciding on a method, we should look at some sample addresses. The following
    code prints the first five addresses, the output of which is shown in figure 2.5:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在决定方法之前，我们应该查看一些样本地址。以下代码打印出前五个地址，其输出显示在图2.5中：
- en: '[PRE4]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![figure](../Images/2-5.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-5.png)'
- en: Figure 2.5 Five sample addresses
  id: totrans-73
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.5 五个样本地址
- en: We can already notice some patterns, as well as some potential pitfalls. From
    our limited sample, it appears that addresses end with the postcode, but sometimes
    London addresses contain a line for England, and sometimes they don’t. This means
    we cannot rely on looking at a specific row of an address to give us the city,
    which is useful information.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经可以注意到一些模式，以及一些潜在的陷阱。从我们的有限样本来看，地址似乎以邮编结束，但有时伦敦地址包含一行英格兰，有时则不包含。这意味着我们不能依赖于查看地址的特定行来给我们城市的信息，这是有用的信息。
- en: 'What about looking for the string “London” to identify customers in London?
    Would that be sufficient? Probably not. You would end up including people who
    live on “London Road” in other towns, for a start. Examining the data, we can
    see that address lines are separated by a comma and a new line character, so looking
    for `"LONDON,"` could alleviate this particular problem. Note the extra comma
    in the search string. Our rule could simply be the following: if one of the rows
    of an address is “London,” then that address is a London one. In our sample, all
    addresses were uppercase, but we should not assume this will be the case for all
    100,000 rows, so we should ensure they are all uppercase ourselves. To compare
    our cleaned address data with the original, we will create a new column to store
    the cleaned version. It is usually a good idea to keep data in its raw form somewhere
    to reference as needed:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，寻找字符串“London”来识别伦敦的客户怎么样？这会足够吗？可能不会。首先，你可能会包括住在其他城镇的“London Road”上的人。检查数据，我们可以看到地址行由逗号和换行符分隔，因此寻找
    `"LONDON,"` 可以缓解这个特定问题。注意搜索字符串中的额外逗号。我们的规则可以简单地是以下这样：如果一个地址的某一行是“London”，那么这个地址就是伦敦的地址。在我们的样本中，所有地址都是大写，但我们不应假设所有
    100,000 行都会是这样，因此我们应该确保它们都是大写的。为了比较我们的清洗后的地址数据与原始数据，我们将创建一个新列来存储清洗后的版本。通常，将数据保留在原始形式以便需要时参考是一个好主意：
- en: '[PRE5]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Now that we have ensured that the casing is consistent, we can investigate
    the difference between looking for `"LONDON"` and `"LONDON,"`:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经确保了大小写的一致性，我们可以调查寻找 `"LONDON"` 和 `"LONDON,"` 之间的差异：
- en: '[PRE6]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The output of these lines of code is `21,768` and `20,831`, respectively, which
    means nearly 1,000 rows are no longer selected when we add the commas. Those are
    the addresses that contain the word London, but we assume are not, in fact, in
    the city of London (e.g., addresses on London Road). We have already seen from
    our sample addresses that we cannot rely on the position of a row to decide where
    the city component is. However, there may only be a finite number of address structures.
    Let’s look at how many addresses consist of how many rows. The output of this
    code is shown in figure 2.6:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 这些代码行的输出分别是 `21,768` 和 `20,831`，这意味着当我们添加逗号时，将近 1,000 行不再被选中。这些是包含单词“London”的地址，但我们假设实际上它们并不在伦敦市（例如，位于伦敦路的地址）。我们已经从我们的样本地址中看到，我们不能依赖于行的位置来决定城市成分的位置。然而，地址结构可能只有有限的数量。让我们看看有多少地址由多少行组成。此代码的输出如图
    2.6 所示：
- en: '[PRE7]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '#1 Splits an address into a list of substrings (i.e., separate the rows)'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 将地址拆分为子字符串列表（即分离行）'
- en: '#2 Counts the length of each list (i.e., the number of rows in the address)'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 计算每个列表的长度（即地址中的行数）'
- en: '#3 Now counts how many addresses are made of how many rows'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 现在计算由多少行组成的地址数量'
- en: '![figure](../Images/2-6.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-6.png)'
- en: Figure 2.6 Distribution of address lengths
  id: totrans-85
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 2.6 地址长度的分布
- en: 'We can observe that some addresses consist of only one or two lines, and some
    have as many as six. In theory, if every three-line, four-line, five-line, and
    so forth address is consistent, we could come up with a rule to extract the city
    slightly differently from each. We should also examine some of these shorter addresses
    to see what they look like. The output of this code is shown in figures 2.7 and
    2.8, respectively:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以观察到，一些地址只有一行或两行，而一些地址多达六行。理论上，如果每三行、四行、五行等地址都是一致的，我们就可以制定一个规则，从每个地址中提取城市的方式略有不同。我们还应该检查一些这些较短的地址，看看它们是什么样子。此代码的输出分别如图
    2.7 和 2.8 所示：
- en: '[PRE8]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '#1 Looks at five random rows that have only two lines of address. The random_state
    parameter ensures we get the same results each time for reproducibility.'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 查看只有两行地址的五个随机行。random_state 参数确保我们每次都能得到相同的结果，以保证可重复性。'
- en: '![figure](../Images/2-7.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-7.png)'
- en: Figure 2.7 All the one-line addresses in our data
  id: totrans-90
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 2.7 我们数据中所有的单行地址
- en: '![figure](../Images/2-8.png)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-8.png)'
- en: Figure 2.8 A sample of five rows of two-line address data
  id: totrans-92
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 2.8 两行地址数据的五个样本行
- en: These figures show the variability of our data. Some rows are simply a city,
    Falkirk; there are entirely missing addresses referring us to a parent registry;
    and we also have PO Box addresses. It is unlikely we can come up with a rule to
    extract cities purely based on their position in the lines of an address without
    writing a lot of bespoke code.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 这些图显示了数据的可变性。有些行只是一个城市，福尔柯克；有些行完全缺失地址，指引我们到一个父注册处；我们还有邮政信箱地址。我们不太可能仅基于地址行中的位置制定出提取城市的规则，而不编写大量的定制代码。
- en: 'Let’s remind ourselves of our goal: our immediate task is to create a `city`
    column, and we now have to decide how to proceed. One option is to take our London-finding
    example and extend it by explicitly looking for city names in the `address` column.
    This would require a comprehensive list of cities in the United Kingdom, which
    is not an impossible task. Such lists exist—for example, the list available at
    [https://mng.bz/5gKB](https://mng.bz/5gKB) is provided by the UK government. In
    this case, we would still need to decide what to do with addresses that fall outside
    of these cities. Do we simply label them “Other”? For a first iteration, this
    may suffice, as the question was specifically asking about cities, not towns or
    villages.'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们再次提醒自己我们的目标：我们的直接任务是创建一个 `城市` 列，我们现在必须决定如何进行。一个选项是采用我们的伦敦查找示例，并通过在 `地址` 列中显式查找城市名称来扩展它。这需要一份英国城市的综合列表，这并不是一个不可能的任务。这样的列表是存在的——例如，[https://mng.bz/5gKB](https://mng.bz/5gKB)
    上的列表是由英国政府提供的。在这种情况下，我们仍然需要决定如何处理位于这些城市之外地址的情况。我们是否简单地将其标记为“其他”？对于第一次迭代，这可能足够了，因为问题特别询问的是城市，而不是镇或村庄。
- en: Another option is to use the postcode component of each address and look it
    up against a national postcode database, which we would have to obtain and ensure
    we are allowed to use. This might be a more accurate method but would require
    additional work, such as identifying the postcode component of each address in
    the first place.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个选项是使用每个地址的邮政编码部分，并在国家邮政编码数据库中进行查找，我们必须获取并确保我们有权限使用它。这可能是一种更准确的方法，但需要额外的工作，例如首先识别每个地址的邮政编码部分。
- en: In general, we should err on the side of less effort for our first iteration,
    so we will attempt to use the list of cities in the UK provided by the UK government.
    The web page consists of a bulleted list of cities for each country of the United
    Kingdom, an extract of which is shown in figure 2.9.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，在我们的第一次迭代中，我们应该尽量减少工作量，因此我们将尝试使用英国政府提供的英国城市列表。网页包含每个英国国家的城市列表，其中一部分如图 2.9
    所示。
- en: '![figure](../Images/2-9.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-9.png)'
- en: Figure 2.9 An extract of the UK government's web page listing all the cities
    in the United Kingdom
  id: totrans-98
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 2.9 英国政府网页上列出的所有英国城市摘录
- en: 'There are multiple ways to extract these into a code-friendly form. The simplest
    one is to copy and paste the bullet points from the website directly into Excel,
    so each city is on a separate line, and then import and clean the data in our
    code. The quickest option isn’t always to write code! However, for full reproducibility,
    you may want to automate that step. Obtaining this data manually will suit us
    here since we don’t expect the list of UK cities to change very often. This raw
    data is provided in the accompanying materials as a separate file called `cities.csv`.
    The first few rows of this data are shown in figure 2.10:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 有多种方法将这些信息提取成代码友好的格式。最简单的一种是将网站上的项目符号直接复制粘贴到 Excel 中，这样每个城市就单独占一行，然后我们可以在代码中导入并清理这些数据。最快的选项并不总是编写代码！然而，为了确保完全可重复性，你可能希望自动化这一步骤。由于我们预计英国城市的列表不会经常变化，手动获取这些数据在这里是合适的。这些原始数据作为单独的文件提供，文件名为
    `cities.csv`。这些数据的前几行如图 2.10 所示：
- en: '[PRE9]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![figure](../Images/2-10.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-10.png)'
- en: Figure 2.10 The first few rows of city data
  id: totrans-102
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 2.10 城市数据的前几行
- en: 'There are clearly some aspects of this data to clean before using it as a definitive
    list of cities. First, the country headings were included as rows in the data,
    so the values `England`, `Scotland`, `Wales`, and `Northern` `Ireland` need to
    be removed. Then, the trailing asterisk `*` character also needs to be trimmed,
    and the remaining city names should be uppercased to match our address data. Figure
    2.11 shows a sample of our final, cleaned city list:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用它作为城镇的最终列表之前，显然需要清理一些数据。首先，国家标题被包含在数据中的行中，所以需要移除值`England`、`Scotland`、`Wales`和`Northern
    Ireland`。然后，需要修剪尾随的星号`*`字符，剩余的城镇名应该大写以匹配我们的地址数据。图2.11显示了我们的最终、清洗后的城镇列表样本：
- en: '[PRE10]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![figure](../Images/2-11.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-11.png)'
- en: Figure 2.11 A sample of our cleaned, definitive city list
  id: totrans-106
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.11 我们清洗后的、确定的城镇列表样本
- en: Now that we have our definitive list of cities, we can use it to create the
    `city` column. Figure 2.12 shows the work we have done so far and the alternatives
    in our most recent step.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了确定的城镇列表，我们可以用它来创建`city`列。图2.12显示了我们所做的工作以及我们最近步骤中的替代方案。
- en: '![figure](../Images/2-12.png)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-12.png)'
- en: Figure 2.12 Diagram of the analysis so far after two main steps
  id: totrans-109
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.12 分析到目前为止的两个主要步骤后的分析图
- en: Creating a city column
  id: totrans-110
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 创建城镇列
- en: 'We can use our city list to tag an address with a particular city if that city
    name and an additional comma are found somewhere in the address. Using figure
    2.11 as an example, we will assume that an address that contains the substring
    `"BATH,"` is an address in the city of Bath, so the value in the `city` column
    will be `"BATH"`. Anything where this newly created `city` column doesn’t have
    a value, where none of the city names was found in the address, will be categorized
    as `"OTHER"`. The following code achieves this, and figure 2.13 shows the latest
    state of our data:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在地址中找到某个城市名和额外的逗号，我们可以使用我们的城镇列表来标记一个特定城市的地址。以图2.11为例，我们将假设包含子字符串“`BATH,`”的地址是巴斯市的地址，因此`city`列中的值将是“`BATH`”。任何新创建的`city`列没有值，地址中没有找到任何城市名的地方，将被归类为“`OTHER`”。以下代码实现了这一点，图2.13显示了我们数据的最新状态：
- en: '[PRE11]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![figure](../Images/2-13.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-13.png)'
- en: Figure 2.13 An extract of the data with a newly added `city` column
  id: totrans-114
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.13 带有新添加的`city`列的数据摘录
- en: Now that we have our new `city` column, we need to explore it to see which cities
    our customers are in and what proportion of our customers we weren’t able to allocate
    to a city based on their address.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了新的`city`列，我们需要探索它，看看我们的客户在哪些城市，以及根据他们的地址，我们无法将多少客户分配到城市的比例。
- en: Exploring the new city column
  id: totrans-116
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 探索新的城镇列
- en: 'Based on figure 2.13, it looks like we have correctly categorized the London
    and Bristol addresses from the first five rows, and put the rest in the “Other”
    category. We can now do our first piece of analysis by counting how many customers
    appear in each city, according to our categorization. Let’s look at the top 20,
    which are shown in figure 2.14:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 根据图2.13，看起来我们已经正确地将前五行中的伦敦和布里斯托尔地址归类，并将其余的归入“其他”类别。现在我们可以通过计算每个城市中出现的客户数量来进行我们的第一次分析，根据我们的分类。让我们看看图2.14中显示的前20个：
- en: '[PRE12]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![figure](../Images/2-14.png)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-14.png)'
- en: Figure 2.14 The top 20 cities by number of customers
  id: totrans-120
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.14 按客户数量排名前20的城市
- en: 'Over half of our data is in the “Other” category, which means half of our customer
    base is established outside of major cities. This is an important insight to communicate
    to our stakeholders. Let’s look at some addresses from this category, as shown
    in figure 2.15:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的数据中超过一半属于“其他”类别，这意味着我们的一半客户群是在大城市之外建立的。这是一个需要向我们的利益相关者传达的重要见解。让我们看看这个类别中的一些地址，如图2.15所示：
- en: '[PRE13]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![figure](../Images/2-15.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-15.png)'
- en: Figure 2.15 A sample of addresses whose city is categorized as “Other”
  id: totrans-124
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.15 被归类为“其他”的城镇的地址样本
- en: Some of these addresses relate to towns, but there is an address in Twickenham,
    which is a suburban district in London. While the address did not contain the
    word “London,” that customer should be categorized as being London based. We can
    already see some of the shortfalls of our chosen approach. At this point, we note
    them down and may consider tackling them in a future iteration.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 其中一些地址与城镇相关，但在特威肯汉姆有一个地址，它是伦敦的一个郊区。虽然这个地址没有包含“伦敦”这个词，但这位客户应该被归类为伦敦本地。我们已经开始看到我们选择的方法的一些不足之处。在这个阶段，我们将它们记下来，并可能在未来的迭代中解决它们。
- en: Note  Unless you have knowledge of UK geography, you may miss these instances
    of London addresses without the word “London” in them. This highlights how important
    domain knowledge is for an analyst and why you should work closely with domain
    experts.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：除非你了解英国地理，否则你可能错过这些没有“London”一词的伦敦地址实例。这突出了领域知识对分析师的重要性以及为什么你应该与领域专家密切合作。
- en: 'One sanity check at this point is to see how many unique cities are in the
    government data and our tagged address data. Depending on the business, we might
    assume that we have at least one customer in every major UK city, and we can verify
    this. A Python trick is to create a unique set of the government’s city list and
    the list of unique cities in our new `city` column and subtract one set from the
    other. This will give us the difference between the lists, that is, cities that
    appear in the government list but not in our address data:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 此时的一个合理性检查是查看政府数据和我们的标记地址数据中有多少独特的城市。根据业务，我们可能假设我们在每个主要英国城市至少有一个客户，我们可以验证这一点。Python的一个技巧是创建政府城市列表和我们的新`city`列中独特城市列表的唯一集合，并从其中一个集合中减去另一个。这将给出两个列表之间的差异，即出现在政府列表中但不在我们的地址数据中的城市：
- en: '[PRE14]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '#1 Subtracting sets in Python means finding items in one list that aren’t in
    another.'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 在Python中，减去集合意味着找出一个列表中不在另一个列表中的项目。'
- en: 'The output of this code is the string `{''KINGSTON-UPON-HULL''}`, which tells
    us that the city Kingston-upon-Hull is not in the `city` column of our customer
    address data. This either means we have no customers there, which is not impossible
    given its population is only around 250,000, or there is something else going
    on. The city is usually abbreviated to just “Hull,” which again is a case of applying
    specific domain knowledge to the problem, so let’s look for that in our address
    data:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 此代码的输出是字符串`{'KINGSTON-UPON-HULL'}`，这告诉我们城市Kingston-upon-Hull不在我们的客户地址数据的`city`列中。这可能意味着我们那里没有客户，考虑到其人口只有大约25万，这是可能的，或者还有其他情况。该城市通常简称为“Hull”，这又是一个将特定领域知识应用于问题的例子，因此让我们在我们的地址数据中查找它：
- en: '[PRE15]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'The output of this code tells us there are 284 relevant records. We can manually
    update our `city` column to fix this problem:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 此代码的输出告诉我们有284条相关记录。我们可以手动更新我们的`city`列以解决这个问题：
- en: '[PRE16]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Let’s again review our analysis so far. The work we have done and the alternative
    steps are shown in figure 2.16.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们再次回顾到目前为止的分析。我们已完成的工作和替代步骤如图2.16所示。
- en: '![figure](../Images/2-16.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-16.png)'
- en: Figure 2.16 The current progress of our analysis
  id: totrans-136
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.16 我们分析目前的进度
- en: We can now finally take a look at spending figures by city using the newly created
    `city` column.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以查看使用新创建的`city`列的城市消费数据了。
- en: Analyzing spending by city
  id: totrans-138
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 分析按城市消费
- en: 'The hard work was getting the data into the correct format; the analysis itself
    is a simple grouping and aggregation. The output chart is shown in figure 2.17:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 严谨的工作是将数据整理成正确的格式；分析本身只是一个简单的分组和汇总。输出图表如图2.17所示：
- en: '[PRE17]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '#1 Defines a function to show figures in millions'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 定义一个函数以显示百万为单位的数据'
- en: '#2 Sorts by descending total spending to get the top 20 highest spenders (required
    for the analysis)'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 按总消费额降序排序以获取前20位最高消费者（分析所需）'
- en: '#3 Now sorts in the opposite direction to make our horizontal bar chart have
    the highest numbers at the top (required for the Python plot)'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 现在按相反方向排序，使我们的水平条形图顶部显示最高数字（Python绘图所需）'
- en: '![figure](../Images/2-17.png)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/2-17.png)'
- en: Figure 2.17 Total customer spending by city
  id: totrans-145
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.17 各城市总消费额
- en: It is clear that the “Other” category dominates. As we have seen before, our
    customers are just as likely to be based outside of a major city. This is partly
    down to how cities are defined in the United Kingdom. There are only 76 that are
    officially called “cities,” but there are many “towns” with significant populations.
    This distinction between towns and cities partly explains why the “Other” category
    is so large.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 很明显，“其他”类别占主导地位。正如我们之前看到的，我们的客户同样可能在主要城市之外。这部分是由于英国对城市的定义。只有76个被官方称为“城市”，但有许多人口众多的“镇”。城镇与城市之间的这种区别部分解释了为什么“其他”类别如此之大。
- en: Another observation is that London does indeed come out as the top city in terms
    of customer spending, as well as the number of customers. The next largest cities
    in terms of spending, Manchester and Birmingham, are also the next largest by
    population. The top cities in both this chart and our customer volume calculation
    in figure 2.14 generally correspond to the top cities by population. Leeds is
    perhaps lower than you would expect based on its population, but there is no reason
    customer spending figures should correlate perfectly with population.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个观察结果是，伦敦确实在客户消费和客户数量方面都是最高的城市。在消费方面排名第二和第三的城市，曼彻斯特和伯明翰，也是人口最多的城市。在这张图表和图2.14中我们的客户量计算中，顶级城市通常与人口最多的城市相对应。利兹可能低于你根据其人口预期的水平，但没有任何理由说客户消费数字应该与人口完美相关。
- en: 'Our final inquiry is to compare London against the rest of the United Kingdom.
    We can take this to mean either “all of the United Kingdom that isn’t London”
    or “all major cities except London.” We should calculate both figures and decide
    how to report our findings:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 我们最后的调查是对伦敦与其他英国地区的比较。我们可以将其理解为“除了伦敦以外的所有英国”或“除了伦敦以外的所有主要城市”。我们应该计算这两个数字并决定如何报告我们的发现：
- en: '[PRE18]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: The output of this code tells us the total spending across our customers was
    £490M. This breaks down into £103M for London customers and £387M for the rest
    of the United Kingdom. If we look at all major cities outside London, the total
    is £119M. That is, if we compare London to other cities, we can see that our London
    customers generate nearly as much revenue as all other major cities combined.
    It does appear that our customer base is London-centric.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码的输出告诉我们，我们客户的总消费为4.9亿英镑。这分解为伦敦客户的1.03亿英镑和英国其他地区的3.87亿英镑。如果我们看伦敦以外的所有主要城市，总数为1.19亿英镑。也就是说，如果我们将伦敦与其他城市比较，我们可以看到我们的伦敦客户产生的收入几乎与其他所有主要城市之和相当。确实看起来我们的客户基础是以伦敦为中心的。
- en: This gets us our minimum viable answer, except we haven’t fully answered the
    question of whether certain cities are underserved. Figure 2.17 shows us that
    the largest cities produce the highest amount of customer spend. To understand
    whether a city is being underserved, we would need to know more about what we
    would base that on. This would require a conversation with our stakeholders to
    understand whether they are missing any cities they expected to see among the
    highest-spending ones shown in figure 2.17\. Before we move on, let’s review all
    the steps we took in this analysis (figure 2.18).
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 这为我们提供了最小可行答案，但我们还没有完全回答某些城市是否被忽视的问题。图2.17显示，最大的城市产生了最高的客户消费。要了解一个城市是否被忽视，我们需要知道更多关于我们基于什么来评估的信息。这需要与我们的利益相关者进行对话，了解他们是否遗漏了他们在图2.17中期望看到的高消费城市。在我们继续之前，让我们回顾一下我们在这次分析中采取的所有步骤（图2.18）。
- en: '![figure](../Images/2-18.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-18.png)'
- en: Figure 2.18 The final analysis steps visualized
  id: totrans-153
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图2.18 最终分析步骤的可视化
- en: At the end of this process, we have our minimum viable answer, and we’re ready
    to bring it to our stakeholders.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个过程的最后，我们得到了我们的最小可行答案，并且我们准备将其带给我们的利益相关者。
- en: 2.2.3 Review and future steps
  id: totrans-155
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.2.3 审查和未来步骤
- en: '![figure](../Images/2-unnumb-6.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-unnumb-6.png)'
- en: After cleaning our data and extracting city information, we have arrived at
    an answer to our analytical questions. Our customers spend the most in bigger
    cities since there are generally more customers in larger cities, and London generates
    nearly as much income as all the other cities combined. This insight, coupled
    with the table in figure 2.14 and the chart from figure 2.17, would fit on one
    or two slides to present to our stakeholders.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 在清理我们的数据并提取城市信息后，我们得到了对分析问题的答案。我们的客户在大城市花费最多，因为大城市通常有更多的客户，而伦敦产生的收入几乎与其他所有城市之和相当。这个见解，结合图2.14中的表格和图2.17中的图表，可以放在一两个幻灯片上向我们的利益相关者展示。
- en: When presenting, we should be clear about the caveats of our analysis; namely,
    that not all addresses are in a format that allows us to extract the city correctly,
    at least with the method we have chosen. Another caveat is we have used the government’s
    list of cities, which excludes larger towns that our stakeholders may be interested
    in. We would make it clear to our stakeholders that further work is possible to
    make our city-level figures more accurate. However, we would need to understand
    the business value of spending more time arriving at a more accurate figure when
    it might not change the overall result.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在展示时，我们应该清楚地说明我们分析的限制；即，并非所有地址都采用允许我们正确提取城市的格式，至少在我们选择的方法中是这样。另一个限制是我们使用了政府的城市名单，该名单排除了我们的利益相关者可能感兴趣的较大城镇。我们会向我们的利益相关者明确表示，可以进行进一步的工作，以使我们的城市级别数据更加准确。然而，我们需要了解在可能不会改变整体结果的情况下，花费更多时间来获得更准确的数据的业务价值。
- en: '![figure](../Images/2-unnumb-7.png)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/2-unnumb-7.png)'
- en: After presenting our results, our stakeholders may want us to continue the analysis
    and get a more comprehensive answer. What could we do to improve our solution?
    Perhaps, as we have discussed, we could identify the city or town an address refers
    to by identifying the postcode. Well, for that, we need a comprehensive list of
    UK postcodes, the assumption that all values in the “customer address” field contain
    postcodes, and the assumption that we can find the postcode every time. Another
    option is to expand our current city list to include towns above a certain population.
    However, this would not solve the problem where sometimes the name of the city
    or town is not in the address.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 在展示我们的结果后，我们的利益相关者可能希望我们继续分析并得到一个更全面的答案。我们如何改进我们的解决方案？也许，正如我们讨论的那样，我们可以通过识别邮编来识别地址所指的城市或城镇。嗯，为此，我们需要一个全面的英国邮编列表，假设“客户地址”字段中的所有值都包含邮编，以及假设我们每次都能找到邮编。另一个选择是将我们当前的城镇名单扩展到包括一定人口以上的城镇。然而，这并不能解决有时城市或城镇的名称不在地址中的问题。
- en: Another option is to send these addresses to a third-party geocoding system,
    such as the Google Maps API, which would find the best match for an address we
    provide, and the resulting data would contain a field for the town/city that we
    could use. However, this particular option raises privacy concerns. Do we want
    to send all our customers’ addresses to a third party? Are we even allowed to
    do that?
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个选择是将这些地址发送到第三方地理编码系统，例如 Google Maps API，该系统将为我们提供的地址找到最佳匹配项，并且结果数据将包含一个我们可以使用的城镇/城市字段。然而，这个特定的选项引发了隐私问题。我们是否希望将所有客户的地址发送给第三方？我们甚至是否有权这样做？
- en: Finally, we could augment our data with population statistics or even demographic
    information about each city or town. This could help us understand whether there
    are cities where customers are spending less than expected based on their city’s
    population and are, therefore, being underserved. This was one of our stakeholders’
    initial concerns, and this would be one way to address it further.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们可以通过人口统计数据或甚至每个城市或城镇的人口统计数据来增强我们的数据。这可以帮助我们了解是否存在客户在根据其城市人口预期花费较少的城市，因此受到服务不足的情况。这是我们利益相关者最初的担忧之一，这也是进一步解决这一问题的方法之一。
- en: You can start to see how many additional considerations are involved in solving
    a real business problem. This is why it is vital to arrive at a viable solution
    as soon as possible so that these additional possibilities are only considered
    if there is tangible business value in doing so. The value of any further work
    should be decided in collaboration with key stakeholders.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以开始看到解决一个真实商业问题涉及多少额外的考虑。这就是为什么尽快找到一个可行的解决方案至关重要，这样这些额外的可能性只有在这样做具有实际商业价值时才予以考虑。任何进一步工作的价值都应在与关键利益相关者的合作中决定。
- en: 'Activity: Further project ideas with this data'
  id: totrans-164
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 活动：使用这些数据进一步的项目想法
- en: 'In each project chapter, I encourage you to think of other possible research
    questions to answer with this data, unrelated to the specific chapter project.
    This is an exercise to help you make your solution really your own and let it
    stand out in a portfolio. Here are some ideas to get you started:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在每个项目章节中，我鼓励你考虑其他可能的研究问题，用这些数据来回答，这些问题与特定章节项目无关。这是一个练习，帮助你使你的解决方案真正属于你，并使其在作品集中脱颖而出。以下是一些帮助你开始的想法：
- en: What do customer spending figures look like at different levels of granularity?
    You would need to either dig down into subcity levels, such as boroughs, or figure
    out how to group addresses that belong to the same geographic region (e.g., South
    West England).
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户消费数据在不同粒度级别上看起来是什么样子？你可能需要深入到次城市级别，例如区，或者找出如何将属于同一地理区域（例如，西南英格兰）的地址分组的方法。
- en: Can you identify business addresses and consider comparing customers with private
    addresses versus those with business addresses?
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你能否识别商业地址，并考虑比较拥有私人地址的客户与拥有商业地址的客户？
- en: Augment your geographic analysis with population figures or other demographics.
    Are there any patterns, such as a relationship between the wealth of an area and
    the amount of customer spend? You could also calculate “spending per capita” for
    each city and see if that varies across the country.
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用人口数据或其他人口统计信息增强你的地理分析。是否存在任何模式，例如一个地区的财富与客户消费金额之间的关系？你也可以计算每个城市的“人均消费”并查看它在整个国家中是否有所变化。
- en: 2.3 How to use the rest of the book
  id: totrans-169
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.3 如何使用本书的其余部分
- en: This chapter introduced both a specific example of the results-driven approach
    in practice and the format of all the projects. Each project throughout your career
    will require you to
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了实践中以结果为导向的方法的具体示例以及所有项目的格式。在你整个职业生涯中，每个项目都将要求你
- en: Ensure you understand the problem
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保你理解了问题
- en: Think about the end goal you are working toward
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 思考你正在努力实现的目标
- en: Consider whether you have the right data
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 考虑你是否拥有正确的数据
- en: Identify the caveats you would need to flag when presenting your findings
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别在展示你的发现时需要标记的注意事项
- en: Document what further work is possible once you have arrived at a minimum viable
    answer
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 记录在得到最小可行答案后可能进行的进一步工作
- en: Each of this book’s projects addresses a different topic you will encounter
    in real-world analytical projects, and they will all follow the same flow as the
    one in this chapter.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 本书中的每个项目都针对你在现实世界的分析项目中会遇到的不同主题，并且它们都将遵循本章中相同的流程。
- en: Summary
  id: totrans-177
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Using a results-driven approach helps focus on the specific problem you are
    solving.
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 采用以结果为导向的方法有助于集中精力解决具体问题。
- en: Part of the results-driven approach is to ensure you understand the problem
    before starting the analysis.
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以结果为导向的方法的一部分是确保在开始分析之前你理解了问题。
- en: Envisioning the end result at the start creates a goal to work toward.
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在开始分析之前就设想最终结果可以创建一个目标去努力实现。
- en: There are multiple possible approaches to extracting the city part of a free-type
    address, each with its pros and cons.
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提取自由格式地址中的城市部分有多个可能的方法，每种方法都有其优缺点。
- en: Analyses will diverge depending on the choices and assumptions made; therefore,
    it is possible to get different, but still correct, results.
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析结果将根据所做的选择和假设而有所不同；因此，可能得到不同的，但仍然正确的结果。
- en: Even seemingly smaller tasks, such as extracting city information from address
    data, benefit from a results-driven approach by helping focus on a valuable outcome.*
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 即使是看似较小的任务，例如从地址数据中提取城市信息，也能通过帮助关注有价值的成果而受益。*
