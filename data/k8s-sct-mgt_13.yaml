- en: Appendix B. Installing and configuring yq
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录 B. 安装和配置 yq
- en: Most operating systems have built-in support for manipulating text within the
    terminal, such as sed and awk. These tools are great for fairly simple text manipulations
    but can become cumbersome when working with structured serialization languages,
    such as YAML. `yq` ([https://mikefarah.gitbook.io/yq](https://mikefarah.gitbook.io/yq))
    is a command-line tool that provides support for querying and manipulating YAML-based
    content and can be helpful when interacting with Kubernetes environments, as the
    majority of the resources are expressed in YAML format. A similar and popular
    tool, called `jq`, provides similar capabilities for JSON-formatted content, which
    is described in chapter 4\. This appendix describes the installation of `yq`,
    along with several examples to confirm the successful installation of the tool.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数操作系统都内置了对终端内文本操作的支持，例如 sed 和 awk。这些工具非常适合进行相对简单的文本操作，但在处理结构化序列化语言（如 YAML）时可能会变得繁琐。`yq`
    ([https://mikefarah.gitbook.io/yq](https://mikefarah.gitbook.io/yq)) 是一个命令行工具，它提供了查询和操作基于
    YAML 内容的支持，并且在与 Kubernetes 环境交互时非常有用，因为大部分资源都是以 YAML 格式表达的。另一个类似且流行的工具，称为 `jq`，为
    JSON 格式的内容提供了类似的功能，这在第 4 章中有描述。本附录描述了 `yq` 的安装，以及一些示例来确认工具安装成功。
- en: B.1 Installing yq
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: B.1 安装 yq
- en: '`yq` is supported on multiple operating systems and can be installed using
    a variety of methods, including a package manager or as a direct binary download
    from the project website ([https://github.com/mikefarah/yq/releases/latest](https://github.com/mikefarah/yq/releases/latest)).
    The direct binary option is the most straightforward option, as there are no external
    dependencies or prerequisites needed. Be sure to locate version 4 or higher of
    the tool, as there was a significant rewrite from prior versions. The Releases
    page will allow you to choose between downloading a compressed archive or the
    direct binary. Alternatively, you can use the terminal to download the binary
    to your local machine.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '`yq` 支持多个操作系统，可以使用多种方法进行安装，包括包管理器或直接从项目网站 ([https://github.com/mikefarah/yq/releases/latest](https://github.com/mikefarah/yq/releases/latest))
    下载二进制文件。直接二进制选项是最直接的方法，因为它没有外部依赖或先决条件。请确保找到版本 4 或更高版本的工具，因为与先前版本相比，它进行了重大重写。发布页面将允许您选择下载压缩归档或直接二进制文件。或者，您可以使用终端将二进制文件下载到本地机器。'
- en: WarninG There is another tool, also called `yq`, which is available as a Python
    package and performs similar capabilities. Installing the incorrect tool will
    cause errors, as there are differences in the syntax and functionality between
    the two tools.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 警告：还有一个工具，也称为 `yq`，它作为一个 Python 包提供，并具有类似的功能。安装错误的工具会导致错误，因为这两个工具在语法和功能上存在差异。
- en: 'The following command can be used to download the `yq` binary and place the
    binary in a directory on the `PATH`:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用以下命令下载 `yq` 二进制文件并将其放置在 `PATH` 目录中：
- en: Listing B.1 Downloading `yq`
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 B.1 下载 `yq`
- en: '[PRE0]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: ① VERSION refers to the tagged release version, while BINARY is a combination
    of the name of the yq binary, the name of the operating system, and the architecture.
    An example for AMD64 Linux is yq_linux_amd64.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: ① 版本（VERSION）指的是标记的发布版本，而二进制（BINARY）是 yq 二进制文件名称、操作系统名称和架构的组合。例如，AMD64 Linux
    的示例是 yq_linux_amd64。
- en: 'The installation was successful if the following command succeeds:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 如果以下命令成功执行，则表示安装成功：
- en: '[PRE1]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: If the command does not succeed, confirm the file was downloaded successfully,
    placed in a directory on the operating system `PATH`, and that the binary is executable.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 如果命令没有成功执行，请确认文件已成功下载，放置在操作系统的 `PATH` 目录中，并且二进制文件是可执行的。
- en: B.2 yq by example
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: B.2 以示例说明 yq
- en: '`yq` can perform actions against YAML-formatted content, such as querying and
    manipulating values, and is useful when working with Kubernetes manifests. `kubectl`
    has the functionality to output in a variety of formats, such as JSONPath or Go
    templates. However, certain advanced features, like piping, are not available
    and require a more full-purpose, dedicated tool.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '`yq` 可以对 YAML 格式的文件执行操作，例如查询和操作值，当与 Kubernetes 清单一起工作时非常有用。`kubectl` 具有多种输出格式的功能，例如
    JSONPath 或 Go 模板。然而，某些高级功能，如管道，不可用，需要更全面的专用工具。'
- en: 'To showcase some of the ways `yq` can be used to manipulate YAML content, create
    a file called `book-info.yaml` containing a resource that we are familiar with:
    a Kubernetes Secret.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 为了展示 `yq` 可以用来操作 YAML 内容的一些方法，创建一个名为 `book-info.yaml` 的文件，包含我们熟悉的一个资源：Kubernetes
    密钥。
- en: Listing B.2 book-info.yaml
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 列表B.2 book-info.yaml
- en: '[PRE2]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '`yq` has two primary modes: evaluating a single document (with the `evaluate`
    or `e` subcommand) or multiple documents (with the `eval-all` or `ea` subcommand).
    Evaluating a single document is the most common mode, so you can use it to query
    the contents of the `book-info.yaml` file created in listing B.2.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '`yq`有两个主要模式：评估单个文档（使用`evaluate`或`e`子命令）或多个文档（使用`eval-all`或`ea`子命令）。评估单个文档是最常见的模式，因此可以使用它来查询列表B.2中创建的`book-info.yaml`文件的
    内容。'
- en: 'Operations against YAML files use *expressions* to determine the specific actions
    to take. Since most YAML content uses nested content, these properties can be
    accessed using dot notation. For example, to extract the contents of the `title`
    field underneath `stringData`, the expression `.stringData.title` is used. The
    combination of the type of action to perform, such as `evaluate`, the expression,
    and the location of the YAML content are three components needed when using `yq`.
    Now use the following command to extract the `title` field:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 对YAML文件的操作使用*表达式*来确定要执行的具体操作。由于大多数YAML内容使用嵌套内容，这些属性可以通过点符号访问。例如，为了提取`stringData`下`title`字段的值，使用表达式`.stringData.title`。在`yq`中使用时，需要三个组件：要执行的操作类型（如`evaluate`）、表达式和YAML内容的定位。现在使用以下命令提取`title`字段：
- en: '[PRE3]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'More complex expressions can also be used to perform advanced operations. *Pipes*
    (''|'') can be used to chain expressions together, so the output from one expression
    becomes the input to another expression. For example, to determine the length
    of the `publisher` field underneath `stringData`, a pipe can be used to take the
    output of the `.stringData.publisher` expression and feed it into the `length`
    operator:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 更复杂的表达式也可以用来执行高级操作。*管道*（`|`）可以用来连接表达式，使得一个表达式的输出成为另一个表达式的输入。例如，为了确定`stringData`下`publisher`字段的长度，可以使用管道将`.stringData.publisher`表达式的输出传递给`length`运算符：
- en: '[PRE4]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The result of the command should have returned `7`. In addition to extracting
    properties, `yq` can also be used to modify YAML content. Now add a new property
    underneath `stringData` called `category` with a value of `Security`. The `yq`
    expression to accomplish this task is `''.stringData.category` `=` `"Security"''`.
    Execute the following command to add the `category` field:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 命令的结果应该返回`7`。除了提取属性外，`yq`还可以用来修改YAML内容。现在在`stringData`下添加一个名为`category`的新属性，其值为`Security`。完成此任务的`yq`表达式为`'.stringData.category'
    `=` `"Security"`。执行以下命令以添加`category`字段：
- en: '[PRE5]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The following listing should have been returned as a result of the command.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表应该是命令的结果。
- en: Listing B.3 The output of updating YAML content using `yq`
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 列表B.3 使用`yq`更新YAML内容的输出
- en: '[PRE6]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: ① A new category field is added.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: ① 添加了一个新的类别字段。
- en: 'Even though the output of the execution resulted in the addition of the new
    `category` field, it is important to note the content of the `book-info.yaml`
    file was not modified. To update the content of the `book-info.yaml` field, the
    `-i` option must be used, which will instruct `yq` to perform an in-place update
    of the file. Execute the following command to perform an in-place file update:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管执行的结果导致添加了新的`category`字段，但重要的是要注意`book-info.yaml`文件的内容并未被修改。为了更新`book-info.yaml`字段的内容，必须使用`-i`选项，这将指示`yq`执行文件就地更新。执行以下命令以执行就地文件更新：
- en: '[PRE7]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Confirm the changes have been applied to the file. The capabilities provided
    by `yq` to extract and manipulate make it a versatile tool and useful to have
    in your arsenal when working with any YAML-formatted content.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 确认更改已应用于文件。`yq`提供的提取和操作能力使其成为一个多功能的工具，在处理任何YAML格式内容时都非常有用。
