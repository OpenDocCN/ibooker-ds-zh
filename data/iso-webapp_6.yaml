- en: Appendix C. Additional React Router 4 use cases
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 附录C. React Router 4的附加用法
- en: '*This appendix covers*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*本附录涵盖*'
- en: Handling third-party libraries such as an analytics module in React Router 4
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在React Router 4中处理第三方库，如分析模块
- en: Adding routes dynamically at runtime
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在运行时动态添加路由
- en: Code splitting with webpack and React Router 4
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用webpack和React Router 4进行代码拆分
- en: '[Chapters 10](kindle_split_022_split_000.xhtml#ch10) and [11](kindle_split_023_split_000.xhtml#ch11)
    show you how to do several things that affect the way the React Router code and
    the rest of the app work together. This appendix goes over several of those examples
    with React Router 4.'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[第10章](kindle_split_022_split_000.xhtml#ch10) 和 [第11章](kindle_split_023_split_000.xhtml#ch11)
    展示了如何执行一些会影响 React Router 代码和应用程序其余部分协同工作方式的事情。本附录通过 React Router 4 讲解了这些示例中的几个。'
- en: All the examples in this appendix live in the react-router-4 branch (`git checkout
    react-router-4`) of the main example repo, [http://mng.bz/S3N0](http://mng.bz/S3N0).
    The code in this branch is also updated so you can see a complete example of the
    way React Router 4 works with the final version of the code as it exists at the
    end of [chapter 11](kindle_split_023_split_000.xhtml#ch11). This builds off the
    code changes presented in [appendix A](kindle_split_027_split_000.xhtml#app01)
    and [appendix B](kindle_split_028.xhtml#app02).
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 本附录中的所有示例都位于主示例仓库的 react-router-4 分支（`git checkout react-router-4`）中，[http://mng.bz/S3N0](http://mng.bz/S3N0)。此分支中的代码也已更新，以便您可以查看
    React Router 4 与代码最终版本协同工作的完整示例。这基于附录A（kindle_split_027_split_000.xhtml#app01）和附录B（kindle_split_028.xhtml#app02）中展示的代码更改。
- en: C.1\. Moving analytics to onRouteChange
  id: totrans-7
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: C.1\. 将分析移动到 onRouteChange
- en: The first update you need to make is to move the analytics code into the `onRouteChange`
    HOC. Previously, this was handled in the React Router 3 lifecycle methods. Now
    you’ll handle it like page tracking and prefetching data are in [appendix A](kindle_split_027_split_000.xhtml#app01).
    The following listing demonstrates how this is done. This change is from [chapter
    10](kindle_split_022_split_000.xhtml#ch10), [section 10.1](kindle_split_022_split_001.xhtml#ch10lev1sec1).
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要做的第一个更新是将分析代码移动到 `onRouteChange` HOC。之前，这由 React Router 3 的生命周期方法处理。现在您将像处理页面跟踪和预取数据一样在
    [附录A](kindle_split_027_split_000.xhtml#app01) 中处理它。以下列表演示了如何进行此操作。此更改来自 [第10章](kindle_split_022_split_000.xhtml#ch10)，[第10.1节](kindle_split_022_split_001.xhtml#ch10lev1sec1)。
- en: Listing C.1\. Add analytics to `onRouteChange`—components/onRouteChange.jsx
  id: totrans-9
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表C.1\. 在 `onRouteChange` 中添加分析—components/onRouteChange.jsx
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '***1* Imports sendData from the analytics module**'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 从分析模块导入 sendData**'
- en: '***2* Passes location into the function. Calls sendAnalytics.**'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 将位置传递给函数。调用 sendAnalytics。**'
- en: '***3* Creates a sendAnalytics function that calls sendData. The location will
    be passed in.**'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 创建一个调用 sendData 的 sendAnalytics 函数。将位置传递给它。**'
- en: '***4* Calls trackPageView each time the route changes. Make sure to pass in
    the correct location.**'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 每次路由更改时调用 trackPageView。确保传递正确的位置。**'
- en: Calling `sendAnalytics` from `componentWillReceiveProps` replaces the `onEnter`
    call in `sharedRoutes`. Additionally, calling `sendAnalytics` from `componentDidMount`
    replaces the `onEnter` call in `sharedRoutes`.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 从 `componentWillReceiveProps` 中调用 `sendAnalytics` 替换了 `sharedRoutes` 中的 `onEnter`
    调用。此外，从 `componentDidMount` 中调用 `sendAnalytics` 也替换了 `sharedRoutes` 中的 `onEnter`
    调用。
- en: C.2\. Adding dynamic routes
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: C.2\. 添加动态路由
- en: '[Chapter 10](kindle_split_022_split_000.xhtml#ch10) also demonstrates how to
    add dynamic routes based on an environment variable or other flag. To do this
    in the new sharedRoutesv4 file, you need to update the routes array before exporting
    it. The following listing shows how to do this.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '[第10章](kindle_split_022_split_000.xhtml#ch10) 还演示了如何根据环境变量或其他标志添加动态路由。要在新的
    sharedRoutesv4 文件中这样做，您需要在导出之前更新路由数组。以下列表显示了如何进行此操作。'
- en: Listing C.2\. Adding a dynamic route—sharedRoutesv4.es6
  id: totrans-18
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表C.2\. 添加动态路由—sharedRoutesv4.es6
- en: '[PRE1]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '***1* Checks for the environment. If it isn’t production, adds this dev-only
    route.**'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 检查环境。如果不是生产环境，则添加此仅限开发的路由。**'
- en: '***2* Pushes the new route into the routes array. Remember, the routes array
    is a child of the root App component in the routes object.**'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 将新路由推入路由数组。记住，路由数组是路由对象中根 App 组件的子组件。**'
- en: Now you have an additional route in dev!
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您在开发中有一个额外的路由了！
- en: 'C.3\. Code splitting: React Loadable'
  id: totrans-23
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: C.3\. 代码拆分：React Loadable
- en: The last example that touches on React Router is code splitting from [chapter
    11](kindle_split_023_split_000.xhtml#ch11). The good news is that it’s somewhat
    easier with React Router 4\. The community has definitely caught up here and provides
    a library to handle all your code-splitting needs. The library is called React
    Loadable, and it’s easy to use and well documented.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个涉及 React Router 的例子是来自第 11 章（kindle_split_023_split_000.xhtml#ch11）的代码拆分。好消息是，在
    React Router 4 中这要容易一些。社区在这方面确实已经迎头赶上，并提供了一个库来处理您所有的代码拆分需求。这个库叫做 React Loadable，它易于使用且文档齐全。
- en: The React community has thought of everything, including handling an isomorphic
    app. They’ve provided good documentation at [http://mng.bz/3hJg](http://mng.bz/3hJg).
    I’m not going to reproduce all their examples here.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: React 社区考虑到了方方面面，包括处理同构应用。他们在 [http://mng.bz/3hJg](http://mng.bz/3hJg) 提供了良好的文档。我这里不会重复所有他们的例子。
- en: 'A few cool things about React Loadable:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 React Loadable 的一些有趣之处：
- en: You can provide a component that’s shown while your components are being loaded
    ([http://mng.bz/518M](http://mng.bz/518M)).
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以提供一个在组件加载时显示的组件（[http://mng.bz/518M](http://mng.bz/518M)）。
- en: The library ships with an option to preload components (which is always used
    on the server) and can be used on the browser for optimistic loading ([http://mng.bz/081O](http://mng.bz/081O)).
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 该库提供了一种预加载组件的选项（这在服务器上总是被使用），并且可以在浏览器中进行乐观加载（[http://mng.bz/081O](http://mng.bz/081O)）。
- en: Instead of installing all the correct Babel plugins and having to set up webpack
    properly, the library handles all that for you. It provides a Babel package for
    you ([http://mng.bz/91mV](http://mng.bz/91mV)). It also ships with a webpack plugin
    and a related utility for server-side rendering ([http://mng.bz/34vL](http://mng.bz/34vL)).
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 而不是安装所有正确的 Babel 插件并正确设置 webpack，该库为您处理所有这些。它提供了一个 Babel 包供您使用（[http://mng.bz/91mV](http://mng.bz/91mV)）。它还附带了一个
    webpack 插件和用于服务器端渲染的相关实用工具（[http://mng.bz/34vL](http://mng.bz/34vL)）。
