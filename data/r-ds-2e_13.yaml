- en: Chapter 11\. Communication
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第11章 传达
- en: Introduction
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: In [Chapter 10](ch10.xhtml#chp-EDA), you learned how to use plots as tools for
    *exploration*. When you make exploratory plots, you know—even before looking—which
    variables the plot will display. You made each plot for a purpose, could quickly
    look at it, and could then move on to the next plot. In the course of most analyses,
    you’ll produce tens or hundreds of plots, most of which are immediately thrown
    away.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第10章](ch10.xhtml#chp-EDA)中，您学习了如何将图表用作*探索*工具。在制作探索性图表时，您甚至在查看之前就知道图表将显示哪些变量。您为每个图表设定了特定目的，可以快速查看它，然后转移到下一个图表。在大多数分析过程中，您将生成数十甚至数百个图表，其中大多数立即被丢弃。
- en: Now that you understand your data, you need to *communicate* your understanding
    to others. Your audience will likely not share your background knowledge and will
    not be deeply invested in the data. To help others quickly build up a good mental
    model of the data, you will need to invest considerable effort in making your
    plots as self-explanatory as possible. In this chapter, you’ll learn some of the
    tools that ggplot2 provides to do so.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您了解了您的数据，需要*传达*给其他人您的理解。您的受众可能不会共享您的背景知识，也不会对数据深感兴趣。为了帮助他人快速建立起对数据的良好心理模型，您需要付出相当大的努力，使您的图形尽可能自解释。在本章中，您将学习到ggplot2提供的一些工具来实现这一点。
- en: This chapter focuses on the tools you need to create good graphics. We assume
    that you know what you want and just need to know how to do it. For that reason,
    we highly recommend pairing this chapter with a good general visualization book.
    We particularly like [*The Truthful Art*](https://oreil.ly/QIr_w) by Albert Cairo
    (New Riders). It doesn’t teach the mechanics of creating visualizations but instead
    focuses on what you need to think about to create effective graphics.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章重点介绍创建优质图形所需的工具。我们假设您知道自己想要什么，只需知道如何做。因此，我们强烈建议将本章与一本优秀的通用可视化书籍配对。我们特别推荐阅读[*真实的艺术*](https://oreil.ly/QIr_w)，作者是阿尔伯特·开罗（New
    Riders）。它不会教授创建可视化图形的机制，而是专注于创建有效图形时需要考虑的内容。
- en: Prerequisites
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 先决条件
- en: In this chapter, we’ll focus once again on ggplot2\. We’ll also use a little
    dplyr for data manipulation; *scales* to override the default breaks, labels,
    transformations and palettes; and a few ggplot2 extension packages, including
    [ggrepel](https://oreil.ly/IVSL4) by Kamil Slowikowski and [patchwork](https://oreil.ly/xWxVV)
    by Thomas Lin Pedersen. Don’t forget that you’ll need to install those packages
    with [`install.packages()`](https://rdrr.io/r/utils/install.packages.xhtml) if
    you don’t already have them.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们再次专注于ggplot2。我们还会使用一些dplyr进行数据操作；*scales*用于覆盖默认的间断、标签、转换和调色板；以及一些ggplot2扩展包，包括由卡米尔·斯洛维科夫斯基（Kamil
    Slowikowski）开发的[ggrepel](https://oreil.ly/IVSL4)和由托马斯·林·佩德森（Thomas Lin Pedersen）开发的[patchwork](https://oreil.ly/xWxVV)。不要忘记，如果您尚未安装这些包，您需要使用[`install.packages()`](https://rdrr.io/r/utils/install.packages.xhtml)来安装它们。
- en: '[PRE0]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Labels
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 标签
- en: 'The easiest place to start when turning an exploratory graphic into an expository
    graphic is with good labels. You add labels with the [`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml)
    function:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 将探索性图形转换为解释性图形的最简单方法是添加良好的标签。您可以使用[`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml)函数添加标签：
- en: '[PRE1]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![Scatterplot of highway fuel efficiency versus engine size of cars, where
    points are colored according to the car class. A smooth curve following the trajectory
    of the relationship between highway fuel efficiency versus engine size of cars
    is overlaid. The x-axis is labelled "Engine displacement (L)" and the y-axis is
    labelled "Highway fuel economy (mpg)". The legend is labelled "Car type". The
    plot is titled "Fuel efficiency generally decreases with engine size". The subtitle
    is "Two seaters (sports cars) are an exception because of their light weight"
    and the caption is "Data from fueleconomy.gov".](assets/rds2_11in01.png)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![汽车引擎大小与高速公路燃油效率散点图，点根据汽车类别着色。覆盖着沿着引擎大小与燃油效率关系轨迹的平滑曲线。x轴标签为“引擎排量（升）”，y轴标签为“高速公路燃油经济性（mpg）”。图例标签为“汽车类型”。标题为“燃油效率通常随引擎大小减少”。副标题为“两座（跑车）是由于其轻量化而例外”。图表来自fueleconomy.gov。](assets/rds2_11in01.png)'
- en: The purpose of a plot title is to summarize the main finding. Avoid titles that
    just describe what the plot is, e.g., “A scatterplot of engine displacement vs.
    fuel economy.”
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 图表标题的目的是总结主要发现。避免仅描述图表内容的标题，例如“引擎排量与燃油经济性的散点图”。
- en: 'If you need to add more text, there are two other useful labels: `subtitle`
    adds additional detail in a smaller font beneath the title, and `caption` adds
    text at the bottom right of the plot, often used to describe the source of the
    data. You can also use [`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml)
    to replace the axis and legend titles. It’s usually a good idea to replace short
    variable names with more detailed descriptions and to include the units.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要添加更多文本，还有两个有用的标签：`subtitle` 在标题下方以较小的字体添加额外细节，`caption` 则在图的右下角添加文本，通常用于描述数据来源。您还可以使用
    [`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml) 替换坐标轴和图例标题。通常建议用更详细的描述替换简短的变量名，并包含单位。
- en: 'It’s possible to use mathematical equations instead of text strings. Just switch
    `""` out for [`quote()`](https://rdrr.io/r/base/substitute.xhtml) and read about
    the available options in [`?plotmath`](https://rdrr.io/r/grDevices/plotmath.xhtml):'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用数学方程替代文本字符串。只需将 `""` 替换为 [`quote()`](https://rdrr.io/r/base/substitute.xhtml)，并在
    [`?plotmath`](https://rdrr.io/r/grDevices/plotmath.xhtml) 中了解可用选项：
- en: '[PRE2]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![Scatterplot with math text on the x and y axis labels. X-axis label says
    x_i, y-axis label says sum of x_i  squared, for i from 1 to n.](assets/rds2_11in02.png)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![在 x 和 y 轴标签上带有数学文本的散点图。X 轴标签为 x_i，Y 轴标签为 x_i 的平方和，其中 i 从 1 到 n。](assets/rds2_11in02.png)'
- en: Exercises
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习
- en: Create one plot on the fuel economy data with customized `title`, `subtitle`,
    `caption`, `x`, `y`, and `color` labels.
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在燃油经济数据上创建一个图，自定义 `title`、`subtitle`、`caption`、`x`、`y` 和 `color` 标签。
- en: Re-create the following plot using the fuel economy data. Note that both the
    colors and shapes of points vary by type of drivetrain.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用燃油经济数据重新创建以下图。请注意，点的颜色和形状都因驱动类型而异。
- en: '![Scatterplot of highway versus city fuel efficiency. Shapes and colors of
    points are determined by type of drivetrain.](assets/rds2_11in03.png)'
  id: totrans-20
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![公路与城市燃油效率的散点图。点的形状和颜色由驱动类型确定。](assets/rds2_11in03.png)'
- en: Take an exploratory graphic that you’ve created in the last month, and add informative
    titles to make it easier for others to understand.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 取出您在上个月创建的探索性图形，并添加信息性标题，以便他人更容易理解。
- en: Annotations
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 注释
- en: 'In addition to labeling major components of your plot, it’s often useful to
    label individual observations or groups of observations. The first tool you have
    at your disposal is [`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml).
    [`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml) is similar
    to [`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml),
    but it has an additional aesthetic: `label`. This makes it possible to add textual
    labels to your plots.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 除了标记绘图的主要组件外，通常还有必要标记单个观察值或观察值组。您可以使用 [`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)。[`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)
    类似于 [`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)，但具有额外的美学：`label`。这使得可以向绘图添加文本标签。
- en: 'There are two possible sources of labels. First, you might have a tibble that
    provides labels. In the following plot we pull out the cars with the highest engine
    size in each drive type and save their information as a new data frame called
    `label_info`:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 标签有两种可能的来源。首先，您可能有一个提供标签的 tibble。在以下图中，我们提取每种驱动类型中引擎尺寸最大的汽车，并将其信息保存为一个名为 `label_info`
    的新数据框：
- en: '[PRE3]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Then, we use this new data frame to directly label the three groups to replace
    the legend with labels placed directly on the plot. Using the `fontface` and `size`
    arguments we can customize the look of the text labels. They’re larger than the
    rest of the text on the plot and bolded. (`theme(legend.position = "none"`) turns
    all the legends off—we’ll talk about it more shortly.)
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们使用这个新数据框直接标记三个组，以取代图例并直接放置在图上。使用 `fontface` 和 `size` 参数可以自定义文本标签的外观。它们比图上其余文本更大并加粗。(`theme(legend.position
    = "none"`) 关闭所有图例 — 我们将很快讨论更多内容。)
- en: '[PRE4]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![Scatterplot of highway mileage versus engine size where points are colored
    by drive type. Smooth curves for each drive type are overlaid. Text labels identify
    the curves as front-wheel, rear-wheel, and 4-wheel.](assets/rds2_11in04.png)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![公路里程与引擎尺寸的散点图，点的颜色由驱动类型确定。每种驱动类型的平滑曲线叠加在一起。文本标签标识曲线为前轮驱动、后轮驱动和四轮驱动。](assets/rds2_11in04.png)'
- en: Note the use of `hjust` (horizontal justification) and `vjust` (vertical justification)
    to control the alignment of the label.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 注意使用 `hjust`（水平对齐）和 `vjust`（垂直对齐）来控制标签的对齐方式。
- en: 'However, the annotated plot we just made is hard to read because the labels
    overlap with each other and with the points. We can use the [`geom_label_repel()`](https://rdrr.io/pkg/ggrepel/man/geom_text_repel.xhtml)
    function from the ggrepel package to address both of these issues. This useful
    package will automatically adjust labels so that they don’t overlap:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，我们刚刚制作的带注释的图表很难阅读，因为标签彼此重叠且与点重叠。我们可以使用ggrepel包中的[`geom_label_repel()`](https://rdrr.io/pkg/ggrepel/man/geom_text_repel.xhtml)函数来解决这两个问题。这个有用的包会自动调整标签，以避免重叠：
- en: '[PRE5]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![Scatterplot of highway fuel efficiency versus engine size of cars, where
    points are colored according to the car class. Some points are labelled with the
    car''s name. The labels are box with white, transparent background and positioned
    to not overlap.](assets/rds2_11in05.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![汽车引擎尺寸与公路燃油效率的散点图，根据车辆类别着色。某些点带有车辆名称的标签。标签为白色透明背景的框，位置不重叠。](assets/rds2_11in05.png)'
- en: 'You can also use the same idea to highlight certain points on a plot with [`geom_text_repel()`](https://rdrr.io/pkg/ggrepel/man/geom_text_repel.xhtml)
    from the ggrepel package. Note another handy technique used here: we added a second
    layer of large, hollow points to further highlight the labeled points.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用ggrepel包中的[`geom_text_repel()`](https://rdrr.io/pkg/ggrepel/man/geom_text_repel.xhtml)来突出显示图表上的某些点。注意这里使用的另一个有用技巧：我们添加了第二层大空心点以进一步突出标记点。
- en: '[PRE6]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![Scatterplot of highway fuel efficiency versus engine size of cars. Points
    where highway mileage is above 40 as well as above 20 with engine size above 5
    are red, with a hollow red circle, and labelled with model name of the car.](assets/rds2_11in06.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![汽车公路燃油效率与引擎尺寸的散点图。高速公路里程超过40和引擎尺寸超过5的点为红色，空心红圆圈，并带有车型名称的标签。](assets/rds2_11in06.png)'
- en: 'Remember, in addition to [`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)
    and [`geom_label()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml),
    you have many other geoms in ggplot2 available to help annotate your plot. A couple
    ideas:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，除了[`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)和[`geom_label()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)，ggplot2中还有许多其他geoms可用于帮助注释您的图表。一些想法：
- en: Use [`geom_hline()`](https://ggplot2.tidyverse.org/reference/geom_abline.xhtml)
    and [`geom_vline()`](https://ggplot2.tidyverse.org/reference/geom_abline.xhtml)
    to add reference lines. We often make them thick (`linewidth = 2`) and white (`color
    = white`) and draw them underneath the primary data layer. That makes them easy
    to see, without drawing attention away from the data.
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用[`geom_hline()`](https://ggplot2.tidyverse.org/reference/geom_abline.xhtml)和[`geom_vline()`](https://ggplot2.tidyverse.org/reference/geom_abline.xhtml)添加参考线。通常我们会将它们设置为粗线（`linewidth
    = 2`），白色（`color = white`），并在主数据层下绘制。这样可以使它们易于看见，而不会分散数据的注意力。
- en: Use [`geom_rect()`](https://ggplot2.tidyverse.org/reference/geom_tile.xhtml)
    to draw a rectangle around points of interest. The boundaries of the rectangle
    are defined by aesthetics `xmin`, `xmax`, `ymin`, and `ymax`. Alternatively, look
    into the [ggforce package](https://oreil.ly/DZtL1), specifically [`geom_mark_hull()`](https://ggforce.data-imaginist.com/reference/geom_mark_hull.xhtml),
    which allows you to annotate subsets of points with hulls.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用[`geom_rect()`](https://ggplot2.tidyverse.org/reference/geom_tile.xhtml)绘制围绕感兴趣点的矩形。矩形的边界由美学`xmin`、`xmax`、`ymin`和`ymax`定义。或者，可以查看[ggforce包](https://oreil.ly/DZtL1)，特别是[`geom_mark_hull()`](https://ggforce.data-imaginist.com/reference/geom_mark_hull.xhtml)，它允许您使用凸包标注子集点。
- en: Use [`geom_segment()`](https://ggplot2.tidyverse.org/reference/geom_segment.xhtml)
    with the `arrow` argument to draw attention to a point with an arrow. Use aesthetics
    `x` and `y` to define the starting location, and use `xend` and `yend` to define
    the end location.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用[`geom_segment()`](https://ggplot2.tidyverse.org/reference/geom_segment.xhtml)和`arrow`参数来用箭头突出显示一个点。使用美学`x`和`y`定义起始位置，使用`xend`和`yend`定义结束位置。
- en: Another handy function for adding annotations to plots is [`annotate()`](https://ggplot2.tidyverse.org/reference/annotate.xhtml).
    As a rule of thumb, geoms are generally useful for highlighting a subset of the
    data, while [`annotate()`](https://ggplot2.tidyverse.org/reference/annotate.xhtml)
    is useful for adding one or a few annotation elements to a plot.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 添加注释到图表的另一个便捷函数是[`annotate()`](https://ggplot2.tidyverse.org/reference/annotate.xhtml)。一般而言，geoms通常用于突出显示数据的子集，而[`annotate()`](https://ggplot2.tidyverse.org/reference/annotate.xhtml)则用于向图表添加一个或几个注释元素。
- en: 'To demonstrate using [`annotate()`](https://ggplot2.tidyverse.org/reference/annotate.xhtml),
    let’s create some text to add to our plot. The text is a bit long, so we’ll use
    [`stringr::str_wrap()`](https://stringr.tidyverse.org/reference/str_wrap.xhtml)
    to automatically add line breaks to it given the number of characters you want
    per line:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 为了演示如何使用[`annotate()`](https://ggplot2.tidyverse.org/reference/annotate.xhtml)，让我们创建一些文本添加到我们的绘图中。文本有点长，所以我们将使用[`stringr::str_wrap()`](https://stringr.tidyverse.org/reference/str_wrap.xhtml)根据每行字符数自动添加换行符：
- en: '[PRE7]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Then, we add two layers of annotation: one with a label geom and the other
    with a segment geom. The `x` and `y` aesthetics in both define where the annotation
    should start, and the `xend` and `yend` aesthetics in the segment annotation define
    the starting location of the end location of the segment. Note also that the segment
    is styled as an arrow.'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们添加两层注释：一个使用标签geom，另一个使用段geom。两者中的`x`和`y`美学定义了注释的起始位置，而段注释中的`xend`和`yend`美学定义了段的结束位置。还请注意，该段被设计成箭头样式。
- en: '[PRE8]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![Scatterplot of highway fuel efficiency versus engine size of cars. A red
    arrow pointing down follows the trend of the points and the annotation placed
    next to the arrow reads "Larger engine sizes tend to have lower fuel economy".
    The arrow and the annotation text is red.](assets/rds2_11in07.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![汽车的公路燃油效率与发动机大小的散点图。一只红色箭头向下沿着点的趋势，旁边的注释读到“较大的发动机尺寸通常具有较低的燃油经济性”。箭头和注释文字都是红色的。](assets/rds2_11in07.png)'
- en: Annotation is a powerful tool for communicating main takeaways and interesting
    features of your visualizations. The only limit is your imagination (and your
    patience with positioning annotations to be aesthetically pleasing)!
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 注释是传达可视化主要观点和有趣特征的强大工具。唯一的限制是你的想象力（以及调整注释位置以美观地呈现的耐心）！
- en: Exercises
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习
- en: Use [`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)
    with infinite positions to place text at the four corners of the plot.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用[`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)将文本放置在绘图的四个角落。
- en: Use [`annotate()`](https://ggplot2.tidyverse.org/reference/annotate.xhtml) to
    add a point geom in the middle of your last plot without having to create a tibble.
    Customize the shape, size, or color of the point.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用[`annotate()`](https://ggplot2.tidyverse.org/reference/annotate.xhtml)在不需要创建tibble的情况下在最后一个绘图中添加一个点geom。定制点的形状、大小或颜色。
- en: 'How do labels with [`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)
    interact with faceting? How can you add a label to a single facet? How can you
    put a different label in each facet? (Hint: Think about the dataset that is being
    passed to [`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml).)'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如何使用[`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)标签与分面互动？如何在单个分面中添加标签？如何在每个分面中放置不同的标签？（提示：考虑传递给[`geom_text()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)的数据集。）
- en: What arguments to [`geom_label()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)
    control the appearance of the background box?
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 控制背景框外观的[`geom_label()`](https://ggplot2.tidyverse.org/reference/geom_text.xhtml)的参数是什么？
- en: What are the four arguments to [`arrow()`](https://rdrr.io/r/grid/arrow.xhtml)?
    How do they work? Create a series of plots that demonstrate the most important
    options.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[`arrow()`](https://rdrr.io/r/grid/arrow.xhtml)的四个参数是什么？它们如何工作？创建一系列示例图来演示最重要的选项。'
- en: Scales
  id: totrans-53
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 比例尺
- en: The third way you can make your plot better for communication is to adjust the
    scales. Scales control how the aesthetic mappings manifest visually.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 第三种使图表更适合传达信息的方法是调整比例尺。比例尺控制美学映射在视觉上的表现方式。
- en: Default Scales
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 默认比例尺
- en: 'Normally, ggplot2 automatically adds scales for you. For example, when you
    type:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 通常情况下，ggplot2会自动为您添加比例尺。例如，当您输入：
- en: '[PRE9]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'ggplot2 automatically adds default scales behind the scenes:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: ggplot2在幕后自动添加默认比例尺：
- en: '[PRE10]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Note the naming scheme for scales: `scale_` followed by the name of the aesthetic,
    then `_`, and then the name of the scale. The default scales are named according
    to the type of variable they align with: continuous, discrete, date-time, or date.
    [`scale_x_continuous()`](https://ggplot2.tidyverse.org/reference/scale_continuous.xhtml)
    puts the numeric values from `displ` on a continuous number line on the x-axis,
    [`scale_color_discrete()`](https://ggplot2.tidyverse.org/reference/scale_colour_discrete.xhtml)
    chooses colors for each `class` of car, etc. There are lots of nondefault scales,
    which you’ll learn about next.'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 注意比例尺的命名方案：以`scale_`开头，然后是美学名称，接着是`_`，最后是比例尺名称。默认的比例尺根据其对齐的变量类型命名：连续型、离散型、日期时间型或日期型。[`scale_x_continuous()`](https://ggplot2.tidyverse.org/reference/scale_continuous.xhtml)
    将`displ`的数值放置在x轴的连续数线上，[`scale_color_discrete()`](https://ggplot2.tidyverse.org/reference/scale_colour_discrete.xhtml)
    为每个汽车`class`选择颜色等。还有许多非默认比例尺，接下来你将了解更多。
- en: 'The default scales have been carefully chosen to do a good job for a wide range
    of inputs. Nevertheless, you might want to override the defaults for two reasons:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 默认比例尺已经经过精心选择，以便为广泛的输入提供良好的效果。然而，由于两个原因你可能想要覆盖默认设置：
- en: You might want to tweak some of the parameters of the default scale. This allows
    you to do things like change the breaks on the axes, or the key labels on the
    legend.
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可能想调整默认比例尺的一些参数。这使你可以做一些改变，比如更改轴上的刻度间断点或图例上的键标签。
- en: You might want to replace the scale altogether and use a completely different
    algorithm. Often you can do better than the default because you know more about
    the data.
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可能想完全替换比例尺并使用完全不同的算法。通常你可以优于默认设置，因为你对数据了解更多。
- en: Axis Ticks and Legend Keys
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 轴刻度和图例键
- en: Collectively axes and legends are called *guides*. Axes are used for `x` and
    `y` aesthetics; legends are used for everything else.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 轴和图例总称为*guides*。轴用于`x`和`y`美学；图例用于其他所有内容。
- en: 'There are two primary arguments that affect the appearance of the ticks on
    the axes and the keys on the legend: `breaks` and `labels`. The `breaks` argument
    controls the position of the ticks or the values associated with the keys. The
    `labels` argument controls the text label associated with each tick/key. The most
    common use of `breaks` is to override the default choice:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 有两个主要参数影响轴上刻度和图例上的键的外观：`breaks`和`labels`。`breaks`参数控制刻度的位置或与键相关联的值。`labels`参数控制与每个刻度/键关联的文本标签。最常见的`breaks`用法是覆盖默认选择：
- en: '[PRE11]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![Scatterplot of highway fuel efficiency versus engine size of cars, colored
    by drive. The y-axis has breaks starting at 15 and ending at 40, increasing by
    5.](assets/rds2_11in08.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![汽车高速公路燃油效率与发动机尺寸的散点图，按驱动方式着色。y轴从15开始到40，每5增加一个间断点。](assets/rds2_11in08.png)'
- en: You can use `labels` in the same way (a character vector the same length as
    `breaks`), but you can also set it to `NULL` to suppress the labels altogether.
    This can be useful for maps or for publishing plots where you can’t share the
    absolute numbers. You can also use `breaks` and `labels` to control the appearance
    of legends. For discrete scales for categorical variables, `labels` can be a named
    list of the existing levels names and the desired labels for them.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以以相同方式使用`labels`（一个与`breaks`长度相同的字符向量），但也可以将其设置为`NULL`以完全禁止标签。这对于地图或发布图表（不能共享绝对数字）非常有用。你还可以使用`breaks`和`labels`来控制图例的外观。对于分类变量的离散比例尺，`labels`可以是现有级别名称和所需标签的命名列表。
- en: '[PRE12]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![Scatterplot of highway fuel efficiency versus engine size of cars, colored
    by drive. The x and y-axes do not have any labels at the axis ticks. The legend
    has custom labels: 4-wheel, front, rear.](assets/rds2_11in09.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![汽车高速公路燃油效率与发动机尺寸的散点图，按驱动方式着色。x轴和y轴没有任何标签在轴刻度上。图例具有自定义标签：4轮驱动、前驱动、后驱动。](assets/rds2_11in09.png)'
- en: The `labels` argument coupled with labeling functions from the scales package
    is also useful for formatting numbers as currency, percent, etc. The plot on the
    left shows default labeling with [`label_dollar()`](https://scales.r-lib.org/reference/label_dollar.xhtml),
    which adds a dollar sign as well as a thousand separator comma. The plot on the
    right adds further customization by dividing dollar values by 1,000 and adding
    a suffix “K” (for “thousands”) as well as adding custom breaks. Note that `breaks`
    is in the original scale of the data.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '`labels`参数与scales包中的标签函数结合使用，用于将数字格式化为货币、百分比等。左侧图显示了使用[`label_dollar()`](https://scales.r-lib.org/reference/label_dollar.xhtml)的默认标签，它添加了美元符号和千位分隔符逗号。右侧图通过将美元值除以1,000并添加后缀“K”（表示“千”），以及添加自定义刻度线进一步定制。请注意，`breaks`在原始数据的比例尺上。'
- en: '[PRE13]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![Two side-by-side box plots of price versus cut of diamonds. The outliers
    are transparent. On both plots the x-axis labels are formatted as dollars. The
    x-axis labels on the plot start at $0 and go to $15,000, increasing by $5,000\.
    The x-axis labels on the right plot start at $1K and go to $19K, increasing by
    $6K.](assets/rds2_11in10.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![钻石价格与切割方式的并排箱线图。异常值为透明。两个图的x轴标签格式为美元。左侧图的x轴标签从$0到$15,000，每增加$5,000。右侧图的x轴标签从$1K到$19K，每增加$6K。](assets/rds2_11in10.png)'
- en: 'Another handy label function is [`label_percent()`](https://scales.r-lib.org/reference/label_percent.xhtml):'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个方便的标签函数是[`label_percent()`](https://scales.r-lib.org/reference/label_percent.xhtml)：
- en: '[PRE14]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![Segmented bar plots of cut, filled with levels of clarity. The y-axis labels
    start at 0% and go to 100%, increasing by 25%. The y-axis label name is "Percentage".](assets/rds2_11in11.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![根据清晰度水平划分的分段条形图。y轴标签从0%到100%，每增加25%。y轴标签名为“百分比”。](assets/rds2_11in11.png)'
- en: 'Another use of `breaks` is when you have relatively few data points and want
    to highlight exactly where the observations occur. For example, take this plot
    that shows when each US president started and ended their term:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 当您的数据点较少且希望准确突出观察发生的位置时，`breaks`的另一个用途是。例如，以下图显示了每位美国总统任职的开始和结束时间：
- en: '[PRE15]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![Line plot of id number of presidents versus the year they started their presidency.
    Start year is marked with a point and a segment that starts there and ends at
    the end of the presidency. The x-axis labels are formatted as two digit years
    starting with an apostrophe, e.g., ''53.](assets/rds2_11in12.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![总统编号与他们开始任期的年份的折线图。起始年份用点标记，从那里开始到任期结束。x轴标签格式为两位数年份，以撇号开头，例如，''53。](assets/rds2_11in12.png)'
- en: 'Note that for the `breaks` argument we pulled out the `start` variable as a
    vector with `presidential$start` because we can’t do an aesthetic mapping for
    this argument. Also note that the specification of breaks and labels for date
    and date-time scales is a little different:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，对于`breaks`参数，我们将`start`变量作为一个向量从`presidential$start`中提取出来，因为我们无法对此参数进行美学映射。还要注意，日期和日期时间刻度的断点和标签规范略有不同：
- en: '`date_labels` takes a format specification, in the same form as [`parse_datetime()`](https://readr.tidyverse.org/reference/parse_datetime.xhtml).'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`date_labels`采用与[`parse_datetime()`](https://readr.tidyverse.org/reference/parse_datetime.xhtml)相同格式规范。'
- en: '`date_breaks` (not shown here) takes a string like “2 days” or “1 month.”'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`date_breaks`（此处未显示）接受像“2 days”或“1 month”这样的字符串。'
- en: Legend Layout
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 图例布局
- en: You will most often use `breaks` and `labels` to tweak the axes. While they
    both also work for legends, there are a few other techniques you are more likely
    to use.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 您最常使用`breaks`和`labels`来调整坐标轴。虽然它们也适用于图例，但您更有可能使用一些其他技术。
- en: 'To control the overall position of the legend, you need to use a [`theme()`](https://ggplot2.tidyverse.org/reference/theme.xhtml)
    setting. We’ll come back to themes at the end of the chapter, but in brief, they
    control the nondata parts of the plot. The theme setting `legend.position` controls
    where the legend is drawn:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 要控制图例的整体位置，需要使用[`theme()`](https://ggplot2.tidyverse.org/reference/theme.xhtml)设置。我们会在本章末尾回到主题，但简而言之，它们控制绘图的非数据部分。主题设置`legend.position`控制图例绘制位置：
- en: '[PRE16]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![Four scatterplots of highway fuel efficiency versus engine size of cars where
    points are colored based on class of car. Clockwise, the legend is placed on the
    right, left, top, and bottom of the plot.](assets/rds2_11in13.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![四个汽车发动机尺寸与公路燃油效率的散点图，点按车辆类别着色。顺时针，图例分别放置在右侧、左侧、顶部和底部。](assets/rds2_11in13.png)'
- en: If your plot is short and wide, place the legend at the top or bottom, and if
    it’s tall and narrow, place the legend at the left or right. You can also use
    `legend.position = "none"` to suppress the display of the legend altogether.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的图形短而宽，请将图例放置在顶部或底部；如果图形高而窄，请将图例放置在左侧或右侧。您还可以使用`legend.position = "none"`来完全隐藏图例的显示。
- en: 'To control the display of individual legends, use [`guides()`](https://ggplot2.tidyverse.org/reference/guides.xhtml)
    along with [`guide_legend()`](https://ggplot2.tidyverse.org/reference/guide_legend.xhtml)
    or [`guide_colorbar()`](https://ggplot2.tidyverse.org/reference/guide_colourbar.xhtml).
    The following example shows two important settings: controlling the number of
    rows the legend uses with `nrow`, and overriding one of the aesthetics to make
    the points bigger. This is particularly useful if you have used a low `alpha`
    to display many points on a plot.'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 控制单个图例的显示，请使用[`guides()`](https://ggplot2.tidyverse.org/reference/guides.xhtml)，结合[`guide_legend()`](https://ggplot2.tidyverse.org/reference/guide_legend.xhtml)或[`guide_colorbar()`](https://ggplot2.tidyverse.org/reference/guide_colourbar.xhtml)。以下示例展示了两个重要设置：使用`nrow`控制图例使用的行数，以及覆盖一个美学元素使点变大。如果在图中使用了低`alpha`显示多个点，这尤其有用。
- en: '[PRE17]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![Scatterplot of highway fuel efficiency versus engine size of cars where points
    are colored based on class of car. Overlaid on the plot is a smooth curve. The
    legend is in the bottom and classes are listed horizontally in two rows. The points
    in the legend are larger than the points in the plot.](assets/rds2_11in14.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![汽车引擎大小与公路燃油效率的散点图，点的颜色基于汽车类别。图中还叠加了平滑曲线。图例位于底部，类别以两行水平列出。图例中的点比图中的点大。](assets/rds2_11in14.png)'
- en: Note that the name of the argument in [`guides()`](https://ggplot2.tidyverse.org/reference/guides.xhtml)
    matches the name of the aesthetic, just like in [`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml).
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，在[`guides()`](https://ggplot2.tidyverse.org/reference/guides.xhtml)中的参数名与美学名字匹配，就像在[`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml)中一样。
- en: Replacing a Scale
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 替换比例尺
- en: 'Instead of just tweaking the details a little, you can instead replace the
    scale altogether. There are two types of scales you’re most likely to want to
    switch out: continuous position scales and color scales. Fortunately, the same
    principles apply to all the other aesthetics, so once you’ve mastered position
    and color, you’ll be able to quickly pick up other scale replacements.'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 而不仅仅是微调细节，您可以完全替换比例尺。您最有可能想要替换的两种比例尺是：连续位置比例尺和颜色比例尺。幸运的是，所有其他美学原则都适用于这些比例尺替换，因此一旦掌握了位置和颜色，您将能够快速掌握其他比例尺替换。
- en: 'It’s useful to plot transformations of your variable. For example, it’s easier
    to see the precise relationship between `carat` and `price` if we log transform
    them:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 对您的变量进行转换是很有用的。例如，如果我们对`carat`和`price`进行对数转换，就更容易看到它们之间的精确关系：
- en: '[PRE18]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![Two plots of price versus carat of diamonds. Data binned and the color of
    the rectangles representing each bin based on the number of points that fall into
    that bin. In the plot on the right, price and carat values are logged and the
    axis labels shows the logged values.](assets/rds2_11in15.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![两个价格与钻石克拉数的图表。数据被分bin处理，每个bin的颜色表示落入该bin的点数。在右侧图中，价格和克拉值被对数化，轴标签显示了对数值。](assets/rds2_11in15.png)'
- en: However, the disadvantage of this transformation is that the axes are now labeled
    with the transformed values, making it hard to interpret the plot. Instead of
    doing the transformation in the aesthetic mapping, we can instead do it with the
    scale. This is visually identical, except the axes are labeled on the original
    data scale.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这种转换的缺点是轴现在标记为转换后的值，使得解释图形变得困难。与在美学映射中进行转换不同，我们可以使用比例尺进行转换。这在视觉上是相同的，只是轴标记在原始数据比例上。
- en: '[PRE19]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![Plot of price versus carat of diamonds. Data binned and the color of the
    rectangles representing each bin based on the number of points that fall into
    that bin. The axis labels are on the original data scale.](assets/rds2_11in16.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![价格与钻石克拉数的图表。数据被分bin处理，每个bin的颜色表示落入该bin的点数。轴标签采用原始数据比例。](assets/rds2_11in16.png)'
- en: Another scale that is frequently customized is color. The default categorical
    scale picks colors that are evenly spaced around the color wheel. Useful alternatives
    are the ColorBrewer scales, which have been hand tuned to work better for people
    with common types of color blindness. The following two plots look similar, but
    there is enough difference in the shades of red and green that the dots on the
    right can be distinguished even by people with red-green color blindness.^([1](ch11.xhtml#idm44771304642976))
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个经常定制的比例是颜色。默认的分类比例选择颜色均匀分布在色轮周围。有用的替代方案是ColorBrewer比例，这些比例经过手工调整，更适合普通类型的色盲人士。下面的两个图看起来相似，但红色和绿色的色调差异足够大，即使是红绿色盲的人也能区分右边的点。^([1](ch11.xhtml#idm44771304642976))
- en: '[PRE20]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![Two scatterplots of highway mileage versus engine size where points are colored
    by drive type. The plot on the left uses the default ggplot2 color palette and
    the plot on the right uses a different color palette.](assets/rds2_11in17.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![两个散点图，公路里程与发动机大小相关，点的颜色基于驱动类型。左边的图使用默认的ggplot2颜色调色板，右边的图使用不同的颜色调色板。](assets/rds2_11in17.png)'
- en: Don’t forget simpler techniques for improving accessibility. If there are just
    a few colors, you can add a redundant shape mapping. This will also help ensure
    your plot is interpretable in black and white.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 不要忘记更简单的技术来改善可访问性。如果只有几种颜色，您可以添加多余的形状映射。这也有助于确保您的图在黑白情况下也能被解读。
- en: '[PRE21]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![Two scatterplots of highway mileage versus engine size where both color and
    shape of points are based on drive type. The color palette is not the default
    ggplot2 palette.](assets/rds2_11in18.png)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![两个散点图，公路里程与发动机大小相关，点的颜色和形状都基于驱动类型。颜色调色板不是默认的ggplot2调色板。](assets/rds2_11in18.png)'
- en: The ColorBrewer scales are [documented online](https://oreil.ly/LNHAy) and made
    available in R via the RColorBrewer package, by Erich Neuwirth. [Figure 11-1](#fig-brewer)
    shows the complete list of all palettes. The sequential (top) and diverging (bottom)
    palettes are particularly useful if your categorical values are ordered or have
    a “middle.” This often arises if you’ve used [`cut()`](https://rdrr.io/r/base/cut.xhtml)
    to make a continuous variable into a categorical variable.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: ColorBrewer比例可以在[网上文档中查看](https://oreil.ly/LNHAy)，并通过Erich Neuwirth的RColorBrewer包在R中使用。[图 11-1](#fig-brewer)展示了所有调色板的完整列表。顺序（顶部）和发散（底部）调色板特别适用于您的分类值有序或具有“中间”情况。如果您已使用[`cut()`](https://rdrr.io/r/base/cut.xhtml)将连续变量变成分类变量，这种情况经常发生。
- en: '![All ColorBrewer scales. One group goes from light to dark colors. Another
    group is a set of non ordinal colors. And the last group has diverging scales
    (from dark to light to dark again). Within each set there are a number of palettes.](assets/rds2_1101.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![所有ColorBrewer比例。一个组从浅色到深色。另一组是一组非有序颜色。最后一组有发散比例（从深到浅再到深）。在每组中都有许多调色板。](assets/rds2_1101.png)'
- en: Figure 11-1\. All ColorBrewer scales.
  id: totrans-110
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 11-1\. 所有ColorBrewer比例。
- en: 'When you have a predefined mapping between values and colors, use [`scale_color_manual()`](https://ggplot2.tidyverse.org/reference/scale_manual.xhtml).
    For example, if we map presidential party to color, we want to use the standard
    mapping of red for Republicans and blue for Democrats. One approach for assigning
    these colors is using hex color codes:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 当您有预定义的值与颜色之间的映射时，请使用[`scale_color_manual()`](https://ggplot2.tidyverse.org/reference/scale_manual.xhtml)。例如，如果我们将总统党派映射到颜色，我们希望使用标准的映射，即共和党人为红色，民主党人为蓝色。为分配这些颜色的一种方法是使用十六进制颜色代码：
- en: '[PRE22]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '![Line plot of id number of presidents versus the year they started their presidency.
    Start year is marked with a point and a segment that starts there and ends at
    the end of the presidency. Democratic presidents are represented in blue and Republicans
    in red.](assets/rds2_11in19.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![ID号码总统与他们开始总统任期的年份的线图。开始年份用一个点标记，并从那里开始的段到总统任期结束。民主总统用蓝色表示，共和党总统用红色表示。](assets/rds2_11in19.png)'
- en: For continuous color, you can use the built-in [`scale_color_gradient()`](https://ggplot2.tidyverse.org/reference/scale_gradient.xhtml)
    or [`scale_fill_gradient()`](https://ggplot2.tidyverse.org/reference/scale_gradient.xhtml).
    If you have a diverging scale, you can use [`scale_color_gradient2()`](https://ggplot2.tidyverse.org/reference/scale_gradient.xhtml).
    That allows you to give, for example, positive and negative values different colors.
    That’s sometimes also useful if you want to distinguish points above or below
    the mean.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 对于连续颜色，你可以使用内置的[`scale_color_gradient()`](https://ggplot2.tidyverse.org/reference/scale_gradient.xhtml)或者[`scale_fill_gradient()`](https://ggplot2.tidyverse.org/reference/scale_gradient.xhtml)。如果你有一个发散尺度，可以使用[`scale_color_gradient2()`](https://ggplot2.tidyverse.org/reference/scale_gradient.xhtml)。例如，这允许你给正负值赋予不同的颜色。有时候，这也非常有用，如果你想区分高于或低于平均值的点。
- en: Another option is to use the viridis color scales. The designers, Nathaniel
    Smith and Stéfan van der Walt, carefully tailored continuous color schemes that
    are perceptible to people with various forms of color blindness as well as perceptually
    uniform in both color and black and white. These scales are available as continuous
    (`c`), discrete (`d`), and binned (`b`) palettes in ggplot2.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个选项是使用viridis颜色尺度。设计师Nathaniel Smith和Stéfan van der Walt精心设计了适合各种形式色盲人士感知的连续色彩方案，以及在彩色和黑白模式下都是感知均匀的尺度。这些尺度在ggplot2中作为连续(`c`)、离散(`d`)和分组(`b`)调色板可用。
- en: '[PRE23]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![Three hex plots where the color of the hexes show the number of observations
    that fall into that hex bin. The first plot uses the default, continuous ggplot2
    scale. The second plot uses the viridis, continuous scale, and the third plot
    uses the viridis, binned scale.](assets/rds2_11in20.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![三个六边形图，其中六边形的颜色显示落入该六边形区域的观测次数。第一个图使用默认的连续ggplot2尺度。第二个图使用viridis连续尺度，第三个图使用viridis分组尺度。](assets/rds2_11in20.png)'
- en: 'Note that all color scales come in two varieties: `scale_color_*()` and `scale_fill_*()`
    for the `color` and `fill` aesthetics, respectively (the color scales are available
    in both UK and US spellings).'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 注意所有颜色尺度都有两种变体：`scale_color_*()`和`scale_fill_*()`分别用于`color`和`fill`美学（颜色尺度在英国和美国拼写都可用）。
- en: Zooming
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 缩放
- en: 'There are three ways to control the plot limits:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 有三种控制绘图限制的方法：
- en: Adjusting what data are plotted
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调整绘制的数据
- en: Setting the limits in each scale
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在每个尺度中设置限制
- en: Setting `xlim` and `ylim` in [`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml)
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在[`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml)中设置`xlim`和`ylim`。
- en: We’ll demonstrate these options in a series of plots. The plot on the left shows
    the relationship between engine size and fuel efficiency, colored by type of drivetrain.
    The plot on the right shows the same variables but subsets the data plotted. Subsetting
    the data has affected the x and y scales as well as the smooth curve.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在一系列图中演示这些选项。左边的图显示了引擎尺寸与燃油效率之间的关系，按驱动类型着色。右边的图显示了相同的变量，但子集绘制的数据。子集数据影响了x和y轴的刻度以及平滑曲线。
- en: '[PRE24]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![On the left, scatterplot of highway mileage vs. displacement, with displacement.
    The smooth curve overlaid shows a decreasing, and then increasing, trend like
    a hockey stick. On the right, same variables are plotted with displacement ranging
    only from 5 to 6 and highway mileage ranging only from 10 to 25\. The smooth curve
    overlaid shows a trend that''s slightly increasing first and then decreasing.](assets/rds2_11in21.png)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![左边是公路里程与排量的散点图，带有平滑曲线叠加显示出先减少，然后增加的趋势，如同曲棍球棒。右边相同的变量用于绘制，但是仅限于排量从5到6，公路里程从10到25。叠加的平滑曲线显示出先略微增加，然后减少的趋势。](assets/rds2_11in21.png)'
- en: Let’s compare these to the two following plots where the plot on the left sets
    the `limits` on individual scales and the plot on the right sets them in [`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml).
    We can see that reducing the limits is equivalent to subsetting the data. Therefore,
    to zoom in on a region of the plot, it’s generally best to use [`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml).
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将这些与下面的两个图进行比较，左边的图设置了各自刻度的`limits`，右边的图在[`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml)中设置了它们。我们可以看到，减少限制等同于子集数据。因此，为了放大绘图区域，通常最好使用[`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml)。
- en: '[PRE25]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '![On the left, scatterplot of highway mileage vs. displacement, with displacement
    ranging from 5 to 6 and highway mileage ranging from 10 to 25\. The smooth curve
    overlaid shows a trend that''s slightly increasing first and then decreasing.
    On the right, same variables are plotted with the same limits; however, the smooth
    curve overlaid shows a relatively flat trend with a slight increase at the end.](assets/rds2_11in22.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![左侧，高速公路里程与排量的散点图，排量从5到6，高速公路里程从10到25。叠加的平滑曲线显示了一种略微先增加然后减少的趋势。右侧，相同变量的散点图，使用相同的限制；然而，叠加的平滑曲线显示了一个相对平坦的趋势，并在最后略微增加。](assets/rds2_11in22.png)'
- en: On the other hand, setting the `limits` on individual scales is generally more
    useful if you want to *expand* the limits, e.g., to match scales across different
    plots. For example, if we extract two classes of cars and plot them separately,
    it’s difficult to compare the plots because all three scales (the x-axis, the
    y-axis, and the color aesthetic) have different ranges.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，如果要扩展限制（例如，使不同图形之间的比例尺匹配），则在单个比例尺上设置`limits`通常更有用。例如，如果我们提取两类汽车并分别绘制它们，由于三个比例尺（x轴、y轴和颜色美学）具有不同的范围，很难比较这些图形。
- en: '[PRE26]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '![On the left, a scatterplot of highway mileage vs. displacement of SUVs. On
    the right, a scatterplot of the same variables for compact cars. Points are colored
    by drive type for both plots. Among SUVs, more of the cars are 4-wheel drive and
    the others are rear-wheel drive, while among compact cars more of the cars are
    front-wheel drive and the others are 4-wheel drive. SUV plot shows a clear negative
    relationship between highway mileage and displacement, while in the compact cars
    plot, the relationship is much flatter.](assets/rds2_11in23.png)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![左侧是SUV高速公路里程与排量的散点图。右侧是紧凑型车辆相同变量的散点图。点按驱动类型着色。在SUV中，更多车辆是四轮驱动，其他的是后轮驱动，而在紧凑型车辆中，更多的车辆是前轮驱动，其他的是四轮驱动。SUV图显示了高速公路里程与排量之间明显的负相关关系，而在紧凑型车辆图中，关系要平缓得多。](assets/rds2_11in23.png)'
- en: One way to overcome this problem is to share scales across multiple plots, training
    the scales with the `limits` of the full data.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 克服这个问题的一种方法是在多个图形之间共享比例尺，使用完整数据的`limits`训练比例尺。
- en: '[PRE27]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '![On the left, a scatterplot of highway mileage vs. displacement of SUVs. On
    the right, a scatterplot of the same variables for compact cars. Points are colored
    by drive type for both plots. Both plots are plotted on the same scale for highway
    mileage, displacement, and drive type, resulting in the legend showing all three
    types (front, rear, and 4-wheel drive) for both plots even though there are no
    front-wheel drive SUVs and no rear-wheel drive compact cars. Since the x and y
    scales are the same, and go well beyond minimum or maximum highway mileage and
    displacement, the points do not take up the entire plotting area.](assets/rds2_11in24.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![左侧是SUV高速公路里程与排量的散点图。右侧是紧凑型车辆相同变量的散点图。点按驱动类型着色。尽管SUV中没有前轮驱动车辆，紧凑型车中也没有后轮驱动车辆，但两个图中的图例显示了所有三种类型（前轮驱动、后轮驱动和四轮驱动）。由于x和y轴的比例相同，并且远远超出了最小或最大的高速公路里程和排量，点没有占据整个绘图区域。](assets/rds2_11in24.png)'
- en: In this particular case, you could have simply used faceting, but this technique
    is useful more generally, if, for instance, you want to spread plots over multiple
    pages of a report.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种特定情况下，你可以简单地使用分面，但如果你想在报告的多个页面上分散绘图，这种技术通常也很有用。
- en: Exercises
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习
- en: Why doesn’t the following code override the default scale?
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为什么以下代码没有覆盖默认比例尺？
- en: '[PRE28]'
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: What is the first argument to every scale? How does it compare to [`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml)?
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每个比例尺的第一个参数是什么？它与[`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml)有什么区别？
- en: 'Change the display of the presidential terms by:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更改总统任期的显示方法：
- en: Combining the two variants that customize colors and x-axis breaks
  id: totrans-142
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 结合定制颜色和x轴分割的两个变体
- en: Improving the display of the y-axis
  id: totrans-143
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 改善y轴的显示
- en: Labeling each term with the name of the president
  id: totrans-144
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用总统姓名标记每个任期
- en: Adding informative plot labels
  id: totrans-145
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加信息丰富的图形标签
- en: Placing breaks every four years (this is trickier than it seems!)
  id: totrans-146
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每隔四年设置分割点（这比看起来更复杂！）
- en: First, create the following plot. Then, modify the code using `override.aes`
    to make the legend easier to see.
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先创建以下图形。然后，使用`override.aes`修改代码，以使图例更容易看到。
- en: '[PRE29]'
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Themes
  id: totrans-149
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 主题
- en: 'Finally, you can customize the nondata elements of your plot with a theme:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，您可以使用主题定制图表的非数据元素：
- en: '[PRE30]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '![Scatterplot of highway mileage vs. displacement of cars, colored by class
    of car. The plot background is white, with gray grid lines.](assets/rds2_11in25.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![汽车公路里程与汽车排量的散点图，按车辆类别着色。图的背景为白色，带有灰色网格线。](assets/rds2_11in25.png)'
- en: ggplot2 includes the eight themes shown in [Figure 11-2](#fig-themes), with
    [`theme_gray()`](https://ggplot2.tidyverse.org/reference/ggtheme.xhtml) as the
    default.^([2](ch11.xhtml#idm44771303447760)) Many more are included in add-on
    packages like [ggthemes](https://oreil.ly/F1nga), by Jeffrey Arnold. You can also
    create your own themes, if you are trying to match a particular corporate or journal
    style.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: ggplot2 包含了八种主题，如 [图 11-2](#fig-themes) 所示，其中 [`theme_gray()`](https://ggplot2.tidyverse.org/reference/ggtheme.xhtml)
    是默认主题。^([2](ch11.xhtml#idm44771303447760)) 还有许多其他主题包含在像 [ggthemes](https://oreil.ly/F1nga)
    这样的附加包中，由 Jeffrey Arnold 提供。如果您想匹配特定的公司或期刊风格，您也可以创建自己的主题。
- en: '![Eight barplots created with ggplot2, each with one of the eight built-in
    themes: theme_bw() - White background with grid lines, theme_light() - Light axes
    and grid lines, theme_classic() - Classic theme, axes but no grid lines, theme_linedraw()
    - Only black lines, theme_dark() - Dark background for contrast, theme_minimal()
    - Minimal theme, no background, theme_gray() - Gray background (default theme),
    theme_void() - Empty theme, only geoms are visible.](assets/rds2_1102.png)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![使用 ggplot2 创建的八个条形图，每个图使用一种内置主题：theme_bw() - 白色背景带有网格线，theme_light() - 浅色轴线和网格线，theme_classic()
    - 经典主题，仅有轴线而无网格线，theme_linedraw() - 仅有黑线，theme_dark() - 深色背景以增加对比度，theme_minimal()
    - 极简主题，无背景，theme_gray() - 灰色背景（默认主题），theme_void() - 空主题，只有几何图形可见。](assets/rds2_1102.png)'
- en: Figure 11-2\. The eight themes built in to ggplot2.
  id: totrans-155
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 11-2\. ggplot2 内置的八种主题。
- en: It’s also possible to control individual components of each theme, such as the
    size and color of the font used for the y-axis. We’ve already seen that `legend.position`
    controls where the legend is drawn. There are many other aspects of the legend
    that can be customized with [`theme()`](https://ggplot2.tidyverse.org/reference/theme.xhtml).
    For example, in the following plot we change the direction of the legend as well
    as put a black border around it. Note that customization of the legend box and
    plot title elements of the theme are done with `element_*()` functions. These
    functions specify the styling of nondata components; e.g., the title text is bolded
    in the `face` argument of [`element_text()`](https://ggplot2.tidyverse.org/reference/element.xhtml),
    and the legend border color is defined in the `color` argument of [`element_rect()`](https://ggplot2.tidyverse.org/reference/element.xhtml).
    The theme elements that control the position of the title and the caption are
    `plot.title.position` and `plot.caption.position`, respectively. In the following
    plot these are set to `"plot"` to indicate these elements are aligned to the entire
    plot area, instead of the plot panel (the default). A few other helpful [`theme()`](https://ggplot2.tidyverse.org/reference/theme.xhtml)
    components are used to change the placement for formatting the title and caption
    text.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以控制每个主题的各个组件，例如用于 y 轴字体的大小和颜色。我们已经看到 `legend.position` 控制图例绘制的位置。还有许多其他图例的方面可以通过
    [`theme()`](https://ggplot2.tidyverse.org/reference/theme.xhtml) 进行自定义。例如，在下面的图中，我们改变了图例的方向，并在其周围添加了黑色边框。请注意，主题的图例框和图表标题元素的自定义是使用
    `element_*()` 函数完成的。这些函数指定非数据组件的样式；例如，标题文本在 [`element_text()`](https://ggplot2.tidyverse.org/reference/element.xhtml)
    的 `face` 参数中加粗，图例边框颜色在 [`element_rect()`](https://ggplot2.tidyverse.org/reference/element.xhtml)
    的 `color` 参数中定义。控制标题位置和说明的主题元素分别为 `plot.title.position` 和 `plot.caption.position`。在下面的图中，将它们设置为
    `"plot"` 表示这些元素与整个图区对齐，而不是图面板（默认设置）。其他几个有用的 [`theme()`](https://ggplot2.tidyverse.org/reference/theme.xhtml)
    组件用于更改标题和说明文本的格式和放置位置。
- en: '[PRE31]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '![Scatterplot of highway fuel efficiency versus engine size of cars, colored
    by drive. The plot is titled ''Larger engine sizes tend to have lower fuel economy''
    with the caption pointing to the source of the data, fueleconomy.gov. The caption
    and title are left justified, the legend is inside of the plot with a black border.](assets/rds2_11in26.png)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![汽车公路燃油效率与发动机大小的散点图，按驱动类型着色。图的标题为“较大的发动机尺寸通常具有较低的燃油经济性”，说明指向数据来源 fueleconomy.gov。说明和标题左对齐，图例位于图内，带有黑色边框。](assets/rds2_11in26.png)'
- en: For an overview of all [`theme()`](https://ggplot2.tidyverse.org/reference/theme.xhtml)
    components, see the help with [`?theme`](https://ggplot2.tidyverse.org/reference/theme.xhtml).
    The [ggplot2 book](https://oreil.ly/T4Jxn) is also a great place to go for the
    full details on theming.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看所有 [`theme()`](https://ggplot2.tidyverse.org/reference/theme.xhtml) 组件的概述，请参阅
    [`?theme`](https://ggplot2.tidyverse.org/reference/theme.xhtml) 的帮助。此外，[ggplot2
    书籍](https://oreil.ly/T4Jxn)也是获取主题详细信息的好地方。
- en: Exercises
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习
- en: Pick a theme offered by the ggthemes package and apply it to the last plot you
    made.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 ggthemes 包提供的主题，并将其应用到您制作的最后一个图中。
- en: Make the axis labels of your plot blue and bold.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使您图的轴标签变为蓝色和粗体。
- en: Layout
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 布局
- en: So far we talked about how to create and modify a single plot. What if you have
    multiple plots you want to lay out in a certain way? The patchwork package allows
    you to combine separate plots into the same graphic. We loaded this package earlier
    in the chapter.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们讨论了如何创建和修改单个图。如果您有多个图想要以某种方式布局呢？patchwork 包允许您将单独的图合并到同一图形中。我们在本章前面加载了这个包。
- en: To place two plots next to each other, you can simply add them to each other.
    Note that you first need to create the plots and save them as objects (in the
    following example they’re called `p1` and `p2`). Then, you place them next to
    each other with `+`.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 要将两个图放置在一起，您可以简单地将它们添加到一起。请注意，您首先需要创建图并将它们保存为对象（在下面的示例中称为 `p1` 和 `p2`）。然后，您可以使用
    `+` 将它们放置在一起。
- en: '[PRE32]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '![Two plots (a scatterplot of highway mileage versus engine size and a side-by-side
    boxplots of highway mileage versus drivetrain) placed next to each other.](assets/rds2_11in27.png)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
  zh: '![两个图（一张是高速公路里程与发动机大小的散点图，另一张是高速公路里程与驱动系统的并排箱线图）并排放置在一起。](assets/rds2_11in27.png)'
- en: It’s important to note that in the previous code chunk we did not use a new
    function from the patchwork package. Instead, the package added a new functionality
    to the `+` operator.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的代码块中，重要的是我们没有使用 patchwork 包的新功能。相反，该包向 `+` 操作符添加了新功能。
- en: 'You can also create complex plot layouts with patchwork. In the following,
    `|` places the `p1` and `p3` next to each other, and `/` moves `p2` to the next
    line:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用 patchwork 创建复杂的图形布局。在下面的示例中，`|` 将 `p1` 和 `p3` 并排放置，`/` 将 `p2` 移到下一行：
- en: '[PRE33]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '![Three plots laid out such that first and third plot are next to each other
    and the second plot stretched beneath them. The first plot is a scatterplot of
    highway mileage versus engine size, third plot is a scatterplot of highway mileage
    versus city mileage, and the third plot is side-by-side boxplots of highway mileage
    versus drivetrain) placed next to each other.](assets/rds2_11in28.png)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![三个图的布局，第一个和第三个图并排放置，第二个图在它们下面拉伸。第一个图是高速公路里程与发动机大小的散点图，第三个图是高速公路里程与城市里程的散点图，第三个图是高速公路里程与驱动系统的并排箱线图。](assets/rds2_11in28.png)'
- en: Additionally, patchwork allows you to collect legends from multiple plots into
    one common legend, customize the placement of the legend as well as dimensions
    of the plots, and add a common title, subtitle, caption, etc., to your plots.
    Here we created five plots. We turned off the legends on the box plots and the
    scatterplot and collected the legends for the density plots at the top of the
    plot with `& theme(legend.position = "top")`. Note the use of the `&` operator
    here instead of the usual `+`. This is because we’re modifying the theme for the
    patchwork plot as opposed to the individual ggplots. The legend is placed on top,
    inside the [`guide_area()`](https://patchwork.data-imaginist.com/reference/guide_area.xhtml).
    Finally, we have also customized the heights of the various components of our
    patchwork—the guide has a height of 1, the box plots 3, the density plots 2, and
    the faceted scatterplot 4\. Patchwork divides up the area you have allotted for
    your plot using this scale and places the components accordingly.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，patchwork 还允许您将多个图的图例收集到一个共同的图例中，自定义图例的位置以及图的尺寸，并向您的图添加共同的标题、副标题、说明等。在这里，我们创建了五个图。我们关闭了箱线图和散点图的图例，并在图的顶部收集了密度图的图例，使用了
    `& theme(legend.position = "top")`。请注意，这里使用的是 `&` 运算符，而不是通常的 `+`。这是因为我们要修改 patchwork
    图的主题，而不是单个 ggplot 的主题。图例位于顶部，在 [`guide_area()`](https://patchwork.data-imaginist.com/reference/guide_area.xhtml)
    内。最后，我们还自定义了 patchwork 的各个组件的高度——指南的高度为1，箱线图为3，密度图为2，分面散点图为4。Patchwork 使用此比例划分您为图分配的区域，并相应地放置组件。
- en: '[PRE34]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '![Five plots laid out such that first two plots are next to each other. Plots
    three and four are underneath them. And the fifth plot stretches under them. The
    patchworked plot is titled "City and highway mileage for cars with different drivetrains"
    and captioned "Source: https://fueleconomy.gov". The first two plots are side-by-side
    box plots. Plots 3 and 4 are density plots. And the fifth plot is a faceted scatterplot.
    Each of these plots show geoms colored by drivetrain, but the patchworked plot
    has only one legend that applies to all of them, above the plots and beneath the
    title.](assets/rds2_11in29.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![五个图表布局如下：前两个图表并列显示。第三和第四个图表位于它们的下方。第五个图表横跨它们的下方。这个合成图表的标题是“不同驱动系统汽车的城市和高速里程”，注释是“来源：https://fueleconomy.gov”。前两个图表是并排的箱线图。第三和第四个图表是密度图。第五个图表是分面散点图。这些图表展示了根据驱动系统着色的几何图形，但合成图表只有一个适用于所有图表的图例，位于图表上方和标题下方。](assets/rds2_11in29.png)'
- en: If you’d like to learn more about combining and laying out multiple plots with
    patchwork, we recommend looking through the guides on the [package website](https://oreil.ly/xWxVV).
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想了解如何结合和布局多个图表，我们建议查阅[包网站](https://oreil.ly/xWxVV)上的指南。
- en: Exercises
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习
- en: What happens if you omit the parentheses in the following plot layout. Can you
    explain why this happens?
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你在以下图表布局中省略了括号会发生什么？你能解释为什么会发生这种情况吗？
- en: '[PRE35]'
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Using the three plots from the previous exercise, re-create the following patchwork:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 使用前一练习中的三个图表，重新创建以下的patchwork：
- en: '![Three plots: Plot 1 is a scatterplot of highway mileage versus engine size.
    Plot 2 is side-by-side box plots of highway mileage versus drivetrain. Plot 3
    is side-by-side box plots of city mileage versus drivetrain. Plots 1 is on the
    first row. Plots 2 and 3 are on the next row, each span half the width of Plot
    1\. Plot 1 is labelled "Fig. A", Plot 2 is labelled "Fig. B", and Plot 3 is labelled
    "Fig. C".](assets/rds2_11in30.png)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![三个图表：图表1是高速里程与引擎尺寸的散点图。图表2是侧面的箱线图，显示不同驱动系统的高速里程。图表3是侧面的箱线图，显示不同驱动系统的城市里程。图表1位于第一行。图表2和图表3位于下一行，每个图表占图表1宽度的一半。图表1标为“图A”，图表2标为“图B”，图表3标为“图C”。](assets/rds2_11in30.png)'
- en: Summary
  id: totrans-181
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter you learned about adding plot labels such as title, subtitle,
    and caption as well as modifying default axis labels, using annotation to add
    informational text to your plot or to highlight specific data points, customizing
    the axis scales, and changing the theme of your plot. You also learned about combining
    multiple plots in a single graph using both simple and complex plot layouts.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了如何添加图表标签，如标题、副标题和说明，以及修改默认轴标签，使用注释添加信息文本到你的图表或突出显示特定数据点，定制轴标尺，以及改变图表的主题。你还学习了如何使用简单和复杂的图表布局将多个图表合并到单个图形中。
- en: 'While you’ve so far learned about how to make many different types of plots
    and how to customize them using a variety of techniques, we’ve barely scratched
    the surface of what you can create with ggplot2\. If you want to get a comprehensive
    understanding of ggplot2, we recommend reading the book [*ggplot2: Elegant Graphics
    for Data Analysis*](https://oreil.ly/T4Jxn) (Springer). Other useful resources
    are the [*R Graphics Cookbook*](https://oreil.ly/CK_sd) by Winston Chang (O’Reilly)
    and [*Fundamentals of Data Visualization*](https://oreil.ly/uJRYK) by Claus Wilke
    (O’Reilly).'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: '尽管你迄今已学习了如何制作许多不同类型的图表，并且如何使用各种技术进行定制，但我们仅仅触及了ggplot2能创造的冰山一角。如果你希望全面理解ggplot2，我们建议阅读[*ggplot2:
    Elegant Graphics for Data Analysis*](https://oreil.ly/T4Jxn)（Springer）这本书。其他有用的资源包括Winston
    Chang的[*R Graphics Cookbook*](https://oreil.ly/CK_sd)（O’Reilly）以及Claus Wilke的[*Fundamentals
    of Data Visualization*](https://oreil.ly/uJRYK)（O’Reilly）。'
- en: ^([1](ch11.xhtml#idm44771304642976-marker)) You can use a tool like [SimDaltonism](https://oreil.ly/i11yd)
    to simulate color blindness to test these images.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](ch11.xhtml#idm44771304642976-marker)) 你可以使用像[SimDaltonism](https://oreil.ly/i11yd)这样的工具来模拟色盲，以测试这些图像。
- en: ^([2](ch11.xhtml#idm44771303447760-marker)) Many people wonder why the default
    theme has a gray background. This was a deliberate choice because it puts the
    data forward while still making the grid lines visible. The white grid lines are
    visible (which is important because they significantly aid position judgments),
    but they have little visual impact, and we can easily tune them out. The gray
    background gives the plot a similar typographic color to the text, ensuring that
    the graphics fit in with the flow of a document without jumping out with a bright
    white background. Finally, the gray background creates a continuous field of color,
    which ensures that the plot is perceived as a single visual entity.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: ^([2](ch11.xhtml#idm44771303447760-marker)) 许多人想知道为什么默认主题有灰色背景。这是一个有意为之的选择，因为它突出了数据，同时使网格线可见。白色网格线是可见的（这很重要，因为它们显著地帮助位置判断），但它们在视觉上影响较小，我们可以轻松忽略它们。灰色背景使得绘图与文本的排版颜色相似，确保图形与文档流畅融合，而不是用明亮的白色背景突兀地跳出来。最后，灰色背景形成了连续的色彩场，确保绘图被感知为一个单一的视觉实体。
