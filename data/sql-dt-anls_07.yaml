- en: Chapter 7\. Experiment Analysis
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第7章 实验分析
- en: '*Experimentation*, also known as *A/B testing* or *split testing*, is considered
    the gold standard for establishing causality. Much data analysis work involves
    establishing correlations: one thing is more likely to happen when another thing
    also happens, whether that be an action, an attribute, or a seasonal pattern.
    You’ve probably heard the saying “correlation does not imply causation,” however,
    and it is exactly this problem in data analysis that experimentation attempts
    to solve.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*实验*，也称为*A/B测试*或*分割测试*，被认为是建立因果关系的黄金标准。许多数据分析工作涉及建立相关性：一件事在另一件事发生时更有可能发生，无论是行动、属性还是季节模式。您可能听说过“相关不意味着因果关系”的说法，而正是数据分析中的这个问题，实验试图解决。'
- en: 'All experiments begin with a *hypothesis*: a guess about behavioral change
    that will result from some alteration to a product, process, or message. The change
    might be to a user interface, a new user onboarding flow, an algorithm that powers
    recommendations, marketing messaging or timing, or any number of other areas.
    If the organization built it or has control over it, it can be experimented on,
    at least in theory. Hypotheses are often driven by other data analysis work. For
    example, we might find that a high percentage of people drop out of the checkout
    flow, and we could hypothesize that more people might complete the checkout process
    if the number of steps were reduced.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 所有实验都始于一个*假设*：关于产品、流程或消息进行某种改变会导致行为变化的猜测。这种改变可能是用户界面、新用户入门流程、推荐算法、营销消息或时机等任何领域。理论上，只要组织构建或控制它，就可以进行实验。假设通常受到其他数据分析工作的驱动。例如，我们可能发现很高比例的人在结账流程中退出，我们可以假设如果减少步骤，更多人可能会完成结账流程。
- en: The second element necessary for any experiment is a *success metric*. The behavioral
    change we hypothesize might be related to form completion, purchase conversion,
    click-through, retention, engagement, or any other behavior that is important
    to the organization’s mission. The success metric should quantify this behavior,
    be reasonably easy to measure, and be sensitive enough to detect a change. Click-through,
    checkout completion, and time to complete a process are often good success metrics.
    Retention and customer satisfaction are often less suitable success metrics, despite
    being very important, because they are frequently influenced by many factors beyond
    what is being tested in any individual experiment and thus are less sensitive
    to the changes we’d like to test. Good success metrics are often ones that you
    already track as part of understanding company or organizational health.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 任何实验所需的第二个要素是*成功指标*。我们假设的行为变化可能与表单完成、购买转化、点击率、保留率、参与度或组织使命相关的任何其他行为有关。成功指标应量化这种行为，易于测量，并且足够敏感以检测到变化。点击率、结账完成率和完成流程所需时间通常是很好的成功指标。保留率和客户满意度通常不太适合作为成功指标，尽管它们非常重要，因为它们往往受到超出任何个别实验所测试内容的许多因素的影响，因此对我们想测试的变化不太敏感。好的成功指标通常是您已经作为了解公司或组织健康的一部分而跟踪的指标。
- en: Tip
  id: totrans-4
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: You may wonder whether an experiment can have multiple success metrics. Certainly
    with SQL, it is usually possible to generate many different calculations and metrics.
    You should be aware of the multiple comparisons problem, however. I won’t go into
    a full explanation here, but the gist is that the more places you look for a significant
    change, the more likely you are to find one. Check one metric, and you may or
    may not find a significant change in one of the experiment variants. Check 20
    metrics, however, and there’s a pretty good chance that at least one will show
    significance, whether or not the experiment had anything to do with that metric
    in the first place. As a rule of thumb, there should be one or maybe two primary
    success metrics. One to five additional metrics may be used for downside protection.
    These are sometimes called *guardrail metrics*. For example, you may want to ensure
    that an experiment doesn’t hurt page-loading time, even though it’s not the goal
    of the experiment to improve it.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会想知道一个实验是否可以有多个成功指标。当然，使用 SQL，通常可以生成许多不同的计算和指标。但是，你应该意识到存在多重比较问题。我不会在这里进行详细解释，但核心是，你查看的地方越多，找到显著变化的可能性就越大。检查一个指标，你可能会发现实验变体中的一个是否有显著变化，也可能没有。然而，如果检查
    20 个指标，至少有一个显示显著性的可能性相当大，无论实验是否与该指标有关。作为一个经验法则，应该有一个或者最多两个主要的成功指标。还可以使用一到五个额外的指标用于防范风险，有时被称为*防护指标*。例如，你可能希望确保实验不会影响页面加载时间，即使这并不是实验的目标所在。
- en: The third element of experimentation is a system that randomly assigns entities
    to a control or experiment variant group and alters the experience accordingly.
    This type of system is also sometimes called a *cohorting system*. A number of
    software vendors offer experiment-cohorting tools, though some organizations choose
    to build them internally in order to achieve more flexibility. Either way, to
    perform experiment analysis with SQL, the entity-level assignment data must flow
    into a table in the database that also contains behavioral data.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 实验的第三要素是一个随机将实体分配到控制组或实验变体组，并相应地修改体验的系统。这种类型的系统有时也被称为*分组系统*。许多软件供应商提供实验分组工具，尽管一些组织选择内部构建它们以获得更大的灵活性。无论哪种方式，要使用
    SQL 进行实验分析，实体级别的分配数据必须流入数据库表中，同时包含行为数据。
- en: Tip
  id: totrans-7
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 小贴士
- en: The discussions of experiments in this chapter specifically refer to online
    experiments, in which variant assignment happens through a computer system and
    behavior is tracked digitally. There are certainly many types of experiments performed
    across science and social science disciplines. A key difference is that the success
    metrics and behaviors that are examined in online experiments are usually already
    tracked for other purposes, whereas in many scientific studies, the resulting
    behavior is tracked specifically for the experiment and only during the period
    of the experiment. With online experiments, we sometimes need to be creative about
    finding metrics that are good proxies for an impact when a direct measurement
    isn’t possible.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 本章讨论的实验特指在线实验，在这些实验中，变体分配通过计算机系统完成，并且行为被数字化跟踪。当然，科学和社会科学领域进行许多类型的实验。一个关键的区别是，在在线实验中检查的成功指标和行为通常已经被用于其他目的进行跟踪，而在许多科学研究中，结果行为是专门为实验跟踪的，并且仅在实验期间跟踪。在在线实验中，有时需要创造性地寻找能代表影响的好指标，当直接测量不可行时。
- en: With a hypothesis, a success metric, and a variant cohorting system in place,
    you can run experiments, collect the data, and analyze the outcomes using SQL.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 有了假设、成功指标和变体分组系统，你可以运行实验，收集数据，并使用 SQL 分析结果。
- en: Strengths and Limits of Experiment Analysis with SQL
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SQL 实验分析的优势和限制
- en: SQL is useful for analyzing experiments. In many cases with experiment analysis,
    the experiment cohort data and behavioral data are already flowing into a database,
    making SQL a natural choice. Success metrics are often already part of an organization’s
    reporting and analysis vocabulary, with SQL queries already developed. Joining
    variant assignment data to existing query logic is often relatively straightforward.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: SQL 对于分析实验非常有用。在许多情况下，实验队列数据和行为数据已经流入数据库，使得 SQL 成为一个自然的选择。成功指标通常已经成为组织报告和分析词汇的一部分，并且已经开发了
    SQL 查询。将变体分配数据加入现有的查询逻辑通常相对比较直接。
- en: SQL is a good choice for automating experiment result reporting. The same query
    can be run for each experiment, substituting the name or identifier of the experiment
    in the *WHERE* clause. Many organizations with high volumes of experiments have
    created standardized reports to speed up readouts and simplify the interpretation
    process.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: SQL 是自动化实验结果报告的一个很好的选择。可以为每个实验运行相同的查询，在 *WHERE* 子句中替换实验的名称或标识符。许多进行大量实验的组织已创建了标准化报告，以加快阅读速度并简化解释过程。
- en: 'While SQL is useful for many of the steps involved with experiment analysis,
    it does have one major shortcoming: SQL is not able to calculate statistical significance.
    Many databases allow developers to extend SQL functionality with *user-defined
    functions* (UDFs). UDFs may be able to leverage statistical tests from languages
    such as Python, but they are beyond the scope of this book. A good option is to
    calculate summary statistics in SQL and then use an online calculator such as
    the one provided at [Evanmiller.org](https://oreil.ly/3uspA) to determine whether
    the experiment result is statistically significant.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管 SQL 在实验分析的许多步骤中很有用，但它确实有一个主要缺点：SQL 无法计算统计显著性。许多数据库允许开发人员通过 *用户定义函数*（UDFs）扩展
    SQL 功能。UDFs 可能能够利用来自诸如 Python 等语言的统计测试，但这超出了本书的范围。一个很好的选择是在 SQL 中计算摘要统计信息，然后使用提供在[Evanmiller.org](https://oreil.ly/3uspA)的在线计算器来确定实验结果是否具有统计显著性。
- en: The Data Set
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据集
- en: For this chapter, we will use a data set for a mobile game from the fictional
    Tanimura Studios. There are four tables. The `game_users` table contains records
    for people who downloaded the mobile game, along with the date and country. A
    sample of the data is shown in [Figure 7-1](#sample_of_the_game_users_table).
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 本章节中，我们将使用来自虚构的 Tanimura Studios 移动游戏的数据集。有四个表格。`game_users` 表包含下载移动游戏的人员记录，以及日期和国家。数据样本见[图
    7-1](#sample_of_the_game_users_table)。
- en: '![](Images/sfda_0701.png)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/sfda_0701.png)'
- en: Figure 7-1\. Sample of the `game_users` table
  id: totrans-17
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 7-1\. `game_users` 表的样本
- en: The `game_actions` table contains records for things the users did in the game.
    A sample of the data is shown in [Figure 7-2](#sample_of_the_game_actions_table).
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '`game_actions` 表包含用户在游戏中的操作记录。数据样本见[图 7-2](#sample_of_the_game_actions_table)。'
- en: '![](Images/sfda_0702.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/sfda_0702.png)'
- en: Figure 7-2\. Sample of the `game_actions` table
  id: totrans-20
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 7-2\. `game_actions` 表的样本
- en: The `game_purchases` table tracks purchases of in-game currency in US dollars.
    A sample of the data is shown in [Figure 7-3](#sample_of_the_game_purchases_table).
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '`game_purchases` 表跟踪以美元计的游戏内货币购买记录。数据样本见[图 7-3](#sample_of_the_game_purchases_table)。'
- en: '![](Images/sfda_0703.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/sfda_0703.png)'
- en: Figure 7-3\. Sample of the `game_purchases` table
  id: totrans-23
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 7-3\. `game_purchases` 表的样本
- en: Finally, the `exp_assignment` table contains records of which variant users
    were assigned to for a particular experiment. A sample of the data is shown in
    [Figure 7-4](#sample_of_the_exp_assignment_table).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，`exp_assignment` 表包含用户分配给特定实验变体的记录。数据样本见[图 7-4](#sample_of_the_exp_assignment_table)。
- en: '![](Images/sfda_0704.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/sfda_0704.png)'
- en: Figure 7-4\. Sample of the `exp_assignment` table
  id: totrans-26
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 7-4\. `exp_assignment` 表的样本
- en: All of the data in these tables is fictional, created with random number generators,
    though the structure is similar to what you might see in the database of a real
    digital gaming company.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些表中的数据都是虚构的，使用随机数生成器创建的，尽管结构类似于您可能在真实数字游戏公司的数据库中看到的。
- en: Types of Experiments
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实验类型
- en: 'There is a wide range of experiments. If you can change something that a user,
    customer, constituent, or other entity experiences, you can in theory test that
    change. From an analysis standpoint, there are two main types of experiments:
    those with binary outcomes and those with continuous outcomes.'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 实验种类繁多。如果可以改变用户、客户、选民或其他实体体验的某些方面，理论上可以测试该变更。从分析角度来看，实验主要分为两种类型：二元结果和连续结果。
- en: 'Experiments with Binary Outcomes: The Chi-Squared Test'
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 二元结果的实验：卡方检验
- en: 'As you might expect, a binary outcome experiment has only two outcomes: either
    an action is taken or it isn’t. Either a user completes a registration flow or
    they don’t. A consumer clicks on a website ad or they don’t. A student graduates
    or they don’t. For these types of experiments, we calculate the proportion of
    each variant that completes the action. The numerator is the number of completers,
    while the denominator is all units that were exposed. This metric is also described
    as a rate: completion rate, click-through rate, graduation rate, and so on.'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所预期的，二元结果实验只有两种结果：要么采取行动，要么不采取。用户完成注册流程或不完成。消费者点击网站广告或不点击。学生毕业或不毕业。对于这些类型的实验，我们计算每个变体完成操作的比例。分子是完成者的数量，分母是所有曝光单元。该指标也称为比率：完成率、点击率、毕业率等。
- en: To determine whether the rates in the variants are statistically different,
    we can use the *chi-squared test*, which is a statistical test for categorical
    variables.^([1](ch07.xhtml#ch01fn9)) Data for a chi-squared test is often shown
    in the form of a *contingency table*, which shows the frequency of observations
    at the intersection of two attributes. This looks just like a pivot table to those
    who are familiar with that type of table.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 要确定变体中的比率是否在统计上存在差异，我们可以使用*卡方检验*，这是一种用于分类变量的统计检验。^([1](ch07.xhtml#ch01fn9))
    卡方检验的数据通常以*列联表*的形式显示，该表显示了两个属性交集处的观察频率。对于熟悉这种类型表格的人来说，这看起来就像是透视表。
- en: Let’s take a look at an example, using our mobile game data set. A product manager
    has introduced a new version of the onboarding flow, a series of screens that
    teach a new player how the game works. The product manager hopes that the new
    version will increase the number of players who complete the onboarding and start
    their first game session. The new version was introduced in an experiment called
    “Onboarding” that assigned users to either control or variant 1, as tracked in
    the `exp_assignment` table. An event called “onboarding complete” in the `game_actions`
    table indicates whether a user completed the onboarding flow.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看一个例子，使用我们的移动游戏数据集。产品经理推出了新版本的入职流程，一系列屏幕向新玩家介绍游戏的工作原理。产品经理希望新版本能够增加完成入职并开始他们的第一游戏会话的玩家数量。新版本在名为“Onboarding”的实验中引入，将用户分配到控制组或变体
    1，如`exp_assignment`表中跟踪的那样。`game_actions`表中的“完成入职”事件指示用户是否完成了入职流程。
- en: 'The contingency table shows the frequency at the intersection of the variant
    assignment (control or variant 1) and whether or not onboarding was completed.
    We can use a query to find the values for the table. Here we `count` the number
    of users with and without an “onboarding complete” action and *GROUP BY* the `variant`:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 列联表显示了变体分配（控制或变体 1）与是否完成入职的交集处的频率。我们可以使用查询来找到表的值。在这里，我们计算具有和没有“完成入职”动作的用户数，并按`variant`进行*GROUP
    BY*：
- en: '[PRE0]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Adding totals for each row and column turns this output into a contingency table,
    as in [Figure 7-5](#contingency_table_for_onboarding_comple).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 将每行和每列的总数加起来，将此输出转换为一个列联表，如[图 7-5](#contingency_table_for_onboarding_comple)所示。
- en: '![](Images/sfda_0705.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/sfda_0705.png)'
- en: Figure 7-5\. Contingency table for onboarding completions
  id: totrans-38
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 7-5\. 完成入职的列联表
- en: 'To make use of one of the online significance calculators, we will need the
    number of successes, or times when the action was taken, and the total number
    cohorted for each variant. The SQL to find the required data points is straightforward.
    The assigned variant and the `count` of users assigned to that variant are queried
    from the `exp_assignment` table. We then *LEFT JOIN* the `game_actions` table
    to find the `count` of users who completed onboarding. The *LEFT JOIN* is required
    since we expect that not all users completed the relevant action. Finally, we
    find the percent completed in each variant by dividing the number of users who
    completed by the total number cohorted:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用在线显著性计算器之一，我们需要成功次数或执行动作的次数以及每个变体的总体配对数。查找所需数据点的SQL非常简单。从`exp_assignment`表中查询分配的变体和该变体的用户`count`。然后，我们*LEFT
    JOIN* `game_actions`表以查找完成入职的用户`count`。由于我们预期并非所有用户都完成了相关操作，因此需要*LEFT JOIN*。最后，通过将完成用户数除以总配对数来查找每个变体的完成百分比：
- en: '[PRE1]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: We can see that variant 1 did indeed have more completions than the control
    experience, with 76.14% completing compared to 72.69%. But is this difference
    statistically significant, allowing us to reject the hypothesis that there is
    no difference? For this, we plug our results into an online calculator and confirm
    that the completion rate for variant 1 was significantly higher at a 95% confidence
    level than the completion rate for the control. Variant 1 can be declared the
    winner.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，变体1确实比控制体验有更多的完成率，完成率为76.14%，而控制体验为72.69%。但这种差异在统计学上是否显著，允许我们拒绝无差异的假设呢？为此，我们将结果输入在线计算器，并确认在95%的置信水平下，变体1的完成率显著高于控制组。变体1可以被宣布为胜利者。
- en: Tip
  id: totrans-42
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: A 95% confidence level is commonly used, although this is not the only option.
    There are many online articles and discussions about the meaning of confidence
    levels, which level to use, and adjustments in scenarios in which you are comparing
    multiple variants to a control.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 常用的置信水平是95%，尽管这不是唯一的选择。关于置信水平含义、使用哪个水平以及在比较多个变体与控制组时的调整，有许多在线文章和讨论。
- en: Binary outcome experiments follow this basic pattern. Calculate the successes
    or completions as well as the total members in each variant. The SQL used to derive
    the success events may be more complicated depending on the tables and how actions
    are stored in the database, but the output is consistent. Next, we’ll turn to
    experiments with continuous outcomes.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 二进制结果实验遵循这个基本模式。计算每个变体中的成功或完成次数，以及每个变体中的总成员数。用于获取成功事件的SQL可能会更加复杂，这取决于表格和动作在数据库中的存储方式，但输出是一致的。接下来，我们将转向具有连续结果的实验。
- en: 'Experiments with Continuous Outcomes: The t-Test'
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 连续结果实验：t检验
- en: Many experiments seek to improve *continuous metrics*, rather than the binary
    outcomes discussed in the last section. Continuous metrics can take on a range
    of values. Examples include amount spent by customers, time spent on page, and
    days an app is used. Ecommerce sites often want to increase sales, and so they
    might experiment on product pages or checkout flows. Content sites may test layout,
    navigation, and headlines to try to increase the number of stories read. A company
    running an app might run a remarketing campaign to remind users to come back to
    the app.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 许多实验旨在改进*连续指标*，而不是上一节讨论的二进制结果。连续指标可以取多个值。例如，客户的消费金额、页面停留时间以及应用程序使用天数。电子商务网站通常希望增加销售额，因此它们可能会在产品页面或结账流程上进行实验。内容网站可能会测试布局、导航和标题，以增加阅读的文章数量。运行应用程序的公司可能会进行重新营销活动，提醒用户回到应用程序。
- en: 'For these and other experiments with continuous success metrics, the goal is
    to figure out whether the average values in each variant differ from each other
    in a statistically significant way. The relevant statistical test is the *two-sample
    t-test*, which determines whether we can reject the null hypothesis that the averages
    are equal with a defined confidence interval, usually 95%. The statistical test
    has three inputs, all of which are straightforward to calculate with SQL: the
    mean, the standard deviation, and the count of observations.'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这些以及其他具有连续成功指标的实验，目标是找出每个变体中的平均值是否在统计上有显著差异。相关的统计检验是*双样本t检验*，它确定在通常为95%的置信区间下，我们是否可以拒绝平均值相等的零假设。统计测试有三个输入，所有这些都可以通过SQL进行简单计算：平均值、标准差和观察数量。
- en: 'Let’s take a look at an example using our game data. In the last section, we
    looked at whether a new onboarding flow increased the completion rate. Now we
    will consider whether that new flow increased user spending on in-game currency.
    The success metric is the amount spent, so we need to calculate the mean and standard
    deviation of this value for each variant. First we need to calculate the amount
    per user, since users can make multiple purchases. Retrieve the cohort assignment
    from the `exp_assignment` table and `count` the users. Next, *LEFT JOIN* to the
    `game_purchases` table to gather the amount data. The *LEFT JOIN* is required
    since not all users make a purchase, but we still need to include them in the
    mean and standard deviation calculations. For users without purchases, the amount
    is set to a default of 0 with `coalesce`. Since the `avg` and `stddev` functions
    ignore nulls, the 0 default is required to ensure that these records are included.
    The outer query summarizes the output values by variant:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过游戏数据来看一个例子。在上一节中，我们考察了新的入职流程是否提高了完成率。现在我们将考虑这个新流程是否增加了用户在游戏中的货币支出。成功指标是支出金额，因此我们需要计算每个变体的平均值和标准差。首先，我们需要计算每位用户的金额，因为用户可以进行多次购买。从`exp_assignment`表中检索分组分配，并计数用户。接下来，*LEFT
    JOIN*到`game_purchases`表中获取金额数据。由于不是所有用户都会购买，所以需要*LEFT JOIN*，但我们仍然需要包括他们在平均值和标准差计算中。对于没有购买记录的用户，金额默认设置为0，使用`coalesce`函数确保这些记录被包括在内，因为`avg`和`stddev`函数会忽略空值。外部查询通过变体对输出值进行汇总：
- en: '[PRE2]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Next, we plug these values into an online calculator and find that there is
    no significant difference between the control and variant groups at a 95% confidence
    interval. The “variant 1” group appears to have increased onboarding completion
    rates but not the `amount` spent.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将这些数值输入在线计算器中，并发现在95%置信区间内，控制组和变体组之间没有显著差异。 “变体1”组的入职完成率似乎有所提高，但未增加`金额`支出。
- en: 'Another question we might consider is whether variant 1 affected spending among
    those users who completed the onboarding. Those who don’t complete the onboarding
    never make it into the game and therefore don’t even have the opportunity to make
    a purchase. To answer this question, we can use a query similar to the previous
    one, but we’ll add an *INNER JOIN* to the `game_actions` table to restrict the
    users counted to only those who have an action of “onboarding complete”:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个我们可以考虑的问题是变体1是否影响了那些完成了入职流程的用户的支出。那些未完成入职流程的用户永远无法进入游戏，因此甚至没有机会进行购买。为了回答这个问题，我们可以使用类似于之前的查询，但是我们将向`game_actions`表添加一个*INNER
    JOIN*，以限制计算的用户仅限于具有“入职完成”操作的用户：
- en: '[PRE3]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Plugging these values into the calculator reveals that the average for the
    control group is statistically significantly higher than that for variant 1 at
    a 95% confidence interval. This result may seem perplexing, but it illustrates
    why it is so important to agree on the success metric for an experiment up front.
    The experiment variant 1 had a positive effect on onboarding completion and so
    can be judged a success. It did not have an effect on the overall spending level.
    This could be due to a mix shift: the additional users who made it through onboarding
    in variant 1 were less likely to pay. If the underlying hypothesis was that increasing
    onboarding completion rates would increase revenue, then the experiment should
    not be judged a success, and the product managers should come up with some new
    ideas to test.'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 将这些数值输入计算器后，发现控制组的平均值在95%置信区间内显著高于变体1组。这个结果可能看似令人困惑，但说明了为什么事先在实验中达成对成功指标的共识是如此重要。实验变体1对入职完成率有积极影响，因此可以判定为成功。但它对整体支出水平没有影响。这可能是由于混合变化导致的：在变体1中完成入职的额外用户较不可能付款。如果基础假设是增加入职完成率将增加收入，那么实验不应被视为成功，产品经理应该提出一些新的测试想法。
- en: Challenges with Experiments and Options for Rescuing Flawed Experiments
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实验中的挑战及修复失败实验的选项
- en: Although experimentation is the gold standard for understanding causality, there
    are a number of ways experiments can go wrong. If the entire premise is flawed,
    there won’t be much that SQL can do to save the day. If the flaw is more technical
    in nature, we may be able to query the data in such a way as to adjust or exclude
    problematic data points and still interpret some results. Running experiments
    has a cost in terms of the time spent by engineers, designers, or marketers who
    create variants. It also has *opportunity cost*, or the missed benefit that could
    have been gained by sending customers down an optimal conversion path or product
    experience. On a practical level, using SQL to help the organization at least
    learn something from an experiment is often time well spent.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然实验是理解因果关系的黄金标准，但实验可能出现多种问题。如果整个前提是错误的，SQL也无法拯救。如果问题更多是技术性质的，我们可以通过查询数据的方式调整或排除有问题的数据点，仍然可以解释一些结果。进行实验会消耗工程师、设计师或营销人员创建变体的时间成本。此外还有*机会成本*，即错失的本可以通过将客户引导至最佳转化路径或产品体验而获得的好处。在实际操作层面上，使用SQL至少能让组织从实验中学到一些东西，通常是值得花费时间的。
- en: Variant Assignment
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 变体分配
- en: Random assignment of experiment units (which can be users, sessions, or other
    entities) to control and variant groups is one of the key elements of experimentation.
    However, sometimes errors in the assignment process happen, whether because of
    a flaw in the experiment specification, a technical failure, or a limitation in
    the cohorting software. As a result, the control and variant groups may be of
    unequal sizes, fewer overall entities may have been cohorted than expected, or
    the assignment may not have actually been random.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 随机分配实验单元（可以是用户、会话或其他实体）到控制组和变体组是实验的关键要素之一。然而，有时分配过程中会出现错误，无论是因为实验规范的缺陷、技术故障还是分组软件的限制。结果是，控制组和变体组可能大小不等，可能比预期少了一些实体被分组，或者实际分配可能并非完全随机。
- en: SQL can sometimes help salvage an experiment in which too many units were cohorted.
    I have seen this happen when an experiment is meant to target only new users but
    all users are cohorted instead. Another way this can happen is when an experiment
    tests something that only a subset of users will see, either because it is a few
    clicks into the experience or because certain conditions must be met, such as
    previous purchase. Due to technical limitations, all users get cohorted, even
    though a chunk of them would never see the experiment treatment even if they are
    in that group. The solution is to add a *JOIN* into the SQL that restricts the
    users or entities considered to only those that were intended to be eligible.
    For example, in the case of a new user experiment, we can add an *INNER JOIN*
    to a table or subquery that contains user registration date and set a *WHERE*
    condition to exclude users who registered too far prior to the cohort event to
    be considered new. The same strategy can be used when a certain condition must
    be met to even see the experiment. Restrict the entities included by excluding
    those that shouldn’t be eligible via *JOIN*s and *WHERE* conditions. After doing
    this, you should check to make sure that the resulting population is a large enough
    sample to produce significant results.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: SQL有时可以帮助挽救那些因分组过多而导致实验失败的情况。我曾见过这种情况发生在实验本应只针对新用户，但所有用户都被分组的情况下。另一种情况是当实验测试仅有部分用户能看到的内容时发生，无论是因为需要点击几次才能看到，还是因为需要满足特定条件，比如之前的购买记录。由于技术限制，所有用户都被分组，即使其中很多人永远也看不到实验的内容。解决方案是通过在SQL中添加*JOIN*来限制只考虑原本应符合条件的用户或实体。例如，在新用户实验中，我们可以添加一个*INNER
    JOIN*到包含用户注册日期的表或子查询，并设置一个*WHERE*条件来排除那些注册时间过早的用户。当需要满足特定条件才能看到实验时，也可以使用相同的策略。通过*JOIN*和*WHERE*条件来限制包含的实体，排除那些不应该符合条件的。做完这些操作后，应确保结果样本足够大以产生显著的结果。
- en: If too few users or entities are cohorted, it’s important to check whether the
    sample is large enough to produce significant results. If not, run the experiment
    again. If the sample size is large enough, a second consideration is whether there
    is bias in who or what was cohorted. As an example, I have seen cases in which
    users on certain browsers or older app versions were not cohorted due to technical
    limitations. If populations that were excluded aren’t random and represent differences
    in location, technical savvy, or socioeconomic status, it’s important to consider
    both how large this population is relative to the rest and whether any adjustments
    should be made to include them in the final analysis.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如果分组的用户或实体太少，重要的是检查样本是否足够大以产生显著结果。如果不够大，则需要重新运行实验。如果样本量足够大，第二个考虑因素是分组是否存在偏差。例如，我曾经看到某些浏览器或旧版本应用由于技术限制而未被分组的情况。如果被排除的群体不是随机的，并且代表了位置、技术能力或社会经济地位的差异，重要的是考虑这些群体相对于其他群体的规模以及是否应该调整以将其纳入最终分析中。
- en: Another possibility is that the variant assignment system is flawed and entities
    are not assigned randomly. This is fairly unusual with most modern experiment
    tools, but if it happens, it invalidates the whole experiment. Results that are
    “too good to be true” might signal a variant assignment problem. I have seen,
    for example, cases in which highly engaged users are accidentally assigned to
    both treatment and control due to a change in experiment configuration. Careful
    data profiling can check whether entities have been assigned to multiple variants
    or whether users with high or low engagement prior to the experiment are clustered
    in a particular variant.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个可能性是变体分配系统存在缺陷，实体并未随机分配。这在大多数现代实验工具中相当不常见，但如果发生这种情况，则会使整个实验无效。结果“太好以至于难以置信”可能表明存在变体分配问题。例如，我曾经看到过高度参与的用户由于实验配置更改而意外地分配到了治疗组和对照组。通过仔细的数据分析可以检查实体是否已分配到多个变体，以及在实验之前是否存在高或低参与度的用户聚集在特定变体中。
- en: Tip
  id: totrans-61
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: Running an A/A test can help uncover flaws in the variant assignment software.
    In this type of test, entities are cohorted and success metrics are compared,
    just like in any other experiment. However, no changes are made to the experience,
    and both cohorts receive the control experience. Since the groups receive the
    same experience, we should expect no significant differences in the success metric.
    If it turns out there is a difference, further investigation should be done to
    uncover and fix the problem.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 运行 A/A 测试可以帮助发现变体分配软件中的缺陷。在这种测试中，实体被分组，并且成功指标进行比较，就像任何其他实验一样。然而，体验不会发生任何变化，两个分组都接收到控制体验。由于两组接收到相同的体验，我们不应该期望成功指标有显著差异。如果确实存在差异，需要进一步调查并解决问题。
- en: Outliers
  id: totrans-63
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 异常值
- en: Statistical tests for analyzing continuous success metrics rely on averages.
    As a result, they are sensitive to unusually high or low outlier values. I have
    seen experiments in which the presence of one or two particularly high-spending
    customers in a variant gives that variant a statistically significant edge over
    others. Without those few high spenders, the result may be neutral or even the
    reverse. In most cases, we are more interested in whether a treatment has an effect
    across a range of individuals, and thus adjusting for these outliers can make
    an experiment result more meaningful.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 用于分析连续成功指标的统计测试依赖于平均值。因此，它们对异常高或低的异常值非常敏感。我曾经看到实验中的一些情况，其中一个或两个特别高消费的客户的存在使得一个变体比其他变体具有统计显著优势。如果没有这些高消费者，结果可能是中性甚至相反的。在大多数情况下，我们更关心的是一种治疗是否对各种个体产生效果，因此调整这些异常值可以使实验结果更具有意义。
- en: We discussed anomaly detection in [Chapter 6](ch06.xhtml#anomaly_detection),
    and experiment analysis is another place in which those techniques can be applied.
    Outlier values can be determined either by analyzing the experiment results or
    by finding the base rate prior to the experiment. The outliers may be removed
    via a technique such as winsorizing (also discussed in [Chapter 6](ch06.xhtml#anomaly_detection)),
    which removes values beyond a threshold, such as the 95th or 99th percentile.
    This can be done in SQL before moving on to the rest of the experiment analysis.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在[第六章](ch06.xhtml#anomaly_detection)中讨论了异常检测，实验分析是这些技术可以应用的另一个领域。异常值可以通过分析实验结果或找到实验之前的基本率来确定。异常值可以通过例如winso化（也在[第六章](ch06.xhtml#anomaly_detection)中讨论过）的技术移除，该技术移除超出阈值的值，例如95th或99th百分位数。这可以在进入实验分析的SQL之前完成。
- en: 'Another option for dealing with outliers in continuous success metrics is to
    turn the success metric into a binary outcome. For example, instead of comparing
    the average spend across the control and variant groups, which may be distorted
    due to a few very high spenders, compare the purchase rate between the two groups
    and then follow the procedure discussed in the section on experiments with binary
    outcomes. We could consider the conversion rate to purchaser among users who completed
    onboarding in the control and variant 1 groups from the “Onboarding” experiment:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 处理连续成功指标中的异常值的另一种选择是将成功指标转换为二进制结果。例如，不再比较对照组和变体组的平均花费，因为这可能因为少数非常高的花费者而扭曲，而是比较两组之间的购买率，然后按照讨论的在二进制结果实验部分的程序进行。我们可以考虑在“入门”实验中完成入门的用户中的购买转化率，对比对照组和变体1组：
- en: '[PRE4]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: We can look at the numbers and observe that even though there are more users
    in variant 1, there are fewer purchasers. The percentage of users who purchased
    in the control group is 10%, compared to 9.91% for variant 1\. Next, we plug the
    data points into an online calculator. The conversion rate is statistically significantly
    higher for the control group. In this case, even though the rate of purchasing
    was higher for the control group, on a practical level we may be willing to accept
    this small decline if we believe that more users completing the onboarding process
    has other benefits. More players might boost rankings, for example, and players
    who enjoy the game may spread it to their friends via word of mouth, both of which
    can help growth and may then lead to attracting other new players who will become
    purchasers.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以观察到，尽管第一个变体的用户更多，但购买者却更少。在对照组中，购买用户的比例为10%，而第一个变体为9.91%。接下来，我们将数据点输入在线计算器。在对照组中，转化率在统计上显著更高。在这种情况下，尽管对照组的购买率更高，但从实际角度来看，如果我们认为更多用户完成入门流程具有其他益处，我们可能愿意接受这种小幅下降。例如，更多的玩家可能会提升排名，而享受游戏的玩家可能会通过口口相传将游戏传播给朋友，这两者都有助于增长，进而可能吸引其他新玩家成为购买者。
- en: The success metric can also be set to a threshold, and the share of entities
    meeting that threshold compared. For example, the success metric could be reading
    at least three stories or using an app at least two times a week. An infinite
    number of metrics could be constructed in this way, so it’s important to understand
    what is both important and meaningful to the organization.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 成功指标也可以设置为阈值，并比较达到该阈值的实体的份额。例如，成功指标可以是阅读至少三篇故事或每周使用应用程序至少两次。可以以这种方式构建无数的指标，因此了解对组织而言既重要又有意义的内容至关重要。
- en: Time Boxing
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 时间盒定
- en: Experiments are often run over the course of several weeks. This means that
    individuals who enter the experiment earlier have a longer window in which to
    complete actions associated with the success metric. To control for this, we can
    apply *time boxing*—imposing a fixed length of time relative to the experiment
    entry date and considering actions only during that window. This concept was also
    covered in [Chapter 4](ch04.xhtml#cohort_analysis).
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 实验通常持续几周。这意味着较早进入实验的个体有更长的时间窗口来完成与成功指标相关的操作。为了控制这一点，我们可以应用*时间盒定*——根据实验进入日期固定时间长度，并仅考虑该时间窗口内的操作。这个概念也在[第四章](ch04.xhtml#cohort_analysis)中有所涵盖。
- en: For experiments, the appropriate size of the time box depends on what you are
    measuring. The window could be as short as one hour when measuring an action that
    typically has an immediate response, such as clicking on an ad. For purchase conversion,
    experimenters often allow a window of 1 to 7 days. Shorter windows allow experiments
    to be analyzed sooner, since all cohorted entities need to be allowed the full
    time to complete actions. The best windows balance the need to obtain results
    with the actual dynamics of the organization. If customers typically convert in
    a few days, consider a 7-day window; if customers often take 20 or more days,
    consider a 30-day window.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 对于实验来说，时间框的合适大小取决于你要测量的内容。当测量通常具有即时响应的行为时，窗口可能只有一小时。对于购买转化，实验者通常允许1至7天的时间窗口。较短的窗口可以更早地分析实验结果，因为所有的分组实体都需要允许完全时间来完成行动。最佳的窗口平衡了获取结果的需求与组织的实际动态。如果客户通常在几天内转化，请考虑7天的窗口；如果客户通常需要20天或更长时间，请考虑30天的窗口。
- en: 'As an example, we can revise our first example from experiments with continuous
    outcomes by only including purchases within 7 days of the cohorting event. Note
    that it is important to use the time the entity was assigned to a variant as the
    starting point of the time box. An additional *ON* clause is added, restricting
    the results to purchases that occurred within the interval “7 days”:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们可以通过仅包括与集团事件发生后7天内的购买来修订我们从连续结果实验中的第一个例子。注意，使用实体分配给变体的时间作为时间框的起始点非常重要。添加了额外的*ON*子句，限制结果仅限于在“7天”间内发生的购买：
- en: '[PRE5]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The means are similar, and in fact statistically they are not significantly
    different from each other. In this example, the time-boxed conclusion agrees with
    the conclusion when there was no time box.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 这些平均数相似，事实上在统计上它们彼此之间没有显著差异。在这个例子中，时间框结论与没有时间框时的结论一致。
- en: In this case, purchase events are relatively rare. For metrics that measure
    common events and those that accumulate quickly, such as pageviews, clicks, likes,
    and articles read, using a time box can prevent the earliest cohorted users from
    looking substantially “better” than those cohorted later.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，购买事件相对较少。对于衡量常见事件和快速累积的指标，如页面浏览量、点击量、点赞和阅读文章，使用时间框可以防止最早分组的用户看起来比后来的分组用户显著“更好”。
- en: Repeated Exposure Experiments
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 重复接触实验
- en: 'In discussions of online experimentation, most examples are of what I like
    to call “one-and-done” experiences: the user encounters a treatment once, reacts
    to it, and does not pass that way again. User registration is a classic example:
    a consumer signs up for a particular service only once, and therefore any changes
    to the sign-up process affect only new users. Analyzing tests on these experiences
    is relatively straightforward.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在在线实验讨论中，大多数例子都是我喜欢称之为“一劳永逸”的体验：用户只遇到一次处理，对此做出反应，然后不再经过。用户注册是一个典型的例子：消费者仅注册某项服务一次，因此对注册流程的任何更改仅影响新用户。分析这些体验上的测试相对比较简单。
- en: There is another type of experience that I call “repeated exposure,” in which
    an individual comes into contact with the change many times during the course
    of using a product or service. In any experiment involving these changes, we can
    expect individuals to encounter them more than once. Changes to an app’s user
    interface, such as color, text, and placement of important information and links,
    are experienced by users throughout their app usage. Email marketing programs
    that send customers reminders or promotions on a regular basis also have this
    repeated exposure quality. Emails are experienced many times as subject lines
    in the inbox, and as content if opened.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种经验类型被我称为“重复接触”，在这种情况下，个体在使用产品或服务的过程中多次接触到变化。在涉及这些变化的任何实验中，我们可以预期个体会多次遇到它们。应用程序用户界面的变化，如颜色、文本和重要信息及链接的位置，在用户使用应用程序期间会被用户体验到。定期向客户发送提醒或促销的电子邮件营销计划也具有这种重复接触的特质。电子邮件在收件箱中作为主题行出现多次，并且如果被打开，作为内容出现。
- en: Measuring repeated exposure experiments is trickier than measuring one-and-done
    experiments due to novelty effects and regression to the mean. A *novelty effect*
    is the tendency for behavior to change just because something is new, not because
    it is necessarily better. *Regression to the mean* is the tendency for phenomena
    to return to an average level over time. As an example, changing any part of a
    user interface tends to increase the number of people who interact with it, whether
    it is a new button color, logo, or placement of functionality. Initially the metrics
    look good, because the click-through rate or engagement goes up. This is the novelty
    effect. But over time, users get used to the change, and they tend to click or
    use the functionality at rates that return closer to the baseline. This is the
    regression to the mean. The important question to answer when running this kind
    of experiment is whether the new baseline is higher (or lower) than the previous
    one. One solution is to allow passage of a long enough time period, in which you
    might expect regression to happen, before evaluating the results. In some cases,
    this will be a few days; in others, it might be a few weeks or months.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 测量重复曝光实验比测量一次性实验更加棘手，因为存在新奇效应和均值回归现象。*新奇效应*是行为因为某事物新而改变的倾向，并非因为它实际上更好。*均值回归*是现象随着时间返回到平均水平的倾向。例如，改变用户界面的任何部分都倾向于增加与其互动的人数，无论是新的按钮颜色、标志还是功能放置位置。最初指标看起来不错，因为点击率或参与度上升了。这就是新奇效应。但随着时间的推移，用户习惯于这种变化，他们倾向于以接近基线的速率点击或使用功能。这就是均值回归。运行这类实验时要回答的重要问题是新基线是否高于（或低于）之前的基线。一种解决方案是允许足够长的时间段过去，在这段时间内您可能期望发生均值回归，然后再评估结果。在某些情况下，这可能是几天；在其他情况下，可能是几周或几个月。
- en: When there are many changes, or the experiment comes in a series such as email
    or physical mail campaigns, figuring out whether the entire program makes a difference
    can be a challenge. It’s easy to claim success when customers receiving a certain
    email variant purchase a product, but how do we know if they would have made that
    purchase anyway? One option is to set up a *long-term holdout*. This is a group
    that is set up to not receive any marketing messages or changes to the product
    experience. Note that this is different from simply comparing to users who have
    opted out of marketing messages, since there is usually some bias in who opts
    out and who doesn’t. Setting up long-term holdouts can be complicated, but there
    are few better ways to truly measure the cumulative effects of campaigns and product
    changes.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 当变化很多或实验以系列形式出现（如电子邮件或实体邮件活动）时，弄清整个方案是否有所不同可能是个挑战。当顾客收到某种电子邮件变体后购买产品时，很容易宣称成功，但我们如何知道他们是否本来就会做出那个购买决定呢？一种选择是建立*长期对照组*。这是一个不接收任何营销消息或产品体验变更的群体。请注意，这与简单比较选择退出营销消息的用户不同，因为通常存在一些选择退出和不选择退出的偏见。设置长期对照组可能会很复杂，但几乎没有更好的方法来真正衡量活动和产品变更的累积效果。
- en: Another option is to perform cohort analysis (discussed in [Chapter 4](ch04.xhtml#cohort_analysis))
    on the variants. The groups can be followed for a longer time period, from weeks
    to months. Retention or cumulative metrics can be calculated and tested to see
    whether effects differ between variants over the long term.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种选择是对变体进行队列分析（详见[第4章](ch04.xhtml#cohort_analysis)）。可以在较长时间段内追踪这些群体，从几周到几个月不等。可以计算和测试留存或累积指标，以查看长期内变体之间的效果是否有所不同。
- en: Even with the various challenges that can be encountered with experiments, they
    are still the best way to test and prove the causality around changes made to
    experiences ranging from marketing messaging and creative to in-product experience.
    We often encounter less than ideal situations in data analysis, however, so next
    we’ll turn to some analysis options for when A/B testing isn’t possible.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管在实验中可能会遇到各种挑战，但它们仍然是测试和验证涉及从营销消息和创意到产品体验中所做更改因果关系的最佳方式。我们在数据分析中经常遇到不太理想的情况，因此接下来我们将转向一些分析选项，以解决无法进行A/B测试时的情况。
- en: 'When Controlled Experiments Aren’t Possible: Alternative Analyses'
  id: totrans-84
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 当无法进行控制实验时：替代分析方法
- en: Randomized experiments are the gold standard for going beyond correlation to
    establish causality. However, there are a number of reasons why a randomized experiment
    may not be possible. It may be unethical to give different treatments to different
    groups, particularly in medical or educational settings. Regulatory requirements
    may prevent experiments in other settings, such as financial services. There may
    be practical reasons, such as the difficulty of restricting access to a variant
    treatment to only a randomized group. It’s always worth considering whether there
    are pieces that are worth testing or are testable within ethical, regulatory,
    and practical boundaries. Wording, placement, and other design elements are some
    examples.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 随机实验是超越相关性以建立因果关系的黄金标准。然而，有许多原因可能导致无法进行随机实验。在医疗或教育环境中，给予不同群体不同治疗可能是不道德的。监管要求可能会阻止在其他环境中进行实验，如金融服务。还可能存在实际原因，例如难以限制变异处理仅限于随机群体的访问。始终值得考虑是否有值得在伦理、监管和实际边界内测试或可测试的部分。措辞、位置和其他设计元素是一些示例。
- en: A second situation in which experimentation isn’t possible is when a change
    happened in the past and the data has already been collected. Aside from reverting
    the change, going back and running an experiment isn’t an option. Sometimes a
    data analyst or data scientist wasn’t available to advise on experimentation.
    More than once, I have joined an organization and been asked to untangle the results
    of changes that would have been much more straightforward to understand had there
    been a holdout group. At other times, the change is unintended. Examples include
    site outages that affect some or all customers, errors in forms, and natural disasters
    such as storms, earthquakes, and wildfires.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 第二种无法进行实验的情况是当变化已经发生且数据已经收集时。除了恢复变化之外，回去重新进行实验不是一个选项。有时数据分析师或数据科学家无法提供关于实验的建议。我曾多次加入一个组织，并被要求解开那些本来如果有对照组会更容易理解的变化结果。在其他情况下，变化是意外的。例如影响部分或全部客户的站点停机、表单错误以及如风暴、地震和山火等自然灾害。
- en: Although causal conclusions aren’t as strong in situations in which there was
    no experiment, there are a few quasi-experimental analysis methods that can be
    used to draw insights from the data. These rely on constructing groups from the
    available data that represent “control” and “treatment” conditions as closely
    as possible.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在没有实验的情况下，因果推断的结论不如强有力，但有一些准实验分析方法可以从数据中获得洞见。这些方法依赖于从可用数据中构建尽可能接近的“对照”和“治疗”条件的组。
- en: Pre-/Post-Analysis
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 预/后分析
- en: A pre-/post-analysis compares either the same or similar populations before
    and after a change. The measurement of the population before the change is used
    as the control, while the measurement after the change is used as the variant
    or treatment.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: '**预/后分析**比较同一或相似人群在变化前后的情况。变化前的人群测量用作对照，而变化后的人群测量则用作变量或治疗组。'
- en: Pre-/post-analysis works best when there is a clearly defined change that happened
    on a well-known date, so that the before and after groups can be cleanly divided.
    In this type of analysis, you will need to choose how long to measure before and
    after the change, but the periods should be equal or close to equal. For example,
    if two weeks have elapsed since a change, compare that period to the two weeks
    prior to the change. Consider comparing multiple periods, such as one week, two
    weeks, three weeks, and four weeks before and after the change. If the results
    agree across all these windows, you can have more confidence in the result than
    you would if the results differed.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 预/后分析在有清晰定义的变化发生在已知日期的情况下效果最好，这样可以清晰地划分出变化前后的群体。在这种分析类型中，您需要选择在变化前后测量多长时间，但这些期间应该是相等或接近相等的。例如，如果变化发生后已经过去了两周，那么将这段时间与变化前的两周进行比较。考虑比较多个时期，如变化前后一周、两周、三周和四周。如果所有这些时间段的结果都一致，那么您对结果的信心就会比结果不一致时更高。
- en: Let’s walk through an example. Imagine that the onboarding flow for our mobile
    game includes a step in which the user can check a box to indicate whether they
    want to receive emails with game news. This had always been checked by default,
    but a new regulation requires that it now be unchecked by default. On January
    27, 2020, the change was released into the game, and we would like to find out
    if it had a negative effect on email opt-in rates. To do this, we will compare
    the two weeks before the change to the two weeks after the change and see whether
    the opt-in rate is statistically significantly different. We could use one-week
    or three-week periods, but two weeks is chosen because it is long enough to allow
    for some day-of-week variability and also short enough to restrict the number
    of other factors that could otherwise affect users’ willingness to opt in.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过一个例子来详细说明。想象一下，我们的移动游戏的入职流程包括一个步骤，用户可以勾选一个框，表示他们是否希望接收游戏新闻的电子邮件。这一直以来都是默认选中的，但是一项新的法规要求现在默认不选中。2020年1月27日，这一变更发布到游戏中，我们想要找出它是否对电子邮件选择率产生了负面影响。为此，我们将比较变更之前的两周和变更之后的两周，看看选择参与率是否有统计显著性差异。我们可以使用一周或三周的期间，但选择两周是因为它足够长，可以允许一些星期几的变化，同时也足够短，以限制其他可能影响用户愿意选择参与的因素数量。
- en: 'The variants are assigned in the SQL query via a CASE statement: the users
    who were created in the time range prior to the change are labeled “pre,” while
    those created after the change are labeled “post.” Next, we `count` the number
    of users in each group from the `game_users` table. Then we `count` the number
    of users who opted in, which is accomplished with a *LEFT JOIN* to the `game_actions`
    table, restricting to the records with the “email_optin” action. Then we divide
    the values to find the percent who opted in. I like to include the count of days
    in each variant as a quality check, though it is not necessary to perform the
    rest of the analysis:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 变体通过SQL查询中的CASE语句进行分配：在变更之前创建的用户标记为“pre”，而在变更之后创建的用户标记为“post”。接下来，我们从`game_users`表中计算每个组中用户的数量。然后，我们通过与`game_actions`表的*LEFT
    JOIN*，限制为具有“email_optin”动作的记录，来计算选择参与的用户数量。然后我们将这些值相除以找到选择参与的百分比。我喜欢在每个变体中包含天数的计数作为质量检查，尽管不必在分析的其余部分中执行：
- en: '[PRE6]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Tip
  id: totrans-94
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: 'Many databases will recognize dates entered as strings, as in `''2020-01-13''`.
    If your database does not, cast the string to a date using one of these options:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 许多数据库将日期输入视为字符串，如 `'2020-01-13'`。如果您的数据库不识别，请使用以下选项将字符串转换为日期：
- en: '[PRE7]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: In this case, we can see that the users who went through the onboarding flow
    before the change had a much higher email opt-in rate—58.75%, compared to 40.63%
    afterward. Plugging the values into an online calculator results in confirmation
    that the rate for the “pre” group is statistically significantly higher than the
    rate for the “post” group. In this example, there may not be much the game company
    can do, since the change is due to a regulation. Further tests could determine
    whether providing sample content or other information about the email program
    might encourage more new players to opt in, if this is a business goal.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们可以看到，在变更之前通过入职流程的用户的电子邮件选择率明显较高——58.75%，而之后为40.63%。将数值输入在线计算器中，确认“pre”组的比例显著高于“post”组。在这个例子中，游戏公司可能无法做太多，因为这一变更是由法规引起的。进一步的测试可能会确定，如果这是一个业务目标，提供样本内容或关于电子邮件程序的其他信息是否会鼓励更多新玩家选择参与。
- en: When performing a pre-/post-analysis, keep in mind that other factors beyond
    the change that you’re trying to learn about may cause an increase or a decrease
    in the metric. External events, seasonality, marketing promotions, and so on can
    drastically change the environment and customers’ mindsets even within the span
    of a few weeks. As a result, this type of analysis is not as good as a true randomized
    experiment for proving causality. However, sometimes this is one of the few analysis
    options available, and it can generate working hypotheses that can be tested and
    refined in future controlled experiments.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行前后分析时，请记住，您试图了解的变化之外的其他因素可能会导致指标的增加或减少。外部事件、季节性、营销促销等因素甚至可能在几周内大幅改变环境和客户心态。因此，这种类型的分析不如真正的随机实验来证明因果关系。然而，有时这是少数可用的分析选项之一，可以生成可以在将来的控制实验中测试和完善的工作假设。
- en: Natural Experiment Analysis
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自然实验分析
- en: A *natural experiment* occurs when entities end up with different experiences
    through some process that approximates randomness. One group receives the normal
    or control experience, and another receives some variation that may have a positive
    or negative effect. Usually these are unintentional, such as when a software bug
    is introduced, or when an event happens in one location but not in other locations.
    For this type of analysis to have validity, we must be able to clearly determine
    which entities were exposed. Additionally, a control group that is as similar
    as possible to the exposed group is needed.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: '*自然实验* 是指实体通过某种近似随机的过程获得不同体验的情况。一个组接受正常或控制体验，另一个组接受可能具有积极或消极影响的变体。通常这些实验是无意识的，比如引入软件漏洞或某个地点发生的事件。为了使这种分析有效，我们必须能够清楚地确定哪些实体受到了影响。此外，还需要一个尽可能与受影响组相似的对照组。'
- en: SQL can be used to construct the variants and to calculate the size of cohorts
    and success events in the case of a binary outcome event (or the mean, standard
    deviation, and population sizes in the case of a continuous outcome event). The
    results can be plugged into an online calculator just like with any other experiment.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: SQL可用于构建变体并计算在二元结果事件中的队列大小和成功事件（或在连续结果事件中的均值、标准差和人口大小）。结果可以像任何其他实验一样插入在线计算器中。
- en: 'As an example in the video game data set, imagine that, during the time period
    of our data, users in Canada were accidentally given a different offer on the
    virtual currency purchase page the first time they looked at it: an extra zero
    was added to the number of virtual coins in each package. So, for example, instead
    of 10 coins the user would receive 100 game coins, or instead of 100 coins they
    would receive 1,000 game coins, and so on. The question we would like to answer
    is whether Canadians converted to buyers at a higher rate than other users. Rather
    than compare to the entire user base, we will compare only to users in the United
    States. The countries are close geographically, and most users in the two countries
    speak the same language—and for the sake of the example, we’ll assume that we’ve
    done other analysis showing that their behavior is similar, while the behavior
    of users in other countries differs enough to exclude them.'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 以视频游戏数据集为例，假设在我们的数据时间段内，加拿大用户在第一次查看虚拟货币购买页面时，因为误操作多添加了一个零：每个包中的虚拟币数量增加了。例如，用户本来可以得到10个游戏币，现在会得到100个游戏币，或者本来可以得到100个游戏币，现在会得到1,000个游戏币，依此类推。我们想要回答的问题是，加拿大人是否以更高的比例转化为购买者。我们将仅与美国用户比较，而不是整个用户基础。这两个国家在地理上靠近，大多数用户使用相同语言——假设我们已经进行了其他分析，表明他们的行为相似，而其他国家的用户行为差异足以排除它们。
- en: 'To perform the analysis, we create the “variants” from whatever the distinguishing
    characteristic is—in this case, the `country` field from the `game_users` table—but
    note that sometimes more complex SQL will be required, depending on the data set.
    The counts of users cohorted, and those who purchased, are calculated in the same
    way we saw previously:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 要进行分析，我们根据区分特征（在这种情况下是`game_users`表中的`country`字段）创建“变体”，但需要注意，根据数据集的不同，有时可能需要更复杂的SQL。计算用户分组及其购买次数的方法与之前相同：
- en: '[PRE8]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The share of users in Canada who purchased is in fact higher—24.83%, compared
    to 11.01% of those in the United States. Plugging these values into an online
    calculator confirms that the conversion rate in Canada is statistically significantly
    higher at a 95% confidence interval.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，加拿大购买用户的比例更高——为24.83%，而美国为11.01%。将这些值输入在线计算器确认，加拿大的转化率在95%置信区间下显著更高。
- en: The hardest part of analyzing a natural experiment tends to be finding a comparable
    population and showing that the two populations are similar enough to support
    the conclusions from the statistical test. Although it is virtually impossible
    to prove that there are no confounding factors, careful comparison of population
    demographics and behaviors lends credibility to the results. Since a natural experiment
    is not a true random experiment, the evidence for causality is weaker, and this
    should be noted in the presentation of analysis of this type.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 分析自然实验最困难的部分往往是找到一个可比较的人群，并且显示这两个人群足够相似，以支持统计检验的结论。虽然几乎不可能证明没有混杂因素，但人口统计特征和行为的仔细比较可以增加结果的可信度。由于自然实验不是真正的随机实验，因果关系的证据较弱，这一点在这类分析的呈现中应该注意。
- en: Analysis of Populations Around a Threshold
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 围绕阈值的人群分析
- en: In some cases, there is a threshold value that results in some people or other
    subject units getting a treatment, while others do not. For example, a certain
    grade point average might qualify students for a scholarship, a certain income
    level might qualify households for subsidized health care, or a high churn risk
    score might trigger a sales rep to follow up with a customer. In such cases, we
    can leverage the idea that subjects on either side of the threshold value are
    likely quite similar to each other. So instead of comparing the entire populations
    that did and did not receive the reward or intervention, we can compare only those
    that were close to the threshold both on the positive and the negative side. The
    formal name for this is *regression discontinuity design* (RDD).
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，存在一个阈值，导致某些人或其他主体单位接受治疗，而其他人则没有。例如，某个特定的成绩平均值可能使学生有资格获得奖学金，某个收入水平可能使家庭有资格获得补助医疗保健，或者高流失风险评分可能会触发销售代表跟进客户。在这种情况下，我们可以利用这样一个想法：阈值两侧的主体很可能相似。因此，我们可以仅比较在正面和负面靠近阈值的那些人，而不是比较整个收到奖励或干预的人群。这种方法的正式名称是*回归断点设计*（RDD）。
- en: To perform this type of analysis, we can construct “variants” by splitting the
    data around the threshold value, similar to what we did in the pre-/post-analysis.
    Unfortunately, there is no hard-and-fast rule about how wide to make the bands
    of values on either side of the threshold. The “variants” should be similar in
    size, and they should be large enough to allow for significance in the results
    analysis. One option is to perform the analysis several times with a few different
    ranges. For example, you might analyze the differences between the “treated” group
    and the control when each group contains subjects that fall within 5%, 7.5%, and
    10% of the threshold. If the conclusions from these analyses agree, there is more
    support for the conclusions. If they do not agree, however, the data may be considered
    inconclusive.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行这种类型的分析，我们可以通过围绕阈值分割数据来构建“变体”，类似于我们在前/后分析中所做的。不幸的是，关于两侧值的带宽应该多宽的硬性规定并不存在。这些“变体”应该在大小上相似，并且它们应该足够大，以便在结果分析中具有显著性。一个选择是使用几个不同的范围进行多次分析。例如，您可以分析在每个组包含在阈值的5%、7.5%和10%内的受试者时，“治疗”组与对照组之间的差异。如果这些分析的结论一致，那么这些结论会得到更多的支持。然而，如果它们不一致，数据可能被视为无法得出结论。
- en: As with other types of nonexperimental analysis, results from RDD should be
    taken as proving causality less conclusively. Potential confounding factors should
    receive careful attention as well. For example, if customers with high churn risk
    receive interventions from multiple teams, or a special discount to encourage
    them to retain, in addition to a call from a sales rep, the data can potentially
    be tainted by those other changes.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 与其他类型的非实验分析一样，来自RDD的结果应该被认为不那么确凿地证明了因果关系。潜在的混杂因素也应该受到仔细的关注。例如，如果高流失风险客户接受了多个团队的干预，或者享受到了特别折扣以鼓励他们保持客户，再加上销售代表的电话，数据可能会被这些其他变化所影响。
- en: Conclusion
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结论
- en: Experiment analysis is a rich field that often incorporates different types
    of analysis seen in other parts of this book, from anomaly detection to cohort
    analysis. Data profiling can be useful in tracking down issues that occur. When
    randomized experiments are not possible, a variety of other techniques are available,
    and SQL can be used to create synthetic control and variant groups.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 实验分析是一个丰富的领域，通常包括本书其他部分所见的不同类型的分析，从异常检测到队列分析。数据剖析在追踪发生的问题时非常有用。当随机实验不可能时，有多种其他技术可用，而且可以使用
    SQL 创建合成对照组和变体组。
- en: In the next chapter, we’ll turn to constructing complex data sets for analysis,
    an area that brings together various topics that we’ve discussed in the book so
    far.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将转向构建复杂的数据集进行分析，这一领域整合了我们迄今为止讨论过的各种主题。
- en: ^([1](ch07.xhtml#ch01fn9-marker)) See *[*https://www.mathsisfun.com/data/chi-square-test.html*](https://www.mathsisfun.com/data/chi-square-test.html)*
    for a good explanation of this test.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](ch07.xhtml#ch01fn9-marker)) 参见[*https://www.mathsisfun.com/data/chi-square-test.html*](https://www.mathsisfun.com/data/chi-square-test.html)以获取对此测试的良好解释。
