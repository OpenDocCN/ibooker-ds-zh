- en: Chapter 5\. Moving from local to remote topologies
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第 5 章. 从本地到远程拓扑结构的迁移
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: The Storm cluster
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Storm 集群
- en: Fault tolerance within a Storm cluster
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Storm 集群内的容错性
- en: Storm cluster installation
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Storm 集群安装
- en: Deploying and running topologies on a Storm cluster
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Storm 集群上部署和运行拓扑结构
- en: The Storm UI and the role it plays
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Storm UI 及其作用
- en: Imagine the following scenario. You’re tasked with implementing a Storm topology
    for performing real-time analysis on events logged within your company’s system.
    As a conscientious developer, you’ve decided to use this book as a guideline for
    developing the topology. You’ve built it using the core Storm components covered
    in [chapter 2](kindle_split_010.html#ch02). You’ve applied the topology design
    patterns you learned about in [chapter 3](kindle_split_011.html#ch03) while determining
    what logic should go into each bolt, and you’ve followed the steps in [chapter
    4](kindle_split_012.html#ch04) to provide at-least-once processing for all tuples
    coming into your topology. You’re ready to hook the topology up to a queue receiving
    logging events and have it hum along. What do you do next?
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 想象以下场景。你被分配去实现一个 Storm 拓扑结构，用于对公司系统内记录的事件进行实时分析。作为一名负责任的开发者，你决定将这本书作为开发拓扑结构的指南。你使用了在第
    2 章 [chapters 2](kindle_split_010.html#ch02) 中介绍的核心 Storm 组件来构建它。你在第 3 章 [chapters
    3](kindle_split_011.html#ch03) 中学习到的拓扑设计模式的基础上，确定每个 bolt 应该包含什么逻辑，并遵循第 4 章 [chapters
    4](kindle_split_012.html#ch04) 中的步骤，为进入你的拓扑结构的所有元组提供至少一次处理。你准备将拓扑结构连接到接收日志事件的队列，并让它正常运行。接下来你该做什么？
- en: You can run your topology locally as in [chapters 2](kindle_split_010.html#ch02),
    [3](kindle_split_011.html#ch03), and [4](kindle_split_012.html#ch04), but doing
    so won’t scale to the data volume and velocity that you’re expecting. You need
    to be able to deploy your topology to an environment that’s built for handling
    production-level data. This is where the “remote” (also known as “production”)
    Storm cluster comes into play—an environment built to handle the demands of production-level
    data.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在本地运行你的拓扑结构，就像在第 2 章 [chapters 2](kindle_split_010.html#ch02)、第 3 章 [chapters
    3](kindle_split_011.html#ch03) 和第 4 章 [chapters 4](kindle_split_012.html#ch04)
    中所做的那样，但这样做并不能扩展到你期望的数据量和速度。你需要能够将你的拓扑结构部署到专为处理生产级数据而构建的环境中。这就是“远程”（也称为“生产”）Storm
    集群发挥作用的地方——一个专为处理生产级数据需求而构建的环境。
- en: '|  |'
  id: totrans-9
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-10
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: As you learned in [chapter 1](kindle_split_009.html#ch01), *volume* refers to
    the amount of data entering your system and *velocity* refers to the pace at which
    that data flows through your system.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你在第 1 章 [chapters 1](kindle_split_009.html#ch01) 中所学的，*容量*指的是进入你系统的数据量，*速度*指的是这些数据流经你系统的速度。
- en: '|  |'
  id: totrans-12
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Running our topologies locally and simulating a Storm cluster within a single
    process has served our needs so far and is useful for development and testing
    purposes. But local mode doesn’t support the scaling discussed in [chapter 3](kindle_split_011.html#ch03)
    nor the first-class guaranteed processing we learned about in [chapter 4](kindle_split_012.html#ch04).
    An actual Storm cluster is needed for both of these.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们在单个进程中运行拓扑结构并模拟 Storm 集群已经满足了我们的需求，这对于开发和测试目的很有用。但本地模式不支持在第 3 章 [chapters
    3](kindle_split_011.html#ch03) 中讨论的扩展性，也不支持我们在第 4 章 [chapters 4](kindle_split_012.html#ch04)
    中了解到的第一类保证处理。实际上的 Storm 集群对于这两者都是必需的。
- en: 'This chapter will begin by explaining the parts of a Storm cluster and the
    roles they play, followed by a Q&A session on how Storm provides fault tolerance.
    We’ll then move on to installing a Storm cluster and deploying and running your
    topologies against the installed cluster. We’ll also cover an important tool you
    can use to make sure your topology is healthy: the Storm UI. Along the way, we’ll
    provide a preview into the tuning and troubleshooting topics that will be covered
    in [chapters 6](kindle_split_014.html#ch06) and [7](kindle_split_015.html#ch07).'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将首先解释 Storm 集群的各个部分及其所扮演的角色，随后将进行关于 Storm 如何提供容错性的问答环节。然后，我们将继续介绍如何安装 Storm
    集群，并在安装的集群上部署和运行你的拓扑结构。我们还将介绍一个重要的工具，你可以使用它来确保你的拓扑结构健康：Storm UI。在这个过程中，我们将预览到将在第
    6 章 [chapters 6](kindle_split_014.html#ch06) 和第 7 章 [chapters 7](kindle_split_015.html#ch07)
    中涉及到的调整和故障排除主题。
- en: It all starts with the Storm cluster, so let’s expand on our worker nodes discussion
    from [chapter 3](kindle_split_011.html#ch03).
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这一切都始于 Storm 集群，因此让我们从第 3 章 [chapters 3](kindle_split_011.html#ch03) 中讨论的工作节点讨论展开。
- en: 5.1\. The Storm cluster
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5.1. Storm 集群
- en: '[Chapter 3](kindle_split_011.html#ch03) scratched the surface of a worker node
    and how it runs a JVM, which in turn runs executors and tasks. In this section,
    we’re going to go much deeper, starting with the Storm cluster as a whole. A Storm
    cluster consists of two types of nodes: the master node and the worker nodes.
    A *master* node runs a daemon called Nimbus, and the *worker* nodes each run a
    daemon called a Supervisor. [Figure 5.1](#ch05fig01) shows a Storm cluster with
    one master node and four worker nodes. Storm supports only a single master node,
    whereas it’s likely your cluster will have a different number of worker nodes
    based on your needs (we’ll cover how to determine this number in [chapters 6](kindle_split_014.html#ch06)
    and [7](kindle_split_015.html#ch07)).'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 第3章（kindle_split_011.html#ch03）简要介绍了工作节点及其运行JVM的方式，而JVM又运行执行器和任务。在本节中，我们将深入探讨，从Storm集群的整体结构开始。一个Storm集群由两种类型的节点组成：主节点和工作节点。*主节点*运行一个名为Nimbus的守护进程，而*工作节点*每个运行一个名为Supervisor的守护进程。[图5.1](#ch05fig01)展示了包含一个主节点和四个工作节点的Storm集群。Storm只支持单个主节点，而你的集群可能根据需要拥有不同数量的工作节点（我们将在第6章和第7章中介绍如何确定这个数量）。
- en: Figure 5.1\. Nimbus and Supervisors and their responsibilities inside a Storm
    cluster
  id: totrans-18
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.1\. Nimbus和Supervisor及其在Storm集群内的责任
- en: '![](05fig01_alt.jpg)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig01_alt.jpg)'
- en: The master node can be thought of as the control center. In addition to the
    responsibilities listed in [figure 5.1](#ch05fig01), this is where you’d run any
    of the commands—such as `activate`, `deactivate`, `rebalance`, or `kill`—available
    in a Storm cluster (more on these commands later in the chapter). The worker nodes
    are where the logic in the spouts and bolts is executed.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 主节点可以被视为控制中心。除了[图5.1](#ch05fig01)中列出的责任外，这里还可以运行Storm集群中可用的任何命令——例如`activate`、`deactivate`、`rebalance`或`kill`（本章后面将详细介绍这些命令）。工作节点是Spout和Bolt中的逻辑执行的地方。
- en: Another big part of a Storm cluster is *Zookeeper*. Storm relies on Apache Zookeeper^([[1](#ch05fn01)])
    for coordinating communication between Nimbus and the Supervisors. Any state needed
    to coordinate between Nimbus and the Supervisors is kept in Zookeeper. As a result,
    if Nimbus or a Supervisor goes down, once it comes back up it can recover state
    from Zookeeper, keeping the Storm cluster running as if nothing happened.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: Storm集群的另一个重要部分是*Zookeeper*。Storm依赖于Apache Zookeeper^([[1](#ch05fn01)])来协调Nimbus和Supervisor之间的通信。任何需要协调Nimbus和Supervisor之间的状态都保存在Zookeeper中。因此，如果Nimbus或Supervisor出现故障，一旦它们恢复，就可以从Zookeeper中恢复状态，使Storm集群像什么都没发生一样继续运行。
- en: ¹ [http://zookeeper.apache.org/](http://zookeeper.apache.org/)
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ¹ [http://zookeeper.apache.org/](http://zookeeper.apache.org/)
- en: '[Figure 5.2](#ch05fig02) shows a cluster of Zookeeper nodes integrated into
    the Storm cluster. We’ve removed the worker processes from this figure so you
    can focus on where Zookeeper fits as it coordinates communication between Nimbus
    and Supervisors.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '[图5.2](#ch05fig02)展示了集成到Storm集群中的Zookeeper节点集群。我们已从该图中移除工作进程，以便你可以专注于Zookeeper如何作为Nimbus和Supervisor之间通信协调者的位置。'
- en: Figure 5.2\. The Zookeeper Cluster and its role within a Storm cluster
  id: totrans-24
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.2\. Zookeeper集群及其在Storm集群中的作用
- en: '![](05fig02_alt.jpg)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig02_alt.jpg)'
- en: Throughout the remainder of the book, any time we mention “Storm cluster,” we’re
    referring to the master, worker, and Zookeeper nodes.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的剩余部分，每次提到“Storm集群”时，我们指的是主节点、工作节点和Zookeeper节点。
- en: Although the master node and Zookeeper are important parts of a Storm cluster,
    we’re going to shift our focus to worker nodes for now. Worker nodes are where
    the spout and bolt processing occurs, making them the central place for much of
    our tuning and troubleshooting efforts in [chapters 6](kindle_split_014.html#ch06)
    and [7](kindle_split_015.html#ch07).
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管主节点和Zookeeper是Storm集群的重要组成部分，但我们将暂时将焦点转移到工作节点上。工作节点是Spout和Bolt处理发生的地方，因此它们是我们第6章和第7章中许多调整和故障排除工作的中心。
- en: '|  |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-29
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: '[Chapters 6](kindle_split_014.html#ch06) and [7](kindle_split_015.html#ch07)
    will explain when you might want to increase the number of worker processes running
    on a worker node and when and how you might reach a point of diminishing returns.
    These chapters will also discuss tuning within a worker process, so it makes sense
    to explain the various parts of a worker process.'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 第6章和第7章将解释你何时可能想要增加工作节点上运行的工作进程数量，以及何时以及如何达到收益递减的点。这些章节还将讨论工作进程内的调整，因此解释工作进程的各个部分是有意义的。
- en: '|  |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 5.1.1\. The anatomy of a worker node
  id: totrans-32
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.1.1\. 工作节点的结构
- en: As mentioned earlier, each worker node has a Supervisor daemon that’s tasked
    with administering the worker processes and keeping them in a running state. If
    a Supervisor notices that one of the worker processes is down, it will immediately
    restart it. What’s a worker process exactly? We mentioned that it was a JVM, but
    as you know from [chapter 3](kindle_split_011.html#ch03), there’s more to it.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，每个工作节点都有一个负责管理工作进程并保持其运行状态的守护进程。如果守护进程注意到某个工作进程已关闭，它将立即重启它。那么，工作进程究竟是什么呢？我们提到它是一个
    JVM，但正如你在[第 3 章](kindle_split_011.html#ch03) 中所知，它还有更多内容。
- en: Each worker process executes a subset of a topology. This means that each worker
    process belongs to a specific topology and that each topology will be run across
    one or more worker processes. Normally, these worker processes are run across
    many machines within the Storm cluster.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 每个工作进程执行拓扑的一部分。这意味着每个工作进程属于特定的拓扑，并且每个拓扑将在一个或多个工作进程中运行。通常，这些工作进程在 Storm 集群中的多台机器上运行。
- en: In [chapter 3](kindle_split_011.html#ch03), you learned about executors (threads)
    and tasks (instances of spouts/bolts). We discussed how a worker process (JVM)
    runs one or more executors (threads), with each thread executing one or more instances
    of spouts/bolts (tasks). [Figure 5.3](#ch05fig03) illustrates this concept.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第 3 章](kindle_split_011.html#ch03)中，你学习了关于执行器（线程）和任务（数据源/螺栓的实例）的内容。我们讨论了工作进程（JVM）如何运行一个或多个执行器（线程），每个线程执行一个或多个数据源/螺栓的实例（任务）。[图
    5.3](#ch05fig03) 说明了这个概念。
- en: Figure 5.3\. A worker process consists of one or more executors, with each executor
    consisting of one or more tasks.
  id: totrans-36
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 5.3\. 工作进程由一个或多个执行器组成，每个执行器由一个或多个任务组成。
- en: '![](05fig03_alt.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![图片](05fig03_alt.jpg)'
- en: 'Here are the key takeaways:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是一些关键要点：
- en: A worker process is a JVM.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工作进程是一个 JVM。
- en: An executor is a thread of execution within a JVM.
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行器是 JVM 中的一个执行线程。
- en: A task is an instance of a spout or bolt being run within a thread of execution
    on the JVM.
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 任务是在 JVM 执行线程中运行的数据源或螺栓的实例。
- en: Understanding these mappings is extremely important for the purposes of tuning
    and troubleshooting. For example, [chapter 6](kindle_split_014.html#ch06) answers
    questions such as why you might want many tasks per executor, so understanding
    the relationship between an executor and its tasks is essential.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 理解这些映射对于调整和故障排除非常重要。例如，[第 6 章](kindle_split_014.html#ch06) 回答了为什么你可能希望每个执行器有多个任务等问题，因此理解执行器与其任务之间的关系是至关重要的。
- en: To bring the discussion of a worker node, worker processes, executors, and tasks
    full circle, let’s present them within the context of the credit card authorization
    topology from [chapter 4](kindle_split_012.html#ch04).
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使关于工作节点、工作进程、执行器和任务的讨论完整，让我们在[第 4 章](kindle_split_012.html#ch04)中提到的信用卡授权拓扑的背景下介绍它们。
- en: 5.1.2\. Presenting a worker node within the context of the credit card au- uthorization
    topology
  id: totrans-44
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.1.2\. 在信用卡授权拓扑的背景下介绍工作节点
- en: In this section we’ll present a hypothetical configuration for the credit card
    authorization topology in order to help you make the connection between the number
    of worker processes, executors, and tasks in the figures and the code for doing
    so. This hypothetical configuration can be seen in [figure 5.4](#ch05fig04).
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将展示一个假设的信用卡授权拓扑配置，以帮助你在图中的工作进程、执行器和任务数量与实现它们的代码之间建立联系。这个假设配置可以在[图 5.4](#ch05fig04)中看到。
- en: Figure 5.4\. A hypothetical breakdown of a worker node with multiple worker
    processes, executors, and tasks for the credit card authorization topology
  id: totrans-46
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: '![图片](05fig04.jpg)'
- en: '![](05fig04.jpg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![图片](05fig04.jpg)'
- en: The setup in [figure 5.4](#ch05fig04) would be achieved via the code in the
    following listing.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 5.4](#ch05fig04) 中的设置将通过以下列表中的代码实现。'
- en: Listing 5.1\. Configuration for our hypothetical Storm cluster
  id: totrans-49
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 5.1\. 我们假设的 Storm 集群配置
- en: '![](106fig01_alt.jpg)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![图片](106fig01_alt.jpg)'
- en: When we set the `numWorkers` in the `Config`, we’re configuring the worker processes
    desired for running this topology. We don’t actually force both worker processes
    to end up on the same worker node as depicted in [figure 5.4](#ch05fig04). Storm
    will pick where they end up based on which worker nodes in the cluster have vacant
    slots for running worker processes.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们在`Config`中设置`numWorkers`时，我们正在配置运行此拓扑所需的worker进程。我们实际上并没有强迫两个worker进程最终都运行在同一个worker节点上，如图5.4所示。[图5.4](#ch05fig04)。Storm会根据集群中哪些worker节点有空闲槽位来决定它们最终的位置。
- en: '|  |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**Parallelism vs. concurrency: what’s the difference?**'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: '**并行性 vs. 并发性：有什么区别？**'
- en: '*Parallelism* is when two threads are executing simultaneously. *Concurrency*
    is when at least two threads are making progress on some sort of computation.
    Concurrency doesn’t necessarily mean the two threads are executing simultaneously—something
    like time slicing may be used to simulate parallelism.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '*并行性*是指两个线程同时执行。*并发性*是指至少有两个线程在某种计算上取得进展。并发性不一定意味着两个线程是同时执行的——可能使用时间切片等技术来模拟并行性。'
- en: '|  |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Having revisited the breakdown of a worker node, let’s see how Storm provides
    fault tolerance across the cluster’s various parts.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在重新审视了工作节点故障分解之后，让我们看看Storm是如何在集群的各个部分提供容错性的。
- en: 5.2\. Fail-fast philosophy for fault tolerance within a Storm cluster
  id: totrans-57
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5.2\. Storm集群内的快速失败容错哲学
- en: Remember the four pieces to the reliability puzzle discussed in [chapter 4](kindle_split_012.html#ch04)?
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 记得在[第4章](kindle_split_012.html#ch04)中讨论的可靠性难题的四个部分吗？
- en: A reliable data source with a corresponding reliable spout
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个具有相应可靠spout的可靠数据源
- en: An anchored tuple stream
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个锚定的元组流
- en: A topology that acknowledges each tuple as it gets processed or notifies you
    of failure
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个在处理每个元组时确认或通知失败的拓扑
- en: A fault-tolerant Storm cluster infrastructure
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个具有容错能力的Storm集群基础设施
- en: We’re finally at a point to discuss the last piece, a fault-tolerant Storm cluster
    infrastructure. The components of a Storm cluster have been designed with fault
    tolerance in mind. The easiest way to explain how Storm handles fault tolerance
    is to answer questions in the form of “What does Storm do when *x* happens?” The
    most important questions on fault tolerance are addressed in [table 5.1](#ch05table01).
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 我们终于到了讨论最后一部分的时候了，那就是具有容错能力的Storm集群基础设施。Storm集群的组件在设计时已经考虑了容错性。解释Storm如何处理容错性最简单的方法就是以“当*x*发生时，Storm会做什么？”的形式回答问题。关于容错性的最重要问题在[表5.1](#ch05table01)中得到了解答。
- en: Table 5.1\. Fault tolerance questions and answers
  id: totrans-64
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表5.1\. 容错性问题及答案
- en: '| Question | Answer |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| 问题 | 答案 |'
- en: '| --- | --- |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| What if a worker node dies? | Supervisor will restart it and new tasks will
    be assigned to it. All tuples that weren’t fully acked at time of death will be
    fully replayed by the spout. This is why the spout needs to support replaying
    (reliable spout) *and* the data source behind the spout also needs to be reliable
    (supporting replay). |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| 如果一个工作节点挂了？ | Supervisor会重启它，并将新的任务分配给它。所有在死亡时未完全确认的元组将由spout完全重放。这就是为什么spout需要支持重放（可靠的spout）*并且*数据源也需要是可靠的（支持重放）。
    |'
- en: '| What if a worker node continuously fails to start up? | Nimbus will reassign
    tasks to another worker. |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| 如果一个工作节点连续启动失败？ | Nimbus会将任务重新分配给另一个工作节点。 |'
- en: '| What if an actual machine that runs worker nodes dies? | Nimbus will reassign
    the tasks on that machine to healthy machines. |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| 如果运行worker节点的一台实际机器挂了？ | Nimbus会将该机器上的任务重新分配给健康的机器。 |'
- en: '| What if Nimbus dies? | Because Nimbus is being run under supervision (using
    a tool like daemontools or monit), it should get restarted and continue processing
    like nothing happened. |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| 如果Nimbus挂了？ | 因为Nimbus是在监控下运行的（使用daemontools或monit等工具），它应该会自动重启并继续处理，就像什么都没发生一样。
    |'
- en: '| What if a Supervisor dies? | Because Supervisors are being run under supervision
    (using a tool like daemontools or monit), they should get restarted like nothing
    happened. |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
  zh: '| 如果一个Supervisor挂了？ | 因为Supervisor也是在监控下运行的（使用daemontools或monit等工具），它们应该会像什么都没发生一样自动重启。
    |'
- en: '| Is Nimbus a single point of failure? | Not necessarily. Supervisors and worker
    nodes will continue to process, but you lose the ability to reassign workers to
    other machines or deploy new topologies. |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '| Nimbus是否是单点故障？ | 不一定。Supervisor和worker节点将继续处理，但你将失去将worker重新分配到其他机器或部署新拓扑的能力。
    |'
- en: You can see that Storm maintains a fail-fast philosophy in the sense that every
    piece within this infrastructure can be restarted and will recalibrate itself
    and move on. If tuples were in mid-process during a failure, they’ll be failed
    automatically.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以看到，Storm 在保持快速失败哲学方面做得很好，即这个基础设施中的每一部分都可以重启，并将重新校准自己继续运行。如果在失败过程中元组处于中间状态，它们将自动失败。
- en: It doesn’t matter whether the unit of infrastructure that failed is an instance
    (task) or a thread (executor) or a JVM (worker process) or a VM (worker node).
    At each level, safeguards are in place to ensure that everything gets restarted
    automatically (because everything runs under supervision).
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 无论失败的单元是实例（任务）、线程（执行器）、JVM（工作进程）还是 VM（工作节点），在每个层面上都设有安全措施，以确保一切都能自动重启（因为所有内容都在监督下运行）。
- en: We’ve talked about the benefits a Storm cluster provides in terms of parallelism
    and fault tolerance. How do you go about getting such a cluster up and running?
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经讨论了 Storm 集群在并行性和容错性方面的优势。你是如何着手搭建并运行这样一个集群的呢？
- en: 5.3\. Installing a Storm cluster
  id: totrans-76
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5.3. 安装 Storm 集群
- en: 'The Storm wiki does an excellent job describing how to set up a Storm cluster.
    The steps found on the wiki include these:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: Storm 维基对如何设置 Storm 集群做了很好的描述。维基上找到的步骤包括以下内容：
- en: Find information on setting up Zookeeper along with some helpful tips on maintaining
    the Zookeeper cluster.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查找有关设置 Zookeeper 的信息，以及一些有关维护 Zookeeper 集群的实用技巧。
- en: Install the required Storm dependencies on the master and worker machines.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主节点和工作节点上安装所需的 Storm 依赖项。
- en: Download and extract a Storm release to the master and worker machines.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 Storm 发布版本下载并解压到主节点和工作节点上。
- en: Configure the master and worker nodes via the storm.yaml file.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过 storm.yaml 文件配置主节点和工作节点。
- en: Launch the Nimbus and Supervisor daemons under supervision using the Storm script.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 Storm 脚本在监督下启动 Nimbus 和监督者守护进程。
- en: We’ll cover each of these steps in more detail next.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在下一部分更详细地介绍这些步骤。
- en: '|  |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-85
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: What does it mean to run a process under supervision? It means that some supervisory
    process manages the actual process being run. Therefore, if the process being
    “supervised” fails, the supervisory process can automatically restart the failed
    process. This is a key element in providing fault tolerance in Storm.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在监督下运行一个进程意味着什么？这意味着某个监督进程管理着正在运行的进程。因此，如果被“监督”的进程失败，监督进程可以自动重启失败的进程。这是在 Storm
    中提供容错性的关键要素。
- en: '|  |'
  id: totrans-87
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 5.3.1\. Setting up a Zookeeper cluster
  id: totrans-88
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.3.1. 设置 Zookeeper 集群
- en: The steps for setting up a Zookeeper cluster are outside the scope of this book.
    You can find a thorough explanation of how to install Zookeeper on the Apache
    Zookeeper project page at [http://zookeeper.apache.org](http://zookeeper.apache.org).
    Follow those steps to get your cluster up and running.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 设置 Zookeeper 集群的步骤超出了本书的范围。你可以在 Apache Zookeeper 项目页面上找到如何安装 Zookeeper 的详细解释：[http://zookeeper.apache.org](http://zookeeper.apache.org)。遵循这些步骤来搭建并运行你的集群。
- en: 'Keep the following in mind when running Zookeeper:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行 Zookeeper 时请注意以下几点：
- en: Zookeeper is designed to “fail fast,” meaning it will shut down if an error
    occurs that it can’t recover from. This isn’t desirable within a Storm cluster
    because Zookeeper coordinates communication between Nimbus and the Supervisors.
    Because of this, we must have a supervisory process manage the Zookeeper instances
    so that if a Zookeeper instance does go down, the cluster as a whole can continue
    handling requests. The supervisory process will handle restarting any failed individual
    Zookeeper server, allowing the Zookeeper cluster to be self-healing.
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Zookeeper 被设计为“快速失败”，这意味着如果发生它无法恢复的错误，它将关闭。在 Storm 集群中这并不理想，因为 Zookeeper 协调
    Nimbus 和监督者之间的通信。因此，我们必须有一个监督进程来管理 Zookeeper 实例，以便如果 Zookeeper 实例发生故障，整个集群可以继续处理请求。监督进程将处理重启任何失败的
    Zookeeper 服务器，使 Zookeeper 集群能够自我修复。
- en: Because Zookeeper is a long-running process, its transaction logs can get quite
    large. This will eventually result in Zookeeper running out of disk space. Therefore,
    it’s critical to set up some sort of process to compact (and even archive) the
    data produced in these logs.
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于 Zookeeper 是一个长期运行的过程，其事务日志可能会变得相当大。这最终会导致 Zookeeper 运行空间耗尽。因此，设置某种类型的进程来压缩（甚至存档）这些日志中产生的数据至关重要。
- en: 5.3.2\. Installing the required Storm dependencies to master and worker nodes
  id: totrans-93
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.3.2. 在主节点和工作节点上安装所需的 Storm 依赖项
- en: The next step is to install the required Storm dependencies to the machines
    you’ve dedicated to running Nimbus and the Supervisors. [Table 5.2](#ch05table02)
    lists these dependencies.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是将所需的 Storm 依赖项安装到您为运行 Nimbus 和监督者而指定的机器上。[表 5.2](#ch05table02) 列出了这些依赖项。
- en: Table 5.2\. External dependencies for Storm master and worker nodes
  id: totrans-95
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表 5.2\. Storm 主节点和工作节点的外部依赖
- en: '| Dependency | Why it’s needed | Link to download |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| 依赖项 | 为什么需要它 | 下载链接 |'
- en: '| --- | --- | --- |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Java 6+ | Storm runs on the JVM and the latest version of Storm runs on Java
    6. | [www.oracle.com/us/technologies/java/overview/index.html](http://www.oracle.com/us/technologies/java/overview/index.html)
    |'
  id: totrans-98
  prefs: []
  type: TYPE_TB
  zh: '| Java 6+ | Storm 在 JVM 上运行，最新的 Storm 版本在 Java 6 上运行。 | [http://www.oracle.com/us/technologies/java/overview/index.html](http://www.oracle.com/us/technologies/java/overview/index.html)
    |'
- en: '| Python 2.6.6 | The standard command-line tool for Storm is Python wrapped
    around Java. | [https://www.python.org/downloads/](https://www.python.org/downloads/)
    |'
  id: totrans-99
  prefs: []
  type: TYPE_TB
  zh: '| Python 2.6.6 | Storm 的标准命令行工具是围绕 Java 包装的 Python。 | [https://www.python.org/downloads/](https://www.python.org/downloads/)
    |'
- en: Once the required external dependencies have been installed to each of the machines
    hosting Nimbus and the Supervisors, you can install Storm to those machines.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦将所需的依赖项安装到托管 Nimbus 和监督者的每台机器上，您就可以将这些机器安装 Storm。
- en: 5.3.3\. Installing Storm to master and worker nodes
  id: totrans-101
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.3.3\. 在主节点和工作节点上安装 Storm
- en: The Storm installations can currently be found at [http://storm.apache.org/downloads.html](http://storm.apache.org/downloads.html).
    For this book, we used apache-storm-0.9.3\. You should download the Storm release
    zip file to each node and extract the contents of the zip file somewhere on each
    of the machines. The location is up to you; something like /opt/storm is one example.
    [Figure 5.5](#ch05fig05) shows the extracted contents in an /opt/storm directory.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 目前 Storm 安装可以在 [http://storm.apache.org/downloads.html](http://storm.apache.org/downloads.html)
    找到。对于本书，我们使用了 apache-storm-0.9.3。您应该将 Storm 版本的 zip 文件下载到每个节点，并在每台机器上的某个位置提取 zip
    文件的内容。位置由您决定；例如，/opt/storm 是一个示例。[图 5.5](#ch05fig05) 显示了在 /opt/storm 目录中提取的内容。
- en: Figure 5.5\. Extracted contents of a Storm release zip
  id: totrans-103
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 5.5\. Storm 版本 zip 文件的提取内容
- en: '![](05fig05.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig05.jpg)'
- en: 'There are two files in this figure that we’re particularly interested in for
    this chapter: /opt/storm/bin/storm and /opt/storm/conf/storm.yaml. Let’s discuss
    storm.yaml and its purpose next.'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 本图中有两个文件是我们本章特别感兴趣的：/opt/storm/bin/storm 和 /opt/storm/conf/storm.yaml。接下来让我们讨论
    storm.yaml 及其用途。
- en: 5.3.4\. Configuring the master and worker nodes via storm.yaml
  id: totrans-106
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.3.4\. 通过 storm.yaml 配置主节点和工作节点
- en: The Storm release contains a conf/storm.yaml file that configures the Storm
    daemons. This file overrides configuration settings found in defaults.yaml.^([[2](#ch05fn02)])
    It’s likely that you’ll want to override at least some of the values; many of
    the defaults point to “localhost” for a machine name. [Table 5.3](#ch05table03)
    lists some of the initial configuration options you may want to override in order
    to get your Storm cluster up and running.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: Storm 版本包含一个 conf/storm.yaml 文件，用于配置 Storm 守护进程。此文件覆盖了在 defaults.yaml 中找到的配置设置。[2](#ch05fn02)
    您可能希望覆盖至少一些值；许多默认值将机器名指向“localhost”。[表 5.3](#ch05table03) 列出了您可能想要覆盖的一些初始配置选项，以便使您的
    Storm 集群启动并运行。
- en: ² You can find defaults.yaml at [https://github.com/apache/storm/blob/master/conf/defaults.yaml](https://github.com/apache/storm/blob/master/conf/defaults.yaml).
  id: totrans-108
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ² 您可以在 [https://github.com/apache/storm/blob/master/conf/defaults.yaml](https://github.com/apache/storm/blob/master/conf/defaults.yaml)
    找到 defaults.yaml。
- en: Table 5.3\. storm.yaml properties you may want to override for your Storm installations
  id: totrans-109
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表 5.3\. 您可能想要覆盖的 storm.yaml 属性，以用于您的 Storm 安装
- en: '| Properties | Description | Default value |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '| 属性 | 描述 | 默认值 |'
- en: '| --- | --- | --- |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| storm.zookeeper. servers | The lists of hosts in the Zookeeper cluster for
    your Storm cluster. | storm.zookeeper.servers: - "localhost" |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| storm.zookeeper.servers | 为您的 Storm 集群指定的 Zookeeper 集群中的主机列表。 | storm.zookeeper.servers:
    - "localhost" |'
- en: '| storm.zookeeper. port | Needed if the port your Zookeeper cluster uses is
    different from the default. | storm.zookeeper.port: 2181 |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| storm.zookeeper.port | 如果您的 Zookeeper 集群使用的端口与默认端口不同，则需要此端口。 | storm.zookeeper.port:
    2181 |'
- en: '| storm.local.dir | The directory that the Nimbus and Supervisor daemons will
    use for storing small amounts of state. You must create these directories and
    give them proper permissions on each machine that’ll be running Nimbus and workers.
    | storm.local.dir: "storm-local" |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '| storm.local.dir | Nimbus和Supervisor守护进程将用于存储少量状态信息的目录。您必须在将运行Nimbus和worker的每台机器上创建这些目录并赋予它们适当的权限。
    | storm.local.dir: "storm-local" |'
- en: '| java.library.path | The location of the Java installation. | java.library.path:
    "/usr/local/lib:/opt/local/lib:/usr/lib" |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '| java.library.path | Java安装的位置。 | java.library.path: "/usr/local/lib:/opt/local/lib:/usr/lib"
    |'
- en: '| nimbus.host | The hostname of the Nimbus machine. | nimbus.host: "localhost"
    |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '| nimbus.host | Nimbus机器的主机名。 | nimbus.host: "localhost" |'
- en: '| supervisor.slots.ports | For each worker machine, the ports that are used
    for receiving messages. The number of available ports will determine the number
    of worker processes Storm runs on each worker machine. | supervisor.slots.ports:
    – 6700'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '| supervisor.slots.ports | 对于每个工作机器，用于接收消息的端口。可用的端口号数量将决定Storm在每个工作机器上运行的worker进程数量。
    | supervisor.slots.ports: – 6700'
- en: – 6701
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: – 6701
- en: – 6702
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: – 6702
- en: – 6703 |
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: – 6703 |
- en: You’ll need to update the configuration on each node in the cluster. Doing so
    can become tedious if you have a cluster containing several worker nodes. For
    this reason, we recommend using an external tool such as Puppet^([[3](#ch05fn03)])
    for automating the deployment and configuration of each node.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要更新集群中每个节点的配置。如果您有一个包含多个工作节点的集群，这样做可能会变得繁琐。因此，我们建议使用像Puppet^([[3](#ch05fn03)])这样的外部工具来自动化每个节点的部署和配置。
- en: ³ [http://puppetlabs.com/](http://puppetlabs.com/)
  id: totrans-122
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ³ [http://puppetlabs.com/](http://puppetlabs.com/)
- en: 5.3.5\. Launching Nimbus and Supervisors under supervision
  id: totrans-123
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.3.5. 在监督模式下启动Nimbus和Supervisors
- en: As mentioned earlier, running daemons under supervision is a critical step in
    setting up a Storm cluster. The supervisory processes allow our system to be fault-tolerant.
    What does this mean exactly? Why is it needed?
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，在监督模式下运行守护进程是设置Storm集群的关键步骤。监督进程使我们的系统具有容错能力。这究竟意味着什么？为什么需要这样做？
- en: 'Storm is a fail-fast system, meaning that any Storm process encountering an
    unexpected error will stop. Storm is designed so that any process can safely stop
    at any point and recover when the process is restarted. Running these processes
    under supervision allows them to be restarted whenever a failure occurs. Thus,
    your topologies are unaffected by failures in the Storm daemons. To run the Storm
    daemons under supervision, execute the following commands:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: Storm是一个快速失败的系统，这意味着任何遇到意外错误的Storm进程都会停止。Storm被设计成任何进程都可以在任何点安全停止，并在进程重启时恢复。在监督模式下运行这些进程允许它们在发生故障时重新启动。因此，您的拓扑不受Storm守护进程故障的影响。要在监督模式下运行Storm守护进程，请执行以下命令：
- en: '***Starting Nimbus*—** Run `bin/storm nimbus` under supervision on the master
    machine.'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***启动 Nimbus*—** 在主机器上以监督模式运行 `bin/storm nimbus`。'
- en: '***Starting Supervisors*—** Run `bin/storm supervisor` under supervision on
    each worker machine.'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***启动 supervisors*—** 在每个工作机器上以监督模式运行 `bin/storm supervisor`。'
- en: '***Storm UI*—** Run `bin/storm ui` under supervision on the master machine.'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***Storm UI*—** 在主机器上以监督模式运行 `bin/storm ui`。'
- en: Running the Storm daemons is the last step in setting up a Storm cluster. With
    everything up and running, your cluster is ready to start accepting topologies.
    Let’s see how you go about getting your topology to run on a Storm cluster.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 运行Storm守护进程是设置Storm集群的最后一步。当一切正常运行时，您的集群准备开始接受拓扑。让我们看看您如何将拓扑运行在Storm集群上。
- en: 5.4\. Getting your topology to run on a Storm cluster
  id: totrans-130
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5.4. 将您的拓扑运行在Storm集群上
- en: 'In previous chapters we’ve run our topologies locally. This approach is fine
    for learning the fundamentals of Storm. But if one wants to reap the benefits
    Storm provides (especially along the lines of guaranteed message processing and
    parallelism), a remote Storm cluster is required. In this section we’ll show you
    how to do this by taking some of the code from the credit card authorization topology
    in [chapter 4](kindle_split_012.html#ch04) and doing the following:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的章节中，我们已经在本地运行了我们的拓扑。这种方法对于学习Storm的基本原理是可行的。但如果你想获得Storm提供的益处（尤其是在保证消息处理和并行性方面），则需要一个远程的Storm集群。在本节中，我们将通过从第4章中的信用卡授权拓扑中提取一些代码，并执行以下操作来展示如何做到这一点：
- en: Revisit the code for wiring together the topology components
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重新审视连接拓扑组件的代码
- en: Show the code for running that topology in local mode
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 展示在本地模式下运行该拓扑的代码
- en: Show the code for running that topology on a remote Storm cluster
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 展示在远程Storm集群上运行该拓扑的代码
- en: Show how to package and deploy that code to the remote Storm cluster
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 展示如何打包和部署该代码到远程Storm集群
- en: 5.4.1\. Revisiting how to put together the topology components
  id: totrans-136
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.4.1\. 重新审视如何组合拓扑组件
- en: Before we get into the code for running a topology in both local mode and on
    a remote cluster, let’s quickly rehash the code for wiring together the components
    for the topology from [chapter 4](kindle_split_012.html#ch04), the credit card
    authorization topology, to provide some context. We’ve already presented some
    of this code in [section 5.1.2](#ch05lev2sec2), but the next listing shows it
    in a more structured format.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们深入到在本地模式和远程集群上运行拓扑的代码之前，让我们快速回顾一下从[第4章](kindle_split_012.html#ch04)，信用卡授权拓扑，连接拓扑组件的代码，以提供一些背景。我们已经在[第5.1.2节](#ch05lev2sec2)中展示了一些这段代码，但接下来的列表以更结构化的格式展示了它。
- en: Listing 5.2\. `CreditCardTopologyBuilder.java` for building the credit card
    authorization topology
  id: totrans-138
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表5.2\. 用于构建信用卡授权拓扑的`CreditCardTopologyBuilder.java`
- en: '[PRE0]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: We’ve encapsulated the code for building the topology in CreditCardTopologyBuilder.java
    because this code doesn’t change, regardless of whether we’re running in local
    mode or on a Storm cluster. This is something we started doing in [chapter 3](kindle_split_011.html#ch03)
    and the advantage of this approach is it allows us to call the code for building
    the topology from multiple places without having to duplicate code.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将构建拓扑的代码封装在`CreditCardTopologyBuilder.java`中，因为这段代码不会改变，无论我们是在本地模式还是在Storm集群上运行。这是我们从[第3章](kindle_split_011.html#ch03)开始做的事情，这种方法的优点是它允许我们从多个地方调用构建拓扑的代码，而无需重复代码。
- en: Now that we have the code for building the topology, we’ll show you how to take
    this built topology and run it locally.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经有了构建拓扑的代码，我们将向您展示如何运行这个构建好的拓扑。
- en: 5.4.2\. Running topologies in local mode
  id: totrans-142
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.4.2\. 在本地模式下运行拓扑
- en: 'Local mode is useful when developing topologies. It allows you to simulate
    a Storm cluster in process on your local machine so you can quickly develop and
    test your topologies. This provides the benefit of a quick turnaround between
    making a change in code and functionally testing that change in a running topology.
    There are some drawbacks to local mode, though:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 本地模式在开发拓扑时很有用。它允许您在本地机器上模拟一个Storm集群，这样您就可以快速开发和测试您的拓扑。这提供了在代码更改和在实际运行拓扑中测试该更改之间快速周转的好处。尽管如此，本地模式也有一些缺点：
- en: You can’t achieve the parallelism you would with a remote Storm cluster. This
    makes testing parallelism changes difficult, if not impossible in local mode.
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您无法实现与远程Storm集群相同的并行性。这使得在本地模式下测试并行性更改变得困难，甚至可能不可能。
- en: Local mode won’t reveal potential serialization issues when Nimbus attempts
    to serialize instances of spouts and bolts to the individual worker nodes.
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当Nimbus尝试将spouts和bolts的实例序列化到各个工作节点时，本地模式不会揭示潜在的序列化问题。
- en: The following listing shows the class, `LocalTopologyRunner`, with a `main()`
    method that takes the topology we built in [listing 5.2](#ch05ex02) and runs it
    locally.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的列表展示了具有`main()`方法的`LocalTopologyRunner`类，该方法接受我们在[列表5.2](#ch05ex02)中构建的拓扑并在本地运行它。
- en: Listing 5.3\. `LocalTopologyRunner.java`, which runs the topology on a local
    cluster
  id: totrans-147
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表5.3\. 运行本地集群上拓扑的`LocalTopologyRunner.java`
- en: '![](113fig01_alt.jpg)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![](113fig01_alt.jpg)'
- en: The code in this listing should be familiar to you. What we have yet to address
    is the code for submitting the topology to a remote Storm cluster. Fortunately,
    this code isn’t that much different. Let’s take a look.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 列表中的代码应该对您来说很熟悉。我们尚未解决的是将拓扑提交到远程Storm集群的代码。幸运的是，这段代码并没有太大的不同。让我们看看。
- en: 5.4.3\. Running topologies on a remote Storm cluster
  id: totrans-150
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.4.3\. 在远程Storm集群上运行拓扑
- en: The code for running your topology remotely is similar to running it locally.
    The only difference is the code for submitting the topology to a cluster. You
    may also want a slightly different configuration as well, because local mode doesn’t
    support some of the things (parallelism and guaranteed message processing) that
    a remote cluster supports. The next listing shows this code in a class we call
    `RemoteTopologyRunner`.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 在远程运行您的拓扑的代码与本地运行类似。唯一的区别是提交拓扑到集群的代码。您可能还需要不同的配置，因为本地模式不支持远程集群支持的一些功能（并行性和保证消息处理）。下一个列表展示了这段代码在一个我们称之为`RemoteTopologyRunner`的类中。
- en: Listing 5.4\. `RemoteTopologyRunner`, which submits the topology to a remote
    cluster
  id: totrans-152
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 5.4\. `RemoteTopologyRunner`，用于将拓扑提交到远程集群
- en: '![](114fig01_alt.jpg)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![](114fig01_alt.jpg)'
- en: You’ll notice that the only differences are a slightly different configuration
    and using `StormSubmitter.submitTopology` instead of `LocalCluster.submitTopology`.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 您会注意到唯一的区别是配置略有不同，使用 `StormSubmitter.submitTopology` 而不是 `LocalCluster.submitTopology`。
- en: '|  |'
  id: totrans-155
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-156
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: We’ve wrapped the building, running locally, and running remotely of our topology
    within three different classes (`CreditCardTopologyBuilder`, `LocalTopologyRunner`,
    and `RemoteTopologyRunner`). Although you can set up your code however you please,
    we’ve found this split works well and we use it across all our topologies.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将我们的拓扑的构建、本地运行和远程运行封装在三个不同的类中（`CreditCardTopologyBuilder`、`LocalTopologyRunner`
    和 `RemoteTopologyRunner`）。虽然您可以按照您喜欢的任何方式设置代码，但我们发现这种分割效果很好，并且我们在所有拓扑中都使用它。
- en: '|  |'
  id: totrans-158
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Now that we’ve written the code for running our topologies on a remote cluster,
    let’s shift our attention to physically getting that code onto the Storm cluster
    so it can be run.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经编写了在远程集群上运行拓扑的代码，让我们将注意力转移到将代码物理上传到 Storm 集群以便运行。
- en: 5.4.4\. Deploying a topology to a remote Storm cluster
  id: totrans-160
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.4.4\. 将拓扑部署到远程 Storm 集群
- en: What does it mean to “deploy” your topology to a Storm cluster? By “deploy,”
    we mean physically copying a JAR containing your topology’s compiled code to the
    cluster so it can be run. You will need to deploy your topology from a machine
    with a properly-configured Storm installation. [Figure 5.6](#ch05fig06) provides
    a refresher on the extracted contents of a Storm release zip.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: “将拓扑部署到 Storm 集群”是什么意思？通过“部署”，我们指的是将包含拓扑编译代码的 JAR 文件物理复制到集群中，以便运行。您需要从配置了 Storm
    的机器上部署您的拓扑。[图 5.6](#ch05fig06) 提供了 Storm 发布版 zip 文件提取内容的复习。
- en: Figure 5.6\. Extracted contents of a Storm release zip
  id: totrans-162
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 5.6\. Storm 发布版 zip 文件提取的内容
- en: '![](05fig06.jpg)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig06.jpg)'
- en: 'You’ll want to make sure you update the /opt/storm/conf/storm.yaml file so
    the `nimbus.host` property is set to the proper location. We’re also interested
    in the /opt/storm/bin/storm file for this step: this is the executable you’ll
    run in order to deploy your topology JAR to the remote cluster. [Figure 5.7](#ch05fig07)
    shows the command you’d run to deploy your topology. You’ll notice in the figure
    that we reference the full location for the storm executable via /opt/storm/bin/storm.
    If you don’t want to do this, put /opt/storm/bin on your `PATH` and you can directly
    reference the `storm` command from anywhere on your machine.'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要确保更新 /opt/storm/conf/storm.yaml 文件，以便将 `nimbus.host` 属性设置为正确位置。我们对此步骤中的 /opt/storm/bin/storm
    文件也很感兴趣：这是您将运行以将拓扑 JAR 部署到远程集群的可执行文件。[图 5.7](#ch05fig07) 显示了您将运行的部署拓扑的命令。您会注意到在图中，我们通过
    /opt/storm/bin/storm 引用了 storm 可执行文件的全路径。如果您不想这样做，将 /opt/storm/bin 添加到您的 `PATH`
    中，您可以从机器上的任何位置直接引用 `storm` 命令。
- en: Figure 5.7\. The command for deploying your topology to a Storm cluster
  id: totrans-165
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 5.7\. 将拓扑部署到 Storm 集群的命令
- en: '![](05fig07_alt.jpg)'
  id: totrans-166
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig07_alt.jpg)'
- en: After you execute the command in [figure 5.7](#ch05fig07), your topology will
    be up and running on the Storm cluster. Once your topology is running, how do
    you know it’s actually working and processing data as expected? This is where
    you’d look to the Storm UI, which is discussed next.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 执行 [图 5.7](#ch05fig07) 中的命令后，您的拓扑将在 Storm 集群上启动并运行。一旦您的拓扑开始运行，您如何知道它实际上正在按预期工作并处理数据？这就是您需要查看
    Storm UI 的地方，接下来我们将讨论 Storm UI。
- en: 5.5\. The Storm UI and its role in the Storm cluster
  id: totrans-168
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5.5\. Storm UI 及其在 Storm 集群中的作用
- en: 'The Storm UI is the central place to find diagnostics on the Storm cluster
    and individual topologies. As mentioned in [section 5.3.5](#ch05lev2sec7), running
    the command `/bin/storm ui` on Nimbus will start the Storm UI. Two properties
    in defaults.yaml affect where to find the Storm UI:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: Storm UI 是查找 Storm 集群和单个拓扑诊断的中心位置。如 [5.3.5 节](#ch05lev2sec7) 中所述，在 Nimbus 上运行命令
    `/bin/storm ui` 将启动 Storm UI。defaults.yaml 中的两个属性影响 Storm UI 的查找位置：
- en: '**`nimbus.host`—** The hostname of the Nimbus machine'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**`nimbus.host`—** Nimbus 机器的主机名'
- en: '**`ui.port`—** The port number to serve up the Storm UI (defaults to 8080)'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**`ui.port`—** 用来提供 Storm UI 的端口号（默认为 8080）'
- en: Once it’s running, enter http://{nimbus.host}:{ui.port} in a web browser to
    get to the Storm UI.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦运行起来，请在网页浏览器中输入 http://{nimbus.host}:{ui.port} 以访问 Storm UI。
- en: 'The Storm UI has several sections:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: Storm UI 有几个部分：
- en: The Cluster Summary screen
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 集群摘要屏幕
- en: The individual topology summary screen
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 单个拓扑摘要屏幕
- en: Screens for each of the spouts and bolts
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个喷发器和螺栓的屏幕
- en: Each screen shows information related to different parts of the Storm cluster
    at varying levels of granularity. The Cluster Summary screen is related to the
    Storm cluster as a whole, as seen in [figure 5.8](#ch05fig08).
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 每个屏幕都显示了与Storm集群不同部分相关的信息，具有不同粒度级别。集群概要屏幕与整个Storm集群相关，如[图5.8](#ch05fig08)所示。
- en: Figure 5.8\. The Cluster Summary screen shows details for the entire Storm cluster.
  id: totrans-178
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.8\. 集群概要屏幕显示了整个Storm集群的详细信息。
- en: '![](05fig08_alt.jpg)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![图5.08](05fig08_alt.jpg)'
- en: Clicking on a particular topology link (such as github-commit-count in [figure
    5.8](#ch05fig08)) takes you to a topology summary screen. This screen shows information
    related to the specific topology, as you can see in [figure 5.9](#ch05fig09).
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 点击特定的拓扑链接（如[图5.8](#ch05fig08)中的github-commit-count）将带您进入拓扑概要屏幕。此屏幕显示与特定拓扑相关的信息，如[图5.9](#ch05fig09)所示。
- en: Figure 5.9\. The Topology summary screen shows details for a specific topology.
  id: totrans-181
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.9\. 拓扑概要屏幕显示了特定拓扑的详细信息。
- en: '![](05fig09_alt.jpg)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
  zh: '![图5.9](05fig09_alt.jpg)'
- en: Let’s delve into each screen in more detail next.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们更详细地探讨每个屏幕。
- en: '5.5.1\. Storm UI: the Storm cluster summary'
  id: totrans-184
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.5.1\. Storm UI：Storm集群概要
- en: The Storm Cluster Summary consists of four parts, as shown in [figure 5.10](#ch05fig10).
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: Storm集群概要由四个部分组成，如[图5.10](#ch05fig10)所示。
- en: Figure 5.10\. The Cluster Summary screen of the Storm UI
  id: totrans-186
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.10\. Storm UI的集群概要屏幕
- en: '![](05fig10_alt.jpg)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![图5.10](05fig10_alt.jpg)'
- en: Each section of this screen is explained in more detail in the following sections.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 本屏幕的每个部分将在以下部分中更详细地解释。
- en: Cluster Summary
  id: totrans-189
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 集群概要
- en: The Cluster Summary section provides a small but useful overview of your Storm
    cluster. You’ll notice the term *slots* in [figure 5.11](#ch05fig11). A slot corresponds
    to a worker process, so a cluster with two used slots means there are two worker
    processes running on that cluster. [Figure 5.11](#ch05fig11) provides more detail
    on each of the columns in this section.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 集群概要部分提供了一个小但有用的集群概览。你会在[图5.11](#ch05fig11)中注意到术语*槽位*。一个槽位对应一个工作进程，因此有两个槽位被使用的集群意味着该集群上有两个工作进程正在运行。[图5.11](#ch05fig11)提供了本节中每个列的更多详细信息。
- en: Figure 5.11\. The Cluster Summary section on the Cluster Summary screen of the
    Storm UI
  id: totrans-191
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.11\. Storm UI的集群概要屏幕上的集群概要部分
- en: '![](05fig11_alt.jpg)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![图5.11](05fig11_alt.jpg)'
- en: Topology summary
  id: totrans-193
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 拓扑概要
- en: The Topology summary lists all of the topologies deployed to the cluster. [Figure
    5.12](#ch05fig12) provides more detail on what information you see in this section.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 拓扑概要列出了部署到集群的所有拓扑。[图5.12](#ch05fig12)提供了本节中你看到的信息的更多详细信息。
- en: Figure 5.12\. The Topology summary section on the Cluster Summary screen of
    the Storm UI
  id: totrans-195
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.12\. Storm UI的集群概要屏幕上的拓扑概要部分
- en: '![](05fig12_alt.jpg)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
  zh: '![图5.12](05fig12_alt.jpg)'
- en: Supervisor summary
  id: totrans-197
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 管理员概要
- en: The Supervisor summary lists all the Supervisors in the cluster. Again, you’ll
    notice the term slots in [figure 5.13](#ch05fig13). This corresponds to a worker
    process on a particular Supervisor node. [Figure 5.13](#ch05fig13) provides more
    detail on what information you see in this section.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员概要列出了集群中的所有管理员。同样，你会在[图5.13](#ch05fig13)中注意到术语槽位。这对应于特定管理员节点上的一个工作进程。[图5.13](#ch05fig13)提供了本节中你看到的信息的更多详细信息。
- en: Figure 5.13\. The Supervisor summary section on the Cluster Summary screen of
    the Storm UI
  id: totrans-199
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.13\. Storm UI的集群概要屏幕上的管理员概要部分
- en: '![](05fig13_alt.jpg)'
  id: totrans-200
  prefs: []
  type: TYPE_IMG
  zh: '![图5.13](05fig13_alt.jpg)'
- en: Nimbus Configuration
  id: totrans-201
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: Nimbus配置
- en: The Nimbus Configuration lists the configuration defined in defaults.yaml and
    any overridden values in storm.yaml. [Figure 5.14](#ch05fig14) provides more detail
    on what information you see in this section.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: Nimbus配置列出了在defaults.yaml中定义的配置以及在storm.yaml中覆盖的任何值。[图5.14](#ch05fig14)提供了本节中你看到的信息的更多详细信息。
- en: Figure 5.14\. The Nimbus Configuration section on the Cluster Summary screen
    of the Storm UI
  id: totrans-203
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.14\. Storm UI的集群概要屏幕上的Nimbus配置部分
- en: '![](05fig14.jpg)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![图5.14](05fig14.jpg)'
- en: Having covered the Cluster Summary screen, let’s dive into what the screen for
    an individual topology looks like. You can access this screen by clicking on a
    given topology name in the list of topologies.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 在介绍了集群概要屏幕后，让我们深入了解单个拓扑的屏幕看起来是什么样子。您可以通过点击拓扑列表中的给定拓扑名称来访问此屏幕。
- en: '5.5.2\. Storm UI: individual Topology summary'
  id: totrans-206
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.5.2\. Storm UI：单个拓扑概要
- en: The sections of the individual Topology summary screen can be seen in [figure
    5.15](#ch05fig15).
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 单个拓扑概要屏幕的部分可以在[图5.15](#ch05fig15)中看到。
- en: Figure 5.15\. The Topology summary screen of the Storm UI
  id: totrans-208
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.15。Storm UI拓扑摘要屏幕
- en: '![](05fig15_alt.jpg)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
  zh: '![图片](05fig15_alt.jpg)'
- en: Each section of this screen is explained in more detail in the following sections.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的章节将更详细地解释此屏幕的每个部分。
- en: Topology summary
  id: totrans-211
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 拓扑摘要
- en: The Topology summary provides a small but useful overview of the topology being
    observed. [Figure 5.16](#ch05fig16) provides more detail on each of the individual
    columns in this section.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 拓扑摘要提供了对正在观察的拓扑的简要但有用的概述。[图5.16](#ch05fig16)提供了关于此部分每个单独列的更多细节。
- en: Figure 5.16\. The Topology summary section on the Topology summary screen of
    the Storm UI
  id: totrans-213
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.16。Storm UI拓扑摘要屏幕上的拓扑摘要部分
- en: '![](05fig16_alt.jpg)'
  id: totrans-214
  prefs: []
  type: TYPE_IMG
  zh: '![图片](05fig16_alt.jpg)'
- en: Topology actions
  id: totrans-215
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 拓扑操作
- en: The Topology actions section provides a UI for activating, deactivating, rebalancing,
    and killing your topology. [Figure 5.17](#ch05fig17) describes these actions in
    more detail.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 拓扑操作部分提供了一个用户界面来激活、停用、重新平衡和终止您的拓扑。[图5.17](#ch05fig17)更详细地描述了这些操作。
- en: Figure 5.17\. The Topology actions section on the Topology summary screen of
    the Storm UI
  id: totrans-217
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.17。Storm UI拓扑摘要屏幕上的拓扑操作部分
- en: '![](05fig17_alt.jpg)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
  zh: '![图片](05fig17_alt.jpg)'
- en: Topology stats
  id: totrans-219
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 拓扑统计
- en: The Topology stats section provides some general statistics at the topology
    level. These statistics can be shown for all time, the past 10 minutes, the past
    3 hours, or the past day. The time interval that’s selected is also applied to
    the spout and bolt stats sections, which are described next. [Figure 5.18](#ch05fig18)
    provides more detail on the information you see in this section.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 拓扑统计部分在拓扑级别提供了一些通用统计数据。这些统计数据可以显示为所有时间、过去10分钟、过去3小时或过去一天。所选的时间间隔也应用于喷发器和螺栓统计部分，这些部分将在下面描述。[图5.18](#ch05fig18)提供了关于此部分看到的信息的更多细节。
- en: Figure 5.18\. The Topology stats section on the Topology summary screen of the
    Storm UI
  id: totrans-221
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.18。Storm UI拓扑摘要屏幕上的拓扑统计部分
- en: '![](05fig18_alt.jpg)'
  id: totrans-222
  prefs: []
  type: TYPE_IMG
  zh: '![图片](05fig18_alt.jpg)'
- en: Spout stats
  id: totrans-223
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 喷发器统计
- en: The Spouts section shows the statistics for all spouts in the topology. The
    statistics are for the window of time that’s selected in the Topology Stats section
    (all time, the past 10 minutes, the past 3 hours, or the past day). [Figure 5.19](#ch05fig19)
    provides more detail on the information you see in this section.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 喷发器部分显示了拓扑中所有喷发器的统计数据。这些统计数据是拓扑统计部分所选时间窗口内的（所有时间、过去10分钟、过去3小时或过去一天）。[图5.19](#ch05fig19)提供了关于此部分看到的信息的更多细节。
- en: Figure 5.19\. The Spouts section on the Topology summary screen of the Storm
    UI
  id: totrans-225
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.19。Storm UI拓扑摘要屏幕上的喷发器部分
- en: '![](05fig19_alt.jpg)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![图片](05fig19_alt.jpg)'
- en: Bolt stats
  id: totrans-227
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 螺栓统计
- en: The Bolts section shows the statistics for all bolts in the topology. The statistics
    are for the window of time that’s selected in the Topology Stats section (all
    time, the past 10 minutes, the past 3 hours, or the past day). [Figure 5.20](#ch05fig20)
    provides more detail up to the Capacity column. [Figure 5.21](#ch05fig21) offers
    more detail on the remaining columns.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 螺栓部分显示了拓扑中所有螺栓的统计数据。这些统计数据是拓扑统计部分所选时间窗口内的（所有时间、过去10分钟、过去3小时或过去一天）。[图5.20](#ch05fig20)提供了直到容量列的更多细节。[图5.21](#ch05fig21)提供了剩余列的更多细节。
- en: Figure 5.20\. The Bolts section on the Topology summary screen of the Storm
    UI, up to Capacity column
  id: totrans-229
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.20。Storm UI拓扑摘要屏幕上的螺栓部分，直到容量列
- en: '![](05fig20_alt.jpg)'
  id: totrans-230
  prefs: []
  type: TYPE_IMG
  zh: '![图片](05fig20_alt.jpg)'
- en: Figure 5.21\. The Bolts section on the Topology summary screen of the Storm
    UI, remaining columns
  id: totrans-231
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.21。Storm UI拓扑摘要屏幕上的螺栓部分，剩余列
- en: '![](05fig21_alt.jpg)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![图片](05fig21_alt.jpg)'
- en: Topology Configuration
  id: totrans-233
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 拓扑配置
- en: The Topology Configuration lists the configuration defined for the particular
    topology being viewed. [Figure 5.22](#ch05fig22) provides more detail on what
    information you see in this section.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 拓扑配置列出了正在查看的特定拓扑中定义的配置。[图5.22](#ch05fig22)提供了关于您在此部分看到的信息的更多细节。
- en: Figure 5.22\. The Topology Configuration section on the Topology summary screen
    of the Storm UI
  id: totrans-235
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.22。Storm UI拓扑摘要屏幕上的拓扑配置部分
- en: '![](05fig22_alt.jpg)'
  id: totrans-236
  prefs: []
  type: TYPE_IMG
  zh: '![图片](05fig22_alt.jpg)'
- en: From the Topology summary screen, you can dive into one of the individual spouts
    or bolts. You access an individual spout or bolt by clicking on a spout or bolt
    name while on the Topology summary screen.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 从拓扑摘要屏幕，您可以深入了解单个喷发器或螺栓。在拓扑摘要屏幕上，通过单击喷发器或螺栓名称来访问单个喷发器或螺栓。
- en: '5.5.3\. Storm UI: individual spout/bolt summary'
  id: totrans-238
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.5.3。Storm UI：单个喷发器/螺栓摘要
- en: In the UI, an individual bolt contains six sections, as you can see in [figure
    5.23](#ch05fig23).
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在UI中，一个单独的bolt包含六个部分，如[图5.23](#ch05fig23)所示。
- en: Figure 5.23\. The bolt summary screen in the Storm UI
  id: totrans-240
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.23\. Storm UI中的bolt摘要屏幕
- en: '![](05fig23_alt.jpg)'
  id: totrans-241
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig23_alt.jpg)'
- en: Component summary
  id: totrans-242
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 组件摘要
- en: The Component summary section shows some high-level information about the bolt
    or spout being observed. [Figure 5.24](#ch05fig24) provides more details.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 组件摘要部分显示了被观察的bolt或spout的一些高级信息。[图5.24](#ch05fig24)提供了更多细节。
- en: Figure 5.24\. The Component Summary section for a bolt in the Storm UI
  id: totrans-244
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.24\. Storm UI中bolt的组件摘要部分
- en: '![](05fig24_alt.jpg)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig24_alt.jpg)'
- en: Bolt stats
  id: totrans-246
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: Bolt统计
- en: The Bolt stats section provides much of the same information that you saw in
    the Bolts section for the Topology summary, but the information is limited to
    an individual bolt (see [figure 5.25](#ch05fig25)).
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: Bolt统计部分提供了与拓扑摘要中Bolts部分所看到的大部分相同的信息，但信息仅限于单个bolt（见[图5.25](#ch05fig25)）。
- en: Figure 5.25\. The Bolt stats section in the Storm UI
  id: totrans-248
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.25\. Storm UI中的bolt统计部分
- en: '![](05fig25_alt.jpg)'
  id: totrans-249
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig25_alt.jpg)'
- en: Input stats
  id: totrans-250
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 输入统计
- en: The Input stats section shows statistics related to tuples being consumed by
    the bolt. The statistics are relative to a particular stream; in this case it’s
    the “default” stream. [Figure 5.26](#ch05fig26) goes into more detail about this
    section.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 输入统计部分显示了bolt正在消费的元组的统计信息。这些统计信息与特定的流相关；在这种情况下是“默认”流。[图5.26](#ch05fig26)对此部分进行了更详细的说明。
- en: Figure 5.26\. The Input stats section for a bolt in the Storm UI
  id: totrans-252
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.26\. Storm UI中bolt的输入统计部分
- en: '![](05fig26_alt.jpg)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig26_alt.jpg)'
- en: Output stats
  id: totrans-254
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 输出统计
- en: The Output stats section shows statistics related to tuples being emitted by
    the bolt (see [figure 5.27](#ch05fig27)).
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 输出统计部分显示了bolt发出的元组的统计信息（见[图5.27](#ch05fig27)）。
- en: Figure 5.27\. The Output stats section for a bolt in the Storm UI
  id: totrans-256
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.27\. Storm UI中bolt的输出统计部分
- en: '![](05fig27.jpg)'
  id: totrans-257
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig27.jpg)'
- en: Executors
  id: totrans-258
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: Executors
- en: The Executors section shows the statistics for all executors running instances
    of the particular bolt. We’ve split this section into two figures. [Figure 5.28](#ch05fig28)
    shows the first part and [figure 5.29](#ch05fig29) shows the second.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: Executors部分显示了运行特定bolt实例的所有executors的统计信息。我们将此部分分为两个图。![图5.28](#ch05fig28)显示了第一部分，[图5.29](#ch05fig29)显示了第二部分。
- en: Figure 5.28\. The Executors section for a bolt in the Storm UI, through Capacity
    column
  id: totrans-260
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.28\. Storm UI中bolt的Executors部分，通过容量列
- en: '![](05fig28_alt.jpg)'
  id: totrans-261
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig28_alt.jpg)'
- en: Figure 5.29\. The Executors section for a bolt in the Storm UI, remaining columns
  id: totrans-262
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.29\. Storm UI中bolt的Executors部分，剩余列
- en: '![](05fig29_alt.jpg)'
  id: totrans-263
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig29_alt.jpg)'
- en: Errors
  id: totrans-264
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 错误
- en: The Errors section shows you a history of errors experienced by this bolt, as
    you can see in [figure 5.30](#ch05fig30).
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 错误部分显示了此bolt所经历的错误历史，如[图5.30](#ch05fig30)所示。
- en: Figure 5.30\. The Errors section for a bolt in the Storm UI
  id: totrans-266
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图5.30\. Storm UI中bolt的错误部分
- en: '![](05fig30_alt.jpg)'
  id: totrans-267
  prefs: []
  type: TYPE_IMG
  zh: '![](05fig30_alt.jpg)'
- en: The Storm UI provides a wealth of information, giving you a clear picture of
    how your topology is operating in production. With the Storm UI, you can quickly
    tell if your topology is healthy or if something is amiss. You should easily be
    able to spot errors your topology is encountering while also being able to quickly
    identify other issues, such as bottlenecks.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: Storm UI提供了丰富的信息，使你能够清楚地了解你的拓扑在生产中的运行情况。使用Storm UI，你可以快速判断你的拓扑是否健康，或者是否有问题。你应该能够轻松地发现你的拓扑遇到的问题，同时也能够快速识别其他问题，例如瓶颈。
- en: As you can probably imagine, once you deploy your topology to a production Storm
    cluster, your job as a developer doesn’t end. Once it’s deployed, you enter a
    whole new world of making sure your topology is running as efficiently as possible.
    This is the world of tuning and troubleshooting. We’ve devoted the next two chapters
    to those tasks.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所能想象，一旦你将你的拓扑部署到生产Storm集群中，你的开发者工作并没有结束。一旦部署，你将进入一个全新的世界，确保你的拓扑尽可能高效地运行。这就是调优和故障排除的世界。我们将在接下来的两章中专注于这些任务。
- en: 'This chapter laid the foundation for tuning by explaining the parts of a Storm
    cluster and what each part of the Storm cluster does. We also provided a thorough
    explanation of the primary tool you’ll use while tuning and troubleshooting: the
    Storm UI.'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 本章通过解释Storm集群的各个部分以及每个部分的作用，为调优奠定了基础。我们还详细解释了你在调优和故障排除过程中将使用的首选工具：Storm UI。
- en: 5.6\. Summary
  id: totrans-271
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5.6\. 摘要
- en: 'In this chapter you learned the following:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了以下内容：
- en: A Storm cluster consists of Nimbus, which acts as the control center, and Supervisors,
    which execute the logic in the instances of spouts and bolts.
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Storm集群由Nimbus组成，它作为控制中心，以及执行spouts和bolts实例中的逻辑的管理员组成。
- en: A Zookeeper cluster is necessary to run alongside a Storm cluster as it coordinates
    communication between Nimbus/Supervisors while also maintaining state.
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行Storm集群的同时需要有一个Zookeeper集群，因为它在Nimbus/管理员之间协调通信，同时维护状态。
- en: Supervisors run worker processes (JVMs), which in turn run executors (threads)
    and tasks (instances of spouts/bolts).
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理员运行工作进程（JVMs），这些工作进程再运行执行器（线程）和任务（spouts/bolts的实例）。
- en: How to install a Storm cluster, including the key configuration options that
    must be set in order to get the cluster running.
  id: totrans-276
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何安装一个Storm集群，包括必须设置的键配置选项，以便使集群运行。
- en: How to deploy your topologies to a Storm cluster and how running them on the
    cluster is really no different than running them locally.
  id: totrans-277
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何将你的拓扑部署到Storm集群，以及如何在集群上运行它们实际上与本地运行没有太大区别。
- en: What the Storm UI is and how the different parts of the Storm ecosystem map
    to the different screens of the Storm UI.
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Storm UI是什么，以及Storm生态系统的不同部分如何映射到Storm UI的不同屏幕。
- en: What information each section of the Storm UI provides and how these pieces
    of information may be useful for tuning and troubleshooting your topologies.
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Storm UI的每个部分提供什么信息，以及这些信息如何有助于调整和调试你的拓扑。
