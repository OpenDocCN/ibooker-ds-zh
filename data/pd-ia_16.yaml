- en: 14 Visualization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 14 可视化
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Installing the Matplotlib library for data visualization
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装Matplotlib库进行数据可视化
- en: Rendering graphs and charts with pandas and Matplotlib
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用pandas和Matplotlib渲染图表和图形
- en: Applying color templates to visualizations
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将颜色模板应用于可视化
- en: Text-based `DataFrame` summaries are helpful, but many times, a story can best
    be told by a visualization. A line chart can quickly communicate a trend over
    time; a bar graph can distinctly identify unique categories and their counts;
    a pie chart can represent proportions in an easily digestible manner, and so on.
    Fortunately, pandas seamlessly integrates with many popular Python data visualization
    libraries, including Matplotlib, seaborn, and ggplot. In this chapter, we’ll learn
    how to use Matplotlib to render dynamic charts from our `Series` and `DataFrame`s.
    I hope that these visualizations help you add that little spark to your data presentations.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 文本形式的 `DataFrame` 摘要很有帮助，但很多时候，一个故事最好通过可视化来讲述。折线图可以快速传达趋势；条形图可以清晰地识别独特的类别及其计数；饼图可以以易于消化的方式表示比例，等等。幸运的是，pandas与许多流行的Python数据可视化库无缝集成，包括Matplotlib、seaborn和ggplot。在本章中，我们将学习如何使用Matplotlib从我们的
    `Series` 和 `DataFrame`s 中渲染动态图表。我希望这些可视化能帮助您在数据展示中添加一点火花。
- en: 14.1 Installing matplotlib
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 14.1 安装matplotlib
- en: By default, pandas relies on the open source Matplotlib package to render charts
    and graphs. Let’s install it in our Anaconda environment.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，pandas依赖于开源的Matplotlib包来渲染图表和图形。让我们在我们的Anaconda环境中安装它。
- en: Begin by launching the Terminal (macOS) or Anaconda Prompt (Windows) application
    for your operating system. The default Anaconda environment, `base`, should be
    listed in parentheses to the left. `base` is the currently active environment.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，启动您操作系统的终端（macOS）或Anaconda Prompt（Windows）应用程序。默认的Anaconda环境 `base` 应该列在左侧括号内。`base`
    是当前活动环境。
- en: 'When we installed Anaconda (see appendix A), we created an environment called
    `pandas_in_action`. Let’s execute the `conda` `activate` command to activate it.
    If you chose a different environment name, replace `pandas_in_action` with that
    name, as follows:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们安装Anaconda（见附录A）时，我们创建了一个名为 `pandas_in_action` 的环境。让我们执行 `conda activate`
    命令来激活它。如果您选择了不同的环境名称，请将 `pandas_in_action` 替换为该名称，如下所示：
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The parentheses should change to reflect the active environment. Execute the
    command `conda install matplotlib` to install the Matplotlib library within the
    `pandas_in_action` environment:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 括号应反映活动环境。执行命令 `conda install matplotlib` 在 `pandas_in_action` 环境中安装Matplotlib库：
- en: '[PRE1]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: When the prompt asks you to confirm, enter `'Y'` for yes and press Enter. When
    installation completes, execute `jupyter notebook` and create a new Notebook.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 当提示确认时，输入 `'Y'` 表示是并按Enter键。安装完成后，执行 `jupyter notebook` 并创建一个新的Notebook。
- en: 14.2 Line charts
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 14.2 折线图
- en: As always, let’s begin by importing the pandas library. We’ll also import the
    `pyplot` package from within the Matplotlib library. In this context, a *package*
    means a nested folder within the top library. We can access the `pyplot` package
    using dot syntax, the same way we access any library attribute. A common community
    alias for `pyplot` is `plt`.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 如往常一样，让我们首先导入pandas库。我们还将从Matplotlib库中导入 `pyplot` 包。在这个上下文中，一个 *包* 指的是顶级库中的一个嵌套文件夹。我们可以使用点符号访问
    `pyplot` 包，就像访问任何库属性一样。`pyplot` 的一个常见社区别名是 `plt`。
- en: 'By default, Jupyter Notebook renders each Matplotlib visualization in a separate
    browser window, like a pop-up window on a website. The windows can be a bit jarring,
    especially when there are multiple charts on the screen. We can add an extra line—`%matplotlib`
    `inline`—to force Jupyter to render visualizations directly below the code in
    a cell. `%matplotlib inline` is an example of a magic function, a syntactical
    shortcut for setting a configuration option in the Notebook:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Jupyter Notebook会将每个Matplotlib可视化渲染在单独的浏览器窗口中，就像网站上的弹出窗口一样。窗口可能会有些令人震惊，尤其是当屏幕上有多个图表时。我们可以添加一个额外的行——`%matplotlib
    inline`——来强制Jupyter在单元格下方直接渲染可视化。`%matplotlib inline` 是一个魔法函数，是设置Notebook配置选项的语法快捷方式：
- en: '[PRE2]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Now on to the data! This chapter’s data set, space_missions.csv, includes more
    than 100 space flights throughout 2019 and 2020\. Each record consists of a mission’s
    date, sponsoring company, location, cost, and status `("Success"` or `"Failure"`):'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 现在来看数据！本章的数据集，space_missions.csv，包含了2019年和2020年间的100多次太空飞行记录。每条记录包括任务日期、赞助公司、地点、成本和状态（"成功"或"失败"）：
- en: '[PRE3]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Let’s adjust two settings before we assign the imported `DataFrame` to a `space`
    variable. First, we’ll use the `parse_dates` parameter to import the values in
    the Date column as datetimes. Next, we’ll set the Date column as the index of
    the `DataFrame`:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们将导入的`DataFrame`分配给`space`变量之前，让我们调整两个设置。首先，我们将使用`parse_dates`参数将日期列中的值导入为日期时间。接下来，我们将日期列设置为`DataFrame`的索引：
- en: '[PRE4]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Suppose that we want to plot the flight costs over the two years in this data
    set. A *time-series* graph is an optimal chart for observing a trend over time.
    We can plot time on the x-axis and values on the y-axis. First, let’s extract
    the Cost column from the space `DataFrame`. The result is a `Series` with numeric
    values and a datetime index:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们想要绘制这个数据集中两年内的飞行成本。*时间序列*图是观察随时间趋势的最佳图表。我们可以在x轴上绘制时间，在y轴上绘制值。首先，让我们从`DataFrame`的空间中提取成本列。结果是包含数值和日期时间索引的`Series`：
- en: '[PRE5]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'To render a visualization, invoke the `plot` method on a pandas data structure.
    By default, Matplotlib draws a line graph. Jupyter also prints the location of
    the graph object in the computer’s memory. The location will be different with
    each cell execution, so feel free to ignore it:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 要渲染一个可视化，请在pandas数据结构上调用`plot`方法。默认情况下，Matplotlib绘制一个折线图。Jupyter还会打印出图表对象在计算机内存中的位置。这个位置会随着每个单元格的执行而不同，所以请随意忽略它：
- en: '[PRE6]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](../Images/CH14_UN01_Paskhaver.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH14_UN01_Paskhaver.png)'
- en: Pretty fancy! We have rendered a line chart with Matplotlib using values from
    pandas. By default, the library plots the index labels (in this case, the datetimes)
    on the x-axis and the `Series`’ values on the y-axis. Matplotlib also calculates
    reasonable intervals for the range of values on both axes.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 真的很花哨！我们已经使用pandas的值使用Matplotlib渲染了一个折线图。默认情况下，库在x轴上绘制索引标签（在这种情况下，日期时间），在y轴上绘制`Series`的值。Matplotlib还计算了两个轴上值范围的合理间隔。
- en: 'We can also invoke the `plot` method on the space `DataFrame` itself. In this
    scenario, pandas produces the same output, but only because the data set has only
    one numeric column:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也可以在空间`DataFrame`本身上调用`plot`方法。在这种情况下，pandas产生相同的输出，但仅因为数据集只有一个数值列：
- en: '[PRE7]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](../Images/CH14_UN02_Paskhaver.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH14_UN02_Paskhaver.png)'
- en: 'If a `DataFrame` holds multiple numeric columns, Matpotlib will draw a separate
    line for each one. Be careful: if there is a large gap in the magnitude of values
    between columns (if one numeric column has values in the millions and another
    has values in the hundreds, for example), the larger values can easily dwarf the
    smaller ones. Consider this `DataFrame`:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`DataFrame`包含多个数值列，Matplotlib将为每个列绘制一条单独的线。请注意：如果列之间值的幅度存在较大差距（例如，如果一个数值列的值在百万级别，而另一个在百级别），较大的值可能会轻易地掩盖较小的值。考虑以下`DataFrame`：
- en: '[PRE8]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'When we plot the df `DataFrame`, Matplotlib adjusts the graph scale to accommodate
    the Large column’s values. The trend in the Small column’s values becomes impossible
    to see:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们绘制df `DataFrame`时，Matplotlib调整图表比例以适应大型列的值。小型列的值趋势变得难以看到：
- en: '[PRE9]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](../Images/CH14_UN03_Paskhaver.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH14_UN03_Paskhaver.png)'
- en: 'Let’s come back to space. The `plot` method accepts a `y` parameter to identify
    the `DataFrame` column whose values Matplotlib should plot. The next example passes
    the Cost column and is another way to render the same time-series graph:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回到空间。`plot`方法接受一个`y`参数来标识Matplotlib应该绘制其值的`DataFrame`列。下一个示例传递了成本列，这是渲染相同时间序列图的另一种方式：
- en: '[PRE10]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](../Images/CH14_UN04_Paskhaver.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH14_UN04_Paskhaver.png)'
- en: 'We can use the `colormap` parameter to alter the aesthetics of the visualization.
    Think of this process as setting the color theme of the graph. The parameter accepts
    a string with a predefined color palette from the Matplotlib library. The following
    example uses a `"gray"` theme that renders the line chart in black and white:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`colormap`参数来改变可视化的外观。将这个过程想象成设置图表的颜色主题。该参数接受一个字符串，该字符串来自Matplotlib库的预定义调色板。以下示例使用了一个`"gray"`主题，该主题将折线图渲染为黑白：
- en: '[PRE11]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](../Images/CH14_UN05_Paskhaver.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH14_UN05_Paskhaver.png)'
- en: 'To see a list of valid inputs for the `colormaps` parameter, invoke the `colormaps`
    method on the `pyplot` library (aliased to `plt` in our Notebook). Note that we
    can apply some of these themes only if certain criteria are met, such as a minimum
    number of graph lines:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看`colormaps`参数的有效输入列表，请在`pyplot`库（在我们的笔记本中别名为`plt`）上调用`colormaps`方法。请注意，我们只能在某些条件满足的情况下应用一些主题，例如最小数量的图表线条：
- en: '[PRE12]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Matplotlib has more than 150 available color maps to choose among. The library
    also offers ways to customize the graphs manually.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: Matplotlib 提供了超过 150 种可用的颜色图可供选择。该库还提供了手动自定义图表的方法。
- en: 14.3 Bar graphs
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 14.3 柱状图
- en: The `plot` method’s `kind` parameter alters the type of chart that Matplotlib
    renders. A bar graph is an excellent choice to display the counts of unique values
    in a data set, so let’s use it to visualize how many space flights each company
    sponsored.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '`plot` 方法的 `kind` 参数会改变 Matplotlib 渲染的图表类型。柱状图是展示数据集中唯一值计数的绝佳选择，因此我们可以用它来可视化每家公司赞助的太空飞行次数。'
- en: 'First, we’ll target the Company Name column and invoke the `value_counts` method
    to return a `Series` of mission counts by company:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将针对“公司名称”列并调用 `value_counts` 方法来返回按公司计算的使命计数的 `Series`：
- en: '[PRE13]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Next, let’s invoke the `plot` method on the `Series`, passing an argument of
    `"bar"` to the `kind` parameter. Matplotlib once again plots the index labels
    on the x-axis and the values on the y-axis. It looks as though CASC has the most
    entries in the data set, followed by SpaceX:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们在 `Series` 上调用 `plot` 方法，将 `kind` 参数的参数传递为 `"bar"`。Matplotlib 再次在 x 轴上绘制索引标签，在
    y 轴上绘制值。看起来 CASC 在数据集中有最多的条目，其次是 SpaceX：
- en: '[PRE14]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![](../Images/CH14_UN06_Paskhaver.png)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH14_UN06_Paskhaver.png)'
- en: 'The graph is a good start, but we have to twist our heads to read the labels.
    Ouch. Let’s change the `kind` argument to `"barh"` to render a horizontal bar
    graph instead:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图表是一个良好的开始，但我们必须转动头部才能读取标签。哎呀。让我们将 `kind` 参数更改为 `"barh"` 以渲染一个水平柱状图：
- en: '[PRE15]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](../Images/CH14_UN07_Paskhaver.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH14_UN07_Paskhaver.png)'
- en: That’s a lot better! Now we can easily identify which companies had the greatest
    number of space flights in the data set.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 现在好多了！现在我们可以轻松地识别哪些公司在数据集中有最多的太空飞行次数。
- en: 14.4 Pie charts
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 14.4 饼图
- en: A *pie chart* is a visualization in which colored slices add up to form a whole
    circular pie (much like slices of a pizza). Each piece visually represents the
    proportion it contributes to the total amount.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '*饼图*是一种可视化，其中彩色切片组合形成一个完整的圆形饼图（就像披萨的片状）。每一部分都直观地表示它对总量的贡献比例。'
- en: 'Let’s use a pie chart to compare the ratio of successful missions to failed
    missions. The Status column has only two unique values: `"Success"` and `"Failure"`.
    First, we’ll use the `value_counts` method to count the number of occurrences
    of each:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用饼图来比较成功任务与失败任务的比例。状态列只有两个唯一值：“成功”和“失败”。首先，我们将使用 `value_counts` 方法来计算每个值的出现次数：
- en: '[PRE16]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Let’s invoke the `plot` method again. This time around, we’ll pass the `kind`
    parameter an argument of `"pie"`:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们再次调用 `plot` 方法。这次，我们将 `kind` 参数的参数设置为 `"pie"`：
- en: '[PRE17]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![](../Images/CH14_UN08_Paskhaver.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH14_UN08_Paskhaver.png)'
- en: Good news! It looks as though the majority of space flights were successful.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 好消息！看起来大多数太空飞行都是成功的。
- en: 'To add a legend to a visualization like this one, we can pass the `legend`
    parameter an argument of `True`:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 要向此类可视化添加图例，我们可以将 `legend` 参数的参数设置为 `True`：
- en: '[PRE18]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Matplotlib supports a wide variety of additional charts and graphs, including
    histograms, scatterplots, and boxplots. We can include additional parameters to
    customize the aesthetics, labels, legends, and interactivity of these visualizations.
    We’ve only scratched the surface of what this powerful library can render.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: Matplotlib 支持广泛的附加图表和图形，包括直方图、散点图和箱线图。我们可以包括额外的参数来自定义这些可视化的美学、标签、图例和交互性。我们只是触及了这个强大库可以渲染的表面。
- en: '![](../Images/CH14_UN09_Paskhaver.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH14_UN09_Paskhaver.png)'
- en: Summary
  id: totrans-68
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 概述
- en: Pandas seamlessly integrates with the Matplotlib library for data visualization.
    It also plays well with additional plotting libraries within Python’s data science
    ecosystem.
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Pandas 与 Matplotlib 库无缝集成，用于数据可视化。它还与 Python 数据科学生态系统中其他绘图库兼容得很好。
- en: The `plot` method on a `Series` or `DataFrame` renders a visualization with
    data from the pandas data structure.
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 `Series` 或 `DataFrame` 上的 `plot` 方法会渲染一个包含 pandas 数据结构数据的可视化。
- en: The default Matplotlib chart is a line graph.
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Matplotlib 默认的图表是折线图。
- en: The `kind` parameter to the `plot` method alters the type of the rendered visualization.
    Options include line graphs, bar graphs, and pie charts.
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`plot` 方法的 `kind` 参数会改变渲染的可视化类型。选项包括折线图、柱状图和饼图。'
- en: The `colormap` parameter changes the color scheme of the rendered graphic. Matplotlib
    has dozens of predefined templates, and users can also create their own by adjusting
    method parameters.
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`colormap`参数会改变渲染图形的颜色方案。Matplotlib有数十个预定义的模板，用户也可以通过调整方法参数来创建自己的模板。'
