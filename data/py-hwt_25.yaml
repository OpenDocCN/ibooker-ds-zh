- en: Appendix E. Preparing your package for public distribution
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录 E. 准备您的包以供公开分发
- en: E.1 Selecting PyPI as the distribution target
  id: totrans-1
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.1 选择 PyPI 作为分发目标
- en: One major reason for Python’s popularity is its vast repository of tools for
    various specialties, including data science and machine learning. Most of these
    tools are contributed by regular Python developers. The most common way to share
    the tools is to pack your code into a package and upload it to the Python Package
    Index (PyPI; [https://pypi.org](https://pypi.org/)). After you upload it, any
    Python users in the world can download your package easily by using the pip tool
    (appendix B online). In this appendix, I’ll show you how to publish a package
    using the task management app that we’ve built (chapter 14).
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: Python 流行的一个主要原因是它拥有庞大的工具库，用于各种专业领域，包括数据科学和机器学习。这些工具中的大多数都是由常规 Python 开发者贡献的。最常见的方式是将代码打包成包并上传到
    Python 包索引（PyPI；[https://pypi.org](https://pypi.org/))。上传后，世界上任何使用 pip 工具（附录 B
    在线）的 Python 用户都可以轻松下载您的包。在本附录中，我将向您展示如何使用我们构建的任务管理应用程序发布包（第 14 章）。
- en: E.2 Preparing the files
  id: totrans-3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.2 准备文件
- en: 'Before we can publish our package, we should organize the directory in the
    desired format. Using our task management app, we should have a directory like
    this one:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们可以发布我们的包之前，我们应该以所需的格式组织目录。使用我们的任务管理应用程序，我们应该有一个如下所示的目录：
- en: '[PRE0]'
  id: totrans-5
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The README.md file contains information about the package, such as installation
    and use instructions. The .md extension represents the Markdown language, which
    can convert plain text to formatted text. For simplicity, suppose that the README.md
    file has the following content:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: README.md 文件包含有关包的信息，例如安装和使用说明。.md 扩展名代表 Markdown 语言，可以将纯文本转换为格式化文本。为了简单起见，假设
    README.md 文件具有以下内容：
- en: '[PRE1]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: After we publish the package, you’ll see that the web page has formatted the
    text (figure E.1).
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们发布包之后，您会看到网页已经格式化了文本（图 E.1）。
- en: '![APPE_F01_Cui](../Images/APPE_F01_Cui.png)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
  zh: '![APPE_F01_Cui](../Images/APPE_F01_Cui.png)'
- en: Figure E.1 Converting markdowns to formatted content
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 图 E.1 将 Markdown 转换为格式化内容
- en: You may notice that we include license information about the package so that
    users know the terms. In most cases, you use one of the licenses to open-source
    your package, giving users freedom to use the package.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能会注意到我们包括了有关包的许可信息，以便用户了解条款。在大多数情况下，您使用其中一个许可来开源您的包，使用户能够自由使用该包。
- en: 'The setup.py file includes code that sets up the package for publishing. Please
    note that there are different ways to prepare your package for publishing. One
    common way is to use the built-in setuptools module. We have the following code
    in the setup.py file:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: setup.py 文件包含设置包以供发布的代码。请注意，有不同方式为发布准备您的包。一种常见的方式是使用内置的 setuptools 模块。我们在 setup.py
    文件中有以下代码：
- en: '[PRE2]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'In the file, we call the setup method. The arguments should be straightforward.
    The following list highlights a few arguments:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在文件中，我们调用设置方法。参数应该是直截了当的。以下列表突出显示了一些参数：
- en: The name argument is a unique identifier for your package on PyPI. It's a convention
    to append your PyPI username to the package name to ensure uniqueness.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 名称参数是您的包在 PyPI 上的唯一标识符。将您的 PyPI 用户名附加到包名是一种约定，以确保唯一性。
- en: The long_description argument is usually set using the content of the README.md
    file. To format the content properly, we specify that the content uses the markdown
    language in the long_description_content_type argument.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: long_description 参数通常使用 README.md 文件的内容设置。为了正确格式化内容，我们在 long_description_content_type
    参数中指定内容使用 markdown 语言。
- en: The setuptools.find_packages() call retrieves the packages that we’re going
    to publish in the directory. As I’ll discuss in the last item of this list, the
    __init__.py file marks a folder as a Python package.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: setuptools.find_packages() 调用检索我们将要发布的目录中的包。正如我将在本列表的最后一项中讨论的那样，__init__.py
    文件将文件夹标记为 Python 包。
- en: Because our app depends on streamlit, we specify it in the install_requires
    argument.
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于我们的应用程序依赖于 streamlit，我们在 install_requires 参数中指定了它。
- en: Python is evolving, so we make sure that our package has the correct Python
    version by setting the python_requires argument.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python 正在不断发展，因此我们通过设置 python_requires 参数来确保我们的包具有正确的 Python 版本。
- en: We create an empty file named __init__.py in the howtotaskier folder. This file
    converts a regular directory to a Python package.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们在 howtotaskier 文件夹中创建了一个名为 __init__.py 的空文件。此文件将常规目录转换为 Python 包。
- en: E.3 Registering a TestPyPI account
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.3 注册 TestPyPI 账户
- en: The official PyPI refers to the packages managed through the [https://pypi.org](https://pypi.org/)
    website. Notably, a test instance for the website allows you to test your package
    publishing without messing up the official indexing. For practice, you’re going
    to work on the test instance.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 官方PyPI指的是通过[https://pypi.org](https://pypi.org/)网站管理的包。值得注意的是，该网站的测试实例允许您在不干扰官方索引的情况下测试您的包发布。为了练习，您将在这个测试实例上工作。
- en: You need to register an account for the test instance (a separate account from
    the one on [https://pypi.org](https://pypi.org/)) by going to [https://test.pypi.org/account/register/](https://test.pypi.org/account/register/).
    When you have your TestPyPI account, I recommend that you create an application
    programming interface (API) token, which you can use to upload your package. That
    process is more secure than entering your username and password for uploading.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要通过访问[https://test.pypi.org/account/register/](https://test.pypi.org/account/register/)来为测试实例（与[https://pypi.org](https://pypi.org/)上的账户分开）注册一个账户。当您拥有TestPyPI账户后，我建议您创建一个应用程序编程接口（API）令牌，您可以使用它来上传您的包。这个过程比输入您的用户名和密码来上传更安全。
- en: 'To set up an API token, go to Account Settings, and click Add API Token in
    the API Tokens section. You can specify the token’s scope: for all projects or
    specific projects. After you create a token, it’s critical to save it to a place
    where you can retrieve it later; you can’t recreate or recover the token for security
    reasons.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置API令牌，请转到账户设置，并在API令牌部分点击添加API令牌。您可以指定令牌的作用域：对所有项目或特定项目。在创建令牌后，将其保存到您可以稍后检索的地方非常重要；出于安全原因，您无法重新创建或恢复令牌。
- en: E.4 Installing, archiving, and uploading tools
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.4 安装、存档和上传工具
- en: 'To publish our package, we need three tools: setuptools, wheel, and twine.
    You’ve seen how we use setuptools, which is a built-in module that requires no
    extra installation. For these tools, in the taskier-env environment (section 14.1),
    run the following command in a command-line tool:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 为了发布我们的包，我们需要三个工具：setuptools、wheel和twine。您已经看到了我们如何使用setuptools，这是一个内置模块，无需额外安装。对于这些工具，在taskier-env环境（第14.1节）中，在命令行工具中运行以下命令：
- en: '[PRE3]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: This command installs or updates the necessary tools (if you have those tools
    installed already). Section E.5 shows how to use those tools.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令安装或更新必要的工具（如果您已经安装了这些工具）。第E.5节展示了如何使用这些工具。
- en: E.5 Distributing your package
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.5 分发您的包
- en: 'The first step in package distribution is archiving the package. Using the
    command-line tool, navigate to the root directory of the project (the taskier_app
    folder, in this case). Then run the following command:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 包分发的第一步是存档包。使用命令行工具，导航到项目的根目录（在本例中是taskier_app文件夹）。然后运行以下命令：
- en: '[PRE4]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'This command uses the wheel tool with setuptools to archive the package, making
    it ready for uploading to PyPI. After running the command, you’ll see that extra
    files have been created, and you should see something like the following:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令使用wheel工具与setuptools一起存档包，使其准备好上传到PyPI。运行命令后，您将看到创建了额外的文件，您应该看到以下类似的内容：
- en: '[PRE5]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: These new directories and files are required documents for archiving your package.
    In particular, the two files in the dist folder are those you’re going to upload
    for public distribution.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 这些新目录和文件是存档您的包所需的文档。特别是，dist文件夹中的两个文件是您将要上传以供公开分发的文件。
- en: 'The second step in package distribution is uploading the package. To upload,
    use the twine tool by running the following command:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 包分发的第二步是上传包。要上传，使用twine工具运行以下命令：
- en: '[PRE6]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This command uploads the archived package files in the dist folder to the test
    instance of the PyPI website. You’ll be prompted to enter your username and password.
    As mentioned in section E.3, it’s best to use an API token. To do that, enter
    __token__ as the username. For the password, copy and paste your token from the
    place where you saved it. The token or password is hidden for security purposes.
    Then press Return (Mac) or Enter (Windows) on your computer to complete the upload.
    If everything works, the command-line tool should tell you that the package is
    uploaded, and you can view the project at [https://test.pypi.org/project/howtotaskier/](https://test.pypi.org/project/howtotaskier/).
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令将 dist 文件夹中的归档包文件上传到 PyPI 网站的测试实例。你将被提示输入用户名和密码。如 E.3 节所述，最好使用 API 令牌。为此，输入
    __token__ 作为用户名。密码方面，从你保存令牌的地方复制并粘贴你的令牌。出于安全考虑，令牌或密码是隐藏的。然后按电脑上的 Return（Mac）或
    Enter（Windows）键完成上传。如果一切顺利，命令行工具应该会告诉你包已上传，你可以在 [https://test.pypi.org/project/howtotaskier/](https://test.pypi.org/project/howtotaskier/)
    查看项目。
- en: E.6 Testing your package
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.6 测试你的包
- en: 'Now the package is uploaded, and you know that it’s visible to the whole world!
    You can try installing the package using the pip tool (appendix B online) as follows:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 现在包已上传，你知道它对全世界都是可见的！你可以尝试使用 pip 工具（附录 B 在线）如下安装包：
- en: '[PRE7]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: REMINDER You can create a separate environment for the testing so that you don't
    mess up the current project.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 提醒：你可以为测试创建一个单独的环境，这样就不会弄乱当前项目。
- en: 'After installation, try the following code in the Python console:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 安装后，请在 Python 控制台中尝试以下代码：
- en: '[PRE8]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: As shown, you’re able to use the Task class in the package!
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如所示，你能够使用包中的 Task 类！
