- en: Appendix B. Miscellaneous library updates
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 附录B. 其他库更新
- en: This appendix reviews the main additions to the Java 8 library.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本附录回顾了Java 8库的主要新增内容。
- en: B.1\. Collections
  id: totrans-2
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.1\. 集合
- en: The biggest update to the Collections API is the introduction of streams, which
    we discussed in [chapters 4](kindle_split_015.xhtml#ch04), [5](kindle_split_016.xhtml#ch05),
    and [6](kindle_split_017.xhtml#ch06). There are also other updates discussed in
    [Chapter 9](kindle_split_021.xhtml#ch09) and additional minor additions summarized
    in this appendix.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 集合API的最大更新是引入了流，我们已在第4章、第5章和第6章中讨论过。第9章中也讨论了其他更新，本附录中还总结了额外的少量新增内容。
- en: B.1.1\. Additional methods
  id: totrans-4
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: B.1.1\. 其他方法
- en: The Java API designers made the most out of default methods and added several
    new methods to collection interfaces and classes. The new methods are listed in
    [table B.1](#app02table01).
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: Java API设计者充分利用了默认方法，并为集合接口和类添加了几个新方法。新方法列在[表B.1](#app02table01)中。
- en: Table B.1\. New methods added to collection classes and interfaces
  id: totrans-6
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表B.1\. 集合类和接口新增的方法
- en: '| Class/interface | New methods |'
  id: totrans-7
  prefs: []
  type: TYPE_TB
  zh: '| 类/接口 | 新方法 |'
- en: '| --- | --- |'
  id: totrans-8
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| Map | getOrDefault, forEach, compute, computeIfAbsent, computeIfPresent,
    merge, putIfAbsent, remove(key, value), replace, replaceAll, of, ofEntries |'
  id: totrans-9
  prefs: []
  type: TYPE_TB
  zh: '| Map | getOrDefault, forEach, compute, computeIfAbsent, computeIfPresent,
    merge, putIfAbsent, remove(key, value), replace, replaceAll, of, ofEntries |'
- en: '| Iterable | forEach, spliterator |'
  id: totrans-10
  prefs: []
  type: TYPE_TB
  zh: '| Iterable | forEach, spliterator |'
- en: '| Iterator | forEachRemaining |'
  id: totrans-11
  prefs: []
  type: TYPE_TB
  zh: '| Iterator | forEachRemaining |'
- en: '| Collection | removeIf, stream, parallelStream |'
  id: totrans-12
  prefs: []
  type: TYPE_TB
  zh: '| 集合 | removeIf, stream, parallelStream |'
- en: '| List | replaceAll, sort, of |'
  id: totrans-13
  prefs: []
  type: TYPE_TB
  zh: '| List | replaceAll, sort, of |'
- en: '| BitSet | stream |'
  id: totrans-14
  prefs: []
  type: TYPE_TB
  zh: '| BitSet | stream |'
- en: '| Set | of |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '| Set | of |'
- en: Map
  id: totrans-16
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 地图
- en: 'The `Map` interface is the most updated interface, with support for several
    new convenient methods. For example, the method `getOrDefault` can be used to
    replace an existing idiom that checks whether a `Map` contains a mapping for a
    given key. If not, you can provide a default value to return instead. Previously
    you would do this:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '`Map`接口是最新的接口，支持几个新的便捷方法。例如，可以使用`getOrDefault`方法来替换之前检查`Map`是否包含给定键映射的现有惯用语。如果没有，您可以提供一个默认值以返回。之前您会这样做：'
- en: '[PRE0]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'You can now more simply do the following:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在可以更简单地执行以下操作：
- en: '[PRE1]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Note that this works only if there’s no mapping. For example, if the key is
    explicitly mapped to the value `null`, then no default value will be returned.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，这仅在没有任何映射的情况下才有效。例如，如果键显式映射到值`null`，则不会返回任何默认值。
- en: 'Another particularly useful method is `computeIfAbsent`, which we briefly mentioned
    in [chapter 19](kindle_split_034.xhtml#ch19) when explaining memoization. It lets
    you conveniently use the caching pattern. Let’s say that you need to fetch and
    process data from a different website. In such a scenario, it’s useful to cache
    the data, so you don’t have to execute the (expensive) fetching operation multiple
    times:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个特别有用的方法是`computeIfAbsent`，我们在第19章（[kindle_split_034.xhtml#ch19]）中简要提到，当时解释了记忆化。它允许您方便地使用缓存模式。假设您需要从不同的网站获取和处理数据。在这种情况下，缓存数据很有用，这样您就不必多次执行（昂贵的）获取操作：
- en: '[PRE2]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '***1* Check if the data is already cached.**'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 检查数据是否已缓存。**'
- en: '***2* If not, fetch the data and then cache it in the Map for future use.**'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 如果不是，请获取数据，然后将其缓存到Map中以供将来使用。**'
- en: 'You can now write this code more concisely by using `computeIfAbsent` as follows:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在可以通过使用`computeIfAbsent`来更简洁地编写以下代码：
- en: '[PRE3]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: A description of all other methods can be found in the official Java API documentation
    ([http://docs.oracle.com/javase/8/docs/api/java/util/Map.html](http://docs.oracle.com/javase/8/docs/api/java/util/Map.html)).
    Note that `ConcurrentHashMap` was also updated with additional methods. We discuss
    them in [section B.2](#app02lev1sec2).
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 所有其他方法的描述可以在官方Java API文档中找到（[http://docs.oracle.com/javase/8/docs/api/java/util/Map.html](http://docs.oracle.com/javase/8/docs/api/java/util/Map.html)）。请注意，`ConcurrentHashMap`也更新了额外的功能。我们将在第B.2节中讨论它们。
- en: Collection
  id: totrans-29
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 集合
- en: The `removeIf` method can be used to remove all elements in a collection that
    match a predicate. Note that this is different than the `filter` method included
    in the `Streams` API. The `filter` method in the `Streams` API produces a new
    stream; it doesn’t mutate the current stream or source.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用`removeIf`方法来删除集合中所有匹配谓词的元素。请注意，这与`Streams` API中包含的`filter`方法不同。`Streams`
    API中的`filter`方法会产生一个新的流；它不会修改当前的流或源。
- en: List
  id: totrans-31
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表
- en: The `replaceAll` method replaces each element in a `List` with the result of
    applying a given operator to it. It’s similar to the `map` method in a stream,
    but it mutates the elements of the `List`. In contrast, the `map` method produces
    new elements.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '`replaceAll` 方法将 `List` 中的每个元素替换为应用给定运算符后的结果。它与流中的 `map` 方法类似，但它会修改 `List`
    的元素。相比之下，`map` 方法会产生新的元素。'
- en: 'For example, the following code will print [2, 4, 6, 8, 10] because the `List`
    is modified in place:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，以下代码将打印 `[2, 4, 6, 8, 10]`，因为 `List` 在原地被修改：
- en: '[PRE4]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '***1* Prints [2, 4, 6, 8, 10]**'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 打印 [2, 4, 6, 8, 10]**'
- en: B.1.2\. The Collections class
  id: totrans-36
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: B.1.2\. 集合类
- en: The `Collections` class has been around for a long time to operate on or return
    collections. It now includes additional methods to return unmodifiable, synchronized,
    checked, and empty `NavigableMap` and `NavigableSet`. In addition, it includes
    the method `checkedQueue`, which returns a view of `Queue` that’s extended with
    dynamic type checking.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '`Collections` 类已经存在很长时间，用于操作或返回集合。现在它包括额外的返回不可修改、同步、检查和空的 `NavigableMap` 和
    `NavigableSet` 的方法。此外，它还包括 `checkedQueue` 方法，该方法返回一个扩展了动态类型检查的 `Queue` 视图。'
- en: B.1.3\. Comparator
  id: totrans-38
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: B.1.3\. 比较器
- en: The `Comparator` interface now includes default and static methods. You used
    the `Comparator.comparing` static method in [chapter 3](kindle_split_013.xhtml#ch03)
    to return a `Comparator` object given a function that extracts the sorting key.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '`Comparator` 接口现在包括默认和静态方法。你曾在[第 3 章](kindle_split_013.xhtml#ch03)中使用 `Comparator.comparing`
    静态方法来返回一个 `Comparator` 对象，该对象由提取排序键的函数给出。'
- en: 'New instance methods include the following:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 新增实例方法包括以下内容：
- en: '`reversed`—Returns a `Comparator` with the reverse ordering of the current
    `Comparator`.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`reversed`——返回一个具有当前 `Comparator` 反向排序的 `Comparator`。'
- en: '`thenComparing`—Returns a `Comparator` that uses another `Comparator` when
    two objects are equal.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`thenComparing`——返回一个在两个对象相等时使用另一个 `Comparator` 的 `Comparator`。'
- en: '`thenComparingInt`, `thenComparingDouble`, `thenComparingLong`—Work like the
    `thenComparing` method, but take a function specialized for primitive types (respectively,
    `ToIntFunction`, `ToDoubleFunction`, and `ToLongFunction`).'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`thenComparingInt`、`thenComparingDouble`、`thenComparingLong`——与 `thenComparing`
    方法类似，但接受针对原始类型的专用函数（分别是 `ToIntFunction`、`ToDoubleFunction` 和 `ToLongFunction`）。'
- en: 'New static methods include these:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 新增静态方法包括以下内容：
- en: '`comparingInt`, `comparingDouble`, `comparingLong`—Work like the `comparing`
    method, but take a function specialized for primitive types (respectively `ToIntFunction`,
    `ToDoubleFunction`, and `ToLongFunction`).'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`comparingInt`、`comparingDouble`、`comparingLong`——与 `comparing` 方法类似，但接受针对原始类型的专用函数（分别是
    `ToIntFunction`、`ToDoubleFunction` 和 `ToLongFunction`）。'
- en: '`naturalOrder`—Returns a `Comparator` object that imposes a natural order on
    `Comparable` objects.'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`naturalOrder`——返回一个对 `Comparable` 对象施加自然排序的 `Comparator` 对象。'
- en: '`nullsFirst`, `nullsLast`—Return a `Comparator` object that considers `null`
    to be less than non-`null` or greater than non-`null`.'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`nullsFirst`、`nullsLast`——返回一个将 `null` 视为小于非 `null` 或大于非 `null` 的 `Comparator`
    对象。'
- en: '`reverseOrder—`Equivalent to `naturalOrder().reverse()`.'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`reverseOrder—` 等同于 `naturalOrder().reverse()`。'
- en: B.2\. Concurrency
  id: totrans-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.2\. 并发
- en: Java 8 brings several updates related to concurrency. The first is, of course,
    the introduction of parallel streams, which we explore in [chapter 7](kindle_split_018.xhtml#ch07).
    There’s also the introduction of the `CompletableFuture` class, which you can
    learn about in [chapter 16](kindle_split_030.xhtml#ch16).
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: Java 8 带来了与并发相关的几个更新。首先是当然的，并行流的引入，我们将在[第 7 章](kindle_split_018.xhtml#ch07)中探讨。还有
    `CompletableFuture` 类的引入，你可以在[第 16 章](kindle_split_030.xhtml#ch16)中了解它。
- en: There are other noticeable updates. For example, the `Arrays` class now supports
    parallel operations. We discuss these operations in [section B.3](#app02lev1sec3).
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 有其他值得注意的更新。例如，`Arrays` 类现在支持并行操作。我们将在[章节 B.3](#app02lev1sec3)中讨论这些操作。
- en: In this section, we look at updates in the `java.util.concurrent.atomic` package,
    which deals with atomic variables. In addition, we discuss updates to the `ConcurrentHashMap`
    class, which supports several new methods.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们查看 `java.util.concurrent.atomic` 包的更新，该包处理原子变量。此外，我们讨论 `ConcurrentHashMap`
    类的更新，它支持几个新方法。
- en: B.2.1\. Atomic
  id: totrans-53
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: B.2.1\. 原子操作
- en: 'The `java.util.concurrent.atomic` package offers several numeric classes, such
    as `AtomicInteger` and `AtomicLong` that support atomic operation on single variables.
    They were updated to support new methods:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '`java.util.concurrent.atomic` 包提供了几个数字类，例如 `AtomicInteger` 和 `AtomicLong`，它们支持对单个变量的原子操作。它们已更新以支持新的方法：'
- en: '`getAndUpdate`—Atomically updates the current value with the results of applying
    the given function, returning the previous value.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`getAndUpdate`—原子地使用给定的函数更新当前值，返回更新前的值。'
- en: '`updateAndGet`—Atomically updates the current value with the results of applying
    the given function, returning the updated value.'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`updateAndGet`—原子地使用给定的函数更新当前值，返回更新后的值。'
- en: '`getAndAccumulate`—Atomically updates the current value with the results of
    applying the given function to the current and given values, returning the previous
    value.'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`getAndAccumulate`—原子地使用给定的函数更新当前值，该函数应用于当前值和给定值，返回更新前的值。'
- en: '`accumulateAndGet`—Atomically updates the current value with the results of
    applying the given function to the current and given values, returning the updated
    value.'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`accumulateAndGet`—原子地使用给定的函数更新当前值，该函数应用于当前值和给定值，返回更新后的值。'
- en: 'Here’s how to atomically set the minimum between an observed value of 10 and
    an existing atomic integer:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是如何原子性地设置一个观察到的值为10和现有原子整数之间的最小值：
- en: '[PRE5]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Adders and accumulators
  id: totrans-61
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 加法器和累加器
- en: The Java API recommends using the new classes `LongAdder`, `LongAccumulator`,
    `DoubleAdder`, and `DoubleAccumulator` instead of the `Atomic` classes equivalent
    when multiple threads update frequently but read less frequently (for example,
    in the context of statistics). These classes are designed to grow dynamically
    to reduce thread contention.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: Java API建议在多个线程频繁更新但读取较少的情况下（例如，在统计学的上下文中）使用新的类`LongAdder`、`LongAccumulator`、`DoubleAdder`和`DoubleAccumulator`，而不是使用等效的`Atomic`类。这些类设计为动态增长以减少线程竞争。
- en: The classes `LongAdder` and `DoubleAdder` support operations for additions,
    whereas `LongAccumulator` and `DoubleAccumulator` are given a function to combine
    values. For example, to calculate the sum of several values, you can use a `LongAdder`
    as follows.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 类`LongAdder`和`DoubleAdder`支持加法操作，而`LongAccumulator`和`DoubleAccumulator`提供了一个组合值的函数。例如，要计算几个值的总和，可以使用以下方式`LongAdder`。
- en: Listing B.1\. `LongAdder` to calculate the sum of values
  id: totrans-64
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表B.1\. 使用`LongAdder`计算值的总和
- en: '[PRE6]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '***1* The initial sum value is set to 0 with the default constructor.**'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 使用默认构造函数将初始总和值设置为0。**'
- en: '***2* Do some addition in several different threads.**'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 在几个不同的线程中进行一些加法操作。**'
- en: '***3* Get the sum at some point.**'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 在某个点上获取总和。**'
- en: Or you can use a `LongAccumulator` as follows.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 或者你可以按照以下方式使用`LongAccumulator`。
- en: Listing B.2\. `LongAccumulator` to calculate the sum of values
  id: totrans-70
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表B.2\. 使用`LongAccumulator`计算值的总和
- en: '[PRE7]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '***1* Accumulate values in several different threads.**'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 在几个不同的线程中累积值。**'
- en: '***2* Get the result at some point.**'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 在某个点上获取结果。**'
- en: B.2.2\. ConcurrentHashMap
  id: totrans-74
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: B.2.2\. ConcurrentHashMap
- en: The `ConcurrentHashMap` class was introduced to provide a more modern `HashMap`,
    which is concurrent friendly. `ConcurrentHashMap` allows concurrent add and updates
    that lock only certain parts of the internal data structure. Thus, read and write
    operations have improved performance compared to the synchronized `Hashtable`
    alternative.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '`ConcurrentHashMap`类被引入以提供更现代的`HashMap`，它是线程安全的。`ConcurrentHashMap`允许并发添加和更新，但只锁定内部数据结构的一部分。因此，与同步的`Hashtable`替代品相比，读写操作的性能得到了提高。'
- en: Performance
  id: totrans-76
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 性能
- en: '`ConcurrentHashMap`’s internal structure was updated to improve performance.
    Entries of a map are typically stored in buckets accessed by the generated hashcode
    of the key. But if many keys return the same hashcode, performance will deteriorate
    because buckets are implemented as `List`s with O(*n*) retrieval. In Java 8, when
    the buckets become too big, they’re dynamically replaced with sorted trees, which
    have O(log(*n*)) retrieval. Note that this is possible only when the keys are
    `Comparable` (for example, `String` or `Number` classes).'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '`ConcurrentHashMap`的内部结构已更新以提高性能。映射的条目通常存储在通过键的生成哈希码访问的桶中。但如果许多键返回相同的哈希码，性能将下降，因为桶实现为具有O(*n*)检索的`List`。在Java
    8中，当桶变得太大时，它们会动态地替换为具有O(log(*n*))检索的有序树。请注意，这仅在键是`Comparable`（例如，`String`或`Number`类）时才可能。'
- en: Stream-like operations
  id: totrans-78
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 类似于流的操作
- en: '`ConcurrentHashMap` supports three new kinds of operations reminiscent of what
    you saw with streams:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '`ConcurrentHashMap`支持三种新的操作，这些操作让人联想到你在流中看到的内容：'
- en: '`forEach`—Performs a given action for each (key, value)'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`forEach`—对每个(key, value)执行给定的操作'
- en: '`reduce`—Combines all (key, value) given a reduction function into a result'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`reduce`—使用一个归约函数将所有给定的(key, value)组合成一个结果'
- en: '`search`—Applies a function on each (key, value) until the function produces
    a non-`null` result'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`search`—对每个（键，值）应用一个函数，直到函数产生一个非 `null` 结果'
- en: 'Each kind of operation supports four forms, accepting functions with keys,
    values, `Map.Entry`, and (key, value) arguments:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 每种操作支持四种形式，接受具有键、值、`Map.Entry` 和（键，值）参数的函数：
- en: Operates with keys and values (`forEach`, `reduce`, `search`)
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与键和值操作（`forEach`、`reduce`、`search`）
- en: Operates with keys (`forEachKey`, `reduceKey`, `searchKey`)
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与键操作（`forEachKey`、`reduceKey`、`searchKey`）
- en: Operates with values (`forEachValue`, `reduceValue`, `searchValues`)
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与值操作（`forEachValue`、`reduceValue`、`searchValues`）
- en: Operates with `Map.Entry` objects (`forEachEntry`, `reduceEntries`, `searchEntries`)
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与 `Map.Entry` 对象操作（`forEachEntry`、`reduceEntries`、`searchEntries`）
- en: Note that these operations don’t lock the state of the `ConcurrentHashMap`.
    They operate on the elements as they go along. The functions supplied to these
    operations shouldn’t depend on any ordering or on any other objects or values
    that may change while computation is in progress.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，这些操作不会锁定 `ConcurrentHashMap` 的状态。它们在操作过程中对元素进行操作。提供给这些操作的功能不应依赖于任何排序或任何可能在计算过程中改变的其他对象或值。
- en: In addition, you need to specify a parallelism threshold for all these operations.
    The operations will execute sequentially if the current `map` size is estimated
    to be less than the given threshold. Using a value of `1` enables maximal parallelism
    using the common thread pool. Using a value of `Long.MAX_VALUE` runs the operation
    on a single thread.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，您还需要为所有这些操作指定一个并行度阈值。如果当前 `map` 的大小估计小于给定的阈值，则操作将按顺序执行。使用 `1` 的值启用最大并行性，使用公共线程池。使用
    `Long.MAX_VALUE` 的值在单个线程上运行操作。
- en: 'In this example we use the method `reduceValues` to find the maximum value
    in the `map`:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，我们使用 `reduceValues` 方法在 `map` 中找到最大值：
- en: '[PRE8]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Note that there are primitive specializations for `int`, `long`, and `double`
    for each `reduce` operation (for example, `reduceValuesToInt`, `reduceKeysToLong`,
    and so on).
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，对于每个 `reduce` 操作，都有 `int`、`long` 和 `double` 的原始特化（例如，`reduceValuesToInt`、`reduceKeysToLong`
    等）。
- en: Counting
  id: totrans-93
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 计数
- en: The `ConcurrentHashMap` class provides a new method called `mappingCount`, which
    returns the number of mappings in the `map` as a `long`. It should be used instead
    of the method `size`, which returns an `int`. This is because the number of mappings
    may not fit in an `int`.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '`ConcurrentHashMap` 类提供了一个名为 `mappingCount` 的新方法，它以 `long` 返回 `map` 中的映射数量。它应该用于替代返回
    `int` 的方法 `size`。这是因为映射的数量可能不适合 `int`。'
- en: Set views
  id: totrans-95
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 集合视图
- en: The `ConcurrentHashMap` class provides a new method called `keySet` that returns
    a view of the `ConcurrentHashMap` as a `Set` (changes to the `map` are reflected
    in the `Set` and vice versa). You can also create a `Set` backed by a `ConcurrentHashMap`
    using the new static method `newKeySet`.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '`ConcurrentHashMap` 类提供了一个名为 `keySet` 的新方法，它返回 `ConcurrentHashMap` 作为 `Set`
    的视图（`map` 的更改反映在 `Set` 中，反之亦然）。您还可以使用新的静态方法 `newKeySet` 创建由 `ConcurrentHashMap`
    支持的 `Set`。'
- en: B.3\. Arrays
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.3\. Arrays
- en: The `Arrays` class provides various static methods to manipulate arrays. It
    now includes four new methods (which have primitive specialized overloaded variants).
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '`Arrays` 类提供了各种静态方法来操作数组。现在它包括四个新的方法（它们有原始特化的重载变体）。'
- en: B.3.1\. Using parallelSort
  id: totrans-99
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: B.3.1\. 使用 parallelSort
- en: The `parallelSort` method sorts the specified array in parallel, using a natural
    order, or using an extra `Comparator` for an array of objects.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: '`parallelSort` 方法以并行方式对指定的数组进行排序，使用自然顺序，或者使用额外的 `Comparator` 对对象数组进行排序。'
- en: B.3.2\. Using setAll and parallelSetAll
  id: totrans-101
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: B.3.2\. 使用 setAll 和 parallelSetAll
- en: The `setAll` and `parallelSetAll` methods set all elements of the specified
    array, respectively sequentially or in parallel, using the provided function to
    compute each element. The function receives the element index and returns a value
    for that index. Because `parallelSetAll` is executed in parallel, the function
    must be side-effect free, as explained in [chapters 7](kindle_split_018.xhtml#ch07)
    and [18](kindle_split_033.xhtml#ch18).
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '`setAll` 和 `parallelSetAll` 方法分别按顺序或并行地设置指定数组的所有元素，使用提供的函数计算每个元素。该函数接收元素索引并返回该索引的值。因为
    `parallelSetAll` 是并行执行的，所以该函数必须是无副作用的，如第 [7](kindle_split_018.xhtml#ch07) 章和 [18](kindle_split_033.xhtml#ch18)
    所述。'
- en: 'As an example, you can use the method `setAll` to produce an array with the
    values 0, 2, 4, 6, ...:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，您可以使用 `setAll` 方法生成包含值 0、2、4、6、... 的数组：
- en: '[PRE9]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: B.3.3\. Using parallelPrefix
  id: totrans-105
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: B.3.3\. 使用 parallelPrefix
- en: The `parallelPrefix` method cumulates, in parallel, each element of the given
    array, using the supplied binary operator. In the next listing you produce the
    values 1, 2, 3, 4, 5, 6, 7, ....
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: '`parallelPrefix`方法并行地累积给定数组中的每个元素，使用提供的二元运算符。在下一个列表中，您将生成1、2、3、4、5、6、7、...的值。'
- en: Listing B.3\. `parallelPrefix` cumulates in parallel elements of an array
  id: totrans-107
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表B.3. `parallelPrefix`并行累积数组元素
- en: '[PRE10]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '***1* ones is now [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]**'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* ones is now [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]**'
- en: B.4\. Number and Math
  id: totrans-110
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.4. 数字和数学
- en: The Java 8 API enhances the `Number` and `Math` classes with new methods.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: Java 8 API通过新方法增强了`Number`和`Math`类。
- en: B.4.1\. Number
  id: totrans-112
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: B.4.1. 数字
- en: 'The new methods of the `Number` class are as follows:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '`Number`类的新方法如下：'
- en: The `Short`, `Integer`, `Long`, `Float`, and `Double` classes include the `sum`,
    `min`, and `max` static methods. You saw these methods in conjunction with the
    `reduce` operation in [chapter 5](kindle_split_016.xhtml#ch05).
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Short`、`Integer`、`Long`、`Float`和`Double`类包含了`sum`、`min`和`max`静态方法。您在[第5章](kindle_split_016.xhtml#ch05)中与`reduce`操作一起看到了这些方法。'
- en: The `Integer` and `Long` classes include the methods `compareUnsigned`, `divide-Unsigned`,
    `remainderUnsigned`, and `toUnsignedString` to work with unsigned values.
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Integer`和`Long`类包括`compareUnsigned`、`divide-Unsigned`、`remainderUnsigned`和`toUnsignedString`方法，用于处理无符号值。'
- en: The `Integer` and `Long` classes also respectively include the static methods
    `parseUnsignedInt` and `parseUnsignedLong`, to parse strings as an unsigned `int`
    or `long`.
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Integer`和`Long`类分别包括静态方法`parseUnsignedInt`和`parseUnsignedLong`，用于将字符串解析为无符号的`int`或`long`。'
- en: The `Byte` and `Short` classes include the methods `toUnsignedInt` and `toUnsigned-Long`,
    to convert the argument to an `int` or `long` by an unsigned conversion. Similarly,
    the `Integer` class now includes the static method `toUnsignedLong`.
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Byte`和`Short`类包括`toUnsignedInt`和`toUnsigned-Long`方法，通过无符号转换将参数转换为`int`或`long`。同样，`Integer`类现在包括静态方法`toUnsignedLong`。'
- en: The `Double` and `Float` classes include the static method `isFinite`, to check
    whether the argument is a finite floating-point value.
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Double`和`Float`类包括静态方法`isFinite`，用于检查参数是否为有限的浮点值。'
- en: The `Boolean` class now includes the static methods `logicalAnd`, `logicalOr`,
    and `logicalXor`, to apply the `and`, `or`, and `xor` operations between two booleans.
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Boolean`类现在包括静态方法`logicalAnd`、`logicalOr`和`logicalXor`，用于在两个布尔值之间应用`and`、`or`和`xor`操作。'
- en: The `BigInteger` class includes the methods `byteValueExact`, `shortValueExact`,
    `intValueExact`, and `longValueExact`, to convert this `BigInteger` to the respective
    primitive type. But it throws an arithmetic exception if there’s a loss of information
    during the conversion.
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`BigInteger`类包括`byteValueExact`、`shortValueExact`、`intValueExact`和`longValueExact`方法，将这些`BigInteger`转换为相应的原始类型。但如果转换过程中信息丢失，它将抛出一个算术异常。'
- en: B.4.2\. Math
  id: totrans-121
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: B.4.2. 数学
- en: The `Math` class includes new methods that throw an arithmetic exception if
    the result of the operation overflows. These methods consist of `addExact`, `subtractExact`,
    `multiplyExact`, `incrementExact`, `decrementExact`, and `negateExact` with `int`
    and `long` arguments. In addition, there’s a static `toIntExact` method to convert
    a `long` value to an `int`. Other additions include the static methods `floorMod`,
    `floorDiv`, and `nextDown`.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '`Math`类包括在操作结果溢出时抛出算术异常的新方法。这些方法包括`addExact`、`subtractExact`、`multiplyExact`、`incrementExact`、`decrementExact`和`negateExact`，它们具有`int`和`long`参数。此外，还有一个静态的`toIntExact`方法，用于将`long`值转换为`int`。其他增加包括静态方法`floorMod`、`floorDiv`和`nextDown`。'
- en: B.5\. Files
  id: totrans-123
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.5. 文件
- en: 'Noticeable additions to the `Files` class let you produce a stream from files.
    We mention the new static method `Files.lines` in [chapter 5](kindle_split_016.xhtml#ch05);
    it lets you read a file lazily as a stream. Other useful static methods that return
    a stream include the following:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 对`Files`类的明显增加让您可以从文件生成流。我们在[第5章](kindle_split_016.xhtml#ch05)中提到了新的静态方法`Files.lines`；它允许您以流的形式惰性读取文件。其他返回流的实用静态方法包括以下内容：
- en: '`Files.list`—Produces a `Stream<Path>` consisting of entries in a given directory.
    The listing isn’t recursive. Because the stream is consumed lazily, it’s a useful
    method for processing potentially very large directories.'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Files.list`——生成一个包含给定目录条目的`Stream<Path>`。列表不是递归的。因为流是惰性消费的，所以这是一个处理可能非常大的目录的有用方法。'
- en: '`Files.walk`—Just like `Files.list`, it produces a `Stream<Path>` consisting
    of entries in a given directory. But the listing is recursive and the depth level
    can be configured. Note that the traversal is performed depth-first.'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Files.walk`—就像`Files.list`一样，它生成一个包含给定目录条目的`Stream<Path>`。但是列表是递归的，并且可以配置深度级别。请注意，遍历是按深度优先进行的。'
- en: '`Files.find`—Produces a `Stream<Path>` from recursively traversing a directory
    to find entries that match a given predicate.'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Files.find`—通过递归遍历目录以找到匹配给定谓词的条目，从而生成一个`Stream<Path>`。'
- en: B.6\. Reflection
  id: totrans-128
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.6\. 反射
- en: We discussed several changes to the annotation mechanism in Java 8 in [appendix
    A](kindle_split_037.xhtml#app01). The Reflection API was updated to support these
    changes.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在附录A中讨论了Java 8中注释机制的几个变化。[附录A](kindle_split_037.xhtml#app01)。反射API已更新以支持这些变化。
- en: Another addition to the Reflection API is that information about parameters
    of methods such as names and modifiers can now be accessed with the help of the
    new `java.lang.reflect.Parameter` class, which is referenced in the new `java.lang.reflect.Executable`
    class that serves as a shared superclass for the common functionality of `Method`
    and `Constructor`.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 反射API的另一个新增功能是，现在可以通过新的`java.lang.reflect.Parameter`类来访问方法参数的信息，如名称和修饰符，该类在新的`java.lang.reflect.Executable`类中被引用，该类作为`Method`和`Constructor`共同功能的一个共享超类。
- en: B.7\. String
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: B.7\. 字符串
- en: 'The `String` class now includes a convenient static method called `join` to—as
    you may guess—join strings with a delimiter! You can use it as follows:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '`String`类现在包含一个方便的静态方法`join`，正如你可能猜到的，它使用分隔符连接字符串！你可以如下使用它：'
- en: '[PRE11]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '***1* Raoul, Mario, Alan**'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 拉乌尔，马里奥，艾伦**'
