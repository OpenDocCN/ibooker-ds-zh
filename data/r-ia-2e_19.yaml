- en: 15 Time series
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 15 时间序列
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Creating a time series
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个时间序列
- en: Decomposing a time series into components
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将时间序列分解为组成部分
- en: Developing predictive models
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开发预测模型
- en: Forecasting future values
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预测未来的值
- en: How fast is global warming occurring, and what will the impact be in 10 years?
    With the exception of repeated measures ANOVA in section 9.6, each of the preceding
    chapters has focused on *cross-sectional* data. In a cross-sectional dataset,
    variables are measured at a single point in time. In contrast, *longitudinal*
    data involves measuring variables repeatedly over time. By following a phenomenon
    over time, it’s possible to learn a great deal about it.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 全球变暖的速度有多快，10年后会有什么影响？除了第9.6节中的重复测量方差分析外，前面各章都集中在 *横截面* 数据上。在横截面数据集中，变量是在一个时间点测量的。相比之下，*纵向*
    数据涉及在时间上反复测量变量。通过随时间跟踪一个现象，可以对其了解很多。
- en: In this chapter, we’ll examine observations that have been recorded at regularly
    spaced time intervals for a given span of time. We can arrange observations such
    as these into a *time series* of the form *Y*[1], *Y*[2], *Y*[3], ... , *Y[t]*,
    ..., *Y[T]*, where *Y[t]* represents the value of *Y* at time *t* and *T* is the
    total number of observations in the series.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将检查在一定时间段内以固定时间间隔记录的观察结果。我们可以将这些观察结果排列成一种形式为 *Y*[1]，*Y*[2]，*Y*[3]，...
    ，*Y[t]*，... ，*Y[T]* 的 *时间序列*，其中 *Y[t]* 表示在时间 *t* 时 *Y* 的值，而 *T* 是序列中观察的总数。
- en: 'Consider two very different time series displayed in figure 15.1\. The series
    on the left contains the quarterly earnings (dollars) per Johnson & Johnson share
    between 1960 and 1980\. There are 84 observations: 1 for each quarter over 21
    years. The series on the right describes the monthly mean relative sunspot numbers
    from 1749 to 1983 recorded by the Swiss Federal Observatory and the Tokyo Astronomical
    Observatory. The sunspots time series is much longer, with 2,820 observations—1
    per month for 235 years.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑两个在图15.1中显示的非常不同的时间序列。左侧的序列包含1960年至1980年间每季度强生公司股票的季度收益（美元）。共有84个观察值：21年中的每个季度都有一个。右侧的序列描述了从1749年到1983年由瑞士联邦天文台和东京天文台记录的每月平均相对太阳黑子数。太阳黑子时间序列要长得多，共有2,820个观察值——235年中的每月一个。
- en: '![](Images/CH15_F01_Kabacoff3.png)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH15_F01_Kabacoff3.png)'
- en: Figure 15.1 Time-series plots for (left) Johnson & Johnson quarterly earnings
    per share (in dollars) from 1960 to 1980, and (right) the monthly mean relative
    sunspot numbers recorded from 1749 to 1983
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.1 时间序列图：（左）1960年至1980年间强生公司每股季度收益（美元），（右）从1749年到1983年记录的每月平均相对太阳黑子数
- en: 'Studies of time-series data involve two fundamental questions: what happened
    (description), and what will happen next (forecasting)? For the Johnson & Johnson
    data, you might ask,'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列数据的研究涉及两个基本问题：发生了什么（描述），接下来会发生什么（预测）？对于强生公司的数据，你可能想知道，
- en: Is the price of Johnson & Johnson shares changing over time?
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 强生公司的股价随时间变化吗？
- en: Are there quarterly effects, with share prices rising and falling in a regular
    fashion throughout the year?
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存在季度效应吗？股价在一年中是否以规律的方式上升和下降？
- en: Can you forecast what future share prices will be and, if so, to what degree
    of accuracy?
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你能预测未来的股价，并且准确度如何？
- en: For the sunspot data, you might ask,
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 对于太阳黑子数据，你可能想知道，
- en: What statistical models best describe sunspot activity?
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哪些统计模型最能描述太阳黑子活动？
- en: Do some models fit the data better than others?
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哪些模型比其他模型更适合数据？
- en: Are the number of sunspots at a given time predictable, and, if so, to what
    degree?
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在特定时间点的太阳黑子数量是否可预测，如果是的话，准确度如何？
- en: The ability to accurately predict stock prices has relevance for my (hopefully)
    early retirement to a tropical island, whereas the ability to predict sunspot
    activity has relevance for my cell phone reception on said island.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 准确预测股价的能力对我的（希望是）早期退休到热带岛屿上是有相关性的，而预测太阳黑子活动的能力则与我在该岛屿上的手机信号接收有关。
- en: Predicting future values of a time series, or *forecasting*, is a fundamental
    human activity, and studies of time-series data have important real-world applications.
    Economists use time-series data to understand and predict changes in financial
    markets. City planners use time-series data to predict future transportation demands.
    Climate scientists use time-series data to study global climate change. Corporations
    use time series to predict product demand and future sales. Health-care officials
    use time-series data to study the spread of disease and to predict the number
    of future cases in a given region. Seismologists study times-series data to predict
    earthquakes. In each case, the study of historical time series is an indispensable
    part of the process. Because different approaches may work best with different
    types of time series, we’ll investigate many examples in this chapter.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 预测时间序列的未来值，或称为*预测*，是人类的一项基本活动，对时间序列数据的研究在现实世界中有着重要的应用。经济学家使用时间序列数据来理解和预测金融市场的变化。城市规划者使用时间序列数据来预测未来的交通需求。气候学家使用时间序列数据来研究全球气候变化。企业使用时间序列数据来预测产品需求和未来的销售。卫生官员使用时间序列数据来研究疾病的传播并预测特定地区未来病例的数量。地震学家研究时间序列数据来预测地震。在每种情况下，对历史时间序列的研究都是过程不可或缺的一部分。由于不同的方法可能对不同类型的时间序列效果最佳，因此在本章中我们将探讨许多例子。
- en: There is a wide range of methods for describing time-series data and forecasting
    future values. If you work with time-series data, you’ll find that R has some
    of the most comprehensive analytic capabilities available. This chapter explores
    some of the most common descriptive and forecasting approaches and the R functions
    used to perform them. Table 15.1 lists the time-series data that you’ll analyze.
    They’re available with the base installation of R. The datasets vary greatly in
    their characteristics and the models that fit them best.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 描述时间序列数据和预测未来值的方法有很多。如果你处理时间序列数据，你会发现R拥有一些最全面的分析能力。本章探讨了最常见的描述和预测方法以及用于执行它们的R函数。表15.1列出了你将分析的时间序列数据。它们包含在R的基础安装中。这些数据集在特征和最佳拟合模型方面差异很大。
- en: Table 15.1 Datasets used in this chapter
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 表15.1本章使用的数据集
- en: '| Time series | Description |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
  zh: '| 时间序列 | 描述 |'
- en: '| `AirPassengers` | Monthly airline passenger numbers from 1949–1960 |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| `AirPassengers` | 1949–1960年每月的航空公司乘客数量 |'
- en: '| `JohnsonJohnson` | Quarterly earnings per Johnson & Johnson share |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| `JohnsonJohnson` | 每季度强生公司每股收益 |'
- en: '| `nhtemp` | Average yearly temperatures in New Haven, Connecticut, from 1912–1971
    |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| `nhtemp` | 1912–1971年康涅狄格州纽黑文的平均年气温 |'
- en: '| `Nile` | Flow of the river Nile |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| `Nile` | 尼罗河的流量 |'
- en: '| `sunspots` | Monthly sunspot numbers from 1749–1983 |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| `sunspots` | 1749–1983年每月的太阳黑子数量 |'
- en: We’ll start with methods for creating and manipulating time series, describing
    and plotting them, and decomposing them into level, trend, seasonal, and irregular
    (error) components. Then we’ll turn to forecasting, starting with popular exponential
    modeling approaches that use weighted averages of time-series values to predict
    future values. Next, we’ll consider a set of forecasting techniques called *autoregressive
    integrated moving averages (ARIMA) models* that use correlations among recent
    data points and among recent prediction errors to make future forecasts. Throughout,
    we’ll consider methods of evaluating the fit of models and the accuracy of their
    predictions. The chapter ends with a description of resources for learning more
    about these topics.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从创建和操作时间序列、描述和绘制它们以及将它们分解为水平、趋势、季节性和不规则（误差）成分的方法开始。然后我们将转向预测，从使用时间序列值加权平均的流行指数建模方法开始，用于预测未来的值。接下来，我们将考虑一组称为*自回归积分移动平均（ARIMA）模型*的预测技术，这些技术使用最近数据点之间的相关性以及最近预测误差之间的相关性来做出未来的预测。在整个过程中，我们将考虑评估模型拟合度和预测准确性的方法。本章以对这些主题了解更多资源的描述结束。
- en: To reproduce the analyses in this chapter, be sure to install the `xts`, `forecast``,
    tseries`, and `directlabels` packages before continuing (`install.packages (c("xts",`
    `"forecast",` `"tseries",` `"directlabels")`).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 为了重现本章的分析，请确保在继续之前安装`xts`、`forecast`、`tseries`和`directlabels`包（`install.packages(c("xts",
    "forecast", "tseries", "directlabels"))`）。
- en: 15.1 Creating a time-series object in R
  id: totrans-31
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 15.1 在R中创建时间序列对象
- en: To work with a time series in R, you have to place it in a *time-series object*—an
    R structure that contains the observations and date specifications for the observations.
    Once the data is in a time-series object, you can use numerous functions to manipulate,
    model, and plot it.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 要在R中处理时间序列，你必须将其放置在 *时间序列对象* 中——这是一个包含观测值和观测值日期指定的R结构。一旦数据在时间序列对象中，你就可以使用众多函数来操作、建模和绘制它。
- en: R packages offer a variety of structures for holding time series (see the sidebar
    “Time-series objects in R”). In this chapter, we'll use the `xts` class offered
    by the `xts` package. It supports both regularly and irregularly spaced time series
    and has many functions for manipulating time-series data.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: R包提供了多种用于存储时间序列的结构（参见侧边栏“R中的时间序列对象”）。在本章中，我们将使用 `xts` 包提供的 `xts` 类。它支持规则和不规则时间序列，并具有许多用于操作时间序列数据的函数。
- en: Time-series objects in R
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: R中的时间序列对象
- en: It’s easy to get lost among the many objects R provides for holding time-series
    data. Base R comes with `ts` for holding a single time series with regularly spaced
    time intervals and `mts` for multiple time series with regularly spaced intervals.
    The `zoo` package offers a class that can hold time series with irregularly spaced
    intervals, and the `xts` package offers a superset of the `zoo` class with more
    supporting functions. Other popular formats include `tsibble`, `timeSeries`, `irts`,
    and `tis`. Luckily, the `tsbox` package provides functions to convert a data frame
    into any of these formats and can also convert one time-series format into another.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在R提供的众多用于存储时间序列数据的对象中容易迷失方向。基础R包含 `ts` 用于存储具有规则时间间隔的单个时间序列，以及 `mts` 用于具有规则间隔的多个时间序列。`zoo`
    包提供了一个可以存储不规则间隔时间序列的类，而 `xts` 包提供了一个包含更多支持函数的 `zoo` 类的超集。其他流行的格式包括 `tsibble`、`timeSeries`、`irts`
    和 `tis`。幸运的是，`tsbox` 包提供了将数据框转换为这些格式以及将一个时间序列格式转换为另一个格式的函数。
- en: To create an `xts` time series, you'll use
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建 `xts` 时间序列，你将使用
- en: '[PRE0]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: where *`data`* is a numeric vector at values and *`index`* is a date vector
    indicating when the values were observed. The following listing shows an example.
    The data consists of monthly sales figures for two years, starting in January
    2018.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *`data`* 是一个数值向量，*`index`* 是一个表示值观察时间的日期向量。以下列表显示了一个示例。数据包括从2018年1月开始的两年的月度销售额。
- en: Listing 15.1 Creating a time-series object
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.1 创建时间序列对象
- en: '[PRE1]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Time-series objects in `xts` format can be subset using bracket `[]` notation.
    For example, `sales.xts["2018"]` will return all data from 2018\. Specifying `sales.xts
    ["2018-3/2019-5"]` will return all data from March 2018 to May 2019.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '`xts` 格式的时间序列对象可以使用方括号 `[]` 表示法进行子集。例如，`sales.xts["2018"]` 将返回2018年所有的数据。指定
    `sales.xts ["2018-3/2019-5"]` 将返回从2018年3月到2019年5月所有的数据。'
- en: There are also `apply` functions designed to execute a function on each distinct
    period of a time-series object. They are particularly useful for aggregating a
    time series into larger time periods. The format is
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 还有一些 `apply` 函数旨在对时间序列对象的每个不同时间段执行函数。它们对于将时间序列聚合到更大的时间段特别有用。其格式为
- en: '[PRE2]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: where *`period`* can be `daily`, `weekly`, `monthly`, `quarterly`, or `yearly`,
    *`x`* is an `xts` time-series object, *`FUN`* is the function to be applied, and
    `...` are arguments passed to *`FUN`*.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *`period`* 可以是 `daily`、`weekly`、`monthly`、`quarterly` 或 `yearly`，*`x`* 是一个
    `xts` 时间序列对象，*`FUN`* 是要应用的函数，`...` 是传递给 *`FUN`* 的参数。
- en: For example, `quarterlies` `<-` `apply.quarterly(sales.xts,` `sum)` will return
    a time series with eight quarterly sales totals. The `sum` function could be replaced
    with `mean`, `median`, `min`, `max`, or any other function returning a single
    value.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，`quarterlies` `<-` `apply.quarterly(sales.xts,` `sum)` 将返回一个包含八个季度销售总额的时间序列。`sum`
    函数可以被替换为 `mean`、`median`、`min`、`max` 或任何返回单个值的函数。
- en: The `autoplot()` function in the `forecast` package can be used for plotting
    time-series data as `ggplot2` graphs. The following listing provides two examples.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '`forecast` 包中的 `autoplot()` 函数可用于将时间序列数据绘制为 `ggplot2` 图表。以下列表提供了两个示例。'
- en: Listing 15.2 Plotting time series
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.2 绘制时间序列
- en: '[PRE3]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: ❶ Default graph
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 默认图表
- en: ❷ Sets line color
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 设置线条颜色
- en: ❸ Specifies x-axis labels
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 指定x轴标签
- en: ❹ Adjusts theme
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 调整主题
- en: In the first example, the `autoplot()` function is used to create `ggplot2`
    graph ❶. Figure 15.2 shows the graph.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一个示例中，使用 `autoplot()` 函数创建 `ggplot2` 图 ❶。图15.2显示了该图表。
- en: '![](Images/CH15_F02_Kabacoff3.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F02_Kabacoff3.png)'
- en: Figure 15.2 Time-series plot for the sales data in listing 15.1\. This is the
    default format provided by the `autoplot()` function.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.2 列表15.1中销售数据的时序图。这是 `autoplot()` 函数提供的默认格式。
- en: In the second example, the plot is modified to make it more appealing. The line
    color is changed to blue ❷. The `scale_x_date()` function is used to provide better
    labels for the x-axis ❸. The `data_breaks` option specifies the distance between
    tick marks and takes on values like `"1` `day"`, `"2 weeks"`, `"5` `years",` or
    whatever is appropriate. The `date_labels` option specifies the format for the
    labels. Here `"%b` `%y"` specifies month (3 letters) and year (2 digits) with
    a space in between. See section 4.6 for a table of these codes. Finally, a black-and-white
    theme is chosen, the x-axis labels are rotated 90 degrees, and the vertical minor
    grid lines are suppressed ❹. Figure 15.3 displays the customized graph.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在第二个例子中，图表被修改以使其更具吸引力。线条颜色被改为蓝色 ❷。使用 `scale_x_date()` 函数为 x 轴提供更好的标签 ❸。`data_breaks`
    选项指定刻度标记之间的距离，可以取如 `"1 day"`、`"2 weeks"`、`"5 years"` 或适当的任何值。`date_labels` 选项指定标签的格式。在这里
    `"%b %y"` 指定月份（3个字母）和年份（2位数字），中间有空格。参见第4.6节中的这些代码表。最后，选择了一个黑白主题，x轴标签旋转90度，并抑制了垂直的次要网格线
    ❹。图15.3显示了定制的图表。
- en: '![](Images/CH15_F03_Kabacoff3.png)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F03_Kabacoff3.png)'
- en: Figure 15.3 Times-series plot for the sales data in listing 15.1\. The graph
    is customized with color, better labeling, and cleaner theme elements.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.3 列表15.1中销售数据的时序图。该图表通过颜色、更好的标签和更干净的主题元素进行了定制。
- en: The time-series examples that come with base R (table 15.1) are actually in
    `ts` format, but luckily, the functions introduced in this chapter can handle
    time series in either `ts` or `xts` format.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 基础R中附带的时间序列示例（表15.1）实际上是 `ts` 格式，但幸运的是，本章中介绍的功能可以处理 `ts` 或 `xts` 格式的时间序列。
- en: 15.2 Smoothing and seasonal decomposition
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 15.2 平滑和季节分解
- en: Just as analysts explore a dataset with descriptive statistics and graphs before
    attempting to model the data, describing a time series numerically and visually
    should be the first step before attempting to build complex models. In this section,
    we’ll look at smoothing a time series to clarify its general trend and decomposing
    a time series to observe any seasonal effects.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 就像分析师在尝试建模数据之前先使用描述性统计和图表来探索数据集一样，在尝试构建复杂模型之前，对时间序列进行数值和视觉描述应该是第一步。在本节中，我们将查看如何平滑时间序列以阐明其总体趋势，以及如何分解时间序列以观察任何季节性影响。
- en: 15.2.1 Smoothing with simple moving averages
  id: totrans-62
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.2.1 使用简单移动平均进行平滑
- en: The first step when investigating a time series is to plot it, as in listing
    15.1\. Consider the `Nile` time series. It records the annual flow of the river
    Nile at Aswan from 1871–1970\. A plot of the series can be seen in the upper-left
    panel of figure 15.4\. The time series appears to be decreasing, but there is
    a great deal of variation from year to year.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 调查时间序列的第一步是绘制它，如列表15.1所示。考虑`尼罗河`时间序列。它记录了从1871年到1970年尼罗河在阿斯旺的年流量。该序列的图可以在图15.4的左上角面板中看到。时间序列似乎在下降，但年与年之间的变化很大。
- en: Time series typically have a significant irregular or error component. To discern
    any patterns in the data, you’ll frequently want to plot a smoothed curve that
    damps down these fluctuations. One of the simplest methods of smoothing a time
    series is to use simple moving averages. For example, each data point can be replaced
    with the mean of that observation and one observation before and after it. This
    is called a *centered moving average*. A centered moving average is defined as
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列通常具有显著的不规则或误差成分。为了在数据中辨别任何模式，你通常会想要绘制一条平滑曲线来抑制这些波动。平滑时间序列的最简单方法之一是使用简单移动平均。例如，每个数据点可以用该观测值及其前后一个观测值的平均值来代替。这被称为**中心移动平均**。中心移动平均被定义为
- en: '*S[t]* = (*Y[t-q]* + ... + *Y[t]* + ... + *Y[t+q]*)/(2*q* + 1)'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '*S[t]* = (*Y[t-q]* + ... + *Y[t]* + ... + *Y[t+q]*)/(2*q* + 1)'
- en: where *S[t]* is the smoothed value at time *t* and *k* = 2*q* + 1 is the number
    of observations that are averaged. The *k* value is usually chosen to be an odd
    number (in this example, 3). By necessity, when using a centered moving average,
    you lose the (*k* – 1) / 2 observations at each end of the series.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *S[t]* 是时间 *t* 的平滑值，*k* = 2*q* + 1 是平均的观测数。*k* 值通常选择为奇数（在这个例子中，3）。在使用中心移动平均时，不可避免地会失去序列两端的
    (*k* – 1) / 2 个观测值。
- en: Several functions in R can provide a simple moving average, including `SMA``()`
    in the `TTR` package, `rollmean``()` in the `zoo` package, and `ma``()` in the
    `forecast` package. Here, you’ll use the `ma()` function to smooth the `Nile`
    time series that comes with the base R installation.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: R中有几个函数可以提供简单移动平均，包括`TTR`包中的`SMA()`，`zoo`包中的`rollmean()`，以及`forecast`包中的`ma()`。在这里，你将使用`ma()`函数来平滑随R基础安装一起提供的`Nile`时间序列。
- en: The code in the next listing plots the raw time series and smoothed versions
    using *k* equal to 3, 7, and 15\. Figure 15.3 shows the plots.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表中的代码使用 *k* 等于 3, 7 和 15 的值绘制了原始时间序列和平滑版本。图15.3显示了这些图表。
- en: Listing 15.3 Simple moving averages
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.3 简单移动平均
- en: '[PRE4]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: As *k* increases, the plot becomes increasingly smoothed. The challenge is to
    find the value of *k* that highlights the major patterns in the data without under-
    or over-smoothing. This is more art than science, and you’ll probably want to
    try several values of *k* before settling on one. From the plots in figure 15.4,
    there certainly appears to have been a drop in river flow between 1892 and 1900\.
    Other changes are open to interpretation. For example, there may have been a small
    increasing trend between 1941 and 1961, but this could also have been a random
    variation.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 随着 *k* 的增加，图表变得越来越平滑。挑战在于找到 *k* 的值，既能突出数据中的主要模式，又不会过度或不足平滑。这更多的是艺术而非科学，你可能会在确定一个值之前尝试几个
    *k* 的值。从图15.4的图表中，确实可以看出在1892年至1900年之间河流流量有所下降。其他变化则有待解释。例如，1941年至1961年之间可能存在一个小的上升趋势，但这也可能是随机变化。
- en: '![](Images/CH15_F04_Kabacoff3.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![图像](Images/CH15_F04_Kabacoff3.png)'
- en: Figure 15.4 The Nile time series measuring annual river flow at Aswan from 1871–1970
    (upper left). The other plots are smoothed versions using simple moving averages
    at three smoothing levels (*k* = 3, 7, and 15).
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.4 显示了从1871年至1970年在阿斯旺测量的尼罗河年流量时间序列（左上角）。其他图表是使用简单移动平均法在三个平滑级别（*k* = 3, 7,
    和 15）上的平滑版本。
- en: For time-series data with a periodicity greater than 1 (that is, with a seasonal
    component), you’ll want to go beyond a description of the overall trend. You can
    use seasonal decomposition to examine both seasonal and general trends.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 对于周期性大于1的时间序列数据（即具有季节性成分的数据），你将希望超越对整体趋势的描述。你可以使用季节分解来检查季节性和一般趋势。
- en: 15.2.2 Seasonal decomposition
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.2.2 季节分解
- en: Time-series data that have a seasonal aspect (such as monthly or quarterly data)
    can be decomposed into a trend component, a seasonal component, and an irregular
    component. The *trend component* captures changes in level over time. The *seasonal
    component* captures cyclical effects due to the time of year. The *irregular*
    (or *error*) *component* captures those influences not described by the trend
    and seasonal effects.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 具有季节性方面的时间序列数据（如月度或季度数据）可以分解为趋势成分、季节成分和不规则成分。*趋势成分* 捕捉随时间变化的水平变化。*季节成分* 捕捉由于年份时间而产生的周期性效应。*不规则*（或*误差*）*成分*
    捕捉趋势和季节性效应未描述的影响。
- en: The decomposition can be additive or multiplicative. In an additive model, the
    components sum to give the values of the time series. Specifically,
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 分解可以是加法或乘法。在加法模型中，各成分相加给出时间序列的值。具体来说，
- en: '*Y[t]* = Trend[t] + Seasonal[t] + Irregular[t]'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '*Y[t]* = 趋势[t] + 季节[t] + 不规则[t]'
- en: where the observation at time *t* is the sum of the contributions of the trend
    at time *t*, the seasonal effect at time *t*, and an irregular effect at time
    *t*.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 其中，时间 *t* 的观测值是时间 *t* 的趋势、时间 *t* 的季节性效应以及时间 *t* 的不规则效应的总和。
- en: In a multiplicative model, given by the equation
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在乘法模型中，由以下方程给出
- en: '*Y[t]* = Trend[t] × Seasonal[t] × Irregular[t]'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '*Y[t]* = 趋势[t] × 季节[t] × 不规则[t]'
- en: the trend, seasonal, and irregular influences are multiplied. Figure 15.5 shows
    examples.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 趋势、季节和不规则影响是相乘的。图15.5显示了示例。
- en: '![](Images/CH15_F05_Kabacoff3.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![图像](Images/CH15_F05_Kabacoff3.png)'
- en: Figure 15.5 Time-series examples consisting of different combinations of trend,
    seasonal, and irregular components
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.5 由不同组合的趋势、季节和不规则成分构成的时间序列示例
- en: 'In the first plot (a), there is neither a trend nor a seasonal component. The
    only influence is a random fluctuation around a given level. In the second plot
    (b), there is an upward trend over time as well as random fluctuations. In the
    third plot (c), there are seasonal effects and random fluctuations, but no overall
    trend away from a horizontal line. In the fourth plot (d), all three components
    are present: an upward trend, seasonal effects, and random fluctuations. You also
    see all three components in the final plot (e), but here, they combine in a multiplicative
    way. Notice how the variability is proportional to the level: as the level increases,
    so does the variability. This amplification (or possible damping) based on the
    current level of the series strongly suggests a multiplicative model.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一幅图（a）中，没有趋势或季节性成分，唯一的影响是围绕给定水平的随机波动。在第二幅图（b）中，随着时间的推移存在上升趋势以及随机波动。在第三幅图（c）中，存在季节性效应和随机波动，但没有整体趋势偏离水平线。在第四幅图（d）中，所有三个成分都存在：上升趋势、季节性效应和随机波动。在最后的图（e）中，也看到了所有三个成分，但在这里它们以乘性方式结合。注意变异性与水平成正比：随着水平的增加，变异性也增加。这种基于当前序列水平的放大（或可能的衰减）强烈表明存在乘性模型。
- en: An example may make the difference between additive and multiplicative models
    clearer. Consider a time series that records the monthly sales of motorcycles
    over a 10-year period. In a model with an additive seasonal effect, the number
    of motorcycles sold tends to increase by 500 in November and December (due to
    the Christmas rush) and decrease by 200 in January (when sales tend to slow down).
    The seasonal increase or decrease is independent of the current sales volume.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 一个例子可以使加性和乘性模型之间的区别更清晰。考虑一个记录了10年期间摩托车月度销售的时序。在具有加性季节效应的模型中，11月和12月摩托车销量通常会增加500辆（由于圣诞节购物热潮），而在1月（销量通常会放缓）会减少200辆。季节性增加或减少与当前销量无关。
- en: In a model with a multiplicative seasonal effect, motorcycle sales in November
    and December tend to increase by 20% and decrease in January by 10%. In the multiplicative
    case, the impact of the seasonal effect is proportional to the current sales volume,
    which isn’t the case in an additive model. In many instances, the multiplicative
    model is more realistic.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在具有乘性季节效应的模型中，11月和12月的摩托车销量通常会增加20%，而在1月会减少10%。在乘性情况下，季节效应的影响与当前销量成正比，这与加性模型不同。在许多情况下，乘性模型更符合实际情况。
- en: A popular method for decomposing a time series into trend, seasonal, and irregular
    components is seasonal decomposition by loess smoothing. In R, this can be accomplished
    with the `stl()` function. The format is
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 将时间序列分解为趋势、季节性和不规则成分的流行方法是使用局部加权回归的季节分解。在 R 中，可以使用 `stl()` 函数实现。其格式为
- en: '[PRE5]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: where *`ts`* is the time series to be decomposed, `s.window` controls how fast
    the seasonal effects can change over time, and `t.window` controls how fast the
    trend can change over time. Setting `s.window="periodic"` forces seasonal effects
    to be identical across years. Only the `ts` and `s.window` parameters are required.
    See `help(stl)` for details.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *`ts`* 是要分解的时间序列，`s.window` 控制季节效应随时间变化的快慢，`t.window` 控制趋势随时间变化的快慢。设置 `s.window="periodic"`
    强制季节效应在年份间保持一致。只需要 `ts` 和 `s.window` 参数。有关详细信息，请参阅 `help(stl)`。
- en: 'The `stl()` function can only handle additive models, but this isn''t a serious
    limitation. Multiplicative models can be transformed into additive models using
    a log transformation:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '`stl()` 函数只能处理加性模型，但这并不是一个严重的限制。通过对数变换可以将乘性模型转换为加性模型：'
- en: log(*Y[t]*) = log(Trend[t] × Seasonal[t] × Irregular[t])
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: log(*Y[t]*) = log(Trend[t] × Seasonal[t] × Irregular[t])
- en: = log(Trend[t]) + log(Seasonal[t]) + log(Irregular[t])
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: = log(Trend[t]) + log(Seasonal[t]) + log(Irregular[t])
- en: After fitting the additive model to the log-transformed series, the results
    can be back-transformed to the original scale. Let's look at an example.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 将加性模型拟合到对数变换后的序列后，结果可以回变换到原始尺度。让我们来看一个例子。
- en: The time series `AirPassengers` comes with a base R installation and describes
    the monthly totals (in thousands) of international airline passengers between
    1949 and 1960\. The top of figure 15.6 shows a plot of the data. From the graph,
    it appears that variability of the series increases with the level, suggesting
    a multiplicative model.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列 `AirPassengers` 随 R 的基本安装提供，描述了1949年至1960年之间每月国际航空公司乘客总数（以千为单位）。图15.6的顶部显示了数据的图表。从图中可以看出，序列的变异性随着水平的增加而增加，这表明存在乘性模型。
- en: The plot in the lower portion of figure 15.6 displays the time series created
    by taking the log of each observation. The variance has stabilized, and the logged
    series looks like an appropriate candidate for an additive decomposition. This
    is carried out using the `stl()` function listing 15.4.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.6下半部分的图显示了通过对每个观测值取对数创建的时间序列。方差已稳定，对数序列看起来是加性分解的合适候选。这是使用列表15.4中的 `stl()`
    函数完成的。
- en: '![](Images/CH15_F06_Kabacoff3.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F06_Kabacoff3.png)'
- en: Figure 15.6 Plot of the `AirPassengers` time series (top). The time series contains
    the monthly totals (in thousands) of international airline passengers between
    1949 and 1960\. The log-transformed time series (bottom) stabilizes the variance
    and fits an additive seasonal decomposition model better.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.6 `AirPassengers` 时间序列图（顶部）。该时间序列包含1949年至1960年之间每月的国际航空公司乘客总数（以千为单位）。对时间序列进行对数变换（底部）可以稳定方差，并更好地拟合加性季节分解模型。
- en: Listing 15.4 Seasonal decomposition using `stl()`
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.4 使用 `stl()` 进行季节分解
- en: '[PRE6]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: ❶ Plots the time series
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 绘制时间序列图
- en: ❷ Decomposes the time series
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 分解时间序列
- en: ❸ Components for each observation
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 每个观测值的成分
- en: First, the time series is plotted and transformed ❶. A seasonal decomposition
    is performed and saved in an object called `fit` ❷. Plotting the results gives
    the graph in figure 15.7, which shows the time series, seasonal, trend, and irregular
    components from 1949 to 1960\. Note that the seasonal components have been constrained
    to remain the same across each year (using the `s.window="period"` option). The
    trend is monotonically increasing, and the seasonal effect suggests more passengers
    in the summer (perhaps during vacations). The grey bars on the right are magnitude
    guides—each bar represents the same magnitude. This is useful because the y-axes
    are different for each graph.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，绘制并变换时间序列 ❶。执行季节分解并将其保存到名为 `fit` 的对象中 ❷。绘制结果给出图15.7中的图形，显示了1949年至1960年的时间序列、季节性、趋势和不规则成分。请注意，季节性成分已被约束为每年保持相同（使用
    `s.window="period"` 选项）。趋势是单调递增的，季节性效应表明夏季（可能是假期期间）的乘客更多。右侧的灰色条是幅度指南——每个条代表相同的幅度。这很有用，因为每个图形的y轴都不同。
- en: '![](Images/CH15_F07_Kabacoff3.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F07_Kabacoff3.png)'
- en: Figure 15.7 A seasonal decomposition of the logged `AirPassengers` time series
    using the `stl()` function. The time series (data) is decomposed into seasonal,
    trend, and irregular components.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.7 使用 `stl()` 函数对对数 `AirPassengers` 时间序列进行季节分解。时间序列（数据）被分解为季节性、趋势和不规则成分。
- en: The object returned by the `stl()` function includes a component called `time
    .series` that contains the trend, season, and irregular portion of each observation
    ❸. In this case, `fit$time.series` is based on the logged time series. `exp(fit$time
    .series)` converts the decomposition back to the original metric. Examining the
    seasonal effects suggests that the number of passengers increased by 24% in July
    (a multiplier of 1.24) and decreased by 20% in November (a multiplier of .80).
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '`stl()` 函数返回的对象包括一个名为 `time.series` 的组件，它包含每个观测值的趋势、季节和不规则部分 ❸。在这种情况下，`fit$time.series`
    基于对数时间序列。`exp(fit$time .series)` 将分解转换回原始度量。检查季节性效应表明，7月份（乘数为1.24）的乘客数量增加了24%，而在11月份（乘数为0.80）的乘客数量减少了20%。'
- en: The `forecast` package provides additional tools for visualizing the seasonal
    decomposition. The following listing demonstrates the creation of a month plot
    and seasonal plot.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '`forecast` 包提供了用于可视化季节分解的额外工具。以下列表展示了创建月度图和季节性图的示例。'
- en: Listing 15.5 Month and season plots
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.5 月度和季节性图
- en: '[PRE7]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: ❶ Month plot
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 月度图
- en: ❷ Season plot
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 季节性图
- en: '![](Images/CH15_F08_Kabacoff3.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F08_Kabacoff3.png)'
- en: Figure 15.8 A month plot of `AirPassengers` time series. The month plot displays
    the subseries for each month (all January values from 1949 to 1960 connected,
    all February values connected, and so on), along with the average of each subseries.
    There is a uniform increasing trend for each month, and the most passengers tend
    to fly in July and August.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.8 `AirPassengers` 时间序列的月度图。月度图显示了每个月的子序列（1949年至1960年所有1月份的值连接，所有2月份的值连接，依此类推），以及每个子序列的平均值。每个月都有一个均匀递增的趋势，乘客最倾向于在7月和8月出行。
- en: The month plot (figure 15.8) displays the subseries for each month (all January
    values connected, all February values connected, and so on), along with the average
    of each subseries. From this graph, it appears that the trend is increasing for
    each month in a roughly uniform way. Additionally, the greatest number of passengers
    occurs in July and August.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 月度图（图15.8）显示了每个月的子序列（所有1月份的值相连，所有2月份的值相连，依此类推），以及每个子序列的平均值。从这张图中可以看出，趋势在每个月都以大致均匀的方式增加。此外，7月和8月是乘客数量最多的月份。
- en: The season plot (figure 15.9) displays the subseries by year. Again, you see
    a similar pattern, with increases in passengers each year and the same seasonal
    pattern. By default, the `ggplot2` package would create a legend for the year
    variable. The `directlabels` package is used to place the year labels directly
    on the graph, next to each line in the time series.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 季节图（图15.9）显示了按年份划分的子序列。再次，你看到相似的图案，每年乘客数量都在增加，并且具有相同的季节性模式。默认情况下，`ggplot2`包会为年份变量创建图例。`directlabels`包用于将年份标签直接放置在图表上，紧邻时间序列中的每条线。
- en: '![](Images/CH15_F09_Kabacoff3.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F09_Kabacoff3.png)'
- en: Figure 15.9 A season plot (bottom) for the `AirPassengers` time series. Each
    shows an increasing trend and similar seasonal pattern year to year.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.9 `AirPassengers`时间序列的季节图（底部）。每个图都显示了一个逐年增加的趋势和相似的季节性模式。
- en: Note that although you’ve described the time series, you haven’t predicted any
    future values. In the next section, we’ll consider the use of exponential models
    for forecasting beyond the available data.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，尽管你已经描述了时间序列，但你并没有预测任何未来的值。在下一节中，我们将考虑使用指数模型来预测超出可用数据的情况。
- en: 15.3 Exponential forecasting models
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 15.3 指数预测模型
- en: Exponential models are some of the most popular approaches to forecasting the
    future values of a time series. They’re simpler than many other types of models,
    but they can yield good short-term predictions in a wide range of applications.
    They differ from each other in the components of the time series that are modeled.
    A simple exponential model (also called a *single exponential model*) fits a time
    series that has a constant level and an irregular component at time *i*, but has
    neither a trend nor a seasonal component. A *double exponential model* (also called
    a *Holt exponential smoothing*) fits a time series with both a level and a trend.
    Finally, a *triple exponential model* (also called a *Holt–Winters exponential
    smoothing*) fits a time series with level, trend, and seasonal components.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 指数模型是预测时间序列未来值的最流行方法之一。它们比许多其他类型的模型更简单，但它们可以在广泛的领域中提供良好的短期预测。它们在模型的时间序列组件上有所不同。一个简单的指数模型（也称为*单指数模型*）拟合一个在时间*i*处具有恒定水平和不规则成分的时间序列，但没有趋势或季节成分。一个*双指数模型*（也称为*霍尔特指数平滑*）拟合一个具有水平和趋势的时间序列。最后，一个*三指数模型*（也称为*霍尔特-温特斯指数平滑*）拟合一个具有水平、趋势和季节成分的时间序列。
- en: Exponential models can be fit with the `ets()` function that comes with the
    `forecast` package. The format of the `ets()` function is
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 指数模型可以使用`forecast`包中提供的`ets()`函数进行拟合。`ets()`函数的格式为
- en: '[PRE8]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: where *`ts`* is a time series and the `model` is specified by three letters.
    The first letter denotes the error type, the second letter denotes the trend type,
    and the third letter denotes the seasonal type. Allowable letters are *A* for
    additive, *M* for multiplicative, *N* for none, and *Z* for automatically selected.
    Table 15.2 shows examples of common models.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 其中*`ts`*是一个时间序列，`model`由三个字母指定。第一个字母表示误差类型，第二个字母表示趋势类型，第三个字母表示季节类型。允许的字母是*A*表示加法，*M*表示乘法，*N*表示无，*Z*表示自动选择。表15.2显示了常见模型的示例。
- en: Table 15.2 Functions for fitting simple, double, and triple exponential forecasting
    models
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 表15.2 简单、双指数和三指数预测模型拟合函数
- en: '| Type | Parameters fit | Functions |'
  id: totrans-126
  prefs: []
  type: TYPE_TB
  zh: '| 类型 | 参数拟合 | 函数 |'
- en: '| `simple` | `level` | `ets(ts, model="ANN")``ses(ts)` |'
  id: totrans-127
  prefs: []
  type: TYPE_TB
  zh: '| `simple` | `level` | `ets(ts, model="ANN")` `ses(ts)` |'
- en: '| `double` | `level`, `slope` | `ets(ts, model="AAN")``holt(ts)` |'
  id: totrans-128
  prefs: []
  type: TYPE_TB
  zh: '| `double` | `level`, `slope` | `ets(ts, model="AAN")` `holt(ts)` |'
- en: '| `triple` | `level`, `slope`, `seasonal` | `ets(ts, model="AAA")``hw(ts)`
    |'
  id: totrans-129
  prefs: []
  type: TYPE_TB
  zh: '| `triple` | `level`, `slope`, `seasonal` | `ets(ts, model="AAA")` `hw(ts)`
    |'
- en: 'The `ses``()`, `holt``()`, and `hw()` functions are convenience wrappers to
    the `ets()` function with prespecified defaults. First, we’ll look at the most
    basic exponential model: simple exponential smoothing.'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '`ses()`、`holt()`和`hw()`函数是针对`ets()`函数的便利包装，具有预定义的默认值。首先，我们将查看最基本指数模型：简单指数平滑。'
- en: 15.3.1 Simple exponential smoothing
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.3.1 简单指数平滑
- en: Simple exponential smoothing uses a weighted average of existing time-series
    values to make a short-term prediction of future values. The weights are chosen
    so that observations have an exponentially decreasing impact on the average as
    you go back in time.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 简单指数平滑使用现有时间序列值的加权平均来对未来的短期值进行预测。权重选择使得随着时间的推移，观测值对平均值的指数衰减影响。
- en: The simple exponential smoothing model assumes that an observation in the time
    series can be described by
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 简单指数平滑模型假设时间序列中的观测值可以描述为
- en: '*Y[t]* = level + irregular[t]'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '*Y[t]* = 水平 + 不规则[t]'
- en: The prediction at time *Y[t]*[+1] (called the *1-step-ahead forecast*) is written
    as
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 时间 *Y[t]*[+1] 的预测（称为 *1步预测*）表示为
- en: '*Y[t]*[+1] = *c*[0]*Y[t]* + *c*[1]*Y[t]*[−1] + *c*[2]*Y[t]*[−2] + ...'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '*Y[t]*[+1] = *c*[0]*Y[t]* + *c*[1]*Y[t]*[−1] + *c*[2]*Y[t]*[−2] + ...'
- en: where *c[i]* = *α*(1−*α*)^i, *t* = 0,1,2, ... and 0 ≤ *α* ≤ 1. The *c[i]* weights
    sum to one, and the 1-step-ahead forecast can be seen to be a weighted average
    of the current value and all past values of the time series. The alpha (*α*) parameter
    controls the rate of decay for the weights. The closer alpha is to 1, the more
    weight is given to recent observations. The closer alpha is to 0, the more weight
    is given to past observations. The actual value of alpha is usually chosen by
    computer to optimize a fit criterion. A common fit criterion is the sum of squared
    errors between the actual and predicted values. An example will help clarify these
    ideas.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *c[i]* = *α*(1−*α*)^i, *t* = 0,1,2, ... 且 0 ≤ *α* ≤ 1。*c[i]* 权重之和为1，一步预测可以看作是当前值和所有过去时间序列值的加权平均。alpha
    (*α*) 参数控制权重的衰减速率。alpha 越接近1，近期观测值的权重就越大。alpha 越接近0，过去观测值的权重就越大。alpha 的实际值通常由计算机选择以优化拟合标准。一个常见的拟合标准是实际值和预测值之间平方误差的和。以下示例将有助于阐明这些概念。
- en: The `nhtemp` time series contains the mean annual temperature in degrees Fahrenheit
    in New Haven, Connecticut, from 1912 to 1971\. Figure 15.10 shows a plot of the
    time series as a line.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '`nhtemp` 时间序列包含康涅狄格州纽黑文从1912年到1971年的平均年气温（华氏度）。图15.10显示了时间序列的线形图。'
- en: There is no obvious trend, and the yearly data lack a seasonal component, so
    the simple exponential model is a reasonable place to start. The code for making
    a 1-step-ahead forecast using the `ses()` function is given in the following listing.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 没有明显的趋势，并且年度数据缺乏季节成分，因此简单指数模型是一个合理的起点。使用 `ses()` 函数进行一步预测的代码如下所示。
- en: Listing 15.6 Simple exponential smoothing
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.6 简单指数平滑
- en: '[PRE9]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: ❶ Fits the model
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 符合模型
- en: ❷ 1-step-ahead forecast
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 一步预测
- en: ❸ Prints accuracy measures
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 打印准确度指标
- en: The `ets(mode="ANN")` statement fits the simple exponential model to the `nhtemp`
    time series ❶. The `A` indicates that the errors are additive, and the `NN` indicates
    that there is no trend and no seasonal component. The relatively low value of
    alpha (0.18) indicates that distant as well as recent observations are being considered
    in the forecast. This value is automatically chosen to maximize the fit of the
    model to the given dataset.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: '`ets(mode="ANN")` 语句将简单指数模型拟合到 `nhtemp` 时间序列 ❶。`A` 表示误差是可加的，而 `NN` 表示没有趋势和季节成分。alpha（0.18）的相对较低值表明在预测中考虑了远期和近期观测值。此值自动选择以最大化模型与给定数据集的拟合度。'
- en: The `forecast()` function is used to predict the time series *k* steps into
    the future. The format is `forecast(``fit,` *`k`*`)`. The 1-step-ahead forecast
    for this series is 51.9°F with a 95% confidence interval (49.6°F to 54.1°F) ❷.
    Figure 15.10 shows plots of the time series, the forecast value, and the 80% and
    95% confidence intervals.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `forecast()` 函数来预测时间序列 *k* 步的未来值。格式为 `forecast(``fit,` *`k`*`)`。此系列的一步预测为
    51.9°F，95% 置信区间为 (49.6°F 至 54.1°F) ❷。图15.10显示了时间序列、预测值以及80%和95%置信区间的图示。
- en: '![](Images/CH15_F10_Kabacoff3.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F10_Kabacoff3.png)'
- en: Figure 15.10 Average yearly temperatures in New Haven, Connecticut and a 1-step-ahead
    prediction from a simple exponential forecast using the `ets()` function
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.10 康涅狄格州纽黑文的平均年气温以及使用 `ets()` 函数进行的一步预测
- en: The `forecast` package also provides an `accuracy()` function that displays
    the most popular predictive accuracy measures for time-series forecasts ❸. Table
    15.3 describes each one. The *e*[t] represents the error or irregular component
    of each observation (*Y[i]* − *Ŷ[i]*).
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '`forecast` 包还提供了一个 `accuracy()` 函数，该函数显示时间序列预测中最常用的预测准确度指标 ❸。表 15.3 描述了每一个。*e*[t]
    代表每个观察值（*Y[i]* − *Ŷ[i]*）的错误或不规则成分。'
- en: Table 15.3 Predictive accuracy measures
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 表 15.3 预测准确度指标
- en: '| Measure | Abbreviation | Definition |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '| 指标 | 缩写 | 定义 |'
- en: '| Mean error | ME | mean(*e[t]*) |'
  id: totrans-152
  prefs: []
  type: TYPE_TB
  zh: '| 平均误差 | ME | mean(*e[t]*) |'
- en: '| Root mean squared error | RMSE | sqrt(mean(*e[t]*²)) |'
  id: totrans-153
  prefs: []
  type: TYPE_TB
  zh: '| 均方根误差 | RMSE | sqrt(mean(*e[t]*²)) |'
- en: '| Mean absolute error | MAE | mean(&#124;*e[t]*&#124;) |'
  id: totrans-154
  prefs: []
  type: TYPE_TB
  zh: '| 平均绝对误差 | MAE | mean(&#124;*e[t]*&#124;) |'
- en: '| Mean percentage error | MPE | mean(100 × *e[t]* / *Y[t]*) |'
  id: totrans-155
  prefs: []
  type: TYPE_TB
  zh: '| 平均百分比误差 | MPE | mean(100 × *e[t]* / *Y[t]*) |'
- en: '| Mean absolute percentage error | MAPE | mean(&#124;100 × *e[t]* / *Y[t]*&#124;)
    |'
  id: totrans-156
  prefs: []
  type: TYPE_TB
  zh: '| 平均绝对百分比误差 | MAPE | mean(&#124;100 × *e[t]* / *Y[t]*&#124;) |'
- en: '| Mean absolute scaled error | MASE | mean(&#124;*q[t]*&#124;) where *q[t]*
    = *e[t]* / (1/(*T*–1) * sum(&#124;*y[t]* – *y[t]*[–1]&#124;)), *T* is the number
    of observations, and the sum goes from *t* = 2 to *t = T* |'
  id: totrans-157
  prefs: []
  type: TYPE_TB
  zh: '| 平均绝对缩放误差 | MASE | mean(&#124;*q[t]*&#124;) 其中 *q[t]* = *e[t]* / (1/(*T*–1)
    * sum(&#124;*y[t]* – *y[t]*[–1]&#124;))，*T* 是观察数量，求和从 *t* = 2 到 *t = T* |'
- en: The mean error and mean percentage error may not be that useful because positive
    and negative errors can cancel out. The RMSE gives the square root of the mean
    square error, which in this case is 1.13°F. The mean absolute percentage error
    reports the error as a percentage of the time-series values. It’s unitless and
    can be used to compare prediction accuracy across time series. But it assumes
    a measurement scale with a true zero point (for example, number of passengers
    per day). Because the Fahrenheit scale has no true zero, you can’t use it here.
    The mean absolute scaled error is the most recent accuracy measure and is used
    to compare the forecast accuracy across time series on different scales. There
    is no one best measure of predictive accuracy. The RMSE is certainly the best
    known and most often cited.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '平均误差和平均百分比误差可能不是很有用，因为正负误差可能会相互抵消。RMSE 给出平均平方误差的平方根，在这种情况下是 1.13°F。平均绝对百分比误差将误差报告为时间序列值的百分比。它是无单位的，可以用于比较不同时间序列的预测准确度。但它假设有一个具有真实零点的测量尺度（例如，每天乘客数量）。因为华氏尺度没有真实零点，所以在这里不能使用。平均绝对缩放误差是最新的准确度指标，用于比较不同尺度上时间序列的预测准确度。没有一种预测准确度的最佳度量。RMSE
    无疑是最为人所知且最常引用的。 '
- en: Simple exponential smoothing assumes the absence of trend or seasonal components.
    The next section considers exponential models that can accommodate both.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 简单指数平滑假设不存在趋势或季节性成分。下一节将考虑可以同时容纳这两种成分的指数模型。
- en: 15.3.2 Holt and Holt–Winters exponential smoothing
  id: totrans-160
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.3.2 Holt 和 Holt–Winters 指数平滑
- en: The Holt exponential smoothing approach can fit a time series that has an overall
    level and a trend (slope). The model for an observation at time *t* is
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: Holt 指数平滑方法可以拟合具有总体水平和趋势（斜率）的时间序列。时间 *t* 的观测值模型为
- en: '*Y[t]* = level + slope × *t* + irregular[t]'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '*Y[t]* = 水平 + 斜率 × *t* + 不规则[t]'
- en: An alpha smoothing parameter controls the exponential decay for the level, and
    a beta smoothing parameter controls the exponential decay for the slope. Again,
    each parameter ranges from 0 to 1, with larger values giving more weight to recent
    observations.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 一个 alpha 平滑参数控制水平的指数衰减，一个 beta 平滑参数控制斜率的指数衰减。同样，每个参数的范围从 0 到 1，较大的值在计算季节性效应时给予近期观察更大的权重。
- en: The Holt–Winters exponential smoothing approach can be used to fit a time series
    that has an overall level, a trend, and a seasonal component. Here, the model
    is
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: Holt–Winters 指数平滑方法可用于拟合具有总体水平、趋势和季节性成分的时间序列。在这里，模型是
- en: '*Y[t]* = level + slope × *t* + *s[t]* + irregular[t]'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '*Y[t]* = 水平 + 斜率 × *t* + *s[t]* + 不规则[t]'
- en: where *s[t]* represents the seasonal influence at time *t*. In addition to alpha
    and beta parameters, a gamma smoothing parameter controls the exponential decay
    of the seasonal component. Like the others, it ranges from 0 to 1, and larger
    values give more weight to recent observations in calculating the seasonal effect.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *s[t]* 表示时间 *t* 的季节性影响。除了 alpha 和 beta 参数外，一个 gamma 平滑参数控制季节性成分的指数衰减。与其他参数一样，它介于
    0 到 1 之间，较大的值在计算季节性效应时给予近期观察更大的权重。
- en: In section 15.2, you decomposed a time series describing the monthly totals
    (in log thousands) of international airline passengers into additive trend, seasonal,
    and irregular components. Let’s use an exponential model to predict future travel.
    Again, you’ll use log values so that an additive model fits the data. The code
    in the following listing applies the Holt–Winters exponential smoothing approach
    to predicting the next five values of the `AirPassengers` time series.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 在第15.2节中，您将描述国际航空公司每月总客流量（以对数千为单位）的时间序列分解为加法趋势、季节性和不规则成分。让我们使用指数模型来预测未来的旅行。同样，您将使用对数值，以便加法模型适合数据。以下列表中的代码应用了Holt-Winters指数平滑方法来预测`AirPassengers`时间序列的下一个五个值。
- en: Listing 15.7 Exponential smoothing with level, slope, and seasonal components
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.7具有水平、斜率和季节性成分的指数平滑
- en: '[PRE10]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: ❶ Smoothing parameters
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 平滑参数
- en: ❷ Future forecasts
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 未来预测
- en: ❸ Makes forecasts in the original scale
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 在原始尺度上进行预测
- en: The smoothing parameters for the level (.70), trend (.0004), and seasonal components
    (.003) are given in ❶. The low value for the trend (.0001) doesn’t mean there
    is no slope; it indicates that the slope estimated from early observations didn’t
    need to be updated.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 水平（.70）、趋势（.0004）和季节性成分（.003）的平滑参数在❶中给出。趋势的值较低（.0001）并不意味着没有斜率；它表示从早期观察中估计的斜率不需要更新。
- en: 'The `forecast()` function produces forecasts for the next five months ❷ and
    is plotted in figure 15.11\. Because the predictions are on a log scale, exponentiation
    is used to get the predictions in the original metric: numbers (in thousands)
    of passengers ❸. The matrix `pred$mean` contains the point forecasts, and the
    matrices `pred$lower` and `pred$upper` contain the 80% and 95% lower and upper
    confidence limits, respectively. The `exp()` function is used to return the predictions
    to the original scale, and `cbind()` creates a single table. Thus, the model predicts
    509,200 passengers in March, with a 95% confidence band ranging from 454,900 to
    570,000.'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '`forecast()`函数为未来五个月生成预测❷，并在图15.11中绘制。由于预测是在对数尺度上，因此使用指数运算来获得原始度量的预测：乘客数量（以千为单位）❸。矩阵`pred$mean`包含点预测，矩阵`pred$lower`和`pred$upper`分别包含80%和95%的置信下限和上限。使用`exp()`函数将预测返回到原始尺度，并使用`cbind()`创建单个表。因此，模型预测3月将有509,200名乘客，95%置信区间为454,900至570,000。'
- en: '![](Images/CH15_F11_Kabacoff3.png)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![图像](Images/CH15_F11_Kabacoff3.png)'
- en: Figure 15.11 Five-year forecast of log(number of international airline passengers
    in thousands) based on a Holt-Winters exponential smoothing model. The data is
    from the `AirPassengers` time series.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.11基于Holt-Winters指数平滑模型的五年预测，预测的是以千为单位的国际航空公司乘客数量的对数。数据来自`AirPassengers`时间序列。
- en: 15.3.3 The ets() function and automated forecasting
  id: totrans-177
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.3.3 `ets()`函数和自动预测
- en: The `ets()` function has additional capabilities. You can use it to fit exponential
    models that have multiplicative components, add a dampening component, and perform
    automated forecasts. Let’s consider each in turn.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '`ets()`函数具有额外的功能。您可以使用它来拟合具有乘法成分的指数模型，添加阻尼成分，并执行自动预测。让我们逐一考虑这些功能。'
- en: In the previous section, you fit an additive exponential model to the log of
    the `AirPassengers` time series. Alternatively, you could fit a multiplicative
    model to the original data. The function call would be `ets(AirPassengers,` `model="MAM")`.
    The trend remains additive, but the seasonal and irregular components are assumed
    to be multiplicative. By using a multiplicative model in this case, the accuracy
    statistics and forecasted values are reported in the original metric (thousands
    of passengers)—a decided advantage.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一节中，您将加法指数模型拟合到`AirPassengers`时间序列的对数。作为替代，您也可以将乘法模型拟合到原始数据。函数调用将是`ets(AirPassengers,
    model="MAM")`。趋势仍然是加法的，但季节性和不规则成分被假定为乘法的。在这种情况下使用乘法模型，准确性统计和预测值将报告在原始度量（千名乘客）上——这是一个明显的优势。
- en: The `ets()` function can also fit a damping component. Time-series predictions
    often assume that a trend will continue up forever (housing market, anyone?).
    A damping component forces the trend to a horizontal asymptote over a period of
    time. In many cases, a damped model makes more realistic predictions.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '`ets()`函数还可以拟合阻尼成分。时间序列预测通常假设趋势将永远持续下去（比如房地产市场，对吗？）。阻尼成分会迫使趋势在一段时间内达到水平渐近线。在许多情况下，阻尼模型能做出更现实的预测。'
- en: Finally, you can invoke the `ets()` function to automatically select a best-fitting
    model for the data. Let’s fit an automated exponential model to the Johnson &
    Johnson data described in the introduction to this chapter. The code in the following
    listing allows the software to select a best-fitting model.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你可以调用`ets()`函数来自动选择最适合数据的模型。让我们将自动指数模型拟合到本章引言中描述的强生公司数据。以下列表中的代码允许软件选择一个最佳拟合模型。
- en: Listing 15.8 Automatic exponential forecasting with `ets()`
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.8 使用`ets()`函数进行自动指数预测
- en: '[PRE11]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Because no model is specified, the software performs a search over a wide array
    of models to find one that minimizes the fit criterion (log-likelihood by default).
    The selected model has multiplicative trend, seasonal, and error components. Figure
    15.12 gives the plot, along with forecasts for the next eight quarters (the default
    in this case).
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 因为没有指定模型，软件将在广泛的模型中进行搜索，以找到最小化拟合标准（默认为对数似然）的模型。选定的模型具有乘法趋势、季节性和误差成分。图15.12给出了图表，以及对未来八个季度的预测（在这种情况下默认为八个季度）。
- en: '![](Images/CH15_F12_Kabacoff3.png)'
  id: totrans-185
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F12_Kabacoff3.png)'
- en: Figure 15.12 Multiplicative exponential smoothing forecast with trend and seasonal
    components. The forecasts are a dashed line, and the 80% and 95% confidence intervals
    are shown in light and dark blue, respectively.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.12 带趋势和季节成分的乘法指数平滑预测。预测值用虚线表示，80%和95%的置信区间分别用浅蓝色和深蓝色表示。
- en: As stated earlier, exponential time-series modeling is popular because it can
    give good short-term forecasts in many situations. A second popular approach is
    the Box–Jenkins methodology, commonly referred to as ARIMA models. These are described
    in the next section.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，指数时间序列建模因其能在许多情况下提供良好的短期预测而受到欢迎。第二种流行的方法是Box-Jenkins方法，通常称为ARIMA模型。这些将在下一节中描述。
- en: 15.4 ARIMA forecasting models
  id: totrans-188
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 15.4 ARIMA预测模型
- en: In the *autoregressive integrated moving average (ARIMA)* approach to forecasting,
    predicted values are a linear function of recent actual values and recent errors
    of prediction (residuals). ARIMA is a complex approach to forecasting. In this
    section, we’ll limit discussion to ARIMA models for nonseasonal time series.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 在预测的**自回归积分移动平均（ARIMA）**方法中，预测值是近期实际值和近期预测误差（残差）的线性函数。ARIMA是一种复杂的预测方法。在本节中，我们将仅讨论非季节性时间序列的ARIMA模型。
- en: Before describing ARIMA models, several terms need to be defined, including
    lags, autocorrelation, partial autocorrelation, differencing, and stationarity.
    Each is considered in the next section.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在描述ARIMA模型之前，需要定义几个术语，包括滞后、自相关、偏自相关、差分和稳定性。这些内容将在下一节中讨论。
- en: 15.4.1 Prerequisite concepts
  id: totrans-191
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.4.1 前置概念
- en: When you *lag* a time series, you shift it back by a given number of observations.
    Consider the first few observations from the `Nile` time series, displayed in
    table 15.4\. Lag 0 is the unshifted time series. Lag 1 is the time series shifted
    one position to the left. Lag 2 shifts the time series two positions to the left,
    and so on. Time series can be lagged using the function `lag(ts,k)`, where `ts`
    is the time series and `k` is the number of lags.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 当你对时间序列进行**滞后**处理时，你会将其向后移动给定数量的观测值。考虑来自`尼罗河`时间序列的前几个观测值，如表15.4所示。滞后0是未移动的时间序列。滞后1是将时间序列向左移动一个位置。滞后2是将时间序列向左移动两个位置，依此类推。可以使用函数`lag(ts,k)`对时间序列进行滞后，其中`ts`是时间序列，`k`是滞后数。
- en: Table 15.4 The `Nile` time series at various lags
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 表15.4 在不同滞后下的`尼罗河`时间序列
- en: '| Lag | 1869 | 1870 | 1871 | 1872 | 1873 | 1874 | 1875 | ... |'
  id: totrans-194
  prefs: []
  type: TYPE_TB
  zh: '| 滞后 | 1869 | 1870 | 1871 | 1872 | 1873 | 1874 | 1875 | ... |'
- en: '| 0 |  |  | 1120 | 1160 | 963 | 1210 | 1160 | ... |'
  id: totrans-195
  prefs: []
  type: TYPE_TB
  zh: '| 0 |  |  | 1120 | 1160 | 963 | 1210 | 1160 | ... |'
- en: '| 1 |  | 1120 | 1160 | 963 | 1210 | 1160 | 1160 | ... |'
  id: totrans-196
  prefs: []
  type: TYPE_TB
  zh: '| 1 |  | 1120 | 1160 | 963 | 1210 | 1160 | 1160 | ... |'
- en: '| 2 | 1120 | 1160 | 963 | 1210 | 1160 | 1160 | 813 | ... |'
  id: totrans-197
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 1120 | 1160 | 963 | 1210 | 1160 | 1160 | 813 | ... |'
- en: '*Autocorrelation* measures the way observations in a time series relate to
    each other. *AC[k]* is the correlation between a set of observations (*Y[t]*)
    and observations *k* periods earlier (*Y[t−k]*). Thus, *AC*[1] is the correlation
    between the Lag 1 and Lag 0 time series, *AC*[2] is the correlation between the
    Lag 2 and Lag 0 time series, and so on. Plotting these correlations (*AC*[1],
    *AC*[2], ..., *AC[k]*) produces an *autocorrelation function (ACF) plot*. The
    ACF plot is used to select appropriate parameters for the ARIMA model and to assess
    the fit of the final model.'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: '*自相关*衡量时间序列中观测值之间的关系。*AC[k]*是一组观测值（*Y[t]*)与较早的*k*个周期的观测值（*Y[t−k]*）之间的相关性。因此，*AC*[1]是滞后1和滞后0时间序列之间的相关性，*AC*[2]是滞后2和滞后0时间序列之间的相关性，依此类推。绘制这些相关性（*AC*[1]，*AC*[2]，...，*AC[k]*)将产生一个*自相关函数（ACF）图*。ACF图用于选择ARIMA模型的最佳参数，并评估最终模型的拟合度。'
- en: An ACF plot can be produced with the `Acf()` function in the `forecast` package.
    The format is `Acf(*ts*)`, where *`ts`* is the original time series. The ACF plot
    for the `Nile` time series, with *k* = 1 to 18, is provided a little later in
    the top half of figure 15.13.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用`forecast`包中的`Acf()`函数生成自相关图。其格式为`Acf(*ts*)`，其中*`ts`*是原始时间序列。`Nile`时间序列的自相关图（*k*
    = 1到18），将在稍后图15.13的上半部分提供。
- en: A *partial autocorrelation* is the correlation between *Y[t]* and *Y[t−k]* with
    the effects of all *Y* values between the two (*Y[t]*[-1], *Y[t]*[-2], ..., *Y[t-k]*[+1])
    removed. Partial autocorrelations can also be plotted for multiple values of *k*.
    The PACF plot can be generated with the `Pacf()` function in the `forecast` package.
    The function call is `Pacf(*ts*)`, where *`ts`* is the time series to be assessed.
    The PACF plot is also used to determine the most appropriate parameters for the
    ARIMA model. The bottom half of figure 15.13 gives the results for the `Nile`
    time series.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '*偏自相关*是*Y[t]*与*Y[t−k]*之间的相关性，同时消除了两者之间的所有*Y*值的影响（*Y[t]*[-1]，*Y[t]*[-2]，...，*Y[t-k]*[+1]）。对于多个*k*值，也可以绘制偏自相关。可以使用`forecast`包中的`Pacf()`函数生成PACF图。函数调用为`Pacf(*ts*)`，其中*`ts`*是要评估的时间序列。PACF图也用于确定ARIMA模型的最合适的参数。图15.13的下半部分给出了`Nile`时间序列的结果。'
- en: ARIMA models are designed to fit *stationary* time series (or time series that
    can be made stationary). In a stationary time series, the statistical properties
    of the series don’t change over time. For example, the mean and variance of *Y[t]*
    are constant. Additionally, the autocorrelations for any lag *k* don’t change
    with time.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: ARIMA模型旨在拟合*平稳*时间序列（或可以变为平稳的时间序列）。在平稳时间序列中，序列的统计属性不会随时间变化。例如，*Y[t]*的均值和方差是恒定的。此外，任何滞后*k*的自相关也不会随时间变化。
- en: It may be necessary to transform the values of a time series to achieve constant
    variance before proceeding to fitting an ARIMA model. The log transformation is
    often useful here, as you saw in section 15.1.3\. Other transformations, such
    as the Box–Cox transformation described in section 8.5.2, may also be helpful.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行ARIMA模型的拟合之前，可能需要将时间序列的值进行转换以实现常数方差。对数转换在这里通常很有用，正如你在15.1.3节中看到的。其他转换，如8.5.2节中描述的Box-Cox转换，也可能有所帮助。
- en: Because stationary time series are assumed to have constant means, they can’t
    have a trend component. Many nonstationary time series can be made stationary
    through *differencing*. In differencing, each value of a time series *Y[t]* is
    replaced with *Y[t]*[-1] – *Y[t]*. Differencing a time series once removes a linear
    trend. Differencing it a second time removes a quadratic trend. A third time removes
    a cubic trend. It’s rarely necessary to difference more than twice.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 由于平稳时间序列假定具有恒定的均值，因此它们不能有趋势成分。许多非平稳时间序列可以通过*差分*变为平稳。在差分中，时间序列*Y[t]*的每个值被替换为*Y[t]*[-1]
    – *Y[t]*。对时间序列进行一次差分可以去除线性趋势。进行第二次差分可以去除二次趋势。第三次差分可以去除三次趋势。很少需要差分超过两次。
- en: You can difference a time series with the `diff()` function. The format is `diff(*ts*,
    differences=*d*)`, where *`d`* indicates the number of times the time series `ts`
    is differenced. The default is `d=1`. The `ndiffs()` function in the `forecast`
    package can be used to help determine the best value of `d`. The format is `ndiffs(*ts*)`.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用`diff()`函数对时间序列进行差分。其格式为`diff(*ts*, differences=*d*)`，其中*`d`*表示时间序列`ts`被差分的次数。默认值为`d=1`。`forecast`包中的`ndiffs()`函数可用于帮助确定`d`的最佳值。其格式为`ndiffs(*ts*)`。
- en: Stationarity is often evaluated with a visual inspection of a time-series plot.
    If the variance isn’t constant, the data are transformed. If there are trends,
    the data are differenced. You can also use a statistical procedure called the
    *Augmented Dickey–Fuller (ADF**) test* to evaluate the assumption of stationarity.
    In R, the function `adf.test``()` in the `tseries` package performs the test.
    The format is `adf.test(*ts*``)`, where *`ts`* is the time series to be evaluated.
    A significant result suggests stationarity.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 平稳性通常通过时间序列图的可视检查来评估。如果方差不是常数，则对数据进行变换。如果有趋势，则对数据进行差分。您还可以使用称为*Augmented Dickey–Fuller
    (ADF**)测试的统计程序来评估平稳性的假设。在R中，`tseries`包中的`adf.test``()`函数执行此测试。格式为`adf.test(*ts*``)`，其中*`ts`*是要评估的时间序列。显著的结果表明平稳性。
- en: To summarize, ACF and PCF plots are used to determine the parameters of ARIMA
    models. Stationarity is an important assumption, and transformations and differencing
    are used to help achieve stationarity. With these concepts in hand, we can now
    turn to fitting models with an autoregressive (AR) component, a moving averages
    (MA) component, or both components (ARMA). Finally, we’ll examine ARIMA models
    that include ARMA components and differencing to achieve stationarity (integration).
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，ACF和PCF图用于确定ARIMA模型的参数。平稳性是一个重要的假设，变换和差分被用来帮助实现平稳性。掌握这些概念后，我们现在可以转向拟合具有自回归（AR）成分、移动平均（MA）成分或两者成分（ARMA）的模型。最后，我们将检查包含ARMA成分和差分以实现平稳性（积分）的ARIMA模型。
- en: 15.4.2 ARMA and ARIMA models
  id: totrans-207
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.4.2 ARMA和ARIMA模型
- en: In an *autoregressive* model of order p, each value in a time series is predicted
    from a linear combination of the previous p-values
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 在阶数为p的自回归模型中，时间序列中的每个值都是通过前p个值的线性组合进行预测的
- en: '*AR*(*p*): *Y[t]* = *µ* + *β*[1]*Y[t]*[−1] + *β*[2]*Y[t]*[−2] + ... + *β[p]**Y[t−p]*
    + *ε[t]*'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: '*AR*(*p*): *Y[t]* = *µ* + *β*[1]*Y[t]*[−1] + *β*[2]*Y[t]*[−2] + ... + *β[p]**Y[t−p]*
    + *ε[t]*'
- en: where *Y[t]* is a given value of the series, *µ* is the mean of the series,
    the *β*s are the weights, and *ε[t]* is the irregular component. In a *moving
    average* model of order q, each value in the time series is predicted from a linear
    combination of q previous errors. In this case,
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *Y[t]* 是序列的给定值，*µ* 是序列的均值，*β* 是权重，*ε[t]* 是不规则成分。在阶数为q的移动平均模型中，时间序列中的每个值都是通过q个前误差值的线性组合进行预测的。在这种情况下，
- en: '*MA*(*q*): *Y[t]* = *µ* + *θ*[1]*ε[t]*[−1] + *θ*[2]*ε[t]*[−2] + ... + *θ[p]**ε[t−q]*
    + *ε[t]*'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: '*MA*(*q*): *Y[t]* = *µ* + *θ*[1]*ε[t]*[−1] + *θ*[2]*ε[t]*[−2] + ... + *θ[p]**ε[t−q]*
    + *ε[t]*'
- en: where the *ε*s are the errors of prediction and the *θ*s are the weights. (It’s
    important to note that the moving averages described here aren’t the simple moving
    averages described in section 15.1.2.)
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 其中，*ε*表示预测误差，*θ*表示权重。（需要注意的是，这里描述的移动平均并不是第15.1.2节中描述的简单移动平均。）
- en: Combining the two approaches yields an ARMA(p, q) model of the form
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 结合两种方法可以得到形式为ARMA(p, q)的模型
- en: '*Y[t]* = *µ* + *β*[1]*Y[t]*[−1] + *β*[2]*Y[t]*[−2] + ... + *β[p]**Y[t−p]* −
    *θ*[1]*ε[t]*[−1] − *θ*[2]*ε[t]*[−2] − ... − *θ[p]**ε[t−q]* + *ε[t]*'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: '*Y[t]* = *µ* + *β*[1]*Y[t]*[−1] + *β*[2]*Y[t]*[−2] + ... + *β[p]**Y[t−p]* −
    *θ*[1]*ε[t]*[−1] − *θ*[2]*ε[t]*[−2] − ... − *θ[p]**ε[t−q]* + *ε[t]*'
- en: that predicts each value of the time series from the past p values and q residuals.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 从过去p个值和q个残差预测时间序列的每个值。
- en: An ARIMA(p, d, q) model is a model in which the time series has been differenced
    d times, and the resulting values are predicted from the previous p actual values
    and q previous errors. The predictions are *un-differenced* or *integrated* to
    achieve the final prediction.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: ARIMA(p, d, q)模型是一种时间序列经过d次差分后的模型，预测值由前p个实际值和q个前误差值得到。预测值经过*非差分*或*积分*处理以得到最终预测。
- en: 'The steps in ARIMA modeling are as follows:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: ARIMA建模的步骤如下：
- en: Ensure that the time series is stationary.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保时间序列是平稳的。
- en: Identify a reasonable model or models (possible values of p and q).
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定一个合理的模型或多个模型（p和q的可能值）。
- en: Fit the model.
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 拟合模型。
- en: Evaluate the model’s fit, including statistical assumptions and predictive accuracy.
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 评估模型的拟合度，包括统计假设和预测准确性。
- en: Make forecasts.
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进行预测。
- en: Let’s apply each step in turn to fit an ARIMA model to the `Nile` time series.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们依次应用每个步骤来拟合一个ARIMA模型到`Nile`时间序列。
- en: Ensuring that the time series is stationary
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 确保时间序列是平稳的
- en: First, you plot the time series and assess its stationarity (see listing 15.7
    and the top half of figure 15.13). The variance appears to be stable across the
    years observed, so there’s no need for a transformation. There may be a trend,
    which is supported by the results of the `ndiffs()` function.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您绘制时间序列并评估其平稳性（参见列表15.7和图15.13的上半部分）。方差似乎在观察的年份中保持稳定，因此不需要转换。可能存在趋势，这得到了`ndiffs()`函数结果的支持。
- en: Listing 15.9 Transforming the time series and assessing stationarity
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.9转换时间序列并评估平稳性
- en: '[PRE12]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![](Images/CH15_F13_Kabacoff3.png)'
  id: totrans-228
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F13_Kabacoff3.png)'
- en: Figure 15.13 Time series displaying the annual flow of the river Nile at Aswan
    from 1871 to 1970 (top) along with the times series differenced once (bottom).
    The differencing removes the decreasing trend evident in the original plot.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.13显示了从1871年到1970年阿斯旺尼罗河年流量的时间序列（顶部）以及一次差分后的时间序列（底部）。差分消除了原始图中明显的下降趋势。
- en: The series is differenced once (lag = 1 is the default) and saved as `dNile`.
    The differenced time series is plotted in the bottom half of figure 15.13 and
    certainly looks more stationary. Applying the ADF test to the differenced series
    suggests that it’s now stationary, so you can proceed to the next step.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列进行了一次差分（滞后=1是默认值）并保存为`dNile`。差分后的时间序列在图15.13的下半部分绘制，看起来更平稳。对差分序列应用ADF测试表明它现在是平稳的，因此您可以继续下一步。
- en: Identifying one or more reasonable models
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 确定一个或多个合理模型
- en: 'Possible models are selected based on the ACF and PACF plots:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 根据ACF和PACF图选择可能的模型：
- en: '[PRE13]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Figure 15.14 shows the resulting plots.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.14显示了结果图。
- en: '![](Images/CH15_F14_Kabacoff3.png)'
  id: totrans-235
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F14_Kabacoff3.png)'
- en: Figure 15.14 Autocorrelation and partial autocorrelation plots for the differenced
    `Nile` time series
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.14差分后的尼罗河时间序列的自相关和偏自相关图
- en: The goal is to identify the parameters p, d, and q. You already know that d
    = 1 from the previous section. You get p and q by comparing the ACF and PACF plots
    with the guidelines given in table 15.5.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 目标是确定参数p、d和q。您已经从上一节中知道d = 1。您通过比较ACF和PACF图与表15.5中给出的指南来获取p和q。
- en: Table 15.5 Guidelines for selecting an ARIMA model
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 表15.5选择ARIMA模型的指南
- en: '| Model | ACF | PACF |'
  id: totrans-239
  prefs: []
  type: TYPE_TB
  zh: '| 模型 | ACF | PACF |'
- en: '| ARIMA(p, d, 0) | Trails off to zero | Zero after lag p |'
  id: totrans-240
  prefs: []
  type: TYPE_TB
  zh: '| ARIMA(p, d, 0) | 逐渐衰减至零 | 滞后p后的零值 |'
- en: '| ARIMA(0, d, q) | Zero after lag q | Trails off to zero |'
  id: totrans-241
  prefs: []
  type: TYPE_TB
  zh: '| ARIMA(0, d, q) | 滞后q后的零值 | 逐渐衰减至零 |'
- en: '| ARIMA(p, d, q) | Trails off to zero | Trails off to zero |'
  id: totrans-242
  prefs: []
  type: TYPE_TB
  zh: '| ARIMA(p, d, q) | 逐渐衰减至零 | 逐渐衰减至零 |'
- en: The results in table 15.5 are theoretical, and the actual ACF and PACF may not
    match this exactly, but they can be used to give a rough guide of reasonable models
    to try. For the `Nile` time series in figure 15.13, there appears to be one large
    autocorrelation at Lag 1, and the partial autocorrelations trail off to zero as
    the lags get bigger. This suggests trying an ARIMA(0, 1, 1) model.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 表15.5中的结果是理论上的，实际的ACF和PACF可能不会完全匹配，但它们可以用来给出尝试的合理模型的粗略指南。对于图15.13中的“尼罗河”时间序列，似乎在滞后1处有一个大的自相关，并且随着滞后时间的增加，偏自相关逐渐衰减至零。这表明尝试ARIMA(0,
    1, 1)模型。
- en: Fitting the model(s)
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 拟合模型
- en: The ARIMA model is fit with the `Arima()` function. The format is `Arima(*ts*,
    order=c(q,` `d,` `q))`. The following listing gives the result of fitting an ARIMA(0,
    1, 1) model to the `Nile` time series.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`Arima()`函数拟合ARIMA模型。格式为`Arima(*ts*, order=c(q, d, q))`。以下列表给出了将ARIMA(0, 1,
    1)模型拟合到尼罗河时间序列的结果。
- en: Listing 15.10 Fitting an ARIMA model
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.10拟合ARIMA模型
- en: '[PRE14]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Note that you apply the model to the original time series. By specifying d =
    1, it calculates first differences for you. The coefficient for the moving averages
    (–0.73) is provided along with the AIC. If you fit other models, the AIC can help
    you choose which one is most reasonable. Smaller AIC values suggest better models.
    The accuracy measures can help you determine whether the model fits with sufficient
    accuracy. Here the mean absolute percent error is 13% of the river level.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，您将模型应用于原始时间序列。通过指定d = 1，它为您计算一阶差分。移动平均系数（–0.73）与AIC一起提供。如果您拟合其他模型，AIC可以帮助您选择哪个模型最合理。较小的AIC值表示更好的模型。准确度指标可以帮助您确定模型是否具有足够的准确性。这里河流水平的平均绝对百分比误差为13%。
- en: Evaluating model fit
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 评估模型拟合
- en: If the model is appropriate, the residuals should be normally distributed with
    mean zero, and the autocorrelations should be zero for every possible lag. In
    other words, the residuals should be normally and independently distributed (no
    relationship between them). The assumptions can be evaluated with the code in
    the following listing.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 如果模型是合适的，残差应该是均值为零的正态分布，并且对于每个可能的滞后，自相关系数都应该为零。换句话说，残差应该是正态且独立分布的（它们之间没有关系）。可以使用以下列表中的代码评估这些假设。
- en: Listing 15.11 Evaluating the model fit
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 15.11 评估模型拟合
- en: '[PRE15]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: ❶ Extracts residuals
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 提取残差
- en: ❷ Creates Q-Q plot
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 创建 Q-Q 图
- en: ❸ Tests autocorrelations are zero for all lags
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 测试所有滞后阶数的自相关系数为零
- en: First, the residuals are extracted from the `fit` object and saved in a data
    frame. Then `qq_*` functions are used to produce `the Q-Q plot` (figure 15.15).
    Normally distributed data should fall along the line. In this case, the results
    look good.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，从 `fit` 对象中提取残差并保存到数据框中。然后使用 `qq_*` 函数生成 `Q-Q 图`（图 15.15）。正态分布的数据应该沿着这条线分布。在这种情况下，结果看起来很好。
- en: '![](Images/CH15_F15_Kabacoff3.png)'
  id: totrans-257
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F15_Kabacoff3.png)'
- en: Figure 15.15 Normal Q-Q plot for determining the normality of the time-series
    residuals. Normally distributed values are expected to fall along the line.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.15：用于确定时间序列残差的正态性的正态 Q-Q 图。期望正态分布的值会沿着这条线分布。
- en: The `Box.test()` function provides a test that the autocorrelations are all
    zero. The results aren’t significant, suggesting that the autocorrelations don’t
    differ from zero. This ARIMA model appears to fit the data well.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: '`Box.test()` 函数提供了一个测试，表明所有自相关系数都为零。结果并不显著，表明自相关系数与零没有差异。这个 ARIMA 模型似乎很好地拟合了数据。'
- en: Making forecasts
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 进行预测
- en: If the model hadn’t met the assumptions of normal residuals and zero autocorrelations,
    it would have been necessary to alter the model, add parameters, or try a different
    approach. Once a final model has been chosen, it can be used to make predictions
    of future values. In the next listing, the `forecast()` function from the `forecast`
    package is used to predict three years ahead.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 如果模型没有满足正态残差和零自相关的假设，那么就需要修改模型、添加参数或尝试不同的方法。一旦选择了最终模型，就可以用它来预测未来的值。在下一个列表中，使用
    `forecast` 包中的 `forecast()` 函数来预测三年后的值。
- en: Listing 15.12 Forecasting with an ARIMA model
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 15.12 使用 ARIMA 模型进行预测
- en: '[PRE16]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: The `autoplot()` function is used to plot the forecast in figure 15.16\. Point
    estimates are given by the black line, and 80% and 95% confidence bands are represented
    by dark and light blue bands, respectively.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: '`autoplot()` 函数用于绘制图 15.16 中的预测结果。点估计由黑色线条表示，而 80% 和 95% 的置信区间分别由深蓝色和浅蓝色带表示。'
- en: '![](Images/CH15_F16_Kabacoff3.png)'
  id: totrans-265
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH15_F16_Kabacoff3.png)'
- en: Figure 15.16 Three-year forecast for the `Nile` time series from a fitted ARIMA(0,1,1)
    model. The black line represents point estimates, and the light and dark blue
    bands represent the 80% and 95% confidence bands limits, respectively.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.16：从拟合的 ARIMA(0,1,1) 模型对 `尼罗河` 时间序列的三年预测。黑色线条代表点估计，浅蓝色和深蓝色带分别代表 80% 和 95%
    的置信区间界限。
- en: 15.4.3 Automated ARIMA forecasting
  id: totrans-267
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.4.3 自动 ARIMA 预测
- en: In section 15.2.3, you used the `ets()` function in the `forecast` package to
    automate the selection of a best exponential model. The package also provides
    an `auto.arima()` function to select a best ARIMA model. The next listing applies
    this approach to the `sunspots` time series described in the chapter introduction.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 在 15.2.3 节中，你使用了 `forecast` 包中的 `ets()` 函数来自动选择最佳指数模型。该包还提供了一个 `auto.arima()`
    函数来选择最佳 ARIMA 模型。下面的列表将此方法应用于章节引言中描述的 `sunspots` 时间序列。
- en: Listing 15.13 Automated ARIMA forecasting
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 15.13 自动 ARIMA 预测
- en: '[PRE17]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The function selects an ARIMA model with p = 2, d = 1, and q = 2. These are
    values that minimize the AIC criterion over a large number of possible models.
    The MPE and MAPE accuracy blow up because there are zero values in the series
    (a drawback of these two statistics). Plotting the results and evaluating the
    fit are left for you as an exercise.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 该函数选择了一个 p = 2, d = 1, q = 2 的 ARIMA 模型。这些值是在大量可能的模型中使 AIC 准则最小化的值。由于序列中存在零值（这两个统计量的缺点），MPE
    和 MAPE 准确度会爆炸。绘制结果和评估拟合留给你作为练习。
- en: A caveat on forecasting
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 预测的注意事项
- en: Forecasting has a long and varied history, from early shamans predicting the
    weather to modern data scientists predicting the results of recent elections.
    Prediction is fundamental to both science and human nature.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 预测有着悠久而多样的历史，从早期的巫师预测天气到现代数据科学家预测最近选举的结果。预测是科学和人类本性的基础。
- en: Although these methodologies can be crucial in understanding and predicting
    a wide variety of phenomena, it’s important to remember that they each entail
    extrapolation—going beyond the data. They assume that future conditions will mirror
    current conditions. Financial predictions made in 2007 assumed continued economic
    growth in 2008 and beyond. As we all know now, that isn’t exactly how things turned
    out. Significant events can change the trend and pattern in a time series, and
    the farther out you try to predict, the greater the uncertainty.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这些方法在理解和预测各种现象时可能至关重要，但重要的是要记住，它们每个都涉及外推——超越数据。它们假设未来的条件将反映当前的条件。2007 年做出的金融预测假设
    2008 年及以后的经济持续增长。正如我们今天所知道的那样，事情并没有完全按照这种方式发展。重大事件可以改变时间序列的趋势和模式，而且你尝试预测得越远，不确定性就越大。
- en: 15.5 Going further
  id: totrans-275
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 15.5 深入学习
- en: 'There are many good books on time-series analysis and forecasting. *Forecasting:
    Principles and Practice* ([http://otexts.com/fpp2](http://otexts.com/fpp2), 2018)
    is a clear and concise online textbook by Rob Hyndman and George Athanasopoulos
    that includes R code throughout. I highly recommend it. Additionally, Cowpertwait
    and Metcalfe (2009) have written an excellent text on analyzing time series with
    R. A more advanced treatment that also includes R code can be found in Shumway
    and Stoffer (2010). Finally, you can consult the CRAN Task View on Time Series
    Analysis ([http://cran.r-project.org/web/views/TimeSeries.html](http://cran.r-project.org/web/views/TimeSeries.html)),
    which contains a comprehensive summary of all of R’s time-series capabilities.'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 关于时间序列分析和预测有许多优秀的书籍。*预测：原理与实践* ([http://otexts.com/fpp2](http://otexts.com/fpp2),
    2018) 是由 Rob Hyndman 和 George Athanasopoulos 编写的一本清晰简洁的在线教科书，其中包含了贯穿始终的 R 代码。我强烈推荐它。此外，Cowpertwait
    和 Metcalfe (2009) 撰写了一本关于使用 R 分析时间序列的优秀文本。Shumway 和 Stoffer (2010) 提供了一种更高级的处理方法，其中也包括了
    R 代码。最后，你可以查阅 CRAN 任务视图关于时间序列分析 ([http://cran.r-project.org/web/views/TimeSeries.html](http://cran.r-project.org/web/views/TimeSeries.html))，其中包含了对
    R 所有时间序列能力的全面总结。
- en: Summary
  id: totrans-277
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: R provides a wide array of data structures for holding time-series data. Base
    R offers classes for holding one (`ts`) or more than one (`mts`) series of observations
    recorded at regular intervals. The `xts` and `zoo` packages extend this to include
    observations recorded at irregular intervals.
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R 提供了广泛的数据结构来存储时间序列数据。基础 R 提供了用于存储一个 (`ts`) 或多个 (`mts`) 观测序列的类。`xts` 和 `zoo`
    包扩展了这一功能，以包括记录在非规律间隔的观测。
- en: Time-series data stored as `xts` objects can be easily subsetted using bracket
    `[]` notation and aggregated using `apply.period` functions.
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储为 `xts` 对象的时间序列数据可以很容易地使用方括号 `[]` 符号进行子集化，并使用 `apply.period` 函数进行聚合。
- en: The `forecast` package provides several functions for visually exploring time-series
    data. The `autoplot()` function can be used to plot time-series data as `ggplot2`
    graphs. The `ma()` function can be used smooth irregularities in a time series
    to highlight trends. The `stl()` function can be used to decompose a time series
    into trend, seasonal, and irregular (residual) components.
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`forecast` 包提供了几个用于可视化探索时间序列数据的函数。`autoplot()` 函数可以用来将时间序列数据绘制为 `ggplot2` 图表。`ma()`
    函数可以用来平滑时间序列中的不规则性，以突出趋势。`stl()` 函数可以用来将时间序列分解为趋势、季节性和不规则（残差）成分。'
- en: 'The `forecast` package can also be used to forecast future values of a time
    series. We covered two popular forecasting approaches: exponential models and
    autoregressive integrated moving average (ARIMA) models.'
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`forecast` 包还可以用来预测时间序列的未来值。我们介绍了两种流行的预测方法：指数模型和自回归积分移动平均（ARIMA）模型。'
