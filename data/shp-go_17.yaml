- en: Appendix C. Using JavaScript
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录 C. 使用 JavaScript
- en: Node.js is a JavaScript runtime that allows developers to write applications
    to run outside of the web browser. This has led to the growth of JavaScript libraries,
    helping developers write backend services. We can use tools to connect to databases
    and create APIs. Let’s get started.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Node.js 是一个 JavaScript 运行时环境，允许开发者编写在网页浏览器之外运行的应用程序。这导致了 JavaScript 库的增长，帮助开发者编写后端服务。我们可以使用工具连接到数据库并创建
    API。让我们开始吧。
- en: C.1 Node Package Manager
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: C.1 Node 包管理器
- en: 'NPM, or the Node Package Manager, is the central build and dependency management
    tool we’ll use for our API. We will use the Express library. First, make sure
    you have Node installed from [https://nodejs.org/en/download/](https://nodejs.org/en/download/);
    then install the Express Generator application:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: NPM，或 Node 包管理器，是我们用于 API 的核心构建和依赖管理工具。我们将使用 Express 库。首先，确保您已从 [https://nodejs.org/en/download/](https://nodejs.org/en/download/)
    安装了 Node；然后安装 Express 生成器应用程序：
- en: '[PRE0]'
  id: totrans-4
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Once the code has been generated, edit the `package.json` file using the code
    in the following listing.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 代码生成完成后，使用以下列表中的代码编辑 `package.json` 文件。
- en: Listing C.1 `package.json`
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 C.1 `package.json`
- en: '[PRE1]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: ❶ The name of the package
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 包的名称
- en: ❷ Jest configuration settings
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ Jest 配置设置
- en: ❸ NPM has a built-in execution mechanism to run scripts based on locally installed
    packages.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ NPM 内置了执行机制，可以根据本地安装的包运行脚本。
- en: ❹ Libraries required to run the application
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 运行应用程序所需的库
- en: ❺ Libraries to test or develop the application
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 用于测试或开发应用程序的库
- en: The `package.json` file houses all of the dependencies and scripts needed to
    test, build, and run our application. After making these changes, type `npm install`
    to add all of these dependencies to our project. We have set up the basic structure
    and can now start coding.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '`package.json` 文件包含了测试、构建和运行我们的应用程序所需的全部依赖和脚本。在做出这些更改后，输入 `npm install` 以将这些依赖项添加到我们的项目中。我们已经设置了基本结构，现在可以开始编码了。'
- en: C.2 Coding
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: C.2 编码
- en: You’ll notice that Express generated a lot of files for you. The main one is
    `app.js`. This is your entry route to your API. Open it, and replace it with the
    code in the following listing.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 您会注意到 Express 为您生成了很多文件。主要的一个是 `app.js`。这是您进入 API 的入口路由。打开它，并用以下列表中的代码替换它。
- en: Listing C.2 `app.js`
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 C.2 `app.js`
- en: '[PRE2]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: ❶ Imports express framework
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 导入 Express 框架
- en: ❷ Imports translation handler
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 导入翻译处理器
- en: ❸ Imports repository
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 导入存储库
- en: ❹ Constructs application class
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 构建应用程序类
- en: ❺ Exports the app to be used by the running application
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 导出应用程序以供运行中的应用程序使用
- en: Hopefully, you notice the difference between the generated code and what you
    wrote. We use the object-oriented paradigm of JavaScript to help us with future
    unit testing.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 希望您能注意到生成的代码与您所写的代码之间的差异。我们使用 JavaScript 的面向对象范式来帮助我们进行未来的单元测试。
- en: We have a router and repository to define. Let’s define the router first. Create
    a directory called `routes`. This will house our `translation.js` file and will
    be the location of any other routes or groups of routes that you want to define.
    Create the file, and add the code in the following listing.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要定义一个路由和存储库。让我们首先定义路由。创建一个名为 `routes` 的目录。这个目录将存放我们的 `translation.js` 文件，也将是您想要定义的任何其他路由或路由组的存放位置。创建该文件，并添加以下列表中的代码。
- en: Listing C.3 `translation.js`
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 C.3 `translation.js`
- en: '[PRE3]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: ❶ Functional definition for handler
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 处理器的功能定义
- en: ❷ If a query parameter is not passed, default to English.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 如果未传递查询参数，则默认为英语。
- en: ❸ If a response is given, return it; otherwise, it returns 404.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 如果提供了响应，则返回它；否则，返回 404。
- en: As you can see, this function requires the translation service to be passed
    to the function. This is different from what we do in other languages with dependency
    injection and stronger type checks. Instead, we pass the function in to handle
    the business logic. Alternatively, we could have created a class, as we did with
    the main app.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，此函数需要将翻译服务传递给函数。这与我们在其他语言中使用依赖注入和更强的类型检查所做的方法不同。相反，我们传递函数以处理业务逻辑。或者，我们也可以创建一个类，就像我们在主应用中所做的那样。
- en: NOTE We are organizing our files by function and not by domain, meaning we place
    all routes in a directory and all repository methods in each directory. An alternate
    way is to have a `translation` directory with a `repo.js` and a `route.js` file.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：我们按照功能而不是按领域组织文件，这意味着我们将所有路由放在一个目录中，并将每个目录中的存储库方法放在每个目录中。另一种方法是有一个 `translation`
    目录，其中包含 `repo.js` 和 `route.js` 文件。
- en: Now we need to define the translation repository. Create a directory called
    `repository` and a file called `translation.js`, and add the code in the following
    listing.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们需要定义翻译仓库。创建一个名为`repository`的目录和一个名为`translation.js`的文件，并添加以下列表中的代码。
- en: Listing C.4 `translation.js`
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 列表C.4 `translation.js`
- en: '[PRE4]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: ❶ Adds logging when the database is connected
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 当数据库连接时添加日志记录
- en: ❷ Adds logging for errors
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 添加错误日志记录
- en: ❸ Checks for language; if not specified, uses the default
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 检查语言；如果没有指定，则使用默认值
- en: Here, we build a connection to the Redis database and a function to retrieve
    the translation. To test this, open a terminal window and type `npm start`. We
    have a functioning API; let’s test it.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们建立与Redis数据库的连接和一个用于检索翻译的功能。为了测试这个，打开一个终端窗口并输入`npm start`。我们有一个正在运行的API；让我们来测试它。
- en: C.3 Testing
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: C.3 测试
- en: 'We will jump right into an integration test using the testing framework Jest
    and a container library called `testcontainers`, which will provide us with a
    Redis database. Before we write our tests, we want to create a configuration file
    for our test framework Jest. Create a `jest.config.js` file, and add the following
    code:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将直接使用测试框架Jest和一个名为`testcontainers`的容器库进行集成测试，它将为我们提供Redis数据库。在我们编写测试之前，我们想要为我们的测试框架Jest创建一个配置文件。创建一个`jest.config.js`文件，并添加以下代码：
- en: '[PRE5]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: This will give our container time to start before our tests. Now we can write
    our integration test using the code in the following listing.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这将给我们的容器提供启动时间，以便在测试之前。现在我们可以使用以下列表中的代码编写我们的集成测试。
- en: Listing C.5 `app.test.js`
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 列表C.5 `app.test.js`
- en: '[PRE6]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: ❶ Sets up tests by starting a container
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 通过启动容器来设置测试
- en: ❷ Passes values to construct the app
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 将值传递给构建应用
- en: ❸ Writes a test to call the endpoint
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 编写一个测试来调用端点
- en: Now run `npm` `test` to see your tests pass.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 现在运行`npm test`来查看测试是否通过。
- en: C.4 Linting
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: C.4 代码风格检查
- en: 'Our next step is to check formatting and static code analysis. We will use
    Prettier and ESLint to help us with these steps. In the package .json code, we
    added scripts for running these libraries for formatting, checking format, and
    linting. To run these, simply type the following commands:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 我们下一步是检查格式和静态代码分析。我们将使用Prettier和ESLint来帮助我们完成这些步骤。在package.json代码中，我们添加了运行这些库进行格式化、检查格式和代码风格检查的脚本。要运行这些脚本，只需输入以下命令：
- en: '[PRE7]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: For linting, we need to create a configuration file for our linter (see the
    next listing).
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 对于代码风格检查，我们需要为我们的代码风格检查器创建一个配置文件（见以下列表）。
- en: Listing C.6 `\.eslintrc.json`
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 列表C.6 `\.eslintrc.json`
- en: '[PRE8]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: ❶ Defines the environment
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 定义环境
- en: ❷ Passes in Jest formatting rules
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 传递Jest格式化规则
- en: ❸ Defines additional formatting rules
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 定义额外的格式化规则
- en: Now you can run the lint step by typing
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你可以通过输入以下命令来运行代码风格检查步骤
- en: '[PRE9]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: It was pretty simple to incorporate these steps right into our script. This
    shows the power of having a single tool that can fulfill multiple areas of our
    pipeline. The final step before we assemble our pipeline is to define the container.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 将这些步骤直接集成到我们的脚本中非常简单。这展示了拥有一个能够满足我们管道多个领域的单一工具的强大之处。在我们组装管道之前，定义容器是最后一步。
- en: C.5 Defining the container
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: C.5 定义容器
- en: Much like the Python container we made in appendix B, JavaScript requires an
    environment to be set up for the scripts to run. NPM is installed as part of the
    base image so that we can run the install process for our dependencies and run
    the main app. The following listing shows our container definition.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 与附录B中我们创建的Python容器类似，JavaScript需要设置一个环境以便脚本运行。NPM作为基础镜像的一部分被安装，这样我们就可以运行依赖项的安装过程并运行主应用。以下列表显示了我们的容器定义。
- en: Listing C.7 Dockerfile
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 列表C.7 Dockerfile
- en: '[PRE10]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: ❶ Base image
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 基础镜像
- en: ❷ Cleans and installs dependent packages required for production
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 清理并安装生产所需的依赖包
- en: ❸ Runs using a wrapper script provided by Express
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 使用Express提供的包装脚本运行
- en: Finally, we can build our pipeline.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们可以构建我们的管道。
- en: C.6 Building the pipeline
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: C.6 构建管道
- en: This pipeline is similar to those in the other chapters in that it will have
    linting, testing, and container steps, as shown in the following listing.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 这个管道与其他章节中的管道类似，它将包含代码风格检查、测试和容器步骤，如下所示。
- en: Listing C.8 `pipeline.yml`
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 列表C.8 `pipeline.yml`
- en: '[PRE11]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: ❶ Cleans and installs dependencies
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 清理并安装依赖
- en: ❷ Runs format check
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 运行格式检查
- en: ❸ Runs lint
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 运行代码风格检查
- en: First we will do a simple clean, install, and format checking before we move
    on to our integration tests (see the following listing).
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，在我们进行集成测试之前（见以下列表），我们将先进行简单的清理、安装和格式检查。
- en: Listing C.9 `pipeline.yml`
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 列表C.9 `pipeline.yml`
- en: '[PRE12]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: ❶ Runs tests using npm script
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 使用npm脚本运行测试
- en: When the integration tests have completed, we can finally build our container
    to ship (see the next listing).
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 当集成测试完成后，我们最终可以构建我们的容器以进行分发（参见下一列表）。
- en: Listing C.10 `pipeline.yml`
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 C.10 `pipeline.yml`
- en: '[PRE13]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: ❶ Builds a container
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 构建容器
