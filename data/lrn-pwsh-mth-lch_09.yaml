- en: 9 A practical interlude
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 9 实践插曲
- en: 'It’s time to put some of your new knowledge to work. In this chapter, we’re
    not going to teach you anything new. Instead, we’re going to walk you through
    a detailed example using what you’ve learned. This is an absolutely real-world
    example: We’re going to set ourselves a task and then let you follow our thought
    processes as we figure out how to complete it. This chapter is the epitome of
    what this book is all about, because instead of just handing you the answer on
    how to do something, we’re helping you realize that *you can teach yourself*.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 是时候将你的新知识付诸实践了。在本章中，我们不会教你任何新东西。相反，我们将通过一个详细的例子来引导你，使用你所学到的知识。这是一个绝对的现实世界例子：我们将给自己设定一个任务，然后让你跟随我们的思维过程，了解我们如何完成它。这一章是本书主题的精髓，因为本书不是仅仅给你一个如何做某事的答案，而是帮助你意识到*你可以自学*。
- en: 9.1 Defining the task
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.1 定义任务
- en: First of all, we’re assuming that you’re working on any operating system running
    PowerShell 7.1 or higher. The example we’re going to work through may very well
    work on earlier versions of Windows PowerShell, but we have not tested this.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们假设你正在使用运行PowerShell 7.1或更高版本的任何操作系统。我们将要处理的例子可能非常适用于早期版本的Windows PowerShell，但我们没有测试这一点。
- en: In the world of DevOps, there is a specific language that almost always pops
    up—besides PowerShell, of course. It’s a rather controversial language among IT
    pros and DevOps engineers—people either love it or hate it. Any guesses? If you
    guessed YAML, you’re right! YAML stands for “YAML ain’t markup language” (it’s
    what we call a recursive acronym, when the acronym contains the acronym), and
    although it says that it isn’t, in a lot of ways it is similar to a simple markup
    language—in other words, it’s just a file with a certain structure to it, just
    like CSVs and JSON have a certain structure to them. Since we see a lot of YAML
    in the DevOps world, it’s important that we have the tools to interact with YAML
    files.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在DevOps的世界里，除了PowerShell之外，几乎总是会出现一种特定的语言——当然，还有YAML。这在IT专业人士和DevOps工程师中是一个相当有争议的语言——人们要么爱它，要么恨它。有什么猜测吗？如果你猜到了YAML，你就对了！YAML代表“YAML
    ain’t markup language”（它是一个递归缩写，当缩写包含缩写时），尽管它说它不是，但在很多方面它类似于简单的标记语言——换句话说，它只是一个具有特定结构的文件，就像CSV和JSON也有特定的结构一样。由于我们在DevOps世界中看到了很多YAML，因此我们拥有与之交互的工具是很重要的。
- en: 9.2 Finding the commands
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.2 查找命令
- en: 'The first step in solving any task is to figure out which commands will do
    it for you. Your results might differ from ours, depending on what you have installed,
    but it’s the process we’re going through that’s important. Because we know we
    want to manage some virtual machines, we’ll start with YAML as a keyword:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 解决任何任务的第一个步骤是找出哪些命令可以为你完成它。你的结果可能与我们不同，这取决于你安装了什么，但重要的是我们正在经历的过程。因为我们知道我们想要管理一些虚拟机，所以我们将以YAML作为关键词开始：
- en: '[PRE0]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Hmm. That wasn’t helpful. Nothing showed up. Okay, let’s try another approach—this
    time, we focus on commands rather than on help files:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 嗯。这没有帮助。没有显示任何内容。好吧，让我们尝试另一种方法——这次，我们关注命令而不是帮助文件：
- en: '[PRE1]'
  id: totrans-9
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Okay, so there are no commands whose names contain *YAML*. Disappointing! So
    now we have to see what might be in the online PowerShell Gallery:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 好吧，没有命令的名称包含*YAML*。令人失望！所以现在我们必须看看在线PowerShell Gallery中可能有什么：
- en: '[PRE2]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Much more promising! So let’s install that first module:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 这看起来更有希望！所以让我们安装第一个模块：
- en: '[PRE3]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Now, at this point, you do have to be careful. Although Microsoft runs PowerShell
    Gallery, it doesn’t validate any of the code that others publish. So we did take
    a break in our process, review the code that we’d just installed, and made sure
    we were comfortable with it before we continued. It also helps that the author
    of this module is a fellow MVP, Boe Prox, and we trust him. Now let’s see the
    commands we just gained:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在这个时候，你必须小心。虽然Microsoft运行PowerShell Gallery，但它不会验证其他人发布的任何代码。因此，我们在我们的过程中暂停了一下，审查了我们刚刚安装的代码，并在继续之前确保我们对此感到舒适。这也得益于这个模块的作者是一个共同的价值专家（MVP），Boe
    Prox，我们信任他。现在让我们看看我们刚刚获得的命令：
- en: '[PRE4]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Okay, those seem straightforward. `ConvertTo` and `ConvertFrom`—sounds like
    all we need.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 好吧，这些看起来很简单。`ConvertTo`和`ConvertFrom`——听起来我们需要的就这些。
- en: 9.3 Learning to use the commands
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.3 学习使用命令
- en: 'With any luck, the author included help with their module. If you ever write
    a module someday, always remember that if other folks are going to use it, you
    should probably—no, you *should*—include help so that consumers of your module
    know how to use it. If you didn’t, it’d be like shipping a piece of IKEA furniture
    without the instruction manual—don’t do it! There is another book called *Learn
    PowerShell Toolmaking in a Month of Lunches* (Manning, 2012), where two of its
    authors, Don Jones and Jeffery Hicks, cover how to write modules and how to put
    help in them—and adding help is the right thing to do. Let’s see whether the author
    did the right thing:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 希望作者在他们的模块中包含了帮助信息。如果你有一天编写了一个模块，请始终记住，如果其他人将要使用它，你很可能——不，你 *应该*——包含帮助信息，这样模块的消费者就知道如何使用它。如果你没有这样做，那就好比在没有说明书的情况下运送宜家家具——不要这样做！还有另一本书叫做
    *Learn PowerShell Toolmaking in a Month of Lunches*（Manning，2012），其中两位作者 Don Jones
    和 Jeffery Hicks 讲述了如何编写模块以及如何在其中添加帮助信息——添加帮助信息是正确的事情。让我们看看作者是否做了正确的事情：
- en: '[PRE5]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Drat! No help. Well, in this instance, it’s not too bad because PowerShell
    helps even though the author didn’t write any help. PowerShell still gives you
    the syntax, parameters, output, and aliases—that’s enough info for this straightforward
    command. So we need a sample YAML file. . . . Well, it’s worth using a live example
    from the PowerShell GitHub repository:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: Drat! 没有帮助。嗯，在这个例子中，情况并不太糟糕，因为即使作者没有编写任何帮助信息，PowerShell 仍然提供了帮助。PowerShell 仍然会给你语法、参数、输出和别名——对于这个简单的命令来说，这些信息已经足够了。所以我们需要一个样本
    YAML 文件……嗯，使用 PowerShell GitHub 仓库中的实时示例是值得的：
- en: '[https://raw.githubusercontent.com/PowerShell/PowerShell/master/.vsts-ci/templates/credscan.yml](https://raw.githubusercontent.com/PowerShell/PowerShell/master/.vsts-ci/templates/credscan.yml)'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://raw.githubusercontent.com/PowerShell/PowerShell/master/.vsts-ci/templates/credscan.yml](https://raw.githubusercontent.com/PowerShell/PowerShell/master/.vsts-ci/templates/credscan.yml)'
- en: This is the Azure Pipelines YAML file that the PowerShell team uses to run CredScan—a
    tool used for scanning if secrets or credentials have accidentally been added
    to code. The PowerShell team has it set up to run every time someone sends a pull
    request (aka a code change) to the PowerShell GitHub repository so that it can
    be caught immediately. Running tasks during a pull request is a common practice
    called *continuous integration* (CI).
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 这是 PowerShell 团队使用的 Azure Pipelines YAML 文件，用于运行 CredScan 工具——一个用于扫描代码中是否意外添加了机密或凭证的工具。PowerShell
    团队将其设置为每次有人向 PowerShell GitHub 仓库发送拉取请求（即代码更改）时运行，以便可以立即捕获。在拉取请求期间运行任务是一种常见的做法，称为
    *持续集成*（CI）。
- en: 'Go ahead and download that file, and let’s read the file from PowerShell:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 好吧，先下载这个文件，然后让我们从 PowerShell 中读取这个文件：
- en: '[PRE6]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Okay great, so we’ve figured out how to read in the YAML file. Next let’s convert
    it into something a bit easier to work with:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 好极了，所以我们已经弄清楚如何读取 YAML 文件。接下来，让我们将其转换为更容易处理的东西：
- en: '[PRE7]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Well, then. That was easy. Let’s see what kind of object we have:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 嗯，那就简单了。让我们看看我们有什么类型的对象：
- en: '[PRE8]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Okay, so it’s a hash table. Hash tables are just a grab bag of stuff. You’ll
    see them a lot throughout your PowerShell journey. These are great because they
    can easily be turned into other formats. Let’s try to take what we got in YAML
    and turn it into another very important data structure in DevOps—JSON. Let’s see
    what we have to work with:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 好吧，所以这是一个散列表。散列表只是各种东西的集合。你会在 PowerShell 的旅程中看到很多这样的散列表。它们很棒，因为它们可以轻松地转换为其他格式。让我们尝试将我们在
    YAML 中得到的内容转换为 DevOps 中另一个非常重要的数据结构——JSON。让我们看看我们有什么可以工作的：
- en: '[PRE9]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Bingo, a `ConvertTo-Json` cmdlet. Let’s use the pipeline to convert YAML into
    JSON. We’ll need to use `ConvertTo-Json`’s `Depth` parameter (you can read about
    this from the help), which allows us to specify how deep the cmdlet should go
    in trying to make the JSON structure. For what we’re doing, 100 is a safe bet.
    All right, let’s bring it together:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: Bingo，一个 `ConvertTo-Json` 命令。让我们使用管道将 YAML 转换为 JSON。我们需要使用 `ConvertTo-Json`
    的 `Depth` 参数（你可以在帮助中阅读有关此信息），这允许我们指定命令应该深入到什么程度来尝试创建 JSON 结构。对于我们正在做的事情，100 是一个安全的选择。好吧，让我们把它放在一起：
- en: '[PRE10]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: It works! We now have some JSON based on a YAML file. This is a useful exercise,
    as there are many different DevOps tools out in the wild that accept YAML or JSON
    (AutoRest, Kubernetes, to name a couple). As a result, you might prefer YAML,
    but your coworker prefers JSON. Now you have an easy way to share with each other
    by converting it this way.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 它成功了！我们现在根据 YAML 文件生成了一些 JSON。这是一个有用的练习，因为野外有许多不同的 DevOps 工具接受 YAML 或 JSON（例如
    AutoRest、Kubernetes），因此你可能更喜欢 YAML，但你的同事可能更喜欢 JSON。现在你有一个简单的方法可以通过这种方式相互分享。
- en: Now, we freely admit that this isn’t a complicated task. But the task itself
    isn’t the point of this chapter. The point is *how we figured it out.* What did
    we do?
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们坦白承认，这并不是一个复杂的任务。但任务本身并不是本章的重点。重点是*我们是如何找到答案的*。我们做了什么？
- en: We started by searching the local help files for any that contained a specific
    keyword. When our search term didn’t match a command name, PowerShell did a full
    search of all the help files’ contents. That’s useful, because if a file had even
    *mentioned* YAML, we’d have found it.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们首先在本地帮助文件中搜索包含特定关键词的任何文件。当我们的搜索词与命令名称不匹配时，PowerShell会对所有帮助文件的内容进行全文搜索。这很有用，因为如果某个文件甚至*提到了*
    YAML，我们就能找到它。
- en: We moved on to searching for specific command names. This would help find commands
    *for which no help files were installed*. Ideally, commands should always have
    help files, but we don’t live in an ideal world, so we always take this extra
    step.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们继续搜索特定的命令名称。这将帮助我们找到*没有安装帮助文件的命令*。理想情况下，命令应该总是有帮助文件，但我们并不生活在一个理想的世界，所以我们总是采取这一额外步骤。
- en: Finding nothing locally, we searched PowerShell Gallery and found a promising-looking
    module. We installed the module and reviewed its commands.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在本地找不到任何东西后，我们在 PowerShell Gallery 中搜索，并找到了一个看起来很有希望的模块。我们安装了该模块并审查了其命令。
- en: Even though the module author didn’t provide help, PowerShell helped us out
    and we were able to figure out how to run the commands to convert to and from
    YAML. This helps us see how the commands’ data is structured and what sorts of
    values the commands are expecting.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 即使模块作者没有提供帮助，PowerShell 也帮助我们找到了如何运行命令以将数据转换为 YAML 的方法。这有助于我们了解命令数据的结构以及命令期望的值类型。
- en: Using the information we had gathered to that point, we were able to implement
    the change we wanted.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用我们到那时收集到的信息，我们能够实现我们想要的更改。
- en: 9.4 Tips for teaching yourself
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.4 自学小贴士
- en: 'Again, the real point of this book is to teach you how to teach yourself—and
    that’s what this chapter illustrates. Here are a few tips:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 再次强调，这本书的真正目的是教你如何自学——这正是本章所展示的。这里有一些小贴士：
- en: Don’t be afraid of the help, and be sure to read the examples. We say that over
    and over, and it’s like nobody believes us. We still see newcomers, right in front
    of us, secretly going to Google to find examples. What’s so scary about the help
    files? If you’re willing to read someone’s blog, why not give the examples in
    the help files a shot first?
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不要害怕寻求帮助，并且一定要阅读示例。我们反复这么说，但好像没有人相信我们。我们仍然看到新来的新手，就在我们眼前，偷偷地去谷歌寻找示例。帮助文件有什么可怕的呢？如果你愿意阅读某人的博客，为什么不先尝试一下帮助文件中的示例呢？
- en: Pay attention. Every bit of information on the screen is potentially important—don’t
    mentally skip over the stuff that you’re not immediately looking for. That’s easy
    to do, but don’t. Instead, look at each thing, and try to figure out what it’s
    for and what information you can derive from it.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注意。屏幕上的每一信息都可能很重要——不要在心理上跳过你立即寻找的东西。这很容易做到，但不要这么做。相反，看看每一件事，并试图弄清楚它的用途以及你可以从中得到的信息。
- en: Don’t be afraid to fail. Hopefully you have a virtual machine that you can play
    in—so use it. Newcomers are constantly asking us questions like, “Hey, if I do
    such and such, what will happen?” to which we’ve started replying, “No idea—try
    it.” Experimentation is good. In a virtual machine, the worst that can happen
    is you have to roll back to a snapshot, right? So give it a whirl, whatever you’re
    working on.
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不要害怕失败。希望你有可以玩耍的虚拟机——那么就使用它。新手们不断地向我们提出问题，比如，“嘿，如果我这样做，会发生什么？”我们开始回答，“不知道——试试看。”实验是好的。在虚拟机中，最坏的情况是你不得不回滚到快照，对吧？所以试试看，无论你在做什么。
- en: If one thing doesn’t work, don’t bang your head against a wall—try something
    else.
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果一件事不起作用，不要头撞南墙——尝试其他方法。
- en: Everything gets easier with time, patience, and practice—but be sure that you’re
    *thinking* along the way.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 随着时间的推移、耐心和练习，一切都会变得容易——但一定要确保你在*思考*。
- en: 9.5 Lab
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.5 实验室
- en: Note For this lab, you can use any OS you prefer (try it on multiple ones if
    you would like), and make sure you are using PowerShell 7.1 or higher.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：对于这个实验，你可以使用你喜欢的任何操作系统（如果你想的话，可以在多个操作系统上尝试），并确保你正在使用 PowerShell 7.1 或更高版本。
- en: Now it’s your turn. We’re assuming that you’re working in a virtual machine
    or other machine that is okay to mess up a little in the name of learning. Please
    don’t do this in a production environment on a mission-critical computer!
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 现在轮到你了。我们假设你在一个虚拟机或其他机器上工作，这个机器在学习的过程中可以稍微出点问题。请不要在生产环境中的关键计算机上这样做！
- en: 'This exercise will be about secrets management. DevOps engineers should be
    very familiar with this concept. The idea is simple: We have a bunch of sensitive
    information (passwords, connection strings, etc.) that we need to use in our commands,
    but we need to keep those secrets in a secure location. We also may want to share
    those secrets with other members on our team—and an email is not secure enough,
    folks!'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 这个练习将涉及秘密管理。DevOps 工程师应该非常熟悉这个概念。想法很简单：我们有一堆敏感信息（密码、连接字符串等），这些信息需要在我们的命令中使用，但我们需要将这些秘密保存在一个安全的地方。我们可能还想与其他团队成员分享这些秘密——电子邮件并不足够安全，朋友们！
- en: The PowerShell team has recently been working on a module called Secrets Management
    to do just this. It’s a generic module for interacting with any secret store that
    supports it. Some will be local secret stores like the macOS Keychain, and others
    will be cloud services like Azure Key Vault and HashiCorp Vault. Your goal is
    to grab this module, store a secret in your secret store of choice, and then retrieve
    it. If you use a cloud-based secret store, try to retrieve the secret from a different
    machine as the ultimate test.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: PowerShell 团队最近一直在开发一个名为“秘密管理”的模块，专门用于执行这项任务。这是一个通用的模块，可以与支持它的任何秘密存储进行交互。一些将是本地秘密存储，如
    macOS Keychain，而其他将是云服务，如 Azure Key Vault 和 HashiCorp Vault。你的目标是获取这个模块，在你的选择秘密存储中存储一个秘密，然后检索它。如果你使用基于云的秘密存储，尝试从不同的机器检索秘密，作为最终测试。
- en: 9.6 Lab answer
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.6 实验答案
- en: We’re sure you were expecting us to give you a full list of commands to run
    to complete this lab exercise. However, this entire chapter has been about figuring
    these things out on your own. The secrets management module is well documented.
    If you have been following along with us, then you will not have any problems
    with this lab.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们确信你们期待我们给出一个完整的命令列表来完成这个实验练习。然而，这一章的全部内容都是关于自己找出这些事情。秘密管理模块有很好的文档记录。如果你一直跟着我们学习，那么你在这个实验中不会遇到任何问题。
