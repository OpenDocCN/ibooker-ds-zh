- en: 'Chapter 11\. System monitoring: Working with log files'
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第11章. 系统监控：与日志文件一起工作
- en: '*This chapter covers*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*本章涵盖*'
- en: Filtering log entries to maintain system health
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 过滤日志条目以维护系统健康
- en: The care and feeding of your Linux logging system
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关心并培养你的Linux日志系统
- en: Filtering text streams using grep, awk, and sed
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用grep、awk和sed过滤文本流
- en: Deploying intrusion detection systems
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 部署入侵检测系统
- en: If all you had to work with was just the things you’ve learned so far in this
    book, I’d say you’re ready to put together a pretty respectable server. It’ll
    be connected, automated, backed up, open for remote clients requesting data and
    other services, and at least reasonably secure. All the comforts of home.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '如果你只能使用这本书中到目前为止学到的东西，我会说你已经准备好构建一个相当令人尊重的服务器。它将连接、自动化、备份，对远程客户端请求数据和其它服务开放，并且至少是合理安全的。所有家的舒适。 '
- en: Time to put your feet up and enjoy the view? Not yet. Your server may be properly
    configured, but you’ll also need to keep an eye on the way it handles the road
    once it enters its production environment. How does that work? As you’ll soon
    see, most Linux system monitoring consists of reading log files.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 是时候放下脚休息并享受风景了吗？还不行。你的服务器可能已经正确配置，但你还需要关注它在进入生产环境后如何处理道路。这是怎么工作的？正如你很快就会看到的，大多数Linux系统监控都包括读取日志文件。
- en: A *log entry* is a text-based record of some system event. When a user enters
    authentication credentials, a remote client requests data from a web server, an
    application crashes, or a new hardware device is connected, a descriptive note
    is appended to one or more log files.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '*日志条目*是某些系统事件的基于文本的记录。当用户输入身份验证凭据、远程客户端从Web服务器请求数据、应用程序崩溃或连接了新的硬件设备时，描述性注释会被附加到一个或多个日志文件中。'
- en: Even a lightly used system can generate many thousands of lines of log files
    between the time it’s booted up and shut down, and busy applications can easily
    produce millions of lines a day. Because log files tend to be long and boring,
    you’ll probably want to outsource their reading to software that can intelligently
    filter only urgent entries, like warnings of imminent failures, and notify you
    only when absolutely necessary. The better you get at configuring your system’s
    log behavior and managing the ever-growing log files, the better you’ll understand
    your system’s strengths and weaknesses—and the more reliable your system will
    become.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 即使是轻度使用的系统，在启动和关闭之间也可能生成数千行日志文件，繁忙的应用程序每天可以轻松生成数百万行。由于日志文件通常很长且无聊，你可能希望将它们的阅读外包给能够智能地过滤仅包含紧急条目（如即将发生的故障警告）的软件，并且仅在绝对必要时才通知你。你越擅长配置你系统的日志行为和管理不断增长的日志文件，你就越能了解你系统的优势和劣势——你的系统也将变得更加可靠。
- en: For those who can read them, log files are a treasure chest of valuable insights.
    They can tell you about weaknesses in your security defenses and past unauthorized
    intrusions. Log entries can help you anticipate problems with your system security
    and performance, and diagnose them once everything has already blown up.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 对于能够阅读它们的人来说，日志文件是一个充满宝贵见解的宝库。它们可以告诉你关于你安全防御中的弱点以及过去的未授权入侵。日志条目可以帮助你预测系统安全和性能问题，并在一切都已经失控后诊断它们。
- en: You could say that this chapter is about providing you with an inventory of
    the log resources at your disposal and describing the best-practice approaches
    to configuring, consuming, and managing your logs. You’ll also learn about intrusion
    detection tools that can be set to regularly scan your server and network environments
    looking for telltale signs of suspicious activity.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以说，本章是关于为你提供可用的日志资源的清单，并描述配置、消费和管理日志的最佳实践方法。你还将了解可以设置为定期扫描你的服务器和网络环境以寻找可疑活动迹象的入侵检测工具。
- en: But the chapter is really focused on trouble-proofing your system to protect
    it from security breaches and performance outages. If you’re an admin responsible
    for a critical public-facing server, then this kind of trouble-proofing is for
    you.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 但本章实际上专注于使你的系统免受安全漏洞和性能中断的影响。如果你是一个负责关键公开服务器的管理员，那么这种加固措施就是为你准备的。
- en: 11.1\. Working with system logs
  id: totrans-13
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.1. 与系统日志一起工作
- en: For decades, Linux logging has been managed by the *syslogd* daemon. Syslogd
    would collect the log messages that system processes and applications sent to
    the /dev/log pseudo device. Then it would direct the messages to appropriate plain
    text log files in the /var/log/ directory. Syslogd ([figure 11.1](#ch11fig01))
    would know where to send the messages because each one includes headers containing
    metadata fields (including a timestamp, and the message origin and priority).
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 几十年来，Linux日志记录一直由*syslogd*守护进程管理。Syslogd会收集系统进程和应用程序发送到/dev/log虚拟设备上的日志消息。然后它会将这些消息定向到/var/log目录中适当的纯文本日志文件。Syslogd（[图11.1](#ch11fig01)）会知道将消息发送到何处，因为每个消息都包含包含元数据字段的标题（包括时间戳、消息来源和优先级）。
- en: Figure 11.1\. The flow of log data from sample sources through the syslogd daemon
  id: totrans-15
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图11.1\. 来自样本源通过syslogd守护进程的日志数据流
- en: '![](Images/11fig01_alt.jpg)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig01_alt.jpg)'
- en: In the wake of systemd’s relentless, world-conquering juggernaut, Linux logging
    is now also handled by journald. I say *also* because syslogd hasn’t gone anywhere,
    and you can still find most of its traditional log files in /var/log/. But you
    need to be aware that there’s a new sheriff in town whose (command line) name
    is *journalctl*.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在systemd不屈不挠、征服世界的巨轮之后，Linux日志记录现在也由journald处理。我说*也*是因为syslogd并没有消失，你仍然可以在/var/log/中找到大部分传统的日志文件。但你需要意识到，镇上来了一个新的警长，他的（命令行）名字是*journalctl*。
- en: Like everything else connected to systemd, the move to journald has been contentious.
    No one will deny the value behind journald’s new functionality (illustrated in
    [figure 11.2](#ch11fig02)). You’ll soon see for yourself how it introduces some
    powerful filtering and searches. But the fact that journald stores log data in
    a binary file rather than plain text is definitely an issue.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 与systemd相关的所有事物一样，转向journald的举措引起了争议。没有人会否认journald新功能的价值（如图11.2所示）。你很快就会亲自看到它如何引入一些强大的过滤和搜索功能。但journald将日志数据存储在二进制文件而不是纯文本文件中，这确实是一个问题。
- en: Figure 11.2\. The journald logs (including those generated by syslogd) are consumed
    using the journalctl command-line tool.
  id: totrans-19
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图11.2\. 使用journalctl命令行工具消费journald日志（包括由syslogd生成的日志）。
- en: '![](Images/11fig02_alt.jpg)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig02_alt.jpg)'
- en: 'Practically, because they’re binary, it might sometimes be difficult or even
    impossible to access your logs. Think about it: when you most need it (while struggling
    to recover from a system crash, perhaps), journalctl will probably be out of service.
    Syslogd logs, on the other hand, will always be accessible to you as long as you
    can mount their drive. This can be immensely helpful when you’re trying to figure
    out what brought down your system and what has to be done to get it back up. The
    good news is that both systems will continue to coexist for the foreseeable future.'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，由于它们是二进制文件，有时可能很难甚至无法访问你的日志。想想看：当你最需要它的时候（可能在努力从系统崩溃中恢复时），journalctl可能无法提供服务。另一方面，只要你能挂载它们的驱动器，syslogd日志总是会对你可用。当你试图找出是什么导致了系统崩溃以及需要做什么来恢复系统时，这可以非常有帮助。好消息是，在可预见的未来，这两个系统将继续共存。
- en: 11.1.1\. Logging with journald
  id: totrans-22
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.1.1\. 使用journald进行日志记录
- en: 'Here’s one that came my way last week. A worried developer brought me his laptop
    running Ubuntu, complaining that it was dying. The boot had, in fact, stalled,
    leaving a black screen displaying a single message that read something like this:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一个上周发生在我身上的例子。一位担忧的开发者带来了他的运行Ubuntu的笔记本电脑，抱怨它要死了。实际上，引导已经停滞，留下一个黑色屏幕，显示一条类似以下的消息：
- en: '[PRE0]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The fact that I was getting a reference to /dev/sda1 told me that the hard drive
    was alive, the boot process had made it past GRUB, and Linux was at least partially
    loaded. In fact, that particular screen message turned out to be misleading, because
    it represented the last successful stage the boot process cleared before stalling
    and had nothing to do with the problem itself.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 我得到一个指向/dev/sda1的引用，这告诉我硬盘是活着的，引导过程已经通过了GRUB，Linux至少部分加载了。实际上，那个特定的屏幕信息最终证明是误导性的，因为它代表了引导过程在停滞之前清除的最后成功阶段，这与问题本身无关。
- en: After a bit of trial and error, including booting the laptop to a live USB drive
    and mounting the laptop’s drive (the way you saw back in [chapter 6](kindle_split_014.xhtml#ch06)),
    it turned out that Linux had fully loaded, but it had failed to launch the GUI
    desktop. How did I discover that gem? Back in a failed boot (with the /dev/sda1:...
    showing onscreen), I pressed Alt-F1 and was taken to the login of a virtual console.
    From there I had full command-line shell access.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 经过一番尝试和错误，包括将笔记本电脑引导到可启动USB驱动器并挂载笔记本电脑的驱动器（就像你在第6章中看到的那样），结果发现Linux已经完全加载，但未能启动GUI桌面。我是如何发现这个宝贝的？在失败的引导过程中（屏幕上显示/dev/sda1:...），我按了Alt-F1，被带到了虚拟控制台的登录界面。从那里，我有了完整的命令行shell访问权限。
- en: '|  |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Tip
  id: totrans-28
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 小贴士
- en: It turns out that you can open multiple virtual consoles using Alt-F2, Alt-F3,
    and so forth. You can also switch back and forth between them through Alt-<the
    appropriate F-key>. Keep in mind that you can return to the host shell (usually
    your GUI session) using Alt-F7.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 结果表明，你可以使用Alt-F2、Alt-F3等组合键打开多个虚拟控制台。你还可以通过Alt-<相应的F键>在它们之间切换。请记住，你可以使用Alt-F7返回到主shell（通常是你的GUI会话）。
- en: '|  |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Why was the desktop GUI not loading? And why am I even telling you about this
    whole business in the first place? The answer to both questions can be found,
    you guessed it, in the laptop’s logs.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么桌面GUI没有加载？我为什么会首先告诉你这整个事情？这两个问题的答案，你猜对了，可以在笔记本电脑的日志中找到。
- en: 'To figure it all out, let’s take a small detour to learn a bit more about journalctl
    and then get back to that poor laptop. Typing `journalctl` by itself returns a
    screen full of the oldest log entries currently on the system. The first line,
    however, displays the start and end date of the available entries. In the following,
    there are nearly nine months of log entries, which would require a great many
    screens to display in order:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 为了弄清楚这一切，让我们稍微偏离一下，先了解一下journalctl，然后再回到那台可怜的笔记本电脑。单独输入`journalctl`会返回系统上当前最旧的日志条目的一整屏。然而，第一行显示了可用条目的开始和结束日期。接下来，有近九个月的日志条目，需要很多屏幕才能显示：
- en: '[PRE1]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'As you’re likely to be interested in more recent activity, the `-n 20` argument
    will display only the last 20 entries:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 由于你很可能对最近的活动更感兴趣，`-n 20`参数将只显示最后20条条目：
- en: '[PRE2]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: It’s always a good idea to check your logs every now and then. I ran that command
    on my own workstation to confirm that it works as expected and discovered an orphaned
    OpenVPN client. Bless its little heart. Every 5 seconds, the client was faithfully
    trying to connect with a VPN server that, sadly, no longer existed, and then sending
    off new entries to tell me about it. To resolve the problem, I used systemctl
    to first stop and then disable the OpenVPN service.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 时不时地检查你的日志总是一个好主意。我在自己的工作站上运行了那个命令来确认它按预期工作，并发现了一个孤立的OpenVPN客户端。愿它的心得到祝福。每5秒钟，客户端都会忠诚地尝试连接到一个VPN服务器，不幸的是，这个服务器已经不存在了，然后发送新的条目告诉我这一点。为了解决这个问题，我使用systemctl首先停止然后禁用了OpenVPN服务。
- en: 'As I wrote earlier, the more accurately you can narrow down results, the quicker
    you’ll get the information you’re after. One useful way to filter logs is to display
    results by priority. Adding `-p emerg`, for instance, shows you only those log
    entries categorized as an emergency. If you know something has broken on your
    system but can’t isolate the problem, `emerg` would be a good first place to look:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 如我之前所写，你越能准确地缩小结果范围，你就能越快地得到你想要的信息。过滤日志的一个有用方法是按优先级显示结果。例如，添加`-p emerg`会显示仅被归类为紧急情况的日志条目。如果你知道你的系统上出了问题，但无法隔离问题，`emerg`会是一个好的起点：
- en: '[PRE3]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Besides `emerg`, you can also filter for debug, info, notice, warning, err,
    crit, and alert messages (see syslogd’s priority levels in the next section).
    Adding the `-f` flag (for follow) displays the 10 most recent entries and any
    subsequent entries as they’re created. This allows you to watch events in real
    time as they occur:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 除了`emerg`之外，你还可以过滤调试、信息、通知、警告、错误、严重和警报消息（参见下一节中syslogd的优先级）。添加`-f`标志（表示跟随）会显示最近的10条条目以及随后创建的任何条目。这允许你实时观察事件的发生：
- en: '[PRE4]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: You can also filter logs by date and time. And here’s where we arrive back at
    the GUI-less laptop. If you’ve got a pretty good idea when the boot process ground
    to a halt, you can narrow down your search to return only events from that time
    frame. Fortunately, the `--since` and `--until` arguments take dates and times.
    If you don’t specify a date, you’ll get the most recent time meeting those criteria.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以通过日期和时间过滤日志。而且，我们回到了没有GUI的笔记本电脑。如果你对引导过程何时停止有相当的了解，你可以缩小搜索范围，只返回该时间框架的事件。幸运的是，`--since`和`--until`参数接受日期和时间。如果你没有指定日期，你将获得满足这些条件的最近期时间。
- en: 'In my case, I could specify a 2-minute bracket within which I figured the failure
    occurred. Two minutes, especially during a system boot, can still produce a lot
    of log entries—but it will be a whole lot easier to browse than 20 minute’s worth:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在我的情况下，我可以在2分钟的时间段内指定失败发生。在系统引导期间，2分钟仍然可以产生大量的日志条目——但与20分钟的日志相比，浏览起来会容易得多：
- en: '[PRE5]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Had I run that command on the laptop, I might have saved myself some time. As
    it happened, however, I went with the older syslog log files instead. Let’s see
    how those work.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我在笔记本电脑上运行那个命令，我可能已经节省了一些时间。然而，实际上，我选择了较旧的syslog日志文件。让我们看看这些是如何工作的。
- en: 11.1.2\. Logging with syslogd
  id: totrans-45
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.1.2\. 使用syslogd进行日志记录
- en: All the logs generated by events on a syslogd system are added to the /var/log/syslog
    file. But, depending on their identifying characteristics, they might also be
    sent to one or more other files in the same directory.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 由syslogd系统上事件生成的一切日志都被添加到/var/log/syslog文件中。但是，根据它们的标识特征，它们也可能被发送到同一目录中的一个或多个其他文件中。
- en: 'With syslogd, the way messages are distributed is determined by the contents
    of the 50-default.conf file that lives in the /etc/rsyslog.d/ directory. This
    example from 50-default.conf shows how log messages marked as cron-related will
    be written to the cron.log file. In this case, the asterisk (`*`) tells syslogd
    to send entries with any priority level (as opposed to a single level like `emerg`
    or `err`):'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 使用syslogd，消息的分配方式由位于/etc/rsyslog.d/目录中的50-default.conf文件的内容决定。以下是从50-default.conf文件中摘取的示例，展示了如何将标记为cron相关的日志消息写入cron.log文件。在这种情况下，星号（`*`）告诉syslogd发送任何优先级级别的条目（与单个级别如`emerg`或`err`相反）：
- en: '[PRE6]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Working with syslogd log files doesn’t require any special tools like journalctl.
    But if you want to get good at this, you’ll need to know what kind of information
    is kept in each of the standard log files. [Table 11.1](#ch11table01) lists the
    most common syslogd log files and their purposes. (To get you up to speed on the
    others, check out their man pages. `man lastlog` is one example.)
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 与syslogd日志文件一起工作不需要任何特殊工具，如journalctl。但如果你想精通这项技能，你需要知道每个标准日志文件中保存了什么类型的信息。[表11.1](#ch11table01)列出了最常见的syslogd日志文件及其用途。（要了解其他信息，请查看它们的man页面。`man
    lastlog`是一个例子。）
- en: Table 11.1\. Commonly used syslogd facilities
  id: totrans-50
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表11.1\. 常用syslogd设施
- en: '| Filename | Purpose |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '| Filename | 目的 |'
- en: '| --- | --- |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| auth.log | System authentication and security events |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
  zh: '| auth.log | 系统身份验证和安全事件 |'
- en: '| boot.log | A record of boot-related events |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '| boot.log | 与引导相关事件的记录 |'
- en: '| dmesg | Kernel-ring buffer events related to device drivers |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| dmesg | 与设备驱动程序相关的内核环形缓冲区事件 |'
- en: '| dpkg.log | Software package-management events |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '| dpkg.log | 软件包管理事件 |'
- en: '| kern.log | Linux kernel events |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| kern.log | Linux内核事件 |'
- en: '| syslog | A collection of all logs |'
  id: totrans-58
  prefs: []
  type: TYPE_TB
  zh: '| syslog | 所有日志的集合 |'
- en: '| wtmp | Tracks user sessions (accessed through the who and last commands)
    |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| wtmp | 跟踪用户会话（通过who和last命令访问） |'
- en: In addition, individual applications will sometimes write to their own log files.
    You’ll often also see entire directories like /var/log/apache2/ or /var/log/mysql/
    created to receive application data. Log redirection can also be controlled through
    any one of eight priority levels, in addition to the `*` symbol you saw before.
    [Table 11.2](#ch11table02) lists syslogd’s priority levels.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，某些应用程序有时会写入它们自己的日志文件。你通常也会看到像/var/log/apache2/或/var/log/mysql/这样的整个目录被创建来接收应用程序数据。日志重定向也可以通过之前看到的任何八个优先级级别来控制。
    [表11.2](#ch11table02)列出了syslogd的优先级级别。
- en: Table 11.2\. Syslogd priority levels
  id: totrans-61
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表11.2\. Syslogd优先级级别
- en: '| Level | Description |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| Level | 描述 |'
- en: '| --- | --- |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| debug | Helpful for debugging |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| debug | 有助于调试 |'
- en: '| info | Informational |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| info | 信息 |'
- en: '| notice | Normal conditions |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| notice | 正常条件 |'
- en: '| warn | Conditions requiring warnings |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| warn | 需要警告的条件 |'
- en: '| err | Error conditions |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| err | 错误条件 |'
- en: '| crit | Critical conditions |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| crit | 临界条件 |'
- en: '| alert | Immediate action required |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| 警报 | 立即采取行动 |'
- en: '| emerg | System unusable |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
  zh: '| 紧急 | 系统不可用 |'
- en: 'Now, curious about what I found on that laptop? Well, it’s not really relevant
    to this chapter, but because you’ve been such a nice reader I’ll tell you anyway.
    This one appeared in the syslog log file itself:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，好奇我在那台笔记本电脑上发现了什么？好吧，这章内容并不真正相关，但因为你是如此好的读者，我还是会告诉你。这个信息出现在syslog日志文件本身：
- en: '[PRE7]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'X server is the Linux system that handles desktop graphical interfaces. If
    the user was unable to connect, it sounds like one of two things:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: X服务器是处理桌面图形界面的Linux系统。如果用户无法连接，可能是因为以下两种情况之一：
- en: The X server system had become corrupted.
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: X服务器系统已经损坏。
- en: There was some kind of authentication problem.
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存在某种身份验证问题。
- en: 'It wasn’t the former because, by this time, I’d already successfully logged
    in to a desktop session using a different user account. But it was difficult to
    see how the laptop’s owner would have been able to authenticate in a command-line
    shell and still be refused access to the desktop. Nevertheless, it seemed worth
    exploring further, so I opened up the auth.log file, and here’s what I saw (with
    *username* used here in place of the developer’s name):'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 这不是前者，因为到那时，我已经成功使用不同的用户账户登录到桌面会话。但是，很难想象笔记本电脑的所有者如何在命令行shell中进行身份验证，却仍然被拒绝访问桌面。尽管如此，这似乎值得进一步探索，所以我打开了auth.log文件，下面是我看到的内容（这里用*用户名*代替开发者的名字）：
- en: '[PRE8]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: I know that lightdm is the desktop manager used by Ubuntu computers, and pam
    is a module that handles Linux user authentication. But I’ll admit that I didn’t
    understand the full significance of the message until I fed it into my favorite
    internet search engine.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 我知道lightdm是Ubuntu计算机使用的桌面管理器，pam是一个处理Linux用户身份验证的模块。但是，我必须承认，直到我将它输入我最喜欢的搜索引擎，我才没有完全理解这条消息的重要性。
- en: 'There I learned that other people facing that message had traced it to incorrect
    ownership of the .Xauthority file kept in the user’s home directory. Apparently
    X server can only load a GUI session if the .Xauthority file belongs to the user.
    I checked, and this user’s .Xauthority file actually belonged to root. Fixing
    the problem was as simple as running `chown` to change the ownership back to `username`:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在那里，我了解到其他遇到这条消息的人将其追溯到用户主目录中保存的.Xauthority文件的错误所有权。显然，X服务器只能加载GUI会话，如果.Xauthority文件属于用户。我检查了一下，这个用户的.Xauthority文件实际上属于root。修复这个问题只需要运行`chown`将所有权改回`username`：
- en: '[PRE9]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: How did the ownership get mixed up in the first place? Who knows. But it happened.
    And the smart use of log files helped me fix it.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 最初所有权是如何混乱的？谁知道。但事情确实发生了。而智能地使用日志文件帮助我解决了问题。
- en: 11.2\. Managing log files
  id: totrans-83
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.2. 管理日志文件
- en: With hundreds of system processes spitting out thousands of log messages each
    hour, an unmanaged log system quickly fills all the storage space available to
    it. At that point logging will break down, along with any other system processes
    relying on that space. What to do? Continue reading.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在数百个系统进程每小时产生数千条日志消息的情况下，未管理的日志系统很快就会填满它可用的所有存储空间。到那时，日志记录将崩溃，以及任何依赖该空间的系统进程。那该怎么办？继续阅读。
- en: 11.2.1\. The journald way
  id: totrans-85
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.2.1. journald方式
- en: Journald deals with the problem by automatically limiting the maximum disk space
    the journald system will be allowed to use. Once a limit is reached, older messages
    are removed and deleted. This setting is controlled by the `SystemMaxUse=` and
    `RuntimeMaxUse=` settings in the /etc/systemd/journal.conf file.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: Journald通过自动限制journald系统允许使用的最大磁盘空间来处理这个问题。一旦达到限制，较旧的日志将被删除。这个设置由/etc/systemd/journal.conf文件中的`SystemMaxUse=`和`RuntimeMaxUse=`设置控制。
- en: 'What’s the difference between these settings? By default, journald builds and
    maintains its journal in the /run/log/journal file, which is a volatile file that’s
    destroyed each time the system is shut down. You can, however, direct journald
    to maintain a persistent journal file at /var/log/journal. You’d use either one
    or the other of those two journal.conf settings depending on your system setup.
    Converting to a persistent journal file requires only that you create a /var/log/journal/
    directory, and use `systemd-tmpfiles` to direct log traffic appropriately:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 这些设置之间的区别是什么？默认情况下，journald在/run/log/journal文件中构建和维护其日志，这是一个在系统关闭时被销毁的易失性文件。然而，你可以指导journald在/var/log/journal目录中维护一个持久的日志文件。你会根据你的系统设置使用这两个journal.conf设置之一。将日志转换为持久日志文件只需要创建一个/var/log/journal/目录，并使用`systemd-tmpfiles`来适当地引导日志流量：
- en: '[PRE10]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 11.2.2\. The syslogd way
  id: totrans-89
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.2.2\. syslogd 方法
- en: By default, syslogd handles log rotation, compression, and deletion behind the
    scenes without any help from you. But you should know how it’s done in case you
    ever have logs needing special treatment.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，syslogd 在幕后处理日志轮换、压缩和删除，无需您的任何帮助。但您应该知道它是如何操作的，以防您有需要特殊处理的日志。
- en: What kind of special treatment could a simple log ever require? Well, suppose
    your company has to be compliant with the transaction reporting rules associated
    with regulatory or industry standards like Sarbanes-Oxley or PCI-DSS. If your
    IT infrastructure records must remain accessible for longer periods of time, then
    you’ll definitely want to know how to find your way through the key files.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 简单的日志可能需要什么样的特殊处理呢？好吧，假设贵公司必须遵守与萨班斯-奥克斯利法案或 PCI-DSS 等监管或行业标准相关的交易报告规则。如果您的 IT
    基础设施记录必须保留更长的时间，那么您肯定想知道如何找到关键文件的方法。
- en: 'To see the logrotate system in action, list some of the contents of the /var/log/
    directory. The auth.log file, for instance, appears in three different formats:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看 logrotate 系统的实际操作，列出 /var/log/ 目录的一些内容。例如，auth.log 文件以三种不同的格式出现：
- en: '*auth.log*—The version that’s currently active, with new auth messages being
    written to it.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*auth.log*—当前活跃的版本，新的认证消息将被写入其中。'
- en: '*auth.log.1*—The most recent file to have been rotated out of service. It’s
    maintained in uncompressed format to make it easier to quickly call it back into
    action should it be necessary.'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*auth.log.1*—最近被轮换出服务的文件。它以未压缩格式维护，以便在必要时可以快速将其重新投入使用。'
- en: '*auth.log.2.gz*—An older collection (as you can see from the .gz file extension
    in the following listing) that, because it’s less likely to be needed, has been
    compressed to save space.'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*auth.log.2.gz*—一个较旧的集合（如以下列表中所示 .gz 文件扩展名所示），因为它不太可能被需要，所以被压缩以节省空间。'
- en: Listing 11.1\. Contents of the /var/log/ directory
  id: totrans-96
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.1\. /var/log/ 目录的内容
- en: '[PRE11]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '***1* The currently active version of auth.log**'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 当前活跃的 auth.log 版本**'
- en: '***2* The most recently retired version**'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 最近退役的版本**'
- en: '***3* Subsequent versions are compressed using gzip.**'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 后续版本将使用 gzip 进行压缩。**'
- en: When, after seven days, the next rotation date arrives, auth.log.2.gz will be
    renamed auth .log.3.gz, auth.log.1 will be compressed and renamed auth.log.2.gz,
    auth.log will become auth.log.1, and a new file will be created and given the
    name auth.log. The default log rotation cycle is controlled in the /etc/logrotate.conf
    file. The values illustrated in this listing rotate files after a single active
    week and delete old files after four weeks.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 当经过七天，下一个轮换日期到来时，auth.log.2.gz 将被重命名为 auth.log.3.gz，auth.log.1 将被压缩并重命名为 auth.log.2.gz，auth.log
    将成为 auth.log.1，并将创建一个新的文件并命名为 auth.log。默认的日志轮换周期由 /etc/logrotate.conf 文件控制。本列表中所示值在单周活跃后轮换文件，并在四周后删除旧文件。
- en: Listing 11.2\. Some common settings from the /etc/logrotate.conf file
  id: totrans-102
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.2\. 来自 /etc/logrotate.conf 文件的常见设置
- en: '[PRE12]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The /etc/logrotate.d/ directory also contains customized configuration files
    for managing the log rotation of individual services or applications. Listing
    the contents of that directory, you see these config files:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: /etc/logrotate.d/ 目录还包含用于管理单个服务或应用程序日志轮换的自定义配置文件。列出该目录的内容，你会看到这些配置文件：
- en: '[PRE13]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Here’s what the apt config file looks like on my system.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我系统上的 apt 配置文件的样子。
- en: Listing 11.3\. Contents of the /etc/logrotate.d/apt log rotate configuration
    file
  id: totrans-107
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.3\. /etc/logrotate.d/apt 日志轮换配置文件的内容
- en: '[PRE14]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '***1* Files will be rotated 12 times before being deleted.**'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 文件在被删除之前将被轮换 12 次。**'
- en: '***2* Rotations will take place once a month.**'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 轮换将每月进行一次。**'
- en: '***3* Rotated files will be immediately compressed.**'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 轮换的文件将被立即压缩。**'
- en: '|  |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Tip
  id: totrans-113
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 小贴士
- en: Many admins choose to redirect log entries to purpose-built remote log servers
    where the data can receive all the specialized attention it deserves. This can
    free up application servers for their immediate tasks and consolidate log data
    in a single, easily accessible central location.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 许多管理员选择将日志条目重定向到专门构建的远程日志服务器，这样数据就能得到应有的专业关注。这可以释放应用服务器执行其即时任务，并将日志数据集中在一个易于访问的中心位置。
- en: '|  |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 11.3\. Consuming large files
  id: totrans-116
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.3\. 消耗大文件
- en: You know you’ve got better things to do with your time than read through millions
    of lines of log entries. The following sections describe three text-processing
    tools that can do it for you—faster and better.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 你知道你有比阅读数百万行日志条目更好的事情要做。以下几节描述了三种可以为你完成这项工作的文本处理工具——更快、更好。
- en: 11.3.1\. Using grep
  id: totrans-118
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.3.1\. 使用 grep
- en: 'Based on my experience, at least, the most versatile and straightforward tool
    for filtering text is our old friend grep. Here’s an obvious example that will
    search through the auth.log file for evidence of failed login attempts. Searching
    for the word *failure* will return any line containing the phrase *authentication
    failure*. Checking this once in a while can help you spot attempts to compromise
    an account by guessing at the correct password. Anyone can mess up a password
    once or twice, but too many failed attempts should make you suspicious:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我的经验，至少，最灵活且直接的工具是 grep 这个老朋友。以下是一个明显的例子，它将在 auth.log 文件中搜索失败的登录尝试的证据。搜索单词
    *failure* 将返回任何包含短语 *authentication failure* 的行。偶尔检查一下可以帮助你发现通过猜测正确密码来尝试破坏账户的行为：
- en: '[PRE15]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'If you’re the kind of admin who never makes mistakes, then this search might
    come up empty. You can guarantee yourself at least one result by manually generating
    a log entry using a program called logger. Try it out doing something like this:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你是一位从不犯错的管理员，那么这次搜索可能一无所获。你可以通过使用名为 logger 的程序手动生成日志条目来确保至少有一个结果。试着这样做：
- en: '[PRE16]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: You could also pre-seed a genuine error by logging in to a user account and
    entering the wrong password.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 您也可以通过登录用户账户并输入错误的密码来预先设置一个真实的错误。
- en: 'As you can tell, grep did the job for you, but all you can see from the results
    is that there was an authentication failure. Wouldn’t it be useful to know whose
    account was involved? You can expand the results grep returns by telling it to
    include the lines immediately before and after the match. This example prints
    the match along with the lines around it. It tells you that someone using the
    account david (that would be me, I guess) tried unsuccessfully to use `su` (switch
    user) to log in to the studio account:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，grep 为你完成了这项工作，但你从结果中只能看到发生了认证失败。知道涉及的是哪个账户不是很有用吗？你可以通过告诉 grep 包含匹配前后立即的行来扩展
    grep 返回的结果。这个例子打印了匹配项及其周围的行。它告诉你，有人使用账户 david（我想那应该是我）尝试使用 `su`（切换用户）登录到工作室账户，但未能成功：
- en: '[PRE17]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'By the way, you can also use grep to search within multiple files, which I’ve
    personally found useful while writing this book. My problem was that each chapter
    is saved as a separate file in its own directory, so searching, say, for each
    reference to the word *daemon* can get tedious. Because copies of the plain text
    chapter files are also saved to a single manuscript directory, I can move to that
    directory and search using `grep -nr`. There it is, in [chapter 3](kindle_split_011.xhtml#ch03):'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 顺便说一句，你还可以使用 grep 在多个文件中进行搜索，我在写这本书的时候发现这非常有用。我的问题是每个章节都保存在它自己的目录中作为一个单独的文件，所以搜索每个对单词
    *daemon* 的引用可能会变得很繁琐。因为纯文本章节文件的副本也保存在一个单独的手稿目录中，我可以移动到那个目录并使用 `grep -nr` 进行搜索。就在
    [第 3 章](kindle_split_011.xhtml#ch03)：
- en: '[PRE18]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '***1* The n argument tells grep to include line information; the r argument
    returns recursive results.**'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* n 参数告诉 grep 包含行信息；r 参数返回递归结果。**'
- en: '***2* The number 505 in the result tells me that the match appeared on line
    505 in the specified file.**'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 结果中的数字 505 告诉我匹配出现在指定文件的第 505 行。**'
- en: 11.3.2\. Using awk
  id: totrans-130
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.3.2\. 使用 awk
- en: There’s a lot that grep can do, but it’s not omnipotent. Let’s take these entries
    from the /var/log/mysql/error.log file as an example.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: grep 可以做很多事情，但它并非万能。让我们以 /var/log/mysql/error.log 文件中的这些条目为例。
- en: Listing 11.4\. A selection of entries from a /var/log/mysql/error.log file
  id: totrans-132
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.4\. 来自 /var/log/mysql/error.log 文件的一些条目
- en: '[PRE19]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'As you can see, entries are categorized by a priority level enclosed in brackets
    (`[Warning]`, for example). Suppose you’d like to know how many warning messages
    there have been since the log was last rotated. Perhaps you regularly compare
    the numbers with an accepted baseline frequency to know when you might have a
    problem needing investigation. You can grep for each time `[Warning]` shows up
    and then pipe that to `wc`, which will count the lines, words, and characters
    in the output:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，条目是根据括号中包含的优先级进行分类的（例如 `[Warning]`）。假设你想知道自日志上次轮换以来有多少条警告信息。也许你经常将数字与一个接受的基线频率进行比较，以知道何时可能有一个需要调查的问题。你可以使用
    `grep` 搜索 `[Warning]` 出现的每一次，然后将结果通过管道传递给 `wc`，它将计算输出中的行数、单词数和字符数：
- en: '[PRE20]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: It would seem that `[Warning]` shows up 4,219 times. Someone is trying to get
    your attention here. But try the same thing using the awk tool. `wc` will return
    only 204 lines! What’s going on?
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来 `[Warning]` 出现了 4,219 次。有人在这里试图引起你的注意。但尝试使用 awk 工具做同样的事情。`wc` 将只返回 204 行！这是怎么回事？
- en: '[PRE21]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: It seems that grep uses brackets to contain a list of characters and searches
    the text stream for any one of those. Because there are six unique letters in
    *Warning*, pretty much every line in the log file was a match. You could always
    remove the brackets and search for *Warning*, but there might be cases where that
    returns too many false positives.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来 grep 使用括号来包含一个字符列表，并在文本流中搜索这些字符中的任何一个。因为 *Warning* 中有六个独特的字母，所以几乎日志文件中的每一行都是匹配项。你总是可以移除括号并搜索
    *Warning*，但可能会有一些情况，这会导致太多的误报。
- en: 'As long as the search string is enclosed in forward slashes (`/[Warning]/`),
    awk will have no trouble with the brackets. And the sophisticated syntax of awk
    comes with its own distinct benefits. Take that `$3` in the previous example,
    for instance. By default, awk divides a line of text into individual fields, each
    separated by one or more spaces. This log entry, for instance, has seven fields:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 只要搜索字符串被包含在向前斜杠中（`/[Warning]/`），awk 就不会在括号上遇到麻烦。awk 的复杂语法也带来了它自己的独特优势。以之前的例子中的
    `$3` 为例。默认情况下，awk 将一行文本分割成单独的字段，每个字段由一个或多个空格分隔。例如，这个日志条目有七个字段：
- en: '[PRE22]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: grep interprets the final four words (`Shutting down plugin binlog`) as four
    distinct data fields, so it would be hard to figure out a way to usefully search
    those. But the third field represents the entry’s priority level, so you can run
    `awk` with `$3` to return only matching results from that field.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: grep 将最后的四个单词（`Shutting down plugin binlog`）解释为四个不同的数据字段，因此很难找到一种方法来有效地搜索这些字段。但第三个字段代表了条目的优先级，因此你可以运行
    `awk` 并使用 `$3` 来只返回该字段的匹配结果。
- en: 11.3.3\. Using sed
  id: totrans-142
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.3.3\. 使用 sed
- en: 'In case typing `wc` to return the number of lines in a stream doesn’t appeal
    to you, you could always do the same thing with sed, in whose universe `=` will
    print the current line number (`-n` tells sed to not print the text itself):'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不喜欢使用 `wc` 来返回流中的行数，你总是可以用 sed 做同样的事情，在 sed 的世界里 `=` 会打印当前行号（`-n` 告诉 sed
    不要打印文本本身）：
- en: '[PRE23]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: OK, but you’re not likely to ever need to drag out an industrial-strength stream
    editor like sed just to do something simple like count lines. I only brought it
    up as an excuse to introduce you to sed and, in particular, its ability to make
    complex substitutions on text streams.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 好吧，但你可能永远不会需要拖出一个工业级的流编辑器 sed 来做像计数行这样简单的事情。我之所以提到它，只是为了向你介绍 sed，特别是它在文本流上执行复杂替换的能力。
- en: 'Here’s a simple example where sed is given the text *hello world* and told
    to substitute (`s`) the first instance of the word *world* with the word *fishtank*:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一个简单的例子，sed 被给定了文本 *hello world* 并被指示用单词 *fishtank* 替换（`s`）第一个出现的单词 *world*：
- en: '[PRE24]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Adding a `g` before the final quotation mark would tell sed to substitute every
    instance of *world*, assuming there were more than one.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后的引号前加上 `g` 会告诉 sed 替换所有出现的 *world*，假设有多个的话。
- en: That’s nice, but not very useful. Where sed shines is in cleaning up text as
    part of some larger process. Perhaps the next step of a Bash script you’re working
    on needs to operate on only one part of the input it’s receiving. Or maybe you’re
    preparing text so it will be more readable for an end user.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 这很好，但不是很实用。sed 在清理文本作为更大过程中的一个部分时表现得很好。也许你正在工作的 Bash 脚本的下一步需要只操作它接收到的输入的一部分。或者，也许你正在准备文本，以便它对最终用户来说更容易阅读。
- en: 'Let’s say you’ve got a file called numbers.txt that contains some code with
    line numbers. You need to remove the line numbers without messing with the code
    itself, including the lines that are part of the code. Here’s some text you can
    use (paste it into a file on your own computer to follow along):'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你有一个名为numbers.txt的文件，其中包含带有行号的代码。你需要删除行号，同时不修改代码本身，包括代码中的行。以下是一些你可以使用的文本（将它们粘贴到你的电脑上的文件中以便跟随）：
- en: Listing 11.5\. A sample code snippet with unwanted line numbers
  id: totrans-151
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表11.5. 包含不需要行号的示例代码片段
- en: '[PRE25]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Now feed the numbers.txt file to sed: use the caret character (`^`) to point
    sed to the start of each line. Specify any number, and the instance of any number
    at that first position will be deleted. Note how the line numbers have disappeared,
    but the `Item` numbers are still there:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 现在将numbers.txt文件传递给sed：使用插入符字符（`^`）指向sed到每一行的开始。指定任何数字，并删除该位置上任何数字的实例。注意行号已经消失，但`Item`数字仍然存在：
- en: '[PRE26]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Alternatively, you could redirect the output to a new file:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你也可以将输出重定向到新文件：
- en: '[PRE27]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Finally, sed can selectively print only the subdirectories (and not individual
    files) from a directory listing. Here’s what an unfiltered listing would look
    like:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，sed可以选择性地仅打印目录列表中的子目录（而不是单个文件）。以下是一个未过滤的列表看起来会是什么样子：
- en: '[PRE28]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'And here’s how that would go using sed with `^d` to print (`p`) only those
    lines starting with a *d* (which, as you know, designates a directory):'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 使用sed和`^d`来打印（`p`）仅以*d*（正如你所知，表示目录）开头的那些行，以下是这样做的方法：
- en: '[PRE29]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 11.4\. Monitoring with intrusion detection
  id: totrans-161
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.4. 使用入侵检测进行监控
- en: 'Besides logs, there’s another way to monitor your system’s health and welfare:
    intrusion detection. The idea is to create a baseline profile of your system state,
    the way it’s supposed to look, and then scan the system periodically looking for
    the kinds of changes that suggest there’s mischief afoot.'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 除了日志之外，还有另一种方法来监控你系统的健康和福利：入侵检测。想法是创建一个系统状态的基线配置文件，即它应该看起来是什么样子，然后定期扫描系统，寻找表明有恶意行为的变化。
- en: One way to go about this is by implementing a network-based intrusion detection
    System (NIDS), which relies on software (like Snort, Nmap, and Wireshark) to regularly
    “sniff” the network neighborhood looking for devices, open ports, and hosts that
    shouldn’t be there. We’re not going to spend time on NIDS here (although my “Linux
    Network Security” course on Pluralsight does).
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 处理这个问题的一种方法是通过实现基于网络的入侵检测系统（NIDS），它依赖于软件（如Snort、Nmap和Wireshark）定期“嗅探”网络邻居，寻找不应该存在的设备、开放端口和主机。我们在这里不会花费时间在NIDS上（尽管我的“Linux网络安全”课程在Pluralsight上有所涉及）。
- en: Closer to home, you can also build a host-based intrusion detection system (HIDS)
    to keep a steady eye on your server. That’s what we’re going to learn how to do
    using an open source package called Tripwire.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 更接近家庭的是，你也可以构建一个基于主机的入侵检测系统（HIDS），以持续关注你的服务器。这正是我们将学习如何使用一个名为Tripwire的开源软件包来做的。
- en: Tripwire scans your server and adds key attributes of important system files
    (like the file size) to its own database. If any one of those files should be
    edited or deleted, or if new files are added to directories being monitored, those
    attributes will change. When you later tell Tripwire to check the system, it compares
    the current values to the ones stored in the database and reports any discrepancies.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: Tripwire会扫描你的服务器，并将重要系统文件（如文件大小）的关键属性添加到其自己的数据库中。如果这些文件中的任何一个被编辑或删除，或者如果被监控的目录中添加了新文件，这些属性将会改变。当你后来告诉Tripwire检查系统时，它会将当前值与数据库中存储的值进行比较，并报告任何差异。
- en: '|  |'
  id: totrans-166
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-167
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: The Tripwire company also provides a commercial version that offers centralized
    management for multiple installations, policy compliance, support, and compatibility
    with Windows (not that we’ll be needing that one). It’s not cheap, but for enterprise-scaled
    deployments, it can be worth the cost.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: Tripwire公司还提供了一种商业版本，为多个安装提供集中式管理、策略合规性、支持和与Windows的兼容性（尽管我们可能不需要那个）。它并不便宜，但对于企业规模的部署，它可能是值得的。
- en: '|  |'
  id: totrans-169
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: To get Tripwire going, you’ll first install a plain vanilla mail server to send
    email reports to any admins you specify. You’ll install and configure Tripwire
    itself, and then edit and encrypt its policy and configuration files (tw.cfg and
    tw.pol, respectively). Finally, you’ll simulate a system change to see how it
    looks in an emailed report.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 要启动 Tripwire，你首先需要安装一个普通的邮件服务器，以便将电子邮件报告发送到任何指定的管理员。然后，你将安装和配置 Tripwire 本身，并编辑和加密其策略和配置文件（分别是
    tw.cfg 和 tw.pol）。最后，你将模拟系统更改，以查看电子邮件报告中的外观。
- en: 11.4.1\. Setting up a mail server
  id: totrans-171
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.4.1\. 设置邮件服务器
- en: 'Creating a basic Linux mail server is a lot easier than you might think. Install
    the postfix (and, for Ubuntu, mailutils) package. During installation (for Ubuntu,
    at least), select Internet Site when prompted for a mail configuration type and
    localhost.localdomain for your system mail name. You’ll also want to make sure
    the inet_interfaces setting in the /etc/postfix/main.cf file is set to localhost.
    All that’s left is to make sure port 25 is open for SMTP on any firewall you’ve
    got running and to restart postfix:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 创建基本的 Linux 邮件服务器比你想象的要容易得多。安装 postfix（对于 Ubuntu，还需要 mailutils）软件包。在安装过程中（至少对于
    Ubuntu），当被提示选择邮件配置类型时，选择 Internet Site，并为你的系统邮件名称选择 localhost.localdomain。你还需要确保
    /etc/postfix/main.cf 文件中的 inet_interfaces 设置为 localhost。剩下的只是确保在运行中的任何防火墙上都打开
    SMTP 的 25 端口，并重新启动 postfix：
- en: '[PRE30]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: That wasn’t so bad, was it? You should now have an active mail server that can
    send emails to remote recipients. It’s not ready to handle incoming mail, but
    you don’t need that for this project.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 这并不难，对吧？你现在应该有一个可以发送电子邮件到远程收件人的活动邮件服务器。它还没有准备好处理传入的邮件，但在这个项目中你不需要这个功能。
- en: '|  |'
  id: totrans-175
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**How do you know your mail server is operational?**'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '**如何知道你的邮件服务器是否运行正常？**'
- en: Send some mail to a local address (named, for example, Steve) using `sendmail
    steve`. You’ll be faced with a blank line on which you’re expected to type your
    message, followed by a hard return, a single dot, and another hard return. Steve
    can collect his email by typing `mail` on his command line.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `sendmail steve` 向本地地址（例如，命名为 Steve）发送邮件。你将面对一个空白行，你需要在上面输入你的消息，然后是硬回车，一个点，再是硬回车。Steve
    可以通过在命令行中输入 `mail` 来收集他的电子邮件。
- en: '|  |'
  id: totrans-178
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 11.4.2\. Installing Tripwire
  id: totrans-179
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.4.2\. 安装 Tripwire
- en: Installation is straightforward, although there are some minor variations between
    Ubuntu and CentOS. I’ll cover each in its own section.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 安装过程很简单，尽管 Ubuntu 和 CentOS 之间有一些细微的差异。我将在各自的章节中介绍每个差异。
- en: Ubuntu
  id: totrans-181
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: Ubuntu
- en: As apt installs the Tripwire package, you’ll be prompted to create new passphrases
    for two sets of signing keys. This process will briefly leave your passphrase
    unencrypted and exposed to anyone else who happens to be logged in to your system
    ([figure 11.3](#ch11fig03)).
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 当 apt 安装 Tripwire 软件包时，你将被提示为两套签名密钥创建新的密码短语。这个过程将暂时使你的密码短语未加密且暴露给任何可能登录到你的系统的人
    ([图 11.3](#ch11fig03))。
- en: Figure 11.3\. Warning screen from the Debian/Ubuntu installation process for
    Tripwire
  id: totrans-183
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 11.3\. Debian/Ubuntu 安装过程中 Tripwire 的警告屏幕
- en: '![](Images/11fig03_alt.jpg)'
  id: totrans-184
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig03_alt.jpg)'
- en: After creating passphrases from both sets of keys, you’ll be asked whether you
    want to rebuild the encrypted Tripwire configuration file ([figure 11.4](#ch11fig04)).
    Rebuilding the configuration and policy files is required after any edits to their
    source text files. You’ll see how to do it manually later, but this first time
    the Tripwire installation does it for you.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在从两套密钥中创建密码短语后，你将被询问是否要重建加密的 Tripwire 配置文件 ([图 11.4](#ch11fig04))。在编辑其源文本文件后，需要重建配置和政策文件。你将在稍后了解如何手动完成，但这次
    Tripwire 安装会为你完成。
- en: Figure 11.4\. Final screen before Tripwire rebuilds the encrypted configuration
    file
  id: totrans-186
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 11.4\. 在 Tripwire 重建加密配置文件之前的最终屏幕
- en: '![](Images/11fig04_alt.jpg)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig04_alt.jpg)'
- en: When the installation is complete, you’ll be shown a screen ([figure 11.5](#ch11fig05))
    containing information about the locations of key Tripwire files. Make a note
    of those, and in particular note the location of the documentation in /usr/share/.
    As you might expect, there are also configuration files in the /etc/tripwire/
    directory.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，你将看到一个包含关键 Tripwire 文件位置的屏幕 ([图 11.5](#ch11fig05))。记下这些信息，特别是注意 /usr/share/
    中的文档位置。正如你所期望的，/etc/tripwire/ 目录中也有配置文件。
- en: Figure 11.5\. When installation completes, Tripwire displays the locations of
    important files.
  id: totrans-189
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 11.5\. 安装完成后，Tripwire 显示重要文件的位置。
- en: '![](Images/11fig05_alt.jpg)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig05_alt.jpg)'
- en: CentOS
  id: totrans-191
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: CentOS
- en: CentOS installation lacks the fancy, cutting-edge, vintage 1980’s graphics accompanying
    the Ubuntu wizard. In fact, assuming you already have the epel-release repository
    installed (`install epel-release`), it’s a matter of installing the Tripwire package
    and watching the lines of text fly by.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: CentOS的安装缺少Ubuntu向导所伴随的复杂、前沿、复古1980年代的图形界面。实际上，假设你已经安装了epel-release仓库（`install
    epel-release`），那么只需安装Tripwire软件包并观察文本行飞快地滚动即可。
- en: 'In CentOS, the signing keys are created by running a program called tripwire-setup-keyfiles
    after the main installation. There you’ll be prompted to create two passphrases.
    Once the installation is done (for both Ubuntu and CentOS), you’ll need to run
    `tripwire --init` to initialize the database:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在CentOS中，在主要安装完成后，通过运行名为tripwire-setup-keyfiles的程序来创建签名密钥。在那里，你会被提示创建两个密码短语。一旦安装完成（对于Ubuntu和CentOS都适用），你需要运行`tripwire
    --init`来初始化数据库：
- en: '[PRE31]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'If you’re setting up Tripwire on an LXC container, be aware that you’ll likely
    see a lot of errors like these:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在一个LXC容器上设置Tripwire，请注意你可能会看到很多这样的错误：
- en: '[PRE32]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: This is happening because some of the system files normally monitored by Tripwire
    are being shared with the container’s host. This means that processes running
    in the container may not always have full access. Don’t worry, though. Other than
    producing lots of nasty-looking error messages, this won’t have any impact on
    the way Tripwire works.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 这是因为一些通常由Tripwire监控的系统文件正在与容器的宿主机共享。这意味着在容器中运行的过程可能不会始终拥有完全访问权限。不过，不用担心。除了产生大量难看的错误消息外，这不会对Tripwire的工作方式产生影响。
- en: 11.4.3\. Configuring Tripwire
  id: totrans-198
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.4.3\. 配置Tripwire
- en: 'You control the way Tripwire behaves through two files kept in the /etc/tripwire/
    directory: tw.cfg and tw.pol. The thing is, those files are encrypted and are
    not only impossible to edit but, unless you’ve got some special superhero skills,
    they’re unreadable, too. The files are built from the information in two plain
    text files: twcfg.txt and twpol.txt.'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 你通过在`/etc/tripwire/`目录中保留的两个文件来控制Tripwire的行为：tw.cfg和tw.pol。问题是，这些文件是加密的，不仅无法编辑，而且除非你有特殊超级英雄技能，否则也无法阅读。这些文件是从两个纯文本文件中的信息构建的：twcfg.txt和twpol.txt。
- en: The twcfg.txt file contains some basic environment variables, all of which you
    can change to fit your needs. Most of them will work perfectly well right out
    of the box. But changing some of the file locations can add a layer of security
    through obscurity, especially if you’re concerned that the bad guys might be looking
    to identify and disable the alarm system before getting down to do their work.
    If you do decide to move things around, twcfg.txt is the file you’ll edit.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: twcfg.txt文件包含一些基本的环境变量，你都可以根据需要更改。大多数变量将直接正常工作。但更改一些文件位置可以通过隐蔽性增加一层安全性，特别是如果你担心坏人可能会在开始工作之前识别并禁用警报系统。如果你决定移动某些内容，twcfg.txt是你要编辑的文件。
- en: Listing 11.6\. The default contents of the twcfg.txt file
  id: totrans-201
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表11.6\. twcfg.txt文件的默认内容
- en: '[PRE33]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '***1* Note how the report filename reflects the server’s hostname for easy
    identification.**'
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 注意报告文件名如何反映了服务器的主机名，以便于识别。**'
- en: '***2* You can change the default text editor to Nano if you’re more comfortable
    with it.**'
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 如果你更习惯使用Nano文本编辑器，你可以将其设置为默认文本编辑器。**'
- en: '***3* You may find changing the verbosity setting to 1 will make reports easier
    to read.**'
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 你可能会发现将详细程度设置改为1会使报告更容易阅读。**'
- en: 'One thing you’ll want to add to this file is the email address (or addresses)
    where you’d like reports to be sent. You do this by adding a `GLOBALEMAIL` line
    pointing to your address:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要添加到这个文件中的一个是你希望报告发送到的电子邮件地址（或地址）。你可以通过添加一个指向你地址的`GLOBALEMAIL`行来实现：
- en: '[PRE34]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: The twpol.txt file sets the policies Tripwire will use to categorize and scan
    your file system. The file gives you a working generic policy, but you’ll almost
    certainly need to make at least some customizations to accommodate your particular
    server setup. You can add those customizations gradually over time, as you get
    a feel for the kinds of false positives you’re seeing in reports, and for the
    things Tripwire might be missing.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: twpol.txt文件设置了Tripwire将用于分类和扫描文件系统的策略。该文件提供了一个工作通用的策略，但你几乎肯定需要至少进行一些定制以适应你特定的服务器配置。你可以随着时间的推移逐渐添加这些定制，因为你会了解你在报告中看到的假阳性类型，以及Tripwire可能遗漏的事情。
- en: You’ll probably get a feel for the kinds of false positives your system will
    produce pretty quickly. Likely culprits include process ID (PID) files and configuration
    files for applications you’re actively working on. Once you’ve run Tripwire a
    couple of times and start to recognize the false positives, look through the twpol.txt
    file for the line referencing the offending file (the line for the bashrc file,
    for instance, would look like `/etc/bashrc -> $(SEC_CONFIG) ;`) and comment it
    out with the *#* character (meaning, `#/etc/bashrc -> $(SEC_CONFIG) ;`).
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会很快对系统产生的假阳性有感觉。可能的原因包括正在积极工作的应用程序的进程 ID (PID) 文件和配置文件。一旦你运行了几次 Tripwire
    并开始识别假阳性，就查看 twpol.txt 文件中引用受影响文件的行（例如，bashrc 文件的行可能看起来像 `/etc/bashrc -> $(SEC_CONFIG)
    ;`）并使用 *#* 字符将其注释掉（意味着，`#/etc/bashrc -> $(SEC_CONFIG) ;`）。
- en: Browse through the twpol.txt file you’ve installed on your own server, and note
    the way policies are defined by rules with names like Invariant Directories. Each
    rule is assigned a severity level (like `SIG_MED`, for medium significance, in
    the following listing). An *Invariant* designation means that you don’t expect
    such objects to change permission or ownership, and that you should therefore
    be alerted if such events do occur.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 浏览你安装在自己服务器上的 twpol.txt 文件，并注意策略是通过具有“不变目录”等名称的规则定义的。每个规则都被分配了一个严重级别（如列表中所示的
    `SIG_MED`，表示中等重要性）。*不变* 标识意味着你不期望此类对象更改权限或所有权，因此如果发生此类事件，你应该收到警告。
- en: Listing 11.7\. A sample Tripwire policy rule from the twpol.txt file
  id: totrans-211
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.7\. 来自 twpol.txt 文件的示例 Tripwire 策略规则
- en: '[PRE35]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: Obviously, you’re free to edit the contents and values of any of the dozen or
    so rules that make up Tripwire policy to suit your needs. The file is well documented,
    so spending 10 or 15 minutes reading through it should make the kinds of things
    you can do with it quite clear.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，你可以自由编辑构成 Tripwire 策略的十几个规则的内容和值以适应你的需求。该文件有很好的文档说明，所以花上 10 或 15 分钟阅读它应该会使你可以用它做什么变得很清楚。
- en: 'After editing the plain text files, and assuming you’re in the same directory,
    update the encrypted versions using `twadmin --create-cfgfile` and `twadmin --create-polfile`:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 在编辑纯文本文件后，假设你仍在同一目录下，使用 `twadmin --create-cfgfile` 和 `twadmin --create-polfile`
    更新加密版本：
- en: '[PRE36]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Because the source files are in plain text, you should delete those as soon
    as their settings have been successfully incorporated into their encrypted cousins:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 由于源文件是纯文本格式，你应该在它们的设置成功集成到加密版本后立即删除它们：
- en: '[PRE37]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'If, sometime in the future, you need to update your configuration, you can
    recover the original values by running `twadmin --print-cfgfile` or `twadmin --print-polfile`.
    Those commands give you a file in which you can make any necessary edits:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在未来某个时候你需要更新你的配置，你可以通过运行 `twadmin --print-cfgfile` 或 `twadmin --print-polfile`
    来恢复原始值。这些命令会给你一个文件，你可以在其中进行任何必要的编辑：
- en: '[PRE38]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'It’s time to take Tripwire out for a test drive. On the command line, `tripwire`
    takes many arguments with a `-m` prefix, where `m` stands for module, so `-m c`
    would load the check module. Running a check prints a report to the screen that
    will (probably) mostly consist of dozens of file system error messages about files
    and directories that aren’t there:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 是时候对 Tripwire 进行测试运行了。在命令行中，`tripwire` 接受许多带有 `-m` 前缀的参数，其中 `m` 代表模块，所以 `-m
    c` 就会加载检查模块。运行检查会在屏幕上打印报告，该报告（可能）主要包含关于文件和目录不存在的数十个文件系统错误信息：
- en: '[PRE39]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Now you can update the Tripwire database based on the results of the previous
    scan:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你可以根据之前扫描的结果更新 Tripwire 数据库：
- en: '[PRE40]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'It’s possible that Tripwire will complain that it’s unable to open the report
    file. If that happens, run `--update -r` against the most recent file currently
    in the /var/lib/ tripwire/report/ directory. You’ll be shown the report in a text
    editor. Exit, and the update will continue (`:q!` should do the trick if you find
    yourself in the vi editor):'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 有可能 Tripwire 会抱怨它无法打开报告文件。如果发生这种情况，请在 /var/lib/tripwire/report/ 目录中最新的文件上运行
    `--update -r`。你将在文本编辑器中看到报告。退出，更新将继续（如果你在 vi 编辑器中，`:q!` 应该可以解决问题）：
- en: '[PRE41]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: '***1* You don’t need to include the full filename, including its date/time
    stamp, as long as you include enough to be unique.**'
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 你不需要包含包括日期/时间戳在内的完整文件名，只要包含足够的信息以保持唯一性即可。**'
- en: 11.4.4\. Generating a test Tripwire report
  id: totrans-227
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.4.4\. 生成测试 Tripwire 报告
- en: 'Let’s make some trouble and see whether Tripwire will notice. Adding a new
    user to the system will leave fingerprints all over the place. At the very least,
    the passwd, shadow, and group files in /etc/ will be updated. Give your friend
    Max an account and password:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们制造一些麻烦，看看 Tripwire 是否会注意到。向系统中添加新用户会在各个地方留下指纹。至少，/etc/ 目录中的 passwd、shadow
    和 group 文件将被更新。给你的朋友 Max 创建一个账户和密码：
- en: '[PRE42]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Now run `tripwire`, specifying that an email report should be sent using level
    1 verbosity:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 现在运行 `tripwire`，指定使用 1 级详细程度发送电子邮件报告：
- en: '[PRE43]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'If everything works out, you should receive an email that includes text like
    this:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切顺利，你应该会收到一封包含如下文本的电子邮件：
- en: '[PRE44]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: What’s left? Once you’re done fine-tuning your policies, you can add `tripwire
    --check` and `tripwire -m u` commands to cron to automate the process. Happy hunting!
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 还剩下什么？一旦你完成了策略的微调，你可以添加 `tripwire --check` 和 `tripwire -m u` 命令到 cron 中以自动化此过程。祝您狩猎愉快！
- en: Summary
  id: totrans-235
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 摘要
- en: Journald logging is built around a binary journal file that can be finely parsed
    using journalctl to target specific matches.
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Journald 日志是基于二进制日志文件构建的，可以使用 journalctl 进行精细解析，以针对特定的匹配项。
- en: Log files grow quickly and must be controlled through a rotation regimen that
    takes business and regulatory needs into account.
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志文件增长迅速，必须通过考虑业务和监管需求的轮换计划来控制。
- en: 'The grep, awk, and sed text-filtering and -formatting tools can be used to
    manage large volumes of data: grep, by string matches; awk, by breaking strings
    down into fields; and sed, through string substitution.'
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: grep、awk 和 sed 文本过滤和格式化工具可以用于管理大量数据：grep 通过字符串匹配；awk 通过将字符串分解成字段；sed 通过字符串替换。
- en: Tripwire can be used for ongoing server monitoring to alert admins should it
    sense the presence of suspicious behavior.
  id: totrans-239
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tripwire 可以用于持续的服务器监控，以便在检测到可疑行为时提醒管理员。
- en: Key terms
  id: totrans-240
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 关键术语
- en: '*Journald* stores its log data in a binary file, which allows for more flexible
    retrieval but requires a running host system.'
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Journald* 将其日志数据存储在二进制文件中，这允许更灵活的检索，但需要运行中的主机系统。'
- en: On a *syslogd* system, all log events are written to the /var/log/syslog file.
  id: totrans-242
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在一个 *syslogd* 系统上，所有日志事件都写入 /var/log/syslog 文件。
- en: '*Log rotation* for syslogd log files is controlled through the /etc/logrotate.conf
    file and through individual files in the /etc/logrotate.d/ directory.'
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*日志轮转* 对于 syslogd 日志文件是通过 /etc/logrotate.conf 文件以及 /etc/logrotate.d/ 目录中的单个文件来控制的。'
- en: A *text stream filter* (like grep) searches text for matching strings and, usually,
    returns the entire line containing the match.
  id: totrans-244
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 *文本流过滤器*（如 grep）在文本中搜索匹配的字符串，并且通常返回包含匹配的整个行。
- en: A *network-based intrusion detection system* (NIDS) monitors a private network
    for evidence of infiltration.
  id: totrans-245
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 *基于网络的入侵检测系统*（NIDS）监控私有网络，以查找入侵的证据。
- en: A *host-based intrusion detection system* (HIDS) monitors servers for evidence
    system files have been maliciously altered.
  id: totrans-246
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 *基于主机的入侵检测系统*（HIDS）监控服务器，以查找系统文件被恶意篡改的证据。
- en: A *mail server* allows emails to be sent and received by applications or at
    the command-line level.
  id: totrans-247
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 *邮件服务器* 允许应用程序或命令行级别发送和接收电子邮件。
- en: Security best practices
  id: totrans-248
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安全最佳实践
- en: Regularly scan the auth.log file for evidence of repeated failed attempts to
    access user accounts.
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定期扫描 auth.log 文件，查找重复尝试访问用户账户的证据。
- en: Configure scanning software like an intrusion detection system to push alerts
    to admins when potentially compromising events occur.
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置扫描软件，如入侵检测系统，在发生可能损害的事件时向管理员推送警报。
- en: The original plain text files used to create encrypted Tripwire configuration
    and policy files should be deleted immediately after use.
  id: totrans-251
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建加密 Tripwire 配置和政策文件后，应立即删除原始的纯文本文件。
- en: Command-line review
  id: totrans-252
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 命令行审查
- en: Alt-F<n> opens a virtual console from a non-GUI shell.
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Alt-F<n> 从非 GUI 终端打开一个虚拟控制台。
- en: '`journalctl -n 20` displays the 20 most recent log entries in the journal.'
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`journalctl -n 20` 显示日志中的 20 个最新条目。'
- en: '`journalctl --since 15:50:00 --until 15:52:00` displays only events between
    the *since* and *until* times.'
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`journalctl --since 15:50:00 --until 15:52:00` 仅显示 *since* 和 *until* 时间之间的事件。'
- en: '`systemd-tmpfiles --create --prefix /var/log/journal` instructs systemd to
    create and maintain a persistent journal rather than a file that’s destroyed with
    every boot.'
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`systemd-tmpfiles --create --prefix /var/log/journal` 指示 systemd 创建并维护一个持久的日志，而不是每次启动时被销毁的文件。'
- en: '`cat /var/log/auth.log | grep -B 1 -A 1 failure` displays matching lines along
    with the lines immediately before and after.'
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cat /var/log/auth.log | grep -B 1 -A 1 failure` 显示匹配的行以及其前后立即的行。'
- en: '`cat /var/log/mysql/error.log | awk ''$3 ~/[Warning]/'' | wc` searches the
    MySQL error log for events classified as a warning.'
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cat /var/log/mysql/error.log | awk ''$3 ~/[Warning]/'' | wc` 在MySQL错误日志中搜索被分类为警告的事件。'
- en: '`sed "s/^` **`[0-9]`** `//g" numbers.txt` removes numbers at the start of each
    line of a file.'
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sed "s/^` **`[0-9]`** `//g" numbers.txt` 从文件的每一行开头删除数字。'
- en: '`tripwire --init` initializes the database of a Tripwire installation.'
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`tripwire --init` 初始化Tripwire安装的数据库。'
- en: '`twadmin --create-cfgfile --site-keyfile site.key twcfg.txt` generates a new
    encrypted tw.cfg file for Tripwire.'
  id: totrans-261
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`twadmin --create-cfgfile --site-keyfile site.key twcfg.txt` 为Tripwire生成一个新的加密tw.cfg文件。'
- en: Test yourself
  id: totrans-262
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 测试自己
- en: '**[1](#ch11qa2q0a1)**'
  id: totrans-263
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[1](#ch11qa2q0a1)**'
- en: ''
  id: totrans-264
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The /dev/log pseudo device is used for
  id: totrans-265
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: /dev/log伪设备用于
- en: ''
  id: totrans-266
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Storing the journald ephemeral journal file
  id: totrans-267
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 存储journald的临时日志文件
- en: Storing the journald persistent journal file
  id: totrans-268
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 存储journald的持久日志文件
- en: Collecting log event data for syslogd
  id: totrans-269
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 收集syslogd的日志事件数据
- en: Storing log even data collected by syslogd
  id: totrans-270
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 存储由syslogd收集的日志事件数据
- en: '**[2](#ch11qa2q0a2)**'
  id: totrans-271
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[2](#ch11qa2q0a2)**'
- en: ''
  id: totrans-272
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following commands will display the five most recent log entries
    in the journal file?
  id: totrans-273
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个命令将显示日志文件中的五条最新日志条目？
- en: ''
  id: totrans-274
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`journalctl -l 5`'
  id: totrans-275
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`journalctl -l 5`'
- en: '`journalctl -n 5`'
  id: totrans-276
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`journalctl -n 5`'
- en: '`journalctl -f 5`'
  id: totrans-277
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`journalctl -f 5`'
- en: '`journalctl --since 5`'
  id: totrans-278
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`journalctl --since 5`'
- en: '**[3](#ch11qa2q0a3)**'
  id: totrans-279
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[3](#ch11qa2q0a3)**'
- en: ''
  id: totrans-280
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following directives would send only kernel-related emergency messages
    to the existing kern.log file?
  id: totrans-281
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个指令只会将内核相关的紧急消息发送到现有的kern.log文件？
- en: ''
  id: totrans-282
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`kern.emerg -/var/log/kern` in the /etc/rsyslog.d/50-default.conf file'
  id: totrans-283
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`/etc/rsyslog.d/50-default.conf` 文件中的 `kern.emerg -/var/log/kern`'
- en: '`kern.* -/var/lib/kern.log` in the /etc/rsyslog.d/50-default.conf file'
  id: totrans-284
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`/etc/rsyslog.d/50-default.conf` 文件中的 `kern.* -/var/lib/kern.log`'
- en: '`*.emerg -/var/log/kern.log` in the /etc/rsyslog.d/30-default.conf file'
  id: totrans-285
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`/etc/rsyslog.d/30-default.conf` 文件中的 `*.emerg -/var/log/kern.log`'
- en: '`kern.emerg -/var/log/kern.log` in the /etc/rsyslog.d/50-default.conf file'
  id: totrans-286
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`/etc/rsyslog.d/50-default.conf` 文件中的 `kern.emerg -/var/log/kern.log`'
- en: '**[4](#ch11qa2q0a4)**'
  id: totrans-287
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[4](#ch11qa2q0a4)**'
- en: ''
  id: totrans-288
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which configuration file is used to control the log-rotation policies for files
    in /var/log/?
  id: totrans-289
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 用于控制/var/log/中文件日志轮转策略的配置文件是哪个？
- en: ''
  id: totrans-290
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: /etc/logrotate.conf
  id: totrans-291
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: /etc/logrotate.conf
- en: /etc/systemd/journal.conf
  id: totrans-292
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: /etc/systemd/journal.conf
- en: /etc/logrotate.d
  id: totrans-293
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: /etc/logrotate.d
- en: /etc/rsyslog.conf
  id: totrans-294
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: /etc/rsyslog.conf
- en: '**[5](#ch11qa2q0a5)**'
  id: totrans-295
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[5](#ch11qa2q0a5)**'
- en: ''
  id: totrans-296
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: What arguments will tell grep to include surrounding lines of text along with
    the matching line it displays?
  id: totrans-297
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 哪些参数会告诉grep在显示匹配行的同时包括周围的文本行？
- en: ''
  id: totrans-298
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`cat /var/log/auth.log | grep --B 1 --A 1 failure`'
  id: totrans-299
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`cat /var/log/auth.log | grep --B 1 --A 1 failure`'
- en: '`cat /var/log/auth.log | grep --since 1 --until 1 failure`'
  id: totrans-300
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`cat /var/log/auth.log | grep --since 1 --until 1 failure`'
- en: '`cat /var/log/auth.log | grep -B 1 -A 1 failure`'
  id: totrans-301
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`cat /var/log/auth.log | grep -B 1 -A 1 failure`'
- en: '`cat /var/log/auth.log | grep -b 1 -a 1 failure`'
  id: totrans-302
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`cat /var/log/auth.log | grep -b 1 -a 1 failure`'
- en: '**[6](#ch11qa2q0a6)**'
  id: totrans-303
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[6](#ch11qa2q0a6)**'
- en: ''
  id: totrans-304
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following sed commands will remove line numbers from lines of text?
  id: totrans-305
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个sed命令将删除文本行的行号？
- en: ''
  id: totrans-306
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`sed "s/^ [0-9] //g"`'
  id: totrans-307
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`sed "s/^ [0-9] //g"`'
- en: '`sed -n ''/^d/ p''`'
  id: totrans-308
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`sed -n ''/^d/ p''`'
- en: '`sed -n ''/^d/ [0-9] p''`'
  id: totrans-309
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`sed -n ''/^d/ [0-9] p''`'
- en: '`sed "s/^ [0-9] //"`'
  id: totrans-310
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`sed "s/^ [0-9] //"`'
- en: '**[7](#ch11qa2q0a7)**'
  id: totrans-311
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[7](#ch11qa2q0a7)**'
- en: ''
  id: totrans-312
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following commands will prepare the Tripwire database for operation?
  id: totrans-313
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个命令将为Tripwire数据库准备操作？
- en: ''
  id: totrans-314
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`tripwire-setup-keyfiles`'
  id: totrans-315
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`tripwire-setup-keyfiles`'
- en: '`tripwire --init`'
  id: totrans-316
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`tripwire --init`'
- en: '`twadmin --create-polfile twpol.txt`'
  id: totrans-317
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`twadmin --create-polfile twpol.txt`'
- en: '`tripwire -m c`'
  id: totrans-318
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`tripwire -m c`'
- en: '**[8](#ch11qa2q0a8)**'
  id: totrans-319
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[8](#ch11qa2q0a8)**'
- en: ''
  id: totrans-320
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of these commands contains the appropriate syntax to encrypt and update
    the Tripwire configuration file?
  id: totrans-321
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 哪个命令包含适当的语法来加密并更新Tripwire配置文件？
- en: ''
  id: totrans-322
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`wadmin --create-polfile --site-keyfile site.key twcfg.txt`'
  id: totrans-323
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`wadmin --create-polfile --site-keyfile site.key twcfg.txt`'
- en: '`wadmin --create-cfgfile --site-keyfile site.key twcfg.txt`'
  id: totrans-324
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`wadmin --create-cfgfile --site-keyfile site.key twcfg.txt`'
- en: '`wadmin --create-cfgfile --local-keyfile local.key twcfg.txt`'
  id: totrans-325
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`wadmin --create-cfgfile --local-keyfile local.key twcfg.txt`'
- en: '`wadmin --create-cfgfile --site-keyfile site.key twpol.txt`'
  id: totrans-326
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`wadmin --create-cfgfile --site-keyfile site.key twpol.txt`'
- en: Answer key
  id: totrans-327
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 答案键
- en: '**[1.](#ch11qa1q1)**'
  id: totrans-328
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[1.](#ch11qa1q1)**'
- en: ''
  id: totrans-329
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: c
  id: totrans-330
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: c
- en: '**[2.](#ch11qa1q2)**'
  id: totrans-331
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[2.](#ch11qa1q2)**'
- en: ''
  id: totrans-332
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: b
  id: totrans-333
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: b
- en: '**[3.](#ch11qa1q3)**'
  id: totrans-334
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[3.](#ch11qa1q3)**'
- en: ''
  id: totrans-335
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: d
  id: totrans-336
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: d
- en: '**[4.](#ch11qa1q4)**'
  id: totrans-337
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[4.](#ch11qa1q4)**'
- en: ''
  id: totrans-338
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: a
  id: totrans-339
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: a
- en: '**[5.](#ch11qa1q5)**'
  id: totrans-340
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[5.](#ch11qa1q5)**'
- en: ''
  id: totrans-341
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: c
  id: totrans-342
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: c
- en: '**[6.](#ch11qa1q6)**'
  id: totrans-343
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[6.](#ch11qa1q6)**'
- en: ''
  id: totrans-344
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: a
  id: totrans-345
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: a
- en: '**[7.](#ch11qa1q7)**'
  id: totrans-346
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[7.](#ch11qa1q7)**'
- en: ''
  id: totrans-347
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: b
  id: totrans-348
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: b
- en: '**[8.](#ch11qa1q8)**'
  id: totrans-349
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[8.](#ch11qa1q8)**'
- en: ''
  id: totrans-350
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: b
  id: totrans-351
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: b
