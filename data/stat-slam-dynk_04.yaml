- en: 4 Constrained optimization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 4 约束优化
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Adding comments to your R code
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在R代码中添加注释
- en: Visualizing data distributions with density plots
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用密度图可视化数据分布
- en: Visualizing the correlation between just two variables at a time
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同时可视化两个变量的相关性
- en: Defining constrained optimization
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义约束优化
- en: Applying the constrained optimization method
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应用约束优化方法
- en: How often have you been asked to do more with less? In other words, what you’re
    really being asked is to make the *most* of a situation compromised by trying
    circumstances. Constrained optimization is the operations research and quantitative
    solution to that end. In this chapter, we’ll demonstrate how to organize and execute
    a typical constrained optimization problem. To accomplish this goal, we have a
    fictional NBA team fixed on acquiring veteran players from the free agent market.
    Their objective is *not* to acquire the five best players available, but the five
    best players that meet their specific requirements and needs. Our hypothesis,
    therefore, is that constrained optimization can successfully isolate the best
    group of free agents this team should acquire without breaching any of the constraints
    established in advance.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 你有多少次被要求在资源有限的情况下做更多的事情？换句话说，你真正被要求的是在不利情况下最大限度地利用一个受限制的情况。约束优化是针对这一目标的运筹学和定量解决方案。在本章中，我们将展示如何组织和执行一个典型的约束优化问题。为了实现这一目标，我们有一个虚构的NBA球队，专注于从自由球员市场上收购老将球员。他们的目标不是收购五个最好的球员，而是五个符合他们具体需求和要求的最佳球员。因此，我们的假设是，约束优化可以成功地隔离出这个球队应该收购的最佳自由球员组合，而不会违反事先设定的任何约束。
- en: 4.1 What is constrained optimization?
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.1 什么是约束优化？
- en: '*Constrained optimization* is a method or technique that seeks to minimize
    or maximize some function while subject to constraints that curb freedom of movement.
    One such method might minimize costs or the depletion of resources; another might
    maximize profit margins. Constraints are effectively boundaries that can’t be
    breached while crunching numbers to maximize or minimize some defined function.
    There are many use cases for constrained optimization:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '**约束优化**是一种方法或技术，旨在在受到限制的情况下最小化或最大化某个函数，这些限制限制了行动的自由度。一种方法可能最小化成本或资源的消耗；另一种方法可能最大化利润率。约束是有效的边界，在计算最大化或最小化某个定义的函数时，不能越界。约束优化有许多应用案例：'
- en: A chief financial officer, reviewing a long list of capital projects to fund
    against severe budgetary and resource constraints, needs to approve a subset of
    these projects to maximize the top line and load balance the projects across different
    departments.
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 首席财务官在审查一份长长的资本项目清单，以应对严重的预算和资源限制时，需要批准其中的一部分项目，以最大化收入并平衡不同部门的项目。
- en: 'A triathlete needs the following on the bike: tools and spare parts in case
    of a flat tire or mechanical failure; water and a power drink to stay hydrated;
    salt tablets to cure cramps; and some combination of energy chews, energy gels,
    and Snickers bars to stay fueled. Between one saddle bag, two water bottle cages,
    and the rear pockets of the jersey, the triathlete must decide beforehand how
    to best use those spaces.'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 三项铁人运动员在自行车上需要以下物品：工具和备用零件，以防出现爆胎或机械故障；水和能量饮料以保持水分；盐片以治疗抽筋；以及一些能量棒、能量凝胶和士力架巧克力棒的组合，以保持能量。在一只鞍包、两个水瓶架和运动衫后口袋之间，铁人运动员必须事先决定如何最好地利用这些空间。
- en: For our purposes, a general manager of an NBA team is evaluating several players
    in the free agent market.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 就我们的目的而言，一个NBA球队的总经理正在评估自由球员市场上的几位球员。
- en: 'Our fictional NBA team intends to rebuild its roster, not through the draft,
    but rather by acquiring veteran players on the free agent market:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的虚构NBA球队打算通过自由球员市场而不是选秀来重建阵容：
- en: The team is assessing 24 free agents of which they intend to sign *exactly*
    5 players. That’s their first requirement or constraint (these terms are used
    interchangeably in this chapter).
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 该团队正在评估24名自由球员，他们打算签约**正好**5名球员。这是他们的第一个要求或约束（在本章中，这些术语可以互换使用）。
- en: 'They want one player for each position: one point guard, one shooting guard,
    one center, one power forward, and one small forward. That’s their second requirement.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们希望每个位置都有一个球员：一个控球后卫、一个得分后卫、一个中锋、一个大前锋和一个小前锋。这是他们的第二个要求。
- en: Player salary demands are known and fixed. The team is willing to spend no more
    than $90 million (M) in annual salaries between the five players they acquire.
    That’s their third requirement. It doesn’t matter how the $90 M is distributed;
    all that matters is the total sum.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 球员的薪资要求是已知且固定的。球队愿意为五名他们收购的球员支付的年薪总额不超过 9000 万美元（M）。这是他们的第三项要求。90 M 美元如何分配无关紧要；重要的是总额。
- en: The average age of whatever five players they acquire must be equal to or less
    than 30\. That’s their fourth and final requirement. Individual ages don’t matter;
    all that matters is that the mean must be equal to or less than 30.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们收购的五名球员的平均年龄必须等于或小于 30 岁。这是他们的第四和最后一项要求。个别年龄无关紧要；重要的是平均值必须等于或小于 30。
- en: The flip side of the equation is the function that should be minimized or, in
    our case, maximized. The team’s assessment included annual win share projections
    for each of the 24 free agents based on actual win shares from prior seasons,
    career trajectory, age, and other factors. Our fictional NBA team wants to maximize
    win shares while obeying *all* the constraints itemized here. Let’s get started.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 方程的另一方面是应该最小化或，在我们的情况下，最大化的函数。球队的评估包括基于前几个赛季的实际赢分、职业生涯轨迹、年龄和其他因素，对每个 24 名自由球员的年度赢分预测。我们虚构的
    NBA 球队希望在遵守*所有*这些约束条件的情况下最大化赢分。让我们开始吧。
- en: 4.2 Loading packages
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.2 加载包
- en: 'We have four packages to load: `tidyverse` and `patchwork`, which we’ve loaded
    and used in prior chapters, and two new packages, as described here:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有四个包需要加载：`tidyverse` 和 `patchwork`，我们在前面的章节中已经加载并使用过，还有两个新包，如本节所述：
- en: The `lpSolve` package contains several functions for solving linear programming
    problems, including those that require constrained optimization.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`lpSolve` 包包含解决线性规划问题的几个函数，包括需要约束优化的函数。'
- en: The `scales` package—part of the `ggplot2` package, which, of course, is part
    of the `tidyverse` universe of packages—contains functions for, among other things,
    transforming `ggplot2` axis labels. Even though the `scales` package ties back
    to `tidyverse`, R might throw an error when you call `scales` functions if the
    `scales` package hasn’t first been loaded separately and independently from the
    `tidyverse` package.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`scales` 包是 `ggplot2` 包的一部分，当然，`ggplot2` 包也是 `tidyverse` 包宇宙的一部分——它包含用于转换 `ggplot2`
    轴标签的函数。尽管 `scales` 包与 `tidyverse` 相关联，但如果 `scales` 包没有首先单独且独立于 `tidyverse` 包加载，R
    在调用 `scales` 函数时可能会抛出错误。'
- en: Warning Notice that the `S` in the `lpSolve` package is capitalized. R is a
    case- sensitive programming language. Even “innocuous” misapplications of lowercase
    and uppercase will generate error messages—some of which will be straightforward
    and others not so much—and prevent your code from running.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 警告 注意到 `lpSolve` 包中的 `S` 是大写的。R 是一种区分大小写的编程语言。即使是“无害”的小写和大写误用也会生成错误信息——其中一些可能是直接的，而另一些则不然——并阻止你的代码运行。
- en: Before we make four successive calls to the `library()` function to load these
    four packages, let’s first introduce the concept of adding comments to your code
    chunks. Even though comments are comingled with your code, they aren’t code at
    all; in fact, they are completely ignored when you execute your R script. Commenting
    is the practice of adding readable descriptions to help ease the potential pain
    later on when fixes or other changes are in order, especially when those changes
    are then assigned to another programmer.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们连续四次调用 `library()` 函数来加载这四个包之前，让我们首先介绍在代码块中添加注释的概念。尽管注释与你的代码混合在一起，但它们根本不是代码；实际上，当你执行
    R 脚本时，它们会被完全忽略。注释是一种添加可读描述的做法，有助于减轻将来在需要修复或其他更改时的潜在痛苦，尤其是在这些更改随后分配给其他程序员时。
- en: 'Unlike many other programming languages, R makes allowances for single-line
    comments only; multi-line comments are only possible by “merging” two or more
    single-line comments. To add a comment to a chunk of code, simply preface it with
    the pound (#) sign:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 与许多其他编程语言不同，R 只允许单行注释；多行注释只能通过“合并”两个或多个单行注释来实现。要给一段代码添加注释，只需在前面加上井号（#）符号：
- en: '[PRE0]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: We’ll import our data set next and further demonstrate the use of comments.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 我们接下来将导入我们的数据集，并进一步展示注释的使用。
- en: 4.3 Importing data
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.3 导入数据
- en: The `readr` `read_csv()` function is called to import our data set, a Microsoft
    Excel file previously saved with a .csv extension. Through the assignment operator,
    we label our data set as free_agents.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `readr` 的 `read_csv()` 函数导入我们的数据集，这是一个之前保存为 .csv 扩展名的 Microsoft Excel 文件。通过赋值运算符，我们将数据集标记为
    free_agents。
- en: The free_agents data set contained (when the data set was created) real-life
    soon-to-be free agents scraped from a website called Sportrac that were then joined
    with illustrative annual salary and win share projections based on historical
    data gathered from [www.basketball-reference.com](https://www.basketball-reference.com/).
    An NBA player becomes a free agent once their contract expires; at that point,
    free agents are free to negotiate and sign a new contract with any team, including
    the team they most recently played for.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: free_agents 数据集（在数据集创建时）包含从 Sportrac 网站抓取的现实生活中的即将成为自由球员的数据，然后根据从 [www.basketball-reference.com](https://www.basketball-reference.com/)
    收集的历史数据，结合了说明性的年薪和赢球份额预测。一旦球员的合同到期，NBA 球员就会成为自由球员；在那个时刻，自由球员可以自由地与任何球队谈判并签订新合同，包括他们最近效力的球队。
- en: 'Note that we’ve added one comment, but this time, at the end of a line of code
    rather than in a separate line. R will execute the following code chunk until
    it sees the # sign; it will then ignore everything *on the same line* that comes
    after it:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '注意，我们添加了一条注释，但这次是在代码行末尾而不是单独的一行。R 将执行以下代码块，直到看到 # 符号；然后它将忽略该行之后的所有内容：'
- en: '[PRE1]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Next, we’ll go about learning the basics of the data we just imported and then
    visualizing the same to acquire deeper insights.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将学习我们刚刚导入的数据的基本知识，然后可视化以获得更深入的见解。
- en: 4.4 Knowing the data
  id: totrans-34
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.4 了解数据
- en: 'R provides several functions to get a quick, yet good, basic understanding
    of a data set. One is the base R `dim()` function, which returns the row and column
    counts:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: R 提供了几个函数来快速获得对数据集的基本理解。一个是基础 R 的 `dim()` 函数，它返回行数和列数：
- en: '[PRE2]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The row count is provided first, followed by the column count.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 首先提供行数，然后是列数。
- en: 'Another is the `glimpse()` function from the `dplyr` package. The function
    also returns the dimension of a data set but with a truncated view of the data
    that has been rotated 90 degrees:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个是来自 `dplyr` 包的 `glimpse()` 函数。该函数也返回数据集的维度，但以旋转 90 度的数据的截断视图返回：
- en: '[PRE3]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'There is, by the way, a base R equivalent to `glimpse()`: the `str()` function.
    The `glimpse()` function is “cleaner” than `str()` and therefore the first choice
    between the two, but both functions return the same information in somewhat similar
    formats:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 顺便说一句，`glimpse()` 函数在基础 R 中有一个等价函数：`str()` 函数。`glimpse()` 函数比 `str()` “更干净”，因此是两者之间的首选，但这两个函数都以某种类似格式返回相同的信息：
- en: '[PRE4]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The variables `position1` and `position2` should be factors rather than character
    strings (`chr`), so we then call the base R `as.factor()` function twice to convert
    both variables from one type or class to the other:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 变量 `position1` 和 `position2` 应该是因子而不是字符字符串（`chr`），所以我们调用基础 R 的 `as.factor()`
    函数两次，将两个变量从一种类型或类转换为另一种类型：
- en: '[PRE5]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Let’s run the base R `levels()` function to return the unique attributes of
    both variables. You must run the `levels()` function *after* converting variables
    to factors and not beforehand:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们运行基本的 R `levels()` 函数来返回两个变量的唯一属性。你必须将变量转换为因子后才能运行 `levels()` 函数，而不是在此之前：
- en: '[PRE6]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The variable `position1` contains five levels, one for each position, which,
    of course, is what we would want or expect. Therefore, we’ve at least confirmed
    there are no typographical errors or other anomalies with `position1`. The variable
    `position2`, meanwhile, contains 24 levels, equaling the free_agents data set
    record count, which is a good thing.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 变量 `position1` 包含五个水平，每个位置一个，这当然是我们所希望或预期的。因此，我们至少确认了 `position1` 没有错别字或其他异常。同时，变量
    `position2` 包含 24 个水平，等于 free_agents 数据集的记录数，这是一个好事。
- en: Even the smallest of errors with either of these variables would compromise
    our constrained optimization problem, which is why it was worth our while to check
    the integrity of both variables.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 即使这两个变量中的任何一个出现最小的错误，也会损害我们的约束优化问题，这就是为什么检查两个变量的完整性值得我们去做。
- en: 'If you don’t care for `glimpse``()` or `str``()`, the `head``()` and `tail()`
    functions are good alternatives; by default, `head()` returns the first six records,
    and `tail()` returns the last six. The following two lines of code return the
    first three and last three observations from free_agents:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不喜欢 `glimpse()` 或 `str()`，`head()` 和 `tail()` 函数是很好的替代品；默认情况下，`head()` 返回前六条记录，而
    `tail()` 返回最后六条。以下两行代码返回了 free_agents 的前三个和最后三个观测值：
- en: '[PRE7]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Finally, the `summary()` function is a base R generic function that returns
    basic statistics for whatever data object is passed as an argument. It’s mostly
    used to return the results of various model fitting functions (discussed in chapter
    5); here, it returns basic statistics and other data for every variable in the
    free_agents data set. Once more, `summary()` returns boxplot-like measures for
    continuous variables and level counts for factor variables:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，`summary()` 函数是一个基础 R 通用函数，它返回传递给它的任何数据对象的基线统计信息。它主要用于返回各种模型拟合函数的结果（在第5章中讨论）；在这里，它返回
    free_agents 数据集中每个变量的基线统计信息和其它数据。再次强调，`summary()` 返回连续变量的箱线图样度量，以及因子变量的水平计数：
- en: '[PRE8]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The `summary()` function returns some useful and interesting information, but
    even for short data sets such as free_agents, it’s always best to also visualize
    the data to better understand it.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '`summary()` 函数返回一些有用且有趣的信息，但对于像 free_agents 这样的短数据集，始终最好也可视化数据以更好地理解它。'
- en: 'But first, one more housecleaning item is required: the `options()` function
    from base R, with the argument `scipen = 999`, tells R to not print any results
    in scientific notation (i.e., e+10), but instead to return them, without exception,
    in full digit numerals. We’re essentially instructing R to return results in fixed
    notation unless those results are greater than scipen digits long. So any large
    scipen number will suffice, but 999 is the number most frequently used:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 但首先，还需要一个额外的清理项目：基础 R 中的 `options()` 函数，带有参数 `scipen = 999`，告诉 R 不要以科学记数法（即
    e+10）打印任何结果，而是无例外地以全数字形式返回它们。我们实际上是在指示 R 在结果大于 scipen 位数字长时返回固定记数法的结果。因此，任何大的
    scipen 数字都足够，但999是最常用的数字：
- en: '[PRE9]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: This setting can be reverted by again calling the `options()` function and adding
    the argument `scipen = 000`; this time, any small number will work, but 000 is
    preferred. The `options()` function is not universal, by the way—it applies only
    to the script to which it has been called.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过再次调用 `options()` 函数并添加参数 `scipen = 000` 来撤销此设置；这次，任何小的数字都可以，但000是首选。顺便说一下，`options()`
    函数并非通用——它仅适用于它被调用的脚本。
- en: 4.5 Visualizing the data
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.5 可视化数据
- en: Before we set up and run our constrained optimization problem, let’s first get
    a better read on our data. We’ll do just that by first creating a series of density
    plots covering the variables `annual_salary`, `win_shares`, and `age`; a sequence
    of boxplots over these same variables, but broken down by the variable `position1`;
    a single correlation plot between the variables `annual_salary` and `win_shares`;
    and, finally, a bar chart that displays the player counts by the variable `position1`.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们设置并运行约束优化问题之前，让我们首先更好地了解我们的数据。我们将通过首先创建一系列密度图来覆盖变量 `annual_salary`、`win_shares`
    和 `age`；一系列针对这些相同变量的箱线图，但按变量 `position1` 分组；一个变量 `annual_salary` 和 `win_shares`
    之间的单一相关性图；最后，一个显示按变量 `position1` 分组的球员数量的条形图。
- en: 4.5.1 Density plots
  id: totrans-58
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.1 密度图
- en: The first graphical representation of the free_agents data set is a set of density
    plots around the continuous variables salary (`annual_salary`), win shares (`win_shares`),
    and age (`age`). A density plot is essentially a smoothed version of a histogram,
    and like histograms, density plots display the distribution of continuous or numeric
    data. (Afterward, we’ll create boxplots, a correlation plot, and a bar chart.)
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 自由球员数据集的第一个图形表示是一系列围绕连续变量薪水（`annual_salary`）、赢分（`win_shares`）和年龄（`age`）的密度图。密度图本质上是对直方图的平滑版本，就像直方图一样，密度图显示连续或数值数据的分布。（之后，我们将创建箱线图、相关性图和条形图。）
- en: The most significant advantage that density plots have over histograms is that
    density plots more accurately reflect the real distribution shape because there’s
    no programmer option to fiddle with bin counts that can otherwise influence the
    appearance. But while the x-axis represents the range of values, just as it does
    for histograms, the y-axis represents a less-than-intuitive density function,
    or probability density function, rather than frequencies. However, at the end
    of the day, the probability density function actually correlates well with frequencies;
    in other words, the probability density function equals a low number when frequencies
    are low and, conversely, equals a high number (or at least a higher number) when
    frequencies are higher. Regardless, density plots are extremely useful for visualizing
    the underlying distribution of a continuous variable, identifying peaks or modes,
    and assessing skewness or symmetry.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 密度图相较于直方图最显著的优势在于，密度图能更准确地反映实际的分布形状，因为没有程序员选项可以调整箱数，否则可能会影响外观。但尽管 x 轴代表值的范围，就像直方图一样，y
    轴代表一个不太直观的密度函数，或概率密度函数，而不是频率。然而，最终，概率密度函数实际上与频率有很好的相关性；换句话说，当频率低时，概率密度函数等于一个低数值，反之，当频率高时，概率密度函数等于一个高数值（或至少是一个更高的数值）。无论如何，密度图对于可视化连续变量的潜在分布、识别峰值或模式以及评估偏度或对称性非常有用。
- en: 'Here’s a walkthrough of our first `ggplot2` density plot out of three:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是三个 `ggplot2` 密度图中的第一个的演示：
- en: The `ggplot()` function is always called first to initialize any `ggplot2` object.
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ggplot()` 函数始终首先被调用以初始化任何 `ggplot2` 对象。'
- en: The `geom_density()` function computes the smoothed estimates and draws the
    plot. The `alpha` argument passed to the `geom_density()` makes the fill transparent
    so that the `ggplot2` grid lines remain visible throughout. For this effect to
    take, `alpha` should equal a number close to 0, such as .3.
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`geom_density()` 函数计算平滑估计并绘制图表。传递给 `geom_density()` 的 `alpha` 参数使填充透明，以便 `ggplot2`
    网格线在整个图表中保持可见。为了实现这种效果，`alpha` 应该等于接近 0 的数值，例如 .3。'
- en: The `geom_vline()` function is called twice to draw a pair of vertical dashed
    lines, one that represents the population mean and the other that represents the
    population median. The thickness of the lines can be adjusted by modifying the
    `size` argument up or down; the default is 1, so any adjustments are therefore
    relative to the `ggplot2` default.
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`geom_vline()` 函数被调用两次以绘制一对垂直虚线，一条代表总体均值，另一条代表总体中位数。可以通过修改 `size` 参数上下调整线的厚度；默认值为
    1，因此任何调整都是相对于 `ggplot2` 默认值的相对调整。'
- en: The `scale_x_continuous()` function, in tandem with the `scales` package, adds
    commas to the x-axis tick marks, so that 10000000 is converted to a more readable
    10,000,000.
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`scale_x_continuous()` 函数与 `scales` 包一起使用，在 x 轴刻度标记上添加逗号，因此 10000000 转换为更易读的
    10,000,000。'
- en: 'The `annotate()` function adds vertical text at the provided x- and y-coordinates:'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`annotate()` 函数在提供的 x 和 y 坐标处添加垂直文本：'
- en: '[PRE10]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The second and third density plots—`p2` and `p3`, respectively—are just like
    `p1`, minus a few modifications:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个和第三个密度图——分别是 `p2` 和 `p3`——与 `p1` 类似，只是做了一些修改：
- en: The variable `annual_salary` has been swapped out in favor of the variables
    `win_shares` and `age`.
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将变量 `annual_salary` 替换为变量 `win_shares` 和 `age`。
- en: Label changes have been incorporated.
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 已经包含了标签更改。
- en: 'The `scale_x_continuous()` function and the scales package are no longer needed—after
    all, plots `p2` and `p3` don’t have labels that require converting—and have therefore
    been removed:'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`scale_x_continuous()` 函数和 scales 包不再需要——毕竟，图表 `p2` 和 `p3` 没有需要转换的标签，因此已经被移除：'
- en: '[PRE11]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The `plot_layout()` function from the `patchwork` package bundles the three
    density plots into one object (see figure 4.1), where plots `p1` and `p2` occupy
    the top row, and plot `p3`, assuming the same width as `p1` plus `p2`, is displayed
    on the bottom row:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '`plot_layout()` 函数从 `patchwork` 包中将三个密度图捆绑成一个对象（见图 4.1），其中图表 `p1` 和 `p2` 占据顶部一行，而图表
    `p3`，假设与 `p1` 和 `p2` 相同的宽度，显示在底部一行：'
- en: '[PRE12]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![CH04_F01_Sutton](../../OEBPS/Images/CH04_F01_Sutton.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![CH04_F01_Sutton](../../OEBPS/Images/CH04_F01_Sutton.png)'
- en: Figure 4.1 Density plots visualize the distribution of numeric data. Density
    plots are sometimes drawn in lieu of histograms or boxplots.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.1 密度图用于可视化数值数据的分布。密度图有时会替代直方图或箱线图。
- en: 'Our first three visualizations tell us the following about the data:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的前三个可视化展示了以下关于数据的信息：
- en: '*Annual salaries*—These figures, which represent the year-over-year base salary
    expectations of our 24 free agents, are right skewed, or positively skewed. There
    are two ways of deducing this: (1) most values are obviously clustered around
    the left tail of the distribution while the right tail is longer, and (2) the
    mean is therefore greater than the median.'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*年薪*—这些数字代表我们 24 名自由球员的年度基本工资的逐年预期，它们是右偏斜的，或者说正偏斜。有两种方法可以推断这一点：（1）大多数值明显聚集在分布的左尾，而右尾较长，并且（2）因此，均值大于中位数。'
- en: '*Win shares*—The same can be said for the annual win shares figures, which
    represent the projected number of accrued win shares per player per season. Given
    the means and medians of `annual_salaries` and `win_shares`, we can reasonably
    conclude that approximately $15 M in salary is the equivalent of about 3.5 to
    4 win shares.'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*赢分*—对于年度赢分数据，也可以说同样的话，这些数据代表每个球员在每个赛季预计获得的赢分数量。考虑到 `annual_salaries` 和 `win_shares`
    的均值和中位数，我们可以合理地得出结论，大约 1500 万美元的薪水相当于大约 3.5 到 4 个赢分。'
- en: '*Age*—Unlike the variables `annual_salaries` and `win_shares`, the variable
    `age` is normally distributed; both the mean and the median equal approximately
    30.5.'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*年龄*—与变量 `annual_salaries` 和 `win_shares` 不同，变量 `age` 通常呈正态分布；均值和中位数都大约等于 30.5。'
- en: 4.5.2 Boxplots
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.2 箱线图
- en: 'Our next series of visualizations again displays the distributions of these
    same variables, but this time through boxplots and also broken down by each level
    in variable `position1`. These boxplots are similar to the boxplots we created
    in previous chapters, but note that we’re now using the `scales` package to transform
    our y-axis tick marks rather than those along the x-axis. Therefore, we call the
    `scale_y_continuous()` function instead of `scale_x_continuous``()`:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 我们接下来的可视化系列再次显示了这些相同变量的分布，但这次是通过箱线图，并且按变量 `position1` 的每个级别细分。这些箱线图与我们之前章节中创建的箱线图类似，但请注意，我们现在使用
    `scales` 包来转换我们的 y 轴刻度标记，而不是 x 轴上的刻度标记。因此，我们调用 `scale_y_continuous()` 函数而不是 `scale_x_continuous()`
    函数：
- en: '[PRE13]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'We then make another call to the `plot_layout()` function, which pulls the
    three visualizations from memory and displays them as a single 3 × 1 graphical
    object (see figure 4.2):'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们再次调用 `plot_layout()` 函数，该函数从内存中检索三个可视化效果，并将它们显示为一个 3 × 1 的图形对象（见图 4.2）：
- en: '[PRE14]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![CH04_F02_Sutton](../../OEBPS/Images/CH04_F02_Sutton.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![CH04_F02_Sutton](../../OEBPS/Images/CH04_F02_Sutton.png)'
- en: Figure 4.2 Another series of views into the distribution of numeric data
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.2 另一系列对数值数据分布的观察
- en: 'Following are a few notes about our boxplots:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些关于我们箱线图的说明：
- en: It’s no surprise that, given the variance in `annual_salary` and the low number
    of records in the free_agents data set, especially for each of the five levels
    in `position1`, the distributions are quite different from one position to the
    next.
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于 `annual_salary` 的方差以及 free_agents 数据集中记录的低数量，特别是 `position1` 的五个级别中的每一个，分布差异很大。
- en: While there is less dispersion in the `win_shares` distributions, the position-by-position
    view appears to match the same for `annual_salary`.
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虽然 `win_shares` 分布的分散度较低，但按位置查看似乎与 `annual_salary` 相同。
- en: While we previously discovered that `age` is normally distributed, its distribution
    is nevertheless quite different when viewed by position. For instance, most centers
    and point guards are above the age of 30, whereas most small forwards and shooting
    guards are below the age of 30.
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虽然我们之前发现 `age` 是正态分布的，但按位置查看时，其分布仍然相当不同。例如，大多数中锋和控球后卫的年龄都超过 30 岁，而大多数小前锋和得分后卫的年龄都低于
    30 岁。
- en: 4.5.3 Correlation plot
  id: totrans-92
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.3 相关图
- en: 'In chapter 2, we demonstrated how to compute correlation coefficients between
    multiple continuous variables at once and then display the same in a heat map
    or correlation matrix. Here, we merely want to compute the correlation coefficient
    between just two variables and then add the result as a subtitle to a correlation
    plot, which visualizes the same by one variable running along the x-axis and the
    other variable running along the y-axis. That being said, we pass variables `annual_salary`
    and `win_shares` to the base R `cor()` function to compute the correlation coefficient
    between them:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 在第 2 章中，我们展示了如何同时计算多个连续变量之间的相关系数，并在热图或相关矩阵中显示相同的结果。在这里，我们只想计算两个变量之间的相关系数，然后将结果作为相关图的副标题添加，该图通过一个变量沿
    x 轴运行，另一个变量沿 y 轴运行来可视化相同的内容。也就是说，我们将变量 `annual_salary` 和 `win_shares` 传递给基础 R
    的 `cor()` 函数来计算它们之间的相关系数：
- en: '[PRE15]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: The correlation coefficient, being equal to 0.76 (rounded), means that salaries
    and win shares are positively and strongly correlated with one another, which
    means that when one variable moves, the other moves in the same direction.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 相关系数等于0.76（四舍五入），这意味着工资和赢分之间存在着正面的强相关性，这意味着当一个变量移动时，另一个变量也会向同一方向移动。
- en: Our next chunk of code draws a `ggplot2` correlation plot, with `annual_salary`
    as the x-axis variable and `win_shares` as the y-axis variable (see figure 4.3).
    Whereas `geom_ density``()` is called to draw a `ggplot2` density plot and `geom_boxplot``()`
    is called to draw a `ggplot2` boxplot, `geom_point``()` tells R to draw a correlation
    plot, sometimes called a scatterplot. By passing the `size = 3` argument to `geom_point()`,
    we’re instructing R to draw the points three times their default size.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 我们接下来的代码块绘制了一个`ggplot2`相关图，其中`annual_salary`是x轴变量，`win_shares`是y轴变量（见图4.3）。`geom_density()`被调用以绘制`ggplot2`密度图，`geom_boxplot()`被调用以绘制`ggplot2`箱线图，而`geom_point()`告诉R绘制相关图，有时也称为散点图。通过将`size
    = 3`参数传递给`geom_point()`，我们指示R绘制点的大小是默认大小的三倍。
- en: '![CH04_F03_Sutton](../../OEBPS/Images/CH04_F03_Sutton.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![CH04_F03_Sutton](../../OEBPS/Images/CH04_F03_Sutton.png)'
- en: Figure 4.3 Salaries and win shares are positively and highly correlated with
    one another. The line is a regression line of best fit that minimizes the distances
    between it and the data.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.3 工资和赢分之间存在着正面的高度相关性。这条线是最优拟合回归线，它最小化了与数据的距离。
- en: When the `method = lm` argument is then passed to the `geom_smooth()` function,
    a linear regression line is drawn through the data (`lm` is short for linear model).
    A regression line, or line of best fit, is an annotation meant to visualize a
    trend in a data series; the line is drawn to minimize the distances between it
    and the data. The steeper the line, the stronger the correlation.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 当将`method = lm`参数传递给`geom_smooth()`函数时，会在数据上绘制一条线性回归线（`lm`是线性模型的缩写）。回归线，或最优拟合线，是一种注释，旨在可视化数据系列中的趋势；线被绘制以最小化与数据的距离。线越陡，相关性越强。
- en: 'The `geom_smooth()` function automatically draws a 95% confidence interval
    around the regression line, unless instructed otherwise. The confidence interval
    can, in fact, be adjusted up or down or removed altogether. We’ve chosen to remove
    it by also passing the `se = FALSE` argument (`se` is short for standard error):'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: '`geom_smooth()`函数会自动在回归线上绘制一个95%的置信区间，除非有其他指示。实际上，置信区间可以向上或向下调整，或者完全删除。我们选择删除它，通过传递`se
    = FALSE`参数（`se`是标准误差的缩写）：'
- en: '[PRE16]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 4.5.4 Bar chart
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.4 条形图
- en: 'In our next chunk of code, we pass the free_agents data set via the pipe operator
    to the `dplyr` `group_by``()` and `tally()` functions. Together, `group_by()`
    and `tally()` count, or tally, the number of free_agents observations by each
    level, or factor, in variable `position1`. The results are then thrown into a
    tibble called tibble1:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们接下来的代码块中，我们通过管道操作符将free_agents数据集传递给`dplyr`的`group_by()`和`tally()`函数。`group_by()`和`tally()`函数一起计算变量`position1`中每个级别的free_agents观察值的数量，结果被放入一个名为tibble1的tibble中：
- en: '[PRE17]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'In this second chunk of code, we pass free_agents to the `dplyr summarize()`
    function to compute the means for `annual_salary`, `win_shares`, and `age` for
    each level in variable `position1`. The results are cast into a tibble called
    tibble2:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个第二个代码块中，我们将free_agents传递给`dplyr summarize()`函数，以计算变量`position1`中每个级别的`annual_salary`、`win_shares`和`age`的平均值。结果被转换成一个名为tibble2的tibble：
- en: '[PRE18]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'In this third and final chunk of code, we make a call to the `dplyr left_join()`
    function to join the two tibbles we just created on their like variable `position1`.
    A left join is an operation by which all the rows in one object are merged or
    matched with corresponding values in the second object. In the process, we also
    get every unique *column* returned. The result is yet another tibble, tibble3:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个第三个也是最后一个代码块中，我们调用`dplyr left_join()`函数，将我们刚刚创建的两个tibbles根据它们的类似变量`position1`进行连接。左连接是一种操作，通过它一个对象中的所有行都会与第二个对象中的相应值合并或匹配。在这个过程中，我们还得到了每个唯一的*列*返回。结果是另一个tibble，tibble3：
- en: '[PRE19]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'We now have a data source for our next and final visualization, a `ggplot2`
    bar chart:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经有了下一个和最后一个可视化所需的数据源，一个`ggplot2`条形图：
- en: The `geom_text()` function is called to affix the counts for each level of `position1`
    *atop* the bars. The `vjust` argument moves or adjusts the location of `ggplot2`
    plot elements such as labels, titles, and subtitles vertically; there is also
    an `hjust` argument, not called here, that adjusts similar plot elements horizontally.
    You’ll likely want or need to experiment with different settings on a per-plot
    basis to get the best aesthetics.
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调用 `geom_text()` 函数将 `position1` 每个级别的计数固定在条形图顶部。`vjust` 参数移动或调整 `ggplot2` 图表元素（如标签、标题和副标题）的垂直位置；还有一个
    `hjust` 参数，这里没有调用，它调整类似的图表元素的水平位置。你可能需要或需要根据每个图表的不同设置进行实验，以获得最佳的美观效果。
- en: The `geom_label()` function is called three times to affix truncated values
    representing the means for `annual_salaries`, `win_shares`, and `age` *inside*
    the bars.
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`geom_label()` 函数被调用了三次，用于在条形图中标注代表 `annual_salaries`、`win_shares` 和 `age`
    的截断值，这些值位于条形图内部。'
- en: The y-axis is extended, or otherwise fixed on minimum and maximum values, by
    calling the `ylim()` function to make all of this fit and not compromise the aesthetics.
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过调用 `ylim()` 函数，y 轴被扩展或固定在最小和最大值上，以确保所有这些都能适应，并且不会损害美观。
- en: 'These additional features enhance the aesthetics of our bar chart (see figure
    4.4), converting it from a very ordinary graphical representation of the data
    to an object that (hopefully) demands more of our attention. More importantly,
    these features provide just enough information that wouldn’t otherwise be included.
    We want to inform our audience, not overwhelm them. Following is the code for
    our `ggplot2` bar chart:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 这些附加功能增强了我们的条形图的美观（见图 4.4），将其从一种非常普通的图形数据表示转变为一个（希望）能吸引我们更多注意的对象。更重要的是，这些功能提供了足够的信息，而不会包含其他信息。我们希望通知我们的观众，而不是让他们感到不知所措。以下是我们
    `ggplot2` 条形图的代码：
- en: '[PRE20]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![CH04_F04_Sutton](../../OEBPS/Images/CH04_F04_Sutton.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![CH04_F04_Sutton](../../OEBPS/Images/CH04_F04_Sutton.png)'
- en: Figure 4.4 Counts of shortlisted free agents by position. Note the legend in
    the lower-right corner that explains the white-boxed labels inside the bars from
    top to bottom.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.4 按位置统计的候选自由球员数量。注意右下角的图例，它解释了条形图内部从上到下白色框内的标签。
- en: 'Our bar chart also includes a caption, positioned by default below the plot
    and to the right, that explains the three labels from top to bottom affixed to
    the inside of the bars. Aggregating the means across positions gives us a so-called
    mark on the wall: for $91 M (a slight constraint violation, but a violation nonetheless),
    our fictional NBA team can get 17 win shares from five players with an average
    age equal to 29.8.'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的条形图还包括一个标题，默认情况下位于图表下方和右侧，从上到下解释固定在条形图内部的三个标签。将不同职位的平均值汇总，我们得到了所谓的“墙上的标记”：对于
    91 M（轻微的约束违规，但仍然是违规），我们的虚构 NBA 球队可以从五个平均年龄为 29.8 的球员那里获得 17 个胜利份额。
- en: The rest of this chapter is dedicated to organizing and executing a constrained
    optimization problem that, hopefully, gets us a better solution than our mark
    on the wall—without, of course, any constraint breaches. Regardless of where we
    ultimately land, constrained optimization takes out the guesswork and produces
    *the* optimal solution.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的其余部分致力于组织和执行一个约束优化问题，希望它能比我们的“墙上的标记”提供更好的解决方案——当然，没有任何约束违规。无论我们最终在哪里，约束优化都消除了猜测，并产生了*最优*的解决方案。
- en: 4.6 Constrained optimization setup
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.6 约束优化设置
- en: We’re about to demonstrate how to design and develop a constrained optimization
    problem. The code is easily transferable to other use cases by merely swapping
    out the function to be maximized or minimized and changing out the constraints.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 我们即将演示如何设计和开发一个约束优化问题。通过仅替换要最大化或最小化的函数以及更改约束条件，代码可以轻松地转移到其他用例。
- en: In the meantime, we have a fictional NBA team in need of a serious rebuilding
    effort. This team has recently failed in the draft, doesn’t own a top pick for
    the next draft, and has been unable to negotiate a trade to move up; therefore,
    the team’s general manager (GM) has instead decided to upgrade the roster by acquiring
    veteran players available in the free agent market. These are players with expiring
    contracts who can then sign and play for any team.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 同时，我们有一个虚构的 NBA 球队，需要一场重大的重建努力。这个球队最近在选秀中失败，没有下个选秀的顶尖选择，并且无法通过交易提升排名；因此，球队的总经理（GM）决定通过在自由球员市场上收购老将球员来升级阵容。这些球员的合同即将到期，他们可以与任何球队签约并打球。
- en: Let’s revisit our requirements. The GM has room to sign five players (first
    constraint). There must be one point guard, one shooting guard, one center, one
    power forward, and one small forward (second constraint). Annual salaries, collectively,
    must not exceed $90 M (third constraint). Finally, the average age of these five
    players, at the time of signing, must be equal to or less than 30 (fourth constraint).
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回顾一下我们的要求。总经理有空间签约五名球员（第一约束）。必须有一名控球后卫、一名得分后卫、一名中锋、一名大前锋和一名小前锋（第二约束）。年薪总额不得超过9000万美元（第三约束）。最后，这五名球员在签约时的平均年龄必须等于或低于30岁（第四约束）。
- en: 'For the sake of this exercise, let’s assume the team can otherwise sign whatever
    free agents it wants; in other words, there is no risk that any sought-after player
    will choose to sign with another team. The free_agents data set is therefore the
    team’s short list of free agents, with the following variables:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 为了这次练习，让我们假设球队可以签约任何它想要的自由球员；换句话说，没有风险是任何被追求的球员会选择签约另一支球队。因此，free_agents数据集是球队的短期自由球员名单，以下变量：
- en: '`player`—The full name of every player the team is evaluating, in firstname
    lastname format (e.g., Chris Paul); the free_agents data set is 24 rows long,
    so therefore we have 24 players in all. When the data was scraped from Spotrac,
    these players were, in fact, about to hit the free agent market.'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`player`—该团队评估的每位球员的全名，采用名-姓格式（例如，Chris Paul）；free_agents数据集有24行，因此我们总共有24名球员。当数据从Spotrac抓取时，这些球员实际上即将进入自由球员市场。'
- en: '`current_team`—The abbreviated team name—for instance, PHX for Phoenix Suns—each
    player was playing for when the free_agents data set was created.'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`current_team`—球队的简称——例如，PHX代表凤凰城太阳队——每个球员在创建free_agents数据集时正在为该队效力。'
- en: '`age`—The age of every player, in whole numbers, at the time free_agents was
    created.'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`age`—在创建free_agents时，每位球员的年龄，以整数表示。'
- en: '`position1`—The primary position played by each of the 24 players—C for center,
    PF for power forward, PG for point guard, SF for small forward, and SG for shooting
    guard.'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`position1`—24名球员中的每一位球员的主要位置——C代表中锋，PF代表大前锋，PG代表控球后卫，SF代表小前锋，SG代表得分后卫。'
- en: '`position2`—The primary position combined with a one-digit integer starting
    at 1 and incrementing by one for each position as we move down the free_agents
    data set. For instance, Chris Paul happens to be the first point guard in our
    data set, so the variable `position2` for Chris Paul equals `PG1`; Rajon Rondo
    is our second point guard, so `position2` for Rondo equals `PG2`. Jonas Valančiūnas
    is our first center, so `position2` for Valančiūnas equals `C1`; the last of four
    centers is Aron Baynes, so `position2` for him equals `C4`. This variable will
    be required once we further set up and run our constrained optimization problem.'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`position2`—主要位置加上从1开始的个位数整数，随着我们在free_agents数据集中向下移动，每个位置递增一个。例如，Chris Paul在我们的数据集中是第一位控球后卫，因此Chris
    Paul的`position2`变量等于`PG1`；Rajon Rondo是我们第二位控球后卫，因此Rondo的`position2`变量等于`PG2`。Jonas
    Valančiūnas是我们第一位中锋，因此Valančiūnas的`position2`变量等于`C1`；最后四位中锋中的最后一位是Aron Baynes，因此他的`position2`变量等于`C4`。当我们进一步设置和运行我们的约束优化问题时，这个变量将是必需的。'
- en: '`annual_salary`—The projected annual salary for each player. These figures
    are loosely based on prior salary information gathered from [www.basketball-reference.com](https://www.basketball-reference.com/),
    but are otherwise illustrative.'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`annual_salary`—每位球员预期的年薪。这些数字大致基于从[www.basketball-reference.com](https://www.basketball-reference.com/)收集的先前薪资信息，但除此之外具有说明性。'
- en: '`win_shares`—The projected number of win shares to be accrued by each player
    per season. These figures tie back to actual win share totals from prior seasons
    grabbed from [www.basketball-reference.com](https://www.basketball-reference.com/),
    but like variable `annual_salary`, these figures are illustrative. Our constrained
    optimization problem will *maximize win shares while obeying the hard constraints*
    previously mentioned.'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`win_shares`—每位球员每赛季预计获得的胜利份额。这些数字与从[www.basketball-reference.com](https://www.basketball-reference.com/)抓取的先前赛季的实际胜利份额相关联，但像`annual_salary`变量一样，这些数字具有说明性。我们的约束优化问题将在遵守之前提到的硬约束的同时*最大化胜利份额*。'
- en: Table 4.1 shows the team’s short list of 24 players or free agents; the variables
    `current_ team` and `position2` aren’t included in this table. The players aren’t
    listed in any particular order except for being grouped by position.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 表4.1显示了球队的24名球员或自由球员的短期名单；`current_team`和`position2`变量不包括在这个表中。球员没有按照任何特定的顺序列出，除了按位置分组。
- en: Table 4.1 List of available free agents
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 表 4.1 可用自由球员列表
- en: '| Player | Age | Position | Annual Salary | Win Shares |'
  id: totrans-133
  prefs: []
  type: TYPE_TB
  zh: '| 球员 | 年龄 | 位置 | 年薪 | 胜场分 |'
- en: '| Chris Paul | 37 | PG | $32,000,000 | 6.9 |'
  id: totrans-134
  prefs: []
  type: TYPE_TB
  zh: '| Chris Paul | 37 | PG | $32,000,000 | 6.9 |'
- en: '| Rajon Rondo | 36 | PG | $6,500,000 | 2.3 |'
  id: totrans-135
  prefs: []
  type: TYPE_TB
  zh: '| Rajon Rondo | 36 | PG | $6,500,000 | 2.3 |'
- en: '| Ricky Rubio | 31 | PG | $18,500,000 | 4.7 |'
  id: totrans-136
  prefs: []
  type: TYPE_TB
  zh: '| Ricky Rubio | 31 | PG | $18,500,000 | 4.7 |'
- en: '| Patrick Beverley | 34 | PG | $16,500,000 | 4.2 |'
  id: totrans-137
  prefs: []
  type: TYPE_TB
  zh: '| Patrick Beverley | 34 | PG | $16,500,000 | 4.2 |'
- en: '| Marcus Smart | 28 | PG | $15,500,000 | 4.7 |'
  id: totrans-138
  prefs: []
  type: TYPE_TB
  zh: '| Marcus Smart | 28 | PG | $15,500,000 | 4.7 |'
- en: '| Cory Joseph | 31 | PG | $14,500,000 | 3.6 |'
  id: totrans-139
  prefs: []
  type: TYPE_TB
  zh: '| Cory Joseph | 31 | PG | $14,500,000 | 3.6 |'
- en: '| Josh Richardson | 29 | SG | $11,000,000 | 3.0 |'
  id: totrans-140
  prefs: []
  type: TYPE_TB
  zh: '| Josh Richardson | 29 | SG | $11,000,000 | 3.0 |'
- en: '| Gary Harris | 28 | SG | $22,500,000 | 3.7 |'
  id: totrans-141
  prefs: []
  type: TYPE_TB
  zh: '| Gary Harris | 28 | SG | $22,500,000 | 3.7 |'
- en: '| Zach LaVine | 27 | SG | $10,500,000 | 3.8 |'
  id: totrans-142
  prefs: []
  type: TYPE_TB
  zh: '| Zach LaVine | 27 | SG | $10,500,000 | 3.8 |'
- en: '| Jonas Valančiūnas | 30 | C | $15,000,000 | 5.1 |'
  id: totrans-143
  prefs: []
  type: TYPE_TB
  zh: '| Jonas Valančiūnas | 30 | C | $15,000,000 | 5.1 |'
- en: '| Jusuf Nurkić | 28 | C | $14,000,000 | 3.8 |'
  id: totrans-144
  prefs: []
  type: TYPE_TB
  zh: '| Jusuf Nurkić | 28 | C | $14,000,000 | 3.8 |'
- en: '| Serge Ibaka | 33 | C | $12,000,000 | 2.9 |'
  id: totrans-145
  prefs: []
  type: TYPE_TB
  zh: '| Serge Ibaka | 33 | C | $12,000,000 | 2.9 |'
- en: '| Aron Baynes | 35 | C | $7,000,000 | 2.5 |'
  id: totrans-146
  prefs: []
  type: TYPE_TB
  zh: '| Aron Baynes | 35 | C | $7,000,000 | 2.5 |'
- en: '| Blake Griffin | 33 | PF | $35,000,000 | 5.2 |'
  id: totrans-147
  prefs: []
  type: TYPE_TB
  zh: '| Blake Griffin | 33 | PF | $35,000,000 | 5.2 |'
- en: '| Montrezl Harrell | 28 | PF | $26,000,000 | 4.2 |'
  id: totrans-148
  prefs: []
  type: TYPE_TB
  zh: '| Montrezl Harrell | 28 | PF | $26,000,000 | 4.2 |'
- en: '| Thaddeus Young | 34 | PF | $17,000,000 | 3.9 |'
  id: totrans-149
  prefs: []
  type: TYPE_TB
  zh: '| Thaddeus Young | 34 | PF | $17,000,000 | 3.9 |'
- en: '| Marvin Bagley III | 23 | PF | $14,500,000 | 4.7 |'
  id: totrans-150
  prefs: []
  type: TYPE_TB
  zh: '| Marvin Bagley III | 23 | PF | $14,500,000 | 4.7 |'
- en: '| Taurean Prince | 28 | PF | $14,500,000 | 1.7 |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '| Taurean Prince | 28 | PF | $14,500,000 | 1.7 |'
- en: '| Robert Covington | 31 | PF | $13,500,000 | 3.1 |'
  id: totrans-152
  prefs: []
  type: TYPE_TB
  zh: '| Robert Covington | 31 | PF | $13,500,000 | 3.1 |'
- en: '| Kawhi Leonard | 31 | SF | $37,000,000 | 9.4 |'
  id: totrans-153
  prefs: []
  type: TYPE_TB
  zh: '| Kawhi Leonard | 31 | SF | $37,000,000 | 9.4 |'
- en: '| Rodney Hood | 29 | SF | $19,500,000 | 2.1 |'
  id: totrans-154
  prefs: []
  type: TYPE_TB
  zh: '| Rodney Hood | 29 | SF | $19,500,000 | 2.1 |'
- en: '| Will Barton | 31 | SF | $14,500,000 | 3.8 |'
  id: totrans-155
  prefs: []
  type: TYPE_TB
  zh: '| Will Barton | 31 | SF | $14,500,000 | 3.8 |'
- en: '| Justise Winslow | 26 | SF | $15,000,000 | 2.8 |'
  id: totrans-156
  prefs: []
  type: TYPE_TB
  zh: '| Justise Winslow | 26 | SF | $15,000,000 | 2.8 |'
- en: '| TJ Warren | 29 | SF | $13,500,000 | 3.7 |'
  id: totrans-157
  prefs: []
  type: TYPE_TB
  zh: '| TJ Warren | 29 | SF | $13,500,000 | 3.7 |'
- en: Though our problem scenario seems rather complex, you may be surprised at the
    simplicity of the solution that R and constrained optimization can provide. Let’s
    turn to that solution between constructing the problem in section 4.7 and getting
    to the results in section 4.8.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我们的问题场景似乎相当复杂，但您可能会对 R 和约束优化提供的解决方案的简单性感到惊讶。让我们在 4.7 节构建问题和 4.8 节得到结果之间转向那个解决方案。
- en: 4.7 Constrained optimization construction
  id: totrans-159
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.7 约束优化构建
- en: 'Time to go about constructing our constrained optimization problem (note that
    these steps would be the same regardless of the use case). The first step in this
    process is to create a “copy” of the free_agents data set, called free_agents_sort,
    by calling the `dplyr arrange()` function, where the data is sorted by variable
    `position2`. The printed results are purposely limited to six observations, just
    for space considerations, by also calling the base R `head()` function:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 开始构建我们的约束优化问题（请注意，这些步骤无论在何种用例中都是相同的）。这个过程的第一步是通过调用 `dplyr arrange()` 函数创建一个“副本”的
    `free_agents` 数据集，称为 `free_agents_sort`，数据按变量 `position2` 排序。打印的结果有意限制为六个观测值，仅考虑空间因素，同时也调用了基础
    R 的 `head()` 函数：
- en: '[PRE21]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Second, the free_agents_sort data set is subset to only include variables absolutely
    needed for our constrained optimization problem; the `select()` function from
    the `dplyr` package is called to reduce free_agents_sort to just the variables
    `player`, `age`, `position2`, `annual_salary`, and `win_shares`. The printed results
    are again limited by once more calling the `head()` function:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 第二，将 `free_agents_sort` 数据集子集化，仅包括我们约束优化问题绝对需要的变量；调用 `dplyr` 包中的 `select()`
    函数将 `free_agents_sort` 简化为仅包含变量 `player`、`age`、`position2`、`annual_salary` 和 `win_shares`。打印的结果再次通过再次调用
    `head()` 函数被限制：
- en: '[PRE22]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Third, a constraint matrix is built, by which five vectors are created (note
    the `$` operator separating the object and variable names), called `centers`,
    `power_forwards`, `point_guards`, `small_forwards`, and `shooting_guards`, and
    then appended to the free_agents_sort data set. We then use binary encoding to
    populate these vectors with ones and zeros, representing true and false, depending
    upon the corresponding value in `position2`.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 第三，构建一个约束矩阵，通过它创建了五个向量（注意 `$` 操作符分隔对象和变量名），称为 `centers`、`power_forwards`、`point_guards`、`small_forwards`
    和 `shooting_guards`，然后将它们附加到 `free_agents_sort` 数据集上。然后我们使用二进制编码用一和零填充这些向量，代表真和假，取决于
    `position2` 中的对应值。
- en: 'To elaborate, each vector contains 24 elements, which, of course, matches the
    length of free_agents_sort. With respect to the vector `centers`, for instance,
    the top four values equal 1 because, after sorting our data, free agents that
    play the center position take up the top four records in free_agents_sort. The
    remaining values equal 0 because the other players in our data set play some position
    other than center. These results are subsequently printed in full:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 为了详细说明，每个向量包含24个元素，这当然与 free_agents_sort 的长度相匹配。以向量 `centers` 为例，前四个值等于1，因为在我们对数据进行排序后，担任中锋位置的球员占据了
    free_agents_sort 的前四条记录。其余的值等于0，因为我们的数据集中的其他球员扮演的是除中锋以外的其他位置。这些结果随后被完整打印出来：
- en: '[PRE23]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Fourth, we call the base R `rbind()` function (short for row-bind), which does
    more or less what the name suggests—it joins two or more vectors (or matrices
    or data sets), by rows, into a single object. Here, we call the `rbind()` function
    to combine several vectors into a new object called `constraint_matrix`, which
    has a dimension determined by variable `position2` as well as the hard constraints
    established at the beginning:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 第四，我们调用基础R的 `rbind()` 函数（简称行绑定），它基本上就是按行将两个或多个向量（或矩阵或数据集）连接成一个单一的对象。在这里，我们调用
    `rbind()` 函数将几个向量组合成一个新的对象，称为 `constraint_matrix`，其维度由变量 `position2` 以及最初建立的硬约束决定：
- en: '[PRE24]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Finally, we make a call to the base R `dimnames()` function to set the row
    and column names at once. We now have an object 13 rows long, in which each row
    represents a predetermined constraint, and 24 columns wide, in which each column
    ties back to the values from variable `position2`:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们调用基础R的 `dimnames()` 函数一次性设置行和列名。现在我们有一个13行长的对象，其中每一行代表一个预定的约束，24列宽，其中每一列都与变量
    `position2` 的值相关联：
- en: '[PRE25]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: All that remains is writing and running the constrained optimization algorithm,
    printing the results, and performing a series of simple checks.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 剩余的工作是编写和运行约束优化算法，打印结果，并执行一系列简单的检查。
- en: 4.8 Results
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.8 结果
- en: 'We can now solve our constrained optimization problem—that is, we can compute
    which five free agents this NBA team should acquire—by calling the `lp()` function
    from the `lpSolve` package. We’re calling a *linear* programming function because
    our variables are continuous and all have a power of 1, meaning they are added
    and subtracted rather than multiplied or divided. Here’s how it works:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以通过调用 `lp()` 函数从 `lpSolve` 包中解决我们的约束优化问题——即计算这支NBA球队应该签下哪五名自由球员。我们调用的是一个
    *线性* 编程函数，因为我们的变量是连续的，并且所有变量都有1的幂，这意味着它们是相加和相减，而不是相乘或相除。以下是它是如何工作的：
- en: The `const.mat` argument references a matrix of numeric constraint coefficients
    where there must be one row for each constraint and one column for each variable,
    which, of course, is exactly how we constructed `constraint_matrix`.
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`const.mat` 参数引用了一个数值约束系数矩阵，其中必须为每个约束有一个行，为每个变量有一个列，这当然正是我们构建 `constraint_matrix`
    的方式。'
- en: The `objective` argument equals the function that should be optimized, which
    is win shares.
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`objective` 参数等于应该优化的函数，即胜利份额。'
- en: The `direction` argument is a character string indicating the optimization direction
    (this must equal either `min` or `max`).
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`direction` 参数是一个表示优化方向的字符串（这必须等于 `min` 或 `max`）。'
- en: The `const.rhs` argument is a vector of numeric values that represents our constraints—a
    minimum of one player for each position on the floor, a maximum of one player
    for each position (that’s 10 constraints), five players maximum, a maximum annual
    salary equal to $90 M, and a maximum age in years equal to 150.
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`const.rhs` 参数是一个表示我们约束的数值向量——场上的每个位置至少有一名球员，每个位置最多有一名球员（即10个约束），最多五名球员，年薪最高为9000万美元，年龄最高为150岁。'
- en: The `const.dir` argument is a vector of character strings indicating the direction
    of each constraint—no less and no more than one player per each of the five positions,
    five players total, annual salaries not to exceed $90 M, and the total age not
    to exceed 150 (thereby ensuring an average equal to or less than 30).
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`const.dir` 参数是一个表示每个约束方向的字符串向量——每个位置不多也不少地有一名球员，总共五名球员，年薪不超过9000万美元，总年龄不超过150岁（从而确保平均年龄等于或低于30岁）。'
- en: The `int.vec` argument is a numeric vector specifying the number of integer
    variables.
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`int.vec` 参数是一个指定整数变量数量的数值向量。'
- en: 'The result is a new object called `co_object`. The `print()` function is *not*
    called at the end of the next code chunk; while it would return the objective
    function results—that is, how many win shares could be expected every year from
    the best free agents to acquire under the circumstances—it would not otherwise
    return anything else:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是一个名为 `co_object` 的新对象。在下一个代码块结束时没有调用 `print()` 函数；虽然它会返回目标函数的结果——即每年从最佳自由球员中可以期望获得多少胜利份额——但它不会返回其他任何内容：
- en: '[PRE26]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The following line of code returns the *full* results in the form of an object
    called `df`. The `select()` function is called to limit `df` to just include the
    variables in positions 1 through 5, these being `player`, `age`, `position2`,
    `annual_salary`, and `win_shares`:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码行返回一个名为 `df` 的对象形式的*完整*结果。通过调用 `select()` 函数，将 `df` 限制为仅包含位置 1 到 5 的变量，这些变量是
    `player`、`age`、`position2`、`annual_salary` 和 `win_shares`：
- en: '[PRE27]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: We have five players, one player for each position on the floor.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有五名球员，每个位置都有一个球员。
- en: 'A call to the base R `sum()` function computes the total of variable `win_shares`:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 调用基础 R 的 `sum()` 函数计算变量 `win_shares` 的总和：
- en: '[PRE28]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Another call to the `sum()` function computes the grand total of variable `annual_salary`.
    It turns out that this team will pay out approximately $3.5 M in salary for every
    win share:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 另一次调用 `sum()` 函数计算变量 `annual_salary` 的总和。结果是，这个球队将为每个胜利份额支付大约 $3.5 M 的薪水：
- en: '[PRE29]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Finally, the base R `mean()` function is called to compute the average age
    of the five free agent acquisitions:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，调用基础 R 的 `mean()` 函数来计算五名自由球员收购的平均年龄：
- en: '[PRE30]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Any other combination of players would either result in a lower win share total
    or would inevitably violate at least one of the hard constraints established up
    front. Thus, we’ve confirmed our hypothesis that constrained optimization can
    maximize a function while simultaneously obeying several constraints; our fictional
    NBA team is actually getting significantly more win shares at a slightly lower
    cost compared to the very rough estimates we computed after exploring the data.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 任何其他球员组合要么会导致胜利份额总和不增加，要么不可避免地违反事先设定的至少一个硬约束。因此，我们证实了我们的假设，即约束优化可以在同时遵守多个约束的情况下最大化一个函数；我们的虚构
    NBA 球队实际上在略低的成本下获得了显著更多的胜利份额，这比我们探索数据后计算的大致估计要高得多。
- en: So far, we’ve established how NBA teams can best take advantage of the draft
    or, as in the case here, the free agent market through constrained optimization
    to build up their rosters. Over the next several chapters, we’ll apply several
    statistical techniques, most of which haven’t yet been introduced, for in-game
    use. These same techniques are transferrable to other data and other real-world
    scenarios.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经确定了 NBA 球队如何通过约束优化最好地利用选秀权，或者在本例中，通过自由球员市场来构建他们的阵容。在接下来的几章中，我们将应用几种统计技术，其中大多数尚未介绍，用于比赛中的使用。这些相同的技术可以转移到其他数据和现实世界的场景中。
- en: Summary
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: 'We demonstrated how to add comments to your code. Comments improve the readability
    of your code and are especially useful during code reviews and post-production
    maintenance. R ignores and therefore doesn’t execute lines in your script if they
    begin with the # sign.'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '我们展示了如何为你的代码添加注释。注释可以提高代码的可读性，在代码审查和后期维护期间特别有用。R 忽略并以 # 符号开头的脚本中的行，因此不会执行这些行。'
- en: We introduced how to draw a `ggplot2` density plot as a means of displaying
    the distribution of a single continuous variable as well as a `ggplot2` correlation
    plot to visualize the correlation between two continuous variables.
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们介绍了如何绘制 `ggplot2` 密度图，作为显示单个连续变量分布以及 `ggplot2` 相关性图来可视化两个连续变量之间相关性的方法。
- en: Sometimes, small touches to your visualizations can go a long way toward enhancing
    their aesthetics and improving their interpretability. The `scales` package makes
    it possible to transform your `ggplot2` labels without having to reformat your
    data. In fact, we’ll apply other `scales` transformations in future chapters.
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有时，对可视化的一些小改动可以大大提高其美学和可解释性。`scales` 包使得在不重新格式化数据的情况下转换 `ggplot2` 标签成为可能。实际上，我们将在未来的章节中应用其他
    `scales` 转换。
- en: Constrained optimization is a relatively straightforward operations research
    technique that quantitatively solves difficult and real-world problems by eliminating
    guesswork and producing the best possible solution. Calling the `lp()` function
    from the `lpSolve` package is just one way in R to go about this.
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 约束优化是一种相对直接的运筹学技术，通过消除猜测并产生最佳可能解决方案，定量解决困难和现实世界的问题。从`lpSolve`包中调用`lp()`函数只是R中实现这一目标的一种方法。
- en: Problems large or small, where less-than-ideal circumstances reduce available
    options, are best solved through constrained optimization methods.
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无论问题大小，在不太理想的环境下减少可用选项时，最佳解决方案是通过约束优化方法。
- en: Constrained optimization problems are easily portable to other use cases; one
    algorithm applied to the NBA free agent market can subsequently be used elsewhere
    simply by substituting maximum or minimum functions and modifying the constraints.
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 约束优化问题很容易转移到其他用例；一个算法应用于NBA自由球员市场后，只需替换最大或最小函数并修改约束，就可以在其他地方使用。
- en: More often than not, you’re probably seeking to minimize costs (acquisition
    costs, warehousing costs, supplier costs, salaries and benefits, etc.) or time
    (routes and deliveries, time to market, service level responses, delays and downtime,
    etc.).
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更多的时候，你可能是在寻求最小化成本（获取成本、仓储成本、供应商成本、薪资和福利等）或时间（路线和配送、上市时间、服务水平响应、延误和停机时间等）。
- en: Most certainly, you’re equally interested in maximizing some aspect of your
    business, perhaps in terms of profit margins, shelf space, or schedule adherence.
    Once more, anytime you’re seeking to minimize or maximize a function where one
    or more constraints place restrictions on your options, you can and should apply
    constrained optimization to find your best option.
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当然，你对最大化你业务的一些方面也同等感兴趣，可能是利润率、货架空间或时间表的遵守。再次强调，每次你寻求最小化或最大化一个函数，其中一个或多个约束限制了你的选择时，你都可以也应该应用约束优化来找到最佳选项。
