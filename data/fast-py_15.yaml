- en: Appendix A. Setting up the environment
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录A. 设置环境
- en: This appendix covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本附录涵盖了
- en: Setting up Anaconda
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置Anaconda
- en: Setting up your Python distribution
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置你的Python发行版
- en: Setting up Docker
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置Docker
- en: Hardware considerations
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 硬件考虑
- en: This appendix provides some recommendations on how to set up your environment.
    We will be using Python 3.10 as the base for our code.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 本附录提供了一些关于如何设置你的环境的建议。我们将使用Python 3.10作为我们代码的基础。
- en: You can use any operating system that you like. Nowadays, most production code
    is commonly deployed on Linux, but you can also use Windows or Mac OS X. There
    is little difference between using Mac and Linux. Using Windows is more difficult.
    If you choose to do so, I recommend that you install some Unix tools, like a Bash
    shell, or you can use the Windows subsystem for Linux; Cygwin is also an option.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用你喜欢的任何操作系统。如今，大多数生产代码通常部署在Linux上，但你也可以使用Windows或Mac OS X。使用Mac和Linux之间几乎没有区别。使用Windows会更困难。如果你选择这样做，我建议你安装一些Unix工具，比如Bash
    shell，或者你可以使用Windows子系统中的Linux；Cygwin也是一个选择。
- en: An alternative route, available on all operating systems, is to use the provided—and
    totally optional—Docker image, which includes the required software. If you follow
    this route, be sure to install Docker for your operating system. I provide a default
    Docker image, although some chapters require specialized software, in which case
    I provide specialized Docker images. If so, you will find specific instructions
    in those chapters.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 一个适用于所有操作系统的替代方案是使用提供的——并且完全可选的——Docker镜像，其中包含所需的软件。如果你选择这条路径，请确保为你的操作系统安装Docker。我提供了一个默认的Docker镜像，尽管某些章节需要专门的软件，在这种情况下，我会提供专门的Docker镜像。如果需要，你可以在那些章节中找到具体的说明。
- en: A complete list—too long to list here—of the software used in this book can
    be found on the code repository inside the various `Dockerfile`s. This list can
    be useful even if you don’t use Docker. The repository for the book can be found
    at [https://github.com/tiagoantao/python-performance](https://github.com/tiagoantao/python-performance).
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在这本书中使用的软件的完整列表——太长了，这里无法列出——可以在各种`Dockerfile`中的代码仓库中找到。即使你不使用Docker，这个列表也可能很有用。本书的仓库可以在[https://github.com/tiagoantao/python-performance](https://github.com/tiagoantao/python-performance)找到。
- en: A.1 Setting up Anaconda Python
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.1 设置Anaconda Python
- en: 'Anaconda Python is probably the most common distribution for data science and
    engineering. I recommend using it to run the code in this book. After installing
    Anaconda, create an environment for the book:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: Anaconda Python可能是数据科学和工程中最常见的发行版。我建议使用它来运行本书中的代码。安装Anaconda后，为本书创建一个环境：
- en: '[PRE0]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Some chapters will require extra software. In these cases, I suggest you clone
    the original environment and create a new one for each chapter. This can be done
    with:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 一些章节将需要额外的软件。在这种情况下，我建议你克隆原始环境并为每个章节创建一个新的环境。这可以通过以下方式完成：
- en: '[PRE1]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: After cloning, you can install any required software in the new environment
    without compromising the original one.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 克隆后，你可以在新环境中安装任何所需的软件，而不会影响原始环境。
- en: I also suggest you create a separate environment for each chapter to avoid clashes
    between distinct packages and libraries. Package management is still problematic
    even when using a good package manager, like conda, so it’s easier to have separate
    environments.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 我还建议你为每个章节创建一个单独的环境，以避免不同包和库之间的冲突。即使在使用像conda这样的优秀包管理器的情况下，包管理仍然存在问题，因此拥有单独的环境会更容易。
- en: Updating conda environments
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 更新conda环境
- en: 'If you are a long-time Anaconda user, it’s probably better if you create a
    new environment with:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你是一个长期使用Anaconda的用户，那么创建一个新的环境可能更好，使用：
- en: '[PRE2]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Updating old environments can take a lot of time or even fail. If you are a
    new Anaconda user, you should consider creating a separate environment for the
    book material or, preferably, each chapter.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 更新旧环境可能需要很长时间，甚至可能失败。如果你是Anaconda的新用户，你应该考虑为书中的材料或，最好是每个章节，创建一个单独的环境。
- en: A.2 Installing your own Python distribution
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.2 安装你自己的Python发行版
- en: You can choose whichever Python distribution you prefer, but I strongly recommend
    Anaconda Python, the *de facto* standard in data science and high-performance
    computing. If you install Anaconda (not the smaller version, Miniconda), you will
    have most of the software that we will use out of the box. *I assume throughout
    the book that you are on Anaconda. If you use another distribution, you might
    need to adapt the installation instructions provided in the chapters (for the
    chapters that have specific needs)*. I would recommend checking a tool like Poetry
    ([https://python-poetry.org/](https://python-poetry.org/)) that can partially
    help you with package management
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以选择你喜欢的任何Python发行版，但我强烈推荐Anaconda Python，这是数据科学和高性能计算中的*事实上的*标准。如果你安装了Anaconda（不是较小的版本Miniconda），你将获得我们将会使用的绝大多数软件。*我在整本书中假设你使用Anaconda。如果你使用其他发行版，你可能需要调整章节中提供的安装说明（对于具有特定需求的章节）。我建议检查像Poetry（[https://python-poetry.org/](https://python-poetry.org/））这样的工具，它可以部分帮助你进行包管理*。
- en: You will need some very standard libraries, like NumPy and SciPy. To produce
    charts, we will use matplotlib. Different chapters require a specific library,
    like Cython, Numba, Apache Arrow, or Apache Parquet. If you are using neither
    conda nor Poetry, you will probably be dependent on `pip` to install software.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 你将需要一些非常标准的库，如NumPy和SciPy。为了生成图表，我们将使用matplotlib。不同的章节需要特定的库，如Cython、Numba、Apache
    Arrow或Apache Parquet。如果你既不使用conda也不使用Poetry，你可能会依赖于`pip`来安装软件。
- en: A.3 Using Docker
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.3 使用Docker
- en: If package installation is something you want to avoid or you are using Windows
    and want a more typical environment, I provide Docker images with everything you
    need to run the code. These Docker images will provide a Linux environment for
    you, irrespective of your host operating system.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要避免包安装，或者你使用Windows并希望有一个更典型的环境，我提供了包含运行代码所需一切内容的Docker镜像。这些Docker镜像将为你提供一个Linux环境，无论你的宿主操作系统是什么。
- en: 'The base image can be run as follows:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 基础镜像可以按照以下方式运行：
- en: '[PRE3]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The first time you run this code, it will download the image, which can take
    some time and bandwidth. You will have a shell, and you will be able to find the
    code in the directory `/code`. For chapters with specific software requirements,
    I provide tailored Docker images.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 第一次运行此代码时，它将下载镜像，这可能需要一些时间和带宽。你将有一个shell，你将能够在`/code`目录中找到代码。对于具有特定软件要求的章节，我提供了定制的Docker镜像。
- en: A.4 Hardware considerations
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.4 硬件考虑
- en: 'The software that we use in this book is fairly standard, but we are at the
    level that the setup can be tricky and actually derail some of the optimizations,
    for example:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这本书中使用的软件相当标准，但我们处于一个设置可能很棘手，实际上可能会破坏一些优化水平的阶段，例如：
- en: The way you compile and link the library can have a massive effect on performance
    (see chapter 4 on NumPy). If you install the recommended distribution, you are
    *probably* safe that you have a highly performant version. If you don’t (and especially
    if you compile it yourself), be sure to read the last section of chapter 4.
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你编译和链接库的方式可能会对性能产生巨大影响（参见第4章关于NumPy的内容）。如果你安装了推荐的发行版，你*很可能*拥有一个高性能版本。如果你没有（尤其是如果你自己编译它），请务必阅读第4章的最后部分。
- en: If you use the provided Docker image and given that you are inside a virtual
    environment, it’s quite difficult to know whether you have full control of what
    is going on in the machine, which will make profiling and especially CPU caching
    less reliable.
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你使用提供的Docker镜像，并且你处于虚拟环境中，那么很难知道你是否完全控制着机器上正在发生的事情，这将使得性能分析和特别是CPU缓存变得不太可靠。
- en: Similar arguments can be made if you are on a desktop where you are doing a
    lot of other tasks in parallel.
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你在一台同时进行许多其他任务的台式机上，可以提出类似的论点。
- en: Cloud instances also will suffer from the same problem unless you have access
    to the whole physical machine, which is possible (although expensive) and less
    common than being on a shared physical computer.
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 除非你有访问整个物理机器的权限，否则云实例也会遇到相同的问题，这是可能的（尽管成本高昂）但不如在共享物理计算机上常见。
- en: Different hardware configurations can have completely different performance
    profiles. For example, an SSD disk typically has a much better read performance
    than a disk with physical spinning plates. This variability in performance applies
    to CPUs, CPU caches, internal buses, memories, disks, and networks—especially
    for profiling and caching issues (CPU, disk, or network).
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不同的硬件配置可能会有完全不同的性能特征。例如，固态硬盘（SSD）通常比带有物理旋转盘的硬盘具有更好的读取性能。这种性能的变异性适用于CPU、CPU缓存、内部总线、内存、硬盘和网络——尤其是在分析和缓存问题（CPU、硬盘或网络）方面。
- en: Addressing the previous point from a different perspective, a well-configured
    bare-metal production machine may be the best place to see a few of the techniques
    presented here in full force.
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从不同的角度来处理前面提到的问题，一个配置良好的裸机生产机器可能是观察这里展示的一些技术发挥最大作用的最佳场所。
- en: Chapter 9 on GPUs requires access to a recent NVIDIA GPU—at least with a Pascal
    architecture.
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第9章关于GPU的内容需要访问最新的NVIDIA GPU——至少需要配备Pascal架构。
- en: We will discuss all these issues in depth throughout the book. But the larger
    point is that the practical examples you will see, while interesting per se, should
    be viewed as a conduit to develop essential insights about performance issues,
    which you might have to adapt to your specific cases. At a more advanced level,
    deep understanding is the real objective. Practical examples are the means but
    surely not the end.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在整本书中深入讨论所有这些问题。但更大的观点是，你将看到的实际例子，虽然本身很有趣，但应被视为发展关于性能问题基本洞察的途径，你可能需要根据具体情况对其进行调整。在更高级的水平上，深入理解才是真正的目标。实际例子是手段，但肯定不是终点。
