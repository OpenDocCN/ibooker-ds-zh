- en: 8 Optimal stopping
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 8 优化停止
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Optimal stopping (aka the 37% rule)
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最优停止（又称37%规则）
- en: Regression to the mean
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 均值回归
- en: Creating a frequency table
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建频率表
- en: Adding a theme to `ggplot2` visualizations
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为`ggplot2`可视化添加主题
- en: Importing and insetting images into `ggplot2` visualizations
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将图像导入和插入到`ggplot2`可视化中
- en: Adding multiple trendlines to a data series
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 向数据系列添加多个趋势线
- en: Creating a derived variable from a substring
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从子字符串创建派生变量
- en: 'There is a popular algorithm called the optimal stopping rule—which is frequently
    referred to as the 37% rule and sometimes called the look-then-leap rule—that
    solves the problem of *when* to take a specific course of action versus continuing
    to deliberate. Here’s a common use case: Let’s say you’re a hiring manager interviewing
    candidates for an open role in your organization, and you’re obligated to render
    a yea or nay decision immediately after interviewing each candidate because there
    are no second chances. According to the optimal stopping rule, you should automatically
    pass on the first 37% of the candidates in the applicant pool and then extend
    an offer to the first interviewed candidate who rates higher than every previous
    candidate.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 有一个流行的算法称为最优停止规则——通常被称为37%规则，有时也称为观察后跳跃规则——它解决了在何时采取特定行动与继续深思熟虑之间的问题。以下是一个常见的用例：假设你是组织中的一个开放职位的招聘经理，正在面试候选人，你必须在面试每个候选人后立即做出是或否的决定，因为没有第二次机会。根据最优停止规则，你应该自动跳过申请池中前37%的候选人，然后向第一个评分高于所有之前候选人的面试候选人发出录用通知。
- en: Our purpose here is to explore how the optimal stopping rule might or might
    not apply to the NBA. Should teams not shoot during the first 37% of their allotted
    possession time? Should they then attempt a shot as soon as they have a scoring
    opportunity equal to or better than any previous chance? By rule, teams have 24
    seconds to attempt a shot, and there are no resets; failure to take a shot results
    in a turnover whereby the opposing team takes possession. Teams use all or some
    of their allotted time passing and dribbling—the equivalent of interviewing candidates—expecting
    or hoping to create a high-percentage shot opportunity before their 24 seconds
    expire. Is there an optimal stopping point, measured in seconds, to passing and
    dribbling versus shooting? If so, is it consistent with the 37% rule? That’s what
    we aim to find out.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里的目的就是要探索最优停止规则可能或不可能适用于NBA的情况。球队是否应该在分配的控球时间的37%之前不投篮？然后，一旦他们获得与之前任何机会相等或更好的得分机会，他们是否应该立即尝试投篮？根据规则，球队有24秒的时间尝试投篮，没有重置；未能投篮将导致失误，对方球队获得控球权。球队使用所有或部分分配的时间进行传球和运球——相当于面试候选人——期望或希望在他们24秒用完之前创造一个高概率的投篮机会。是否存在一个最优的停止点，以秒为单位，来衡量传球和运球与投篮之间的平衡？如果是的话，它是否与37%的规则一致？这正是我们想要弄清楚的事情。
- en: We’ll sequentially test the optimal stopping rule on three teams using 2019-20
    regular season data, and then we’ll test the same against the entire league. Along
    the way, we’ll demonstrate a series of new visualization and data wrangling techniques.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用2019-20赛季的数据，依次对三支球队进行最优停止规则的测试，然后我们将对整个联赛进行相同的测试。在这个过程中，我们将展示一系列新的可视化和数据处理技术。
- en: 8.1 Loading packages
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 8.1 加载包
- en: 'We’ll use base R functionality as well as a combination of familiar and not-so-familiar
    packages; packages not used previously and therefore introduced here include `stringr`,
    `janitor`, and `png`:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用基本的R功能以及熟悉和不那么熟悉的包的组合；这里介绍了一些之前未使用的包，包括`stringr`、`janitor`和`png`：
- en: The `stringr` package is actually part of the `tidyverse` universe of packages,
    so it’s loaded by default when we load `tidyverse`; `stringr` makes it easy to
    manipulate character strings.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`stringr`包实际上是`tidyverse`包宇宙的一部分，因此当我们加载`tidyverse`时，它会默认加载；`stringr`使得操作字符字符串变得容易。'
- en: The `janitor` package contains several functions for examining and cleaning
    dirty data.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`janitor`包包含用于检查和清理脏数据的几个函数。'
- en: The `png` package contains functions for reading, writing, and displaying Portable
    Network Graphic (PNG) images.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`png`包包含用于读取、写入和显示便携式网络图形（PNG）图像的函数。'
- en: 'We start by calling the base R `library()` function four times to sequentially
    load our required packages:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先通过调用四次基本的R `library()` 函数来依次加载所需的包：
- en: '[PRE0]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: We’ll act on the last of these packages first.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先将对这些包中的最后一个进行操作。
- en: 8.2 Importing images
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 8.2 导入图像
- en: Images saved with a .png extension and stored in our default working directory
    are imported similarly to how we import .csv files—we simply call the `readPNG()`
    function from the `png` package and add the file path between a pair of single
    or double quotation marks. When inserted into any plot or chart, images accomplish
    more than merely enhancing their aesthetics; they also provide immediate clarity
    around scope or content. The presence of, let’s say, the Milwaukee Bucks logo
    in a plot makes it instantly clear that we’re visualizing Milwaukee Bucks results
    only.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 以.png扩展名保存并存储在我们默认工作目录中的图像，导入方式与导入.csv文件类似——我们只需从`png`包中调用`readPNG()`函数，并在一对单引号或双引号之间添加文件路径。当插入到任何图表或图中时，图像不仅增强了其美学，还提供了关于范围或内容的即时清晰度。例如，在图表中出现密尔沃基雄鹿队的标志，可以立即清楚地表明我们正在可视化密尔沃基雄鹿队的结果。
- en: 'In the following code chunk, we call the `readPNG()` function four times to
    sequentially import four NBA logos downloaded from the internet, saved as .png
    files, and then dragged and dropped into our default working directory. (There
    are dozens, probably hundreds, of websites from which these and other NBA images
    can be downloaded.) Because these are raster (or bitmap) images, the native argument
    is set to `TRUE`:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的代码块中，我们四次调用`readPNG()`函数，依次导入从互联网下载的四个NBA标志，保存为.png文件，然后拖放到我们的默认工作目录中。（可能有数十个，甚至数百个网站可以下载这些和其他NBA图像。）因为这些是光栅（或位图）图像，所以原生的参数设置为`TRUE`：
- en: '[PRE1]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Once we get around to creating a series of `ggplot2` line charts, we’ll inset
    these images as a way of augmenting our visual content. In the meantime, we’ll
    move forward by importing and viewing our data set.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们着手创建一系列`ggplot2`折线图，我们将插入这些图像作为增强我们视觉内容的一种方式。在此期间，我们将继续导入和查看我们的数据集。
- en: 8.3 Importing and viewing data
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 8.3 导入和查看数据
- en: We import our data by calling the `readr` `read_csv()` function and in the process
    establish an object called pbp (short for play-by-play). Our data was downloaded
    from the website [www.bigdataball.com](https://www.bigdataball.com/) and subsequently
    saved in our default working directory with the filename pbp.csv.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过调用`readr`的`read_csv()`函数导入数据，并在过程中创建了一个名为pbp（意为比赛过程）的对象。我们的数据是从网站[www.bigdataball.com](https://www.bigdataball.com/)下载的，随后保存在我们的默认工作目录中，文件名为pbp.csv。
- en: 'Our data set contains almost every play from every regular season and postseason
    game from the 2019-20 NBA season. The types of plays included and not included
    in our data will be explored momentarily. For now, we merely want to understand,
    at a macro level, the size and scope of our data; the `glimpse()` function from
    the `dplyr` package returns the dimension of pbp and a transposed snapshot of
    the content—it’s 543,149 rows long and 44 columns wide. If you’re working on a
    personal computer and not a server, it may take several seconds to load the data:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的数据集包含了2019-20 NBA赛季每场常规赛和季后赛的几乎所有比赛。我们数据中包含和不包含的比赛类型将在稍后探讨。现在，我们只想从宏观层面了解我们数据的大小和范围；`dplyr`包中的`glimpse()`函数返回pbp的维度和内容的转置快照——它有543,149行长和44列宽。如果你在个人电脑上工作而不是服务器上，加载数据可能需要几秒钟：
- en: '[PRE2]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Before we can properly analyze the data we’ve just loaded, we’ll first have
    to explore it further and wrangle it.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们能够正确分析刚刚加载的数据之前，我们首先需要进一步探索和整理它。
- en: 8.4 Exploring and wrangling data
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 8.4 探索和整理数据
- en: 'We start by converting the variable `data_set` from a character string to a
    factor by calling the built-in `as.factor()` function:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先通过调用内置的`as.factor()`函数将变量`data_set`从字符字符串转换为因子：
- en: '[PRE3]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'By doing so, we can then call the base R `levels()` function, which returns
    the three factor levels associated with the variable `data_set`. Had we instead
    kept `data_set` as a character string, rather than converting it to a factor,
    and then called the `levels()` function, R would have returned `NULL`:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这样做，我们就可以调用基础R的`levels()`函数，该函数返回与变量`data_set`相关的三个因子水平。如果我们没有将`data_set`保持为字符字符串，而是将其转换为因子，然后调用`levels()`函数，R将返回`NULL`：
- en: '[PRE4]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: It appears that observations which tie back to regular season games are, for
    some reason, divided between two factor levels, 2019-20 Regular Season and 2019-2020
    Regular Season, while playoff games are designated by the 2019-20 Playoffs factor
    level.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来，那些与常规赛比赛相关的观测值，由于某种原因，被分成了两个因子水平，即2019-20常规赛和2019-2020常规赛，而季后赛比赛则由2019-20季后赛因子水平指定。
- en: Our intent is to relegate our analysis to regular season games only instead
    of mixing regular season and postseason results; every NBA team plays a fixed
    regular season schedule, but only some teams then qualify for postseason play.
    Therefore, we pipe the pbp data set to the `dplyr filter()` function to subset
    pbp where the variable `data_set` does *not* equal `2019-20 Playoffs` (the `!=`
    operator means not equal to).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的意图是将我们的分析限制在常规赛比赛上，而不是混合常规赛和季后赛结果；每个NBA球队都有一份固定的常规赛赛程，但只有一些球队有资格参加季后赛。因此，我们将pbp数据集通过`dplyr
    filter()`函数进行管道处理，以子集pbp，其中变量`data_set`不等于`2019-20 Playoffs`（`!=`运算符表示不等于）。
- en: 'We then call the `dim()` function from base R to check the new dimension of
    the pbp data set:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 我们随后从基础R中调用`dim()`函数来检查pbp数据集的新维度：
- en: '[PRE5]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: By filtering *out* postseason plays and retaining every play from the 2019-20
    regular season, pbp has thus been reduced to 504,445 rows.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 通过过滤掉季后赛比赛并保留2019-20常规赛的每一场比赛，pbp因此减少到504,445行。
- en: 'The variable `play_length` is a bit more challenging. It’s now a character
    string (which doesn’t work for us) in an hours:minutes:seconds format (which also
    doesn’t work for us). We want and need a numeric variable in seconds only. So
    we call the `mutate()` function from the `dplyr` package in tandem with the `str_sub()`
    function from the `stringr` package to create a new variable, `play_length2`,
    which will be in seconds only. The `str_sub()` function requires the following
    three inputs:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 变量`play_length`有点更具挑战性。它现在是一个以小时:分钟:秒格式表示的字符串（这对我们不起作用），我们需要一个只以秒为单位的数值变量。因此，我们调用`dplyr`包中的`mutate()`函数和`stringr`包中的`str_sub()`函数来创建一个新变量`play_length2`，它将只以秒为单位。`str_sub()`函数需要以下三个输入：
- en: The character string that requires manipulation, which is the original variable
    `play_length`.
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 需要操作的字符串，即原始变量`play_length`。
- en: The first character from the variable `play_length` that should be extracted
    and ported to the derived variable `play_length2`. Because `play_length2` will
    be in seconds only, we’re therefore interested in extracting and porting the last
    two characters from `play_length`, which, again, is in an hours:minutes:seconds
    format. Therefore, the second input is `-2`, which is the second-to-last character
    in `play_length`.
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应从变量`play_length`中提取并移植到派生变量`play_length2`的第一个字符。因为`play_length2`将只以秒为单位，所以我们感兴趣的是提取并移植`play_length`的最后两个字符，它再次是以小时:分钟:秒的格式。因此，第二个输入是`-2`，它是`play_length`中的倒数第二个字符。
- en: The last character from `play_length` that should be extracted and ported to
    `play_length2`, which is the last character in the string. Therefore, the third
    input is `-1`.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应从`play_length`中提取并移植到最后一个字符到`play_length2`，即字符串中的最后一个字符。因此，第三个输入是`-1`。
- en: 'Our new variable is then converted to a numeric class by calling the base R
    `as.numeric()` function:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的新变量随后通过调用基础R的`as.numeric()`函数转换为数值类型：
- en: '[PRE6]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'To compare and contrast the variables `play_length` and `play_length2`, we
    call the base R `head()` function twice to return the first six values in the
    pbp data set for each variable. Usually, when we call the `head()` function, or
    even the `tail()` function, for that matter, we instruct R to return every variable
    in whatever number of top or bottom observations we need to view; here, by inserting
    the `$` operator, we’re instead telling R to just return `play_length` and then
    `play_length2`, ignoring the other pbp variables:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 要比较和对比变量`play_length`和`play_length2`，我们两次调用基础R的`head()`函数，以返回每个变量在pbp数据集中的前六个值。通常，当我们调用`head()`函数，甚至`tail()`函数时，我们指示R返回我们需要查看的顶部或底部观察值中的每个变量；这里，通过插入`$`运算符，我们告诉R只返回`play_length`和`play_length2`，忽略其他pbp变量：
- en: '[PRE7]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: So by calling the `str_sub()` function, we successfully created a new variable
    where, for instance, 00:00:12 is converted to 12 seconds, and 00:00:18 is converted
    to 18 seconds.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，通过调用`str_sub()`函数，我们成功创建了一个新变量，例如，00:00:12被转换为12秒，00:00:18被转换为18秒。
- en: 'Let’s now explore the variable `event_type`, which is also a character string.
    We convert it to a factor variable and then call the `levels()` function to return
    the factor levels:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们来探索变量`event_type`，它也是一个字符串。我们将其转换为因子变量，然后调用`levels()`函数以返回因子水平：
- en: '[PRE8]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'It turns out that the pbp data set contains 14 event types, including unknowns.
    We’ll eventually work with just a small subset of the following 13 event types:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 结果表明，pbp数据集包含14种事件类型，包括未知类型。我们最终将只处理以下13种事件类型的小子集：
- en: '`ejection`—A player has been permanently ejected from a game by one of the
    officials, usually after getting called for a second technical foul. Technical
    fouls are called subsequent to personal fouls that are especially violent or when
    players argue with the officials.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ejection`——一名球员被一名裁判永久驱逐出场比赛，通常是在被判定第二次技术犯规后。技术犯规是在特别暴力或球员与裁判争论之后对个人犯规的追加。'
- en: '`end of period`—Time has expired, thereby ending a period, or quarter.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`end of period`——时间已到，因此结束了一个时段或一个季度。'
- en: '`foul`—A personal foul has been called.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`foul`——被判个人犯规。'
- en: '`free throw`—A free throw has been attempted, which could result in a make
    (a successful shot) or a miss. A free throw isn’t the same as a shot or field
    goal. Neither the game clock nor the shot clock runs while a player is attempting
    a free throw.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`free throw`——尝试罚球，可能命中（成功投篮）或未命中。罚球不同于投篮或投篮。当球员尝试罚球时，比赛计时器和投篮计时器都不会运行。'
- en: '`jump ball`—This occurs after a pair of opposing players have equal possession
    of the ball. An official blows the whistle, thereby stopping play. The two players
    then jump for possession of the ball.'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`jump ball`——在两名对方球员拥有相等球权后发生。裁判吹哨，从而停止比赛。然后两名球员跳起争夺球权。'
- en: '`miss`—A field goal attempt is missed, or unsuccessful.'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`miss`——投篮未命中，或未成功。'
- en: '`rebound`—An offensive or defensive rebound is made immediately following a
    missed shot.'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`rebound`——在投篮不中后立即进行的进攻或防守篮板。'
- en: '`shot`—A field goal attempt is made, or successful.'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`shot`——投篮尝试成功。'
- en: '`start of period`—A new period, or quarter, begins, including any overtime
    sessions, which take place following regulation when a game is tied.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`start of period`——一个新的时段或一个季度开始，包括任何加时赛，这些加时赛在比赛平局后进行。'
- en: '`sub`—One or both teams are substituting one or more players. Substitutions
    can only occur when the game clock is stopped.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sub`——一方或双方球队正在替换一名或多名球员。替换只能在比赛计时器停止时进行。'
- en: '`timeout`—A break in play, usually requested by one of the teams. The game
    clock is stopped when a timeout is called and remains stopped until play resumes.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`timeout`——比赛暂停，通常由一方球队请求。当叫暂停时，比赛计时器停止，直到比赛恢复时才继续。'
- en: '`turnover`—The team in possession of the ball has committed some sort of sloppy
    play, resulting in the opposing team gaining possession.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`turnover`——持球方犯了一些粗心大意的失误，导致对方球队获得球权。'
- en: '`violation`—One team, usually the team in possession of the ball, has committed
    some sort of violation such as traveling, double dribble, or three seconds in
    the key, which results in a change of possession.'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`violation`——一方球队，通常是持球方，犯了一些违规行为，如越位、两次运球或关键区三秒违例，这导致球权改变。'
- en: 'In the following chunk of `dplyr` code, we call the `group_by``()` and `tally()`
    functions to return the counts for each event type in the pbp data set in the
    form of a tibble called tbl1:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的 `dplyr` 代码块中，我们调用 `group_by()` 和 `tally()` 函数，以 tibble 形式返回 pbp 数据集中每种事件类型的计数，称为
    tbl1：
- en: '[PRE9]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Following are a few observations and explanations:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些观察和解释：
- en: Ejections are rare. Players permanently foul out of a game once they’ve committed
    their sixth personal foul, but that is a disqualification and not an ejection.
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 投篮犯规很少见。一旦球员犯了第六次个人犯规，就会被永久罚下场，但这是一种取消资格，而不是被驱逐出场。
- en: There is an equal number of events for end of period and start of period, which
    makes perfect sense.
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 结束时段和开始时段的事件数量相等，这是完全合理的。
- en: Personal fouls often immediately result in one or two free throw attempts, but
    sometimes don’t result in attempted free throws at all. There is no way to readily
    derive the count for one measure from the count of another.
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 个人犯规通常立即导致一次或两次罚球尝试，但有时根本不会导致罚球尝试。无法从另一个计数中轻松推导出一个计数的数量。
- en: There are approximately 15,000 more events where a player missed a shot attempt
    versus making a shot, meaning more shots are missed than made.
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 大约有 15,000 次事件是球员投篮未命中，而不是投篮命中，这意味着未命中的投篮比命中的投篮多。
- en: Rebounds come after *most* missed shots and missed free throws, but not all.
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 反弹通常发生在大多数投篮不中和罚球不中之后，但并非所有。
- en: Passes between teammates might be the most obvious—certainly the most frequent—event
    type not accounted for in our data set.
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同队球员之间的传球可能是最明显的一——当然是最频繁的一——事件类型，但我们的数据集中没有记录。
- en: Note that our data set includes 790 observations in which no event type has
    been defined; our call to the `levels()` function failed to detect these. Otherwise,
    these numbers make perfect sense—just a few ejections, more missed than made field
    goal attempts, for instance—which, of course, suggests we’re working with a reliable
    data set overall.
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注意，我们的数据集中有790个观测值，其中没有定义事件类型；我们对`levels()`函数的调用未能检测到这些。否则，这些数字完全合理——只是少数投篮，比投篮次数多，例如，这当然表明我们正在处理一个整体上可靠的数据集。
- en: 'Our next operation is to convert the variable `team` to a factor. We can then
    call the `levels()` function once more to return the factor levels, but we’ll
    call the base R `summary()` function instead, which returns the factor levels
    *and* the record counts for each. Thus, the `summary()` function returns factor
    levels and counts for the variable team, whereas we previously called the `levels()`
    function and then wrote a small chunk of `dplyr` code to return the same with
    respect to the variable `event_type`:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 我们接下来的操作是将变量`team`转换为因子。然后我们可以再次调用`levels()`函数来返回因子水平，但我们将调用基本的R `summary()`函数，它返回因子水平和每个的记录计数。因此，`summary()`函数返回了变量`team`的因子水平和计数，而之前我们调用`levels()`函数，然后编写一小段`dplyr`代码来返回与变量`event_type`相同的相同结果：
- en: '[PRE10]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The NBA is a 30-team league, yet the variable team contains 31 levels, due to
    30,346 blanks that R returns as NAs.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: NBA是一个30支球队的联赛，但变量`team`包含31个水平，这是由于R返回的30,346个空白值作为NAs。
- en: 'Finally, we again call the `summary()` function to return a series of basic
    statistics for the variable points:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们再次调用`summary()`函数来返回变量`points`的一系列基本统计数据：
- en: '[PRE11]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Though our data set isn’t necessarily perfect, the results are nonetheless
    consistent with our expectations:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我们的数据集可能并不完美，但结果仍然与我们的预期一致：
- en: Points aren’t possible through most event types, so we have the 267,122 NAs.
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 大多数事件类型中不可能得分，所以我们有267,122个NAs。
- en: Missed shots and missed free throws result in zero points.
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 失误和罚球失误得零分。
- en: One point is awarded for a successful free throw.
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 成功的罚球得一分。
- en: Two or three points are awarded for successful field goals, depending on how
    close or how far from the basket the shot was attempted.
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 成功的投篮得两分或三分，具体取决于投篮距离篮筐的远近。
- en: Now that we’ve explored and wrangled our data, it’s time to go about analyzing
    it.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经探索并整理了我们的数据，是时候开始分析它了。
- en: 8.5 Analysis
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 8.5 分析
- en: To reiterate, our purpose here is to establish how well the optimal stopping
    algorithm applies to the NBA. In other words, we want to determine if it makes
    sense for NBA teams to automatically abstain from shooting for some finite number
    of seconds and then take the first available shot that is equal to or better than
    any previous shot opportunity; if yes, we want to further determine if the 37%
    rule applies. As always, we must be careful not to make any sweeping conclusions.
    Because the analysis that follows uses just the data we’ve already imported and
    subsequently wrangled, our verdicts thus apply to the 2019-20 regular season only.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 再次强调，我们在这里的目的是确定最优停止算法在NBA中的应用效果。换句话说，我们想确定NBA球队是否应该自动放弃射击一些有限秒数，然后抓住第一个等于或优于任何先前射击机会的射击；如果是的话，我们还想进一步确定37%规则是否适用。一如既往，我们必须小心不要得出任何过于宽泛的结论。因为接下来的分析只使用了我们已导入并随后整理的数据，因此我们的结论仅适用于2019-20赛季常规赛。
- en: Our analysis is otherwise divided into two parts. We’ll begin by isolating three
    teams that had very different points per game averages during the 2019-20 season,
    summarizing and visualizing their points scored and field goal percentages by
    1-second increments, and then drawing some larger conclusions based on what R
    returns for us. Afterward, we’ll do the same for the NBA as a whole by packing
    the league’s 30 teams into a single data series. Let’s start with the Milwaukee
    Bucks, who led the NBA in scoring during the 2019-20 regular season by averaging
    118.7 points per game.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的分析分为两部分。我们将首先隔离三支在2019-20赛季每场比赛得分平均值差异很大的球队，按1秒的增量总结和可视化他们的得分和投篮百分比，然后基于R返回的结果得出一些更广泛的结论。之后，我们将对整个NBA进行同样的分析，将联盟的30支球队打包成一个单一的数据系列。让我们从密尔沃基雄鹿队开始，他们在2019-20赛季常规赛中平均每场得分118.7分，领跑NBA。
- en: 8.5.1 Milwaukee Bucks
  id: totrans-89
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.5.1 密尔沃基雄鹿队
- en: 'Our first order of business is to create a Milwaukee Bucks data set from the
    pbp data set. We’ll begin by calling the `dplyr filter()` function to reduce the
    length of pbp by only retaining observations that meet a specific series of criteria:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的首要任务是创建一个从 pbp 数据集中提取的密尔沃基雄鹿队数据集。我们将首先调用 `dplyr filter()` 函数来通过仅保留满足一系列特定标准的观测值来减少
    pbp 的长度：
- en: Where the variable `team` equals `MIL`, which is short for Milwaukee Bucks
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当变量 `team` 等于 `MIL`，即密尔沃基雄鹿队
- en: Where our derived variable `play_length2` is equal to or greater than `5` *and*
    less than or equal to `24`
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当我们派生的变量 `play_length2` 等于或大于 `5` 且小于或等于 `24`
- en: Where the variable `event_type` equals `shot` *or* `miss`
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当变量 `event_type` 等于 `shot` 或 `miss`
- en: Some explanation is required here. Our interest here is in half-court possessions
    where teams can choose to deliberate by dribbling and passing or can instead take
    action by shooting. Attempted shots less than 5 seconds into a possession are
    usually fast-break opportunities against an out-of-position defense, easy returns
    near the basket immediately following an offensive rebound, or a desperate effort
    to beat an expiring game clock. In all three scenarios, shooting the ball is the
    only *reasonable* course of action. So times of possession less than 5 seconds
    in duration will be ignored by removing them altogether. Some cutoff is therefore
    an absolute must; 5 seconds is admittedly somewhat arbitrary, but it does represent
    the approximate duration of most fast breaks. Unfortunately, our data set doesn’t
    contain an event type that indicates when teams in possession of the ball cross
    mid-court and establish their half-court sets.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 这里需要一些解释。我们的兴趣在于半场控球，球队可以选择通过运球和传球来犹豫，或者可以选择通过投篮来采取行动。控球时间少于 5 秒的投篮通常是对站位不当的防守的快速反击机会，是进攻篮板后靠近篮筐的轻松得分，或者是在比赛时间即将用尽时的绝望努力。在这三种情况下，投篮是唯一合理的行动。因此，持续时间少于
    5 秒的控球时间将被忽略，全部删除。因此，设定一个截止点绝对是必要的；5 秒虽然有些武断，但确实代表了大多数快速反击的大致持续时间。不幸的是，我们的数据集没有包含一个事件类型来指示控球球队何时穿过中场并建立半场阵容。
- en: Furthermore, the NBA employs a 24-second shot clock, which means teams must
    attempt a shot within 24 seconds of gaining possession or otherwise turn the ball
    over to the opposing team. The shot clock increases scoring by accelerating the
    pace of play and prevents teams from using stalling tactics to protect leads (and
    from boring the fans). For some reason—probably due to missing event types—the
    pbp data set includes a *small* number of observations where the variable `play_length2`
    is greater than 24 seconds. Therefore, it only makes sense to remove these few
    records.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，NBA 采用 24 秒的投篮计时器，这意味着球队必须在获得球权后的 24 秒内尝试投篮，否则将球权转给对方球队。投篮计时器通过加快比赛节奏来增加得分，并防止球队使用拖延战术来保护领先（以及避免让观众感到无聊）。由于某些原因——可能是由于缺少事件类型——pbp
    数据集中包含一些变量 `play_length2` 大于 24 秒的观测值。因此，只删除这些少数记录是有意义的。
- en: Finally, we’re only interested in plays where a shot was made or missed. Because
    we’re not interested in ejections, rebounds, violations, and other event types,
    it makes sense to also remove these records.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们只对投篮或未投篮的回合感兴趣。因为我们不感兴趣于驱逐、篮板、犯规和其他事件类型，所以也删除这些记录是有意义的。
- en: Creating data sources
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 创建数据源
- en: 'The end result is a new object called MIL. One note about our `dplyr` code
    and specifically the logic we’re passing to the `filter()` function: like other
    programming languages, R requires variable names to be explicitly called out whenever
    setting unique selection criteria. For instance, if we were to tell R that `play_length2`
    must be equal to or greater than 5 seconds and less than or equal to 24 seconds,
    rather than telling R that `play_length2` must be equal to or greater than 5 seconds
    and `play_length2` should also be equal to or less than 24 seconds, R wouldn’t
    have any idea which pbp variable should be equal to or less than 24; it would
    then throw an error.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 最终结果是称为 MIL 的新对象。关于我们的 `dplyr` 代码和特别是我们传递给 `filter()` 函数的逻辑的一个注意事项：像其他编程语言一样，R
    要求在设置唯一选择标准时明确调用变量名。例如，如果我们告诉 R `play_length2` 必须等于或大于 5 秒且小于或等于 24 秒，而不是告诉 R
    `play_length2` 必须等于或大于 5 秒，并且 `play_length2` 也应该等于或小于 24 秒，R 就会不知道哪个 pbp 变量应该等于或小于
    24；然后它会抛出一个错误。
- en: 'We then call the `dim()` function to return the MIL row and columns counts:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们调用 `dim()` 函数来返回 MIL 行和列的数量：
- en: '[PRE12]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: MIL contains 5,436 rows and 45 columns. Our analysis requires only the variables
    `event_type`, `points`, and `play_length2`; therefore, we cut the width of MIL
    by calling the `dplyr select()` function, which subsets MIL by retaining these
    three variables only.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: MIL 包含 5,436 行和 45 列。我们的分析只需要 `event_type`、`points` 和 `play_length2` 这三个变量；因此，我们通过调用
    `dplyr select()` 函数来裁剪 MIL 的宽度，该函数仅保留这三个变量。
- en: 'We then call the `dim()` function again, just to confirm that MIL now has a
    dimension of 5,436 rows and only three columns. It’s always up to you when or
    how often you want to validate operations and display results of the same. We
    lean toward being safe rather than sorry:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们再次调用 `dim()` 函数，只是为了确认 MIL 现在具有 5,436 行和仅三个列的维度。何时以及如何频繁地验证操作和显示相同的结果完全取决于你。我们倾向于安全而不是后悔：
- en: '[PRE13]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'We then pipe the MIL data set to the `dplyr group_by``()` and `summarize()`
    functions to compute the average number of points the Bucks scored by each value
    in the derived variable `play_length2`. Our result is a 20 × 2 tibble called MILx
    where `play_length2` is one column (with a minimum of 5 and a maximum of 24 seconds)
    and `avg` is the other column, which represents the average, or mean, number of
    points scored:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们将 MIL 数据集通过管道传递到 `dplyr group_by()` 和 `summarize()` 函数，以计算雄鹿队在每个 `play_length2`
    值上得分的平均值。我们的结果是名为 MILx 的 20 × 2 tibble，其中 `play_length2` 是一列（最小值为 5，最大值为 24 秒），而
    `avg` 是另一列，它代表平均或平均得分数：
- en: '[PRE14]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: We’ll keep these results in our back pocket for the time being.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将暂时将这些结果放在我们的口袋里。
- en: Meanwhile, let’s create a second data object that gets us the field goal percentages
    for every value in `play_length2`. We then pass MIL to the `tabyl()` function
    from the `janitor` package to create a frequency table, where the first argument
    is `play_length2` and the second argument is `event_type`. R returns a frequency
    table, or a data frame—called MILy—that tabulates the frequencies of every `event_type`
    factor for every `play_length2` value. Because we’re only interested in the shot
    and miss event types, we then call the `select()` function to reduce MILy to include
    just those two variables, plus, of course, `play_length2`.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 同时，让我们创建第二个数据对象，以获取 `play_length2` 中每个值的投篮百分比。然后我们将 MIL 传递给 `janitor` 包中的 `tabyl()`
    函数来创建一个频率表，其中第一个参数是 `play_length2`，第二个参数是 `event_type`。R 返回一个频率表，或数据框——称为 MILy，它统计了每个
    `play_length2` 值的每个 `event_type` 因子的频率。因为我们只对投篮和未命中事件类型感兴趣，所以我们调用 `select()` 函数将
    MILy 简化，仅包括这两个变量，当然还有 `play_length2`。
- en: 'Finally, we make a call to the `mutate()` function from the `dplyr` package
    to create another variable, `fg_pct`, which is then appended to MILy. Our new
    variable computes the field goal (or shot) percentage by dividing the variable
    `shot` by the sum of variables `shot` and `miss`; the quotient is then multiplied
    by 100 to return a percentage. Our derived variable is then rounded to just two
    digits to the right of the decimal point:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们调用来自 `dplyr` 包的 `mutate()` 函数来创建另一个变量，`fg_pct`，然后将其附加到 MILy 上。我们的新变量通过将变量
    `shot` 除以变量 `shot` 和 `miss` 的总和来计算投篮（或射门）百分比；然后将商数乘以 100 以返回一个百分比。我们的导出变量然后四舍五入到小数点后两位：
- en: '[PRE15]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Displaying results
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 显示结果
- en: 'We now have a pair of data sources, MILx and MILy, for two separate yet complementary
    `ggplot2` line charts. The first of our two line charts, MILp1, pulls from the
    tibble MILx and displays the average number of points the Milwaukee Bucks scored
    during the 2019-20 regular season for every whole second of possession time, between
    5 and 24 seconds, where a made or missed shot was the result:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们有两个数据源，MILx 和 MILy，用于两个独立但互补的 `ggplot2` 线形图。我们两个线形图中的第一个，MILp1，从 tibble
    MILx 中提取数据，显示了密尔沃基雄鹿队在 2019-20 赛季的每个整秒拥有时间中得分平均数，在 5 到 24 秒之间，其中投篮命中或未命中是结果：
- en: So `play_length2` is our x-axis variable, and `avg`, which we created using
    a combination of the `dplyr group_by``()` and `summarize()` functions, is our
    y-axis variable.
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 因此，`play_length2` 是我们的 x 轴变量，而 `avg`，我们使用 `dplyr group_by()` 和 `summarize()`
    函数的组合创建，是我们的 y 轴变量。
- en: The `geom_line()` function draws the line, and the `geom_point()` function adds
    a layer of points to the line.
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`geom_line()` 函数绘制线条，而 `geom_point()` 函数向线条添加点层。'
- en: The `geom_smooth()` function, called three times, draws a trio of regression
    lines over the data, which allow us to readily see how the average number of points
    scored trended as the length of play increased. Regression lines are drawn to
    minimize the distances between it and the applicable data points. The blue line
    illustrates the trend covering the entire data series, whereas the gold and purple
    lines, respectively, display the trends before and after 12 seconds, or the 37%
    mark (12 seconds equals 5 plus 7 seconds; 7 divided by 19 seconds equals 37%).
    By passing the `se = FALSE` argument, we’re instructing R to not draw shaded confidence
    intervals above and below our regression lines.
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 被调用三次的 `geom_smooth()` 函数在数据上绘制了三条回归线，使我们能够轻松地看到平均得分趋势是如何随着比赛时间的增加而变化的。回归线被绘制出来以最小化它与适用数据点之间的距离。蓝色线表示覆盖整个数据系列的趋势，而金色和紫色线分别显示了
    12 秒前后的趋势，或 37% 的标记（12 秒等于 5 秒加 7 秒；7 除以 19 秒等于 37%）。通过传递 `se = FALSE` 参数，我们指示
    R 不要在回归线之上和之下绘制阴影置信区间。
- en: The `theme_classic()` function replaces the `ggplot2` default background with
    one that is solid white. The `theme_classic()` function must be called *before*
    the `theme()` function to preserve the bold font for the title; otherwise, the
    `theme_ classic()` function, which renders the header in plain font, would overwrite
    the `theme()` function preferences.
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`theme_classic()` 函数将 `ggplot2` 默认的背景替换为纯白色。必须在使用 `theme()` 函数之前调用 `theme_classic()`
    函数，以保留标题的粗体字体；否则，`theme_classic()` 函数，它以普通字体渲染标题，将覆盖 `theme()` 函数的偏好设置。'
- en: The `inset_element()` function, which is actually part of the `patchwork` package,
    insets a .png file called bucks. The left, bottom, right, and top arguments collectively
    determine where the image should be placed and how large or small it should be.
    Because those arguments equal numbers close to 1, our image will be placed in
    the upper-right corner of the plot. You’ll likely want to experiment with these
    settings.
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`inset_element()` 函数，实际上是 `patchwork` 包的一部分，将名为 bucks 的 .png 文件嵌入。左、底、右和顶参数共同决定图像应该放置的位置以及它的大小。因为这些参数等于接近
    1 的数字，所以我们的图像将被放置在图表的右上角。你可能想要尝试这些设置。'
- en: 'All of this is thrown together in the following code chunk:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些都在以下代码块中一起使用：
- en: '[PRE16]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Our second line chart, MILp2, pulls from MILy, the frequency table we previously
    created by calling the `tabyl()` function from the `janitor` package. The variable
    `play_length2` is again our x-axis variable, and `fg_pct` is our y-axis variable.
    Otherwise, the syntax for our second line chart is just like our first one, thereby
    returning a graphical object with the forms, features, and functions equivalent
    to MILp1:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的第二个折线图 MILp2 从 MILy 中获取，这是通过调用 `janitor` 包中的 `tabyl()` 函数之前创建的频率表。`play_length2`
    是我们的 x 轴变量，`fg_pct` 是我们的 y 轴变量。否则，我们的第二个折线图的语法就像第一个一样，因此返回一个具有与 MILp1 相同的形式、特征和功能的图形对象：
- en: '[PRE17]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'We then call the `plot_layout()` function from the `patchwork` package to bundle
    our two line charts into a single object where the plots are placed side by side
    (see figure 8.1). Our attention is immediately drawn to the fact that points scored
    and field goal percentage both drop precipitously as time of possession increases,
    although the relationship isn’t exactly linear:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们调用 `plot_layout()` 函数，该函数来自 `patchwork` 包，将我们的两个折线图捆绑成一个单一的对象，其中图表并排放置（见图
    8.1）。我们的注意力立即被吸引到这样一个事实，即得分和投篮命中率都会随着控球时间的增加而急剧下降，尽管这种关系并不完全是线性的：
- en: '[PRE18]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![CH08_F01_Sutton](../../OEBPS/Images/CH08_F01_Sutton.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![CH08_F01_Sutton](../../OEBPS/Images/CH08_F01_Sutton.png)'
- en: Figure 8.1 Average number of points scored (on the left) and field goal percentage
    (on the right) for the Milwaukee Bucks during the 2019-20 regular season computed
    at each second of a half-court possession, with trendlines
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.1 在 2019-20 赛季每半场控球每秒计算出的密尔沃基雄鹿队平均得分（左侧）和投篮命中率（右侧），并带有趋势线
- en: Conclusions
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 结论
- en: 'Before summarizing our first set of results, let’s discuss optimal stopping
    a bit more: first, the intended purpose of the optimal stopping rule is to prescribe
    a *specific* amount of intended deliberation before acting, that is, how many
    candidates a hiring manager should interview for an open role before extending
    an offer, or how long an NBA team should dribble and pass before attempting a
    shot.'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 在总结我们的第一组结果之前，让我们再讨论一下最佳停止策略：首先，最佳停止规则的目的在于规定在采取行动之前应该进行的具体思考量，也就是说，招聘经理在发出录用通知之前应该面试多少个候选人，或者NBA球队在尝试投篮之前应该运球和传球多长时间。
- en: 'Second, when applied properly, optimal stopping returns a maximum gain and
    prevents valueless effort. The maximum gain might not equate to a “great” return
    in any absolute sense, but it does produce the highest chance of a *best* return
    against several alternatives. Defying the optimal stopping rule doesn’t increase
    chances for a best outcome: a hiring manager won’t increase chances of landing
    the best applicant by breaching the optimal stopping point; an NBA team won’t,
    at least theoretically, make more shots by ignoring the optimal stopping point
    and pursuing the false hope of a better scoring opportunity.'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 第二，当正确应用时，最佳停止策略会带来最大收益并防止无效努力。最大收益可能不等于任何绝对意义上的“巨大”回报，但它确实提供了在几种替代方案中实现最佳回报的最高机会。违反最佳停止规则不会增加最佳结果的机会：招聘经理不会通过违反最佳停止点来增加找到最佳申请人的机会；NBA球队至少在理论上，不会通过忽视最佳停止点并追求更好的得分机会的虚假希望而射出更多的球。
- en: Third, regardless of the situation, the point at which a hiring manager or an
    NBA team—or anyone—should leap rather than continuing to look is the 37% mark.
    There are two ways of computing what that mark is or where it is. If, for instance,
    *n* equals 20—there are 20 candidates in an applicant pool or 20 seconds remaining
    on the shot clock—the optimal stopping point is the product of 20 and 37%, which
    equals 7 (when rounded down to the nearest whole number). Alternatively, we get
    the same result when *n* is divided by *e*, the mathematical constant approximately
    equal to 2.72.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 第三，无论情况如何，招聘经理或NBA球队——或任何人——应该跳过而不是继续寻找的点是37%。计算这个标记的方法有两种。例如，如果*n*等于20——申请池中有20个候选人或投篮时钟剩余20秒——最佳停止点就是20乘以37%，等于7（四舍五入到最接近的整数）。或者，当*n*除以数学常数*e*（约等于2.72）时，我们也会得到相同的结果。
- en: So if a hiring manager has an applicant pool of 20 candidates, the manager should
    automatically pass on the first seven candidates, continue interviewing, and then
    stop immediately after interviewing the first candidate that compares well to
    the first seven. By the same token, an NBA team should refrain from shooting until
    the 24-second shot clock is half expired equal to 12, or 5 plus 7, seconds and
    then attempt a shot once it has a scoring opportunity as good or better than any
    previous opportunity.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，如果招聘经理有20个候选人的申请池，经理应该自动跳过前七个候选人，继续面试，然后在面试第一个与前面七个候选人相比表现良好的候选人后立即停止。同样，NBA球队应该等到24秒的投篮时钟过半，即12秒，或5加7秒，然后才有得分机会，这个机会与任何之前的得分机会一样好或更好时再尝试投篮。
- en: 'That being said, from these two plots, we can draw a combination of obvious
    and maybe not-so-obvious conclusions, as there’s a lot to unpack here:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 话虽如此，从这两个图表中，我们可以得出一些明显和可能不那么明显的结论，因为这里有很多东西需要解释：
- en: Trendlines are visual representations of direction where the slope further illustrates
    the rate of change. Though the downward trends are hardly linear, our two y-axis
    variables, average points scored and field goal percentage, are nevertheless positively
    and strongly correlated with one another—meaning they move in the same direction
    at the same time.
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 趋势线是方向的视觉表示，其中斜率进一步说明了变化的速率。尽管下降趋势几乎不是线性的，但我们的两个y轴变量，平均得分和投篮命中率，仍然正强相关——这意味着它们同时向同一方向移动。
- en: With respect to the average number of points scored for every second of possession
    time, the Bucks were most successful when our x-axis variable equaled 8 seconds
    or 20 seconds; the Bucks averaged 1.19 points when x equaled 8 and 1.18 points
    when x equaled 20.
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于每秒占有时间平均得分的数量，雄鹿队在x轴变量等于8秒或20秒时最成功；当x等于8时，雄鹿队平均得到1.19分，当x等于20时，平均得到1.18分。
- en: That’s significant because it means the Bucks were never as successful at scoring
    points after the 37% mark as they were before then. In other words, Milwaukee’s
    optimal stopping point was actually before the 37% mark and not after that.
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这是有意义的，因为它意味着雄鹿队在37%的标记之后从未像之前那样成功得分。换句话说，密尔沃基的最佳停止点实际上是在37%的标记之前，而不是之后。
- en: However, those results don’t translate to field goal percentage. The Bucks shot
    49.03% from the floor when x equaled 8 and 49.55% when x equaled 15\. Of course,
    this means Milwaukee was better off not shooting before the 37% mark, based on
    this measure, at least.
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 然而，这些结果并不能转化为投篮命中率。当x等于8时，雄鹿队的投篮命中率为49.03%，当x等于15时为49.55%。当然，这意味着根据这一衡量标准，至少密尔沃基在37%的标记之前不投篮是更好的选择。
- en: At any rate, the Bucks were generally better off scoring points and shooting
    from the floor when there was more time remaining on the shot clock. We say “generally”
    because, once more, the trends aren’t exactly linear; most of the data points
    are, in fact, well below or well above our regression lines. This suggests that
    what we’re really seeing is a regression to the mean phenomenon, where opposite
    results offset one another, rather than the letter of the optimal stopping rule.
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无论如何，当投篮计时器剩余时间更多时，雄鹿队通常在得分和投篮方面表现得更好。我们说“通常”，因为，又一次，这些趋势并不完全是线性的；大多数数据点实际上都远远低于或高于我们的回归线。这表明我们真正看到的是回归到平均值的现象，其中相反的结果相互抵消，而不是最优停止规则的字面意思。
- en: To carry this last point a step further, take a closer look at either or both
    plots where x equals 19 to 21 seconds—these three consecutive data points are
    significantly and alternately below or above the regression lines. Milwaukee’s
    success at scoring points and shooting the basketball when just 4 seconds remain
    on the shot clock (x therefore equals 20) is as much an offset to their relative
    lack of success when x equals 19, and their further lack of success when x equals
    21 is yet another offset in the opposite direction.
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为了进一步阐述这一点，让我们更仔细地看看x等于19到21秒的图表——这三个连续的数据点显著且交替地低于或高于回归线。当投篮计时器仅剩4秒时（因此x等于20），密尔沃基在得分和投篮方面的成功在很大程度上是对其当x等于19时的相对不成功的一种抵消，而当x等于21时，其进一步的不成功则是另一种相反方向的抵消。
- en: Regression to the mean, sometimes called regression *toward* the mean, is a
    phenomenon by which extreme outcomes are succeeded by more moderate outcomes or
    equally extreme outcomes in the opposite direction that average each other out.
    What we’re seeing is natural variation due to chance, or, at a minimum, results
    that are the natural byproduct of just a few data points. After all, our data
    contains significantly fewer records when there are no more than 5 seconds remaining
    on the shot clock than otherwise. We’ll see the same phenomenon as we next evaluate
    results for two more teams; however, we’ll instead observe smoothed-over results
    when we analyze the entire NBA in a single data series.
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 回归到平均值，有时也称为回归*到*平均值，是一种现象，其中极端的结果被更温和的结果或同等极端但方向相反的结果所继起，从而相互抵消。我们所看到的是由于偶然性引起的变化，或者至少是只有少数数据点的自然结果。毕竟，当投篮计时器剩余时间不超过5秒时，我们的数据包含的记录明显少于其他情况。当我们评估两个更多球队的结果时，我们将看到相同的现象；然而，当我们分析整个NBA的单个数据系列时，我们将观察到平滑过的结果。
- en: Next, we’ll see how well these results hold up, or don’t hold up, with a pair
    of lesser-scoring teams.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将看看这些结果能保持多久，或者不能保持多久，我们将使用一对得分较低的球队。
- en: 8.5.2 Atlanta Hawks
  id: totrans-139
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.5.2 亚特兰大老鹰队
- en: We’ll first repeat this exercise by substituting the Atlanta Hawks for the Bucks.
    The Hawks scored 111.8 points per game during the 2019-20 regular season, which
    was the league average.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先将用亚特兰大老鹰队代替雄鹿队重复这项练习。老鹰队在2019-20赛季常规赛中每场比赛得到111.8分，这是联盟的平均水平。
- en: Creating data sources
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 创建数据源
- en: 'We subset the pbp data set where the variable `team` equals `ATL` (short for
    Atlanta Hawks), the derived variable `play_length2` is equal to or greater than
    `5` and less than or equal to `24`, and the variable `event_type` equals `shot`
    or `miss`. We then call the `dim()` function to return the dimension of our new
    data set:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 我们对pbp数据集进行子集化，其中变量`team`等于`ATL`（代表亚特兰大老鹰队），派生变量`play_length2`等于或大于`5`且小于或等于`24`，变量`event_type`等于`shot`或`miss`。然后我们调用`dim()`函数来返回我们新数据集的维度：
- en: '[PRE19]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The ATL data set is 4,945 rows long, which is considerably shorter than the
    MIL data set. The following chunk of `dplyr` code returns the miss and shot counts
    for the Hawks and Bucks for comparison purposes.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: ATL数据集有4,945行，这比MIL数据集短得多。以下`dplyr`代码块返回老鹰队和雄鹿队的失误和投篮次数，用于比较目的。
- en: '[PRE20]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: The Hawks attempted 441 fewer field goals than the Bucks and made 396 fewer
    shots. That’s why the ATL row count is less than the MIL row count—and why the
    Hawks scored seven fewer points per game, on average, than the Milwaukee Bucks.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 老鹰队的投篮次数比雄鹿队少441次，投篮次数少396次。这就是为什么ATL行数少于MIL行数，以及为什么老鹰队平均每场比赛比密尔沃基雄鹿队少得7分。
- en: 'We then call the `select()` function to reduce the width of ATL by just retaining
    the variables `event_type`, `points`, and `play_length2`:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们调用`select()`函数，仅保留`event_type`、`points`和`play_length2`变量来减少ATL的宽度：
- en: '[PRE21]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: A rerun of the `dim()` function confirms that our ATL data set now includes
    just those three variables.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 再次运行`dim()`函数确认，我们的ATL数据集现在仅包含这三个变量。
- en: 'Next, we create a tibble called ATLx, the Atlanta equivalent to MILx, by calling
    the `dplyr group_by``()` and `summarize()` functions to compute the average number
    of points the Hawks scored for every second in the variable `play_length2`:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们通过调用`dplyr group_by()`和`summarize()`函数创建一个名为ATLx的tibble，这是亚特兰大的MILx的对应物，以计算老鹰队在`play_length2`变量中每秒的平均得分：
- en: '[PRE22]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: We then create a frequency table called ATLy, the Atlanta equivalent to MILy,
    by passing ATL to the `tabyl()` function and adding `play_length2` and `event_type`
    as additional arguments. Because we only need the variable `play_length2` and
    the `shot` and `miss` factors from the variable `event_type`, which are now also
    variables, we then call the `select()` function to reduce ATLy to include just
    `play_length2`, `shot`, and `miss`.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们创建一个名为ATLy的频率表，这是亚特兰大的MILy的对应物，通过将ATL传递给`tabyl()`函数，并添加`play_length2`和`event_type`作为额外的参数。因为我们只需要`event_type`变量中的`play_length2`变量以及`shot`和`miss`因子，这些现在也是变量，所以我们调用`select()`函数将ATLy减少到仅包含`play_length2`、`shot`和`miss`。
- en: 'Next, we call the `mutate()` function to create a variable called `fg_pct`;
    our new variable computes the field goal percentage by dividing the variable `shot`
    by the sum of the variables `shot` and `miss`, which is then multiplied by 100
    to return a percentage. Our derived variable is then rounded to two digits to
    the right of the decimal point:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们调用`mutate()`函数创建一个名为`fg_pct`的变量；我们的新变量通过将`shot`变量除以`shot`和`miss`变量之和，然后乘以100来计算投篮命中率。我们的导出变量随后被四舍五入到小数点后两位：
- en: '[PRE23]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Displaying results
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 展示结果
- en: 'We’ll pull the tibble ATLx into one chunk of `ggplot2` code to source one line
    chart and the frequency table ATLy into another chunk of `ggplot2` code to source
    a second line chart. These line charts (see figure 8.2) are just like the first
    pair we created, except that we’ve swapped out data sources and images:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将tibble ATLx提取为一段`ggplot2`代码，以生成一个折线图，并将频率表ATLy提取为另一段`ggplot2`代码，以生成第二个折线图。这些折线图（见图8.2）与第一个对完全相同，只是我们更换了数据源和图像：
- en: '[PRE24]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![CH08_F02_Sutton](../../OEBPS/Images/CH08_F02_Sutton.png)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![CH08_F02_Sutton](../../OEBPS/Images/CH08_F02_Sutton.png)'
- en: Figure 8.2 Average number of points scored (on the left) and field goal percentage
    (on the right) for the Atlanta Hawks during the 2019-20 regular season computed
    at each second of a half-court possession, with trendlines
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.2展示了亚特兰大老鹰队在2019-20赛季常规赛中，在每个半场控球秒数所获得的平均得分（左侧）和投篮命中率（右侧），并附有趋势线
- en: 'After temporarily holding ATLp1 and ATLp2 in memory, we bundle them together
    by again calling the `plot_layout()` function from the `patchwork` package and
    print the two as a single object:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 在临时保留ATLp1和ATLp2在内存中后，我们再次通过调用`plot_layout()`函数从`patchwork`包中捆绑它们，并将两个对象打印为一个单一对象：
- en: '[PRE25]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Conclusions
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 结论
- en: 'Our results are both the same and not quite the same as before:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的结果既相同又略有不同：
- en: With respect to points scored and field goal percentage, the 2019-20 Hawks were
    most successful just 7 seconds into their time of possession, when they averaged
    1.17 points and made 49.18% of their field goal attempts.
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在得分和投篮命中率方面，2019-20赛季的老鹰队在控球时间仅7秒时最成功，平均每秒得到1.17分，投篮命中率达到了49.18%。
- en: This means that at no point after the 37% mark did the Hawks average as many
    points or shoot an equal or better field goal percentage than they did when their
    time of possession equaled 7 seconds. So once more, we’re not seeing the optimal
    stopping, or 37%, rule in effect.
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这意味着在37%标记之后，老鹰队平均得分没有达到或超过他们在控球时间等于7秒时的得分，也没有达到或超过他们的投篮命中率。因此，我们再次没有看到最佳停止，或37%，规则生效。
- en: Like the Bucks, the Atlanta Hawks were generally more successful on offense,
    regardless of which measure we’re considering, when more time remained on the
    shot clock.
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 就像雄鹿队一样，亚特兰大老鹰队在剩余投篮时间较多时，无论从哪个角度来看，在进攻上都普遍更成功。
- en: Also like the Bucks, we see ongoing regressions to the mean as the x-axis variable
    increases and the observation counts decrease.
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同样，就像雄鹿队一样，我们看到随着x轴变量的增加和观察次数的减少，存在回归到平均水平的趋势。
- en: Let’s take a look at just one more team.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们再看看另一支球队。
- en: 8.5.3 Charlotte Hornets
  id: totrans-169
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.5.3 夏洛特黄蜂队
- en: We’ll again repeat this exercise, this time by inserting the Charlotte Hornets
    for the Bucks or Hawks. The Hornets averaged just 102.9 points per game during
    the 2019-20 regular season, which was lowest in the league.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将再次重复这项练习，这次是将夏洛特黄蜂队插入到雄鹿队或老鹰队的位置。2019-20赛季常规赛中，黄蜂队平均每场得分仅为102.9分，这是联盟中最低的。
- en: Creating data sources
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 创建数据源
- en: 'We pass the pbp data set to the `filter()` function to subset it where the
    variable `team` equals `CHA`, the variable `play_length2` is again equal to or
    greater than `5` and less than or equal to `24`, and the variable `event_type`
    equals `shot` or `miss`. We then cast the results to equal a tibble called CHA.
    Next, we pass CHA to the `select()` function to reduce its width by just retaining
    the variables `event_type`, `points`, and `play_length2`. Finally, we call the
    `dim()` function to return the final dimension of the CHA data set:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将pbp数据集传递给`filter()`函数，以便对它进行子集化，其中变量`team`等于`CHA`，变量`play_length2`再次等于或大于`5`且小于或等于`24`，变量`event_type`等于`shot`或`miss`。然后我们将结果转换为名为CHA的tibble。接下来，我们将CHA传递给`select()`函数，通过仅保留变量`event_type`、`points`和`play_length2`来减少其宽度。最后，我们调用`dim()`函数以返回CHA数据集的最终维度：
- en: '[PRE26]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The CHA data set contains 4,539 observations between the `miss` and `made`
    event types. We then pipe CHA to the `group_by``()` and `tally()` functions to
    return the miss and made counts so we can compare and contrast the Hornets with
    the Bucks and Hawks:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: CHA数据集包含在`miss`和`made`事件类型之间的4,539个观测值。然后我们将CHA传递给`group_by()`和`tally()`函数，以返回失误和命中次数，这样我们就可以比较和对比黄蜂队与雄鹿队和老鹰队：
- en: '[PRE27]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: The 2019-20 Charlotte Hornets attempted 897 fewer shots than the Bucks and 406
    fewer shots than the Hawks; they made 619 fewer shots than the Bucks and made
    223 fewer shots than the Hawks.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 2019-20赛季的夏洛特黄蜂队比雄鹿队少尝试了897次投篮，比老鹰队少406次；他们比雄鹿队少投中619次，比老鹰队少投中223次。
- en: 'We then create a tibble called CHAx and a frequency table called CHAy, just
    as we’ve done twice before:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们创建一个名为CHAx的tibble和一个名为CHAy的频率表，就像我们之前做过两次一样：
- en: '[PRE28]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Displaying results
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 显示结果
- en: 'We then create a third pair of line charts to visualize Charlotte’s points-per-game
    average and field goal percentage per second of possession time (see figure 8.3):'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们创建第三组折线图来可视化夏洛特黄蜂队每场比赛的平均得分和每秒控球时间的投篮命中率（见图8.3）：
- en: '[PRE29]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '![CH08_F03_Sutton](../../OEBPS/Images/CH08_F03_Sutton.png)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
  zh: '![CH08_F03_Sutton](../../OEBPS/Images/CH08_F03_Sutton.png)'
- en: Figure 8.3 Average number of points scored (on the left) and field goal percentage
    (on the right) for the Charlotte Hornets during the 2019-20 regular season computed
    at each second of a half-court possession, with trendlines
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.3 在2019-20赛季常规赛中，夏洛特黄蜂队在半场控球每秒的平均得分（左侧）和投篮命中率（右侧），并带有趋势线
- en: Conclusions
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 结论
- en: 'For Charlotte, we have a mix of like and unlike results compared to the previous
    teams:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 与之前的球队相比，夏洛特黄蜂队的结果既有相似之处也有不同之处：
- en: Interestingly, with respect to both average points and field goal percentage,
    the Charlotte Hornets were best off applying the optimal stopping rule.
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有趣的是，无论是平均得分还是投篮命中率，夏洛特黄蜂队最擅长应用最佳停止规则。
- en: Where time of possession equals 6 seconds, the Hornets averaged 1.14 points
    and made 48.44% of their shot attempts, which is when the Hornets were most successful
    on offense before the 37% mark.
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当控球时间等于6秒时，黄蜂队平均每场得到1.14分，投篮命中率达到了48.44%，这是黄蜂队在37%命中率之前进攻最成功的时候。
- en: But where time of possession instead equals 18 seconds, the Hornets averaged
    1.19 points and were successful on 49.78% of their attempted shots, which actually
    compares well to Milwaukee’s best figures.
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 但当控球时间等于18秒时，黄蜂队平均得到1.19分，并且在其尝试的投篮中成功率为49.78%，这实际上与密尔沃基队最佳数据相当。
- en: Otherwise, we see like trends as well as ongoing regressions to the mean—just
    as we did with the Bucks and Hawks.
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 否则，我们也会看到类似趋势以及回归到平均值——就像我们在雄鹿和老鹰队中看到的那样。
- en: Finally, let’s examine the whole NBA—Bucks, Hawks, and Hornets included—in one
    final pair of `ggplot2` line charts.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，让我们通过最后的一对`ggplot2`线形图来审视整个NBA——包括雄鹿、老鹰和黄蜂队。
- en: 8.5.4 NBA
  id: totrans-191
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.5.4 NBA
- en: 'No doubt, you’re now familiar with the code, but note that the first argument
    passed to the `filter()` function is optional; as it turns out, there are no observations
    in the pbp data set where the variable `team` is blank *and* the variable `event_type`
    equals `shot` or `miss`. The end result, as you might expect by now, is yet another
    pair of complementary `ggplot2` line charts (see figure 8.4):'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 毫无疑问，你现在已经熟悉了代码，但请注意，传递给`filter()`函数的第一个参数是可选的；实际上，在pbp数据集中没有变量`team`为空且变量`event_type`等于`shot`或`miss`的观测值。最终结果，正如你现在可能预料的那样，又是另一对互补的`ggplot2`线形图（见图8.4）：
- en: '[PRE30]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '![CH08_F04_Sutton](../../OEBPS/Images/CH08_F04_Sutton.png)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![CH08_F04_Sutton](../../OEBPS/Images/CH08_F04_Sutton.png)'
- en: Figure 8.4 Average number of points scored (on the left) and field goal percentage
    (on the right) for all 30 NBA teams during the 2019-20 regular season computed
    at each second of a half-court possession, with trendlines
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.4 在2019-20赛季的常规赛中，每半场控球时间每秒所有30支NBA球队的平均得分（左侧）和投篮命中率（右侧），并带有趋势线
- en: 'We see some really fascinating results here, but not necessarily unexpected
    results due to the size of the data:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里看到了一些非常有趣的结果，但这些结果并不一定是由于数据量大小而产生的意外结果：
- en: For starters, we don’t see the second-over-second variation that we do when
    visualizing results for just one team at a time. That’s because the results have
    been more or less smoothed out as a result of plotting the whole NBA in a single
    data series rather than just 1 of 30 teams.
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 首先，我们没有看到在仅可视化一个球队的结果时出现的第二次超过第二次的变化。这是因为结果在将整个NBA绘制在一个数据系列中而不是仅30支球队中的1支时，已经被或多或少地平滑化了。
- en: Instead, we see three regression lines with roughly equal but steep slopes and,
    of course, relatively minimal distances between any of them and the data.
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 相反，我们看到三条大致相等但斜率陡峭的回归线，当然，它们之间的相对距离相对较小。
- en: These regression lines suggest that neither the optimal stopping rule nor regressions
    to the mean are in effect.
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这些回归线表明，既没有最优停止规则，也没有回归到平均值的效果。
- en: Most significantly, teams are *way* better off shooting earlier than later.
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最重要的是，球队在早于晚投篮时表现得更好。
- en: As far as the optimal stopping rule is concerned, our results, at least to the
    *letter* of the rule, are mixed at best; in fact, where some might see optimal
    stopping, we instead see regressions to the mean. But the *spirit* of the optimal
    stopping rule does apply to the NBA. Remember that optimal stopping, in part,
    is aimed at preventing wasteful effort—pull the trigger on a qualified candidate
    and stop interviewing; take a good shot and stop passing and dribbling. Our team-level
    and league-level analysis strongly suggests that teams are most successful scoring
    points and shooting higher field goal percentages when there is more time remaining
    on the shot clock, at least based on 2019-20 regular season data.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 就最优停止规则而言，我们的结果，至少从规则的字面意义上讲，是混合的；事实上，在一些地方可能看到最优停止，而我们却看到了回归到平均值。但最优停止规则的精神确实适用于NBA。记住，最优停止部分目的是为了防止浪费精力——对合格的候选人开枪并停止面试；好好投篮并停止传球和运球。我们的团队层面和联赛层面的分析强烈表明，当剩余的投篮时钟时间更长时，球队在得分和投篮命中率方面最成功，至少基于2019-20赛季的数据。
- en: In this chapter and the one prior, we explored different facets of NBA games
    controlled by the officials or by the players and coaches, but in the next chapter,
    we’ll examine how the league schedule can significantly influence wins and losses
    when one team is playing on more rest than its opponent.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章和前一章中，我们探讨了由裁判、球员和教练控制的NBA比赛的各个方面，但在下一章中，我们将探讨联赛赛程如何显著影响一支球队在休息时间比对手更多时胜负。
- en: Summary
  id: totrans-203
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: We all have opportunities in our personal and professional lives to apply the
    optimal stopping rule. For example, if you’re in the market for a new home and
    absolutely want or need to submit an offer within 60 days, you should spend the
    first 22 days (37% of 60) noncommittally attending open houses; you should then
    submit an offer on the first house that favorably compares to the best house you
    previously inspected. Similarly, if you’re speed dating, you should spend the
    first 37% of the evening more or less warming up, and then make a match with the
    first person who is just as appealing as everyone you’ve already met. Finally,
    if you’re a lawyer researching the best legal precedent among 25 qualifying cases,
    you should automatically dismiss the first nine cases and then proceed with the
    first case that best compares to that initial batch.
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在我们的个人和职业生活中，我们都拥有应用最佳停止规则的机会。例如，如果你在市场上寻找新家，并且绝对需要在60天内提交出价，你应该在前22天（60天的37%）非承诺性地参加公开房屋参观；然后你应该提交出价给第一套与你之前检查过的最佳房屋有利的房屋。同样，如果你在快速约会，你应该在晚上的前37%的时间里进行更多的热身，然后与第一个与你已经遇到的所有人一样吸引人的第一人配对。最后，如果你是一名律师，正在研究25个符合条件的案例中的最佳法律先例，你应该自动排除前九个案例，然后继续处理与最初一批最相似的第一个案例。
- en: 'However, keep the following in mind: optimal stopping is fixed on providing
    the highest *probability* of a best outcome, without any guarantees, while proactively
    eliminating wasteful efforts. And it *only* works when you don’t have second chances.'
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 然而，请注意：最佳停止策略旨在提供最高**概率**的最佳结果，没有任何保证，同时积极消除浪费的努力。而且它**仅**在你没有第二次机会时才有效。
- en: Optimal stopping isn’t necessarily a best fit for the NBA, at least based on
    our analysis of the 2019-20 regular season data. What might be construed as optimal
    stopping are more likely regressions to the mean, where positive and negative
    results are continuously offsetting one another. However, NBA teams during the
    2019-20 regular season were generally better off—much better off, in fact—shooting
    earlier in their half-court sets rather than later.
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最佳停止策略不一定适合NBA，至少根据我们对2019-20赛季常规赛季数据的分析是这样的。可能被视为最佳停止策略的更有可能是回归到平均值，其中正面和负面的结果不断地相互抵消。然而，在2019-20赛季的常规赛季中，NBA球队通常表现得更好——实际上要好得多——在半场设置中尽早投篮，而不是晚些时候。
- en: It’s usually not worth it for a team to pass up good or even decent shot opportunities
    and to use what’s left, or mostly left, on the 24-second shot clock. The mostly
    old-school idea that teams are more frequently than not better off passing and
    dribbling until a best shot opportunity comes to fruition is absolutely false.
    In other words, while the letter of the optimal stopping rule might not be generally
    applicable, the spirit of optimal stopping absolutely applies.
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于一支球队来说，放弃好的或甚至还可以的投篮机会，并使用剩下的或大部分剩下的24秒投篮时钟上的时间，通常是不值得的。那种认为球队在大多数情况下通过传球和运球直到最佳投篮机会出现而更有利的老式想法是完全错误的。换句话说，虽然最佳停止规则的字面意义可能并不普遍适用，但最佳停止的精神绝对适用。
- en: In the meantime, we otherwise demonstrated how to create a frequency table and
    how to create a character string derived from another character string.
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同时，我们展示了如何创建频率表以及如何从一个字符串创建另一个字符串的字符串。
- en: We also showed how you can overwrite default `ggplot2` settings by adding a
    theme, how to inset images that improve the quality of your visual content, and
    how to add multiple trendlines to the same line chart.
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们还展示了如何通过添加主题来覆盖默认的`ggplot2`设置，如何嵌入提高你视觉内容质量的图片，以及如何向同一张线图添加多个趋势线。
