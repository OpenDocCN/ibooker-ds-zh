- en: appendix A. Creating a development environment with Vagrant
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录 A. 使用 Vagrant 创建开发环境
- en: Vagrant is a tool that allows us to script the creation of a virtual machine
    (VM). It’s typically used for creating a VM to run on our local computer (rather
    than building a VM to run in the cloud).
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Vagrant 是一个允许我们通过脚本创建虚拟机（VM）的工具。它通常用于创建在本地计算机上运行的 VM（而不是在云中运行的 VM）。
- en: Vagrant is a great way to create a Linux-based development environment. It’s
    also great for experimenting with new software (e.g., Docker and Terraform). You
    can use it so that you don’t clutter up your regular development computer with
    new software.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: Vagrant 是创建基于 Linux 的开发环境的好方法。它也适用于实验新的软件（例如 Docker 和 Terraform）。你可以使用它，这样就不会让你的常规开发计算机因为新软件而变得杂乱无章。
- en: I used Vagrant extensively on a day-to-day basis for development until just
    recently. It was really useful as a convenient way to get Docker working on a
    computer running Windows 10 Home. Now, I use WSL2 (*Windows Subsystem for Linux
    2*). Docker for Windows integrates with that (see chapter 3 for details), so I
    don’t need Vagrant to run Docker anymore.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 我直到最近还在日常开发中广泛使用 Vagrant。它作为一个方便的方法，在运行 Windows 10 Home 的计算机上安装 Docker 非常有用。现在，我使用
    WSL2（*Windows Subsystem for Linux 2*）。Docker for Windows 与之集成（详见第 3 章），因此我不再需要
    Vagrant 来运行 Docker。
- en: 'But Vagrant is still useful for building throwaway environments for development,
    testing, and experimentation. You can find an example Vagrant setup on GitHub:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 但 Vagrant 仍然适用于构建用于开发、测试和实验的临时环境。你可以在 GitHub 上找到一个示例 Vagrant 设置：
- en: '[https://github.com/bootstrapping-microservices/example-vagrant-vm](https://github.com/bootstrapping-microservices/example-vagrant-vm)'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/bootstrapping-microservices/example-vagrant-vm](https://github.com/bootstrapping-microservices/example-vagrant-vm)'
- en: The example Vagrant setup installs Docker, Docker Compose, and Terraform automatically,
    giving you an “instant” development environment you can use to experiment with
    the code examples that accompany this book (see section A.6). Note that the example
    code repositories for the chapters of this book each include a preconfigured Vagrant
    script that you can use to run the code for that chapter.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 Vagrant 设置会自动安装 Docker、Docker Compose 和 Terraform，为你提供一个“即时”的开发环境，你可以使用这个环境来实验本书附带代码示例（见附录
    A.6）。请注意，本书各章节的示例代码库都包含一个预配置的 Vagrant 脚本，你可以使用它来运行该章节的代码。
- en: A.1 Installing VirtualBox
  id: totrans-7
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.1 安装 VirtualBox
- en: 'Before using Vagrant, you must install VirtualBox. This is the software that
    actually runs the VM within your regular computer (the host). You can download
    it from the VirtualBox download page:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用 Vagrant 之前，你必须安装 VirtualBox。这是在您的普通计算机（主机）内实际运行 VM 的软件。您可以从 VirtualBox 下载页面下载它：
- en: '[https://www.virtualbox.org/wiki/Downloads](https://www.virtualbox.org/wiki/Downloads)'
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://www.virtualbox.org/wiki/Downloads](https://www.virtualbox.org/wiki/Downloads)'
- en: Download and install the package that fits your host operating system. Follow
    the instructions on the VirtualBox web page.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 下载并安装适合您主机操作系统的包。按照 VirtualBox 网页上的说明操作。
- en: NOTE Vagrant supports other VM providers, like VMWare, but I recommend VirtualBox
    because it’s free and easy to setup.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：Vagrant 支持其他 VM 提供商，如 VMWare，但我推荐使用 VirtualBox，因为它免费且易于设置。
- en: A.2 Installing Vagrant
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.2 安装 Vagrant
- en: 'Now install Vagrant. This is a scripting layer on top of VirtualBox that allows
    you to manage the setup of your VM through code (Ruby code actually). You can
    download it from the Vagrant downloads page:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 现在安装 Vagrant。这是 VirtualBox 之上的一个脚本层，允许你通过代码（实际上是 Ruby 代码）管理 VM 的设置。您可以从 Vagrant
    下载页面下载它：
- en: '[https://www.vagrantup.com/downloads.html](https://www.vagrantup.com/downloads.html)'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://www.vagrantup.com/downloads.html](https://www.vagrantup.com/downloads.html)'
- en: Download and install the package that fits your host operating system. Follow
    the instructions on the Vagrant web page.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 下载并安装适合您主机操作系统的包。按照 Vagrant 网页上的说明操作。
- en: A.3 Creating your virtual machine (VM)
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.3 创建你的虚拟机（VM）
- en: 'With VirtualBox and Vagrant installed, you are now ready to create your VM.
    First, you must decide which operating system to use. If you already have a production
    system in place, choose that same operating system. If not, choose a long-term
    support (LTS) version that will hold up for a long time. You can search for operating
    systems on this web page:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装了 VirtualBox 和 Vagrant 之后，你现在可以创建你的 VM。首先，你必须决定使用哪个操作系统。如果你已经有一个生产系统，请选择相同的操作系统。如果没有，请选择一个长期支持（LTS）版本，这将长期保持稳定。你可以在本网页上搜索操作系统：
- en: '[https://vagrantcloud.com/search](https://vagrantcloud.com/search)'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://vagrantcloud.com/search](https://vagrantcloud.com/search)'
- en: I’m a big fan of Ubuntu Linux, so for this example, we’ll use Ubuntu 20.04 LTS.
    The Vagrant name for the *box* that we’ll install is `ubuntu/xenial64`.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我非常喜欢Ubuntu Linux，所以在这个例子中，我们将使用Ubuntu 20.04 LTS。我们将安装的*box*的Vagrant名称是`ubuntu/xenial64`。
- en: 'Before creating the Vagrant box, open a command line and create a directory
    in which to store it. Change to that directory, then invoke the `vagrant init`
    command as follows:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建Vagrant box之前，打开命令行并创建一个目录来存储它。切换到该目录，然后按照以下方式调用`vagrant init`命令：
- en: '[PRE0]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'This creates a barebones Vagrantfile in the current directory. Edit this file
    to change the configuration and setup for your VM. You can learn more about Vagrant
    configuration here:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 这将在当前目录中创建一个基本的Vagrantfile。编辑此文件以更改虚拟机的配置和设置。你可以在这里了解更多关于Vagrant配置的信息：
- en: '[https://docs.vagrantup.com](https://docs.vagrantup.com)'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://docs.vagrantup.com](https://docs.vagrantup.com)'
- en: 'Now launch your VM:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 现在启动你的虚拟机：
- en: '[PRE1]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Make sure you run this command in the same directory that contains the Vagrantfile.
    This can take some time, especially if you don’t already have the image for the
    operating system locally cached. Do give it plenty of time to complete. Once it
    has finished, you will have a fresh Ubuntu VM to work with.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 确保你在包含Vagrantfile的同一目录中运行此命令。这可能需要一些时间，尤其是如果你还没有在本地缓存操作系统的镜像。请给它足够的时间完成。一旦完成，你将有一个全新的Ubuntu虚拟机可以工作。
- en: A.4 Connecting to your VM
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.4 连接到你的虚拟机
- en: 'With the VM booted up, you can now connect to it like this:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在虚拟机启动后，你可以这样连接到它：
- en: '[PRE2]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Vagrant automatically creates an SSH key and manages the connection for you.
    You now have a command-line shell into your VM. Any commands you invoke in this
    shell are executed inside your VM.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: Vagrant会自动创建一个SSH密钥并为你管理连接。你现在有了进入虚拟机的命令行shell。在这个shell中调用的任何命令都会在虚拟机内部执行。
- en: A.5 Installing software in the VM
  id: totrans-31
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.5 在虚拟机中安装软件
- en: With your VM running and having connected using `vagrant ssh`, you’ll now want
    to install some software. The first thing to do with your new VM is to update
    the operating system. You can do this in Ubuntu with
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的虚拟机运行并使用`vagrant ssh`连接后，你现在可能想要安装一些软件。在你的新虚拟机中要做的第一件事是更新操作系统。在Ubuntu中，你可以使用以下命令：
- en: '[PRE3]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: You can now install whatever software you need by following the instructions
    from the software vendor. To install Docker, see
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在可以通过遵循软件供应商的说明来安装所需的任何软件。要安装Docker，请参阅
- en: '[https://docs.docker.com/install/linux/docker-ce/ubuntu](https://docs.docker.com/install/linux/docker-ce/ubuntu)'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://docs.docker.com/install/linux/docker-ce/ubuntu](https://docs.docker.com/install/linux/docker-ce/ubuntu)'
- en: To install Docker Compose, see
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装Docker Compose，请参阅
- en: '[https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/)'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/)'
- en: 'To install Terraform, you simply download it, unpack it, and add the executable
    to your path. You can download Terraform from here:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装Terraform，你只需下载它，解压它，并将可执行文件添加到你的路径中。你可以从这里下载Terraform：
- en: '[https://www.terraform.io/downloads.html](https://www.terraform.io/downloads.html)'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://www.terraform.io/downloads.html](https://www.terraform.io/downloads.html)'
- en: The example Vagrant setup (next section) installs all these tools automatically.
    This gives you an “instant” development environment you can use to experiment
    with the code examples that accompany this book.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 示例Vagrant设置（下一节）会自动安装所有这些工具。这为你提供了一个“即时”的开发环境，你可以用它来实验这本书附带的代码示例。
- en: A.6 Using the example setup
  id: totrans-41
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.6 使用示例设置
- en: You can start a VM from the example setup on GitHub available at
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以从GitHub上的示例设置启动虚拟机
- en: '[https://github.com/bootstrapping-microservices/example-vagrant-vm](https://github.com/bootstrapping-microservices/example-vagrant-vm)'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/bootstrapping-microservices/example-vagrant-vm](https://github.com/bootstrapping-microservices/example-vagrant-vm)'
- en: 'Clone the repository using Git:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Git克隆仓库：
- en: '[PRE4]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Then change to that repository directory:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 然后切换到那个仓库目录：
- en: '[PRE5]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Now boot up the VM:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 现在启动虚拟机：
- en: '[PRE6]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Connect a command-line shell to the VM:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 将命令行shell连接到虚拟机：
- en: '[PRE7]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: This Vagrant script runs a shell script that automatically installs Docker,
    Docker Compose, and Terraform! Once the VM has started and you have connected
    you can use all these tools.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 这个Vagrant脚本运行一个shell脚本，该脚本会自动安装Docker、Docker Compose和Terraform！一旦虚拟机启动并连接，你就可以使用所有这些工具。
- en: A.7 Turning your VM off
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.7 关闭虚拟机
- en: 'After you have completely finished with your VM, you can destroy it with the
    following command:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在你完全完成虚拟机后，你可以使用以下命令将其销毁：
- en: '[PRE8]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'If you are only temporarily finished with the machine and would like to reuse
    it again later, suspend it with the following command:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你只是暂时完成机器，并希望以后再次使用它，可以使用以下命令挂起它：
- en: '[PRE9]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: A suspended machine can be resumed at any time by invoking `vagrant up`. Remember
    to destroy or suspend your virtual machines when you are not using these, otherwise,
    they’ll unnecessarily consume your valuable system resources.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 悬挂的机器可以通过调用 `vagrant up` 命令在任何时候恢复。记住，当您不使用这些虚拟机时，请销毁或挂起它们，否则它们将无端消耗您宝贵的系统资源。
