- en: Chapter 24\. Exploring data
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第24章\. 探索数据
- en: '*This chapter covers*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*本章涵盖*'
- en: Python’s advantages for handling data
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python 处理数据的优势
- en: Jupyter Notebook
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Jupyter Notebook
- en: pandas
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: pandas
- en: Data aggregation
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据聚合
- en: Plots with matplotlib
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用matplotlib绘制的图表
- en: Over the past few chapters, I’ve dealt with some aspects of using Python to
    get and clean data. Now it’s time to look at a few of the things that Python can
    help you do to manipulate and explore data.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在过去的几章中，我处理了一些使用Python获取和清理数据方面的内容。现在，是时候看看Python可以帮助你完成的一些操纵和探索数据的事情了。
- en: 24.1\. Python tools for data exploration
  id: totrans-8
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.1\. Python 数据探索工具
- en: 'In this chapter, we’ll look at some common Python tools for data exploration:
    Jupyter notebook, pandas, and matplotlib. I can only touch briefly on a few features
    of these tools, but the aim is to give you an idea of what is possible and some
    initial tools to use in exploring data with Python.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨一些常见的Python数据探索工具：Jupyter笔记本、pandas和matplotlib。我只会简要介绍这些工具的一些功能，但目的是给你一个可能的思路，以及一些在用Python探索数据时可以使用的初始工具。
- en: 24.1.1\. Python’s advantages for exploring data
  id: totrans-10
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.1.1\. Python 探索数据的优势
- en: Python has become one of the leading languages for data science and continues
    to grow in that area. As I’ve mentioned, however, Python isn’t always the fastest
    language in terms of raw performance. Conversely, some data-crunching libraries,
    such as NumPy, are largely written in C and heavily optimized to the point that
    speed isn’t an issue. In addition, considerations such as readability and accessibility
    often outweigh pure speed; minimizing the amount of developer time needed is often
    more important. Python is readable and accessible, and both on its own and in
    combination with tools developed in the Python community, it’s an enormously powerful
    tool for manipulating and exploring data.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: Python已经成为数据科学领域的主要语言之一，并继续在该领域增长。然而，正如我提到的，Python在原始性能方面并不总是最快的语言。相反，一些数据处理库，如NumPy，大部分是用C编写的，并且高度优化到速度不再是问题。此外，可读性和可访问性等考虑因素往往超过纯速度；最小化开发者所需的时间通常更为重要。Python是可读的且易于访问的，并且无论是单独使用还是与Python社区开发的工具结合使用，它都是操纵和探索数据的强大工具。
- en: 24.1.2\. Python can be better than a spreadsheet
  id: totrans-12
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.1.2\. Python 可以比电子表格做得更好
- en: 'Spreadsheets have been the tools of choice for ad-hoc data manipulation for
    decades. People who are skilled with spreadsheets can make them do truly impressive
    tricks: spreadsheets can combine different but related data sets, pivot tables,
    use lookup tables to link data sets, and much more. But although people everywhere
    get a vast amount of work done with them every day, spreadsheets do have limitations,
    and Python can help you go beyond those limitations.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 电子表格几十年来一直是临时数据处理的工具。擅长使用电子表格的人可以让它们完成真正令人印象深刻的技巧：电子表格可以结合不同的但相关的数据集，使用数据透视表，使用查找表来链接数据集，等等。尽管如此，尽管人们每天都在使用它们完成大量工作，但电子表格确实存在局限性，Python可以帮助你超越这些局限性。
- en: One limitation that I’ve already alluded to is the fact that most spreadsheet
    software has a row limit—currently, about 1 million rows, which isn’t enough for
    many data sets. Another limitation is the central metaphor of the spreadsheet
    itself. Spreadsheets are two-dimensional grids, rows and columns, or at best stacks
    of grids, which limits the ways you can manipulate and think about complex data.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 我已经提到的一个限制是，大多数电子表格软件都有一个行数限制——目前大约是100万行，这对于许多数据集来说是不够的。另一个限制是电子表格本身的中心隐喻。电子表格是二维网格，行和列，或者最多是网格的堆叠，这限制了你可以操纵和思考复杂数据的方式。
- en: With Python, you can code your way around the limitations of spreadsheets and
    manipulate data the way you want. You can combine Python data structures such
    as lists, tuples, sets, and dictionaries in endlessly flexible ways, or you can
    create your own classes to package both data and behavior exactly the way you
    need.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Python，你可以通过编写代码来克服电子表格的限制，并按照你想要的方式操纵数据。你可以以无数灵活的方式组合Python数据结构，如列表、元组、集合和字典，或者你可以创建自己的类来精确地封装数据和行为。
- en: 24.2\. Jupyter notebook
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.2\. Jupyter Notebook
- en: Probably one of the most compelling tools for exploring data with Python doesn’t
    augment what the language itself does, but changes the way you use the language
    to interact with your data. Jupyter notebook is a web application that allows
    you to create and share documents that contain live code, equations, visualizations,
    and explanatory text. Although several other languages are now supported, it originated
    in connection with IPython, an alternative shell for Python developed by the scientific
    community.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 可能是使用Python探索数据最有说服力的工具之一，它并没有增强语言本身的功能，而是改变了你使用语言与数据交互的方式。Jupyter笔记本是一个网络应用程序，允许你创建和分享包含实时代码、方程、可视化和解释性文本的文档。尽管现在支持多种其他语言，但它起源于与IPython的联系，这是科学社区为Python开发的替代shell。
- en: What makes Jupyter such a convenient and powerful tool is the fact that you
    interact with it in a web browser. It lets you combine text and code, as well
    as modify and execute your code interactively. You can not only run and modify
    code in chunks, but also save and share the notebooks with others.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 使Jupyter成为一个方便且强大的工具的原因在于，你可以通过网页浏览器与之交互。它允许你结合文本和代码，以及交互式地修改和执行你的代码。你不仅可以分块运行和修改代码，还可以与他人保存和分享笔记本。
- en: The best way to get a feel for what Jupyter notebook can do is start playing
    with it. It’s fairly easy to run a Jupyter process locally on your machine, or
    you can access online versions. For some options, see the sidebar on ways to run
    Jupyter.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 体验Jupyter笔记本能做什么的最佳方式就是开始尝试使用它。在本地机器上运行Jupyter进程相对容易，或者你也可以访问在线版本。有关一些选项，请参阅关于运行Jupyter方式的侧边栏。
- en: '|  |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**Ways to run Jupyter**'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '**运行Jupyter的方式**'
- en: '*Jupyter online:* Accessing online instances of Jupyter is one of the easiest
    ways to get started. Currently, Project Jupyter, the community behind Jupyter,
    hosts free notebooks at [https://jupyter.org/try](https://jupyter.org/try). You
    can also find demo notebooks and kernels for other languages. At this writing,
    you can also access free notebooks on Microsoft’s Azure platform at [https://notebooks.azure.com](https://notebooks.azure.com),
    and many other ways are available.'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '*Jupyter在线:* 访问Jupyter的在线实例是开始使用的一种最简单的方式。目前，Jupyter背后的社区Project Jupyter在[https://jupyter.org/try](https://jupyter.org/try)上提供免费的笔记本。你还可以找到其他语言的演示笔记本和内核。在撰写本文时，你还可以在Microsoft的Azure平台上访问免费的笔记本[https://notebooks.azure.com](https://notebooks.azure.com)，以及许多其他方式。'
- en: '*Jupyter locally:* Although using an online instance is quite convenient, it’s
    not very much work to set up your own instance of Jupyter on your computer. Usually
    for local versions, you point your browser to localhost:8888.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '*Jupyter本地:* 虽然使用在线实例非常方便，但在你的电脑上设置自己的Jupyter实例并不需要太多工作。通常对于本地版本，你只需将浏览器指向localhost:8888。'
- en: 'If you use Docker, you have several containers to choose among. To run the
    data science notebook container, use something like this:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用Docker，你可以在几个容器中进行选择。要运行数据科学笔记本容器，可以使用类似以下命令：
- en: '[PRE0]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: If you’d rather run directly on your system, it’s easy to install and run Jupyter
    in a virtualenv.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你更愿意直接在你的系统上运行，安装和运行Jupyter在virtualenv中非常容易。
- en: '*macOS and Linux systems:* First, open a command window, and enter the following
    commands:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '*macOS和Linux系统:* 首先，打开一个命令窗口，并输入以下命令：'
- en: '[PRE1]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '*Windows systems:*'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '*Windows系统:*'
- en: '[PRE2]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The last command should run the Jupyter notebook web app and open a browser
    window pointing at it.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个命令应该运行Jupyter笔记本网络应用程序，并打开指向它的浏览器窗口。
- en: '|  |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 24.2.1\. Starting a kernel
  id: totrans-33
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.2.1\. 启动内核
- en: When you have Jupyter installed, running, and open in your browser, you need
    to start a Python kernel. One nice thing about Jupyter is that it lets you run
    multiple kernels at the same time. You can run kernels for different versions
    of Python and for other languages such as R, Julia, and even Ruby.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 当你在浏览器中安装、运行并打开Jupyter时，你需要启动一个Python内核。Jupyter的一个优点是它允许你同时运行多个内核。你可以运行不同版本的Python内核，以及其他语言如R、Julia甚至Ruby的内核。
- en: Starting a kernel is easy. Just click the new button and select Python 3 ([figure
    24.1](#ch24fig01)).
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 启动内核很简单。只需点击新建按钮，并选择Python 3（[图24.1](#ch24fig01)）。
- en: Figure 24.1\. Starting a Python kernel
  id: totrans-36
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图24.1\. 启动Python内核
- en: '![](images/24fig01_alt.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![](images/24fig01_alt.jpg)'
- en: 24.2.2\. Executing code in a cell
  id: totrans-38
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.2.2\. 在单元格中执行代码
- en: When you have a kernel running, you can start entering and running Python code.
    Right away, you’ll notice a few differences from the ordinary Python command shell.
    You won’t get the >>> prompt that you see in the standard Python shell, and pressing
    Enter just adds new lines in the cell. To execute the code in a cell, illustrated
    in [figure 24.2](#ch24fig02), choose Cell > Run Cells, click the Run button immediately
    to the left of the down arrow on the button bar, or use the key combination Alt-Enter.
    After you use Jupyter notebook a little bit, it’s quite likely that the Alt-Enter
    key combination will become quite natural to you.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 当你有一个正在运行的内核时，你可以开始输入和运行 Python 代码。立即，你会注意到与普通 Python 命令行的一些不同。你不会在标准 Python
    命令行中看到 >>> 提示符，按 Enter 只是在单元格中添加新行。要在一个单元格中执行代码，如[图 24.2](#ch24fig02)所示，选择单元格
    > 运行单元格，点击按钮栏上箭头下方的运行按钮，或使用快捷键 Alt-Enter。使用 Jupyter notebook 一段时间后，Alt-Enter 键组合可能会变得非常自然。
- en: Figure 24.2\. Executing code in a notebook cell
  id: totrans-40
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 24.2\. 在笔记本单元格中执行代码
- en: '![](images/24fig02_alt.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](images/24fig02_alt.jpg)'
- en: You can test how it works by entering some code or an expression into the first
    cell of your new notebook and then pressing Alt-Enter.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过在新的笔记本的第一个单元格中输入一些代码或表达式来测试其工作方式，然后按 Alt-Enter。
- en: As you can see, any output is shown immediately below the cell, and a new cell
    is created and ready for your next input. Also note that each cell that’s executed
    is numbered in the order in which it’s executed.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，任何输出都显示在单元格下方，并且会创建一个新的单元格，准备接收你的下一个输入。此外，请注意，每个已执行的单元格都会按照执行顺序进行编号。
- en: '|  |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'Try this: Using Jupyter Notebook'
  id: totrans-45
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 尝试这样做：使用 Jupyter Notebook
- en: Enter some code in the notebook and experiment with running it. Check out the
    Edit, Cell, and Kernel menus to see what options are there. When you have a little
    code running, use the Kernel menu to restart the kernel, repeat your steps, and
    then use the Cell menu to rerun the code in all of the cells.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在笔记本中输入一些代码并尝试运行它。查看编辑、单元格和内核菜单，看看有哪些选项。当你运行了一小段代码后，使用内核菜单来重启内核，重复你的步骤，然后使用单元格菜单在所有单元格中重新运行代码。
- en: '|  |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 24.3\. Python and pandas
  id: totrans-48
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.3\. Python 和 pandas
- en: In the course of exploring and manipulating data, you perform quite a few common
    operations, such as loading data into a list or dictionary, cleaning data, and
    filtering data. Most of these operations are repeated often, have to be done in
    standard patterns, and are simple and often tedious. If you think that this combination
    is a strong reason to automate those tasks you’re not alone. One of the now-standard
    tools for handling data in Python—pandas—was created to automate the boring heavy
    lifting of handling data sets.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在探索和操作数据的过程中，你会执行许多常见的操作，例如将数据加载到列表或字典中，清理数据，以及过滤数据。这些操作大多数都是经常重复的，必须按照标准模式执行，简单且通常很繁琐。如果你认为这种组合是自动化这些任务的一个强有力的理由，你并不孤单。Python
    中现在用于处理数据的标准工具之一——pandas——就是为了自动化处理数据集的繁琐工作而创建的。
- en: 24.3.1\. Why you might want to use pandas
  id: totrans-50
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.3.1\. 你可能想要使用 pandas 的原因
- en: pandas was created to make manipulating and analyzing tablular or relational
    data easy by providing a standard framework for holding the data, with convenient
    tools for frequent operations. As a result, it’s almost more of an extension to
    Python than a library, and it changes the way you can interact with data. The
    plus side is that after you grok how pandas work, you can do some impressive things
    and save a lot of time. It does take time to learn how to get the most from pandas,
    however. As with many tools, if you use pandas for what it was designed for, it
    excels. The simple examples I show you in the following sections should give you
    a rough idea whether pandas is a tool that’s suited for your use cases.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: pandas 的创建是为了通过提供一个标准的框架来存储数据，并提供方便的工具来执行频繁的操作，使得操作和解析表格或关系型数据变得容易。因此，它几乎更像是
    Python 的一个扩展，而不是一个库，它改变了你与数据交互的方式。好处是，一旦你掌握了 pandas 的工作原理，你就可以做一些令人印象深刻的事情，并节省大量时间。然而，学习如何充分利用
    pandas 需要时间。与许多工具一样，如果你按照 pandas 的设计目的使用它，它就会表现出色。以下章节中展示的简单示例应该能给你一个大致的概念，即 pandas
    是否适合你的使用场景。
- en: 24.3.2\. Installing pandas
  id: totrans-52
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.3.2\. 安装 pandas
- en: 'pandas is easy to install with `pip`. It’s often used along with matplotlib
    for plotting, so you can install both tools from the command line of your Jupyter
    virtual environment with this code:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `pip` 可以轻松安装 pandas。它通常与 matplotlib 一起用于绘图，因此你可以使用以下代码从 Jupyter 虚拟环境的命令行安装这两个工具：
- en: '[PRE3]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: From a cell in a Jupyter notebook, you can use
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 从 Jupyter 笔记本的一个单元格中，你可以使用
- en: '[PRE4]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'If you use pandas, life will be easier if you use the following three lines:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用pandas，使用以下三行会使生活变得更简单：
- en: '[PRE5]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The first line is a Jupyter “magic” function that enables matplotlib to plot
    data in the cell where your code is (which is very useful). The second line imports
    pandas with the alias of pd, which is both easier to type and common among pandas
    users; the last line also imports numpy. Although pandas depends quite a bit on
    numpy, you won’t use it explicitly in the following examples, but it’s reasonable
    to get into the habit of importing it anyway.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 第一行是一个Jupyter“魔法”函数，它使matplotlib能够在你的代码所在的单元格中绘制数据（这非常有用）。第二行使用别名pd导入pandas，这使得输入更简单，并且是pandas用户中常见的做法；最后一行也导入了numpy。尽管pandas在很大程度上依赖于numpy，但在下面的例子中你不会明确使用它，但养成导入它的习惯是合理的。
- en: 24.3.3\. Data frames
  id: totrans-60
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.3.3. 数据框
- en: 'One basic structure that you get with pandas is a data frame. A *data frame*
    is a two-dimensional grid, rather similar to a relational database table except
    in memory. Creating a data frame is easy; you give it some data. To keep things
    absolutely simple, give it a 3 × 3 grid of numbers as the first example. In Python,
    such a grid is a list of lists:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 使用pandas，你可以得到一个基本结构，即数据框。*数据框*是一个二维网格，与内存中的关系数据库表非常相似。创建数据框很容易；给它一些数据。为了使事情尽可能简单，以一个3×3的数字网格作为第一个例子。在Python中，这样的网格是列表的列表：
- en: '[PRE6]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Sadly, in Python the grid won’t look like a grid unless you make some additional
    effort. So see what you can do with the same grid as a pandas data frame:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 很遗憾，在Python中，除非你做出额外的努力，否则网格看起来不会像网格。所以看看你能否用同一个网格作为pandas数据框来做什么：
- en: '[PRE7]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'That code is fairly straightforward; all you needed to do was turn your grid
    into a data frame. You’ve gained a more gridlike display, and now you have both
    row and column numbers. It’s often rather bothersome to keep track of what column
    number is what, of course, so give your columns names:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 那段代码相当简单；你所需要做的只是将你的网格转换成数据框。你现在有了更网格化的显示，并且现在你既有行号也有列号。当然，跟踪列号是什么往往相当麻烦，所以给你的列起个名字：
- en: '[PRE8]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'You may wonder whether naming the columns has any benefit, but the column names
    can be put to use with another pandas trick: the ability to select columns by
    name. If you want the contents only of column `"two"`, for example, you can get
    it very simply:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会想知道给列命名是否有任何好处，但列名可以用另一个pandas技巧来使用：通过名称选择列的能力。例如，如果你想只获取列“two”的内容，你可以非常简单地得到它：
- en: '[PRE9]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Here, you’ve already saved time in comparison to Python. To get only column
    two of your grid, you’d need to use a list comprehension while also remembering
    to use a zero-based index (and you still wouldn’t get the nice output):'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，与Python相比，你已经节省了时间。要只获取网格的第二列，你需要使用列表推导，同时记得使用零基索引（而且你仍然不会得到那么好的输出）：
- en: '[PRE10]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'You can loop over data frame column values just as easily as the list you got
    by using a comprehension:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以像使用推导得到的列表一样轻松地遍历数据框的列值：
- en: '[PRE11]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'That’s not bad for a start, but by using a list of columns in double brackets,
    you can do better, getting a subset of the data frame that’s another data frame.
    Instead of getting the middle column, get the first and last columns of your data
    frame as another data frame:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 这对于开始来说还不错，但通过使用双括号中的列列表，你可以做得更好，得到另一个数据框的数据子集。而不是获取中间列，获取你的数据框的第一列和最后一列作为另一个数据框：
- en: '[PRE12]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'A data frame also has several methods that apply the same operation and argument
    to every item in the frame. If you want to add two to every item in the data frame’s
    edges, you could use the `add()` method:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 数据框也有几个方法，可以对框架中的每个项目应用相同的操作和参数。如果你想将数据框边缘的每个项目加2，你可以使用`add()`方法：
- en: '[PRE13]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Here again, it’s possible to get the same result by using list comprehensions
    and/or nested loops, but those techniques aren’t as convenient. It’s pretty easy
    to see how such functionality can make life easier, particularly for someone who’s
    more interested in the information that the data contains than in the process
    of manipulating it.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，同样可以通过使用列表推导和/或嵌套循环来得到相同的结果，但这些技术并不那么方便。很容易看出这样的功能可以使生活变得更轻松，尤其是对于那些对数据包含的信息比对操作过程更感兴趣的人。
- en: 24.4\. Data cleaning
  id: totrans-78
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.4. 数据清洗
- en: In earlier chapters, I discussed a few ways to use Python to clean data. Now
    that I’ve added pandas to the mix, I’ll show you examples of how to use its functionality
    to clean data. As I present the following operations, I also refer to ways that
    the same operation might be done in plain Python, both to illustrate how using
    pandas is different and to show why pandas isn’t right for every use case (or
    user, for that matter).
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的章节中，我讨论了几种使用Python清理数据的方法。现在，我已经将pandas添加到其中，我将展示如何使用其功能来清理数据。在介绍以下操作时，我也提到了在纯Python中执行相同操作的方法，既为了说明使用pandas的不同之处，也为了展示为什么pandas并不适合每个用例（或者用户，无论如何）。
- en: 24.4.1\. Loading and saving data with pandas
  id: totrans-80
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.4.1\. 使用pandas加载和保存数据
- en: pandas has an impressive collection of methods to load data from different sources.
    It supports several file formats (including fixed-width and delimited text files,
    spreadsheets, JSON, XML, and HTML), but it’s also possible to read from SQL databases,
    Google BiqQuery, HDF, and even clipboard data. You should be aware that many of
    these operations aren’t actually part of pandas itself; pandas relies on having
    other libraries installed to handle those operations, such as SQLAlchemy for reading
    from SQL databases. This distinction matters mostly if something goes wrong; quite
    often, the problem that needs to be fixed is outside pandas, and you’re left to
    deal with the underlying library.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: pandas有一系列令人印象深刻的方法可以从不同的来源加载数据。它支持多种文件格式（包括固定宽度和分隔文本文件、电子表格、JSON、XML和HTML），但也可以从SQL数据库、Google
    BigQuery、HDF甚至剪贴板数据中读取。你应该意识到，许多这些操作实际上并不是pandas本身的一部分；pandas依赖于安装其他库来处理这些操作，例如使用SQLAlchemy从SQL数据库读取。这种区别在出现问题的时候很重要；很多时候，需要解决的问题在pandas之外，你只能处理底层库。
- en: 'Reading a JSON file with the `read_json()` method is simple:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`read_json()`方法读取JSON文件很简单：
- en: '[PRE14]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'This code gives you a data frame like this:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码会给你一个如下所示的数据框：
- en: '[PRE15]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'For another example of how simple reading data into pandas is, load some data
    from the CSV file of temperature data from [chapter 21](kindle_split_034.html#ch21)
    and from the JSON file of Mars weather data used in [chapter 22](kindle_split_035.html#ch22).
    In the first case, use the `read_csv()` method:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 为了展示如何简单地将数据读入pandas，从[第21章](kindle_split_034.html#ch21)的温度数据CSV文件和[第22章](kindle_split_035.html#ch22)中使用的火星天气数据JSON文件加载数据。在第一种情况下，使用`read_csv()`方法：
- en: '[PRE16]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '***1* Note that the \ at the end of the header line is an indication that the
    table is too long to be printed on one line and more columns are printed below.**'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 注意，标题行末尾的\是一个指示，表明表格太长，无法在一行中打印，更多列将在下面打印。**'
- en: 'Clearly, loading the file in a single step is appealing, and you can see that
    pandas had no issues loading the file. You can also see that the empty first column
    has been translated into `NaN` (not a number). You do still have the same issue
    with `''Missing''` for some values, and in fact it might make sense to have those
    `''Missing''` values converted to `NaN`:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，单步加载文件很吸引人，你可以看到pandas没有在加载文件时遇到任何问题。你也可以看到空的第一列已经被转换为`NaN`（不是一个数字）。你仍然有一些值存在`'Missing'`的问题，实际上，将那些`'Missing'`值转换为`NaN`可能是有意义的：
- en: '[PRE17]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The addition of the `na_values` parameter controls what values will be translated
    to `NaN` on load. In this case, you added the string `'Missing'` so that the row
    of the data frame was translated from
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '`na_values`参数的添加控制了在加载时哪些值会被转换为`NaN`。在这种情况下，你添加了字符串`''Missing''`，因此数据框的行从'
- en: '[PRE18]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: to
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 转换为
- en: '[PRE19]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'This technique can be particularly useful if you have one of those data files
    in which, for whatever reason, “no data” is indicated in a variety of ways: `NA`,
    `N/A`, `?`, `-`, and so on. To handle a case like that, you can inspect the data
    to find out what’s used and then reload it, using the `na_values` parameter to
    standardize all those variations as `NaN`.'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有那种数据文件，无论出于什么原因，“无数据”以各种方式表示：`NA`、`N/A`、`?`、`-`等等，这种技术特别有用。为了处理这种情况，你可以检查数据以找出使用了什么，然后重新加载它，使用`na_values`参数将所有这些变化标准化为`NaN`。
- en: Saving data
  id: totrans-96
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 保存数据
- en: If you want to save the contents of a data frame, a pandas data frame has a
    similarly broad collection of methods. If you take your simple grid data frame,
    you can write it in several ways. This line
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要保存数据框的内容，pandas数据框有一系列广泛的方法。如果你有一个简单的网格数据框，你可以以几种方式写入它。这一行
- en: '[PRE20]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '***1* Setting index to False means that the row indexes will not be written.**'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 将索引设置为False意味着行索引将不会被写入。**'
- en: 'writes a file that looks like this:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 写入一个如下所示的文件：
- en: '[PRE21]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Similarly, you can transform a data grid to a JSON object or write it to a
    file:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，你可以将数据网格转换为 JSON 对象或将它写入文件：
- en: '[PRE22]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '***1* Supplying a file path as an argument writes the JSON to that file rather
    than returning it.**'
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 将文件路径作为参数传递会将 JSON 写入该文件而不是返回它。**'
- en: 24.4.2\. Data cleaning with a data frame
  id: totrans-105
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.4.2\. 使用数据框进行数据清洗
- en: 'Converting a particular set of values to `NaN` on load is a very simple bit
    of data cleaning that pandas makes trivial. Going beyond that, data frames support
    several operations that can make data cleaning less of a chore. To see how this
    works, reopen the temperature CSV file, but this time, instead of using the headers
    to name the columns, use the `range()` function with the `names` parameter to
    give them numbers, which will make referring to them easier. You also may recall
    from an earlier example that the first field of every line—the `"Notes"` field—is
    empty and loaded with `NaN` values. Although you could ignore this column, it
    would be even easier if you didn’t have it. You can use the `range()` function
    again, this time starting from 1, to tell pandas to load all columns except the
    first one. But if you know that all of your values are from Illinois and you don’t
    care about the long-form date field, you could start from 4 to make things much
    more manageable:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在加载时将特定的一组值转换为 `NaN` 是 pandas 使数据清洗变得非常简单的一个小技巧。超出这个范围，数据框支持几个操作，可以使数据清洗变得不那么繁琐。为了了解这是如何工作的，重新打开温度
    CSV 文件，但这次，不是使用标题来命名列，而是使用 `range()` 函数和 `names` 参数来给它们编号，这将使引用它们更容易。你也许还记得，从之前的例子中，每一行的第一个字段——“`Notes`”字段是空的，并加载了
    `NaN` 值。虽然你可以忽略这个列，但如果没有它会更简单。你可以再次使用 `range()` 函数，这次从 1 开始，告诉 pandas 加载除了第一个列之外的所有列。但如果你知道所有值都来自伊利诺伊州，并且你不在乎长格式日期字段，你可以从
    4 开始，使事情变得更容易管理：
- en: '[PRE23]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '***1* Setting header=0 turns off reading the header for column labels.**'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 设置 header=0 会关闭读取列标签的标题。**'
- en: 'Now you have a data frame that has only the columns you might want to work
    with. But you still have an issue: the last column, which lists the percentage
    of coverage for the heat index, is still a string ending with a percentage sign
    rather than an actual percentage. This problem is apparent if you look at the
    first row’s value for column 17:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你有一个只包含你可能想要处理的列的数据框。但你仍然有一个问题：最后一个列，它列出了热指数的覆盖率百分比，仍然是一个以百分号结尾的字符串，而不是实际的百分比。如果你查看第一行的列
    17 的值，这个问题就会很明显：
- en: '[PRE24]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'To fix this problem, you need to do two things: Remove the `%` from the end
    of the value and then cast the value from string to a number. Optionally, if you
    want to represent the resulting percentage as a fraction, you need to divide it
    by 100\. The first bit is simple because pandas lets you use a single command
    to repeat an operation on a column:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 要解决这个问题，你需要做两件事：从值末尾移除 `%`，然后将值从字符串转换为数字。如果想要将得到的百分比表示为分数，你需要将其除以 100。第一部分很简单，因为
    pandas 允许你用一个命令在列上重复操作：
- en: '[PRE25]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: This code takes the column and calls a string `strip()` operation on it to remove
    the trailing `%`. Now when you look at the first value in the column (or any of
    the other values), you see that the offending percentage sign is gone. It’s also
    worth noting that you could have used other operations, such as `replace("%",
    "")`, to achieve the same result.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码对列进行操作，并在其上调用一个字符串 `strip()` 操作来移除尾部的 `%`。现在当你查看该列的第一个值（或任何其他值）时，你会看到那个令人讨厌的百分号已经消失了。还值得注意的是，你可以使用其他操作，例如
    `replace("%", "")`，来达到相同的结果。
- en: 'The second operation is to convert the string to a numeric value. Again, pandas
    lets you perform this operation with one command:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个操作是将字符串转换为数值。同样，pandas 允许你用一个命令来完成这个操作：
- en: '[PRE26]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Now the values in column 17 are numeric, and if you want to, you can use the
    `div()` method to finish the job of turning those values into fractions:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 现在列 17 中的值是数值型的，如果你想的话，可以使用 `div()` 方法来完成将那些值转换为分数的工作：
- en: '[PRE27]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'In fact, it would be possible to achieve the same result in a single line by
    chaining the three operations together:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，通过将三个操作串联在一起，可以在一行中实现相同的结果：
- en: '[PRE28]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: This example is very simple, but it gives you an idea of the convenience that
    pandas can bring to cleaning your data. pandas has a wide variety of operations
    for transforming data, as well as the ability to use custom functions, so it would
    be hard to think of a scenario in which you couldn’t streamline data cleaning
    with pandas.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 这个例子很简单，但它给你一个关于pandas如何方便地清理数据的想法。pandas具有广泛的数据转换操作，以及使用自定义函数的能力，因此很难想象一个无法通过pandas简化数据清理的场景。
- en: Although the number of options is almost overwhelming, a wide variety of tutorials
    and videos is available, and the documentation at [http://pandas.pydata.org](http://pandas.pydata.org)
    is excellent.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管选项数量几乎令人难以承受，但仍然有各种各样的教程和视频可供选择，[http://pandas.pydata.org](http://pandas.pydata.org)上的文档也非常出色。
- en: '|  |'
  id: totrans-122
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'Try this: Cleaning Data with and without pandas'
  id: totrans-123
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 尝试这个：使用和不用pandas清理数据
- en: Experiment with the operations. When the final column has been converted to
    a fraction, can you think of a way to convert it back to a string with the trailing
    percentage sign?
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试这些操作。当最终列已转换为分数时，你能想到一种方法将其转换回带有百分号后缀的字符串吗？
- en: '|  |'
  id: totrans-125
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: By contrast, load the same data into a plain Python list by using the `csv`
    module, and apply the same changes by using plain Python.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，通过使用`csv`模块将相同的数据加载到普通的Python列表中，并使用纯Python应用相同的更改。
- en: 24.5\. Data aggregation and manipulation
  id: totrans-127
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.5. 数据聚合和处理
- en: The preceding examples probably gave you some idea of the many options pandas
    gives you for performing fairly complex operations on your data with only a few
    commands. As you might expect, this level of functionality is also available for
    aggregating data. In this section, I walk through a few simple examples of aggregating
    data to illustrate some of the many possibilities. Although many options are available,
    I focus on merging data frames, performing simple data aggregation, and grouping
    and filtering.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的例子可能让你对pandas提供的许多选项有了些了解，这些选项只需几个命令就可以在数据上执行相当复杂的操作。正如你所期望的，这种功能级别也适用于数据聚合。在本节中，我将通过几个简单的数据聚合示例来展示许多可能性。尽管有许多选项可用，但我专注于合并数据框、执行简单的数据聚合以及分组和过滤。
- en: 24.5.1\. Merging data frames
  id: totrans-129
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.5.1. 合并数据框
- en: 'Quite often in the course of handling data, you need to relate two data sets.
    Suppose that you have one file containing the number of sales calls made per month
    by members of a sales team, and in another file, you have the dollar amounts of
    the sales in each of their territories:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理数据的过程中，你经常需要关联两个数据集。假设你有一个文件包含销售团队成员每月进行的销售电话次数，在另一个文件中，你有他们各自地区销售的美元金额：
- en: '[PRE29]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Clearly, it would be very useful to link revenue and team-member activity.
    These two files are very simple, yet merging them with plain Python isn’t entirely
    trivial. pandas has a function to merge two data frames:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，将收入和团队成员活动联系起来将非常有用。这两个文件非常简单，但用纯Python合并它们并不完全简单。pandas有一个用于合并两个数据框的函数：
- en: '[PRE30]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'The `merge` function creates a new data frame by joining the two frames on
    the columns specified in the column field. The `merge` function works similarly
    to a relational-database join, giving you a table that combines the columns from
    the two files:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '`merge`函数通过在列字段中指定的列将两个数据框连接起来创建一个新的数据框。`merge`函数的工作方式类似于关系型数据库的连接，为你提供一个结合了两个文件列的表：'
- en: '[PRE31]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: In this case, you have a one-to-one correspondence between the rows in the two
    fields, but the `merge` function can also do one-to-many and many-to-many joins,
    as well as right and left joins.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，两个字段中的行之间存在一对一的对应关系，但`merge`函数也可以执行一对一和多对多连接，以及右连接和左连接。
- en: '|  |'
  id: totrans-137
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'Quick Check: Merging data sets'
  id: totrans-138
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 快速检查：合并数据集
- en: How would you go about merging to data sets like the ones in the Python example?
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 你会如何处理像Python示例中的数据集合并？
- en: '|  |'
  id: totrans-140
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 24.5.2\. Selecting data
  id: totrans-141
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.5.2. 选择数据
- en: 'It can also be useful to select or filter the rows in a data frame based on
    some condition. In the example sales data, you may want to look only at territory
    3, which is also easy:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 根据某些条件选择或过滤数据框中的行也可能很有用。在示例销售数据中，你可能只想查看地区3，这也很简单：
- en: '[PRE32]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: In this example, you select only rows in which the territory is equal to 3 but
    using exactly that expression, `revenue.Territory==3`, as the index for the data
    frame. From the point of view of plain Python, such use is nonsense and illegal,
    but for a pandas data frame, it works and makes for a much more concise expression.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，您只选择地区等于3的行，但使用恰好那个表达式，`revenue.Territory==3`，作为数据框的索引。从纯Python的角度来看，这种用法是没有意义且非法的，但对于pandas数据框来说，它是有效的，并且使得表达式更加简洁。
- en: 'More complex expressions are also allowed, of course. If you want to select
    only rows in which the amount per call is greater than 500, you could use this
    expression instead:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，也允许更复杂的表达式。如果您想选择通话金额大于500的行，您可以使用这个表达式代替：
- en: '[PRE33]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Even better, you could calculate and add that column to your data frame by
    using a similar operation:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 更好的是，您可以使用类似的操作计算并添加该列到您的数据框中：
- en: '[PRE34]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Again, note that pandas’s built-in logic replaces a more cumbersome structure
    in plain Python.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 再次注意，pandas的内置逻辑替换了纯Python中更繁琐的结构。
- en: '|  |'
  id: totrans-150
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 'Quick Check: Selecting in Python'
  id: totrans-151
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 快速检查：在Python中选择
- en: What Python code structure would you use to select only rows meeting certain
    conditions?
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 您会使用什么Python代码结构来选择仅满足某些条件的行？
- en: '|  |'
  id: totrans-153
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 24.5.3\. Grouping and aggregation
  id: totrans-154
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.5.3. 分组和聚合
- en: 'As you might expect, pandas has plenty of tools to summarize and aggregate
    data as well. In particular, getting the sum, mean, median, minimum, and maximum
    values from a column uses clearly named column methods:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所预期，pandas有很多工具可以总结和聚合数据。特别是，从列中获取总和、平均值、中位数、最小值和最大值使用明确命名的列方法：
- en: '[PRE35]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'If, for example, you want to get all of the rows in which the amount per call
    is above the median, you can combine this trick with the selection operation:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果您想获取所有通话金额超过中值的行，您可以结合这个技巧与选择操作：
- en: '[PRE36]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'In addition to being able to pick out summary values, it’s often useful to
    group the data based on other columns. In this simple example, you can use the
    `groupby` method to group your data. You may want to know the total calls and
    amounts by month or by territory, for example. In those cases, use those fields
    with the data frame’s `groupby` method:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 除了能够挑选出汇总值之外，根据其他列分组数据通常也很有用。在这个简单的例子中，您可以使用`groupby`方法来分组您的数据。例如，您可能想知道按月份或地区汇总的总通话次数和金额。在这些情况下，使用这些字段与数据框的`groupby`方法：
- en: '[PRE37]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: In each case, you select the columns that you want to aggregate, group them
    by the values in one of those columns, and (in this case) sum the values for each
    group. You could also use any of the other methods mentioned earlier in this chapter.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在每种情况下，您选择要聚合的列，按这些列中的一个列的值分组，然后（在这种情况下）对每个组求和。您也可以使用本章前面提到的其他任何方法。
- en: Again, all these examples are simple, but they illustrate a few of the options
    you have for manipulating and selecting data with pandas. If these ideas resonate
    with your needs, you can learn more by studying the pandas documentation at [http://pandas.pydata.org](http://pandas.pydata.org).
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，所有这些例子都很简单，但它们说明了您使用pandas操作和选择数据的一些选项。如果这些想法与您的需求相呼应，您可以通过研究pandas文档在[http://pandas.pydata.org](http://pandas.pydata.org)上了解更多信息。
- en: '|  |'
  id: totrans-163
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 'Try this: Grouping and Aggregating'
  id: totrans-164
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 尝试这个：分组和聚合
- en: Experiment with pandas and the data in previous examples. Can you get the calls
    and amounts by both team member and month?
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在pandas和前例中的数据上实验。您能否按团队成员和月份获取通话和金额？
- en: '|  |'
  id: totrans-166
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 24.6\. Plotting data
  id: totrans-167
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.6. 绘制数据
- en: 'Another very attractive feature of pandas is the ability to plot the data in
    a data frame very easily. Although you have many options for plotting data in
    Python and Jupyter notebook, pandas can use matplotlib directly from a data frame.
    You may recall that when you started your Jupyter session, one of the first commands
    you gave was the Jupyter “magic” command to enable matplotlib for inline plotting:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: pandas的另一个非常吸引人的特性是能够非常容易地在数据框中绘制数据。尽管您在Python和Jupyter笔记本中有很多绘制数据的选择，但pandas可以直接从数据框中使用matplotlib。您可能还记得，当您开始Jupyter会话时，您给出的第一个命令之一是启用matplotlib进行内联绘图的Jupyter“魔法”命令：
- en: '[PRE38]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Because you have the ability to plot, see how you might plot some data ([figure
    24.3](#ch24fig03)). To continue with the sales example, if you want to plot the
    quarter’s mean sales by territory, you can get a graph right in your notebook
    just by adding `.plot.bar()`:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 因为您有绘图的能力，看看您如何绘制一些数据（[图24.3](#ch24fig03)）。继续使用销售示例，如果您想按地区绘制季度的平均销售额，您只需在笔记本中添加
    `.plot.bar()` 就可以立即得到一个图表：
- en: '[PRE39]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Figure 24.3\. Bar plot of a pandas data frame in Jupyter notebook
  id: totrans-172
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图24.3\. Jupyter笔记本中的pandas数据框条形图
- en: '![](images/24fig03_alt.jpg)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
  zh: '![图片](images/24fig03_alt.jpg)'
- en: Other options are available. `plot()` alone or `.plot.line()` creates a line
    graph, `.plot.pie()` creates a pie chart, and so on.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 其他选项也是可用的。`plot()`单独使用或`.plot.line()`创建折线图，`.plot.pie()`创建饼图，等等。
- en: Thanks to the combination of pandas and matplotlib, plotting data in a Jupyter
    notebook is quite easy. I should also note that although such plotting is easy,
    there are many things that it doesn’t do extremely well.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 多亏了pandas和matplotlib的结合，在Jupyter笔记本中绘制数据变得相当容易。我也应该指出，尽管这种绘图很容易，但它并不擅长做很多事情。
- en: '|  |'
  id: totrans-176
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'Try this: Plotting'
  id: totrans-177
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 尝试这个：绘图
- en: Plot a line graph of the monthly average amount per call.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 绘制每月平均通话金额的折线图。
- en: '|  |'
  id: totrans-179
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 24.7\. Why you might not want to use pandas
  id: totrans-180
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.7\. 为什么你可能不想使用pandas
- en: The preceding examples illustrate only a tiny fraction of the tools pandas can
    offer you in cleaning, exploring, and manipulating data. As I mentioned at the
    beginning of this chapter, pandas is an excellent tool set that excels in what
    it was designed to do. That doesn’t mean, however, that pandas is the tool for
    all situations or for all people.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 上述示例仅展示了pandas在数据清洗、探索和操作方面可以为你提供的工具的一小部分。正如我在本章开头提到的，pandas是一个出色的工具集，擅长它被设计去做的任务。但这并不意味着pandas是所有情况或所有人的工具。
- en: There are reasons why you might elect to use plain old Python (or some other
    tool) instead. For one thing, as I mention earlier, learning to fully use pandas
    is in some ways like learning another language, which may not be something you
    have the time or inclination for. Also, pandas may not be ideal in all production
    situations, particularly with very large data sets that don’t require much in
    the way of math operations or with data that isn’t easy to put into the formats
    that work best with pandas. Munging large collections of product information,
    for example, probably wouldn’t benefit so much from pandas; neither would basic
    processing of a stream of transactions.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会选择使用传统的Python（或其他工具）而不是它。一方面，正如我之前提到的，学会完全使用pandas在某种程度上就像学习另一种语言，这可能不是你愿意或有时间去做的事情。此外，pandas在所有生产环境中可能并不理想，尤其是在处理不需要太多数学运算的大数据集或难以用pandas最佳格式处理的数据时。例如，对大量产品信息的整理可能不会从pandas中获得太多好处；对交易流的简单处理也不会。
- en: The point is that you should choose your tools thoughtfully based on the problems
    at hand. In many cases, pandas will truly make your life easier as you work with
    data, but in other cases, plain old Python may be your best bet.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 重点是，你应该根据手头的问题仔细选择你的工具。在许多情况下，pandas确实会使你在处理数据时生活变得更轻松，但在其他情况下，传统的Python可能才是你的最佳选择。
- en: Summary
  id: totrans-184
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 摘要
- en: Python offers many benefits for data handling, including the ability to handle
    very large data sets and the flexibility to handle data in ways that match your
    needs.
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python在数据处理方面提供了许多好处，包括处理非常大的数据集的能力以及以符合你需求的方式处理数据的能力。
- en: Jupyter notebook is a useful way to access Python via a web browser, which also
    makes improved presentation easier.
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Jupyter笔记本是一种通过网页浏览器访问Python的有用方式，这也使得改进演示变得更容易。
- en: pandas is a tool that makes many common data-handling operations much easier,
    including cleaning, combining, and summarizing data.
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: pandas是一个使许多常见数据处理操作变得容易的工具，包括数据清洗、合并和汇总。
- en: pandas also makes simple plotting much easier.
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: pandas还使简单的绘图变得容易。
