- en: 9 Adding external variables to our model
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 9 向我们的模型添加外部变量
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Examining the SARIMAX model
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 检查SARIMAX模型
- en: Exploring the use of external variables for forecasting
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索外部变量在预测中的应用
- en: Forecasting using the SARIMAX model
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用SARIMAX模型进行预测
- en: In chapters 4 through 8, we have increasingly built a general model that allows
    us to consider more complex patterns in time series. We started our journey with
    the autoregressive and moving average processes before combining them into the
    ARMA model. Then we added a layer of complexity to model non-stationary time series,
    leading us to the ARIMA model. Finally, in chapter 8 we added yet another layer
    to ARIMA that allows us to consider seasonal patterns in our forecasts, which
    resulted in the SARIMA model.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在第4章到第8章中，我们逐渐构建了一个通用模型，使我们能够考虑时间序列中的更复杂模式。我们的旅程从自回归和移动平均过程开始，然后将其结合成ARMA模型。然后我们为模型添加了一层复杂性，以模拟非平稳时间序列，这使我们到达了ARIMA模型。最后，在第8章中，我们在ARIMA模型的基础上又增加了一层，使我们能够考虑预测中的季节性模式，从而产生了SARIMA模型。
- en: So far, each model that we have explored and used to produce forecasts has considered
    only the time series itself. In other words, past values of the time series were
    used as predictors of future values. However, it is possible that external variables
    also have an impact on our time series and can therefore be good predictors of
    future values.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们探索并用于生成预测的每个模型都只考虑了时间序列本身。换句话说，时间序列的过去值被用作未来值的预测因子。然而，外部变量也可能对我们的时间序列产生影响，因此可以作为未来值的良好预测因子。
- en: This brings us to the *SARIMAX* model. You’ll notice the addition of the *X*
    term, which denotes exogenous variables. In statistics the term *exogenous* is
    used to describe predictors or input variables, while *endogenous* is used to
    define the target variable—what we are trying to predict. With the SARIMAX model,
    we can now consider external variables, or exogenous variables, when forecasting
    a time series.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 这将我们引向SARIMAX模型。你会注意到增加了X项，它表示外生变量。在统计学中，术语“外生”用于描述预测因子或输入变量，而“内生”用于定义目标变量——我们试图预测的内容。使用SARIMAX模型，我们现在可以在预测时间序列时考虑外部变量，或外生变量。
- en: As a guiding example, we’ll use a macroeconomics dataset from the United States,
    collected quarterly from 1959 to 2009, to forecast the real gross domestic product
    (GDP), as shown in figure 9.1.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 作为指导性示例，我们将使用从1959年到2009年每季度收集的美国宏观经济数据集，来预测实际国内生产总值（GDP），如图9.1所示。
- en: '![](../../OEBPS/Images/09-01.png)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/09-01.png)'
- en: Figure 9.1 Real gross domestic product (GDP) of the United States from 1959
    to 2009\. The data was collected quarterly and is expressed in thousands of US
    dollars. Notice the clear positive trend over the years with no cyclical pattern,
    suggesting that seasonality is not present in the series.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.1 1959年至2009年美国实际国内生产总值（GDP）。数据按季度收集，并以千美元为单位表示。注意，多年来呈现明显的上升趋势，没有周期性模式，这表明该系列中不存在季节性。
- en: The GDP is the total market value of all the finished goods and services produced
    within a country. The *real* GDP is an inflation-adjusted measure that removes
    the impact of inflation on the market value of goods. Inflation or deflation can
    respectively increase or decrease the monetary value of goods and services, hence
    increasing or decreasing the GDP. By removing the effect of inflation, we can
    better determine whether an economy saw an expansion of production.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 国内生产总值（GDP）是一个国家内生产的所有最终商品和服务的总市场价值。实际GDP是一个经过通货膨胀调整的衡量标准，它消除了通货膨胀对商品市场价值的影响。通货膨胀或通货紧缩可以分别增加或减少商品和服务的货币价值，从而增加或减少GDP。通过消除通货膨胀的影响，我们可以更好地确定一个经济体是否经历了生产的扩张。
- en: Without diving into the technicalities of measuring the GDP, we’ll define the
    GDP as the sum of consumption *C*, government spending *G*, investments *I*, and
    net exports *NX*, as shown in equation 9.1.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 不深入探讨衡量GDP的技术细节，我们将GDP定义为消费C、政府支出G、投资I和净出口NX的总和，如方程9.1所示。
- en: GDP = *C* + *G* + *I* + *NX*
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: GDP = C + G + I + NX
- en: Equation 9.1
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 方程9.1
- en: Each element of equation 9.1 is likely affected by some external variable. For
    example, consumption is likely impacted by the unemployment rate, because if fewer
    people are employed, consumption is likely to decrease. Interest rates can also
    have an impact, because if they go up, it is harder to borrow money, and spending
    decreases as a result. We can also think of currency exchange rates as having
    an impact on net exports. A weaker local currency will generally stimulate exports
    and make imports more expensive. Thus, we can see how many exogenous variables
    can likely impact the real GDP of the United States.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 方程9.1中的每个元素都可能受到某些外部变量的影响。例如，消费可能受到失业率的影响，因为如果就业人数减少，消费很可能会下降。利率也可能产生影响，因为如果它们上升，借款会变得更加困难，从而导致支出减少。我们还可以考虑货币汇率对净出口的影响。一般来说，本币贬值会刺激出口，并使进口变得更加昂贵。因此，我们可以看到许多外生变量可能影响美国的实际GDP。
- en: In this chapter, we’ll first examine the SARIMAX model and explore an important
    caveat when using it to produce forecasts. Then we’ll apply the model to forecast
    the real GDP of the United States.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将首先检查SARIMAX模型，并探讨在使用它进行预测时需要注意的一个重要注意事项。然后，我们将应用该模型来预测美国的实际GDP。
- en: 9.1 Examining the SARIMAX model
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.1 检查SARIMAX模型
- en: The SARIMAX model further extends the SARIMA(*p*,*d*,*q*) (*P*,*D*,*Q*)*[m]*
    model by adding the effect of exogenous variables. Therefore, we can express the
    present value *y[t]* simply as a SARIMA(*p*,*d*,*q*) (*P*,*D*,*Q*)*[m]* model
    to which we add any number of exogenous variables *X[t]* as shown in equation
    9.2.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: SARIMAX模型通过添加外生变量的影响进一步扩展了SARIMA(*p*,*d*,*q*) (*P*,*D*,*Q*)*[m]*模型。因此，我们可以简单地用SARIMA(*p*,*d*,*q*)
    (*P*,*D*,*Q*)*[m]*模型来表示当前值*y[t]*，并向其中添加任何数量的外生变量*X[t]*，如方程9.2所示。
- en: '![](../../OEBPS/Images/09-01-Equation-9-2.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![方程式图片](../../OEBPS/Images/09-01-Equation-9-2.png)'
- en: Equation 9.2
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 方程9.2
- en: The SARIMA model is a linear model, as it is a linear combination of past values
    of the series and error terms. Here we add another linear combination of different
    exogenous variables, resulting in SARIMAX being a linear model as well. Note that
    in SARIMAX you can include categorical variables as exogenous variables, but make
    sure you encode them (give them numerical values or binary flags) just like you
    would do for traditional regression tasks.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: SARIMA模型是一个线性模型，因为它是由时间序列的过去值和误差项的线性组合。在这里，我们添加了另一个不同外生变量的线性组合，因此SARIMAX也是一个线性模型。请注意，在SARIMAX中，您可以包括分类变量作为外生变量，但请确保您像处理传统回归任务一样对它们进行编码（赋予它们数值或二进制标志）。
- en: We have been using the `SARIMAX` function from `statsmodels` since chapter 4
    to implement different models. This is because SARIMAX is the most general function
    for forecasting a time series. You now understand how a SARIMAX model without
    exogenous variables is a SARIMA model. Similarly, a model with no seasonality
    but with exogenous variables can be denoted as an ARIMAX model, and a model with
    no seasonality and no exogenous variables becomes an ARIMA model. Depending on
    the problem, different combinations of each portion of the general SARIMAX model
    will be used.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 自第4章以来，我们一直在使用`statsmodels`中的`SARIMAX`函数来实现不同的模型。这是因为SARIMAX是用于预测时间序列最通用的函数。现在您已经了解了没有外生变量的SARIMAX模型是一个SARIMA模型。同样，没有季节性但有外生变量的模型可以表示为ARIMAX模型，而没有季节性和外生变量的模型则变为ARIMA模型。根据问题，将使用通用SARIMAX模型各部分的组合。
- en: SARIMAX model
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: SARIMAX模型
- en: The SARIMAX model simply adds a linear combination of exogenous variables to
    the SARIMA model. This allows us to model the impact of external variables on
    the future value of a time series.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: SARIMAX模型简单地将外生变量的线性组合添加到SARIMA模型中。这使得我们能够模拟外部变量对时间序列未来值的影响。
- en: 'We can loosely define the SARIMAX model as follows:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以大致定义SARIMAX模型如下：
- en: '![](../../OEBPS/Images/09-Equation-unnumb.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![方程式图片](../../OEBPS/Images/09-Equation-unnumb.png)'
- en: The SARIMAX model is the most general model for forecasting time series. You
    can see that if you have no seasonal patterns, it becomes an ARIMAX model. With
    no exogenous variables, it is a SARIMA model. With no seasonality or exogenous
    variables, it becomes an ARIMA model.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: SARIMAX模型是预测时间序列最通用的模型。您可以看到，如果没有季节性模式，它就变成了ARIMAX模型。如果没有外生变量，它就是一个SARIMA模型。如果没有季节性或外生变量，它就变成了ARIMA模型。
- en: Theoretically, this sums up the SARIMAX model. Chapters 4 through 8 were purposely
    ordered in such a way that we incrementally developed the SARIMAX model, making
    the addition of exogenous variables easy to understand. To reinforce your learning,
    let’s explore the exogenous variables of our dataset.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 理论上，这总结了SARIMAX模型。第4章到第8章的顺序是故意这样安排的，以便我们逐步开发SARIMAX模型，使得添加外生变量易于理解。为了加强您的学习，让我们探索我们数据集的外生变量。
- en: 9.1.1 Exploring the exogenous variables of the US macroeconomics dataset
  id: totrans-29
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 9.1.1 探索美国宏观经济数据集的外生变量
- en: Let’s load the US macroeconomics dataset and explore the different exogenous
    variables available to us to forecast the real GDP. This dataset is available
    with the `statsmodels` library, meaning that you do not need to download and read
    an external file. You can load the dataset using the `datasets` module of `statsmodels`.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们加载美国宏观经济数据集，并探索可用于预测实际GDP的不同外生变量。此数据集由 `statsmodels` 库提供，这意味着您不需要下载和读取外部文件。您可以使用
    `statsmodels` 的 `datasets` 模块加载数据集。
- en: 'Note The full source code for this chapter is available on GitHub: [https://github.com/marcopeix/TimeSeriesForecastingInPython/tree/master/CH09](https://github.com/marcopeix/TimeSeriesForecastingInPython/tree/master/CH09).'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：本章的完整源代码可在GitHub上找到：[https://github.com/marcopeix/TimeSeriesForecastingInPython/tree/master/CH09](https://github.com/marcopeix/TimeSeriesForecastingInPython/tree/master/CH09)。
- en: '[PRE0]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: ❶ Load the US macroeconomics dataset.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 加载美国宏观经济数据集。
- en: ❷ Display the DataFrame.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 显示DataFrame。
- en: This displays the entire `DataFrame` containing the US macroeconomics dataset.
    Table 9.1 describes the meaning of each variable. We have our target variable,
    or endogenous variable, which is the real GDP. Then we have 11 exogenous variables
    that can be used for forecasting, such as personal and federal consumption expenditures,
    interest rate, inflation rate, population, and others.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 这显示了包含美国宏观经济数据集的整个 `DataFrame`。表9.1描述了每个变量的含义。我们有一个目标变量，或内生变量，即实际GDP。然后我们有11个外生变量可以用于预测，例如个人和联邦消费支出、利率、通货膨胀率、人口等。
- en: Table 9.1 Description of all variables in the US macroeconomics dataset
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 表9.1 美国宏观经济数据集中所有变量的描述
- en: '| Variable | Description |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| 变量 | 描述 |'
- en: '| `realgdp` | Real gross domestic product (the target variable or endogenous
    variable) |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| `realgdp` | 实际国内生产总值（目标变量或内生变量） |'
- en: '| `realcons` | Real personal consumption expenditure |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| `realcons` | 实际个人消费支出 |'
- en: '| `realinv` | Real gross private domestic investment |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| `realinv` | 实际国内私人总投资 |'
- en: '| `realgovt` | Real federal consumption expenditure and investment |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| `realgovt` | 实际联邦消费支出和投资 |'
- en: '| `realdpi` | Real private disposable income |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| `realdpi` | 实际私人可支配收入 |'
- en: '| `cpi` | Consumer price index for the end of the quarter |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| `cpi` | 季末消费者价格指数 |'
- en: '| `m1` | M1 nominal money stock |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| `m1` | M1名义货币存量 |'
- en: '| `tbilrate` | Quarterly monthly average of the monthly 3-month treasury bill
    |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| `tbilrate` | 月度3个月期国库券的季度月平均数 |'
- en: '| `unemp` | Unemployment rate |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| `unemp` | 失业率 |'
- en: '| `pop` | Total population at the end of the quarter |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '| `pop` | 季末总人口 |'
- en: '| `infl` | Inflation rate |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| `infl` | 通货膨胀率 |'
- en: '| `realint` | Real interest rate |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '| `realint` | 实际利率 |'
- en: Of course, each of these variables may or may not be a good predictor of the
    real GDP. We do not have to perform feature selection because the linear model
    will attribute a coefficient close to 0 for exogenous variables that are not significant
    in predicting the target.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，这些变量中的每一个可能或可能不是实际GDP的良好预测指标。我们不必执行特征选择，因为线性模型将为在预测目标中不显著的变量分配接近0的系数。
- en: 'For the sake of simplicity and clarity, we will only work with six variables
    in this chapter: the real GDP, which is our target, and the next five variables
    listed in table 9.1 (`realcons` to `cpi`) as our exogenous variables.'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 为了简单和清晰，我们将在本章中只处理六个变量：我们的目标变量实际GDP，以及表9.1中列出的下一个五个变量（从 `realcons` 到 `cpi`）作为我们的外生变量。
- en: We can visualize how each variable behaves through time to see if we can discern
    any distinctive patterns. The result is shown in figure 9.2.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过查看每个变量随时间的变化情况，看看我们是否可以识别出任何独特的模式。结果如图9.2所示。
- en: '[PRE1]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: ❶ Iterate for six variables.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 对六个变量进行迭代。
- en: ❷ Skip the year and quarter columns. That way, we can start at realgdp.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 跳过年和季度列。这样我们就可以从 `realgdp` 开始。
- en: ❸ Display the variable’s name at the top of the plot.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 在图表顶部显示变量的名称。
- en: '![](../../OEBPS/Images/09-02.png)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/09-02.png)'
- en: Figure 9.2 Evolution of the real GDP and five exogenous variables from 1959
    to 2009\. You’ll notice that `realgdp`, `realcons`, `realdpi`, and `cpi` all have
    a similar shape, which means that `realcons`, `realdpi`, and `cpi` are potentially
    good predictors, although a graphical analysis is not sufficient to confirm that
    idea. On the other hand, `realgovt` has peaks and troughs that do not appear in
    `realgdp`, so we can hypothesize that `realgovt` is a weaker predictor.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.2 1959 年至 2009 年真实 GDP 和五个外生变量的演变。你会注意到 `realgdp`、`realcons`、`realdpi` 和
    `cpi` 都有相似的形状，这意味着 `realcons`、`realdpi` 和 `cpi` 可能是好的预测因子，尽管图形分析不足以证实这一点。另一方面，`realgovt`
    有峰和谷，这在 `realgdp` 中没有出现，因此我们可以假设 `realgovt` 是一个较弱的预测因子。
- en: There are two ways to work with exogenous variables for time series forecasting.
    First, we could train multiple models with various combinations of exogenous variables,
    and see which model generates the best forecasts. Alternatively, we can simply
    include all exogenous variables and stick to model selection using the AIC, as
    we know this yields a good-fitting model that does not overfit.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 对于时间序列预测，处理外生变量的方式有两种。首先，我们可以训练多个模型，使用各种外生变量的组合，并查看哪个模型生成的预测最好。或者，我们可以简单地包含所有外生变量，并坚持使用
    AIC 进行模型选择，因为我们知道这样可以得到一个拟合良好且不过拟合的模型。
- en: Why disregard the p-value in regression analysis?
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么在回归分析中不考虑 p 值？
- en: The SARIMAX implementation in `statsmodels` comes with a regression analysis
    using the `summary` method. This is shown later in the chapter.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '`statsmodels` 中的 SARIMAX 实现，附带使用 `summary` 方法的回归分析。这一点将在本章后面展示。'
- en: In that analysis, we can see the p-value associated with each coefficient of
    each predictor of the SARIMAX model. Often the p-value is misused as a way to
    perform feature selection. Many incorrectly interpret the p-value as a way to
    determine if a predictor is correlated with the target.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在那个分析中，我们可以看到 SARIMAX 模型每个预测因子的每个系数的 p 值。通常，p 值被错误地用作特征选择的方法。许多人错误地将 p 值解释为确定预测因子是否与目标相关的手段。
- en: In fact, the p-value tests whether the coefficient is significantly different
    from 0 or not. If the p-value is less than 0.05, then we reject the null hypothesis
    and conclude that the coefficient is significantly different from 0\. It does
    not determine whether a predictor is useful for forecasting.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，p 值测试系数是否显著不同于 0。如果 p 值小于 0.05，则我们拒绝零假设，并得出结论，系数与 0 显著不同。它并不决定预测因子是否对预测有用。
- en: Therefore, you should not remove predictors based on their p-values. Selecting
    the model by minimizing the AIC takes care of that step.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，你不应该根据 p 值移除预测因子。通过最小化 AIC 选择模型可以处理这一步骤。
- en: 'To learn more, I recommend reading Rob Hyndman’s “Statistical tests for variable
    selection” blog post: [https://robjhyndman.com/hyndsight/tests2/](https://robjhyndman.com/hyndsight/tests2/).'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多信息，我建议阅读 Rob Hyndman 的“用于变量选择的统计测试”博客文章：[https://robjhyndman.com/hyndsight/tests2/](https://robjhyndman.com/hyndsight/tests2/)。
- en: 9.1.2 Caveat for using SARIMAX
  id: totrans-66
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 9.1.2 使用 SARIMAX 的注意事项
- en: There is an important caveat that comes with the use of the SARIMAX model. Including
    external variables can potentially be beneficial, as you may find strong predictors
    for your target. However, you might encounter issues when forecasting multiple
    timesteps into the future.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 SARIMAX 模型时，有一个重要的注意事项。包含外部变量可能是有益的，因为你可能会找到针对目标变量的强预测因子。然而，在预测多个未来的时间步时，你可能会遇到问题。
- en: Recall that the SARIMAX model uses the SARIMA(*p*,*d*,*q*) (*P*,*D*,*Q*)*[m]*
    model and a linear combination of exogenous variables to predict one timestep
    into the future. But what if you wish to predict two timesteps into the future?
    While this is possible with a SARIMA model, the SARIMAX model requires us to forecast
    the exogenous variables too.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 回想一下，SARIMAX 模型使用 SARIMA(*p*,*d*,*q*) (*P*,*D*,*Q*)*[m]* 模型和外生变量的线性组合来预测未来的一个时间步。但如果你希望预测两个时间步的未来呢？虽然使用
    SARIMA 模型是可能的，但 SARIMAX 模型要求我们也要预测外生变量。
- en: To illustrate this idea, let’s assume that `realcons` is a predictor of `realgdp`
    (this will be verified later in the chapter). Assume also that we have a SARIMAX
    model where `realcons` is used as an input feature to predict `realgdp`. Now suppose
    that we are at the end of 2009 and must predict the real GDP for 2010 and 2011\.
    The SARIMAX model allows us to use the `realcons` of 2009 to predict the real
    GDP for 2010\. However, predicting the real GDP for 2011 will require us to predict
    `realcons` for 2010, unless we wait to observe the value at the end of 2010.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明这个想法，让我们假设`realcons`是`realgdp`的预测因子（这一点将在本章后面得到验证）。假设我们有一个SARIMAX模型，其中`realcons`被用作输入特征来预测`realgdp`。现在假设我们处于2009年底，必须预测2010年和2011年的实际GDP。SARIMAX模型允许我们使用2009年的`realcons`来预测2010年的实际GDP。然而，预测2011年的实际GDP将需要我们预测2010年的`realcons`，除非我们等待观察2010年底的值。
- en: Because the `realcons` variable is a time series itself, it can be forecast
    using a version of the SARIMA model. Nevertheless, we know that our forecast always
    has some error associated with it. Therefore, having to forecast an exogenous
    variable to forecast our target variable can magnify the prediction error of our
    target, meaning that our predictions can quickly degrade as we predict more timesteps
    into the future.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 因为`realcons`变量本身就是一个时间序列，它可以使用SARIMA模型的一个版本进行预测。然而，我们知道我们的预测总是与一些误差相关联。因此，为了预测目标变量而必须预测外生变量可能会放大目标预测的误差，这意味着我们的预测随着预测更多时间步长而迅速降低准确性。
- en: The only way to avoid that situation is to predict only one timestep into the
    future and wait to observe the exogenous variable before predicting the target
    for another timestep into the future.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 避免这种情况的唯一方法是在未来预测一个时间步长，并在预测下一个时间步长的目标变量之前等待观察外生变量。
- en: On the other hand, if your exogenous variable is *easy* to predict, meaning
    that it follows a known function that can be accurately predicted, there is no
    harm in forecasting the exogenous variable and using these forecasts to predict
    the target.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，如果你的外生变量*易于预测*，这意味着它遵循一个已知函数，可以准确预测，那么预测外生变量并使用这些预测来预测目标变量是没有害处的。
- en: In the end, there is no clear recommendation to predict only one timestep. It
    is dependent on the situation and the exogenous variables available. This is where
    your expertise as a data scientist and rigorous experimenting come into play.
    If you determine that your exogenous variable can be accurately predicted, you
    can recommend forecasting many timesteps into the future. Otherwise, your recommendation
    must be to predict one timestep at a time and justify your decision by explaining
    that errors will accumulate as more predictions are made, meaning that the forecasts
    will lose accuracy.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，没有明确的建议只预测一个时间步长。这取决于具体情况和可用的外生变量。这就是作为数据科学家，你的专业知识以及严格的实验变得重要的地方。如果你确定你的外生变量可以被准确预测，你可以建议预测很多未来的时间步长。否则，你的建议必须是每次只预测一个时间步长，并通过解释随着更多预测的进行，错误会累积，这意味着预测将失去准确性来证明你的决定。
- en: Now that we have explored the SARIMAX model in depth, let’s apply it to forecast
    the real GDP.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经深入探讨了SARIMAX模型，让我们将其应用于预测实际GDP。
- en: 9.2 Forecasting the real GDP using the SARIMAX model
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.2 使用SARIMAX模型预测实际GDP
- en: We are now ready to use the SARIMAX model to forecast the real GDP. Having explored
    the exogenous variables of the dataset, we will incorporate them into our forecasting
    model.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在准备好使用SARIMAX模型来预测实际GDP。在探讨了数据集的外生变量之后，我们将它们纳入我们的预测模型。
- en: Before diving in, we must reintroduce the general modeling procedure. There
    are no major changes to the procedure. The only modification is that we will now
    fit a SARIMAX model. All the other steps remain the same, as shown in figure 9.3.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在深入探讨之前，我们必须重新介绍一般的建模过程。这个过程没有发生重大变化。唯一的修改是我们现在将拟合一个SARIMAX模型。所有其他步骤保持不变，如图9.3所示。
- en: '![](../../OEBPS/Images/09-03.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/09-03.png)'
- en: Figure 9.3 General modeling procedure for the SARIMAX model. This procedure
    can be applied to any problems, as the SARIMAX model is the most general forecasting
    model and can accommodate all the different processes and properties of time series
    that we have explored. Notice that the only change here is that we are fitting
    a SARIMAX model instead of a SARIMA model as we did in chapter 8\. The rest of
    the procedure remains the same.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.3 SARIMAX模型的一般建模过程。此过程可以应用于任何问题，因为SARIMAX模型是最通用的预测模型，可以容纳我们探索的所有不同时间序列过程和属性。请注意，这里唯一的改变是我们正在适配SARIMAX模型，而不是我们在第8章中使用的SARIMA模型。其余过程保持不变。
- en: Following the modeling procedure of figure 9.3, we’ll first check for the stationarity
    of our target using the augmented Dickey-Fuller (ADF) test.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 按照图9.3中的建模过程，我们首先将使用增强迪基-富勒（ADF）测试检查目标变量的平稳性。
- en: '[PRE2]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: ❶ Define the target variable. In this case, it is the real GDP.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 定义目标变量。在这种情况下，它是实际GDP。
- en: ❷ Define the exogenous variables. Here we limit it to five variables for simplicity.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 定义外生变量。这里我们为了简单起见限制为五个变量。
- en: This returns an ADF statistic of 1.75 and a p-value of 1.00. Since the ADF statistic
    is not a large negative number, and the p-value is larger than 0.05, we cannot
    reject the null hypothesis and conclude that the series is not stationary.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 这将返回一个ADF统计量为1.75和p值为1.00。由于ADF统计量不是一个大的负数，且p值大于0.05，我们不能拒绝零假设，并得出结论，该序列不是平稳的。
- en: 'Therefore, we must apply a transformation and test for stationarity again.
    Here we will difference the series once:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们必须应用一个转换并再次测试序列的平稳性。在这里，我们将对序列进行一次差分：
- en: '[PRE3]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: ❶ Difference the series.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 差分序列。
- en: This now returns an ADF statistic of –6.31 and p-value of 3.32 × 10^(–8). With
    a large negative ADF statistic and a p-value smaller than 0.05, we can reject
    the null hypothesis and conclude that the series is now stationary. Therefore,
    we know that *d* = 1. Since we did not need to take a seasonal difference to make
    the series stationary, *D* = 0.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 现在返回一个ADF统计量为-6.31和p值为3.32 × 10^(–8)。由于ADF统计量是大的负数，且p值小于0.05，我们可以拒绝零假设，并得出结论，该序列现在是平稳的。因此，我们知道*d*
    = 1。由于我们不需要对序列进行季节差分使其平稳，*D* = 0。
- en: We will now define the `optimize_SARIMAX` function, which will fit all unique
    combinations of the model and return a `DataFrame` in ascending order of AIC.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将定义`optimize_SARIMAX`函数，该函数将适配模型的全部唯一组合，并以AIC升序返回一个`DataFrame`。
- en: Listing 9.1 Function to fit all unique SARIMAX models
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 列表9.1 适配所有唯一SARIMAX模型的函数
- en: '[PRE4]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: ❶ Notice the addition of the exogenous variables when fitting the model.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 注意在适配模型时添加外生变量。
- en: Next we’ll define the range of possible values for the orders *p*, *q*, *P*,
    and *Q*. We’ll try values from 0 to 3, but feel free to try a different set of
    values. Also, since the data is collected quarterly, *m* = 4.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将定义可能的值范围*p*、*q*、*P*和*Q*的阶数。我们将尝试从0到3的值，但也可以尝试不同的值集。此外，由于数据是按季度收集的，因此*m*
    = 4。
- en: '[PRE5]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: ❶ Remember that s in the implementation of SARIMAX from statsmodels is equivalent
    to m.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 记住，在statsmodels中SARIMAX实现的s与m等价。
- en: To train the model, we will use the first 200 instances of both the target and
    exogenous variables. We’ll then run the `optimize_SARIMAX` function and select
    the model with the lowest AIC.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 为了训练模型，我们将使用目标和外生变量的前200个实例。然后我们将运行`optimize_SARIMAX`函数，并选择具有最低AIC的模型。
- en: '[PRE6]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Once it’s completed, the function returns the verdict that the SARIMAX(3,1,3)(0,0,0)[4]
    model is the model with the lowest AIC. Notice that the seasonal component of
    the model has only orders of 0\. This makes sense, as there is no visible seasonal
    pattern in the plot of real GDP, as shown in figure 9.4\. Therefore, the seasonal
    component is null, and we have an ARIMAX(3,1,3) model.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦完成，函数将返回结论，SARIMAX(3,1,3)(0,0,0)[4]模型是具有最低AIC的模型。请注意，该模型的季节性成分只有0阶。这是有道理的，因为如图9.4所示，在真实GDP的图中没有明显的季节性模式。因此，季节性成分是空的，我们有一个ARIMAX(3,1,3)模型。
- en: '![](../../OEBPS/Images/09-04.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/09-04.png)'
- en: Figure 9.4 Real gross domestic product (GDP) of the United States between 1959
    and 2009\. The data is collected quarterly and is expressed in thousands of US
    dollars. Notice the clear positive trend over the years with no cyclical pattern,
    suggesting that seasonality is not present in the series.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.4 1959年至2009年美国实际国内生产总值（GDP）。数据按季度收集，并以千美元为单位表示。注意，多年来存在明显的上升趋势，没有周期性模式，这表明序列中不存在季节性。
- en: Now we can fit the selected model and display a summary table to see the coefficients
    associated with our exogenous variables. The result is shown in figure 9.5.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以拟合选定的模型并显示一个汇总表来查看与我们的外生变量相关的系数。结果如图 9.5 所示。
- en: '[PRE7]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: ❶ Display the summary table of the model.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 显示模型的汇总表。
- en: In figure 9.5 you’ll notice that all exogenous variables have a p-value smaller
    than 0.05, except for `realdpi`, which has a p-value of 0.712\. This means that
    the coefficient of `realdpi` is not significantly different from 0\. You’ll also
    notice that its coefficient is 0.0091\. However, the coefficient is kept in the
    model, as the p-value does not determine the relevance of this predictor in forecasting
    our target.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在图 9.5 中，您会注意到所有外生变量的 p 值都小于 0.05，除了 `realdpi`，它的 p 值为 0.712。这意味着 `realdpi`
    的系数与 0 没有显著差异。您还会注意到其系数为 0.0091。然而，系数被保留在模型中，因为 p 值并不决定这个预测因子在预测我们的目标时的相关性。
- en: '![](../../OEBPS/Images/09-05.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/09-05.png)'
- en: Figure 9.5 Summary table of the selected model. You can see that our exogenous
    variables were assigned coefficients. You can also see their p-values under the
    column P>|z|.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.5 选定模型的汇总表。您可以看到我们的外生变量被分配了系数。您还可以在 P>|z| 列下看到它们的 p 值。
- en: Moving on with the modeling procedure, we’ll now study the residuals of the
    model, which are shown in figure 9.6\. Everything points to the residuals being
    completely random, just like white noise. Our model passes the visual check.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 继续进行建模过程，我们现在将研究模型的残差，这些残差在图 9.6 中显示。所有迹象都表明残差是完全随机的，就像白噪声一样。我们的模型通过了视觉检查。
- en: '[PRE8]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](../../OEBPS/Images/09-06.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/09-06.png)'
- en: Figure 9.6 Residual analysis of the selected model. You can see that the residuals
    have no trend and a fairly constant variance over time, just like white noise.
    In the top-right plot, the distribution of residuals is very close to a normal
    distribution. This is further supported by the Q-Q plot at the bottom left, which
    shows a fairly straight line that lies on *y* = *x*. Finally, the correlogram
    shows no significant coefficients after lag 0, just like white noise. Therefore,
    from a graphical analysis, the residuals of this model resemble white noise.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.6 选定模型的残差分析。您可以看到残差没有趋势，并且随着时间的推移具有相当恒定的方差，就像白噪声一样。在右上角的图中，残差的分布非常接近正态分布。这进一步得到了左下角
    Q-Q 图的支持，该图显示了一条位于 *y* = *x* 上的相当直的线。最后，自相关图在滞后 0 之后没有显示显著的系数，就像白噪声一样。因此，从图形分析来看，该模型的残差类似于白噪声。
- en: Now we’ll apply the Ljung-Box test to make sure the residuals are not correlated.
    We therefore want to see p-values that are greater than 0.05, since the null hypothesis
    of the Ljung-Box test is that residuals are independent and uncorrelated.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将应用 Ljung-Box 测试以确保残差不相关。因此，我们希望看到大于 0.05 的 p 值，因为 Ljung-Box 测试的零假设是残差是独立且不相关的。
- en: '[PRE9]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: All the p-values are greater than 0.05. Therefore, we do not reject the null
    hypothesis, and we conclude that the residuals are independent and uncorrelated.
    Having passed both residual checks, our model can be used for forecasting.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 所有 p 值都大于 0.05。因此，我们不拒绝零假设，并得出结论，残差是独立且不相关的。在通过两个残差检查后，我们的模型可用于预测。
- en: As mentioned before, the caveat of using a SARIMAX model is that it is reasonable
    to predict only the next timestep, to avoid predicting the exogenous variables
    as well, which would lead us to accumulate prediction errors in the final forecast.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，使用 SARIMAX 模型的缺点是，合理地预测只有下一个时间步是合理的，以避免预测外生变量，这会导致我们在最终预测中累积预测误差。
- en: Instead, to test our model, we predict the next timestep multiple times and
    average the errors of each prediction. This is done using the `rolling_forecast`
    function, which we defined and worked with in chapters 4–6\. As a baseline model,
    we will use the last known value method.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，为了测试我们的模型，我们将多次预测下一个时间步并平均每次预测的错误。这是通过 `rolling_forecast` 函数完成的，我们在第 4-6
    章中定义并使用了该函数。作为一个基线模型，我们将使用最后已知值方法。
- en: Listing 9.2 Function to forecast the next timestep multiple times
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 9.2 预测下一个时间步多次的函数
- en: '[PRE10]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The `recursive_forecast` function allows us to predict the next timestep over
    a certain period of time. Specifically, we will use it to forecast the next timestep
    starting in 2008 and going to the third quarter of 2009.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '`recursive_forecast` 函数允许我们在一定时间内预测下一个时间步。具体来说，我们将使用它来预测从 2008 年开始到 2009 年第三季度的下一个时间步。'
- en: '[PRE11]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: ❶ We fit the model on the data from 1959 to the end of 2007.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 我们将模型拟合到1959年至2007年底的数据。
- en: ❷ The test set contains the values starting in 2008 to the third quarter of
    2009\. There is a total of seven values to predict.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 测试集包含从2008年开始到2009年第三季度的值。总共有七个值需要预测。
- en: ❸ This specifies that we predict the next timestep only.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 这指定了我们只预测下一个时间步长。
- en: With the predictions done, we can visualize which model has the lowest mean
    absolute percentage error (MAPE). The result is shown in figure 9.7.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 预测完成后，我们可以可视化哪个模型具有最低的平均绝对百分比误差（MAPE）。结果如图9.7所示。
- en: '[PRE12]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: In figure 9.7 you’ll see that the SARIMAX model is the winning model by only
    0.04%. You’ll appreciate the importance of a baseline here, as both methods achieve
    an extremely low MAPE, showing that the SARIMAX model is only slightly better
    than simply predicting the last value. This is where the business context comes
    into play. In our case, since we are predicting the real GDP of the United States,
    a difference of 0.04% represents thousands of dollars. This difference might be
    relevant in this particular context, justifying the use of the SARIMAX model,
    even though it is only slightly better than the baseline.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在图9.7中，你会发现SARIMAX模型仅以0.04%的优势成为获胜模型。你会欣赏到基线在这里的重要性，因为两种方法都实现了极低的MAPE，表明SARIMAX模型仅略优于简单地预测最后一个值。这就是业务背景发挥作用的地方。在我们的案例中，由于我们正在预测美国的实际GDP，0.04%的差异代表着数千美元。这种差异可能在这个特定背景下是相关的，这证明了即使SARIMAX模型仅略优于基线，使用SARIMAX模型也是合理的。
- en: '![](../../OEBPS/Images/09-07.png)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/09-07.png)'
- en: Figure 9.7 The mean absolute percentage error (MAPE) of the forecasts of each
    method. You can see that the SARIMAX model only has a slightly smaller MAPE than
    the baseline. This highlights the importance of using a baseline, as a MAPE of
    0.70% is extremely good, but a naive forecast achieves a MAPE of 0.74%, meaning
    that the SARIMAX model only has a small advantage.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.7 每种方法的预测的平均绝对百分比误差（MAPE）。你可以看到，SARIMAX模型仅比基线模型略小。这突出了使用基线的重要性，因为0.70%的MAPE已经非常好了，但简单的预测实现了0.74%的MAPE，这意味着SARIMAX模型仅具有微小的优势。
- en: 9.3 Next steps
  id: totrans-128
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.3 下一步
- en: In this chapter, we covered the SARIMAX model, which allows us to include external
    variables when forecasting our target time series.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们介绍了SARIMAX模型，该模型允许我们在预测目标时间序列时包含外部变量。
- en: 'The addition of exogenous variables comes with a caveat: if we need to predict
    many timesteps into the future, we must also predict the exogenous variables,
    which can magnify the prediction error on the target. To avoid that, we must only
    predict the next timestep.'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 添加外生变量有一些注意事项：如果我们需要预测很多时间步长到未来，我们必须也预测外生变量，这可能会放大目标上的预测误差。为了避免这种情况，我们只能预测下一个时间步长。
- en: In considering exogenous variables for predicting real GDP, we can also hypothesize
    that real GDP can be a predictor for other variables. For example, the variable
    `cpi` was a predictor for `realgdp`, but we could also show that `realgdp` can
    predict `cpi`.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 在考虑预测实际GDP的外生变量时，我们也可以假设实际GDP可以是其他变量的预测因子。例如，变量`cpi`是`realgdp`的预测因子，但我们也可能表明`realgdp`可以预测`cpi`。
- en: In a situation where we wish to show that two variables varying in time can
    impact one another, we must use the *vector autoregression* (VAR) model. This
    model allows for multivariate time series forecasting, unlike the SARIMAX model,
    which is for univariate time series forecasting. In the next chapter we will explore
    the VAR model in detail, and you’ll see that it can also be extended to become
    a *VARMA* model and a *VARMAX* model.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们希望展示两个随时间变化的变量可以相互影响的情况下，我们必须使用*向量自回归*（VAR）模型。这个模型允许进行多元时间序列预测，与用于单变量时间序列预测的SARIMAX模型不同。在下一章中，我们将详细探讨VAR模型，并你会发现它也可以扩展成为*VARMA*模型和*VARMAX*模型。
- en: 9.4 Exercises
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 9.4 练习
- en: 'Take the time to test your knowledge with this exercise. The full solution
    is on GitHub: [https://github.com/marcopeix/TimeSeriesForecastingInPython/tree/master/CH09](https://github.com/marcopeix/TimeSeriesForecastingInPython/tree/master/CH09).'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 请花时间通过这个练习测试你的知识。完整的解决方案在GitHub上：[https://github.com/marcopeix/TimeSeriesForecastingInPython/tree/master/CH09](https://github.com/marcopeix/TimeSeriesForecastingInPython/tree/master/CH09)。
- en: 9.4.1 Use all exogenous variables in a SARIMAX model to predict the real GDP
  id: totrans-135
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 9.4.1 在SARIMAX模型中使用所有外生变量来预测实际GDP
- en: In this chapter we limited the number of exogenous variables when forecasting
    for the real GDP. This exercise is an occasion to fit a SARIMAX model using all
    exogenous variables and to verify if you can achieve better performance.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们在预测实际GDP时限制了外生变量的数量。这次练习是一个机会，使用所有外生变量来拟合SARIMAX模型，并验证你是否能实现更好的性能。
- en: Use all exogenous variables in the SARIMAX model.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在SARIMAX模型中使用所有外生变量。
- en: Perform residual analysis.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进行残差分析。
- en: Produce forecasts for the last seven timesteps in the dataset.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对数据集中最后七个时间步长进行预测。
- en: Measure the MAPE. Is it better, worse, or identical to what was achieved with
    a limited number of exogenous variables?
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测量MAPE。它是否比使用有限数量的外生变量时更好、更差，还是相同？
- en: Summary
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: The SARIMAX model allows you to include external variables, also termed exogenous
    variables, to forecast your target.
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SARIMAX模型允许你包含外部变量，也称为外生变量，以预测你的目标。
- en: Transformations are applied only on the target variable, not on the exogenous
    variables.
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 仅对目标变量应用变换，不对外生变量应用变换。
- en: If you wish to forecast multiple timesteps into the future, the exogenous variables
    must also be forecast. This can magnify the errors on the final forecast. To avoid
    that, you must predict only the next timestep.
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你希望预测未来的多个时间步长，外生变量也必须进行预测。这可能会放大最终预测中的误差。为了避免这种情况，你必须只预测下一个时间步长。
