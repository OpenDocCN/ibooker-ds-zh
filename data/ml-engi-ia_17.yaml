- en: 15 Quality and acceptance testing
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 15 质量和验收测试
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Establishing consistency for data sources used in ML
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 建立用于ML的数据源的一致性
- en: Handling prediction failures gracefully with fallback logic
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用回退逻辑优雅地处理预测失败
- en: Providing quality assurance for ML predictions
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为ML预测提供质量保证
- en: Implementing explainable solutions
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实施可解释的解决方案
- en: In the preceding chapter, we focused on broad and foundational technical topics
    for successful ML project work. Following from those foundations, a critical infrastructure
    of monitoring and validation needs to be built to ensure the continued health
    and relevance of any project. This chapter focuses on these ancillary processes
    and infrastructure tooling that enable not only more efficient development, but
    easier maintenance of the project once it is in production.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一章中，我们关注了成功ML项目工作的广泛和基础技术主题。在此基础上，需要建立一个关键的监控和验证基础设施，以确保任何项目的持续健康和相关性。本章重点介绍这些辅助流程和基础设施工具，这些工具不仅使开发更加高效，而且一旦项目投入生产，维护也更加容易。
- en: 'Between the completion of model development and the release of a project are
    four main activities:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在模型开发完成和项目发布之间有四个主要活动：
- en: Data availability and consistency verifications
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据可用性和一致性验证
- en: Cold-start (fallback or default) logic development
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 冷启动（回退或默认）逻辑开发
- en: User-acceptance testing (subjective quality assurance)
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户验收测试（主观质量保证）
- en: Solution interpretability (explainable AI, or XAI)
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 解决方案的可解释性（可解释人工智能，或XAI）
- en: To show where these elements fit within a project’s development path, figure
    15.1 illustrates the post-modeling phase work covered in this chapter.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 为了展示这些元素在项目开发路径中的位置，图15.1展示了本章涵盖的建模阶段后的工作。
- en: '![15-01](../Images/15-01.png)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![15-01](../Images/15-01.png)'
- en: Figure 15.1 Production-grade qualification and testing phase for an ML project
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.1 ML项目的生产级资格和测试阶段
- en: These highlighted actions are generally seen as an afterthought or reactive
    implementation for many projects that I’ve had exposure to. While not applicable
    to every ML solution, evaluating each of these components is highly recommended.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 这些突出的行动通常被视为许多我接触过的项目的后知后觉或反应性实施。虽然这些不一定适用于每个ML解决方案，但评估这些组件非常推荐。
- en: Having their actions or implementations complete before a release happens can
    efficiently prevent a lot of confusion and frustration for your internal business
    unit customer. Removing those obstacles directly translates to better working
    relationships with the business and creates fewer headaches for you.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在发布之前完成他们的行动或实现可以有效地防止内部业务单位客户产生很多困惑和挫败感。直接移除这些障碍可以转化为与业务更好的工作关系，并为你减少许多麻烦。
- en: 15.1 Data consistency
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 15.1 数据一致性
- en: Data issues can be one of the most frustrating aspects of production stability
    for a model. Whether due to flaky data collection, ETL changes between project
    development and deployment, or a general poor implementation of ETL, they typically
    bring a project’s production service to a grinding halt.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 数据问题可能是模型生产稳定性中最令人沮丧的方面之一。无论是因为数据收集不稳定、项目开发和部署之间的ETL更改，还是ETL的一般性实施不佳，它们通常会导致项目的生产服务陷入停滞。
- en: Ensuring data consistency (and regularly validating its quality) in every phase
    of the model life cycle is incredibly important for both the relevance of the
    implementation’s output and the stability of the solution over time. Consistency
    across phases of modeling is achieved by eliminating training and inference skew,
    utilizing feature stores, and openly sharing materialized feature data across
    an organization.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在模型生命周期的每个阶段确保数据一致性（并定期验证其质量）对于实现输出的相关性以及解决方案随时间稳定性的重要性不可估量。通过消除训练和推理偏差、利用特征存储以及在组织内公开共享物化特征数据，实现了建模阶段的一致性。
- en: 15.1.1 Training and inference skew
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.1.1 训练和推理偏差
- en: Let’s imagine that we’re working on a team that has been developing a solution
    by using a batch extract of features for consistency throughout model development.
    Throughout the development process, we were careful to utilize data that we knew
    was available in the serving system’s online data store. Because of the success
    of the project, the status quo was simply not left alone. The business wants more
    of what we’re bringing to the table.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们假设我们正在一个团队中工作，该团队通过使用特征批处理提取来确保模型开发的一致性，从而开发解决方案。在整个开发过程中，我们小心翼翼地利用我们知道在服务系统的在线数据存储中可用的数据。由于项目的成功，现状并没有被忽视。业务希望我们提供更多。
- en: After a few weeks of work, we find that the addition of features from a new
    dataset that wasn’t included in the initial project development makes a large
    impact on the model’s predictive capabilities. We integrate these new features,
    retrain the model, and are left in the position shown in figure 15.2.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 经过几周的工作，我们发现从未包含在初始项目开发中的新数据集中添加特征对模型的预测能力产生了重大影响。我们整合了这些新特征，重新训练了模型，并处于图15.2所示的境地。
- en: '![15-02](../Images/15-02.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![15-02](../Images/15-02.png)'
- en: Figure 15.2 Inference skew due to a feature update
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.2 由于特征更新导致的推理偏差
- en: 'With the online feature system not able to access the data that was later included
    in the model revision, we have a training and inference skew problem. This problem
    manifests itself in two primary ways, as mentioned in figure 15.2:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 由于在线特征系统无法访问后来包含在模型修订中的数据，我们遇到了训练和推理偏差问题。正如图15.2所述，这个问题以两种主要方式表现出来：
- en: Null values are imputed.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 空值被填充。
- en: If filling with a mean or median value of the feature space, the variance and
    potential information within the feature vector will be reduced, potentially leading
    to model degradation during retraining.
  id: totrans-27
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果用特征空间的平均值或中值填充，特征向量的方差和潜在信息将减少，这可能导致重新训练期间模型退化。
- en: If filling with a placeholder value, the results may be worse than the original
    model.
  id: totrans-28
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果用占位符值填充，结果可能比原始模型更差。
- en: Null values are not handled. This may cause exceptions to be thrown, depending
    on the library used. This can fundamentally break the production deployment of
    the new model. The predictions will all be of the fallback heuristics “last hope”
    service.
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 未处理空值。这可能会根据所使用的库抛出异常。这可能会从根本上破坏新模型的部署。所有预测都将使用回退启发式“最后希望”服务。
- en: Scenarios of mismatch between training and inference are not relegated to the
    presence or absence of feature data. These issues can also happen if the processing
    logic for creating the raw data is different between offline data in the data
    warehouse and the online systems. Working through these issues, diagnosing them,
    and repairing them can be incredibly costly and time-consuming.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 训练和推理之间的不匹配场景并不仅限于特征数据的缺失或存在。如果数据仓库中的离线数据与在线系统之间创建原始数据的处理逻辑不同，这些问题也可能发生。解决这些问题、诊断它们和修复它们可能非常昂贵且耗时。
- en: As part of any production ML process, architectural validation and checks for
    consistency in offline and online training systems should be conducted. These
    checks can be manual (statistical validation through a scheduled job) or fully
    automated through the use of a feature store to ensure consistency.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 作为任何生产ML流程的一部分，应进行架构验证和检查离线和在线训练系统的一致性。这些检查可以是手动的（通过计划作业进行的统计验证）或通过使用特征存储完全自动化，以确保一致性。
- en: 15.1.2 A brief intro to feature stores
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.1.2 特征存储简介
- en: From a project’s development perspective, one of the more time-consuming aspects
    of crafting the ML code base is in feature creation. As data scientists, we spend
    a great amount of creative effort in manipulating the data being used in models
    to ensure that the correlations present are optimally leveraged to solve a problem.
    Historically, this computational processing is embedded within a project’s code
    base, in an inline execution chain that is acted upon during both training and
    prediction.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 从项目开发的角度来看，构建ML代码库中耗时较多的一个方面是在特征创建。作为数据科学家，我们在模型中使用的数据上投入了大量的创造性努力，以确保现有的相关性得到最佳利用，以解决问题。历史上，这种计算处理嵌入在项目的代码库中，在一个在线执行链中执行，该链在训练和预测期间都会被调用。
- en: Having this tightly coupled association between the feature engineering code
    and the model-training and prediction code can lead to a great deal of frustrating
    troubleshooting, as we saw earlier in our scenario. This tight coupling can also
    result in complicated refactoring if data dependencies change, and duplicated
    effort if a calculated feature ever needs to be implemented in another project.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 特征工程代码与模型训练和预测代码之间这种紧密耦合的关联可能导致大量的令人沮丧的故障排除，正如我们在之前的场景中看到的。这种紧密耦合还可能导致数据依赖关系变化时的复杂重构，以及如果计算出的特征需要在其他项目中实现时，会重复工作。
- en: With the implementation of a feature store, however, these data consistency
    issues can be largely solved. With a single source of truth defined once, a registered
    feature calculation can be developed once, updated as part of a scheduled job,
    and available to be used by anyone in the organization (if they have sufficient
    access privileges, that is).
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，通过实施特征存储，这些数据一致性问题是可以通过大量解决。一旦定义了单一的真实来源，注册的特征计算就可以开发一次，作为计划作业的一部分进行更新，并且可供组织中的任何人使用（如果他们有足够的访问权限的话）。
- en: 'Consistency is not the only goal of these engineered systems. Synchronized
    data feeds to an online transaction processing (OLTP) storage layer (for real-time
    predictions) are another quality-of-life benefit that a feature store brings to
    minimizing the engineering burden of developing, maintaining, and synchronizing
    ETL needs for production ML. The basic design of a feature store capable of supporting
    online predictions consists of the following:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 一致性并不是这些工程化系统的唯一目标。同步数据流到在线事务处理（OLTP）存储层（用于实时预测）是特征存储带来的另一个生活质量的提升，它有助于最小化开发、维护和同步生产机器学习ETL需求的技术负担。能够支持在线预测的特征存储的基本设计包括以下内容：
- en: 'An ACID-compliant storage layer:'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个符合ACID存储层：
- en: '*(A) Atomicity*—Guaranteeing that transactions (writes, reads, updates) are
    handled as unit operations that either succeed (are committed) or fail (are rolled
    back) to ensure data consistency.'
  id: totrans-38
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*(A) 原子性*—保证事务（写入、读取、更新）作为单元操作处理，要么成功（提交），要么失败（回滚），以确保数据一致性。'
- en: '*(C) Consistency*—Transactions to the data store must leave the data in a valid
    state to prevent data corruption (from an invalid or illegal action to the system).'
  id: totrans-39
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*(C) 一致性*—对数据存储的事务必须使数据处于有效状态，以防止数据损坏（来自对系统的无效或非法操作）。'
- en: '*(I) Isolation*—Transactions are concurrent and always leave the storage system
    in a valid state as though operations were performed in sequence.'
  id: totrans-40
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*(I) 隔离*—事务是并发进行的，并且总是使存储系统处于有效状态，就像操作是按顺序执行的一样。'
- en: '*(D) Durability*—Valid executions to the state of the system will remain persistent
    at all times, even in the event of a hardware system failure or power loss, and
    are written to a persistent storage layer (written to disk, as opposed to volatile
    memory).'
  id: totrans-41
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*(D) 持久性*—对系统状态的合法执行将始终持续存在，即使在硬件系统故障或断电的情况下，也会写入持久存储层（写入磁盘，而不是易失性内存）。'
- en: A low-latency serving layer that is synchronized to the ACID storage layer (typically,
    volatile in-memory cache layers or in-memory database representations such as
    Redis).
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个低延迟的服务层，与ACID存储层同步（通常是易失性的内存缓存层或内存数据库表示，如Redis）。
- en: A denormalized representation data model for both a persistent storage layer
    and in-memory key-value store (primary-key access to retrieve relevant features).
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个非规范化的表示数据模型，适用于持久存储层和内存中的键值存储（通过主键访问以检索相关特征）。
- en: An immutable read-only access pattern for end users. The teams that own the
    generated data are the only ones with write authority.
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对最终用户来说，是一个不可变的只读访问模式。拥有生成数据的团队是唯一具有写入权限的团队。
- en: As mentioned, the benefits of a feature store are not restricted to consistency.
    Reusability is one of the primary features of a feature store, as illustrated
    in figure 15.3.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，特征存储的好处不仅限于一致性。可重用性是特征存储的主要特性之一，如图15.3所示。
- en: '![15-03](../Images/15-03.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![15-03](../Images/15-03.png)'
- en: Figure 15.3 The basic concept of a feature store
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.3 特征存储的基本概念
- en: As you can see, implementing a feature store carries a multitude of benefits.
    Having a standard corpus of features throughout a company means that every use
    case, from reporting (BI) to analytics and DS research is operating on the *same
    set of source-of-truth data* as everyone else. Using the feature store eliminates
    confusion, increases efficiency (features don’t have to be redesigned by everyone
    for each use case), and ensures that the costs for generating features are incurred
    only once.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所见，实施特征存储带来了许多好处。在整个公司拥有一个标准的特征库意味着每个用例，从报告（BI）到分析和DS研究，都在使用与其他人相同的*同一套真实数据来源*。使用特征存储消除了混淆，提高了效率（特征不需要为每个用例由每个人重新设计），并确保生成特征的成本只发生一次。
- en: 15.1.3 Process over technology
  id: totrans-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.1.3 过程胜于技术
- en: The success of a feature store implementation is not in the specific technology
    used to implement it. The benefit is in the actions it enables a company to take
    with its calculated and standardized feature data.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 特征存储实施的成功并不在于实现它的具体技术。其好处在于它使公司能够利用其计算和标准化的特征数据采取行动。
- en: Let’s briefly examine an ideal process for a company that needs to update the
    definition of its revenue metric. For such a broadly defined term, the concept
    of revenue at a company can be interpreted in many ways, depending on the end-use
    case, the department concerned with the usage of that data, and the level of accounting
    standards applied to the definition for those use cases.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们简要考察一个公司需要更新其收入指标定义的理想过程。对于这样一个广泛定义的术语，公司的收入概念可以根据最终用例、关注该数据使用的部门以及应用于这些用例的定义的会计标准水平以多种方式解释。
- en: A marketing group, for instance, may be interested in gross revenue for measuring
    the success rate of advertising campaigns. The DE group may define multiple variations
    of revenue to handle the needs of different groups within the company. The DS
    team may be looking at a windowed aggregation of any column in the data warehouse
    that has the words “sales,” “revenue,” or “cost” in it to create feature data.
    The BI team might have a more sophisticated set of definitions that appeal to
    a broader set of analytics use cases.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，一个营销团队可能对总收入感兴趣，以衡量广告活动的成功率。DE团队可能会定义多种收入变体，以满足公司内部不同团队的需求。DS团队可能会查看数据仓库中任何包含“销售”、“收入”或“成本”等词语的列的窗口聚合，以创建特征数据。BI团队可能有一套更复杂的定义，这些定义适用于更广泛的分析用例。
- en: Changing a definition of the logic of such a key business metric can have far-reaching
    impacts to an organization if everyone is responsible for their group’s personal
    definitions. The likelihood of each group changing its references in each of the
    queries, code bases, reports, and models that it is responsible for is marginal.
    Fragmenting the definition of such an important metric across departments is problematic
    enough on its own. Creating multiple versions of the defining characteristics
    within each group is a recipe for complete chaos. With no established standard
    for how key business metrics are defined, groups within a company are effectively
    no longer speaking on even terms when evaluating the results and outputs from
    one another.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 如果每个人都对其小组的个人定义负责，那么改变这样一个关键业务指标的定义逻辑可能会对组织产生深远的影响。每个小组在每个查询、代码库、报告和模型中改变其参考的可能性微乎其微。将如此重要的指标的定义碎片化到各个部门本身就存在问题。在每个小组内部创建多个定义特征的版本是导致完全混乱的配方。如果没有建立关键业务指标定义的标准，公司内部的小组在评估彼此的结果和输出时实际上不再处于平等地位。
- en: Regardless of the technology stack used to store the data for consumption, having
    a process built around change management for critical features can guarantee a
    frictionless and resilient data migration. Figure 15.4 illustrates such a process.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 无论使用哪种技术栈来存储用于消费的数据，围绕关键特征变更管理构建的过程可以保证无缝且具有弹性的数据迁移。图15.4展示了这样一个过程。
- en: '![15-04](../Images/15-04.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![15-04](../Images/15-04.png)'
- en: Figure 15.4 Setting a data change-point process for updating a critical feature
    store entry
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.4 设置更新关键特征存储条目数据变更点过程
- en: As you can see, the new standard for reporting company revenue comes from the
    executive council. From this defining point, a successful feature store update
    process can begin. With the stakeholders present from each group that deals with
    company-wide utilization of this sort of data, a thorough evaluation of the proposed
    change can commence. Each of the producers and consumers of this data collectively
    agree on a course of action to ensure that the new standard becomes an actual
    standard at the company. After the meeting, each group knows the actions that
    it needs to take in order to make the migration to this new metric; the metric
    is defined, implemented, and synchronized through ETL to a common feature store.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所见，公司收入报告的新标准来自执行委员会。从这个定义性的点开始，一个成功的特征存储更新过程可以开始。在处理此类公司范围内数据利用的每个小组的利益相关者都到场的情况下，可以开始对拟议的变更进行彻底评估。数据的生产者和消费者集体同意采取行动，以确保新的标准在公司中成为实际标准。会议结束后，每个小组都知道它需要采取哪些行动才能迁移到这个新指标；该指标通过ETL同步到公共特征存储中。
- en: Change-point processes are critical for ensuring consistency across an organization
    that relies on data to make informed decisions. By employing these processes,
    everyone is speaking the same “data language.” Discussions around the veracity
    of analytics, reporting, and predictions can all be standardized on the same common
    definition of a data term. It also dramatically improves the stability of dependent
    production (automated) jobs and reporting that rely on this data.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 变点过程对于确保依赖数据做出明智决策的组织的一致性至关重要。通过采用这些过程，每个人都使用相同的“数据语言”。关于分析、报告和预测的真实性的讨论都可以基于对数据术语的同一共同定义进行标准化。这也极大地提高了依赖于这些数据的依赖性生产（自动化）工作和报告的稳定性。
- en: 15.1.4 The dangers of a data silo
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.1.4 数据孤岛的危险
- en: Data silos are deceptively dangerous. Isolating data in a walled-off, private
    location that is accessible only to a certain select group of individuals stifles
    the productivity of other teams, causes a large amount of duplicated effort throughout
    an organization, and frequently (in my experience of seeing them, at least) leads
    to esoteric data definitions that, in their isolation, depart wildly from the
    general accepted view of a metric for the rest of the company.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 数据孤岛看似无害，实则危险。将数据隔离在只有特定小部分人可以访问的封闭、私人位置，会抑制其他团队的生产力，在整个组织中造成大量重复劳动，并且（至少在我观察到的经验中）经常导致一些晦涩难懂的数据定义，这些定义在孤立状态下与公司普遍接受的观点大相径庭。
- en: It may seem like a really great thing when an ML team is granted a database
    of its own or an entire cloud object store bucket to empower the team to be self-service.
    The seemingly geologically scaled time spent for the DE or warehousing team to
    load required datasets disappears. The team members are fully masters of their
    domain, able to load, consume, and generate data with impunity. This can definitely
    be a good thing, provided that clear and soundly defined processes govern the
    management of this technology.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 当一个机器学习团队被授予自己的数据库或整个云对象存储桶以赋予团队自助服务能力时，这似乎是一件非常好的事情。对于数据工程或仓储团队来说，用于加载数据集所需的时间似乎在地质尺度上消失了。团队成员完全掌握自己的领域，能够无拘无束地加载数据、消费数据和生成数据。这确实可能是一件好事，前提是明确且合理定义的过程来管理这项技术。
- en: But clean or dirty, an internal-use-only data storage stack is a silo, the contents
    squirreled away from the outside world. These silos can generate more problems
    than they solve.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 但无论数据是干净的还是脏的，仅限内部使用的数据存储堆栈都是一种孤岛，其内容被隐藏在世外桃源。这些孤岛可能产生的问题比解决的问题还要多。
- en: To show how a data silo can be disadvantageous, let’s imagine that we work at
    a company that builds dog parks. Our latest ML project is a bit of a moon shot,
    working with counterfactual simulations (causal modeling) to determine which amenities
    would be most valuable to our customers at different proposed construction sites.
    The goal is to figure out how to maximize the perceived quality and value of the
    proposed parks while minimizing our company’s investment costs.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明数据孤岛可能带来的不利影响，让我们设想我们工作在一个建造狗公园的公司。我们最新的机器学习项目是一个有点像太空任务的项目，使用反事实模拟（因果建模）来确定在不同拟议的建筑地点，哪些设施对我们客户最有价值。目标是找出如何最大化拟议公园的感知质量和价值，同时最小化我们公司的投资成本。
- en: To build such a solution, we have to get data on all of the registered dog parks
    in the country. We also need demographic data associated with the localities of
    these dog parks. Since the company’s data lake contains no data sources that have
    this information, we have to source it ourselves. Naturally, we put all of this
    information in our own environment, thinking it will be far faster than waiting
    for the DE team’s backlog to clear enough to get around to working on it.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 要构建这样的解决方案，我们必须获取全国所有注册狗公园的数据。我们还需要与这些狗公园所在地相关的人口统计数据。由于公司的数据湖不包含具有这些信息的数据源，我们必须自己获取这些信息。自然地，我们将所有这些信息放在我们自己的环境中，认为这将比等待数据工程团队的工作队列清理完毕后开始工作要快得多。
- en: After a few months, questions began to arise about some of the contracts that
    the company had bid on in certain locales. The business operations team is curious
    about why so many orders for custom paw-activated watering fountains are being
    ordered as part of some of these construction inventories. As the analysts begin
    to dig into the data available in the data lake, they can’t make sense of why
    the recommendations for certain contracts consistently recommended these incredibly
    expensive components.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 几个月后，关于公司在某些地区竞标的一些合同开始出现疑问。业务运营团队好奇为什么在许多建筑库存中会订购如此多的定制爪子激活喷泉。随着分析师开始挖掘数据湖中的数据，他们无法理解为什么某些合同的推荐始终建议这些极其昂贵的组件。
- en: After spending months working through analyses, the decision is made to remove
    this feature from contract bidding. No one can explain why it is there, and they
    decide that it isn’t worth it to continue to offer it. They are keener on offering
    automatic dog-washing stations (car-wash style), dog-poop robots (cleaners of,
    not made of), park-wide cooling fans, and automated ball-throwing apparatuses.
    As such, a large order is placed for those items, and the fountain-sourcing contracts
    are terminated.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在花费数月时间进行分析后，决定从合同投标中移除此功能。没有人能解释为什么它在那里，他们决定继续提供它不值得。他们更愿意提供自动洗狗站（汽车洗车风格）、狗粪机器人（清洁者，而非制造者）、公园范围的冷却风扇和自动抛球装置。因此，订购了大量这些物品，并终止了喷泉采购合同。
- en: 'A few months later, a competitor starts offering the exact same element on
    contracts that we have been bidding on. The cities and towns begin to go for the
    competitor’s bid. When finally pressed about why, sales teams start hearing the
    same answer: the dogs just really love water fountains, particularly in areas
    that are far from people’s homes and municipal dog-watering stations. What ends
    up happening here is shown in figure 15.5.'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 几个月后，一个竞争对手开始在合同中提供与我们一直在竞标的完全相同的元素。城市和城镇开始转向竞争对手的投标。当最终被追问原因时，销售团队开始听到相同的答案：狗们真的很喜欢喷泉，尤其是在远离人们住所和市政供水站的地区。这里最终发生的情况如图15.5所示。
- en: '![15-05](../Images/15-05.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![15-05](../Images/15-05.png)'
- en: Figure 15.5 Storing critical data in a silo
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.5 在隔离区存储关键数据
- en: With no visibility into these features that were collected and used for the
    amenities counterfactual-based simulation model that the DS team built, the business
    is unable to piece together the reasons for the model’s suggestions. The data
    was siloed with no ill intentions, but it causes a massive problem for the business
    because critical data is inaccessible.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 由于无法看到DS团队构建的基于便利设施反事实模拟模型所收集和使用的这些特征，业务无法拼凑出模型建议的原因。数据被孤立，没有恶意，但它给业务带来了巨大问题，因为关键数据无法访问。
- en: We’re not farmers. *We should never be using silos.* At least not data ones.
    If farming’s your hobby, don’t let me stop you. We should, on the other hand,
    work closely with DE and warehousing teams to ensure that we’re able to write
    data to locations that everyone can access—preferably, as we will discuss in chapter
    17, to a feature store.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不是农民。*我们永远不应该使用隔离区。*至少不是数据隔离区。如果你对农业感兴趣，那就别让我阻止你。另一方面，我们应该与数据工程和仓储团队紧密合作，确保我们能够将数据写入每个人都可以访问的位置——最好，如我们将在第17章中讨论的，写入特征存储库。
- en: 15.2 Fallbacks and cold starts
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 15.2 备用方案和冷启动
- en: Let’s imagine that we’ve just built an ML-powered solution for optimizing delivery
    routes for a pizza company. Some time ago, the business approached us, asking
    for a cheaper, faster, and more adaptable solution to optimizing the delivery
    routes of a single driver. The prior method for figuring out which addresses a
    certain driver would deliver the pizzas to was done by a pathing algorithm that
    generated optimal routes based on ArcGIS. While capable and quite fully featured,
    the business wanted something that considered the temporal nature and history
    of actual delivery data to create a more effective route.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们想象一下，我们刚刚为一家披萨公司构建了一个用于优化配送路线的机器学习解决方案。不久前，公司向我们寻求一个更便宜、更快、更灵活的解决方案来优化单个司机的配送路线。之前确定某个司机将配送披萨到哪些地址的方法是通过路径算法，该算法基于ArcGIS生成最佳路线。虽然功能强大且全面，但公司希望有一种考虑实际配送数据的时空性质和历史的方法来创建更有效的路线。
- en: The team worked on an LSTM-based approach that was trained on the last three
    years of delivery data, creating an adversarial network with reinforcement learning
    that rewarded optimal pathing based on timeliness of delivery. The project quickly
    advanced from a science project to something that was proving its worth in a handful
    of regions. It was far more adept at selecting delivery sequences than the brute-force
    pathing that their previous production system was capable of.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 团队使用了一种基于LSTM的方法，该方法在过去的三年配送数据上进行了训练，创建了一个基于强化学习的对抗网络，该网络根据配送的及时性奖励最佳路径。项目迅速从一项科学项目转变为在几个地区证明其价值的实际应用。它在选择配送序列方面比之前生产系统能够实现的暴力路径搜索要熟练得多。
- en: After reviewing several weeks’ worth of routing data in the test markets, the
    business felt comfortable with turning on the system for all delivery routes.
    Things looked pretty good. Predictions were being served, drivers were spending
    less time stuck in traffic, and pizza was delivered hot at a much higher rate
    than ever before.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在审查了测试市场几周的路由数据后，公司对在所有配送路线上启用系统感到放心。一切看起来都很顺利。预测正在被提供服务，司机在交通堵塞中花费的时间减少了，而且比以往任何时候都要高得多地将热披萨准时送达。
- en: It took about a week before the complaints began pouring in. Customers in rural
    areas were complaining of very long delivery times at a frighteningly high rate.
    After looking at the complaints, the pattern began to emerge that every complaint
    was always with the last stop on a delivery chain. It didn’t take long for the
    DS team to realize what was happening. With most of the training data focused
    on urban centers, the volume of drop-offs and the lower proximity between stops
    meant that an optimized stop count was being targeted in general for the model.
    When this delivery count was applied to a rural environment, the sheer distances
    involved meant that nearly all final-stop delivery customers would be greeted
    with a room-temperature pizza.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 大约过了一个星期，投诉才开始如潮水般涌来。农村地区的客户以惊人的高比例抱怨配送时间非常长。在查看投诉后，一个模式开始显现，即每个投诉都与配送链的最后一个停靠点有关。DS团队很快就意识到发生了什么。由于大部分训练数据集中在城市中心，停靠点的数量和停靠点之间的距离较低，因此模型通常针对优化停靠点数量。当这个配送数量应用于农村环境时，巨大的距离意味着几乎所有最终停靠点的配送客户都会收到室温的披萨。
- en: Without a fallback control on the length of routes or the estimated total delivery
    time, the model was optimizing routes for the minimal amount of time for the total
    delivery run volume, regardless of how long that total estimated time would be.
    The solution lacked a backup plan. It didn’t have a fallback to use existing geolocation
    services (the ArcGIS solution for rural routes) if the model’s output violated
    a business rule (don’t deliver cold pizza).
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 由于没有对路线长度或估计的总配送时间进行回退控制，该模型正在优化总配送运行量的最小时间，而不管这个总估计时间有多长。该解决方案缺乏备用计划。如果没有回退到使用现有的地理位置服务（农村路线的ArcGIS解决方案），如果模型的输出违反了业务规则（不要配送冷披萨），则没有备用方案。
- en: A critical part of any production ML solution is to *always have a backup plan*.
    Regardless of the level of preparation, forethought, and planning, even the most
    comprehensive and hardened-against-failure solution will inevitably go wrong at
    some point. Whether the solution that you’re building is offline (batch), near-real-time
    (micro-batch streaming), online, or edge deployed, some condition in the near
    or far future will result in the model just not behaving the way that you were
    hoping.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 任何生产级机器学习解决方案的关键部分是**始终有一个备份计划**。无论准备、预想和规划的程度如何，即使是综合性和抗故障能力最强的解决方案，也难免在某些时候出现问题。无论你构建的解决方案是离线（批量）、近实时（微批流式）、在线还是边缘部署，未来近或远某个条件都可能导致模型无法按照预期的方式运行。
- en: Table 15.1 shows a brief list of ways for a solution’s model to malfunction
    and the level of impact depending on the degree of gravity of the model’s use.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 表15.1展示了解决方案模型可能出现的故障方式及其影响程度，这取决于模型使用的严重程度。
- en: Table 15.1 When models don’t play nicely
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 表15.1 模型不配合的情况
- en: '| Condition | Comical example | Serious business example |'
  id: totrans-81
  prefs: []
  type: TYPE_TB
  zh: '| 条件 | 好笑的例子 | 严重的业务例子 |'
- en: '| Regression predictions outside of possible natural range | Predict that customer
    will spend -$8,745 today. | Withdraw reactor control rods to maximum height. Now.
    |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '| 回归预测超出可能自然范围 | 预测客户今天将花费-8,745美元。 | 现在将反应堆控制棒拔到最大高度。 |'
- en: '| Classifier predicting only a single class | Everything is a dog. Even that
    cat is a dog. | Self-driving car classifying a stop sign on an interstate highway.
    |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '| 只预测单个类别的分类器 | 一切都是狗。甚至那只猫也是狗。 | 在州际高速公路上自动分类停车标志。 |'
- en: '| Missed SLA on app/web | A blank void of empty IFrame elements. | Locking
    your accounts because of fraudulent activity. |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
  zh: '| 未满足应用/网页的SLA | 空白的空Iframe元素。 | 由于欺诈活动锁定账户。 |'
- en: '| No content filtering of chatbot | Starts reciting song lyrics. | Starts insulting
    the user. |'
  id: totrans-85
  prefs: []
  type: TYPE_TB
  zh: '| 聊天机器人没有内容过滤 | 开始背诵歌曲歌词。 | 开始侮辱用户。 |'
- en: '| No response from failure-detection system | Monitoring panel converted to
    Christmas display. | Shut off all power plants. On the Eastern seaboard. |'
  id: totrans-86
  prefs: []
  type: TYPE_TB
  zh: '| 失败检测系统无响应 | 监控面板变成了圣诞展示。 | 关闭所有发电厂。在东海岸。 |'
- en: While these examples are fairly ridiculous (mostly—some are based on real situations),
    they all share a common thread. Not a single one has a fallback plan. They allow
    bad things to happen if the single point of failure in the system (a model’s prediction)
    doesn’t work as intended. While purposefully obtuse, the point here is that all
    model-powered solutions have some sort of failure mode that will happen if a backup
    isn’t in place.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这些例子相当荒谬（大多数是——一些基于真实情况），但它们都有一个共同点。没有一个有回退计划。如果系统中的单点故障（模型的预测）没有按预期工作，它们就会允许发生不好的事情。虽然故意含糊其辞，但这里的重点是，所有由模型驱动的解决方案都有某种失败模式，如果没有备份，就会发生。
- en: '*Cold starts*, on the other hand, are a unique form of model failure. Instead
    of a fully nonfunctional scenario that typical fallback systems handle, models
    that suffer from a cold-start issue are those that require historical data to
    function for which that data hasn’t been generated yet. From recommendation systems
    for first-time users to price optimization algorithms in new markets, model solutions
    that need to make a prediction based on data that doesn’t exist need a specific
    type of fallback system to be in place.'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，**冷启动**是模型失败的一种独特形式。与典型回退系统处理的完全非功能场景不同，遭受冷启动问题的模型是需要历史数据来运行，而这种数据尚未生成。从为新用户设计的推荐系统到新市场的价格优化算法，需要基于不存在的数据进行预测的模型解决方案需要特定的回退系统。
- en: 15.2.1 Leaning heavily on prior art
  id: totrans-89
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.2.1 过度依赖现有技术
- en: We could use nearly any of the comical examples from table 15.1 to illustrate
    the first rule in creating fallback plans. Instead, let’s use an actual example
    from my own personal history.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以用表15.1中的几乎所有好笑的例子来说明创建回退计划的第一条规则。相反，让我们用一个来自我个人历史的实际例子来说明。
- en: I once worked on a project that had to deal with a manufacturing recipe. The
    goal of this recipe was to set a rotation speed on a ludicrously expensive piece
    of equipment while a material was dripped onto it. The speed of this unit needed
    to be adjusted periodically throughout the day as the temperature and humidity
    changed the viscosity of the material being dripped onto the product. Keeping
    this piece of equipment running optimally was my job; there were many dozens of
    these stations in the machine and many types of chemicals.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 我曾经参与过一个必须处理制造配方项目。这个配方的目标是设置一个旋转速度在一个极其昂贵的设备上，当材料滴到上面时。这个单元的速度需要根据温度和湿度的变化，在一天中定期调整，因为温度和湿度会改变滴到产品上的材料的粘度。保持这台设备运行最佳是我的工作；机器中有许多这样的站点和许多种类的化学品。
- en: As in so many times in my career, I got really tired of doing a repetitive task.
    I figured there had to be some way to automate the spin speed of these units so
    I wouldn’t have to stand at the control station and adjust them every hour or
    so. Thinking myself rather clever, I wired up a few sensors to a microcontroller,
    programmed the programmable logic controller to receive the inputs from my little
    controller, wrote a simple program that would adjust the chuck speed according
    to the temperature and humidity in the room, and activated the system.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 就像在我的职业生涯中许多次一样，我厌倦了重复性的工作。我想，一定有办法自动化这些单元的转速，这样我就不必每小时站在控制站调整它们。自认为相当聪明，我连接了一些传感器到微控制器上，编程了可编程逻辑控制器以接收来自我的小控制器的输入，编写了一个简单的程序，它会根据房间内的温度和湿度调整夹具转速，并激活了系统。
- en: Everything went well, I thought, for the first few hours. I had programmed a
    simple regression formula into the microcontroller, checked my math, and even
    tested it on an otherwise broken piece of equipment. It all seemed pretty solid.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 我想，前几个小时一切都很顺利。我已经将一个简单的回归公式编程到微控制器中，检查了我的数学计算，甚至在另一件损坏的设备上进行了测试。一切看起来都很稳固。
- en: It wasn’t until around 3 a.m. that my pager (yes, it was *that long ago*) started
    going off. By the time I made it to the factory 20 minutes later, I realized that
    I had caused an overspeed condition in every single spin chuck system. They stopped.
    The rest of the liquid dosing system did not. As the chilly breeze struck the
    back of my head, and I looked out at the open bay doors letting in the 27˚F night
    air, I realized my error.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 直到凌晨3点左右，我的呼叫器（是的，那是很久以前的事情了）才开始响起。当我20分钟后到达工厂时，我意识到我已经在每个旋转夹具系统中造成了超速条件。它们停止了。其余的液体计量系统没有停止。当冷风击打我的后脑勺，我看着敞开的船坞门让27°F的夜晚空气进来时，我意识到我的错误。
- en: I didn’t have a fallback condition. The regression line, taking in the ambient
    temperature, tried to compensate for the untested range of data (the viscosity
    curve wasn’t actually linear at that range), and took a chuck that normally rotated
    at around 2,800 RPM and tried to instruct it to spin at 15,000 RPM.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 我没有后备条件。回归线，考虑到环境温度，试图补偿未经测试的数据范围（在该范围内，粘度曲线实际上并不是线性的），并试图让一个通常以约2,800 RPM旋转的夹具以15,000
    RPM的速度旋转。
- en: I spent the next four days and three nights cleaning up lacquer from the inside
    of that machine. By the time I was finished, the lead engineer took me aside and
    handed me a massive three-ring binder and told me to “read it before playing any
    more games.” (I’m paraphrasing. I can’t put into print what he said to me.) The
    book was filled with the materials science analysis of each chemical that the
    machine was using. It had the exact viscosity curves that I could have used. It
    had information on maximum spin speeds for deposition.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来的四天三夜，我都在清理这台机器内部的清漆。当我完成时，首席工程师把我拉到一边，递给我一个巨大的三环笔记本，并告诉我“在玩任何游戏之前先读一读。”（我在这里进行释义。我不能把他对我说的话写出来。）这本书充满了机器使用的每种化学品的材料科学分析。它有我可以用到的精确的粘度曲线。它有关于沉积的最大转速的信息。
- en: Someone had done a lot of work before I got there. Someone had figured out what
    the safe and unsafe thresholds were for the material, as well as the chuck drive
    motor.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在我到达之前，有人做了很多工作。有人已经确定了材料的安危阈值，以及夹具驱动电机。
- en: I learned an important lesson that day. That lesson is illustrated in figure
    15.6.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 我在那一天学到了一个重要的教训。这个教训在图15.6中得到了说明。
- en: I was solidly in the top portion of figure 15.6\. I rapidly learned, with no
    small amount of antagonistic reinforcement from my fellow engineers, to strive
    to be in the bottom portion of figure 15.6\. I learned to think about what could
    go wrong in any solution and how important it is to have guardrails and fallback
    conditions when things did go wrong.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 我一开始就坚定地处于图15.6的上半部分。我迅速地意识到，在同事工程师们不小的对抗性强化下，我需要努力达到图15.6的下半部分。我学会了思考任何解决方案可能出错的地方，以及当事情出错时，拥有护栏和后备条件是多么重要。
- en: '![15-06](../Images/15-06.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![15-06](../Images/15-06.png)'
- en: Figure 15.6 Figuring out the importance of safeguards and fallbacks in engineering
    work
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.6 在工程工作中弄清楚安全措施和后备方案的重要性
- en: Many times, when building an ML solution, a DS can wrongly assume that the problem
    that they are tackling is one that has no prior art. There are certainly exceptions
    (the moon-shot projects), but the vast majority of solutions I’ve worked on in
    my career have had *someone* at a company fulfilling the role that the project
    is meant to automate.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在构建机器学习解决方案时，许多时候，数据科学家可能会错误地假设他们正在解决的问题是没有先例的。当然有例外（如登月项目），但我在职业生涯中工作的绝大多数解决方案都有人在公司中扮演着项目旨在自动化的角色。
- en: That person had methods, practices, and standards by which they were doing that
    task. They understood the data before you came along. They were, for all intents
    and purposes, a living, breathing version of that three-ring binder that my boss
    threw at me in anger. They knew how fast the chuck could spin and what would happen
    to the lacquer if a technician tried to sneak a cigarette break in the middle
    of winter.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 那个人有完成这项任务的方法、实践和标准。在你到来之前，他们就理解了数据。从所有意义上讲，他们是一个活生生的、有呼吸的版本，就像我的老板生气时扔给我的那个三环笔记本。他们知道卡盘能转多快，如果技术人员想在冬天中间偷偷抽根烟，会发生什么。
- en: These individuals (or code) that represent prior art will know the conditions
    that you need to consider when building a fallback system. They’ll know what the
    default conditions should be if the model predicts garbage. They’ll know what
    the acceptable range of your regressor’s prediction can be. They’ll know how many
    cat photos should be expected each day and how many dogs as well. They are your
    sage guides who can help make a more robust solution. It’s worth asking them how
    they solved the problem and what their funniest story is of when things went wrong.
    It will only help to make sure you don’t repeat it.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 这些代表现有技术的个人（或代码）将知道在构建后备系统时需要考虑的条件。他们会知道如果模型预测出垃圾数据，默认条件应该是什么。他们会知道回归预测的可接受范围。他们会知道每天应该有多少猫的照片和狗的照片。他们是你的智者向导，可以帮助你构建更稳健的解决方案。询问他们如何解决问题以及他们最有趣的错误故事是值得的。这只会帮助你确保不要重复同样的错误。
- en: 15.2.2 Cold-start woes
  id: totrans-105
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.2.2 冷启动问题
- en: For certain types of ML projects, model prediction failures are not only frequent,
    but also expected. For solutions that require a historical context of existing
    data to function properly, the absence of historical data prevents the model from
    making a prediction. The data simply isn’t available to pass through the model.
    Known as the *cold-start problem*, this is a critical aspect of solution design
    and architecture for any project dealing with temporally associated data.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 对于某些类型的机器学习项目，模型预测失败不仅频繁，而且预期。对于需要现有数据历史背景才能正常工作的解决方案，缺乏历史数据会阻止模型进行预测。数据根本无法通过模型。被称为“冷启动问题”，这是任何处理时间相关数据的项目的解决方案设计和架构的关键方面。
- en: As an example, let’s imagine that we run a dog-grooming business. Our fleets
    of mobile bathing stations scour the suburbs of North America, offering all manner
    of services to dogs at their homes. Appointments and service selection is handled
    through an app interface. When booking a visit, the clients select from hundreds
    of options and prepay for the services through the app no later than a day before
    the visit.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，让我们假设我们经营一家宠物美容业务。我们的移动洗澡站车队在美国郊区巡游，为狗狗提供各种上门服务。预约和服务选择通过应用程序界面处理。当预订访问时，客户可以从数百个选项中选择，并在访问前一天通过应用程序预先支付服务费用。
- en: To increase our customers’ satisfaction (and increase our revenue), we employ
    a service recommendation interface on the app. This model queries the customer’s
    historical visits, finds products that might be relevant for them, and indicates
    additional services that the dog might enjoy. For this recommender to function
    correctly, the historical services history needs to be present during service
    selection.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提高我们客户的满意度（并增加我们的收入），我们在应用程序上使用服务推荐界面。此模型查询客户的历史访问记录，找到可能对他们相关的产品，并指出狗可能喜欢的额外服务。为了使推荐器正常工作，需要在服务选择期间提供历史服务记录。
- en: This isn’t much of a stretch for anyone to conceptualize. A model without data
    to process isn’t particularly useful. With no history available, the model clearly
    has no data in which to infer additional services that could be recommended for
    bundling into the appointment.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 这对任何人来说都不是很难想象。没有数据处理数据模型的模型并不特别有用。没有历史记录，模型显然没有数据来推断可能推荐捆绑到预约中的额外服务。
- en: What’s needed to serve *something* to the end user is a cold-start solution.
    An easy implementation for this use case is to generate a collection of the most
    frequently ordered services globally. If the model doesn’t have enough data to
    provide a prediction, this popularity-based services aggregation can be served
    in its place. At that point, the app IFrame element will at least have something
    in it (instead of showing an empty collection) and the user experience won’t be
    broken by seeing an empty box.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 向最终用户提供“某种东西”需要冷启动解决方案。对于此用例的一个简单实现是生成全球最常订购服务的集合。如果模型没有足够的数据来提供预测，可以用基于流行度的服务聚合来代替。到那时，应用程序的IFrame元素至少会有一些内容（而不是显示空集合），用户界面不会因为看到空框而受损。
- en: More-sophisticated implementations can be made, upgrading a global popularity
    ranking to one with more fine-grained cold-start pre-generated data. At a bare
    minimum, the geographic region can be used as a grouped aggregation to calculate
    popularity of services to create a pseudo-personalized failover condition. More-sophisticated
    grouping assignments can be made if additional data is available for the end user,
    referencing those aggregated data points across the user base for grouping conditions,
    ensuring that more refined and granular recommendations are served. A cold-start-enabled
    architecture is shown in figure 15.7.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 可以进行更复杂的实现，将全局流行度排名升级为具有更多细粒度预生成的冷启动数据的排名。至少，可以使用地理区域作为分组聚合来计算服务的流行度，以创建一个伪个性化的故障转移条件。如果为最终用户提供额外的数据，可以进行更复杂的分组分配，参考用户基础中的聚合数据点来设置分组条件，确保提供更精细和粒度化的推荐。图15.7展示了启用了冷启动的架构。
- en: '![15-07](../Images/15-07.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![15-07](../Images/15-07.png)'
- en: Figure 15.7 Logical diagram of a cold start solution
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.7 冷启动解决方案的逻辑图
- en: 'Building a heuristics-based solution, leveraging the deep knowledge of the
    use case by collaborating with the SMEs, is a solid approach for solving the cold-start
    issue. When a user who doesn’t have an order selection history of at least three
    appointments starts using the app, the model is bypassed entirely and a simple
    business rules pseudo-prediction is made. These cold-start solution implementations
    can take the following forms:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 建立基于启发式解决方案，通过与SMEs合作利用用例的深度知识，是解决冷启动问题的有效方法。当一个用户没有至少三个预约选择历史记录时开始使用应用程序，模型将完全绕过，并做出简单的基于业务规则的伪预测。这些冷启动解决方案的实施可以采取以下形式：
- en: Most popular items in user geographic location over the last month
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 上个月用户地理位置中最受欢迎的项目
- en: Most popular items bought today globally
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 全球今天最受欢迎的项目
- en: SME-curated collections of items
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SME管理的项目集合
- en: High-inventory items
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 库存高的项目
- en: Regardless of the approach used, it’s important to have something in place.
    The alternative, after all, is to return no data. This simply isn’t an option
    for customer-facing applications that depend on some form of data to be produced
    from an API in order to populate elements in the interface with content. The benefit
    to having a cold-start alternative solution in place is that it can serve as a
    fallback solution as well. By a small adjustment of decision logic to check the
    veracity of the output coming from the model’s prediction output, the cold-start
    values can be served in place of the problematic data.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 无论使用何种方法，都要确保有东西可以实施。毕竟，另一种选择是返回没有数据。这对于需要从 API 生成数据以填充界面元素的面向客户的应用程序来说，根本不是一种选择。拥有冷启动替代解决方案的好处是它可以作为一个后备解决方案。通过微调决策逻辑以检查模型预测输出结果的准确性，可以提供冷启动值来替代有问题的数据。
- en: It can be tempting to build something complex for this cold-start default value
    service, but complexity should be avoided here. The goal is to build something
    that is exceptionally fast (low SLA), simple to adjust and maintain, and relevant
    enough so as not to bring attention to the end user that something was not designed
    correctly.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个冷启动默认值服务，可能会诱使人们构建一个复杂的东西，但在这里应该避免复杂性。目标是构建一个特别快（低 SLA）、易于调整和维护，并且足够相关，以至于不会引起最终用户注意某些东西设计不正确。
- en: Cold-start solutions don’t apply exclusively to recommendation systems. Anytime
    a model is issuing predictions, particularly those with a low-SLA response requirement,
    some sort of value should be produced that is at least somewhat relevant to the
    task at hand (relevant as defined and designed by the business unit and SMEs,
    not by the DS team).
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 冷启动解决方案不仅适用于推荐系统。任何时候模型发布预测，尤其是那些具有低 SLA 响应要求的预测，都应该产生至少与当前任务多少有些相关的价值（由业务部门和
    SMEs 定义和设计的相关性，而不是由 DS 团队定义）。
- en: Failing to generate a value can, particularly for real-time use cases, break
    downstream systems that ingest that data. Failing to have a relevancy-dependent
    fallback for many systems can cause them to throw exceptions, retry excessively,
    or resort to system-protecting default values that a backend or frontend developer
    puts in place. That’s a situation that neither the engineering department nor
    the end user wants to see.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 对于实时用例，未能生成价值可能会破坏下游系统，这些系统会消费这些数据。对于许多系统，未能有相关性依赖的后备方案可能会导致它们抛出异常、过度重试，或者求助于后端或前端开发者设置的系统保护默认值。这是工程部门和最终用户都不希望看到的情况。
- en: 15.3 End user vs. internal use testing
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 15.3 最终用户测试与内部使用测试
- en: Releasing a project to production once the end-to-end functionality is confirmed
    to be working is incredibly tempting. After so much work, effort, and metrics-based
    quantitative quality checks, it’s only natural to assume that the solution is
    ready to be sent out into the world for use. Resisting this urge to sprint the
    last mile to release is difficult, although it is absolutely critical.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦确认端到端功能正常，就发布项目到生产环境是非常诱人的。经过如此多的工作、努力和基于指标的定量质量检查，自然而然地认为解决方案已经准备好进入世界使用。抵制这种冲刺最后一英里的冲动是困难的，尽管这是绝对关键的。
- en: 'The primary reasons it’s so ill-advised to simply release a project based solely
    on the internal evaluations of the DS team, as we covered in part 1, are as follows:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们在第1部分中所述，以下是一些主要原因，说明仅基于 DS 团队的内部评估发布项目是多么不明智：
- en: The DS team members are biased. This is their baby. No one wants to admit to
    having created an ugly baby.
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DS 团队成员存在偏见。这是他们的“孩子”。没有人愿意承认自己创造了一个丑陋的“孩子”。
- en: Quantitative metrics do not always guarantee qualitative traits.
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定量指标并不总是保证定性特征。
- en: The most important influence over quality predictions may be data that is not
    collected.
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对质量预测最重要的可能是不收集的数据。
- en: These reasons harken back to the concept of correlation not implying causality,
    as well as creator bias. While the model’s validation and quantitative metrics
    may perform remarkably well, precious few projects will have all of the causal
    factors captured within a feature vector.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 这些原因让人联想到相关性不意味着因果关系的概念，以及创造者偏见。虽然模型的验证和定量指标可能表现得非常好，但很少有几个项目能够将所有因果因素都捕捉在特征向量中。
- en: What a thorough testing or QA process can help us do is assign a qualitative
    assessment of our solution. We can accomplish this in multiple ways.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 详尽的测试或质量保证（QA）流程可以帮助我们对我们的解决方案进行定性评估。我们可以通过多种方式实现这一点。
- en: Let’s imagine that we work at a music streaming service. We have an initiative
    to increase customer engagement by way of providing highly relevant song choices
    to follow along after a queued listening session.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们设想我们正在一家音乐流媒体服务公司工作。我们有一个通过在排队收听会话后提供高度相关的歌曲选择来增加客户参与度的倡议。
- en: Instead of using a collaborative filtering approach that would find similar
    songs listened to by other users, we want to find songs that are similar based
    on how the human ear would interpret a song. We use a Fourier transformation of
    the audio file to get a frequency distribution and then map that distribution
    to a mel scale (a linear cosine transformation of the log power spectrum of an
    audio signal that closely approximates how the human ear perceives sound). With
    this transformation of the data and a plot, we arrive at a visual representation
    of the characteristics of each song. We then, in an offline manner, calculate
    similarities of all songs to all other songs through the use of a tuned tri-branch
    Siamese Network. The feature vector that comes out of this system, augmented by
    additional tagged features to each song, is used to calculate both a Euclidean
    and a Cosine distance from one song to another. We save these relationships among
    all songs in a NoSQL database that tracks the 1,000 most similar songs to all
    others for our serving layer.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不想使用一种协作过滤方法，该方法会找到其他用户听过的类似歌曲，而是想根据人类耳朵如何解释一首歌来找到类似的歌曲。我们使用音频文件的四次变换来获取频率分布，然后将该分布映射到梅尔尺度（音频信号的对数功率谱的线性余弦变换，这接近于人类耳朵对声音的感知）。通过这种数据变换和绘图，我们得到了每首歌曲特性的视觉表示。然后，我们通过使用调整过的三分支Siamese网络，以离线方式计算所有歌曲与所有其他歌曲的相似性。从这个系统中出来的特征向量，通过为每首歌曲添加额外的标签特征来增强，用于计算一首歌曲到另一首歌曲的欧几里得距离和余弦距离。我们将所有歌曲之间的关系保存在一个NoSQL数据库中，该数据库跟踪了与所有其他歌曲最相似的1000首歌曲，用于我们的服务层。
- en: For illustration, figure 15.8 is essentially what the team is feeding into the
    Siamese network, mel visualizations of each song. These distance metrics have
    internal “knobs” that the DS team can use to adjust the final output collections.
    This feature was discovered early in testing when internal SME members expressed
    a desire to refine filters of similar music within a genre to eras of music.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明，图15.8基本上是团队输入到Siamese网络中的内容，每首歌曲的梅尔可视化。这些距离度量有内部“旋钮”，DS团队可以使用这些旋钮来调整最终的输出集合。这个特性在测试早期被发现，当时内部SME成员表达了希望细化音乐流派中类似音乐的过滤器的愿望，以适应音乐的时代。
- en: '![15-08](../Images/15-08.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![15-08](../Images/15-08.png)'
- en: Figure 15.8 Music file transformation to a mel spectrogram for use in Siamese
    CNN network
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.8 音乐文件转换为用于Siamese CNN网络的梅尔频谱图
- en: Now that we can see what is going on here (and the sort of information the CNN
    would be creating from an encoded feature), we can delve into how to test this
    service. Figure 15.9 shows an overview of the testing.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经可以看到这里的情况（以及CNN从编码特征中创建的信息类型），我们可以深入探讨如何测试这项服务。图15.9展示了测试的概述。
- en: Figure 15.9 compares three separate forms of preproduction QA work that can
    be done to make qualitative assessments on our service. The next three subsections
    cover each of these elements—internal biased testing, dogfooding (consuming the
    product of our own efforts), and thorough SME review—to show the benefits of the
    holistic SME evaluation approach over the others.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.9比较了三种可以在我们的服务上进行定性评估的预生产QA工作形式。接下来的三个小节涵盖了这些元素——内部偏向性测试、尝鲜（消费我们自己的产品）、详尽的小型专家（SME）审查——以展示整体SME评估方法相对于其他方法的优点。
- en: '![15-09](../Images/15-09.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![15-09](../Images/15-09.png)'
- en: Figure 15.9 Different qualitative testing strategies. The one at the top is
    pretty bad as a practice.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.9 不同的定性测试策略。顶部的策略作为实践来说相当糟糕。
- en: The end goal of performing QA on ML projects, after all, is to evaluate predictions
    on real-world data that doesn’t rely on the highly myopic perspective of the solution’s
    creators. The objective is to eliminate as much bias as possible from the qualitative
    assessment of a solution’s utility.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 最终，对机器学习项目进行QA的目标是评估基于现实世界数据的预测，这些数据不依赖于解决方案创造者的高度短视视角。目标是尽可能消除对解决方案效用定性评估中的偏见。
- en: 15.3.1 Biased testing
  id: totrans-141
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.3.1 偏向性测试
- en: 'Internal testing is easy—well, easier than the alternatives. It’s painless
    (if the model works properly). It’s what we typically think of when we’re qualifying
    the results of a project. The process typically involves the following:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 内部测试很容易——好吧，比替代方案更容易。如果模型工作正常，那么这个过程是无痛的。这是我们通常在认证项目结果时所想到的。这个过程通常涉及以下步骤：
- en: Generating predictions on new (unseen to the modeling process) data
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在新（对建模过程来说是未知的）数据上生成预测
- en: Analyzing the distribution and statistical properties of the new predictions
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析新预测的分布和统计特性
- en: Taking random samples of predictions and making qualitative judgments of them
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对预测进行随机抽样并对其做出定性判断
- en: Running handcrafted sample data (or their own accounts, if applicable) through
    the model
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将手工制作的样本数据（或适用的个人账户）通过模型运行
- en: The first two elements in this list are valid for qualification of model effectiveness.
    They are wholly void of bias and should be done. The latter two, on the other
    hand, are *dangerous*. The final one is the more dangerous of them.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 列表中的前两个元素适用于模型有效性的资格认证。它们完全无偏见，应该执行。另一方面，后两个则是有害的。其中最后一个更危险。
- en: 'In our music playlist generator system scenario, let’s say that the DS team
    members are all fans of classical music. Throughout their qualitative verifications,
    they’ve been checking to see the relative quality of the playlist generator for
    the field of music that they are most familiar with: classical music. To perform
    these validations, they’ve been generating listening history of their favorite
    pieces, adjusting the implementation to fine-tune the results, and iterating on
    the validation process.'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的音乐播放列表生成系统场景中，假设DS团队成员都是古典音乐的粉丝。在整个定性验证过程中，他们一直在检查他们最熟悉的音乐领域——古典音乐的播放列表生成器的相对质量。为了进行这些验证，他们一直在生成他们最喜欢的作品的收听历史，调整实现来微调结果，并在验证过程中迭代。
- en: When they are fully satisfied that the solution works well at identifying a
    nearly uncanny level of sophistication for capturing thematic and tonally relevant
    similar pieces of music, they ask a colleague what they think. The results for
    both the DS team (Ben and Julie) as well as for their data warehouse engineer
    friend Connor are shown in figure 15.10.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 当他们完全满意解决方案在识别具有高度复杂性的主题和调性相关相似音乐片段方面表现良好时，他们会询问同事的看法。DS团队（本和朱莉）以及他们的数据仓库工程师朋友康纳的结果如图15.10所示。
- en: '![15-10](../Images/15-10.png)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![15-10](../Images/15-10.png)'
- en: Figure 15.10 Biased feedback in qualitative assessment of model efficacy
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.10 模型效能在定性评估中的偏差反馈
- en: What ends up happening is a bias-based optimization of the solution that caters
    to the DS team’s own preferences and knowledge of a genre of music. While perfectly
    tuned for the discerning tastes of a classical music fan, the solution is woefully
    poor for someone who is a fan of modern alternative rock, such as Connor. His
    feedback would have been dramatically different from the team’s own adjudication
    of their solution’s quality. To fix the implementation, Ben and Julie would likely
    have to make a lot of adjustments, pulling in additional features to further refine
    Connor’s tastes in alt-rock music. What about all of the other hundreds of genres
    of music, though?
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是，基于偏差的解决方案优化，以满足DS团队自己对该音乐类型的偏好和知识。虽然对于古典音乐爱好者的挑剔品味来说，解决方案调得恰到好处，但对于像康纳这样的现代另类摇滚乐迷来说，解决方案则非常糟糕。他的反馈将与团队对自己解决方案质量的判断大相径庭。为了修复实现，本和朱莉可能需要做出很多调整，引入额外的功能来进一步细化康纳对另类摇滚音乐的品味。那么，其他数百种音乐类型又如何呢？
- en: While this example is particularly challenging (musical tastes are exceptionally
    varied and highly specific to individuals), this exact problem of internal-team
    bias can exist for any ML project. Any DS team will have only a limited view of
    the nuances in the data. A detailed understanding of the complex latent relationships
    of the data and how each relates to the business is generally not knowable by
    the DS team. This is why it is so critical to involve in the QA process those
    in the company who know most about the use case that the project is solving.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这个例子特别具有挑战性（音乐品味极为多样且高度个性化），但任何ML项目都可能存在这种内部团队偏差的问题。任何DS团队都将只能有限地了解数据的细微差别。对数据的复杂潜在关系以及每个如何与业务相关的详细了解通常不是DS团队所知的。这就是为什么让那些对公司中解决项目用例最了解的人参与QA过程是如此关键。
- en: 15.3.2 Dogfooding
  id: totrans-154
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.3.2 试用
- en: A far more thorough approach than Ben and Julie’s first attempt would have been
    to canvass people at the company. Instead of keeping the evaluation internal to
    the team, where a limited exposure to genres hampers their ability to qualitatively
    measure the effectiveness of the project, they could ask for help. They could
    ask around and see if people at the company might be interested in taking a look
    at how their own accounts and usage would be impacted by the changes the DS team
    is introducing. Figure 15.11 illustrates how this could work for this scenario.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 比Ben和Julie的第一次尝试要更彻底的方法是向公司的人进行调查。而不是将评估限制在团队内部，因为有限的接触类型阻碍了他们从质量上衡量项目有效性的能力，他们可以寻求帮助。他们可以四处询问，看看公司的人是否可能对查看他们自己的账户和受DS团队引入的变更影响的用法感兴趣。图15.11说明了这种情况是如何工作的。
- en: '![15-11](../Images/15-11.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![15-11](../Images/15-11.png)'
- en: Figure 15.11 Dogfooding a project by utilizing volunteers to give subjective
    feedback as a user
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.11 通过利用志愿者提供主观反馈作为用户来尝鲜一个项目
- en: '*Dogfooding*, in the broadest sense, is consuming the results of your own product.
    The term refers to opening up functionality that is being developed so that everyone
    at a company can use it, find out how to break it, provide feedback on how it’s
    broken, and collectively work toward building a better product. All of this happens
    across a broad range of perspectives, drawing on the experience and knowledge
    of many employees from all departments.'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在最广泛的意义上，“尝鲜”是指消费你自己的产品结果。这个术语指的是开放正在开发的功能，以便公司中的每个人都可以使用它，找出如何破坏它，提供关于它如何被破坏的反馈，并共同努力打造更好的产品。所有这些都在广泛的视角中发生，借鉴了来自所有部门的许多员工的经验和知识。
- en: However, as you can see in figure 15.11, the evaluation still contains bias.
    An internal user who uses the company’s product is likely not a typical user.
    Depending on their job function, they may be using their account to validate functionality
    in the product, use it for demonstrations, or simply interact with the product
    more because of an employee benefit associated with it.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如图15.11所示，评估仍然包含偏见。使用公司产品的内部用户可能不是典型用户。根据他们的工作职能，他们可能在使用他们的账户来验证产品中的功能，用它进行演示，或者仅仅因为与员工福利相关的它而更多地与产品互动。
- en: In addition to the potentially spurious information contained within the listen
    history of employees, the other form of bias is that people like what they like.
    They also don’t like what they don’t like. Subjective responses to something as
    emotionally charged as music preferences add an incredible amount of bias due
    to the nature of being a member of the human race. Knowing that these predictions
    are based on their listening history and that it is their own company’s product,
    internal users evaluating their own profiles will generally be more critical than
    a typical user if they find something that they don’t like (which is a stark contrast
    to the builder bias that the DS team would experience).
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 除了员工收听历史中可能包含的虚假信息之外，另一种形式的偏见是人们喜欢他们喜欢的东西。他们也不喜欢他们不喜欢的东西。对像音乐偏好这样情绪化的东西的主观反应，由于人类成员的本质，会添加大量的偏见。知道这些预测是基于他们的收听历史，并且是他们自己公司的产品，内部用户评估自己的个人资料时，如果他们发现不喜欢的东西（这与DS团队会遇到的构建者偏见形成鲜明对比），通常会比典型用户更加苛刻。
- en: While dogfooding is certainly preferable to evaluating a solution’s quality
    within the confines of the DS team, it’s still not ideal, mostly because of these
    inherent biases that exist.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管尝鲜当然比在DS团队的限制内评估解决方案的质量要好，但这仍然不是理想的，主要是因为这些固有的偏见存在。
- en: 15.3.3 SME evaluation
  id: totrans-162
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.3.3 主题专家（SME）评估
- en: The most thorough QA testing you can conduct while still staying within the
    confines of your own company leverages SMEs in the business. This is one of the
    most important reasons to keep SMEs within the business engaged in a project.
    They will not only know who in the company has the deepest knowledge and experience
    with facets of the project (in this case, genres of music), but they can help
    muster those resources to assist.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 在保持在公司内部的前提下，你可以进行的最彻底的QA测试是利用业务中的主题专家（SMEs）。这是保持业务中的SMEs参与项目最重要的原因之一。他们不仅会知道公司中谁对项目的某个方面（在这种情况下，是音乐类型）有最深入的知识和经验，而且他们可以帮助调动这些资源来协助。
- en: For the SME evaluation, we can stage this phase of QA beforehand, requesting
    resources who are experts in each of the music genres for which we need an unbiased
    opinion regarding the quality of generated song lists. By having experts designated,
    we can feed them not only their own recommendations, but also those of randomly
    sampled users. With their deep knowledge of the nuances of each genre, they can
    evaluate the recommendations of others to determine if the playlists that are
    being generated make tonal and thematic sense. Figure 15.12 illustrates this process.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 对于SME评估，我们可以在QA阶段之前安排这一阶段，请求那些对我们需要提供关于生成歌单质量公正意见的音乐流派专家资源。通过指定专家，我们可以不仅向他们提供自己的推荐，还可以提供随机抽样用户的推荐。凭借他们对每个流派细微之处的深入了解，他们可以评估他人的推荐，以确定生成的播放列表是否在音调和主题上合理。图15.12展示了这一过程。
- en: '![15-12](../Images/15-12.png)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![15-12](../Images/15-12.png)'
- en: Figure 15.12 Unbiased SME evaluation of a project’s implementation
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.12 项目实施的公正SME评估
- en: With the far more thorough adjudication in place, the usefulness of the feedback
    is significantly higher than any other methodology We can minimize bias while
    also incorporating the deep knowledge of experts into actionable changes that
    can be iterated over.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 在实施更为彻底的裁决后，反馈的有用性显著高于任何其他方法。我们可以在最小化偏见的同时，将专家的深入知识融入可迭代的可操作变化中。
- en: While this scenario focuses on music recommendations, it can apply to nearly
    any ML project. It’s best to keep in mind that before you start to tackle whichever
    project you’re working on, some human (or many humans) had been solving that problem
    in some way before you were called in to work on it. They’re going to understand
    the details of the subject in far more depth than anyone on the DS team will.
    You may as well try to make the best solution that you can by leveraging their
    knowledge and wisdom.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这个场景关注的是音乐推荐，但它几乎可以应用于任何机器学习项目。最好记住，在你开始着手解决你正在工作的任何项目之前，一些人类（或许多人类）已经在以某种方式解决这个问题了。他们将比DS团队中的任何人都更深入地了解主题的细节。你不妨利用他们的知识和智慧，尽力提供最佳的解决方案。
- en: 15.4 Model interpretability
  id: totrans-169
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 15.4 模型可解释性
- en: Let’s suppose that we’re working on a problem designed to control forest fires.
    The organization that we work for can stage equipment, personnel, and services
    to locations within a large national park system in order to mitigate the chances
    of wildfires growing out of control. To make logistics effectiveness as efficient
    as possible, we’ve been tasked with building a solution that can identify risks
    of fire outbreaks by grid coordinates. We have several years of data, sensor data
    from each location, and a history of fire-burn area for each grid position.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们正在解决一个旨在控制森林火灾的问题。我们工作的组织可以调动设备、人员和资源到大型国家公园系统内的各个位置，以减轻野火失控的可能性。为了使物流效率尽可能高效，我们被要求构建一个可以通过网格坐标识别火灾爆发风险的解决方案。我们拥有多年的数据，每个位置的传感器数据，以及每个网格位置的火灾燃烧历史。
- en: After building the model and providing the predictions as a service to the logistics
    team, questions arise about the model’s predictions. The logistics team members
    notice that certain predictions don’t align with their tribal knowledge of having
    dealt with fire seasons, voicing concerns about addressing predicted calamities
    with the feature data that they’re exposed to.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在构建模型并向物流团队提供预测服务之后，关于模型预测的问题开始出现。物流团队成员注意到某些预测与他们对火灾季节的经验性知识不符，他们表达了对使用他们接触到的特征数据应对预测灾难的担忧。
- en: They’ve begun to doubt the solution. They’re asking questions. They’re convinced
    that something strange is going on and they’d like to know why their services
    and personnel are being told to cover a grid coordinate in a month that, as far
    as they can remember, has never had a fire break out.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 他们开始怀疑这个解决方案。他们提出了问题。他们确信有些奇怪的事情正在发生，并且他们想知道为什么他们的服务和人员被告知要在一个月内覆盖一个网格坐标，而这个坐标，据他们所记，从未发生过火灾。
- en: How can we tackle this situation? How can we run simulations of our feature
    vector for the prediction through our model and tell them conclusively why the
    model predicted what it did? Specifically, how can we implement explainable artificial
    intelligence (XAI) on our model with the minimum amount of effort?
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 我们如何应对这种情况？我们如何运行我们的特征向量预测的模拟，并通过我们的模型向他们明确说明模型为什么做出这样的预测？具体来说，我们如何以最少的努力在我们的模型上实施可解释的人工智能（XAI）？
- en: When planning out a project, particularly for a business-critical use case,
    a frequently overlooked aspect is to think about model explainability. Some industries
    and companies are the exception to this rule, because of either legal requirements
    or corporate policies, but for most groups that I’ve interacted with, interpretability
    is an afterthought.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 在规划项目时，尤其是对于业务关键用例，一个经常被忽视的方面是考虑模型的可解释性。一些行业和公司是这一规则的例外，这可能是由于法律要求或公司政策，但与我互动的大多数团队来说，可解释性是一个事后考虑的问题。
- en: I understand the reticence that most teams have in considering tacking on XAI
    functionality to a project. During the course of EDA, model tuning, and QA validation,
    the DS team generally understands the behavior of the model quite well. Implementing
    XAI may seem redundant.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 我理解大多数团队在考虑将 XAI 功能添加到项目中时的犹豫。在 EDA（探索性数据分析）、模型调整和 QA 验证过程中，DS 团队通常对模型的行为有相当的了解。实现
    XAI 可能看起来是多余的。
- en: By the time you need to explain how or why a model predicted what it did, you’re
    generally in a panic situation that is already time-constrained. Through implementing
    XAI processes through straightforward open source packages, this panicked and
    chaotic scramble to explain functionality of a solution can be avoided.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 当你需要解释模型如何或为什么做出这样的预测时，你通常已经处于一个紧张的情况，时间已经受限。通过实现 XAI 流程的简单开源包，可以避免这种紧张和混乱的解释解决方案功能。
- en: 15.4.1 Shapley additive explanations
  id: totrans-177
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.4.1 Shapley 加性解释
- en: One of the more well-known and thoroughly proven XAI implementations for Python
    is the `shap` package, written and maintained by Scott Lundberg. This implementation
    is fully documented in detail in the 2017 NeurIPS paper “A Unified Approach to
    Interpreting Model Predictions” by Lundberg and Su-In Lee.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 Python 而言，较为知名且经过充分验证的 XAI（可解释人工智能）实现之一是 Scott Lundberg 编写和维护的 `shap` 包。这个实现详细记录在
    2017 年 NeurIPS 论文“一种统一的方法来解释模型预测”中，由 Lundberg 和 Su-In Lee 撰写。
- en: At the core of the algorithm is game theory. Essentially, when we’re thinking
    of features that go into a training dataset, what is the effect on the model’s
    predictions for each feature? As with players in a team sport, if a match is the
    model itself and the features involved in training are the players, what is the
    effect on the match if one player is substituted for another? How one player’s
    influence changes the outcome of the game is the basic question that `shap` is
    attempting to answer.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 算法的核心是博弈论。本质上，当我们考虑要进入训练数据集的特征时，每个特征对模型预测的影响是什么？就像团队运动中的球员一样，如果比赛是模型本身，而参与训练的特征是球员，那么如果一个球员被另一个球员替换，这对比赛有什么影响？一个球员的影响力如何改变比赛的结果是
    `shap` 尝试回答的基本问题。
- en: Foundation
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 基础
- en: The principle behind `shap` involves estimating the contribution of each feature
    from the training dataset upon the model. According to the original paper, calculating
    the true contribution (the exact Shapley value) requires evaluating all permutations
    for each row of the dataset for inclusion and exclusion of the source row’s feature,
    creating different coalitions of feature groupings.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '`shap` 原理背后的思想是估计训练数据集中每个特征对模型贡献的大小。根据原始论文，计算真实贡献（即精确的 Shapley 值）需要评估数据集中每一行的所有排列，包括和排除源行特征的排列，创建不同的特征分组联盟。'
- en: 'For instance, if we have three features (a, b, and c; original features denoted
    with [i]), with replacement features from the dataset denoted as [j](for example,
    a[j]) the coalitions to test for evaluating feature b are as follows:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果我们有三个特征（a、b 和 c；原始特征用 [i] 表示），用数据集中的替换特征 [j]（例如，a[j]）表示，那么评估特征 b 的测试联盟如下：
- en: (a[i], b[i], c[j]), (a[i], b[j], c[j]), (a[i], b[j], c[i]), (a[j], b[i], c[j]),
    (a[j], b[j], c[i])
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: (a[i], b[i], c[j]), (a[i], b[j], c[j]), (a[i], b[j], c[i]), (a[j], b[i], c[j]),
    (a[j], b[j], c[i])
- en: These coalitions of features are run through the model to retrieve a prediction.
    The resulting prediction is then differenced from the original row’s prediction
    (and an absolute value taken of the difference). This process is repeated for
    each feature, resulting in a feature-value contribution score when a weighted
    average is applied to each delta grouping per feature.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 这些特征联盟通过模型运行以获取预测。然后，将得到的预测与原始行的预测（以及差异的绝对值）进行差分。这个过程对每个特征重复进行，当对每个特征的每个差分组应用加权平均时，结果得到一个特征值贡献分数。
- en: 'It should come as no surprise that this isn’t a very scalable solution. As
    the feature count increases and the training dataset’s row count increases, the
    computational complexity of this approach quickly becomes untenable. Thankfully,
    another solution is far more scalable: the approximate Shapley estimation.'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 毫不奇怪，这不是一个非常可扩展的解决方案。随着特征数量的增加和训练数据集行数的增加，这种方法计算复杂性的快速增加变得难以承受。幸运的是，另一个解决方案的扩展性要远好：近似Shapley估计。
- en: Approximate Shapley value estimation
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 近似Shapley值估计
- en: To scale the additive effects of features across a large feature set, a slightly
    different approach is performed. The Python package `shap` utilizes this approximate
    implementation to get reasonable values across all rows and features without having
    to resort to the brute-force approach in the original paper. Figure 15.13 illustrates
    the process of this approximated approach.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在大特征集中缩放特征的加性效应，采用了一种略有不同的方法。Python包`shap`利用这种近似实现来获取所有行和特征上的合理值，而无需求助于原始论文中的暴力方法。图15.13说明了这种近似方法的过程。
- en: '![15-13](../Images/15-13.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![15-13](../Images/15-13.png)'
- en: Figure 15.13 Approximate kernel Shapley values implementation in shap
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.13 shap中近似核Shapley值实现的实现
- en: The primary differentiator here as compared to the exhaustive search approach
    is in the limited number of tests conducted and the method of building coalitions.
    As opposed to the original design, a single row’s feature vector is not used to
    generate a baseline prediction. Instead, a random sampling of rows is conducted,
    and the feature under test is swapped out with other values from the selected
    subset for that feature. These new synthetic vectors are then passed to the model,
    generating a prediction. For each of these synthetic predictions, an absolute
    difference is calculated, then averaged, giving the reference vector’s feature
    contribution value across these coalitions. The weighting factor that is applied
    to averaging these values depends on the number of “modified” (replaced) features
    in the individual synthetic vector. For rows where more of the features are swapped
    out, a higher weight of importance is placed on these as compared to those with
    fewer mutations.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 与穷举搜索方法相比，这里的主要区别在于测试的数量有限和构建联盟的方法。与原始设计不同，单行特征向量不用于生成基线预测。相反，对行进行随机抽样，并将测试中的特征与其他选定子集的值进行交换。然后，将这些新的合成向量传递给模型，生成预测。对于这些合成预测中的每一个，都计算绝对差异，然后取平均值，给出参考向量在这些联盟中的特征贡献值。应用于这些值平均的加权因子取决于单个合成向量中“修改”（替换）的特征数量。对于特征交换较多的行，与特征交换较少的行相比，这些行的重要性权重更高。
- en: The final stage shown in figure 15.13 is in the overall per-feature contribution
    assessment. These feature-importance estimations are done by weighting each row’s
    feature contribution margin and scaling the results to a percentage contribution
    for the entire dataset. Both calculated data artifacts are available by using
    the Python `shap` package (a per-row contribution estimation and an aggregated
    measurement across the entire dataset) and can help in explaining not only a single
    row’s prediction but also in providing a holistic view of the feature influence
    to a trained model.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.13中显示的最后阶段是在整体每个特征的贡献评估中。这些特征重要性估计是通过加权每行的特征贡献边际并按百分比贡献对整个数据集进行缩放来完成的。这两种计算数据伪影都可以通过使用Python
    `shap`包（每行的贡献估计和整个数据集的聚合测量）获得，并且可以帮助解释不仅是一行的预测，还可以提供对训练模型中特征影响的整体视图。
- en: What we can do with these values
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以用这些值做什么
- en: 'Simply calculating Shapley values doesn’t do much for a DS team. The utility
    of having an XAI solution based on this package is in what questions these analyses
    enable answering. Some of the questions that you’ll be able to answer after calculating
    these values are as follows:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 简单地计算Shapley值对数据科学团队来说帮助不大。基于这个包的XAI解决方案的效用在于这些分析能够回答哪些问题。在计算这些值之后，你将能够回答以下一些问题：
- en: “Why did the model predict this strange result?” (single-event explanation)
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: “为什么模型预测了这个奇怪的结果？”（单事件解释）
- en: “Will these additional features generate different performance?” (feature-engineering
    validation)
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: “这些额外的特征会产生不同的性能吗？”（特征工程验证）
- en: “How do ranges of our features affect the model predictions?” (general model
    functionality explanation)
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: “我们的特征范围如何影响模型预测？”（一般模型功能解释）
- en: The `shap` package can be used not only as an aid to solution development and
    maintenance, but also to help to provide data-based explanations to business unit
    members and SMEs. By shifting a discussion on the functionality of a solution
    away from the tools that the DS team generally uses (correlation analyses, dependence
    plots, analysis of variance, and so forth), a more productive discussion can be
    had. This package, and the approach therein, remove the burden from the ML team
    of having to explain esoteric techniques and tools, focusing instead on discussing
    the functionality of a solution in terms of the data that the company generates.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: '`shap`包不仅可以作为解决方案开发和维护的辅助工具，还可以帮助向业务单元成员和专家提供基于数据的解释。通过将关于解决方案功能的讨论从DS团队通常使用的工具（相关性分析、依赖图、方差分析等）转移到数据上，可以开展更有成效的讨论。这个包以及其中的方法，减轻了ML团队解释晦涩的技术和工具的负担，转而专注于讨论解决方案的功能，即公司生成的数据。'
- en: 15.4.2 Using shap
  id: totrans-198
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 15.4.2 使用shap
- en: To illustrate how we can use this technique for our problem of predicting forest
    fires, let’s assume that we have a model already built.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明我们如何使用这种技术来预测森林火灾的问题，让我们假设我们已经构建了一个模型。
- en: NOTE To follow along and see the model construction, tuning with the Optuna
    package (a more modern version of the previously mentioned Hyperopt from part
    2), and the full implementation of this example, please see the companion GitHub
    repository for this book. The code is within the Chapter 15 directory.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：要跟随示例并查看模型构建、使用Optuna包（第2部分中提到的Hyperopt的现代版本）进行调优以及此示例的完整实现，请参阅本书的配套GitHub存储库。代码位于第15章目录中。
- en: With a preconstructed model available, let’s leverage the `shap` package to
    determine the effects of features within our training data to assist in answering
    the questions that the business is asking about why the model is behaving a particular
    way. The following listing shows a series of classes that aids in generating the
    explanation plots (refer to the repository for `import` statements and the remainder
    of the code, which is too lengthy to print here).
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 在可用的预构建模型的基础上，让我们利用`shap`包来确定训练数据中各个特征的影响，以帮助回答业务提出的关于模型为何以特定方式表现的问题。以下列表展示了一系列辅助生成解释图的类（请参考存储库中的`import`语句和代码的其余部分，这部分代码太长，无法在此打印）。
- en: Listing 15.1 shap interface
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.1 shap接口
- en: '[PRE0]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: ❶ Image-handling class to handle resizing of the plots and storing of the different
    formats
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 图像处理类，用于处理图表的调整大小和存储不同格式
- en: ❷ Gets a reference to the current plot figure for resizing
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 获取当前图表图标的引用以调整大小
- en: ❸ Since this plot is generated in JavaScript, we have to save it as HTML.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 由于此图是用JavaScript生成的，我们必须将其保存为HTML。
- en: ❹ Unification of the required attributes coming from the shap Explainer to enable
    handling of all the plots’ requirements
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 统一来自shap Explainer的所需属性，以处理所有图表的要求
- en: ❺ Method called during class instantiation to generate the shap values based
    on the model passed in and the data provided for evaluation of the model’s functionality
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 在类实例化期间调用的方法，根据传入的模型和提供的数据生成shap值，以评估模型的功能
- en: ❻ Generates a single row’s waterfall plot to explain the impact of each feature
    to the row’s target value (composition analysis)
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: ❻ 生成单行的水波图，以解释每个特征对行目标值的影响（组成分析）
- en: ❼ Generates the full shap summary of each feature across the entire passed-in
    dataset
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: ❼ 生成整个传入数据集中每个特征的完整shap摘要
- en: ❽ Generates a single row’s force plot to illustrate the cumulative effect of
    each feature on its target value
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: ❽ 生成单行力的图表，以展示每个特征对其目标值的累积影响
- en: ❾ Generates the entire dataset’s combined force plots into a single displayed
    visualization
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: ❾ 将整个数据集的合并力图生成单个显示的可视化
- en: ❿ Creates the debugging plot for the estimated shap importance of each feature
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: ❿ 创建每个特征的估计shap重要性的调试图
- en: ⓫ Generates a scatter plot of a single feature against its shap values, colored
    by the feature in the remaining positions of the vector with the highest covariance
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: ⓫ 生成单个特征与其shap值之间的散点图，颜色由向量中剩余位置的最高协方差特征决定
- en: With our class defined, we can begin to answer the questions from the business
    about why the model has been predicting the values that it has. We can step away
    from the realm of conjecture that would be the best-effort attempt at explanation
    through the use of presenting correlation effects. Instead of wasting our time
    (and the business’s) with extremely time-consuming and likely confusing presentations
    of what our EDA showed at the outset of the project, we can focus on answering
    their questions.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 定义了我们的类别后，我们可以开始回答商家关于为什么模型预测了这些值的问题。我们可以摆脱通过展示相关性效应来解释的最好努力尝试的猜想领域，而不是浪费时间（和商家的）去进行耗时且可能令人困惑的演示，我们可以专注于回答他们的问题。
- en: As an added bonus, having this game-theory-based approach available to us during
    development could help inform which features could be improved upon and which
    could potentially be dropped. The information that can be gained from this algorithm
    is invaluable throughout the model’s entire life cycle.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 作为额外的奖励，在开发过程中拥有这种基于博弈论的方法可以帮助我们了解哪些特征可以改进，哪些可能被删除。从该算法中获得的信息在整个模型的生命周期中都是无价的。
- en: 'Before we look at what these methods in listing 15.1 would be producing when
    executed, let’s review what the business executives want to know. In order to
    be satisfied that the predictions coming from the model are logical, they want
    to know the following:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们查看列表 15.1 中这些方法执行时会产生什么结果之前，让我们回顾一下业务高管想知道的内容。为了确保模型输出的预测是合理的，他们想知道以下内容：
- en: What are the conditions that should cause us to panic if we see them?
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果我们看到以下条件，应该引起我们恐慌吗？
- en: Why doesn’t the amount of rain seem to affect the risk?
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为什么降雨量似乎不影响风险？
- en: To answer these two questions, let’s take a look at two of the plots that can
    be generated from within the `shap` package. Based on these plots, we should be
    able to see where the problematic predictions are coming from.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 为了回答这两个问题，让我们看看可以从 `shap` 包中生成的两个图表。基于这些图表，我们应该能够看到问题预测的来源。
- en: shap summary plot
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: shap 概要图
- en: To answer the question about the rain—as well as to provide an opportunity to
    understand which features are driving the predictions the most—the summary plot
    is the most comprehensive and utilitarian for this purpose. Because it combines
    all of the rows of the training data, it will do a per-row estimation of each
    feature’s impact when run through the replacement strategy that the algorithm
    performs. This holistic view of the entire training dataset can show the features’
    overall magnitude of impact within the scope of the problem. Figure 15.14 shows
    the summary plot.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 为了回答关于降雨的问题，以及提供了解哪些特征驱动预测最多的机会——概要图是为此目的最全面和实用的。因为它结合了所有训练数据的行，它将通过算法执行的替换策略对每个特征的冲击进行逐行估计。这种对整个训练数据集的整体视角可以显示特征在问题范围内的整体影响程度。图
    15.14 显示了概要图。
- en: '![15-14](../Images/15-14.png)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
  zh: '![15-14](../Images/15-14.png)'
- en: Figure 15.14 The shap summary plot, showing each feature’s substitution and
    prediction delta for each row
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.14 shap 概要图，显示每行的每个特征的替换和预测增量
- en: Armed with this plot, a great deal of discussion can be had with the business.
    Not only can you jointly explore why the rain amount values clearly aren’t making
    a difference in the model’s output (the plot shows that the feature isn’t even
    considered in the random forest model), but also how other aspects of the data
    are interpreted by the model.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有这个图表，可以与商家进行大量的讨论。不仅能够共同探讨为什么降雨量值在模型输出中明显没有产生影响（图表显示该特征甚至没有被随机森林模型考虑），还可以了解模型如何解释数据的其他方面。
- en: Note Make sure that you are very clear with the business on what `shap` is.
    It doesn’t bear a relationship to reality; rather, it simply indicates how the
    model interprets changes to a feature within a vector on its predictions. It is
    a measure of the *model* and not on the reality of what you’re trying to model.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：确保你向商家非常清楚地解释什么是 `shap`。它与现实无关；它只是简单地表明模型如何解释其预测中向量的特征变化。这是一个关于*模型*的度量，而不是你试图模拟的现实。
- en: The summary plot can begin the discussions about why the model is performing
    the way it is, what improvements might be made after identifying shortcomings
    identified by SMEs, and how to talk with the business about the model in terms
    that everyone can understand. Once the initial confusion is explained away regarding
    this tool, with the business fully understanding that the values shown are simply
    an estimation of how the model understands the features (and that they are not
    a reflection of the reality of the problem space you are predicting within), the
    conversations can become more fruitful.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 概述图可以开始讨论为什么模型会以这种方式表现，在识别了SMEs（行业专家）指出的不足之后，可能进行哪些改进，以及如何用大家都能理解的方式与业务讨论模型。一旦解释了这个工具的初始困惑，业务完全理解所显示的值只是模型理解特征的估计（并且它们不是你预测的问题空间现实情况的反映），对话就可以变得更加富有成效。
- en: It is, to be clear, *absolutely essential* to explain exactly what these values
    are before showing a single one of the visualizations that the tool is capable
    of generating. We’re not explaining the world; we’re explaining the model’s limited
    understanding of correlation effects based on the data we actually collect. There
    is simply nothing more or less to it.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 清楚地说，在展示工具能够生成的任何可视化之前，**绝对必要**的是解释这些值的确切含义。我们不是在解释世界；我们是在解释基于我们实际收集的数据，模型对相关效应的有限理解。其中并没有更多或更少的内容。
- en: With the general discussion complete with the business and the issue of rainfall
    tackled, we can move on to answering the next question.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 在与业务和降雨问题的一般讨论完成后，我们可以继续回答下一个问题。
- en: Waterfall plots
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 水位图
- en: We can answer the second question, arguably the most important for the business
    to be worried about, with a series of visualizations. When the business leaders
    asked when they should panic, what they really meant was that they wanted to know
    when the model would predict an emergency. They want to know which attributes
    of the features they should be looking at in order to warn their people on the
    ground that something bad might happen.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过一系列的可视化来回答第二个问题，这可能是企业最关心的问题。当业务领导问他们何时应该恐慌时，他们真正想了解的是模型何时会预测紧急情况。他们想知道他们应该关注哪些特征的属性，以便警告地面人员可能发生不好的事情。
- en: This is an admirable use of ML and something that I’ve seen many times in my
    career. Once a company’s business units move past the trough of distrust and into
    the realm of relying on predictions, the inevitable result is that the business
    wants to understand which aspects of their problem can be monitored and controlled
    in order to help minimize disaster or maximize beneficial results.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 这是对机器学习的一种可嘉的使用，我在我的职业生涯中见过很多次。一旦公司的业务单元走过了不信任的低谷，进入了依赖预测的领域，不可避免的结果就是企业想要了解他们的问题的哪些方面可以监控和控制，以帮助最小化灾难或最大化有利的结果。
- en: To enable this discovery, we can look at our prior data, select the worst-case
    scenario (or scenarios) from history, and plot the impact of each feature’s contribution
    to the predicted result. This contribution analysis for the most severe fire in
    history for this dataset is shown in figure 15.15.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 为了实现这一发现，我们可以查看我们之前的数据，从历史中选择最坏的情况（或情况），并绘制每个特征对预测结果的影响。这个数据集中历史上最严重的火灾的贡献分析如图15.15所示。
- en: '![15-15](../Images/15-15.png)'
  id: totrans-234
  prefs: []
  type: TYPE_IMG
  zh: '![15-15](../Images/15-15.png)'
- en: Figure 15.15 Waterfall plot of the most severe wildfire in history. The contribution
    margin of each feature can inform the business of what the model correlated to
    for high risk for fire.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.15 历史上最严重的野火的水位图。每个特征的贡献边际可以告知企业模型与哪些因素相关联，以预测高风险的火灾。
- en: While this plot is but a single data point, we can arrive at a more complete
    picture by analyzing the top *n* historical rows of data for the target. The next
    listing illustrates how simple this can be to generate with interfaces built around
    `shap`.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这个图表只是一个单一的数据点，但通过分析目标的历史数据的前* n*行，我们可以得到一个更完整的图景。接下来的列表展示了如何使用围绕`shap`构建的界面来简单地生成这些图表。
- en: Listing 15.2 Generating feature-contribution plots for the most extreme events
    in history
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 列表15.2 生成历史上最极端事件的特征贡献图
- en: '[PRE1]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: ❶ Instantiates the shap package’s handler to generate the shap values by passing
    in a trained model and the training data used to train it
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 通过传递训练好的模型和用于训练它的训练数据，实例化shap包的处理程序以生成shap值
- en: ❷ Extracts the five most severe area burn events in the training data to retrieve
    their row index values
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 从训练数据中提取五个最严重的区域烧伤事件，以检索它们的行索引值
- en: ❸ Generates the waterfall plots (as in figure 15.15) for each of the five most
    severe events
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 为五个最严重的五个事件生成瀑布图（如图15.15所示）
- en: Armed with these top event plots and the contributions of each feature to these
    events, the business can now identify patterns of behavior that they will want
    to explain to their analysts and observers in the field. With this knowledge,
    people can prepare and proactively take action long before a model’s prediction
    would ever make it to them.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有这些顶级事件图和每个特征对这些事件的贡献，企业现在可以识别他们希望向分析师和现场观察者解释的行为模式。有了这些知识，人们可以在模型预测之前就做好准备并主动采取行动。
- en: Using `shap` to help educate a team to take a beneficial series of actions based
    on a model’s inference of data is one of the most powerful aspects of this tool.
    It can help leverage the model in a way that is otherwise difficult to utilize.
    It helps to bring a much more far-reaching benefit to a business (or society and
    the natural world in general) from a model than a prediction on its own could
    ever do.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`shap`帮助团队根据模型对数据的推断采取一系列有益的行动，这是该工具最强大的功能之一。它可以帮助以其他方式难以利用的方式利用模型。它有助于从模型中获得比单独的预测更大的深远利益（对商业（或社会和自然界）而言）。
- en: A personal note on XAI
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 关于XAI的个人笔记
- en: 'Having explanations of how supervised (and unsupervised!) models arrive at
    their conclusions based on input features has helped me to craft more comprehensive
    solutions to problems. More than that, however, XAI enables me to conduct one
    of the most important tasks that a DS will ever engage in: winning the trust of
    the business.'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 解释基于输入特征的监督（和未监督！）模型如何得出结论，这帮助我制定了对问题的更全面解决方案。然而，XAI还使我能够执行DS将参与的最重要任务之一：赢得企业的信任。
- en: The building of trust and intrinsic faith in the ability of data to explain
    to and empower a business allows an organization to move more fully toward an
    objective and truly data-driven decision-making process. When evidence-based logic
    is used to guide a business, efficiency, revenue, and general employee well-being
    is increased. That, above all else, is reason to enable your business counterparts
    to take part in understanding the algorithms that you’re employing to help them
    along their journey.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 建立对数据解释和赋予企业能力的信任和内在信念，使组织能够更全面地向目标迈进，实现真正以数据驱动的决策过程。当基于证据的逻辑被用来引导企业时，效率、收入和员工的总体福祉都会提高。最重要的是，这为使您的业务同行参与理解您帮助他们前进的算法提供了理由。
- en: Many more plots and features are associated with this package, most of which
    are covered thoroughly in the companion notebook to this chapter within the repository.
    I encourage you to read through it and consider employing this methodology in
    your projects.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 与此包相关联的还有许多图表和功能，其中大部分在存储库中该章节的配套笔记本中得到了彻底的介绍。我鼓励您阅读它并考虑在您的项目中采用这种方法。
- en: Summary
  id: totrans-248
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Consistency in feature and inference data can be accomplished by using a rules-based
    validation feature store. Having a single source of truth can dramatically reduce
    confusion in interpretation of results, as well as enforcing quality-control checks
    on any data that is sent to a model.
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过使用基于规则的验证功能存储库，可以实现特征和推断数据的一致性。拥有单一的真实来源可以显著减少对结果解释的混淆，并确保对发送给模型的任何数据进行质量控制检查。
- en: Establishing fallback conditions for prediction failures due to a lack of data
    or a corrupted set of data for inference can ensure that consumers of the solution’s
    output will not see errors or service interruptions.
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 建立因数据不足或数据集损坏导致的预测失败的后备条件，可以确保解决方案的消费者不会看到错误或服务中断。
- en: Utilizing prediction-quality metrics is not enough to determine the efficacy
    of a solution. Validation of the prediction results by SMEs, test users, and cross-functional
    team members can provide subjective quality measurements to any ML solution.
  id: totrans-251
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 仅使用预测质量指标不足以确定解决方案的有效性。由领域专家、测试用户和跨职能团队成员对预测结果进行验证，可以为任何ML解决方案提供主观质量测量。
- en: Utilizing techniques such as `shap` can help to explain in a simple manner why
    a model made a particular decision and what influence particular feature values
    are having on the predictions from a model. These tools are critically important
    for production health of a solution, particularly during periodic retraining.
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用如`shap`等技术可以帮助以简单的方式解释模型为何做出特定的决策，以及特定特征值对模型预测的影响。这些工具对于解决方案的生产健康至关重要，尤其是在定期重新训练期间。
