- en: 13 Managing tools
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 13 管理工具
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Assessing the use of open source infrastructure modules and tools
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评估开源基础设施模块和工具的使用
- en: Applying techniques to update or migrate IaC tools
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应用技术来更新或迁移IaC工具
- en: Implementing module patterns for event-driven IaC
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实施事件驱动IaC的模块模式
- en: You’ve learned how to write infrastructure as code, update it with your team
    by using delivery pipelines and testing, and manage its security and cost within
    your organization. As you evolve your infrastructure system, you adapt these patterns
    and practices and adjust them to fit new workflows and use cases. Similarly, tools
    change but should not disrupt the patterns and practices to scale, collaborate,
    and operate your infrastructure.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经学会了如何编写基础设施代码，通过使用交付管道和测试与团队一起更新它，并在组织内部管理其安全和成本。随着您的基础设施系统的发展，您会适应这些模式和策略，并调整它们以适应新的工作流程和用例。同样，工具会发生变化，但不应破坏扩展、协作和操作基础设施的模式和策略。
- en: Updating your tool can require several actions. You could upgrade to a new version,
    replace it with a new tool, or handle more dynamic use cases for IaC. This chapter
    discusses common patterns and practices to handle updates to IaC tools.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 更新您的工具可能需要采取几个步骤。您可以选择升级到新版本，用新工具替换它，或者处理更动态的IaC用例。本章讨论了处理IaC工具更新的常见模式和策略。
- en: The patterns apply to any tools that cover *provisioning**, configuration management**,
    and image building* use cases. You’ll find they also apply to software development,
    although I adapted them in an opinionated way to infrastructure. Use these patterns
    and practices to mitigate the blast radius of an update, scale the new tool across
    teams, and continue evolving your system to support business requirements.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 这些模式适用于任何涵盖*提供**、**配置管理**和**镜像构建**用例的工具。您会发现它们也适用于软件开发，尽管我根据基础设施的观点对这些模式进行了调整。使用这些模式和策略来减轻更新的影响范围，跨团队扩展新工具，并继续发展您的系统以支持业务需求。
- en: Note This chapter does not include any code listings. Adding an example means
    introducing yet another tool. I describe the patterns and approaches at a higher
    level. You can apply the techniques to any tool that supports DSLs or programming
    languages.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：本章不包括任何代码列表。添加示例意味着引入另一个工具。我在更高层次上描述了模式和策略。您可以将这些技术应用于支持DSLs或编程语言的任何工具。
- en: You’ve read the many chapters in this book and practiced IaC in different industries
    and companies. You’ve built a reputation for setting up and scaling IaC practices.
    One day, a social media company offers you a role in its platform team.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经阅读了本书中的许多章节，并在不同行业和公司中实践了IaC。您在建立和扩展IaC实践方面建立了声誉。有一天，一家社交媒体公司向您提供了一个平台团队的角色。
- en: The company has already established its IaC practice for a few years now. The
    staff needs your help to maintain and keep the tools they use for IaC updated.
    You accept and get a backlog of projects to start on the very first day.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 该公司已经建立了其IaC实践几年了。员工需要您的帮助来维护和更新他们用于IaC的工具。您接受了这个提议，并在第一天就接到了一系列待办项目。
- en: 13.1 Using open source tools and modules
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.1 使用开源工具和模块
- en: The accessibility of version control and public repositories makes it simpler
    to search for an existing tool or infrastructure module instead of writing your
    own. You can go onto GitHub or any other service to find the automation and tooling
    to serve your needs. However, you need to make sure you do your due diligence
    before introducing new tooling to any organization.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 版本控制和公共仓库的易用性使得在编写自己的工具或基础设施模块时，搜索现有工具或模块变得更加简单。您可以去GitHub或其他任何服务上寻找满足您需求的自动化和工具。然而，在将新工具引入任何组织之前，您需要确保您已经做了充分的尽职调查。
- en: For example, let’s imagine the team members who maintain the social media’s
    feed functionality approach you. They searched online and found an infrastructure
    module to create a database. They want to use it. They hope to speed up their
    development process and avoid waiting for another team to review their database
    configuration. Why reinvent the wheel, after all?
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，让我们想象一下维护社交媒体的推送功能团队成员向您提出的情况。他们在网上搜索并找到了一个用于创建数据库的基础设施模块。他们希望使用它。他们希望加快他们的开发过程，避免等待另一个团队审查他们的数据库配置。毕竟，为什么要重新发明轮子呢？
- en: You offer to help review the module for security and best practices. Before
    you introduce the module to the other teams at the social media company, you use
    figure 13.1 to assess the database module for its functionality, security, and
    life cycle before officially adopting it.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 您提出帮助审查该模块的安全性和最佳实践。在您将模块介绍给社交媒体公司的其他团队之前，您使用图13.1评估数据库模块的功能、安全和生命周期，然后正式采用它。
- en: Each time the open source maintainers release a new database module, you reassess
    the module. You can apply this decision workflow to safely and securely adopt
    external IaC modules and tools. You want to make sure you can use the tool or
    module and avoid insecure configuration in your infrastructure system that would
    allow a bad actor to exploit your system.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 每次开源维护者发布新的数据库模块时，您都会重新评估该模块。您可以将此决策流程应用于安全地采用外部IaC模块和工具。您想确保您可以使用该工具或模块，并避免在您的基础设施系统中造成不安全的配置，从而允许恶意行为者利用您的系统。
- en: 13.1.1 Functionality
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.1.1 功能性
- en: You may find a module or tool promising to start. It allows you to configure
    the attributes you need very flexibly. However, recall from chapters 2 and 3 that
    modules should include some opinionated defaults. Without them, a module or tool
    with too much flexibility may lead to one-off configurations that eventually break
    your system.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能会发现一个模块或工具很有前景。它允许您非常灵活地配置所需的属性。然而，回想一下第2章和第3章，模块应包含一些具有意见的默认值。没有它们，过于灵活的模块或工具可能会导致一次性配置，最终破坏您的系统。
- en: '![](../../OEBPS/Images/CH13_F01_Wang.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH13_F01_Wang.png)'
- en: Figure 13.1 You assess the functionality, security, and life cycle of a tool
    or module before you use it.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.1 在您使用工具或模块之前，您评估其功能、安全和生命周期。
- en: You encourage the feed team to verify the default values in the database module.
    The team assesses the module, as shown in figure 13.2\. The module uses very opinionated
    defaults, pins the version of the database, and tests compatibility thoroughly.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 您鼓励数据源团队验证数据库模块中的默认值。团队评估该模块，如图13.2所示。该模块使用非常具有意见的默认值，固定了数据库版本，并彻底测试了兼容性。
- en: '![](../../OEBPS/Images/CH13_F02_Wang.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH13_F02_Wang.png)'
- en: Figure 13.2 Decision flow for assessing usage of a module or tool based on functionality
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.2 基于功能评估模块或工具使用的决策流程
- en: The documentation notes that the module pins the database version to thoroughly
    test the configuration and its compatibility with specific versions. The feed
    team members confirm they use the database version and approve the module’s default
    value for it.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 文档指出，该模块将数据库版本固定，以彻底测试配置及其与特定版本的兼容性。数据源团队成员确认他们使用该数据库版本，并批准了该模块为其设置的默认值。
- en: Next, they assess the input variables for the module. The database module allows
    them to set the attributes they need, such as database name. It also lets them
    set the tagging and network. The feed team members confirm they do not need to
    set more than those variables.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，他们评估模块的输入变量。数据库模块允许他们设置所需的属性，例如数据库名称。它还允许他们设置标签和网络。数据源团队成员确认他们不需要设置超过这些变量。
- en: Since the module does not offer every attribute as an input variable and offers
    opinionated defaults that fit the team, you approve the module based on functionality.
    In general, review the module’s documentation and commit history. If the module
    tests for version compatibility and a set of opinionated defaults that suit your
    functionality, you can move forward with a security assessment.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 由于该模块并未将每个属性都作为输入变量提供，并且提供了适合团队的默认值，因此您根据功能批准该模块。一般来说，请审查模块的文档和提交历史。如果该模块测试了版本兼容性以及适合您功能的一组默认值，您就可以继续进行安全评估。
- en: If you find the module does not offer some specific default values or input
    variables you need to change, you can find another module, write your own, or
    proceed to use the module with its limitations in mind. Similarly, you can apply
    the decision flow to a tool and find it lacking. A single tool cannot do everything!
    You must balance its flexibility in functionality with its predictability in making
    infrastructure changes.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您发现该模块没有提供您需要更改的一些特定默认值或输入变量，您可以找到另一个模块，编写自己的模块，或者带着其限制使用该模块。同样，您可以将决策流程应用于工具，并发现其不足。一个工具不能做所有事情！您必须平衡其在功能上的灵活性与其在基础设施变更中的可预测性。
- en: 13.1.2 Security
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.1.2 安全性
- en: While you might first assess the functionality of a module or tool, you should
    next evaluate its security. Security tends to serve as the make-or-break criteria
    for whether you should use an open source tool or module. Without carefully assessing
    an open source module or tool for secure configuration or code, you may inadvertently
    open a door for a bad actor to compromise the system.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然你可能首先评估模块或工具的功能，但接下来你应该评估其安全性。安全性往往是决定你是否应该使用开源工具或模块的关键标准。如果没有仔细评估开源模块或工具的安全配置或代码，你可能会无意中为恶意行为者打开一扇门，使其能够损害系统。
- en: Before the feed team members can use their database module, they need you to
    check the module for any security concerns. You check whether the database module
    exposes or outputs sensitive information, sends information to third-party endpoints,
    and passes existing security and compliance tests, as shown in figure 13.3.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在饲料团队成员可以使用他们的数据库模块之前，他们需要你检查该模块是否存在任何安全顾虑。你检查数据库模块是否暴露或输出敏感信息，是否向第三方端点发送信息，以及是否通过现有的安全性和合规性测试，如图13.3所示。
- en: '![](../../OEBPS/Images/CH13_F03_Wang.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH13_F03_Wang.png)'
- en: Figure 13.3 Decision flow for assessing usage of module or tool based on security
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.3 基于安全性的模块或工具使用评估决策流程
- en: In the example, the database module does not output the password or any sensitive
    configuration or send information to a third-party endpoint. The module also passes
    your security and compliance tests for databases you wrote in chapter 8\. Why
    should you verify all three checks before adopting a module?
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在示例中，数据库模块不会输出密码或任何敏感配置，也不会将信息发送到第三方端点。该模块还通过了你在第8章中编写的数据库的安全和合规性测试。为什么在采用模块之前你应该验证这三个检查？
- en: A module may accidentally expose or output sensitive information. For example,
    a configuration could accidentally output a password during a dry run. If it does,
    make sure you have a way to mitigate or mask the password and rotate it.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 一个模块可能会意外地暴露或输出敏感信息。例如，在模拟运行期间，配置可能会意外地输出密码。如果确实如此，确保你有方法来缓解或隐藏密码并更换它。
- en: Similarly, a module should not write or send information to an unauthorized
    third party. A bad actor might add a minor configuration that sends your network
    information to an HTTP endpoint. Review each resource and check that they do not
    send anything to a third party.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，一个模块不应写入或向未经授权的第三方发送信息。恶意行为者可能会添加一个小的配置，将你的网络信息发送到HTTP端点。审查每个资源并检查它们是否没有向第三方发送任何信息。
- en: Security and open source
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 安全性和开源
- en: Software supply-chain attacks occur when an actor includes malicious code in
    a vendor’s software, which gets shipped out to customers and compromises their
    data and systems. The benefit of open source means that you can examine *what*
    goes into code before you, as a customer, decide to use it.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 软件供应链攻击发生在行为者在供应商的软件中包含恶意代码时，该软件被发送给客户并损害了他们的数据和系统。开源的好处在于，在作为客户的你决定使用它之前，你可以检查代码中包含的内容。
- en: In this section, I recognize that I greatly oversimplified the risk assessments
    and guardrails for defending against supply-chain attacks. For more information,
    a NIST whitepaper ([http://mng.bz/449B](https://shortener.manning.com/449B)) better
    organizes some of the practices.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我意识到我在防御供应链攻击的风险评估和防护措施上过于简化了。更多详细信息，请参阅NIST的白皮书([http://mng.bz/449B](https://shortener.manning.com/449B))，它更好地组织了一些实践。
- en: Finally, run existing security and compliance tests you wrote for the infrastructure
    resources. You want *secure* and *compliant* resources. Otherwise, you need to
    go back and update the module to suit your requirements.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，运行你为基础设施资源编写的现有安全性和合规性测试。你希望拥有*安全*和*合规*的资源。否则，你需要回过头来更新模块以满足你的要求。
- en: Deploy the module in your IaC in an isolated testing environment. Then run the
    security and compliance tests against the module. Isolating the module in its
    own environment ensures that you do not introduce noncompliant configurations
    to running environments.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的基础设施即代码（IaC）中，在一个隔离的测试环境中部署该模块。然后对该模块运行安全性和合规性测试。将模块隔离在其自己的环境中可以确保你不会向运行环境引入不合规的配置。
- en: Keep in mind that not all security and compliance tests will pass. Those that
    fail need minor refactoring to work with the module. After all the tests pass,
    you can approve the module as secure for use.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，并非所有的安全性和合规性测试都会通过。那些失败的测试需要对模块进行一些小的重构才能工作。所有测试通过后，你可以批准该模块作为安全模块使用。
- en: Tools follow a similar decision workflow as you assess their security. However,
    security and compliance testing for IaC tools may include static code analysis
    and additional reviews from your organization. For tools that output configuration
    or other information during dry runs, you will want to apply the remediation steps
    from chapter 8.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 工具在评估其安全性时遵循类似的决策流程。然而，IaC 工具的安全性和合规性测试可能包括静态代码分析和来自您组织的额外审查。对于在干运行期间输出配置或其他信息的工具，您将希望应用第
    8 章中的修复步骤。
- en: 13.1.3 Life cycle
  id: totrans-42
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.1.3 生命周期
- en: You examined the functionality and security of the module, but the compliance
    team members raise a very good question. They ask about *who* maintains the public
    module. Your organization will need to take private (or maybe public) ownership
    of the module or tool if its maintainers no longer update it.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 您检查了模块的功能和安全，但合规性团队成员提出了一个非常好的问题。他们询问 *谁* 维护公共模块。如果维护者不再更新它，您的组织将需要对该模块或工具拥有私人（或可能是公共）所有权。
- en: You examine the documentation to understand the life cycle of the module and
    who maintains it, as shown in figure 13.4\. If the database module has company
    sponsorship and an appropriate license, you can likely use it.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 您检查了文档以了解模块的生命周期以及谁在维护它，如图 13.4 所示。如果数据库模块有公司赞助和适当的许可证，您很可能可以使用它。
- en: '![](../../OEBPS/Images/CH13_F04_Wang.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/CH13_F04_Wang.png)'
- en: Figure 13.4 Decision flow for assessing usage of a module or tool based on tool
    or module life cycle
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.4 基于工具或模块生命周期评估模块或工具使用的决策流程
- en: You examine the maintainers of the database module. The maintainers come from
    a well-known technology company and have many contributors, which means the project
    fosters an active community. They update and release a new version of the module
    every few months. Each contribution must pass a testing suite to verify that changes
    do not break the module.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 您检查了数据库模块的维护者。维护者来自一家知名科技公司，并且有许多贡献者，这意味着项目培养了一个活跃的社区。他们每隔几个月就会更新和发布模块的新版本。每个贡献都必须通过测试套件来验证更改不会破坏模块。
- en: Next, you retrieve information about the database module’s open source license.
    You do not know how the open source license affects your company, so you contact
    your legal team. The legal team reviews the license before the feed team can use
    it.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，您检索有关数据库模块开源许可证的信息。您不知道开源许可证如何影响您的公司，因此您联系了您的法律团队。法律团队在数据团队可以使用之前审查了许可证。
- en: The module includes an MIT license. As a *permissive open source license*, the
    MIT license means if you fork (maintain a copy) or modify the database module,
    you must include a copy of the license and the original copyright notice. If the
    maintainers deprecate the module or tool, the permissive license type allows you
    to modify and update the module yourself.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块包含一个 MIT 许可证。作为一种 *宽松的开源许可证*，MIT 许可证意味着如果您分叉（维护副本）或修改数据库模块，您必须包含许可证副本和原始版权声明。如果维护者废弃了模块或工具，宽松的许可证类型允许您自己修改和更新模块。
- en: Definition A *permissive open source license* allows you to fork or modify code
    as long as you include a copy of the license and original copyright notice.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 A *宽松的开源许可证* 允许您在包含许可证副本和原始版权声明的情况下分叉或修改代码。
- en: Your legal team approves the license because the module poses minimal risk to
    the overall infrastructure configuration. The company can edit the module if needed
    but does not have to release it publicly. Perhaps you can even contribute to the
    open source module yourself, pending legal approval.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 您的法律团队批准了许可证，因为该模块对整体基础设施配置的风险极低。公司如果需要可以编辑该模块，但不必公开发布。也许您甚至可以自己为开源模块做出贡献，前提是获得法律批准。
- en: A module or tool can also include an open source license in the copyleft category.
    The *copyleft* category of licenses contains a clause that you must release the
    codebase with your modifications.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 模块或工具还可以包含属于版权左开类别的开源许可证。许可证的 *版权左开* 类别包含一个条款，您必须发布带有您修改的代码库。
- en: Definition A *copyleft open source license* allows you to fork or modify code
    as long as you release the codebase with your modifications.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 A *版权左开的开源许可证* 允许您在发布带有您修改的代码库的情况下分叉或修改代码。
- en: The copyleft category of licenses often includes more restrictions on modifying
    and distributing the tool or module. Your company’s legal team will assess whether
    the company can use open source IaC with more restrictive licenses.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 许可证的copyleft类别通常包括对修改和分发工具或模块的更多限制。您的公司的法律团队将评估公司是否可以使用具有更严格许可的开源IaC。
- en: Note For more information on open source licenses, review the licenses and standards
    outlined by the Open Source Initiative ([https://opensource.org/licenses](https://opensource.org/licenses)).
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：有关开源许可的更多信息，请参阅开源倡议概述的许可和标准（[https://opensource.org/licenses](https://opensource.org/licenses)）。
- en: The feed team (overjoyed) can use the database module. You recommend that the
    team pins the module version by mirroring it to an internal artifact repository.
    Mirroring the module ensures that teams can use the approved module only in the
    internal repository. If the public endpoint for the module goes down, the team
    always has a copy in the internal repository. Each time the maintainers release
    a new module version, you must check the changes and approve the latest version.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: （兴奋的）饲料团队可以使用数据库模块。您建议团队通过将其镜像到内部工件存储库来锁定模块版本。镜像模块确保团队只能在内部存储库中使用经过批准的模块。如果模块的公共端点出现故障，团队始终可以在内部存储库中找到副本。每次维护者发布新的模块版本时，您都必须检查更改并批准最新版本。
- en: Consider contributing back to open source if your organization allows it. Forking
    an open source module or tool and maintaining it yourself while keeping it updated
    with the public release has an operational overhead. You can dedicate many hours
    reconciling changes between the open source version and your version. Creating
    a process to contribute changes directly to the public release helps reduce the
    overhead of maintaining unique changes that may break your infrastructure.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的组织允许，请考虑为开源项目做出贡献。从开源模块或工具中分叉并自行维护，同时保持与公共发布的同步，这将产生运营开销。您可能需要投入许多小时来协调开源版本和您的版本之间的更改。创建一个直接向公共发布贡献更改的流程有助于减少维护独特更改的开销，这些更改可能会破坏您的基础设施。
- en: 13.2 Upgrading tools
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.2 升级工具
- en: When you run your IaC practice for a few years, you inevitably reach a point
    where you need to upgrade your tool or the plugins it uses. A wider gap in your
    tool version to the latest version can make it much harder for you to update your
    infrastructure with minimal disruption!
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 当您运行IaC实践几年后，您不可避免地会达到一个需要升级工具或其使用的插件的点。工具版本与最新版本之间的差距越大，您在最小干扰的情况下更新基础设施就越困难！
- en: We learned about this challenge for module versioning in chapter 5\. In this
    section, I’ll cover some of the considerations and patterns you can use when you
    need to upgrade your tool.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在第5章中了解了模块版本化的挑战。在本节中，我将介绍一些您在需要升级工具时可以使用的考虑因素和模式。
- en: Note You will not find magic tools to migrate everything perfectly for you.
    Upgrading a tool will always have challenging obstacles. Unique patterns in your
    IaC (such as inline scripting) may break the system during the upgrade! As a result,
    try to limit the complexity of your IaC logic when possible.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：您不会找到可以完美迁移所有内容的魔法工具。升级工具始终会面临挑战。您IaC中的独特模式（如内联脚本）可能在升级过程中破坏系统！因此，尽可能限制您IaC逻辑的复杂性。
- en: Imagine you audit the company’s IaC tools (provisioning, configuration management,
    and image building). Most of the company IaC uses tool version 1.7\. However,
    the latest tool version is at 4.0\. Your first major project involves updating
    the IaC to use the tool version 4.0.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下，您审计了公司的IaC工具（提供、配置管理和镜像构建）。公司的大部分IaC使用工具版本1.7。然而，最新工具版本是4.0。您的第一个主要项目涉及将IaC更新为使用工具版本4.0。
- en: 13.2.1 Pre-upgrade checklist
  id: totrans-63
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.2.1 升级前清单
- en: Before you start upgrading a tool or plugin, you need to check a few essential
    practices that will help minimize potential disruption to your infrastructure.
    Your checklist should include a few steps to decouple, stabilize, and reconcile
    IaC.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始升级工具或插件之前，您需要检查一些基本实践，这些实践将有助于最大限度地减少对您基础设施的潜在干扰。您的清单应包括一些步骤来解耦、稳定和协调IaC。
- en: Figure 13.5 shows this checklist. You decouple all dependencies, check versioning,
    pin all versions, and deploy your IaC to reduce drift.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.5显示了此清单。您解耦所有依赖项，检查版本，锁定所有版本，并将IaC部署以减少漂移。
- en: '![](../../OEBPS/Images/CH13_F05_Wang.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH13_F05_Wang.png)'
- en: Figure 13.5 Before you upgrade a tool, your checklist should include pinning
    and checking all versions for modules, plugins, and tools.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.5 在升级工具之前，你的清单应该包括固定和检查模块、插件和工具的所有版本。
- en: If the tool upgrade adds or removes fields, you need to pass the correct information
    expected by each resource subset. Dependency injection offers a layer of abstraction
    for configuration attributes between infrastructure resources (refer to chapter
    4). It protects each subset from changes to the other.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 如果工具升级添加或删除字段，你需要传递每个资源子集期望的正确信息。依赖注入为基础设施资源之间的配置属性提供了一层抽象（参见图4）。它保护每个子集免受其他子集变更的影响。
- en: You check that you added module versioning to all IaC modules (chapter 5). Similarly,
    you make sure any IaC or repositories using the module pin to a specific version.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要检查你是否为所有IaC模块（第5章）添加了模块版本号。同样，你也要确保任何使用该模块的IaC或存储库将其固定到特定版本。
- en: For example, one of the teams at the social media company always uses the latest
    version of the module. You add module version 2.3.1 to the team’s repository.
    When you release module version 3.0.0 with the tool upgrade, the team’s IaC will
    not upgrade with breaking changes. You could update a module and push a breaking
    change to everyone using it without pinning the module version!
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，社交媒体公司的一个团队总是使用模块的最新版本。你将模块版本2.3.1添加到团队的存储库中。当你使用工具升级发布模块版本3.0.0时，团队的IaC不会因为破坏性变更而升级。你可以在不固定模块版本的情况下更新模块并将破坏性变更推送给所有使用它的人！
- en: You also verify that each team pins the current version of the tool and its
    plugin versions. While the plugins may not have forward compatibility, you want
    to preserve the current version and avoid adding a new configuration in a different
    version. Finally, you push all your pinned module, tool, and plugin versions to
    each IaC module and configuration. You ensure that the version pinning does not
    introduce new changes.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 你还要验证每个团队是否将工具及其插件版本固定到当前版本。虽然插件可能没有向前兼容性，但你希望保留当前版本，并避免在另一个版本中添加新的配置。最后，将所有固定的模块、工具和插件版本推送到每个IaC模块和配置中。你确保版本固定不会引入新的变更。
- en: After you complete your pre-upgrade checklist, you must plan your tool upgrade
    path. Figure 13.6 shows that upgrading from 1.0 to 4.0 of the tool introduces
    some breaking changes! You decide you can upgrade to 3.0, which provides backward
    compatibility with 1.7\. Then you can upgrade from 3.0 to 4.0, which should reduce
    any other breaking changes.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在完成你的预升级清单后，你必须规划你的工具升级路径。图13.6显示，从1.0升级到4.0的工具引入了一些破坏性变更！你决定可以升级到3.0，它提供了与1.7的向后兼容性。然后你可以从3.0升级到4.0，这应该减少其他破坏性变更。
- en: '![](../../OEBPS/Images/CH13_F06_Wang.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH13_F06_Wang.png)'
- en: Figure 13.6 You plan your tool upgrade path and account for backward-compatible
    versions and versions with breaking changes.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.6 你规划工具升级路径，并考虑向后兼容版本和具有破坏性变更的版本。
- en: Do not upgrade to the latest version immediately. Instead, examine a list of
    breaking changes in your tool and assess whether you can accommodate those changes.
    I avoid upgrading more than two versions (or subversions in case of beta releases)
    at one time. Most tools have breaking changes in either behavior or syntax.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 不要立即升级到最新版本。相反，检查你的工具中的破坏性变更列表，并评估你是否可以适应这些变更。我避免一次性升级超过两个版本（或beta发布中的子版本）。大多数工具在行为或语法上都会有破坏性变更。
- en: Consider testing the upgrade in a testing environment before rolling it out
    to production. Based on your system and its testing environment, you can identify
    if a tool upgrade may disrupt infrastructure. Upgrading will never go as smoothly
    as you expect, and a testing environment helps identify significant issues before
    you upgrade production.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在将升级部署到生产环境之前，考虑在测试环境中测试升级。根据你的系统和测试环境，你可以确定工具升级是否可能破坏基础设施。升级永远不会像你预期的那样顺利，测试环境有助于在升级生产之前识别重大问题。
- en: 13.2.2 Backward compatibility
  id: totrans-77
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.2.2 向后兼容性
- en: Many IaC tools offer some kind of backward compatibility for changes. They typically
    support old and new features for a version or two before deprecating the old feature.
    Even if a tool supports backward compatibility, make sure to port and refactor
    to new features as soon as you can.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 许多IaC工具为变更提供某种向后兼容性。它们通常在废弃旧功能之前，支持一个或两个版本的旧和新功能。即使一个工具支持向后兼容性，也要确保尽快将代码移植和重构到新功能。
- en: Your example upgrades the tool from version 1.7 to 3.0\. Fortunately, version
    3.0 does support backward compatibility with 1.7\. It offers new features but
    no breaking changes that would affect your IaC. Just in case, you take a careful
    approach to the upgrade.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 你的示例将工具从版本1.7升级到3.0。幸运的是，版本3.0确实支持与1.7的向后兼容性。它提供了新功能，但没有破坏性更改会影响你的IaC。当然，你采取了谨慎的方法进行升级。
- en: You start with the feed team members since they agree to your help during the
    upgrade. The feed team deploys all changes and makes sure not to add new changes
    to the IaC. Then, you examine the configuration for the best way to upgrade the
    tool without disrupting the social media feed.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 你从同意在升级期间提供帮助的饲料团队成员开始。饲料团队部署所有更改，并确保不要向IaC添加新的更改。然后，你检查配置，以找到升级工具而不中断社交媒体流量的最佳方式。
- en: In figure 13.7, you apply the refactoring techniques from chapter 10 to upgrading
    the tool. You start with high-level resources because other resources do not depend
    on them, deploy changes, test the system, and upgrade the lower-level resources.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在图13.7中，你将第10章中提到的重构技术应用于工具的升级。你从高级资源开始，因为其他资源不依赖于它们，部署更改，测试系统，然后升级底层资源。
- en: You notify the feed team that you will upgrade DNS and load balancer infrastructure
    resources first. Other resources do not depend on them. Updating them first allows
    you to test whether your upgrade patterns work. You can upgrade the tool version
    for the resource by changing the version and running the IaC. You check the dry
    run and tests in your delivery pipeline to ensure that you did not disrupt anything.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 你通知饲料团队，你将首先升级DNS和负载均衡器基础设施资源。其他资源不依赖于它们。首先更新它们允许你测试你的升级模式是否有效。你可以通过更改版本并运行IaC来升级资源的工具版本。你检查交付管道中的干运行和测试，以确保你没有中断任何内容。
- en: '![](../../OEBPS/Images/CH13_F07_Wang.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH13_F07_Wang.png)'
- en: Figure 13.7 Apply refactoring techniques to upgrade a backward-compatible tool
    version from high-level to low-level resources.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.7 将重构技术应用于从高级到低级资源的向后兼容性工具版本升级。
- en: The high-level resources like DNS and load balancer update without any disruption.
    Next, you move to lower-level resources. You start to update the servers with
    the rolling update pattern from chapter 10\. Rather than upgrade all servers simultaneously,
    you start the upgrade on one and quickly run into a problem.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 高级资源如DNS和负载均衡器更新时没有任何中断。接下来，你转向更底层的资源。你开始使用第10章中提到的滚动更新模式更新服务器。你不会同时升级所有服务器，而是从一台开始升级，很快遇到了问题。
- en: The production server configuration has an override script that breaks when
    you upgrade the tool. Fortunately, you affected only one server, since you used
    a rolling update. After all, you want to keep the social media feed running and
    available.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 生产服务器配置有一个覆盖脚本，在升级工具时会中断。幸运的是，由于你使用了滚动更新，你只影响了一台服务器。毕竟，你希望保持社交媒体流量的运行和可用性。
- en: In figure 13.8, you apply the roll-forward techniques from chapter 11 to fix
    the server that no longer works. You implement a manual fix and debug the old
    server for the problem. Once you fix the problem in the testing environment, you
    push out a change to the override script and proceed with your rolling update
    of servers.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在图13.8中，你应用第11章中提到的回滚技术来修复不再工作的服务器。你实施手动修复，并调试旧服务器以解决问题。一旦你在测试环境中修复了问题，你就将更改推送到覆盖脚本，并继续进行服务器的滚动更新。
- en: '![](../../OEBPS/Images/CH13_F08_Wang.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH13_F08_Wang.png)'
- en: Figure 13.8 You can use a rolling update pattern to minimize the blast radius
    of a failed tool upgrade and roll forward if the change fails.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.8 你可以使用滚动更新模式来最小化失败的工具升级的影响范围，并在更改失败时回滚。
- en: The servers pass the test. You move to the lowest-level resource, the network.
    Just in case, you deploy a second version of the network using a blue-green deployment
    pattern from chapter 9\. After deploying everything onto the new network, you
    run all the end-to-end tests and check that the system still works. You completed
    the tool upgrade!
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器通过了测试。你转向最低级别的资源，即网络。以防万一，你使用第9章中提到的蓝绿部署模式部署了网络的第二个版本。将所有内容部署到新网络后，你运行了所有端到端测试，并检查系统是否仍然正常工作。你完成了工具升级！
- en: Why revisit patterns like refactoring, blue-green deployment, and rolling upgrades?
    You want to minimize the blast radius of a potential failure. Many of these patterns
    seem repetitive, but they offer a structured, less risky approach to upgrading
    your system. Changing your tool *does* change your infrastructure, so you can
    apply very similar techniques with the same result.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么要回顾重构、蓝绿部署和滚动升级等模式？你希望最小化潜在失败的影响范围。许多这些模式看似重复，但它们提供了结构化、风险较低的升级系统的方法。改变你的工具*确实*会改变你的基础设施，因此你可以应用非常相似的技术并获得相同的结果。
- en: In general, use rolling upgrades for IaC upgrades to servers or other compute
    resources. Blue-green deployment helps tool upgrades for high-risk, low-level
    infrastructure resources. You can usually update high-level resources in place.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，使用滚动升级进行IaC升级到服务器或其他计算资源。蓝绿部署有助于高风险、低级基础设施资源的工具升级。你通常可以在原地更新高级资源。
- en: However, you can’t prevent every failure. In that case, use the roll-forward
    practices and patterns from chapter 11 if the system breaks. High-level resources
    can revert the configuration in place, while lower-level resources benefit from
    creating new resources with previous changes.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，你无法预防所有的失败。在这种情况下，如果系统崩溃，可以使用第11章中的回滚实践和模式。高级资源可以回滚配置，而低级资源则通过创建具有先前更改的新资源来受益。
- en: 13.2.3 Breaking changes in upgrades
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.2.3 升级中的破坏性变更
- en: Every once in a while, you’ll find your infrastructure tool or plugin releases
    a new version that includes breaking changes. New versions with breaking changes
    often happen with early versions of a tool, such as when the tool handles new
    or edge use cases. If you need to do a tool upgrade with breaking changes or features,
    use the techniques for making changes in chapter 9.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，你会发现你的基础设施工具或插件发布了包含破坏性变更的新版本。带有破坏性变更的新版本通常发生在工具的早期版本中，例如当工具处理新的或边缘用例时。如果你需要执行带有破坏性变更或功能的工具升级，请使用第9章中描述的更改技术。
- en: For the social media company, you upgraded the feed team’s tool from version
    1.7 to 3.0\. However, upgrading from version 3.0 to 4.0 involves some breaking
    changes! Version 4.0 contains backend schema changes that may affect your resources.
    How can you update your infrastructure to version 4.0 without impacting the system?
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 对于社交媒体公司，你将饲料团队的工具从版本1.7升级到3.0。然而，从版本3.0升级到4.0涉及一些破坏性变更！版本4.0包含后端架构更改，可能会影响你的资源。你如何在不影响系统的情况下将你的基础设施更新到版本4.0？
- en: Remember, in chapter 4, I mentioned the existence of the *tool state*. Tools
    keep a copy of the infrastructure state to detect drift between actual resource
    state and configuration and to track which resources it manages. Tool state differs
    from the actual infrastructure state. When you update a tool, you want to break
    out the old tool state from the new one.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，在第4章中，我提到了*工具状态*的存在。工具保留基础设施状态的副本，以检测实际资源状态与配置之间的偏差，并跟踪它管理的资源。工具状态与实际基础设施状态不同。当你更新工具时，你希望将旧工具状态与新的工具状态分开。
- en: In our example, you want to isolate the old tool state with version 3.0 from
    a new tool state with version 4.0\. Separating the tool state minimizes the blast
    radius of a potential failure by isolating the infrastructure resources a tool
    needs to change. Fewer resources means faster recovery and potentially less impact
    to other parts of the system.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的例子中，你希望将版本3.0的旧工具状态与版本4.0的新工具状态隔离开。通过隔离工具状态，可以最小化潜在失败的影响范围，因为这样可以隔离工具需要更改的基础设施资源。资源越少，恢复越快，并且可能对系统其他部分的影响越小。
- en: In figure 13.9, each team in the social media company separates its tool state
    into a different location. Separate tool states ensure that changes to the feed
    team’s blue infrastructure does not affect the green infrastructure.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在图13.9中，社交媒体公司的每个团队都将其工具状态分离到不同的位置。分离的工具状态确保对饲料团队蓝色基础设施的更改不会影响绿色基础设施。
- en: '![](../../OEBPS/Images/CH13_F09_Wang.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![图13.9](../../OEBPS/Images/CH13_F09_Wang.png)'
- en: Figure 13.9 A tool state captures the infrastructure state for the tool to make
    comparisons and can exist in separate locations for the tool to use.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.9 工具状态捕获了工具的基础设施状态，以便进行比较，并且可以存在于工具使用的不同位置。
- en: First, you pin tool and module versions across the feed team’s IaC. Next, you
    update infrastructure modules to tool version 4.0\. You release a new version
    of the module, making a note of breaking changes.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你在整个饲料团队的IaC中固定工具和模块版本。接下来，你更新基础设施模块到工具版本4.0。你发布模块的新版本，并记录破坏性变更。
- en: Next, you copy the existing configuration into a new folder. Each new folder
    creates a new tool state. Find the network folder and create a new network using
    tool version 4.0\. You should now have the original “blue” resources from tool
    version 3.0 and the new “green” resources from tool version 4.0.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，您将现有配置复制到一个新文件夹中。每个新文件夹创建一个新的工具状态。找到网络文件夹，并使用工具版本 4.0 创建一个新的网络。现在，您应该有来自工具版本
    3.0 的原始“蓝色”资源，以及来自工具版本 4.0 的新“绿色”资源。
- en: You applied a *blue-green deployment strategy to the tool state* to create new
    resources with the new tool! Creating a new set of resources with a new version
    ensures that any breaking changes will not affect the existing infrastructure.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 您将**蓝绿部署策略**应用于工具状态，以创建带有新工具的新资源！使用新版本创建一组新资源确保任何破坏性更改都不会影响现有基础设施。
- en: Definition *Blue-green deployment for tool state* is a pattern that creates
    a new subset of infrastructure resources with a new tool version. You gradually
    shift traffic from the old set of resources (blue) to the new set of resources
    (green). The pattern isolates breaking changes to the new set of resources for
    testing.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 定义**工具状态蓝绿部署**是一种模式，它创建了一个带有新工具版本的新基础设施资源子集。您逐渐将流量从旧资源集（蓝色）转移到新资源集（绿色）。该模式将破坏性更改隔离到新资源集以进行测试。
- en: After creating the low-level resources, copy the high-level resources to a new
    folder. Update its dependencies to use the low-level resources from tool version
    4.0\. After all, you want all resources using the new tool version.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建低级资源之后，将高级资源复制到一个新文件夹中。更新其依赖项以使用来自工具版本 4.0 的低级资源。毕竟，你希望所有使用新工具版本的资源。
- en: Figure 13.10 summarizes the strategy. Create the high-level resources, run your
    tests, and send traffic to the new resources.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.10 总结了该策略。创建高级资源，运行您的测试，并将流量发送到新资源。
- en: '![](../../OEBPS/Images/CH13_F10_Wang.png)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH13_F10_Wang.png)'
- en: Figure 13.10 With breaking changes, consider creating a new resource in a different
    state and cutting over traffic to the resource with the latest version of the
    tool.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.10 在出现破坏性更改时，考虑在另一种状态中创建一个新的资源，并将流量切换到使用工具最新版本的资源。
- en: This approach differs from the blue-green deployment in chapter 9\. You create
    a new set of resources *and* an entirely new tool state. If you loosely coupled
    your dependencies, subsets of resources can have different tool versions without
    affecting the system’s functionality.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法与第 9 章中提到的蓝绿部署不同。您创建了一组全新的资源，以及一个全新的工具状态。如果您松散耦合了依赖项，资源子集可以有不同的工具版本，而不会影响系统的功能。
- en: Recall that you can work on IaC with different repository structures (chapter
    5) and branching models (chapter 7). Depending on your repository structure and
    branching model, you can isolate your tool state differently. You can always merge
    a new branch and alter its pipeline to deploy infrastructure or copy the separate
    folder into your main configuration for a repository.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 回想一下，您可以使用不同的存储库结构（第 5 章）和分支模型（第 7 章）进行 IaC 的工作。根据您的存储库结构和分支模型，您可以以不同的方式隔离工具状态。您始终可以合并一个新的分支并修改其管道以部署基础设施，或者将单独的文件夹复制到存储库的主配置中。
- en: Suppose your organization has an opinionated approach to delivery pipelines
    and allows production deployment only on the main branch. In that case, you can
    create a new repository for the tool upgrade and archive the old one.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 假设您的组织对交付管道有特定的方法，并且只允许在主分支上进行生产部署。在这种情况下，您可以创建一个新的存储库用于工具升级，并将旧的存储库存档。
- en: You can apply an in-place upgrade if you dry-run and test the changes thoroughly.
    If it fails, you create an entirely new resource in a new tool state with the
    upgraded tool. When in doubt, refer to a tool’s upgrade documentation. As a general
    practice, I will try an in-place upgrade if the tool offers some kind of migration
    tool or script to ease the update.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您彻底测试了更改并进行了干运行，则可以应用就地升级。如果失败，您可以在新的工具状态中创建一个全新的资源，并使用升级后的工具。如有疑问，请参考工具的升级文档。作为一个一般做法，如果工具提供某种类型的迁移工具或脚本以简化更新，我将尝试就地升级。
- en: 13.3 Replacing tools
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.3 替换工具
- en: I attempted to keep this book as tool-agnostic as possible while offering concrete
    examples to demonstrate the patterns and practices. I recognize I will probably
    have to update this book and replace all the tools with the latest and greatest
    technology! When running IaC for a while, you inevitably change tools for improved
    functionality or vendor support. What patterns should we use when migrating to
    a new tool?
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 我试图在提供具体示例以展示模式和做法的同时，使本书尽可能不依赖于任何工具！在运行IaC一段时间后，您不可避免地会为了改进功能或供应商支持而更改工具。在迁移到新工具时，我们应该使用哪些模式？
- en: Many of the patterns and practices in this book should help protect your system
    from these changes. Scoping and modularizing your infrastructure with patterns
    from chapter 3 and decoupling your dependencies with patterns from chapter 4 allows
    your teams to use tools that fit their use case and replace them as needed. If
    you do not have these patterns in place, you will encounter some difficulties
    migrating to a new tool.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 本书中的许多模式和做法应该有助于保护您的系统免受这些变化的影响。使用第3章中的模式对您的基础设施进行范围和模块化，以及使用第4章中的模式解耦您的依赖关系，允许您的团队使用适合其用例的工具，并在需要时替换它们。如果您没有这些模式，您在迁移到新工具时可能会遇到一些困难。
- en: Imagine completing your tool upgrades across the IaC for the social media company.
    You think about taking a break when the network team members ask for your help.
    They want to move from a vendor’s DSL to an open source DSL. Their configuration
    will need an additional review from the social media feed team, which does not
    know anything about the vendor.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下您完成了社交媒体公司的IaC工具升级。当网络团队成员请求您的帮助时，您考虑休息一下。他们希望从供应商的DSL迁移到开源DSL。他们的配置需要社交媒体推送团队进行额外的审查，该团队对供应商一无所知。
- en: Your research cannot find a vendor or open source script to facilitate a straightforward
    migration. You wished you had something that could translate the vendor’s DSL
    to the open source one. Without it, you and the network team need to proceed with
    the migration carefully.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 您的研究无法找到供应商或开源脚本以简化直接的迁移。您希望有一种可以将供应商的DSL翻译为开源DSL的工具。没有它，您和网络团队需要谨慎进行迁移。
- en: 13.3.1 New tool supports import
  id: totrans-119
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.3.1 新工具支持导入
- en: You could not find automation to “translate” between tools. However, you can
    apply patterns in this book to migrate across tools. Some tools support an import
    capability to add new resources to a tool’s state. You can use the practices in
    chapter 2 to migrate existing resources to the new tool.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 您找不到“翻译”工具之间的自动化工具。然而，您可以将本书中的模式应用于迁移到不同的工具。一些工具支持导入功能，可以将新资源添加到工具的状态中。您可以使用第2章中的实践将现有资源迁移到新工具。
- en: In figure 13.11, you upgrade the modules to use the new open source DSL. You
    also update its tests, which pass. To start, identify some low-level resources
    you can change. You create a separate folder, branch, or repository to isolate
    the new DSL from the vendor DSL. After writing the configuration for the new DSL,
    you import existing resources into the state of the new DSL.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 在图13.11中，您将模块升级以使用新的开源DSL。您还更新了其测试，并且测试通过。首先，确定一些可以更改的低级资源。您创建一个单独的文件夹、分支或仓库，以将新的DSL与供应商的DSL隔离。在为新DSL编写配置后，您将现有资源导入到新DSL的状态中。
- en: Once again, you rewrite the tests to test the new syntax of the open source
    DSL. They pass, and you proceed to write configuration and import high-level resources.
    Finally, you delete the IaC.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 再次重写测试以测试开源DSL的新语法。它们通过，然后您继续编写配置和导入高级资源。最后，您删除IaC。
- en: Throughout each cycle of writing new IaC with the open source DSL, you want
    to check your dry run and rewrite your tests. The dry run shows if the defaults
    for the new tool do not match your existing state. You need to update the new
    IaC if they do not match and fix the drift.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用开源DSL编写每个新的IaC周期中，您想要检查您的干运行并重写您的测试。干运行显示新工具的默认设置是否与您的现有状态不匹配。如果不匹配，您需要更新新的IaC并修复漂移。
- en: '![](../../OEBPS/Images/CH13_F11_Wang.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/CH13_F11_Wang.png)'
- en: Figure 13.11 A new tool that supports importing resources allows you to migrate
    to a new tool without changing existing resources.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.11 支持导入资源的工具允许您在不更改现有资源的情况下迁移到新工具。
- en: 13.3.2 No import capability
  id: totrans-126
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.3.2 没有导入功能
- en: Some tools do not support import capabilities, and you need to create new resources
    for the new tool. Imagine if the network team asked you to help them convert from
    one vendor DSL to another. However, the new vendor DSL does not allow the import
    of existing resources into its state.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 一些工具不支持导入功能，你需要为新工具创建新的资源。想象一下，如果网络团队要求你帮助他们从一家供应商的 DSL 转换到另一家。然而，新的供应商 DSL
    不允许将现有资源导入其状态。
- en: If your new tool does not support importing existing resources, you need to
    re-create resources with a blue-green deployment strategy for the tool state.
    In figure 13.12, you start by writing new IaC for the low-level resources and
    refactor tests for the new tool. As you repeat the process and finish migrating
    high-level resources, you cut over traffic and test the entire system.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的新工具不支持导入现有资源，你需要使用蓝绿部署策略重新创建工具状态下的资源。在图 13.12 中，你首先编写新的基础设施即代码（IaC）用于低级资源，并对新工具进行测试重构。随着你重复此过程并完成高级资源的迁移，你将切换流量并测试整个系统。
- en: '![](../../OEBPS/Images/CH13_F12_Wang.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH13_F12_Wang.png)'
- en: Figure 13.12 A new tool that cannot import resources requires a tool migration
    using a blue-green deployment strategy.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.12 一个无法导入资源的全新工具需要使用蓝绿部署策略进行工具迁移。
- en: The pattern of migrating tools remains consistent, import capability or none.
    However, migration without an import capability takes more effort because you
    re-create the system. Even if you had a magical script to migrate from one tool
    to another, you might consider applying some of these patterns and practices to
    avoid breaking critical infrastructure resources, like the network.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 工具迁移的模式保持一致，无论是否有导入能力。然而，没有导入能力的迁移需要更多努力，因为你需要重新创建系统。即使你有一个可以将从一个工具迁移到另一个工具的神奇脚本，你也可能考虑应用一些这些模式和做法，以避免破坏关键基础设施资源，如网络。
- en: You will always replace or add tools to your infrastructure ecosystem. Your
    organization will choose the tools that fit its architectural objectives. Applying
    the techniques to modularize, isolate, and manage IaC will accommodate your IaC
    evolution. I always return to the practices and patterns to make infrastructure,
    IaC, module, tool, and organizational changes and mitigate their risk to critical
    systems.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 你总是会替换或添加工具到你的基础设施生态系统中。你的组织将选择适合其架构目标的工具。应用模块化、隔离和管理 IaC 的技术将适应你的 IaC 发展。我总是回到这些实践和模式，以使基础设施、IaC、模块、工具和组织的变化，并减轻它们对关键系统的风险。
- en: Regardless of whether a tool has import capabilities, you need to rewrite the
    tests for each resource you refactor. Figure 13.13 shows that you must refactor
    the unit and contract tests for each module and subset of resources as you migrate.
    However, your end-to-end and integration tests may stay the same.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 无论工具是否具有导入功能，你都需要为每个重构的资源重写测试。图 13.13 显示，在迁移过程中，你必须对每个模块和资源子集的重构单元测试和契约测试进行重构。然而，你的端到端和集成测试可能保持不变。
- en: '![](../../OEBPS/Images/CH13_F13_Wang.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH13_F13_Wang.png)'
- en: Figure 13.13 You will need to rewrite the unit and contract tests when you upgrade
    a tool, while the integration, end-to-end, and manual tests may stay mostly the
    same.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.13 当你升级工具时，你需要重写单元测试和契约测试，而集成、端到端和手动测试可能保持基本不变。
- en: A new tool will affect unit and contract tests because the tool uses a different
    state and metadata format. Tests cannot parse the correct information from the
    new tool. Integration and end-to-end tests likely stay the same because they evaluate
    the functions of infrastructure and not the tool itself.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 新工具将影响单元测试和契约测试，因为该工具使用不同的状态和元数据格式。测试无法从新工具中解析出正确信息。集成和端到端测试可能保持不变，因为它们评估的是基础设施的功能，而不是工具本身。
- en: Refactoring the tests as you go along allows you to add more tests, remove redundant
    tests, or make updates to broader security or policy tests. You should update
    your manual, integration, and end-to-end tests with new input parameters because
    you have different resources. However, the tests themselves do not change too
    much because they test the system’s functionality, not infrastructure attributes.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在重构测试的同时进行重构，允许你添加更多测试，删除冗余测试，或对更广泛的安全或策略测试进行更新。由于你有不同的资源，你应该更新你的手册、集成和端到端测试，以包含新的输入参数。然而，测试本身的变化不大，因为它们测试的是系统的功能，而不是基础设施属性。
- en: 13.4 Event-driven IaC
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.4 事件驱动 IaC
- en: Most of the book covers the practices of collaborating on and writing IaC to
    reduce the impact of a potential failure of critical systems. Once you get familiar
    with the principles and practices, you can extend them to more dynamic use cases.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 本书的大部分内容涵盖了协作编写IaC以减少关键系统潜在故障影响的实践。一旦你熟悉了原则和实践，你就可以将它们扩展到更多动态用例。
- en: For example, a development team wants some very dynamic automation with its
    IaC. Whenever the development team members deploy a new instance of an application,
    they need to update a firewall rule to allow access from the instance to the database.
    Rather than push a new instance and then remember to update the firewall rule
    later, they want some automation to run an infrastructure module to configure
    the firewall rule after an application instance starts.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，一个开发团队希望在其IaC中实现一些非常动态的自动化。每当开发团队成员部署应用程序的新实例时，他们需要更新防火墙规则以允许从实例访问数据库。而不是推送新实例然后记住稍后更新防火墙规则，他们希望有一些自动化在应用程序实例启动后运行基础设施模块来配置防火墙规则。
- en: Figure 13.14 demonstrates the automation you implement. You deploy a new application
    with a new IP address. An automated script captures the new IP address and runs
    some IaC. The configuration updates the firewall with the new IP address. This
    automation repeats each time you deploy a new application with a new IP address.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.14展示了你实现的自动化。你部署了一个带有新IP地址的新应用程序。一个自动脚本来捕获新的IP地址并运行一些IaC。配置更新了防火墙以包含新的IP地址。每次你部署带有新IP地址的新应用程序时，这种自动化都会重复。
- en: '![](../../OEBPS/Images/CH13_F14_Wang.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![图13.14](../../OEBPS/Images/CH13_F14_Wang.png)'
- en: Figure 13.14 Whenever an application instance gets a new IP address, the infrastructure
    module updates the firewall rule with the new IP address.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.14 每当应用程序实例获得新的IP地址时，基础设施模块都会使用新的IP地址更新防火墙规则。
- en: You may consider running an infrastructure module automatically when the system
    changes. *Event-driven IaC* means running a minimally scoped infrastructure module
    to configure infrastructure in response to an event. You can use the automation
    to update another resource or fix the system based on the event.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 当系统发生变化时，你可能考虑自动运行基础设施模块。*事件驱动的IaC*意味着运行最小范围的基础设施模块以响应事件来配置基础设施。你可以使用自动化来更新其他资源或根据事件修复系统。
- en: Definition *Event-driven IaC* runs a minimally scoped infrastructure module
    to configure infrastructure in response to an event.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 *事件驱动的IaC* 运行最小范围的基础设施模块以响应事件来配置基础设施。
- en: Updating the application equals an event. Some script, application, or automation
    detects the event and responds by running an infrastructure module! You can write
    your own or find an open source tool to identify and respond to the event. Some
    real-world automation you can use to detect and react to an event includes an
    operator for Kubernetes, a serverless function, or an application that consumes
    from an event queue.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 更新应用程序等同于一个事件。某些脚本、应用程序或自动化检测到事件，并通过运行基础设施模块来响应！你可以编写自己的或找到开源工具来识别和响应事件。你可以使用的某些实际自动化工具包括Kubernetes的操作员、无服务器函数或从事件队列中消费的应用程序。
- en: Isn’t this GitOps?
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 这不是GitOps吗？
- en: In chapter 7, I mentioned that a number of practices and patterns in this book
    lean toward GitOps. GitOps combines declarative configuration, drift detection,
    version control, and continuous deployment. The approach achieves event-driven
    IaC. I think of GitOps as a subset of event-driven IaC because its automation
    responds to events in configuration drift.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在第7章中，我提到本书中的一些实践和模式倾向于GitOps。GitOps结合了声明性配置、漂移检测、版本控制和持续部署。这种方法实现了事件驱动的IaC。我认为GitOps是事件驱动的IaC的一个子集，因为它的自动化响应配置漂移的事件。
- en: If the GitOps framework detects drift, it runs automation to reconcile the configuration.
    For example, the container orchestrator Kubernetes uses controllers to automatically
    reconcile the declarative configuration with resource state. However, event-driven
    IaC describes IaC automated by a broader set of events, not just drift.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 如果GitOps框架检测到漂移，它会运行自动化操作来协调配置。例如，容器编排器Kubernetes使用控制器来自动协调声明性配置与资源状态。然而，事件驱动的IaC描述的是由更广泛的事件集自动化的IaC，而不仅仅是漂移。
- en: 'The use case for event-driven IaC has become more prevalent with dynamic services
    and applications. If you do use event-driven IaC, keep a few practices in mind:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 随着动态服务和应用程序的普及，事件驱动的IaC用例变得更加普遍。如果你确实使用事件驱动的IaC，请记住以下几点：
- en: Avoid infrastructure resources that take a long time to create or configure.
    You do not want to include an infrastructure resource that takes an hour to create.
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免创建或配置时间较长的基础设施资源。你不想包含一个需要一小时来创建的基础设施资源。
- en: Do not add too many resources to an event-driven module. Otherwise, you will
    take a long time to create many instances.
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不要向事件驱动模块添加太多资源。否则，你将花费很长时间来创建许多实例。
- en: Balance the time it takes to run a change with the module versus the time interval
    between events.
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平衡运行更改所需的时间与模块之间的时间间隔。
- en: Combine the module practices from chapter 2 with the testing patterns from chapter
    6 to verify that event-driven IaC runs quickly and correctly.
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将第2章中的模块实践与第6章中的测试模式结合起来，以验证事件驱动IaC运行快速且正确。
- en: Some events happen with high frequency. You need infrastructure that deploys
    faster than the event’s frequency or an automation script to batch changes at
    a specific interval. You should choose the most minimal subset of infrastructure
    resources to deploy with event-driven IaC.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 一些事件发生频率很高。你需要比事件频率部署更快的基础设施，或者一个自动化脚本来在特定间隔批量更改。你应该选择与事件驱动IaC一起部署的最小基础设施资源子集。
- en: From static IaC that you deploy based on code commits to dynamic IaC run for
    an event, you apply the same patterns, practices, and principles to managing and
    collaborating. Your objectives, your team’s requirements, and your organization’s
    business will evolve and change over time—hopefully, your IaC practice grows with
    it. Keep in mind your testing strategy, the cost of infrastructure, and maintaining
    its security and compliance.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 从基于代码提交部署的静态基础设施即代码（IaC）到为事件运行动态IaC，你应用相同的模式、实践和原则来管理和协作。你的目标、团队的需求以及你组织的业务将随着时间的推移而演变和改变——希望你的IaC实践也能随之增长。请记住你的测试策略、基础设施成本以及维护其安全和合规性。
- en: Summary
  id: totrans-157
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Review the functionality, security, and life cycle of an open source tool or
    module before adopting it in your organization.
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在你的组织中采用开源工具或模块之前，请审查其功能、安全性和生命周期。
- en: An open source tool or module should have default values or behaviors that offer
    predictability and stability in changes. Otherwise, you will have to write a layer
    of code to add opinionated default attributes within your organization.
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开源工具或模块应具有默认值或行为，这些值或行为在更改中提供可预测性和稳定性。否则，你将不得不编写一层代码，在你的组织中添加具有偏见的默认属性。
- en: Protect your infrastructure from supply-chain attacks by scanning an infrastructure
    tool or module for security, checking for third-party data collection, and running
    your security and compliance tests.
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过扫描基础设施工具或模块以检查安全性、检查第三方数据收集以及运行你的安全和合规性测试来保护你的基础设施免受供应链攻击。
- en: The type and number of maintainers and the license associated with the tool
    or module also affect your organization’s use.
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 维护者类型和数量以及与工具或模块关联的许可证也会影响你组织的使用。
- en: 'Open source tools and modules can have two categories of licenses: permissive
    and copyleft.'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开源工具和模块可以有两个类别的许可证：宽松和copyleft。
- en: A permissive license lets you modify and update the module or tool as long as
    you include a copy of the license and its original copyright notice.
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 宽松许可证允许你修改和更新模块或工具，只要你包括许可证副本及其原始版权声明。
- en: A copyleft license allows you to modify and update the module or tool as long
    as you include a copy of the license, its original copyright notice, and release
    your copy open source.
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: copyleft许可证允许你修改和更新模块或工具，只要你包括许可证副本、其原始版权声明并开源你的副本。
- en: Before upgrading your IaC tool, decouple infrastructure dependencies and pin
    module, plugin, and tool versions.
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在升级你的IaC工具之前，解耦基础设施依赖项并固定模块、插件和工具版本。
- en: Start a tool update with backward compatibility by refactoring high-level resources
    mutably and proceeding to low-level resources.
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用向后兼容性开始工具更新，通过可变地重构高级资源并继续到低级资源。
- en: A blue-green deployment strategy for tool state means creating a new set of
    infrastructure resources with a state separate from the existing configuration.
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于工具状态，采用蓝绿部署策略意味着创建一组具有与现有配置分离的状态的新基础设施资源。
- en: Tool state refers to a copy of the infrastructure state that an IaC tool uses
    to detect drift or resources under its management.
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工具状态是指IaC工具用来检测漂移或其管理下的资源的基础设施状态副本。
- en: Start a tool update with breaking changes by applying a blue-green deployment
    strategy to the tool state, starting from low-level to high-level resources.
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过对工具状态应用蓝绿部署策略，从底层资源到高层资源，开始一个带有破坏性变更的工具更新。
- en: When replacing one tool with another, use the new tool’s import capability to
    migrate existing resources to the new tool. Start with low-level resources and
    apply them to high-level resources. Then, remove the configuration for the old
    tool.
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当用一个新的工具替换另一个工具时，使用新工具的导入功能将现有资源迁移到新工具。从底层资源开始，并将它们应用到高层资源。然后，移除旧工具的配置。
- en: If a new tool does not have an importing feature for existing infrastructure
    resources, you will need to apply a blue-green deployment strategy for the tool
    state.
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果新工具没有现有基础设施资源的导入功能，您将需要为工具状态应用蓝绿部署策略。
- en: Event-driven IaC runs a minimal IaC module in response to a system event to
    automate infrastructure changes.
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 事件驱动的基础设施即代码（IaC）在响应系统事件时运行一个最小的IaC模块，以自动化基础设施变更。
- en: Ensure that a module for event-driven IaC deploys quickly with as few resources
    as possible.
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保事件驱动的IaC模块以尽可能少的资源快速部署。
