- en: 5 Customization and configuration files
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 5 自定义和配置文件
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Using Podman configuration files based on libraries used
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据使用的库使用 Podman 配置文件
- en: Configuring the storage.conf file
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 storage.conf 文件
- en: Using the registries.conf and policy.json files for configuration
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 registries.conf 和 policy.json 文件进行配置
- en: Using the containers.conf file to configure other defaults
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 containers.conf 文件配置其他默认设置
- en: Using system configuration files to allow non-root users namespace access
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用系统配置文件允许非 root 用户命名空间访问
- en: Container engines like Podman have dozens of hardcoded defaults built into them.
    These defaults determine many aspects of the functional and nonfunctional behaviors
    of Podman, such as network and security settings. Podman developers try to pick
    the maximum amount of security but still allow most containers to run successfully.
    Similarly, I want as much isolation from the host as possible.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Podman 等容器引擎内置了数十个硬编码的默认值。这些默认值决定了 Podman 的功能性和非功能性行为的许多方面，例如网络和安全设置。Podman
    开发者试图选择最大程度的安全，但仍然允许大多数容器成功运行。同样，我也希望尽可能多地从主机隔离。
- en: The security defaults include which Linux capabilities to use, which SELinux
    labels to set, and the set of syscalls available to the containers. There are
    defaults for resource constraints, like memory usage and maximum processes allowed
    within a container. Other defaults include the local path for storing images,
    the list of container registries, and even system configuration to allow rootless
    mode to work. The Podman developers wanted to allow users to have ultimate control
    over these defaults, so the container engine configuration files provide a mechanism
    for customizing the way Podman and other container engines run.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 安全默认设置包括要使用的 Linux 能力、要设置的 SELinux 标签以及容器可用的系统调用集合。对于资源约束，如内存使用量和容器内允许的最大进程数，也有默认值。其他默认设置包括存储镜像的本地路径、容器注册库列表，甚至允许无根模式工作的系统配置。Podman
    开发者希望允许用户对这些默认值拥有最终控制权，因此容器引擎配置文件提供了一种自定义 Podman 和其他容器引擎运行方式的机制。
- en: The problem with defaults is that they are best-guess estimates from developers.
    While most users run Podman in default configuration, sometimes there is a need
    to change the configuration. Not every environment has the same configuration,
    and you might want to default certain machines to different levels of security
    and different registry configurations. Even rootless users might need different
    configurations than rootful users. In this chapter, I will show you how to customize
    different parts of Podman and explain where you can find more information about
    all of the different knobs available to you.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 默认配置的问题在于它们是开发者基于最佳猜测得出的估计。虽然大多数用户都在默认配置下运行 Podman，但有时需要更改配置。并非每个环境都有相同的配置，你可能希望将某些机器的默认安全级别和注册表配置设置为不同级别。即使是无根用户也可能需要与有根用户不同的配置。在本章中，我将向您展示如何自定义
    Podman 的不同部分，并解释您可以在哪里找到有关所有可用旋钮的更多信息。
- en: As you have learned in previous chapters, Podman uses multiple libraries to
    perform different tasks when working with containers. Table 5.1 describes the
    different libraries Podman uses.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 如您在前面章节中学到的，Podman 使用多个库在处理容器时执行不同的任务。表 5.1 描述了 Podman 使用的不同库。
- en: Table 5.1 Container libraries used by Podman
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 表 5.1 Podman 使用的容器库
- en: '| Library | Description |'
  id: totrans-12
  prefs: []
  type: TYPE_TB
  zh: '| 库 | 描述 |'
- en: '| containers/storage | Defines the storage of container images and other basic
    storage used by container engines |'
  id: totrans-13
  prefs: []
  type: TYPE_TB
  zh: '| containers/storage | 定义了容器镜像和其他基本存储的存储，这些存储由容器引擎使用 |'
- en: '| containers/image | Defines the mechanisms used to move container images from
    different types of storage; usually used between container registries and local
    container storage |'
  id: totrans-14
  prefs: []
  type: TYPE_TB
  zh: '| containers/image | 定义了用于在不同类型存储之间移动容器镜像的机制；通常用于容器注册库和本地容器存储之间 |'
- en: '| containers/common | Defines all of the default configuration options for
    container engines not defined in containers/storage or containers/image |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '| containers/common | 定义了在 containers/storage 或 containers/image 中未定义的所有容器引擎默认配置选项
    |'
- en: '| containers/buildah | As explained in chapter 2, it is used for building container
    images into local storage using rules defined in a Containerfile or Dockerfile;
    for more information on Buildah, see appendix A. |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| containers/buildah | 如第 2 章所述，它用于使用在 Containerfile 或 Dockerfile 中定义的规则将容器镜像构建到本地存储；有关
    Buildah 的更多信息，请参阅附录 A。 |'
- en: Each of these libraries has separate configuration files used to set the default
    settings for the particular library, with the exception of Buildah. The container
    engines, Podman, and Buildah share the containers/common configuration file containers.conf,
    described in section 5.3.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 这些库中的每一个都有单独的配置文件，用于设置特定库的默认设置，Buildah 除外。容器引擎 Podman 和 Buildah 共享 containers/common
    配置文件 containers.conf，这在第 5.3 节中进行了描述。
- en: 'Note All of the nonsystem configuration files used by Podman use the TOML format.
    TOML’s syntax consists of name = “value” pairs, [section names], and # comments.
    The format of TOML can be simplified to the following:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '注意：Podman 所使用的所有非系统配置文件都使用 TOML 格式。TOML 的语法由名称 = “值” 对、[部分名称] 和 # 注释组成。TOML
    的格式可以简化为以下形式：'
- en: '`[table]`'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[表格]`'
- en: '`option` `=` `value`'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`选项` `=` `值`'
- en: '`[table.subtable1]`'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[表格子表格1]`'
- en: '`option` `=` `value`'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`选项` `=` `值`'
- en: '`[table.subtable2]`'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[表格子表格2]`'
- en: '`option` `=` `value`'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`选项` `=` `值`'
- en: See [https://toml.io](https://toml.io) for a more complete explanation of the
    TOML language. When configuring Podman, usually one of the first concerns is where
    you are going to store your containers and images.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 请参阅 [https://toml.io](https://toml.io) 以获取对 TOML 语言的更完整解释。当配置 Podman 时，通常第一个关注的问题之一是您打算在哪里存储您的容器和镜像。
- en: 5.1 Configuration files for storage
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 5.1 存储配置文件
- en: Podman uses the [github.com/containers/storage](http://github.com/containers/storage)
    library, which provides methods for storing filesystem layers, container images,
    and containers. Configuration of this library is done using the storage.conf configuration
    file, which can be stored in multiple different directories.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: Podman 使用 [github.com/containers/storage](http://github.com/containers/storage)
    库，该库提供了存储文件系统层、容器镜像和容器的相关方法。此库的配置是通过 storage.conf 配置文件完成的，该文件可以存储在多个不同的目录中。
- en: Linux distributions often provide a /usr/share/containers/storage.conf file,
    which can be overridden by creating a /etc/containers/storage.conf file. Rootless
    users can store their configuration in the $XDG_CONFIG_HOME/containers/storage.conf
    file; if the $XDG_CONFIG_HOME environment variable is not set, the $HOME/.config/
    containers/storage.conf file is used. Most users will never change the storage.conf
    file, but in a few situations, advanced users need to do some customizations.
    The most common reason for changes is relocating the container’s storage.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: Linux 发行版通常提供 /usr/share/containers/storage.conf 文件，可以通过创建 /etc/containers/storage.conf
    文件来覆盖。无根用户可以将他们的配置存储在 $XDG_CONFIG_HOME/containers/storage.conf 文件中；如果 $XDG_CONFIG_HOME
    环境变量未设置，则使用 $HOME/.config/ containers/storage.conf 文件。大多数用户永远不会更改 storage.conf
    文件，但在少数情况下，高级用户需要进行一些自定义设置。最常见的更改原因是重新定位容器的存储。
- en: Note When using Podman in remote mode, for example on a Mac or Windows box,
    the Podman service uses the storage.conf files located in the Linux box. To modify
    them, you need to enter the VM. When using the Podman machine, execute the `podman`
    `machine` `ssh` command to enter the VM. See appendixes E and F for more information.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：当在远程模式下使用 Podman，例如在 Mac 或 Windows 系统上时，Podman 服务会使用位于 Linux 系统上的 storage.conf
    文件。要修改这些文件，您需要进入虚拟机。在使用 Podman 机器时，执行 `podman machine ssh` 命令进入虚拟机。有关更多信息，请参阅附录
    E 和 F。
- en: 'Podman reads only one storage.conf and ignores all subsequent ones. Podman
    first attempts to use the storage.conf from your home directory; next goes the
    /etc/storage/ storage.conf; and finally, if both files do not exist, Podman reads
    the /usr/share/ containers/storage.conf file. You can see the storage.conf file
    your Podman command is using via the `podman` `info` command:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: Podman 只读取一个 storage.conf 文件，并忽略所有后续的文件。Podman 首先尝试使用您主目录中的 storage.conf 文件；其次是
    /etc/storage/ 目录下的 storage.conf 文件；最后，如果这两个文件都不存在，Podman 会读取 /usr/share/ containers/storage.conf
    文件。您可以通过 `podman info` 命令查看 Podman 命令正在使用的 storage.conf 文件：
- en: '[PRE0]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 5.1.1 Storage location
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5.1.1 存储位置
- en: By default rootless Podman is configured to store your images in the $HOME/.local/
    share/containers/storage directory. The default rootful storage location is /var/lib/
    containers/storage.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，无根 Podman 配置为将您的镜像存储在 $HOME/.local/ share/containers/storage 目录中。默认的带根存储位置是
    /var/lib/ containers/storage。
- en: Sometimes you need to change this default location. Perhaps you don’t have enough
    disk space in /var or in the user’s home directory, so you want to store your
    images on a different disk. The storage.conf file calls the storage location the
    `graphRoot`, and it can be overridden in /etc/containers/storage.conf for rootful
    containers.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 有时您需要更改此默认位置。可能您在 /var 或用户主目录中没有足够的磁盘空间，因此您希望将镜像存储在不同的磁盘上。storage.conf 文件将存储位置称为
    `graphRoot`，并且可以在 /etc/containers/storage.conf 中为带根容器覆盖。
- en: 'In this section, you will modify the location of the graph driver to /var/mystorage.
    First, become root and make sure the /etc/containers/storage.conf file exists.
    If it does not exist, just copy the /usr/share/containers/storage.conf file into
    it:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，你将修改图驱动程序的位置到 /var/mystorage。首先，成为 root 并确保 /etc/containers/storage.conf
    文件存在。如果不存在，只需将 /usr/share/containers/storage.conf 文件复制到其中：
- en: '[PRE1]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Note Some distributions just ship the /etc/containers/storage.conf.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：某些发行版仅提供 /etc/containers/storage.conf。
- en: 'Now, make a backup, and open /etc/containers/storage.conf file for editing:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，创建一个备份，并打开 /etc/containers/storage.conf 文件进行编辑：
- en: '[PRE2]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Set the `graphdriver` variable `graphroot` `=` `"/var/lib/containers/storage"`
    to `graphroot` `=` `"/var/mystorage"`, and save the file.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 将 `graphdriver` 变量的 `graphroot` 设置为 `"/var/lib/containers/storage"` 并保存文件。
- en: 'Your storage.conf file should include the following:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 你的 storage.conf 文件应包括以下内容：
- en: '[PRE3]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Execute `podman` `info` to see if the change took place:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 执行 `podman info` 来查看更改是否发生：
- en: '[PRE4]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Notice in the storage section that the `graphRoot` is now /var/mystorage. All
    images and containers will be stored in this directory.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 注意在存储部分，`graphRoot` 现在是 /var/mystorage。所有镜像和容器都将存储在这个目录中。
- en: 'Now run the `podman` `info` command in rootless mode. The storage location
    will not change; it is still /home/dwalsh/.local/share/containers/storage:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在无根模式下运行 `podman info` 命令。存储位置不会改变；它仍然是 /home/dwalsh/.local/share/containers/storage：
- en: '[PRE5]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: You can create a $HOME/.config/containers/storage.conf and change it there,
    but this does not scale well for systems with multiple users. The key `rootless_storage_
    path` allows you to change the location for all users on your system.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在 $HOME/.config/containers/storage.conf 中创建一个并更改它，但这对于有多个用户的系统来说扩展性不好。键 `rootless_storage_path`
    允许你更改系统中所有用户的位置。
- en: 'This time, uncomment and modify the `rootless_storage_path` line:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 这次，取消注释并修改 `rootless_storage_path` 行：
- en: '[PRE6]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Modify the `rootless_storage_path` line in storage.conf from
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 将 storage.conf 中的 `rootless_storage_path` 行修改为
- en: '[PRE7]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Change it to
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 将其更改为
- en: '[PRE8]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Save the storage.conf file. When you are done, it should look like this:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 保存 storage.conf 文件。当你完成时，它应该看起来像这样：
- en: '[PRE9]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Now run `podman` `info` to see the changes. Notice that the `graphRoot` now
    points at the /var/tmp/3267/var/mystorage directory:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，运行 `podman info` 来查看更改。注意，`graphRoot` 现在指向 /var/tmp/3267/var/mystorage 目录：
- en: '[PRE10]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Container/storage supports expanding the `$HOME` and `$UID` environment variables
    for this path. To revert changes, copy and restore the original storage.conf file:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 容器/存储支持为此路径扩展 `$HOME` 和 `$UID` 环境变量。要撤销更改，复制并恢复原始的 storage.conf 文件：
- en: '[PRE11]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Note If you are running on an SELinux system and change the default location
    of storage, you need to inform SELinux about it, using the following `semanage`
    command. This will tell SELinux to label the new location as if it was in the
    old location. Next, you will need to change the labeling on disk using the `restorecon`
    command. You can do this with the following commands:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：如果你在一个 SELinux 系统上运行，并更改存储的默认位置，你需要使用以下 `semanage` 命令通知 SELinux。这将告诉 SELinux
    将新位置标记为如果它在旧位置一样。接下来，你需要使用 `restorecon` 命令更改磁盘上的标记。你可以使用以下命令来完成此操作：
- en: '[PRE12]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'In rootless mode you need to do the following:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在无根模式下，你需要执行以下操作：
- en: '[PRE13]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Sometimes you might want to change the storage driver or, more likely, the configuration
    of the storage driver.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 有时你可能想更改存储驱动程序，或者更可能的是，更改存储驱动程序的配置。
- en: 5.1.2 Storage drivers
  id: totrans-66
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5.1.2 存储驱动程序
- en: Recall the wedding cake illustration from chapter 2\. This illustration shows
    that images are often made of multiple layers. These layers are stored on disk
    by the container/ storage library, but when you are running a container on them,
    each layer needs to be mounted on the previous layer (figure 5.1).
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 回想第2章中的婚礼蛋糕插图。这个插图显示图像通常由多个层组成。这些层由容器/存储库存储在磁盘上，但当你在这上面运行容器时，每个层都需要挂载到前一个层（图5.1）。
- en: '![](../../OEBPS/Images/05-01.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/05-01.png)'
- en: Figure 5.1 Layered images stacked on one another are reassembled and mounted
    using container/storage.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.1 层叠在一起的分层图像通过容器/存储重新组装和挂载。
- en: Container/storage uses a Linux kernel filesystem concept called a *layered filesystem*
    to do this. Podman, using container/storage, supports multiple different types
    of layered filesystems. In Linux, these filesystems are called *copy-on-write
    (CoW**)* filesystems. In containers/storage, these different filesystem types
    are called *drivers*. By default Podman uses the `overlay` storage driver.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: Container/storage使用Linux内核文件系统概念，称为*分层文件系统*来完成这项工作。Podman通过container/storage支持多种不同类型的分层文件系统。在Linux中，这些文件系统被称为*写时复制（CoW）*文件系统。在容器/storage中，这些不同的文件系统类型被称为*驱动程序*。默认情况下，Podman使用`overlay`存储驱动程序。
- en: 'Note Docker supports two types of overlay drivers: `overlay` and `overlay2`.
    `overlay2` was an improvement over `overlay`, and the original `overlay` driver
    is rarely used any more. In contrast, Podman uses the newer `overlay2` driver
    and just calls it `overlay`. You can select the `overlay` driver in Podman, but
    this is just an alias for `overlay2`.'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 注意Docker支持两种类型的overlay驱动程序：`overlay`和`overlay2`。`overlay2`是`overlay`的改进版，原始的`overlay`驱动程序现在很少使用。相比之下，Podman使用较新的`overlay2`驱动程序，并称之为`overlay`。您可以在Podman中选择`overlay`驱动程序，但这只是`overlay2`的别名。
- en: Table 5.2 lists all of the storage drivers Podman and containers/storage support.
    I recommend you just stick to the `overlay` driver, since this is the driver the
    vast majority of the world uses.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 表5.2列出了Podman和container/storage支持的存储驱动程序。我建议您只坚持使用`overlay`驱动程序，因为这是世界上绝大多数人使用的驱动程序。
- en: Table 5.2 Container storage drivers
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 表5.2 容器存储驱动程序
- en: '| Storage drivers | Description |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '| 存储驱动程序 | 描述 |'
- en: '| `overlay (overlay2``)` | This is the default driver, and I strongly recommend
    its use. It is based on the Linux kernel overlay filesystem. `overlay` and `overlay2`
    are exactly the same in Podman. It is the most tested driver, which the overwhelming
    majority of users use. |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '| `overlay (overlay2)` | 这是默认驱动程序，我强烈推荐使用它。它基于Linux内核overlay文件系统。在Podman中，`overlay`和`overlay2`完全相同。这是最经过测试的驱动程序，绝大多数用户都在使用它。|'
- en: '| `vfs` | This is the simplest driver; it creates full copies of each lower
    layer up onto the next layer. It works everywhere but is slow and very disk intensive.
    |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '| `vfs` | 这是最简单的驱动程序；它为每一层创建完整的副本到下一层。它在任何地方都适用，但速度较慢且非常占用磁盘。|'
- en: '| `devmapper` | This driver was heavily used when Docker first became popular—before
    the `overlay` driver was available. It reallocates the size of each layer at a
    maximum size. It is not recommended any longer. |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '| `devmapper` | 当Docker最初变得流行时，此驱动程序被广泛使用——在`overlay`驱动程序可用之前。它会重新分配每个层的最大大小。现在不再推荐使用。|'
- en: '| `aufs` | This driver was never merged into the upstream kernel, so it is
    only available on a few Linux distributions. |'
  id: totrans-78
  prefs: []
  type: TYPE_TB
  zh: '| `aufs` | 此驱动程序从未合并到上游内核中，因此它仅在少数Linux发行版上可用。|'
- en: '| `btrfs` | This driver allows storage on btrfs snapshots based on the Btrfs
    filesystem. Some users have had success using this filesystem. |'
  id: totrans-79
  prefs: []
  type: TYPE_TB
  zh: '| `btrfs` | 此驱动程序允许基于Btrfs文件系统的快照进行存储。一些用户在使用此文件系统时取得了成功。|'
- en: '| `zfs` | This driver uses the ZFS filesystem, which is a proprietary filesystem
    and not available on most distributions. |'
  id: totrans-80
  prefs: []
  type: TYPE_TB
  zh: '| `zfs` | 此驱动程序使用ZFS文件系统，这是一个专有文件系统，在大多数发行版上不可用。|'
- en: overlay storage options
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: overlay存储选项
- en: The `overlay` driver has some interesting customization options. These options
    are located in the storage.conf [storage.options.overlay] table.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '`overlay`驱动程序有一些有趣的定制选项。这些选项位于storage.conf [storage.options.overlay]表中。'
- en: There are several advanced options available for configuring the overlay driver.
    I’ll quickly mention a few to describe use cases.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 配置overlay驱动程序有多个高级选项可用。我将简要提及几个以描述用例。
- en: The `mount_program` option allows you to specify an executable to use instead
    of the kernel overlay driver. Podman usually ships with the `fuse-overlayfs` executable,
    which provides a `FUSE` (userspace) overlay driver. Podman automatically fails
    over to the `fuse-overlayfs` `mount_program` if it is installed on systems where
    rootless native overlay is not supported. Most kernels support native overlay;
    however, there are use cases when you might want to configure the `mount_program`.
    The `fuse-overlayfs` has advanced features not currently supported in the native
    overlay.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '`mount_program`选项允许您指定一个可执行文件来代替内核overlay驱动程序。Podman通常附带`fuse-overlayfs`可执行文件，它提供了一个`FUSE`（用户空间）overlay驱动程序。如果系统不支持无根原生overlay，Podman会自动切换到`fuse-overlayfs`的`mount_program`。大多数内核支持原生overlay；然而，在某些情况下，您可能需要配置`mount_program`。`fuse-overlayfs`具有目前原生overlay不支持的高级功能。'
- en: Podman is quickly being adopted by the high-performance computing (HPC) community.
    The HPC community does not allow rootful containers, and in many cases it allows
    workloads to run only with a single UID. This means some HPC systems do not allow
    user namespaces with multiple UIDs. Since many images come with multiple UIDs,
    Podman added an `ignore_chown_errors` option to containers/storage to allow images
    with files with different UIDs to be flattened into a single UID. Table 5.3 lists
    all the current storage options supported by container storage.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: Podman 正迅速被高性能计算 (HPC) 社区采用。HPC 社区不允许有 root 权限的容器，并且在许多情况下只允许工作负载以单个 UID 运行。这意味着一些
    HPC 系统不允许具有多个 UIDs 的用户命名空间。由于许多镜像都带有多个 UIDs，Podman 为 containers/storage 添加了 `ignore_chown_errors`
    选项，以便将具有不同 UIDs 的文件扁平化到单个 UID。表 5.3 列出了容器存储支持的所有当前存储选项。
- en: 'Note You have examined a few of the storage.conf fields, but there are many
    more. Use the containers-storage.conf man page to explore all of them:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：您已经检查了 storage.conf 的一些字段，但还有很多。使用 containers-storage.conf 手册页来探索所有这些选项：
- en: '[PRE14]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Table 5.3 Container storage drivers
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 表 5.3 容器存储驱动程序
- en: '| Storage drivers | Description |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
  zh: '| 存储驱动程序 | 描述 |'
- en: '| `ignore_chown_errors` | Ignore `chown`ing file UIDs for rootless containers
    with a single UID. There is no entry in /etc/subuid. |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| `ignore_chown_errors` | 忽略对无 root 权限容器中具有单个 UID 的文件进行 `chown` 的 UIDs。/etc/subuid
    中没有条目。|'
- en: '| `mount_program` | Path to a helper program to use for mounting the filesystem
    instead of using a kernel overlay to mount it. Older kernels did not support rootless
    overlay. |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| `mount_program` | 用于挂载文件系统的辅助程序路径，而不是使用内核覆盖来挂载。较旧的内核不支持无 root 权限的覆盖。|'
- en: '| `mountopt` | Comma-separated list of mount options to be passed to the kernel.
    It defaults to `"nodev,metacopy=on"`. |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| `mountopt` | 要传递给内核的挂载选项的逗号分隔列表。默认为 `"nodev,metacopy=on"`。|'
- en: '| `skip_mount_home` | Do not create `PRIVATE` bind mounts on the storage home
    directory. |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| `skip_mount_home` | 不要在存储主目录上创建 `PRIVATE` 绑定挂载。|'
- en: '| `inode` | Maximum number of inodes in a container image |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| `inode` | 容器镜像中 inode 的最大数量 |'
- en: '| `size` | Maximum size of a container image |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| `size` | 容器镜像的最大大小 |'
- en: '| `force_mask` | Permissions mask for new files and directories in an image.
    The values are the following:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '| `force_mask` | 图像中新文件和目录的权限掩码。值如下：'
- en: '`private`—This sets all filesystem objects to `0700`. No other users on the
    system can access the files.'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`private`—这会将所有文件系统对象设置为 `0700`。系统上的其他用户无法访问这些文件。'
- en: '`shared`—This is equivalent to `0755`. Everyone on the system can read, access,
    and execute files in the image. This is useful for sharing container storage with
    other users.'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`shared`—这相当于 `0755`。系统上的每个人都可以读取、访问和执行镜像中的文件。这对于与其他用户共享容器存储很有用。'
- en: All files within the image are made readable and executable by any user on the
    system. Even /etc/shadow within your image is now readable by any user.When `force_mask`
    is set, the original permission mask is stored in `xattr`s, and the `mount_program`,
    like /usr/bin/fuse-overlayfs, presents the `xattr` permissions to processes within
    containers. |
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 图像中的所有文件都允许系统上的任何用户读取和执行。即使您镜像中的 /etc/shadow 现在也可以被任何用户读取。当 `force_mask` 设置时，原始权限掩码存储在
    `xattr`s 中，而 `mount_program`（如 /usr/bin/fuse-overlayfs）向容器内的进程呈现 `xattr` 权限。
- en: Now you know about configuring the container storage! The next configuration
    you will look at is container registry access.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您已经了解了如何配置容器存储！接下来，您将查看的是容器注册表访问的配置。
- en: 5.2 Configuration files for registries
  id: totrans-101
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 5.2 注册表配置文件
- en: Podman uses the github.com/containers/image library for pulling and pushing
    container images, usually from container registries. Podman uses the registries.conf
    configuration file to specify registries and the policy.json file for signature
    verification of images. As with the container storage storage.conf, most users
    never modify these files and just use the distribution defaults.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: Podman 使用 github.com/containers/image 库来拉取和推送容器镜像，通常来自容器注册表。Podman 使用 registries.conf
    配置文件来指定注册表，并使用 policy.json 文件对镜像进行签名验证。与容器存储的 storage.conf 一样，大多数用户永远不会修改这些文件，只是使用发行版的默认设置。
- en: 5.2.1 registries.conf
  id: totrans-103
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5.2.1 registries.conf
- en: The registries.conf configuration file is a system-wide configuration file for
    container image registries. Podman uses $HOME/.config/containers/registries.conf
    if it exists; otherwise, it uses /etc/containers/registries.conf.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: registries.conf 配置文件是容器镜像注册表的系统级配置文件。如果存在，Podman 使用 $HOME/.config/containers/registries.conf；否则，它使用
    /etc/containers/registries.conf。
- en: Note When using Podman in remote mode, for example on a Mac or Windows box,
    registries.conf files are stored in the Linux box on the server side. You need
    to `ssh` into the Linux box to make the changes. With a Podman machine, you can
    execute `podman` `machine` `ssh`. See appendixes E and F for more information.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：当在远程模式下使用 Podman，例如在 Mac 或 Windows 机器上时，registries.conf 文件存储在服务器端的 Linux
    机器上。你需要通过 `ssh` 登录到 Linux 机器以进行更改。使用 Podman 机器，你可以执行 `podman machine ssh`。有关更多信息，请参阅附录
    E 和 F。
- en: The main key value to use with the registries.conf file is `unqualified-search-registries`.
    This field specifies an array of `host[:port]` registries to try when pulling
    via short names, in order. If you specify only one registry in the `unqualified-search-registries`
    option, Podman will work similarly to Docker and force a single registry on the
    user.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 与 registries.conf 文件一起使用的主要键值是 `unqualified-search-registries`。该字段指定了一个 `host[:port]`
    注册库数组，用于通过短名称拉取时尝试，按顺序。如果你在 `unqualified-search-registries` 选项中只指定一个注册库，Podman
    将与 Docker 类似，并强制用户使用单个注册库。
- en: 'In this exercise, you will modify the default search registries to be used
    by Podman. First, you need to make a backup of the /etc/containers/registries.conf
    file, and then remove docker.io and add example.com:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，你需要修改 Podman 使用的默认搜索注册库。首先，你需要备份 /etc/containers/registries.conf 文件，然后删除
    docker.io 并添加 example.com：
- en: '[PRE15]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Modify the following line:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 修改以下行：
- en: '[PRE16]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Change the line to
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 将行更改为
- en: '[PRE17]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Save the file, then execute `podman` `info` to verify the changes:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 保存文件后，执行 `podman info` 以验证更改：
- en: '[PRE18]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Now, if you attempt to pull via an unknown short name, you should see the following
    prompt:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果你尝试通过一个未知的短名称进行拉取，你应该看到以下提示：
- en: '[PRE19]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Copy the original to the registries.conf file:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 将原始内容复制到 registries.conf 文件中：
- en: '[PRE20]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Table 5.4 describes all of the options available in registries.conf files.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 表 5.4 描述了 registries.conf 文件中所有可用的选项。
- en: Table 5.4 Container registries.conf global fields
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 表 5.4 Container registries.conf 全局字段
- en: '| Fields | Description |'
  id: totrans-121
  prefs: []
  type: TYPE_TB
  zh: '| 字段 | 描述 |'
- en: '| `unqualified-search-registries` | An array of `host[:port]` registries to
    try when pulling an unqualified image, in order. |'
  id: totrans-122
  prefs: []
  type: TYPE_TB
  zh: '| `unqualified-search-registries` | 一个 `host[:port]` 注册库数组，用于按顺序尝试拉取未经验证的镜像。|'
- en: '| `short-name-mode` | Determines how Podman should handle short names. The
    values include the following:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '| `short-name-mode` | 确定Podman如何处理短名称。值包括以下内容：'
- en: '`enforcing`—If there is one unqualified search registry, use it. If there are
    two or more registries defined and you are running Podman in a terminal, prompt
    the user to select one of the search registries; otherwise, there will be an error.'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`enforcing`—如果有一个未经验证的搜索注册库，则使用它。如果有两个或更多注册库定义，并且你在终端中运行 Podman，则提示用户选择一个搜索注册库；否则，将出现错误。'
- en: '`permissive`—Behaves as `enforcing` but does not lead to an error if no terminal:
    just uses each entry in unqualified search registries until success.'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`permissive`—行为类似于 `enforcing`，但如果没有终端则不会导致错误：只需使用未经验证的搜索注册库中的每个条目，直到成功。'
- en: '`disabled`—Use all unqualified search registries without prompting.'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`disabled`—使用所有未经验证的搜索注册库而无需提示。'
- en: '|'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| `credential-helpers` | An array of default credential helpers is used as
    external credential stores. Note that containers-auth.json is a reserved value
    to use auth files as specified in `containers-auth.json(5)`. The credential helpers
    are set to `["containers-auth.json"]` if none are specified. |'
  id: totrans-128
  prefs: []
  type: TYPE_TB
  zh: '| `credential-helpers` | 使用默认凭证助手数组作为外部凭证存储。请注意，containers-auth.json 是一个保留值，用于使用
    `containers-auth.json(5)` 中指定的认证文件。如果没有指定任何凭证助手，则将凭证助手设置为 `["containers-auth.json"]`。|'
- en: Blocking pulling from container registries
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 阻止从容器注册库拉取
- en: 'Another interesting thing you can configure in registries.conf is the ability
    to block users from pulling from a container registry. In the following example,
    you will configure registries.conf to block pulls from docker.io. The registries.conf
    file has a specific `[[registry]]` table entry that can specify how to handle
    individual container registries. You can add this table multiple times—once per
    registry:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在 registries.conf 中可以配置的另一个有趣的功能是阻止用户从容器注册库拉取的能力。在以下示例中，你将配置 registries.conf
    以阻止从 docker.io 拉取。registries.conf 文件有一个特定的 `[[registry]]` 表条目，可以指定如何处理单个容器注册库。你可以多次添加此表——每个注册库一次：
- en: '[PRE21]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Add the following:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 添加以下内容：
- en: '[PRE22]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Save the file. Examine the settings using `podman` `info`:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 保存文件。使用 `podman info` 检查设置：
- en: '[PRE23]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Now, attempt to pull an image from docker.io:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，尝试从 docker.io 拉取镜像：
- en: '[PRE24]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: This demonstrates that administrators have the ability to block content from
    specific registries. Table 5.5 describes the suboptions available for the `[[registry]]`
    table in the registries.conf file.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 这表明管理员有阻止来自特定注册表内容的能力。表 5.5 描述了在 registries.conf 文件中的 `[[registry]]` 表中可用的子选项。
- en: 'Note Copy the original registries.conf to pull from docker.io for the rest
    of this book:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：将原始 registries.conf 复制到 docker.io 以从本书的其余部分拉取：
- en: '[PRE25]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Table 5.5 `[[registry]]` table fields
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 表 5.5 `[[registry]]` 表字段
- en: '| Fields | Description |'
  id: totrans-142
  prefs: []
  type: TYPE_TB
  zh: '| 字段 | 描述 |'
- en: '| `location` | Name of the registry/repository to apply the filters on |'
  id: totrans-143
  prefs: []
  type: TYPE_TB
  zh: '| `location` | 要应用筛选器的注册表/存储库名称 |'
- en: '| `prefix` | Select the specified configuration when attempting to pull an
    image matched by the specific prefix. |'
  id: totrans-144
  prefs: []
  type: TYPE_TB
  zh: '| `prefix` | 在尝试拉取与特定前缀匹配的镜像时选择指定的配置。 |'
- en: '| `insecure` | If true, unencrypted HTTP as well as TLS connections with untrusted
    certificates are allowed. |'
  id: totrans-145
  prefs: []
  type: TYPE_TB
  zh: '| `insecure` | 如果为真，则允许未加密的 HTTP 以及与不受信任证书的 TLS 连接。 |'
- en: '| `blocked` | If true, pulling images with matching names is forbidden. |'
  id: totrans-146
  prefs: []
  type: TYPE_TB
  zh: '| `blocked` | 如果为真，则禁止拉取具有匹配名称的镜像。 |'
- en: 'Some users work on systems that are fully isolated from the internet but still
    need to use applications that rely on images from the internet. An example of
    this situation is if you have an application that expects to use registry.access.redhat.com/ubi8/
    httpd-24:latest but has no access to registry.access.redhat.com on the internet.
    You can download the image and put it onto an internal registry and then configure
    registries.conf with a mirror registry. If you configure an entry in registries.conf,
    it will look like this:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 一些用户在完全与互联网隔离的系统上工作，但仍需要使用依赖于互联网镜像的应用程序。这种情况的一个例子是，如果您有一个期望使用 registry.access.redhat.com/ubi8/
    httpd-24:latest 的应用程序，但没有访问 registry.access.redhat.com 的互联网。您可以下载镜像并将其放入内部注册表，然后配置
    registries.conf 以使用镜像注册表。如果您在 registries.conf 中配置条目，它将看起来像这样：
- en: '[PRE26]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Then your users can use the `podman` `pull` command:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，您的用户可以使用 `podman` `pull` 命令：
- en: '[PRE27]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Podman actually pulls mirror-1.com/ubi8/httpd-24:latest, but users will not
    notice the difference.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: Podman 实际上拉取 mirror-1.com/ubi8/httpd-24:latest，但用户不会注意到差异。
- en: 'Note You have examined a few of the registries.conf fields, but there are many
    more. Use the `containers-registries.conf(5)` man page to explore all of them:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：您已经检查了一些 registries.conf 字段，但还有很多。使用 `containers-registries.conf(5)` 手册页来探索所有这些字段：
- en: '[PRE28]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Now that you know how to configure storage and registries, it is time to look
    at how to configure all of the options central to Podman.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经知道了如何配置存储和注册表，是时候看看如何配置 Podman 的所有核心选项了。
- en: 5.3 Configuration files for engines
  id: totrans-155
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 5.3 引擎配置文件
- en: Podman and other container engines use the github.com/containers/common library
    for handling the default settings not related to container storage or container
    registries. These configuration settings come from the containers.conf file. Podman
    reads the files in table 5.6 if they exist.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: Podman 和其他容器引擎使用 github.com/containers/common 库来处理与容器存储或容器注册表无关的默认设置。这些配置设置来自
    containers.conf 文件。如果存在，Podman 会读取表 5.6 中的文件。
- en: Table 5.6 containers.conf files read by both rootful and rootless Podman
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 表 5.6 读取 rootful 和 rootless Podman 的 containers.conf 文件
- en: '| File | Description |'
  id: totrans-158
  prefs: []
  type: TYPE_TB
  zh: '| 文件 | 描述 |'
- en: '| /usr/share/containers/containers.conf | Usually shipped with the distribution
    defaults |'
  id: totrans-159
  prefs: []
  type: TYPE_TB
  zh: '| /usr/share/containers/containers.conf | 通常与发行版默认值一起提供 |'
- en: '| /etc/containers/containers.conf | System administrator can use this file
    to set and modify different defaults. |'
  id: totrans-160
  prefs: []
  type: TYPE_TB
  zh: '| /etc/containers/containers.conf | 系统管理员可以使用此文件来设置和修改不同的默认值。 |'
- en: '| /etc/containers/containers.conf.d/*.conf | Some package tools might drop
    additional default files into this directory, sorted numerically. |'
  id: totrans-161
  prefs: []
  type: TYPE_TB
  zh: '| /etc/containers/containers.conf.d/*.conf | 一些包工具可能会将额外的默认文件放入此目录，按数字排序。 |'
- en: When running in rootless mode, Podman also reads the files in table 5.7 if they
    exist.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 当以 rootless 模式运行时，如果存在，Podman 也会读取表 5.7 中的文件。
- en: Table 5.7 containers.conf files read by rootless Podman
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 表 5.7 rootless Podman 读取的 containers.conf 文件
- en: '| File | Description |'
  id: totrans-164
  prefs: []
  type: TYPE_TB
  zh: '| 文件 | 描述 |'
- en: '| $HOME/.config/containers/containers.conf | Users can create this file to
    override system defaults. |'
  id: totrans-165
  prefs: []
  type: TYPE_TB
  zh: '| $HOME/.config/containers/containers.conf | 用户可以创建此文件以覆盖系统默认值。 |'
- en: '| $HOME/.config/containers/containers.conf.d/*.conf | Users can also drop files
    here if they want, and they will be sorted numerically. |'
  id: totrans-166
  prefs: []
  type: TYPE_TB
  zh: '| $HOME/.config/containers/containers.conf.d/*.conf | 用户也可以将文件放在这里，如果他们愿意，它们将被按数字排序。
    |'
- en: Unlike storage.conf and registries.conf, containers.conf files are merged together,
    and they do not fully override previous versions. Individual fields can override
    the same field in the higher-level containers.conf file. Podman does not require
    any containers.conf file to exist, since it has built-in defaults. Most systems
    come with only the distribution default overrides in /usr/share/containers/containers.conf.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 与 storage.conf 和 registries.conf 不同，containers.conf 文件是合并在一起的，并且它们不会完全覆盖之前的版本。单个字段可以覆盖高级
    containers.conf 文件中的相同字段。由于 Podman 内置了默认设置，因此它不需要任何 containers.conf 文件存在。大多数系统只包含
    /usr/share/containers/containers.conf 中的发行版默认覆盖设置。
- en: Note Podman supports the CONTAINERS_CONF environment variable, which forces
    Podman to use the target of the $CONTAINERS_CONF. All other containers.conf files
    are ignored. This is useful for testing environments or making sure no one has
    customized the Podman defaults.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：Podman 支持使用 CONTAINERS_CONF 环境变量，这会强制 Podman 使用 $CONTAINERS_CONF 的目标。所有其他
    containers.conf 文件都将被忽略。这在测试环境或确保没有人自定义了 Podman 默认设置时非常有用。
- en: containers.conf currently supports five different tables, as shown in table
    5.8\. You need to be careful that you are in the correct table when you modify
    options.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: containers.conf 当前支持五个不同的表格，如表 5.8 所示。当你修改选项时，请确保你处于正确的表格中。
- en: Table 5.8 Containers.conf tables
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 表 5.8：containers.conf 表格
- en: '| Table | Description |'
  id: totrans-171
  prefs: []
  type: TYPE_TB
  zh: '| 表格 | 描述 |'
- en: '| `[containers]` | Configuration on running individual containers. Examples
    are the namespaces to stick containers in, whether or not SELinux is enabled,
    and default environment variables for containers. |'
  id: totrans-172
  prefs: []
  type: TYPE_TB
  zh: '| `[containers]` | 对运行单个容器的配置。例如，将容器粘附在命名空间中、是否启用 SELinux 以及容器的默认环境变量。|'
- en: '| `[engine]` | Default configurations for Podman to use. Examples are the default
    logging system, paths for OCI runtimes to use, and the location of conmon. |'
  id: totrans-173
  prefs: []
  type: TYPE_TB
  zh: '| `[engine]` | Podman 使用时的默认配置。例如，默认的日志系统、OCI 运行时使用的路径以及 conmon 的位置。|'
- en: '| `[service_destinations]` | Remote connection data for use with `podman` `--remote`.
    Remote service is covered in chapter 9. |'
  id: totrans-174
  prefs: []
  type: TYPE_TB
  zh: '| `[service_destinations]` | 与 `podman --remote` 一起使用的远程连接数据。远程服务在第 9 章中有介绍。|'
- en: '| `[secrets]` | Information about the `secrets` plugin driver to use for containers
    |'
  id: totrans-175
  prefs: []
  type: TYPE_TB
  zh: '| `[secrets]` | 关于用于容器的 `secrets` 插件驱动程序的信息 |'
- en: '| `[network]` | Special configuration for network configuration, including
    the default network name, location of CNI plugins, and default subnets |'
  id: totrans-176
  prefs: []
  type: TYPE_TB
  zh: '| `[network]` | 网络配置的特殊配置，包括默认网络名称、CNI 插件的位置以及默认子网 |'
- en: Many users of Podman want to change the default ways it launches containers
    in an environment. I previously explained how the HPC community wants to use Podman
    to run their workloads, but they are very specific about the volumes that get
    added to containers, which environment variables are added, and which namespaces
    are enabled.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 许多 Podman 用户希望改变它在环境中启动容器的方式。我之前解释了高性能计算社区如何希望使用 Podman 来运行他们的工作负载，但他们对于添加到容器中的卷、添加的环境变量以及启用的命名空间有非常具体的要求。
- en: Perhaps you want all of your containers to have the same environment variables
    set. Let’s try an example. Run `podman` to show the default environment in the
    ubi8 image.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 可能你希望所有容器的环境变量都设置得相同。让我们尝试一个例子。运行 `podman` 来显示 ubi8 镜像中的默认环境。
- en: '[PRE29]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Note When using Podman in remote mode, for example on a Mac or Windows box,
    most of the settings of the containers.conf files are used from the Linux box
    on the server side. A containers.conf file in the user’s home directory is used
    for storing connection data, which is covered in chapter 9\. Mac and Windows clients
    are covered in appendixes E and F.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：当在远程模式下使用 Podman，例如在 Mac 或 Windows 机器上时，大多数 containers.conf 文件的设置都是从服务器端的
    Linux 机器上使用的。用户主目录中的 containers.conf 文件用于存储连接数据，这部分内容在第 9 章中有详细说明。Mac 和 Windows
    客户端在第 E 和 F 附录中有介绍。
- en: 'Now create an env.conf file in the home directory with the `env="[foo=bar]"`
    set:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 现在在主目录中创建一个名为 env.conf 的文件，并设置 `env="[foo=bar]"`：
- en: '[PRE30]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'I use containers.conf when configuring Podman to run within a container. Many
    users want to run Podman within a container for CI/CD systems or for just testing
    out newer versions of Podman than their distribution enables. Because lots of
    people were having a hard time running Podman in a container, I decided to try
    to create a default image, quay.io/podman/stable, to help them. While creating
    that image, I realized several of the Podman defaults did not work well when running
    it within a container, so I used containers.conf to change those settings. You
    can see my containers.conf file at this link: [http://mng.bz/o5DM](http://mng.bz/o5DM).'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 我使用 containers.conf 来配置 Podman 在容器内运行。许多用户希望将 Podman 运行在容器内，用于 CI/CD 系统，或者只是测试比他们的发行版提供的
    Podman 更新版本的 Podman。由于很多人在容器内运行 Podman 时遇到了困难，我决定尝试创建一个默认镜像 quay.io/podman/stable，以帮助他们。在创建该镜像时，我意识到
    Podman 的几个默认设置在容器内运行时效果不佳，因此我使用了 containers.conf 来更改这些设置。您可以通过此链接查看我的 containers.conf
    文件：[http://mng.bz/o5DM](http://mng.bz/o5DM)。
- en: 'You can see the contains.conf by actually running the image:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过实际运行镜像来查看 contains.conf：
- en: '[PRE31]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Here was what I was thinking while writing this file. First, I decided that
    since Podman is running inside of a container, I would disable all of the cgroups
    and namespaces other than the mount and user namespace. If users set cgroups or
    configured namespaces, then the container run by Podman in a container would follow
    the parent Podman’s rules:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 在编写此文件时，我考虑了以下几点。首先，由于 Podman 在容器内运行，我决定除了挂载和用户命名空间之外，禁用所有其他 cgroups 和命名空间。如果用户设置了
    cgroups 或配置了命名空间，那么 Podman 在容器内运行的容器将遵循父 Podman 的规则：
- en: '[PRE32]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'The default `log_driver`, event logger, and cgroup manager on many distributions
    is journald and system, respectively, but inside of the container, systemd and
    journald are not running, so the container engine needs to use the filesystem:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 许多分布默认的 `log_driver`、事件记录器和 cgroup 管理器分别是 journald 和 system，但在容器内，systemd 和
    journald 都没有运行，因此容器引擎需要使用文件系统：
- en: '[PRE33]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Finally, use the OCI runtime `crun` rather than `runc`, mainly because `crun`
    is a lot smaller than `runc`:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，使用 OCI 运行时 `crun` 而不是 `runc`，主要是因为 `crun` 比较小：
- en: '[PRE34]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Now attempt to run a container within a container. A trick needed to make this
    work is running the podman/stable image with `--user` `podman`. This causes the
    Podman inside the container to run in rootless mode. Since the podman/stable image
    uses the `fuse-overlay` driver within the container, you also need to add the
    /dev/fuse device:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 现在尝试在一个容器内运行一个容器。使这成为可能的一个技巧是使用 `--user podman` 运行 podman/stable 镜像。这会导致容器内的
    Podman 以无根模式运行。由于 podman/stable 镜像在容器内使用 `fuse-overlay` 驱动程序，因此你还需要添加 /dev/fuse
    设备：
- en: '[PRE35]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Note You examined a few of the containers.conf fields, but there are many more.
    Use the `container.conf(5)` man page to explore all of them:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：您检查了几个 containers.conf 字段，但还有很多。使用 `container.conf(5)` 手册页来探索所有这些字段：
- en: '[PRE36]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Now you know more about configuration tools specific to container tools like
    Podman. Next, you’ll learn about some other system configuration files Podman
    needs.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经了解了针对容器工具如 Podman 的特定配置工具。接下来，你将了解 Podman 需要的一些其他系统配置文件。
- en: 5.4 System configuration files
  id: totrans-197
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 5.4 系统配置文件
- en: When you run rootless Podman, you are using the /etc/subuid and /etc/subgid
    files to specify the UID ranges for your containers. As I explained in section
    3.1.2, Podman reads the /etc/subuid and /etc/subgid files for UID and GID ranges
    allocated for your user account. Podman then launches /usr/bin/newuidmap and /usr/bin/newgidmap,
    which verifies the range of UIDs and GIDs Podman specified are actually allocated
    to you. In certain cases you need to modify these files to add UIDs. Tools like
    `useradd` automatically update the /etc/subuid and /etc/subgid when you add new
    users to your system. For example, when I installed my laptop, `useradd` set up
    my user account to use UID `3267` and added the mapping `dwalsh:100000:65536`
    to /etc/subuid and /etc/subgid. Figure 5.2 shows what containers based on this
    mapping look like on my system.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 当你运行无根 Podman 时，你正在使用 /etc/subuid 和 /etc/subgid 文件来指定容器的 UID 范围。正如我在 3.1.2 节中解释的那样，Podman
    读取 /etc/subuid 和 /etc/subgid 文件以获取为你的用户账户分配的 UID 和 GID 范围。然后，Podman 启动 /usr/bin/newuidmap
    和 /usr/bin/newgidmap，这些程序会验证 Podman 指定的 UID 和 GID 范围实际上是否分配给了你。在某些情况下，你需要修改这些文件来添加
    UID。例如，当我安装我的笔记本电脑时，`useradd` 将我的用户账户设置为使用 UID `3267`，并将映射 `dwalsh:100000:65536`
    添加到 /etc/subuid 和 /etc/subgid。图 5.2 展示了基于此映射在我的系统上看起来像什么容器。
- en: '![](../../OEBPS/Images/05-02.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/05-02.png)'
- en: Figure 5.2 User namespace mapping for containers
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.2 容器用户命名空间映射
- en: Note You want to keep the ranges of UIDs unique for each user and ensure they
    are not overlapping with any system UIDs. Podman and the system do not verify
    there is no overlap. If two different users had the same UIDs in their range,
    the processes in the containers would be allowed to attack each other from the
    user namespace perspective. Verifying this is a manual process. The `useradd`
    tool automatically selects unique ranges.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：您希望为每个用户保留唯一的 UID 范围，并确保它们不与任何系统 UID 冲突。Podman 和系统不会验证是否存在冲突。如果两个不同的用户在其范围内有相同的
    UID，容器中的进程将允许从用户命名空间的角度相互攻击。验证这是一个手动过程。`useradd` 工具会自动选择唯一的范围。
- en: 'As the `subuid(5)` and `subgid(5)` man pages explain, each line in /etc/subuid
    and /etc/subgid contains a username and a range of subordinate user IDs or GIDs,
    respectively, that the user is allowed to use. The entry is specified with three
    fields delimited by colons. These fields are the following:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 如 `subuid(5)` 和 `subgid(5)` 手册页所述，`/etc/subuid` 和 `/etc/subgid` 中的每一行都包含一个用户名和一个用户允许使用的从属用户
    ID 或 GID 的范围。条目由冒号分隔的三个字段指定。这些字段如下：
- en: Login name or UID
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 登录名或 UID
- en: Numerical subordinate user ID or group ID
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数值从属用户 ID 或组 ID
- en: Numerical subordinate user ID or group ID count
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数值从属用户 ID 或组 ID 计数
- en: Newer versions of the operating system, specifically the packages that ship
    /usr/bin/ newuidmap and /usr/bin/newgidmap, are gaining the ability to share the
    contents of these files via the network from an LDAP server. On Fedora, these
    executables are shipped in the `shadow-utils` package. Versions 4.9 or later have
    this feature.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 操作系统的较新版本，特别是包含 `/usr/bin/newuidmap` 和 `/usr/bin/newgidmap` 软件的包，正在获得通过 LDAP
    服务器共享这些文件内容的能力。在 Fedora 上，这些可执行文件包含在 `shadow-utils` 包中。版本 4.9 或更高版本具有此功能。
- en: 'Tip Changes to /etc/subuid and /etc/subgid may not be immediately reflected
    in the user’s account. This is a common problem for users who modify these files
    after they have already run Podman. But remember: when Podman first runs, it launches
    the `podman` `pause` process in the user namespace, and then all other containers
    join this Podman process’s user namespace. To have a new user namespace take effect,
    you must execute the `podman` `system` `migrate` command, which stops the `podman`
    `pause` process and re-creates the user namespace.'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 小贴士：对 `/etc/subuid` 和 `/etc/subgid` 的更改可能不会立即反映在用户的账户中。这是修改这些文件后已经运行 Podman
    的用户常见的问题。但请记住：当 Podman 首次运行时，它会在用户命名空间中启动 `podman pause` 进程，然后所有其他容器都加入这个 Podman
    进程的用户命名空间。要使新的用户命名空间生效，您必须执行 `podman system migrate` 命令，该命令停止 `podman pause` 进程并重新创建用户命名空间。
- en: Summary
  id: totrans-208
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Podman has multiple configuration files based on the libraries it uses.
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Podman 根据所使用的库具有多个配置文件。
- en: Configuration files are shared between rootful and rootless environments.
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置文件在 rootful 和 rootless 环境之间共享。
- en: The storage.conf file is used to configure containers/storage, including the
    storage driver as well as the location where containers and their images are to
    be stored.
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`storage.conf` 文件用于配置 `containers/storage`，包括存储驱动程序以及容器及其镜像的存储位置。'
- en: The registries.conf and policy.json files are used to configure the container/
    image library—primarily affecting access to container registries, short names,
    and mirror sights.
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`registries.conf` 和 `policy.json` 文件用于配置容器/镜像库——主要影响对容器注册库、短名称和镜像站的访问。'
- en: The containers.conf file is used to configure all of the other defaults used
    within Podman.
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`containers.conf` 文件用于配置 Podman 内部使用的所有其他默认设置。'
- en: System configuration files /etc/subuid and /etc/subgid are used to configure
    the user namespace required for running rootless Podman.
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统配置文件 `/etc/subuid` 和 `/etc/subgid` 用于配置运行无根 Podman 所需的用户命名空间。
