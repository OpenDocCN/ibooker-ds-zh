- en: Chapter 11\. Validating forms
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第 11 章. 验证表单
- en: '*This chapter covers*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*本章涵盖*'
- en: Using built-in form validators
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用内置表单验证器
- en: Creating custom validators
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建自定义验证器
- en: Handling sync and async validation
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理同步和异步验证
- en: The user fills out a form and clicks Submit, expecting that the app will process
    the data in some way. In web applications, the data is usually sent to the server.
    Often, the user receives some data back (for example, search results), but sometimes,
    the data is just saved in the server’s storage (for example, creating a new order).
    In any case, the data should be valid so the server’s software can do its job
    properly.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 用户填写表单并点击提交，期望应用程序以某种方式处理数据。在 Web 应用程序中，数据通常被发送到服务器。通常，用户会收到一些数据回传（例如，搜索结果），但有时，数据只是保存在服务器的存储中（例如，创建新订单）。在任何情况下，数据都应该是有效的，以便服务器的软件能够正确地执行其工作。
- en: For example, an app can’t log in a user unless they’ve provided a user ID and
    a password in the login form. Both fields are required—otherwise, the form isn’t
    valid. You shouldn’t even allow submitting this form until the user has filled
    out all required fields. A user registration form may be considered invalid if
    the password doesn’t contain at least 8 characters, including a number, an uppercase
    letter, and a special character.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，应用程序不能在没有在登录表单中提供用户 ID 和密码的情况下登录用户。这两个字段都是必需的——否则，表单无效。您甚至不应允许用户在填写所有必需字段之前提交此表单。如果密码不包含至少
    8 个字符，包括一个数字、一个大写字母和一个特殊字符，则用户注册表单可能被认为是无效的。
- en: In this chapter, we’ll show you how to validate forms in Angular using built-in
    validators and how to create custom forms. At the end of the chapter, you’ll develop
    a new version of ngAuction that will include three fields. The entered values
    will be validated first, and only afterward will they be submitted for finding
    products that meet entered criteria.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将向您展示如何使用内置验证器在 Angular 中验证表单以及如何创建自定义表单。在本章末尾，您将开发 ngAuction 的新版本，该版本将包含三个字段。输入的值将首先进行验证，然后才会提交以查找符合输入标准的商品。
- en: We’ll start exploring built-in validators by using a reactive form and then
    move to a template-driven one.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先通过使用响应式表单来探索内置验证器，然后转向模板驱动型验证器。
- en: 11.1\. Using built-in validators
  id: totrans-9
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.1. 使用内置验证器
- en: The Angular Forms API includes the `Validators` class, with static functions
    such as `required()`, `minLength()`, `maxLength()`, `pattern()`, `email()`, and
    others. These built-in validators can be used in templates by specifying the directives
    `required`, `minLength`, `maxLength`, `pattern`, and `email`, respectively. The
    `pattern` validator enables you to specify a regular expression.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: Angular 表单 API 包含 `Validators` 类，其中包含静态函数，如 `required()`、`minLength()`、`maxLength()`、`pattern()`、`email()`
    等。这些内置验证器可以通过指定指令 `required`、`minLength`、`maxLength`、`pattern` 和 `email` 分别在模板中使用。`pattern`
    验证器允许您指定一个正则表达式。
- en: Validators are functions that conform to the interface in the following listing.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 验证器是符合以下列表中接口的函数。
- en: Listing 11.1\. The `ValidatorFn` interface
  id: totrans-12
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.1. `ValidatorFn` 接口
- en: '[PRE0]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'If a validator function returns null, that means no errors. Otherwise, it’ll
    return a `ValidationErrors` object of type `{[key: string]: any}`, where the property
    names (error names) are strings, and values (error descriptions) can be of any
    type.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '如果验证器函数返回 null，则表示没有错误。否则，它将返回一个类型为 `{[key: string]: any}` 的 `ValidationErrors`
    对象，其中属性名（错误名称）是字符串，而值（错误描述）可以是任何类型。'
- en: A validator function should declare a single argument of type `AbstractControl`
    (or its descendants) and return an object literal or null. There, you implement
    business logic for validating user input. `AbstractControl` is the superclass
    for `FormControl`, `FormGroup`, and `FormArray`; hence, validators can be created
    for all model classes.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 验证器函数应声明一个类型为 `AbstractControl`（或其子类）的单个参数，并返回一个对象字面量或 null。在那里，你实现业务逻辑以验证用户输入。`AbstractControl`
    是 `FormControl`、`FormGroup` 和 `FormArray` 的超类；因此，可以为所有模型类创建验证器。
- en: With the reactive Forms API, you can either provide validators while creating
    a form or form control or attach validators dynamically during runtime. The next
    listing shows an example that attaches the `required` validator to the form control
    represented by the variable `username`.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 使用响应式表单 API，您可以在创建表单或表单控件时提供验证器，也可以在运行时动态附加验证器。下面的列表显示了将 `required` 验证器附加到由变量
    `username` 表示的表单控件的示例。
- en: Listing 11.2\. Attaching the `required` validator
  id: totrans-17
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.2. 附加 `required` 验证器
- en: '[PRE1]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '***1* Attaches the required validator to a FormControl**'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1. 将所需的验证器附加到 FormControl**'
- en: Here, the first parameter of the constructor is the initial value of the control,
    and the second is the validator function. You can also attach more than one validator
    to a form control.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，构造函数的第一个参数是控件的初始值，第二个是验证器函数。您还可以将多个验证器附加到表单控件上。
- en: Listing 11.3\. Attaching two validators
  id: totrans-21
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.3\. 附加两个验证器
- en: '[PRE2]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '***1* Attaches required and minLength validators to a FormControl**'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 将必填和最小长度验证器附加到 FormControl**'
- en: 'To query the form or form control’s validity, use the `valid` property, which
    can have one of two values, `true` or `false`:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 要查询表单或表单控件的验证状态，请使用 `valid` 属性，它可以是两个值之一，`true` 或 `false`：
- en: '[PRE3]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The preceding line checks whether the value entered in the form control passes
    or fails all the validation rules attached to this control. If any of the rules
    fails, you’ll get error objects generated by the validator functions, as in the
    next listing.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 上一行检查表单控件中输入的值是否通过附加到该控件的全部验证规则。如果任何规则失败，您将获得由验证器函数生成的错误对象，如下一个列表所示。
- en: Listing 11.4\. Getting validators’ errors
  id: totrans-27
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.4\. 获取验证器的错误
- en: '[PRE4]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '***1* Gets all errors reported by validators**'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 获取验证器报告的所有错误**'
- en: With the method `hasError()`, you can check whether a form or control has specific
    errors and conditionally show or hide corresponding error messages.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `hasError()` 方法，您可以检查表单或控件是否有特定错误，并条件性地显示或隐藏相应的错误信息。
- en: Now let’s see how to apply built-in validators in a template-driven form. You’ll
    create an app that illustrates how to show or hide error messages for `required`,
    `minLength`, and `pattern` validators. The UI of this app may look like [figure
    11.1](#ch11fig01) if the user enters an invalid phone number.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们来看看如何在模板驱动的表单中应用内置验证器。您将创建一个应用，说明如何为 `required`、`minLength` 和 `pattern`
    验证器显示或隐藏错误信息。如果用户输入无效的电话号码，此应用的 UI 可能看起来像 [图 11.1](#ch11fig01)。
- en: Figure 11.1\. Showing validation errors
  id: totrans-32
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 11.1\. 展示验证错误
- en: '![](Images/11fig01.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig01.jpg)'
- en: The app component’s template will include the `<div>` element with error messages
    located under the `<input>`, and the `<div>` will be hidden if the phone number
    is valid or if its value wasn’t entered (*pristine*), as shown in the following
    listing. The Submit button will stay disabled until the user enters a value that
    passes all validators.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 应用组件的模板将包括位于 `<input>` 下的 `<div>` 元素，其中包含错误信息。如果电话号码有效或其值未输入（*pristine*），则 `<div>`
    将被隐藏，如下面的列表所示。提交按钮将保持禁用状态，直到用户输入一个通过所有验证器的值。
- en: Listing 11.5\. Conditionally showing and hiding errors
  id: totrans-35
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.5\. 条件性地显示和隐藏错误
- en: '[PRE5]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '***1* Adds the required validator**'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 添加必填验证器**'
- en: '***2* Adds the pattern validator to allow only digits**'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 添加模式验证器以允许仅数字**'
- en: '***3* Adds the minlength validator**'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 添加最小长度验证器**'
- en: '***4* The local variable #phone gives access to the value of this control’s
    model.**'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 局部变量 #phone 提供了对该控件模型值的访问。**'
- en: '***5* Hides the errors section if the form control is valid or pristine**'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***5* 如果表单控件有效或 pristine，则隐藏错误部分**'
- en: '***6* Shows the error message if the value was entered and then erased**'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***6* 如果输入了值然后删除，则显示错误信息**'
- en: '***7* Shows the error message if the value violates the minlength requirement**'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***7* 如果值违反最小长度要求，则显示错误信息**'
- en: '***8* Shows the error message if the value doesn’t match the regular expression**'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***8* 如果值不匹配正则表达式，则显示错误信息**'
- en: '***9* Disables the Submit button until the form is valid**'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***9* 在表单有效之前禁用提交按钮**'
- en: 'To see this app in action, run `npm install` in the project folder named form-validation,
    and then run the following command:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看此应用的运行情况，请在名为 form-validation 的项目文件夹中运行 `npm install`，然后运行以下命令：
- en: '[PRE6]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '|  |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**The ValidationErrors object**'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**验证错误对象**'
- en: 'The error returned by a validator is represented by a JavaScript object that
    has a property whose name briefly describes an error. The property value can be
    of any type and may provide additional error details. For example, the standard
    `Validators.minLength()` validator returns an error object as shown here:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 验证器返回的错误由一个具有描述错误名称属性的 JavaScript 对象表示。属性值可以是任何类型，并且可能提供额外的错误详细信息。例如，标准的 `Validators.minLength()`
    验证器返回的错误对象如下所示：
- en: '[PRE7]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'This object has a property named `minlength`, which means that the minimum
    length is invalid. The value of this property is also an object with two fields:
    `requiredLength` and `actualLength`. These error details can be used to display
    a user-friendly error message. Not all validators provide error details. Sometimes,
    the property just indicates that an error has occurred. In this case, the property
    is initialized with the value `true`.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 此对象有一个名为`minlength`的属性，表示最小长度无效。此属性的值也是一个具有两个字段的对象：`requiredLength`和`actualLength`。这些错误详情可用于显示友好的错误消息。并非所有验证器都提供错误详情。有时，该属性仅指示已发生错误。在这种情况下，该属性被初始化为`true`。
- en: 'The following snippet shows an example of the built-in `Validators.required()`
    error object:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码片段展示了内置`Validators.required()`错误对象的示例：
- en: '[PRE8]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: In [section 11.6](#ch11lev1sec6), you’ll find an example of how to extract the
    error description from the `ValidationErrors` object.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第 11.6 节](#ch11lev1sec6)中，您将找到一个如何从`ValidationErrors`对象中提取错误描述的示例。
- en: '|  |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '[Table 11.1](#ch11table01) provides a brief description of Angular built-in
    validators offered by the `Validators` class.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '[表 11.1](#ch11table01) 提供了由`Validators`类提供的Angular内置验证器的简要描述。'
- en: Table 11.1\. Built-in validators
  id: totrans-58
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表 11.1\. 内置验证器
- en: '| Validator | Description |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| 验证器 | 描述 |'
- en: '| --- | --- |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| min | A value can’t be less than the specified number; it can be used only
    with reactive forms. |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| min | 值不能小于指定的数字；它只能与响应式表单一起使用。 |'
- en: '| max | A value can’t be greater than the specified number; it can be used
    only with reactive forms. |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| max | 值不能大于指定的数字；它只能与响应式表单一起使用。 |'
- en: '| required | The form control must have a non-empty value. |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| required | 表单控件必须有一个非空值。 |'
- en: '| requiredTrue | The form control must have the value true. |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| requiredTrue | 表单控件必须具有true值。 |'
- en: '| email | The form control value must be a valid email. |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| email | 表单控件值必须是一个有效的电子邮件地址。 |'
- en: '| minLength | The form control must have a value of a minimum length. |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| minLength | 表单控件必须具有最小长度的值。 |'
- en: '| maxLength | The form control can’t have more than the specified number of
    characters. |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| maxLength | 表单控件不能超过指定的字符数。 |'
- en: '| pattern | The form control’s value must match the specified regular expression.
    |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| pattern | 表单控件值必须匹配指定的正则表达式。 |'
- en: In the code sample that validated the phone number, the validators were checking
    the value after each character entered by the user. Is it possible to control
    when validation starts?
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在验证电话号码的代码示例中，验证器会在用户输入每个字符后检查值。是否可以控制验证何时开始？
- en: 11.2\. Controlling when validation starts
  id: totrans-70
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.2\. 控制验证开始的时间
- en: 'Prior to Angular 5, the validators performed their work each time a value in
    the form control changed. Now, you can use the `updateOn` property, which gives
    you better control over the validation process. When you attach a validator, you
    can specify when validation should start. The `updateOn` property can take one
    of these values:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在Angular 5之前，验证器会在表单控件中的每个值更改时执行其工作。现在，您可以使用`updateOn`属性，这使您能够更好地控制验证过程。当您附加验证器时，您可以指定验证应该何时开始。`updateOn`属性可以取以下值之一：
- en: '**`change`—** This is the default mode, with validators checking a value as
    soon as it changes. You saw this behavior in the previous section when validating
    a phone number.'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**`change`—** 这是默认模式，验证器会在值更改时立即检查值。您在上一节验证电话号码时看到了这种行为。'
- en: '**`blur`—** Checks validity of a value when the control loses focus.'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**`blur`—** 当控件失去焦点时检查值的有效性。'
- en: '**`submit`—** Checks validity when the user submits the form.'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**`submit`—** 当用户提交表单时检查有效性。'
- en: To try out these options with a template-driven form, add `[ngModelOptions]=
    "{updateOn:'blur'}"` to the telephone input field in [listing 11.5](#ch11ex05),
    and the user’s input will be validated only when you move the focus from this
    control. To start validation when the Submit button is clicked or the Enter key
    is pressed, use the option `[ngModelOptions]="{updateOn:'submit'}"`.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 要尝试使用模板驱动的表单使用这些选项，请将`[ngModelOptions]= "{updateOn:'blur'}"`添加到[列表 11.5](#ch11ex05)中的电话输入字段，这样当用户将焦点从该控件移开时，才会进行验证。要当提交按钮被点击或按下Enter键时开始验证，请使用选项`[ngModelOptions]="{updateOn:'submit'}"`。
- en: '|  |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-77
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: 'If you use the sample from [listing 11.5](#ch11ex05) with the option `updateOn:
    ''submit''`, remove the code that conditionally disables the Submit button or
    use the Enter key to test the validation.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '如果您使用[列表 11.5](#ch11ex05)中的示例，并使用选项`updateOn: ''submit''`，请移除条件禁用提交按钮的代码或使用Enter键来测试验证。'
- en: '|  |'
  id: totrans-79
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: In case of the reactive API, you would set the update mode for a form as follows.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在反应式 API 的情况下，你可以按如下方式设置表单的更新模式。
- en: Listing 11.6\. Applying validators on blur using the reactive API
  id: totrans-81
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.6\. 使用反应式 API 在失焦时应用验证器
- en: '[PRE9]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '***1* Attaches the minLength validator to a FormControl**'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 将 minLength 验证器附加到 FormControl**'
- en: '***2* Validates the value when focus moves out of the FormControl**'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 当焦点从 FormControl 中移出时验证值**'
- en: You can also specify the update mode on the form level using the property `ngFormOptions`,
    as shown in the following listing.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以使用属性 `ngFormOptions` 在表单级别指定更新模式，如下面的列表所示。
- en: Listing 11.7\. Applying validators on blur using template-driven API
  id: totrans-86
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.7\. 使用模板驱动 API 在失焦时应用验证器
- en: '[PRE10]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '***1* Each form control is validated when focus moves out of it.**'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 当焦点从一个表单控件移出时，每个表单控件都会被验证。**'
- en: Built-in validators are good for basic validation, but what if you need to apply
    application-specific logic to decide whether the entered value is valid?
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 内置验证器适用于基本验证，但如果你需要应用特定于应用程序的逻辑来决定输入的值是否有效呢？
- en: 11.3\. Custom validators in reactive forms
  id: totrans-90
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.3\. 反应式表单中的自定义验证器
- en: You can create custom validators in Angular. Similar to built-in validators,
    custom validators should comply with the interface in the following listing.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在 Angular 中创建自定义验证器。与内置验证器类似，自定义验证器应遵守以下列表中的接口。
- en: Listing 11.8\. The interface custom validators must conform to
  id: totrans-92
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.8\. 自定义验证器必须遵守的接口
- en: '[PRE11]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '***1* In case of errors, returns the ValidationErrors object; otherwise, null**'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 在出错的情况下，返回 ValidationErrors 对象；否则，返回 null**'
- en: You need to declare a function that accepts an instance of one of the control
    types—`FormControl`, `FormGroup`, or `FormArray`—and returns the `ValidationErrors`
    object or null. The next listing shows an example of a custom validator that checks
    whether the control’s value is a valid social security number (SSN).
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要声明一个函数，该函数接受控制类型（`FormControl`、`FormGroup` 或 `FormArray`）的实例，并返回 `ValidationErrors`
    对象或 null。下面的列表显示了检查控件值是否为有效的社会安全号码（SSN）的自定义验证器示例。
- en: Listing 11.9\. A sample custom validator
  id: totrans-96
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.9\. 一个示例自定义验证器
- en: '[PRE12]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '***1* Validates the FormControl and returns either an error object or null**'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 验证 FormControl 并返回一个错误对象或 null**'
- en: '***2* Gets the control’s value if available, or uses an empty string otherwise**'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 如果可用，则获取控件值，否则使用空字符串**'
- en: '***3* Matches the value against a regular expression that represents the SSN
    nine-digit format**'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 将值与表示 SSN 九位格式的正则表达式进行匹配**'
- en: '***4* If the value is an invalid SSN, returns the error object; the error name
    is ssn**'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 如果值是无效的 SSN，则返回错误对象；错误名称是 ssn**'
- en: You can attach custom validators to form controls the same way you attach the
    built-in ones, as you can see in the following listing.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以像附加内置验证器一样附加自定义验证器到表单控件，如下面的列表所示。
- en: Listing 11.10\. Attaching custom validators to form controls
  id: totrans-103
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.10\. 将自定义验证器附加到表单控件
- en: '[PRE13]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '***1* Shows an error message if the socialSecurity form control has the error
    named ssn**'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 如果 socialSecurity 表单控件有名为 ssn 的错误，则显示错误信息**'
- en: '***2* Attaches your custom ssnValidator**'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 附加你的自定义 ssnValidator**'
- en: You’ll see a window with an input field that requires you to enter nine digits
    to make the error message go away.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 你将看到一个输入字段，需要你输入九位数字以消除错误信息。
- en: 'Your `ssnValidator` returns an error object that indicates there’s something
    wrong with the SSN value: `{ ssn: true }`. You added the error text “SSN is invalid”
    to the HTML template. The `ValidationErrors` object can contain a more specific
    description of the error, for example `{ssn: {description: ''SSN is invalid''}}`,
    and you can get the error description using the `getError()` method. The following
    listing shows a modified version of `ssnValidator` and the template.'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '你的 `ssnValidator` 返回一个错误对象，指示 SSN 值存在问题：`{ ssn: true }`。你将错误文本“SSN 无效”添加到 HTML
    模板中。`ValidationErrors` 对象可以包含更具体的错误描述，例如 `{ssn: {description: ''SSN is invalid''}}`，你可以使用
    `getError()` 方法获取错误描述。下面的列表显示了修改后的 `ssnValidator` 和模板。'
- en: Listing 11.11\. Adding the error description in a custom validator
  id: totrans-109
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.11\. 在自定义验证器中添加错误描述
- en: '[PRE14]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '***1* Creates a specific object with the description property that contains
    the description of the error**'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 创建一个包含错误描述的特定对象**'
- en: '***2* Gets the error message from the description property of the error**'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 从错误的描述属性中获取错误信息**'
- en: '***3* Shows an error message if the socialSecurity form control got the error
    named ssn**'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 如果 socialSecurity 表单控件获得了名为 ssn 的错误，则显示错误信息**'
- en: '|  |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-115
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: In [listing 11.10](#ch11ex10), you use Angular’s *safe navigation operator*,
    which is represented by a question mark and can be used in the component template.
    The question mark after the invocation of `getError()` means “Don’t try to access
    the property `description` if the object returned by `getError()` is undefined
    or null,” meaning when the entered value is valid. If you didn’t use the safe
    navigation operator, this code would produce the runtime error “cannot read property
    `description` of null” for valid SSN values.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [列表11.10](#ch11ex10) 中，你使用了 Angular 的 *安全导航操作符*，它由一个问号表示，可以在组件模板中使用。`getError()`
    调用后的问号表示“如果 `getError()` 返回的对象是未定义或 null，则不要尝试访问 `description` 属性”，这意味着当输入的值有效时。如果你没有使用安全导航操作符，此代码将为有效的
    SSN 值产生运行时错误“无法读取 null 的属性 `description`”。
- en: '|  |'
  id: totrans-117
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: If you run this app, the browser shows an empty input field and the message
    “SSN is invalid,” but the user didn’t have the chance to enter any value. Before
    showing a validation error message, always check whether the form control is `dirty`
    (has been modified). The `<span>` element should look like the following listing.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你运行此应用，浏览器将显示一个空白的输入字段和消息“SSN 无效”，但用户没有机会输入任何值。在显示验证错误消息之前，始终检查表单控件是否 `dirty`（已被修改）。`<span>`
    元素应如下所示。
- en: Listing 11.12\. Using the `dirty` flag
  id: totrans-119
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表11.12\. 使用 `dirty` 标志
- en: '[PRE15]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '***1* Checks whether the form control has been modified**'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 检查表单控件是否已被修改**'
- en: 'Now let’s add some styling to this form. Angular’s Forms API offers a number
    of CSS classes that work hand in hand with their respective flags on the form:
    `.ng-valid`, `.ng-invalid`, `.ng-pending`, `.ng-pristine`, `.ng-dirty`, `.ng-untouched`,
    and `.ng-touched`. In the code sample, if the value is invalid and dirty, you
    want to change the background of the input field to be light pink, as shown in
    the following listing.'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们给这个表单添加一些样式。Angular 的表单 API 提供了多个 CSS 类，它们与表单上的相应标志协同工作：`.ng-valid`、`.ng-invalid`、`.ng-pending`、`.ng-pristine`、`.ng-dirty`、`.ng-untouched`
    和 `.ng-touched`。在代码示例中，如果值无效且已修改，你想要将输入字段的背景色改为浅粉色，如下面的列表所示。
- en: Listing 11.13\. Adding styles to the input field
  id: totrans-123
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表11.13\. 为输入字段添加样式
- en: '[PRE16]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '***1* Adds the CSS selector social**'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 添加 CSS 选择器 social**'
- en: '***2* Is the field dirty and invalid?**'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 字段是否已修改且无效？**'
- en: '***3* Changes the background to light pink**'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 将背景色改为浅粉色**'
- en: 'The application that illustrates the use of `ssnValidator` in a reactive form
    is located in the reactive-validator directory, and you can run it as follows:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 展示 `ssnValidator` 在响应式表单中使用的应用程序位于 reactive-validator 目录中，你可以按照以下方式运行它：
- en: '[PRE17]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '[Figure 11.2](#ch11fig02) shows how the browser will render this app if the
    value isn’t valid.'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '[图11.2](#ch11fig02) 展示了如果值无效，浏览器将如何渲染此应用。'
- en: Figure 11.2\. Showing the validation error and changing the background color
  id: totrans-131
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图11.2\. 显示验证错误和更改背景颜色
- en: '![](Images/11fig02.jpg)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig02.jpg)'
- en: 'Now that you know how to create a custom validator for a single form control,
    let’s consider another scenario: validating a group of form controls.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经知道如何为单个表单控件创建自定义验证器，让我们考虑另一个场景：验证一组表单控件。
- en: 11.4\. Validating a group of controls
  id: totrans-134
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.4\. 验证一组控件
- en: You can validate a group of form controls by attaching validator functions to
    a `FormGroup` instead of an individual `FormControl`. The following listing creates
    an `equalValidator` that ensures that the password and password confirmation fields
    on the sample user registration form have the same value.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过将验证器函数附加到 `FormGroup` 而不是单个 `FormControl` 来验证一组表单控件。以下列表创建了一个 `equalValidator`，确保在示例用户注册表单上的密码和密码确认字段具有相同的值。
- en: Listing 11.14\. A sample validator for a `FormGroup`
  id: totrans-136
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表11.14\. `FormGroup` 的一个示例验证器
- en: '[PRE18]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '***1* Using rest parameters, gets the names of all properties of FormGroup.value**'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 使用剩余参数，获取 FormGroup.value 的所有属性名称**'
- en: '***2* Iterates through the properties’ values to check if they’re equal**'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 遍历属性值以检查它们是否相等**'
- en: '***3* If equal, returns null; otherwise, returns an error object with the error
    named equal**'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 如果相等，则返回 null；否则，返回一个具有 equal 错误名称的错误对象**'
- en: 'The signature of the preceding function conforms to the `ValidatorFn` interface:
    the first parameter is of type `FormGroup`, a subclass of `AbstractControl`, and
    the return type is an object literal. Note that you use object destructuring in
    the function argument to extract the value property from the instance of the `FormGroup`
    object.'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 前述函数的签名符合 `ValidatorFn` 接口：第一个参数是 `FormGroup` 类型，它是 `AbstractControl` 的子类，返回类型是一个对象字面量。注意，你在这个函数参数中使用对象解构来从
    `FormGroup` 对象的实例中提取 value 属性。
- en: You also use array destructuring combined with rest parameters in the first
    line of the function so you can iterate through the properties of `FormGroup.value`.
    You get the names of all properties in the value object and save them in two variables,
    `first` and `rest`. `first` is the name of a property that will be used as the
    reference value—values of all other properties must be equal to it to make validation
    pass. `rest` holds the names of all the other properties.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 你还在函数的第一行使用了数组解构和剩余参数，这样你可以遍历 `FormGroup.value` 的属性。你从值对象中获取所有属性的名称，并将它们保存在两个变量
    `first` 和 `rest` 中。`first` 是一个属性，将用作参考值——所有其他属性的值必须等于它才能使验证通过。`rest` 包含所有其他属性的名称。
- en: Finally, the validator function returns either `null`, if the values in the
    group are the same, or an error object, otherwise. Let’s apply the `ssnValidator`
    and `equalValidator` in the sample user registration form. The following listing
    shows the code of the modified `AppComponent` class.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，验证器函数返回 `null`，如果组中的值相同，或者返回一个错误对象，否则。让我们在示例用户注册表单中应用 `ssnValidator` 和 `equalValidator`。以下列表显示了修改后的
    `AppComponent` 类的代码。
- en: Listing 11.15\. A modified form model for a user registration form
  id: totrans-144
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.15\. 修改后的用户注册表单的表单模型
- en: '[PRE19]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '***1* Injects the FormBuilder service**'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 注入 FormBuilder 服务**'
- en: '***2* Creates the form model object**'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 创建表单模型对象**'
- en: '***3* Creates the username control and attaches the required validator**'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 创建 username 控件并附加 required 验证器**'
- en: '***4* Creates the socialSecurity control and attaches the ssnValidator**'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 创建 socialSecurity 控件并附加 ssnValidator**'
- en: '***5* Creates the subgroup passwordsGroup for password and password confirmation
    controls**'
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***5* 为密码和密码确认控件创建子组 passwordsGroup**'
- en: '***6* Creates the password control, applying the minLength validator**'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***6* 创建密码控件，应用 minLength 验证器**'
- en: '***7* Creates the pconfirm control for confirming the password**'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***7* 创建用于确认密码的 pconfirm 控件**'
- en: '***8* Attaches the equalValidator to passwordsGroup to ensure that both entered
    passwords are the same**'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***8* 将 equalValidator 附加到 passwordsGroup 以确保输入的两个密码相同**'
- en: To display validation errors when the user enters invalid values, you’ll add
    a `<span>` element next to each form control in the template. Depending on the
    return of the `hasError()` method, the error text will be either shown or hidden,
    as in the following listing.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户输入无效值时，为了显示验证错误，你将在模板中每个表单控件旁边添加一个 `<span>` 元素。根据 `hasError()` 方法的返回值，错误文本将被显示或隐藏，如下所示。
- en: Listing 11.16\. The template and styles of the user registration component
  id: totrans-155
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.16\. 用户注册组件的模板和样式
- en: '[PRE20]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '***1* If the value of the username control is invalid, shows the error message**'
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 如果 username 控件的值无效，显示错误信息**'
- en: '***2* If the value of the socialSecurity control is invalid, shows the error
    message**'
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 如果 socialSecurity 控件的值无效，显示错误信息**'
- en: '***3* If the value of the password control is invalid, shows the error message**'
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 如果密码控件的值无效，显示错误信息**'
- en: '***4* If passwords are not the same, shows the error message**'
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 如果密码不相同，显示错误信息**'
- en: 'Note how you access the form model’s `hasError()` method. It takes two parameters:
    the name of the validation error you want to check and the control name from the
    form model. In the case of `username`, it’s a direct child of the top-level `FormGroup`
    that represents the form model, so you specify the name of the control. But the
    `password` field is a child of the nested `FormGroup`, so the path to the control
    is specified as an array of strings: `[''passwordsGroup'', ''password'']`. The
    first element is the name of the nested group, and the second is the name of the
    `password` field itself.'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 注意你如何访问表单模型的 `hasError()` 方法。它接受两个参数：你想要检查的验证错误名称和表单模型中的控件名称。在 `username` 的例子中，它是最顶层
    `FormGroup` 的直接子控件，代表表单模型，因此你指定控件的名称。但 `password` 字段是嵌套 `FormGroup` 的子控件，所以控件的路径被指定为一个字符串数组：`['passwordsGroup',
    'password']`。第一个元素是嵌套组的名称，第二个是 `password` 字段的名称本身。
- en: 'You can find the code for this app in the group-validators directory. To see
    this app in action, run the following command:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在 group-validators 目录中找到此应用的代码。要查看此应用的实际效果，请运行以下命令：
- en: '[PRE21]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '[Figure 11.3](#ch11fig03) illustrates the error messages produced by invalid
    values in the individual fields Username, SSN, and Password, as well as invalid
    values in the form group—provided passwords don’t match.'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 11.3](#ch11fig03) 展示了由单个字段（用户名、SSN 和密码）以及表单组中的无效值产生的错误消息，以及密码不匹配时的无效值。'
- en: Figure 11.3\. Showing multiple validation errors
  id: totrans-165
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 11.3\. 显示多个验证错误
- en: '![](Images/11fig03_alt.jpg)'
  id: totrans-166
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig03_alt.jpg)'
- en: 11.5\. Checking a form control’s status and validity
  id: totrans-167
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.5\. 检查表单控件的状态和有效性
- en: You already used such control properties as `valid`, `invalid`, and `errors`
    for checking field status. In this section, we’ll look at a number of other properties
    that help improve the user experience.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经使用了 `valid`、`invalid` 和 `errors` 等控制属性来检查字段状态。在本节中，我们将探讨许多其他有助于改进用户体验的属性。
- en: 11.5.1\. touched and untouched form controls
  id: totrans-169
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.5.1\. 已触摸和未触摸表单控件
- en: In addition to checking a control’s validity, you can also use the `touched`
    and `untouched` properties to check whether a form control was visited by the
    user. If the user puts the focus into a form control using the keyboard or mouse
    and then moves the focus out, this control becomes `touched`; while the focus
    remains in the control, it’s still `untouched`. This can be useful when displaying
    error messages—if the value in a form control is invalid, but it was never visited
    by the user, you can choose not to highlight it with red, because the user didn’t
    even try to enter a value. The following listing shows an example.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 除了检查控件的有效性之外，你还可以使用 `touched` 和 `untouched` 属性来检查表单控件是否被用户访问。如果用户使用键盘或鼠标将焦点放入表单控件，然后移出焦点，则此控件变为
    `touched`；而焦点保持在控件中，它仍然是 `untouched`。这可以在显示错误消息时很有用——如果表单控件中的值无效，但用户从未访问过它，你可以选择不使用红色突出显示它，因为用户甚至没有尝试输入值。以下列表显示了一个示例。
- en: Listing 11.17\. Using the touched property
  id: totrans-171
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.17\. 使用 touched 属性
- en: '[PRE22]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '***1* Defines a CSS selector that highlights the border of the invalid form
    control with red**'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 定义了一个 CSS 选择器，用于用红色突出显示无效表单控件的边框**'
- en: '***2* Adds the required validator for the username field**'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 为用户名字段添加了必需的验证器**'
- en: '***3* Enables Forms API support for the field and saves a reference to the
    NgModel directive instance in the local template variable c**'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 启用字段对 Forms API 的支持，并将 NgModel 指令实例的引用保存在局部模板变量 c 中**'
- en: '***4* Conditionally applies the hasError CSS selector to the <input> element**'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 条件性地将 hasError CSS 选择器应用到 <input> 元素**'
- en: '|  |'
  id: totrans-177
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-178
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: All the properties discussed in [section 11.5.1](#ch11lev2sec1) are available
    for the model classes `FormControl`, `FormGroup`, and `FormArray` as well as for
    the template-driven directives `NgModel`, `NgModelGroup`, and `NgForm`.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [11.5.1 节](#ch11lev2sec1) 中讨论的所有属性都适用于模型类 `FormControl`、`FormGroup` 和 `FormArray`，以及模板驱动的指令
    `NgModel`、`NgModelGroup` 和 `NgForm`。
- en: '|  |'
  id: totrans-180
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'Note the CSS class binding example on the last line. It conditionally applies
    the `hasError` CSS class to the element if the expression on the right side is
    `true`. If you used only `c.invalid`, the border would be highlighted as soon
    as the page was rendered; but that can confuse users, especially if the page has
    a lot of fields. Instead, you add one more condition: the field must be touched.
    Now the field is highlighted only after a user visits and leaves this field.'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 注意最后一行的 CSS 类绑定示例。如果右侧的表达式为 `true`，则条件性地将 `hasError` CSS 类应用到元素上。如果你只使用了 `c.invalid`，则边框会在页面渲染时立即高亮显示；但这可能会让用户感到困惑，尤其是如果页面有很多字段。相反，你可以添加一个额外的条件：字段必须被触摸。现在，字段只有在用户访问并离开该字段后才会高亮显示。
- en: 11.5.2\. pristine and dirty fields
  id: totrans-182
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.5.2\. 原始和脏字段
- en: Another useful pair of properties are `pristine` and `dirty`. `pristine` means
    the user never interacted with the form control. `dirty` indicates that the initial
    value of the form control was modified, regardless of where the focus is. These
    properties can be used to display or hide validation errors.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 另一对有用的属性是 `pristine` 和 `dirty`。`pristine` 表示用户从未与表单控件交互。`dirty` 表示表单控件的初始值已被修改，无论焦点在哪里。这些属性可以用来显示或隐藏验证错误。
- en: '|  |'
  id: totrans-184
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-185
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: All the properties in [section 11.5.2](#ch11lev2sec2) have corresponding CSS
    classes (`ng-touched` and `ng-untouched`, `ng-dirty` and `ng-pristine`, `ng-valid`
    and `ng-invalid`) that are automatically added to HTML elements when the respective
    property is `true`. These can be useful to style elements in a certain state.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: '[第11.5.2节](#ch11lev2sec2)中的所有属性都有相应的CSS类（`ng-touched`和`ng-untouched`、`ng-dirty`和`ng-pristine`、`ng-valid`和`ng-invalid`），当相应的属性为`true`时，这些类会自动添加到HTML元素上。这些类可以用来为特定状态下的元素设置样式。'
- en: '|  |'
  id: totrans-187
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 11.5.3\. Pending fields
  id: totrans-188
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.5.3. 等待字段
- en: If you have async validators configured for a control, the `pending` property
    may come in handy. It indicates whether the validity status is currently unknown.
    This happens when an async validator is still in progress and you need to wait
    for the results. This property can be used for displaying a progress indicator.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你为一个控件配置了异步验证器，`pending`属性可能会很有用。它表示当前的有效性状态是否未知。这发生在异步验证器仍在进行中，你需要等待结果时。这个属性可以用来显示进度指示器。
- en: 'For reactive forms, the type of the `statusChanges` property is `Observable`,
    and it emits one of three values: `VALID`, `INVALID`, and `PENDING`.'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 对于响应式表单，`statusChanges`属性的类型是`Observable`，它发出三个值之一：`VALID`、`INVALID`和`PENDING`。
- en: 11.6\. Changing validators dynamically in reactive forms
  id: totrans-191
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.6. 在响应式表单中动态更改验证器
- en: Using the reactive Forms API, you can change the validators attached to a form
    or one of its controls during runtime. You may need to implement a scenario where,
    depending on user input in one control, validation rules for another control should
    be changed. You can do that using the `setValidators()` and `updateValueAndValidity()`
    functions.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 使用响应式表单API，你可以在运行时更改表单或其控件附加的验证器。你可能需要实现一个场景，根据一个控件的用户输入，另一个控件的验证规则应该被更改。你可以使用`setValidators()`和`updateValueAndValidity()`函数来实现这一点。
- en: 'Imagine a form that has two controls: country and phone. If the user enters
    `USA` in the country field, you want to allow entering the phone number without
    the country code, and the phone has to have at least 10 characters. For other
    countries, the country code is required, and the phone has to have at least 11
    characters. In other words, you need to dynamically set the validator for the
    phone based on the input in the `country` field. The following listing shows how
    to implement this: you subscribe to the `valueChanges` property of the `country`
    field and assign the validator to the `phone` field based on the selected country.'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一个包含两个控件：国家和电话的表单。如果用户在“国家”字段中输入`USA`，你希望允许输入不带国家代码的电话号码，并且电话号码至少要有10个字符。对于其他国家，需要国家代码，并且电话号码至少要有11个字符。换句话说，你需要根据“国家”字段的输入动态设置电话的验证器。以下列表展示了如何实现：你订阅了“国家”字段的`valueChanges`属性，并根据所选国家将验证器分配给“电话”字段。
- en: Listing 11.18\. Dynamically changing validators
  id: totrans-194
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表11.18. 动态更改验证器
- en: '[PRE23]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '***1* Displays the error message only if the phone was modified and is invalid**'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 仅当电话被修改且无效时显示错误信息**'
- en: '***2* Creates the form model using FormBuilder**'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 使用FormBuilder创建表单模型**'
- en: '***3* Gets the reference to the instance of the country control**'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 获取国家控件实例的引用**'
- en: '***4* Gets the reference to the instance of the phone control**'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 获取电话控件实例的引用**'
- en: '***5* Subscribes to the changes in the country control**'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***5* 订阅国家控件的更改**'
- en: '***6* Sets the phone validator for the USA**'
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***6* 为美国设置电话验证器**'
- en: '***7* Sets the phone validator for other countries**'
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***7* 为其他国家设置电话验证器**'
- en: '***8* Emits the updated validator to the subscribers of valueChanges**'
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***8* 向valueChanges的订阅者发出更新后的验证器**'
- en: 'To see this app in action, run the following command:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看此应用程序的实际效果，请运行以下命令：
- en: '[PRE24]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: So far, you’ve been performing validation on the client side, but what if you
    want to do server-side validation of form values?
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，你一直在客户端执行验证，但如果你想要对表单值进行服务器端验证怎么办？
- en: 11.7\. Asynchronous validators
  id: totrans-207
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.7. 异步验证器
- en: Asynchronous validators can be used to check form values by making requests
    to a remote server. Like synchronous validators, async validators are functions.
    The main difference is that async validators should return either an `Observable`
    or a `Promise` object. [Figure 11.4](#ch11fig04) compares the interfaces that
    synchronous and asynchronous validators should implement. It shows the validators
    for a `formControl`, but the same applies to any subclass of the `AbstractControl`.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 异步验证器可以通过向远程服务器发出请求来检查表单值。与同步验证器一样，异步验证器是函数。主要区别在于异步验证器应返回一个 `Observable` 或
    `Promise` 对象。[图 11.4](#ch11fig04) 比较了同步和异步验证器应实现的接口。它显示了 `formControl` 的验证器，但同样适用于
    `AbstractControl` 的任何子类。
- en: Figure 11.4\. Comparing sync and async validators
  id: totrans-209
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 11.4\. 比较同步和异步验证器
- en: '![](Images/11fig04_alt.jpg)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig04_alt.jpg)'
- en: '|  |'
  id: totrans-211
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Tip
  id: totrans-212
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 小贴士
- en: If a form control has both sync and async validators, the latter will be invoked
    only after the value(s) pass all synchronous validators.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 如果表单控件既有同步验证器又有异步验证器，则只有在值通过所有同步验证器后，才会调用异步验证器。
- en: '|  |'
  id: totrans-214
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: The code that comes with this chapter includes a directory called async-validator
    that uses both sync and async validators to validate the SSN. For synchronous
    validation, you’ll reuse the `ssnValidator()` function that you created in [section
    11.3](#ch11lev1sec3). That validator checked that the user entered nine digits
    in the form control.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 本章附带代码中包含一个名为 async-validator 的目录，它使用同步和异步验证器来验证 SSN。对于同步验证，您将重用您在 [第 11.3 节](#ch11lev1sec3)
    中创建的 `ssnValidator()` 函数。该验证器检查用户是否在表单控件中输入了九位数字。
- en: Now you also want to invoke a service that will check whether the entered SSN
    authorizes the user to work in the USA. By your rules, if a person’s SSN has a
    sequence 123 in it, they can work in the USA. The following listing creates an
    Angular service that includes such an asynchronous validator.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您还希望调用一个服务，该服务将检查输入的 SSN 是否授权用户在美国工作。根据您的规则，如果一个人的 SSN 中包含序列 123，他们可以在美国工作。以下列表创建了一个包含此类异步验证器的
    Angular 服务。
- en: Listing 11.19\. A service with an async validator
  id: totrans-217
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.19\. 带有异步验证器的服务
- en: '[PRE25]'
  id: totrans-218
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '***1* This function properly implements the async validator interface.**'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 此函数正确实现了异步验证器接口。**'
- en: '***2* Returns an observable of null—the validation passed**'
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 返回一个空的 `Observable`——验证通过**'
- en: '***3* Returns an observable of the ValidationErrors object—the validation failed**'
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 返回一个 ValidationErrors 对象的可观察对象——验证失败**'
- en: The following listing creates a component that, in addition to the synchronous
    ssn`Validator()`, attaches to the form control the async validator, `checkWorkAuthorization()`.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表创建了一个组件，除了同步的 ssn`Validator()`，还将异步验证器 `checkWorkAuthorization()`附加到表单控件。
- en: Listing 11.20\. async-validator/app.component.ts
  id: totrans-223
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.20\. async-validator/app.component.ts
- en: '[PRE26]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '***1* Synchronous validator**'
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 同步验证器**'
- en: '***2* In case of an error, shows the text from <span>; otherwise, from the
    template validSSN**'
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 在出错的情况下，显示 <span> 中的文本；否则，从模板 validSSN 显示**'
- en: '***3* Defines the template validSSN**'
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 定义了模板 validSSN**'
- en: '***4* Extracts the description of the error named work**'
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 提取名为 work 的错误描述**'
- en: '***5* Attaches the sync validator to ssnControl**'
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***5* 将同步验证器附加到 ssnControl**'
- en: '***6* Attaches the async validator to ssnControl**'
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***6* 将异步验证器附加到 ssnControl**'
- en: Async validators are passed as the third argument to constructors of model classes.
    If you need to have several synchronous or asynchronous validators, specify an
    array as the second and/or third argument.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 异步验证器作为模型类构造函数的第三个参数传递。如果您需要多个同步或异步验证器，请将数组作为第二个和/或第三个参数指定。
- en: In general, the HTML `<template>` element is used to specify the content that’s
    not rendered by the browser on page load but can be rendered by JavaScript later
    on. The Angular `<ng-template>` directive serves the same purpose. In your component,
    the content of `<ng-template>` is “SSN is valid,” and it’s not rendered on page
    load. The Angular directive `*ngIf` will render it if the entered SSN is valid,
    using the template variable `validSSN` as a reference.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，HTML `<template>` 元素用于指定在页面加载时不会被浏览器渲染但可以在稍后由 JavaScript 渲染的内容。Angular `<ng-template>`
    指令具有相同的目的。在您的组件中，`<ng-template>` 的内容是“SSN 是有效的”，它在页面加载时不会被渲染。Angular 指令 `*ngIf`
    将在输入的 SSN 有效时渲染它，使用模板变量 `validSSN` 作为参考。
- en: 'When assigning the asynchronous validator `checkWorkAuthorization()`, you want
    to make sure that this method runs in the context of the service `ssnValidatorService`.
    That’s why you used the JavaScript function `bind()`. To see this application
    in action, run the following command:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 当分配异步验证器 `checkWorkAuthorization()` 时，您想确保此方法在服务 `ssnValidatorService` 的上下文中运行。这就是为什么您使用了
    JavaScript 函数 `bind()`。要查看此应用的运行情况，请运行以下命令：
- en: '[PRE27]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Try entering the SSN with and without the 123 sequence to see different validation
    messages.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试输入带有和不带有 123 序列的 SSN，以查看不同的验证消息。
- en: '|  |'
  id: totrans-236
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-237
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: The source code for this example includes one more async validator, `checkWorkAuthorizationV2()`,
    that can’t be attached to the form control because it doesn’t conform to the interface
    shown in [figure 11.4](#ch11fig04). We added that validator just to show that
    you can invoke any function for validating the form values.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 此示例的源代码还包括一个额外的异步验证器 `checkWorkAuthorizationV2()`，因为它不符合 [图 11.4](#ch11fig04)
    中显示的接口，所以无法附加到表单控件。我们添加此验证器只是为了展示您可以为验证表单值调用任何函数。
- en: '|  |'
  id: totrans-239
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 11.8\. Custom validators in template-driven forms
  id: totrans-240
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.8\. 模板驱动的表单中的自定义验证器
- en: With template-driven forms, you can use only directives to specify validators,
    so wrapping validator functions into directives is required. The following listing
    creates a directive that wraps the synchronous SSN validator from [section 11.3](#ch11lev1sec3).
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 在模板驱动的表单中，您只能使用指令来指定验证器，因此需要将验证器函数包装到指令中。以下列表创建了一个指令，它包装了来自 [第 11.3 节](#ch11lev1sec3)
    的同步 SSN 验证器。
- en: Listing 11.21\. `SsnValidatorDirective`
  id: totrans-242
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.21\. `SsnValidatorDirective`
- en: '[PRE28]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '***1* Declares a directive using the @Directive decorator**'
  id: totrans-244
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 使用 @Directive 装饰器声明一个指令**'
- en: '***2* Defines the directive’s selector to be used as an HTML attribute**'
  id: totrans-245
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 定义指令的选择器以用作 HTML 属性**'
- en: '***3* Registers ssnValidator as an NG_VALIDATORS provider**'
  id: totrans-246
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 将 ssnValidator 注册为 NG_VALIDATORS 提供者**'
- en: The square brackets around the `ssn` selector denote that the directive can
    be used as an attribute. This is convenient, because you can add this attribute
    to any `<input>` element or to an Angular component represented as a custom HTML
    element.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: '`ssn` 选择器周围的方括号表示该指令可以用作属性。这很方便，因为您可以将此属性添加到任何 `<input>` 元素或表示为自定义 HTML 元素的
    Angular 组件中。'
- en: In [listing 11.20](#ch11ex20), you register the validator function using the
    predefined `NG_VALIDATORS` Angular token. This token is, in turn, injected by
    the `NgModel` directive, and `NgModel` gets the list of all validators attached
    to the HTML element. Then, `NgModel` passes validators to the `FormControl` instance
    it implicitly creates. The same mechanism is responsible for running validators;
    directives are just a different way to configure them. The `multi` property lets
    you associate multiple values with the same token. When the token is injected
    into the `NgModel` directive, `NgModel` gets a list of values instead of a single
    value. This enables you to pass multiple validators.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [列表 11.20](#ch11ex20) 中，您使用预定义的 `NG_VALIDATORS` Angular 标记注册验证器函数。这个标记反过来由
    `NgModel` 指令注入，`NgModel` 获取附加到 HTML 元素上的所有验证器的列表。然后，`NgModel` 将验证器传递给它隐式创建的 `FormControl`
    实例。相同的机制负责运行验证器；指令只是配置它们的不同方式。`multi` 属性允许您将多个值与同一个标记关联。当标记注入到 `NgModel` 指令中时，`NgModel`
    获取一个值列表而不是单个值。这使得您能够传递多个验证器。
- en: 'Here’s how you can use the `SsnValidatorDirective`:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是如何使用 `SsnValidatorDirective` 的示例：
- en: '[PRE29]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'You can find the complete running application that illustrates directive validators
    in the template-validator directory. To see this app in action, run the following
    command:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在模板验证器目录中找到说明指令验证器的完整运行应用程序。要查看此应用的运行情况，请运行以下命令：
- en: '[PRE30]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '[Chapter 10](kindle_split_019.xhtml#ch10) covered the basics of the Forms API.
    In this chapter, we’ve explained how to validate form data. Now it’s time to modify
    ngAuction and add a search form so users can search for products.'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: '[第 10 章](kindle_split_019.xhtml#ch10) 介绍了 Forms API 的基础知识。在本章中，我们解释了如何验证表单数据。现在是时候修改
    ngAuction 并添加一个搜索表单，以便用户可以搜索产品。'
- en: '|  |'
  id: totrans-254
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-255
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: Source code for this chapter can be found at [https://github.com/Farata/angulartypescript](https://github.com/Farata/angulartypescript)
    and [www.manning.com/books/angular-development-with-typescript-second-edition](http://www.manning.com/books/angular-development-with-typescript-second-edition).
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的源代码可在 [https://github.com/Farata/angulartypescript](https://github.com/Farata/angulartypescript)
    和 [www.manning.com/books/angular-development-with-typescript-second-edition](http://www.manning.com/books/angular-development-with-typescript-second-edition)
    找到。
- en: '|  |'
  id: totrans-257
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 11.9\. Adding a search form to ngAuction
  id: totrans-258
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.9\. 向 ngAuction 添加搜索表单
- en: You made quite a few changes to the new version of ngAuction. The main addition
    is the new search component where you use the Angular Forms API. You’ll also add
    tabs with product categories, so the top portion of ngAuction will look like [figure
    11.5](#ch11fig05).
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 您对 ngAuction 的新版本进行了相当多的修改。主要新增的是新的搜索组件，您在其中使用 Angular 表单 API。您还将添加带有产品类别的标签，因此
    ngAuction 的顶部部分将类似于图 11.5 所示。
- en: Figure 11.5\. The new search icon and product category tabs
  id: totrans-260
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 11.5\. 新的搜索图标和产品类别标签
- en: '![](Images/11fig05_alt.jpg)'
  id: totrans-261
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig05_alt.jpg)'
- en: To return to the landing page from any other app view, the user should click
    the ngAuction logo. When the user clicks the search icon, the search-form component
    will slide from the left, where the user can enter search criteria, as shown in
    [figure 11.6](#ch11fig06).
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 要从任何其他应用视图返回主页，用户应点击 ngAuction 标志。当用户点击搜索图标时，搜索表单组件将从左侧滑动，用户可以在此处输入搜索条件，如图 11.6
    所示。
- en: Figure 11.6\. The search-form component
  id: totrans-263
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 11.6\. 搜索表单组件
- en: '![](Images/11fig06_alt.jpg)'
  id: totrans-264
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig06_alt.jpg)'
- en: After the user clicks the Search button, the app will invoke `ProductService
    .search()`; the search-form component will slide back off the screen; and the
    user will see the products that meet the search criteria rendered by the search-results
    component. Note that there are no tabs with categories in the search result view
    displayed in [figure 11.7](#ch11fig07). That’s because products from different
    categories can meet the search criteria—for example, a price between $70 and $100.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 用户点击搜索按钮后，应用程序将调用 `ProductService .search()`；搜索表单组件将滑出屏幕；用户将看到由搜索结果组件渲染的符合搜索条件的商品。注意，在图
    11.7 所示的搜索结果视图中没有显示带有类别的标签。这是因为来自不同类别的产品可以满足搜索条件——例如，价格在 70 美元到 100 美元之间。
- en: Figure 11.7\. The search results view
  id: totrans-266
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 11.7\. 搜索结果视图
- en: '![](Images/11fig07_alt.jpg)'
  id: totrans-267
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig07_alt.jpg)'
- en: In this section, we won’t be providing detailed instructions for implementing
    all the code changes, because that would take lots of pages to describe. We’ll
    do a code review of the new search-form component and search-results component.
    Then we’ll highlight other important changes made throughout the code of ngAuction.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们不会提供实现所有代码更改的详细说明，因为这需要很多页面来描述。我们将对新的搜索表单组件和搜索结果组件进行代码审查。然后，我们将突出显示在整个
    ngAuction 代码中做出的其他重要更改。
- en: 11.9.1\. The search-form component
  id: totrans-269
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.9.1\. 搜索表单组件
- en: 'You created the search-form component in the shared directory of the project
    just in case the search functionality will be required in other parts of this
    app. The template of the search-form component contains a form with three input
    fields: `Title`, `Min price`, and `Max price`.'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 您在项目的共享目录中创建了搜索表单组件，以防在应用程序的其他部分需要搜索功能。搜索表单组件的模板包含一个包含三个输入字段（`标题`、`最低价格`和`最高价格`）的表单。
- en: Each of these fields, along with corresponding validation error messages (`<mat-error>`),
    is wrapped into an Angular Material `<mat-form-field>`, and the value in the placeholder
    attribute (or the field label, if present) becomes a floating label, as you can
    see in the following listing.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 这些字段以及相应的验证错误信息（`<mat-error>`）都被包裹在 Angular Material `<mat-form-field>` 中，占位符属性中的值（或如果有，字段标签）变成一个浮动标签，如下面的列表所示。
- en: Listing 11.22\. search-form.component.html
  id: totrans-272
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.22\. search-form.component.html
- en: '[PRE31]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '***1* Title form control**'
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 标题表单控件**'
- en: '***2* Validation error message for Title**'
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 验证错误信息用于标题**'
- en: '***3* Min price control**'
  id: totrans-276
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 最低价格控件**'
- en: '***4* Validation error message for negative values**'
  id: totrans-277
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 验证错误信息用于负值**'
- en: '***5* Max price control**'
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***5* 最高价格控件**'
- en: '***6* The matcher controls when to display validation errors.**'
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***6* 匹配器控制何时显示验证错误。**'
- en: '***7* Shows an error message if the value is negative**'
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***7* 如果值是负数，将显示错误信息**'
- en: '***8* Shows an error message if the value is greater than max price**'
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***8* 如果值大于最高价格，将显示错误信息**'
- en: '***9* Shows an error message if the entered max price is less than the min
    price**'
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***9* 如果输入的最高价格小于最低价格，将显示错误信息**'
- en: In the TypeScript code, you’ll attach a validator to require at least two characters
    in the `Title` field. The `<mat-error>` will display the error message if the
    entered value won’t pass the validator. The `Min price` field has a validator
    that doesn’t allow negative numbers.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 在 TypeScript 代码中，您将为 `标题` 字段附加一个至少需要两个字符的验证器。如果输入的值无法通过验证器，`<mat-error>` 将显示错误信息。`最低价格`
    字段有一个不允许负数的验证器。
- en: 'But the `Max price` field has three validators and three corresponding error
    messages: the first one is shown if the value is negative, the second is shown
    if the entered price is greater than 10,000, and the third one is shown if the
    entered `Max value` is less than the `Min value`.'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 但 `最大价格` 字段有三个验证器和三个相应的错误消息：第一个在值是负数时显示，第二个在输入的价格大于10,000时显示，第三个在输入的 `最大值` 小于
    `最小值` 时显示。
- en: You’ll create a custom validator named `minLessThanMaxValidator` in the TypeScript
    code of the search-form component. Because this validator needs the values from
    two fields, you’ll attach it to the entire form and not to the individual form
    control. Accordingly, for this validator in `<mat-error>`, you invoke `hasError()`
    not in the form control but in the form.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 您将在搜索表单组件的 TypeScript 代码中创建一个名为 `minLessThanMaxValidator` 的自定义验证器。因为此验证器需要两个字段的值，所以您将把它附加到整个表单而不是单个表单控件。因此，对于
    `<mat-error>` 中的此验证器，您在表单控件而不是表单中调用 `hasError()`。
- en: By default, validation errors are shown when the value is invalid and the user
    interacts with the control. The `Max price` field is special because one of its
    validators should kick in when the value in the `Min price` field is also entered.
    To specify *when* this validator should check the values, you’ll implement the
    `ErrorStateMatcher` interface in the TypeScript code of the search-form component.
    If the entered value doesn’t pass one or more validators, the respective error
    messages will be displayed, as shown in [figure 11.8](#ch11fig08).
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，当值无效且用户与控件交互时显示验证错误。`最大价格` 字段是特殊的，因为其中一个验证器应该在 `最小价格` 字段中的值也被输入时启动。为了指定此验证器何时检查值，您将在搜索表单组件的
    TypeScript 代码中实现 `ErrorStateMatcher` 接口。如果输入的值未通过一个或多个验证器，将显示相应的错误消息，如[图11.8](#ch11fig08)所示。
- en: Figure 11.8\. Showing two validation errors
  id: totrans-287
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图11.8\. 显示两个验证错误
- en: '![](Images/11fig08.jpg)'
  id: totrans-288
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig08.jpg)'
- en: The search-form.component.ts file includes the decorated class `SearchFormComponent`
    and the custom validator `minLessThanMaxValidator`. The form model is created
    using `FormBuilder`.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: '`search-form.component.ts` 文件包含装饰类 `SearchFormComponent` 和自定义验证器 `minLessThanMaxValidator`。表单模型使用
    `FormBuilder` 创建。'
- en: When the user clicks the Search button, the router navigates to the search-results
    component, passing the search criteria as query parameters (see [section 3.5.2](kindle_split_012.xhtml#ch03lev2sec4)
    in [chapter 3](kindle_split_012.xhtml#ch03)). The search-results component implements
    the search functionality. You also emit a custom `search` event, which notifies
    the `AppComponent` that the search panel can be closed, as shown in the following
    listing.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户点击搜索按钮时，路由器导航到搜索结果组件，并将搜索条件作为查询参数传递（参见[第3.5.2节](kindle_split_012.xhtml#ch03lev2sec4)中的[第3章](kindle_split_012.xhtml#ch03)）。搜索结果组件实现了搜索功能。您还发出一个自定义的
    `search` 事件，如以下列表所示，通知 `AppComponent` 可以关闭搜索面板。
- en: Listing 11.23\. search-form.component.ts
  id: totrans-291
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表11.23\. search-form.component.ts
- en: '[PRE32]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '***1* The object that controls when to show the validation error for Max price**'
  id: totrans-293
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 控制何时显示最大价格验证错误的对象**'
- en: '***2* Creates a form model with validators**'
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 创建带有验证器的表单模型**'
- en: '***3* The user clicked the Search button.**'
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 用户点击了搜索按钮。**'
- en: '***4* Sends an event to app component to close the search-form component**'
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 向应用程序组件发送事件以关闭搜索表单组件**'
- en: '***5* Doesn’t send empty values in query parameters**'
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***5* 在查询参数中不发送空值**'
- en: '***6* Navigates to search-results, passing the search criteria**'
  id: totrans-298
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***6* 导航到搜索结果，传递搜索条件**'
- en: '***7* Reports an error when either the form or a control is invalid**'
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***7* 当表单或控件无效时报告错误**'
- en: '***8* Creates a queryParams object that contains only the properties with values**'
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***8* 创建一个只包含具有值的属性的查询参数对象**'
- en: '***9* A custom validator for comparing min and max prices**'
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***9* 用于比较最小和最大价格的自定义验证器**'
- en: The `matInput` directive has the `errorStateMatcher` property, which takes an
    instance of the `ErrorStateMatcher` object. This object must implement the `isErrorState()`
    method that takes the form control and the form and has the app logic to decide
    whether the error message has to be shown. In this case, this function returns
    `true` (show the error) if the control’s value is invalid or if the `minLessThanMax`
    validator returned an error.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: '`matInput` 指令具有 `errorStateMatcher` 属性，该属性接受 `ErrorStateMatcher` 对象的实例。此对象必须实现
    `isErrorState()` 方法，该方法接受表单控件和表单，并具有应用程序逻辑以决定是否显示错误消息。在这种情况下，如果控件值无效或 `minLessThanMax`
    验证器返回错误，则此函数返回 `true`（显示错误）。'
- en: While searching for products, keep an eye on the URL, which will contain the
    search parameters. For example, if you enter `red` in the title field and click
    Search, you’ll invoke `Router.navigate()`, and the URL will change to localhost:4200/search-results?title=red.
    The function `withoutEmptyValues()` ensures that if some search parameters weren’t
    used (for example, min and max price), they won’t be used in the query parameters.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 在搜索产品时，注意URL，它将包含搜索参数。例如，如果你在标题字段中输入`red`并点击搜索，你将调用`Router.navigate()`，URL将变为localhost:4200/search-results?title=red。函数`withoutEmptyValues()`确保如果某些搜索参数没有被使用（例如，最小和最大价格），它们将不会出现在查询参数中。
- en: '|  |'
  id: totrans-304
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-305
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: Note
- en: 'In ngAuction from [chapter 10](kindle_split_019.xhtml#ch10), the home component
    included `<mat-grid-list>` for rendering the list of products. In this version
    of ngAuction, we extracted the grid list into a separate product-grid component
    that now is reused by two components: categories and search-results (both belong
    to the home module).'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 在第10章的ngAuction中，主组件包含了`<mat-grid-list>`来渲染产品列表。在这个版本的ngAuction中，我们将网格列表提取到一个单独的产品网格组件中，现在它被两个组件复用：分类和搜索结果（两者都属于主模块）。
- en: '|  |'
  id: totrans-307
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 11.9.2\. The search-results component
  id: totrans-308
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.9.2\. 搜索结果组件
- en: The search-results component receives the query parameters via the observable
    property `queryParams` of the `ActivatedRoute` object. Using the `switchMap` operator,
    you pass the value emitted by the `queryParams` observable to another observable,
    the `search()` method on `ProductService`, as shown in the following listing.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 搜索结果组件通过`ActivatedRoute`对象的`queryParams`可观察属性接收查询参数。使用`switchMap`操作符，你将`queryParams`可观察对象发出的值传递给另一个可观察对象，即`ProductService`上的`search()`方法，如下所示。
- en: Listing 11.24\. search-results.component.ts
  id: totrans-310
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表11.24\. search-results.component.ts
- en: '[PRE33]'
  id: totrans-311
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '***1* Declares an observable for products**'
  id: totrans-312
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 声明一个用于产品的可观察对象**'
- en: '***2* Wraps the RxJS pipeable operator into the pipe() function**'
  id: totrans-313
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 将RxJS可管道操作符包装到pipe()函数中**'
- en: '***3* Passes the received parameters to the search() method**'
  id: totrans-314
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 将接收到的参数传递给search()方法**'
- en: If you need a refresher on the `switchMap` operator, see [section D.8](kindle_split_028.xhtml#app04lev1sec8)
    of [appendix D](kindle_split_028.xhtml#app04). You can read about pipeable operators
    in [section D.4.1](kindle_split_028.xhtml#app04lev2sec1).
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要关于`switchMap`操作符的复习，请参阅[附录D](kindle_split_028.xhtml#app04)中的[第D.8节](kindle_split_028.xhtml#app04lev1sec8)。你可以在[第D.4.1节](kindle_split_028.xhtml#app04lev2sec1)中了解可管道操作符。
- en: The template of the search-results component incorporates the product-grid component
    and uses the async pipe to unwrap the observable `products$`, as shown in the
    next listing.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 搜索结果组件的模板包含了产品网格组件，并使用异步管道来展开`products$`可观察对象，如下所示。
- en: Listing 11.25\. search-results.component.html
  id: totrans-317
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表11.25\. search-results.component.html
- en: '[PRE34]'
  id: totrans-318
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'The product-grid component receives the products via its input parameter as
    follows:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 产品网格组件通过其输入参数接收产品，如下所示：
- en: '[PRE35]'
  id: totrans-320
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: Then it renders the grid with products as described in [section 9.3.4](kindle_split_018.xhtml#ch09lev2sec8)
    in [chapter 9](kindle_split_018.xhtml#ch09).
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 然后它按照第9章中[9.3.4节](kindle_split_018.xhtml#ch09lev2sec8)的描述渲染了网格。
- en: 11.9.3\. Other code refactoring
  id: totrans-322
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 11.9.3\. 其他代码重构
- en: We won’t be providing complete code listings of other ngAuction components that
    underwent refactoring but rather will highlight the changes. You’re encouraged
    to go through the code of ngAuction that comes with this chapter. If you have
    specific questions about the code, post them on the book forum at [https://forums.manning.com/forums/angular-development-with-typescript-second-edition](https://forums.manning.com/forums/angular-development-with-typescript-second-edition).
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不会提供其他经过重构的ngAuction组件的完整代码列表，而是突出显示更改。我们鼓励你阅读本章附带ngAuction的代码。如果你对代码有具体问题，可以在[https://forums.manning.com/forums/angular-development-with-typescript-second-edition](https://forums.manning.com/forums/angular-development-with-typescript-second-edition)的书籍论坛上发帖。
- en: Showing and hiding the search-form component
  id: totrans-324
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 显示和隐藏搜索表单组件
- en: In the ngAuction from [chapters 2](kindle_split_011.xhtml#ch02), [3](kindle_split_012.xhtml#ch03),
    and [4](kindle_split_013.xhtml#ch04), the search component was always present
    on the UI, occupying 25% of the screen width. Why does it take so much space even
    when the user isn’t searching for products? In this version of the app, the search-form
    component is represented by a small search icon, which is a part of the app toolbar,
    as shown in [figure 11.9](#ch11fig09).
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 在 ngAuction 的第 [2](kindle_split_011.xhtml#ch02)、[3](kindle_split_012.xhtml#ch03)
    和 [4](kindle_split_013.xhtml#ch04) 章，搜索组件始终存在于UI中，占据了屏幕宽度的25%。为什么即使用户没有搜索产品，它也占用这么多空间？在这个应用的版本中，搜索表单组件由一个小搜索图标表示，它是应用工具栏的一部分，如
    [图 11.9](#ch11fig09) 所示。
- en: Figure 11.9\. The search icon in a toolbar
  id: totrans-326
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 11.9. 工具栏中的搜索图标
- en: '![](Images/11fig09_alt.jpg)'
  id: totrans-327
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/11fig09_alt.jpg)'
- en: Angular Material offers components for side navigation with which you can add
    collapsible side content to a full-screen app. You use the `<mat-sidenav-container>`
    component, which acts as a structural container for both the side-navigation panel
    (the search-form component) and the toolbar of ngAuction. `<mat-sidenav>` represents
    the added side content—the search-form component, in your case—as shown in the
    following listing.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: Angular Material 提供了用于侧导航的组件，你可以使用这些组件向全屏应用添加可折叠的侧边内容。你使用 `<mat-sidenav-container>`
    组件，它作为侧导航面板（搜索表单组件）和 ngAuction 工具栏的结构容器。`<mat-sidenav>` 代表添加的侧边内容——在你的情况下是搜索表单组件，如下面的列表所示。
- en: Listing 11.26\. A fragment of app.component.html
  id: totrans-329
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.26. app.component.html 的片段
- en: '[PRE36]'
  id: totrans-330
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: '***1* Wraps the sidenav and the toolbar into <mat-sidenav-container>**'
  id: totrans-331
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 将侧边栏和工具栏包裹在 <mat-sidenav-container> 中**'
- en: '***2* Wraps the search-form component into <mat-sidenav>**'
  id: totrans-332
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 将搜索表单组件包裹在 <mat-sidenav> 中**'
- en: '***3* On search event, closes the sidenav with the search-form component**'
  id: totrans-333
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 在搜索事件中，关闭带有搜索表单组件的侧边栏**'
- en: '***4* Declares a button with an icon**'
  id: totrans-334
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 声明一个带有图标的按钮**'
- en: '***5* Clicking the icon button toggles the sidenav (opening it, in this case).**'
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***5* 点击图标按钮切换侧边栏（在这种情况下是打开它）。**'
- en: '***6* Uses the icon named search, offered by Google Material icons**'
  id: totrans-336
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***6* 使用由 Google Material icons 提供的名为 search 的图标**'
- en: Refactoring the home module
  id: totrans-337
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 重构主页模块
- en: 'In [chapter 9](kindle_split_018.xhtml#ch09), ngAuction had a home module with
    a home component. The home module still exists, but there’s no home component
    anymore. You split its functionality into three components: categories, search-results,
    and product-grid components. The categories component is rendered below the navbar.
    Below the categories component, the browser renders the product-grid component
    that encapsulates the search-results component.'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [第 9](kindle_split_018.xhtml#ch09) 章，ngAuction 有一个主页模块和一个主页组件。主页模块仍然存在，但不再有主页组件。你将其功能拆分为三个组件：类别、搜索结果和产品网格组件。类别组件在导航栏下方渲染。在类别组件下方，浏览器渲染封装了搜索结果组件的产品网格组件。
- en: The routing has also changed, and the route configuration looks like the following
    listing now.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 路由也发生了变化，现在的路由配置如下所示。
- en: Listing 11.27\. The modified configuration of the routes
  id: totrans-340
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.27. 路由的修改配置
- en: '[PRE37]'
  id: totrans-341
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: '***1* By default, redirects to the componentless categories route**'
  id: totrans-342
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 默认情况下，重定向到无组件的类别路由**'
- en: '***2* Adds the routing for the search-results component**'
  id: totrans-343
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 为搜索结果组件添加路由**'
- en: '***3* By default, redirects to the categories/all route**'
  id: totrans-344
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 默认情况下，重定向到类别/all路由**'
- en: '***4* Adds the routing for the categories component with a parameter**'
  id: totrans-345
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 为带有参数的类别组件添加路由**'
- en: In this code, you use the so-called *componentless route* `categories`, which
    doesn’t have a specific component mapped to the path. It consumes the URL fragment,
    providing it to its children. By default, the fragment *categories* and *all*
    will be combined into categories/all.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 在此代码中，你使用所谓的*无组件路由* `categories`，它没有将特定组件映射到路径。它消耗URL片段，并将其提供给其子组件。默认情况下，片段
    *categories* 和 *all* 将合并为 categories/all。
- en: The parameters passed to the componentless route are passed further down to
    the child routes. In your case, if there were a parameter after the URL fragment
    *categories*, it would be passed to the `CategoriesComponent` via the `:category`
    path.
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 传递给无组件路由的参数会进一步传递到子路由。在你的情况下，如果URL片段 *categories* 后面有参数，它将通过 `:category` 路径传递给
    `CategoriesComponent`。
- en: The categories component
  id: totrans-348
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 类别组件
- en: The categories component is a part of the home module. It uses the standard
    HTML `<nav>` element that’s meant to hold a set of links for navigation. To make
    these links fancy, you add the Angular Material `mat-tab-nav-bar` directive to
    the `<nav>` element. In [chapter 9](kindle_split_018.xhtml#ch09), the home component
    rendered the grid of products, but now the user will see tabs with product category
    names. The user can click tabs to select all products or those that belong to
    a particular category, and the product-grid component will render them. The template
    of the categories component is shown in the following listing.
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 类别组件是主页模块的一部分。它使用标准的 HTML `<nav>` 元素，该元素旨在包含一组用于导航的链接。为了使这些链接更美观，您将 Angular
    Material 的 `mat-tab-nav-bar` 指令添加到 `<nav>` 元素中。在第 [9](kindle_split_018.xhtml#ch09)
    章中，主页组件渲染了产品网格，但现在用户将看到带有产品类别名称的标签页。用户可以点击标签页来选择所有产品或属于特定类别的产品，产品网格组件将渲染它们。类别组件的模板如下所示。
- en: Listing 11.28\. categories.component.html
  id: totrans-350
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.28\. categories.component.html
- en: '[PRE38]'
  id: totrans-351
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: '***1* Adds the mat-tab-nav-bar to the standard HTML <nav> tag**'
  id: totrans-352
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 将 mat-tab-nav-bar 添加到标准的 HTML <nav> 标签**'
- en: '***2* Each tab title is a link.**'
  id: totrans-353
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 每个标签页标题都是一个链接。**'
- en: '***3* Iterates through the category names to create an <a> tag for each one**'
  id: totrans-354
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 遍历类别名称以为每个名称创建一个 <a> 标签**'
- en: '***4* routerLinkActive shows the user which link is active now.**'
  id: totrans-355
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 路由链接活动状态显示当前哪个链接是激活的。**'
- en: '***5* Navigates to the route categories, passing the category name as param**'
  id: totrans-356
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***5* 导航到 categories 路由，传递类别名称作为参数**'
- en: '***6* The link text (the tab title) is in uppercase.**'
  id: totrans-357
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***6* 链接文本（标签页标题）是大写的。**'
- en: '***7* The product-grid component gets the array of products to render.**'
  id: totrans-358
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***7* 产品网格组件获取要渲染的产品数组。**'
- en: The TypeScript code of the categories component comes next. It uses `ProductService`
    to retrieve the distinct names of categories to be used as tab titles. It also
    uses the same service to retrieve the products of all categories or from the selected
    one.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是类别组件的 TypeScript 代码。它使用 `ProductService` 获取用作标签页标题的类别名称的唯一名称。它还使用相同的服务来检索所有类别或所选类别的产品。
- en: Listing 11.29\. categories.component.ts
  id: totrans-360
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 11.29\. categories.component.ts
- en: '[PRE39]'
  id: totrans-361
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: '***1* Category names to be used as tab titles**'
  id: totrans-362
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 用作标签页标题的类别名称**'
- en: '***2* Creates an array of category names where the first one is “all”**'
  id: totrans-363
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 创建一个包含类别名称的数组，第一个是“全部”**'
- en: '***3* Gets products that belong to the selected category**'
  id: totrans-364
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 获取属于所选类别的产品**'
- en: '***4* Gets all products because the user clicked All**'
  id: totrans-365
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 获取所有产品，因为用户点击了“全部”**'
- en: '***5* Gets corresponding products because the user clicked a tab with a specific
    category name**'
  id: totrans-366
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***5* 获取对应的产品，因为用户点击了具有特定类别名称的标签页**'
- en: This concludes the code review of ngAuction. To see it in action, run `npm install`
    in the project directory, and then run `ng serve -o`.
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 这完成了 ngAuction 的代码审查。要查看其效果，请在项目目录中运行 `npm install`，然后运行 `ng serve -o`。
- en: Summary
  id: totrans-368
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 摘要
- en: Angular comes with several built-in validators, and you can create as many custom
    ones as you like.
  id: totrans-369
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Angular 随带提供了一些内置验证器，并且您可以创建尽可能多的自定义验证器。
- en: You can validate user input with synchronous and asynchronous validators.
  id: totrans-370
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以使用同步和异步验证器验证用户输入。
- en: You can control when validation happens.
  id: totrans-371
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以控制验证何时发生。
