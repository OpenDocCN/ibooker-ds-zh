- en: 8 Authoring and maintaining documentation
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 8 编写和维护文档
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Writing prose documentation using reStructuredText
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 reStructuredText 编写散文文档
- en: Automating code documentation collection using sphinx-apidoc and sphinx-autodoc
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 sphinx-apidoc 和 sphinx-autodoc 自动化代码文档收集
- en: Building an HTML documentation site using Sphinx
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Sphinx 构建HTML文档站点
- en: Publishing documentation using Read the Docs
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Read the Docs 发布文档
- en: At the end of the previous chapter, you achieved the important milestone of
    publishing your package to the Python Package Index (PyPI) for others to use.
    The truth is that PyPI already has more than 350,000 packages and will only continue
    growing. Your work on the functionality, quality, and logistics of packaging has
    ensured that people *can* use it, but you’re going to need to put in some more
    work if you want to ensure they *will* use it. You already have a captive audience
    at CarCorp, but as you try to scale to more clients, they will come to expect
    more.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章的结尾，你实现了将你的包发布到 Python 包索引（PyPI）的重要里程碑，以便其他人可以使用。事实是，PyPI 已经有超过 350,000
    个包，并且只会继续增长。你在功能、质量和包装物流方面的工作确保了人们*可以*使用它，但如果你想确保他们*会*使用它，你还需要做更多的工作。你已经在 CarCorp
    有了一个固定的受众，但随着你尝试扩展到更多客户，他们将会期待更多。
- en: Documentation is one of the major hurdles to package adoption. Without ample
    rationale, people may not understand why they need to use your package. Even with
    sufficient justification, people may not understand how to use the package, even
    if they want to. In this chapter, you’ll learn what effective package documentation
    looks like and how to create a setup that will support your project as the code
    evolves.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 文档是包采用的主要障碍之一。如果没有充分的理由，人们可能不理解为什么他们需要使用你的包。即使有足够的理由，人们可能也不理解如何使用该包，即使他们想这么做。在本章中，你将了解有效的包文档是什么样的，以及如何创建一个随着代码演变而支持你的项目的设置。
- en: Important You can use the code companion ([http://mng.bz/69A5](http://mng.bz/69A5))
    to check your work for the exercises in this chapter.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示：你可以使用代码伴侣（[http://mng.bz/69A5](http://mng.bz/69A5)）来检查本章练习的工作。
- en: 8.1 Some quick philosophy on documentation
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 8.1 关于文档的一些快速哲学
- en: 'Users come seeking documentation with typically one of a few distinct goals
    in mind:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 用户带着通常只有几个明确的目标来寻找文档：
- en: They want to learn about the code for the very first time.
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们第一次想要了解代码。
- en: They know the code well but want to achieve a specific task they haven’t done
    before.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们对代码非常了解，但想要完成他们以前没有做过的一项特定任务。
- en: They know the behavior of the code well but still need to reference details
    like signatures and syntax.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们对代码的行为非常了解，但仍需要参考诸如签名和语法之类的细节。
- en: They want to understand the reasoning that brought the code to the point it’s
    at today.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们想要了解导致代码达到今天这个地步的推理过程。
- en: 'Although there may be overlap in what kinds of information might benefit a
    user from one goal to another, the way that information is presented must cater
    specifically to just one goal at a time to be effective. The Diátaxis framework
    ([https://diataxis.fr/](https://diataxis.fr/)) from Daniele Procida spells out
    the nuances of each goal and the kind of documentation that helps achieve each
    goal, as described here:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然从一种目标到另一种目标可能存在信息类型上的重叠，但信息的呈现方式必须专门针对一次一个目标，才能有效。Daniele Procida 的 Diátaxis
    框架（[https://diataxis.fr/](https://diataxis.fr/））详细说明了每个目标及其有助于实现每个目标的文档类型，如以下所述：
- en: Tutorials help a new reader through a worked problem to learn the general ideas
    and approach of a project.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 指南帮助新读者通过一个已解决的问题来学习项目的一般思想和方法。
- en: How-tos help a reader accomplish a specific task they came into the documentation
    to find.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 指南有助于读者完成他们进入文档想要完成的特定任务。
- en: Discussions help a reader understand the history and decisions in a project.
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 讨论有助于读者了解项目的历史和决策。
- en: References help a reader find very specific information, such as syntax or allowed
    arguments.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 参考内容有助于读者找到非常具体的信息，例如语法或允许的参数。
- en: The ideas on the Diátaxis site and Procida’s corresponding presentation make
    a compelling argument for separating these concerns, maximizing the efficacy of
    documentation. The natural result of this approach is that some documentation
    will be nearly all prose, whereas another will be nearly all code, and others
    still will be a mix of both. You need a documentation system that can easily combine
    prose and code documentation while supporting a clear demarcation between the
    two concepts.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: Diátaxis 网站上的观点和 Procida 的相应演示文稿有力地论证了将这些问题分开，最大化文档的有效性。这种方法的自然结果是，一些文档将几乎全部是散文，而另一些将几乎全部是代码，还有一些将是两者的混合。您需要一个可以轻松结合散文和代码文档，同时支持两者之间清晰区分的文档系统。
- en: Although the full depth of pedagogy, cognitive science, and didactics are outside
    the scope of this book (for more of that, check out *The Programmer’s Brain* by
    Felienne Hermans, Manning, 2021, [http://mng.bz/lRxd](http://mng.bz/lRxd)), there
    are some tools out there that will help your teaching thrive. Sphinx ([https://www.sphinx-doc.org](https://www.sphinx-doc.org))
    is a documentation framework that builds on the power of reStructuredText ([http://mng.bz/BZMw](http://mng.bz/BZMw))
    to create paginated, cross-referenced documentation sites in a variety of output
    formats.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管教育、认知科学和教学法的全部深度超出了本书的范围（更多内容请参阅 Felienne Hermans 的《程序员的大脑》，Manning，2021，[http://mng.bz/lRxd](http://mng.bz/lRxd)），但有一些工具可以帮助您的教学蓬勃发展。Sphinx
    ([https://www.sphinx-doc.org](https://www.sphinx-doc.org)) 是一个文档框架，它利用 reStructuredText
    ([http://mng.bz/BZMw](http://mng.bz/BZMw)) 的强大功能，以各种输出格式创建分页和交叉引用的文档网站。
- en: Other great documentation frameworks
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 其他优秀的文档框架
- en: Although Sphinx is one of the most popular frameworks for Python documentation
    due to its use in Python’s documentation and the power of reStructuredText, it
    isn’t the only player in the space.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管由于在 Python 文档中使用以及 reStructuredText 的强大功能，Sphinx 是 Python 文档中最受欢迎的框架之一，但它并不是这个领域唯一的参与者。
- en: Python provides a built-in `pydoc` module ([https://docs.python.org/3/library/pydoc.xhtml](https://docs.python.org/3/library/pydoc.xhtml))
    that can generate documentation files from docstrings found in Python modules.
    It doesn’t have a great way to include prose documentation, but if your project
    just needs a bare minimum, it might work.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: Python 提供了一个内置的 `pydoc` 模块 ([https://docs.python.org/3/library/pydoc.xhtml](https://docs.python.org/3/library/pydoc.xhtml))，可以从
    Python 模块中找到的文档字符串生成文档文件。它没有很好的方法来包含散文文档，但如果你的项目只需要最基本的内容，它可能还是可行的。
- en: MkDocs ([https://www.mkdocs.org/](https://www.mkdocs.org/)) is another third-party
    documentation framework that uses Markdown and YAML to create a documentation
    site, and there’s a mkdocstrings plugin ([https://github.com/pawamoy/mkdocstrings](https://github.com/pawamoy/mkdocstrings))
    for working with Python docstrings.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: MkDocs ([https://www.mkdocs.org/](https://www.mkdocs.org/)) 是另一个使用 Markdown
    和 YAML 创建文档网站的第三方文档框架，并且有一个用于处理 Python 文档字符串的 mkdocstrings 插件 ([https://github.com/pawamoy/mkdocstrings](https://github.com/pawamoy/mkdocstrings))。
- en: Sphinx is incredibly powerful and can be extended through its plugin-based architecture.
    It’s such a valuable choice for Python projects that even the official Python
    documentation ([https://docs.python.org](https://docs.python.org)) uses it.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: Sphinx 非常强大，可以通过其基于插件的架构进行扩展。它是 Python 项目的宝贵选择，甚至官方的 Python 文档 ([https://docs.python.org](https://docs.python.org))
    也使用了它。
- en: Note The full capabilities and customizations Sphinx provides are outside the
    scope of this book, but Sphinx has—as you might imagine—excellent documentation.
    If you enjoy this chapter, you might like to explore more of what Sphinx can do.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：Sphinx 提供的完整功能和自定义选项超出了本书的范围，但正如您所想象的那样，Sphinx 有出色的文档。如果您喜欢这一章，您可能会喜欢探索 Sphinx
    可以做什么的更多内容。
- en: Read on to learn how you can use Sphinx to create an HTML documentation website
    that you can serve on Read the Docs ([https://readthedocs.org/](https://readthedocs.org/)),
    the most popular place to host documentation for Python projects.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 继续阅读，了解您如何使用 Sphinx 创建一个可以在 Read the Docs ([https://readthedocs.org/](https://readthedocs.org/))
    上提供的服务 HTML 文档网站，这是托管 Python 项目文档最受欢迎的地方。
- en: 8.2 Starting your documentation with Sphinx
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 8.2 使用 Sphinx 开始您的文档
- en: 'Start by creating a new tox environment for your documentation. Remember that
    you can configure tox environments by adding a new section in your setup.cfg file
    called `[testenv:docs]`, which enables you to run it using `tox -e docs`. Add
    the `sphinx` package ([https://pypi.org/project/Sphinx/](https://pypi.org/project/Sphinx/))
    as a dependency for the environment using the `deps` key. Then add the `commands`
    key with the following command to the environment, which creates a docs/ directory
    in the root of your project and fills it with the initial documentation configuration
    and directory structure:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 首先为您的文档创建一个新的tox环境。记住，您可以通过在setup.cfg文件中添加一个名为`[testenv:docs]`的新部分来配置tox环境，这使您能够使用`tox
    -e docs`运行它。使用`deps`键将`sphinx`包([https://pypi.org/project/Sphinx/](https://pypi.org/project/Sphinx/))作为环境的依赖项。然后，将`commands`键添加到环境中，使用以下命令，该命令在项目根目录中创建一个docs/目录，并填充初始文档配置和目录结构：
- en: '[PRE0]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: One of the files Sphinx’s quickstart generates is docs/index.rst. This file
    is the entry point to your documentation. The quickstart version of the index.rst
    file creates a table of contents with nested headings and a caption, as shown
    in the next listing.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: Sphinx快速启动生成的文件之一是docs/index.rst。此文件是您文档的入口点。index.rst文件的快速启动版本创建了一个带有嵌套标题和标题的目录表，如下一列表所示。
- en: Listing 8.1 A basic table-of-contents directive in Sphinx
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 列表8.1 Sphinx中的基本目录表指令
- en: '[PRE1]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: ❶ Creates a table of contents
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 创建目录表
- en: ❷ Shows links for pages nested up to two levels deep
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 显示最多两层嵌套页面的链接
- en: '❸ Renders the string Contents: to introduce the table'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 使用字符串“内容”来引入目录
- en: The table of contents is an important Sphinx concept, because just like in a
    book, the reader should be able to find their way to the content they’re interested
    in reading. Each page of documentation you add should be part of the table of
    contents tree, so Sphinx’s quickstart process starts you off following this pattern.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 目录表是Sphinx的一个重要概念，因为就像在书中一样，读者应该能够找到他们感兴趣阅读的内容。您添加的每一页文档都应该成为目录树的一部分，因此Sphinx的快速启动过程从遵循此模式开始。
- en: 'Run your environment using the `tox -e docs` command. Sphinx prompts you for
    the following basic information about the package:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`tox -e docs`命令运行您的环境。Sphinx会提示您有关包的基本信息：
- en: '*Directory structure*—You can choose the default that places a _build/ directory
    in the docs/ directory alongside the raw documentation, or you can choose to have
    nested source/ and build/ directories to keep the raw and built documentation
    totally separate. The default works just fine here; the rest of this chapter will
    assume this structure.'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*目录结构*—您可以选择默认结构，将_build/目录放置在docs/目录中，与原始文档并列，或者您可以选择嵌套source/和build/目录，以将原始文档和构建文档完全分开。默认结构在这里就很好；本章的其余部分将假设这种结构。'
- en: '*Project name*—This should match the name under which you publish your package
    so people recognize that they’re reading the correct documentation for a package
    they’re considering installing or have installed.'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*项目名称*—这应该与您发布包时使用的名称相匹配，以便人们能够识别他们正在阅读他们考虑安装或已安装的包的正确文档。'
- en: '*Author name*—This is your name or another identifier such as your company’s
    name.'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*作者姓名*—这是您的姓名或其他标识符，例如您公司的名称。'
- en: '*Project release*—You can leave this empty for now. Later in this chapter,
    you’ll get the package version dynamically in the documentation configuration.'
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*项目发布*—目前您可以留空。在本章的后面部分，您将在文档配置中动态获取包版本。'
- en: '*Project language*—This is the two-letter ISO 639-1 code ([http://mng.bz/de2g](http://mng.bz/de2g))
    for the natural language in which you’re writing your documentation. Sphinx will
    adjust some of its output into the selected language as well; English is the default.'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*项目语言*—这是您编写文档的自然语言的两个字母ISO 639-1代码([http://mng.bz/de2g](http://mng.bz/de2g))。Sphinx会根据所选语言调整其输出；默认为英语。'
- en: The full output of the quickstart process will look something like the following
    listing.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 快速启动过程的完整输出将类似于以下列表。
- en: Listing 8.2 The initial setup for a Sphinx-driven documentation project
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 列表8.2 使用Sphinx驱动的文档项目的初始设置
- en: '[PRE2]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: ❶ Uses the default structure
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 使用默认结构
- en: ❷ Uses the same name as the published package
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 使用与已发布包相同的名称
- en: ❸ Uses your name or another appropriate identifier
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 使用您的姓名或其他适当的标识符
- en: ❹ Leave this empty for now.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 目前请保持为空。
- en: ❺ Chooses your preferred language
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 选择您首选的语言
- en: 'You should now see the docs/ directory in the root of your project, and inside
    it you should see the following files and directories:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在应该在项目的根目录中看到`docs/`目录，并在其中看到以下文件和目录：
- en: '*conf.py*—This file contains the Sphinx configuration for building your documentation.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*conf.py*—此文件包含构建您的文档的Sphinx配置。'
- en: '*index.rst*—When you build the documentation, this file acts as the main entry
    point for Sphinx to find all your documentation. Its content will be the home
    page of your documentation.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*index.rst*—当您构建文档时，这个文件作为Sphinx查找所有文档的主要入口点。其内容将是您文档的首页。'
- en: '*Makefile*—You can use this to build your documentation manually on Unix systems
    where GNU Make ([https://www.gnu.org/software/make/](https://www.gnu.org/software/make/))
    is installed. You can remove this file for now; you won’t use it in this book.'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Makefile*—您可以使用这个文件在已安装GNU Make ([https://www.gnu.org/software/make/](https://www.gnu.org/software/make/))的Unix系统上手动构建文档。目前您可以删除这个文件；在这个书中您不会用到它。'
- en: '*make.bat*—You can use this to build your documentation manually on Windows
    systems. You can remove this file for now; you won’t use it in this book.'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*make.bat*—您可以使用这个文件在Windows系统上手动构建文档。目前您可以删除这个文件；在这个书中您不会用到它。'
- en: '*static/*—You can add CSS or image files to this directory to use within your
    documentation. You can remove this directory for now; you won’t use it in this
    book.'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*static/*—您可以将CSS或图像文件添加到这个目录中，以便在文档中使用。目前您可以删除这个目录；在这个书中您不会用到它。'
- en: '*templates/*—You can add to or override Sphinx’s default templates to this
    directory to change how your documentation is presented. You can remove this directory
    for now; you won’t use it in this book.'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*templates/*—您可以将或覆盖Sphinx的默认模板添加到这个目录中，以改变您的文档展示方式。目前您可以先删除这个目录；在这个书中您不会用到它。'
- en: 'You won’t need to use the `sphinx-quickstart` command again unless you want
    to start your documentation over from scratch. The `sphinx-quickstart` command
    will produce an error if it finds existing documentation to avoid overwriting
    what you’ve already created. Going forward, you want the tox environment to build
    the documentation instead. You can use the `sphinx-build` command to build the
    documentation from the docs/ directory as HTML in the docs/_build/ directory.
    In addition to converting the index.rst file to HTML, Sphinx also builds indices
    that support searching the documentation as well as letting other Sphinx-based
    documentation sites cross-reference it—more on this later in this chapter. Remember
    that you configured pytest and mypy to fail explicitly if you accidentally add
    nonexistent or unused references. The `sphinx-build` command also has some options
    to help ensure your documentation doesn’t have any broken references. Each of
    the following options changes the behavior of Sphinx and the output it logs to
    the console:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 除非您想从零开始重新开始您的文档，否则您不需要再次使用`sphinx-quickstart`命令。如果`sphinx-quickstart`命令发现现有的文档，它将产生错误以避免覆盖您已经创建的内容。从现在开始，您希望tox环境构建文档。您可以使用`sphinx-build`命令从`docs/`目录构建文档，将其作为HTML保存在`docs/_build/`目录中。除了将`index.rst`文件转换为HTML外，Sphinx还会构建索引，支持搜索文档以及允许其他基于Sphinx的文档站点进行交叉引用——关于这一点将在本章后面详细说明。请记住，您已经配置了pytest和mypy，如果意外添加了不存在或未使用的引用，它们会明确失败。`sphinx-build`命令也有一些选项可以帮助确保您的文档没有任何损坏的引用。以下每个选项都会改变Sphinx的行为以及它输出到控制台的信息：
- en: '`-n`—Nit-picky mode makes Sphinx output missing references as warnings in the
    logged output.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-n`—挑剔模式使Sphinx在日志输出中将缺失的引用作为警告。'
- en: '`-W`—This option turns all warnings generated during the build into errors.
    You might like to enable this to decrease the chances that you introduce issues
    into your documentation that silently allow the build to succeed.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-W`—此选项将构建过程中生成的所有警告转换为错误。您可能喜欢启用此选项以降低将问题引入文档的风险，这些问题会静默地允许构建成功。'
- en: '`--keep-going`—This option runs the full documentation build, collecting all
    errors along the way instead of failing after the first one. This is useful so
    you can see multiple errors to fix at once instead of repeatedly building and
    getting new errors each time.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--keep-going`—此选项运行完整的文档构建，沿途收集所有错误，而不是在第一个错误后失败。这很有用，这样您就可以一次性看到多个错误并修复它们，而不是反复构建并每次都得到新的错误。'
- en: 'Update the `commands` value for your documentation tox environment to run the
    following command, which builds the documentation from the docs/ directory as
    HTML in the docs/_build/ directory:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 更新您的文档tox环境的`commands`值，以运行以下命令，该命令从`docs/`目录构建文档，将其作为HTML保存在`docs/_build/`目录中：
- en: '[PRE3]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Run the `docs` tox environment again. This time, Sphinx should find the existing
    configuration in conf.py and the content of the index.rst file and use them to
    build the documentation, as illustrated in the next listing.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 再次运行 `docs` tox 环境。这次，Sphinx 应该在 conf.py 中找到现有的配置以及 index.rst 文件的内容，并使用它们来构建文档，如下一列表所示。
- en: Listing 8.3 Sample output of building HTML documentation using sphinx-build
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 8.3 使用 sphinx-build 构建HTML文档的示例输出
- en: '[PRE4]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: ❶ Creates the _build/ directory if not present
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 如果不存在，则创建 _build/ 目录。
- en: ❷ The index.rst source file
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 每个源文件的索引.rst 源文件。
- en: ❸ A line for each source file is printed.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 为每个源文件打印一行。
- en: ❹ An output file for each source file is created.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 为每个源文件创建一个输出文件。
- en: ❺ Indices support search and cross-references.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 索引支持搜索和交叉引用。
- en: ❻ The index for users to search the documentation
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: ❻ 用户搜索文档的索引
- en: ❼ For cross-referencing from other Sphinx sites
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: ❼ 用于从其他 Sphinx 网站进行交叉引用。
- en: ❽ Where you can access the built site
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: ❽ 您可以访问构建的网站
- en: 'Now that you’ve built the documentation as HTML, you can view it in your browser.
    Although you have just one index.rst file right now, in addition to a corresponding
    index.xhtml file in the docs/_build/ directory, Sphinx built HTML files for the
    documentation search page and the indices. You can view the index.xhtml file directly
    in your browser and even run a search, but a better way to view the documentation
    with all its features is with Python’s built-in `http.server` module. This module
    runs a small HTTP server, simulating how the files would be accessed on a server
    on the internet. You can run the following command from the root of your project
    to serve the documentation at http:/ /localhost:9876:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经将文档构建为 HTML，您可以在浏览器中查看它。尽管您现在只有一个 index.rst 文件，以及 docs/_build/ 目录中的相应 index.xhtml
    文件，但 Sphinx 为文档搜索页面和索引构建了 HTML 文件。您可以直接在浏览器中查看 index.xhtml 文件，甚至运行搜索，但更好的方法是使用
    Python 内置的 `http.server` 模块来查看具有所有功能的文档。此模块运行一个小型 HTTP 服务器，模拟文件在互联网上的服务器上如何被访问。您可以从项目的根目录运行以下命令来在
    http:/ /localhost:9876 上提供文档：
- en: '[PRE5]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Visit http:/ /localhost:9876 in your browser now. This shows the documentation
    home page, which contains some of the information you provided to Sphinx during
    the quick start process (see figure 8.1).
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 现在请在浏览器中访问 http:/ /localhost:9876。这显示了文档主页，其中包含您在快速入门过程中提供给 Sphinx 的一些信息（见图
    8.1）。
- en: '![](../../OEBPS/Images/08-01.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/08-01.png)'
- en: Figure 8.1 The bare-bones HTML site created by Sphinx for a new documentation
    project. It includes the package name and the author name.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.1 Sphinx 为新文档项目创建的裸骨 HTML 网站。它包括包名和作者名。
- en: Now that you have Sphinx running successfully, the next step before going further
    into writing documentation is building automation for a few things to speed up
    your documentation efforts.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经成功运行了 Sphinx，在进一步编写文档之前，下一步是为几件事情构建自动化，以加快您的文档工作。
- en: 8.2.1 Automating documentation refresh during development
  id: totrans-83
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.2.1 在开发过程中自动化文档刷新
- en: 'You can leave the Python HTTP server running as you make updates to your documentation
    throughout this chapter so that you can always access them in your browser, but
    this can be difficult to remember to do each time you work on the documentation
    in the future. You can manage this using the `sphinx-autobuild` package ([https://pypi.org/project/sphinx-autobuild/](https://pypi.org/project/sphinx-autobuild/))
    and the `sphinx-autobuild` command it provides instead of `sphinx-build` when
    you’re working on the documentation locally. The `sphinx-autobuild` command starts
    an HTTP server as well, but it will watch the documentation source files for changes
    and refresh the documentation in your browser automatically. This is really helpful
    to save time when you’re iterating quickly on the wording or structure of your
    documentation. Create a new `devdocs` tox environment that has a similar configuration
    as the `docs` environment with the following changes:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在更新本章中的文档时让 Python HTTP 服务器持续运行，这样您就可以始终在浏览器中访问它们，但每次在将来工作于文档时记住这样做可能会有点困难。您可以使用
    `sphinx-autobuild` 包（[https://pypi.org/project/sphinx-autobuild/](https://pypi.org/project/sphinx-autobuild/))
    和它提供的 `sphinx-autobuild` 命令来管理，而不是使用 `sphinx-build` 当您在本地工作于文档时。`sphinx-autobuild`
    命令也会启动一个 HTTP 服务器，但它将监视文档源文件的变化，并自动在您的浏览器中刷新文档。这在您快速迭代文档的措辞或结构时可以节省大量时间。创建一个新的
    `devdocs` tox 环境，其配置与 `docs` 环境类似，但有以下更改：
- en: Add the `sphinx-autobuild` package as a dependency in addition to the `sphinx`
    package.
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 除了 `sphinx` 包之外，将 `sphinx-autobuild` 包作为依赖项添加。
- en: Change the `sphinx-build` command to `sphinx-autobuild`.
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将 `sphinx-build` 命令更改为 `sphinx-autobuild`。
- en: Remove the `--keep-going` option; `sphinx-autobuild` will keep serving the documentation
    even if an error occurs and prints a warning that the built documentation is out
    of sync with the source. When you fix the error, the build will catch back up
    to the latest source.
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除 `--keep-going` 选项；即使发生错误，`sphinx-autobuild` 也会继续提供文档，并打印一条警告，说明构建的文档与源代码不同步。当你修复错误时，构建将重新同步到最新的源代码。
- en: Add a `--port` option, if desired, to choose an available port on your machine
    to serve the documentation. The default is `8000`.
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果需要，可以添加一个 `--port` 选项，以选择机器上可用的端口来提供文档。默认端口是 `8000`。
- en: Now you can serve your documentation locally using the `tox -e devdocs` command
    instead of running the documentation tox environment and Python HTTP server in
    tandem. You can still run the `docs` tox environment to build the documentation
    statically, which is used later in this chapter to validate the documentation.
    For now, keep moving forward on fleshing out the documentation itself.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你可以使用 `tox -e devdocs` 命令在本地提供文档，而不是同时运行文档的 tox 环境和 Python HTTP 服务器。你仍然可以运行
    `docs` tox 环境来构建静态文档，这将在本章的后面用于验证文档。现在，继续完善文档本身。
- en: 8.2.2 Automating extraction of code documentation
  id: totrans-90
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.2.2 自动提取代码文档
- en: Low-level documentation of code is most effective when it lives as close to
    the code as possible. Otherwise, the documentation is sure to become outdated
    just about the time you finish writing it. Ideally, the code documentation would
    be interleaved into the code itself, associated directly with the code it documents.
    Python supports this through some of its language constructs. At the same time,
    delving into the code isn’t always the best option for your users when their goal
    is only to read the code at a high level. You need a process that allows you to
    keep code reference documentation close to the relevant code for maintainability,
    but also enables you to pull it up to a higher level for the reader’s usability.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 代码的低级文档最有效的方式是尽可能接近代码本身。否则，文档很可能会在你写完它的时候就已经过时了。理想情况下，代码文档应该与代码本身交织在一起，直接关联到它所文档化的代码。Python
    通过其一些语言结构支持这一点。同时，当用户的目标只是阅读代码的高级内容时，深入代码并不总是对用户来说是最好的选择。你需要一个流程，这个流程允许你将代码参考文档保持在与相关代码的紧密关联中，以便于维护，同时也允许你将其提升到更高的层次，以便于读者的使用。
- en: In chapter 6, you configured mypy to validate the type hints in your code. Although
    type hints are valuable for automated validation, they also help developers reading
    the code understand what data types they can expect to pass in or receive from
    a function. You should extract these as part of the code documentation because
    of their value as reference information. More on this shortly.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在第 6 章，你配置了 mypy 以验证代码中的类型提示。虽然类型提示对于自动化验证很有价值，但它们也有助于开发者阅读代码时理解他们可以期望传递给函数或从函数接收的数据类型。你应该将这些内容作为代码文档的一部分提取出来，因为它们作为参考信息的价值。关于这一点，稍后会有更多说明。
- en: Python allows you to add *docstrings*, or free-standing strings meant to document
    code, to Python modules, classes, methods, and functions. You may have seen or
    used docstrings before—maybe serving a similar purpose to code comments—but they’re
    quite a bit more powerful. Python parses docstrings as part of the structure of
    the objects they document. In particular, the `__doc__` attribute of any module,
    class, method, or function contains the value of its docstring if present. An
    example Python module called `shapes.py` is shown with docstrings at each level
    in the following listing.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: Python 允许你将 *docstrings*（文档字符串）或独立字符串添加到 Python 模块、类、方法和函数中，这些字符串旨在文档化代码。你可能之前见过或使用过
    docstrings——可能起到与代码注释类似的作用——但它们的功能要强大得多。Python 将 docstrings 作为它们所文档化的对象结构的一部分进行解析。特别是，任何模块、类、方法或函数的
    `__doc__` 属性都包含其 docstring 的值（如果存在）。以下是一个名为 `shapes.py` 的 Python 模块示例，其中展示了每个级别的
    docstrings。
- en: Listing 8.4 Docstrings for modules, classes, methods, and standalone functions
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 8.4 模块、类、方法和独立函数的 docstrings
- en: '[PRE6]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: ❶ A module docstring
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 模块 docstring
- en: ❷ A class docstring
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 类 docstring
- en: ❸ A method docstring
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 方法 docstring
- en: You can observe the behavior of the docstrings by inspecting the `__doc__` attribute
    of the objects in the `shapes.py` module, including the module itself (see the
    next listing). Note that because the docstrings are multiline Python strings,
    they’re faithfully reproduced in the `__doc__` attribute with the same newlines
    and indentation as the original string.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过检查`shapes.py`模块中对象的`__doc__`属性来观察文档字符串的行为，包括模块本身（见下一条列表）。请注意，由于文档字符串是多行Python字符串，它们在`__doc__`属性中以与原始字符串相同的换行符和缩进方式忠实复制。
- en: Listing 8.5 Introspecting docstrings using the __doc__ attribute
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 列表8.5 使用 __doc__ 属性检查文档字符串
- en: '[PRE7]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: ❶ The docstring at the start of the module file
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 模块文件开头的文档字符串
- en: ❷ The docstring starts and ends with a newline
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 文档字符串以换行符开始和结束
- en: ❸ The docstring just inside the Circle class
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ Circle类内部的文档字符串
- en: ❹ The docstring contains more indentation because it is inside a class.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 文档字符串包含更多的缩进，因为它位于类内部。
- en: This association makes docstrings useful in automated systems because they can
    extract the name, signature, and docstring of a function for documentation purposes,
    putting the focus on the API and the prose documentation you add in your docstrings
    instead of forcing users to sift through the implementation details of the source
    code. Sphinx provides tools for this kind of extraction, which would otherwise
    be an insurmountable task in a project with more than a handful of objects to
    document.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 这种关联使得文档字符串在自动化系统中非常有用，因为它们可以提取函数的名称、签名和文档字符串以用于文档目的，从而将重点放在API和你在文档字符串中添加的叙述性文档上，而不是强迫用户浏览源代码的实现细节。Sphinx为此类提取提供了工具，这在需要文档化大量对象的项目中通常是一项无法克服的任务。
- en: 'To get Sphinx to extract your code’s documentation, you must add an additional
    command to your documenation tox environments. Sphinx provides a `sphinx-apidoc`
    command ([http://mng.bz/rnJx](http://mng.bz/rnJx)) that discovers all the modules,
    classes, methods, and functions in your project and extracts any documentation
    they have. The command provides a large number of options affecting how the final
    documentation renders, but these often come down to a matter of personal taste.
    I recommend the following options for their effects:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 要让Sphinx提取你的代码文档，你必须向你的文档tox环境中添加一个额外的命令。Sphinx提供了一个`sphinx-apidoc`命令（[http://mng.bz/rnJx](http://mng.bz/rnJx)），它可以发现你项目中的所有模块、类、方法和函数，并提取它们拥有的任何文档。该命令提供了大量影响最终文档渲染方式的选择，但这些通常取决于个人品味。我推荐以下选项，因为它们的效果：
- en: '`--force`—This will cause `sphinx-apidoc` to overwrite any existing extracted
    documentation. Because you’re generating these files directly from the code continuously
    rather than building them just once in a while, you want to make sure the generated
    documentation is in sync with the source code it comes from. Without this option,
    `sphinx-apidoc` will conservatively avoid writing to files that exist already.'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--force`—这将导致`sphinx-apidoc`覆盖任何现有的提取文档。由于你直接从代码中连续生成这些文件，而不是偶尔构建一次，因此你需要确保生成的文档与源代码保持同步。如果没有此选项，`sphinx-apidoc`将保守地避免写入已存在的文件。'
- en: '`--implicit-namespaces`—When searching for modules, you want Sphinx to find
    any modules that are in an implicit namespace, as defined in PEP 420 ([https://www.python.org/dev/peps/pep-0420/](https://www.python.org/dev/peps/pep-0420/)).
    This supports a wider variety of package configurations so that it won’t break
    on you later if you add implicit namespaces to your project.'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--implicit-namespaces`—在搜索模块时，你希望Sphinx找到任何位于隐式命名空间中的模块，如PEP 420（[https://www.python.org/dev/peps/pep-0420/](https://www.python.org/dev/peps/pep-0420/)）中定义的。这支持更广泛的包配置，这样在将来你为项目添加隐式命名空间时，它不会导致问题。'
- en: '`--module-first`—Usually people learn best by reading about high-level concepts
    before low-level concepts. By default, Sphinx outputs documentation with the lowest-level
    code documented first; this option puts the highest-level documentation first
    instead.'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--module-first`—通常人们在学习时，先了解高级概念再了解低级概念效果最好。默认情况下，Sphinx输出的文档是先从最低级代码开始进行文档化；此选项将最高级文档放在前面。'
- en: '`--separate`—Some readers can become overwhelmed if too much content is presented
    on one page. By default, Sphinx groups documentation together; this option splits
    the documentation for each module onto its own page instead.'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--separate`—如果一页上展示的内容太多，一些读者可能会感到不知所措。默认情况下，Sphinx将文档分组在一起；此选项将每个模块的文档拆分到其自己的页面上。'
- en: 'The next few options are necessary to tell the `sphinx-apidoc` command where
    to discover and output the documentation:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来的几个选项是必要的，用于告诉 `sphinx-apidoc` 命令在哪里发现和输出文档：
- en: The `-o` option indicates the output directory for the documentation. A directory
    with a name like docs/reference/ is a decent choice for the output directory,
    but you can name it something else if you like. This name will appear in the URL
    for the extracted documentation, and you should add the directory to your .gitignore
    file to avoid checking in the generated documentation files.
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-o` 选项表示文档的输出目录。一个像 `docs/reference/` 这样的目录是一个不错的选择，但如果您喜欢，您可以将其命名为其他名称。这个名称将出现在提取的文档的
    URL 中，并且您应该将该目录添加到 .gitignore 文件中，以避免将生成的文档文件提交到版本控制中。'
- en: The positional arguments are the directory in which to start discovering code,
    followed by zero or more patterns of files to ignore during the search. You want
    Sphinx to look in your src/imppkg/ directory where your package’s source code
    is located, and you want it to ignore all src/imppkg/*.c and src/imppkg/*.so files
    because those are non-Python files generated by Cython.
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 位置参数是要开始发现代码的目录，后面跟着零个或多个在搜索过程中要忽略的文件模式。您希望 Sphinx 在您的 `src/imppkg/` 目录中查找，这是您的包源代码所在的位置，并且您希望它忽略所有
    `src/imppkg/*.c` 和 `src/imppkg/*.so` 文件，因为这些是由 Cython 生成的非 Python 文件。
- en: The final incantation for the `sphinx-apidoc` command may be a bit intimidating,
    but you understand the moving parts of it now. It should look like the listing
    shown here.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '`sphinx-apidoc` 命令的最终用法可能有点令人畏惧，但现在您已经理解了它的各个部分。它应该看起来像这里显示的列表。'
- en: Listing 8.6 Automatically extracting code documentation using sphinx-apidoc
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 8.6 使用 sphinx-apidoc 自动提取代码文档
- en: '[PRE8]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: ❶ Overwrites the extracted docs every time
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 每次都覆盖提取的文档
- en: ❷ Includes modules from implicit namespaces
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 包括隐式命名空间中的模块
- en: ❸ Shows high-level before low-level documentation
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 先展示高级文档，再展示低级文档
- en: ❹ Splits each module into its own page
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 将每个模块拆分到自己的页面
- en: ❺ Outputs the generated files here
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 将生成的文件输出到这里
- en: ❻ Starts the documentation search here
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: ❻ 在这里启动文档搜索
- en: ❼ Ignores files generated by Cython
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: ❼ 忽略由 Cython 生成的文件
- en: Add this new `sphinx-apidoc` command as the first command in each of the `docs`
    and `devdocs` tox environments so that they extract the code documentation into
    the docs/ reference/ directory before building and watching the full documentation.
    You’re almost ready to extract some code documentation, but before you do, you
    need to configure two more things.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 将这个新的 `sphinx-apidoc` 命令作为 `docs` 和 `devdocs` tox 环境中的第一个命令添加，以便在构建和监视完整文档之前，将代码文档提取到
    `docs/reference/` 目录中。您几乎准备好提取一些代码文档了，但在这样做之前，您还需要配置两件事。
- en: Warning The `sphinx-autobuild` command you set up in the `devdocs` environment
    can detect changes only to existing documentation files. If you add a new Python
    module while the `devdocs` environment is running, any code documentation in the
    new module won’t get automatically extracted by Sphinx. When this happens, you
    can stop and rerun the `tox -e devdocs` command.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 警告 在 `devdocs` 环境中设置的 `sphinx-autobuild` 命令只能检测现有文档文件的变化。如果在 `devdocs` 环境运行时添加了新的
    Python 模块，那么新模块中的任何代码文档都不会被 Sphinx 自动提取。当这种情况发生时，您可以停止并重新运行 `tox -e devdocs` 命令。
- en: The `sphinx-apidoc` command generates several files in the docs/references/
    directory that use directives from Sphinx’s `autodoc` extension ([http://mng.bz/VyMN](http://mng.bz/VyMN)),
    and that extension isn’t enabled by default. In the `docs/conf.py` module, look
    for the empty `extensions` list and add the extensions shown in the next listing
    to interpret the extracted docstrings and type hints from the source code.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '`sphinx-apidoc` 命令在 `docs/references/` 目录下生成几个文件，这些文件使用了 Sphinx 的 `autodoc`
    扩展的指令 ([http://mng.bz/VyMN](http://mng.bz/VyMN))，而这个扩展默认是未启用的。在 `docs/conf.py`
    模块中，查找空的 `extensions` 列表，并添加下一列表中显示的扩展来解释从源代码中提取的文档字符串和类型提示。'
- en: Listing 8.7 Extracting documentation from source code using Sphinx
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 8.7 使用 Sphinx 从源代码中提取文档
- en: '[PRE9]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: ❶ The files output by sphinx-apidoc use this extension.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ sphinx-apidoc 输出的文件使用这个扩展。
- en: ❷ This extension will render type hints in the documentation.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 这个扩展将在文档中渲染类型提示。
- en: One of the files the `sphinx-apidoc` command generates is called docs/reference/
    modules.rst. Just as index.rst acts as the main entry point to all your documentation,
    the modules.rst file acts as an entry point to the code documentation generated
    by the `sphinx-apidoc` command. You need to link the index.rst file to the modules.rst
    file so that your documentation home page will link to the code documentation.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '`sphinx-apidoc` 命令生成的文件之一被称为 docs/reference/modules.rst。正如 index.rst 作为所有文档的主要入口点一样，modules.rst
    文件作为 `sphinx-apidoc` 命令生成的代码文档的入口点。您需要将 index.rst 文件链接到 modules.rst 文件，以便您的文档主页可以链接到代码文档。'
- en: Version control for generated documentation
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 生成文档的版本控制
- en: In my experience, the automated documentation Sphinx extracts from your code
    should be ignored from version control systems, because the documentation regenerates
    any time the code changes and will mostly add noise to code review. That being
    said, you could put them in version control if you work on a project whose documentation
    needs careful attention to validate its contents. You need to decide on the trade-off
    between completeness and overhead that this choice has for your projects.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我的经验，Sphinx 从您的代码中提取的自动文档应该从版本控制系统中忽略，因为文档在代码更改时重新生成，并将主要增加代码审查的噪音。话虽如此，如果您在一个需要仔细关注以验证其内容的文档的项目上工作，您可以将它们放入版本控制中。您需要决定这个选择对您的项目在完整性和开销之间的权衡。
- en: When you first rendered the documentation and viewed it in your browser, there
    was no content; you hadn’t added any documentation yet. Because you’re about to
    build code documentation in the docs/reference/ directory, where the modules.rst
    file will be an entry point to all documentation in that directory, you can add
    it to the table of contents directive in index.rst. In reStructuredText, you can
    use relative links to files and omit the extension for other files if they’re
    also reStructuredText. That is, if you want to reference docs/reference/modules.rst
    from docs/index.rst, the relative path is reference/modules.rst, and you can use
    the shorter reference/modules because it’s a reStructuredText file. Add this value
    to the `toctree` directive now, separating it with a blank line from the `:maxdepth:`
    and `:caption:` properties, as shown in the next listing.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 当您第一次渲染文档并在浏览器中查看时，没有内容；您还没有添加任何文档。因为您即将在 docs/reference/ 目录中构建代码文档，其中 modules.rst
    文件将成为该目录中所有文档的入口点，您可以将它添加到 index.rst 中的目录指令。在 reStructuredText 中，您可以使用相对链接到文件，并且如果其他文件也是
    reStructuredText 格式，则可以省略扩展名。也就是说，如果您想从 docs/index.rst 引用 docs/reference/modules.rst，相对路径是
    reference/modules.rst，您可以使用更短的 reference/modules，因为它是一个 reStructuredText 文件。现在将此值添加到
    `toctree` 指令中，用空白行与 `:maxdepth:` 和 `:caption:` 属性分隔，如下一列表所示。
- en: Listing 8.8 Linking other documentation in a table of contents
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 8.8 在目录中链接其他文档
- en: '[PRE10]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: ❶ Links documentation found in this file in the table of contents
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 在目录中链接此文件中找到的文档
- en: In addition to one .rst file for each Python module, Sphinx generates an .rst
    file for each import package. The import package’s file links to the .rst file
    for each module in that package. In turn, the top-level module.rst file links
    to the .rst file for each import package. This creates a graph of links, and when
    Sphinx builds them into an HTML site, they create a browsable page structure,
    as shown in figure 8.2.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 除了为每个 Python 模块生成一个 .rst 文件外，Sphinx 还为每个导入包生成一个 .rst 文件。导入包的文件链接到该包中每个模块的 .rst
    文件。反过来，顶级模块.rst 文件链接到每个导入包的 .rst 文件。这创建了一个链接图，当 Sphinx 将其构建成 HTML 站点时，它们创建了一个可浏览的页面结构，如图
    8.2 所示。
- en: '![](../../OEBPS/Images/08-02.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/08-02.png)'
- en: Figure 8.2 Sphinx processes interlinked prose documentation and code documentation
    into a browsable graph of HTML pages.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.2 Sphinx 将相互链接的文本文档和代码文档处理成可浏览的 HTML 页面图。
- en: Warning Sphinx uses the terms *module* and *submodule* interchangeably with
    *import packages* and *modules*, respectively. If you’ve named things clearly
    and know the structure of your project well, this doesn’t prove to be too big
    an issue, but it’s good to keep an eye out for this.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 警告 Sphinx 将术语 *module* 和 *submodule* 分别与 *import packages* 和 *modules* 互换使用。如果您命名清晰并且对项目的结构非常了解，这不会成为太大的问题，但最好留意这一点。
- en: Now that your tox environments are configured to run the `sphinx-apidoc` command,
    and Sphinx is configured to interpret the output of that step using the `sphinx.ext
    .autodoc` extension during the HTML build, run the `devdocs` tox environment again.
    This time you should see additional output from the `sphinx-apidoc` command indicating
    the creation of new documentation files (see the following listing).
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您的 tox 环境已配置为运行 `sphinx-apidoc` 命令，并且 Sphinx 已配置为在 HTML 构建期间使用 `sphinx.ext.autodoc`
    扩展来解释该步骤的输出，再次运行 `devdocs` tox 环境。这次您应该会看到 `sphinx-apidoc` 命令的额外输出，指示已创建新的文档文件（见以下列表）。
- en: Listing 8.9 Output from automated generation of documentation using sphinx-apidoc
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 8.9 使用 sphinx-apidoc 自动生成文档的输出
- en: '[PRE11]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: ❶ The index for the whole imppkg package
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 整个 imppkg 包的索引
- en: ❷ The documentation for each module in imppkg
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ imppkg 中每个模块的文档
- en: ❸ The index of all packages—Sphinx calls them modules.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 所有包的索引——Sphinx 称它们为模块。
- en: View the documentation again in your browser. You should now see the `imppkg`
    package linked on the home page (see figure 8.3).
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 再次在浏览器中查看文档。现在您应该会在主页上看到链接到 `imppkg` 包（见图 8.3）。
- en: '![](../../OEBPS/Images/08-03.png)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/08-03.png)'
- en: Figure 8.3 A Sphinx table of contents built using the automated sphinx-apidoc
    code documentation extraction approach
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.3 使用自动的 sphinx-apidoc 代码文档提取方法构建的 Sphinx 目录表
- en: You can also follow these new links to view the documentation specific to the
    `harmonic_ mean` or `harmony` modules. Remember that the documentation is a browsable
    graph.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以通过这些新链接查看针对 `harmonic_mean` 或 `harmony` 模块的特定文档。请记住，文档是一个可浏览的图。
- en: Exercise 8.1
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 练习 8.1
- en: Although it doesn’t look like much yet, your documentation setup is already
    equipped to build fairly rich documentation. You need to do the hard work by adding
    more prose documentation in the docs/ directory and docstrings to your Python
    code.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然目前看起来并不多，但您的文档设置已经具备了构建相当丰富的文档的能力。您需要通过在 docs/ 目录中添加更多文本文档和在 Python 代码中添加文档字符串来付出艰苦的努力。
- en: 'Take a moment to practice adding docstrings to your code, and see how Sphinx
    reflects these in the documentation as a result. Add the following documentation
    to your project, and observe how the built HTML documentation changes:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 抽空练习为您的代码添加文档字符串，并看看 Sphinx 如何在文档中反映这些内容。将以下文档添加到您的项目中，并观察构建的 HTML 文档如何变化：
- en: Add a module-level docstring to the `harmony.py` module explaining how to use
    it as a command-line tool.
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 `harmony.py` 模块中添加一个模块级别的文档字符串，解释如何将其用作命令行工具。
- en: Add a docstring to the `harmonic_mean` function in the harmonic_mean.pyx Cython
    file linking to a resource about the use of harmonic means.
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 harmonic_mean.pyx Cython 文件中的 `harmonic_mean` 函数中添加一个文档字符串，链接到一个关于谐波平均使用资源的页面。
- en: Add an introduction about the harmony package to the index.rst file before the
    table of contents.
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在目录表之前将关于 harmony 包的介绍添加到 index.rst 文件中。
- en: Add a new .rst file explaining the project’s structure to a developer who wants
    to add or change features, and link it in the table of contents.
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为想要添加或更改功能的开发者添加一个解释项目结构的 .rst 文件，并将其链接到目录表中。
- en: In addition to using reStructuredText in .rst files, you can also use reStructuredText
    in your docstrings. If you want to see how to achieve something specific in reStructuredText,
    check out Sphinx’s reStructuredText primer ([http://mng.bz/xMn7](http://mng.bz/xMn7)).
    You will need to rerun the `devdocs` or `docs` environment when adding or changing
    docstrings in the source code.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 除了在 .rst 文件中使用 reStructuredText，您还可以在文档字符串中使用 reStructuredText。如果您想了解如何在 reStructuredText
    中实现特定功能，请查看 Sphinx 的 reStructuredText 入门指南（[http://mng.bz/xMn7](http://mng.bz/xMn7)）。在源代码中添加或更改文档字符串时，您需要重新运行
    `devdocs` 或 `docs` 环境。
- en: Finally, you should configure the package version so Sphinx and Read the Docs
    can associate a particular build with its corresponding package version. You can
    use the `importlib` module ([https://docs.python.org/3/library/importlib.xhtml](https://docs.python.org/3/library/importlib.xhtml))
    to retrieve the version of your installed package. `importlib.metadata.version`
    accepts the installation name of a distribution package and returns the installed
    version as a string. Add the code shown in the next listing to the `docs/conf.py`
    module, entering the name you chose for publishing your package.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你应该配置包版本，以便Sphinx和Read the Docs可以将特定的构建与其对应的包版本关联起来。你可以使用`importlib`模块([https://docs.python.org/3/library/importlib.xhtml](https://docs.python.org/3/library/importlib.xhtml))来检索已安装包的版本。`importlib.metadata.version`接受一个分发包的安装名称，并以字符串形式返回已安装的版本。将下一列表中的代码添加到`docs/conf.py`模块中，输入你为发布你的包所选择的名称。
- en: Listing 8.10 Configuring Sphinx to understand the version of your installed
    package
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 列表8.10 配置Sphinx以理解已安装包的版本
- en: '[PRE12]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Note that the default theme for Sphinx doesn’t display the package version in
    the documentation. Some of the other built-in themes do, and you can customize
    the theme to show the version if you prefer; more on themes and customization
    later. When you’re feeling satisfied with the quick first pass of your documentation,
    you can commit those changes to your project and push them to GitHub. The next
    step is getting your documentation published on Read the Docs.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，Sphinx的默认主题在文档中不会显示包版本。一些其他内置主题会显示，如果你更喜欢显示版本，你可以自定义主题；关于主题和自定义配置将在稍后详细说明。当你对文档的快速初步审查感到满意时，你可以将这些更改提交到你的项目中，并将它们推送到GitHub。下一步是将你的文档发布到Read
    the Docs。
- en: 8.3 Publishing documentation to Read the Docs
  id: totrans-165
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 8.3 将文档发布到Read the Docs
- en: Tip Before proceeding in this section, you must create an account on Read the
    Docs ([https://readthedocs.org/accounts/signup/](https://readthedocs.org/accounts/signup/)).
    You can use either your email or your GitHub account; I connect with GitHub because
    it makes importing an existing GitHub project that much easier.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 小贴士 在继续本节之前，你必须在Read the Docs上创建一个账户([https://readthedocs.org/accounts/signup/](https://readthedocs.org/accounts/signup/))。你可以使用你的电子邮件或GitHub账户；我选择GitHub，因为它使得导入现有的GitHub项目变得容易得多。
- en: You have a great start on your documentation, but if it only lives in your repository
    in plain text files, it still isn’t reaching its full potential to help your users.
    You don’t want to force the people trying to use your code to build the documentation
    themselves, distracting them from their true goals. Read the Docs is a great hosting
    platform that publishes your Sphinx-built HTML documentation online. It supports
    Sphinx directly, along with a few other documentation systems, and as of this
    writing, it’s always free for open source projects.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 你的文档已经取得了很好的开端，但如果它只存在于你的仓库中的纯文本文件中，它还没有充分发挥其帮助用户的潜力。你不想强迫试图使用你的代码的人自己构建文档，这会分散他们的注意力。Read
    the Docs是一个优秀的托管平台，它将你的Sphinx构建的HTML文档在线发布。它直接支持Sphinx，以及一些其他文档系统，并且截至本文撰写时，它对开源项目始终免费。
- en: Publishing documentation for private projects
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 为私有项目发布文档
- en: Do you have a private package for use within your organization? Read the Docs
    has a paid business-class solution ([https://readthedocs.com](https://readthedocs.com)),
    which is a great way for your organization to give back to them. If your organization
    is more likely to pay for your time and some private infrastructure, you can also
    build the Sphinx documentation in a Docker container and serve it yourself using
    nginx ([https://nginx.org](https://nginx.org)) or the Apache HTTP Server ([https://httpd.apache.org/](https://httpd.apache.org/)).
    This works because the Sphinx build ultimately converts all your documentation
    to static HTML.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 你是否有用于组织内部使用的私有包？Read the Docs提供了一个付费的商业级解决方案([https://readthedocs.com](https://readthedocs.com))，这对于你的组织回馈他们来说是一个很好的方式。如果你的组织更可能为你支付时间和一些私有基础设施的费用，你还可以在Docker容器中构建Sphinx文档，并使用nginx([https://nginx.org](https://nginx.org))或Apache
    HTTP服务器([https://httpd.apache.org/](https://httpd.apache.org/))自行提供服务。这是因为Sphinx构建最终会将所有文档转换为静态HTML。
- en: After you log in on Read the Docs, you arrive on the dashboard page. If you’ve
    never used Read the Docs before, there won’t be much there. The important part
    is the Import a Project button (see figure 8.4). Click there to begin importing
    your project.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 在Read the Docs上登录后，您将到达仪表板页面。如果您之前从未使用过Read the Docs，那里可能不会有太多内容。重要的是导入项目按钮（见图8.4）。点击那里开始导入您的项目。
- en: '![](../../OEBPS/Images/08-04.png)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/08-04.png)'
- en: Figure 8.4 The Read the Docs dashboard shows you any projects you’ve already
    imported, with a callout to import new projects.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.4 Read the Docs仪表板显示了您已导入的任何项目，并提示导入新项目。
- en: On the first import page, Read the Docs prompts you to select a repository to
    import. You can select any public repository owned by you or one of your organizations
    (see figure 8.5). Choose your package’s repository from the list by clicking Add
    (**+**). If you don’t see your repository, click refresh or double-check that
    your repository is public on GitHub.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一次导入页面，Read the Docs会提示您选择要导入的仓库。您可以选择您或您所在组织拥有的任何公共仓库（见图8.5）。通过点击添加（**+**）从列表中选择您的包仓库。如果您看不到您的仓库，请点击刷新或再次确认您的仓库在GitHub上是公开的。
- en: '![](../../OEBPS/Images/08-05.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/08-05.png)'
- en: Figure 8.5 Read the Docs can import any public repositories from your account
    or any organizations you’re in.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.5 Read the Docs可以从您的账户或您所在的任何组织的任何公共仓库导入。
- en: 'When you add your repository, Read the Docs prompts you for some project information.
    This page is already populated with default values, but you should change the
    following:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 当您添加仓库时，Read the Docs会提示您输入一些项目信息。此页面已经填充了默认值，但您应该更改以下内容：
- en: Change the Name field to match the name you used to publish your package on
    the Python Package Index. This should be something like `pubpypack-harmony-<firstname>-<lastname>`.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将名称字段更改为与您在Python包索引上发布包时使用的名称匹配。这应该是类似于`pubpypack-harmony-<firstname>-<lastname>`的东西。
- en: Ensure the Default Branch field is set to your repository’s default branch,
    which is typically `main` for new GitHub repositories. If you are still working
    on your documentation on a branch other than the default branch, set this field
    to your documentation branch for now so Read the Docs can find your documentation
    code. You can switch this setting back to `main` when you’re ready to merge the
    documentation branch.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保默认分支字段设置为您的仓库默认分支，对于新的GitHub仓库通常是`main`。如果您正在默认分支之外的分支上编写文档，请暂时将此字段设置为您的文档分支，以便Read
    the Docs可以找到您的文档代码。当您准备好合并文档分支时，可以将此设置切换回`main`。
- en: 'Select the Edit Advanced Project Options: option.'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择“编辑高级项目选项”选项。
- en: Your settings should look something like figure 8.6 before proceeding. When
    you’re ready, click Next.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续之前，您的设置应该类似于图8.6。准备好后，点击下一步。
- en: '![](../../OEBPS/Images/08-06.png)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/08-06.png)'
- en: Figure 8.6 The main Read the Docs settings when importing a project
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.6 导入项目时的主要Read the Docs设置
- en: 'The next page prompts you for advanced settings about the project, which is
    also populated with some default values. Change the following:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 下一页会提示您输入有关项目的高级设置，该页面也已填充了一些默认值。更改以下内容：
- en: Update the description to match the description from your project’s README file,
    if you choose. This is shown only on the Read the Docs site.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您选择，更新描述以匹配项目README文件中的描述。这仅在Read the Docs网站上显示。
- en: Ensure the Documentation Type field is set to Sphinx HTML.
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保文档类型字段设置为Sphinx HTML。
- en: Ensure the Language field is set to the language in which you wrote your documentation.
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保语言字段设置为编写文档所用的语言。
- en: Ensure the Programming Language field is set to Python.
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保编程语言字段设置为Python。
- en: Add some tags of your choosing. These tags help others discover your project.
    Add a pubpypack tag so all the readers of this book can find each other’s projects.
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一些您选择的标签。这些标签有助于他人发现您的项目。添加一个pubpypack标签，这样这本书的所有读者都可以找到彼此的项目。
- en: Your settings should look something like figure 8.7 before proceeding. When
    you’re ready, click Finish.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续之前，您的设置应该类似于图8.7。准备好后，点击完成。
- en: '![](../../OEBPS/Images/08-07.png)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/08-07.png)'
- en: Figure 8.7 The advanced Read the Docs settings when importing a project
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.7 导入项目时的高级Read the Docs设置
- en: When you finish the import process for the project, Read the Docs brings you
    to the project’s page. There isn’t a lot of information yet; it mostly reflects
    the settings you just entered. Importantly, you can see that the Last Built field
    says “No builds yet” and the status badge shows an Unknown status (see figure
    8.8).
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 当你完成项目的导入过程后，Read the Docs 会带你到项目的页面。目前还没有太多信息；它主要反映了你刚刚输入的设置。重要的是，你可以看到“最后构建”字段显示“尚未构建”，状态徽章显示未知状态（见图8.8）。
- en: '![](../../OEBPS/Images/08-08.png)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![图8.8](../../OEBPS/Images/08-08.png)'
- en: Figure 8.8 The page for a Read the Docs project just after you import a repository
    from GitHub. It may not have any builds yet.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.8 在你从GitHub导入仓库后，Read the Docs项目的页面。可能还没有任何构建。
- en: Read the Docs has started building your project in the background, which you
    can observe by choosing the Builds tab. You should see a build with a status such
    as Triggering, Cloning, or Building (as shown in figure 8.9). Periodically refresh
    this page; the status should change to Passed after a minute or so.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: Read the Docs 已经在后台开始构建你的项目，你可以通过选择构建标签来观察。你应该会看到一个状态为触发、克隆或构建（如图8.9所示）的构建。定期刷新此页面；大约一分钟后，状态应该变为通过。
- en: '![](../../OEBPS/Images/08-09.png)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
  zh: '![图8.9](../../OEBPS/Images/08-09.png)'
- en: Figure 8.9 The Builds page shows the status of past and current builds.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: '![图8.9](../../OEBPS/Images/08-09.png)'
- en: When the build completes successfully, click View Docs to see your published
    documentation. The URL should be something like https://pubpypack-harmony-<firstname>-<lastname>.readthedocs.io/<language>/latest/.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 当构建成功完成后，点击查看文档以查看你发布的文档。URL 应该类似于 https://pubpypack-harmony-<firstname>-<lastname>.readthedocs.io/<language>/latest/。
- en: Take a close look at your new documentation site’s home page. Notice that the
    code documentation you so carefully configured the `sphinx-apidoc` command to
    extract isn’t there. This is because Read the Docs doesn’t know about your tox
    environment—it’s only reproducing what it found in the docs/ directory without
    running `sphinx-apidoc` first. To fix this, you can create some additional configuration
    to tell Read the Docs more about your project.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 仔细查看你新文档网站的首页。注意，你如此仔细配置的 `sphinx-apidoc` 命令提取的代码文档并不在那里。这是因为 Read the Docs
    不了解你的 tox 环境——它只是在运行 `sphinx-apidoc` 之前复制了在 docs/ 目录中找到的内容。为了解决这个问题，你可以创建一些额外的配置来告诉
    Read the Docs 更多关于你的项目信息。
- en: 8.3.1 Configuring Read the Docs
  id: totrans-200
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.3.1 配置 Read the Docs
- en: 'Your current configuration has the following two drawbacks:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 你当前配置有两个缺点：
- en: Read the Docs won’t run your tox environment or a `sphinx-apidoc` command before
    building your documentation, causing the missing code documentation you observed
    earlier ([http://mng.bz/AVye](http://mng.bz/AVye)).
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Read the Docs 在构建你的文档之前不会运行你的 tox 环境或 `sphinx-apidoc` 命令，这导致了你之前观察到的缺失的代码文档（[http://mng.bz/AVye](http://mng.bz/AVye)）。
- en: Sphinx doesn’t install your package into the Python environment like your tox
    environment does. If your package has any third-party dependencies, those also
    won’t be installed, and Sphinx may fail during the build of the documentation
    when it runs into unknown package imports.
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Sphinx 不会像你的 tox 环境那样将你的包安装到 Python 环境中。如果你的包有任何第三方依赖项，这些依赖项也不会被安装，Sphinx 在构建文档时遇到未知包导入时可能会失败。
- en: You must handle both of these cases to ensure smooth operation moving forward.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 你必须处理这两种情况以确保后续的顺利运行。
- en: Read the Docs will read configuration from a YAML file called .readthedocs.yaml
    ([http://mng.bz/ZpAN](http://mng.bz/ZpAN)) in the root directory of your project.
    The Read the Docs build uses operating system images, much like the GitHub Actions
    you set up earlier. The YAML configuration file can change the operating system,
    the versions of tools used during the build, and so on. Read the Docs also found
    your Sphinx documentation files automatically, but you can explicitly configure
    where those files are located so Read the Docs doesn’t get confused later on.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: Read the Docs 将从你项目的根目录中名为 .readthedocs.yaml 的 YAML 文件中读取配置（[http://mng.bz/ZpAN](http://mng.bz/ZpAN)）。Read
    the Docs 构建使用操作系统镜像，就像你之前设置的 GitHub Actions 一样。YAML 配置文件可以更改构建过程中使用的工具的版本，等等。Read
    the Docs 还自动找到了你的 Sphinx 文档文件，但你也可以明确配置这些文件的位置，这样 Read the Docs 以后就不会混淆了。
- en: 'Create an empty .readthedocs.yaml now. For your project, you need to add the
    following:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 现在创建一个空的 .readthedocs.yaml 文件。对于你的项目，你需要添加以下内容：
- en: '`version`—The version of the Read the Docs configuration schema you’re using.
    The latest version is `2` at the time of this writing and is a required field.'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`version`—您使用的 Read the Docs 配置架构版本。在撰写本文时，最新版本是 `2`，这是一个必填字段。'
- en: '`sphinx.configuration`—The relative path from the project root directory to
    the Sphinx conf.py file.'
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sphinx.configuration`—从项目根目录到 Sphinx conf.py 文件的相对路径。'
- en: '`formats`—A list of the output types to build. Sphinx supports EPUB and PDF
    output in addition to HTML. If you want to build just the HTML, specify `htmlzip`.'
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`formats`—要构建的输出类型列表。Sphinx 支持除了 HTML 之外的 EPUB 和 PDF 输出。如果您只想构建 HTML，请指定 `htmlzip`。'
- en: '`build.os`—The operating system to build on. Use the latest Ubuntu LTS release,
    which at the time of this writing is `ubuntu-20.04`.'
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`build.os`—构建的操作系统。使用最新的 Ubuntu LTS 版本，在撰写本文时是 `ubuntu-20.04`。'
- en: '`build.tools.python`—The Python version to build on. At the time of this writing,
    the default is Python 3.7\. You should use one of the Python versions your package
    supports. Specify something like `"3.10"`, including the quotes; YAML interprets
    `3.10` without quotes as a decimal number, resulting in `3.1`.'
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`build.tools.python`—构建的 Python 版本。在撰写本文时，默认为 Python 3.7。您应该使用您的包支持的 Python
    版本之一。指定类似于 `"3.10"` 的内容，包括引号；YAML 将不带引号的 `3.10` 解释为十进制数字，结果为 `3.1`。'
- en: '`python.install[0].method`—How to install dependencies for the documentation
    build. Read the Docs supports using pip or Setuptools to install packages; you
    should use pip because the Setuptools approach is a legacy one, and you properly
    configured your package to be installable using the latest build system approach
    for Python. Specify `pip`.'
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`python.install[0].method`—如何为文档构建安装依赖项。Read the Docs 支持使用 pip 或 Setuptools
    来安装包；您应该使用 pip，因为 Setuptools 方法是一个遗留方法，并且您已正确配置了您的包，使其可以使用 Python 的最新构建系统方法进行安装。指定
    `pip`。'
- en: '`python.install[0].path`—The relative path to the directory of the package
    project. Your package project is the same as the root directory, so specify the
    current directory using a dot character (`.`).'
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`python.install[0].path`—到包项目目录的相对路径。您的包项目与根目录相同，因此使用点字符（`.`）指定当前目录。'
- en: Your Read the Docs YAML configuration file should look like the following listing
    when you finish.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 当您完成时，您的 Read the Docs YAML 配置文件应如下所示。
- en: Listing 8.11 A Read the Docs configuration file
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 8.11 一个 Read the Docs 配置文件
- en: '[PRE13]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: ❶ Read the Docs configuration schema version
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ Read the Docs 配置架构版本
- en: ❷ Location of the Sphinx configuration
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ Sphinx 配置的位置
- en: ❸ Builds only the HTML output
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 仅构建 HTML 输出
- en: ❹ How to specify a nondefault operating system
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 如何指定非默认操作系统
- en: ❺ How to specify a nondefault Python version—remember the quotes.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 如何指定非默认 Python 版本—记住引号。
- en: ❻ Uses pip to install a package before building documentation
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: ❻ 在构建文档之前使用 pip 安装包
- en: ❼ Installs the package located in the root project directory
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: ❼ 在根项目目录中安装包
- en: With this configuration in place, you can add dependencies to your project later
    and be confident that Sphinx won’t fail because of unknown imports. Next, you
    need to get Read the Docs to run the `sphinx-apidoc` command.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 在此配置就绪后，您可以稍后向项目中添加依赖项，并确信 Sphinx 不会因为未知导入而失败。接下来，您需要让 Read the Docs 运行 `sphinx-apidoc`
    命令。
- en: Running sphinx-apidoc on Read the Docs
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Read the Docs 上运行 sphinx-apidoc
- en: In your tox environment, you added the `sphinx-apidoc` command before the `sphinx-build`
    and `sphinx-autobuild` commands, respectively, so that the code documentation
    is extracted before the full build. When your project gets built on Read the Docs,
    Read the Docs is running its own separate set of commands that aren’t related
    to or aware of your tox environment. You can’t tell Read the Docs to change its
    process directly, but you can tell Sphinx to do something before every build.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的 tox 环境中，您在 `sphinx-build` 和 `sphinx-autobuild` 命令之前分别添加了 `sphinx-apidoc`
    命令，以便在完整构建之前提取代码文档。当您的项目在 Read the Docs 上构建时，Read the Docs 正在运行其自己的独立命令集，这些命令与您的
    tox 环境无关或未意识到。您不能直接告诉 Read the Docs 改变其过程，但您可以在每次构建之前告诉 Sphinx 做些什么。
- en: As part of its plugin-based architecture, Sphinx exposes a series of “events”
    ([http://mng.bz/Rv4R](http://mng.bz/Rv4R)) with which extensions can interface.
    One such event is called `builder-inited` ([http://mng.bz/2rro](http://mng.bz/2rro)),
    which is triggered just before the build occurs. Sphinx will call a `setup` function
    defined in your configuration during the build, where you can connect with any
    events you need to listen for. You can leverage this architecture along with the
    programmatic API for sphinx-apidoc to achieve the same behavior as calling the
    `sphinx-apidoc` command in your tox environment.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 作为其基于插件的架构的一部分，Sphinx公开了一系列“事件”（[http://mng.bz/Rv4R](http://mng.bz/Rv4R)），扩展可以通过这些事件进行交互。其中一个事件称为`builder-inited`（[http://mng.bz/2rro](http://mng.bz/2rro)），它在构建发生之前触发。Sphinx将在构建期间调用您配置中定义的`setup`函数，在那里您可以连接到您需要监听的事件。您可以利用这个架构以及sphinx-apidoc的编程API来实现与在tox环境中调用`sphinx-apidoc`命令相同的行为。
- en: Note What follows may feel redundant given what you already added in your setup.cfg
    file, but I recommend keeping both configurations. The duration of the sphinx-apidoc
    step grows linearly with the number of Python modules your project contains, so
    it only grows slower and slower over time. Running it before each and every build
    locally can be tiresome, especially when you’re making changes to only your prose
    documentation.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：以下内容可能因您已在setup.cfg文件中添加的内容而显得重复，但我建议保留这两种配置。sphinx-apidoc步骤的持续时间与您的项目包含的Python模块数量呈线性增长，因此随着时间的推移，它只会越来越慢。在本地每次构建之前运行它可能会很麻烦，尤其是当您只对文档的文本部分进行更改时。
- en: Your programmatic configuration of sphinx-apidoc should happen only when the
    build is executing in the Read the Docs environment. You can determine this by
    inspecting the value of the `READTHEDOCS` environment variable, which has a value
    of `"True"` in the Read the Docs build environment. When you detect that the build
    is happening on Read the Docs, you can then define your `setup` function to hook
    into sphinx-apidoc. sphinx-apidoc’s programmatic API accepts the same arguments
    as the command-line interface because it exposes a `main` function as a console
    script—similar to the one you created for your `harmony` command. The only difference
    when using it in the `docs/conf.py` module is that the paths to the source code,
    output directory, and ignored files need to be relative to the module rather than
    to the root directory of the project. You can use Python’s `os.path` module ([https://docs.python.org/3/library/os.path.xhtml](https://docs.python.org/3/library/os.path.xhtml))
    or the newer `pathlib` module ([https://docs.python.org/3/library/pathlib.xhtml](https://docs.python.org/3/library/pathlib.xhtml))
    to achieve this.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 您的程序配置sphinx-apidoc应在构建执行在Read the Docs环境中时进行。您可以通过检查`READTHEDOCS`环境变量的值来确定这一点，在Read
    the Docs构建环境中该变量的值为`"True"`。当您检测到构建正在Read the Docs上执行时，您可以定义您的`setup`函数以连接到sphinx-apidoc。sphinx-apidoc的编程API接受与命令行界面相同的参数，因为它暴露了一个`main`函数作为控制台脚本——类似于您为`harmony`命令创建的那个。在`docs/conf.py`模块中使用它的唯一区别是，源代码路径、输出目录和忽略文件的路径需要相对于模块而不是项目根目录。您可以使用Python的`os.path`模块([https://docs.python.org/3/library/os.path.xhtml](https://docs.python.org/3/library/os.path.xhtml))或较新的`pathlib`模块([https://docs.python.org/3/library/pathlib.xhtml](https://docs.python.org/3/library/pathlib.xhtml))来实现这一点。
- en: Add the code in the next listing to the bottom of the `docs/conf.py` module.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 将下一列表中的代码添加到`docs/conf.py`模块的底部。
- en: Listing 8.12 Making sphinx-apidoc run as part of the Read the Docs build process
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 列表8.12 使sphinx-apidoc作为Read the Docs构建过程的一部分运行
- en: '[PRE14]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: ❶ Only run this in the Read the Docs environment.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 仅在Read the Docs环境中运行此操作。
- en: ❷ Calculates the needed project paths
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 计算所需的项目路径
- en: ❸ A function to run sphinx-apidoc
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 运行sphinx-apidoc的函数
- en: ❹ Imports sphinx-apidoc
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 导入sphinx-apidoc
- en: ❺ Calls sphinx-apidoc with the same arguments as elsewhere
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 使用与其它地方相同的参数调用sphinx-apidoc
- en: ❻ Paths must be properly relative and must be strings.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: ❻ 路径必须是正确相对的，并且必须是字符串。
- en: ❼ Called by Sphinx during the build
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: ❼ 在构建过程中由Sphinx调用
- en: ❽ Calls run_apidoc just before the main build
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: ❽ 在主要构建之前调用run_apidoc
- en: When you finish adding the changes to the `docs/conf.py` module, you’re ready
    to commit your changes and push them to GitHub. When those changes arrive on the
    branch you specified on Read the Docs, it triggers a new build. When this build
    completes, you should see your documentation in full fidelity.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 当您完成对`docs/conf.py`模块的更改后，您就可以提交您的更改并将它们推送到GitHub。当这些更改到达Read the Docs上指定的分支时，它将触发一个新的构建。当这个构建完成后，您应该能够看到完整的文档。
- en: Note Read the Docs has an effective caching policy in place for documentation
    sites. You typically need to perform a hard refresh in your browser to see fresh
    content after a build.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 注意 Read the Docs 为文档站点实施了一个有效的缓存策略。通常，您需要在浏览器中进行强制刷新才能在构建后看到新鲜内容。
- en: Before moving on, Read the Docs offers one other convenience you should take
    advantage of.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续之前，Read the Docs 还提供了一项您应该利用的便利功能。
- en: Automating Read the Docs builds for GitHub pull requests
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 自动化 Read the Docs 为 GitHub 拉取请求构建
- en: 'Read the Docs can build your documentation for every pull request you open,
    much like the GitHub Actions workflow you already have in place. To add this,
    take the following steps:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: Read the Docs 可以为您打开的每个拉取请求构建文档，就像您已经设置的 GitHub Actions 工作流程一样。要添加此功能，请执行以下步骤：
- en: Visit your project’s page in Read the Docs.
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 访问 Read the Docs 中的项目页面。
- en: Click Admin.
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“管理员”。
- en: Click Advanced Settings.
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“高级设置”。
- en: Select the Build Pull Requests for This Project option at the bottom of the
    Global Settings section.
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在全局设置部分的底部选择“为此项目选择构建拉取请求”选项。
- en: Click Save at the bottom of the page.
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在页面底部点击“保存”。
- en: The next time you push a change, Read the Docs will add a status to your pull
    request indicating whether the documentation built successfully (see figure 8.10).
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 下次您推送更改时，Read the Docs 将在您的拉取请求中添加一个状态，指示文档是否成功构建（如图 8.10 所示）。
- en: '![](../../OEBPS/Images/08-10.png)'
  id: totrans-252
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/08-10.png)'
- en: Figure 8.10 Read the Docs build status on a GitHub pull request
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.10 Read the Docs 在 GitHub 拉取请求上的构建状态
- en: You can click the Details link on the Read the Docs pull request status to see
    an ephemeral version of the documentation. Read the Docs adds a warning to the
    HTML to indicate the documentation is not the live version (as shown in figure
    8.11).
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以点击 Read the Docs 拉取请求状态上的“详情”链接，查看文档的临时版本。Read the Docs 在 HTML 中添加了一个警告，表明文档不是实时版本（如图
    8.11 所示）。
- en: '![](../../OEBPS/Images/08-11.png)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/08-11.png)'
- en: Figure 8.11 Read the Docs builds an ephemeral version of the documentation for
    pull requests.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.11 Read the Docs 为拉取请求构建了一个临时的文档版本。
- en: 'You now have a documentation system that covers the following:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在拥有一个涵盖以下内容的文档系统：
- en: Prose documentation with rich interlinking and stylization powered by reStructuredText
    and Sphinx
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由 reStructuredText 和 Sphinx 驱动的丰富内联链接和样式化的文档
- en: Code documentation complete with type hints, which also supports reStructuredText
    syntax
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 完整的代码文档，包括类型提示，同时也支持 reStructuredText 语法
- en: Automated builds and publishing via Read the Docs
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过 Read the Docs 自动构建和发布
- en: This is valuable for you and your users at CarCorp and beyond, but the value
    moving forward will be in your commitment to keeping the documentation thorough
    and updated. Any time you make changes to your code—in particular, to the public
    API—consider what impact the change has on the documentation and act accordingly.
    The last sections of this chapter cover best practices and a few additional tips.
    If you’re feeling energized about documentation, have a look now; otherwise, you
    can move to the next chapter and revisit them when you’re ready for more.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 这对您和 CarCorp 的用户以及更广泛的人来说都是有价值的，但未来的价值将在于您保持文档详尽和更新的承诺。每次您更改代码时——特别是公共 API——请考虑这种更改对文档的影响，并相应地采取行动。本章的最后几节涵盖了最佳实践和一些额外的提示。如果您对文档感到兴奋，现在就可以查看；否则，您可以转到下一章，在您准备好了解更多信息时再回头来看。
- en: 8.4 Documentation best practices
  id: totrans-262
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 8.4 文档最佳实践
- en: At the beginning of this chapter, you learned about the Diátaxis framework,
    which aims to stratify documentation into distinct goals for the user. Some practices
    transcend this model and are applicable in almost any situation to ensure stellar
    documentation.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的开头，您了解了 Diátaxis 框架，该框架旨在将文档分层为用户的不同目标。一些实践超越了这一模型，几乎适用于任何情况，以确保出色的文档。
- en: 8.4.1 What to document
  id: totrans-264
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.4.1 需要记录的内容
- en: If you think of the thoroughness of documentation as a spectrum—excluding the
    “no documentation at all” case—one end is to document everything, and the other
    is to document only the public API. Sphinx offers features that can automatically
    extract code documentation even for undocumented or private functions and methods,
    so from a technical perspective, it supports the full spectrum. When deciding
    where you’d like to fall on this spectrum for your project, consider your audience
    carefully.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您将文档的彻底性视为一个范围——不包括“完全不文档化”的情况——那么一端是记录一切，另一端是仅记录公共API。Sphinx提供了可以自动提取代码文档的功能，即使是未文档化或私有的函数和方法，因此从技术角度来看，它支持整个范围。在决定您希望在项目中的哪个位置时，请仔细考虑您的受众。
- en: 'If you expect the audience to be *end users*, or people who only want to leverage
    your features to get their own work done, documenting the public API is the best
    choice. This has two benefits: people won’t be overwhelmed by code that doesn’t
    affect them, and they won’t be inclined to depend on it. Because Python doesn’t
    have truly private code, people will inevitably come to depend on implementation
    details, especially when they’re in the documentation. If you need to prioritize
    documenting only a subset of things, document the things users most want to know
    about first and work your way down to the less pressing areas.'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您预计受众是**最终用户**，或者只想利用您的功能来完成自己的工作的人，那么记录公共API是最好的选择。这有两个好处：人们不会因为不影响他们的代码而感到不知所措，他们也不会倾向于依赖它。由于Python没有真正的私有代码，人们不可避免地会依赖实现细节，尤其是在文档中。如果您需要优先记录某些事物，首先记录用户最想知道的事情，然后逐步处理不那么紧迫的区域。
- en: On the other hand, if you expect the audience to be other developers who also
    maintain the project, you may want to consider documenting implementation details
    that were tricky to solve, have known limitations, and so on. This can help them
    better develop the project in the future. They will have different priorities,
    often interacting with the code from an architectural perspective to determine
    good paths forward for the project. Because good documentation helps people understand
    beyond the “what” into the “why” of the code, you have an emphasized duty to ensure
    project maintainers understand the design and history of the project.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，如果您预计受众是其他开发者，他们也会维护该项目，那么您可能需要考虑记录那些难以解决、有已知限制的实现细节等。这可以帮助他们在未来更好地开发项目。他们会有不同的优先级，通常从架构的角度与代码交互，以确定项目的良好前进路径。因为好的文档有助于人们理解代码的“是什么”，而不仅仅是“为什么”，所以您有强调的义务确保项目维护者理解项目的设计和历史。
- en: 8.4.2 Prefer linking over repetition
  id: totrans-268
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.4.2 优先选择链接而非重复
- en: Aside from choosing which areas of your own project code to avoid documenting,
    it’s important to avoid documenting other projects’ code in too much depth as
    well. Keeping code up to date in your own project is already fairly challenging,
    but documenting other projects adds a new layer of complexity on top. Projects
    outside your control may change at any time, so behavior you document on Monday
    might change on Thursday, and you might not realize it for days or weeks or months.
    Instead, consider alluding to a major feature of a project and link to that project’s
    page for the feature. This has the additional benefit that people can understand
    the high-level flow in your documentation, and then they can jump over to the
    detailed documentation to learn more if and when needed.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 除了选择在您自己的项目代码中避免文档化的区域外，避免过度文档化其他项目的代码也同样重要。在您自己的项目中保持代码更新已经相当具有挑战性，而文档化其他项目则又增加了一层复杂性。您无法控制的项目可能会随时发生变化，因此您在周一记录的行为可能在周四发生变化，而您可能几天、几周甚至几个月后才会意识到这一点。相反，考虑提及项目的一个主要功能，并链接到该功能的页面。这还有一个额外的优点，即人们可以理解文档中的高级流程，如果需要了解更多信息，他们可以跳转到详细文档。
- en: By default, Sphinx enables you to link to specific classes, functions, and so
    on using roles like `:class:` and `:ref:` ([http://mng.bz/199Q](http://mng.bz/199Q)),
    but these references will only work within your own project. Fortunately, Sphinx
    provides an extension called intersphinx ([http://mng.bz/Poo8](http://mng.bz/Poo8))
    that enables references to work across other Sphinx-powered documentation sites.
    The only requirement for intersphinx is for any documentation sites you connect
    to be accessible over the network when building your project documentation.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Sphinx允许你使用像`:class:`和`:ref:`这样的角色链接到特定的类、函数等，([http://mng.bz/199Q](http://mng.bz/199Q))，但这些引用只能在你的项目内部工作。幸运的是，Sphinx提供了一个名为intersphinx的扩展（[http://mng.bz/Poo8](http://mng.bz/Poo8)），它允许跨其他Sphinx驱动的文档站点进行引用。intersphinx的唯一要求是在构建项目文档时，任何连接到的文档站点都必须可以通过网络访问。
- en: You can see intersphinx at work in a number of different Python projects. As
    an example, pytest-django ([https://pytest-django.readthedocs.io](https://pytest-django.readthedocs.io))
    cross-references both the pytest documentation ([https://docs.pytest.org](https://docs.pytest.org))
    and the Django documentation ([https://docs.djangoproject.com](https://docs.djangoproject.com)).
    Those projects in turn link to Python’s documentation ([https://docs.python.org](https://docs.python.org)).
    The interlinked sets of documentation ensure that users can always get the latest
    information available, directly from the official source. With well-structured
    documentation, this can create an almost Wikipedia-like experience where users
    can browse in and out of different topics.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在许多不同的Python项目中看到intersphinx在工作。例如，pytest-django ([https://pytest-django.readthedocs.io](https://pytest-django.readthedocs.io))
    对pytest文档 ([https://docs.pytest.org](https://docs.pytest.org)) 和Django文档 ([https://docs.djangoproject.com](https://docs.djangoproject.com))
    进行了交叉引用。那些项目反过来又链接到Python的文档 ([https://docs.python.org](https://docs.python.org))。这些相互链接的文档集确保用户始终能够直接从官方来源获取最新信息。有了结构良好的文档，这可以创造出一个几乎类似于维基百科的体验，用户可以在不同的主题之间浏览和退出。
- en: 8.4.3 Use consistent, empathetic language
  id: totrans-272
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.4.3 使用一致、富有同情心的语言
- en: Documentation benefits from many of the same practices as writing an essay,
    book, or other work. Tenses should be consistent. Grammar should be correct. References
    to things should be spelled and capitalized correctly. Any typos or confusing
    passages put cognitive load on a user who is already potentially facing a challenge
    by learning the material.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 文档受益于撰写论文、书籍或其他作品时的许多相同实践。时态应该一致。语法应该正确。对事物的引用应该拼写和大小写正确。任何错别字或令人困惑的段落都会给已经可能在学习材料上面临挑战的用户增加认知负担。
- en: Further, certain language can create frustration for users. Imagine someone
    is having a tough time understanding a concept and can’t get their code to work.
    When they visit the project’s documentation, it mentions that it should work in
    “just a few easy steps” or that it “obviously doesn’t work for this use case.”
    Things aren’t easy or obvious for this user, and seeing that phrasing might cause
    them to flip their desk over. Always make an effort to stick to the facts and
    remove weasel words, ambiguous phrasing, gendered language, and so on.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，某些语言可能会给用户带来挫败感。想象一下，有人很难理解一个概念，而且他们的代码无法正常工作。当他们访问项目的文档时，文档中提到它应该“只需几个简单步骤”就能工作，或者它“显然不适用于这个用例。”对于这个用户来说，事情并不简单或明显，看到这样的表述可能会让他们非常沮丧。始终努力坚持事实，并删除狡猾的词汇、含糊不清的表述、性别语言等等。
- en: 'Check your documentation for some of the following words and see whether they’re
    adding value:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 检查你的文档中以下单词，看看它们是否增加了价值：
- en: Basic
  id: totrans-276
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基础
- en: Easy/easily
  id: totrans-277
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 简单/容易
- en: Simple/simply
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 简单/简单地
- en: Obvious
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 明显的
- en: Just
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 只是
- en: Automatic/automated
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动/自动化
- en: Magic
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 魔法
- en: Fast/slow
  id: totrans-283
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 快/慢
- en: 'The following example shows how a passage might look before and after applying
    this practice:'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例显示了在应用此实践前后一段文字可能的样子：
- en: '[PRE15]'
  id: totrans-285
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 8.4.4 Avoid assumptions and create context
  id: totrans-286
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.4.4 避免假设并创建上下文
- en: Users often land on documentation after performing a search on Google or another
    search engine. They may crash-land on any page of your documentation without context,
    and they may not even know what they’re looking for. When you can, avoid relying
    on context from other sections or pages. If you do need to assume prior knowledge
    from another location, mention it explicitly, and link to it if possible. This
    will help users more quickly locate the information they need and do further reading
    if necessary to gain a solid understanding of the material.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 用户通常在 Google 或其他搜索引擎进行搜索后到达文档。他们可能在没有上下文的情况下随意点击你的文档中的任何页面，甚至可能不知道他们在寻找什么。当你能的时候，尽量避免依赖其他部分或页面的上下文。如果你确实需要从另一个位置假设先前的知识，请明确提及，如果可能的话，链接到它。这将帮助用户更快地找到他们需要的信息，并在必要时进行进一步阅读，以获得对材料的深入理解。
- en: 'The following example shows how a passage might look before and after applying
    this practice:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例显示了在应用此实践前后段落可能看起来如何：
- en: '[PRE16]'
  id: totrans-289
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 8.4.5 Create visual interest and coherent structure
  id: totrans-290
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.4.5 创建视觉兴趣和连贯结构
- en: Massive walls of text are hard to absorb. If you get lost or need to pause in
    the middle of a 20-line paragraph, you will also have difficulty finding your
    place when you pick back up. Breaking up the information with new paragraphs,
    figures, and so on helps people find and maintain their bearings, reducing cognitive
    load so they can stay engaged.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 大量的文本墙很难吸收。如果你在20行段落的中间迷失或需要暂停，当你重新开始时，你也很难找到你的位置。通过添加新段落、图表等来分割信息，有助于人们找到并保持他们的方向感，减少认知负荷，使他们能够保持参与。
- en: Some passages are difficult to break up—I apologize for any in this book—but
    as a general rule, try to limit passages to one focused topic per paragraph, and
    use lists for things that are naturally amenable to listing. Use parallel structure
    ([http://mng.bz/wyyB](http://mng.bz/wyyB)) so people can logically group phrases
    and concepts.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 有些段落很难拆分——对于本书中的任何此类段落，我表示歉意——但作为一般规则，尽量将段落限制在每个段落一个专注的主题，并使用列表来列出自然适合列出的内容。使用平行结构（[http://mng.bz/wyyB](http://mng.bz/wyyB)）以便人们可以逻辑地分组短语和概念。
- en: 8.4.6 Powering up your documentation
  id: totrans-293
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.4.6 为文档供电
- en: 'Because authoring documentation can be a high-friction activity, some of the
    best tools for creating great documentation improve the authoring process specifically.
    They may make the syntax for writing stylized text less tedious, help check whether
    your documentation is outdated, or help you cross-reference things more effectively.
    The following quick tips are some avenues to explore further:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 因为编写文档可能是一个高摩擦的活动，所以一些最好的文档创建工具专门改进了编写过程。它们可能使编写风格化文本的语法不那么繁琐，帮助检查你的文档是否过时，或者帮助你更有效地交叉引用内容。以下是一些可以进一步探索的快速提示：
- en: If you see some Sphinx-powered documentation you like because of its stylization
    or features, you can almost always take a look at the source code that produced
    it. Many Sphinx-powered sites link directly to the relevant file in GitHub. You
    can also look at that project’s Sphinx configuration to see if it uses any interesting
    extensions or techniques that you can adopt in your own project. Django’s configuration
    ([http://mng.bz/qooN](http://mng.bz/qooN)) is a lot to take in, but it has a lot
    of valuable things you can explore.
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你看到一些由 Sphinx 提供支持的文档，因为其风格或功能而喜欢，你几乎总能查看生成它的源代码。许多由 Sphinx 提供支持的网站直接链接到 GitHub
    中的相关文件。你还可以查看该项目的 Sphinx 配置，看看它是否使用了任何有趣的扩展或技术，你可以在自己的项目中采用。Django 的配置（[http://mng.bz/qooN](http://mng.bz/qooN)）有很多东西需要学习，但它有很多有价值的东西你可以探索。
- en: If you prefer Markdown over reStructuredText, or your project just needs both,
    check out the MyST project ([http://mng.bz/N59n](http://mng.bz/N59n)).
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你更喜欢 Markdown 而不是 reStructuredText，或者你的项目需要两者，请查看 MyST 项目（[http://mng.bz/N59n](http://mng.bz/N59n)）。
- en: Python’s `doctest` module ([https://docs.python.org/3/library/doctest.xhtml](https://docs.python.org/3/library/doctest.xhtml))
    can test code examples in your code’s docstrings to ensure they still function.
    This can be a nice way to ensure your documentation stays up to date.
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python 的 `doctest` 模块（[https://docs.python.org/3/library/doctest.xhtml](https://docs.python.org/3/library/doctest.xhtml)）可以测试代码示例中的
    docstrings，以确保它们仍然有效。这是一种确保你的文档保持更新的好方法。
- en: Read and observe the structure of documentation for big projects, even if they
    aren’t a Python project. The documentation for the Vue JavaScript framework ([https://v3.vuejs.org/guide/introduction.xhtml](https://v3.vuejs.org/guide/introduction.xhtml))
    is a good one to check out.
  id: totrans-298
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 阅读并观察大型项目的文档结构，即使它们不是 Python 项目。Vue JavaScript 框架的文档（[https://v3.vuejs.org/guide/introduction.xhtml](https://v3.vuejs.org/guide/introduction.xhtml)）是一个很好的参考。
- en: The napoleon extension ([http://mng.bz/m22y](http://mng.bz/m22y)) enables you
    to use some alternate formats for docstrings that will still be parsed correctly
    into structured documentation.
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Napoleon 扩展（[http://mng.bz/m22y](http://mng.bz/m22y)）允许您使用一些替代格式来编写 docstrings，这些格式仍然可以被正确解析成结构化的文档。
- en: If you don’t like the default Alabaster theme, Sphinx has other available built-in
    themes ([http://mng.bz/5mmZ](http://mng.bz/5mmZ)), and there’s an entire community
    of Sphinx documentation themers out there ([https://sphinx-themes.org/](https://sphinx-themes.org/)).
    You can also customize Sphinx from the ground up or alter an existing theme to
    fit your project’s needs.
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果您不喜欢默认的 Alabaster 主题，Sphinx 提供了其他可用的内置主题（[http://mng.bz/5mmZ](http://mng.bz/5mmZ)），并且有一个完整的
    Sphinx 文档主题社区（[https://sphinx-themes.org/](https://sphinx-themes.org/)）。您还可以从头开始自定义
    Sphinx 或修改现有主题以适应项目的需求。
- en: Summary
  id: totrans-301
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Documentation is necessary for the successful adoption of a project.
  id: totrans-302
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文档对于项目的成功采用是必要的。
- en: Different users may have different goals, and documentation should be focused
    on catering to one goal at a time.
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不同用户可能有不同的目标，文档应该专注于一次满足一个目标。
- en: Use a technology that supports linking and cross-references to support readers
    browsing the documentation.
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用支持链接和交叉引用的技术来支持读者浏览文档。
- en: Keeping documentation updated is challenging, so find ways to automate what
    you can. Keep code reference documentation close to the code, and extract it automatically
    for higher-level use.
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 保持文档更新是一项挑战，因此找到自动化您能做的事情的方法。将代码参考文档与代码保持紧密，并自动提取以供高级使用。
- en: Sphinx is an extensible framework for building documentation out of prose and
    code documentation.
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Sphinx 是一个可扩展的框架，用于从文本和代码文档中构建文档。
- en: Read the Docs is a popular public documentation platform that supports Sphinx.
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Read the Docs 是一个流行的公共文档平台，支持 Sphinx。
- en: Keep the reader in mind as you write; what’s the clearest, most honest way to
    say what needs to be said?
  id: totrans-308
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在写作时考虑读者；如何以最清晰、最诚实的方式表达需要表达的内容？
