- en: 4 Getting started with graphs
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 4 开始使用图形
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Introducing the `ggplot2` package
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍`ggplot2`包
- en: Creating a simple bivariate (two-variable) graph
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个简单的双变量（两个变量）图
- en: Using grouping and faceting to create multivariate graphs
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用分组和分面创建多变量图
- en: Saving graphs in multiple formats
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以多种格式保存图形
- en: On many occasions, I’ve presented clients with carefully crafted statistical
    results in the form of numbers and text, only to have their eyes glaze over while
    the chirping of crickets permeated the room. Yet those same clients had enthusiastic
    “Ah-ha!” moments when I presented the same information to them in the form of
    graphs. Often, I can see patterns in data or detect anomalies in data values by
    looking at graphs—patterns or anomalies that I completely missed when conducting
    more formal statistical analyses.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多场合，我向客户展示了精心制作的以数字和文本形式呈现的统计结果，但他们的眼睛却变得空洞，房间里充满了蝉鸣。然而，当我把同样的信息以图表的形式呈现给他们时，那些客户却有了热情的“啊哈！”时刻。通常，通过观察图表，我可以看到数据中的模式或检测到数据值中的异常——这些模式或异常在我进行更正式的统计分析时完全忽略了。
- en: Human beings are remarkably adept at discerning relationships from visual representations.
    A well-crafted graph can help you make meaningful comparisons among thousands
    of pieces of information, extracting patterns not easily found through other methods.
    This is one reason why advances in the field of statistical graphics have had
    such a major impact on data analysis. Data analysts need to *look* at their data,
    and this an area in which R shines.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 人类在从视觉表示中辨别关系方面非常擅长。一个精心制作的图表可以帮助您在成千上万的信息中进行有意义的比较，提取其他方法难以找到的模式。这也是统计图形领域的进步对数据分析产生如此重大影响的原因之一。数据分析师需要*查看*他们的数据，而R在这方面表现出色。
- en: The R language has grown organically over the years through the contributions
    of many independent software developers. This has led to the creation of four
    distinct approaches to graph creation in R—`base`, `lattice`, `ggplot2`, and `grid`
    graphics. In this chapter, and throughout the majority of the remaining chapters,
    we’ll focus on `ggplot2`, the most powerful and popular approach currently available
    in R.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: R语言通过许多独立软件开发者的贡献在多年中自然增长。这导致了R中创建图形的四种不同方法的产生——`base`、`lattice`、`ggplot2`和`grid`图形。在本章以及剩余章节的大部分内容中，我们将重点关注`ggplot2`，这是目前R中最强大和最受欢迎的方法。
- en: The `ggplot2` package, written by Hadley Wickham (2009a), provides a system
    for creating graphs based on the grammar of graphics described by Wilkinson (2005)
    and expanded by Wickham (2009b). The `ggplot2` package aims to provide a comprehensive,
    grammar-based system for generating graphs in a unified and coherent manner, allowing
    users to create new and innovative data visualizations.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 由Hadley Wickham（2009a）编写的`ggplot2`包提供了一种基于Wilkinson（2005）描述的图形语法和Wickham（2009b）扩展的系统来创建图形。`ggplot2`包旨在提供一个全面、基于语法的系统，以统一和连贯的方式生成图形，使用户能够创建新的和创新的数据可视化。
- en: 'This chapter will walk you through the major concepts and functions used to
    create `ggplot2` graphs by using visualizations to address the following questions:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将指导您通过使用可视化来解答以下问题，了解创建`ggplot2`图形的主要概念和函数：
- en: What is the relationship between a worker’s past experience and their salary?
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工人的过去经验和他们的薪水之间有什么关系？
- en: How can we summarize this relationship simply?
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们如何简单地总结这种关系？
- en: Is this relationship different for men and women?
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这种关系对男性和女性是否不同？
- en: Does it matter what industry the worker is in?
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工作人员的行业是否重要？
- en: We’ll start with a simple scatterplot displaying the relationship between workers’
    experience and wages. Then in each section, we’ll add new features until we’ve
    produced a single publication quality plot that addresses these questions. At
    each step, we’ll gain greater insight into the questions.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从显示工人经验和工资之间关系的简单散点图开始。然后在每个部分中，我们将添加新的功能，直到我们制作出一个单一的高质量出版物图表，以解决这些问题。在每一步中，我们将对这些问题有更深入的了解。
- en: To answer these questions, we’ll use the `CPS85` data frame contained in the
    `mosaicData` package. The data frame contains a random sample of 534 individuals
    selected from the 1985 *Current Population Survey* and includes information about
    their wages, demographics, and work experience. Be sure to install both the `mosaicData`
    and `ggplot2` packages before continuing `(install.packages(c("mosaicData", "ggplot2"))`).
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 为了回答这些问题，我们将使用包含在 `mosaicData` 包中的 `CPS85` 数据框。该数据框包含从1985年 *当前人口调查* 中随机选取的534个个体，包括他们的工资、人口统计信息和工作经验。在继续之前，请确保已安装
    `mosaicData` 和 `ggplot2` 包 `(install.packages(c("mosaicData", "ggplot2"))`).
- en: 4.1 Creating a graph with ggplot2
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.1 使用 ggplot2 创建图表
- en: The `ggplot2` package uses a series of functions to build up a graph in layers.
    We’ll build a complex graph by starting with a simple graph and adding elements
    one at a time. By default, `ggplot2` graphs appear on a grey background with white
    reference lines.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '`ggplot2` 包使用一系列函数分层构建图表。我们将从一个简单的图表开始，逐步添加元素来构建一个复杂的图表。默认情况下，`ggplot2` 图表显示在灰色背景上，带有白色参考线。'
- en: 4.1.1 ggplot
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.1.1 ggplot
- en: 'The first function in building a graph is the `ggplot(`) function. It specifies
    the following:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 构建图表的第一个函数是 `ggplot(`) 函数。它指定以下内容：
- en: The data frame containing the data to be plotted.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含要绘制数据的DataFrame。
- en: The mapping of the variables to visual properties of the graph. The mappings
    are placed in an `aes()` function (which stands for aesthetics or “something you
    can see”).
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将变量映射到图表的视觉属性。映射放置在 `aes()` 函数中（代表美学或“你可以看到的东西”）。
- en: 'The following code produces the graph in figure 4.1:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码生成了图4.1中的图表：
- en: '[PRE0]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![](Images/CH04_F01_Kabacoff3.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F01_Kabacoff3.png)'
- en: Figure 4.1 Mapping worker experience and wages to the x- and y-axes
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.1 将工人经验和工资映射到x轴和y轴
- en: Why is the graph empty? We specified that the `exper` variable should be mapped
    to the *x*-axis and that the `wage` variable should be mapped to the *y*-axis,
    but we haven’t yet specified *what* we wanted placed on the graph. In this case,
    we’ll want points to represent each participant.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么图表是空的？我们指定了 `exper` 变量应映射到 *x* 轴，而 `wage` 变量应映射到 *y* 轴，但我们还没有指定要在图上放置 *什么*。在这种情况下，我们希望用点来表示每个参与者。
- en: 4.1.2 Geoms
  id: totrans-28
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.1.2 几何对象
- en: '*Geoms* are the geometric objects (points, lines, bars, and shaded regions)
    that can be placed on a graph. They are added using functions whose names begin
    with `geom_`. Currently, 37 different geoms are available, and the list is growing.
    Table 4.1 describes the more common geoms, along with frequently used options
    for each.'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '*几何对象* 是可以放置在图上的几何形状（点、线、条形和阴影区域）。它们通过以 `geom_` 开头的函数添加。目前，有37种不同的几何对象可用，且列表正在增长。表4.1描述了更常见的几何对象，以及每个几何对象常用的选项。'
- en: Table 4.1 Geom functions
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 表4.1 几何函数
- en: '| Function | Adds | Options |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| 函数 | 添加 | 选项 |'
- en: '| `geom_bar()` | Bar chart | `color`, `fill`, `alpha` |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| `geom_bar()` | 条形图 | `color`, `fill`, `alpha` |'
- en: '| `geom_boxplot()` | Box plot | `color`, `fill`, `alpha`, `notch`, `width`
    |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| `geom_boxplot()` | 箱线图 | `color`, `fill`, `alpha`, `notch`, `width` |'
- en: '| `geom_density()` | Density plot | `color`, `fill`, `alpha`, `linetype` |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| `geom_density()` | 密度图 | `color`, `fill`, `alpha`, `linetype` |'
- en: '| `geom_histogram()` | Histogram | `color`, `fill`, `alpha`, `linetype`, `binwidth`
    |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| `geom_histogram()` | 直方图 | `color`, `fill`, `alpha`, `linetype`, `binwidth`
    |'
- en: '| `geom_hline()` | Horizontal lines | `color`, `alpha`, `linetype`, `size`
    |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| `geom_hline()` | 水平线 | `color`, `alpha`, `linetype`, `size` |'
- en: '| `geom_jitter()` | Jittered points | `color`, `size`, `alpha`, `shape` |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| `geom_jitter()` | 振荡点 | `color`, `size`, `alpha`, `shape` |'
- en: '| `geom_line()` | Line graph | `colorvalpha`, `linetype`, `size` |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| `geom_line()` | 折线图 | `colorvalpha`, `linetype`, `size` |'
- en: '| `geom_point()` | Scatterplot | `color`, `alpha`, `shape`, `size` |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| `geom_point()` | 散点图 | `color`, `alpha`, `shape`, `size` |'
- en: '| `geom_rug()` | Rug plot | `color`, `side` |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| `geom_rug()` | 针状图 | `color`, `side` |'
- en: '| `geom_smooth()` | Fitted line | `method`, `formula`, `color`, `fill`, `linetype`,
    `size` |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| `geom_smooth()` | 拟合线 | `method`, `formula`, `color`, `fill`, `linetype`,
    `size` |'
- en: '| `geom_text()` | Text annotations | Many; see the help for this function |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| `geom_text()` | 文本注释 | 许多；请参阅该函数的帮助文档 |'
- en: '| `geom_violin()` | Violin plot | `color`, `fill`, `alpha`, `linetype` |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| `geom_violin()` | 小提琴图 | `color`, `fill`, `alpha`, `linetype` |'
- en: '| `geom_vline()` | Vertical lines | `color`, `alpha`, `linetype`, `size` |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| `geom_vline()` | 垂直线 | `color`, `alpha`, `linetype`, `size` |'
- en: 'We’ll add points using the `geom_point()` function, creating a scatterplot.
    In `ggplot2` graphs, functions are chained together using the `+` sign to build
    a final plot:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 `geom_point()` 函数添加点，创建散点图。在 `ggplot2` 图表中，函数通过使用 `+` 符号链接在一起来构建最终的图表：
- en: '[PRE1]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Figure 4.2 shows the results.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.2显示了结果。
- en: '![](Images/CH04_F02_Kabacoff3.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F02_Kabacoff3.png)'
- en: Figure 4.2 Scatterplot of worker experience vs. wages
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.2 工作经验与工资的散点图
- en: 'It appears that as experience goes up, wages go up, but the relationship is
    weak. The graph also indicates that there is an outlier. One individual has a
    wage much higher than the rest. We’ll delete this case and reproduce the plot:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来，随着经验的增加，工资也会增加，但关系较弱。图表还表明存在一个异常值。有一个人工资远高于其他人。我们将删除这个案例并重新绘制图表：
- en: '[PRE2]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Figure 4.3 displays the new graph.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.3显示了新的图表。
- en: '![](Images/CH04_F03_Kabacoff3.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F03_Kabacoff3.png)'
- en: Figure 4.3 Scatterplot of worker experience vs. wages with outlier removed
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.3 删除异常值后的工作经验与工资的散点图
- en: A number of options can be specified in a `geom_` function (see table 4.1).
    Options for `geom_point()` include `color`, `size`, `shape`, and `alpha`. These
    control the point color, size, shape, and transparency, respectively. Colors can
    be specified by name or hexadecimal code. Shape and linetype can be specified
    by the name or number representing the pattern or symbol, respectively. Point
    size is specified with positive real numbers starting at 0\. Large numbers produce
    larger point sizes. Transparency ranges from 0 (completely transparent) to 1 (completely
    opaque). Adding a degree of transparency can help visualize overlapping points.
    Each of these options is described more fully in chapter 19.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在`geom_`函数中可以指定多个选项（见表4.1）。`geom_point()`的选项包括`color`、`size`、`shape`和`alpha`。这些分别控制点的颜色、大小、形状和透明度。颜色可以通过名称或十六进制代码指定。形状和线型可以通过表示图案或符号的名称或数字指定。点的大小用从0开始的正实数指定。大数字产生更大的点大小。透明度从0（完全透明）到1（完全不透明）。添加一定程度的透明度可以帮助可视化重叠的点。这些选项的更详细描述在第19章中。
- en: 'Let’s make the points in figure 4.3 larger, semitransparent, and blue. We’ll
    also change the gray background to white using a `theme` (themes are described
    in section 4.1.7 and chapter 19). The following code produces the graph in figure
    4.4:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将图4.3中的点放大，半透明，并改为蓝色。我们还将使用`theme`（在第4.1.7节和第19章中描述）将灰色背景改为白色。以下代码生成了图4.4中的图表：
- en: '[PRE3]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: I might argue that the chart is more attractive (at least if you have color
    output), but it doesn’t add to our insights. It would be helpful if the graph
    had a line summarizing the trend between experience and wages.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 我可能会说，这个图表更吸引人（至少如果你有彩色输出），但它并没有增加我们的见解。如果图表中有一条总结经验与工资之间趋势的线，那将是有帮助的。
- en: '![](Images/CH04_F04_Kabacoff3.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F04_Kabacoff3.png)'
- en: Figure 4.4 Scatterplot of worker experience vs. wages with outlier removed with
    modified point color, transparency, and point size. The `bw` theme (dark on light)
    has been applied.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.4 删除异常值后的工作经验与工资的散点图，修改了点的颜色、透明度和点的大小。应用了`bw`主题（深色背景）。
- en: 'We can add this line with the `geom_smooth()` function. Options control the
    type of line (linear, quadratic, nonparametric), the thickness of the line, the
    line’s color, and the presence or absence of a confidence interval. Each of these
    is discussed in chapter 11\. Here we request a linear regression (`method` `=`
    `lm`) line (where `lm` stands for linear model):'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`geom_smooth()`函数添加这一行。选项控制线的类型（线性、二次、非参数），线的粗细，线的颜色，以及置信区间的存在与否。这些内容在第11章中都有讨论。在这里，我们请求一个线性回归线（`method`
    `=` `lm`，其中`lm`代表线性模型）：
- en: '[PRE4]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The results are shown in figure 4.5.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 结果显示在图4.5中。
- en: '![](Images/CH04_F05_Kabacoff3.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F05_Kabacoff3.png)'
- en: Figure 4.5 Scatterplot of worker experience vs. wages with a line of best fit
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.5 工作经验与工资的散点图，带有最佳拟合线
- en: We can see from this line that, on average, wages appear to increase to a moderate
    degree with experience. This chapter uses only two geoms. In future chapters,
    we’ll use others to create a wide variety of graph types, including bar charts,
    histograms, box plots, density plots, and others.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 从这条线我们可以看出，平均而言，工资似乎随着经验的增加而适度增加。本章只使用了两个geom。在未来的章节中，我们将使用其他geom来创建各种图表类型，包括条形图、直方图、箱线图、密度图等。
- en: 4.1.3 Grouping
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.1.3 分组
- en: In the previous section, we set graph characteristics such as color and transparency
    to a *constant* value. However, we can also map variables values to the color,
    shape, size, transparency, line style, and other visual characteristics of geometric
    objects. This allows groups of observations to be superimposed in a single graph
    (a process called *grouping*).
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一节中，我们将图形特征如颜色和透明度设置为 *常量* 值。然而，我们也可以将变量值映射到几何对象的颜色、形状、大小、透明度、线型和其他视觉特征。这使得多个观测值可以在单个图形中叠加（称为
    *分组*）。
- en: Let’s add `sex` to the plot and represent it by `color`, `shape`, and `linetype:`
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们在图形中添加 `sex` 并通过 `color`、`shape` 和 `linetype:` 来表示它：
- en: '[PRE5]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: By default, the first group (female) is represented by pink-filled circles and
    a solid pink line, while the second group (male) is represent by teal-filled triangles
    and a dashed teal line. Figure 4.6 shows the new graph.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，第一组（女性）由粉色填充的圆圈和实线粉色表示，而第二组（男性）由青色填充的三角形和虚线青色表示。图 4.6 显示了新的图形。
- en: '![](Images/CH04_F06_Kabacoff3.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F06_Kabacoff3.png)'
- en: Figure 4.6 Scatterplot of worker experience vs. wages with points colored by
    sex and separate line of best fit for men and women
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.6 工作经验与工资的散点图，点按性别着色，并为男性和女性分别绘制最佳拟合线
- en: Note that the `color=sex,` `shape=sex,` and `linetype=sex` options are placed
    in the `aes()` function because we are mapping a variable to an aesthetic. The
    `geom_ smooth` option (`se` `=` `FALSE`) was added to suppresses the confidence
    intervals, making the graph less busy and easier to read. The `size` `=` `1.5`
    option makes the line a bit thicker.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，`color=sex,`、`shape=sex,` 和 `linetype=sex` 选项放置在 `aes()` 函数中，因为我们正在将一个变量映射到一个美学。添加
    `geom_smooth` 选项（`se` `=` `FALSE`）用于抑制置信区间，使图形不那么复杂，更容易阅读。`size` `=` `1.5` 选项使线条略粗。
- en: Simplifying graphs
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 简化图形
- en: In general, our goal is to create graphs that are as simple as possible while
    conveying the information accurately. In the graphs in this chapter, I would probably
    map gender to color alone. Adding mappings to shape and line type makes the graphs
    unnecessarily busy. I’ve added them here to create graphs that are more easily
    readable in both color (e-book) and the greyscale (print) formats of this book.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，我们的目标是创建尽可能简单的图形，同时准确传达信息。在本章的图形中，我可能会将性别映射到颜色。将映射添加到形状和线型会使图形显得过于复杂。我添加它们是为了创建在本书的颜色（电子书）和灰度（印刷）格式中更容易阅读的图形。
- en: It now appears that men tend to make more money than women (higher line). Additionally,
    there may be a stronger relationship between experience and wages for men than
    for women (steeper line).
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 现在看起来男性比女性赚的钱更多（更高的线）。此外，男性和工资之间的关系可能比女性更强（线更陡）。
- en: 4.1.4 Scales
  id: totrans-78
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.1.4 尺度
- en: As we’ve seen, the `aes()` function is used to map variables to the visual characteristics
    of a plot. Scales specify how each of these mappings occurs. For example, `ggplot2`
    automatically creates plot axes with tick marks, tick mark labels, and axis labels.
    Often they look fine, but occasionally, you’ll want to take greater control over
    their appearance. Colors that represent groups are chosen automatically, but you
    may want to select a different set of colors based on your tastes or a publication’s
    requirements.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，`aes()` 函数用于将变量映射到图形的视觉特征。尺度指定了这些映射如何发生。例如，`ggplot2` 自动创建带有刻度标记、刻度标记标签和轴标签的图形轴。通常它们看起来很好，但偶尔您可能希望对其外观有更大的控制权。代表组别的颜色是自动选择的，但您可能希望根据您的品味或出版物的要求选择不同的颜色集。
- en: Scale functions (which start with `scale_`) allow you to modify default scaling.
    Table 4.2 lists some common scaling functions.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 尺度函数（以 `scale_` 开头）允许您修改默认的缩放。表 4.2 列出了一些常见的缩放函数。
- en: Table 4.2 Some common scale functions
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 表 4.2 一些常见的尺度函数
- en: '| Function | Description |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '| 函数 | 描述 |'
- en: '| `scale_x_continuous(), scale_y_continuous()` | Scales the *x* and *y* axes
    for quantitative variables. Options include `breaks` for specifying tick marks,
    `labels` for specifying tick mark labels, and `limits` to control the range of
    the values displayed. |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '| `scale_x_continuous(), scale_y_continuous()` | 对定量变量的 *x* 和 *y* 轴进行缩放。选项包括
    `breaks` 用于指定刻度标记，`labels` 用于指定刻度标记标签，以及 `limits` 用于控制显示值的范围。|'
- en: '| `scale_x_discrete(), scale_y_discrete()` | Same as above for axes representing
    categorical variables. |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
  zh: '| `scale_x_discrete(), scale_y_discrete()` | 与上述用于表示分类变量的轴相同。|'
- en: '| `scale_color_manual()` | Specifies the colors used to represent the levels
    of a categorical variable. The `values` option specifies the colors. A table of
    colors can be found at [www.stat.columbia.edu/~tzheng/files/Rcolor.pdf](http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf).
    |'
  id: totrans-85
  prefs: []
  type: TYPE_TB
  zh: '| `scale_color_manual()` | 指定用于表示分类变量级别的颜色。`values`选项指定颜色。颜色表可以在[www.stat.columbia.edu/~tzheng/files/Rcolor.pdf](http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf)找到。|'
- en: 'In the next plot, we’ll change the *x*- and *y*-axis scaling and the colors
    representing males and females. The *x*-axis representing `exper` will range from
    0 to 60 by 10, and the *y*-axis representing `wage` will range from 0 to 30 by
    5\. Females will be coded with an off-red color, and males will be coded with
    an off-blue color. The following code produces the graph in figure 4.7:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个图表中，我们将更改x轴和y轴的缩放比例以及代表男性和女性的颜色。代表`exper`的x轴将从0到60以10为增量，代表`wage`的y轴将从0到30以5为增量。女性将被编码为偏红色，男性将被编码为偏蓝色。以下代码生成了图4.7中的图表：
- en: '[PRE6]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](Images/CH04_F07_Kabacoff3.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F07_Kabacoff3.png)'
- en: Figure 4.7 Scatterplot of worker experience vs. wages with custom x- and y-axes
    and custom color mappings for sex
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.7展示了工人经验与工资的散点图，具有自定义的x轴和y轴以及针对性别的自定义颜色映射
- en: Breaks are defined by a vector of values. Here, the `seq()` function provides
    a shortcut. For example, `seq(0,` `60,` `10)` generates a numeric vector starting
    with 0, ending with 60, and incrementing by 10.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 断点由值向量定义。在这里，`seq()`函数提供了一个快捷方式。例如，`seq(0, 60, 10)`生成一个从0开始，以10为增量，到60结束的数值向量。
- en: The numbers on the *x*- and *y*-axes are better, and the colors are more attractive
    (IMHO). However, wages are in dollars. We can change the labels on the y-axis
    to represent dollars using the `scales` package, which provides label formatting
    for dollars, euros, percentages, and more.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: x轴和y轴上的数字更好，颜色也更吸引人（个人看法）。然而，工资是以美元计算的。我们可以使用`scale`包更改y轴上的标签，以表示美元，该包为美元、欧元、百分比等提供了标签格式化。
- en: 'Install the `scales` package (`install.packages("scales")`), and then run the
    following code:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 安装`scales`包（`install.packages("scales")`），然后运行以下代码：
- en: '[PRE7]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Figure 4.8 provides the results.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.8提供了结果。
- en: '![](Images/CH04_F08_Kabacoff3.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F08_Kabacoff3.png)'
- en: Figure 4.8 Scatterplot of worker experience vs. wages with custom x- and y-axes
    and custom color mappings for sex. Wages are printed in dollar format.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.8展示了工人经验与工资的散点图，具有自定义的x轴和y轴以及针对性别的自定义颜色映射。工资以美元格式打印。
- en: We are definitely getting there. The next question is whether the relationship
    between experience, wages, and sex is the same for each job sector. Let’s repeat
    this graph once for each job sector to explore this.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 我们肯定正在取得进展。下一个问题是经验、工资和性别之间的关系是否在每个工作部门都是相同的。让我们为每个工作部门重复这个图表一次来探索这一点。
- en: 4.1.5 Facets
  id: totrans-98
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.1.5 分面
- en: Sometimes relationships are clearer if groups appear in side-by-side graphs
    rather than overlapping in a single graph. Facets reproduce a graph for each level
    of a given variable (or combination of variables). You can create faceted graphs
    using the `facet_wrap()` and `facet_grid()` functions. The syntax is given in
    table 4.3, where `var`, `rowvar`, and `colvar` are factors.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 如果组在并排的图表中而不是在单个图表中重叠，关系可能更清晰。分面会为给定变量的每个级别（或变量的组合）复制一个图表。您可以使用`facet_wrap()`和`facet_grid()`函数创建分面图表。语法在表4.3中给出，其中`var`、`rowvar`和`colvar`是因子。
- en: Table 4.3 `ggplot2` facet functions
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 表4.3 `ggplot2`分面函数
- en: '| Syntax | Results |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
  zh: '| 语法 | 结果 |'
- en: '| `facet_wrap(~var, ncol=n)` | Separate plots for each level of `var` arranged
    into n columns |'
  id: totrans-102
  prefs: []
  type: TYPE_TB
  zh: '| `facet_wrap(~var, ncol=n)` | 将`var`的每个级别分别排列成n列 |'
- en: '| `facet_wrap(~var, nrow=n)` | Separate plots for each level of `var` arranged
    into n rows |'
  id: totrans-103
  prefs: []
  type: TYPE_TB
  zh: '| `facet_wrap(~var, nrow=n)` | 将`var`的每个级别分别排列成n行 |'
- en: '| `facet_grid(rowvar~colvar)` | Separate plots for each combination of `rowvar`
    and `colvar`, where `rowvar` represents rows and `colvar` represents columns |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '| `facet_grid(rowvar~colvar)` | 为`rowvar`和`colvar`的每个组合创建单独的图表，其中`rowvar`代表行，`colvar`代表列
    |'
- en: '| `facet_grid(rowvar~.)` | Separate plots for each level of `rowvar`, arranged
    as a single column |'
  id: totrans-105
  prefs: []
  type: TYPE_TB
  zh: '| `facet_grid(rowvar~.)` | 为`rowvar`的每个级别创建单独的图表，排列成单列 |'
- en: '| `facet_grid(.~colvar)` | Separate plots for each level of `colvar`, arranged
    as a single row |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
  zh: '| `facet_grid(.~colvar)` | 为`colvar`的每个级别创建单独的图表，排列成单行 |'
- en: 'Here, facets will be defined by the eight levels of the sector variable. Since
    each facet will be smaller than a one-panel graph alone, we’ll omit `size=3` from
    `geom_point()` and `size=1.5` from `geom_smooth()`. This will reduce the point
    and line sizes compared with the previous graphs and looks better in a faceted
    graph. The following code produces figure 4.9:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，面元将由职业变量的八个级别定义。由于每个面元都将比单独一个面板图更小，我们将从 `geom_point()` 中省略 `size=3`，从 `geom_smooth()`
    中省略 `size=1.5`。这将减小点的大小和线的大小，与之前的图表相比，在分面图中看起来更好。以下代码生成了图 4.9：
- en: '[PRE8]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](Images/CH04_F09_Kabacoff3.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F09_Kabacoff3.png)'
- en: Figure 4.9 Scatterplot of worker experience vs. wages with custom x- and y-axes
    and custom color mappings for sex. Separate graphs (facets) are provided for each
    of eight job sectors.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.9 展示了工人经验与工资的关系散点图，具有自定义的 x 轴和 y 轴以及针对性别的自定义颜色映射。为八个职业领域的每个领域提供了单独的图表（面元）。
- en: It appears that the differences between men and women depend on the job sector
    under consideration. For example, there is a strong positive relationship between
    experience and wages for male managers, but not for female managers. To a lesser
    extent, this is also true for sales workers. There appears to be no relationship
    between experience and wages for either male and female service workers. In either
    case, males make slightly more. Wages go up with experience for female clerical
    workers, but they may go down for male clerical workers (the relationship may
    not be significant here). We have gained a great deal of insight into the relationship
    between wages and experience at this point.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来，男性和女性之间的差异取决于考虑的职业领域。例如，对于男性经理来说，经验和工资之间存在强烈的正相关关系，但对于女性经理则没有。在某种程度上，这一点也适用于销售人员。对于男性和女性服务人员来说，似乎不存在经验和工资之间的关系。在任何情况下，男性赚得稍微多一些。对于女性文职人员来说，工资随着经验的增加而上升，但对于男性文职人员来说可能会下降（这里的关系可能不显著）。到目前为止，我们已经对工资与经验之间的关系有了深刻的见解。
- en: 4.1.6 Labels
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.1.6 标签
- en: 'Graphs should be easy to interpret, and informative labels are a key element
    in achieving this goal. The `labs()` function provides customized labels for the
    axes and legends. Additionally, a custom title, subtitle, and caption can be added.
    Let’s modify each in the following code:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 图表应该易于解释，并且信息标签是实现这一目标的关键元素。`labs()` 函数为坐标轴和图例提供自定义标签。此外，还可以添加自定义标题、副标题和说明。让我们在以下代码中修改每个部分：
- en: '[PRE9]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Figure 4.10 shows the graph.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.10 展示了该图。
- en: '![](Images/CH04_F10_Kabacoff3.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F10_Kabacoff3.png)'
- en: Figure 4.10 Scatterplot of worker experience vs. wages with separate graphs
    (facets) for each of eight job sectors and custom titles and labels
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.10 展示了八个职业领域的工人经验与工资的关系散点图，每个领域都有单独的图表（面元）和自定义标题和标签
- en: Now a viewer doesn’t need to guess what the labels `expr` and `wage` mean or
    where the data comes from.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 现在查看者不需要猜测标签 `expr` 和 `wage` 的含义或数据来源。
- en: 4.1.7 Themes
  id: totrans-119
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.1.7 主题
- en: 'Finally, we can fine-tune the appearance of the graph using themes. Theme functions
    (which start with `theme_`) control background colors, fonts, grid lines, legend
    placement, and other non-data-related features of the graph. Let’s use a cleaner
    theme. Starting with figure 4.4, we used a theme that produced a white background
    and light grey reference lines. Let’s try a different theme—one that is more minimalistic.
    The following code produces the graph in figure 4.11:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们可以使用主题来微调图表的外观。主题函数（以 `theme_` 开头）控制背景颜色、字体、网格线、图例位置和其他与数据无关的图表特征。让我们使用一个更简洁的主题。从图
    4.4 开始，我们使用了一个产生白色背景和浅灰色参考线的主题。让我们尝试一个更简约的主题。以下代码生成了图 4.11：
- en: '[PRE10]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](Images/CH04_F11_Kabacoff3.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F11_Kabacoff3.png)'
- en: Figure 4.11 Scatterplot of worker experience vs. wages with separate graphs
    (facets) for each of eight job sectors, custom titles and labels, and a cleaner
    theme
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.11 展示了工人经验与工资的关系散点图，每个八个职业领域都有单独的图表（面元），自定义标题和标签，以及更简洁的主题
- en: This is our finished graph, ready for publication. Of course, these findings
    are tentative. They are based on a limited sample size and don’t involve statistical
    testing to assess whether differences may be due to chance variation. Appropriate
    tests for this type of data will be described in chapter 8\. Themes are described
    more fully in chapter 19.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们完成的图表，准备发布。当然，这些发现是初步的。它们基于一个有限的样本量，并且没有进行统计测试来评估差异是否可能是由于偶然变化。第 8 章将描述适用于此类数据的适当测试。主题在第
    19 章中更详细地描述。
- en: 4.2 ggplot2 details
  id: totrans-125
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.2 ggplot2 详细信息
- en: 'Before finishing this chapter, there are three important topics to consider:
    the placement of the `aes()` function, the treatment of `ggplot2` graphs as R
    objects, and various methods to save your graphs for use in reports and web pages.'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 在结束本章之前，有三个重要主题需要考虑：`aes()`函数的位置，将`ggplot2`图形作为R对象处理，以及将您的图形保存用于报告和网页的各种方法。
- en: 4.2.1 Placing the data and mapping options
  id: totrans-127
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.2.1 放置数据和映射选项
- en: Plots created with `ggplot2` always start with the `ggplot` function. In the
    previous examples, the `data=` and `mapping=` options were placed in this function.
    In this case, they apply to each `geom` function that follows.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`ggplot2`创建的图始终以`ggplot`函数开始。在先前的示例中，`data=`和`mapping=`选项放置在这个函数中。在这种情况下，它们适用于随后的每个`geom`函数。
- en: 'You can also place these options directly within a geom. In that case, they
    only apply to that *specific* geom. Consider the following graph:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 您也可以直接在geom中放置这些选项。在这种情况下，它们只适用于该*特定* geom。考虑以下图形：
- en: '[PRE11]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Figure 4.12 shows the resulting plot.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.12显示了结果图。
- en: '![](Images/CH04_F12_Kabacoff3.png)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![图像](Images/CH04_F12_Kabacoff3.png)'
- en: Figure 4.12 Scatterplot of experience and wage by sex, where `aes(color=sex)`
    is placed in the `ggplot()` function. The mapping is applied to both `geom_point()`
    and `geom_smooth()`, producing separate point colors for males and females, along
    with separate lines of best fit.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.12按性别显示经验和工资的散点图，其中`aes(color=sex)`放置在`ggplot()`函数中。映射应用于`geom_point()`和`geom_smooth()`，为男性和女性产生单独的点颜色，以及为所有工人产生单独的最佳拟合线。
- en: Since the mapping of `sex` to color appears in the `ggplot()` function, it applies
    to both `geom_point` and `geom_smooth`. The color of the point indicates the sex,
    and a separate colored-trend line is produced for men and women. Compare this
    to
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 由于性别到颜色的映射出现在`ggplot()`函数中，因此它适用于`geom_point`和`geom_smooth`。点的颜色表示性别，并为男性和女性产生单独的彩色趋势线。与以下内容比较
- en: '[PRE12]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Figure 4.13 shows the resulting graph.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.13显示了结果图。
- en: '![](Images/CH04_F13_Kabacoff3.png)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![图像](Images/CH04_F13_Kabacoff3.png)'
- en: Figure 4.13 Scatterplot of experience and wage by sex, where `aes(color=sex)`
    is placed in the `geom_point()` function. The mapping is applied to point color,
    producing separate point colors for men and women, but a single line of best fit
    for all workers.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.13按性别显示经验和工资的散点图，其中`aes(color=sex)`放置在`geom_point()`函数中。映射应用于点颜色，为男性和女性产生单独的点颜色，但为所有工人产生单独的最佳拟合线。
- en: Since the sex-to-color mapping only appears in the `geom_point()` function,
    it is only used there. A single trend line is created for all observations.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 由于性别到颜色的映射只出现在`geom_point()`函数中，因此它只在那里使用。为所有观测值创建一条趋势线。
- en: Most of the examples in this book place the data and mapping options in the
    `ggplot` function. Additionally, the phrases `data=` and `mapping=` are omitted
    since the first option always refers to data and the second option always refers
    to mapping.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 本书中的大多数示例都将数据和映射选项放置在`ggplot`函数中。此外，省略了`data=`和`mapping=`短语，因为第一个选项始终指数据，第二个选项始终指映射。
- en: 4.2.2 Graphs as objects
  id: totrans-141
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.2.2 图形作为对象
- en: A `ggplot2` graph can be saved as a named R object (a list), manipulated further,
    and then printed or saved to disk. Consider the code in the following listing.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '`ggplot2`图形可以保存为命名的R对象（列表），进一步操作，然后打印或保存到磁盘。考虑以下列表中的代码。'
- en: Listing 4.1  Using a `ggplot2` graph as an object
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 列表4.1 使用`ggplot2`图形作为对象
- en: '[PRE13]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: ❶ Prepare data.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 准备数据。
- en: ❷ Create a scatterplot and save it as myplot.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 创建散点图并将其保存为myplot。
- en: ❸ Display myplot.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 显示myplot。
- en: ❹ Make the points larger and blue, save it as myplot2, and display the graph.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 将点放大并变为蓝色，保存为myplot2，并显示图形。
- en: ❺ Display myplot with a best fit line and a title.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 显示带有最佳拟合线和标题的myplot。
- en: First, the data is imported and outliers are removed. Then, a simple scatter
    plot of experience versus wages is created and saved as myplot. Next, the plot
    is printed. The plot is then modified by changing the point size and color, saved
    as myplot2, and printed. Finally, the original plot is given a line of best fit
    and title and printed. Note that these changes are not saved.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，导入数据并移除异常值。然后，创建一个简单的经验与工资的散点图，并将其保存为myplot。接下来，打印该图。然后通过改变点的大小和颜色修改该图，保存为myplot2，并打印。最后，给原始图添加最佳拟合线和标题，并打印。请注意，这些更改不会被保存。
- en: The ability to save graphs as objects allows you to continue to work with and
    modify them. This can be a real time saver (and help you avoid carpal tunnel syndrome).
    It is also handy when saving graphs programmatically, as we’ll see in the next
    section.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 将图表保存为对象的能力允许您继续使用和修改它们。这可以节省大量时间（并帮助您避免腕管综合征）。在下一节中，我们将看到，当以编程方式保存图表时，这也很方便。
- en: 4.2.3 Saving graphs
  id: totrans-152
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.2.3 保存图表
- en: You can save the graphs created by `ggplot2` via the RStudio GUI or through
    your code. To save a graph using the RStudio menus, go to the Plots tab and choose
    Export (see figure 4.14).
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过 RStudio 图形用户界面或通过您的代码保存由 `ggplot2` 创建的图表。要使用 RStudio 菜单保存图表，请转到“图表”选项卡并选择“导出”（见图
    4.14）。
- en: '![](Images/CH04_F14_Kabacoff3.png)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F14_Kabacoff3.png)'
- en: Figure 4.14 Saving a graph using the RStudio interface
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.14 使用 RStudio 界面保存图表
- en: 'Graphs can be saved via code using the `ggsave()` function. You can specify
    the plot to save, its size and format, and where to save it. Consider this example:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用 `ggsave()` 函数通过代码保存图表。您可以指定要保存的图表、其大小和格式以及保存位置。考虑以下示例：
- en: '[PRE14]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: This saves `myplot` as a 5" × 4" PNG file named mygraph.png in the current working
    directory. You can save the graph in a different format by changing the file extension.
    Table 4.4 lists descriptions of the most common formats.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 这将 `myplot` 保存为当前工作目录中名为 mygraph.png 的 5" × 4" PNG 文件。您可以通过更改文件扩展名以不同的格式保存图表。表
    4.4 列出了最常见的格式描述。
- en: Table 4.4 Image file formats
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 表 4.4 图像文件格式
- en: '| Extension | Format |'
  id: totrans-160
  prefs: []
  type: TYPE_TB
  zh: '| 扩展名 | 格式 |'
- en: '| pdf | Portable Document Format |'
  id: totrans-161
  prefs: []
  type: TYPE_TB
  zh: '| pdf | 可移植文档格式 |'
- en: '| jpeg | JPEG |'
  id: totrans-162
  prefs: []
  type: TYPE_TB
  zh: '| jpeg | JPEG |'
- en: '| tiff | Tagged Image File Format |'
  id: totrans-163
  prefs: []
  type: TYPE_TB
  zh: '| tiff | 标签图像文件格式 |'
- en: '| png | Portable Network Graphics |'
  id: totrans-164
  prefs: []
  type: TYPE_TB
  zh: '| png | 可移植网络图形 |'
- en: '| svg | Scalable Vector Graphics |'
  id: totrans-165
  prefs: []
  type: TYPE_TB
  zh: '| svg | 可缩放矢量图形 |'
- en: '| wmf | Windows Metafile |'
  id: totrans-166
  prefs: []
  type: TYPE_TB
  zh: '| wmf | Windows 元文件 |'
- en: The PDF, SVG, and WMF formats are vectorial formats—they resize without fuzziness
    or pixilation. The other formats are bitmaps—they will pixelate when resized.
    This is especially noticeable when small images are enlarged. The PNG format is
    popular for images destined for web pages. The JPEG and TIF formats are usually
    reserved for photographs.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: PDF、SVG 和 WMF 格式是矢量格式——它们可以无模糊或像素化地缩放。其他格式是位图——它们在缩放时将像素化。这在将小图像放大时尤为明显。PNG
    格式是网页图像的常用格式。JPEG 和 TIF 格式通常保留用于照片。
- en: The WMF format is usually recommended for graphs that will appear in Microsoft
    Word or PowerPoint documents. MS Office does not support PDF or SVG files, and
    the WMF format will rescale well. However, WMF files will lose any transparency
    settings that have been set.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: WMF 格式通常推荐用于将在 Microsoft Word 或 PowerPoint 文档中出现的图表。MS Office 不支持 PDF 或 SVG
    文件，WMF 格式可以很好地缩放。然而，WMF 文件将丢失任何已设置的透明度设置。
- en: 'If you omit the `plot=` option, the most recently created graph is saved. The
    following code is valid and saves the graph to disk as a PDF document:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 如果省略了 `plot=` 选项，则保存最近创建的图表。以下代码是有效的，并将图表保存为磁盘上的 PDF 文档：
- en: '[PRE15]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: See `help(ggsave)` for additional details.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 `help(ggsave)` 获取更多详细信息。
- en: 4.2.4 Common mistakes
  id: totrans-172
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.2.4 常见错误
- en: 'After working with `ggplot2` for years, I’ve found that two mistakes are frequently
    made. The first is omitting or misplacing a closing parenthesis. This happens
    most often following the `aes()` function. Consider the following code:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用 `ggplot2` 几年后，我发现经常犯两个错误。第一个是省略或放置了错误的闭括号。这种情况最常发生在 `aes()` 函数之后。考虑以下代码：
- en: '[PRE16]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Note the lack of a closing parenthesis at the end of the first line. I can’t
    tell you how many times I’ve done this.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 注意第一行末尾缺少一个闭括号。我无法告诉你我犯了多少次这样的错误。
- en: 'The second error is confusing an assignment for a mapping. The following code
    produces the graph in figure 4.15:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个错误是将赋值与映射混淆。以下代码生成了图 4.15 中的图表：
- en: '[PRE17]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The `aes()` function is used to map *variables* to the visual characteristics
    of the graph. Assigning constant values is done outside the `aes()` function.
    The correct code would be
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '`aes()` 函数用于将 *变量* 映射到图表的视觉特征。分配常量值应在 `aes()` 函数外部完成。正确的代码应该是'
- en: '[PRE18]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: The points are red (not blue), and there is a strange legend. What happened?
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 点是红色（而不是蓝色），图例也很奇怪。发生了什么？
- en: '![](Images/CH04_F15_Kabacoff3.png)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH04_F15_Kabacoff3.png)'
- en: Figure 4.15 Placing an assignment statement in the `aes()` function
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.15 在 `aes()` 函数中放置赋值语句
- en: Summary
  id: totrans-183
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: The `ggplot2` package provides a language and grammar for creating comprehensive
    visualizations of data.
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ggplot2` 软件包提供了一种语言和语法，用于创建全面的数据可视化。'
- en: Scatterplots describe the relationship between two quantitative variables.
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 散点图描述了两个定量变量之间的关系。
- en: Trend lines can be added to a scatterplot to summarize the relationship.
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 趋势线可以添加到散点图中以总结其关系。
- en: You can use color, shape, and size to represent groups of observations.
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以使用颜色、形状和大小来表示观察组的集合。
- en: Facets are useful for plotting the data for more than one group.
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分面图对于绘制多个组的数据非常有用。
- en: You can customize graphs with scales, labels, and themes.
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以使用刻度、标签和主题自定义图表。
- en: Graphs can be saved in many formats.
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 图表可以保存为多种格式。
