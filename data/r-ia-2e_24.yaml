- en: 19 Advanced graphs
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 19 高级图表
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Customizing `ggplot2` graphs
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自定义 `ggplot2` 图表
- en: Adding annotations
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加注释
- en: Combining multiple graphs into a single plot
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将多个图表组合成单个图表
- en: Creating interactive graphs
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建交互式图表
- en: There are many ways to create a graph in R. We’ve focused on the use of `ggplot2`
    because of its coherent grammar, flexibility, and comprehensiveness. The `ggplot2`
    package was introduced in chapter 4, with coverage of geoms, scales, facets, and
    titles. In chapter 6, we created bar charts, pie charts, tree maps, histograms,
    kernel density plots, box and violin plots, and dot plots. Chapters 8 and 9 covered
    graphics for regression and ANOVA models. Chapter 11 discussed scatter plots,
    scatter plot matrices, bubble plots, line charts, corrgrams, and mosaic charts.
    Other chapters have covered graphs to visualize the topics at hand.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在 R 中创建图表有许多方法。我们专注于 `ggplot2` 的使用，因为它具有一致的语法、灵活性和全面性。`ggplot2` 包在第 4 章中介绍，涵盖了
    Geoms、缩放、分面和标题。在第 6 章中，我们创建了条形图、饼图、树状图、直方图、核密度图、箱线和小提琴图以及点图。第 8 章和第 9 章涵盖了回归和方差分析模型的图形。第
    11 章讨论了散点图、散点图矩阵、气泡图、折线图、相关图和马赛克图。其他章节涵盖了可视化当前主题的图表。
- en: This chapter will continue the coverage of `ggplot2`, but with a focus on customization—creating
    a graph that precisely meet your needs. Graphs help you uncover patterns and describe
    trends, relationships, differences, compositions, and distributions in data. The
    primary reason to customize a `ggplot2` graph is to enhance your ability to explore
    the data or communicate your findings to others. A secondary goal is to meet the
    look-and-feel requirements of an organization or publisher.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将继续介绍 `ggplot2`，但重点是自定义——创建一个精确满足您需求的图表。图表有助于您发现模式并描述趋势、关系、差异、组成和数据的分布。自定义
    `ggplot2` 图表的主要原因是增强您探索数据或向他人传达发现的能力。次要目标是满足组织或出版商的外观和感觉要求。
- en: In this chapter, we’ll explore the use `ggplot2` scale functions to customize
    axes and colors. We will use the `theme()` function to customize a graph’s overall
    look and feel, including the appearance of text, legends, grid lines, and plot
    background. Geoms will be used to add annotations such as reference lines and
    labels. Additionally, the `patchwork` package will be used to combine several
    plots into one complete graph. Finally, the `plotly` package will be used to convert
    static `ggplot2` graphs into interactive web graphics that let you explore the
    data more fully.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨使用 `ggplot2` 缩放函数来自定义坐标轴和颜色。我们将使用 `theme()` 函数来自定义图表的整体外观和感觉，包括文本、图例、网格线和绘图背景的显示。我们将使用
    Geoms 来添加注释，例如参考线和标签。此外，还将使用 `patchwork` 包将多个图表组合成一个完整的图表。最后，将使用 `plotly` 包将静态的
    `ggplot2` 图表转换为交互式网络图形，让您更全面地探索数据。
- en: The `ggplot2` package has an enormous number of options for customizing graph
    elements. The `theme()` function alone has over 90 arguments! Here, we’ll focus
    on the most frequently used functions and arguments. If you’re reading this chapter
    in greyscale, I encourage you to run the code so you can see the graphs in color.
    Simple datasets are used so that you can focus on the code itself.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '`ggplot2` 包提供了大量自定义图表元素的选择。仅 `theme()` 函数就有超过 90 个参数！在这里，我们将重点关注最常用的函数和参数。如果您正在以灰度阅读本章，我鼓励您运行代码，以便您可以看到彩色图表。使用简单的数据集，这样您可以专注于代码本身。'
- en: At this point, you should already have the `ggplot2` and `dplyr` packages installed.
    Before continuing, you’ll need several additional packages, including `ISLR` and
    `gapminder` for data, and `ggrepel`, `showtext`, `patchwork`, and `plotly` for
    enhanced graphing. You can install them all using `install.packages(c("ISLR",`
    `"gapminder",` `"scales",` `"showtext",` `"ggrepel",` `"patchwork",` `"plotly"))`.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，您应该已经安装了 `ggplot2` 和 `dplyr` 包。在继续之前，您还需要几个额外的包，包括用于数据的 `ISLR` 和 `gapminder`，以及用于增强图形的
    `ggrepel`、`showtext`、`patchwork` 和 `plotly`。您可以使用 `install.packages(c("ISLR",
    "gapminder", "scales", "showtext", "ggrepel", "patchwork", "plotly"))` 安装它们。
- en: 19.1 Modifying scales
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.1 修改缩放
- en: The scale functions in `ggplot2` control the mapping of variable values to specific
    plot characteristics. For example, the `scale_x_continuous()` function creates
    a mapping of the values of a quantitative variable to positions along the *x*-axis.
    The `scale_ color_discrete()` function creates a mapping between the values of
    a categorical variable and a color value. In this section, you’ll use scale functions
    to customize a graph’s axes and plot colors.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '`ggplot2` 中的尺度函数控制变量值到特定绘图特性的映射。例如，`scale_x_continuous()` 函数创建了一个将定量变量的值映射到
    *x*-轴上位置的映射。`scale_color_discrete()` 函数创建了一个将分类变量的值与颜色值之间的映射。在本节中，您将使用尺度函数来自定义图表的轴和绘图颜色。'
- en: 19.1.1 Customizing axes
  id: totrans-13
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.1.1 自定义轴
- en: In `ggplot2`, the *x*- and *y*-axes in a graph are controlled with the `scale_x_*`
    and `scale_y_*` functions, where `*` specifies the type of scale. Table 19.1 lists
    the most common functions. The primary reason for customizing these axes is to
    make the data easier to read or make trends more obvious.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `ggplot2` 中，图表中的 *x*-轴和 *y*-轴由 `scale_x_*` 和 `scale_y_*` 函数控制，其中 `*` 指定尺度的类型。表
    19.1 列出了最常见的函数。自定义这些轴的主要原因是使数据更容易阅读或使趋势更明显。
- en: Table 19.1 Functions that specify axis scales
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 表 19.1 指定轴尺度的函数
- en: '| Function | Description |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| 函数 | 描述 |'
- en: '| `scale_x_continuous``, scale_y_continuous` | Scales for continuous data |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| `scale_x_continuous`, scale_y_continuous | 连续数据的尺度 |'
- en: '| `scale_x_binned, scale_y_binned` | Scales for binning continuous data |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| `scale_x_binned, scale_y_binned` | 对连续数据进行分箱的尺度 |'
- en: '| `scale_x_discrete,scale_y_discrete` | Scales for discrete (categorical) data
    |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| `scale_x_discrete,scale_y_discrete` | 对离散（分类）数据的尺度 |'
- en: '| `scale_x_log10, scale_y_log10` | Scales for continuous data on a logarithmic
    scale (base 10) |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| `scale_x_log10, scale_y_log10` | 对数尺度（基数为 10）上的连续数据尺度 |'
- en: '| `scale_x_date, scale_y_date` | Scales for date data. Other variants include
    datetime and time. |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| `scale_x_date, scale_y_date` | 日期数据的尺度。其他变体包括日期时间和时间。 |'
- en: Customizing axes for continuous variables
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 自定义连续变量的轴
- en: 'In the first example, we’ll use the `mtcars` data frame, a dataset with car
    characteristics for 32 automobiles. The `mtcars` data frame is included in base
    R. Let’s plot fuel efficiency (`mpg`) by automobile weight (`wt`) in 1000 pounds:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一个例子中，我们将使用 `mtcars` 数据框，这是一个包含 32 辆汽车特征的数据库集。`mtcars` 数据框包含在基础 R 中。让我们绘制以
    1000 磅为单位的汽车重量 (`wt`) 与燃油效率 (`mpg`) 的关系图：
- en: '[PRE0]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Figure 19.1 shows the graph. By default, major breaks are labeled. For `mpg`,
    these occur at positions 10 to 35 in 5-point intervals. Minor breaks occur evenly
    between major breaks and are not labeled.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19.1 显示了图表。默认情况下，主要刻度有标签。对于 `mpg`，这些刻度在 10 到 35 之间以 5 点间隔出现。小刻度在主要刻度之间均匀分布，但没有标签。
- en: '![](Images/CH19_F01_Kabacoff3.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F01_Kabacoff3.png)'
- en: Figure 19.1 Default `ggplot2` scatter plot of miles per gallon by car weight
    (1000 pounds) for the 32 automobiles in the `mtcars` dataset
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19.1 默认的 `ggplot2` 散点图，显示 `mtcars` 数据集中的 32 辆汽车每加仑英里数（1000 磅）与汽车重量之间的关系
- en: What’s the weight of the heaviest car in this plot? What’s the `mpg` for the
    third-lightest car? It takes some work to determine the values from these axes.
    We may want to tweak the *x*- and *y*-axes to make reading the values off the
    plot easier.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个图中，最重的汽车的重量是多少？第三轻的汽车的 `mpg` 是多少？从这些轴上确定值需要一些工作。我们可能想要调整 *x*-轴和 *y*-轴，以便更容易从图中读取值。
- en: Since `wt` and `mpg` are continuous variables, we’ll use the `scale_x_continuous()`
    and `scale_y_continuous()` functions to modify the axes. Table 19.2 lists common
    options for these functions.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 `wt` 和 `mpg` 是连续变量，我们将使用 `scale_x_continuous()` 和 `scale_y_continuous()`
    函数来修改轴。表 19.2 列出了这些函数的常见选项。
- en: Table 19.2 Some common `scale_*_continuous` options
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 表 19.2 一些常见的 `scale_*_continuous` 选项
- en: '| Argument | Description |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| 参数 | 描述 |'
- en: '| `name` | Name of the scale. Same as using the `labs(x = , y = )` function.
    |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| `name` | 尺度的名称。与使用 `labs(x = , y = )` 函数相同。 |'
- en: '| `breaks` | Numeric vector of positions for major breaks. Major breaks are
    labeled automatically unless overridden by the `labels` option. Use `NULL` to
    suppress breaks. |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| `breaks` | 主要刻度标记位置的数值向量。主要刻度自动标记，除非被 `labels` 选项覆盖。使用 `NULL` 来抑制刻度。 |'
- en: '| `minor_breaks` | Numeric vector of positions for minor tick marks. Minor
    breaks are not labeled. Use `NULL` to suppress minor breaks. |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| `minor_breaks` | 小刻度标记的位置的数值向量。小刻度没有标签。使用 `NULL` 来抑制小刻度。 |'
- en: '| `n.breaks` | Integer guiding the number of major breaks. The number is taken
    as a suggestion. The function may vary this number to ensure attractive break
    labels. |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| `n.breaks` | 整数，指导主要断点的数量。该数值被视为建议。函数可能会根据需要调整此数值以确保吸引人的断点标签。 |'
- en: '| `labels` | Character vector giving alternative break labels (must be same
    length as breaks) |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| `labels` | 字符向量，提供替代断点标签（必须与断点长度相同） |'
- en: '| `limits` | Numeric vector of length 2 giving minimum and maximum value |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| `limits` | 长度为2的数值向量，给出最小和最大值 |'
- en: '| `position` | Axis placement (left/right for *y*-axis, top/bottom for *x*-axis)
    |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| `position` | 轴放置（对于*y*轴为左/右，对于*x*轴为上/下） |'
- en: Let’s make the following changes. For weight,
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们进行以下更改。对于重量，
- en: Label the axis “Weight (1000 pounds).”
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将轴标签为“重量（1000磅）。”
- en: Have the scale range from 1.5 to 5.5.
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将刻度范围设置为1.5到5.5。
- en: Use 10 major breaks.
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用10个主要断点。
- en: Suppress minor breaks.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 抑制次要断点。
- en: For miles per gallon,
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每加仑英里数，
- en: Label the axis “Miles per gallon.”
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将轴标签为“每加仑英里数。”
- en: Have the scale range from 10 to 35.
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将刻度范围设置为10到35。
- en: Place major breaks at 10, 15, 20, 25, 30, and 35.
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在10、15、20、25、30和35处放置主要断点。
- en: Place minor breaks at one-gallon intervals.
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在每加仑间隔处放置次要断点。
- en: The following listing gives the code.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的列表给出了代码。
- en: Listing 19.1 Plot of fuel efficiency by car weight with customized axes
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.1 使用定制轴绘制燃油效率与汽车重量关系图
- en: '[PRE1]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: ❶ Modifies *x*-axis
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 修改*x*轴
- en: ❷ Modifies *y*-axis
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 修改*y*轴
- en: Figure 19.2 shows the new graph. We can see that the heaviest car is almost
    5.5 tons, and that the third-lightest car gets 34 miles per gallon. Notice that
    you specified 10 major breaks for `wt`, but the plot only has 9\. The `n.breaks`
    argument is taken as a suggestion. The argument may be replaced with a close number
    if it gives nicer labels. We’ll continue to work with this graph later.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.2显示了新的图表。我们可以看到最重的汽车大约有5.5吨，第三轻的汽车每加仑获得34英里。请注意，您为`wt`指定了10个主要断点，但图表只有9个。`n.breaks`参数被视为建议。如果它提供了更好的标签，则参数可能被替换为接近的数值。我们将在稍后继续使用此图表。
- en: '![](Images/CH19_F02_Kabacoff3.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F02_Kabacoff3.png)'
- en: Figure 19.2 `ggplot2` scatter plot of miles per gallon by car weight (1000 pounds)
    with modified x- and y-axes. It is now easier to read off the values of the points.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.2 `ggplot2`根据汽车重量（1000磅）绘制的每加仑英里数散点图，已修改x轴和y轴。现在更容易读取点的值。
- en: Customizing axes for categorical variables
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 为分类变量定制轴
- en: The previous example involved customizing axes for continuous variables. In
    the next example, you’ll customize the axes for categorical variables. The data
    comes from the `Wage` data frame in the `ISLR` package. The data frame contains
    wage and demographic information on 3000 male workers in the mid Atlantic region
    of the United States collected in 2011\. Let’s plot the relationship between race
    and education in this sample. The code is
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的例子涉及为连续变量定制轴。在下一个例子中，您将定制分类变量的轴。数据来自`ISLR`包中的`Wage`数据框。该数据框包含2011年在美国中西部地区收集的3000名男性工人的工资和人口统计信息。让我们绘制此样本中种族与教育之间的关系。代码如下
- en: '[PRE2]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: and figure 19.3 shows the graph.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 和图19.3显示了图表。
- en: '![](Images/CH19_F03_Kabacoff3.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F03_Kabacoff3.png)'
- en: Figure 19.3 Participant education by race for a sample of 3000 mid Atlantic
    male workers in 2011
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.3 2011年3000名中西部男性工人按种族划分的教育样本
- en: 'Note that the numbering on the race and education labels is actually coded
    in the data:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，比赛和教育标签上的编号实际上是在数据中编码的：
- en: '[PRE3]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'We can improve the graph by removing the numbers from the race category labels
    (they aren’t ordinal categories), using percent formatting on the *y*-axis, using
    better scale labels, and reordering the race categories by percent with higher
    degrees. You may also want to drop the Race: Other category since the composition
    of this group is unknown.'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过删除种族类别标签上的数字（它们不是有序类别）、在*y*轴上使用百分比格式、使用更好的刻度标签以及按百分比重新排序种族类别（优先级更高）来改进图表。您还可能希望删除“种族：其他”类别，因为该群体的组成是未知的。
- en: Modifying scales for categorical variables involve using `scale_*_discrete()`
    functions. Table 19.3 lists common options. You can order (and/or omit) the discrete
    values using the `limits` argument and change their labels using the `labels`
    argument.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 修改分类变量的刻度涉及使用`scale_*_discrete()`函数。表19.3列出了常见选项。您可以使用`limits`参数（和/或省略）对离散值进行排序，并使用`labels`参数更改它们的标签。
- en: Table 19.3 Some common `scale_*_discrete` options
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 表19.3 一些常见的 `scale_*_discrete` 选项
- en: '| Argument | Description |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| 参数 | 描述 |'
- en: '| `name` | Name of the scale. Same as using the `labs(x = , y = )` function.
    |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| `name` | 尺度名称。与使用 `labs(x = , y = )` 函数相同。|'
- en: '| `breaks` | A character vector of breaks |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| `breaks` | 一个包含刻度的字符向量|'
- en: '| `limits` | A character vector that defines the values of the scale and their
    order |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
  zh: '| `limits` | 一个定义刻度值及其顺序的字符向量|'
- en: '| `labels` | A character vector giving the labels (must be same length as breaks).
    Using `labels=abbreviate` will shorten long labels. |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '| `labels` | 一个字符向量，给出标签（长度必须与 breaks 相同）。使用 `labels=abbreviate` 将缩短长标签。|'
- en: '| `position` | Axis placement (left/right for *y*-axis, top/bottom for *x*-axis)
    |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
  zh: '| `position` | 轴放置（对于 *y*-轴是左/右，对于 *x*-轴是上/下）|'
- en: The following listing gives the revised code, and figure 19.4 presents the graph.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表给出了修订后的代码，图 19.4 展示了图表。
- en: Listing 19.2 Plot of education by race with customized axes
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 19.2 按种族划分的教育绘图，具有自定义轴
- en: '[PRE4]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: ❶ Modifies *x*-axis
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 修改 *x*-轴
- en: ❷ Modifies *y*-axis
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 修改 *y*-轴
- en: The horizontal axis represents a categorical variable, so it’s customized using
    the `scale_x_discrete()` function. The race categories are reordered using `limits`
    and relabeled using `labels`. The Other category is omitted from the graph by
    leaving it out of these specifications. The axis title is dropped by setting the
    name to "".
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 水平轴表示一个分类变量，因此它使用 `scale_x_discrete()` 函数进行自定义。使用 `limits` 对比赛类别进行重新排序，并使用 `labels`
    进行重新标记。其他类别通过在这些规范中省略而被从图中省略。通过将名称设置为 "" 来删除轴标题。
- en: The vertical axis represents a numeric variable, so it’s customized using the
    `scale_y_continuous()` function. The function is used to modify the axis title
    and change the axis labels. The `percent_format()` function from the `scales`
    package reformats the axis labels to percents. The `argument` `accuracy=2` specifies
    the number of significant digits to print for each percent.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 垂直轴表示一个数值变量，因此它使用 `scale_y_continuous()` 函数进行自定义。该函数用于修改轴标题和更改轴标签。`scales` 包中的
    `percent_format()` 函数重新格式化轴标签为百分比。`accuracy=2` 参数指定每个百分比打印的显著数字位数。
- en: The `scales` package can be very useful for formatting axes. There are options
    for formatting monetary values, dates, percents, commas, scientific notation,
    and more. See [https://scales.r-lib.org/](https://scales.r-lib.org/) for details.
    The `ggh4x` and `ggprism` packages provide additional capabilities for customizing
    axes, including greater customization of major and minor tick marks.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '`scales` 包在格式化轴方面非常有用。有格式化货币值、日期、百分比、逗号、科学记数法等选项。有关详细信息，请参阅 [https://scales.r-lib.org/](https://scales.r-lib.org/)。`ggh4x`
    和 `ggprism` 包提供了额外的自定义轴功能，包括对主刻度和副刻度的更多自定义。'
- en: In the previous example, education was represented on a discrete color scale.
    We’ll consider customizing colors next.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，教育被表示为一个离散的颜色刻度。我们将考虑自定义颜色。
- en: '![](Images/CH19_F04_Kabacoff3.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F04_Kabacoff3.png)'
- en: Figure 19.4 Participant education by race for a sample of 3000 mid Atlantic
    male workers in 2011\. The race categories have been rearranged and relabeled.
    The Other category has been omitted. The *x*-axis label has been omitted, and
    the *y*-axis is now formatted as percentages.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19.4 2011 年 3000 名中大西洋地区男性工人的参与教育按种族划分。种族类别已重新排列和重新标记。其他类别已被省略。*x*-轴标签已被省略，*y*-轴现在格式化为百分比。
- en: 19.1.2 Customizing colors
  id: totrans-85
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.1.2 自定义颜色
- en: The `ggplot2` package provides functions for mapping both categorical and numeric
    variables to color schemes. Table 19.4 describes the functions. The `scale_color_*()`
    functions are used for points, lines, borders, and text. The `scale_fill_*()`
    functions are used for objects that have area, such as rectangles, and ovals.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '`ggplot2` 包提供了将分类和数值变量映射到颜色方案的功能。表 19.4 描述了这些函数。`scale_color_*()` 函数用于点、线、边框和文本。`scale_fill_*()`
    函数用于具有面积的对象，如矩形和椭圆。'
- en: Color palettes can be *sequential*, *diverging*, or *qualitative*. Sequential
    palettes are used to map colors to a monotonic numeric variable. A diverging palette
    is used for numeric variables that have a meaningful middle or zero point. It’s
    two sequential palettes that share an endpoint at the central value. For example,
    a diverging palette is often used to represent the values of correlation coefficients
    (see section 11.3). A qualitative color scale maps the values of a categorical
    variable to discrete colors.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 调色板可以是**顺序的**、**发散的**或**定性的**。顺序调色板用于将颜色映射到单调的数值变量。发散调色板用于具有有意义的中点或零点的数值变量。它是两个共享中值端点的顺序调色板。例如，发散调色板通常用于表示相关系数的值（见第11.3节）。定性的颜色标尺将分类变量的值映射到离散颜色。
- en: Table 19.4 Functions for specifying color scales
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 表19.4 指定颜色尺度的函数
- en: '| Function | Description |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
  zh: '| 函数 | 描述 |'
- en: '| `scale_color_gradient()``scale_fill_gradient``()` | Gradient color scale
    for a continuous variable. Specify the `low` color and the `high` color. Use the
    `*_gradient2()` versions to specify `low`, `mid`, and `high` colors. |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| `scale_color_gradient()``scale_fill_gradient()` | 连续变量的渐变色标尺。指定`low`颜色和`high`颜色。使用`*_gradient2()`版本来指定`low`、`mid`和`high`颜色。
    |'
- en: '| `scale_color_steps()``scale_fill_steps``()` | Binned gradient color scale
    for a continuous variable. Specify the `low` color and the `high` color. Use the
    `*_steps2()` versions to specify `low`, `mid`, and `high` colors. |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| `scale_color_steps()``scale_fill_steps()` | 连续变量的分箱渐变色标尺。指定`low`颜色和`high`颜色。使用`*_steps2()`版本来指定`low`、`mid`和`high`颜色。
    |'
- en: '| `scale_color_brewer()``scale_fill_brewer``()` | Sequential, diverging, and
    qualitative color schemes from ColorBrewer ([https://colorbrewer2.org](https://colorbrewer2.org)).
    Primary argument is `palette=`. See `?scale_color_brewer` for a list of palettes.
    |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| `scale_color_brewer()``scale_fill_brewer()` | 来自ColorBrewer（[https://colorbrewer2.org](https://colorbrewer2.org)）的顺序、发散和定性颜色方案。主要参数是`palette=`。查看`?scale_color_brewer`以获取调色板列表。
    |'
- en: '| `scale_color_grey()``scale_fill_gray()` | Sequential grey color scale. Optional
    arguments are `start` (grey value at the low end) and `end` (grey value at the
    high end). The defaults are 0.2 and 0.8, respectively. |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| `scale_color_grey()``scale_fill_gray()` | 顺序灰色颜色标尺。可选参数是`start`（低端的灰色值）和`end`（高端的灰色值）。默认值分别为0.2和0.8。
    |'
- en: '| `scale_color_manual()``scale_fill_manual``()` | Create your own color scale
    for a discrete variable by specifying a vector of colors in the values argument.
    |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| `scale_color_manual()``scale_fill_manual()` | 通过在值参数中指定颜色向量来为离散变量创建自己的颜色标尺。
    |'
- en: '| `scale_color_virdis_*``scale_fill_virdis_*` | Viridis color scales from `viridisLite`
    package. Designed to be perceived by viewers with common forms of color blindness
    and prints well in black and white. Use `*_d` for discrete, `*_c` for continuous,
    and `*_b` for binned scales. For example, `scale_fill`_`viridis_d()` would provide
    safe color fills for a discrete variable. The argument `option` provides four
    color scheme variations (`"inferno", "plasma",` `"viridis"` (the default), and
    `"cividis"`). |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| `scale_color_virdis_*``scale_fill_virdis_*` | 来自`viridisLite`包的Viridis颜色标尺。旨在被具有常见形式色盲的观众所感知，并且黑白打印效果良好。使用`*_d`表示离散，`*_c`表示连续，`*_b`表示分箱标尺。例如，`scale_fill_virdis_d()`将提供对离散变量的安全颜色填充。`option`参数提供四种颜色方案变化（`"inferno"`、`"plasma"`、`"viridis"`（默认）和`"cividis"`）。
    |'
- en: Continuous color palettes
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 连续颜色调色板
- en: Let’s look at examples of mapping a continuous quantitative variable to a color
    palette. In figure 19.1, fuel efficiency was plotted against car weight. We’ll
    add a third variable to the plot by mapping engine displacement to point color.
    Since engine displacement is a numeric variable, you create a color gradient to
    represent its values. The following listing demonstrates several possibilities.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看将连续定量变量映射到颜色调色板的示例。在图19.1中，燃油效率被绘制在汽车重量上。我们将通过将发动机排量映射到点颜色来向图表中添加第三个变量。由于发动机排量是一个数值变量，你创建一个颜色渐变来表示其值。以下列表展示了几个可能性。
- en: Listing 19.3 Color gradients for continuous variables
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.3 连续变量的颜色渐变
- en: '[PRE5]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The code creates the plots in figure 19.5\. The `ggtitle()` function is equivalent
    to the `labs(title=)` used elsewhere in this book. If you are reading a greyscale
    version of this book, be sure to run the code yourself so that you can appreciate
    the color variations.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 代码创建图19.5中的图表。`ggtitle()`函数等同于本书其他地方使用的`labs(title=)`。如果你正在阅读本书的灰度版本，请确保亲自运行代码，以便你能欣赏到颜色变化。
- en: '![](Images/CH19_F05_Kabacoff3.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F05_Kabacoff3.png)'
- en: Figure 19.5 Plot of fuel efficiency by car weight. Color is used to represent
    engine displacement. Six color schemes are presented. A is the default. B is greyscale.
    Both C and D go from red to blue, but D is binned into five discrete colors. E
    goes from red to white (at the median) to blue. F uses a Viridis color scheme.
    In each graph, engine displacement increases with car weight and lower gas mileage.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.5展示了汽车重量与燃油效率的关系图。颜色用于表示发动机排量。展示了六种配色方案。A是默认方案。B是灰度。C和D从红色到蓝色渐变，但D被分成了五个离散颜色。E从红色到白色（中位数）到蓝色渐变。F使用了Viridis颜色方案。在每个图表中，发动机排量随着汽车重量的增加而增加，油耗降低。
- en: Plot A uses the `ggplot2` default. Plot B shows the plot in greyscale. Plots
    C and D use a red to blue gradient. A binned color gradient takes a continuous
    gradient and divides it up into discrete values (usually five). Plot E demonstrates
    a divergent color gradient, moving from red (low) to white (midpoint) to blue
    (high). Finally, Plot F shows a Viridis color gradient. The option `direction`
    `=` `-1` in Plot F reverses the color anchors, leading to darker colors for greater
    engine displacement.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 图A使用了`ggplot2`的默认颜色。图B显示了灰度图。图C和D使用红色到蓝色的渐变。分箱颜色渐变将连续渐变分成离散值（通常是五个）。图E展示了发散颜色渐变，从红色（低）到白色（中点）到蓝色（高）。最后，图F展示了Viridis颜色渐变。图F中的`direction`
    `=` `-1`选项反转了颜色锚点，导致更大的发动机排量对应更深的颜色。
- en: Qualitative color palettes
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 定性颜色调色板
- en: The following listing demonstrates qualitative color schemes. Here `education`
    is the categorical variable mapped to discrete colors. Figure 19.6 provides the
    resulting graphs.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的列表展示了定性颜色方案。在这里`education`是映射到离散颜色的分类变量。图19.6提供了结果图表。
- en: Listing 19.4 Color schemes for categorical variables
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.4 分类变量的颜色方案
- en: '[PRE6]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Plot A uses the `ggplot2` default colors. Plot B uses the ColorBrewer qualitative
    palette Set2\. Other qualitative ColorBrewer palettes include Accent, Dark2, Paired,
    Pastel1, Pastel2, Set1, and Set3\. Plot C demonstrates the default Viridis discrete
    scheme. Finally, plot D demonstrates a manual scheme, proving that I have no business
    picking colors on my own.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 图A使用了`ggplot2`的默认颜色。图B使用了ColorBrewer的定性调色板Set2。其他定性ColorBrewer调色板包括Accent、Dark2、Paired、Pastel1、Pastel2、Set1和Set3。图C展示了默认的Viridis离散方案。最后，图D展示了手动方案，证明我自己挑选颜色是不合适的。
- en: R packages provide a wide variety of color palettes for use in `ggplot2` graphs.
    Emil Hvitfeldt has created a comprehensive repository at [https://github.com/Emil
    Hvitfeldt/r-color-palettes](https://github.com/EmilHvitfeldt/r-color-palettes)
    (almost 600 at last count!). Choose the scheme that you find appealing and helps
    communicate the information most effectively. Can the reader easily see the relationships,
    differences, trends, composition, or outliers that you are trying to highlight?
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: R包为`ggplot2`图表提供了广泛的各种颜色调色板。Emil Hvitfeldt创建了一个综合的仓库在[https://github.com/Emil
    Hvitfeldt/r-color-palettes](https://github.com/EmilHvitfeldt/r-color-palettes)（最后统计有近600种！）！选择您认为吸引人且能最有效地传达信息的方案。读者能否轻松地看到您试图强调的关系、差异、趋势、组成或异常？
- en: '![](Images/CH19_F06_Kabacoff3.png)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F06_Kabacoff3.png)'
- en: Figure 19.6 Participant education by race for a sample of 3000 mid Atlantic
    male workers in 2011\. Four different color schemes are displayed. A is the default.
    B and C are preset color schemes. In D, the colors are specified by the user.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.6展示了2011年3000名中大西洋地区男性工人的种族参与教育情况。显示了四种不同的配色方案。A是默认方案。B和C是预设的配色方案。在D中，颜色由用户指定。
- en: 19.2 Modifying themes
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.2 修改主题
- en: The `ggplot2 theme()` function allows you to customize the nondata components
    of your plot. The help for the function `(?theme)` describes arguments for modifying
    a graph’s titles, labels, fonts, background, gridlines, and legends.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '`ggplot2 theme()`函数允许您自定义图表的非数据组件。该函数的帮助文档`(?theme)`描述了用于修改图表标题、标签、字体、背景、网格线和图例的参数。'
- en: For example, in the code
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在以下代码中
- en: '[PRE7]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: the `theme()` function renders the *x*- and *y*-axis titles in a 14-point blue
    font. Functions are typically used to provide the values for `theme` arguments
    (see table 19.5).
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '`theme()`函数以14点蓝色字体渲染*x*轴和*y*轴的标题。函数通常用于提供`theme`参数的值（见表19.5）。'
- en: Table 19.5 Theme elements
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 表19.5 主题元素
- en: '| Function | Description |'
  id: totrans-118
  prefs: []
  type: TYPE_TB
  zh: '| 函数 | 描述 |'
- en: '| `element_blank``()` | Blank-out element (useful for removing text, lines,
    etc.). |'
  id: totrans-119
  prefs: []
  type: TYPE_TB
  zh: '| `element_blank()` | 空白元素（用于移除文本、线条等）。 |'
- en: '| `element_rect``()` | Specify rectangle characteristics. Arguments include
    `fill`, `color`, `size`, and `linetype`. The last three refer to the border. |'
  id: totrans-120
  prefs: []
  type: TYPE_TB
  zh: '| `element_rect()` | 指定矩形特征。参数包括`fill`、`color`、`size`和`linetype`。最后三个与边框相关。|'
- en: '| `element_line``()` | Specify line characteristics. Arguments include `color`,
    `size`, `linetype`, `lineend` (`"round"`, `"butt"`, `"square"`), and `arrow` (created
    with the `grid::arrow()` function). |'
  id: totrans-121
  prefs: []
  type: TYPE_TB
  zh: '| `element_line()` | 指定线条特征。参数包括`color`、`size`、`linetype`、`lineend`（`"round"`、`"butt"`、`"square"`）和`arrow`（使用`grid::arrow()`函数创建）。|'
- en: '| `element_text()` | Specify text characteristics. Arguments include `family`
    (font family), `face` (`"plain"`, `"italic"`, `"bold"`, `"bold.italic"`), `size`
    (text size in pts.), `hjust` (horizontal justification in [0,1]), `vjust` (vertical
    justification in [0,1]), `angle` (in degrees), and `color`. |'
  id: totrans-122
  prefs: []
  type: TYPE_TB
  zh: '| `element_text()` | 指定文本特征。参数包括`family`（字体家族）、`face`（`"plain"`、`"italic"`、`"bold"`、`"bold.italic"`）、`size`（以磅为单位的文本大小）、`hjust`（[0,1]中的水平对齐）、`vjust`（[0,1]中的垂直对齐）、`angle`（以度为单位的角）和`color`。|'
- en: First, we’ll look at some preconfigured themes that change numerous elements
    at once to provide a cohesive look and feel. Then we’ll dive into customizing
    individual theme elements.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '首先，我们将查看一些预配置的主题，这些主题可以同时更改多个元素，以提供一致的外观和感觉。然后我们将深入了解自定义单个主题元素。 '
- en: 19.2.1 Prepackaged themes
  id: totrans-124
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.2.1 预包装主题
- en: The `ggplot2` package comes with eight preconfigured themes that can be applied
    to `ggplot2` graphs via `theme_*()` functions. Listing 19.5 and figure 19.7 show
    four of the most popular. The `theme_grey()` function is the default theme, while
    `theme_void()` creates a completely empty theme.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '`ggplot2`包包含八个预配置的主题，可以通过`theme_*()`函数应用于`ggplot2`图形。列表19.5和图19.7展示了其中四个最受欢迎的。`theme_grey()`函数是默认主题，而`theme_void()`创建了一个完全空的主题。'
- en: '![](Images/CH19_F07_Kabacoff3.png)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![图像](Images/CH19_F07_Kabacoff3.png)'
- en: Figure 19.7 Examples of four preconfigured themes. By default, `ggplot2` uses
    `theme_grey()`.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.7 四个预配置主题的示例。默认情况下，`ggplot2`使用`theme_grey()`。
- en: Listing 19.5 Demonstration of four preconfigured `ggplot2` themes
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.5 四个预配置`ggplot2`主题的演示
- en: '[PRE8]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Additional themes are provided by the `ggthemes`, `hbrthemes`, `xaringanthemer`,
    `tgamtheme`, `cowplot`, `tvthemes`, and `ggdark` packages. Each is available from
    CRAN. Additionally, some organizations provide preconfigured themes to their employees
    to assure a consistent appearance in reports and presentations.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '`ggthemes`、`hbrthemes`、`xaringanthemer`、`tgamtheme`、`cowplot`、`tvthemes`和`ggdark`包提供了额外的主题。每个都可以从CRAN获取。此外，一些组织为员工提供预配置的主题，以确保报告和演示文稿的外观一致。'
- en: In addition to preconfigured themes, you can modify individual theme elements.
    In the following sections, you’ll use theme arguments to customize fonts, legends,
    and other graph elements.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 除了预配置的主题外，您还可以修改单个主题元素。在以下章节中，您将使用主题参数来自定义字体、图例和其他图形元素。
- en: 19.2.2 Customizing fonts
  id: totrans-132
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.2.2 自定义字体
- en: It is important to use typography to help communicate meaning without distracting
    or confusing the reader (see [http://mng.bz/5Z1q](http://mng.bz/5Z1q)). For example,
    Google’s Roboto and Lora typefaces are often recommended for clarity. Base R has
    limited native font-handling capabilities. The `showtext` package greatly expands
    these capabilities, allowing you to add system fonts and Google Fonts to plots.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 使用排版来帮助传达意义，同时不会分散或混淆读者的注意力（见[http://mng.bz/5Z1q](http://mng.bz/5Z1q)）。例如，Google的Roboto和Lora字体通常被推荐用于清晰度。基础R具有有限的本地字体处理能力。`showtext`包大大扩展了这些能力，允许您向图形添加系统字体和Google
    Fonts。
- en: The steps are
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 步骤是
- en: Load local and/or Google fonts.
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载本地和/或Google字体。
- en: Set `showtext` as the output graphics device.
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`showtext`设置为输出图形设备。
- en: Specify fonts in the `ggplot2` `theme()` function.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`ggplot2`的`theme()`函数中指定字体。
- en: When considering local fonts, the location, number, and type of fonts vary greatly
    from computer to computer. To use local fonts other than R’s defaults, you need
    to know the names and locations of the font files on your system. Currently supported
    formats include TrueType fonts (*.ttf, *.ttc) and OpenType fonts (*.otf).
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 当考虑本地字体时，位置、数量和类型在计算机之间有很大差异。要使用除R默认字体之外的本地字体，您需要知道系统上字体文件的名称和位置。目前支持包括TrueType字体（*.ttf,
    *.ttc）和OpenType字体（*.otf）在内的格式。
- en: The `font_paths()` function lists the location of font files, while `font_files()`
    list the font files and their characteristics. Listing 19.6 provides a short function
    for locating font files on your local system. Here the function is used to locate
    the font files for the Comic Sans MS font. Since the results depend on your system
    (I’m using a Windows PC), your results are likely to vary.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '`font_paths()` 函数列出了字体文件的位置，而 `font_files()` 列出了字体文件及其特性。列表19.6提供了一个简短的函数，用于在您的本地系统上定位字体文件。在这里，该函数用于定位Comic
    Sans MS字体的字体文件。由于结果取决于您的系统（我在使用Windows PC），您的结果可能会有所不同。'
- en: Listing 19.6 Locating local font files
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.6 定位本地字体文件
- en: '[PRE9]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Once you’ve located local font files, use `font_add()` to load them. For example,
    on my machine
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦定位了本地字体文件，请使用 `font_add()` 将它们加载。例如，在我的机器上
- en: '[PRE10]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: makes the Comic Sans MS font available in R under the arbitrary name “comic.”
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 将 Comic Sans MS 字体在 R 中以任意名称“comic”提供。
- en: To load Google Fonts ([https://fonts.google.com/](https://fonts.google.com/)),
    use the statement
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 要加载 Google 字体 ([https://fonts.google.com/](https://fonts.google.com/))，请使用以下语句
- en: '[PRE11]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: where `name` is the name of the Google font, and `family` is the arbitrary name
    you’ll use to refer to the font in later code. For example,
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 `name` 是 Google 字体的名称，而 `family` 是您将在后续代码中使用的任意名称。例如，
- en: '[PRE12]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: loads the Schoolbell Google Font under the name *bell*.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在名称 *bell* 下加载了 Schoolbell Google 字体。
- en: Once you’ve loaded the fonts, the statement `showtext_auto``()` will set `showtext`
    as the output device for new graphics.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦加载了字体，`showtext_auto()` 语句将 `showtext` 设置为新图形的输出设备。
- en: Finally, use the `theme()` function to indicate which elements of the graph
    will use which fonts. Table 19.6 lists the theme arguments related to text. You
    can specify font family, face, size, color, and orientation using `element_text()`.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，使用 `theme()` 函数来指示图表的哪些元素将使用哪些字体。表19.6列出了与文本相关的主题参数。您可以使用 `element_text()`
    指定字体家族、外观、大小、颜色和方向。
- en: Table 19.6 `theme()` arguments related to the text
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 表19.6 `theme()` 与文本相关的参数
- en: '| Argument | Description |'
  id: totrans-153
  prefs: []
  type: TYPE_TB
  zh: '| 参数 | 描述 |'
- en: '| `axis.title, axis.title.x, axis.title.y` | Axis titles |'
  id: totrans-154
  prefs: []
  type: TYPE_TB
  zh: '| `axis.title, axis.title.x, axis.title.y` | 轴标题 |'
- en: '| `axis.text` with the same variations as `axis.title` | Tick labels along
    axes |'
  id: totrans-155
  prefs: []
  type: TYPE_TB
  zh: '| `axis.text` 与 `axis.title` 相同的变体 | 轴上的刻度标签 |'
- en: '| `legend.text, legend.title` | Legend item labels and legend title |'
  id: totrans-156
  prefs: []
  type: TYPE_TB
  zh: '| `legend.text, legend.title` | 图例项标签和图例标题 |'
- en: '| `plot.title, plot.subtitle, plot.caption` | Plot title, subtitle, and caption
    |'
  id: totrans-157
  prefs: []
  type: TYPE_TB
  zh: '| `plot.title, plot.subtitle, plot.caption` | 图表标题、副标题和说明 |'
- en: '| `strip.text, strip.text.x, strip.text.y` | Facet labels |'
  id: totrans-158
  prefs: []
  type: TYPE_TB
  zh: '| `strip.text, strip.text.x, strip.text.y` | 分面标签 |'
- en: The following listing demonstrates customizing a `ggplot2` graph with two local
    fonts from my machine (Comic Sans MS and Caveat) and two Google Fonts (Schoolbell
    and Gochi Hand). Figure 19.8 displays the graph.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表演示了使用来自我的机器的两个本地字体（Comic Sans MS和Caveat）和两个Google字体（Schoolbell和Gochi Hand）自定义`ggplot2`图表。图19.8显示了该图表。
- en: '![](Images/CH19_F08_Kabacoff3.png)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F08_Kabacoff3.png)'
- en: Figure 19.8 Graph using several fonts (Schoolbell for title, Gochi Hand for
    the subtitle, Caveat for the source, and Comic Sans MS for the axis titles and
    text)
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.8展示了使用多种字体的图表（标题使用Schoolbell，副标题使用Gochi Hand，来源使用Caveat，轴标题和文本使用Comic Sans
    MS）
- en: Listing 19.7 Customizing fonts in a `ggplot2` graph
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.7 在`ggplot2`图表中自定义字体
- en: '[PRE13]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: ❶ Loads local fonts
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 加载本地字体
- en: ❷ Loads Google fonts
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 加载 Google 字体
- en: ❸ Uses showtext as the graphic device
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 使用 showtext 作为图形设备
- en: ❹ Specifies plot fonts
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 指定图表字体
- en: Figure 19.8 presents the resulting graph, which is used for demonstrations purposes
    only. Using several fonts in a single plot is often distracting and takes away
    from the message the graph was designed to convey. Pick the one or two fonts that
    best highlight the information and stick with them. A useful starting guide is
    Tiffany France’s *Choosing Fonts for Your Data Visualization* ([http://mng.bz/nrY5](http://mng.bz/nrY5)).
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.8展示了生成的图表，该图表仅用于演示目的。在单个图表中使用多种字体往往会分散注意力，并削弱图表旨在传达的信息。选择一种或两种最能突出信息的字体，并坚持使用。一个有用的起点是Tiffany
    France的*为您的数据可视化选择字体* ([http://mng.bz/nrY5](http://mng.bz/nrY5))。
- en: 19.2.3 Customizing legends
  id: totrans-169
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.2.3 自定义图例
- en: The `ggplot2` package creates legends whenever variables are mapped to color,
    fill, shape, line type, or size (basically any scaling the does not involve positional
    scales). You can modify the appearance of a legend using the `theme()` arguments
    in table 19.7.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: '`ggplot2`包在变量映射到颜色、填充、形状、线型或大小（基本上是不涉及位置尺度的任何缩放）时创建图例。您可以使用表19.7中的`theme()`参数修改图例的外观。'
- en: The most frequently used argument is `legend.position`. Setting the argument
    to `top`, `right` (default), `bottom`, or `left` allows you to position the legend
    on any side of the graph. Alternatively, a two-element numeric vector (*x*, *y*)
    positions the legend on the *x*- and *y*-axis, with the *x*-coordinate ranging
    from 0-left to 1-right and the *y*-coordinate ranging from 0-bottom to 1-top.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 最常用的参数是 `legend.position`。将参数设置为 `top`、`right`（默认）、`bottom` 或 `left` 允许您将图例放置在图的任何一边。或者，一个包含两个元素的数值向量（*x*、*y*）将图例放置在
    *x* 轴和 *y* 轴上，其中 *x* 坐标范围从0-左到1-右，*y* 坐标范围从0-底到1-顶。
- en: Table 19.7 `theme()` arguments related to the plot legend
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 表19.7 与绘图图例相关的 `theme()` 参数
- en: '| Argument | Description |'
  id: totrans-173
  prefs: []
  type: TYPE_TB
  zh: '| 参数 | 描述 |'
- en: '| `legend.background, legend.key` | Background of the legend and the legend
    key (symbols). Specify with `element_rect()`. |'
  id: totrans-174
  prefs: []
  type: TYPE_TB
  zh: '| `legend.background, legend.key` | 图例和图例键（符号）的背景。使用 `element_rect()` 指定。|'
- en: '| `legend.title, legend.text` | Text characteristics for the legend title and
    text. Specify values with `element_text()`. |'
  id: totrans-175
  prefs: []
  type: TYPE_TB
  zh: '| `legend.title, legend.text` | 图例标题和文本的文本特征。使用 `element_text()` 指定值。|'
- en: '| `legend.position` | Position of the legend. Values are `"none"`, `"left"`,
    `"right"`, `"bottom"`, `"top"`, or two-element numeric vector (each between 0-left/bottom
    and 1-right/top). |'
  id: totrans-176
  prefs: []
  type: TYPE_TB
  zh: '| `legend.position` | 图例的位置。值是 `"none"`、`"left"`、`"right"`、`"bottom"`、`"top"`
    或两个元素的数值向量（每个介于0-左/底和1-右/顶之间）。|'
- en: '| `legend.justification` | If `legend.postion` is set with a two-element numeric
    vector, `legend.justification` gives the *anchor point within the legend*, as
    a two-element vector. For example, if `legend.position` `= c(1,` `1)` and `legend.justification`
    `=` `c(1,` `1)`, the anchor point is the right corner of the legend. This anchor
    point is placed in the top-right corner of the plot. |'
  id: totrans-177
  prefs: []
  type: TYPE_TB
  zh: '| `legend.justification` | 如果 `legend.position` 使用一个包含两个元素的数值向量设置，`legend.justification`
    提供图例内的 *锚点*，作为一个包含两个元素的向量。例如，如果 `legend.position` `= c(1, 1)` 且 `legend.justification`
    `= c(1, 1)`，则锚点是图例的右下角。此锚点放置在图的右上角。|'
- en: '| `legend.direction` | Legend direction as `“horizontal”` or `“vertical”` |'
  id: totrans-178
  prefs: []
  type: TYPE_TB
  zh: '| `legend.direction` | 图例方向为 `“horizontal”` 或 `“vertical”` |'
- en: '| `legend.title.align, legend.text.align` | Alignment of legend title and text
    (number from 0-left to 1-right). |'
  id: totrans-179
  prefs: []
  type: TYPE_TB
  zh: '| `legend.title.align, legend.text.align` | 图例标题和文本的对齐方式（从0-左到1-右的数字）。|'
- en: Let’s create a scatterplot for the `mtcars` data frame. Place `wt` on the *x*-axis,
    `mpg` on the *y*-axis, and color the points by the number of engine cylinders.
    Using table 19.7, customize the graph by
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们为 `mtcars` 数据框创建一个散点图。将 `wt` 放在 *x* 轴上，`mpg` 放在 *y* 轴上，并根据发动机气缸数对点进行着色。使用表19.7，通过以下方式自定义图表：
- en: Placing the legend in the upper-right-hand corner of the plot
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将图例放置在图的右上角
- en: Titling the legend “Cylinders”
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为图例命名“圆柱体”
- en: Listing the legend categories horizontally rather than vertically
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 水平列出图例类别而不是垂直列出
- en: Setting the legend background to light gray and removing the background around
    the key elements (the colored symbols)
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将图例背景设置为浅灰色并移除键元素（彩色符号）周围的背景
- en: Placing a white border around the legend
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在图例周围放置白色边框
- en: The following listing provides the code, and figure 19.9 shows the resulting
    plot.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表提供了代码，图19.9显示了生成的图表。
- en: Listing 19.8 Customizing a plot legend
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 列出19.8自定义图例
- en: '[PRE14]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![](Images/CH19_F09_Kabacoff3.png)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F09_Kabacoff3.png)'
- en: Figure 19.9 Plot with a customized legend. The upper-right corner of the legend
    is placed in the upper-left corner of the plot. The legend is printed horizontally,
    with a grey background, a solid white border, and a title.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.9 带有自定义图例的图表。图例的右上角放置在图的左上角。图例水平打印，带有灰色背景、实线白色边框和标题。
- en: Again, this graph is provided for demonstration purposes. It’s actually easier
    to relate the legend to the graph if it’s placed on the right side and vertical
    (the default in this case). See *Data Visualization Standards* ([http://mng.bz/6m15](http://mng.bz/6m15))
    for recommendations regarding legend formatting.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，这个图表是为了演示目的提供的。如果它放在右侧并垂直（在这种情况下是默认设置），实际上更容易将图例与图表相关联。参见 *数据可视化标准* ([http://mng.bz/6m15](http://mng.bz/6m15))
    以获取有关图例格式的建议。
- en: 19.2.4 Customizing the plot area
  id: totrans-192
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.2.4 自定义绘图区域
- en: The `theme()` arguments in table 19.8 allow you to customize the plot area.
    The most common changes are the background color and major and minor grid lines.
    Listing 19.9 demonstrates customizing many features of the plot area for a faceted
    scatterplot. Figure 19.10 presents the resulting graph.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 表19.8中的 `theme()` 参数允许您自定义绘图区域。最常见的变化是背景颜色和主网格线和副网格线。列表19.9演示了为分面散点图自定义绘图区域许多功能的示例。图19.10展示了结果图。
- en: Table 19.8 `theme()` arguments related to plot area
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 表19.8 与绘图区域相关的 `theme()` 参数
- en: '| Argument | Description |'
  id: totrans-195
  prefs: []
  type: TYPE_TB
  zh: '| 参数 | 描述 |'
- en: '| `plot.background` | Background of the entire plot. Specify with `element_rect()`.
    |'
  id: totrans-196
  prefs: []
  type: TYPE_TB
  zh: '| `plot.background` | 整个图的背景。使用 `element_rect()` 指定。|'
- en: '| `plot.margin` | Margin around entire plot. Use `units()` function with sizes
    for top, right, bottom, and left margins. |'
  id: totrans-197
  prefs: []
  type: TYPE_TB
  zh: '| `plot.margin` | 整个图周围的边距。使用 `units()` 函数和大小指定顶部、右侧、底部和左侧边距。|'
- en: '| `panel.background` | Background for plotting area. Specify with `element_rect()`.
    |'
  id: totrans-198
  prefs: []
  type: TYPE_TB
  zh: '| `panel.background` | 绘图区域的背景。使用 `element_rect()` 指定。|'
- en: '| `strip.background` | Background of the facet strip label |'
  id: totrans-199
  prefs: []
  type: TYPE_TB
  zh: '| `strip.background` | 分面条标签的背景 |'
- en: '| `panel.grid, panel.grid.major, panel.grid.minor, panel.grid.major.x panel.grid.major.y
    panel.grid.minor.x panel.grid.minor.y` | Grid lines, major grid lines, minor grid
    lines, or specific major or minor grid lines. Specify with `element_line()`. |'
  id: totrans-200
  prefs: []
  type: TYPE_TB
  zh: '| `panel.grid, panel.grid.major, panel.grid.minor, panel.grid.major.x panel.grid.major.y
    panel.grid.minor.x panel.grid.minor.y` | 网格线、主网格线、副网格线，或特定主网格线或副网格线。使用 `element_line()`
    指定。|'
- en: '| `axis.line, axis.line.x, axis.line.y, axis.line.x.top, axis.line.x.bottom,
    axis.line.y.left, axis.line.y.right` | Lines along the axes (`axis.line`), the
    lines for each plane (`axis.line.x`, `axis.line.y`), or individual lines for each
    axis (`axis.line.x.bottom`, etc.). Specify with `element_line()`. |'
  id: totrans-201
  prefs: []
  type: TYPE_TB
  zh: '| `axis.line, axis.line.x, axis.line.y, axis.line.x.top, axis.line.x.bottom,
    axis.line.y.left, axis.line.y.right` | 轴上的线条（`axis.line`），每个平面的线条（`axis.line.x`，`axis.line.y`），或每个轴的单独线条（`axis.line.x.bottom`等）。使用
    `element_line()` 指定。|'
- en: Listing 19.9 Customizing the plot area
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.9 自定义绘图区域
- en: '[PRE15]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: ❶ Grouped scatterplot
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 分组散点图
- en: ❷ Fits line
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 拟合线
- en: ❸ Faceting
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 分面
- en: ❹ Sets black-white theme
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 设置黑白主题
- en: ❺ Modify theme
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 修改主题
- en: The code creates a graph with engine displacement (`disp`) on the *x*-axis and
    miles per gallon (`mpg`) on the *y*-axis. The number of cylinders (`cyl`) and
    transmission type (`am`) are originally coded as numeric but are converted to
    factors for plotting. For `cyl`, converting to a factor assures a single color
    for each number of cylinders. For `am`, this provides better labels than 0 and
    1.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 代码创建了一个图，其中发动机排量（`disp`）位于*x*轴上，每加仑英里数（`mpg`）位于*y*轴上。气缸数（`cyl`）和变速器类型（`am`）最初编码为数值，但转换为因子以进行绘图。对于`cyl`，转换为因子确保每个气缸数只有一个颜色。对于`am`，这提供了比0和1更好的标签。
- en: A scatterplot is created with enlarged points, colored by number of cylinders
    ❶. A quadratic line of best fit is then added ❷. A quadratic fit line allows for
    a line with one bend (see section 8.2.3). A faceted plot for each transmission
    type is then added ❸.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 创建了一个带有放大点的散点图，按气缸数着色❶。然后添加了一个最佳拟合的二次曲线❷。二次拟合线允许一条有弯曲的线（见第8.2.3节）。然后添加了每个变速器类型的分面图❸。
- en: To modify the theme, we started with `theme_bw()`❹ and then modified it with
    the `theme()` function ❺. The strip background color is set to white. Major grid
    lines are set to solid light grey, and minor grid lines are set to dashed light
    grey. Axis tick marks are removed. Finally, the legend is placed at the top of
    the graph and the legend keys (symbols) are given a blank background.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 为了修改主题，我们首先使用 `theme_bw()`❹，然后使用 `theme()` 函数❺进行修改。条带背景色设置为白色。主网格线设置为实线浅灰色，副网格线设置为虚线浅灰色。轴刻度标记被移除。最后，图例放置在图的顶部，图例键（符号）具有空白背景。
- en: '![](Images/CH19_F10_Kabacoff3.png)'
  id: totrans-212
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F10_Kabacoff3.png)'
- en: Figure 19.10 Faceted scatter plot with fit lines. The final theme is based on
    a modified version of the black-and-white theme.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.10 带拟合线的分面散点图。最终主题基于黑白主题的修改版本。
- en: 19.3 Adding annotations
  id: totrans-214
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.3 添加注释
- en: '*Annotations* allow you to add additional information to a graph, making it
    easier for the reader to discern relationships, distributions, or unusual observations.
    The most common annotations are reference lines and text labels. The functions
    for adding these annotations are listed in table 19.9.'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: '*注释*允许您向图中添加更多信息，使读者更容易识别关系、分布或异常观察。最常见的注释是参考线和文本标签。添加这些注释的函数列在表19.9中。'
- en: Table 19.9 Functions for adding annotations
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 表19.9 添加注释的函数
- en: '| Function | Description |'
  id: totrans-217
  prefs: []
  type: TYPE_TB
  zh: '| 函数 | 描述 |'
- en: '| `geom_text, geom_label` | `geom_text()` adds text to a plot. `geom_label()`
    is similar, but draws a rectangle around the text. |'
  id: totrans-218
  prefs: []
  type: TYPE_TB
  zh: '| `geom_text, geom_label` | `geom_text()` 向图表添加文本。`geom_label()` 类似，但会在文本周围绘制矩形。|'
- en: '| `geom_text_repel, geom_label_repel` | These are functions from the `ggrepel`
    package. They are similar to `geom_text()` and `geom_label()`, but avoid overlapping
    text. |'
  id: totrans-219
  prefs: []
  type: TYPE_TB
  zh: '| `geom_text_repel, geom_label_repel` | 这些是来自 `ggrepel` 包的函数。它们与 `geom_text()`
    和 `geom_label()` 类似，但可以避免文本重叠。|'
- en: '| `geom_hline, geom_vline, geom_abline` | Adds horizontal, vertical, and diagonal
    reference lines |'
  id: totrans-220
  prefs: []
  type: TYPE_TB
  zh: '| `geom_hline, geom_vline, geom_abline` | 添加水平、垂直和对角参考线|'
- en: '| `geom_rect` | Adds rectangles to the graph. Useful for highlighting areas
    of the plot. |'
  id: totrans-221
  prefs: []
  type: TYPE_TB
  zh: '| `geom_rect` | 向图中添加矩形。用于突出显示绘图中的区域。|'
- en: Labeling points
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 标记点
- en: In figure 19.1, we plotted the relationship between car weight (`wt`) and fuel
    efficiency (`mpg`). However, the reader can’t determine which cars are represented
    by which points without reference to the original dataset. The following listing
    adds this information to the plot. Figure 19.11 displays the graph.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 在图19.1中，我们绘制了汽车重量 (`wt`) 与燃油效率 (`mpg`) 之间的关系。然而，读者无法确定哪些点代表哪些汽车，除非参考原始数据集。以下列表将此信息添加到图表中。图19.11显示了图表。
- en: Listing 19.10 Scatter plot with labeled points
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.10 标记点的散点图
- en: '[PRE16]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![](Images/CH19_F11_Kabacoff3.png)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F11_Kabacoff3.png)'
- en: Figure 19.11 Scatterplot of car weight by miles per gallon. Points are labeled
    with car names.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.11 汽车重量与每加仑英里数的散点图。点用汽车名称标记。
- en: The resulting graph is difficult to read due to overlapping text. The `ggrepel`
    package addresses this limitation by repositioning text labels to avoid overlaps.
    We’ll recreate the graph using this package to label the points. Additionally,
    we’ll add a reference line and label indicating the median MPG. The following
    listing gives the code, and figure 19.12 shows the graph.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 由于文本重叠，生成的图表难以阅读。`ggrepel` 包通过重新定位文本标签以避免重叠来解决这个问题。我们将使用此包来标记点并重新创建图表。此外，我们还将添加一条参考线和标签，指示中位数每加仑英里数。以下列表提供了代码，图19.12显示了图表。
- en: Listing 19.11 Scatter plot with labeled points using `ggrepel`
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.11 使用 `ggrepel` 标记点的散点图
- en: '[PRE17]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: ❶ Reference line
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 参考线
- en: ❷ Reference line label
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 参考线标签
- en: ❸ Point labels
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 点标签
- en: The reference line indicates which cars are above or below the median miles
    per gallon ❶. The line is labeled using `geom_label` ❷. The proper placement of
    the line label (*x*, *y*) takes some experimentation. Finally, the `geom_text_repel()`
    function is used to label the points ❸. The size of the labels is also decreased
    from a default of 4 to 3\. This graph is much easier to read and interpret.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 参考线指示哪些汽车高于或低于中位数每加仑英里数 ❶。该线使用 `geom_label` ❷ 标记。正确放置线标签 (*x*, *y*) 需要一些实验。最后，使用
    `geom_text_repel()` 函数标记点 ❸。标签的大小也从默认的 4 减小到 3。此图表更容易阅读和理解。
- en: '![](Images/CH19_F12_Kabacoff3.png)'
  id: totrans-235
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F12_Kabacoff3.png)'
- en: Figure 19.12 Scatterplot of car weight by miles per gallon. Points are labeled
    with car names. The `ggrepel` package has been used to reposition labels to avoid
    overlapping text. Additionally, a reference line and label have been added.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.12 汽车重量与每加仑英里数的散点图。点用汽车名称标记。`ggrepel` 包已用于重新定位标签以避免文本重叠。此外，还添加了一条参考线和标签。
- en: Labeling bars
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 标记条形图
- en: Labels can be added to bar charts to clarify the distribution of a categorical
    variable or the composition of a stacked bar chart. Adding percentage labels to
    each bar is a two-step process. First, calculate the percentages for each bar.
    Then create the bar chart using these percentages directly, adding the labels
    via the `geom_text()` function. The following listing shows the process. Figure
    19.13 displays the graph.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 可以向条形图添加标签以阐明分类变量的分布或堆叠条形图的组成。向每个条形添加百分比标签是一个两步过程。首先，计算每个条形的百分比。然后使用这些百分比直接创建条形图，并通过
    `geom_text()` 函数添加标签。以下列表显示了此过程。图19.13显示了图表。
- en: Listing 19.12 Adding percent labels to a bar chart
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.12 向条形图添加百分比标签
- en: '[PRE18]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: ❶ Calculates percentages
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 计算百分比
- en: ❷ Adds bars
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 添加条形
- en: ❸ Adds bar labels
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 添加条形标签
- en: The percentages for each race category are calculated ❶, and formatted labels
    (`lbls`) are created using the `percent()` function in the `scales` package. A
    bar chart is then created using this summary data ❷. The option `stat` `=` `"identity"`
    in the `geom_bar()` function tells `ggplot2` to use the *y*-values (bar heights)
    provided, rather than calculating them. The `geom_text()` function is then used
    to print the bar labels ❸. The `vjust` `=` `-0.5` parameter raises the text slightly
    above the bar.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 每个种族类别的百分比是计算出来的 ❶，并使用`scales`包中的`percent()`函数创建格式化的标签（`lbls`）。然后使用这些汇总数据创建条形图
    ❷。`geom_bar()`函数中的`stat` `=` `"identity"`选项告诉`ggplot2`使用提供的*y*-值（条形高度），而不是计算它们。然后使用`geom_text()`函数打印条形标签
    ❸。`vjust` `=` `-0.5`参数将文本略微抬高于条形上方。
- en: '![](Images/CH19_F13_Kabacoff3.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F13_Kabacoff3.png)'
- en: Figure 19.13 Simple bar chart with percent labels
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.13 带有百分比标签的简单条形图
- en: You can also add percentage labels to stacked bar charts. In the following listing,
    the filled bar chart from figure 19.4 is reproduced with added percent labels.
    Figure 19.14 shows the final plot.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以在堆叠条形图中添加百分比标签。在下面的列表中，图19.4中的填充条形图被复制并添加了百分比标签。图19.14显示了最终的图形。
- en: Listing 19.13 Adding percent labels to a stacked (filled) bar chart
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.13 向堆叠（填充）条形图添加百分比标签
- en: '[PRE19]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: ❶ Calculates percentages
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 计算百分比
- en: ❷ Customizes y- and x-axes
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 自定义y轴和x轴
- en: ❸ Adds percent labels
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 添加百分比标签
- en: ❹ Customizes theme
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 自定义主题
- en: This code is similar to the previous code. The percentages for each race by
    education combination are calculated ❶, and the bar charts are produced using
    these percentages. The *x*- and *y*-axes are customized to match listing 19.2
    ❷. Next, the `geom_ text()` function is used to add the percent labels ❸. The
    `position_stack()` function assures that the percentages for each stack segment
    are placed properly. Finally, the plot and fill titles are specified, and a minimal
    theme ❹ is chosen without *x*-axis grid lines (they aren’t needed).
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码与之前的代码类似。根据教育组合计算每个种族的百分比 ❶，并使用这些百分比生成条形图。*x*-轴和*y*-轴被自定义以匹配列表19.2 ❷。接下来，使用`geom_text()`函数添加百分比标签
    ❸。`position_stack()`函数确保每个堆叠段的百分比放置正确。最后，指定了图形和填充标题，并选择了一个没有*x*-轴网格线的最小主题 ❹（它们不需要）。
- en: '![](Images/CH19_F14_Kabacoff3.png)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F14_Kabacoff3.png)'
- en: Figure 19.14 Stacked (filled) bar chart with percent labels
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.14 带有百分比标签的堆叠（填充）条形图
- en: Highlighting details
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 突出细节
- en: A final example demonstrates the use of annotation to highlight information
    in a complex graph. The `gapminder` data frame in the `gapminder` package contains
    the average annual life expectancy for 142 countries recorded every 5 years from
    1952 to 2002\. Life expectancy in Cambodia differs greatly from other Asian countries
    in this dataset. Let’s create a graph that highlights these differences. Listing
    19.14 gives the code, and figure 19.15 shows the results.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 一个最终的例子展示了如何使用注释在复杂图表中突出信息。`gapminder`包中的`gapminder`数据框包含了从1952年到2002年每5年记录的142个国家的平均年度预期寿命。柬埔寨的预期寿命与其他亚洲国家在这组数据中差异很大。让我们创建一个突出这些差异的图表。列表19.14提供了代码，图19.15显示了结果。
- en: '![](Images/CH19_F15_Kabacoff3.png)'
  id: totrans-259
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH19_F15_Kabacoff3.png)'
- en: Figure 19.15 Average life expectancy trends for 33 Asian countries. The trend
    for Cambodia is highlighted. Although the trend is positive for each country,
    Cambodia had a sharp decline from 1967 to 1977.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.15 33个亚洲国家的平均预期寿命趋势。柬埔寨的趋势被突出显示。尽管每个国家的趋势都是积极的，但柬埔寨在1967年到1977年之间有急剧下降。
- en: Listing 19.14 Highlighting one trend among many
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.14 突出众多趋势中的一个
- en: '[PRE20]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: ❶ Subsets Asian countries
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 筛选亚洲国家
- en: ❷ Creates indicator variable for Cambodia
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 为柬埔寨创建指标变量
- en: ❸ Visually highlights Cambodia
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 可视化突出柬埔寨
- en: ❹ Adds an annotation label
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 添加注释标签
- en: First, the data is subset to include only Asian countries ❶. Next, a binary
    variable is created to indicate Cambodia versus other countries ❷. Life expectancy
    is plotted against year, and a separate line is plotted for each country ❸. The
    Cambodian line is thicker than those of other countries and is colored red. All
    other country lines are colored light grey. A label for the Cambodian line is
    added ❹. Finally, plot and axis labels are specified, and a minimal theme is added.
    The legends (size, color) are suppressed (they aren’t needed), and the base text
    size is decreased.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，数据被子集化，只包括亚洲国家 ❶。接下来，创建了一个二元变量来表示柬埔寨与其他国家 ❷。寿命预期与年份作图，并为每个国家绘制一条单独的线 ❸。柬埔寨的线比其他国家的线粗，颜色为红色。所有其他国家的线都为浅灰色。为柬埔寨的线添加了一个标签
    ❹。最后，指定了图形和坐标轴标签，并添加了一个最小主题。图例（大小、颜色）被抑制（不需要），基本文本大小减小。
- en: Looking at the graph, it is clear that average life expectancy has increased
    for each country. But the trend for Cambodia is quite different, with a major
    decline between 1967 and 1977\. This is likely due to the genocide Pol Pot and
    the Khmer Rouge carried out during that period.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 观察图形，可以清楚地看出每个国家的平均寿命预期都有所增加。但柬埔寨的趋势相当不同，在1967年至1977年之间有一个显著的下降。这很可能是由于波尔布特和红色高棉在那个时期实施的种族灭绝。
- en: 19.4 Combining graphs
  id: totrans-269
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.4 组合图形
- en: Combining related `ggplot2` graphs into a single overall graph can often help
    emphasize relationships and differences. I used this when creating several plots
    in the text (see figure 19.7, for an example). The `patchwork` package provides
    a simple yet powerful language for combining plots. To use it, save each `ggplot2`
    graph as an object. Then use the vertical bar (`|`) operator to combine graphs
    horizontally and the forward slash (`/`) operator to combine graphs vertically.
    You can use parentheses `()` to create subgroups of graphs. Figure 19.16 demonstrates
    various plot arrangements.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 将相关的 `ggplot2` 图形组合成一个整体的图形，通常有助于强调关系和差异。我在创建文本中的几个图形时使用了这种方法（例如，见图19.7）。`patchwork`
    包提供了一种简单而强大的语言来组合图形。要使用它，将每个 `ggplot2` 图形保存为一个对象。然后使用竖线（`|`）运算符水平组合图形，使用正斜杠（`/`）运算符垂直组合图形。您可以使用括号
    `()` 创建图形的子组。图19.16展示了各种图形排列方式。
- en: '![](Images/CH19_F16_Kabacoff3.png)'
  id: totrans-271
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH19_F16_Kabacoff3.png)'
- en: Figure 19.16 The `patchwork` package provides a simple set of arithmetic symbols
    for arranging multiple graphs in a single plot.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.16 `patchwork` 包提供了一套简单的算术符号，用于在单个图形中排列多个图形。
- en: Let’s create several `mpg`-related plots from the `mtcars` data frame and combine
    them into a single graph. The following listing gives the code, and figure 19.17
    displays the graph.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从 `mtcars` 数据框中创建几个与 `mpg` 相关的图形，并将它们组合成一个单一的图形。以下列表给出了代码，图19.17显示了该图形。
- en: Listing 19.15 Combining graphs using the `patchwork` package
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.15 使用 `patchwork` 包组合图形
- en: '[PRE21]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: ❶ Three graphs are created.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 创建了三个图形。
- en: ❷ The graphs are combined into one plot.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 图形被组合成一个单一的图形。
- en: Three separate graphs are created and saved as `p1`, `p2`, and `p3` ❶. The code
    `(p1| p2)/p3` indicates that the first two plots should be placed in the first
    row and the third plot should take up the entire second row ❷.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 创建了三个单独的图形，并保存为 `p1`、`p2` 和 `p3` ❶。代码 `(p1| p2)/p3` 表示前两个图形应放置在第一行，第三个图形应占据整个第二行
    ❷。
- en: '![](Images/CH19_F17_Kabacoff3.png)'
  id: totrans-279
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH19_F17_Kabacoff3.png)'
- en: Figure 19.17 Three `ggplot2` plots are combined into one graph using the patchwork
    package.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.17 使用 patchwork 包将三个 `ggplot2` 图形组合成一个图形。
- en: The resulting graph is also a `ggplot2` graph and can be edited. The `plot_annotation()`
    function adds a title to the combined graph (rather than to one of the subplots).
    Finally, the theme is modified. Note the use of the ampersand (`&`) to add theme
    elements. If you had used a plus (`+`) sign, the changes would only apply to the
    *last* subplot (`p3`). The `&` sign indicates that the theme functions should
    apply to each subplot (`p1`, `p2`, and `p3`).
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 生成的图形也是一个 `ggplot2` 图形，可以进行编辑。`plot_annotation()` 函数为组合图形添加了一个标题（而不是为子图之一添加）。最后，修改了主题。注意使用连字符（`&`）来添加主题元素。如果您使用了加号（`+`），则更改只会应用于最后一个子图（`p3`）。`&`
    符号表示主题函数应该应用于每个子图（`p1`、`p2` 和 `p3`）。
- en: The `patchwork` package has many additional options. To learn more, see the
    package reference site ([https://patchwork.data-imaginist.com/](https://patchwork.data-imaginist.com/)).
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: '`patchwork` 包有许多其他选项。要了解更多信息，请参阅包参考网站([https://patchwork.data-imaginist.com/](https://patchwork.data-imaginist.com/))。'
- en: 19.5 Making graphs interactive
  id: totrans-283
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.5 制作交互式图形
- en: With few exceptions, the graphs in this book have been static images. There
    are several reasons for creating *interactive graphs*. They allow you to focus
    on interesting results and call up additional information to understand patterns,
    trends, and unusual observations. Additionally, they’re often more engaging than
    static graphs.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 除了少数例外，本书中的图表都是静态图像。创建交互式图表有几个原因。它们允许你专注于有趣的结果，并调用附加信息来理解模式、趋势和异常观察。此外，它们通常比静态图表更具吸引力。
- en: Several packages in R can be used to create interactive visualizations, including
    `leaflet`, `rbokeh`, `rCharts`, `highlighter`, and `plotly`. In this section,
    we’ll focus on `plotly`.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: R中有几个包可以用来创建交互式可视化，包括`leaflet`、`rbokeh`、`rCharts`、`highlighter`和`plotly`。在本节中，我们将重点关注`plotly`。
- en: The *Plotly R Open Source Graphing Lib*rary ([https://plotly.com/r/](https://plotly.com/r/))
    can be used to create high-end interactive visualizations. A key advantage is
    its ability to convert a static `ggplot2` graph into an interactive web graphic.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: '*Plotly R开源绘图库* ([https://plotly.com/r/](https://plotly.com/r/))可以用来创建高端交互式可视化。一个关键优势是它能够将静态`ggplot2`图表转换为交互式网络图形。'
- en: Creating an interactive graph using the `plotly` package is an easy two-step
    process. First, save a `ggplot2` graph as an object. Then pass the object to the
    `ggplotly()` function.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`plotly`包创建交互式图表是一个简单的两步过程。首先，将`ggplot2`图表保存为一个对象。然后将该对象传递给`ggplotly()`函数。
- en: In listing 19.16, a scatterplot between miles per gallon and engine displacement
    is created using `ggplot2`. The points are colored to represent the number of
    engine cylinders. The plot is then passed to the `ggplotly()` function in the
    `plotly` package, producing an interactive web-based visualization. Figure 19.18
    provides a screenshot.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 在列表19.16中，使用`ggplot2`创建了一个每加仑英里数与发动机排量之间的散点图。点被着色以表示发动机气缸数。然后，将图表传递给`plotly`包中的`ggplotly()`函数，生成一个基于网页的交互式可视化。图19.18提供了一个截图。
- en: Listing 19.16 Converting a `ggplot2` graph to an interactive `plotly` graph
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.16 将`ggplot2`图表转换为交互式`plotly`图表
- en: '[PRE22]'
  id: totrans-290
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: When you mouse over the graph, a toolbar will appear on the top right-hand side
    of the plot that allows you to zoom, pan, select areas, download an image, and
    more (see figure 19.19). Additionally, tooltips will pop up when the mouse cursor
    move over the plot area. By default, the tooltip displays the variable values
    use to create the graph (`disp`, `mpg`, and `cyl` in this example). Additionally,
    clicking on a key (symbol) in the legend will toggle that data on and off. This
    allows you to easily focus on subsets of the data.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 当你将鼠标悬停在图表上时，图表右上角将出现一个工具栏，允许你缩放、平移、选择区域、下载图像等（见图19.19）。此外，当鼠标光标移动到图表区域时，将弹出工具提示。默认情况下，工具提示显示用于创建图表的变量值（在本例中为`disp`、`mpg`和`cyl`）。此外，点击图例中的键（符号）可以切换数据的开和关。这允许你轻松地关注数据的子集。
- en: '![](Images/CH19_F18_Kabacoff3.png)'
  id: totrans-292
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH19_F18_Kabacoff3.png)'
- en: Figure 19.18 Screenshot of a `plotly` interactive web graphic created from a
    static `ggplot2` graph
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.18 从静态`ggplot2`图表创建的`plotly`交互式网络图形的截图
- en: '![](Images/CH19_F19_Kabacoff3.png)'
  id: totrans-294
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH19_F19_Kabacoff3.png)'
- en: Figure 19.19 The `plotly` graph toolbar. The easiest way to understand these
    tools is to try them out one at a time.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.19 `plotly`图表工具栏。理解这些工具的最简单方法是逐一尝试。
- en: There are two simple ways to customize the tooltip. You can add additional variables
    to the tooltip by including `label1` `=` `var1`, `label2` `=` `var2`, etc., in
    the `ggplot aes()` function. For example,
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 有两种简单的方法可以自定义工具提示。你可以在`ggplot aes()`函数中包含`label1` `=` `var1`、`label2` `=` `var2`等，以向工具提示中添加额外的变量。例如，
- en: '[PRE23]'
  id: totrans-297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: will create a tooltip with `disp`, `mpg`, `cyl`, `gear`, and `am`.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 将创建一个包含`disp`、`mpg`、`cyl`、`gear`和`am`的工具提示。
- en: Alternatively, you can use an undocumented `text` argument in the `aes()` function
    to build the tooltip from an arbitrary text string. The following listing gives
    an example, and figure 19.20 provides a screenshot of the result.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你可以使用`aes()`函数中的非官方`text`参数来从任意文本字符串构建工具提示。以下列表提供了一个示例，图19.20提供了结果的截图。
- en: Listing 19.17 Customizing the `plotly` tooltip
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 列表19.17 定制`plotly`工具提示
- en: '[PRE24]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![](Images/CH19_F20_Kabacoff3.png)'
  id: totrans-302
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH19_F20_Kabacoff3.png)'
- en: Figure 19.20 Screenshot of an interactive `plotly` graph with a custom tooltip
    created from within the `ggplot2` code
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.20 从`ggplot2`代码中创建的具有自定义工具提示的交互式`plotly`图表的截图
- en: The `text` approach gives you great control over the tooltip. You can even include
    HTML markup in the text string, allowing you customize the text output further.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: '`text` 方法让你对提示信息有极大的控制权。你甚至可以在文本字符串中包含HTML标记，从而进一步自定义文本输出。'
- en: This chapter has covered various methods for customizing `ggplot2` graphs. Remember
    that the goal of customization is to enhance your insight into the data and improve
    communication of those insights to others. Anything added to a graph that detracts
    from these goals is mere decoration (also known as chart junk). Always try to
    avoid chart junk! See *Data Visualization Standards* ([https://xdgov.github.io/data-design-standards/](https://xdgov.github.io/data-design-standards/))
    for additional recommendations.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了自定义 `ggplot2` 图表的各种方法。请记住，自定义的目标是增强你对数据的洞察力，并改善这些洞察力与他人的沟通。任何偏离这些目标的添加到图表中的元素都只是装饰（也称为图表垃圾）。始终尝试避免图表垃圾！请参阅
    *数据可视化标准* ([https://xdgov.github.io/data-design-standards/](https://xdgov.github.io/data-design-standards/))
    获取更多建议。
- en: Summary
  id: totrans-306
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: The `ggplot2` scale functions map variable values to visual aspects of a graph.
    They are particularly useful for customizing the axes and color palette.
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ggplot2` 的缩放函数将变量值映射到图表的视觉方面。它们特别适用于自定义坐标轴和颜色调色板。'
- en: The `ggplot2 theme()` function controls nondata elements of the graph. It is
    useful for customizing the appearance of fonts, legends, grid lines, and the plot
    background.
  id: totrans-308
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ggplot2 theme()` 函数控制图表的非数据元素。它用于自定义字体、图例、网格线和绘图背景的外观。'
- en: The `ggplot2 geom` functions are useful for annotating a graph by adding useful
    information, such as reference lines and labels.
  id: totrans-309
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ggplot2 geom` 函数通过添加有用的信息（如参考线和标签）来注释图表很有用。'
- en: Two or more graphs can be combined into a single graph using the `patchwork`
    package.
  id: totrans-310
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `patchwork` 包可以将两个或多个图表合并为单个图表。
- en: Almost any `ggplot2` graph can be converted from a static image to an interactive
    web graphic using the `plotly` package.
  id: totrans-311
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 几乎任何 `ggplot2` 图表都可以使用 `plotly` 包从静态图像转换为交互式网络图形。
