- en: 21 Creating dynamic reports
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 21 创建动态报告
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Publishing results to the web
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将结果发布到网络上
- en: Incorporating R results into Microsoft Word or Open Document reports
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将 R 结果整合到 Microsoft Word 或 Open Document 报告中
- en: Creating dynamic reports in which changing the data changes the report
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建动态报告，其中更改数据会更改报告
- en: Creating publication-quality documents with R, Markdown, and LaTeX
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 R、Markdown 和 LaTeX 创建可发布的文档
- en: Avoiding common R Markdown errors
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免常见的 R Markdown 错误
- en: In previous chapters you’ve accessed your data, cleaned it up, described its
    characteristics, modeled the relationships, and visualized the results. The next
    step is to
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的章节中，您已经访问了数据，清理了数据，描述了其特征，建立了模型，并可视化了结果。下一步是
- en: Relax and perhaps go to Disney World.
  id: totrans-8
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 放松一下，也许可以去迪士尼世界。
- en: Communicate the results to others.
  id: totrans-9
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将结果传达给他人。
- en: If you chose 1, please take me with you. If you chose 2, welcome to the real
    world.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您选择了 1，请带上我。如果您选择了 2，欢迎来到现实世界。
- en: Research doesn’t end when the last statistical analysis or graph is finished.
    You’ll almost always have to communicate the results to others. This means incorporating
    the analyses into a report of some kind.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 研究并不随着最后的数据分析或图表的完成而结束。您几乎总是需要将结果传达给他人。这意味着将分析整合到某种类型的报告中。
- en: There are three common report scenarios. In the first, you create a report that
    includes your code and the results so you can remember what you did six months
    from now. It’s easier to reconstruct what was done from a single comprehensive
    document than from a set of related files.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 有三种常见的报告场景。在第一种情况下，您创建的报告包括您的代码和结果，这样您就可以记住六个月前做了什么。从单一的综合文档中重建所做的工作比从一系列相关文件中更容易。
- en: In the second scenario, you have to generate a report for a teacher, a supervisor,
    a client, a government agency, an internet audience, or a journal editor. Clarity
    and attractiveness matter, and the report may only need to be created once.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在第二种情况下，您必须为教师、主管、客户、政府机构、互联网受众或期刊编辑生成报告。清晰度和吸引力很重要，而且报告可能只需要创建一次。
- en: In the third scenario, you need to generate a specific type of report on a regular
    basis. It may be a monthly report on product or resource usage, a weekly financial
    analysis, or a report on web traffic that’s updated hourly. In any case, the data
    changes, but the analyses and the structure of the report remain the same.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在第三种情况下，您需要定期生成特定类型的报告。这可能是一份关于产品或资源使用的月度报告，一份周度财务分析，或者每小时更新的网站流量报告。在任何情况下，数据都会变化，但分析和报告的结构保持不变。
- en: One approach to incorporating R output into a report involves running the analyses,
    cutting and pasting each graph and text table into a word processing document,
    and reformatting the results. This approach is usually time consuming, inefficient,
    and frustrating. Although R creates state-of-the-art graphics, its text output
    is woefully retro—tables of monospaced text with columns lined up using spaces.
    Reformatting them is no easy task. And if the data changes, you’ll have to go
    through the entire process again!
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 将 R 输出整合到报告中的方法之一是运行分析，将每个图表和文本表格剪切并粘贴到文字处理文档中，并重新格式化结果。这种方法通常耗时、效率低下且令人沮丧。尽管
    R 创建了最先进的图形，但其文本输出却非常落后——使用空格对齐列的单倍间距文本表。重新格式化它们并非易事。而且如果数据发生变化，您将不得不再次完成整个流程！
- en: Given these limitations, you may feel that R won’t work for you. Have no fear.
    (OK, have a little fear—it’s an important survival mechanism.) R offers an elegant
    solution for incorporating R code and results into reports using a markup language
    called *R Markdown* ([https://rmarkdown.rstudio.com](https://rmarkdown.rstudio.com)).
    Additionally, the data can be tied to the report so that changing the data changes
    the report. These dynamic reports can be saved as
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到这些限制，您可能会觉得 R 对您不起作用。别担心。（好吧，有点担心——这是一种重要的生存机制。）R 提供了一种优雅的解决方案，使用一种名为 *R
    Markdown* 的标记语言将 R 代码和结果整合到报告中（[https://rmarkdown.rstudio.com](https://rmarkdown.rstudio.com)）。此外，数据可以与报告绑定，以便更改数据会更改报告。这些动态报告可以保存为
- en: Web pages
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网页
- en: Microsoft Word documents
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microsoft Word 文档
- en: Open Document files
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Open Document 文件
- en: Beamer, HTML5, and PowerPoint slides
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Beamer、HTML5 和 PowerPoint 幻灯片
- en: Publication-ready PDF or PostScript documents
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可发布的 PDF 或 PostScript 文档
- en: 'For example, say you’re using regression analysis to study the relationship
    between weight and height in a sample of women. R Markdown allows you to take
    the monospaced output generated by the `lm()` function:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设你正在使用回归分析来研究一组女性体重和身高的关系。R Markdown允许你获取由`lm()`函数生成的等宽输出：
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: and turn it into a web page like that in figure 21.1\. In this chapter, you’ll
    learn how.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 并将其转换为如图21.1所示的网页。在本章中，你将学习如何做到这一点。
- en: '![](Images/CH21_F01_Kabacoff3.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH21_F01_Kabacoff3.png)'
- en: Figure 21.1 Regression analysis saved to a web page
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图21.1回归分析保存到网页
- en: Dynamic documents and reproducible research
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 动态文档和可重复研究
- en: There is a powerful movement growing within the academic community in support
    of *reproducible research*. The goal of reproducible research is to facilitate
    the replication of scientific findings by including the data and software code
    necessary to reproduce findings in the publications that report them. This allows
    readers to verify the findings for themselves and gives them an opportunity to
    build on the results more directly in their own work. The techniques described
    in this chapter, including the embedding of data and source code with documents,
    directly support this effort.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 学术界内部正在兴起一股支持*可重复研究*的强大运动。可重复研究的目的是通过包括必要的数据和软件代码来促进科学发现的复制，这些代码用于在报告它们的出版物中重现发现。这允许读者自己验证发现，并为他们自己提供在自身工作中更直接地建立结果的机会。本章描述的技术，包括将数据和源代码嵌入文档中，直接支持这一努力。
- en: 21.1 A template approach to reports
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 21.1 报告的模板方法
- en: This chapter employs a template approach to report generation. A report starts
    with a template file that contains the report text, formatting syntax, and R code
    chunks.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 本章采用模板方法来生成报告。报告从一个包含报告文本、格式化语法和R代码块的模板文件开始。
- en: The template file is processed, the R code is run, the formatting syntax is
    applied, and a report is generated. Different options control how R output is
    included in the report. Figure 21.2 shows a simple example using an R Markdown
    template to create a web page.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 模板文件被处理，R代码被执行，应用了格式化语法，并生成了一份报告。不同的选项控制了R输出在报告中的包含方式。图21.2展示了使用R Markdown模板创建网页的一个简单示例。
- en: '![](Images/CH21_F02_Kabacoff3.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH21_F02_Kabacoff3.png)'
- en: Figure 21.2 Creating a web page from a text file that includes Markdown syntax,
    report text, and R code chunks
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图21.2从包含Markdown语法、报告文本和R代码块的文本文件创建网页
- en: 'The template file (example.Rmd) is a plain text file containing four components:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 模板文件（example.Rmd）是一个包含四个组件的纯文本文件：
- en: '*Metadata*—The metadata (called a YAML header) is bracketed by a pair of three
    dashes (---) and contains information on the document and the desired output.'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*元数据*—元数据（称为YAML标题）由一对三个短横线（---）括起来，包含有关文档和所需输出的信息。'
- en: '*Report text*—Any explanatory phrases and text. Here, the report text is “My
    Report,” “Here is some data,” “Plots,” and “Here is a plot.”'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*报告文本*—任何解释性短语和文本。在这里，报告文本是“我的报告”、“这里有一些数据”、“图表”和“这里有一个图表”。'
- en: '*Formatting syntax*—The tags that control report formatting. In this file,
    Markdown tags are used to format the results. Markdown is a simple markup language
    that can be used to convert plain text files to structurally valid HTML or XHTML.
    The pound symbol `#` in the first line isn’t a comment. It produces a level-1
    header. `##` produces a level-2 header, and so on.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*格式化语法*—控制报告格式的标签。在这个文件中，Markdown标签用于格式化结果。Markdown是一种简单的标记语言，可以用来将纯文本文件转换为结构有效的HTML或XHTML。第一行中的井号`#`不是一个注释。它产生一个一级标题。`##`产生一个二级标题，以此类推。'
- en: '*R code*—R statements to be executed. In R Markdown documents, R code chunks
    are surrounded by [PRE1] and [PRE2]. The first code chunk lists the first six
    rows of the dataset, and the second code chunk produces a scatter plot. In this
    example, both the code and the results are output to the report, but options allow
    you to control what’s printed on a chunk-by-chunk basis.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*R代码*—要执行的R语句。在R Markdown文档中，R代码块被[PRE1]和[PRE2]包围。第一个代码块列出数据集的前六行，第二个代码块生成一个散点图。在这个例子中，代码和结果都输出到报告中，但选项允许你控制每个代码块打印的内容。'
- en: The template file is passed to the `render()` function in the `rmarkdown` package,
    and a web page named example.html is created. The web page contains both the report
    text and R results.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 模板文件被传递到`rmarkdown`包中的`render()`函数，并创建了一个名为example.html的网页。该网页包含报告文本和R结果。
- en: The examples in this chapter are based on descriptive statistics, regression,
    and ANOVA problems. None of them represent full analyses of the data. The goal
    in this chapter is to learn how to incorporate the R results into various types
    of reports.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的示例基于描述性统计、回归和方差分析问题。它们都不代表数据的完整分析。本章的目标是学习如何将 R 结果纳入各种类型的报告中。
- en: Depending on the template file you start with and the functions used to process
    it, different report formats (HTML web pages, Microsoft Word documents, OpenOffice
    Writer documents, PDF reports, articles, slides, and books) are created. The reports
    are dynamic in the sense that changing the data and reprocessing the template
    file will produce a new report.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 根据您开始时使用的模板文件以及用于处理它的函数，可以创建不同的报告格式（HTML 网页、Microsoft Word 文档、OpenOffice Writer
    文档、PDF 报告、文章、幻灯片和书籍）。报告是动态的，这意味着更改数据和重新处理模板文件将产生一个新的报告。
- en: 21.2 Creating a report with R and R Markdown
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 21.2 使用 R 和 R Markdown 创建报告
- en: 'In this section, you’ll use the `rmarkdown` package to create documents generated
    from Markdown syntax and R code. When the document is processed, the R code is
    executed, and the output is formatted and embedded in the finished document. You
    can use this approach to generate reports in a wide variety of formats. Here are
    the steps:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，您将使用 `rmarkdown` 包来创建由 Markdown 语法和 R 代码生成的文档。当文档被处理时，R 代码将被执行，输出将被格式化并嵌入到最终的文档中。您可以使用这种方法生成各种格式的报告。以下是步骤：
- en: Install the `rmarkdown` package (`install.packages("rmarkdown")`). This will
    install several other packages, including `knitr`. If you’re using a recent version
    of RStudio, you can skip this step because you already have the necessary packages.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装 `rmarkdown` 包 (`install.packages("rmarkdown")`)。这将安装包括 `knitr` 在内的几个其他包。如果您使用的是
    RStudio 的最新版本，您可以跳过此步骤，因为您已经拥有了必要的包。
- en: Install Pandoc ([http://johnmacfarlane.net/pandoc/](http://johnmacfarlane.net/pandoc/)),
    which is a free application available for Windows, macOS, and Linux. It converts
    files from one markup format to another. Again, RStudio users can skip this step.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装 Pandoc ([http://johnmacfarlane.net/pandoc/](http://johnmacfarlane.net/pandoc/))，这是一个免费的应用程序，适用于
    Windows、macOS 和 Linux。它可以将文件从一种标记格式转换为另一种格式。再次提醒，RStudio 用户可以跳过此步骤。
- en: If you want to create PDF documents, install a LaTeX compiler, which converts
    a LaTeX document into a high-quality typeset PDF document. Comprehensive installations
    include MiKTeX ([www.miktex.org](http://www.miktex.org)) for Windows, MacTeX for
    Macs ([http://tug.org/mactex](http://tug.org/mactex)), and TeX Live for Linux
    ([www.tug.org/texlive](http://www.tug.org/texlive)). I recommend a lightweight
    cross-platform installation called TinyTex ([http://yihui.org/tinytex](http://yihui.org/tinytex)).
    To install it, run
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您想创建 PDF 文档，请安装 LaTeX 编译器，它可以将 LaTeX 文档转换为高质量的排版 PDF 文档。完整的安装包括 Windows 的
    MiKTeX ([www.miktex.org](http://www.miktex.org))、Mac 的 MacTeX ([http://tug.org/mactex](http://tug.org/mactex))
    和 Linux 的 TeX Live ([www.tug.org/texlive](http://www.tug.org/texlive))。我推荐一个轻量级的跨平台安装，称为
    TinyTex ([http://yihui.org/tinytex](http://yihui.org/tinytex))。要安装它，请运行
- en: '`install.packages("tinytex")`'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`install.packages("tinytex")`'
- en: '`tinytex::install_tinytex()`'
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`tinytex::install_tinytex()`'
- en: While not strictly necessary, it’s a good idea to install the `broom` package
    (`install.packages("broom")`). The `tidy()` function in this package can export
    the results from over 135 R statistical functions into data frames for inclusion
    in reports. See `methods(tidy)` to view a comprehensive list of the objects it
    can output.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 虽然这不是强制性的，但安装 `broom` 包 (`install.packages("broom")`) 是一个好主意。该包中的 `tidy()` 函数可以将超过
    135 个 R 统计函数的结果导出到数据框中，以便包含在报告中。查看 `methods(tidy)` 以查看它可以输出的对象的综合列表。
- en: Finally, install `kableExtra` (`install.packages("kableExtra"`). The `kable`
    function in the `knitr` package converts a matrix or data frame into a LaTeX or
    HTML table for inclusion in reports. The `kableExtra` package includes functions
    to style the table output.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，安装 `kableExtra` (`install.packages("kableExtra")`)。`knitr` 包中的 `kable` 函数可以将矩阵或数据框转换为
    LaTeX 或 HTML 表格，以便包含在报告中。`kableExtra` 包包括用于样式化表格输出的函数。
- en: With the software set up, you’re ready to go.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 软件设置完成后，您就可以开始了。
- en: To incorporate R output (values, tables, graphs) in a document using Markdown
    syntax, first create a text document that contains
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 Markdown 语法在文档中包含 R 输出（值、表格、图形），首先创建一个包含
- en: A YAML header
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: YAML 标头
- en: Report text
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 报告文本
- en: Markdown syntax
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Markdown 语法
- en: R code chunks (R code surrounded by delimiters)
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R 代码块（由分隔符包围的 R 代码）
- en: The text file should have the file extension .Rmd.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 文本文件应具有 .Rmd 扩展名。
- en: Listing 22.1 shows a sample file (named women.Rmd). To generate an HTML document,
    process this file using
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 22.1 展示了一个示例文件（命名为 women.Rmd）。要生成 HTML 文档，使用以下命令处理此文件
- en: '[PRE3]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: or click on the RStudio Knit button. Figure 21.1 displays the results.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 或点击 RStudio Knit 按钮。图 21.1 显示了结果。
- en: 'Listing 21.1 women.Rmd: an R Markdown template with embedded R code'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 21.1 women.Rmd：一个嵌入 R 代码的 R Markdown 模板
- en: '[PRE4]{r echo = FALSE}                                              ❸'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE4]{r echo = FALSE}                                              ❸'
- en: options(digits=3)                                                ❸
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: options(digits=3)                                                ❸
- en: n    <- nrow(women)                                              ❸
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: n    <- nrow(women)                                              ❸
- en: fit  <- lm(weight ~ height, data=women)                          ❸
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: fit  <- lm(weight ~ height, data=women)                          ❸
- en: sfit <- summary(fit)                                             ❸
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: sfit <- summary(fit)                                             ❸
- en: b    <- coefficients(fit)                                        ❸
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: b    <- coefficients(fit)                                        ❸
- en: '[PRE5]{r echo=FALSE}                                                ❺'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE5]{r echo=FALSE}                                                ❺'
- en: library(broom)                                                   ❺
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: library(broom)                                                   ❺
- en: library(knitr)                                                   ❺
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: library(knitr)                                                   ❺
- en: library(kableExtra)                                              ❺
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: library(kableExtra)                                              ❺
- en: results <- tidy(fit)                                             ❺
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: results <- tidy(fit)                                             ❺
- en: tbl <- kable(results)                                            ❺
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: tbl <- kable(results)                                            ❺
- en: kable_styling(tbl, "striped", full_width=FALSE, position="left") ❺
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: kable_styling(tbl, "striped", full_width=FALSE, position="left") ❺
- en: '[PRE6]{r fig.width=5, fig.height=4}'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE6]{r fig.width=5, fig.height=4}'
- en: library(ggplot2)
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: library(ggplot2)
- en: ggplot(data=women, aes(x=height, y=weight)) +
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: ggplot(data=women, aes(x=height, y=weight)) +
- en: geom_point() + geom_smooth(method="lm", formula=y~x)
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: geom_point() + geom_smooth(method="lm", formula=y~x)
- en: '[PRE7]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: ❶ YAML header
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ YAML 标题
- en: ❷ Level-2 header
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 二级标题
- en: ❸ R code chunk
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ R 代码块
- en: ❹ R inline code
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ R 内联代码
- en: ❺ Formatted results table
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 格式化结果表格
- en: The report starts with a YAML header ❶ indicating title, author, date, and output
    format. The date is hardcoded. To dynamically insert the current date, replace
    `"7/8/2021"` with ``"`r Sys.Date()`"`` (including the double quote marks). In
    a YAML header, only the output field is required. Table 21.1 lists the most common
    of the output options. A complete listing is available from RStudio ([https://rmarkdown.rstudio.com/lesson-9.html](https://rmarkdown.rstudio.com/lesson-9.html)).
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 报告以 YAML 标题 ❶ 开始，指示标题、作者、日期和输出格式。日期是硬编码的。要动态插入当前日期，将 `"7/8/2021"` 替换为 ``"`r
    Sys.Date()`"``（包括双引号）。在 YAML 标题中，只需要输出字段。表 21.1 列出了最常见的输出选项。完整的列表可在 RStudio ([https://rmarkdown.rstudio.com/lesson-9.html](https://rmarkdown.rstudio.com/lesson-9.html))
    中找到。
- en: Table 21.1 R Markdown document output options
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 表 21.1 R Markdown 文档输出选项
- en: '| Output options | Description |'
  id: totrans-87
  prefs: []
  type: TYPE_TB
  zh: '| 输出选项 | 描述 |'
- en: '| `html_document` | HTML document |'
  id: totrans-88
  prefs: []
  type: TYPE_TB
  zh: '| `html_document` | HTML 文档 |'
- en: '| `pdf_document` | PDF document |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
  zh: '| `pdf_document` | PDF 文档 |'
- en: '| `word_document` | Microsoft Word document |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| `word_document` | Microsoft Word 文档 |'
- en: '| `odt_document` | Open Document Text document |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| `odt_document` | Open Document Text 文档 |'
- en: '| `rtf_document` | Rich Text document |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| `rtf_document` | 富文本文档 |'
- en: Next is first-level header ❷. It indicates that “Heights and Weights” should
    be printed in a large, bold font. Table 21.2 shows examples of other Markdown
    syntax.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是第一级标题 ❷。它指示“身高和体重”应以大号粗体字打印。表 21.2 展示了其他 Markdown 语法的示例。
- en: Table 21.2 Markdown code and the resulting output
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 表 21.2 Markdown 代码及其生成的输出
- en: '| Markdown syntax | Resulting HTML output |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| Markdown 语法 | 生成的 HTML 输出 |'
- en: '| `# Heading 1``## Heading 2``...``###### Heading 6` | `<h1>Heading 1</h1>``<h2>Heading
    2</h2>``...``<h6>Heading 6</h6>` |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| `# Heading 1``## Heading 2``...``###### Heading 6` | `<h1>Heading 1</h1>``<h2>Heading
    2</h2>``...``<h6>Heading 6</h6>` |'
- en: '| One or more blank lines between text | Separates text into paragraphs |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
  zh: '| 文本之间有一或多个空白行 | 将文本分隔成段落 |'
- en: '| Two or more spaces at the end of a line | Adds a line break |'
  id: totrans-98
  prefs: []
  type: TYPE_TB
  zh: '| 行尾有两个或多个空格 | 添加换行符 |'
- en: '| `*I mean it*` | `<em>I mean it</em>` |'
  id: totrans-99
  prefs: []
  type: TYPE_TB
  zh: '| `*I mean it*` | `<em>I mean it</em>` |'
- en: '| `**I really mean it**` | `<strong>I really mean it</strong>` |'
  id: totrans-100
  prefs: []
  type: TYPE_TB
  zh: '| `**I really mean it**` | `<strong>I really mean it</strong>` |'
- en: '| `* item 1``* item 2` | `<ul>``<li> item 1 </li>``<li> item 2 </li>``</ul>`
    |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
  zh: '| `* item 1``* item 2` | `<ul>``<li> item 1 </li>``<li> item 2 </li>``</ul>`
    |'
- en: '| `1\. item 1``2\. item 2` | `<ol>``<li> item 1 </li>``<li> item 2 </li>``</ol>`
    |'
  id: totrans-102
  prefs: []
  type: TYPE_TB
  zh: '| `1\. item 1``2\. item 2` | `<ol>``<li> item 1 </li>``<li> item 2 </li>``</ol>`
    |'
- en: '| `[Google](http://google.com)` | `<a href="http://google.com">Google</a>`
    |'
  id: totrans-103
  prefs: []
  type: TYPE_TB
  zh: '| `[Google](http://google.com)` | `<a href="http://google.com">Google</a>`
    |'
- en: '| `![My text](path to image)` | `<img src="path to image", alt="My text">`
    |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '| `![我的文本](图片路径)` | `<img src="图片路径", alt="我的文本">` |'
- en: '| `\newpage` | Page break—starts a new page. (This is a LaTeX command recognized
    by `rmarkdown`.) |'
  id: totrans-105
  prefs: []
  type: TYPE_TB
  zh: '| `\newpage` | 分页符——开始新的一页。（这是`rmarkdown`识别的LaTeX命令。）'
- en: Next comes an R code chunk ❸. R code in Markdown documents is delimited by [PRE8]
    and [PRE9]. When the file is processed, the R code is executed, and the results
    are inserted. The option `echo=FALSE` omits the code from the output. Table 21.3
    lists code chunk options.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是一个R代码块❸。Markdown文档中的R代码由[PRE8]和[PRE9]分隔。当文件被处理时，R代码将被执行，并将结果插入。`echo=FALSE`选项将代码从输出中省略。表21.3列出了代码块选项。
- en: Table 21.3 Code chunk options
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 表21.3代码块选项
- en: '| Option | Description |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| 选项 | 描述 |'
- en: '| `echo` | Whether to include the R source code in the output `(TRUE)` or not
    `(FALSE)` |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '| `echo` | 是否在输出中包含R源代码 `(TRUE)` 或不包含 `(FALSE)` |'
- en: '| `results` | Whether to output raw results `(asis)` or hide the results `(hide)`
    |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '| `results` | 是否输出原始结果 `(asis)` 或隐藏结果 `(hide)` |'
- en: '| `warning` | Whether to include warnings in the output `(TRUE)` or not `(FALSE)`
    |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| `warning` | 是否在输出中包含警告 `(TRUE)` 或不包含 `(FALSE)` |'
- en: '| `message` | Whether to include informational messages in the output `(TRUE)`
    or not `(FALSE)` |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| `message` | 是否在输出中包含信息性消息 `(TRUE)` 或不包含 `(FALSE)` |'
- en: '| `error` | Whether to include error messages in the output `(TRUE)` or not
    `(FALSE)` |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| `error` | 是否在输出中包含错误消息 `(TRUE)` 或不包含 `(FALSE)` |'
- en: '| `cache` | Save results and only rerun the code chunk if the code has changed
    |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '| `cache` | 保存结果，并且只有当代码发生变化时才重新运行代码块 |'
- en: '| `fig.width` | Figure width for plots (inches) |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '| `fig.width` | 图形的宽度（英寸）|'
- en: '| `fig.height` | Figure height for plots (inches) |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '| `fig.height` | 图形的宽度（英寸）|'
- en: Simple R output (a number or string) can also be placed directly within report
    text. Inline R code allows you to customize the text in individual sentences.
    Inline code is placed between `` `r `` and `` ` `` tags. In the regression example,
    the sample size, prediction equation, and R-squared value are embedded in the
    first paragraph ❹.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 简单的R输出（数字或字符串）也可以直接放置在报告文本中。内联R代码允许您自定义单个句子中的文本。内联代码放置在`` `r ``和`` ` ``标签之间。在回归示例中，样本大小、预测方程和R平方值嵌入在第一段❹中。
- en: The next R code chunk creates a nicely formatted ANOVA table ❺. The `tidy()`
    function from the `broom` package exports the regression results as a data frame
    (tibble). The `kable()` function from the `knitr` package converts this data frame
    into HTML code, and the `kable_styling()` function from the `kableExtra` package
    sets the table width and table alignment, and adds color striping. See `help(kable_
    styling`) for additional formatting options.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个R代码块创建了一个格式良好的ANOVA表❺。`tidy()`函数来自`broom`包，将回归结果导出为数据框（tibble）。`kable()`函数来自`knitr`包，将此数据框转换为HTML代码，`kable_styling()`函数来自`kableExtra`包，设置表格宽度和对齐方式，并添加颜色条纹。有关其他格式选项，请参阅`help(kable_
    styling)`。
- en: The `kable``()` and `kable_styling()` functions are simple and easy to use.
    Several packages in R can create more complex tables and offer a larger number
    of styling options. These include `xtable`, `expss`, `gt`, `huxtable`, `flextable`,
    `pixiedust`, and `stargaze`r. Each has its pros and cons (see [http://mng.bz/aKy9](http://mng.bz/aKy9)
    and [http://mng.bz/gxO8](http://mng.bz/gxO8) for discussion). Use the package(s)
    that best meet your needs.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '`kable()`和`kable_styling()`函数简单易用。R中有几个包可以创建更复杂的表格并提供更多的样式选项。这些包括`xtable`、`expss`、`gt`、`huxtable`、`flextable`、`pixiedust`和`stargaze`r。每个包都有其优缺点（请参阅[http://mng.bz/aKy9](http://mng.bz/aKy9)和[http://mng.bz/gxO8](http://mng.bz/gxO8)以获取讨论）。使用最适合您需求的包。'
- en: The final portion of the R Markdown file prints a `ggplot2` graph of the results.
    The figure size is set to 5 inches wide and 4 inches tall. The default is 7 by
    5 inches.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: R Markdown文件的最后一部分打印出结果的`ggplot2`图形。图形大小设置为5英寸宽和4英寸高。默认为7英寸宽和5英寸高。
- en: Using RStudio to create and process R Markdown documents
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 使用RStudio创建和处理R Markdown文档
- en: RStudio makes it particularly easy to render reports from Markdown documents.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: RStudio使得从Markdown文档中渲染报告变得特别容易。
- en: If you choose File > New File > R Markdown from the GUI menu, you’ll see the
    dialog box shown next.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你从GUI菜单中选择文件 > 新建文件 > R Markdown，你会看到下面的对话框。
- en: '![](Images/CH21_F02_UN01_Kabacoff3.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH21_F02_UN01_Kabacoff3.png)'
- en: Dialog box for creating a new R Markdown document in RStudio
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在RStudio中创建新R Markdown文档的对话框
- en: Choose the type of report you want to generate, and RStudio will create a skeleton
    file for you. Edit it with your text and code, and then select the rendering option
    from the Knit drop-down list. That’s it!
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 选择您想要生成的报告类型，RStudio 将为您创建一个骨架文件。使用您的文本和代码编辑它，然后从 Knit 下拉列表中选择渲染选项。就是这样！
- en: '![](Images/CH21_F02_UN02_Kabacoff3.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH21_F02_UN02_Kabacoff3.png)'
- en: Drop-down menu for generating an HTML, PDF, or Word report from an R Markdown
    document
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 从 R Markdown 文档生成 HTML、PDF 或 Word 报告的下拉菜单
- en: Markdown syntax is convenient for creating simple documents quickly. To learn
    more about Markdown, select HELP > Markdown Quick Reference, or visit the Pandoc
    Markdown reference page ([http://mng.bz/0r8E](http://mng.bz/0r8E)).
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: Markdown 语法便于快速创建简单的文档。要了解更多关于 Markdown 的信息，请选择 HELP > Markdown 快速参考，或访问 Pandoc
    Markdown 参考页面 ([http://mng.bz/0r8E](http://mng.bz/0r8E))。
- en: If you want to create complex documents such as publication-quality articles
    and books, then you may want to look at using LaTeX as your markup language. In
    the next section, you’ll use LaTeX and the `knitr` package to create high-quality
    typeset documents.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想创建复杂的文档，如出版物质量的文章和书籍，那么您可能需要考虑使用 LaTeX 作为您的标记语言。在下一节中，您将使用 LaTeX 和 `knitr`
    包来创建高质量的排版文档。
- en: 21.3 Creating a report with R and LaTeX
  id: totrans-131
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 21.3 使用 R 和 LaTeX 创建报告
- en: LaTeX is a document-preparation system for high-quality typesetting that’s freely
    available for Windows, macOS, and Linux platforms. LaTeX allows you to create
    beautiful, complex, multipart documents, and it can convert from one type of document
    (such as an article) to another type of document (such as a report) by changing
    just a few lines of code. It’s extraordinarily powerful software and, as such,
    has a significant learning curve.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: LaTeX 是一个用于高质量排版的文档准备系统，它对 Windows、macOS 和 Linux 平台免费提供。LaTeX 允许您创建美观、复杂的多部分文档，并且只需更改几行代码，就可以将一种类型的文档（如文章）转换为另一种类型的文档（如报告）。这是一款功能极其强大的软件，因此具有相当大的学习曲线。
- en: 'If you’re unfamiliar with LaTeX, you may want to read “The Not So Short Introduction
    to LaTeX 2e” by Tobias Oetiker, Hubert Partl, Irene Hyna, and Elisabeth Schlegl
    ([https://tobi.oetiker.ch/lshort/lshort.pdf](https://tobi.oetiker.ch/lshort/lshort.pdf))
    or *LaTeX Tutorials: A Primer by the Indian TEX Users Group* ([http://mng.bz/2c0O](http://mng.bz/2c0O))
    before continuing. The language is definitely worth learning, but it will take
    some time and patience to master. Once you’re familiar with LaTeX, creating a
    dynamic report is a straightforward process.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您不熟悉 LaTeX，您可能想在继续之前阅读 Tobias Oetiker、Hubert Partl、Irene Hyna 和 Elisabeth
    Schlegl 所著的《LaTeX 2e 不那么简短的介绍》([https://tobi.oetiker.ch/lshort/lshort.pdf](https://tobi.oetiker.ch/lshort/lshort.pdf))
    或印度 TEX 用户组的《LaTeX 教程：入门》([http://mng.bz/2c0O](http://mng.bz/2c0O))。这门语言绝对值得学习，但要掌握它需要一些时间和耐心。一旦您熟悉了
    LaTeX，创建动态报告就是一个简单的过程。
- en: The `knitr` package allows you to embed R code within the LaTeX document using
    techniques that are analogous to the ones used previously for creating web pages.
    If you installed `rmarkdown` or are using RStudio, you already have `knitr`. If
    not, install it now (`install.packages("knitr")`). Additionally, you’ll need a
    LaTeX compiler; see section 21.2 for details.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '`knitr` 包允许您使用与之前创建网页类似的技术在 LaTeX 文档中嵌入 R 代码。如果您已安装 `rmarkdown` 或使用 RStudio，您已经拥有
    `knitr`。如果没有，现在安装它（`install.packages("knitr")`）。此外，您还需要一个 LaTeX 编译器；有关详细信息，请参阅第
    21.2 节。'
- en: In this section, you’ll create a report describing patients’ reactions to various
    drugs, using data from the `multcomp` package. If you didn’t install it in chapter
    9, be sure to run `install.packages("multcomp")` before continuing.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，您将创建一个报告，描述患者对各种药物的反应，使用 `multcomp` 包中的数据。如果您在第 9 章中没有安装它，请确保在继续之前运行 `install.packages("multcomp")`。
- en: To generate a report using R and LaTeX, you first create a text file with the
    file extension .Rnw containing the report text, LaTeX markup code, and R code
    chunks. Listing 21.2 gives an example. Each R code chunk starts with the delimiter
    `<<options>>=` and ends with the delimiter `@`. Table 21.3 lists the code chunk
    options. Inline R code is included using the `\Sexpr{R code}` syntax. When the
    R code is evaluated, the number or string is inserted at that point in the text.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 R 和 LaTeX 生成报告，您首先创建一个扩展名为 .Rnw 的文本文件，其中包含报告文本、LaTeX 标记代码和 R 代码块。列表 21.2
    提供了一个示例。每个 R 代码块以分隔符 `<<options>>=` 开始，以分隔符 `@` 结束。表 21.3 列出了代码块选项。使用 `\Sexpr{R
    code}` 语法包含内联 R 代码。当 R 代码被评估时，数字或字符串将被插入到文本中的该位置。
- en: 'The file is then processed by the `knit2pdf()` function:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 然后文件将由 `knit2pdf()` 函数进行处理：
- en: '[PRE10]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: or by pressing the Compile PDF button in RStudio. During this step, the R code
    chunks are processed and, depending on the options, replaced with LaTeX-formatted
    R code and output. By default, `knit("drugs.Rnw")` inputs the file drugs.Rnw and
    outputs the file drugs.tex. The .tex file is then run through a LaTeX compiler,
    creating a PDF file. Figure 21.3 displays the resulting PDF document.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 或者通过在 RStudio 中按编译 PDF 按钮。在此步骤中，R 代码块被处理，并且根据选项，用 LaTeX 格式的 R 代码和输出替换。默认情况下，`knit("drugs.Rnw")`
    输入文件 drugs.Rnw 并输出文件 drugs.tex。然后，.tex 文件通过 LaTeX 编译器运行，创建一个 PDF 文件。图 21.3 显示了生成的
    PDF 文档。
- en: 'Listing 21.2 drugs.Rnw: a LaTeX template with embedded R code'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 21.2 drugs.Rnw：一个嵌入 R 代码的 LaTeX 模板
- en: '[PRE11]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The `knitr` package is documented at [http://yihui.name/knitr](http://yihui.name/knitr)
    and in Yihui Xie’s book *Dynamic Documents with R and knitr* (Chapman & Hall,
    2013). To learn more about LaTeX, check out the tutorials mentioned earlier and
    visit [www.latex-project.org](https://www.latex-project.org/).
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '`knitr` 包在 [http://yihui.name/knitr](http://yihui.name/knitr) 和 Yihui Xie 的书籍
    *使用 R 和 knitr 创建动态文档*（Chapman & Hall，2013）中有文档说明。要了解更多关于 LaTeX 的信息，请查看前面提到的教程并访问
    [www.latex-project.org](https://www.latex-project.org/)。'
- en: 21.3.1 Creating a parameterized report
  id: totrans-143
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 21.3.1 创建参数化报告
- en: You can pass parameters to a report at run time, allowing you to customize the
    output without having to change the R Markdown template. Parameters are defined
    in the YAML header in a section denoted with the `params` keyword. You access
    the values of the parameters in the body of your code using `$` notation.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在运行时向报告传递参数，这样您就可以自定义输出，而无需更改 R Markdown 模板。参数在带有 `params` 关键字的 YAML 标题中的部分定义。您使用
    `$` 符号在代码的主体中访问参数值。
- en: '![](Images/CH21_F03_Kabacoff3.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH21_F03_Kabacoff3.png)'
- en: Figure 21.3 The text file drugs.Rnw is processed through the `knit2pdf()` function,
    resulting in a typeset PDF document (drugs.pdf).
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 图 21.3 文件 drugs.Rnw 通过 `knit2pdf()` 函数处理，生成排版的 PDF 文档（drugs.pdf）。
- en: Consider the parameterized report in the following listing. This R Markdown
    document downloads stock prices for four large tech stocks (Apple, Amazon, Google,
    and Microsoft) from Yahoo Finance ([https://finance.yahoo.com/](https://finance.yahoo.com/))
    and plots them using `ggplot2` (see figure 21.4).
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下列表中的参数化报告。此 R Markdown 文档从雅虎财经 ([https://finance.yahoo.com/](https://finance.yahoo.com/))
    下载四家大型科技股（苹果、亚马逊、谷歌和微软）的股票价格，并使用 `ggplot2` 进行绘图（见图 21.4）。
- en: '![](Images/CH21_F04_Kabacoff3.png)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH21_F04_Kabacoff3.png)'
- en: Figure 21.4 Dynamic report produced from the parameterized R Markdown file in
    listing 21.3
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 图 21.4 从列表 21.3 中的参数化 R Markdown 文件生成的动态报告
- en: By default, the code reports stock performance for the past 30 days from the
    time the file is knitted. The report uses the `tidyquant` package to obtain stock
    prices, so install it before knitting the document (`install.packages("tidyquant")`).
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，代码报告了从文件编织时间起过去 30 天的股票表现。报告使用 `tidyquant` 包获取股票价格，因此在编织文档之前安装它 (`install.packages("tidyquant")`)。
- en: Listing 21.3 R Markdown report with parameters (techstocks.Rmd)
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 21.3 带参数的 R Markdown 报告（techstocks.Rmd）
- en: '[PRE12]{r, echo=FALSE, message=FALSE}'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE12]{r, echo=FALSE, message=FALSE}'
- en: library(tidyquant)
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: library(tidyquant)
- en: library(ggplot2)
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: library(ggplot2)
- en: tickers = c("AAPL", "MSFT", "AMZN", "GOOG")
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: tickers = c("AAPL", "MSFT", "AMZN", "GOOG")
- en: prices <- tq_get(tickers,                    ❷
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: prices <- tq_get(tickers,                    ❷
- en: from = params$startdate,    ❷
  id: totrans-157
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: from = params$startdate,    ❷
- en: to = params$enddate,        ❷
  id: totrans-158
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: to = params$enddate,        ❷
- en: get = "stock.prices")       ❷
  id: totrans-159
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: get = "stock.prices")       ❷
- en: ggplot(prices, aes(x=date, y=adjusted, color=symbol)) +
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: ggplot(prices, aes(x=date, y=adjusted, color=symbol)) +
- en: geom_line(size=1) + facet_wrap(~symbol, scale="free") +
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: geom_line(size=1) + facet_wrap(~symbol, scale="free") +
- en: theme_bw() +
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: theme_bw() +
- en: theme(legend.position="none") +
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: theme(legend.position="none") +
- en: scale_x_date(date_labels="%m-%d") +
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: scale_x_date(date_labels="%m-%d") +
- en: scale_color_brewer(palette="Set1") +
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: scale_color_brewer(palette="Set1") +
- en: labs(title="Stock Price Chart",
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: labs(title="股票价格图表",
- en: subtitle = paste(params$startdate, "to", params$enddate),
  id: totrans-167
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: subtitle = paste(params$startdate, "至", params$enddate),
- en: x = "Date",
  id: totrans-168
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: x = "日期",
- en: y="Adjusted Price")
  id: totrans-169
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: y="调整价格")
- en: '[PRE13]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: ❶ Defines parameter values
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 定义参数值
- en: ❷ Obtains stock quotes using parameter values
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 使用参数值获取股票报价
- en: The parameters `enddate` and `startdate` are defined in the YAML header ❶. You
    can hardcode these values, or use `!r` to include R code that evaluates to the
    desired values. Here, `enddate` is set to the current date and `startdate` is
    set to 30 days prior.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 `enddate` 和 `startdate` 在 YAML 标题中定义 ❶。您可以硬编码这些值，或者使用 `!r` 包含评估为所需值的 R 代码。在此，`enddate`
    设置为当前日期，`startdate` 设置为 30 天前。
- en: When the code is run, the `tq_get()` function in the `tidyquant` package downloads
    the daily stock prices (symbol, date, open, high, low, close, volume, adjusted)
    for the date range defined by `params$startdate` and `params$enddate` ❷. The values
    are then plotted with `ggplot2`.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 当代码运行时，`tidyquant` 包中的 `tq_get()` 函数会下载由 `params$startdate` 和 `params$enddate`
    定义的日期范围内的每日股票价格（符号、日期、开盘价、最高价、最低价、收盘价、成交量、调整后价格）❷。然后使用 `ggplot2` 进行绘图。
- en: You can override the parameter values at run time by providing a list of values
    to the `render` function. For example,
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过向 `render` 函数提供一个值列表来在运行时覆盖参数值。例如，
- en: '[PRE14]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'would plot the daily stock performance for January 2019\. Alternatively, if
    you run `render("techstocks.Rmd",` `params="ask")`(or click Knit > Knit with parameters...
    in RStudio), you will be prompted for the `startdate` and `enddate` values. The
    values you provide will override the defaults. Including parameter values give
    your reports an added degree of interactivity. To learn more, see section 15.3
    of Yihui Xie, J.J Allaire, and Garret Grolemund’s book *R Markdown: The Definitive
    Guide* (Chapman & Hall, 2019). An online version is available at [https://bookdown.org/yihui/rmarkdown/](https://bookdown.org/yihui/rmarkdown/).'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '将绘制 2019 年 1 月的每日股票表现。或者，如果你运行 `render("techstocks.Rmd",` `params="ask")`(或者在
    RStudio 中点击 Knit > Knit with parameters...)，你将被提示输入 `startdate` 和 `enddate` 的值。你提供的值将覆盖默认值。包括参数值给你的报告增加了额外的交互性。要了解更多信息，请参阅
    Yihui Xie、J.J Allaire 和 Garret Grolemund 的书籍 *R Markdown: The Definitive Guide*（Chapman
    & Hall，2019）的第 15.3 节。在线版本可在 [https://bookdown.org/yihui/rmarkdown/](https://bookdown.org/yihui/rmarkdown/)
    找到。'
- en: 21.4 Avoiding common R Markdown problems
  id: totrans-178
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 21.4 避免常见的 R Markdown 问题
- en: R Markdown is a powerful vehicle for creating dynamic and attractive reports
    in R. But there are a few simple, common errors to avoid (table 21.4).
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: R Markdown 是在 R 中创建动态和吸引人的报告的强大工具。但有一些简单的常见错误需要避免（见表 21.4）。
- en: Table 21.4 Correcting common R Markdown errors
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 表 21.4 修正常见的 R Markdown 错误
- en: '| Rule | Correct | Incorrect |'
  id: totrans-181
  prefs: []
  type: TYPE_TB
  zh: '| 规则 | 正确 | 错误 |'
- en: '| The indentation in YAML headers matters. Only indent subfields. | `---``title:
    "Tech Stock Monthly Report"``author: "IT Department"``output: html_document``params:``enddate:
    2019-01-31``startdate: 2019-01-01``---` | `---``title: "Tech Stock Monthly Report"``author:
    "IT Department"``output: html_document``params:``enddate: 2019-01-31``startdate:
    2019-01-01``---` |'
  id: totrans-182
  prefs: []
  type: TYPE_TB
  zh: '| YAML 标题中的缩进很重要。只有缩进子字段。 | `---``title: "Tech Stock Monthly Report"``author:
    "IT Department"``output: html_document``params:``enddate: 2019-01-31``startdate:
    2019-01-01``---` | `---``title: "Tech Stock Monthly Report"``author: "IT Department"``output:
    html_document``params:``enddate: 2019-01-31``startdate: 2019-01-01``---` |'
- en: '| Place a space after heading tags. | # This is a level one heading. | #This
    is a level one heading. |'
  id: totrans-183
  prefs: []
  type: TYPE_TB
  zh: '| 在标题标记后放置一个空格。 | # 这是一个一级标题。 | #This is a level one heading. |'
- en: '| Lists should be preceded and followed by a blank line, and the asterisk tag
    should have a space after it.Optionally, R code chunks can be labeled, but each
    label must be unique. | `Here is a list`* `item one`* `item two[PRE15][PRE16]{r
    anova2} [PRE17] [PRE18]` | `Here is a list`*`item one`*`item two[PRE19][PRE20]{r
    anova} [PRE21] [PRE22]` |'
  id: totrans-184
  prefs: []
  type: TYPE_TB
  zh: '| 列表应该由空行开头和结尾，并且星号标记后应该有一个空格。可选地，R 代码块可以标记，但每个标记必须是唯一的。 | `Here is a list`*
    `item one`* `item two[PRE15][PRE16]{r anova2} [PRE17] [PRE18]` | `Here is a list`*`item
    one`*`item two[PRE19][PRE20]{r anova} [PRE21] [PRE22]` |'
- en: '| You can’t install packages in R code chunks. | Install `ggplot2` outside
    of the R Markdown document. Then use[PRE23]`library(ggplot2)[PRE24]install.packages(ggplot2)``library(ggplot2)[PRE25]
    |'
  id: totrans-185
  prefs: []
  type: TYPE_TB
  zh: '| 你不能在 R 代码块中安装包。 | 在 R Markdown 文档外部安装 `ggplot2`。然后使用[PRE23]`library(ggplot2)[PRE24]install.packages(ggplot2)``library(ggplot2)[PRE25]
    |'
- en: Errors that occur when rendering R Markdown documents can be more difficult
    to debug than errors in simple R code. If you make sure that each R code chunk
    runs on its own, and you are careful to avoid the errors listed above, things
    should go more smoothly.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 在渲染 R Markdown 文档时发生的错误可能比简单 R 代码中的错误更难调试。如果你确保每个 R 代码块独立运行，并且你小心避免上述列出的错误，事情应该会进行得更顺利。
- en: There is one more topic to mention before moving on. This is more about an inefficiency
    than an actual error. Let’s say that you create an R Markdown document that has
    introductory text and an R code chunk that performs time-consuming analyses. If
    you edit your text and reknit the document, you will end up rerunning the R code,
    even though the results haven’t changed.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续之前，还有另一个话题要提一下。这更多的是关于低效而不是真正的错误。假设你创建了一个 R Markdown 文档，其中包含介绍性文本和一个执行耗时分析的
    R 代码块。如果你编辑文本并重新编译文档，即使结果没有变化，你也会重新运行 R 代码。
- en: To avoid this, you can cache the results of your R code chunks. Adding the R
    code chunk `option` `cache` `=` `TRUE` will save the results to a folder, and
    the code will only be rerun in the future if the R code itself has changed. If
    the code has not changed, the saved results will be inserted. Be careful here—caching
    will not catch changes in the underlying data, just in the code itself. If you
    change the data but not the data filename, the code will not be rerun. In this
    case, you could add the chunk option `cache.extra` `=` `file.mtime(``mydatafile``)`,
    where `mydatafile` is the path to the dataset. If the data file timestamp has
    changed, the code chunk will be rerun.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免这种情况，你可以缓存 R 代码块的结果。添加 R 代码块的 `option` `cache` `=` `TRUE` 将结果保存到文件夹中，并且只有在
    R 代码本身发生变化时，代码才会在未来重新运行。如果代码没有变化，将插入保存的结果。请注意这里——缓存不会捕捉到基础数据的变化，只会捕捉到代码本身的变化。如果你更改了数据但未更改数据文件名，代码将不会重新运行。在这种情况下，你可以添加代码块的选项
    `cache.extra` `=` `file.mtime(``mydatafile``)`，其中 `mydatafile` 是数据集的路径。如果数据文件的时间戳已更改，代码块将重新运行。
- en: 21.5 Going further
  id: totrans-189
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 21.5 进一步探索
- en: In this chapter, you’ve seen several ways that R results can be incorporated
    into reports. The reports are dynamic in the sense that changing the data and
    reprocessing the code results in an updated report. Additionally, the report can
    be modified by passing parameters. You learned methods for creating web pages,
    typeset documents, Open Document Format reports, and Microsoft Word documents.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你已经看到了几种将 R 结果纳入报告的方法。报告是动态的，因为更改数据和重新处理代码会导致报告更新。此外，可以通过传递参数来修改报告。你学习了创建网页、排版文档、Open
    Document Format 报告和 Microsoft Word 文档的方法。
- en: There are several advantages to the template approach described in this chapter.
    By embedding the code needed to perform statistical analyses directly into the
    report template, you can see exactly how the results were calculated. Six months
    from now, you can easily see what was done. You can also modify the statistical
    analyses or add new data and immediately regenerate the report with minimum effort.
    Additionally, you avoid the need to cut and paste and reformat the results. This
    in itself is worth the price of admission.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中描述的模板方法有几个优点。通过将执行统计分析所需的代码直接嵌入到报告模板中，你可以确切地看到结果是如何计算的。六个月之后，你可以轻松地看到当时做了什么。你还可以修改统计分析或添加新数据，并立即以最小的努力重新生成报告。此外，你避免了剪切和粘贴以及重新格式化结果的需要。这本身就是值得的。
- en: The templates in this chapter are static in the sense that their structure is
    fixed. Although not covered here, you can also use these methods to create a variety
    of expert reporting systems. For example, the output of an R code chunk can depend
    on the data submitted. If numeric variables are submitted, a scatterplot matrix
    can be produced. Alternatively, if categorical variables are submitted, a mosaic
    plot can be produced. In a similar fashion, the explanatory text that is generated
    can depend on the results of the analyses. Using R’s `if/then` construct and text
    editing functions such as `grep` and `substr` makes the possibilities for customization
    endless. Basically, you write out the template to a temporary location and edit
    it via code before knitting. You can use this approach to create a sophisticated
    expert system.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中提到的模板在意义上是静态的，即它们的结构是固定的。尽管这里没有涉及，你也可以使用这些方法来创建各种专家报告系统。例如，R 代码块的结果可以依赖于提交的数据。如果提交了数值变量，可以生成散点图矩阵。或者，如果提交了分类变量，可以生成马赛克图。以类似的方式，生成的解释性文本可以依赖于分析的结果。使用
    R 的 `if/then` 构造和文本编辑函数，如 `grep` 和 `substr`，可以创造出无穷无尽的可定制性。基本上，你将模板写入临时位置，并在编织之前通过代码进行编辑。你可以使用这种方法创建一个复杂的专家系统。
- en: 'To learn more about R Markdown, see Yihui Xie, Christophe Dervieux, and Emily
    Riederer’s *R Markdown Cookbook* ([https://bookdown.org/yihui/rmarkdown-cook book/](https://bookdown.org/yihui/rmarkdown-cookbook/)),
    Yihui Xie, J.J Allaire, and Garret Grolemund’s *R Markdown: The Definitive Guide*
    [(https://bookdown.org/yihui/rmarkdown/](https://bookdown.org/yihui/rmarkdown/)),
    and RStudio’s *R Markdown* website ([https://rmarkdown.rstudio.com/](https://rmarkdown.rstudio.com/)).'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: '要了解更多关于 R Markdown 的信息，请参阅 Yihui Xie、Christophe Dervieux 和 Emily Riederer 编著的
    *R Markdown 烹饪书* ([https://bookdown.org/yihui/rmarkdown-cookbook/](https://bookdown.org/yihui/rmarkdown-cookbook/))，Yihui
    Xie、J.J Allaire 和 Garret Grolemund 编著的 *R Markdown: The Definitive Guide* ([https://bookdown.org/yihui/rmarkdown/](https://bookdown.org/yihui/rmarkdown/))，以及
    RStudio 的 *R Markdown* 网站 ([https://rmarkdown.rstudio.com/](https://rmarkdown.rstudio.com/))。'
- en: Summary
  id: totrans-194
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: R Markdown can be used to create attractive reports that combine text, code,
    and output.
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R Markdown 可以用来创建结合文本、代码和输出的吸引人的报告。
- en: Reports can be output in HTML, Word, Open Document, RTF, and PDF formats.
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 报告可以输出为 HTML、Word、Open Document、RTF 和 PDF 格式。
- en: R Markdown documents can be parameterized, allowing you to pass parameters to
    the code at run time and thus create more dynamic reports.
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R Markdown 文档可以进行参数化，允许你在运行时传递参数给代码，从而创建更动态的报告。
- en: LaTeX markup language can be used to produce complex reports that are highly
    customized. The learning curve can be steep.
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以使用 LaTeX 标记语言来生成高度定制的复杂报告。学习曲线可能很陡峭。
- en: The R Markdown (and LaTeX) template approach can be used promote research reproducibility,
    support documentation, and enhance the communication of results.
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R Markdown（以及 LaTeX）模板方法可以用来促进研究可重复性、支持文档编写并增强结果沟通。
