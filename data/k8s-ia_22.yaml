- en: Appendix B. Setting up a multi-node cluster with kubeadm
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: 附录B. 使用kubeadm设置多节点集群
- en: This appendix shows how to install a Kubernetes cluster with multiple nodes.
    You’ll run the nodes inside virtual machines through VirtualBox, but you can also
    use a different virtualization tool or bare-metal machines. To set up both the
    master and the worker nodes, you’ll use the `kubeadm` tool.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本附录展示了如何使用多个节点安装Kubernetes集群。您将通过VirtualBox在虚拟机中运行节点，但也可以使用不同的虚拟化工具或裸机。为了设置主节点和工作节点，您将使用`kubeadm`工具。
- en: B.1\. Setting up the OS and required packages
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: B.1\. 设置操作系统和所需软件包
- en: First, you need to download and install VirtualBox, if you don’t have it installed
    already. You can download it from [https://www.virtualbox.org/wiki/Downloads](https://www.virtualbox.org/wiki/Downloads).
    Once you have it running, download the CentOS 7 minimal ISO image from [www.centos.org/download](http://www.centos.org/download).
    You can also use a different Linux distribution, but make sure it’s supported
    by checking the [http://kubernetes.io](http://kubernetes.io) website.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，如果您还没有安装，需要下载并安装VirtualBox。您可以从[https://www.virtualbox.org/wiki/Downloads](https://www.virtualbox.org/wiki/Downloads)下载。启动后，从[www.centos.org/download](http://www.centos.org/download)下载CentOS
    7最小化ISO镜像。您也可以使用不同的Linux发行版，但请确保它由[kubernetes.io](http://kubernetes.io)网站支持。
- en: B.1.1\. Creating the virtual machine
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: B.1.1\. 创建虚拟机
- en: Next, you’ll create the VM for your Kubernetes master. Start by clicking the
    New icon in the upper-left corner. Then enter “k8s-master” as the name, and select
    Linux as the Type and Red Hat (64-bit) as the version, as shown in [figure B.1](#filepos1739011).
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，您将创建Kubernetes主节点的虚拟机。首先，点击左上角的“新建”图标。然后输入“k8s-master”作为名称，选择Linux作为类型，选择Red
    Hat（64位）作为版本，如图[B.1](#filepos1739011)所示。
- en: Figure B.1\. Creating a Virtual Machine in VirtualBox
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 图B.1\. 在VirtualBox中创建虚拟机
- en: '![](images/00088.jpg)'
  id: totrans-7
  prefs: []
  type: TYPE_IMG
  zh: '![图片](images/00088.jpg)'
- en: 'After clicking the Next button, you can set the VM’s memory size and set up
    the hard disk. If you have enough memory, select at least 2GB (keep in mind you’ll
    run three such VMs). When creating the hard disk, leave the default options selected.
    Here’s what they were in my case:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 点击下一步按钮后，您可以设置虚拟机的内存大小并设置硬盘。如果您有足够的内存，至少选择2GB（请注意，您将运行三个这样的虚拟机）。在创建硬盘时，保留默认选项。以下是我案例中的选项：
- en: 'Hard disk file type: VDI (VirtualBox Disk Image)'
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 硬盘文件类型：VDI（VirtualBox磁盘镜像）
- en: 'Storage on physical hard disk: Dynamically allocated'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 物理硬盘上的存储：动态分配
- en: 'File location and size: k8s-master, size 8GB'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文件位置和大小：k8s-master，大小8GB
- en: B.1.2\. Configuring the network adapter for the VM
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: B.1.2\. 配置虚拟机的网络适配器
- en: Once you’re done creating the VM, you need to configure its network adapter,
    because the default won’t allow you to run multiple nodes properly. You’ll configure
    the adapter so it uses the Bridged Adapter mode. This will connect your VMs to
    the same network your host computer is in. Each VM will get its own IP address,
    the same way as if it were a physical machine connected to the same switch your
    host computer is connected to. Other options are much more complicated, because
    they usually require two network adapters to be set up.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 创建完虚拟机后，您需要配置其网络适配器，因为默认设置不会允许您正确运行多个节点。您将配置适配器使其使用桥接适配器模式。这将使您的虚拟机连接到与您的宿主机相同的网络。每个虚拟机将获得自己的IP地址，就像它是一个连接到与宿主机相同交换机的物理机器一样。其他选项要复杂得多，因为它们通常需要设置两个网络适配器。
- en: To configure the network adapter, make sure the VM is selected in the main Virtual-Box
    window and then click the Settings icon (next to the New icon you clicked before).
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置网络适配器，请确保在VirtualBox主窗口中选择虚拟机，然后点击设置图标（在您之前点击的新图标旁边）。
- en: 'A window like the one shown in [figure B.2](#filepos1741119) will appear. On
    the left-hand side, select Network and then, in the main panel on the right, select
    Attached to: Bridged Adapter, as shown in the figure. In the Name drop-down menu,
    select your host machine’s adapter, which you use to connect your machine to the
    network.'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 将出现一个类似于[图B.2](#filepos1741119)的窗口。在左侧，选择网络，然后在右侧的主面板中，选择附加到：桥接适配器，如图所示。在名称下拉菜单中，选择您用于连接机器到网络的宿主机适配器。
- en: Figure B.2\. Configuring the network adapter for the VM
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 图B.2\. 配置虚拟机的网络适配器
- en: '![](images/00106.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![图片](images/00106.jpg)'
- en: B.1.3\. Installing the operating system
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: B.1.3\. 安装操作系统
- en: You’re now ready to run the VM and install the operating system. Ensure the
    VM is still selected in the list and click on the Start icon at the top of the
    VirtualBox main window.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在可以运行虚拟机并安装操作系统了。确保虚拟机仍在列表中选中，然后在 VirtualBox 主窗口的顶部点击“开始”图标。
- en: Selecting the start-up disk
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 选择启动磁盘
- en: Before the VM starts up, VirtualBox will ask you what start-up disk to use.
    Click the icon next to the drop-down list (shown in [figure B.3](#filepos1742035))
    and then find and select the CentOS ISO image you downloaded earlier. Then click
    Start to boot up the VM.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在虚拟机启动之前，VirtualBox 将询问您要使用哪个启动磁盘。点击下拉列表旁边的图标（如图 B.3 所示），然后找到并选择您之前下载的 CentOS
    ISO 映像。然后点击“开始”以启动虚拟机。
- en: Figure B.3\. Selecting the installation ISO image
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 图 B.3\. 选择安装 ISO 映像
- en: '![](images/00126.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![](images/00126.jpg)'
- en: Initiating the install
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 启动安装
- en: When the VM starts up, a textual menu screen will appear. Use the cursor up
    key to select the Install CentOS Linux 7 option and press the Enter button.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 当虚拟机启动时，将出现一个文本菜单屏幕。使用光标向上键选择“安装 CentOS Linux 7”选项，然后按 Enter 键。
- en: Setting installation options
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 设置安装选项
- en: After a few moments, a graphical Welcome to CentOS Linux 7 screen will appear,
    allowing you to select the language you wish to use. I suggest you keep the language
    set to English. Click the Continue button to get to the main setup screen as shown
    in [figure B.4](#filepos1742932).
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 几分钟后，将出现一个图形化的“欢迎使用 CentOS Linux 7”屏幕，允许您选择要使用的语言。我建议您保持语言设置为英语。点击“继续”按钮进入如图
    B.4 所示的主设置屏幕。
- en: Figure B.4\. The main setup screen
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 图 B.4\. 主设置屏幕
- en: '![](images/00143.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![](images/00143.jpg)'
- en: '|  |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Tip
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 小贴士
- en: When you click into the VM’s window, your keyboard and mouse will be captured
    by the VM. To release them, press the key shown at the bottom-right corner of
    the VirtualBox window the VM is running in. This is usually the Right Control
    key on Windows and Linux or the left Command key on MacOS.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 当您点击进入虚拟机的窗口时，您的键盘和鼠标将被虚拟机捕获。要释放它们，请按虚拟机运行的 VirtualBox 窗口右下角显示的键。这通常是 Windows
    和 Linux 上的右控制键或 MacOS 上的左 Command 键。
- en: '|  |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: First, click Installation Destination and then immediately click the Done button
    on the screen that appears (you don’t need to click anywhere else).
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，点击“安装位置”，然后立即点击出现的屏幕上的“完成”按钮（您不需要点击其他任何地方）。
- en: Then click on Network & Host Name. On the next screen, first enable the network
    adapter by clicking the ON/OFF switch in the top right corner. Then enter the
    host name into the field at the bottom left, as shown in [figure B.5](#filepos1744324).
    You’re currently setting up the master, so set the host name to master.k8s. Click
    the Apply button next to the text field to confirm the new host name.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 然后点击“网络与主机名”。在下一屏幕上，首先通过点击右上角的开关启用网络适配器。然后输入左下角的字段中的主机名，如图 B.5 所示。您目前正在设置主节点，因此将主机名设置为
    master.k8s。点击文本字段旁边的“应用”按钮以确认新的主机名。
- en: Figure B.5\. Setting the hostname and configuring the network adapter
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 图 B.5\. 设置主机名和配置网络适配器
- en: '![](images/00161.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![](images/00161.jpg)'
- en: To return to the main setup screen, click the Done button in the top-left corner.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 要返回主设置屏幕，点击左上角的“完成”按钮。
- en: You also need to set the correct time zone. Click Date & Time and then, on the
    screen that opens, select the Region and City or click your location on the map.
    Return to the main screen by clicking the Done button in the top-left corner.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 您还需要设置正确的时间区域。点击“日期和时间”，然后在打开的屏幕上选择区域和城市或点击地图上的您的位置。通过点击左上角的“完成”按钮返回主屏幕。
- en: Running the install
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 运行安装
- en: To start the installation, click the Begin Installation button in the bottom-right
    corner. A screen like the one in [figure B.6](#filepos1745409) will appear. While
    the OS is being installed, set the root password and create a user account, if
    you want. When the installation completes, click the Reboot button at the bottom
    right.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始安装，点击右下角的“开始安装”按钮。将出现如图 B.6 所示的屏幕。在安装操作系统时，设置 root 密码，如果您想的话，还可以创建用户账户。安装完成后，点击右下角的“重启”按钮。
- en: Figure B.6\. Setting the root password while the OS is being installed and rebooting
    afterward
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 图 B.6\. 在安装操作系统并重启后设置 root 密码
- en: '![](images/00179.jpg)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](images/00179.jpg)'
- en: B.1.4\. Installing Docker and Kubernetes
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: B.1.4\. 安装 Docker 和 Kubernetes
- en: 'Log into the machine as root. First, you need to disable two security features:
    SELinux and the firewall.'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 以 root 身份登录机器。首先，您需要禁用两个安全功能：SELinux 和防火墙。
- en: Disabling SELinux
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 禁用 SELinux
- en: 'To disable SELinux, run the following command:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 要禁用SELinux，运行以下命令：
- en: '`# setenforce 0`'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '`# setenforce 0`'
- en: But this only disables it temporarily (until the next reboot). To disable it
    permanently, edit the /etc/selinux/config file and change the `SELINUX=enforcing`
    line to `SELINUX=permissive`.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 但这只会临时禁用（直到下一次重启）。要永久禁用，编辑`/etc/selinux/config`文件，将`SELINUX=enforcing`行更改为`SELINUX=permissive`。
- en: Disabling the firewall
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 禁用防火墙
- en: 'You’ll also disable the firewall, so you don’t run into any firewall-related
    problems. Run the following command:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 你还将禁用防火墙，以免遇到任何与防火墙相关的问题。运行以下命令：
- en: '`# systemctl disable firewalld && systemctl stop firewalld` `Removed symlink
    /etc/systemd/system/dbus-org.fedoraproject.FirewallD1... Removed symlink /etc/systemd/system/basic.target.wants/firewalld.service.`'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '`# systemctl disable firewalld && systemctl stop firewalld` `Removed symlink
    /etc/systemd/system/dbus-org.fedoraproject.FirewallD1... Removed symlink /etc/systemd/system/basic.target.wants/firewalld.service.`'
- en: Adding the Kubernetes yum repo
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 添加Kubernetes yum仓库
- en: To make the Kubernetes RPM packages available to the yum package manager, you’ll
    add a kubernetes.repo file to the /etc/yum.repos.d/ directory as shown in the
    following listing.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 要使Kubernetes RPM包对yum包管理器可用，你需要在`/etc/yum.repos.d/`目录中添加一个kubernetes.repo文件，如下所示。
- en: Listing B.1\. Adding the Kubernetes RPM repo
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 列表B.1\. 添加Kubernetes RPM仓库
- en: '`# cat <<EOF > /etc/yum.repos.d/kubernetes.repo` `[kubernetes] name=Kubernetes
    baseurl=http://yum.kubernetes.io/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=1
    repo_gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg        
    https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg EOF`'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '`# cat <<EOF > /etc/yum.repos.d/kubernetes.repo` `[kubernetes] name=Kubernetes
    baseurl=http://yum.kubernetes.io/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=1
    repo_gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg        
    https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg EOF`'
- en: '|  |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Make sure no whitespace exists after EOF if you’re copying and pasting.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在复制粘贴，请确保EOF后没有空格。
- en: '|  |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Installing Docker, Kubelet, kubeadm, kubectl, and Kubernetes-CNI
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 安装Docker、Kubelet、kubeadm、kubectl和Kubernetes-CNI
- en: 'Now you’re ready to install all the packages you need:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经准备好安装所有需要的包了：
- en: '`# yum install -y docker kubelet kubeadm kubectl kubernetes-cni`'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '`# yum install -y docker kubelet kubeadm kubectl kubernetes-cni`'
- en: 'As you can see, you’re installing quite a few packages. Here’s what they are:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，你正在安装相当多的包。以下是它们的内容：
- en: '`docker`—The container runtime'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`docker`——容器运行时'
- en: '`kubelet`—The Kubernetes node agent, which will run everything for you'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`kubelet`——Kubernetes节点代理，将为你运行一切'
- en: '`kubeadm`—A tool for deploying multi-node Kubernetes clusters'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`kubeadm`——用于部署多节点Kubernetes集群的工具'
- en: '`kubectl`—The command line tool for interacting with Kubernetes'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`kubectl`——与Kubernetes交互的命令行工具'
- en: '`kubernetes-cni`—The Kubernetes Container Networking Interface'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`kubernetes-cni`——Kubernetes容器网络接口'
- en: 'Once they’re all installed, you need to manually enable the `docker` and the
    `kubelet` services:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦安装完成，你需要手动启用`docker`和`kubelet`服务：
- en: '`# systemctl enable docker && systemctl start docker``# systemctl enable kubelet
    && systemctl start kubelet`'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '`# systemctl enable docker && systemctl start docker``# systemctl enable kubelet
    && systemctl start kubelet`'
- en: Enabling the net.bridge.bridge-nf-call-iptables kernel option
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 启用net.bridge.bridge-nf-call-iptables内核选项
- en: 'I’ve noticed that something disables the `bridge-nf-call-iptables` kernel parameter,
    which is required for Kubernetes services to operate properly. To rectify the
    problem, you need to run the following two commands:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我注意到有某个东西禁用了`bridge-nf-call-iptables`内核参数，这是Kubernetes服务正常运行所必需的。为了解决这个问题，你需要运行以下两个命令：
- en: '`# sysctl -w net.bridge.bridge-nf-call-iptables=1``# echo "net.bridge.bridge-nf-call-iptables=1"
    > /etc/sysctl.d/k8s.conf`'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '`# sysctl -w net.bridge.bridge-nf-call-iptables=1``# echo "net.bridge.bridge-nf-call-iptables=1"
    > /etc/sysctl.d/k8s.conf`'
- en: Disabling swap
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 禁用交换
- en: 'The Kubelet won’t run if swap is enabled, so you’ll disable it with the following
    command:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 如果启用了交换，Kubelet将不会运行，所以你需要使用以下命令来禁用它：
- en: '`# swapoff -a &&  sed -i ''/ swap / s/^/#/'' /etc/fstab`'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '`# swapoff -a &&  sed -i ''/ swap / s/^/#/'' /etc/fstab`'
- en: B.1.5\. Cloning the VM
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: B.1.5\. 克隆虚拟机
- en: Everything you’ve done up to this point must be done on every machine you plan
    to use in your cluster. If you’re doing this on bare metal, you need to repeat
    the process described in the previous section at least two more times—for each
    worker node. If you’re building the cluster using virtual machines, now’s the
    time to clone the VM, so you end up with three different VMs.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止你做的所有事情都必须在计划用于你的集群的每台机器上执行。如果你是在裸机上执行此操作，你需要至少重复前一个章节中描述的过程两次——对于每个工作节点。如果你正在使用虚拟机构建集群，现在是克隆虚拟机的时候了，这样你最终会有三个不同的虚拟机。
- en: Shutting down the VM
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 关闭虚拟机
- en: 'To clone the machine in VirtualBox, first shut down the VM by running the shutdown
    command:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 要在VirtualBox中克隆机器，首先通过运行shutdown命令关闭虚拟机：
- en: '`# shutdown now`'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '`# shutdown now`'
- en: Cloning the VM
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 克隆虚拟机
- en: Now, right-click on the VM in the VirtualBox UI and select Clone. Enter the
    name for the new machine as shown in [figure B.7](#filepos1751624) (for example,
    k8s-node1 for the first clone or k8s-node2 for the second one). Make sure you
    check the Reinitialize the MAC address of all network cards option, so each VM
    uses different MAC addresses (because they’re going to be located in the same
    network).
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在VirtualBox UI中右键单击虚拟机并选择克隆。输入新机器的名称，如[图B.7](#filepos1751624)所示（例如，第一个克隆为k8s-node1或第二个克隆为k8s-node2）。确保您选中了“重新初始化所有网络卡的MAC地址”选项，以便每个虚拟机使用不同的MAC地址（因为它们将位于同一网络中）。
- en: Figure B.7\. Cloning the master VM
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图B.7\. 克隆主虚拟机
- en: '![](images/00197.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![](images/00197.jpg)'
- en: Click the Next button and then make sure the Full clone option is selected before
    clicking Next again. Then, on the next screen, click Clone (leave the Current
    machine state option selected).
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 点击“下一步”按钮，然后确保在再次点击“下一步”之前选中了“完整克隆”选项。然后，在下一屏幕上，点击“克隆”（保留“当前机器状态”选项选中）。
- en: Repeat the process for the VM for the second node and then start all three VMs
    by selecting all three and clicking the Start icon.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 对第二个节点的虚拟机重复此过程，然后通过选择所有三个并点击“启动”图标来启动所有三个虚拟机。
- en: Changing the hostname on the cloned VMs
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 在克隆的虚拟机上更改主机名
- en: 'Because you created two clones from your master VM, all three VMs have the
    same hostname configured. Therefore, you need to change the hostnames of the two
    clones. To do that, log into each of the two nodes (as root) and run the following
    command:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 由于您从主虚拟机创建了两个克隆，因此所有三个虚拟机都配置了相同的主机名。因此，您需要更改两个克隆的主机名。为此，以root身份登录到两个节点中的每一个（作为root）并运行以下命令：
- en: '`# hostnamectl --static set-hostname node1.k8s`'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '`# hostnamectl --static set-hostname node1.k8s`'
- en: '|  |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Be sure to set the hostname to `node2.k8s` on the second node.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 确保在第二个节点上将主机名设置为 `node2.k8s`。
- en: '|  |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Configuring name resolution for all three hosts
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 配置所有三个主机的名称解析
- en: You need to ensure that all three nodes are resolvable either by adding records
    to a DNS server or by editing the /etc/hosts file on all of them. For example,
    you need to add the following three lines to the hosts file (replace the IPs with
    those of your VMs), as shown in the following listing.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要确保所有三个节点都可以解析，无论是通过向DNS服务器添加记录还是通过编辑所有节点的 `/etc/hosts` 文件来实现。例如，您需要将以下三行添加到hosts文件中（用您虚拟机的IP地址替换），如下所示。
- en: Listing B.2\. Entries to add to /etc/hosts on each cluster node
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 列表B.2\. 需要添加到每个集群节点 `/etc/hosts` 中的条目
- en: '`192.168.64.138 master.k8s 192.168.64.139 node1.k8s 192.168.64.140 node2.k8s`'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '`192.168.64.138 master.k8s 192.168.64.139 node1.k8s 192.168.64.140 node2.k8s`'
- en: You can get each node’s IP by logging into the node as root, running `ip addr`
    and finding the IP address associated with the `enp0s3` network adapter, as shown
    in the following listing.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过以root身份登录到节点，运行 `ip addr` 并找到与 `enp0s3` 网络适配器关联的IP地址来获取每个节点的IP，如下所示。
- en: Listing B.3\. Looking up each node’s IP address
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 列表B.3\. 查找每个节点的IP地址
- en: '`# ip addr` `1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN
    qlen 1     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00     inet 127.0.0.1/8
    scope host lo        valid_lft forever preferred_lft forever     inet6 ::1/128
    scope host        valid_lft forever preferred_lft forever 2:` `enp0s3:` `<BROADCAST,MULTICAST,UP,LOWER_UP>
    mtu 1500 qdisc pfifo_fast state UP qlen 1000     link/ether 08:00:27:db:c3:a4
    brd ff:ff:ff:ff:ff:ff     inet` `192.168.64.138``/24 brd 192.168.64.255 scope
    global dynamic enp0s3        valid_lft 59414sec preferred_lft 59414sec     inet6
    fe80::77a9:5ad6:2597:2e1b/64 scope link        valid_lft forever preferred_lft
    forever`'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '`# ip addr` `1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN
    qlen 1     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00     inet 127.0.0.1/8
    scope host lo        valid_lft forever preferred_lft forever     inet6 ::1/128
    scope host        valid_lft forever preferred_lft forever 2:` `enp0s3:` `<BROADCAST,MULTICAST,UP,LOWER_UP>
    mtu 1500 qdisc pfifo_fast state UP qlen 1000     link/ether 08:00:27:db:c3:a4
    brd ff:ff:ff:ff:ff:ff     inet` `192.168.64.138``/24 brd 192.168.64.255 scope
    global dynamic enp0s3        valid_lft 59414sec preferred_lft 59414sec     inet6
    fe80::77a9:5ad6:2597:2e1b/64 scope link        valid_lft forever preferred_lft
    forever`'
- en: The command’s output in the previous listing shows that the machine’s IP address
    is `192.168.64.138`. You’ll need to run this command on each of your nodes to
    get all their IPs.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 上一列表中的命令输出显示，机器的IP地址是 `192.168.64.138`。您需要在每个节点上运行此命令以获取所有节点的IP地址。
- en: B.2\. Configuring the master with kubeadm
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: B.2\. 使用kubeadm配置主节点
- en: You’re now ready to finally set up the Kubernetes Control Plane on your master
    node.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在可以最终在主节点上设置Kubernetes控制平面了。
- en: Running kubeadm init to initialize the master
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 运行kubeadm init以初始化主节点
- en: Thanks to the awesome `kubeadm` tool, all you need to do to initialize the master
    is run a single command, as shown in the following listing.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 感谢出色的`kubeadm`工具，初始化主节点您只需运行一个命令，如下所示。
- en: Listing B.4\. Initializing the master node with kubeadm init
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 列表B.4\. 使用kubeadm init初始化主节点
- en: '`# kubeadm init` `[kubeadm] WARNING: kubeadm is in beta, please do not use
    it for production      clusters. [init] Using Kubernetes version: v.1.8.4 ...
    You should now deploy a pod network to the cluster. Run "kubectl apply -f [podnetwork].yaml"
    with one of the options listed at:   http://kubernetes.io/docs/admin/addons/  You
    can now join any number of machines by running the following on each node as root:  kubeadm
    join --token eb3877.3585d0423978c549 192.168.64.138:6443      --discovery-token-ca-cert-hash
         sha256:037d2c5505294af196048a17f184a79411c7b1eac48aaa0ad137075be3d7a847`'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: '`# kubeadm init` `[kubeadm] WARNING: kubeadm is in beta, please do not use
    it for production clusters. [init] Using Kubernetes version: v.1.8.4 ... You should
    now deploy a pod network to the cluster. Run "kubectl apply -f [podnetwork].yaml"
    with one of the options listed at: http://kubernetes.io/docs/admin/addons/ You
    can now join any number of machines by running the following on each node as root:
    kubeadm join --token eb3877.3585d0423978c549 192.168.64.138:6443 --discovery-token-ca-cert-hash
    sha256:037d2c5505294af196048a17f184a79411c7b1eac48aaa0ad137075be3d7a847`'
- en: '|  |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Write down the command shown in the last line of kubeadm init’s output. You’ll
    need it later.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 记下kubeadm init输出最后一行的命令。您稍后需要用到它。
- en: '|  |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Kubeadm has deployed all the necessary Control Plane components, including etcd,
    the API server, Scheduler, and Controller Manager. It has also deployed the kube-proxy,
    making Kubernetes services available from the master node.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: Kubeadm已部署所有必要的控制平面组件，包括etcd、API服务器、调度器和控制器管理器。它还部署了kube-proxy，使Kubernetes服务从主节点可用。
- en: B.2.1\. Understanding how kubeadm runs the components
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: B.2.1\. 理解kubeadm如何运行组件
- en: All these components are running as containers. You can use the `docker ps`
    command to confirm this. But `kubeadm` doesn’t use Docker directly to run them.
    It deploys their YAML descriptors to the /etc/kubernetes/manifests directory.
    This directory is monitored by the Kubelet, which then runs these components through
    Docker. The components run as Pods. You can see them with the `kubectl get` command.
    But first, you need to configure `kubectl`.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些组件都以容器形式运行。您可以使用`docker ps`命令来确认这一点。但`kubeadm`并不直接使用Docker来运行它们。它将它们的YAML描述符部署到`/etc/kubernetes/manifests`目录。该目录由Kubelet监控，然后通过Docker运行这些组件。这些组件作为Pod运行。您可以使用`kubectl
    get`命令查看它们。但首先，您需要配置`kubectl`。
- en: Running kubectl on the master
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在主节点上运行kubectl
- en: You installed `kubectl` along with `docker`, `kubeadm`, and other packages in
    one of the initial steps. But you can’t use `kubectl` to talk to your cluster
    without first configuring it through a kubeconfig file.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在初始步骤之一中，您安装了`kubectl`、`docker`、`kubeadm`和其他软件包。但您必须首先通过kubeconfig文件配置它，才能使用`kubectl`与您的集群通信。
- en: 'Luckily, the necessary configuration is stored in the /etc/kubernetes/admin.conf
    file. All you need to do is make `kubectl` use it by setting the `KUBECONFIG`
    environment variable, as explained in [appendix A](index_split_135.html#filepos1721130):'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，必要的配置存储在`/etc/kubernetes/admin.conf`文件中。您需要做的只是通过设置`KUBECONFIG`环境变量来让`kubectl`使用它，如附录A（index_split_135.html#filepos1721130）中所述：
- en: '`# export KUBECONFIG=/etc/kubernetes/admin.conf`'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '`# export KUBECONFIG=/etc/kubernetes/admin.conf`'
- en: Listing the pods
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 列出pods
- en: To test `kubectl`, you can list the pods of the Control Plane (they’re in the
    `kube-system` namespace), as shown in the following listing.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 要测试`kubectl`，您可以列出控制平面（它们位于`kube-system`命名空间中）的pods，如下所示。
- en: Listing B.5\. System pods in the kube-system namespace
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 列表B.5\. kube-system命名空间中的系统pods
- en: '`# kubectl get po -n kube-system` `NAME                                 READY    
    STATUS    RESTARTS   AGE etcd-master.k8s                      1/1       Running  
    0          21m kube-apiserver-master.k8s            1/1       Running   0         
    22m kube-controller-manager-master.k8s   1/1       Running   0          21m kube-dns-3913472980-cn6kz           
    0/3       Pending   0          22m kube-proxy-qb709                     1/1      
    Running   0          22m kube-scheduler-master.k8s            1/1       Running  
    0          21m`'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '`# kubectl get po -n kube-system` `NAME                                 READY    
    STATUS    RESTARTS   AGE etcd-master.k8s                      1/1       Running  
    0          21m kube-apiserver-master.k8s            1/1       Running   0         
    22m kube-controller-manager-master.k8s   1/1       Running   0          21m kube-dns-3913472980-cn6kz           
    0/3       Pending   0          22m kube-proxy-qb709                     1/1      
    Running   0          22m kube-scheduler-master.k8s            1/1       Running  
    0          21m`'
- en: Listing nodes
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 列出节点
- en: 'You’re finished with setting up the master, but you still need to set up the
    nodes. Although you already installed the Kubelet on both of your two worker nodes
    (you either installed each node separately or cloned the initial VM after you
    installed all the required packages), they aren’t part of your Kubernetes cluster
    yet. You can see that by listing nodes with `kubectl`:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经完成了主节点的设置，但你仍然需要设置节点。尽管你已经在两个工作节点上安装了 Kubelet（你可能是分别安装每个节点，或者在安装所有必需的包后克隆了初始
    VM），但它们还不是你的 Kubernetes 集群的一部分。你可以通过使用 `kubectl` 列出节点来查看这一点：
- en: '`# kubectl get node` `NAME         STATUS     ROLES     AGE       VERSION master.k8s  
    NotReady   master    2m        v1.8.4`'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '`# kubectl get node` `NAME         STATUS     ROLES     AGE       VERSION master.k8s  
    NotReady   master    2m        v1.8.4`'
- en: See, only the master is listed as a node. And even the master is shown as being
    Not-Ready. You’ll see why later. Now, you’ll set up your two nodes.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 看看，只有主节点被列为节点。甚至主节点也被显示为不就绪。你稍后会看到原因。现在，你将设置你的两个节点。
- en: B.3\. Configuring worker nodes with kubeadm
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: B.3\. 使用 kubeadm 配置工作节点
- en: When using `kubeadm`, configuring worker nodes is even easier than configuring
    the master. In fact, when you ran the `kubeadm init` command to set up your master,
    it already told you how to configure your worker nodes (repeated in the next listing).
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用 `kubeadm` 时，配置工作节点甚至比配置主节点更容易。实际上，当你运行 `kubeadm init` 命令来设置你的主节点时，它已经告诉你如何配置你的工作节点（在下一列表中重复）。
- en: Listing B.6\. Last part of the output of the kubeadm init command
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 B.6\. `kubeadm init` 命令输出的最后部分
- en: '`You can now join any number of machines by running the following on each node
    as root:  kubeadm join --token eb3877.3585d0423978c549 192.168.64.138:6443     
    --discovery-token-ca-cert-hash      sha256:037d2c5505294af196048a17f184a79411c7b1eac48aaa0ad137075be3d7a847`'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '`你现在可以通过在每个节点上以 root 用户运行以下命令来加入任意数量的机器：  kubeadm join --token eb3877.3585d0423978c549
    192.168.64.138:6443    --discovery-token-ca-cert-hash    sha256:037d2c5505294af196048a17f184a79411c7b1eac48aaa0ad137075be3d7a847`'
- en: 'All you need to do is run the `kubeadm join` command with the specified token
    and the master’s IP address/port on both of your nodes. It then takes less than
    a minute for the nodes to register themselves with the master. You can confirm
    they’re registered by running the `kubectl get node` command on the master again:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要做的就是运行带有指定令牌和主节点 IP 地址/端口的 `kubeadm join` 命令在你的两个节点上。然后节点注册到主节点上只需不到一分钟的时间。你可以通过在主节点上再次运行
    `kubectl get node` 命令来确认它们已经注册：
- en: '`# kubectl get nodes` `NAME         STATUS     ROLES     AGE       VERSION
    master.k8s   NotReady   master    3m        v1.8.4 node1.k8s    NotReady   <none>   
    3s        v1.8.4 node2.k8s    NotReady   <none>    5s        v1.8.4`'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '`# kubectl get nodes` `NAME         STATUS     ROLES     AGE       VERSION
    master.k8s   NotReady   master    3m        v1.8.4 node1.k8s    NotReady   <none>   
    3s        v1.8.4 node2.k8s    NotReady   <none>    5s        v1.8.4`'
- en: Okay, you’ve made progress. Your Kubernetes cluster now consists of three nodes,
    but none of them are ready. Let’s investigate.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 好的，你已经取得了进展。你的 Kubernetes 集群现在由三个节点组成，但它们都不处于就绪状态。让我们来调查一下。
- en: Let’s use the `kubectl describe` command in the following listing to see more
    information. Somewhere at the top, you’ll see a list of `Conditions`, showing
    the current conditions on the node. One of them will show the following `Reason`
    and `Message`.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用以下列表中的 `kubectl describe` 命令来查看更多信息。在顶部某个地方，你会看到一个 `Conditions` 列表，显示节点上的当前状态。其中之一将显示以下
    `Reason` 和 `Message`。
- en: Listing B.7\. Kubectl describe shows why the node isn’t ready
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 B.7\. `kubectl describe` 显示节点不就绪的原因
- en: '`# kubectl describe node node1.k8s` `... KubeletNotReady    runtime network
    not ready: NetworkReady=false                    reason:NetworkPluginNotReady
    message:docker:                    network plugin is not ready: cni config uninitialized`'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '`# kubectl describe node node1.k8s` `... KubeletNotReady    runtime network
    not ready: NetworkReady=false                    reason:NetworkPluginNotReady
    message:docker:                    network plugin is not ready: cni config uninitialized`'
- en: According to this, the Kubelet isn’t fully ready, because the container network
    (CNI) plugin isn’t ready, which is expected, because you haven’t deployed the
    CNI plugin yet. You’ll deploy one now.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 根据这个情况，Kubelet 并未完全就绪，因为容器网络（CNI）插件尚未就绪，这是预期的，因为你尚未部署 CNI 插件。你现在将部署一个。
- en: B.3.1\. Setting up the container network
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: B.3.1\. 设置容器网络
- en: You’ll install the Weave Net container networking plugin, but several alternatives
    are also available. They’re listed among the available Kubernetes add-ons at [http://kubernetes.io/docs/admin/addons/](http://kubernetes.io/docs/admin/addons/).
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 你将安装 Weave Net 容器网络插件，但还有其他几种替代方案也可用。它们列在可用的 Kubernetes 附加组件中，见[http://kubernetes.io/docs/admin/addons/](http://kubernetes.io/docs/admin/addons/)。
- en: 'Deploying the Weave Net plugin (like most other add-ons) is as simple as this:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 部署 Weave Net 插件（就像大多数其他附加组件一样）非常简单：
- en: '`$ kubectl apply -f "https://cloud.weave.works/k8s/net?k8s-version=$(kubectl``version
    | base64 | tr -d ''\n'')`'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '`$ kubectl apply -f "https://cloud.weave.works/k8s/net?k8s-version=$(kubectl``version
    | base64 | tr -d ''\n'')`'
- en: This will deploy a DaemonSet and a few security-related resources (refer to
    [chapter 12](index_split_095.html#filepos1145244) for an explanation of the ClusterRole
    and ClusterRoleBinding, which are deployed alongside the DaemonSet).
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 这将部署一个 DaemonSet 和一些与安全相关的资源（有关 ClusterRole 和 ClusterRoleBinding 的解释，请参阅[第 12
    章](index_split_095.html#filepos1145244)，这些资源与 DaemonSet 一起部署）。
- en: 'Once the DaemonSet controller creates the pods and they’re started on all your
    nodes, the nodes should become ready:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦 DaemonSet 控制器创建了 pod 并在所有节点上启动，节点应该变为就绪状态：
- en: '`# k get node` `NAME         STATUS    ROLES     AGE       VERSION master.k8s  
    Ready     master    9m        v1.8.4 node1.k8s    Ready     <none>    5m       
    v1.8.4 node2.k8s    Ready     <none>    5m        v1.8.4`'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '`# k get node` `NAME         STATUS    ROLES     AGE       VERSION master.k8s  
    Ready     master    9m        v1.8.4 node1.k8s    Ready     <none>    5m       
    v1.8.4 node2.k8s    Ready     <none>    5m        v1.8.4`'
- en: And that’s it. You now have a fully functioning three-node Kubernetes cluster
    with an overlay network provided by Weave Net. All the required components, except
    for the Kubelet itself, are running as pods, managed by the Kubelet, as shown
    in the following listing.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样。你现在拥有了一个完全功能的三节点 Kubernetes 集群，Weave Net 提供了覆盖网络。所有必需的组件（除了 Kubelet 本身）都作为
    pod 运行，由 Kubelet 管理，如下所示。
- en: Listing B.8\. System pods in the kube-system namespace after deploying Weave
    Net
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 B.8\. 部署 Weave Net 后 kube-system 命名空间中的系统 pod
- en: '`# kubectl get po --all-namespaces` `NAMESPACE     NAME                                
    READY     STATUS    AGE kube-system   etcd-master.k8s                      1/1      
    Running   1h kube-system   kube-apiserver-master.k8s            1/1       Running  
    1h kube-system   kube-controller-manager-master.k8s   1/1       Running   1h kube-system  
    kube-dns-3913472980-cn6kz            3/3       Running   1h kube-system   kube-proxy-hcqnx                    
    1/1       Running   24m kube-system   kube-proxy-jvdlr                     1/1      
    Running   24m kube-system   kube-proxy-qb709                     1/1       Running  
    1h kube-system   kube-scheduler-master.k8s            1/1       Running   1h kube-system  
    weave-net-58zbk                      2/2       Running   7m kube-system   weave-net-91kjd                     
    2/2       Running   7m kube-system   weave-net-vt279                      2/2      
    Running   7m`'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '`# kubectl get po --all-namespaces` `NAMESPACE     NAME                                
    READY     STATUS    AGE kube-system   etcd-master.k8s                      1/1      
    Running   1h kube-system   kube-apiserver-master.k8s            1/1       Running  
    1h kube-system   kube-controller-manager-master.k8s   1/1       Running   1h kube-system  
    kube-dns-3913472980-cn6kz            3/3       Running   1h kube-system   kube-proxy-hcqnx                    
    1/1       Running   24m kube-system   kube-proxy-jvdlr                     1/1      
    Running   24m kube-system   kube-proxy-qb709                     1/1       Running  
    1h kube-system   kube-scheduler-master.k8s            1/1       Running   1h kube-system  
    weave-net-58zbk                      2/2       Running   7m kube-system   weave-net-91kjd                     
    2/2       Running   7m kube-system   weave-net-vt279                      2/2      
    Running   7m`'
- en: B.4\. Using the cluster from your local machine
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: B.4\. 在本地机器上使用集群
- en: Up to this point, you’ve used `kubectl` on the master node to talk to the cluster.
    You’ll probably want to configure the `kubectl` instance on your local machine,
    too.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，你已经在主节点上使用 `kubectl` 与集群通信。你可能还希望配置本地机器上的 `kubectl` 实例。
- en: 'To do that, you need to copy the /etc/kubernetes/admin.conf file from the master
    to your local machine with the following command:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 要做到这一点，您需要使用以下命令将 /etc/kubernetes/admin.conf 文件从主机关复制到您的本地机器：
- en: '`$ scp root@192.168.64.138:/etc/kubernetes/admin.conf ~/.kube/config2`'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '`$ scp root@192.168.64.138:/etc/kubernetes/admin.conf ~/.kube/config2`'
- en: 'Replace the IP with that of your master. Then you point the `KUBECONFIG` environment
    variable to the ~/.kube/config2 file like this:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 将 IP 替换为您的主机的 IP。然后，将 `KUBECONFIG` 环境变量指向 ~/.kube/config2 文件，如下所示：
- en: '`$ export KUBECONFIG=~/.kube/config2`'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '`$ export KUBECONFIG=~/.kube/config2`'
- en: Kubectl will now use this config file. To switch back to using the previous
    one, unset the environment variable.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: Kubectl 将现在使用此配置文件。要切换回使用之前的配置文件，取消设置环境变量。
- en: You’re now all set to use the cluster from your local machine.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您已经准备好从您的本地机器使用集群了。
