- en: appendix D
  id: totrans-0
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 附录 D
- en: Analyzing a project’s dependencies with JDeps
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用 JDeps 分析项目的依赖关系
- en: JDeps is the Java Dependency Analysis Tool, a command-line tool that processes
    Java bytecode—`.class` files or the JARs that contain them—and analyzes the statically
    declared dependencies between classes. The results can be filtered in various
    ways and can be aggregated to the package or JAR level. JDeps is also fully aware
    of the module system.
  id: totrans-2
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: JDeps 是一个 Java 依赖分析工具，是一个命令行工具，它处理 Java 字节码—`.class` 文件或包含它们的 JAR 文件，并分析类之间的静态声明依赖关系。结果可以以各种方式过滤，并可以聚合到包或
    JAR 级别。JDeps 也完全了解模块系统。
- en: All in all, it’s a useful tool for examining the various sometimes-nebulous
    graphs I talk about so much in this book. More than that, it has concrete applications
    when migrating and modularizing a project, like analyzing its static dependencies
    on JDK-internal APIs (section 7.1.2), listing split packages (section 7.2.5),
    and drafting module descriptors (section 9.3.2).
  id: totrans-3
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 总的来说，这是一个非常有用的工具，可以检查我在这本书中经常提到的各种有时模糊不清的图表。更重要的是，它在迁移和模块化项目时具有具体的应用，例如分析其对
    JDK 内部 API 的静态依赖关系（第 7.1.2 节）、列出分割包（第 7.2.5 节）和制定模块描述符（第 9.3.2 节）。
- en: For this exploration, I encourage you to follow along, preferably with one of
    your projects. It will be easiest if you have a JAR of your project and next to
    it a folder with all of its transitive dependencies. If you’re using Maven, you
    can achieve the latter with the maven-dependency-plugin’s `copy-dependencies`
    goal. With Gradle, you can use a `Copy` task, setting `from` to `configurations.compile`
    or `configurations.runtime`. A quick search will help you with the details.
  id: totrans-4
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 对于这次探索，我鼓励你跟随操作，最好是使用你自己的项目。如果你有一个项目 JAR 文件，旁边有一个包含所有传递依赖项的文件夹，这将是最容易的。如果你使用
    Maven，你可以通过 maven-dependency-plugin 的 `copy-dependencies` 目标来实现这一点。如果你使用 Gradle，你可以使用一个
    `Copy` 任务，将 `from` 设置为 `configurations.compile` 或 `configurations.runtime`。快速搜索可以帮助你了解详细信息。
- en: 'As my sample project, I picked Scaffold Hunter:'
  id: totrans-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 作为我的示例项目，我选择了 Scaffold Hunter：
- en: Scaffold Hunter is a Java-based open source tool for the visual analysis of
    data sets with a focus on data from the life sciences, aiming at an intuitive
    access to large and complex data sets. The tool offers a variety of views, *e.g.*
    graph, dendrogram, and plot view, as well as analysis methods, *e.g.* for clustering
    and classification.
  id: totrans-6
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: Scaffold Hunter 是一个基于 Java 的开源工具，用于可视化分析数据集，重点关注来自生命科学的数据，旨在直观地访问大型和复杂的数据集。该工具提供各种视图，例如图形、树状图和绘图视图，以及分析方法，例如聚类和分类。
- en: —[http://scaffoldhunter.sourceforge.net](http://scaffoldhunter.sourceforge.net)
  id: totrans-7
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: —[http://scaffoldhunter.sourceforge.net](http://scaffoldhunter.sourceforge.net)
- en: I downloaded the 2.6.3 release Zip file and copied all dependencies into `libs`.
    When showing output, I abbreviate `scaffoldhunter` (in package names) and `scaffoldhunter`
    (in file names) to `sh` to make it shorter.
  id: totrans-8
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 我下载了 2.6.3 版本的 Zip 文件，并将所有依赖项复制到 `libs` 目录中。在显示输出时，我将包名中的 `scaffoldhunter` 和文件名中的
    `scaffoldhunter` 缩写为 `sh` 以缩短输出。
- en: Getting to know JDeps
  id: totrans-9
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 了解 JDeps
- en: 'Let’s start with getting to know JDeps: where to find it, how to get the first
    results, and where to go for help. You can find the JDeps executable `jdeps` in
    your JDK’s `bin` folder since Java 8\. Working with it is easiest if it’s available
    on the command line, for which you may have to perform some setup steps specific
    to your OS. Make sure `jdeps --version` works and shows that the most recent version
    is running.'
  id: totrans-10
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 让我们从了解 JDeps 开始：在哪里找到它，如何获取初步结果，以及哪里可以获得帮助。从 Java 8 开始，你可以在 JDK 的 `bin` 文件夹中找到
    JDeps 可执行文件 `jdeps`。如果它可以在命令行上使用，这将是最容易的，你可能需要执行一些针对你操作系统的特定设置步骤。确保 `jdeps --version`
    可以正常工作，并显示正在运行的是最新版本。
- en: The next step is to grab a JAR and set JDeps loose on it. Used without further
    command-line options, it will first list the JDK modules the code depends on,
    including a mention of `not found` for all code that’s neither part of the JAR
    nor part of the JDK. That’s followed by a list of package-level dependencies,
    organized as `${package} -> ${package} ${module/JAR}`.
  id: totrans-11
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 下一步是获取一个 JAR 文件，并使用 JDeps 对其进行分析。如果不使用其他命令行选项，它将首先列出代码所依赖的 JDK 模块，包括对于既不是 JAR
    部分也不是 JDK 部分的所有代码的 `not found` 提示。接着是一个按包级别组织的依赖关系列表，格式为 `${package} -> ${package}
    ${module/JAR}`。
- en: 'Calling `jdeps scaffoldhunter-2.6.3.jar` results in the following overwhelming
    output. You can see that Scaffold Hunter depends on the modules java.base (of
    course), java.desktop (it’s a Swing application), java.sql (data sets are stored
    in SQL data bases), and a few others. This list of dependencies is followed by
    the long list of package dependencies, which is a little too much to take in:'
  id: totrans-12
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 调用 `jdeps scaffoldhunter-2.6.3.jar` 会导致以下令人眼花缭乱的输出。您可以看到 Scaffold Hunter 依赖于模块
    java.base（当然），java.desktop（它是一个 Swing 应用程序），java.sql（数据集存储在 SQL 数据库中），以及其他几个模块。在依赖列表之后，是一个长长的包依赖列表，这可能有点难以全部吸收：
- en: '`$ jdeps scaffoldhunter-2.6.3.jar  # remember, "sh" is short for "scaffoldhunter"
    (in # file names) and "scaffoldhunter" (in package names)` `> sh-2.6.3.jar ->
    java.base` [`①`](part0034.html#filepos2040776) `> sh-2.6.3.jar -> java.datatransfer
    > sh-2.6.3.jar -> java.desktop > sh-2.6.3.jar -> java.logging > sh-2.6.3.jar ->
    java.prefs > sh-2.6.3.jar -> java.sql > sh-2.6.3.jar -> java.xml` `> sh-2.6.3.jar
    -> not found` [`③`](part0034.html#filepos2041469)`> edu.udo.sh -> com.beust.jcommander
    not found` [`②`](part0034.html#filepos2041118) `> edu.udo.sh -> edu.udo.sh.data
    sh-2.6.3.jar > edu.udo.sh -> edu.udo.sh.gui sh-2.6.3.jar > edu.udo.sh -> edu.udo.sh.gui.util
    sh-2.6.3.jar > edu.udo.sh -> edu.udo.sh.util sh-2.6.3.jar > edu.udo.sh -> java.io
    java.base > edu.udo.sh -> java.lang java.base > edu.udo.sh -> javax.swing java.desktop`
    `> edu.udo.sh -> org.slf4j not found` [`③`](part0034.html#filepos2041469) `# truncated
    many more package dependencies`'
  id: totrans-13
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`$ jdeps scaffoldhunter-2.6.3.jar  # 注意，"sh" 是 "scaffoldhunter"（在文件名中）和 "scaffoldhunter"（在包名中）的简称`
    `> sh-2.6.3.jar -> java.base` [`①`](part0034.html#filepos2040776) `> sh-2.6.3.jar
    -> java.datatransfer > sh-2.6.3.jar -> java.desktop > sh-2.6.3.jar -> java.logging
    > sh-2.6.3.jar -> java.prefs > sh-2.6.3.jar -> java.sql > sh-2.6.3.jar -> java.xml`
    `> sh-2.6.3.jar -> not found` [`③`](part0034.html#filepos2041469)`> edu.udo.sh
    -> com.beust.jcommander not found` [`②`](part0034.html#filepos2041118) `> edu.udo.sh
    -> edu.udo.sh.data sh-2.6.3.jar > edu.udo.sh -> edu.udo.sh.gui sh-2.6.3.jar >
    edu.udo.sh -> edu.udo.sh.gui.util sh-2.6.3.jar > edu.udo.sh -> edu.udo.sh.util
    sh-2.6.3.jar > edu.udo.sh -> java.io java.base > edu.udo.sh -> java.lang java.base
    > edu.udo.sh -> javax.swing java.desktop` `> edu.udo.sh -> org.slf4j not found`
    [`③`](part0034.html#filepos2041469) `# 省略了许多其他包依赖`'
- en: ①
  id: totrans-14
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ①
- en: JDK modules the project depends on
  id: totrans-15
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: JDK 项目所依赖的模块
- en: ②
  id: totrans-16
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ②
- en: Package dependencies within and across JARs
  id: totrans-17
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: JAR 内部和跨 JAR 的包依赖
- en: ③
  id: totrans-18
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ③
- en: “not found” indicates that dependencies weren’t found, which isn’t surprising
    as I didn’t tell JDeps where to look for them.
  id: totrans-19
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “not found” 表示未找到依赖项，这并不奇怪，因为我没有告诉 JDeps 在哪里查找它们。
- en: Now it’s time to tune the output with the various options. You can list them
    with `jdeps -h`.
  id: totrans-20
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 现在是时候使用各种选项调整输出了。您可以使用 `jdeps -h` 列出它们。
- en: Including dependencies in the analysis
  id: totrans-21
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在分析中包含依赖项
- en: An important aspect of JDeps is that it allows you to analyze your dependencies
    as if they were part of your code. A first step to that goal is placing them on
    the class path with `--class-path`, but that only enables JDeps to follow the
    paths into your dependencies’ JARs and rids you of the `not found` indicators.
    To analyze the dependencies as well, you need to make JDeps recurse into them
    with `-recursive` or `-r`.
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: JDeps 的重要特性之一是它允许您将依赖项分析为代码的一部分。实现这一目标的第一步是将它们放置在类路径上使用 `--class-path`，但这仅使
    JDeps 能够跟踪依赖项 JAR 的路径，并消除了 `not found` 指示。要分析依赖项，您需要使用 `-recursive` 或 `-r` 使 JDeps
    递归进入它们。
- en: 'To include Scaffold Hunter’s dependencies, I executed JDeps with `--class-path
    ''libs/*''`and `-recursive`, the result of which can be seen next. In this specific
    case, the output begins with a few split-package warnings that I’m going to ignore
    for now. The following module/JAR and package dependencies are as before but now
    are all found, so there are many more of them:'
  id: totrans-23
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 为了包含 Scaffold Hunter 的依赖项，我使用 `--class-path 'libs/*'` 和 `-recursive` 执行了 JDeps，其结果如下。在这个特定的情况下，输出以几个分割包警告开始，我现在将忽略这些警告。以下模块/JAR
    和包依赖与之前相同，但现在都已找到，因此有更多：
- en: '`$ jdeps -recursive --class-path ''libs/*'' scaffoldhunter-2.6.3.jar  # truncated
    split package warnings # truncated some module/JAR dependencies` `> sh-2.6.3.jar
    -> libs/commons-codec-1.6.jar` [`①`](part0034.html#filepos2046411) `> sh-2.6.3.jar
    -> libs/commons-io-2.4.jar > sh-2.6.3.jar -> libs/dom4j-1.6.1.jar > sh-2.6.3.jar
    -> libs/exp4j-0.1.38.jar > sh-2.6.3.jar -> libs/guava-18.0.jar > sh-2.6.3.jar
    -> libs/heaps-2.0.jar > sh-2.6.3.jar -> libs/hibernate-core-4.3.6.Final.jar >
    sh-2.6.3.jar -> java.base > sh-2.6.3.jar -> java.datatransfer > sh-2.6.3.jar ->
    java.desktop > sh-2.6.3.jar -> java.logging > sh-2.6.3.jar -> java.prefs > sh-2.6.3.jar
    -> java.sql > sh-2.6.3.jar -> java.xml > sh-2.6.3.jar -> libs/javassist-3.18.1-GA.jar
    > sh-2.6.3.jar -> libs/jcommander-1.35.jar # truncated more module/JAR dependencies`
    `> edu.udo.sh -> com.beust.jcommander jcommander-1.35.jar` [`②`](part0034.html#filepos2046759)
    `> edu.udo.sh -> edu.udo.sh.data sh-2.6.3.jar > edu.udo.sh -> edu.udo.sh.gui sh-2.6.3.jar
    > edu.udo.sh -> edu.udo.sh.gui.util sh-2.6.3.jar > edu.udo.sh -> edu.udo.sh.util
    sh-2.6.3.jar > edu.udo.sh -> java.io java.base > edu.udo.sh -> java.lang java.base
    > edu.udo.sh -> javax.swing java.desktop` `> edu.udo.sh -> org.slf4j slf4j-api-1.7.5.jar`
    [`②`](part0034.html#filepos2046759) `# truncated many, many more package dependencies`'
  id: totrans-24
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`$ jdeps -recursive --class-path ''libs/*'' scaffoldhunter-2.6.3.jar  # 截断拆分包警告
    # 截断一些模块/JAR 依赖` `> sh-2.6.3.jar -> libs/commons-codec-1.6.jar` [`①`](part0034.html#filepos2046411)
    `> sh-2.6.3.jar -> libs/commons-io-2.4.jar > sh-2.6.3.jar -> libs/dom4j-1.6.1.jar
    > sh-2.6.3.jar -> libs/exp4j-0.1.38.jar > sh-2.6.3.jar -> libs/guava-18.0.jar
    > sh-2.6.3.jar -> libs/heaps-2.0.jar > sh-2.6.3.jar -> libs/hibernate-core-4.3.6.Final.jar
    > sh-2.6.3.jar -> java.base > sh-2.6.3.jar -> java.datatransfer > sh-2.6.3.jar
    -> java.desktop > sh-2.6.3.jar -> java.logging > sh-2.6.3.jar -> java.prefs >
    sh-2.6.3.jar -> java.sql > sh-2.6.3.jar -> java.xml > sh-2.6.3.jar -> libs/javassist-3.18.1-GA.jar
    > sh-2.6.3.jar -> libs/jcommander-1.35.jar # 截断更多模块/JAR 依赖` `> edu.udo.sh -> com.beust.jcommander
    jcommander-1.35.jar` [`②`](part0034.html#filepos2046759) `> edu.udo.sh -> edu.udo.sh.data
    sh-2.6.3.jar > edu.udo.sh -> edu.udo.sh.gui sh-2.6.3.jar > edu.udo.sh -> edu.udo.sh.gui.util
    sh-2.6.3.jar > edu.udo.sh -> edu.udo.sh.util sh-2.6.3.jar > edu.udo.sh -> java.io
    java.base > edu.udo.sh -> java.lang java.base > edu.udo.sh -> javax.swing java.desktop`
    `> edu.udo.sh -> org.slf4j slf4j-api-1.7.5.jar` [`②`](part0034.html#filepos2046759)
    `# 截断许多许多更多的包依赖`'
- en: ①
  id: totrans-25
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ①
- en: No more “not found” JAR dependencies
  id: totrans-26
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 没有更多“未找到”的 JAR 依赖
- en: ②
  id: totrans-27
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ②
- en: No more “not found” sources for package dependencies
  id: totrans-28
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 没有更多“未找到”的包依赖源
- en: This makes the output all the more overwhelming, so it’s high time to look at
    how you can make sense from so much data.
  id: totrans-29
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 这使得输出更加令人眼花缭乱，因此是时候看看如何从如此多的数据中找到意义了。
- en: Configuring JDeps’ output
  id: totrans-30
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 配置 JDeps 的输出
- en: 'There are various ways to configure JDeps’ output. Maybe the best option to
    use in a first analysis of any project is `-summary` or `-s`, which only show
    dependencies between JARs, as shown here:'
  id: totrans-31
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 配置 JDeps 输出的方式有很多种。在分析任何项目的初步分析中，可能最好的选项是 `-summary` 或 `-s`，它只显示 JAR 之间的依赖关系，如下所示：
- en: '`$ jdeps -summary -recursive --class-path ''libs/*'' scaffoldhunter-2.6.3.jar  #
    truncated split package warnings # truncated some module/JAR dependencies > sh-2.6.3.jar
    -> libs/javassist-3.18.1-GA.jar > sh-2.6.3.jar -> libs/jcommander-1.35.jar > sh-2.6.3.jar
    -> libs/jgoodies-forms-1.4.1.jar > sh-2.6.3.jar -> libs/jspf.core-1.0.2.jar >
    sh-2.6.3.jar -> libs/l2fprod-common-sheet.jar > sh-2.6.3.jar -> libs/l2fprod-common-tasks.jar
    > sh-2.6.3.jar -> libs/opencsv-2.3.jar > sh-2.6.3.jar -> libs/piccolo2d-core-1.3.2.jar
    > sh-2.6.3.jar -> libs/piccolo2d-extras-1.3.2.jar > sh-2.6.3.jar -> libs/slf4j-api-1.7.5.jar
    > sh-2.6.3.jar -> libs/xml-apis-ext.jar > sh-2.6.3.jar -> libs/xstream-1.4.1.jar
    > slf4j-api-1.7.5.jar -> java.base > slf4j-api-1.7.5.jar -> libs/slf4j-jdk14-1.7.5.jar
    > slf4j-jdk14-1.7.5.jar -> java.base > slf4j-jdk14-1.7.5.jar -> java.logging >
    slf4j-jdk14-1.7.5.jar -> libs/slf4j-api-1.7.5.jar # truncated more module/JAR
    dependencies`'
  id: totrans-32
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`$ jdeps -summary -recursive --class-path ''libs/*'' scaffoldhunter-2.6.3.jar  #
    截断拆分包警告 # 截断一些模块/JAR 依赖 > sh-2.6.3.jar -> libs/javassist-3.18.1-GA.jar > sh-2.6.3.jar
    -> libs/jcommander-1.35.jar > sh-2.6.3.jar -> libs/jgoodies-forms-1.4.1.jar >
    sh-2.6.3.jar -> libs/jspf.core-1.0.2.jar > sh-2.6.3.jar -> libs/l2fprod-common-sheet.jar
    > sh-2.6.3.jar -> libs/l2fprod-common-tasks.jar > sh-2.6.3.jar -> libs/opencsv-2.3.jar
    > sh-2.6.3.jar -> libs/piccolo2d-core-1.3.2.jar > sh-2.6.3.jar -> libs/piccolo2d-extras-1.3.2.jar
    > sh-2.6.3.jar -> libs/slf4j-api-1.7.5.jar > sh-2.6.3.jar -> libs/xml-apis-ext.jar
    > sh-2.6.3.jar -> libs/xstream-1.4.1.jar > slf4j-api-1.7.5.jar -> java.base >
    slf4j-api-1.7.5.jar -> libs/slf4j-jdk14-1.7.5.jar > slf4j-jdk14-1.7.5.jar -> java.base
    > slf4j-jdk14-1.7.5.jar -> java.logging > slf4j-jdk14-1.7.5.jar -> libs/slf4j-api-1.7.5.jar
    # 截断更多模块/JAR 依赖`'
- en: '[Table D.1](part0034.html#filepos2049527) lists various filters that give different
    perspectives on the dependencies.'
  id: totrans-33
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '[表 D.1](part0034.html#filepos2049527) 列出了各种过滤器，它们提供了对依赖关系的不同视角。'
- en: Table D.1 A short description of some of the options that filter JDeps’ output
  id: totrans-34
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 表 D.1 JDeps 输出的某些选项的简要描述
- en: '| Option   | Description   |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| 选项   | 描述   |'
- en: '| `--apionly` or `-apionly`   | Sometimes, particularly if you’re analyzing
    a library, you only care about a JAR’s API. With this option, only types mentioned
    in the signatures of public and protected members of public classes are examined.   |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| `--apionly` 或 `-apionly`   | 有时，尤其是当你分析一个库时，你可能只关心一个 JAR 的 API。使用此选项，仅检查公共和受保护成员的签名中提到的类型。   |'
- en: '| `-filter` or `-f`   | Followed by a regular expression, excludes dependencies
    on classes that match the regex. (Note that unless `-verbose:class` is used, output
    still shows packages.)   |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| `-filter` 或 `-f`   | 后跟一个正则表达式，排除与匹配正则表达式的类相关的依赖。（注意：除非使用 `-verbose:class`，否则输出仍会显示包。）   |'
- en: '| `-filter:archive`   | In many cases, dependencies within an artifact aren’t
    that interesting. This option ignores them and only shows dependencies across
    artifacts.   |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| `-filter:archive`   | 在许多情况下，工件内的依赖并不那么有趣。此选项忽略它们，只显示跨工件之间的依赖。   |'
- en: '| `--package` or `-p`   | Followed by a package name, only considers dependencies
    on that package, which is a great way to see all the places where those `utils`
    are used.   |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| `--package` 或 `-p`   | 后跟一个包名，仅考虑对该包的依赖，这是一个查看那些 `utils` 被使用所有位置的好方法。   |'
- en: '| `--regex` or `-e`   | Followed by a regular expression, only considers dependencies
    on classes that match the regex. (Note that unless `-verbose:class` is used, output
    still shows packages.)   |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| `--regex` 或 `-e`   | 后跟一个正则表达式，仅考虑与匹配正则表达式的类相关的依赖。（注意：除非使用 `-verbose:class`，否则输出仍会显示包。）   |'
- en: Output on the command line is a good way to examine details and drill deeper
    into interesting bits. It doesn’t make for the most intuitive overview, though—diagrams
    are much better at that. Fortunately, JDeps has the `--dot-output` option, which
    creates `.dot` files for each of the individual analyses. These files are pure
    text, but other tools, such as Graphviz, can be used to create images from them.
    See the following listing and figure D.1 for an example.
  id: totrans-41
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 命令行上的输出是检查细节和深入挖掘有趣部分的好方法。但这并不是最直观的概览——图表在这方面做得更好。幸运的是，JDeps 有 `--dot-output`
    选项，它为每个单独的分析创建 `.dot` 文件。这些文件是纯文本，但可以使用其他工具，如 Graphviz，从它们创建图像。请参阅以下列表和图 D.1 以获取示例。
- en: Listing D.1 Visualizing artifact dependencies
  id: totrans-42
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 列表 D.1 可视化工件依赖关系
- en: '`$ jdeps -recursive --class-path ''libs/*''` `--dot-output dots` [`①`](part0034.html#filepos2058489)
    `scaffoldhunter-2.6.3.jar` `$ dot -Tpng -O dots/summary.dot` [`②`](part0034.html#filepos2058878)'
  id: totrans-43
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`$ jdeps -recursive --class-path ''libs/*''` `--dot-output dots` [①](part0034.html#filepos2058489)
    `scaffoldhunter-2.6.3.jar` `$ dot -Tpng -O dots/summary.dot` [②](part0034.html#filepos2058878)'
- en: ①
  id: totrans-44
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ①
- en: Specifying --dot-output dots tells JDeps to create .dot files in the dots folder.
  id: totrans-45
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 指定 `--dot-output dots` 告诉 JDeps 在 dots 文件夹中创建 .dot 文件。
- en: ②
  id: totrans-46
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ②
- en: Graphviz provides the dot command, which is used here to create a summary.dot.png
    in dots.
  id: totrans-47
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: Graphviz 提供了 dot 命令，这里使用它来在 dots 中创建 summary.dot.png。
- en: '![](../images/00090.jpeg)'
  id: totrans-48
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](../images/00090.jpeg)'
- en: Figure D.1The result of [listing D.1](part0034.html#filepos2057753) is a large,
    complicated, but still approachable dependency graph. This is just a cleaned-up
    part of it. Don’t worry about the details; create one for your project, instead.
  id: totrans-49
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 图 D.1 [列表 D.1](part0034.html#filepos2057753) 的结果是大型、复杂但仍然可接近的依赖关系图。这只是其中的一部分。不必担心细节；为你的项目创建一个。
- en: Dot files and Graphviz
  id: totrans-50
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: Dot 文件和 Graphviz
- en: The `.dot` file is plain text and a great intermediate representation to edit.
    With some regular expressions, you can, for example, remove the java.base module
    from the bottom (makes the graph simpler) or the versions from the JAR’s names
    (makes the graph leaner). For more on Graphviz, check out [https://graphviz.gitlab.io](https://graphviz.gitlab.io).
  id: totrans-51
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`.dot` 文件是纯文本，是一个很好的中间表示形式，可以对其进行编辑。使用一些正则表达式，例如，你可以从底部移除 java.base 模块（使图更简单）或从
    JAR 名称中移除版本（使图更精简）。有关 Graphviz 的更多信息，请参阅 [https://graphviz.gitlab.io](https://graphviz.gitlab.io)。'
- en: Drilling deeper into your project’s dependencies
  id: totrans-52
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 深入挖掘你的项目依赖关系
- en: If you want to see more details, `-verbose:class` lists dependencies between
    classes instead of aggregating them at the package level. Sometimes, listing only
    direct dependencies on a package or class isn’t enough, because they may not be
    in your code but rather in your dependencies. In that case, `--inverse` or `-I`
    might help. Given a specific package or regex to look for, it tracks the dependencies
    back as far as they go, listing the artifacts along the way. Unfortunately, there
    seems to be no straightforward way to see the result at the level of classes instead
    of artifacts.
  id: totrans-53
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 如果你想查看更多细节，`-verbose:class` 会列出类之间的依赖关系，而不是在包级别上聚合它们。有时候，仅列出包或类的直接依赖可能不够，因为它们可能不在你的代码中，而是在你的依赖中。在这种情况下，使用
    `--inverse` 或 `-I` 可能会有所帮助。给定一个特定的包或正则表达式进行查找，它会追踪依赖关系直到它们的最远点，并在过程中列出相关工件。不幸的是，似乎没有一种直接的方法可以在类级别而不是工件级别查看结果。
- en: If you’re only interested in the dependencies exposed in a library’s public
    API, you can use `--apionly` for that. With it, only types mentioned in the signatures
    of public and protected members of public classes are examined. There are a few
    more options that might help you in your specific case—as mentioned, you can list
    them with `jdeps -h`.
  id: totrans-54
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 如果你只对库的公共API中暴露的依赖感兴趣，你可以使用 `--apionly` 来实现这一点。使用它，只会检查公共和受保护成员的签名中提到的类型。还有一些其他选项可能有助于你解决特定情况——如前所述，你可以使用
    `jdeps -h` 列出它们。
- en: JDeps understands modules
  id: totrans-55
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: JDeps 理解模块
- en: 'Just as the compiler and the JVM can operate on a higher level of abstraction
    thanks to the module system, so can JDeps. The module path can be specified with
    `--module-path` (note that `-p` is reserved: it’s not shorthand for this option)
    and the initial module with `--module` or `-m`. From there, you can do the same
    kinds of analyses as earlier:'
  id: totrans-56
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 正如编译器和 JVM 可以通过模块系统在更高层次上进行操作一样，JDeps 也可以。模块路径可以通过 `--module-path` 指定（注意 `-p`
    是保留的：它不是此选项的缩写），初始模块通过 `--module` 或 `-m` 指定。从那里，你可以进行与之前相同类型的分析：
- en: '`$ jdeps -summary -recursive --module-path mods:libs -m monitor  # truncated
    some module dependencies > monitor -> java.base > monitor -> monitor.observer
    > monitor -> monitor.observer.alpha > monitor -> monitor.observer.beta > monitor
    -> monitor.persistence > monitor -> monitor.rest > monitor -> monitor.statistics
    > monitor.observer -> java.base > monitor.observer.alpha -> java.base > monitor.observer.alpha
    -> monitor.observer > monitor.observer.beta -> java.base > monitor.observer.beta
    -> monitor.observer > monitor.persistence -> java.base > monitor.persistence ->
    monitor.statistics > monitor.persistence -> hibernate.jpa > monitor.rest -> java.base
    > monitor.rest -> monitor.statistics > monitor.rest -> spark.core > monitor.statistics
    -> java.base > monitor.statistics -> monitor.observer > slf4j.api -> java.base
    > slf4j.api -> not found > spark.core -> JDK removed internal API > spark.core
    -> java.base > spark.core -> javax.servlet.api > spark.core -> jetty.server >
    spark.core -> jetty.servlet > spark.core -> jetty.util > spark.core -> slf4j.api
    > spark.core -> websocket.api > spark.core -> websocket.server > spark.core ->
    websocket.servlet # truncated more module dependencies`'
  id: totrans-57
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`$ jdeps -summary -recursive --module-path mods:libs -m monitor  # 省略了一些模块依赖
    > monitor -> java.base > monitor -> monitor.observer > monitor -> monitor.observer.alpha
    > monitor -> monitor.observer.beta > monitor -> monitor.persistence > monitor
    -> monitor.rest > monitor -> monitor.statistics > monitor.observer -> java.base
    > monitor.observer.alpha -> java.base > monitor.observer.alpha -> monitor.observer
    > monitor.observer.beta -> java.base > monitor.observer.beta -> monitor.observer
    > monitor.persistence -> java.base > monitor.persistence -> monitor.statistics
    > monitor.persistence -> hibernate.jpa > monitor.rest -> java.base > monitor.rest
    -> monitor.statistics > monitor.rest -> spark.core > monitor.statistics -> java.base
    > monitor.statistics -> monitor.observer > slf4j.api -> java.base > slf4j.api
    -> 未找到 > spark.core -> JDK 移除了内部 API > spark.core -> java.base > spark.core ->
    javax.servlet.api > spark.core -> jetty.server > spark.core -> jetty.servlet >
    spark.core -> jetty.util > spark.core -> slf4j.api > spark.core -> websocket.api
    > spark.core -> websocket.server > spark.core -> websocket.servlet # 省略了更多模块依赖`'
- en: Beyond that, there are some Java 9 and module-specific options. With `--require
    ${modules}`, you can list all modules that require the named ones. How to use
    `--jdk-internals` to analyze a project’s problematic dependencies is explained
    in section 7.1.2\. Section 9.3.2 explains how `--generate-module-info` and `--generate-open-module`
    can be used to create first drafts of module descriptors. As mentioned in passing,
    JDeps will also always report all split packages it finds—a problem discussed
    in detail in section 7.2.
  id: totrans-58
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 此外，还有一些 Java 9 和模块特定的选项。使用 `--require ${modules}`，您可以列出所有需要命名模块的模块。如何使用 `--jdk-internals`
    来分析项目的有问题依赖关系在第 7.1.2 节中解释。第 9.3.2 节解释了如何使用 `--generate-module-info` 和 `--generate-open-module`
    来创建模块描述符的第一稿。如前所述，JDeps 还会始终报告它找到的所有拆分包——这个问题在第 7.2 节中详细讨论。
- en: 'An interesting option is `--check`, which gives different perspectives on a
    module’s descriptor (see [figure D.2](part0034.html#filepos2069144)):'
  id: totrans-59
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 一个有趣的选项是 `--check`，它提供了对模块描述符的不同视角（见[图 D.2](part0034.html#filepos2069144)）：
- en: It starts by printing the actual descriptor, followed by two hypothetical ones.
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它首先打印实际的描述符，然后是两个假设的描述符。
- en: The first of those, which is described as the suggested descriptor, declares
    dependencies on all modules whose types are used in the checked module.
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 其中第一个，被描述为建议的描述符，声明了对所有在检查模块中使用类型的模块的依赖。
- en: The second, described as a transitive reduced graph, is similar to the first
    but removes those dependencies that can be read due to implied readability (see
    section 9.1). This means it’s the smallest set of dependencies that yields a reliable
    configuration.
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第二个，被描述为传递减少图，与第一个类似，但去除了由于暗示的可读性而可以读取的依赖（见第 9.1 节）。这意味着它是产生可靠配置的最小依赖集。
- en: Finally, if the module declares any qualified exports (see section 9.3), `--check`
    will output those that aren’t used within the universe of observable modules.
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后，如果模块声明了任何合格的导出（见第 9.3 节），`--check` 将输出那些在可观察模块的宇宙中未使用的导出。
- en: The hypothetical descriptors `--check` creates can also be viewed separately
    with the two options `--list-deps` and `--list-reduced-deps`, respectively. They
    also work with the class path, in which case they reference the unnamed module
    (see section 8.2).
  id: totrans-64
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`--check` 创建的假设描述符也可以分别使用两个选项 `--list-deps` 和 `--list-reduced-deps` 进行查看。它们也可以与类路径一起使用，在这种情况下，它们引用未命名的模块（见第
    8.2 节）。'
- en: '![](../images/00041.jpeg)'
  id: totrans-65
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![图片](../images/00041.jpeg)'
- en: '[Figure D.2](part0034.html#filepos2066957)At left you can see monitor.peek
    (introduced in section 11.1.1) and its transitive dependencies, some of which
    imply readability on other modules. At right, JDeps suggests including monitor.observer
    in the list of dependencies (because its types are directly referenced). Additionally,
    it lists the absolute minimum set of modules on which monitor.peek needs to depend
    to be reliable, making full use of implied readability.'
  id: totrans-66
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '[图 D.2](part0034.html#filepos2066957) 在左侧，您可以看到 monitor.peek（在 11.1.1 节中介绍）及其传递依赖关系，其中一些暗示了在其他模块上的可读性。在右侧，JDeps
    建议将 monitor.observer 包含在依赖列表中（因为其类型被直接引用）。此外，它列出了 monitor.peek 需要依赖的最小模块集，以充分利用暗示的可读性。'
