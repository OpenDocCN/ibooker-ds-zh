- en: 1 Introducing pandas
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1. 介绍 pandas
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: The growth of data science in the 21st century
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 21世纪数据科学的发展
- en: The history of the pandas library for data analysis
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据分析库 pandas 的历史
- en: The pros and cons of pandas and its competitors
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: pandas 及其竞争对手的优缺点
- en: Data analysis in Excel versus data analysis with a programming language
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Excel 进行数据分析与使用编程语言进行数据分析的比较
- en: A tour of the library’s features through a working example
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过一个工作示例浏览库的功能
- en: 'Welcome to *Pandas in Action*! Pandas is a library for data analysis built
    on top of the Python programming language. A *library* (also called a *package*)
    is a collection of code for solving problems in a specific field of endeavor.
    Pandas is a toolbox for data manipulation operations: sorting, filtering, cleaning,
    deduping, aggregating, pivoting, and more. The epicenter of Python’s vast data
    science ecosystem, pandas pairs well with other libraries for statistics, natural
    language processing, machine learning, data visualization, and more.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 欢迎来到《Pandas实战》！Pandas 是一个基于 Python 编程语言构建的数据分析库。一个 *库*（也称为 *包*）是用于解决特定领域问题的代码集合。Pandas
    是数据操作工具箱：排序、过滤、清理、去重、聚合、转置等等。Python 广大数据科学生态系统的中心，pandas 与其他用于统计、自然语言处理、机器学习、数据可视化等方面的库配合良好。
- en: In this introductory chapter, we’ll explore the history and evolution of modern
    data analytics tools. We’ll see how pandas grew from one financial analyst’s pet
    project to an industry standard used by companies such as Stripe, Google, and
    J.P. Morgan. We’ll compare the library with its competitors, including Excel and
    R. We’ll discuss the differences between working with a programming language and
    working with a graphical spreadsheet application. Finally, we’ll use pandas to
    analyze a real-world data set. Consider this chapter to be a sneak preview of
    the concepts you’ll master throughout the book. Let’s dive in!
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的引言部分，我们将探讨现代数据分析工具的历史和演变。我们将看到 pandas 如何从一个金融分析师的宠物项目成长为被 Stripe、Google
    和 J.P. Morgan 等公司采用的行业标准。我们将将该库与其竞争对手进行比较，包括 Excel 和 R。我们将讨论使用编程语言与使用图形电子表格应用程序之间的区别。最后，我们将使用
    pandas 分析一个真实世界的数据集。请将本章视为对你在整本书中将要掌握的概念的预览。让我们开始吧！
- en: 1.1 Data in the 21st century
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.1 21世纪的数据
- en: “It is a capital mistake to theorize before one has data,” Sherlock Holmes advises
    his assistant John Watson in “A Scandal in Bohemia,” the first of Sir Arthur Conan
    Doyle’s classic short stories pairing the duo. “Insensibly one begins to twist
    facts to suit theories, instead of theories to suit facts.”
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: “在没有数据之前就进行理论化是一个严重的错误，”夏洛克·福尔摩斯在阿瑟·柯南·道尔的经典短篇小说《波希米亚丑闻》中向他的助手约翰·华生建议。“不知不觉中，人们开始扭曲事实以适应理论，而不是让理论适应事实。”
- en: The wise detective’s words continue to ring true more than a century after the
    publication of Doyle’s work, in a world in which data is becoming increasingly
    prevalent in every facet of our lives. “The world’s most valuable resource is
    no longer oil, but data,” declared *The Economist* in a 2017 opinion piece. Data
    is *evidence*, and evidence is critical to businesses, governments, institutions,
    and individuals solving increasingly complex problems in our interconnected world.
    Across a breadth of industries, the world’s most successful companies, from Facebook
    to Amazon to Netflix, cite data as the most prized asset in their portfolios.
    United Nations Secretary-General António Guterres called accurate data “the lifeblood
    of good policy and decision-making.” Data powers everything from movie recommendations
    to medical treatments, from supply chain logistics to poverty-reduction initiatives.
    The success of communities, companies, and even countries in the 21st century
    will depend on their ability to acquire, aggregate, and analyze data.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在道尔作品发表一个多世纪之后，这位明智的侦探的话语依然真实，在一个数据在我们生活的各个方面变得越来越普遍的世界里。“世界上最宝贵的资源不再是石油，而是数据，”2017
    年，《经济学人》在一篇评论文章中宣称。数据是 *证据*，证据对于企业、政府、机构和个人解决我们互联世界中日益复杂的问题至关重要。在众多行业中，从 Facebook
    到 Amazon 到 Netflix，世界上最成功的企业都将数据视为其组合中最宝贵的资产。联合国秘书长安东尼奥·古特雷斯将准确的数据称为“良好政策和决策的生命线。”数据推动着从电影推荐到医疗治疗，从供应链物流到减贫倡议的一切。21
    世纪社区、公司和甚至国家成功将取决于他们获取、汇总和分析数据的能力。
- en: 1.2 Introducing pandas
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.2 介绍 pandas
- en: The technological ecosystem of tools for working with data has grown tremendously
    over the past decade. Today, the open source pandas library is one of the most
    popular solutions available for data analysis and manipulation. *Open source*
    means that the library’s source code is publicly available to download, use, modify,
    and distribute. Its license grants users more permissions than proprietary software
    such as Excel. Pandas is free to use. A global team of volunteer software developers
    maintains the library, and you can find its complete source code on GitHub ([https://github.com/pandas-dev/pandas](https://github.com/pandas-dev/pandas)).
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 过去十年中，用于处理数据的技术生态系统已经大幅增长。如今，开源的pandas库是数据分析和操作中最受欢迎的解决方案之一。“开源”意味着库的源代码是公开可下载、使用、修改和分发的。其许可证赋予用户比Excel等专有软件更多的权限。Pandas是免费使用的。一个全球志愿者软件开发团队维护这个库，你可以在GitHub上找到其完整的源代码（[https://github.com/pandas-dev/pandas](https://github.com/pandas-dev/pandas)）。
- en: Pandas is comparable to Microsoft’s Excel spreadsheet software and Google’s
    in-browser Sheets application. In all three technologies, a user interacts with
    tables consisting of rows and columns of data. A row represents a record or, equivalently,
    one collection of values for the columns. Transformations are applied to coax
    the data into the desired state.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 'Pandas可以与微软的Excel电子表格软件和谷歌的浏览器内Sheets应用程序相媲美。在这三种技术中，用户与由行和列组成的数据表进行交互。一行代表一条记录，或者等价地，一列值的集合。通过应用转换，将数据转换为所需的状态。 '
- en: Figure 1.1 displays a sample transformation of a data set. The analyst applies
    an operation to the four-row data set on the left to arrive at the two-row data
    set on the right. They may select rows that fit a criterion, for example, or remove
    duplicate rows from the original data set.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.1展示了数据集的一个示例转换。分析师对左侧的四行数据集应用操作，得到右侧的两行数据集。他们可以选择符合标准的行，例如，或者从原始数据集中删除重复的行。
- en: '![](../Images/CH01_F01_Paskhaver.png)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/CH01_F01_Paskhaver.png)'
- en: Figure 1.1 A sample transformation of a tabular data set
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.1表格数据集的示例转换
- en: What makes pandas unique is the balance it strikes between processing power
    and user productivity. By relying on lower-level languages such as C for many
    of its calculations, the library can efficiently transform million-row data sets
    in milliseconds. At the same time, it maintains a simple and intuitive set of
    commands. It is easy to accomplish a lot with a little code in pandas.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 使pandas独特的是它在处理能力和用户生产力之间取得的平衡。通过依赖C等底层语言进行许多计算，该库可以高效地将百万行数据集在毫秒内转换。同时，它保持了一套简单直观的命令。在pandas中，用少量代码就能完成很多事情。
- en: Figure 1.2 shows some sample pandas code that imports and sorts a CSV data set.
    Don’t worry about the code yet, but take a second to notice that the entire operation
    takes only two lines of code.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.2展示了导入和排序CSV数据集的pandas代码示例。现在不用担心代码，但请花点时间注意，整个操作只需要两行代码。
- en: '![](../Images/CH01_F02_Paskhaver.png)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/CH01_F02_Paskhaver.png)'
- en: Figure 1.2 A sample of code that imports and sorts a data set in pandas
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.2 pandas导入和排序数据集的代码示例
- en: Pandas works seamlessly with numbers, text, dates, times, missing data, and
    more. We’ll explore its incredible versatility as we proceed through the more
    than 30 data sets included with this book.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: Pandas可以无缝地与数字、文本、日期、时间、缺失数据等协同工作。随着我们继续研究本书附带超过30个数据集，我们将探索其令人难以置信的通用性。
- en: The first version of pandas was developed in 2008 by software developer Wes
    McKinney, who was working at New York’s AQR Capital Management investment firm.
    Dissatisfied with both Excel and the statistical programming language R, McKinney
    searched for a tool that would make it easy to solve common data problems in the
    financial industry, particularly cleanup and aggregation. Unable to find an ideal
    product, he decided to build one himself. At the time, Python was far from the
    powerhouse it is today, but the beauty of the language inspired McKinney to build
    his library on top of its foundation. “I loved [Python] for its economy of expressions,”
    he stated in Quartz ([http://mng.bz/w0Na](http://mng.bz/w0Na)). “You can express
    complicated ideas in Python with very little code, and it is very easy to read.”
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: Pandas 的第一个版本是由软件工程师 Wes McKinney 在 2008 年开发的，当时他在纽约的 AQR Capital Management
    投资公司工作。对 Excel 和统计编程语言 R 都不满意，McKinney 寻找一种工具，可以轻松解决金融行业中的常见数据问题，特别是清理和聚合。由于找不到理想的产品，他决定自己开发一个。当时，Python
    还远未成为今天的强大语言，但语言的美丽启发了 McKinney 在其基础上构建他的库。“我喜欢 [Python] 因为它的表达式经济，”他在石英杂志([http://mng.bz/w0Na](http://mng.bz/w0Na))中说道。“你可以在
    Python 中用很少的代码表达复杂的思想，而且它非常容易阅读。”
- en: Pandas has seen continual, extensive growth since its release to the public
    in December 2009\. User counts are estimated to be between five and ten million[¹](#pgfId-1079100).
    As of June 2021, pandas has been downloaded more than 750 million times from PyPi,
    the centralized online repository of Python packages ([https://pepy.tech/project/pandas](https://pepy.tech/project/pandas)).
    Its GitHub code repository has more than 30,000 stars (a star is equivalent to
    a “like” on the platform). Pandas questions make up a growing percentage of questions
    on the question-answer aggregator Stack Overflow, suggesting increased user interest.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: Pandas 自2009年12月向公众发布以来，持续且广泛地增长。用户数量估计在五百万到一千万之间[¹](#pgfId-1079100)。截至2021年6月，pandas
    已从 PyPi（Python 包的集中在线仓库）下载超过七亿五千万次([https://pepy.tech/project/pandas](https://pepy.tech/project/pandas))。其
    GitHub 代码仓库拥有超过 30,000 个星标（星标相当于平台上的“点赞”）。Pandas 的问题在问答聚合器 Stack Overflow 上的比例不断增长，这表明用户兴趣的增加。
- en: I would argue that we can even credit pandas for the astronomical growth of
    Python itself. The language has exploded in popularity because of its prevalence
    in data science, a field to which pandas contributes greatly. Python is now the
    most common first language taught at colleges and universities. The TIOBE index,
    a ranking of programming language popularity by search engine traffic, declared
    Python to be the fastest-growing language of 2018 [²](#pgfId-1079110). “If Python
    can keep this pace, it will probably replace C and Java in 3 to 4 years’ time,
    thus becoming the most popular programming language of the world,” wrote TIOBE
    in a press release. As you learn pandas, you’ll also be learning Python, which
    is another perk of the library.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 我认为我们甚至可以将 Python 本身的快速增长归功于 Pandas。由于其在数据科学领域的广泛应用，Python 的流行度急剧上升，而 Pandas
    对此做出了巨大贡献。Python 现在是大学和学院中最常见的第一编程语言。TIOBE 指数，根据搜索引擎流量对编程语言流行度进行排名，宣布 Python 是
    2018 年增长最快的语言[²](#pgfId-1079110)。“如果 Python 能保持这种速度，它可能在 3 到 4 年内取代 C 和 Java，从而成为世界上最流行的编程语言，”TIOBE
    在一份新闻稿中写道。随着你学习 Pandas，你也会学习 Python，这是库的另一个优点。
- en: 1.2.1 Pandas vs. graphical spreadsheet applications
  id: totrans-26
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.2.1 Pandas 与图形电子表格应用比较
- en: Pandas requires a different mindset from a graphical spreadsheet app such as
    Excel. Programming is inherently more verbal than it is visual. We communicate
    with the computer through commands, not clicks. Because it makes fewer assumptions
    about what you’re trying to accomplish, a programming language tends to be more
    unforgiving. It needs to be *told* what to do with no uncertainty. We need to
    issue the correct instructions with the correct inputs in the correct order; otherwise,
    the program will not work.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: Pandas 需要不同于 Excel 这样的图形电子表格应用的不同思维方式。编程本质上是比视觉更口语化的。我们通过命令与计算机交流，而不是点击。由于它对你的目标假设较少，编程语言往往更不宽容。它需要被明确告知要做什么，不能有不确定性。我们需要以正确的顺序提供正确的输入和正确的指令；否则，程序将无法运行。
- en: 'Due to these stricter requirements, pandas has a steeper learning curve than
    Excel or Sheets. But if you have limited experience in Python or programming in
    general, there’s no need to worry! When you’re fiddling with functions such as
    `SUMIF` and `VLOOKUP` in Excel, you’re already thinking like a programmer. The
    process is the same: identify the correct function to use and then supply the
    right inputs in the proper order. Pandas requires an identical set of skills;
    the difference is that we’re communicating with the computer in a more verbose
    language.'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这些更严格的要求，pandas 的学习曲线比 Excel 或 Sheets 更陡峭。但如果你在 Python 或编程方面经验有限，无需担心！当你忙于
    Excel 中的 `SUMIF` 和 `VLOOKUP` 函数时，你已经在像程序员一样思考了。过程是一样的：确定正确的函数并按正确的顺序提供正确的输入。Pandas
    需要相同的一套技能；区别在于我们正在用更冗长的语言与计算机进行交流。
- en: When you become familiar with its complexities, pandas grants you greater power
    and flexibility in your data manipulations. In addition to extending the range
    of your available procedures, programming allows you to automate them. You can
    write a piece of code once and reuse it across multiple files—perfect for those
    pesky daily and weekly reports. It’s important to note that Excel comes bundled
    with Visual Basic for Applications (VBA), a programming language that also enables
    you to automate spreadsheet procedures. I would argue, however, that Python is
    easier to pick up than VBA and has uses beyond data analysis, making it a better
    investment of your time.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 当你熟悉其复杂性时，Pandas 会赋予你在数据处理方面更大的权力和灵活性。除了扩展你可用程序的范围外，编程还允许你自动化它们。你可以编写一段代码，然后在整个多个文件中重复使用——这对于那些讨厌的日常和周报来说非常完美。需要注意的是，Excel
    随附 Visual Basic for Applications (VBA) 编程语言，它也能让你自动化电子表格程序。然而，我认为 Python 比 VBA
    更容易上手，并且用途不仅限于数据分析，这使得它是你时间的更好投资。
- en: There are additional benefits to making the jump from Excel to Python. Jupyter
    Notebook, the coding environment often paired with pandas, allows for more dynamic,
    interactive, and comprehensive reports. A Jupyter Notebook consists of cells,
    each of which contains a chunk of executable code. An analyst can integrate these
    cells with headers, charts, descriptions, annotations, images, videos, diagrams,
    and more. Readers can follow the analyst’s step-by-step logic to see how they
    reached their conclusion, not only their final result.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 从 Excel 跳转到 Python 还有其他好处。与 pandas 经常搭配使用的 Jupyter Notebook 编码环境允许创建更动态、交互性和全面的报告。Jupyter
    Notebook 由单元格组成，每个单元格都包含一段可执行的代码。分析师可以将这些单元格与标题、图表、描述、注释、图片、视频、图表等集成。读者可以跟随分析师的逐步逻辑，了解他们是如何得出结论的，而不仅仅是他们的最终结果。
- en: Another advantage of pandas is Python’s large data science ecosystem. Pandas
    integrates easily with libraries for statistics, natural language processing,
    machine learning, web scraping, data visualization, and more. New libraries appear
    yearly. Experimentation is welcomed. Innovation is constant. These robust tools
    sometimes remain underdeveloped in corporate competitors, which lack the support
    of a large, global community of contributors.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: Pandas 的另一个优点是 Python 的庞大数据科学生态系统。Pandas 可以轻松与用于统计、自然语言处理、机器学习、网络爬取、数据可视化等方面的库集成。每年都会出现新的库。实验受到欢迎。创新是持续的。这些强大的工具在缺乏大型、全球贡献者社区支持的竞争对手中有时没有得到充分开发。
- en: Graphical spreadsheet applications also begin to struggle as data sets grow;
    pandas is significantly more powerful than Excel in this aspect. The capacity
    of the library is limited only by the computer’s memory and processing power.
    On most modern machines, pandas plays well with multigigabyte data sets with millions
    of rows, especially when a developer knows how to exploit all its performance
    optimizations. In a blog post describing the limitations of the library, creator
    Wes McKinney wrote, “Nowadays, my rule of thumb for pandas is that you should
    have 5 to 10 times more RAM as the size of your data set” ([http://mng.bz/qeK6](http://mng.bz/qeK6)).
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 当数据集增长时，图形电子表格应用也开始遇到困难；在这一点上，Pandas 比 Excel 强大得多。库的容量仅受计算机内存和处理能力的限制。在大多数现代机器上，当开发者知道如何利用所有性能优化时，pandas
    可以很好地处理具有数百万行和数吉字节数据集。在描述库限制的一篇博客文章中，创建者 Wes McKinney 写道：“如今，我对于 pandas 的经验法则是，你应该有比你的数据集大
    5 到 10 倍的 RAM” ([http://mng.bz/qeK6](http://mng.bz/qeK6))。
- en: Part of the challenge in choosing the best tool for the job is defining what
    terms such as data analysis and big data mean to your organization and your project.
    Excel, which is used by approximately 750 million working professionals globally,
    limits its spreadsheets to 1,048,576 rows of data[³](#pgfId-1079128). For some
    analysts, 1 million rows of data are more than any report requires; for others,
    1 million rows only scratch the surface.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 选择最适合工作的最佳工具的一部分挑战在于定义数据分析和大数据等术语对你所在的组织和项目意味着什么。全球大约有 7.5 亿个工作专业人士使用 Excel，其电子表格限制在
    1,048,576 行数据[³](#pgfId-1079128)。对于一些分析师来说，100 万行数据已经超过了任何报告的需求；而对于其他人来说，100 万行数据只是触及了表面。
- en: I would advise you to look at pandas as being not the best data analysis solution
    but a powerful option to use alongside other modern technologies. Excel is still
    an excellent choice for quick, easy data manipulations. A spreadsheet application
    usually makes assumptions about your intent, which is why it takes only a few
    clicks to import a CSV file or sort a column of 100 values. There’s no real advantage
    to using pandas for simple tasks like these (although it’s more than capable of
    doing them). But what do you use when you need to clean text values in two data
    sets of ten million rows each, remove their duplicate records, join them, and
    replicate that logic for 100 batches of files? For those scenarios, it’s easier
    and less time-consuming to do the work with Python and pandas.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 我建议您将 pandas 视为不是最佳的数据分析解决方案，而是一个与其他现代技术一起使用的强大选项。Excel 仍然是快速、轻松进行数据操作的一个优秀选择。电子表格应用程序通常会假设你的意图，这就是为什么只需点击几下就可以导入
    CSV 文件或排序 100 个值的列。对于这些简单任务，使用 pandas 并没有真正的优势（尽管它完全能够完成这些任务）。但是，当你需要清理两个各包含一千万行数据的文本值，删除它们的重复记录，将它们合并，并为
    100 批次的文件复制这种逻辑时，你会使用什么？在这些情况下，使用 Python 和 pandas 来完成工作既容易又节省时间。
- en: 1.2.2 Pandas vs. its competitors
  id: totrans-35
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.2.2 Pandas 与其竞争对手
- en: Data science enthusiasts frequently compare pandas with the open source programming
    language R and the proprietary software suite SAS. Each solution has its own community
    of advocates.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 数据科学爱好者经常将 pandas 与开源编程语言 R 和专有软件套件 SAS 进行比较。每种解决方案都有自己的支持者社区。
- en: R is a specialized language with a foundation in statistics, whereas Python
    is a generalist language used in multiple technical domains. Predictably, the
    two languages tend to attract users with expertise in specific fields. Hadley
    Wickham, a prominent developer in the R community who built a collection of data
    science packages called tidyverse, advises users to see the two languages as collaborators
    rather than rivals. “These things exist independently and are both awesome in
    different ways,” he said in Quartz ([http://mng.bz/Jv9V](http://mng.bz/Jv9V)).
    “A pattern that I see is that the data science team in a company uses R and the
    data engineering team uses Python. The Python people tend to have a background
    in software engineering and are very confident about their programming skills.
    . . . [The R users] really like R, but can’t argue with the engineering team because
    they don’t have the language to make that argument.” One language may have an
    advanced feature that the other does not, but the two have achieved near parity
    when it comes to common tasks in data analysis. Developers and data scientists
    simply gravitate to what they know best.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: R 是一种以统计学为基础的专用语言，而 Python 则是一种在多个技术领域被广泛使用的通用语言。不出所料，这两种语言往往吸引着特定领域内的专家用户。Hadley
    Wickham，R 社区的一位杰出开发者，他构建了一个名为 tidyverse 的数据科学包集合，建议用户将这两种语言视为合作伙伴而非竞争对手。“这些事物独立存在，并以不同的方式都很出色，”他在《石英》杂志（[http://mng.bz/Jv9V](http://mng.bz/Jv9V)）中说。“我观察到的一个模式是，公司的数据科学团队使用
    R，而数据工程团队使用 Python。Python 人员通常拥有软件工程背景，并且对自己的编程技能非常自信……[R 用户] 真的喜欢 R，但无法与工程团队争论，因为他们没有语言来支持这种争论。”一种语言可能具有另一种语言所不具备的高级功能，但在数据分析的常见任务方面，两者已经达到了近乎对等的状态。开发者和数据科学家只是简单地倾向于使用他们最擅长的工具。
- en: A suite of complementary software tools that supports statistics, data mining,
    econometrics, and more, SAS is a commercial product developed by the North Carolina-based
    SAS Institute. It charges an annual user subscription fee that varies based on
    the bundle of selected software. The advantages conferred by a corporate-backed
    product include technical and visual consistency across tools, robust documentation,
    and a product road map geared towards enterprise clients’ needs. Open source technology
    like pandas enjoys a more free-for-all approach; developers work for their needs
    and for other developers’ needs, which sometimes miss market trends.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 一套支持统计学、数据挖掘、计量经济学等互补的软件工具，SAS 是由北卡罗来纳州立大学的 SAS Institute 开发的商业产品。它根据所选软件包的不同收取年度用户订阅费。由企业支持的产品带来的优势包括工具之间的技术和视觉一致性、强大的文档，以及面向企业客户需求的产品路线图。像
    pandas 这样的开源技术则采用更自由的方法；开发者根据自身和其他开发者的需求进行工作，有时会错过市场趋势。
- en: 'Certain technologies share features with pandas but serve intrinsically different
    purposes. SQL is one example. *SQL* (Structured Query Language) is a language
    for communicating with relational databases. A *relational database* consists
    of tables of data linked by common keys. We can use SQL for basic data manipulations
    such as extracting columns from tables and filtering rows by a criterion, but
    its functionalities are greater in scope and fundamentally revolve around data
    management. Databases are built to *store* data; data analysis is a secondary
    use case. SQL can create new tables, update existing records with new values,
    delete existing records, and so on. By comparison, pandas is built entirely for
    data analysis: statistical calculations, data wrangling, data merges, and more.
    In a typical work environment, the two tools often serve as complements. An analyst
    might use SQL to extract an initial cluster of data and then use pandas to manipulate
    it.'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 某些技术与 pandas 具有相似的功能，但本质上服务于不同的目的。SQL 是一个例子。*SQL*（结构化查询语言）是一种与关系数据库通信的语言。*关系数据库*由通过公共键链接的数据表组成。我们可以使用
    SQL 进行基本的数据操作，例如从表中提取列和根据标准过滤行，但其功能范围更广，并且本质上围绕数据管理展开。数据库是为了 *存储* 数据而构建的；数据分析是次要的使用案例。SQL
    可以创建新表，用新值更新现有记录，删除现有记录等。相比之下，pandas 完全是为了数据分析而构建的：统计计算、数据处理、数据合并等。在典型的工作环境中，这两个工具通常作为互补使用。分析师可能会使用
    SQL 提取初始数据集，然后使用 pandas 对其进行操作。
- en: In summary, pandas is not the only tool in town, but it is a powerful, popular,
    and valuable solution for solving most data analysis problems. Again, Python truly
    shines in its focus on brevity and productivity. As its creator, Guido van Rossum,
    remarked, “The joy of coding Python should be in seeing short, concise, readable
    [data structures] that express a lot of action in a small amount of clear code”
    ([http://mng.bz/7jo7](http://mng.bz/7jo7)). Pandas lives up to that standard and
    is an excellent next step for spreadsheet analysts who are eager to grow their
    programming skills with a powerful, modern data analysis toolkit.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，pandas 不是市场上唯一的工具，但它是一个强大、流行且宝贵的解决方案，用于解决大多数数据分析问题。再次强调，Python 在其简洁和高效方面真正闪耀。正如其创造者
    Guido van Rossum 所言，“编写 Python 的乐趣在于看到简洁、紧凑、易读的 [数据结构]，这些结构在少量清晰的代码中表达了大量的操作”
    ([http://mng.bz/7jo7](http://mng.bz/7jo7))。Pandas 符合这一标准，并且是那些渴望通过强大的现代数据分析工具包提升编程技能的电子表格分析师的绝佳下一步。
- en: 1.3 A tour of pandas
  id: totrans-41
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.3 pandas 概览
- en: The best way to grasp the power of pandas is to see it in action. Let’s take
    a quick tour of the library by analyzing a data set of the 700 highest-grossing
    movies of all time. I hope you are pleasantly surprised by how intuitive the syntax
    of pandas can be, even if you are new to programming.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 要真正掌握 pandas 的强大功能，最好的方式是看到它在实际中的应用。让我们快速浏览这个库，通过分析史上票房最高的 700 部电影的数据集来进行。我希望你会对
    pandas 的语法如何直观感到惊喜，即使你是编程新手。
- en: As you proceed through the rest of the chapter, try not to overanalyze the code
    samples; you don’t even need to copy them. Our goal right now is to get a bird’s-eye
    view of the features and functionalities of pandas. Think about what the library
    can do; we’ll worry about how in greater detail later.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在阅读本章的其余部分时，请尽量不要过度分析代码示例；你甚至不需要复制它们。我们现在的目标是获得 pandas 特性和功能的鸟瞰图。想想这个库能做什么；我们将在稍后更详细地关注如何实现。
- en: We’ll be using the Jupyter Notebook development environment to write our code
    throughout the book. If you need help setting up pandas and Jupyter Notebook on
    your computer, see appendix A. You can download all data sets and completed Jupyter
    Notebooks at [https://www.github.com/paskhaver/pandas-in-action](https://www.github.com/paskhaver/pandas-in-action).
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本书中使用的 Jupyter Notebook 开发环境中编写代码。如果您需要在您的计算机上设置 pandas 和 Jupyter Notebook，请参阅附录
    A。您可以在 [https://www.github.com/paskhaver/pandas-in-action](https://www.github.com/paskhaver/pandas-in-action)
    下载所有数据集和完成后的 Jupyter Notebook。
- en: 1.3.1 Importing a data set
  id: totrans-45
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.1 导入数据集
- en: 'Let’s get started! First, we’ll create a new Jupyter Notebook inside the same
    directory as the movies.csv file; then we’ll import the pandas library to gain
    access to its features:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始吧！首先，我们将在与 movies.csv 文件相同的目录内创建一个新的 Jupyter Notebook；然后我们将导入 pandas 库以访问其功能：
- en: '[PRE0]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The box to the left of the code (displaying the number 1 in the previous example)
    marks the cell’s execution order relative to the launch or restart of the Jupyter
    Notebook. You can execute the cells in any order, and you can execute the same
    cell multiple times.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 代码左侧的框（在先前的示例中显示数字 1）标记了单元格相对于 Jupyter Notebook 的启动或重启的执行顺序。您可以按任何顺序执行单元格，并且可以多次执行相同的单元格。
- en: As you read through the book, you are encouraged to experiment by executing
    different snippets of code in your Jupyter cells. Thus, it is OK if your execution
    numbers do not match those in the text.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 阅读本书时，鼓励你在 Jupyter 单元中执行不同的代码片段进行实验。因此，如果你的执行次数与文本中的不一致是完全可以接受的。
- en: 'Our data is stored in a single movies.csv file. A CSV (comma-separated values)
    file is a plain-text file that separates each row of data with a line break and
    each row value with a comma. The first row in the file holds the column headers
    for the data. Here’s a preview of the first three rows of movies.csv:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的数据存储在一个单独的 movies.csv 文件中。CSV（逗号分隔值）文件是一种纯文本文件，它使用换行符分隔每一行数据，使用逗号分隔每一行值。文件的第一行包含数据的列标题。以下是
    movies.csv 文件前三行的预览：
- en: '[PRE1]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The first row lists the five columns in the data set: Rank, Title, Studio,
    Gross, and Year. The second row holds the first record or, equivalently, the data
    for the first movie. The film has a Rank of 1, a Title of `"Avengers:` `Endgame"`,
    a Studio of `"Buena` `Vista"`, a Gross of `"$2,796.30"`, and a Year of `2019`.
    The next line holds the values for the next movie, and the pattern repeats for
    the remaining 750-plus rows in the data set.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 第一行列出了数据集中的五个列：排名、标题、工作室、总收入和年份。第二行包含第一条记录，或者说第一条电影的记录。这部电影排名为 1，标题为 `"复仇者联盟：终局之战"`，工作室为
    `"Buena Vista"`，总收入为 `"$2,796.30"`，年份为 `2019`。下一行包含下一部电影的值，数据集中的剩余 750 多行按此模式重复。
- en: 'Pandas can import various file types, each of which has an associated import
    function at the top level of the library. A *function* in pandas is equivalent
    to a function in Excel. It’s a command that we issue, either to the library or
    an entity within it. In this scenario, we’ll use the `read_csv` function to import
    the movies.csv file:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: Pandas 可以导入各种文件类型，每种类型在库的顶层都有一个相关的导入函数。在 Pandas 中，*函数*相当于 Excel 中的函数。它是一个我们发出的命令，无论是针对库还是库中的实体。在这种情况下，我们将使用
    `read_csv` 函数来导入 movies.csv 文件：
- en: '[PRE2]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Pandas imports the CSV file’s contents into an object called a `DataFrame`.
    Think of an object as a container for storing data. Different objects are optimized
    for different types of data, and we interact with them in different ways. Pandas
    uses one type of object (the `DataFrame`) to store multicolumn data sets and another
    type of object (the `Series`) to store single-column data sets. A `DataFrame`
    is comparable to a multicolumn table in Excel.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: Pandas 将 CSV 文件的全部内容导入一个名为 `DataFrame` 的对象中。将对象视为存储数据的容器。不同的对象针对不同类型的数据进行了优化，并且我们以不同的方式与它们交互。Pandas
    使用一种类型的对象（`DataFrame`）来存储多列数据集，另一种类型的对象（`Series`）来存储单列数据集。`DataFrame` 可以与 Excel
    中的多列表格相媲美。
- en: To avoid cluttering the screen, pandas displays only the first five and last
    five rows of the `DataFrame`. A row of ellipses ( . . . ) marks where the data
    gap occurs.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免屏幕混乱，pandas 只显示 `DataFrame` 的前五行和后五行。一行省略号（...）标记了数据缺失的位置。
- en: This `DataFrame` consists of five columns (Rank, Title, Studio, Gross, Year)
    and an index. The index is the range of ascending numbers on the left side of
    the `DataFrame`. Index labels serve as identifiers for rows of data. We can set
    any column as the index of the `DataFrame`. When we do not explicitly tell pandas
    which column to use, the library generates a numeric index starting from 0.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 这个`DataFrame`由五个列（排名、标题、工作室、总收入、年份）和一个索引组成。索引是`DataFrame`左侧上升数字的范围。索引标签作为数据行标识符。我们可以将任何列设置为`DataFrame`的索引。当我们没有明确告诉pandas使用哪一列时，库会生成从0开始的数字索引。
- en: 'What column is a good candidate for the index? It’s one whose values can act
    as a primary identifier or point of reference for each row. Among our five columns,
    Rank and Title are the two best options. Let’s swap the autogenerated numeric
    index with the values from the Title column. We can do so directly during the
    CSV import:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 哪一列是作为索引的好候选？它是指可以充当每行主标识符或参考点的值。在我们的五列中，排名和标题是两个最佳选项。让我们将自动生成的数字索引与标题列的值交换。我们可以在CSV导入期间直接这样做：
- en: '[PRE3]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Next, we’ll assign the `DataFrame` to a `movies` variable so that we can reference
    it elsewhere in our program. A *variable* is a user-assigned name for an object
    in the program:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将`DataFrame`分配给一个名为`movies`的变量，这样我们就可以在程序的其它地方引用它。*变量*是程序中对象的用户分配的名称：
- en: '[PRE4]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: For more on variables, check out appendix B.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 更多关于变量的信息，请参阅附录B。
- en: 1.3.2 Manipulating a DataFrame
  id: totrans-63
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.2 操作DataFrame
- en: 'We can look at the `DataFrame` from a variety of angles. We can extract a few
    rows from the beginning:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以从`DataFrame`的多个角度来观察。我们可以从开头提取几行：
- en: '[PRE5]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Or we can peek at the end of the data set instead:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 或者我们可以查看数据集的末尾：
- en: '[PRE6]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'We can find out how many rows the `DataFrame` has:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以找出`DataFrame`有多少行：
- en: '[PRE7]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'We can ask pandas for the number of rows and columns in the `DataFrame`. This
    data set has 782 rows and 4 columns:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以询问`DataFrame`中的行数和列数。这个数据集有782行和4列：
- en: '[PRE8]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'We can inquire about the total number of cells:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以询问总共有多少个单元格：
- en: '[PRE9]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'We can ask for the data types of the four columns. In the following output,
    `int64` denotes an integer column, and `object` denotes a text column:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以询问四个列的数据类型。在以下输出中，`int64`表示整数列，而`object`表示文本列：
- en: '[PRE10]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'We can extract a row from the data set by its numeric order in line, also called
    its index position. In most programming languages, the index starts counting at
    0\. Thus, if we wanted to pull out the 500th movie in the data set, we would target
    index position 499:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过数据集的行号（也称为索引位置）来提取一行。在大多数编程语言中，索引从0开始计数。因此，如果我们想提取数据集中的第500部电影，我们将目标设置为索引位置499：
- en: '[PRE11]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Pandas returns a new object here called a `Series`, a one-dimensional labeled
    array of values. Think of it as a single column of data with an identifier for
    each row. Notice that the `Series`’ index labels (Rank, Studio, Gross, and Year)
    are the four columns from the `movies` `DataFrame`. Pandas has altered the presentation
    of the original row’s values.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: Pandas在这里返回一个新的对象，称为`Series`，它是一个一维带标签的值数组。将其视为带有每行标识符的单列数据。注意，`Series`的索引标签（排名、工作室、总收入和年份）是`movies`
    `DataFrame`中的四列。Pandas已经改变了原始行值的展示方式。
- en: 'We can also use an index label to access a `DataFrame` row. As a reminder,
    our `DataFrame` index holds the films’ titles. Let’s extract the row values for
    everyone’s favorite tearjerker, *Forrest Gump*. The next example extracts a row
    by its index label rather than its numeric position:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也可以使用索引标签来访问`DataFrame`中的行。作为提醒，我们的`DataFrame`索引包含电影的标题。让我们提取每个人最喜欢的催泪电影《阿甘正传》的行值。下一个示例通过索引标签而不是数字位置提取行：
- en: '[PRE12]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Index labels can contain duplicates. Two movies in the `DataFrame` have the
    title `"101` `Dalmatians"`, for example (the 1961 original and the 1996 remake):'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 索引标签可以包含重复项。例如，`DataFrame`中有两部电影标题为`"101 Dalmatians"`（1961年的原版和1996年的重拍版）：
- en: '[PRE13]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Although pandas permits duplicates, I recommend keeping index labels unique
    if possible. A unique collection of labels accelerates the speed at which pandas
    can locate and extract a specific row.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然pandas允许重复项，但如果可能的话，我建议保持索引标签唯一。唯一的标签集合可以加快pandas定位和提取特定行的速度。
- en: 'The films in the CSV are sorted by values in the Rank column. What if we wanted
    to see the five movies with the most recent release date? We can sort the `DataFrame`
    by the values in another column, such as Year:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: CSV中的电影按排名列的值排序。如果我们想看到最近上映的五部电影，怎么办？我们可以按另一列的值对`DataFrame`进行排序，例如年份：
- en: '[PRE14]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'We can also sort `DataFrames` by values across multiple columns. Let’s sort
    `movies` first by the Studio column’s values and then by the Year column’s values.
    Now we can see the films organized alphabetically by both studio and release date:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以根据多个列的值对`DataFrame`进行排序。让我们首先按Studio列的值对`movies`进行排序，然后按Year列的值进行排序。现在我们可以看到按工作室和发行日期字母顺序组织的电影：
- en: '[PRE15]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'We can also sort the index, which is helpful if we want to see the movies in
    alphabetical order:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以对索引进行排序，如果我们想按字母顺序查看电影，这很有帮助：
- en: '[PRE16]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: The operations we’ve performed so far return new `DataFrame` objects. Pandas
    has not altered the original `movies` `DataFrame` from the CSV file. The nondestructive
    nature of these operations is beneficial; it actively encourages experimentation.
    We can always confirm that a result is correct before making it permanent.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 我们迄今为止执行的操作返回新的`DataFrame`对象。Pandas没有改变来自CSV文件的原始`movies` `DataFrame`。这些操作的非破坏性性质是有益的；它积极鼓励实验。我们总是在将其永久化之前确认结果是否正确。
- en: 1.3.3 Counting values in a Series
  id: totrans-91
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.3 在Series中计数值
- en: Let’s try a more sophisticated analysis. What if we wanted to find out which
    movie studio had the greatest number of highest-grossing films? To solve this
    problem, we’ll need to count the number of times each studio appears in the Studio
    column.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们尝试一个更复杂的分析。如果我们想知道哪个电影工作室拥有最多的高票房电影，我们需要解决这个问题，我们需要计算每个工作室在Studio列中出现的次数。
- en: 'We can extract a single column of data from a `DataFrame` as a `Series`. Notice
    that pandas preserves the `DataFrame`’s index, the movie titles, in the `Series`:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以从`DataFrame`中提取单个数据列作为`Series`。注意，pandas保留了`DataFrame`的索引，即电影标题，在`Series`中：
- en: '[PRE17]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: If a `Series` has a large number of rows, pandas truncates the data set to show
    only the first five and the last five rows.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一个`Series`有大量的行，pandas会截断数据集，只显示前五行和后五行。
- en: 'Now that we’ve isolated the Studio column, we can count each unique value’s
    number of occurrences. Let’s limit our results to the top 10 studios:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经隔离了Studio列，我们可以计算每个唯一值的出现次数。让我们将结果限制在前10个工作室：
- en: '[PRE18]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: The return value above is yet another `Series` object! This time around, pandas
    uses the studios from the Studio column as the index labels and their counts as
    the `Series` values.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的返回值是另一个`Series`对象！这次，pandas使用Studio列中的工作室作为索引标签，它们的计数作为`Series`的值。
- en: 1.3.4 Filtering a column by one or more criteria
  id: totrans-99
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.4 通过一个或多个标准过滤列
- en: You’ll often want to extract a subset of rows based on one or more criteria.
    Excel offers the Filter tool for this exact purpose.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 你通常会想根据一个或多个标准提取行子集。Excel提供了过滤工具来完成这个目的。
- en: 'What if we wanted to find only the films released by Universal Studios? We
    can accomplish this task with one line of code in pandas:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们只想找到由环球公司发行的电影，我们可以用一行代码在pandas中完成这个任务：
- en: '[PRE19]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'We can assign the filtering condition to a variable to provide context for
    readers:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将过滤条件分配给一个变量，为读者提供上下文：
- en: '[PRE20]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'We can also filter `DataFrame` rows by multiple criteria. The next example
    targets all movies released by Universal Studios *and* released in 2015:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以根据多个标准过滤`DataFrame`的行。下一个例子针对所有由环球公司发行且在2015年发行的电影：
- en: '[PRE21]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The previous example includes rows that satisfied both conditions. We can also
    filter for films that fit either condition: released by Universal *or* released
    in 2015\. The resulting `DataFrame` is longer because more films have a chance
    of satisfying one of the two conditions instead of both:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的例子包括了满足两个条件都成立的行。我们也可以筛选出符合任一条件的电影：由环球公司发行*或*在2015年发行的。由于更多电影有机会满足这两个条件中的一个而不是两个，所以结果`DataFrame`更长：
- en: '[PRE22]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Pandas provides additional ways to filter a `DataFrame`. We can target column
    values less than or greater than a specific value, for example. Here, we target
    movies released before 1975:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: Pandas提供了额外的过滤`DataFrame`的方法。例如，我们可以针对小于或大于特定值的列值进行目标定位。在这里，我们针对1975年之前发行的电影：
- en: '[PRE23]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'We can also specify a range between which all values must fall. The next example
    pulls out movies released between 1983 and 1986:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以指定一个范围，所有值都必须落在这个范围内。下一个例子提取了1983年至1986年间发行的电影：
- en: '[PRE24]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'We can also use the `DataFrame` index to filter rows. The next example lowercases
    the movie titles in the index and finds all movies with the word `"dark"` in their
    title:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以使用`DataFrame`的索引来过滤行。下一个例子将索引中的电影标题转换为小写，并找到标题中包含单词`"dark"`的所有电影：
- en: '[PRE25]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Notice that pandas finds all movies containing the word `"dark"` irrespective
    of where the text appears in the title.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，pandas会找到所有包含单词`"dark"`的电影，无论该文本出现在标题的哪个位置。
- en: 1.3.5 Grouping data
  id: totrans-116
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.5 数据分组
- en: Our next challenge is the most complex one yet. We might be curious which studio
    had the highest total grosses across all films. Let’s aggregate the values in
    the Gross column by studio.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 我们面临的下一个挑战是最复杂的。我们可能好奇哪个工作室在所有电影中的总收入最高。让我们按工作室对总收入列的值进行汇总。
- en: 'Our first dilemma is that the Gross column’s values are stored as text rather
    than as numbers. Pandas imported the column’s values as text to preserve the dollar
    signs and comma symbols in the original CSV. We can convert the column’s values
    to decimal numbers, but only if we remove both of those characters. The next example
    replaces all occurrences of `"$"` and `","` with empty text. This operation is
    similar to Find and Replace in Excel:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 我们面临的第一道难题是，总收入列的值存储为文本而不是数字。Pandas 将该列的值作为文本导入以保留原始 CSV 中的美元符号和逗号符号。我们可以将列的值转换为小数数字，但前提是必须删除这两个字符。下一个示例将所有出现的
    `"$"` 和 `","` 替换为空文本。这个操作类似于 Excel 中的查找和替换：
- en: '[PRE26]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'With the symbols gone, we can convert the Gross column’s values from text to
    floating-point numbers:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 去掉符号后，我们可以将总收入列的值从文本转换为浮点数：
- en: '[PRE27]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Once again, these operations are temporary and do not modify the original Gross
    `Series`. In all the previous examples, pandas created a copy of the original
    data structure, performed the operation, and returned a new object. The next example
    explicitly overwrites the Gross column in `movies` with a new column of decimal-point
    numbers. Now the transformation is permanent:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 这些操作是临时的，并不会修改原始的总收入 `Series`。在前面的所有示例中，pandas 创建了原始数据结构的副本，执行了操作，并返回了一个新对象。下一个示例明确地将
    `movies` 中的总收入列覆盖为一个新的以小数点分隔的数字列。现在这个转换是永久的：
- en: '[PRE28]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Our data type conversion opens the door to more calculations and manipulations.
    The next example calculates the average box-office gross of the movies:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的数据类型转换打开了更多计算和操作的大门。下一个示例计算电影的平均票房总收入：
- en: '[PRE29]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Let’s return to our original problem: calculating the aggregate box-office
    grosses per film studio. First, we’ll need to identify the studios and bucket
    the movies (or rows) that belong to each one. This process is called *grouping*.
    In the next example, we group the `DataFrame`’s rows based on values in the Studio
    column:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回到最初的问题：计算每个电影工作室的总票房总收入。首先，我们需要识别工作室并将属于每个工作室的电影（或行）进行分类。这个过程称为“分组”。在下一个示例中，我们将
    `DataFrame` 的行根据“工作室”列中的值进行分组：
- en: '[PRE30]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'We can ask pandas to count the number of films per studio:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以要求 pandas 统计每个工作室的电影数量：
- en: '[PRE31]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'The previous results are sorted alphabetically by studio name. We can instead
    sort the `Series` by count of films, from most to least:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的结果是按工作室名称的字母顺序排序的。我们可以改为按电影数量排序 `Series`，从多到少：
- en: '[PRE32]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Next, let’s add the values of the Gross column per studio. Pandas will identify
    the subset of movies that belong to each studio, pull out their row’s respective
    Gross values, and sum them together:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们为每个工作室添加总收入的值。Pandas 将识别属于每个工作室的电影子集，提取它们各自的总收入值，并将它们相加：
- en: '[PRE33]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Again, pandas sorts the results by studio name. We want to identify the studios
    with the highest grosses, so let’s sort the `Series` values in descending order.
    Here are the five studios with the greatest grosses:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，pandas 按工作室名称对结果进行排序。我们想要识别总收入最高的工作室，所以让我们按降序对 `Series` 中的值进行排序。以下是总收入最高的五个工作室：
- en: '[PRE34]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: With a few lines of code, we can derive some fun insights from this complex
    data set. The Warner Brothers studio, for example, has more movies in the list
    than Buena Vista, but Buena Vista has a higher cumulative gross for all films.
    This fact indicates that the average gross of a Buena Vista film is greater than
    that of a Warner Brothers film.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 通过几行代码，我们可以从这个复杂的数据集中得出一些有趣的见解。例如，华纳兄弟工作室在列表中的电影比迪士尼工作室多，但迪士尼工作室所有电影的累计总收入更高。这一事实表明，迪士尼工作室电影的平均总收入高于华纳兄弟工作室电影。
- en: 'We have barely scratched the surface of what pandas is capable of doing. I
    hope that these examples have shed light on the diverse ways we can manipulate
    and transform data with this powerful library. We’ll discuss all the code used
    in this chapter in much greater detail throughout the book. Next, we’ll dive into
    a core building block of pandas: the `Series` object.'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 我们只是刚刚触及 pandas 能够做到的事情的表面。我希望这些示例已经阐明了我们可以用这个强大的库以多种方式操纵和转换数据。我们将在整本书中更详细地讨论本章中使用的所有代码。接下来，我们将深入探讨
    pandas 的核心构建块：`Series` 对象。
- en: Summary
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Pandas is a data analysis library built on top of the Python programming language.
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Pandas 是一个基于 Python 编程语言构建的数据分析库。
- en: Pandas excels at performing complex operations on large data sets with a terse
    syntax.
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Pandas 在使用简洁的语法对大型数据集执行复杂操作方面表现出色。
- en: Competitors to pandas include the graphical spreadsheet application Excel, the
    statistical programming language R, and the SAS software suite.
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Pandas 的竞争对手包括图形电子表格应用 Excel、统计编程语言 R 和 SAS 软件套件。
- en: Programming requires a different skill set than working with Excel or Sheets.
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 编程所需的技能集合与使用 Excel 或 Sheets 工作不同。
- en: Pandas can import a variety of file formats. A popular format is CSV, which
    separates rows with line breaks and row values with commas.
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Pandas 可以导入各种文件格式。一种流行的格式是 CSV，它使用换行符分隔行，使用逗号分隔行值。
- en: The `DataFrame` is the primary data structure in pandas. It is effectively a
    table of data with multiple columns.
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DataFrame` 是 pandas 中的主要数据结构。它实际上是一个具有多列的数据表。'
- en: The `Series` is a one-dimensional labeled array. Think of it as a single column
    of data.
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Series` 是一个一维带标签的数组。可以将其视为数据的一个单列。'
- en: We can access a row in a `Series` or `DataFrame` by its row number or index
    label.
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以通过行号或索引标签访问 `Series` 或 `DataFrame` 中的行。
- en: We can sort a `DataFrame` by values across one or more columns.
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以按一列或多列的值对 `DataFrame` 进行排序。
- en: We can use logical conditions to extract subsets of data from a `DataFrame`.
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以使用逻辑条件从 `DataFrame` 中提取数据子集。
- en: We bucket `DataFrame` rows based on a column’s values. We can also perform aggregate
    operations such as sums on the resulting groups.
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以根据列的值对 `DataFrame` 的行进行分组。我们还可以对结果组执行聚合操作，例如求和。
- en: '* * *'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ¹ See “What’s the future of the pandas library?,” Data School, [https://www.dataschool.io/future-of-pandas](https://www.dataschool.io/future-of-pandas).
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: ¹ 参见“pandas 库的未来是什么？”，Data School，[https://www.dataschool.io/future-of-pandas](https://www.dataschool.io/future-of-pandas)。
- en: '² See Oliver Peckham, “TIOBE Index: Python Reaches Another All-Time High,”
    HPC Wire, [http://mng.bz/w0XP](http://mng.bz/w0XP).'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '² 参见 Oliver Peckham 的文章，“TIOBE Index: Python Reaches Another All-Time High”，HPC
    Wire，[http://mng.bz/w0XP](http://mng.bz/w0XP)。'
- en: '³ See Andy Patrizio, “Excel: Your entry into the world of data analytics,”
    Computer World, [http://mng.bz/qe6r](http://mng.bz/qe6r).'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '³ 参见 Andy Patrizio 的文章，“Excel: Your entry into the world of data analytics”，Computer
    World，[http://mng.bz/qe6r](http://mng.bz/qe6r)。'
