- en: 6 Creating robot web apps
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 6 创建机器人Web应用
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Creating a desktop- and mobile-friendly web application to control robots
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建桌面和移动友好的Web应用以控制机器人
- en: Measuring web application performance using web browser tools
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Web浏览器工具测量Web应用性能
- en: Creating dynamic pages using Tornado templates
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Tornado模板创建动态页面
- en: Enabling enhanced web logging to detect web request failures
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启用增强型Web日志记录以检测Web请求失败
- en: This chapter will teach you how to build a web application to control your robot.
    The application will work equally well on desktop computers and mobile phones.
    The full range of robot movements will be available through the application, along
    with commands that can be used to measure the network performance of the application,
    end to end. As we build the application, you will learn useful techniques for
    measuring the application performance, as well as detecting and fixing certain
    types of web request failures.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '本章将教会你如何构建一个用于控制你的机器人的Web应用。该应用在桌面计算机和手机上都能正常工作。应用将提供完整的机器人运动范围，以及可以用来测量应用网络性能的命令，从端到端。在我们构建应用的过程中，你将学习到测量应用性能的有用技术，以及检测和修复某些类型的Web请求失败。 '
- en: Web applications provide a powerful platform to build a mechanism for controlling
    the robot by a human operator. Web apps are accessible both from the desktop application
    and mobile devices. They also work consistently across the main desktop operating
    systems (i.e., Windows, Mac, and Linux).
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Web应用提供了一个强大的平台，用于构建由人类操作员控制机器人的机制。Web应用既可以从桌面应用程序访问，也可以从移动设备访问。它们在主要的桌面操作系统（即Windows、Mac和Linux）上保持一致的工作。
- en: 6.1 Hardware stack
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6.1 硬件堆栈
- en: Figure 6.1 shows the hardware stack, with the specific components used in this
    chapter highlighted. In this chapter, we can use the mouse as a human-interactive
    device to interact with the robot through our web app.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.1显示了硬件堆栈，本章中使用的特定组件被突出显示。在本章中，我们可以使用鼠标作为人机交互设备，通过我们的Web应用与机器人交互。
- en: '![](../Images/CH06_F01_Alsabbagh.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH06_F01_Alsabbagh.png)'
- en: 'Figure 6.1 Hardware stack: the DC motors will be controlled over the network
    using a web interface.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.1 硬件堆栈：将通过Web界面在网络中控制直流电机。
- en: The web application can be accessed either through wired networks using the
    Ethernet port or wireless networks using the Wi-Fi hardware. The best user experience
    for the mobile access is over the Wi-Fi connection, as it offers full portability.
    When the web interface is accessed from a desktop, a mouse can be used as the
    human interface device to control the robot by clicking on the desired robot movement
    buttons. In later chapters, we will control the robot using a keyboard and a joystick.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: Web应用可以通过有线网络使用以太网端口或无线网络使用Wi-Fi硬件访问。通过Wi-Fi连接进行移动访问的用户体验最佳，因为它提供了完全的便携性。当从桌面访问Web界面时，可以使用鼠标作为人机交互设备，通过点击所需的机器人移动按钮来控制机器人。在后面的章节中，我们将使用键盘和操纵杆来控制机器人。
- en: 6.2 Software stack
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6.2 软件堆栈
- en: Details of the specific software used in this chapter are described in figure
    6.2\. There are three main applications that will be created here. The first is
    a basic web application that displays the current time on the robot server (`basic_web`).
    Then, we will create an application to move the robot forward and backward (`forward_web`).
    Finally, a mobile-friendly application will be created with a full range of robot
    movement commands (`full_web`). The Tornado web framework will be used to create
    these web applications. The built-in template feature of the framework will be
    used to create dynamic content. The `datetime` and `os` Python modules will be
    used to calculate the time on the server and read values from environment variables.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中使用的特定软件的详细信息在图6.2中描述。这里将创建三个主要的应用程序。第一个是一个基本的Web应用，显示机器人服务器上的当前时间（`basic_web`）。然后，我们将创建一个使机器人前后移动的应用程序（`forward_web`）。最后，将创建一个具有完整机器人移动命令的移动友好型应用（`full_web`）。这些Web应用将使用Tornado
    Web框架创建。框架的内置模板功能将用于创建动态内容。将使用`datetime`和`os` Python模块来计算服务器上的时间并从环境变量中读取值。
- en: '![](../Images/CH06_F02_Alsabbagh.png)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH06_F02_Alsabbagh.png)'
- en: 'Figure 6.2 Software stack: web browsers on the network will connect through
    a Tornado web application.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.2 软件堆栈：网络上的Web浏览器将通过Tornado Web应用连接。
- en: 6.3 Moving robots forward and backward over the web
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6.3 通过Web移动机器人前后
- en: 'The first web application we create will perform the basic forward and backward
    robot movements. We need to create a web application to meet the following requirements:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 我们创建的第一个网络应用程序将执行基本的机器人前进和后退运动。我们需要创建一个满足以下要求的网络应用程序：
- en: A Python web application that allows users to move the robot forward and backward
    should be created.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应创建一个 Python 网络应用程序，允许用户控制机器人前进和后退。
- en: The web app should use the HTML5 standard.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络应用程序应使用 HTML5 标准。
- en: The user interface must be desktop and mobile friendly.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户界面必须是桌面和移动友好的。
- en: HTML5 is the latest version of the markup language used on the web, and it offers
    richer features compared to the older versions. For this reason, we have put it
    as a requirement for the application.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: HTML5 是互联网上使用的标记语言最新版本，与旧版本相比，它提供了更丰富的功能。因此，我们将它作为应用程序的要求之一。
- en: 6.3.1 Creating a basic web application
  id: totrans-23
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.3.1 创建基本网络应用程序
- en: 'Let us take some simple first steps and create a web application that displays
    the time on the robot web server. The first step is to import all the required
    modules. From Tornado, we import `IOLoop`, `RequestHandler,` and `Application`,
    as we have done in previous chapters to set up and run our web application. We
    then import `enable_pretty_logging` to enable logging output. The `datetime` object
    will be used to get the current time. The `dirname` function will get the directory
    name of a path. The `os` module will be used to access environment variables:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们采取一些简单的第一步，创建一个显示机器人网络服务器时间的网络应用程序。第一步是导入所有必需的模块。从 Tornado 中，我们导入 `IOLoop`、`RequestHandler`
    和 `Application`，就像我们在前面的章节中做的那样，以设置和运行我们的网络应用程序。然后，我们导入 `enable_pretty_logging`
    以启用日志输出。将使用 `datetime` 对象来获取当前时间。`dirname` 函数将获取路径的目录名。我们将使用 `os` 模块来访问环境变量：
- en: '[PRE0]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The Tornado web framework has a powerful debug mode offering features such
    as automatic reloading and generated error pages that help both when developing
    and debugging a web application. The next line of code sets the global variable
    `DEBUG` to be true or false, depending on whether the environment variable `ROBO_DEBUG`
    has been defined. In this way, the same code can be used for development or production
    use, and its debugging behavior can be defined outside the code base through environment
    variables:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: Tornado 网络框架具有强大的调试模式，提供自动重新加载和生成错误页面等特性，这些特性在开发调试网络应用程序时非常有用。下一行代码设置全局变量 `DEBUG`
    为真或假，这取决于环境变量 `ROBO_DEBUG` 是否已定义。这样，相同的代码可以用于开发或生产使用，并且其调试行为可以通过环境变量在代码库外部定义：
- en: '[PRE1]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The next step is to set `TEMPLATE_PATH` to the path of the templates directory.
    This directory will contain the Tornado template files that will be used to generate
    HTML content. This path is automatically calculated as a subdirectory called `templates`
    in the same directory as the Python code. Place all HTML template files in this
    directory:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是将 `TEMPLATE_PATH` 设置为模板目录的路径。此目录将包含用于生成 HTML 内容的 Tornado 模板文件。此路径自动计算为与
    Python 代码相同的目录下的一个名为 `templates` 的子目录。将所有 HTML 模板文件放置在此目录中：
- en: '[PRE2]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'We can now define the `MainHandler` object that will handle incoming requests.
    It will calculate the current time and save the value as a string in a variable
    called `stamp`. Then, the `basic.html` template is rendered with the `stamp` variable
    and sent to the web browser:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以定义一个 `MainHandler` 对象来处理传入的请求。它将计算当前时间并将该值作为字符串保存在名为 `stamp` 的变量中。然后，使用
    `stamp` 变量渲染 `basic.html` 模板并将其发送到网络浏览器：
- en: '[PRE3]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The last block of code calls `enable_pretty_logging` to enable logging output
    and defines `settings` with the application settings. These settings are then
    provided to `Application`, and the application server is started:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一块代码调用 `enable_pretty_logging` 以启用日志输出，并使用应用程序设置定义 `settings`。然后，这些设置提供给 `Application`，并启动应用程序服务器：
- en: '[PRE4]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The full script can be saved as `basic_web.py` on the Pi.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 整个脚本可以保存为 `basic_web.py` 在 Pi 上。
- en: 'Figure 6.1 `basic_web.py`: Web application that displays the time on the robot'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.1 `basic_web.py`：显示机器人时间的网络应用程序
- en: '[PRE5]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Before we can execute the script, we should create the `basic.html` template.
    We will run through each part of this template file. The first line of the file
    is required to declare to the web browser that this file is using HTML5\. Then,
    we have our opening `html` tag, which defines the document language as English:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们可以执行脚本之前，我们应该创建 `basic.html` 模板。我们将逐部分运行此模板文件。文件的第一行是必需的，用于通知网络浏览器该文件使用 HTML5。然后，我们有我们的
    `html` 开启标签，它定义了文档语言为英语：
- en: '[PRE6]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The next part is the `head` section of the HTML document. The website title
    is provided, and the `meta` tag is then used to set the `viewport` metadata so
    that the web application will be displayed correctly on both desktop and mobile
    browsers. Next, the font for the page is set as `Verdana` using the `style` tag:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个部分是HTML文档的`head`部分。网站标题已提供，然后使用`meta`标签设置`viewport`元数据，以便Web应用程序可以在桌面和移动浏览器上正确显示。接下来，使用`style`标签将页面的字体设置为`Verdana`：
- en: '[PRE7]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The last part of the template contains the `body` portion of the document.
    The `h1` tag is used to provide header content, and finally, the `stamp` template
    variable is then placed under this header to display the current time on the robot:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 模板的最后部分包含文档的`body`部分。使用`h1`标签提供标题内容，最后，将`stamp`模板变量放置在这个标题下以显示当前时间：
- en: '[PRE8]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The template can be saved as `basic.html` on the Pi in the templates directory.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 模板可以保存为`basic.html`在Pi的模板目录中。
- en: 'Figure 6.2 `basic.html`: HTML user interface that displays the time on the
    robot'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.2 `basic.html`：显示机器人时间的HTML用户界面
- en: '[PRE9]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: We can now execute `basic_web.py` to run the web server. You can access the
    web application by visiting the address http://robopi:8888 from a computer on
    your network. Make sure to update the hosts file on the computer to have an entry
    for `robopi`, as described in chapter 5\. You can also access the web app by replacing
    `robopi` in the URL with the IP address of your robot. When accessing the web
    app from a mobile device, using the IP address will be an easier option.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以执行`basic_web.py`来运行Web服务器。您可以通过访问网络上的计算机上的地址http://robopi:8888来访问Web应用程序。请确保更新计算机上的hosts文件，以便有一个`robopi`条目，如第5章所述。您也可以通过将URL中的`robopi`替换为机器人的IP地址来访问Web应用程序。当从移动设备访问Web应用程序时，使用IP地址将是一个更方便的选择。
- en: When you access the web application, it will display the current time on the
    robot server. Refresh the page to see the updated time and confirm that the server
    is responding to multiple requests. Figure 6.3 shows what the application will
    look like.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 当你访问Web应用程序时，它将显示机器人服务器上的当前时间。刷新页面以查看更新时间并确认服务器正在响应多个请求。图6.3显示了应用程序的外观。
- en: '![](../Images/CH06_F03_Alsabbagh.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH06_F03_Alsabbagh.png)'
- en: Figure 6.3 `basic_web:` it displays the current time on the robot server.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.3 `basic_web`：它显示在机器人服务器上的当前时间。
- en: 6.3.2 Detecting failed requests
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.3.2 检测失败的请求
- en: 'Because we have called `enable_pretty_ logging`, we get the benefit of outputting
    the server logs to the terminal. We can inspect this output to see all the incoming
    requests to the web server and the given responses. Try to access the web application
    again from multiple browsers or computers. What follows is the log output after
    the application has been accessed from multiple browsers and computers:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们调用了`enable_pretty_logging`，我们得到了将服务器日志输出到终端的好处。我们可以检查这个输出以查看所有传入Web服务器的请求和给定的响应。尝试从多个浏览器或计算机再次访问Web应用程序。以下是从多个浏览器和计算机访问应用程序后的日志输出：
- en: '[PRE10]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: We can see that after the page is loaded, the browser tries to fetch a file
    called `favicon.ico` and fails with a “404 not found” HTTP error. This is because
    we haven’t defined a proper way to handle these requests, so they are failing.
    In the next upgrade, we can address this problem and check the server logs after
    the change to confirm that the situation has been resolved. This log output is
    also a great way to see how long it takes for Tornado to provide a response, as
    the response times also appear in the log output.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，在页面加载后，浏览器试图获取一个名为`favicon.ico`的文件，并因“404 not found”的HTTP错误而失败。这是因为我们还没有定义一个适当的方式来处理这些请求，所以它们失败了。在下一个升级中，我们可以解决这个问题，并在更改后检查服务器日志以确认问题已解决。这个日志输出也是查看Tornado提供响应所需时间的一个很好的方式，因为响应时间也会出现在日志输出中。
- en: 6.3.3 Moving robots forward with web apps
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.3.3 使用Web应用向前移动机器人
- en: 'Now we will add the forward and backward movements to our application. We will
    once again import the `motor` module to control the robot’s movements:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将向我们的应用程序添加前进和后退动作。我们将再次导入`motor`模块来控制机器人的动作：
- en: '[PRE11]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The `Application` object will be enhanced to handle different request URLs
    and parse the action from the path being requested. The regular expression `/([a-z_]*)`
    is used to match a path consisting of lowercase letters and the underscore character.
    This pattern will match all the available movement commands:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '`Application`对象将被增强以处理不同的请求URL并解析请求路径中的动作。正则表达式`/([a-z_]*)`用于匹配由小写字母和下划线字符组成的路径。此模式将匹配所有可用的移动命令：'
- en: '[PRE12]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'We now update the `get` method to receive the `name` argument and to render
    the `forward.html` template:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在更新`get`方法以接收`name`参数并渲染`forward.html`模板：
- en: '[PRE13]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'As done in previous chapters, we will only process movement commands when they
    come in as `post` requests. The `post` method will then check the value of the
    `name` variable and call the related movement function. It will then redirect
    the browser to the web application home page using the `redirect` method:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 如前几章所述，我们只有在运动命令作为`post`请求传入时才会处理运动命令。然后`post`方法将检查`name`变量的值并调用相关的运动函数。之后，它将使用`redirect`方法将浏览器重定向到Web应用程序主页：
- en: '[PRE14]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The full script can be saved as `forward_web.py` on the Pi.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 完整脚本可以保存为`forward_web.py`在Pi上。
- en: 'Figure 6.3 `forward_web.py`: Web application to move the robot forward and
    backward'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.3 `forward_web.py`：用于移动机器人前后移动的Web应用程序
- en: '[PRE15]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'We can now upgrade the HTML template. To resolve the `favicon` problem, we
    use the following HTML in the `head` portion of our template. This sets no icon
    for the page and thus instructs the web browser not to fetch the `favicon` file
    from the web server:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以升级HTML模板。为了解决`favicon`问题，我们在模板的`head`部分使用以下HTML。这为页面设置无图标，从而指示网络浏览器不要从网络服务器获取`favicon`文件：
- en: '[PRE16]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'In the main body of the document, we add two forms. Each form will submit its
    data, using the `post` method, to either the `forward` path or the `backward`
    path. The submit buttons for each form have a label that matches the movement
    action for that form:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在文档的主体中，我们添加了两个表单。每个表单将使用`post`方法提交其数据，到`forward`路径或`backward`路径。每个表单的提交按钮都有一个标签，与该表单的运动动作相匹配：
- en: '[PRE17]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The template can be saved as `forward.html` on the Pi in the templates directory.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 模板可以保存为`forward.html`在Pi的模板目录中。
- en: 'Figure 6.4 `forward.html`: HTML to move the robot forward and backward'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.4 `forward.html`：用于移动机器人的前后移动的HTML
- en: '[PRE18]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'We can now execute `forward_web.py` to run the web server. When you access
    the web application, press the forward and backward buttons to move the robot
    backward and forward. Figure 6.4 shows what the application will look like now
    with these new buttons. We can inspect the log output from a session using the
    application:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以执行`forward_web.py`来运行网络服务器。当你访问网络应用程序时，按下前后按钮来移动机器人前后。图6.4显示了现在带有这些新按钮的应用程序的外观。我们可以检查应用程序会话的日志输出：
- en: '[PRE19]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![](../Images/CH06_F04_Alsabbagh.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/CH06_F04_Alsabbagh.png)'
- en: Figure 6.4 `forward_web:` it provides buttons to move the robot forward and
    backward.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.4 `forward_web:`它提供了移动机器人前后按钮。
- en: In the log output, we can see the robot was moved forward once and then backward
    twice. From the logs, we can see that it usually takes 2 ms to render the main
    page. It takes around 224 ms to perform a robot movement. The default duration
    set for a robot movement in the `motor` module is 200 ms. Therefore, these numbers
    are what we would expect. Finally, we can see the “favicon not found errors” have
    also been resolved, as they are no longer appearing in the request logs.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在日志输出中，我们可以看到机器人向前移动了一次，然后向后移动了两次。从日志中，我们可以看到渲染主页面通常需要2毫秒。执行机器人移动大约需要224毫秒。`motor`模块中为机器人移动设置的默认持续时间是200毫秒。因此，这些数字是我们预期的。最后，我们可以看到“favicon未找到错误”也已解决，因为它们不再出现在请求日志中。
- en: 'Going Deeper: HTML5'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 深入了解：HTML5
- en: HTML5 is the latest version of the markup language used on the web. The standard
    is maintained by the Web Hypertext Application Technology Working Group (WHATWG),
    which is a consortium of major browser vendors (Apple, Google, Mozilla, and Microsoft).
    The HTML Living Standard ([https://w3.org/TR/html5](https://w3.org/TR/html5))
    provides full details on the HTML elements and syntax. It is a comprehensive reference
    on the standard.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: HTML5是用于网络的标记语言的最新版本。该标准由Web超文本应用技术工作组（WHATWG）维护，它是一个由主要浏览器供应商（苹果、谷歌、Mozilla和微软）组成的联盟。HTML
    Living Standard ([https://w3.org/TR/html5](https://w3.org/TR/html5))提供了关于HTML元素和语法的全部细节。它是标准的全面参考。
- en: HTML forms are used heavily in this chapter to submit the desired movement actions
    to the robot server. The Mozilla guide on web forms ([https://developer.mozilla.org/Learn/Forms](https://developer.mozilla.org/Learn/Forms))
    is an excellent resource to explore how forms with different submission options
    can be created, as well as different input elements contained within the form
    itself.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: HTML表单在本章中被大量使用，用于将所需的运动动作提交给机器人服务器。Mozilla关于网页表单的指南([https://developer.mozilla.org/Learn/Forms](https://developer.mozilla.org/Learn/Forms))是一个优秀的资源，可以探索如何创建具有不同提交选项的表单，以及表单本身包含的不同输入元素。
- en: 6.4\. Creating a full-movement web app
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6.4. 创建一个完整的运动Web应用程序
- en: 'We can now move on to create a web application that can call all the robot
    movement functions. We need to create a web application to meet the following
    requirements:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以继续创建一个可以调用所有机器人运动函数的Web应用程序。我们需要创建一个满足以下要求的Web应用程序：
- en: A Python web application that allows users to move the robot forward, backward,
    right, left, and to spin in both directions should be created.
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应该创建一个Python Web应用程序，允许用户将机器人向前、向后、向右、向左移动，以及向两个方向旋转。
- en: A button to call the no-operation `noop` function should be created so that
    performance measurements can be made within the web browser.
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应该创建一个调用无操作`noop`函数的按钮，以便在网页浏览器内进行性能测量。
- en: The buttons in the user interface should use a layout that comfortably supports
    both mobile touch and desktop mouse interactions.
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户界面的按钮应使用一个舒适地支持移动触摸和桌面鼠标交互的布局。
- en: 6.4.1 Creating the full-movement application
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.4.1 创建完整的运动应用程序
- en: 'On the Python side, we are almost there. We can make some small modifications
    to our previous application to enable all the movement functions. We will make
    a small modification to the `get` method so that it uses our new `full.html` template:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在Python方面，我们几乎完成了。我们可以对我们的先前应用程序进行一些小的修改，以启用所有运动函数。我们将对`get`方法进行小的修改，使其使用我们新的`full.html`模板：
- en: '[PRE20]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The `post` method will now be enhanced to look up the required movement function
    from the `motor` module and then call the function. After that, we will be redirected
    to the application home screen:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 现在将增强`post`方法，从`motor`模块查找所需的运动函数，然后调用该函数。之后，我们将被重定向到应用程序主屏幕：
- en: '[PRE21]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: The full script can be saved as `full_web.py` on the Pi.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 完整的脚本可以保存为`full_web.py`在Pi上。
- en: 'Figure 6.5 `full_web.py`: Web application that supports all robot movement
    actions'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.5 `full_web.py`：支持所有机器人运动动作的Web应用程序
- en: '[PRE22]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The next step will be to upgrade the HTML template. The contents in the `body`
    will have a number of enhancements made. The text in the title of the page will
    be given a link so that users can click on the page title to reload the page.
    A button for each movement function is placed on the screen. The layout of the
    screen is designed so that similar actions are grouped together in the same row.
    The first row has the forward and backward buttons. The second row has the buttons
    to turn left and right. The third row shows buttons to spin left and right. The
    final row presents the no-operation button. The buttons use HTML5-named character
    references so that the buttons have a graphical indication of what they do:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步将是升级HTML模板。`body`中的内容将进行多项增强。页面标题中的文本将被赋予一个链接，以便用户可以点击页面标题来重新加载页面。每个运动函数都有一个按钮放置在屏幕上。屏幕的布局被设计成将类似动作分组在同一行。第一行有前进和后退按钮。第二行有左转和右转按钮。第三行显示左转和右转的按钮。最后一行展示无操作按钮。按钮使用HTML5命名的字符引用，以便按钮有图形指示它们的功能：
- en: '[PRE23]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Now we can style the content on the page by updating the style tag. We center
    the content in the page and remove the default underline text decoration style
    from links on the page. Next, we move on to style the buttons on the page. Their
    font size is made three times larger, and a good amount of margin is added to
    provide a healthy amount of spacing between the buttons. This layout and spacing
    make it easier to press the buttons with your finger on a touch interface, as
    the buttons aren’t bunched up next to each other. Finally, all the buttons are
    given the same height and width of 60 px to create a uniform look:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以通过更新样式标签来对页面上的内容进行样式设计。我们将内容居中在页面中，并从页面上的链接中移除默认的下划线文本装饰样式。接下来，我们继续对页面上的按钮进行样式设计。它们的字体大小被放大了三倍，并添加了足够的边距，以提供健康的按钮间距。这种布局和间距使得在触摸界面上用手指按下按钮更容易，因为按钮没有紧挨在一起。最后，所有按钮都被赋予了相同的高度和宽度为60
    px，以创建统一的样式：
- en: '[PRE24]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: The template can be saved as `full.html` on the Pi in the templates directory.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 模板可以保存为`full.html`在Pi的模板目录中。
- en: 'Figure 6.6 `full.html`: HTML user interface that supports all robot movement
    actions'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.6 `full.html`：支持所有机器人移动动作的HTML用户界面
- en: '[PRE25]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'We can now execute `full_web.py` to run the web server. When you access the
    web application, press different movement buttons to make the robot perform each
    available movement. What follows is the log output from a session using the application:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以执行`full_web.py`来运行网页服务器。当你访问网页应用程序时，按下不同的移动按钮，使机器人执行每个可用的移动。以下是从使用应用程序的会话中输出的日志：
- en: '[PRE26]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: From the logs, we can see each of the different movement functions being successfully
    executed and then the main page loading after each function is called. It is also
    of note that the call to the `noop` page loads in around 2 ms, which indicates
    a good level of performance.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 从日志中，我们可以看到每个不同的移动功能都成功执行，然后在每个功能调用后加载主页面。值得注意的是，对`noop`页面的调用大约在2毫秒内完成，这表明性能良好。
- en: 6.4.2 Web interface design
  id: totrans-104
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.4.2 网页界面设计
- en: Figure 6.5 shows how the web application will appear for desktop and laptop
    users. The icons used for each button reflect the movement that will be performed.
    Thus, arrows pointing forward and backward indicate the forward and backward robot
    movements. The right, left, and spin functions have similar graphical representations.
    The no-operation action is presented with an X to indicate that it will not result
    in a movement.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.5展示了网页应用程序在桌面和笔记本电脑用户面前的外观。每个按钮使用的图标反映了将要执行的动作。因此，指向前后方向的箭头表示机器人的前后移动。右转、左转和旋转功能有类似的图形表示。无操作动作用X表示，表示它不会导致移动。
- en: '![](../Images/CH06_F05_Alsabbagh.png)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/CH06_F05_Alsabbagh.png)'
- en: 'Figure 6.5 Desktop interface: each robot movement can be called by its related
    button.'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.5 桌面界面：每个机器人移动都可以通过其相关按钮调用。
- en: Figure 6.6 shows how the application will appear on a mobile device. The buttons
    use larger fonts and are given a good amount of width and height so that they
    are large enough to be comfortably pressed on a touch screen. The generous spacing
    between the buttons also prevents their crowding. The whole application fits on
    one screen so that all functions can be accessed without the need to scroll.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.6展示了应用程序在移动设备上的外观。按钮使用较大的字体，并赋予了足够的宽度和高度，以便在触摸屏上舒适地按下。按钮之间宽敞的间距也防止了它们的拥挤。整个应用程序都适合在一个屏幕上，这样就可以访问所有功能，而无需滚动。
- en: '![](../Images/CH06_F06_Alsabbagh.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/CH06_F06_Alsabbagh.png)'
- en: 'Figure 6.6 Mobile interface: the spacing between the buttons makes touch interaction
    easier.'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.6 移动界面：按钮之间的间距使得触摸交互更加容易。
- en: 'Robots in the real world: Controlling robots with web applications'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 现实世界中的机器人：使用网页应用程序控制机器人
- en: Controlling robots with a web application can provide more convenient access
    than using a desktop application, as they can be accessed by mobile devices. Operating
    robots on a factory floor by accessing and controlling the robot from a smartphone
    gives a greater freedom of movement to the operator than lugging around a laptop.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 使用网页应用程序控制机器人比使用桌面应用程序更方便，因为它们可以通过移动设备访问。通过智能手机访问和控制工厂车间的机器人，比携带笔记本电脑给操作员带来更大的行动自由度。
- en: When needed, they also support the access from devices with larger screens,
    such as tablet computers or laptops. Different user interfaces can be designed
    to better support devices with larger screens. In this way, users get the best
    of both worlds.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 当需要时，它们还支持从具有更大屏幕的设备访问，例如平板电脑或笔记本电脑。可以设计不同的用户界面，以更好地支持具有更大屏幕的设备。这样，用户就能享受到两者的最佳之处。
- en: Modern web applications are also very extensible. We’ll see in the later chapters
    how to add video streaming from the robot camera to our web applications. This
    gives the robot operator the ability to see exactly what the robot sees.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 现代网页应用程序也非常易于扩展。我们将在后面的章节中看到如何将机器人摄像头的视频流添加到我们的网页应用程序中。这使机器人操作员能够看到机器人所看到的一切。
- en: 6.4.3 Measuring application performance in the browser
  id: totrans-115
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.4.3 在浏览器中测量应用程序性能
- en: Figure 6.7 shows how to measure web application performance in the browser.
    Both the Firefox and Google Chrome web browsers have a built-in function called
    Developer Tools, which provides many rich features, such as measuring application
    performance. Once the tool is accessed in the browser, click on the Network tab.
    Figure 6.7 shows a sample measurement taken when the robot was requested to spin
    right. From the measurements, we can see that it took 229 ms to call the spin
    right action and then 14 ms to redirect and load the main page. These figures
    match the ones that we could see on the server from the log output in the terminal.
    This tool can be very handy when trying to diagnose performance problems with
    web applications.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.7 展示了如何在浏览器中测量网络应用程序的性能。Firefox和Google Chrome网页浏览器都内置了一个名为开发者工具的功能，它提供了许多丰富的功能，例如测量应用程序性能。一旦在浏览器中访问了该工具，点击网络标签。图6.7显示了当请求机器人向右旋转时的一个样本测量。从测量结果中，我们可以看到调用向右旋转动作花费了229毫秒，然后14毫秒用于重定向和加载主页。这些数字与我们在终端日志输出中从服务器上看到的数字相匹配。当尝试诊断网络应用程序的性能问题时，这个工具非常有用。
- en: '![](../Images/CH06_F07_Alsabbagh.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/CH06_F07_Alsabbagh.png)'
- en: 'Figure 6.7 Measuring performance: the load times of a page can be measured
    in the browser itself.'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.7 测量性能：页面的加载时间可以在浏览器本身中进行测量。
- en: 6.4.4 Web hardware devices
  id: totrans-119
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.4.4 网络硬件设备
- en: Figure 6.8 shows how the web application will appear on a smartphone running
    the iOS operating system. Smartphones offer the greatest level of portability,
    as they are small enough to fit in your pocket. The downside of using them is
    their smaller screen, and we are also limited to only using a touch screen interface
    for interacting with the application.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.8 展示了在运行iOS操作系统的智能手机上，网络应用程序将如何显示。智能手机提供最高的便携性，因为它们足够小，可以放入口袋。使用它们的缺点是屏幕较小，我们只能使用触摸屏界面与应用程序进行交互。
- en: '![](../Images/CH06_F08_Alsabbagh.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/CH06_F08_Alsabbagh.png)'
- en: 'Figure 6.8 Smartphone device: smartphones can be used to control the robot.'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.8 智能手机设备：可以使用智能手机来控制机器人。
- en: Figure 6.9 shows the application running on a tablet computer. These types of
    hardware devices offer much larger screens, which allows us to put many more controls
    in our user interface.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.9显示了在平板电脑上运行的应用程序。这类硬件设备提供了更大的屏幕，这使得我们可以在用户界面中放置更多的控件。
- en: It is often a good idea to try out your web application on a variety of devices
    with different screen sizes and web browsers so that you can discover any problems
    that might occur on specific devices or browsers.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在多种不同屏幕尺寸和网页浏览器上尝试您的网络应用程序通常是一个好主意，这样您可以发现可能在特定设备或浏览器上出现的问题。
- en: '![](../Images/CH06_F09_Alsabbagh.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/CH06_F09_Alsabbagh.png)'
- en: 'Figure 6.9 Tablet computers: tablets offer bigger screens then smartphones
    but are still quite portable.'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.9 平板电脑：平板电脑的屏幕比智能手机大，但仍然非常便携。
- en: Summary
  id: totrans-127
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Accessing the robot over Wi-Fi gives the best user experience, as both the robot
    and mobile phone have full portability.
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过Wi-Fi访问机器人可以提供最佳的用户体验，因为机器人和移动电话都具有完全的便携性。
- en: The built-in template feature of the Tornado web framework is used to create
    dynamic content in the application.
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tornado网络框架的内置模板功能用于在应用程序中创建动态内容。
- en: One of the benefits of outputting the server logs is that we can see all the
    incoming requests to the web server and the given responses.
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输出服务器日志的一个好处是我们可以看到所有发送到网络服务器的请求和给出的响应。
- en: The buttons use larger fonts and are given a good amount of width and height
    so that they are large enough to be comfortably pressed on a touch screen.
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 按钮使用较大的字体，并且被赋予了良好的宽度和高度，这样它们就足够大，可以在触摸屏上舒适地按下。
- en: Both the Firefox and Google Chrome web browsers have a built-in function called
    Developer Tools, which provides many rich features, such as measuring application
    performance.
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Firefox和Google Chrome网页浏览器都内置了一个名为开发者工具的功能，它提供了许多丰富的功能，例如测量应用程序性能。
