- en: '11 Web form for orders: Coffee shop on the web'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 11 订单网页表单：网络上的咖啡店
- en: In this chapter
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章
- en: Emily and Erik create a real web form for their shop
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 艾米丽和埃里克为他们的商店创建了一个真实的网页表单
- en: Simon explains how to pass values from the form to the program
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 西蒙解释如何从表单传递值到程序
- en: Erik and Emily learn about form elements, such as `input` and `select`
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 埃里克和艾米丽学习了表单元素，如 `input` 和 `select`
- en: Simon explains how files work
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 西蒙解释文件是如何工作的
- en: The next day, Erik, Emily, and Simon got together to continue working on the
    Coffee Shop application.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 第二天，埃里克、艾米丽和西蒙聚在一起继续工作 Coffee Shop 应用程序。
- en: “Are you ready to get serious?” Simon asked. “Today, we have to work on our
    *actual* web form. We tried a very simple menu yesterday. Now we have to add two
    more menus and the text field where the customer can enter their name.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: “你准备好认真工作了么？”西蒙问。“今天，我们必须着手制作我们的*实际*网页表单。昨天我们尝试了一个非常简单的菜单。现在我们必须添加两个更多的菜单和顾客可以输入他们名字的文本字段。
- en: '“Let’s look at our code from yesterday. We already created one menu there—the
    code between the `<select>` and `</select>` tags. This menu already has two options:
    coffee and decaf.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: “让我们看看我们昨天的代码。我们已经在那里创建了一个菜单——在 `<select>` 和 `</select>` 标签之间的代码。这个菜单已经有了两个选项：咖啡和低咖啡因。
- en: Listing 11.1 First menu options in `templates/forms.html`
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.1 `templates/forms.html` 中的第一个菜单选项
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: ❶ Menu option for coffee
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 咖啡菜单选项
- en: ❷ Menu option for decaf
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 低咖啡因菜单选项
- en: “Now we have to add another option to the `drink` menu. Erik, I think you had
    ‘chocolate’ in that menu, right?”
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: “现在我们必须给 `drink` 菜单添加另一个选项。埃里克，我想你在那个菜单里有‘巧克力’，对吧？”
- en: “Yes, coffee, chocolate, and decaf,” Erik confirmed.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，咖啡、巧克力和低咖啡因，”埃里克确认。
- en: “Good. And what about flavors and toppings?”
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: “很好。那么口味和配料呢？”
- en: “For flavors, we have caramel, vanilla, peppermint, raspberry, and plain,” Erik
    said. “For toppings, we have chocolate, cinnamon, and caramel.”
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: “对于口味，我们有焦糖、香草、薄荷、树莓和平常的，”埃里克说。“对于配料，我们有巧克力、肉桂和焦糖。”
- en: “Yummy,” Emily said.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: “美味，”艾米丽说。
- en: “Here is a task for you,” Simon said. “First, add the third option to the `drink`
    menu. Second, add two more menus for flavors and toppings. It will require some
    copying, pasting, and typing—and attention too. Who’s at the keyboard?”
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: “这里有一个任务给你，”西蒙说。“首先，给 `drink` 菜单添加第三个选项。其次，为口味和配料添加两个更多的菜单。这需要一些复制、粘贴和输入——还有注意力。谁在键盘上？”
- en: “I am,” Emily said. “I can do it. I’m familiar with HTML and all these tags.”
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，”艾米丽说。“我能做到。我对 HTML 和所有这些标签都很熟悉。”
- en: “Very well, go ahead!”
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: “非常好，继续！”
- en: Emily started editing the file. Erik was watching and asking questions from
    time to time.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 艾米丽开始编辑文件。埃里克在旁边观看，时不时地提问。
- en: “Why did you move the `<option>` line to the right? Does HTML have the same
    rules about indentation as Python?”
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: “你为什么把 `<option>` 行移动到右边？HTML 关于缩进的规则和 Python 一样吗？”
- en: “No, in HTML you don’t have to indent lines,” Emily answered. “I could write
    them all from the first position, but this looks better. In my class, our teacher
    said it’s good for *readability*.”
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: “不，在 HTML 中，你不需要缩进行，”艾米丽回答。“我可以从第一个位置开始写它们，但这样看起来更好。在我的课上，我们的老师说过这对*可读性*有好处。”
- en: “Yes, Simon told me the same,” Erik said. “In Python, you *have* to use indentation
    for blocks, but in some cases you’re free to choose whether to put your code on
    one line or use new lines and indentation. Simon said you should write *readable*
    code—at least for yourself.”
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，西蒙也这样告诉我，”埃里克说。“在 Python 中，你必须使用缩进来表示代码块，但在某些情况下，你可以自由选择是将代码放在一行还是使用新行和缩进。西蒙说你应该编写*可读性高*的代码——至少对你自己来说。”
- en: 'With Erik’s help, Emily listed all the options for flavors and toppings and
    created the following HTML template:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在埃里克的帮助下，艾米丽列出了口味和配料的所有选项，并创建了以下 HTML 模板：
- en: Listing 11.2 Additional menu options in `templates/forms.html`
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.2 `templates/forms.html` 中的附加菜单选项
- en: '[PRE1]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '*Your Turn!* Create your menus'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '*轮到你了!* 创建你的菜单'
- en: Create the new menus in the `templates/forms.html` file. Feel free to use different
    options. Take some ideas from your local coffee or ice cream shop.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `templates/forms.html` 文件中创建新的菜单。请随意使用不同的选项。从你当地的咖啡店或冰淇淋店获取一些灵感。
- en: Simon looked at their code and said, “Looks good to me. But before we switch
    from HTML to Python, let’s add one more thing to the form. Remember, we also asked
    the customer’s name.”
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 西蒙看了看他们的代码，说：“看起来不错。但在我们从 HTML 切换到 Python 之前，让我们给表单添加一个东西。记住，我们还问了顾客的名字。”
- en: “Like in Starbucks!” Emily said.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: “就像在星巴克一样！”艾米丽说。
- en: “Exactly,” Simon said. “Let me add one more line to your form. It’s called `input`,
    and it has a type of `text`. We’ll use it to enter the name. You see, I added
    it right after the `form` line.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: “正是这样，” 西蒙说。“让我在你的表单中添加一行。它被称为 `input`，类型为 `text`。我们将用它来输入名字。你看，我就在 `form` 行之后添加了它。
- en: Listing 11.3 Text field to enter a name in `templates/forms.html`
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.3 在 `templates/forms.html` 中输入名字的文本字段
- en: '[PRE2]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '*Your Turn!* Add an `input` field'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '*你的机会！* 添加一个 `input` 字段'
- en: Add an `input` field for the customer’s name. Don’t forget to put a placeholder
    as a hint for the user.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 为顾客添加一个 `input` 字段。别忘了放一个占位符作为用户的提示。
- en: “Take a look at the HTML code again,” Simon continued. “All three menus that
    Emily added, and the `input` line, are between the opening `<form>` tag and the
    closing `</form>` tag. Emily did a great job of indenting them for readability.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: “再看看 HTML 代码，” 西蒙继续说。“艾米丽添加的所有三个菜单，以及 `input` 行，都在 `<form>` 开标签和 `</form>` 关闭标签之间。艾米丽在可读性方面做得很好，对它们进行了缩进。
- en: “Now we can clearly see that they are inside the form. That means they all are
    parts of the *same form*. So, when you click Submit, they will all be passed to
    the program together.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: “现在我们可以清楚地看到它们都在表单内。这意味着它们都是 *同一表单* 的部分。所以，当你点击提交时，它们将一起传递给程序。”
- en: “In the program, we’ll be able to read them using the `request.form` dictionary,
    exactly as we did in our simple program.”
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: “在程序中，我们将能够使用 `request.form` 字典来读取它们，就像我们在我们的简单程序中所做的那样。”
- en: “As in `request.form['drink']`?” Erik asked.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: “就像 `request.form['drink']` 一样？” 艾瑞克问道。
- en: “Yes, right,” Simon answered. “Look, Emily gave them names, `flavor` and `topping`,
    so we can use those as keys for the dictionary in our program. Let’s open our
    `first_app.py` again and see where we have to make changes. Remember what we do
    here? We get the form dictionary and copy the value for the `drink` key to the
    `drink` variable. For example, if the customer chooses `chocolate`, it will be
    assigned to the `drink` variable. That variable will be passed to the form called
    `print.html` to be displayed—or, some say *rendered*—on the page.”
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，没错，” 西蒙回答。“看，艾米丽给他们起了名字，`flavor` 和 `topping`，所以我们可以用这些作为程序中字典的键。让我们再次打开
    `first_app.py` 并看看我们需要在哪里做修改。记得我们在这里做了什么吗？我们获取表单字典，并将 `drink` 键的值复制到 `drink` 变量中。例如，如果顾客选择了
    `chocolate`，它将被分配给 `drink` 变量。这个变量将被传递给名为 `print.html` 的表单，以在页面上显示——或者说，有些人说是
    *渲染*——在页面上。”
- en: Listing 11.4 First version of `order()` in `first_app.py`
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.4 `first_app.py` 中 `order()` 的第一个版本
- en: '[PRE3]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Simon continued, “Now that we’re getting more values from the form, we should
    collect them all and pass them to the template. Can you add those lines, Erik?”
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 西蒙继续说，“现在我们正在从表单中获取更多值，我们应该收集它们并将它们传递给模板。艾瑞克，你能添加这些行吗？”
- en: “I think so,” Erik said.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: “我想是这样的，” 艾瑞克说。
- en: Erik had added lines for flavor and topping when Simon said, “Don’t forget about
    the `name`!”
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 当西蒙说，“别忘了 `name`！”时，艾瑞克添加了关于口味和配料行的代码。
- en: 'Erik added it, and his code now looked like this:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 艾瑞克添加了它，他的代码现在看起来是这样的：
- en: Listing 11.5 More menu options passed to the print template in `first_app.py`
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.5 在 `first_app.py` 中传递给打印模板的更多菜单选项
- en: '[PRE4]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '*Your Turn!* Edit your Flask application'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '*你的机会！* 编辑你的 Flask 应用程序'
- en: Edit your `first_app.py` program and add the variables like Erik did. Don’t
    run it yet, because you don’t have the `print.html` file.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑你的 `first_app.py` 程序，并添加像艾瑞克一样的变量。现在不要运行它，因为你还没有 `print.html` 文件。
- en: “Great job, Erik!” Simon said. “Well, maybe it’s too early to say that before
    we test it,” and he smiled.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: “干得好，艾瑞克！” 西蒙说。“嗯，在我们测试之前，可能还为时过早这么说，” 他微笑着。
- en: “Now there’s just one small thing left,” Simon continued. “We have to add these
    variables to the `print.html` template. Let’s open it in the editor. Look, in
    addition to the main drink, we have to print the flavor and the topping. Oh, and
    don’t forget that we now know the customer’s name. It would be polite to print
    a greeting. Emily, can you edit this HTML?”
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: “现在只剩下一件小事了，” 西蒙继续说。“我们必须将这些变量添加到 `print.html` 模板中。让我们在编辑器中打开它。看，除了主要饮料外，我们还要打印口味和配料。哦，别忘了我们现在知道顾客的名字。打印一个问候语会很有礼貌。艾米丽，你能编辑这个
    HTML 吗？”
- en: “Of course,” Emily said. She started editing, explaining it to Erik while doing
    it.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: “当然，” 艾米丽说。她开始编辑，同时向艾瑞克解释。
- en: “First, let’s replace ‘Thanks for your order’ with ‘Hello’ and the name of the
    customer. I’m leaving it here as `<h1>` to make it bold and big.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: “首先，让我们将‘感谢您的订单’替换为‘你好’和顾客的名字。我将它留在这里作为 `<h1>` 以使其加粗并放大。
- en: '“Then we’ll put ‘Here is your order’ in `<h2>`,” she continued. “It will be
    a bit smaller. After that, we’ll print the order: main drink, flavor, and topping,
    each in a separate paragraph. I’ll keep using the `<strong>` tag to print it in
    bold. At the bottom of the page, we have a simple form with only one button to
    get us back to the order page. I hope you remember it from yesterday.”'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: “然后我们在 `<h2>` 中放入‘这是您的订单’，”她继续说。“它将稍微小一点。之后，我们将打印订单：主要饮料、口味和配料，每个都在一个单独的段落中。我会继续使用
    `<strong>` 标签来加粗打印。在页面底部，我们有一个简单的表单，只有一个按钮，可以带我们回到订单页面。我希望你记得昨天的内容。”
- en: Listing 11.6 Template to print the order in `templates/print.html`
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.6 打印订单的模板 `templates/print.html`
- en: '[PRE5]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: ❶ This form, with a single button, gets us back to the order page.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 这个只有一个按钮的表单，可以带我们回到订单页面。
- en: '*Your Turn!* Create a `templates/print.html` template'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '*轮到你了!* 创建一个 `templates/print.html` 模板'
- en: 'Create a template for printing as Emily just did. Pay attention to the variables:
    you should use the variables that you passed from the program. If you changed
    the `first_app.py` file and used different variables, change them here too. Then
    try running the application.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个打印模板，就像艾米丽刚刚做的那样。注意变量：你应该使用从程序传递过来的变量。如果你更改了`first_app.py`文件并使用了不同的变量，这里也要相应更改。然后尝试运行应用程序。
- en: “Can we try it now?” Erik asked.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: “我们现在可以试试吗？”艾瑞克问道。
- en: “Have you saved all your files?” Simon asked. “Look at your tabs in the editor.
    Mu shows them with a small red circle if you haven’t saved them.”
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: “你保存所有文件了吗？”西蒙问道。“看看编辑器中的标签。如果你没有保存它们，Mu 会用一个小红圈显示它们。”
- en: “Everything is fine,” Erik said.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: “一切正常，”艾瑞克说。
- en: “Then switch to the Python tab and click Run.”
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: “然后切换到 Python 选项卡并点击运行。”
- en: Erik did so and then clicked Browse. His browser opened a new tab with the familiar
    “Hello from Mu!” page. Erik added `/order` to the address line, and he saw the
    menu.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 艾瑞克这样做，然后点击浏览。他的浏览器打开了一个新的标签页，上面是熟悉的“来自 Mu 的问候”页面。艾瑞克在地址栏中添加了 `/order`，他看到了菜单。
- en: '![](../Images/11-01-order-menu.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/11-01-order-menu.png)'
- en: “Let me try it!” Emily said. She entered her name and chose Chocolate, Vanilla,
    and Caramel. She clicked Submit and got her order printed.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: “让我试试！”艾米丽说。她输入了她的名字，并选择了巧克力、香草和焦糖。她点击提交，订单被打印出来。
- en: '![](../Images/11-02-order-printed.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/11-02-order-printed.png)'
- en: “Wow, it works!” She was excited to see a real web application they just wrote
    together.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: “哇，它真的工作了！”她兴奋地看到他们刚刚一起编写的真实网络应用程序。
- en: “This is great,” Simon said. “Now we have to add the functions we wrote for
    the text version.”
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: “太棒了，”西蒙说。“现在我们必须添加我们为文本版本编写的函数。”
- en: “What functions?” Emily was puzzled. She thought it was done already. “Erik,
    can you explain?”
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: “什么函数？”艾米丽感到困惑。她认为这已经完成了。“艾瑞克，你能解释一下吗？”
- en: “What we have written here,” he started, “is a user interface for our application.
    We did this before, but in a text mode. This web application looks so much better.
    But in addition to printing the order, we also want to save it in a file. We may
    want to count how many orders we served with caramel, for example.”
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: “我们在这里写的是我们应用程序的用户界面。我们之前也这样做过，但是在文本模式下。这个网络应用程序看起来好多了。但除了打印订单，我们还想将其保存到文件中。例如，我们可能想计算我们用焦糖服务了多少订单。”
- en: “I see, to know when to buy more caramel for the shop,” Emily said.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: “我明白了，为了知道什么时候为商店购买更多的焦糖，”艾米丽说。
- en: “Exactly! You think like a shop manager, Emily!” Simon said.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: “完全正确！你像一位商店经理一样思考，艾米丽！”西蒙说。
- en: He continued, “Just before you joined us, we created a function to save the
    orders in a file. Our program saved the orders when we told it we were finished.
    The next time we started the program, it loaded all the previous orders into a
    list and was ready to add new orders to it.”
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 他继续说：“在你加入我们之前，我们创建了一个函数，用于将订单保存到文件中。我们的程序在我们告诉它完成时保存订单。下次我们启动程序时，它会将所有之前的订单加载到一个列表中，并准备好添加新的订单。”
- en: Simon stopped for a while, thinking. “But with this new web application, we’ll
    have to do it slightly differently.”
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 西蒙停顿了一下，思考着。“但是，对于这个新的网络应用程序，我们得稍微不同一点。”
- en: “Why?” Erik asked.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: “为什么？”艾瑞克问道。
- en: “Because our application is running all the time, and we’re not going to stop
    it. This kind of application is called a *web service*. It doesn’t stop. It runs
    all the time. Even more, if something happens to it and it crashes for some reason,
    another program restarts it to make sure it’s always ready to respond to requests—
    in our case, to accept orders.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: “因为我们的应用程序一直在运行，我们不会停止它。这种应用程序被称为*网络服务*。它不会停止。它一直在运行。更重要的是，如果它出了问题并且由于某种原因崩溃，另一个程序会重新启动它，以确保它始终准备好响应请求——在我们的案例中，是接受订单。”
- en: “For us,” Simon continued, “it means that we have to save each order right after
    we receive it. Let me quickly find the right way of doing that.”
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: “对我们来说，” 西蒙继续说，“这意味着我们必须在收到每个订单后立即保存它。让我快速找到正确的方法。”
- en: He opened a new tab in the browser and searched for a couple of minutes. “I
    know now,” he said finally. “Erik, let’s open our previous program and copy the
    `load_orders ()` and `save_orders()` functions into our web application.”
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 他打开了一个新的浏览器标签页，搜索了几分钟。“我现在知道了，” 他最后说，“艾瑞克，让我们打开我们之前的程序，并将 `load_orders()` 和
    `save_orders()` 函数复制到我们的网络应用中。”
- en: “Where are we going to use them? In the `order()` function?” he asked Simon.
    “You told me last time that I should have them in the code *before* I use them,
    right?”
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: “我们将在哪里使用它们？在 `order()` 函数中？” 他问西蒙，“你上次告诉我，我应该在使用它们之前将它们放入代码中，对吧？”
- en: “Yes, absolutely right,” Simon said. “Place them at the very beginning, even
    before the `app = Flask(name)` line. That way, we’ll separate our file functions
    from the web application functions. Also, don’t forget to add `import json` and
    `import os`.”
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，绝对正确，” 西蒙说，“将它们放在非常开始的地方，甚至在 `app = Flask(name)` 行之前。这样，我们将文件函数与网络应用函数分开。另外，别忘了添加
    `import json` 和 `import os`。”
- en: Erik copied the functions from the `main_menu.py` file they had worked on several
    days ago.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 艾瑞克从他们几天前工作的 `main_menu.py` 文件中复制了函数。
- en: Simon checked his work and said, “Good. We just have to close the file after
    we load the orders and, most importantly, after we save them.”
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 西蒙检查了他的工作并说，“很好。我们只需要在加载订单后，还有最重要的是在保存它们之后关闭文件。”
- en: “But we didn’t do that before. Why should we do it now? And what does *close
    the file* mean exactly?” Erik asked.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: “但我们之前没有这样做。为什么我们现在要这样做？‘关闭文件’到底意味着什么？” 艾瑞克问。
- en: Simon said, “We talked about that some time ago. Let me find the diagram. Emily,
    I think you’ll want to know it too.”
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 西蒙说，“我们之前讨论过这个问题。让我找到这个图解。艾米丽，我想你也会想了解它。”
- en: “Is it something like closing a file in Word?” Emily asked.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: “这像是在Word中关闭文件一样吗？” 艾米丽问。
- en: “Yes, but, in this case, we should do it from our Python program. It’s important
    to understand that, until you close the file, Python keeps the orders in memory.
    If something happens to our computer and it shuts down, all the orders would be
    lost. So, we have to close the file to make sure the orders are all saved to the
    drive. Look at the diagram.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，但是，在这种情况下，我们应该从我们的Python程序中这样做。理解这一点很重要，直到你关闭文件，Python都会将订单保存在内存中。如果我们的电脑发生故障并关闭，所有订单都会丢失。所以，我们必须关闭文件以确保所有订单都已保存到驱动器上。看看这个图解。”
- en: '![](../Images/11-03-file-close.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![文件关闭](../Images/11-03-file-close.png)'
- en: '*Your Turn!* Try to explain how files work'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '*轮到你了!* 尝试解释文件是如何工作的'
- en: Use this diagram and try to explain to somebody else how files work. Do you
    understand it better after you have explained it?
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这个图解，并尝试向别人解释文件是如何工作的。你解释之后理解得更好了吗？
- en: “We didn’t do this before, because our program automatically closed all the
    files when we ended it. In this web application, we’re going to close the file
    with the orders every time we get a new order.”
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: “我们之前没有这样做，因为我们的程序在结束时自动关闭了所有文件。在这个网络应用中，我们将每次收到新订单时都关闭包含订单的文件。”
- en: “But you said that slows down the program,” Erik said.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: “但你说过这会减慢程序的速度，” 艾瑞克说。
- en: “Yes, it does a little bit. But engineering is all about tradeoffs—this is what
    my robotics teacher keeps telling us. Our program is becoming more realistic,
    so we should think about saving important data—even if it makes the program a
    bit slower.”
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，这确实会稍微慢一点。但工程学就是关于权衡——这是我机器人老师一直告诉我们的。我们的程序变得越来越真实，所以我们应该考虑保存重要数据——即使这会使程序稍微慢一点。”
- en: 'Simon added the `f.close()` method in both functions, so the functions now
    looked like the following listing:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 西蒙在两个函数中都添加了 `f.close()` 方法，所以函数现在看起来如下所示：
- en: Listing 11.7 Functions to load and save orders in `first_app.py`
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.7 在 `first_app.py` 中加载和保存订单的函数
- en: '[PRE6]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Simon added, “Of course, it would be better to use a database here. Maybe we’ll
    add that later.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 西蒙补充说，“当然，在这里使用数据库会更好。也许我们稍后会添加它。”
- en: '“Now we have to load the orders from the file,” Simon said. He added a line
    just before the `Flask` line:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: “现在我们必须从文件中加载订单，” 西蒙说。他在 `Flask` 行之前添加了一行：
- en: Listing 11.8 Create a list of orders using `load_orders()` in `first_app.py`
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.8 使用 `first_app.py` 中的 `load_orders()` 创建订单列表
- en: '[PRE7]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: “Now we have a list of orders to which we’ll add new orders. That gives me an
    idea.” Simon started typing, explaining himself while doing it.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: “现在我们有一个订单列表，我们将向其中添加新的订单。这让我有了一个想法。” 西蒙开始输入，同时解释着。
- en: “We have a list where we keep orders, and it’s a list of Python dictionaries,
    right? So, when we get the new order from the form, we’d better copy it to a dictionary,
    not to separate variables. We’ll append that dictionary to the list and then save
    it to the file. Even better, we can pass the dictionary to the HTML template to
    display it. That will simplify our program!”
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: “我们有一个列表，我们用它来保存订单，它是一个 Python 字典列表，对吧？所以，当我们从表单中获取新订单时，我们最好将其复制到一个字典中，而不是单独的变量中。我们将这个字典追加到列表中，然后将其保存到文件中。甚至更好，我们可以将字典传递给
    HTML 模板以显示它。这将简化我们的程序！”
- en: 'He finished typing, and the `order()` function now looked like this:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 他打完字后，`order()` 函数现在看起来是这样的：
- en: Listing 11.9 Change to dictionary for a new order in `first_app.py`
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.9 在 `first_app.py` 中将新订单改为字典
- en: '[PRE8]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: ❶ Creates a new dictionary from the form
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 从表单创建一个新的字典
- en: ❷ Appends the new order to the list
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 将新订单追加到列表中
- en: ❸ Saves the list in the JSON file
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 将列表保存到 JSON 文件中
- en: ❹ Passes the dictionary to the template
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 将字典传递给模板
- en: '*Your Turn!* Edit the application'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '*你的回合了!* 编辑应用程序'
- en: Use the three previous listings and edit your `first_app.py` program. Make sure
    you understand what’s happening when you create a new order and pass it to the
    template.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 使用前面的三个列表并编辑你的 `first_app.py` 程序。确保你理解在创建新订单并将其传递给模板时发生了什么。
- en: “Finally, we need to change the HTML template,” Simon said. “Emily, would you
    help me?”
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: “最后，我们需要更改 HTML 模板，”西蒙说。“艾米丽，你能帮我一下吗？”
- en: “Sure, but I don’t know what to do,” she answered.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: “当然，但我不知道该怎么做，”她回答。
- en: '“Look, we used to pass variables to the template to display them on the page:
    `name`, `flavor`, and so on. Now, instead of four variables, we’ll pass just one—the
    `new_order` dictionary—that contains all four. It’s called a *dictionary* in Python.
    You give it a key, and it returns the value. For example, you give it `flavor`,
    and it returns `caramel`.”'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: “看，我们以前是将变量传递给模板以在页面上显示：`name`、`flavor` 等等。现在，我们不再传递四个变量，而只传递一个包含所有四个的 `new_order`
    字典。在 Python 中，我们称之为 *字典*。你给它一个键，它就返回一个值。例如，你给它 `flavor`，它就返回 `caramel`。”
- en: “Yes, Erik explained about dictionaries in Python already. But how can we use
    them in HTML?”
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，艾瑞克已经解释了 Python 中的字典。但我们如何在 HTML 中使用它们呢？”
- en: '“Exactly the same way as we do in Python: with square brackets! Let me show
    you,” Simon said. He replaced `name` with `new_order[“name”]` in the `Hello` line.'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: “就像我们在 Python 中做的那样：用方括号！让我给你演示一下，”西蒙说。他在 `Hello` 行中将 `name` 替换为 `new_order[“name”]`。
- en: '“I see it now,” Emily said. She started changing the other variables. The following
    listing shows the `print.html` template after she finished:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: “我现在明白了，”艾米丽说。她开始更改其他变量。以下列表显示她在完成更改后的 `print.html` 模板：
- en: Listing 11.10 Using a dictionary in `templates/print.html`
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.10 在 `templates/print.html` 中使用字典
- en: '[PRE9]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '*Your Turn!* Edit the `templates/print.html` file'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '*你的回合了!* 编辑 `templates/print.html` 文件'
- en: Edit your print template and change from using variables to using the dictionary.
    Pay attention to the dictionary keys—if you changed them in the Python program,
    you should change them here. Try running the application now.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑你的打印模板，并从使用变量改为使用字典。注意字典键——如果你在 Python 程序中更改了它们，你应该在这里更改。现在尝试运行应用程序。
- en: “Great!” Simon said. “Ready to test it?”
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: “太好了！”西蒙说。“准备好测试了吗？”
- en: “Yes!” Erik said. He opened the usual address, `http://127.0.0.1/order`.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: “是的！”艾瑞克说。他打开了常用的地址，`http://127.0.0.1/order`。
- en: He entered `Alex` and chose `chocolate`, `vanilla`, and `cinnamon`. He got the
    order.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 他输入了 `Alex` 并选择了 `chocolate`、`vanilla` 和 `cinnamon`。他得到了订单。
- en: '![](../Images/11-04-order-alex.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/11-04-order-alex.png)'
- en: “Now we have to check if it saved this order to the file,” Simon said.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: “现在我们必须检查是否将这个订单保存到了文件中，”西蒙说。
- en: He found the `orders.json` file in the `mu_code` folder and opened it with a
    text editor. “Yes!” he said. “Our program saved it in the file! Look—the first
    order is from the day when we tested the `save_order()` function. But the second
    order is what you just added. Very good!”
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 他在 `mu_code` 文件夹中找到了 `orders.json` 文件，并用文本编辑器打开了它。“是的！”他说。“我们的程序已经保存到文件中！看——第一个订单是我们测试
    `save_order()` 函数的那一天。但第二个订单是你刚刚添加的。非常好！”
- en: '![](../Images/11-05-orders-json.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/11-05-orders-json.png)'
- en: “But what about the menu files?” Erik asked.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: “但菜单文件怎么办？”艾瑞克问。
- en: “What menu files?”
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: “有什么菜单文件吗？”
- en: “Remember,” Erik explained, “you told me that the shop manager might not know
    Python. So, we created our menus in plain text files. Now our menu is in HTML,
    but I think the shop manager might not know HTML either. Can we do the same with
    this web application and let the shop manager edit text files instead of HTML
    if they want to add something to the menu?”
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: “记住，”埃里克解释道，“你告诉我商店经理可能不知道Python。所以，我们用纯文本文件创建了我们的菜单。现在我们的菜单是HTML格式，但我认为商店经理可能也不知道HTML。我们能否用这个网络应用做同样的事情，让商店经理在想要添加菜单项时编辑文本文件而不是HTML？”
- en: “Great idea, Erik!” Simon answered. “I think it’s possible with HTML templates,
    but I’ll have to check the Flask documentation. But, before you go, let’s quickly
    recap what we learned today.”
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: “好主意，埃里克！”西蒙回答。“我认为使用HTML模板是可能的，但我需要检查Flask文档。但在你走之前，让我们快速回顾一下今天学到的内容。”
- en: “You explained how files work in a computer. I didn’t know that before,” Erik
    said.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: “你解释了计算机中文件的工作方式。我之前不知道这些，”埃里克说。
- en: “I learned about the `input` field in HTML forms,” Emily said. “And it was great
    to work on a real application, not on exercises for the class.”
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: “我学到了HTML表单中的`input`字段，”艾米丽说。“能够在实际应用中工作，而不是在课堂练习中，感觉真是太棒了。”
- en: “I agree,” Simon said. “I think the best way to learn something is to work on
    a real project. We’ve done a lot today, so let’s take a rest and start working
    on Erik’s idea tomorrow.”
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: “我同意，”西蒙说。“我认为学习某样东西的最佳方式就是参与一个真实的项目。我们今天已经做了很多，所以让我们休息一下，明天再开始着手埃里克的点子。”
- en: New things you have learned today
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 今天你学到的新知识
- en: '*Web service*—A web service is a program that runs constantly and responds
    to requests, like a new order in the coffee shop.'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*网络服务*——网络服务是一个持续运行并响应请求的程序，就像咖啡店的新订单一样。'
- en: '*Why it’s important to close files*—When you work with files, Python keeps
    the updates in memory. If you want to make sure your data is saved on a permanent
    drive, you should call `f.close()`.'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*为什么关闭文件很重要*——当你与文件一起工作时，Python会将更新保存在内存中。如果你想确保你的数据被永久保存到驱动器上，你应该调用`f.close()`。'
- en: Code for this chapter
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 本章代码
- en: 'You can find the code for this chapter here: [https://github.com/pavelanni/pythonicadventure-code/tree/main/ch11](https://github.com/pavelanni/pythonicadventure-code/tree/main/ch11).'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在这里找到本章的代码：[https://github.com/pavelanni/pythonicadventure-code/tree/main/ch11](https://github.com/pavelanni/pythonicadventure-code/tree/main/ch11).
