- en: Part 3\. JavaScript in the browser
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第三部分. 浏览器中的JavaScript
- en: Up to this point in *Get Programming with JavaScript*, you’ve been using the
    console as the way of interacting with your programs. You’ve been able to focus
    on the JavaScript code. Now it’s time to start using a web page as the user interface,
    using HyperText Markup Language (HTML) to specify headings, paragraphs, and list
    items for presentation; and buttons, drop-down lists, and text boxes for user
    input. You use templates as an efficient way to generate HTML from your data and
    `XMLHttpRequest` objects to load extra data for your web pages.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在此之前的*用JavaScript编程入门*中，你一直使用控制台作为与程序交互的方式。你能够专注于JavaScript代码。现在，是时候开始使用网页作为用户界面了，使用超文本标记语言（HTML）来指定标题、段落和列表项以进行展示；以及按钮、下拉列表和文本框以供用户输入。你使用模板作为从你的数据中高效生成HTML的方法，并使用`XMLHttpRequest`对象来为你的网页加载额外数据。
- en: '[Part 3](#part03) shows you how to organize files on your own computer rather
    than on JS Bin and suggests some next steps as you continue your JavaScript adventure.
    *The Crypt* gets an HTML makeover and the ability to load locations one at a time
    as players explore the worlds you create for them.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '[第三部分](#part03)向你展示了如何在你自己的电脑上组织文件，而不是在JS Bin上，并在你继续JavaScript冒险时提出一些下一步的建议。*密码*得到了HTML的改造，并能够一次加载一个位置，当玩家探索你为他们创建的世界时。'
- en: 'Chapter 17\. HTML: building web pages'
  id: totrans-3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第17章. HTML：构建网页
- en: '***This chapter covers***'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '***本章涵盖的内容***'
- en: Using HTML to display static content
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用HTML显示静态内容
- en: Tags, elements, and attributes
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标签、元素和属性
- en: Common HTML elements
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 常见HTML元素
- en: Manipulating web page content with JavaScript
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用JavaScript操作网页内容
- en: Switching to HTML-based views in *The Crypt*
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在*密码*中切换到基于HTML的视图
- en: 'JavaScript is associated with adding interactivity to web pages: reacting to
    users clicking buttons and selecting from drop-down menus, for example, and updating
    parts of a page with new content. Having learned the fundamentals of the language,
    you’re almost ready to take that step to interactivity and dynamic content. Your
    focus is still on JavaScript, but you need to learn enough HTML to see how JavaScript
    can be used to create and manipulate the content of a web page. JS Bin still has
    you covered while you learn; you can add HTML and view the resulting web page
    in the Output panel. In [chapter 21](kindle_split_031.html#ch21) you’ll see how
    to move on from the JS Bin sandbox and organize your own HTML, CSS, and JavaScript
    files.'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: JavaScript与为网页添加交互性相关：例如，对用户点击按钮和从下拉菜单中选择做出反应，以及用新内容更新页面的一部分。在掌握了语言的基础知识后，你几乎准备好迈出交互性和动态内容的一步了。你的重点仍然是JavaScript，但你需要学习足够的HTML，以便了解JavaScript如何用于创建和操作网页内容。JS
    Bin在你学习的过程中仍然为你提供支持；你可以在输出面板中添加HTML并查看生成的网页。在[第21章](kindle_split_031.html#ch21)中，你将看到如何从JS
    Bin沙盒中走出来，并组织你自己的HTML、CSS和JavaScript文件。
- en: You’ve spent a lot of time building *The Crypt* in a modular fashion. That work
    pays off in this chapter when you see how easy it is to switch from displaying
    output on the console to displaying it on a web page. It will just take a few
    lines of code—it’s almost magical.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 你花费了大量时间以模块化方式构建*密码*。在这一章中，当你看到如何轻松地将输出从控制台切换到网页上时，你会看到这项工作的回报。这只需要几行代码——几乎就像魔法一样。
- en: 17.1\. HTML, CSS, JavaScript—building a web page
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 17.1. HTML、CSS、JavaScript——构建网页
- en: 'You want to build a movie reviews web page, My Movie Ratings, that displays
    information about your favorite movies and lets you rate them ([figure 17.1](#ch17fig01)).
    To build the page you use three languages:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 你想要构建一个电影评论网页，我的电影评分，该网页显示有关你最喜欢的电影的信息，并允许你对其进行评分（[图17.1](#ch17fig01)）。为了构建这个页面，你使用了三种语言：
- en: Figure 17.1\. CSS and JavaScript build on the HTML content with enhanced presentation
    and interactivity.
  id: totrans-14
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图17.1. CSS和JavaScript通过增强展示和交互性建立在HTML内容之上。
- en: '![](17fig01_alt.jpg)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![](17fig01_alt.jpg)'
- en: '***HTML*** —You use HTML to annotate the text of the page and specify media
    to be loaded; headers, paragraphs, lists, images, and buttons are all specified
    with HTML. This is your base layer, the essential content, the information you
    want visitors to find and read.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***HTML*** ——你使用HTML来注释页面文本并指定要加载的媒体；标题、段落、列表、图像和按钮都使用HTML指定。这是你的基础层，是基本内容，是你希望访客找到并阅读的信息。'
- en: '***CSS*** —You use the Cascading Style Sheets language to specify the look
    of the page, its colors, fonts, margins, borders, and so on. This is your presentation
    layer, a visual treat that enhances the content.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***CSS*** ——你使用层叠样式表（Cascading Style Sheets）语言来指定页面的外观、颜色、字体、边距、边框等。这是你的展示层，是一种视觉享受，可以增强内容。'
- en: '***JavaScript*** —You use the JavaScript language to add interactivity to the
    page; you respond to button clicks, filter content, load extra data, and pop-up
    messages with JavaScript. This is your behavior layer, a subtle dash of user interface
    magic that smooths the way and can improve the user’s experience and efficiency.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***JavaScript*** —你使用 JavaScript 语言为页面添加交互性；通过 JavaScript 响应按钮点击、过滤内容、加载额外数据以及弹出消息。这是你的行为层，是用户界面魔法的一丝微妙点缀，它使事情变得顺畅，并可以提高用户体验和效率。'
- en: '[Figure 17.1](#ch17fig01) includes three screenshots of the My Movie Ratings
    page and shows how the CSS and JavaScript layers build on the HTML foundation.'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 17.1](#ch17fig01) 包含了 My Movie Ratings 页面的三个截图，展示了 CSS 和 JavaScript 层如何建立在
    HTML 基础之上。'
- en: Even without CSS and JavaScript, on the left of [figure 17.1](#ch17fig01), the
    key information about the movie is accessible. The CSS adds visual styles, a sense
    of identity, and (hopefully) design that guides and delights the visitor. Finally,
    on the right, the figure shows a message that has been popped up using JavaScript
    after a user clicked the Rate button.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 即使没有 CSS 和 JavaScript，在 [图 17.1](#ch17fig01) 的左侧，关于电影的关键信息也是可访问的。CSS 添加了视觉样式、身份感以及（希望如此）引导和愉悦访客的设计。最后，在右侧，该图显示了用户点击评分按钮后通过
    JavaScript 弹出的消息。
- en: Take a look at your My Movie Ratings pages on JS Bin. There’s the base HTML
    version at [http://jsbin.com/sayayim/edit?output](http://jsbin.com/sayayim/edit?output)
    and the version with CSS and JavaScript at [http://jsbin.com/hikuzi/edit?output](http://jsbin.com/hikuzi/edit?output).
    (You may have to run the JavaScript to make the Rate button work.)
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 查看你在 JS Bin 上的 My Movie Ratings 页面。这里有基础的 HTML 版本，网址为 [http://jsbin.com/sayayim/edit?output](http://jsbin.com/sayayim/edit?output)，以及包含
    CSS 和 JavaScript 的版本，网址为 [http://jsbin.com/hikuzi/edit?output](http://jsbin.com/hikuzi/edit?output)。（你可能需要运行
    JavaScript 来使评分按钮生效。）
- en: 17.1.1\. Loading the layers
  id: totrans-22
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.1.1\. 加载层
- en: 'If you had your own website, jahvers.crypt, you’d load the My Movie Ratings
    web page by pointing your browser at the page’s URL, jahvers.crypt/movies.html,
    say. The browser loads the HTML document, movies.html, sent by the server at that
    address. The movies.html document may contain CSS and JavaScript code within it,
    between `style` and `script` tags, respectively:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你拥有自己的网站，比如 jahvers.crypt，你将通过在浏览器中指向网页的 URL，例如 jahvers.crypt/movies.html，来加载
    My Movie Ratings 网页。浏览器会加载由该地址的服务器发送的 HTML 文档，即 movies.html。movies.html 文档可能包含
    CSS 和 JavaScript 代码，分别位于 `style` 和 `script` 标签之间：
- en: '[PRE0]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Don’t worry about all the HTML tags for now; we cover them in [section 17.2](#ch17lev1sec2).
    You’re well aware of the benefits of modularization (that’s what [part 2](kindle_split_019.html#part02)
    was all about!), so you’ll be pleased to know that HTML documents can load CSS
    files as well as JavaScript files:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 目前不必担心所有的 HTML 标签；我们将在 [第 17.2 节](#ch17lev1sec2) 中介绍它们。你很清楚模块化的好处（这正是 [第 2 部分](kindle_split_019.html#part02)
    的主题！），所以你会很高兴地知道 HTML 文档可以加载 CSS 文件以及 JavaScript 文件：
- en: '[PRE1]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: You’ve seen the `script` tags for loading JavaScript modules before; the `link`
    tag does a similar job for loading CSS. When your browser is reading through your
    HTML document, ready to display it, it will load the CSS and JavaScript files
    it finds specified by the `link` and `script` elements. You’ll take a proper look
    at organizing your own HTML, CSS, and JavaScript files in [chapter 21](kindle_split_031.html#ch21).
    For now, JS Bin does the work for you.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 你之前已经见过用于加载 JavaScript 模块的 `script` 标签；`link` 标签则执行类似的任务来加载 CSS。当你的浏览器正在读取你的
    HTML 文档，准备显示它时，它会加载由 `link` 和 `script` 元素指定的 CSS 和 JavaScript 文件。你将在 [第 21 章](kindle_split_031.html#ch21)
    中详细了解如何组织自己的 HTML、CSS 和 JavaScript 文件。现在，JS Bin 会为你完成这项工作。
- en: 17.1.2\. Loading the layers in JS Bin
  id: totrans-28
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.1.2\. 在 JS Bin 中加载层
- en: 'When working on your projects, or bins, on JS Bin, you can add code to three
    panels: HTML, CSS, and JavaScript. JS Bin automatically merges the code from the
    three panels, embedding the CSS and JavaScript into the HTML and showing the resulting
    web page on its Output panel.'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 当你在 JS Bin 上工作于你的项目或代码块时，你可以在三个面板中添加代码：HTML、CSS 和 JavaScript。JS Bin 会自动合并这三个面板的代码，将
    CSS 和 JavaScript 嵌入 HTML 中，并在其输出面板上显示生成的网页。
- en: You won’t spend much time working on CSS in *Get Programming with JavaScript*,
    but where it’s used in examples, you can always take a look at the CSS panel yourself;
    the code used is mostly straightforward. You return to JavaScript in [section
    17.3](#ch17lev1sec3), after saying a brief hello to HTML.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *Get Programming with JavaScript* 中，你不会花太多时间在 CSS 上，但在示例中使用的地方，你总是可以自己查看 CSS
    面板；使用的代码大多是直接的。在简要介绍 HTML 之后，你将在 [第 17.3 节](#ch17lev1sec3) 回到 JavaScript。
- en: 17.2\. HTML—a very short introduction
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 17.2\. HTML——一个非常简短的介绍
- en: For My Movie Ratings, your movie reviews website, you want headings, lists of
    actors and directors, a choice of possible ratings, and a button to submit your
    verdict. You need a way of specifying that this text is a heading but that text
    is a list item; here’s a drop-down list and there’s a button. You’re not on the
    console anymore, Dorothy—you’ve left the monochrome world of spaces and new-line
    characters and entered the wonderful, colorful land of HTML. (Rest assured. There
    are no flying monkeys in this chapter.)
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 My Movie Ratings，您的电影评论网站，您想要标题、演员和导演的列表、可能的评分选择以及一个提交您判决的按钮。您需要一种方法来指定这些文本是标题，但文本是列表项；这里有一个下拉列表，还有一个按钮。你已经不再是控制台了，多萝西——你已经离开了由空格和新行字符组成的单色世界，进入了奇妙的多彩的
    HTML 世界。（请放心。本章中没有飞猴。）
- en: You use HTML to annotate text and to identify media that you want to embed in
    a document. The annotations specify the role that each section of text plays within
    the structure of the document. The media can be images, video, audio, or some
    other format.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 您使用 HTML 来注释文本并标识您想要嵌入文档中的媒体。这些注释指定了每个文本部分在文档结构中的作用。媒体可以是图像、视频、音频或某些其他格式。
- en: 'The markup itself takes the form of *tags*. In a document, a section of text
    might be a heading, a paragraph, a list item, or a quotation, for example, and
    there are tags to mark up those sections of text. Here’s a heading and a paragraph,
    each marked up with an opening and closing tag:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 标记本身采取的是 *标签* 的形式。在一个文档中，一段文本可能是一个标题、一个段落、一个列表项或一个引文，例如，并且有标签来标记这些文本部分。以下是一个标题和一个段落，每个都使用开标签和闭标签进行标记：
- en: '[PRE2]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: You wrap each section of text with an opening and closing tag. The heading has
    `<h1>` and `</h1>`, the paragraph `<p>` and `</p>`. Together, each opening and
    closing tag pair specifies an *element*. The `h1` tags specify a heading element;
    the `p` tags specify a paragraph element.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 您使用开标签和闭标签包裹每个文本部分。标题有 `<h1>` 和 `</h1>`，段落有 `<p>` 和 `</p>`。每个开标签和闭标签对一起指定了一个
    *元素*。`h1` 标签指定一个标题元素；`p` 标签指定一个段落元素。
- en: When a web browser loads an HTML document, it sees the tags and creates the
    corresponding element in its model of the page in memory. The tags specify what
    type of element to create and the text between the tags forms the content of the
    element.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 当网络浏览器加载一个 HTML 文档时，它会看到标签并在其内存中的页面模型中创建相应的元素。标签指定要创建的元素类型，标签之间的文本形成元素的内容。
- en: 17.2.1\. Starting with an empty page
  id: totrans-38
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.2.1\. 从一个空页面开始
- en: Before you start adding content to pages, take a look at the HTML that constitutes
    a bare-bones web page. If you create a new bin on JS Bin and view the HTML panel,
    you’ll see the following markup. (I’ve reformatted it slightly.)
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在您开始向页面添加内容之前，看看构成裸骨网页的 HTML。如果您在 JS Bin 上创建一个新的 bin 并查看 HTML 面板，您将看到以下标记。（我稍微进行了格式化。）
- en: '[PRE3]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The `DOCTYPE` in the first line gives the browser information about the version
    of HTML you’re using and helps it decide how to process and display the page.
    HTML has evolved over the years, and a number of versions and variations are specified
    by complicated-looking document type declarations. Fortunately, `<!DOCTYPE html>`
    is a neat shorthand for the latest version (currently HTML5).
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 第一行的 `DOCTYPE` 给浏览器提供了有关您正在使用的 HTML 版本的信息，并帮助它决定如何处理和显示页面。HTML 在这些年中已经发展，许多版本和变体都由复杂的文档类型声明指定。幸运的是，`<!DOCTYPE
    html>` 是最新版本（目前是 HTML5）的一个简洁的缩写。
- en: 'You wrap the whole document, after the document type, in `html` tags. Within
    the document, there are two sections, `head` and `body`. The `head` section contains
    information about the document: its title and character encoding. The `body` section
    is where the main content of the page goes—the content that will be displayed
    to the user when they visit the web page. All of your pages will use the same
    basic structure shown here.'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在文档类型之后，您将整个文档包裹在 `html` 标签中。在文档内部，有两个部分，`head` 和 `body`。`head` 部分包含有关文档的信息：其标题和字符编码。`body`
    部分是页面主要内容所在的地方——当用户访问网页时将显示给用户的内容。所有您的页面都将使用这里所示的基本结构。
- en: 17.2.2\. Adding some content
  id: totrans-43
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.2.2\. 添加一些内容
- en: '[Figure 17.2](#ch17fig02) shows some text for My Movie Ratings added between
    the `body` tags of a new JS Bin document. The text has been marked up with appropriate
    HTML tags to denote headings, subheadings, and paragraphs.'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 17.2](#ch17fig02) 展示了在新的 JS Bin 文档的 `body` 标签之间添加的一些文本，用于 My Movie Ratings。这些文本已经使用适当的
    HTML 标签进行标记，以表示标题、副标题和段落。'
- en: Figure 17.2\. The hierarchy of headings and the paragraphs
  id: totrans-45
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图17.2。标题和段落的层次结构
- en: '![](17fig02_alt.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![](17fig02_alt.jpg)'
- en: The browser represents the hierarchy of headings, `h1`, `h2`, `h3`, by using
    different font sizes. The following listing shows the HTML used between the `body`
    tags for the web page.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 浏览器通过使用不同的字体大小来表示标题的层次结构，`h1`、`h2`、`h3`。以下列表显示了在网页的`body`标签之间使用的HTML。
- en: Listing 17.1\. My Movie Ratings—headings and paragraphs (HTML) ([http://jsbin.com/nosiwi/edit?html,output](http://jsbin.com/nosiwi/edit?html,output))
  id: totrans-48
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表17.1。我的电影评分——标题和段落（HTML）([http://jsbin.com/nosiwi/edit?html,output](http://jsbin.com/nosiwi/edit?html,output))
- en: '![](306fig01_alt.jpg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](306fig01_alt.jpg)'
- en: 17.2.3\. Marking up a list
  id: totrans-50
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.2.3。标记列表
- en: 'Each movie includes a list of actors and a list of directors. Use the `li`
    tag to mark up list item elements. A single list item for an actor looks like
    this:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 每部电影都包含一个演员列表和一个导演列表。使用`li`标签标记列表项元素。一个演员的单个列表项看起来像这样：
- en: '[PRE4]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The list items need to be part of a list. You can have an ordered list, if the
    order of the items matters, or an unordered list, if it doesn’t. Use `ol` tags
    for an ordered list and `ul` tags for an unordered list. [Figure 17.3](#ch17fig03)
    shows the output for lists of actors and directors. [Listing 17.2](#ch17ex02)
    shows the new code.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 列表项需要是列表的一部分。如果您关心项目的顺序，可以使用有序列表，如果不关心，则可以使用无序列表。使用`ol`标签创建有序列表，使用`ul`标签创建无序列表。[图17.3](#ch17fig03)显示了演员和导演列表的输出。[列表17.2](#ch17ex02)显示了新的代码。
- en: Figure 17.3\. The browser renders the ordered list with numbers and the unordered
    list with bullets.
  id: totrans-54
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图17.3。浏览器以数字和项目符号的形式渲染有序列表和无序列表。
- en: '![](17fig03_alt.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![](17fig03_alt.jpg)'
- en: Listing 17.2\. Ordered and unordered lists (HTML) ([http://jsbin.com/vegahe/edit?html,output](http://jsbin.com/vegahe/edit?html,output))
  id: totrans-56
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表17.2。有序和无序列表（HTML）([http://jsbin.com/vegahe/edit?html,output](http://jsbin.com/vegahe/edit?html,output))
- en: '![](307fig01_alt.jpg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![](307fig01_alt.jpg)'
- en: As you can see in [figure 17.3](#ch17fig03), the browser automatically adds
    numbers for an ordered list and bullets for an unordered list.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 如[图17.3](#ch17fig03)所示，浏览器会自动为有序列表添加数字，为无序列表添加项目符号。
- en: 17.2.4\. Some common HTML elements
  id: totrans-59
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.2.4。一些常见的HTML元素
- en: '[Figure 17.4](#ch17fig04) is a screenshot of a web page made up of some common
    HTML elements. The content of each element describes the element. You can visit
    the page on JS Bin: [http://jsbin.com/nuriho/edit?html,css,output](http://jsbin.com/nuriho/edit?html,css,output).'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '[图17.4](#ch17fig04)是包含一些常见HTML元素的网页截图。每个元素的描述内容都描述了该元素。您可以在JS Bin上访问该页面：[http://jsbin.com/nuriho/edit?html,css,output](http://jsbin.com/nuriho/edit?html,css,output)。'
- en: Figure 17.4\. A web page with self-describing HTML elements
  id: totrans-61
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图17.4。具有自我描述HTML元素的网页
- en: '![](17fig04_alt.jpg)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](17fig04_alt.jpg)'
- en: The tags used to create the page in [figure 17.4](#ch17fig04) are shown in [table
    17.1](#ch17table01). There are plenty more HTML tags, but these are enough for
    you to work with for now.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 用于在[图17.4](#ch17fig04)中创建页面的标签显示在[表17.1](#ch17table01)中。还有很多HTML标签，但就目前而言，这些标签已经足够您使用了。
- en: Table 17.1\. Some common HTML elements for wrapping content
  id: totrans-64
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表17.1。用于包装内容的常见HTML元素
- en: '| Tag | Element | What is it for? |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| 标签 | 元素 | 它是用来做什么的？ |'
- en: '| --- | --- | --- |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| <h1> | Heading | Main heading for a document or part of a document |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| <h1> | 标题 | 文档或文档部分的标题 |'
- en: '| <h2>...<h6> | Subheading | Subheadings in decreasing order of importance
    |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| <h2>...<h6> | 子标题 | 按重要性递减的子标题 |'
- en: '| <p> | Paragraph | Paragraphs |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| <p> | 段落 | 段落 |'
- en: '| <div> | Division | Wraps a set of elements that belong together as a section
    of a document |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| <div> | 分区 | 将属于同一文档部分的元素包裹在一起 |'
- en: '| <ol> | Ordered list | Wraps a set of list items where the order of the items
    is important (e.g., a numbered list) |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
  zh: '| <ol> | 有序列表 | 包裹一组列表项，其中项的顺序很重要（例如，编号列表） |'
- en: '| <ul> | Unordered list | Wraps a set of list items where the order of the
    items is not important (e.g., a bulleted list) |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '| <ul> | 无序列表 | 包裹一组列表项，其中项的顺序不重要（例如，项目符号列表） |'
- en: '| <li> | List item | Wraps a single item in an ordered or unordered list |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
  zh: '| <li> | 列表项 | 将单个项目包裹在有序或无序列表中 |'
- en: '| <head> | Head | Wraps elements that provide meta-information about a document
    and load extra code needed by the document |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '| <head> | 头部 | 包裹提供文档元信息以及文档所需的额外代码的元素 |'
- en: '| <body> | Body | Wraps the main content of the page, the content that is displayed
    directly on the web page |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '| <body> | 主体 | 包裹页面的主要内容，直接显示在网页上的内容 |'
- en: 17.3\. Adding content to a web page with JavaScript
  id: totrans-76
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 17.3。使用JavaScript向网页添加内容
- en: Looking for ways to add interest to the site, you decide to welcome visitors
    to your My Movie Ratings web page with a random greeting. To test out the idea,
    you create a minimal page. [Figure 17.5](#ch17fig05) shows what you’re aiming
    for, with four visits to the page producing four different greetings.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在寻找为网站增添趣味的方法时，你决定用随机问候语欢迎你的 My Movie Ratings 网页访客。为了测试这个想法，你创建了一个最小化的页面。[图
    17.5](#ch17fig05) 展示了你所追求的效果，页面访问四次产生了四个不同的问候语。
- en: Figure 17.5\. Random greetings from a web page
  id: totrans-78
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 17.5\. 来自网页的随机问候语
- en: '![](17fig05_alt.jpg)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](17fig05_alt.jpg)'
- en: Refreshing the page generates a new random greeting. Try it out on JS Bin at
    [http://output.jsbin.com/mikura.html](http://output.jsbin.com/mikura.html). The
    next two listings show how to create the page. Run the JavaScript to make the
    message appear.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 刷新页面会生成一个新的随机问候语。在 JS Bin 上尝试一下 [http://output.jsbin.com/mikura.html](http://output.jsbin.com/mikura.html)。接下来的两个列表展示了如何创建页面。运行
    JavaScript 代码以显示消息。
- en: Listing 17.3\. Adding content to a paragraph with JavaScript (HTML) ([http://jsbin.com/mikura/edit?html,js,output](http://jsbin.com/mikura/edit?html,js,output))
  id: totrans-81
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 17.3\. 使用 JavaScript 向段落添加内容（HTML）([http://jsbin.com/mikura/edit?html,js,output](http://jsbin.com/mikura/edit?html,js,output))
- en: '[PRE5]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Listing 17.4\. Adding content to a paragraph with JavaScript ([http://jsbin.com/mikura/edit?html,js,output](http://jsbin.com/mikura/edit?html,js,output))
  id: totrans-83
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 17.4\. 使用 JavaScript 向段落添加内容 ([http://jsbin.com/mikura/edit?html,js,output](http://jsbin.com/mikura/edit?html,js,output))
- en: '![](309fig01_alt.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![](309fig01_alt.jpg)'
- en: 'To generate the effect, you follow these steps:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 要生成这种效果，你需要遵循以下步骤：
- en: '**1**.  Assign an `id` to an element in the HTML'
  id: totrans-86
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**. 在 HTML 中给元素分配一个 `id`'
- en: '**2**.  Use the `id` to get a reference to the element in JavaScript'
  id: totrans-87
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**. 使用 `id` 在 JavaScript 中获取元素引用'
- en: '**3**.  Use the reference to update the element’s contents'
  id: totrans-88
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**. 使用引用更新元素的内容'
- en: 17.3.1\. Getting an element by its id
  id: totrans-89
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.3.1\. 通过 id 获取元素
- en: 'You display the greeting in a paragraph element. To set the greeting, you need
    to get hold of a reference to that paragraph in JavaScript. You give the HTML
    element a unique `id` attribute:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 你在段落元素中显示问候语。要设置问候语，你需要获取 JavaScript 中那个段落的引用。你给 HTML 元素赋予一个唯一的 `id` 属性：
- en: '[PRE6]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'To get a reference to the element in a JavaScript program, you use the `document.get-ElementById`
    method, passing the `id` of the element as an argument:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 JavaScript 程序中获取元素的引用，你使用 `document.get-ElementById` 方法，并将元素的 `id` 作为参数传递：
- en: '[PRE7]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The web browser makes the `document` object available to your JavaScript code.
    The `document` object has properties and methods that allow you to interact with
    the hierarchy of elements on a page.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 网络浏览器使 `document` 对象对你的 JavaScript 代码可用。`document` 对象具有属性和方法，允许你与页面上的元素层次结构进行交互。
- en: You obtained a reference to the paragraph element by using `document.get-ElementById`.
    Having assigned the reference to the `para` variable, you can now use `para` to
    manipulate the element. You update the content of the paragraph by setting the
    element’s `innerHTML` property.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 你通过使用 `document.get-ElementById` 获取了段落元素的引用。将引用分配给 `para` 变量后，你现在可以使用 `para`
    来操作元素。你通过设置元素的 `innerHTML` 属性来更新段落的内联内容。
- en: '[PRE8]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The original content of the paragraph is replaced and becomes
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 段落的原始内容被替换，变成了
- en: '[PRE9]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 17.3.2\. Function declarations
  id: totrans-99
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.3.2\. 函数声明
- en: You’re now using function declarations rather than function expressions when
    defining named functions for later use.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在在定义用于后续使用的命名函数时，使用的是函数声明而不是函数表达式。
- en: '[PRE10]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Function declarations were mentioned in [chapter 4](kindle_split_012.html#ch04)
    as an alternate syntax for defining functions. You’ve been using expressions up
    until now to be consistent with the assignment of values, objects, arrays, and
    functions to variables.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 函数声明在第 [4章](kindle_split_012.html#ch04) 中被提及，作为定义函数的另一种语法。到目前为止，你一直使用表达式来保持与将值、对象、数组、函数分配给变量的赋值一致性。
- en: '[PRE11]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: It’s more common to see function declarations for named functions, so you’ve
    switched to declarations for [part 3](kindle_split_026.html#part03) of *Get Programming
    with JavaScript*.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 对于命名函数，函数声明更为常见，因此你切换到了 *Get Programming with JavaScript* 的第 [3部分](kindle_split_026.html#part03)
    的声明。
- en: 17.3.3\. What, no JavaScript?
  id: totrans-105
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.3.3\. 没有JavaScript？
- en: Occasionally, visitors will arrive at your site on devices that either don’t
    have JavaScript or have it disabled. Or they’ll be on a slow network, maybe at
    a hotel or on a train, where it takes longer (much longer!) to load any JavaScript
    modules for the page. If your page relies on JavaScript to display its content,
    visitors may be presented with an empty space. Whenever possible, consider including
    initial content in the page so that visiting is not a useless waste of time. Content
    should be available to everyone, with the extra flexibility, fluidity, and flashiness
    that JavaScript brings layered on top for those whose devices can handle it.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，访客可能会在既没有启用 JavaScript 或禁用了 JavaScript 的设备上访问你的网站。或者他们可能在一个网络较慢的环境中，比如在酒店或火车上，加载任何
    JavaScript 模块需要更长的时间（长得多！）如果你的页面依赖于 JavaScript 来显示内容，访客可能会看到一个空白的区域。在可能的情况下，考虑在页面中包含初始内容，这样访问就不会是浪费时间。内容应该对所有用户都可用，对于那些设备能够处理
    JavaScript 带来的额外灵活性、流畅性和炫酷效果的用户，可以在其之上添加这些内容。
- en: For your random greeting test, you included a greeting, “Welcome!”, in the initial
    HTML ([listing 17.3](#ch17ex03)). A random greeting is a nice bit of fun but isn’t
    essential.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的随机问候测试中，你已经在初始 HTML 中包含了问候语，“欢迎！”。随机问候是一个有趣的元素，但不是必需的。
- en: Having seen how to add some text to a paragraph, you now step things up and
    add a whole series of elements at once.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 在了解了如何向段落添加一些文本之后，你现在可以增加难度，一次性添加一系列元素。
- en: 17.4\. Displaying data from an array
  id: totrans-109
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 17.4\. 从数组中显示数据
- en: Each movie on My Movie Ratings has a title and a one-line summary. [Figure 17.6](#ch17fig06)
    shows a list of three movies on the site.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: My Movie Ratings 上的每部电影都有一个标题和一行摘要。[图 17.6](#ch17fig06) 展示了网站上三部电影的列表。
- en: Figure 17.6\. A list of movies
  id: totrans-111
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 17.6\. 电影列表
- en: '![](17fig06.jpg)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![](17fig06.jpg)'
- en: 'Given some movie data, you can loop through the movies and insert them into
    an existing element on the page. The movie data looks like this:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 给定一些电影数据，你可以遍历电影并将它们插入到页面上的现有元素中。电影数据如下所示：
- en: '[PRE12]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: You place a `div` element with an `id` of `movies` on the page, as shown in
    the following listing. Use `div` elements as containers to collect groups of related
    elements together.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 你在页面上放置了一个具有 `id` 为 `movies` 的 `div` 元素，如下所示。使用 `div` 元素作为容器来收集相关元素组。
- en: Listing 17.5\. Building HTML with JavaScript (HTML) ([http://jsbin.com/jakowat/edit?html,js,output](http://jsbin.com/jakowat/edit?html,js,output))
  id: totrans-116
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 17.5\. 使用 JavaScript 构建 HTML (HTML) ([http://jsbin.com/jakowat/edit?html,js,output](http://jsbin.com/jakowat/edit?html,js,output))
- en: '[PRE13]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Each movie will be a list item in an unordered list. The browser automatically
    adds the bullets for list items in an unordered list. The next listing shows the
    JavaScript used to display the movies.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 每部电影将是一个无序列表中的列表项。浏览器会自动为无序列表中的列表项添加项目符号。下一个列表展示了用于显示电影的 JavaScript 代码。
- en: Listing 17.6\. Building HTML with JavaScript ([http://jsbin.com/jakowat/edit?html,js,output](http://jsbin.com/jakowat/edit?html,js,output))
  id: totrans-119
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 17.6\. 使用 JavaScript 构建 HTML ([http://jsbin.com/jakowat/edit?html,js,output](http://jsbin.com/jakowat/edit?html,js,output))
- en: '![](313fig01_alt.jpg)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![](313fig01_alt.jpg)'
- en: The `getMovieHTML` method builds up the HTML for a single movie by sandwiching
    the properties of the `movie` object between appropriate opening and closing tags.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '`getMovieHTML` 方法通过在适当的开始和结束标签之间嵌入 `movie` 对象的属性来构建单个电影的 HTML。'
- en: '[PRE14]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The `getMoviesHTML` method iterates over the array of movies, building up the
    HTML for all of the movies as it goes. It uses `getMovieHTML` to get the HTML
    for each movie, wrapping the returned strings in `li` tags to create list item
    elements.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '`getMoviesHTML` 方法遍历电影数组，在遍历过程中构建所有电影的 HTML。它使用 `getMovieHTML` 获取每部电影的 HTML，并将返回的字符串包裹在
    `li` 标签中以创建列表项元素。'
- en: '[PRE15]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: It then wraps the HTML for the list of items in opening and closing `ul` tags
    for an unordered list and returns the complete HTML string.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，它将项目列表的 HTML 包裹在开始和结束的 `ul` 标签中，并返回完整的 HTML 字符串。
- en: '[PRE16]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The `getMoviesHTML` function returns HTML that looks like the following (but
    without the line breaks and extra spaces):'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '`getMoviesHTML` 函数返回类似以下格式的 HTML（但不含换行符和额外空格）：'
- en: '[PRE17]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The `render` method is the one that changes the page. It gets a reference to
    the target `div` on the page and sets its `innerHTML` property with the HTML string
    returned by `getMoviesHTML`.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '`render` 方法是改变页面的方法。它获取页面上的目标 `div` 的引用，并使用 `getMoviesHTML` 返回的 HTML 字符串设置其
    `innerHTML` 属性。'
- en: '[PRE18]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: To reduce the number of global variables, you could wrap the `getMovieHTML`,
    `get-MoviesHTML`, and `render` functions in an immediately invoked function expression
    (IIFE—see [chapter 13](kindle_split_022.html#ch13)) that returns just `render`
    in its interface. The listing has been kept simple to help focus on the generation
    of HTML and how to update an element on a web page.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 为了减少全局变量的数量，你可以将`getMovieHTML`、`get-MoviesHTML`和`render`函数包裹在一个立即执行的函数表达式（IIFE——见[第13章](kindle_split_022.html#ch13)）中，该表达式仅在其接口中返回`render`。列表已被保持简单，以帮助关注HTML的生成以及如何在网页上更新元素。
- en: 17.5\. The Crypt—displaying players and places with web views
  id: totrans-132
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 17.5. 《The Crypt》——使用Web视图显示玩家和位置
- en: 'You’ve split the program for *The Crypt* across multiple modules, sections
    of code that can be loaded independently. The modules perform different tasks:
    you have data, models, views, and a controller ([figure 17.7](#ch17fig07)).'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经将《The Crypt》的程序拆分成了多个模块，这些代码段可以独立加载。模块执行不同的任务：你有数据、模型、视图和控制器（[图17.7](#ch17fig07)）。
- en: Figure 17.7\. The modules that make up *The Crypt*
  id: totrans-134
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图17.7. 组成《The Crypt》的模块
- en: '![](17fig07_alt.jpg)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![](17fig07_alt.jpg)'
- en: 'The promise of modules is that you can switch them easily to change the behavior
    of the program. It’s time to make good on that promise. To build your first HTML
    version of *The Crypt,* follow these steps:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 模块的优势在于你可以轻松地切换它们以改变程序的行为。现在是时候兑现这个承诺了。要构建《The Crypt》的第一个HTML版本，请按照以下步骤操作：
- en: '**1**.  Update the player view (two lines of code)'
  id: totrans-137
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**. 更新玩家视图（两行代码）'
- en: '**2**.  Update the place view (two lines of code)'
  id: totrans-138
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**. 更新位置视图（两行代码）'
- en: '**3**.  Create an HTML page that has `script` elements to load all of the game
    modules and that has placeholders for the player and place views to fill'
  id: totrans-139
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**. 创建一个HTML页面，其中包含`script`元素以加载所有游戏模块，并为玩家和位置视图提供占位符以填充'
- en: You won’t see the output until all of the pieces are in place. But to get a
    sense of what you’re building, [figure 17.8](#ch17fig08) shows your first HTML
    game in action. The web page output shows the current states of the player and
    place. You enter commands at the console.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 你不会看到输出，直到所有部件都到位。但为了了解你正在构建的内容，[图17.8](#ch17fig08)显示了你的第一个HTML游戏的实际运行情况。网页输出显示了玩家和位置当前的状态。你在控制台输入命令。
- en: Figure 17.8\. *The Crypt* with commands and messages on the Console panel and
    updates on the Output panel
  id: totrans-141
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图17.8. 《The Crypt》在控制台面板上的命令和消息以及输出面板上的更新
- en: '![](17fig08_alt.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![](17fig08_alt.jpg)'
- en: Before looking at the updated versions of the player and place views, take time
    to consider the awesome power of your modular approach. The single method that
    displays information for each view is the `render` method. To reflect its beauty
    and simplicity, it gets the following section all to itself.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 在查看玩家和位置视图的更新版本之前，花点时间考虑一下你模块化方法的强大功能。显示每个视图信息的单个方法是`render`方法。为了反映其美丽和简单性，它得到了以下整个章节的介绍。
- en: 17.5.1\. Updating the player and place view modules—the render method
  id: totrans-144
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.5.1. 更新玩家和位置视图模块——`render`方法
- en: In moving from a console application to a web application, you update the player
    and place views. The new versions display information by inserting text into an
    element on a web page rather than logging the information to the console. Those
    are the only changes you make ([figure 17.9](#ch17fig09)), and the changes themselves
    are small.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 在从控制台应用程序迁移到Web应用程序的过程中，你需要更新玩家和视图。新版本通过在网页元素中插入文本来显示信息，而不是将信息记录到控制台。这些是你所做的唯一更改（[图17.9](#ch17fig09)），而且这些更改本身很小。
- en: Figure 17.9\. You only need to change the views to switch to a web-based version
    of *The Crypt*.
  id: totrans-146
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图17.9. 你只需要更改视图，就可以切换到《The Crypt》的基于Web的版本。
- en: '![](17fig09_alt.jpg)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![](17fig09_alt.jpg)'
- en: The views in [chapter 15](kindle_split_024.html#ch15) use `console.log` in a
    single method, the `render` method. That was by design; you have a single place
    where changes need to be made.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 第15章中的视图在单个方法`render`中使用`console.log`，这是有意为之；你只有一个地方需要做出更改。
- en: 'The `render` method for the console-based player view looks like this:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 基于控制台玩家的视图的`render`方法看起来是这样的：
- en: '[PRE19]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The `render` method for the console-based place view looks like this:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 基于控制台的位置视图的`render`方法看起来是这样的：
- en: '[PRE20]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Using what you’ve learned in this chapter about updating web page elements,
    the new place view’s `render` method looks like this:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 使用你在本章中学到的关于更新网页元素的知识，新的位置视图的`render`方法看起来是这样的：
- en: '[PRE21]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The new player view’s `render` method looks almost identical:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 新的玩家视图的`render`方法看起来几乎相同：
- en: '[PRE22]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Those really are the only changes to the JavaScript that you need. The new methods
    use `document.getElementById` to get references to elements on the web page. Until
    you create the web page in [listing 17.9](#ch17ex09), those elements won’t exist,
    so you can’t test your new views. Be patient; their time will come.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 这些确实是你需要更改的 JavaScript 的唯一内容。新方法使用 `document.getElementById` 来获取网页上元素的引用。在你创建
    [列表 17.9](#ch17ex09) 中的网页之前，这些元素将不存在，因此你不能测试你的新视图。请耐心等待；它们的时间会到来。
- en: 17.5.2\. Updating the player and place view modules—the listings
  id: totrans-158
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.5.2\. 更新玩家和地点视图模块——列表
- en: '[Listing 17.7](#ch17ex07) shows the new player view with its updated `render`
    method. Everything else is the same as it’s been since [chapter 15](kindle_split_024.html#ch15),
    so function bodies have been omitted in print. The JS Bin link is there so you
    can check the full listing if you want. The meaning of `"use strict"` is discussed
    after the listings for both views.'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 17.7](#ch17ex07) 展示了带有更新后的 `render` 方法的新的玩家视图。其他所有内容自第 15 章 [chapter 15](kindle_split_024.html#ch15)
    以来保持不变，因此省略了函数体。JS Bin 链接在那里，如果你想查看完整的列表，可以检查。在两个视图的列表之后讨论了 `"use strict"` 的含义。'
- en: Listing 17.7\. A web-based player view ([http://jsbin.com/cehexi/edit?js,console](http://jsbin.com/cehexi/edit?js,console))
  id: totrans-160
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 17.7\. 基于网络的玩家视图 ([http://jsbin.com/cehexi/edit?js,console](http://jsbin.com/cehexi/edit?js,console))
- en: '![](317fig01_alt.jpg)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![](317fig01_alt.jpg)'
- en: The next listing shows the new place view with its updated `render` method.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了带有更新后的 `render` 方法的新的地点视图。
- en: Listing 17.8\. A web-based place view ([http://jsbin.com/cakine/edit?js,console](http://jsbin.com/cakine/edit?js,console))
  id: totrans-163
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 17.8\. 基于网络的地点视图 ([http://jsbin.com/cakine/edit?js,console](http://jsbin.com/cakine/edit?js,console))
- en: '![](317fig02_alt.jpg)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![](317fig02_alt.jpg)'
- en: Those changes to the `render` methods are all you need to move the display of
    player and place information to the web page from the console. For now, the user
    continues to give commands via the console.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 这些对 `render` 方法的更改就是你需要将玩家和地点信息从控制台移动到网页显示的所有更改。目前，用户仍然通过控制台输入命令。
- en: 17.5.3\. Using JavaScript’s strict mode
  id: totrans-166
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.5.3\. 使用 JavaScript 的严格模式
- en: JavaScript is in use on millions of web pages. Those pages need to continue
    working even as JavaScript evolves and matures. To opt into more recent ways of
    using the language that alert you to more errors you might have made, optimize
    how the language works, and prepare the way for further developments, you can
    run your code in *strict mode*. To enable strict mode for a function, add `"use`
    `strict"` at the top of the function.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: JavaScript 被用于数百万个网页上。随着 JavaScript 的演变和成熟，这些页面需要继续工作。为了采用更现代的语言使用方式，这些方式会提醒你可能犯的错误，优化语言的工作方式，并为进一步的发展做好准备，你可以在
    *严格模式* 下运行你的代码。为了为一个函数启用严格模式，请在函数顶部添加 `"use` `strict"`。
- en: All of your code throughout the book could have been run in strict mode, but
    I felt it might be distracting while learning the basics. Modules in [part 3](kindle_split_026.html#part03)
    will all be in strict mode; [listing 17.8](#ch17ex08) is the first module in [part
    3](kindle_split_026.html#part03), which is why it’s being introduced at this point.
    Find out more at [www.room51.co.uk/js/strict-mode.html](http://www.room51.co.uk/js/strict-mode.html).
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 书中的所有代码都可以在严格模式下运行，但我认为在学习基础知识时可能会分散注意力。第 3 部分 [part 3](kindle_split_026.html#part03)
    中的所有模块都将使用严格模式；[列表 17.8](#ch17ex08) 是第 3 部分 [part 3](kindle_split_026.html#part03)
    中的第一个模块，这就是为什么它在这个时候被介绍。更多详情请访问 [www.room51.co.uk/js/strict-mode.html](http://www.room51.co.uk/js/strict-mode.html)。
- en: 17.5.4\. Loading modules and adding placeholders in the HTML
  id: totrans-169
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.5.4\. 在 HTML 中加载模块和添加占位符
- en: The next listing shows the complete HTML for your first web-based version of
    *The Crypt*. It includes `script` tags to load all of the modules you need.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了 *The Crypt* 的第一个基于网络的完整 HTML 版本。它包括 `script` 标签来加载所有需要的模块。
- en: Listing 17.9\. A web-based The Crypt game (HTML) ([http://jsbin.com/zaxaje/edit?html,console,output](http://jsbin.com/zaxaje/edit?html,console,output))
  id: totrans-171
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 17.9\. 基于网络的 The Crypt 游戏 (HTML) ([http://jsbin.com/zaxaje/edit?html,console,output](http://jsbin.com/zaxaje/edit?html,console,output))
- en: '![](ch17ex09-0.jpg)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![](ch17ex09-0.jpg)'
- en: '![](ch17ex09-1.jpg)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
  zh: '![](ch17ex09-1.jpg)'
- en: You set the title of the page using a `title` element in the `head` section.
    The page title isn’t always visible when working in the JS Bin editing environment
    but is normally used by browsers to label tabs and windows showing the page and
    when saving the page as a bookmark or favorite. The `script` tags for loading
    modules are added just before the closing `body` tag. This ensures that the two
    `div` elements used by the program are on the page before any code tries to update
    them with player and place information.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 您使用`head`部分中的`title`元素设置页面标题。在JS Bin编辑环境中工作时，页面标题并不总是可见，但通常由浏览器用于标记显示页面的选项卡和窗口，以及当保存页面为书签或收藏时。加载模块的`script`标签添加在`body`标签关闭之前。这确保了程序使用的两个`div`元素在尝试用玩家和地点信息更新它们之前已经在页面上。
- en: Unfortunately, because your views use the `spacer` namespace to format the generated
    text with line breaks and spaces for the console, and web pages don’t honor those
    line breaks and spaces, all of the player and place information runs together.
    Although the output isn’t quite what you wanted, you can still play the game,
    as shown in [figure 17.10](#ch17fig10).
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，因为您的视图使用`spacer`命名空间通过换行符和空格格式化生成的文本，而网页不尊重这些换行符和空格，所以所有玩家和地点信息都连在一起。尽管输出并不完全符合您的期望，但您仍然可以玩游戏，如图17.10所示。
- en: Figure 17.10\. The text output runs together but the game is playable.
  id: totrans-176
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图17.10\. 文本输出连在一起，但游戏仍然可玩。
- en: '![](17fig10_alt.jpg)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![](17fig10_alt.jpg)'
- en: 17.5.5\. Adding a touch of CSS
  id: totrans-178
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.5.5\. 添加CSS风格
- en: 'You have one more panel up your sleeve on JS Bin! The CSS panel is used for
    specifying how you want elements to look on a page: their size, color, margins,
    borders, and so on. With a couple of lines of CSS, you can tell the browser to
    honor the line breaks generated by your view modules and use a font that gives
    the same amount of space to each character, just like the font on the console.'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在JS Bin中，您还有一张底牌！CSS面板用于指定您希望页面上的元素看起来如何：它们的大小、颜色、边距、边框等。通过几行CSS，您可以告诉浏览器尊重由视图模块生成的换行符，并使用一个给每个字符相同空间的字体，就像控制台上的字体一样。
- en: The next listing shows the code to add to the CSS panel.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了要添加到CSS面板的代码。
- en: Listing 17.10\. A web-based The Crypt game (CSS) ([http://jsbin.com/toyahi/edit?css](http://jsbin.com/toyahi/edit?css))
  id: totrans-181
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表17.10\. 基于网络的《密码游戏》（CSS）([http://jsbin.com/toyahi/edit?css](http://jsbin.com/toyahi/edit?css))
- en: '[PRE23]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: The first rule tells the browser to preserve the white space (that is, spaces
    and line breaks) of text content in `div` elements. The second specifies that
    the browser should use a monospace font for text in `div` elements. Your page
    uses `div` elements for the player information and for the place information.
    The output on the web page is now formatted as it was on the console. Refer to
    [figure 17.8](#ch17fig08) to see the nicely formatted output.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 第一条规则告诉浏览器保留`div`元素中文本内容的空白（即空格和换行符）。第二条指定浏览器应使用等宽字体显示`div`元素中的文本。您的页面使用`div`元素来显示玩家信息和地点信息。网页上的输出现在格式化得与控制台上的格式相同。请参阅[图17.8](#ch17fig08)以查看格式良好的输出。
- en: 17.5.6\. Playing the game
  id: totrans-184
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.5.6\. 游戏玩法
- en: 'You still issue game instructions via the console as methods of `game`. The
    methods available are `get`, `go`, and `use`. Run the program at [http://jsbin.com/toyahi/edit?console,output](http://jsbin.com/toyahi/edit?console,output)
    and have a go at playing the game, issuing commands on the console like this:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 您仍然可以通过`game`对象的方法在控制台中发出游戏指令。可用方法有`get`、`go`和`use`。在[http://jsbin.com/toyahi/edit?console,output](http://jsbin.com/toyahi/edit?console,output)上运行程序，尝试玩游戏，并在控制台输入如下命令：
- en: '[PRE24]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Using line breaks and spaces to format the output isn’t the best approach. It
    would be better to use appropriate HTML tags (for headings, paragraphs, and lists)
    to convey the structure of the different pieces of information in the output.
    You’ll look at better ways of formatting the player and place information using
    HTML in [chapter 19](kindle_split_029.html#ch19) when you investigate templates.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 使用换行符和空格来格式化输出并不是最佳方法。更好的方法是使用适当的HTML标签（用于标题、段落和列表）来传达输出中不同信息片段的结构。当您在[第19章](kindle_split_029.html#ch19)中研究模板时，您将了解使用HTML格式化玩家和地点信息的更好方法。
- en: The current version of *The Crypt* is a bit of a hybrid. Although you make use
    of HTML to display some information, you still force players to enter commands
    on the console. In [chapter 18](kindle_split_028.html#ch18) you’ll discover how
    to use simple form elements like buttons, drop-down lists, and text boxes to let
    players interact with the game directly on the web page. To prepare the way for
    that fully HTML-based version, you finish this chapter by repeating the changes
    you made to the place and player views but this time for the message view.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 当前版本的*《密码学》*是一个混合体。虽然你使用HTML来显示一些信息，但你仍然强迫玩家在控制台输入命令。在第[18章](kindle_split_028.html#ch18)中，你将发现如何使用简单的表单元素，如按钮、下拉列表和文本框，让玩家直接在网页上与游戏互动。为了为完全基于HTML的版本做准备，你通过重复对位置和玩家视图所做的更改来完成本章，但这次是对消息视图进行更改。
- en: 17.5.7\. Preparing the message view
  id: totrans-189
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 17.5.7. 准备消息视图
- en: In order to make the UI 100% web page based, you need to update the message
    view so that it displays messages on the web page rather than on the console.
    The following listing shows the new module code.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使UI 100%基于网页，你需要更新消息视图，使其在网页上显示消息而不是在控制台上。以下列表显示了新的模块代码。
- en: Listing 17.11\. A web-based message view ([http://jsbin.com/nocosej/edit?js,console](http://jsbin.com/nocosej/edit?js,console))
  id: totrans-191
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表17.11. 基于网络的邮件视图([http://jsbin.com/nocosej/edit?js,console](http://jsbin.com/nocosej/edit?js,console))
- en: '![](320fig01_alt.jpg)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![320fig01_alt.jpg](320fig01_alt.jpg)'
- en: The view will need an element with an `id` of `messages`. It also adds a `clear`
    method for removing messages from the page.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 视图需要一个具有`id`为`messages`的元素。它还添加了一个`clear`方法，用于从页面上删除消息。
- en: 17.6\. Summary
  id: totrans-194
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 17.6. 概述
- en: Annotate text with HTML to specify the role the text plays in the structure
    of a document. For example, the text is a heading, a list item, or a paragraph.
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用HTML注释文本以指定文本在文档结构中的作用。例如，文本是标题、列表项或段落。
- en: 'Precede an HTML document with its document type:'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在HTML文档之前加上其文档类型：
- en: '[PRE25]'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Use `html` tags to wrap the entire document:'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`html`标签包裹整个文档：
- en: '[PRE26]'
  id: totrans-199
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The `head` element of a document contains information about the document, for
    example, its title and character encoding:'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文档的`head`元素包含有关文档的信息，例如，其标题和字符编码：
- en: '[PRE27]'
  id: totrans-201
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'The `body` element of a document contains the content to be displayed on the
    web page:'
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文档的`body`元素包含要在网页上显示的内容：
- en: '[PRE28]'
  id: totrans-203
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Use tags appropriate to the content. Among many more tags, there are headings
    `<h1>`, `<h2>,` `...` `,` `<h6>`; paragraphs `<p>`; list items `<li>`; and lists
    `<ol>` and `<ul>`.
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用适合内容的相关标签。在许多其他标签中，有标题`<h1>`、`<h2>`、`...`、`<h6>`；段落`<p>`；列表项`<li>`；以及列表`<ol>`和`<ul>`。
- en: Add `id` attributes to opening tags to uniquely identify elements on the page.
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在打开标签中添加`id`属性以唯一标识页面上的元素。
- en: '[PRE29]'
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'From JavaScript, get a reference to an HTML element by using the `document
    .getElementById` method:'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从JavaScript中，通过使用`document .getElementById`方法获取HTML元素的引用：
- en: '[PRE30]'
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Change the content of an element by setting its `innerHTML` property:'
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过设置元素的`innerHTML`属性来更改元素的内容：
- en: '[PRE31]'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Chapter 18\. Controls: getting user input'
  id: totrans-211
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第18章. 控件：获取用户输入
- en: '***This chapter covers***'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: '***本章涵盖***'
- en: Using buttons to initiate actions
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用按钮来启动操作
- en: Collecting user input with text boxes and drop-down lists
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用文本框和下拉列表收集用户输入
- en: Calling functions automatically when a button is clicked
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当按钮被点击时自动调用函数
- en: We love buttons! Whether we’re buying books on Amazon, liking a tweet, or sending
    that late-night drunken email, we find it hard to resist clicking those alluring,
    colorful buttons. Well, it’s time for you to issue your own calls to action and
    start adding buttons to your pages. And while you’re at it, you need to make space
    for text boxes and drop-down lists too.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 我们喜欢按钮！无论是我们在亚马逊上购买书籍、喜欢一条推文，还是发送深夜醉酒的电子邮件，我们都很难抗拒点击那些诱人、多彩的按钮。好吧，现在是时候你发出自己的行动号召，并开始在页面上添加按钮了。而且，当你在做这件事的时候，你还需要为文本框和下拉列表腾出空间。
- en: In [chapter 17](kindle_split_027.html#ch17) you made the jump to HTML and used
    JavaScript to add content to a web page. To get user input, however, you stuck
    with the console. In these days of flashy web apps you want the users to interact
    solely via the web page; they shouldn’t have to know JavaScript and go searching
    for the console to use the programs you write for them.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第17章](kindle_split_027.html#ch17)中，你跳到了HTML并使用JavaScript向网页添加内容。然而，为了获取用户输入，你仍然坚持使用控制台。在这些充满活力的网络应用的日子里，你希望用户仅通过网页进行交互；他们不应该需要知道JavaScript并寻找控制台来使用你为他们编写的程序。
- en: This chapter introduces the HTML `input`, `select`, and `button` elements, letting
    users type information and commands into a text box, choose from a drop-down list,
    and initiate actions by clicking buttons. You see how to set up functions that
    are automatically called when a button is clicked.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了HTML中的`input`、`select`和`button`元素，使用户能够将信息输入到文本框中，从下拉列表中选择，并通过点击按钮来启动操作。您将了解如何设置在按钮被点击时自动调用的函数。
- en: It’s fun to click buttons, so let’s start with those. *Click!*
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 点击按钮很有趣，所以让我们从这里开始。*点击！*
- en: 18.1\. Working with buttons
  id: totrans-220
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 18.1\. 使用按钮
- en: You’re building a My Movie Ratings website (see [chapter 17](kindle_split_027.html#ch17))
    and have been testing random greetings when visitors arrive at the site. You want
    to give visitors the ability to check out more greetings without reloading the
    whole page. You decide to add a button to your test page that updates the display
    with a random greeting ([figure 18.1](#ch18fig01)).
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 您正在构建一个“我的电影评分”网站（见[第17章](kindle_split_027.html#ch17)），并且一直在测试当访客到达网站时显示的随机问候语。您希望访客能够查看更多问候语而无需重新加载整个页面。您决定在测试页面上添加一个按钮，该按钮会使用随机问候语更新显示（[图18.1](#ch18fig01)）。
- en: Figure 18.1\. Clicking the Say Hi button displays a random greeting.
  id: totrans-222
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图18.1\. 点击“Say Hi”按钮会显示一个随机问候语。
- en: '![](18fig01_alt.jpg)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
  zh: '![图18.1](18fig01_alt.jpg)'
- en: 'Clicking the Say Hi button displays the greeting. But how? How can you make
    your JavaScript program respond to a user clicking the button? You need to do
    three things:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 点击“Say Hi”按钮会显示问候语。但这是如何实现的？您如何让您的JavaScript程序响应用户点击按钮？您需要做三件事：
- en: '**1**.  Add a `button` HTML element to the page'
  id: totrans-225
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**.  在页面上添加一个`button` HTML元素'
- en: '**2**.  Write a function to update the greeting'
  id: totrans-226
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**.  编写一个更新问候语的函数'
- en: '**3**.  Get the button to call the function when it’s clicked'
  id: totrans-227
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**.  让按钮在点击时调用函数'
- en: 18.1.1\. Adding a button to a page
  id: totrans-228
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.1.1\. 在页面上添加一个按钮
- en: 'Well, for starters, you need a button on the page. HTML includes a `button`
    element. Put the button text between the tags ([figure 18.2](#ch18fig02)):'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 好吧，首先，您需要在页面上有一个按钮。HTML包括一个`button`元素。将按钮文本放在标签之间（[图18.2](#ch18fig02)）：
- en: Figure 18.2\. The HTML for three buttons and the output generated
  id: totrans-230
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图18.2\. 三个按钮的HTML和生成的输出
- en: '![](18fig02_alt.jpg)'
  id: totrans-231
  prefs: []
  type: TYPE_IMG
  zh: '![图18.2](18fig02_alt.jpg)'
- en: '[PRE32]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: To work with the button in JavaScript, you give it a unique `id` attribute in
    HTML.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 要在JavaScript中处理按钮，您需要在HTML中给它一个唯一的`id`属性。
- en: '[PRE33]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: The following listing shows the key HTML for the My Movie Ratings test page.
    The paragraph with `id` of `"greeting"` is where you’ll insert the random greeting
    later.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表显示了“我的电影评分”测试页面的关键HTML。具有`id`为`"greeting"`的段落是您稍后插入随机问候语的地方。
- en: Listing 18.1\. My Movie Ratings greetings with button (HTML) ([http://jsbin.com/josoqik/edit?html,output](http://jsbin.com/josoqik/edit?html,output))
  id: totrans-236
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表18.1\. 带按钮的“我的电影评分”问候语（HTML）([http://jsbin.com/josoqik/edit?html,output](http://jsbin.com/josoqik/edit?html,output))
- en: '[PRE34]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: The output was shown in [figure 18.1](#ch18fig01). Feel free to take a peek
    at the CSS panel on JS Bin if you’re interested in how the styling is applied.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 输出结果显示在[图18.1](#ch18fig01)中。如果您对如何应用样式感兴趣，请随意查看JS Bin上的CSS面板。
- en: 18.1.2\. Writing functions to update the greeting
  id: totrans-239
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.1.2\. 编写更新问候语的函数
- en: In [chapter 17](kindle_split_027.html#ch17) you wrote two functions, `getGreeting`
    and `updateGreeting`, that chose a random welcome message and updated the display.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第17章](kindle_split_027.html#ch17)中，您编写了两个函数`getGreeting`和`updateGreeting`，它们选择一个随机的欢迎信息并更新显示。
- en: '[PRE35]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: The `updateGreeting` function updates the display by setting the `innerHTML`
    property of the paragraph element, `para`.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: '`updateGreeting`函数通过设置段落元素`para`的`innerHTML`属性来更新显示。'
- en: So you have your button and paragraph in place in the HTML and you have a function
    to update the paragraph. Now you want the button to call the `updateGreeting`
    function when a user clicks it.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，您已经在HTML中放置了按钮和段落，并且您有一个更新段落的函数。现在，您想让按钮在用户点击时调用`updateGreeting`函数。
- en: 18.1.3\. Listening for clicks
  id: totrans-244
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.1.3\. 监听点击事件
- en: '*Click*—“Wassup!” ... *Click*—“Hola!” ... *Click*—“Ay up me duck!”'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: '*点击*—“Wassup！” ... *点击*—“Hola！” ... *点击*—“Ay up me duck！”'
- en: “Dear button, please call my `updateGreeting` function whenever someone clicks
    you,” is the instruction you want to send. To give the button an instruction like
    that, you need a reference to the button in JavaScript.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: “亲爱的按钮，请在我点击你的时候调用我的`updateGreeting`函数，”这是您想要发送的指令。要给按钮这样的指令，您需要在JavaScript中获取按钮的引用。
- en: '[PRE36]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Once you have a reference to the button, `btn`, you can tell the button to
    call a function whenever the button is clicked:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您有了按钮的引用`btn`，您就可以告诉按钮在按钮被点击时调用一个函数：
- en: '[PRE37]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: The `addEventListener` method tells the button (or whichever element it’s called
    from) to call a specified function whenever a specified *event* occurs—in this
    case whenever the button is clicked. It’s like the `updateGreeting` function is
    waiting, or *listening*, for the button to be clicked.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '`addEventListener` 方法告诉按钮（或从其调用的任何元素）在指定的事件发生时调用指定的函数——在这种情况下，当按钮被点击时。这就像 `updateGreeting`
    函数正在等待，或者 *监听* 按钮被点击。'
- en: '[Listing 18.2](#ch18ex02) shows the final listing for your random greetings
    test page. It’s the same as the listing from [chapter 17](kindle_split_027.html#ch17)
    but with the two lines of button code added. The code is wrapped in an immediately
    invoked function expression to avoid polluting the global namespace. It also includes
    a `use strict` statement to instruct the browser to use strict mode (see [section
    17.5.3](kindle_split_027.html#ch17lev2sec12)).'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 18.2](#ch18ex02) 显示了随机问候测试页面的最终列表。它与第 17 章中的列表相同，但增加了两行按钮代码。代码被包裹在一个立即调用的函数表达式中，以避免污染全局命名空间。它还包括一个
    `use strict` 语句，指示浏览器使用严格模式（见[第 17.5.3 节](kindle_split_027.html#ch17lev2sec12)）。'
- en: Listing 18.2\. My Movie Ratings greetings with button ([http://jsbin.com/josoqik/edit?js,output](http://jsbin.com/josoqik/edit?js,output))
  id: totrans-252
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 18.2\. My Movie Ratings 欢迎信息与按钮 ([http://jsbin.com/josoqik/edit?js,output](http://jsbin.com/josoqik/edit?js,output))
- en: '![](326fig01_alt.jpg)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![图片](326fig01_alt.jpg)'
- en: Take a look back at [chapter 12](kindle_split_021.html#ch12) for a reminder
    of how to use `Math.floor` and `Math .random` to generate a random index for an
    array.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 回顾[第 12 章](kindle_split_021.html#ch12)，以提醒如何使用 `Math.floor` 和 `Math .random`
    生成一个用于数组的随机索引。
- en: '|  |'
  id: totrans-255
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: '**A marvelous menagerie of events**'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: '**事件种类繁多**'
- en: Clicks aren’t the only events that functions can listen out for; mouse moves,
    page scrolling, keys on the keyboard being pressed, and images loading are some
    others, and taps, flicks, force presses, and shakes are some new events appearing
    for touch-enabled and mobile devices.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 点击不是函数可以监听的唯一事件；鼠标移动、页面滚动、键盘按键和图片加载也是一些其他事件，而触摸设备和移动设备出现了一些新事件，如点击、滑动、强按和摇晃。
- en: You’ll keep it simple and stick with button clicks for now, but if you’re interested
    in the marvelous menagerie of possible events, check out the event reference on
    the Mozilla Developer Network at [https://developer.mozilla.org/en-US/docs/Web/Events](https://developer.mozilla.org/en-US/docs/Web/Events).
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 目前我们会保持简单，只关注按钮点击，但如果你对可能的事件种类感兴趣，可以查看 Mozilla 开发者网络上的事件参考[https://developer.mozilla.org/en-US/docs/Web/Events](https://developer.mozilla.org/en-US/docs/Web/Events)。
- en: '|  |'
  id: totrans-259
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 18.2\. Using a select element to choose an option
  id: totrans-260
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 18.2\. 使用选择元素选择一个选项
- en: The My Movie Ratings website lets users rate movies. They choose a rating from
    a drop-down menu and click the Rate button. The page then shows a message with
    their rating ([figure 18.3](#ch18fig03)).
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: My Movie Ratings 网站允许用户对电影进行评分。他们从下拉菜单中选择一个评分，然后点击评分按钮。页面随后显示他们的评分信息（[图 18.3](#ch18fig03)）。
- en: Figure 18.3\. Clicking the Rate button pops up a message with your rating.
  id: totrans-262
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 18.3\. 点击评分按钮会弹出带有你评分的消息。
- en: '![](18fig03_alt.jpg)'
  id: totrans-263
  prefs: []
  type: TYPE_IMG
  zh: '![图片](18fig03_alt.jpg)'
- en: 'To implement the rating system, you need to do four things:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 要实现评分系统，你需要做四件事：
- en: '**1**.  Add a `select` HTML element to the page with `option` elements for
    each rating'
  id: totrans-265
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**. 在页面上添加一个带有每个评分 `option` 元素的 `select` HTML 元素'
- en: '**2**.  Add a `button` HTML element to the page with “Rate” as its text'
  id: totrans-266
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**. 在页面上添加一个带有“评分”文本的 `button` HTML 元素'
- en: '**3**.  Write a function to pop up the message with the rating'
  id: totrans-267
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**. 编写一个函数以弹出带有评分的消息'
- en: '**4**.  Tell the button to call the function when clicked'
  id: totrans-268
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**4**. 告诉按钮在点击时调用函数'
- en: 18.2.1\. Adding a select element to the page
  id: totrans-269
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.2.1\. 在页面上添加一个选择元素
- en: Web browsers render the `select` element as a drop-down list. You use `option`
    elements to specify the choices in the list ([figure 18.4](#ch18fig04)).
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 网络浏览器将 `select` 元素渲染为下拉列表。你使用 `option` 元素来指定列表中的选项（[图 18.4](#ch18fig04)）。
- en: Figure 18.4\. Two select elements in HTML, displayed on a web page and with
    a selection in progress
  id: totrans-271
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 18.4\. HTML 中的两个选择元素，在网页上显示，并且正在选择中
- en: '![](18fig04_alt.jpg)'
  id: totrans-272
  prefs: []
  type: TYPE_IMG
  zh: '![图片](18fig04_alt.jpg)'
- en: '[PRE38]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Test it out on JS Bin. Create a new bin with the HTML, Console, and Output
    panels open. Replace the contents of the HTML panel with the `select` code in
    the previous snippet. You should see the drop-down list appear on the Output panel.
    At the console prompt, enter these commands:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 在 JS Bin 上测试它。创建一个新的 bin，并打开 HTML、控制台和输出面板。将 HTML 面板的内容替换为上一个片段中的 `select` 代码。你应该在输出面板上看到下拉列表出现。在控制台提示符下，输入以下命令：
- en: '[PRE39]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Choose a different film from the drop-down list on the Output panel. Then use
    JavaScript to check its new value:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 在输出面板的下拉列表中选择不同的电影。然后使用JavaScript检查其新值：
- en: '[PRE40]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'You can update the drop-down’s selected value from JavaScript too:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以从JavaScript更新下拉列表的选中值：
- en: '[PRE41]'
  id: totrans-279
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: The value set in JavaScript is selected on the Output panel.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 在JavaScript中设置的值在输出面板中被选中。
- en: '[Figure 18.4](#ch18fig04) shows the HTML for two `select` elements and how
    they’re rendered on a web page.'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: '[图18.4](#ch18fig04)显示了两个`select`元素的HTML以及它们在网页上的渲染方式。'
- en: The next listing shows the HTML for the `body` of the My Movie Ratings main
    page, with a `select` element and a `button` to rate the film shown.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了My Movie Ratings主页体的HTML，其中包含一个用于评分电影的`select`元素和按钮。
- en: Listing 18.3\. My Movie Ratings with a drop-down list (HTML) ([http://jsbin.com/hikuzi/edit?html,output](http://jsbin.com/hikuzi/edit?html,output))
  id: totrans-283
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表18.3.带有下拉列表的My Movie Ratings（HTML）（[http://jsbin.com/hikuzi/edit?html,output](http://jsbin.com/hikuzi/edit?html,output)）
- en: '![](ch18ex03-0.jpg)'
  id: totrans-284
  prefs: []
  type: TYPE_IMG
  zh: '![图片](ch18ex03-0.jpg)'
- en: '![](ch18ex03-1.jpg)'
  id: totrans-285
  prefs: []
  type: TYPE_IMG
  zh: '![图片](ch18ex03-1.jpg)'
- en: Notice that you can add an attribute of `selected` to have that option selected
    when the drop-down list is shown on the web page.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，你可以添加一个`selected`属性，以便在网页上显示下拉列表时选择该选项。
- en: 18.2.2\. A function to rate movies and a button to call it
  id: totrans-287
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.2.2. 评分电影的功能和调用它的按钮
- en: To rate a movie, you need a function that gets the user’s choice from the drop-down
    list, gets the value of the selected option in the `select` element, and pops
    up a message that includes that value, shown in [listing 18.4](#ch18ex04).
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 要对电影进行评分，你需要一个函数，该函数从下拉列表中获取用户的选择，从`select`元素中获取选中选项的值，并弹出包含该值的消息，如[列表18.4](#ch18ex04)所示。
- en: Listing 18.4\. My Movie Ratings with a drop-down list ([http://jsbin.com/hikuzi/edit?js,output](http://jsbin.com/hikuzi/edit?js,output))
  id: totrans-289
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表18.4.带有下拉列表的My Movie Ratings（[http://jsbin.com/hikuzi/edit?js,output](http://jsbin.com/hikuzi/edit?js,output)）
- en: '![](330fig01_alt.jpg)'
  id: totrans-290
  prefs: []
  type: TYPE_IMG
  zh: '![图片](330fig01_alt.jpg)'
- en: The `value` property of the drop-down list gives you the user’s rating. You
    call the `alert` function, provided by the browser, to display the rating in a
    pop-up dialog box. Having wrapped the code in a function, `rateMovie`, you use
    `addEventListener` to tell the Rate button to call `rateMovie` whenever it’s clicked.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 下拉列表的`value`属性提供了用户的评分。你调用浏览器提供的`alert`函数，在弹出对话框中显示评分。在将代码包装在`rateMovie`函数中后，你使用`addEventListener`告诉评分按钮在点击时调用`rateMovie`。
- en: Your users can choose a rating from a list. But what if you want to give them
    more freedom to express themselves?
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 您的用户可以从列表中选择一个评分。但如果你希望给他们更多的自由来表达自己呢？
- en: 18.3\. Reading user input with text boxes
  id: totrans-293
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 18.3. 使用文本框读取用户输入
- en: Congratulations, the My Movie Ratings site now lets users rate movies! Your
    success gets you thinking—what about comments? Why not get users to add a brief
    comment with their ratings? [Figure 18.5](#ch18fig05) shows the site with two
    comments added and a third in progress.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜，My Movie Ratings网站现在允许用户对电影进行评分！你的成功让你开始思考——关于评论呢？为什么不鼓励用户在评分时添加简短的评论呢？[图18.5](#ch18fig05)显示了添加了两个评论并有一个评论正在进行中的网站。
- en: Figure 18.5\. The movie has a text box to add comments and a section to display
    them.
  id: totrans-295
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图18.5。电影有一个文本框来添加评论，还有一个用于显示它们的区域。
- en: '![](18fig05_alt.jpg)'
  id: totrans-296
  prefs: []
  type: TYPE_IMG
  zh: '![图片](18fig05_alt.jpg)'
- en: 'Users type their comment into the text box, pick a rating from the drop-down
    list, and click the Rate button. Rather than popping up a message, you now add
    their comment and rating to the comments section for the movie. To add comments
    to the site, you need to do five things:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 用户将评论输入到文本框中，从下拉列表中选择一个评分，然后点击评分按钮。现在，你不再弹出消息，而是将他们的评论和评分添加到电影的评论部分。为了向网站添加评论，你需要做五件事：
- en: '**1**.  Add a text box to the page'
  id: totrans-298
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**. 在页面上添加一个文本框'
- en: '**2**.  Add an unordered list to the HTML as a place for comments to go'
  id: totrans-299
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**. 在HTML中添加一个无序列表作为评论的放置位置'
- en: '**3**.  Get a reference to the text box in JavaScript and access its value'
  id: totrans-300
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**. 在JavaScript中获取文本框的引用并访问其值'
- en: '**4**.  Get a reference to the comments list in JavaScript'
  id: totrans-301
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**4**. 在JavaScript中获取评论列表的引用'
- en: '**5**.  Update the `rateMovie` function to append a comment to the comments
    list'
  id: totrans-302
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**5**. 更新`rateMovie`函数以将评论追加到评论列表'
- en: 18.3.1\. Adding a text box to the page
  id: totrans-303
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.3.1. 在页面上添加文本框
- en: To add a text box to the page, you use an `input` HTML element with its `type`
    attribute set to `"text"`. Include an `id` attribute to reference the element
    from JavaScript.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 要在页面上添加一个文本框，你使用一个`input`HTML元素，将其`type`属性设置为`"text"`。包括一个`id`属性，以便从JavaScript中引用该元素。
- en: '[PRE42]'
  id: totrans-305
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: The `input` element displays form controls on a web page. It doesn’t wrap any
    other content so is written as a *self-closing* tag. There’s no opening and closing
    tag pair. Notice the forward slash at the end of the tag; it shows you that this
    tag doesn’t need a closing tag. The text box goes in the `"controls" div` along
    with the ratings drop-down list and the Rate button.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: '`input` 元素在网页上显示表单控件。它不包装任何其他内容，因此写作一个 *自闭合* 标签。没有开闭标签对。注意标签末尾的斜杠；它表明这个标签不需要闭合标签。文本框位于
    `"controls"` div 中，与评分下拉列表和评分按钮一起。'
- en: '[PRE43]'
  id: totrans-307
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '[PRE44]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: The `input` element with a `type` attribute set to `"text"` is displayed as
    a text box on the page. Other common `type` attributes for input elements include
    `password`, `submit`, `checkbox`, and `radio`. Browser makers such as Microsoft,
    Apple, Google, Mozilla, and Opera are working to improve support for new types
    like color pickers, date pickers, and sliders. To find out more about types of
    input elements, you can visit the Mozilla Developer Network at [https://developer.mozilla.org/en/docs/Web/HTML/Element/Input](https://developer.mozilla.org/en/docs/Web/HTML/Element/Input).
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: '`type` 属性设置为 `"text"` 的 `input` 元素在页面上显示为文本框。其他常见的 `type` 属性包括 `password`、`submit`、`checkbox`
    和 `radio`。微软、苹果、谷歌、Mozilla 和 Opera 等浏览器制造商正在努力改进对新类型（如颜色选择器、日期选择器和滑块）的支持。要了解更多关于输入元素类型的信息，您可以访问
    Mozilla 开发者网络 [https://developer.mozilla.org/en/docs/Web/HTML/Element/Input](https://developer.mozilla.org/en/docs/Web/HTML/Element/Input)。'
- en: 18.3.2\. Adding an unordered list to display the comments
  id: totrans-310
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.3.2\. 向显示评论的列表中添加无序列表
- en: You use a `ul` element for the list of comments, preceding it by a heading.
    You give the list an `id` attribute so you can add list items using JavaScript.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 您使用一个 `ul` 元素作为评论列表，在其前面添加一个标题。您给列表一个 `id` 属性，这样您就可以使用JavaScript添加列表项。
- en: '[PRE45]'
  id: totrans-312
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: You add the comments list after the Actors and Directors lists.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要在演员和导演列表之后添加评论列表。
- en: 18.3.3\. Getting references to the new elements
  id: totrans-314
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.3.3\. 获取新元素的引用
- en: In order to read comments typed into the text box and to add list items to the
    list of comments, you need to get a reference to the two elements in your JavaScript
    code.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 为了读取文本框中输入的评论并添加列表项到评论列表中，您需要在JavaScript代码中获取这两个元素的引用。
- en: '[PRE46]'
  id: totrans-316
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'The text entered by the user in the text box is accessed via its `value` property.
    To see the `value` property in action, you can access and update it at the console.
    Visit the My Movie Ratings page at [http://jsbin.com/nevaxit/edit?console,output](http://jsbin.com/nevaxit/edit?console,output),
    type “Great Movie!” into the text box, and then type these commands at the console
    prompt:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 用户在文本框中输入的文本可以通过其 `value` 属性访问。要查看 `value` 属性的实际操作，您可以在控制台中访问和更新它。访问 My Movie
    Ratings 页面 [http://jsbin.com/nevaxit/edit?console,output](http://jsbin.com/nevaxit/edit?console,output)，在文本框中输入“Great
    Movie!”，然后在控制台提示符中输入以下命令：
- en: '[PRE47]'
  id: totrans-318
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: The last command will update the contents of the text box on the web page.
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个命令将更新网页上文本框的内容。
- en: 18.3.4\. Updating the rateMovie function
  id: totrans-320
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.3.4\. 更新 rateMovie 函数
- en: The next listing shows all of the assembled pieces. The comment from the text
    box and the rating from the drop-down list are appended as a list item to the
    existing list of comments.
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了所有组装好的部分。来自文本框的评论和来自下拉列表的评分作为列表项附加到现有的评论列表中。
- en: Listing 18.5\. Movies, comments, and a random greeting ([http://jsbin.com/nevaxit/edit?js,output](http://jsbin.com/nevaxit/edit?js,output))
  id: totrans-322
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 18.5\. 电影、评论和随机的问候语 ([http://jsbin.com/nevaxit/edit?js,output](http://jsbin.com/nevaxit/edit?js,output))
- en: '![](ch18ex05-0.jpg)'
  id: totrans-323
  prefs: []
  type: TYPE_IMG
  zh: '![](ch18ex05-0.jpg)'
- en: '![](ch18ex05-1.jpg)'
  id: totrans-324
  prefs: []
  type: TYPE_IMG
  zh: '![](ch18ex05-1.jpg)'
- en: In the listing, you need to get references to five HTML elements. Rather than
    typing out `document.getElementById(id)` each time, you create a function that
    does the same job but with a shorter name, `getById`.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 在列表中，您需要获取五个HTML元素的引用。而不是每次都输入 `document.getElementById(id)`，您可以创建一个执行相同任务但名称更短的功能，即
    `getById`。
- en: '[Listing 18.6](#ch18ex06) shows the updated HTML including the text box, comments
    list, and a `span` element for your random greetings. A `span` wraps text *inline*,
    within a paragraph, for example, and lets you describe the purpose of the text
    it wraps, in this case with an `id` of `"greeting"`, style it differently (change
    the color, make it bold, change its size), and access it via JavaScript (to add
    a random greeting, for example).'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 18.6](#ch18ex06) 显示了更新的HTML，包括文本框、评论列表和一个用于随机问候语的 `span` 元素。一个 `span` 在段落内
    *内联* 包裹文本，让您可以描述它所包裹的文本的目的，在这个例子中，使用 `id` 为 `"greeting"`，可以不同地样式化（改变颜色、加粗、改变大小），并通过JavaScript访问（例如，添加一个随机问候语）。'
- en: The contents of the `body` element are shown here, and some items have been
    omitted or compressed because they’re unchanged from [listing 18.3](#ch18ex03).
    Everything is on JS Bin.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 这里显示了 `body` 元素的内容，一些项目已被省略或压缩，因为它们与 [列表 18.3](#ch18ex03) 中的内容没有变化。所有内容都在 JS
    Bin 上。
- en: Listing 18.6\. Movies, comments, and a random greeting (HTML) ([http://jsbin.com/nevaxit/edit?html,output](http://jsbin.com/nevaxit/edit?html,output))
  id: totrans-328
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 18.6\. 电影、评论和随机问候语 (HTML) ([http://jsbin.com/nevaxit/edit?html,output](http://jsbin.com/nevaxit/edit?html,output))
- en: '![](333fig01_alt.jpg)'
  id: totrans-329
  prefs: []
  type: TYPE_IMG
  zh: '![](333fig01_alt.jpg)'
- en: Try out the web page at [http://output.jsbin.com/nevaxit](http://output.jsbin.com/nevaxit).
    Add some comments and ratings and add them to the list. And check out the random
    greetings.
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [http://output.jsbin.com/nevaxit](http://output.jsbin.com/nevaxit) 上尝试网页。添加一些评论和评分，并将它们添加到列表中。并查看随机问候语。
- en: 18.3.5\. Styling the examples with CSS
  id: totrans-331
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.3.5\. 使用 CSS 设计示例样式
- en: Many of the examples in [part 3](kindle_split_026.html#part03) of *Get Programming
    with JavaScript* have had colors, fonts, margins, borders, and so on set with
    CSS rules on the CSS panel. Although the book doesn’t teach CSS directly, please
    have a look at the CSS rules. Taken one at a time, most of them are easy to follow.
    Try changing some values or deleting some or all of the rules. Although they may
    make the page look nicer, all examples should work just fine without them.
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *Get Programming with JavaScript* 的第 3 部分 [kindle_split_026.html#part03] 中的许多示例都使用了
    CSS 规则设置了颜色、字体、边距、边框等。虽然这本书没有直接教授 CSS，但请查看 CSS 规则。逐个来看，大多数都很容易理解。尝试更改一些值或删除一些或所有规则。虽然它们可能会使页面看起来更美观，但所有示例在没有它们的情况下都应该运行良好。
- en: 18.4\. The Crypt—player commands via a text box
  id: totrans-333
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 18.4\. 通过文本框的 *The Crypt* 玩家命令
- en: Players exploring *The Crypt* have been entering their `get`, `go`, and `use`
    commands at the console prompt. You can now move user input to the game’s web
    page with commands entered via a text box, as shown in [figure 18.6](#ch18fig06).
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 探索 *The Crypt* 的玩家一直在控制台提示符中输入 `get`、`go` 和 `use` 命令。现在，您可以通过在文本框中输入命令来将用户输入移动到游戏网页上，如图
    18.6 所示。
- en: Figure 18.6\. Commands are now entered into a text box at the bottom of the
    page.
  id: totrans-335
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 18.6\. 命令现在输入在页面底部的文本框中。
- en: '![](18fig06_alt.jpg)'
  id: totrans-336
  prefs: []
  type: TYPE_IMG
  zh: '![](18fig06_alt.jpg)'
- en: 'In order to create a web-based set of user controls, you need to do three things:'
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 为了创建一组基于网页的用户控件，您需要做三件事：
- en: '**1**.  Add a text box and button to the page.'
  id: totrans-338
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**.  向页面添加文本框和按钮。'
- en: '**2**.  Write a function to convert the text in the text box into game commands.'
  id: totrans-339
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**.  编写一个将文本框中的文本转换为游戏命令的函数。'
- en: '**3**.  Write a function to be called when the button is clicked.'
  id: totrans-340
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**.  编写一个在按钮被点击时调用的函数。'
- en: You could update the code in the controller module to include the two new functions.
    But the controller module works nicely already, setting up the game and working
    with the models and views for players, places, and messages (see [chapter 16](kindle_split_025.html#ch16)).
    A better plan is to add a separate module that deals with the commands entered
    into the text box, calling on the existing controller to execute the `get`, `go`,
    and `use` methods as necessary. [Figure 18.7](#ch18fig07) shows the modules used
    by *The Crypt*, including the new *Commands* module.
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以更新控制器模块中的代码，包括两个新函数。但控制器模块已经运行良好，设置了游戏，并与玩家、地点和消息的模型和视图一起工作（见 [第 16 章](kindle_split_025.html#ch16)）。更好的计划是添加一个单独的模块来处理文本框中输入的命令，根据需要调用现有的控制器来执行
    `get`、`go` 和 `use` 方法。[图 18.7](#ch18fig07) 显示了 *The Crypt* 使用的模块，包括新的 *Commands*
    模块。
- en: Figure 18.7\. Modules for *The Crypt*, including a Commands module to execute
    commands via a text box
  id: totrans-342
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 18.7\. *The Crypt* 的模块，包括用于通过文本框执行命令的命令模块
- en: '![](18fig07_alt.jpg)'
  id: totrans-343
  prefs: []
  type: TYPE_IMG
  zh: '![](18fig07_alt.jpg)'
- en: Get started by adding a text box and button to the HTML for the page.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 从添加文本框和按钮到网页的 HTML 开始。
- en: 18.4.1\. Adding controls to the page
  id: totrans-345
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.4.1\. 向页面添加控件
- en: You need a way for users to enter the command string and submit it. The following
    listing shows the HTML added to your *The Crypt* web page for the text box and
    button. The player, place, and messages `div` elements are initially empty, which
    is why they can’t be seen on the Output panel.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要一种让用户输入命令字符串并提交的方法。以下列表显示了添加到 *The Crypt* 网页中的 HTML，包括文本框和按钮。玩家、地点和消息的 `div`
    元素最初是空的，这就是为什么它们在输出面板上不可见。
- en: Listing 18.7\. Adding controls to *The Crypt* (HTML) ([http://jsbin.com/rijage/edit?html,output](http://jsbin.com/rijage/edit?html,output))
  id: totrans-347
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 18.7\. 向 *The Crypt* (HTML) 添加控件 ([http://jsbin.com/rijage/edit?html,output](http://jsbin.com/rijage/edit?html,output))
- en: '![](335fig01_alt.jpg)'
  id: totrans-348
  prefs: []
  type: TYPE_IMG
  zh: '![](335fig01_alt.jpg)'
- en: Your controls, the text box and button, are now on the page and they have `id`
    attributes set so they can be accessed using JavaScript.
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 你的控制，文本框和按钮，现在都在页面上，并且它们已经设置了 `id` 属性，以便可以使用 JavaScript 访问。
- en: 18.4.2\. Mapping text box entries to game commands
  id: totrans-350
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.4.2\. 将文本框输入映射到游戏命令
- en: '[Table 18.1](#ch18table01) shows how the commands entered into the text box
    will match up with the methods from the controller module created in [chapter
    16](kindle_split_025.html#ch16).'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: '[表18.1](#ch18table01)显示了输入到文本框中的命令如何与在第16章中创建的控制器模块的方法相匹配。'
- en: Table 18.1\. Comparing text box commands with methods from the controller module
  id: totrans-352
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表18.1\. 比较文本框命令与控制器模块的方法
- en: '| Text box command | Controller method |'
  id: totrans-353
  prefs: []
  type: TYPE_TB
  zh: '| 文本框命令 | 控制器方法 |'
- en: '| --- | --- |'
  id: totrans-354
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| get | game.get() |'
  id: totrans-355
  prefs: []
  type: TYPE_TB
  zh: '| get | game.get() |'
- en: '| go north | game.go("north") |'
  id: totrans-356
  prefs: []
  type: TYPE_TB
  zh: '| go north | game.go("north") |'
- en: '| use a rusty key north | game.use("a rusty key", "north") |'
  id: totrans-357
  prefs: []
  type: TYPE_TB
  zh: '| use a rusty key north | game.use("a rusty key", "north") |'
- en: As you can see, the text box commands should make it easier for users to play
    the game. So how do you translate the text box input into commands that the controller
    understands?
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所见，文本框命令应该使玩家更容易玩游戏。那么，你如何将文本框输入翻译成控制器能理解的命令呢？
- en: 18.4.3\. Issuing orders with split, join, pop, and shift
  id: totrans-359
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.4.3\. 使用 split、join、pop 和 shift 发出命令
- en: The user will type a command into a text box. You need to convert that command
    into an action that the program will take, as shown in [table 18.1](#ch18table01).
    To call the correct controller method (`get`, `go`, or `use`) based on the command
    entered in the text box, you first represent the command by a JavaScript object.
    The object will have a `type` property that matches the controller method that
    you need to call. [Table 18.2](#ch18table02) shows the commands and the command
    objects that they should generate.
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: 用户将在文本框中输入一个命令。你需要将这个命令转换成程序将采取的操作，如[表18.1](#ch18table01)所示。要根据文本框中输入的命令调用正确的控制器方法（`get`、`go`
    或 `use`），你首先用 JavaScript 对象表示该命令。该对象将有一个 `type` 属性，与你要调用的控制器方法相匹配。[表18.2](#ch18table02)显示了命令及其应生成的命令对象。
- en: Table 18.2\. Command objects
  id: totrans-361
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表18.2\. 命令对象
- en: '| Text box command | Command object |'
  id: totrans-362
  prefs: []
  type: TYPE_TB
  zh: '| 文本框命令 | 命令对象 |'
- en: '| --- | --- |'
  id: totrans-363
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| get | { type: "get"'
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: '| get | { type: "get"'
- en: '} |'
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: '} |'
- en: '| go north | { type: "go",'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: '| go north | { type: "go",'
- en: 'direction: "north"'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: '方向: "north"'
- en: '} |'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: '} |'
- en: '| use a rusty key north | { type: "use",'
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: '| use a rusty key north | { type: "use",'
- en: 'item: "a rusty key",'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: '项目: "一把生锈的钥匙",'
- en: 'direction: "north"'
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: '方向: "north"'
- en: '} |'
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: '} |'
- en: The first word of each text box command gives you the `type` of the command
    object. To get at the separate words of the command, you convert the string into
    an array of words using `split`.
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 每个文本框命令的第一个单词给出了命令对象的 `type`。要获取命令的单独单词，你使用 `split` 将字符串转换为单词数组。
- en: '[PRE48]'
  id: totrans-374
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: For example, `"get a rusty key"` becomes `["get", "a", "rusty", "key"]`. The
    `shift` array method removes and returns the first element in an array. That’s
    perfect for grabbing the command `type` for your command object.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，`"get a rusty key"` 变成 `["get", "a", "rusty", "key"]`。`shift` 数组方法移除并返回数组中的第一个元素。这对于获取命令对象的
    `type` 完美。
- en: '[PRE49]'
  id: totrans-376
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: The command word is no longer in the array. `["get",` `"a",` `"rusty",` `"key"]`
    becomes `["a", "rusty", "key"]`.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 命令词不再在数组中。`["get",` `"a",` `"rusty",` `"key"]` 变成 `["a", "rusty", "key"]`。
- en: For `go` and `use`, you grab the `direction`, the last element in the `commandWords`
    array, by using the `pop` array method.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 `go` 和 `use`，你通过使用 `pop` 数组方法获取 `commandWords` 数组中的最后一个元素，即 `direction`。
- en: '[PRE50]'
  id: totrans-379
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: If there are any elements left in the `commandWords` array, you join them back
    together to form the name of an item.
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 `commandWords` 数组中还有任何元素，你将它们重新连接起来形成物品的名称。
- en: '[PRE51]'
  id: totrans-381
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: For example, `["a", "rusty", "key"]` is joined to become `"a rusty key"`.
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，`["a", "rusty", "key"]` 被连接起来成为 `"a rusty key"`。
- en: The next listing shows a function that converts a command string into a command
    object using the ideas just discussed.
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了一个函数，该函数使用刚刚讨论的想法将命令字符串转换为命令对象。
- en: Listing 18.8\. Converting a command string into a command object ([http://jsbin.com/repebe/edit?js,console](http://jsbin.com/repebe/edit?js,console))
  id: totrans-384
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表18.8\. 将命令字符串转换为命令对象 ([http://jsbin.com/repebe/edit?js,console](http://jsbin.com/repebe/edit?js,console))
- en: '![](337fig01_alt.jpg)'
  id: totrans-385
  prefs: []
  type: TYPE_IMG
  zh: '![](337fig01_alt.jpg)'
- en: 'With the command object in hand you can now call the matching method of the
    game controller. To organize the different possible command types, use a control
    structure tailor made for deciding between many options: the `switch` block.'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 在手头有了命令对象后，你现在可以调用游戏控制器的匹配方法。为了组织不同的可能命令类型，使用专门为决定多个选项而设计的控制结构：`switch` 块。
- en: 18.4.4\. Deciding between options with switch
  id: totrans-387
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.4.4\. 使用 switch 判断选项
- en: 'You want to take different actions depending on which command was issued. You
    could use a series of `if-else` blocks. But a `switch` block is an alternative
    that some programmers feel is neater. `switch` lets you define a series of code
    blocks and execute certain blocks depending on the value of a variable or property.
    Here’s an example comparing the two approaches, using `command.type` as the `switch`
    variable:'
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 你希望根据发出的命令采取不同的操作。你可以使用一系列的 `if-else` 块。但 `switch` 块是程序员认为更整洁的替代方案。`switch`
    允许你定义一系列代码块，并根据变量或属性的值执行某些代码块。以下是一个使用 `command.type` 作为 `switch` 变量的示例，比较两种方法：
- en: '[PRE52]'
  id: totrans-389
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: If the value of `command.type` is `"get"`, then the code in the first `case`
    block is executed. If the value of `command.type` is `"go"`, then the code in
    the second `case` is executed. Without the `break` statement, the `switch` block
    would continue to execute all of the `case` blocks after the first one matched.
    You can include a `default` case with code to be executed if no other conditions
    are matched.
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 `command.type` 的值为 `"get"`，则执行第一个 `case` 块中的代码。如果 `command.type` 的值为 `"go"`，则执行第二个
    `case` 中的代码。如果没有 `break` 语句，`switch` 块将继续执行第一个匹配后的所有 `case` 块。你可以包含一个 `default`
    情况，其中包含在没有任何其他条件匹配时执行的代码。
- en: 'There’s not much difference between the two approaches; it’s a bit easier to
    read the condition in the `switch` block, but you have the extra `break` statements.
    Once again, it comes down to personal preference: if you think the `switch` block
    is neater, use it; just don’t forget the `break` statements.'
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: 两种方法之间没有太大的区别；在 `switch` 块中读取条件稍微容易一些，但你需要额外的 `break` 语句。再一次，这取决于个人喜好：如果你认为
    `switch` 块更整洁，就使用它；只是不要忘记 `break` 语句。
- en: '[Listing 18.9](#ch18ex09) shows the `switch` block for *The Crypt* in context,
    as part of a `doAction` function.'
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 18.9](#ch18ex09) 展示了在 `doAction` 函数上下文中 *The Crypt* 的 `switch` 块。'
- en: 18.4.5\. Making it so—listening for button clicks
  id: totrans-393
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.4.5\. 使其生效——监听按钮点击
- en: 'The final piece of the UI puzzle is to link the JavaScript to the HTML. You
    need the button to call the `doAction` function from [listing 18.9](#ch18ex09)
    whenever it’s clicked:'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: UI 问题的最后一部分是将 JavaScript 链接到 HTML。你需要按钮在点击时调用 `doAction` 函数，如 [列表 18.9](#ch18ex09)
    所示：
- en: '[PRE53]'
  id: totrans-395
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'The `doAction` function retrieves the text from the text box:'
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: '`doAction` 函数从文本框中检索文本：'
- en: '[PRE54]'
  id: totrans-397
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: The `doAction` function then parses the command string to create a command object.
    It uses a `switch` block to call the matching controller method. [Listing 18.9](#ch18ex09)
    shows how the pieces fit together for the command module. It uses the `parseCommand`
    function from [listing 18.8](#ch18ex08), which can be seen on JS Bin. Note that
    the JS Bin listing is for reference; the module won’t run in isolation on JS Bin
    but will throw an error.
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: '`doAction` 函数随后解析命令字符串以创建命令对象。它使用 `switch` 块来调用匹配的控制器方法。[列表 18.9](#ch18ex09)
    展示了命令模块的各个部分是如何组合在一起的。它使用了来自 [列表 18.8](#ch18ex08) 的 `parseCommand` 函数，该函数可以在 JS
    Bin 上看到。请注意，JS Bin 中的列表仅供参考；该模块不能在 JS Bin 中独立运行，将会抛出错误。'
- en: Listing 18.9\. The command module ([http://jsbin.com/qedubi/edit?js,console](http://jsbin.com/qedubi/edit?js,console))
  id: totrans-399
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 18.9\. 命令模块 ([http://jsbin.com/qedubi/edit?js,console](http://jsbin.com/qedubi/edit?js,console))
- en: '![](ch18ex09-0.jpg)'
  id: totrans-400
  prefs: []
  type: TYPE_IMG
  zh: '![](ch18ex09-0.jpg)'
- en: '![](ch18ex09-1.jpg)'
  id: totrans-401
  prefs: []
  type: TYPE_IMG
  zh: '![](ch18ex09-1.jpg)'
- en: You like to smooth the path for the players, so, after the `switch` block, you
    clear the user’s command from the text box by setting its `value` property to
    an empty string. And because you *really* care, you put the cursor in the text
    box, ready for their next command, by calling the text box’s `focus` method. Just
    before the `switch` block, you also use the message view’s `clear` method, added
    at the end of [chapter 17](kindle_split_027.html#ch17), to clean up any old messages.
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 你希望为玩家平滑路径，因此，在 `switch` 块之后，你通过将 `value` 属性设置为空字符串来清除用户从文本框中的命令。而且因为你非常关心，你通过调用文本框的
    `focus` 方法将光标放在文本框中，准备接收他们的下一个命令。在 `switch` 块之前，你也使用了消息视图的 `clear` 方法，该方法在 [第
    17 章](kindle_split_027.html#ch17) 的末尾添加，以清理任何旧消息。
- en: The code for the command module is wrapped inside an immediately invoked function
    expression. As soon as the script is loaded by the web page, it will be executed
    and the event listener will be added to the button element.
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 命令模块的代码被包裹在一个立即执行的函数表达式中。一旦网页加载脚本，它就会执行，并将事件监听器添加到按钮元素上。
- en: 18.4.6\. Enter The Crypt
  id: totrans-404
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.4.6\. 进入加密室
- en: Rather than changing the existing, working code of the Controller module, you
    created a new module, the Commands module, that parses a player’s commands and
    calls the controller’s public methods, `get`, `go`, and `use`. That’s neat! The
    controller is independent of the player interface; it’s the same one that worked
    in the console-based game and it will work with new interfaces—could you add a
    button to get items in a room?
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: 你没有修改现有的、正在工作的控制器模块代码，而是创建了一个新的模块，即命令模块，该模块解析玩家的命令并调用控制器的公共方法，`get`、`go` 和 `use`。这很棒！控制器与玩家界面独立；它与基于控制台的游戏中使用的相同，并且可以与新的界面一起工作——你能添加一个按钮来获取房间里的物品吗？
- en: '[Figure 18.8](#ch18fig08) shows a game of *The Crypt* in progress with a message
    being displayed to a player via the message view.'
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: '[图18.8](#ch18fig08) 展示了正在进行中的 *The Crypt* 游戏，玩家通过消息视图查看消息。'
- en: Figure 18.8\. *The Crypt* in progress showing a message to the player
  id: totrans-407
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图18.8。*The Crypt* 游戏进行中，显示给玩家的消息
- en: '![](18fig08_alt.jpg)'
  id: totrans-408
  prefs: []
  type: TYPE_IMG
  zh: '![](18fig08_alt.jpg)'
- en: '[Listing 18.7](#ch18ex07) included the HTML for the latest version of the game
    but you need to change the message view `script` element and add one for the new
    Commands module:'
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表18.7](#ch18ex07) 包含了游戏的最新版本的 HTML，但你需要更改消息视图的 `script` 元素并添加一个新的命令模块：'
- en: '[PRE55]'
  id: totrans-410
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: Play the game at [http://output.jsbin.com/depijo](http://output.jsbin.com/depijo),
    and see the HTML and JavaScript at [http://jsbin.com/depijo/edit?html,javascript](http://jsbin.com/depijo/edit?html,javascript).
    Be careful not to step in the zombie!
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [http://output.jsbin.com/depijo](http://output.jsbin.com/depijo) 上玩游戏，并查看
    [http://jsbin.com/depijo/edit?html,javascript](http://jsbin.com/depijo/edit?html,javascript)
    中的 HTML 和 JavaScript。小心不要踩到僵尸！
- en: 18.5\. Summary
  id: totrans-412
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 18.5。总结
- en: To use controls like buttons, drop-down lists, and text boxes, you need an HTML
    element for the control, an `id` attribute on the element, and a reference to
    the element in JavaScript. You can then access the `value` properties of text
    boxes or drop-down lists and specify a function to call when a button is clicked.
  id: totrans-413
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要使用按钮、下拉列表和文本框等控件，你需要一个用于控件的 HTML 元素、元素上的 `id` 属性以及在 JavaScript 中的元素引用。然后你可以访问文本框或下拉列表的
    `value` 属性，并指定在按钮被点击时调用的函数。
- en: 'Use a `button` element to display a button on the page. Include the text to
    be shown on the button between the opening and closing tags:'
  id: totrans-414
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `button` 元素在页面上显示按钮。在打开和关闭标签之间包含要显示在按钮上的文本：
- en: '[PRE56]'
  id: totrans-415
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'Include an `id` attribute in the opening tag so that the button can be accessed
    from JavaScript code:'
  id: totrans-416
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在打开标签中包含一个 `id` 属性，以便可以从 JavaScript 代码中访问按钮：
- en: '[PRE57]'
  id: totrans-417
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'Use the button’s `id` to get a reference to the button in JavaScript:'
  id: totrans-418
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用按钮的 `id` 在 JavaScript 中获取按钮的引用：
- en: '[PRE58]'
  id: totrans-419
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'Define a function that can be called when the button is clicked:'
  id: totrans-420
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义一个可以在按钮被点击时调用的函数：
- en: '[PRE59]'
  id: totrans-421
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'Add an event listener to the button to call a function when the button is clicked:'
  id: totrans-422
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为按钮添加事件监听器，以便在按钮被点击时调用函数：
- en: '[PRE60]'
  id: totrans-423
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Use an `input` element with its `type` attribute set to `text` to display a
    text box on the page. `input` elements don’t have closing tags:'
  id: totrans-424
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `input` 元素并设置其 `type` 属性为 `text` 在页面上显示文本框。`input` 元素没有关闭标签：
- en: '[PRE61]'
  id: totrans-425
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Get or set the text in a text box by using its `value` property:'
  id: totrans-426
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过使用文本框的 `value` 属性获取或设置文本框中的文本：
- en: '[PRE62]'
  id: totrans-427
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Use a `select` element with `option` elements to display a drop-down list:'
  id: totrans-428
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `select` 元素和 `option` 元素来显示下拉列表：
- en: '[PRE63]'
  id: totrans-429
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Execute code depending on the value of a variable or property by using a `switch`
    block:'
  id: totrans-430
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `switch` 块根据变量的值或属性执行代码：
- en: '[PRE64]'
  id: totrans-431
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'Chapter 19\. Templates: filling placeholders with data'
  id: totrans-432
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第19章。模板：用数据填充占位符
- en: '***This chapter covers***'
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: '***本章涵盖的内容***'
- en: Replacing one string with another
  id: totrans-434
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用一个字符串替换另一个字符串
- en: Repeating code with `while` loops
  id: totrans-435
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `while` 循环重复代码
- en: Using templates to separate HTML from JavaScript
  id: totrans-436
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用模板将 HTML 与 JavaScript 分离
- en: Embedding templates in web pages
  id: totrans-437
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在网页中嵌入模板
- en: Transforming one array into another with `map`
  id: totrans-438
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `map` 将一个数组转换为另一个数组
- en: You want your websites to be easy to navigate and a pleasure to use. Their designs
    should consider what content to include on each page, its accessibility and usability,
    the look and feel, and the overall user experience. Members of your team, building
    and maintaining a site, will have different strengths; even as a team of one,
    it makes sense to focus on different aspects of a site at different times.
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 你希望你的网站易于导航，使用起来愉快。它们的设计应考虑每个页面应包含哪些内容，其可访问性和可用性，外观和感觉，以及整体用户体验。你的团队成员，在构建和维护网站时，将拥有不同的优势；即使是一个人的团队，在不同的时间关注网站的不同方面也是有意义的。
- en: '*Get Programming with JavaScript* has favored a modular approach to developing
    applications, and you’ve seen that although there may be more pieces to manage,
    the management of each piece is simpler, more flexible, and more focused. But
    in moving from pure JavaScript in [part 2](kindle_split_019.html#part02) to JavaScript
    and HTML in [part 3](kindle_split_026.html#part03), there has been an unwelcome
    crossing of the streams. You now have views that mix data and JavaScript with
    HTML to produce their output (see [chapter 17](kindle_split_027.html#ch17)—or
    better yet, read on):'
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: '*用JavaScript编程入门*一直青睐模块化开发应用的方法，您已经看到，尽管可能需要管理更多的部分，但每个部分的管理更加简单、灵活和专注。但是，从[第2部分](kindle_split_019.html#part02)的纯JavaScript到[第3部分](kindle_split_026.html#part03)的JavaScript和HTML，出现了不受欢迎的流交叉。现在，您有视图将数据、JavaScript和HTML混合在一起以产生输出（参见[第17章](kindle_split_027.html#ch17)——或者更好的是，继续阅读）：'
- en: '[PRE65]'
  id: totrans-441
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: This chapter shows you how to untangle the HTML from the data and the JavaScript
    by using templates. The designers on your team can focus on their HTML and avoid
    the tricky JavaScript syntax. And, as ever with a modular approach, isolating
    the pieces improves flexibility, swapability, and maintainability. Don’t cross
    the streams!
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 本章向您展示如何通过使用模板将HTML从数据和JavaScript中分离出来。您的团队中的设计师可以专注于他们的HTML，避免复杂的JavaScript语法。而且，像模块化方法一样，隔离部分可以提高灵活性、可交换性和可维护性。不要交叉流！
- en: 19.1\. Building a news page—breaking news
  id: totrans-443
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.1\. 构建新闻页面——最新消息
- en: In [chapters 14](kindle_split_023.html#ch14), [15](kindle_split_024.html#ch15),
    and [16](kindle_split_025.html#ch16) you worked on a fitness app that let users
    log their sessions of exercise; you’re part of a team of developers working on
    the app for different devices and platforms. Well, the fitness app is gaining
    a lot of attention; early reports from testers are positive and there’s quite
    a buzz on social media. You decide to create a news page for the team, to keep
    developers, testers, and other interested parties up to date with the work you’re
    doing.
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第14章](kindle_split_023.html#ch14)、[第15章](kindle_split_024.html#ch15)和[第16章](kindle_split_025.html#ch16)中，您一直在开发一个健身应用，让用户记录他们的锻炼会话；您是开发团队的一员，负责为不同的设备和平台开发应用。嗯，健身应用受到了很多关注；测试者的早期报告是积极的，社交媒体上也有很多讨论。您决定为团队创建一个新闻页面，以便让开发者、测试人员和其他感兴趣的人了解您正在做的工作。
- en: '[Figure 19.1](#ch19fig01) shows the news page with two news items. All team
    members contribute to the news page, adding their items to a central content management
    system (CMS). Someone else manages the CMS and provides you with the news items
    as JavaScript data. Your job is to turn the data into HTML for the news page.'
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: '[图19.1](#ch19fig01)显示了包含两个新闻条目的新闻页面。所有团队成员都为新闻页面做出贡献，将他们的条目添加到中央内容管理系统（CMS）中。其他人管理CMS，并为您提供作为JavaScript数据的新闻条目。您的任务是把这些数据转换成新闻页面的HTML。'
- en: Figure 19.1\. Fitness App News with two news items
  id: totrans-446
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图19.1\. 健身应用新闻，包含两个新闻条目
- en: '![](19fig01_alt.jpg)'
  id: totrans-447
  prefs: []
  type: TYPE_IMG
  zh: '![](19fig01_alt.jpg)'
- en: 19.1.1\. Comparing the news item data and HTML
  id: totrans-448
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.1.1\. 比较新闻条目数据和HTML
- en: 'The team members are keen and update the news on the content management system
    regularly. The CMS provides you with data in this form:'
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: 团队成员都很积极，并定期在内容管理系统上更新新闻。CMS以这种形式为您提供数据：
- en: '[PRE66]'
  id: totrans-450
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'A designer on the team writes the HTML for a single news item:'
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
  zh: 团队中的设计师编写单个新闻条目的HTML：
- en: '[PRE67]'
  id: totrans-452
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: Each item is wrapped in a `div` element and is made up of a heading and three
    paragraphs. The heading includes a `span` element for the author of the post.
    (You use the `span` to style the author differently from the rest of the heading
    with CSS.) How do you construct the finished HTML news item from the data?
  id: totrans-453
  prefs: []
  type: TYPE_NORMAL
  zh: 每个条目都被包裹在一个`div`元素中，由一个标题和三个段落组成。标题包含一个用于帖子作者的`span`元素。（您使用`span`通过CSS将作者与其他标题部分区分开来。）您如何从数据中构建完成的HTML新闻条目？
- en: 19.1.2\. Constructing the HTML by string concatenation
  id: totrans-454
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.1.2\. 通过字符串连接构建HTML
- en: 'Up to this point, you’ve been constructing strings for display piece by piece
    by using string concatenation. For a news item you do something like this:'
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，您一直是通过字符串连接逐个构建用于显示的字符串。对于一个新闻条目，您可能这样做：
- en: '[PRE68]'
  id: totrans-456
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'A big drawback to this approach is the way it mixes up JavaScript and data
    with HTML. There are some fantastic designers on your team who know HTML inside
    out but who are not so confident with JavaScript. They’ll happily piece together
    the structure of a news item with HTML, but all the `var` and `+=` and dot notation
    are a mystery. And even if they were okay with JavaScript, updating the code isn’t
    exactly a walk in the park; I’m looking at you, quotation marks! There is a better
    way: let the HTML experts stick to what they know best.'
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法的缺点是它将JavaScript和数据与HTML混合在一起。你的团队中有一些出色的设计师，他们对HTML了如指掌，但对JavaScript却不太自信。他们会很高兴地用HTML拼凑新闻条目的结构，但所有的`var`、`+=`和点符号都是谜。即使他们能够接受JavaScript，更新代码也不是一件轻松的事情；我看着你，引号！有更好的方法：让HTML专家专注于他们最擅长的领域。
- en: 19.1.3\. Designing with HTML templates
  id: totrans-458
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.1.3\. 使用HTML模板进行设计
- en: You want the designers to come up with some elegant, well-structured HTML for
    a generic news item, and you’ll then fill it with the latest data. You want them
    to provide you with a *template* for a news item.
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 你希望设计师为通用新闻条目提供一些优雅、结构良好的HTML，然后你将用最新的数据填充它。你希望他们为你提供一个新闻条目的*模板*。
- en: '[PRE69]'
  id: totrans-460
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: That’s much neater than all that string concatenation, right? There’s no potential
    confusion with single and double quotation marks, and the different *fields* of
    the data (title, body, author, posted, social) are clearly identified as *placeholders*
    with double curly braces.
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: 这比所有那些字符串连接要整洁得多，对吧？没有单引号和双引号之间的潜在混淆，数据的不同*字段*（标题、正文、作者、发布、社交）被清楚地标识为带有双大括号的*占位符*。
- en: But if the template is included with the HTML, won’t it appear on the web page?
    Not if you wrap it in `script` tags.
  id: totrans-462
  prefs: []
  type: TYPE_NORMAL
  zh: 但如果模板与HTML一起包含，它不会出现在网页上吗？不会，如果你用`script`标签包裹它。
- en: 19.1.4\. Using script tags for templates
  id: totrans-463
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.1.4\. 使用脚本标签作为模板
- en: The HTML templates are kept with the rest of the HTML for a web page, placed
    within `script` tags. Use a nonstandard `type` attribute for the `script` element,
    and then when the browser is loading the page it won’t recognize the `type` and
    will ignore the template. The content of the `script` element won’t appear as
    part of the output—the visible web page—and won’t be run as JavaScript either.
  id: totrans-464
  prefs: []
  type: TYPE_NORMAL
  zh: HTML模板与网页的其余HTML内容一起保留，放置在`script`标签内。为`script`元素使用非标准`type`属性，然后当浏览器加载页面时，它不会识别`type`并忽略模板。`script`元素的内容不会作为输出的一部分出现——可见的网页——也不会作为JavaScript运行。
- en: '[PRE70]'
  id: totrans-465
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: If the `script` element has a `type` of `"text/javascript"` or if the `type`
    is missing, the browser will try to execute its contents as JavaScript code. But
    with a `type` of `"text/template"`, the browser simply passes over the contents.
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`script`元素具有`"text/javascript"`类型的`type`属性，或者`type`属性缺失，浏览器将尝试将其内容作为JavaScript代码执行。但如果是`"text/template"`类型的`type`，浏览器将简单地跳过其内容。
- en: Although the browser will ignore the template when rendering the page, you can
    still access it from JavaScript via its `id` attribute.
  id: totrans-467
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在渲染页面时浏览器会忽略模板，但你仍然可以通过其`id`属性从JavaScript中访问它。
- en: '[PRE71]'
  id: totrans-468
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: The first listing shows the contents of the `body` element for your news page.
    There’s a heading, a `div` for the news items, and your template wrapped in a
    `script` tag.
  id: totrans-469
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个列表显示了新闻页面的`body`元素内容。有一个标题，一个用于新闻条目的`div`，以及包裹在`script`标签中的模板。
- en: Listing 19.1\. Fitness App News (HTML) ([http://jsbin.com/viyuyo/edit?html,output](http://jsbin.com/viyuyo/edit?html,output))
  id: totrans-470
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表19.1\. 健身应用新闻（HTML）([http://jsbin.com/viyuyo/edit?html,output](http://jsbin.com/viyuyo/edit?html,output))
- en: '![](347fig01_alt.jpg)'
  id: totrans-471
  prefs: []
  type: TYPE_IMG
  zh: '![图片描述](347fig01_alt.jpg)'
- en: You only need to find a way to replace the placeholders with the actual data,
    and you’ll have news items ready for publication. You need to learn how to replace
    one string, a placeholder, with another, some data.
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: 你只需要找到一种方法用实际数据替换占位符，你就可以准备好待发布的新闻条目。你需要学习如何用一个字符串，一个占位符，替换成另一个字符串，一些数据。
- en: 19.2\. Replacing one string with another
  id: totrans-473
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.2\. 替换一个字符串为另一个字符串
- en: 'To switch one string for another, you use the `replace` string method, passing
    the string to find as the first argument and the string with which to replace
    it as the second. The method returns a new string. The following listing shows
    how to replace the string `"{{title}}"` with the string `"Fitness App v1.0 Live!"`.
    It produces the following output on the console:'
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: 要替换一个字符串为另一个字符串，你使用`replace`字符串方法，将需要查找的字符串作为第一个参数，将用于替换的字符串作为第二个参数。该方法返回一个新的字符串。以下列表显示了如何将字符串`"{{title}}"`替换为字符串`"Fitness
    App v1.0 Live!"`。它会在控制台产生以下输出：
- en: '[PRE72]'
  id: totrans-475
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: Listing 19.2\. Replacing one string with another ([http://jsbin.com/jeyohu/edit?js,console](http://jsbin.com/jeyohu/edit?js,console))
  id: totrans-476
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 19.2\. 用一个字符串替换另一个字符串 ([http://jsbin.com/jeyohu/edit?js,console](http://jsbin.com/jeyohu/edit?js,console))
- en: '![](347fig02_alt.jpg)'
  id: totrans-477
  prefs: []
  type: TYPE_IMG
  zh: '![图片](347fig02_alt.jpg)'
- en: The `replace` method searches the string to which it is attached, returning
    a new string.
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
  zh: '`replace` 方法搜索它附加到的字符串，返回一个新的字符串。'
- en: '[PRE73]'
  id: totrans-479
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: This snippet searches the string stored in the variable `before`.
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
  zh: 这个片段搜索存储在变量 `before` 中的字符串。
- en: 19.2.1\. Chaining calls to replace
  id: totrans-481
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.2.1\. 连续调用 `replace`
- en: 'The `replace` method acts on strings. It also returns a string. This means
    `replace` can be called on its own return value, allowing you to chain calls like
    this:'
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
  zh: '`replace` 方法作用于字符串。它也返回一个字符串。这意味着 `replace` 可以在其自己的返回值上调用，允许你进行如下链式调用：'
- en: '[PRE74]'
  id: totrans-483
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'If `template` is the string `"<h3>{{title}}<span> - by {{author}}</span></h3>"`,
    then the previous snippet works through the following steps. First, the `{{title}}`
    placeholder is replaced:'
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 `template` 是字符串 `"<h3>{{title}}<span> - by {{author}}</span></h3>"`，那么前面的代码片段通过以下步骤工作。首先，替换
    `{{title}}` 占位符：
- en: '[PRE75]'
  id: totrans-485
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'Then the `{{author}}` placeholder is replaced:'
  id: totrans-486
  prefs: []
  type: TYPE_NORMAL
  zh: 然后替换了 `{{author}}` 占位符：
- en: '[PRE76]'
  id: totrans-487
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: The final result is
  id: totrans-488
  prefs: []
  type: TYPE_NORMAL
  zh: 最终结果是
- en: '[PRE77]'
  id: totrans-489
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: '[Listing 19.3](#ch19ex03) shows an example of chaining two calls to `replace`.
    It produces the following output on the console:'
  id: totrans-490
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 19.3](#ch19ex03) 展示了连续调用 `replace` 的一个示例。它在控制台上产生了以下输出：'
- en: '[PRE78]'
  id: totrans-491
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: Listing 19.3\. Chaining calls to replace ([http://jsbin.com/rebugu/edit?js,console](http://jsbin.com/rebugu/edit?js,console))
  id: totrans-492
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 19.3\. 连续调用 `replace` ([http://jsbin.com/rebugu/edit?js,console](http://jsbin.com/rebugu/edit?js,console))
- en: '![](348fig01_alt.jpg)'
  id: totrans-493
  prefs: []
  type: TYPE_IMG
  zh: '![图片](348fig01_alt.jpg)'
- en: The calls to `replace` were written across multiple lines in [listing 19.3](#ch19ex03).
    This has no impact on the program but makes it easier for someone reading the
    code to pick out the separate calls. When methods can be chained with dot notation,
    like `replace`, they are said to have a *fluent interface*. Programmers often
    design whole suites of objects and methods to use fluent interfaces so they become
    easier to use, read, and understand.
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [列表 19.3](#ch19ex03) 中，`replace` 的调用被写在了多行中。这对程序没有影响，但使阅读代码的人更容易挑出单独的调用。当方法可以通过点符号链式调用，如
    `replace`，它们被称为具有 *流畅接口*。程序员经常设计一系列对象和方法以使用流畅接口，以便它们更容易使用、阅读和理解。
- en: 19.3\. While loops—replacing a string multiple times
  id: totrans-495
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.3\. 当循环——多次替换字符串
- en: Knowing how to use `replace` to swap one string for another, you write code
    to test it out for the news page. [Figure 19.2](#ch19fig02) shows what a news
    item template looks like before you replace its placeholders.
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
  zh: 了解如何使用 `replace` 来交换一个字符串为另一个字符串，你可以编写代码来测试它在新闻页面上的效果。[图 19.2](#ch19fig02) 展示了在替换占位符之前新闻条目模板的外观。
- en: Figure 19.2\. A news item with all of its placeholders showing
  id: totrans-497
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 19.2\. 显示所有占位符的新闻条目
- en: '![](19fig02_alt.jpg)'
  id: totrans-498
  prefs: []
  type: TYPE_IMG
  zh: '![图片](19fig02_alt.jpg)'
- en: 'The data for a news item is a JavaScript object with five properties: `title`,
    `body`, `author`, `posted`, and `social`:'
  id: totrans-499
  prefs: []
  type: TYPE_NORMAL
  zh: 新闻条目的数据是一个具有五个属性（`title`、`body`、`author`、`posted` 和 `social`）的 JavaScript 对象：
- en: '[PRE79]'
  id: totrans-500
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: You call `replace` for each of the properties and, at first, you think things
    have gone well. [Figure 19.3](#ch19fig03) shows the rendered news item.
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
  zh: 你为每个属性调用 `replace`，一开始你认为一切顺利。[图 19.3](#ch19fig03) 展示了渲染的新闻条目。
- en: Figure 19.3\. A news item—one of the `{{author}}` placeholders has not been
    replaced (bottom right).
  id: totrans-502
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 19.3\. 一个新闻条目——其中一个 `{{author}}` 占位符尚未被替换（右下角）。
- en: '![](19fig03_alt.jpg)'
  id: totrans-503
  prefs: []
  type: TYPE_IMG
  zh: '![图片](19fig03_alt.jpg)'
- en: Close, but no Pulitzer! One of the placeholders hasn’t been replaced. There’s
    still a stubborn `{{author}}` in the bottom right of the news item. The following
    listing shows the code you used. What went wrong?
  id: totrans-504
  prefs: []
  type: TYPE_NORMAL
  zh: 很接近，但不是普利策奖！其中一个占位符尚未被替换。新闻条目的右下角仍然有一个顽固的 `{{author}}`。下面的列表显示了您使用的代码。出了什么问题？
- en: Listing 19.4\. Calling replace once for each property ([http://jsbin.com/quroha/edit?js,html,output](http://jsbin.com/quroha/edit?js,html,output))
  id: totrans-505
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 19.4\. 为每个属性调用一次 `replace` ([http://jsbin.com/quroha/edit?js,html,output](http://jsbin.com/quroha/edit?js,html,output))
- en: '![](350fig01_alt.jpg)'
  id: totrans-506
  prefs: []
  type: TYPE_IMG
  zh: '![图片](350fig01_alt.jpg)'
- en: The problem is, the `replace` method replaces only the first occurrence of the
    string it’s trying to match. The news item template has two `{{author}}` placeholders
    and you replace only one of them. Have a go at fixing the problem yourself, by
    calling `replace` twice for the same placeholder.
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
  zh: 问题在于，`replace` 方法只替换它试图匹配的字符串的第一个出现。新闻条目模板有两个 `{{author}}` 占位符，而你只替换了其中一个。尝试自己解决这个问题，通过为同一个占位符调用
    `replace` 两次。
- en: The template and `replace` code are all a bit too *tightly coupled*. If the
    designer changes the template to include the `{{author}}` placeholder a third
    time (maybe for an email link or a short bio), you’ll have to dig back into the
    JavaScript and update the code to add another call to `replace`.
  id: totrans-508
  prefs: []
  type: TYPE_NORMAL
  zh: 模板和`replace`代码都过于**紧密耦合**。如果设计者将模板修改为第三次包含`{{author}}`占位符（可能是用于电子邮件链接或简短的个人简介），你将不得不再次深入JavaScript代码并更新代码以添加对`replace`的另一个调用。
- en: You want code that automatically keeps calling `replace` while there are placeholders
    to fill. How can you call `replace` the correct number of times?
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
  zh: 你想要代码能够自动调用`replace`，直到所有占位符都被填充。你如何正确地调用`replace`指定次数？
- en: 19.3.1\. Repeating code while a condition is met
  id: totrans-510
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.3.1. 当条件满足时重复代码
- en: All of the placeholders in your news item template need to be replaced with
    the corresponding data. For example, both instances of `{{author}}` should be
    filled with `Oskar`, as shown in the top right and bottom right of [figure 19.4](#ch19fig04).
  id: totrans-511
  prefs: []
  type: TYPE_NORMAL
  zh: 你新闻条目模板中的所有占位符都需要替换为相应的数据。例如，`{{author}}`的两个实例都应该填充为`Oskar`，如图19.4所示（右上角和右下角）。
- en: Figure 19.4\. Both author placeholders have been replaced with Oskar (top right
    and bottom right).
  id: totrans-512
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图19.4。两个作者占位符都已替换为Oskar（右上角和右下角）。
- en: '![](19fig04_alt.jpg)'
  id: totrans-513
  prefs: []
  type: TYPE_IMG
  zh: '![](19fig04_alt.jpg)'
- en: 'Your code should keep calling `replace` while it finds a placeholder for each
    property. In pseudocode (pretend code) it should look something like this:'
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
  zh: 你的代码应该在找到每个属性的占位符时持续调用`replace`。在伪代码（假设代码）中，它应该看起来像这样：
- en: '[PRE80]'
  id: totrans-515
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: 'The code block between the curly braces should keep being repeated while there’s
    a placeholder. Once no placeholder is found, the code block can be skipped. Here’s
    how to accomplish that goal in JavaScript:'
  id: totrans-516
  prefs: []
  type: TYPE_NORMAL
  zh: 大括号之间的代码块应该一直重复，直到找到占位符。一旦没有找到占位符，代码块可以被跳过。以下是在JavaScript中实现该目标的方法：
- en: '[PRE81]'
  id: totrans-517
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: You’ll dig into the details shortly, so don’t worry too much if you don’t follow
    everything yet. But you should be able to appreciate the gist of what the code
    is doing. Let’s look at how the `while` loop works in general.
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: 你很快就会深入了解细节，所以如果你现在还没有完全理解，不要过于担心。但你应该能够理解代码的基本功能。让我们看看`while`循环在一般情况下是如何工作的。
- en: 19.3.2\. The while loop
  id: totrans-519
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.3.2. `while`循环
- en: 'The `while` loop keeps calling `replace` while a placeholder is found in the
    `filled` string. When no placeholder is found, execution continues after the code
    block. In general, the `while` loop lets you repeatedly execute a block of code
    while a condition is `true`. The structure of a `while` loop looks like this:'
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: '`while`循环在`filled`字符串中找到占位符时持续调用`replace`。当没有找到占位符时，执行将继续到代码块之后。一般来说，`while`循环允许你在条件为`true`时重复执行代码块。`while`循环的结构如下所示：'
- en: '[PRE82]'
  id: totrans-521
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: The loop first evaluates the condition. If it evaluates to `true`, then the
    code block is executed, just like an `if` statement. Unlike an `if` statement,
    once the code block has been executed, the `while` loop evaluates the condition
    again. If the condition still evaluates to `true`, then the block is executed
    again. The loop keeps executing the code block while the condition is `true`.
    If the condition is `false`, then the code block is skipped and the program continues
    with the statements after the block.
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
  zh: 循环首先评估条件。如果评估结果为`true`，则执行代码块，就像一个`if`语句。与`if`语句不同，一旦代码块被执行，`while`循环将再次评估条件。如果条件仍然评估为`true`，则再次执行代码块。循环将一直执行代码块，直到条件为`true`。如果条件为`false`，则跳过代码块，程序继续执行块之后的语句。
- en: The next listing shows a `while` loop being used to display whole numbers from
    1 to 10.
  id: totrans-523
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表展示了如何使用`while`循环显示从1到10的整数。
- en: Listing 19.5\. Using a while loop to count ([http://jsbin.com/quroga/edit?js,console](http://jsbin.com/quroga/edit?js,console))
  id: totrans-524
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表19.5。使用`while`循环进行计数([http://jsbin.com/quroga/edit?js,console](http://jsbin.com/quroga/edit?js,console))
- en: '![](352fig01.jpg)'
  id: totrans-525
  prefs: []
  type: TYPE_IMG
  zh: '![](352fig01.jpg)'
- en: 'Once the `count` variable reaches 11, the condition will evaluate to `false`
    and the value of `count` won’t be logged to the console. The code block should
    always change the value of a variable used in the condition. Otherwise, if the
    condition’s value starts as `true`, it will never become `false` and the loop
    will become an *infinite loop*. In [listing 19.5](#ch19ex05), you use the increment
    operator, `++`, to add 1 to the value of `count`. Three different ways of adding
    1 to the value of a `count` variable are shown here:'
  id: totrans-526
  prefs: []
  type: TYPE_NORMAL
  zh: 当 `count` 变量达到 11 时，条件将评估为 `false`，`count` 的值将不会记录到控制台。代码块应该始终更改在条件中使用的变量的值。否则，如果条件的值最初为
    `true`，它将永远不会变为 `false`，循环将变成一个 *无限循环*。在 [列表 19.5](#ch19ex05) 中，你使用增量运算符 `++`
    将 1 添加到 `count` 的值。这里展示了三种将 1 添加到 `count` 变量值的不同方法：
- en: '[PRE83]'
  id: totrans-527
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: 19.3.3\. Replacing a string while it can be found
  id: totrans-528
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.3.3\. 在找到字符串时替换字符串
- en: 'You can use a `while` loop to replace multiple occurrences of a placeholder.
    First, check if the placeholder you want to replace is present with the `indexOf`
    method. `indexOf` returns `-1` if a string can’t be found. If the placeholder
    is found, then `indexOf` won’t return `-1`. Use that fact in the condition of
    a `while` loop:'
  id: totrans-529
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 `while` 循环来替换多个占位符的实例。首先，使用 `indexOf` 方法检查你想要替换的占位符是否存在。如果字符串找不到，`indexOf`
    返回 `-1`。如果占位符被找到，则 `indexOf` 不会返回 `-1`。在 `while` 循环的条件中使用这个事实：
- en: '[PRE84]'
  id: totrans-530
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: '[Listing 19.6](#ch19ex06) uses a `while` loop to keep replacing a string until
    it’s no longer found. It produces the following output on the console:'
  id: totrans-531
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 19.6](#ch19ex06) 使用 `while` 循环不断替换字符串，直到它不再被找到。它在控制台上产生以下输出：'
- en: '[PRE85]'
  id: totrans-532
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: Listing 19.6\. Using a while loop with replace ([http://jsbin.com/cabaju/edit?js,console](http://jsbin.com/cabaju/edit?js,console))
  id: totrans-533
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 19.6\. 使用 `while` 循环进行替换 ([http://jsbin.com/cabaju/edit?js,console](http://jsbin.com/cabaju/edit?js,console))
- en: '![](352fig02_alt.jpg)'
  id: totrans-534
  prefs: []
  type: TYPE_IMG
  zh: '![](352fig02_alt.jpg)'
- en: The code first logs that it’s starting the replacement process. The `while`
    loop then executes its code block twice, replacing one instance of `{{author}}`
    and then the other. With no more instances of `{{author}}` to find, `filled.indexOf("{{author}}")`
    returns `-1` and the `while` loop ends. Execution continues after the loop, and
    the code concludes by logging that the replacement process has finished.
  id: totrans-535
  prefs: []
  type: TYPE_NORMAL
  zh: 代码首先记录开始替换过程。然后，`while` 循环执行其代码块两次，先替换一个 `{{author}}` 实例，然后替换另一个。由于没有更多的 `{{author}}`
    实例要查找，`filled.indexOf("{{author}}")` 返回 `-1`，`while` 循环结束。循环之后继续执行，代码通过记录替换过程已完成来结束。
- en: 19.3.4\. Replacing strings with regular expressions
  id: totrans-536
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.3.4\. 使用正则表达式替换字符串
- en: There’s an alternative way of replacing strings. It uses *regular expressions*,
    a powerful but often complicated way of specifying patterns of characters you
    want to match and replace. Regular expressions are a little beyond the scope of
    the book, but you can investigate a number of examples on the *Get Programming
    with JavaScript* website at [www.room51.co.uk/js/regexp.html](http://www.room51.co.uk/js/regexp.html).
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
  zh: 有一种替换字符串的替代方法。它使用 *正则表达式*，这是一种指定你想要匹配和替换的字符模式的强大但通常复杂的方法。正则表达式略超出了本书的范围，但你可以在
    [www.room51.co.uk/js/regexp.html](http://www.room51.co.uk/js/regexp.html) 的 *Get
    Programming with JavaScript* 网站上调查许多示例。
- en: 19.4\. Automating placeholder replacement for templates
  id: totrans-538
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.4\. 自动化模板占位符替换
- en: The fitness app uses data for user exercise sessions, and its news page uses
    data for news items. The quiz app uses data for sets of questions and answers,
    and *The Crypt* uses data for its maps. It would be great to use HTML templates
    to display all kinds of data you might find in your projects. But you don’t want
    to have to reinvent the `while` every time you need to fill placeholders with
    data. So, what’s the key to automating template use?
  id: totrans-539
  prefs: []
  type: TYPE_NORMAL
  zh: 健身应用使用用户锻炼会话的数据，其新闻页面使用新闻条目的数据。测验应用使用问题和答案的集合数据，*The Crypt* 使用其地图的数据。使用 HTML
    模板来显示你可能在项目中找到的所有类型的数据将非常棒。但你不希望每次需要用数据填充占位符时都要重新发明 `while`。那么，自动化模板使用的关键是什么？
- en: 19.4.1\. Matching template placeholders with object properties
  id: totrans-540
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.4.1\. 匹配模板占位符与对象属性
- en: '[Figure 19.5](#ch19fig05) shows a news item from the fitness app news page
    again. The placeholders have yet to be filled with data.'
  id: totrans-541
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 19.5](#ch19fig05) 再次显示了健身应用新闻页面上的一个新闻条目。占位符尚未用数据填充。'
- en: Figure 19.5\. A news item with placeholders unfilled
  id: totrans-542
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 19.5\. 一个未填充占位符的新闻条目
- en: '![](19fig05_alt.jpg)'
  id: totrans-543
  prefs: []
  type: TYPE_IMG
  zh: '![](19fig05_alt.jpg)'
- en: 'The data that will fill the placeholders looks like this:'
  id: totrans-544
  prefs: []
  type: TYPE_NORMAL
  zh: 将填充占位符的数据看起来是这样的：
- en: '[PRE86]'
  id: totrans-545
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: The property names of the news item data object, its *keys*, match the names
    of the placeholders in the template. For each key, you want to keep replacing
    its matching placeholders while they can be found.
  id: totrans-546
  prefs: []
  type: TYPE_NORMAL
  zh: 新闻项目数据对象的属性名，即其 *键*，与模板中占位符的名称相匹配。对于每个键，你希望继续替换其匹配的占位符，直到它们可以被找到。
- en: '**1**.  Start with `title` and keep replacing `{{title}}` with `Fitness App
    v1.0 Live!` until there are no more `{{title}}` placeholders to replace.'
  id: totrans-547
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**. 从 `title` 开始，并继续用 `Fitness App v1.0 Live!` 替换 `{{title}}`，直到没有更多的 `{{title}}`
    占位符需要替换。'
- en: '**2**.  Move on to `body` and keep replacing `{{body}}` with `Yes, version
    1 is here...` until there are no more `{{body}}` placeholders to replace.'
  id: totrans-548
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**. 继续到 `body`，并继续用 `Yes, version 1 is here...` 替换 `{{body}}`，直到没有更多的 `{{body}}`
    占位符需要替换。'
- en: '**3**.  Repeat the process for each key until all of the keys have had all
    of their placeholders replaced.'
  id: totrans-549
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**. 对每个键重复此过程，直到所有键的所有占位符都已替换。'
- en: You can get an array of all of the news item’s property names by using the `Object
    .keys` method.
  id: totrans-550
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过使用 `Object .keys` 方法来获取所有新闻项目属性名的数组。
- en: '[PRE87]'
  id: totrans-551
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: For the news item, `keys = ["title", "body", "posted", "author", "social"]`.
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
  zh: 对于新闻条目，`keys = ["title", "body", "posted", "author", "social"]`。
- en: 'Armed with the keys, you can easily create the placeholders and replace them
    with values in the template. Remember, you can use square bracket notation to
    retrieve the value for a key:'
  id: totrans-553
  prefs: []
  type: TYPE_NORMAL
  zh: 带着键，你可以轻松地在模板中创建占位符并用值替换它们。记住，你可以使用方括号表示法来检索键的值：
- en: '[PRE88]'
  id: totrans-554
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: 'And if you have a property’s key, you can also build the placeholder you need
    to match in the template:'
  id: totrans-555
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有一个属性的键，你还可以构建模板中需要匹配的占位符：
- en: '[PRE89]'
  id: totrans-556
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: The *key* for a property is well named; you use it to unlock the value of the
    property and its placeholder ([table 19.1](#ch19table01)).
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
  zh: 属性的 *键* 命名得很好；你使用它来解锁属性的值及其占位符([表 19.1](#ch19table01))。
- en: Table 19.1\. A property’s keys are used to access its value and build its placeholder
  id: totrans-558
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表 19.1\. 属性的键用于访问其值并构建其占位符
- en: '| Key | Value | Placeholder |'
  id: totrans-559
  prefs: []
  type: TYPE_TB
  zh: '| 键 | 值 | 占位符 |'
- en: '| --- | --- | --- |'
  id: totrans-560
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| title | data["**title**"] | {{**title**}} |'
  id: totrans-561
  prefs: []
  type: TYPE_TB
  zh: '| title | data["**title**"] | {{**title**}} |'
- en: '| body | data["**body**"] | {{**body**}} |'
  id: totrans-562
  prefs: []
  type: TYPE_TB
  zh: '| body | data["**body**"] | {{**body**}} |'
- en: '| posted | data["**posted**"] | {{**posted**}} |'
  id: totrans-563
  prefs: []
  type: TYPE_TB
  zh: '| posted | data["**posted**"] | {{**posted**}} |'
- en: 19.4.2\. Filling all of the placeholders for each key
  id: totrans-564
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.4.2\. 为每个键填充所有占位符
- en: It’s time to bring all of the parts together and write some code that will not
    only fill templates with data for the fitness app news page but will also work
    with any data and matching templates. [Listing 19.7](#ch19ex07) shows a `fill`
    function that uses the ideas from the previous section, iterating over the keys
    of a data object and replacing the placeholders with values.
  id: totrans-565
  prefs: []
  type: TYPE_NORMAL
  zh: 是时候将所有部分组合起来，编写一些代码，这些代码不仅将为健身应用新闻页面填充数据，而且还将与任何数据和匹配的模板一起工作。[列表 19.7](#ch19ex07)
    展示了一个 `fill` 函数，它使用了上一节中的想法，遍历数据对象的键，并用值替换占位符。
- en: Listing 19.7\. A function to fill templates with data ([http://jsbin.com/bazika/edit?js,output](http://jsbin.com/bazika/edit?js,output))
  id: totrans-566
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 19.7\. 填充模板数据的函数([http://jsbin.com/bazika/edit?js,output](http://jsbin.com/bazika/edit?js,output))
- en: '![](ch19ex07-0.jpg)'
  id: totrans-567
  prefs: []
  type: TYPE_IMG
  zh: '![](ch19ex07-0.jpg)'
- en: '![](ch19ex07-1.jpg)'
  id: totrans-568
  prefs: []
  type: TYPE_IMG
  zh: '![](ch19ex07-1.jpg)'
- en: '[Listing 19.7](#ch19ex07) also includes code to test the `fill` function. On
    the last line, it sets the contents of a `div` element with the HTML returned
    by the function.'
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 19.7](#ch19ex07) 还包括测试 `fill` 函数的代码。在最后一行，它设置了由函数返回的 HTML 的 `div` 元素内容。'
- en: 19.4.3\. Building a list of items using a template
  id: totrans-570
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.4.3\. 使用模板构建项目列表
- en: You’re already smiling. Yes, the fitness app news page features a list of news
    items. And yes, your template `fill` function works with only a single news item.
    But you know the power of `forEach` for working with lists. Writing a `fillList`
    function is a snap, as shown here.
  id: totrans-571
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经笑了。是的，健身应用新闻页面有一个新闻条目列表。是的，你的模板 `fill` 函数只使用一个新闻条目就能工作。但你知道 `forEach` 在处理列表时的强大功能。编写一个
    `fillList` 函数非常简单，如下所示。
- en: Listing 19.8\. Building a list using a template ([http://jsbin.com/hilecu/edit?js,output](http://jsbin.com/hilecu/edit?js,output))
  id: totrans-572
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 19.8\. 使用模板构建列表([http://jsbin.com/hilecu/edit?js,output](http://jsbin.com/hilecu/edit?js,output))
- en: '![](ch19ex08-0.jpg)'
  id: totrans-573
  prefs: []
  type: TYPE_IMG
  zh: '![](ch19ex08-0.jpg)'
- en: '![](ch19ex08-1.jpg)'
  id: totrans-574
  prefs: []
  type: TYPE_IMG
  zh: '![](ch19ex08-1.jpg)'
- en: In the `fillList` function in [listing 19.8](#ch19ex08), you use the `forEach`
    method to iterate over the array of data objects, `dataArray`, passing each one
    to the `fill` function and appending the filled templates it returns to `listString`.
  id: totrans-575
  prefs: []
  type: TYPE_NORMAL
  zh: 在[列表19.8](#ch19ex08)中的`fillList`函数中，你使用`forEach`方法遍历数据对象数组`dataArray`，将每个对象传递给`fill`函数，并将返回的填充模板追加到`listString`中。
- en: Now that you have the two template functions you need, you’re keen to get the
    scoop on the finished fitness app news page.
  id: totrans-576
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你有了所需的两个模板函数，你渴望了解完成后的健身应用新闻页面。
- en: 19.5\. Building a news page—news just in
  id: totrans-577
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.5. 建立新闻页面——新闻即时更新
- en: It’s time to get modular. You know how the fitness app team rolls; they love
    to share code but they hate pollution. They want to see a finished news page with
    separate data and template modules. [Figure 19.6](#ch19fig06) shows the setup.
  id: totrans-578
  prefs: []
  type: TYPE_NORMAL
  zh: 是时候模块化了。你知道健身应用团队是如何运作的；他们喜欢分享代码，但讨厌污染。他们希望看到一个具有独立数据模板模块的新闻页面。![图19.6](#ch19fig06)显示了设置。
- en: Figure 19.6\. The page includes the news item template and JavaScript code and
    imports two modules.
  id: totrans-579
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图19.6。页面包括新闻条目模板和JavaScript代码，并导入两个模块。
- en: '![](19fig06.jpg)'
  id: totrans-580
  prefs: []
  type: TYPE_IMG
  zh: '![图片](19fig06.jpg)'
- en: The news page on JS Bin includes the news item template inside a `script` element
    and code in the JavaScript panel that uses the modules and template to display
    the news items. The finished web page with two news items displayed was shown
    in [figure 19.1](#ch19fig01).
  id: totrans-581
  prefs: []
  type: TYPE_NORMAL
  zh: JS Bin上的新闻页面将新闻条目模板放在一个`script`元素中，并在JavaScript面板中使用模块和模板来显示新闻条目。显示两个新闻条目的完成网页在[图19.1](#ch19fig01)中显示。
- en: To finish your work on the news page, first create the modules and then import
    them into the web page. Read all about it in the next two sections.
  id: totrans-582
  prefs: []
  type: TYPE_NORMAL
  zh: 要完成新闻页面的工作，首先创建模块，然后将它们导入到网页中。在接下来的两个部分中详细了解。
- en: 19.5.1\. Creating the templates and data modules
  id: totrans-583
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.5.1. 创建模板和数据模块
- en: Put the template functions into one module and the news data into another. Use
    namespaces to avoid creating too many local variables.
  id: totrans-584
  prefs: []
  type: TYPE_NORMAL
  zh: 将模板函数放入一个模块中，将新闻数据放入另一个模块中。使用命名空间以避免创建过多的局部变量。
- en: Templating functions
  id: totrans-585
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 模板函数
- en: The next listing shows how the two templating functions from [listings 19.7](#ch19ex07)
    and [19.8](#ch19ex08) are packaged into a templates module.
  id: totrans-586
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了如何将[列表19.7](#ch19ex07)和[19.8](#ch19ex08)中的两个模板函数打包到一个模板模块中。
- en: Listing 19.9\. The templates module ([http://jsbin.com/pugase/edit?js,console](http://jsbin.com/pugase/edit?js,console))
  id: totrans-587
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表19.9。模板模块（[http://jsbin.com/pugase/edit?js,console](http://jsbin.com/pugase/edit?js,console)）
- en: '![](357fig01_alt.jpg)'
  id: totrans-588
  prefs: []
  type: TYPE_IMG
  zh: '![图片](357fig01_alt.jpg)'
- en: 'You use a new namespace, `gpwj` (from *Get Programming with JavaScript*); the
    templates module will be useful in so many projects that it’s worth having it
    as part of a general utilities namespace rather than in with the fitness app or
    *The Crypt* or wherever else it will be used. To call the functions, include the
    namespace:'
  id: totrans-589
  prefs: []
  type: TYPE_NORMAL
  zh: 你使用了一个新的命名空间，`gpwj`（来自《用JavaScript编程》）；模板模块在许多项目中都会很有用，因此将其作为通用工具命名空间的一部分而不是与健身应用或《密码学》或其他任何使用的地方一起使用是值得的。要调用函数，请包含命名空间：
- en: '[PRE90]'
  id: totrans-590
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: News data
  id: totrans-591
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 新闻数据
- en: For the real-world news page, the data will come from a central content management
    system. You mimic the CMS news feed by creating a module that supplies dummy data.
    You can swap the module for one with a live CMS connection further down the line.
  id: totrans-592
  prefs: []
  type: TYPE_NORMAL
  zh: 对于现实世界的新闻页面，数据将来自中央内容管理系统。你通过创建一个提供模拟数据的模块来模拟CMS新闻源。你可以在稍后替换模块，以使用具有实时CMS连接的模块。
- en: The next listing includes the data and a function for getting it assigned to
    the `fitnessApp.news` namespace.
  id: totrans-593
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表包括数据和获取其分配到`fitnessApp.news`命名空间的功能。
- en: Listing 19.10\. A news page data module ([http://jsbin.com/fupiki/edit?js,console](http://jsbin.com/fupiki/edit?js,console))
  id: totrans-594
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表19.10。新闻页面数据模块（[http://jsbin.com/fupiki/edit?js,console](http://jsbin.com/fupiki/edit?js,console)）
- en: '![](358fig01_alt.jpg)'
  id: totrans-595
  prefs: []
  type: TYPE_IMG
  zh: '![图片](358fig01_alt.jpg)'
- en: 'To get news items, call `getItems`, specifying the number of items you want.
    For example, to get three news items you’d use the following code:'
  id: totrans-596
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取新闻条目，调用`getItems`，指定你想要的条目数量。例如，要获取三个新闻条目，你会使用以下代码：
- en: '[PRE91]'
  id: totrans-597
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: The real news data module that retrieves items from the CMS will use the same
    interface as [listing 19.10](#ch19ex10). In other words, its news will also be
    accessed by calling its `getItems` method. By using the same interface, you can
    easily swap modules from your static version to the dynamic CMS version.
  id: totrans-598
  prefs: []
  type: TYPE_NORMAL
  zh: 实际的新闻数据模块将从CMS检索项目，它将使用与[列表19.10](#ch19ex10)相同的接口。换句话说，其新闻也将通过调用其`getItems`方法来访问。通过使用相同的接口，你可以轻松地将模块从静态版本交换到动态CMS版本。
- en: 19.5.2\. Importing the modules
  id: totrans-599
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.5.2\. 导入模块
- en: To provide your readers with the latest headlines on developments from the fitness
    app team, you create the simple news page HTML shown here.
  id: totrans-600
  prefs: []
  type: TYPE_NORMAL
  zh: 为了向读者提供健身应用团队发展的最新头条新闻，你创建了这里所示的简单新闻页面HTML。
- en: Listing 19.11\. A modular news page (HTML) ([http://jsbin.com/vemufa/edit?html,output](http://jsbin.com/vemufa/edit?html,output))
  id: totrans-601
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表19.11\. 一个模块化新闻页面（HTML）([http://jsbin.com/vemufa/edit?html,output](http://jsbin.com/vemufa/edit?html,output))
- en: '![](359fig01_alt.jpg)'
  id: totrans-602
  prefs: []
  type: TYPE_IMG
  zh: '![图片](359fig01_alt.jpg)'
- en: To bring all of the pieces together, you add JavaScript that retrieves the template
    from the page, fills it with the news item data, and updates the news `div` with
    the generated HTML, as in the next listing.
  id: totrans-603
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将所有这些部分组合在一起，你添加了JavaScript代码，从页面中检索模板，用新闻条目数据填充它，并使用生成的HTML更新新闻 `div`，如下面的列表所示。
- en: Listing 19.12\. A modular news page ([http://jsbin.com/vemufa/edit?js,output](http://jsbin.com/vemufa/edit?js,output))
  id: totrans-604
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表19.12\. 一个模块化新闻页面([http://jsbin.com/vemufa/edit?js,output](http://jsbin.com/vemufa/edit?js,output))
- en: '![](359fig02_alt.jpg)'
  id: totrans-605
  prefs: []
  type: TYPE_IMG
  zh: '![图片](359fig02_alt.jpg)'
- en: Using templates is a common way to generate HTML from an application’s data.
    There are many JavaScript templating libraries freely available for general use;
    Handlebars, Moustache, and Pug are three popular examples.
  id: totrans-606
  prefs: []
  type: TYPE_NORMAL
  zh: 使用模板是从应用程序数据生成HTML的常见方式。有许多JavaScript模板库可供免费使用；Handlebars、Moustache和Pug是三个流行的例子。
- en: Stop the press! Your team members love the neat, modular, reusable approach
    you’ve taken and vow to add new news items every day. Some of them have already
    started incorporating the `gpwj.templates` functions into their own applications.
    You decide to do the same, as you return to *The Crypt*.
  id: totrans-607
  prefs: []
  type: TYPE_NORMAL
  zh: 停止 presses！你的团队成员非常喜欢你所采用的整洁、模块化、可重用的方法，并誓言每天都会添加新的新闻条目。其中一些人已经开始将 `gpwj.templates`
    函数整合到他们自己的应用程序中。你决定也这样做，当你回到 *The Crypt* 时。
- en: 19.6\. The Crypt—improving the views
  id: totrans-608
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.6\. The Crypt—改进视图
- en: In [chapter 17](kindle_split_027.html#ch17) you created some web-based views
    for players and places. The information they displayed, originally intended for
    the console, was formatted with spaces, line breaks, and boxes and borders from
    the `spacer` namespace, rather than HTML. Now that you’ve seen how templates can
    be used to separate markup and JavaScript, it’s time to improve the views so that
    appropriate HTML tags are used to wrap data in *The Crypt*.
  id: totrans-609
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [第17章](kindle_split_027.html#ch17) 中，你为玩家和地点创建了一些基于Web的视图。它们显示的信息，原本是为控制台设计的，使用了空格、换行和来自
    `spacer` 命名空间的框和边框进行格式化，而不是HTML。现在你已经看到了如何使用模板来分离标记和JavaScript，是时候改进视图，以便在 *The
    Crypt* 中使用适当的HTML标签来包装数据了。
- en: '[Figure 19.7](#ch19fig07) shows what *The Crypt* will look like after the changes.
    Switching to HTML from plain text makes it possible to style the output with CSS,
    leading to much greater potential for visually interesting designs. [Figure 19.8](#ch19fig08)
    shows the modules for the project with new and updated modules highlighted.'
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
  zh: '[图19.7](#ch19fig07) 展示了经过修改后 *The Crypt* 的样子。从纯文本切换到HTML使得使用CSS来样式化输出成为可能，从而为视觉上有趣的设计提供了更大的潜力。[图19.8](#ch19fig08)
    展示了项目中的模块，其中新模块和更新模块被突出显示。'
- en: Figure 19.7\. The latest version of *The Crypt* uses HTML templates to build
    page elements.
  id: totrans-611
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图19.7\. *The Crypt* 的最新版本使用HTML模板来构建页面元素。
- en: '![](19fig07_alt.jpg)'
  id: totrans-612
  prefs: []
  type: TYPE_IMG
  zh: '![图片](19fig07_alt.jpg)'
- en: Figure 19.8\. Modules in *The Crypt* with new or updated modules highlighted
  id: totrans-613
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图19.8\. *The Crypt* 中的模块，新模块或更新模块被突出显示
- en: '![](19fig08_alt.jpg)'
  id: totrans-614
  prefs: []
  type: TYPE_IMG
  zh: '![图片](19fig08_alt.jpg)'
- en: You created the Templates module earlier in the chapter. Now you create templates
    and update the views to use them.
  id: totrans-615
  prefs: []
  type: TYPE_NORMAL
  zh: 你在本章的早期部分创建了模板模块。现在你创建模板并更新视图以使用它们。
- en: 19.6.1\. Creating HTML templates for all of the views
  id: totrans-616
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.6.1\. 为所有视图创建HTML模板
- en: The following listing shows all of the templates for *The Crypt* embedded within
    HTML `script` tags. They’re part of a full web page on JS Bin.
  id: totrans-617
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的列表展示了嵌入在HTML `script` 标签内的所有 *The Crypt* 模板。它们是JS Bin上的一个完整网页的一部分。
- en: Listing 19.13\. The Crypt with Templates (HTML) ([http://jsbin.com/yapiyic/edit?html,output](http://jsbin.com/yapiyic/edit?html,output))
  id: totrans-618
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表19.13\. 带有模板的 *The Crypt* ([http://jsbin.com/yapiyic/edit?html,output](http://jsbin.com/yapiyic/edit?html,output))
- en: '![](361fig01_alt.jpg)'
  id: totrans-619
  prefs: []
  type: TYPE_IMG
  zh: '![图片](361fig01_alt.jpg)'
- en: There’s no JavaScript mixed with the templates. A web designer used to working
    in HTML could use their knowledge to update the templates without having to unpick
    the HTML from any other code. Clearly, this separation of concerns makes the templates
    neater, easier to read, and easier to use for anyone involved in building the
    application.
  id: totrans-620
  prefs: []
  type: TYPE_NORMAL
  zh: 模板中没有混合JavaScript。一个习惯于使用HTML工作的网页设计师可以使用他们的知识来更新模板，而无需从任何其他代码中拆分HTML。显然，这种关注点的分离使模板更整洁、更易于阅读，也更容易为任何参与构建应用程序的人使用。
- en: 19.6.2\. Updating the views to use the new templates
  id: totrans-621
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.6.2\. 更新视图以使用新的模板
- en: 'With the template strings for *The Crypt* now embedded as HTML on the page,
    you need to update the view modules to grab the template strings and fill them
    with a message or with data from the player and place models. [Listings 19.14](#ch19ex14),
    [19.15](#ch19ex15), and [19.16](#ch19ex16) show the new view code. *Note: The
    views are designed to be used by the controller and won’t work in isolation*.
    The links to JS Bin are included so you can copy, clone, or change the code if
    you choose.'
  id: totrans-622
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，将*The Crypt*的模板字符串嵌入到页面上的HTML中，您需要更新视图模块以获取模板字符串，并用消息或玩家和地点模型的数据填充它们。[列表19.14](#ch19ex14)，[19.15](#ch19ex15)，和[19.16](#ch19ex16)显示了新的视图代码。*注意：视图是为控制器设计的，单独使用时不会工作*。包含到JS
    Bin的链接，以便您可以复制、克隆或更改代码（如果需要的话）。
- en: Messages
  id: totrans-623
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 消息
- en: The simplest view is the message view. Here’s the updated code.
  id: totrans-624
  prefs: []
  type: TYPE_NORMAL
  zh: 最简单的视图是消息视图。以下是更新的代码。
- en: Listing 19.14\. A message view using templates ([http://jsbin.com/jojeyo/edit?js,console](http://jsbin.com/jojeyo/edit?js,console))
  id: totrans-625
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表19.14\. 使用模板的消息视图（[http://jsbin.com/jojeyo/edit?js,console](http://jsbin.com/jojeyo/edit?js,console)）
- en: '![](362fig01_alt.jpg)'
  id: totrans-626
  prefs: []
  type: TYPE_IMG
  zh: '![](362fig01_alt.jpg)'
- en: 'The messages passed to the `render` method for the message view are just strings.
    The `template.fill` method expects objects (it uses object keys to create placeholders
    and find values), so `render` creates an object, `data`, from the message to use
    as the argument. A message of `"hello"` becomes `{ message : "hello" }`. The `fill`
    method will then replace the `{{message}}` placeholder with the value `"hello"`.'
  id: totrans-627
  prefs: []
  type: TYPE_NORMAL
  zh: '传递给消息视图的`render`方法的只是字符串。`template.fill`方法期望对象（它使用对象键来创建占位符并查找值），所以`render`从消息创建一个对象`data`，用作参数。消息`"hello"`变为`{
    message: "hello" }`。然后`fill`方法将`{{message}}`占位符替换为值`"hello"`。'
- en: Players
  id: totrans-628
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 玩家
- en: The player view is slightly more complicated than the message view because players
    have items. As well as having a template string to display the player’s name and
    health, the player view needs another for the items.
  id: totrans-629
  prefs: []
  type: TYPE_NORMAL
  zh: 玩家视图比消息视图稍微复杂一些，因为玩家有物品。除了有一个模板字符串来显示玩家的姓名和健康状态外，玩家视图还需要另一个用于物品的模板。
- en: The next listing shows the new player view. The code relating to items is shown
    in bold.
  id: totrans-630
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了新的玩家视图。与物品相关的代码以粗体显示。
- en: Listing 19.15\. A player view using templates ([http://jsbin.com/suyona/edit?js,console](http://jsbin.com/suyona/edit?js,console))
  id: totrans-631
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表19.15\. 使用模板的玩家视图（[http://jsbin.com/suyona/edit?js,console](http://jsbin.com/suyona/edit?js,console)）
- en: '![](ch19ex15-0.jpg)'
  id: totrans-632
  prefs: []
  type: TYPE_IMG
  zh: '![](ch19ex15-0.jpg)'
- en: '![](ch19ex15-1.jpg)'
  id: totrans-633
  prefs: []
  type: TYPE_IMG
  zh: '![](ch19ex15-1.jpg)'
- en: The player’s items data is an array of strings. Because `fillList` expects an
    array of objects, you use `map` to transform the array from strings to objects.
    You pass a function to the `map` method and `map` builds a new array, with each
    new element created by the function. The array `["a` `lamp",` `"a` `key"]` becomes
    `[{` `item` `:` `"a` `lamp"` `},` `{` `item` `:` `"a` `key"` `}]`.
  id: totrans-634
  prefs: []
  type: TYPE_NORMAL
  zh: '玩家的物品数据是一个字符串数组。因为`fillList`期望一个对象数组，所以您使用`map`将数组从字符串转换为对象。您将一个函数传递给`map`方法，然后`map`构建一个新的数组，其中每个新元素都是由该函数创建的。数组`["a
    lamp", "a key"]`变为`[{ item: "a lamp" }, { item: "a key" }]`。'
- en: The items HTML generated by `fillList` can’t be added to the page until the
    player HTML has been added because the player HTML includes the `ol` element that
    will contain the items.
  id: totrans-635
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`fillList`生成的物品HTML不能添加到页面中，直到玩家HTML已经添加，因为玩家HTML包括将包含物品的`ol`元素。
- en: '[PRE92]'
  id: totrans-636
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: Places
  id: totrans-637
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 地点
- en: The places view is the most complicated because places have items *and* exits.
    But the method for displaying exits is the same as that for items, so the extra
    complication is just a touch of repetition. The exits data is an array of strings,
    just like the items data. The same template can be used for both.
  id: totrans-638
  prefs: []
  type: TYPE_NORMAL
  zh: 地点视图是最复杂的，因为地点有物品和出口。但是显示出口的方法与物品相同，所以额外的复杂性只是轻微的重复。出口数据是一个字符串数组，就像物品数据一样。可以使用相同的模板。
- en: The following listing shows the updated place view. The code for exits is in
    bold.
  id: totrans-639
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表显示了更新的地点视图。退出的代码以粗体显示。
- en: Listing 19.16\. A place view using templates ([http://jsbin.com/yoquna/edit?js,console](http://jsbin.com/yoquna/edit?js,console))
  id: totrans-640
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 19.16. 使用模板的地点视图 ([http://jsbin.com/yoquna/edit?js,console](http://jsbin.com/yoquna/edit?js,console))
- en: '![](ch19ex16-0.jpg)'
  id: totrans-641
  prefs: []
  type: TYPE_IMG
  zh: '![](ch19ex16-0.jpg)'
- en: '![](ch19ex16-1.jpg)'
  id: totrans-642
  prefs: []
  type: TYPE_IMG
  zh: '![](ch19ex16-1.jpg)'
- en: Once again, `map` is used to convert an array of strings into an array of objects,
    this time for both items and exits.
  id: totrans-643
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，`map` 用于将字符串数组转换为对象数组，这次用于物品和出口。
- en: 19.6.3\. Enter The Crypt
  id: totrans-644
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 19.6.3. 进入 The Crypt
- en: '[Listing 19.13](#ch19ex13) on JS Bin is a working example of *The Crypt* using
    templates and the three new views. The scripts to import the new modules are shown
    here:'
  id: totrans-645
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 19.13](#ch19ex13) 在 JS Bin 上是使用模板和三个新视图的 *The Crypt* 的一个工作示例。这里显示了导入新模块的脚本：'
- en: '[PRE93]'
  id: totrans-646
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: Make your way to http://output.jsbin.com/yapiyic and have a play.
  id: totrans-647
  prefs: []
  type: TYPE_NORMAL
  zh: 前往 http://output.jsbin.com/yapiyic 并进行尝试。
- en: 19.7\. Summary
  id: totrans-648
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.7. 概述
- en: 'Use the `replace` string method to replace one string with another:'
  id: totrans-649
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `replace` 字符串方法用另一个字符串替换一个字符串：
- en: '[PRE94]'
  id: totrans-650
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE94]'
- en: 'Chain calls to `replace` to swap multiple strings:'
  id: totrans-651
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `replace` 的链式调用交换多个字符串：
- en: '[PRE95]'
  id: totrans-652
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE95]'
- en: Use a `while` loop to execute a block of code while a condition remains `true`.
  id: totrans-653
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `while` 循环在条件保持 `true` 时执行一段代码。
- en: '[PRE96]'
  id: totrans-654
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE96]'
- en: 'Use the `map` array method to create a new array based on the elements of an
    existing array. The function passed to `map` as an argument returns a new value
    based on an old value:'
  id: totrans-655
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `map` 数组方法根据现有数组的元素创建一个新数组。传递给 `map` 的函数作为参数返回一个基于旧值的新值：
- en: '[PRE97]'
  id: totrans-656
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE97]'
- en: '[PRE98]'
  id: totrans-657
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE98]'
- en: 'Use template strings with placeholders to avoid mixing JavaScript with display
    strings:'
  id: totrans-658
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用带有占位符的模板字符串来避免将 JavaScript 与显示字符串混合：
- en: '[PRE99]'
  id: totrans-659
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE99]'
- en: Embed template strings in HTML by using `script` tags with nonstandard `type`
    attributes.
  id: totrans-660
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过使用具有非标准 `type` 属性的 `script` 标签将模板字符串嵌入到 HTML 中。
- en: '[PRE100]'
  id: totrans-661
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE100]'
- en: 'Access the template from JavaScript via the `script` tag’s `id` attribute and
    the element’s `innerHTML` property:'
  id: totrans-662
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过 `script` 标签的 `id` 属性和元素的 `innerHTML` 属性从 JavaScript 访问模板：
- en: '[PRE101]'
  id: totrans-663
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE101]'
- en: 'Fill a template with data from an object. It returns a string with the placeholders
    replaced by the properties of the object:'
  id: totrans-664
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用对象中的数据填充模板。它返回一个字符串，其中的占位符被对象的属性替换：
- en: '[PRE102]'
  id: totrans-665
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE102]'
- en: 'Chapter 20\. XHR: loading data'
  id: totrans-666
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第 20 章. XHR：加载数据
- en: '***This chapter covers***'
  id: totrans-667
  prefs: []
  type: TYPE_NORMAL
  zh: '***本章涵盖***'
- en: Loading data with the `XMLHttpRequest` object
  id: totrans-668
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `XMLHttpRequest` 对象加载数据
- en: Calling functions once the data loads
  id: totrans-669
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据加载后调用函数
- en: Updating views with loaded data
  id: totrans-670
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用加载的数据更新视图
- en: JavaScript Object Notation (JSON)
  id: totrans-671
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: JavaScript 对象表示法 (JSON)
- en: Converting JSON text into JavaScript objects
  id: totrans-672
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将 JSON 文本转换为 JavaScript 对象
- en: A calendar or movies database or adventure game can use a lot of data. A news
    site may have up-to-the-minute updates with breaking news and sports scores. It’s
    not always desirable to load all of the data at once or for a visitor to have
    to keep refreshing a web page to get the latest information. It would be great
    if a page could access just the pieces of new data it needs to stay fresh, even
    after it has loaded. Stock prices, tweets, comments, scores, and, yes, the current
    health of zombies can all be updated independently without a full page reload.
  id: totrans-673
  prefs: []
  type: TYPE_NORMAL
  zh: 日历或电影数据库或冒险游戏可能需要大量数据。新闻网站可能有最新的更新，包括突发新闻和体育比分。并不是总是希望一次性加载所有数据，或者让访客不断刷新网页以获取最新信息。如果页面能够仅访问它需要以保持新鲜的数据片段，那就太好了，即使它已经加载了。股价、推文、评论、比分，以及是的，僵尸的健康状况都可以独立更新，而无需完全重新加载页面。
- en: This chapter shows you how to reach out across the internet and grab data for
    your apps while they’re running. In particular, you load exercise data as you
    switch between users in the fitness app, and you load location data, tomb by tomb,
    as players solve the riddles of *The Crypt*.
  id: totrans-674
  prefs: []
  type: TYPE_NORMAL
  zh: 本章向您展示如何在运行时通过网络获取数据，用于您的应用。特别是，当您在健身应用中切换用户时，您会加载锻炼数据，当玩家解决 The Crypt 的谜题时，您会逐个加载位置数据。
- en: 20.1\. Building a fitness app—retrieving user data
  id: totrans-675
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 20.1. 构建健身应用—检索用户数据
- en: 'You and your team have been building a fitness app that lets users track their
    exercise (see [chapters 14](kindle_split_023.html#ch14) to [16](kindle_split_025.html#ch16)).
    The app can convert JavaScript data into user models, use a choice of views to
    display user info on the console, and accept user input at the console prompt.
    The tasks you were given for the project are these:'
  id: totrans-676
  prefs: []
  type: TYPE_NORMAL
  zh: 您和您的团队一直在构建一个健身应用，允许用户跟踪他们的锻炼（参见第 14 章 [chapters 14](kindle_split_023.html#ch14)
    到第 16 章 [16](kindle_split_025.html#ch16)）。该应用可以将 JavaScript 数据转换为用户模型，使用可选的视图在控制台显示用户信息，并在控制台提示中接受用户输入。您在项目中分配的任务如下：
- en: '**1**.  Retrieve user data as a string.'
  id: totrans-677
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**. 以字符串形式检索用户数据。'
- en: '**2**.  Convert user data into user models.'
  id: totrans-678
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**. 将用户数据转换为用户模型。'
- en: '**3**.  Display user data.'
  id: totrans-679
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**. 显示用户数据。'
- en: '**4**.  Provide an interface for users to add sessions.'
  id: totrans-680
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**4**. 为用户提供添加会话的界面。'
- en: You’ve completed tasks 2, 3, and 4, and now it’s time to retrieve user data
    over the internet. You want to be able to switch between users while using the
    app, as shown in [figure 20.1](#ch20fig01).
  id: totrans-681
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经完成了任务2、3和4，现在是时候通过互联网检索用户数据了。您希望在应用程序中使用时能够切换用户，如图20.1所示。
- en: Figure 20.1\. Switching between users while using the fitness app
  id: totrans-682
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图20.1. 在使用健身应用程序时切换用户
- en: '![](20fig01_alt.jpg)'
  id: totrans-683
  prefs: []
  type: TYPE_IMG
  zh: '![](20fig01_alt.jpg)'
- en: '[Figure 20.1](#ch20fig01) shows an `app.loadUser` method being called to load
    data for second and third users. Before you can get your hands on the data, you
    need some way of specifying the location of the data for each user.'
  id: totrans-684
  prefs: []
  type: TYPE_NORMAL
  zh: '[图20.1](#ch20fig01)显示了调用`app.loadUser`方法以加载第二和第三用户的数据。在您能够获取数据之前，您需要一种方式来指定每个用户数据的位置。'
- en: 20.1.1\. Locating the user data
  id: totrans-685
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.1.1. 定位用户数据
- en: Different team members are working on versions of the fitness app for different
    platforms and devices. But all of the versions will use the same data, provided
    by the central fitness app server, as shown in [figure 20.2](#ch20fig02).
  id: totrans-686
  prefs: []
  type: TYPE_NORMAL
  zh: 不同的团队成员正在为不同的平台和设备开发健身应用程序的不同版本。但所有版本都将使用由中央健身应用程序服务器提供的相同数据，如图20.2所示。
- en: Figure 20.2\. The same data is used by all of the apps.
  id: totrans-687
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图20.2. 所有应用程序都使用相同的数据。
- en: '![](20fig02_alt.jpg)'
  id: totrans-688
  prefs: []
  type: TYPE_IMG
  zh: '![](20fig02_alt.jpg)'
- en: 'Up until now, while developing the app, you’ve been using a static data file
    for a single user. You want to be able to swap between users without reloading
    the whole app and without loading the data for all of the users at once (you’re
    hoping for *lots* of users!). You decide to define a `loadUser` method that will
    load user data for a given user ID and display it on the console:'
  id: totrans-689
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，在开发应用程序的过程中，您一直使用一个静态数据文件来处理单个用户。您希望能够在不重新加载整个应用程序的情况下，在不一次性加载所有用户数据的情况下（您希望有*很多*用户！），在用户之间进行切换。您决定定义一个`loadUser`方法，该方法将为指定的用户ID加载用户数据，并在控制台上显示：
- en: '[PRE103]'
  id: totrans-690
  prefs: []
  type: TYPE_PRE
  zh: '[PRE103]'
- en: 'Your IDs for the fitness app correspond to files on JS Bin; in a real application
    they may be IDs from a database or maybe unique usernames. Each file contains
    the data for just one user. For example, here’s Mahesha’s data at [http://output.jsbin.com/qiwizo.json](http://output.jsbin.com/qiwizo.json):'
  id: totrans-691
  prefs: []
  type: TYPE_NORMAL
  zh: 您的健身应用程序的ID对应于JS Bin上的文件；在实际应用程序中，它们可能是数据库中的ID或可能是唯一的用户名。每个文件只包含一个用户的数据。例如，以下是Mahesha的数据，位于[http://output.jsbin.com/qiwizo.json](http://output.jsbin.com/qiwizo.json)：
- en: '[PRE104]'
  id: totrans-692
  prefs: []
  type: TYPE_PRE
  zh: '[PRE104]'
- en: So, how do you load data for a player while your program is running? The secret
    lies with the strangely named `XMLHttpRequest` object. But before you load up
    its secrets, it’ll be worth getting a better sense of the steps involved in working
    with the remote data.
  id: totrans-693
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，如何在程序运行时加载玩家的数据呢？秘密在于奇怪命名的`XMLHttpRequest`对象。但在您揭开其秘密之前，了解与远程数据交互的步骤将非常有价值。
- en: 20.1.2\. Loading the user data—an outline
  id: totrans-694
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.1.2. 加载用户数据——概述
- en: 'You need to load user data for the fitness app. Whenever a user calls the `loadUser`
    method, your app needs to reach out across the internet, find the data, retrieve
    it, and then use it. To do all that, the app will need the following:'
  id: totrans-695
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要为健身应用程序加载用户数据。每当用户调用`loadUser`方法时，您的应用程序需要通过网络找到数据，检索它，然后使用它。为了完成所有这些，应用程序将需要以下内容：
- en: A user ID
  id: totrans-696
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个用户ID
- en: A URL at which to find the data
  id: totrans-697
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个用于查找数据的URL
- en: A function to call once the data is retrieved
  id: totrans-698
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个在数据检索后调用的函数
- en: 'The third requirement is worth considering further. The data is across the
    internet, possibly across the world, on another machine. It will take time for
    the data to be found and retrieved (hopefully milliseconds, but maybe seconds).
    Your program needs the data before it can use it to create a new `User` and update
    the display. You define a function, called a *callback function*, that will be
    called when the data is loaded. You’ve come across callback functions before:
    when working with buttons in [chapter 18](kindle_split_028.html#ch18), you asked
    for a function to be called when a button was clicked. It was as if the function
    were listening for the click event to happen. For loading user data, your callback
    function is listening for a load event to happen. Your code for loading user data
    and using it to update the app will be something like this:'
  id: totrans-699
  prefs: []
  type: TYPE_NORMAL
  zh: 第三个要求值得进一步考虑。数据可能跨越互联网，甚至可能跨越世界，在另一台机器上。找到并检索数据需要时间（希望是毫秒，但可能是秒）。在程序能够使用这些数据创建新的
    `User` 对象并更新显示之前，它需要这些数据。你定义了一个函数，称为 *回调函数*，当数据加载完成时会被调用。你之前已经遇到过回调函数：在 [第 18
    章](kindle_split_028.html#ch18) 中处理按钮时，你请求一个在按钮被点击时调用的函数。这就像函数正在监听点击事件的发生。对于加载数据用户，你的回调函数正在监听加载事件的发生。你加载数据并使用它来更新应用程序的代码可能如下所示：
- en: '[PRE105]'
  id: totrans-700
  prefs: []
  type: TYPE_PRE
  zh: '[PRE105]'
- en: You pass the `loadData` function the `id` of the user, `qiwizo`, and a function
    to call when the data has loaded, `updateUser`.
  id: totrans-701
  prefs: []
  type: TYPE_NORMAL
  zh: 你将 `loadData` 函数的用户 `id`（`qiwizo`）和一个在数据加载完成后要调用的函数 `updateUser` 传递给它。
- en: You have a sense of the steps involved in retrieving the data you need. It’s
    time to study the specifics.
  id: totrans-702
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经对获取所需数据的步骤有了概念。现在是时候研究具体细节了。
- en: 20.1.3\. Loading the user data—the XMLHttpRequest constructor
  id: totrans-703
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.1.3\. 加载用户数据——XMLHttpRequest 构造函数
- en: Yes, the `XMLHttpRequest` constructor has a funny name, although the request
    bit’s okay. You want to *request* information from a computer, a *server*, somewhere
    in the world. You can research XML and HTTP as homework. From now on, apart from
    in code, I’ll call it the XHR constructor. Short. Snappy. Cuddly?
  id: totrans-704
  prefs: []
  type: TYPE_NORMAL
  zh: 是的，`XMLHttpRequest` 构造函数有一个有趣的名字，尽管请求部分是合理的。你想要从世界上的某个地方（一个 *服务器*）请求信息。你可以将研究
    XML 和 HTTP 作为家庭作业。从现在起，除了在代码中，我还会称之为 XHR 构造函数。简短、简洁、可爱？
- en: The XHR constructor is provided by the browser. You use it to create XHR objects
    that include methods for requesting resources from across the internet. You pass
    an XHR object a URL and a function to call, and when it loads the data it will
    call your function. [Figure 20.3](#ch20fig03) shows the data retrieved when an
    XHR object is used to load the data for a user in the fitness app.
  id: totrans-705
  prefs: []
  type: TYPE_NORMAL
  zh: XHR 构造函数由浏览器提供。你使用它来创建包含从互联网请求资源的方法的 XHR 对象。你向 XHR 对象传递一个 URL 和一个要调用的函数，当它加载数据时，它会调用你的函数。[图
    20.3](#ch20fig03) 展示了当使用 XHR 对象加载数据健身应用程序中的用户数据时检索到的数据。
- en: Figure 20.3\. The string of data returned by an XHR object
  id: totrans-706
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 20.3\. XHR 对象返回的数据字符串
- en: '![](20fig03.jpg)'
  id: totrans-707
  prefs: []
  type: TYPE_IMG
  zh: '![](20fig03.jpg)'
- en: '[Listing 20.1](#ch20ex01) has the code, which includes these five steps, required
    to make the request for the data.'
  id: totrans-708
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 20.1](#ch20ex01) 包含了执行数据请求所需的这五个步骤的代码。'
- en: '**1**.  Use the XHR constructor to create an XHR object'
  id: totrans-709
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**.  使用 XHR 构造函数创建一个 XHR 对象'
- en: '**2**.  State or build the URL'
  id: totrans-710
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**.  声明或构建 URL'
- en: '**3**.  Give the XHR object a function to call when the data has loaded'
  id: totrans-711
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**.  为 XHR 对象提供一个在数据加载完成后调用的函数'
- en: '**4**.  Call the `open` method, passing it the URL'
  id: totrans-712
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**4**.  调用 `open` 方法，并传入 URL'
- en: '**5**.  Call the `send` method to start the request'
  id: totrans-713
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**5**.  调用 `send` 方法以启动请求'
- en: Listing 20.1\. Using an XHR object to load user data ([http://jsbin.com/qakofo/edit?js,console](http://jsbin.com/qakofo/edit?js,console))
  id: totrans-714
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 20.1\. 使用 XHR 对象加载数据用户 ([http://jsbin.com/qakofo/edit?js,console](http://jsbin.com/qakofo/edit?js,console))
- en: '![](371fig01_alt.jpg)'
  id: totrans-715
  prefs: []
  type: TYPE_IMG
  zh: '![](371fig01_alt.jpg)'
- en: You call the XHR constructor with the `new` keyword and it creates and returns
    an XHR object. You call the object’s methods to set up and start the request.
    You provide a function to call once the data is loaded; in [listing 20.1](#ch20ex01)
    you use a function expression as the second argument to `addEventListener`, but
    you could also use the name of a previously defined function. Once loaded, the
    data is automatically assigned to the `responseText` property of the XHR object
    and your callback function can access the data via that property. The first argument
    to the `open` function, `GET`, is the *HTTP method* or *verb* for the request.
    You stick with `GET` for this chapter because you’re getting data, but there are
    other verbs, like `POST`, `PUT`, and `DELETE`.
  id: totrans-716
  prefs: []
  type: TYPE_NORMAL
  zh: 你使用 `new` 关键字调用 XHR 构造函数，它会创建并返回一个 XHR 对象。你调用对象的方法来设置和启动请求。你提供一个函数，一旦数据加载完成就调用它；在
    [列表 20.1](#ch20ex01) 中，你使用函数表达式作为 `addEventListener` 的第二个参数，但你也可以使用之前定义的函数的名称。一旦加载完成，数据会自动分配给
    XHR 对象的 `responseText` 属性，你的回调函数可以通过该属性访问数据。`open` 函数的第一个参数 `GET` 是请求的 *HTTP 方法*
    或 *动词*。在本章中，你坚持使用 `GET`，因为你正在获取数据，但还有其他动词，如 `POST`、`PUT` 和 `DELETE`。
- en: You can see in [figure 20.3](#ch20fig03) that the data is returned as text.
    The text is shown between double quotation marks (the very first character and
    the very last). The data is in a format called JavaScript Object Notation (JSON),
    which is discussed in more detail in [section 20.2](#ch20lev1sec2). Because it’s
    text, a string, you can’t access the data as you would a JavaScript object, with
    expressions such as `data.name` or `data["sessions"]`.
  id: totrans-717
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在 [图 20.3](#ch20fig03) 中看到数据以文本形式返回。文本显示在双引号之间（第一个字符和最后一个字符）。数据是以称为 JavaScript
    对象表示法（JSON）的格式，这在 [第 20.2 节](#ch20lev1sec2) 中有更详细的讨论。因为它是一种文本，一个字符串，你不能像访问 JavaScript
    对象那样访问数据，例如使用 `data.name` 或 `data["sessions"]`。
- en: Happily, there’s a simple way to convert the JSON text into a JavaScript object.
  id: totrans-718
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，有一种简单的方法可以将 JSON 文本转换为 JavaScript 对象。
- en: 20.1.4\. Loading the user data—parsing the XHR response with JSON.parse
  id: totrans-719
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.1.4\. 加载用户数据——使用 JSON.parse 解析 XHR 响应
- en: The XHR request runs your callback function once it has loaded the data for
    a fitness app user. The data, as a string, is automatically assigned to the `responseText`
    property of the XHR object. In order to translate the string into a JavaScript
    object with properties you can access, like `name` and `sessions`, you use the
    `JSON.parse` JavaScript method.
  id: totrans-720
  prefs: []
  type: TYPE_NORMAL
  zh: 当 XHR 请求加载了健身应用用户的 数据后，它会运行回调函数。数据作为一个字符串，会自动分配给 XHR 对象的 `responseText` 属性。为了将字符串转换为你可以访问的
    JavaScript 对象，例如 `name` 和 `sessions`，你使用 `JSON.parse` JavaScript 方法。
- en: '[PRE106]'
  id: totrans-721
  prefs: []
  type: TYPE_PRE
  zh: '[PRE106]'
- en: '[Figure 20.4](#ch20fig04) shows what the user data looks like once you parse
    it and log it to the console. Rather than just a string, it’s now an *object*
    with properties (compare [figures 20.3](#ch20fig03) and [20.4](#ch20fig04)).'
  id: totrans-722
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 20.4](#ch20fig04) 展示了将用户数据解析并记录到控制台后的样子。它现在是一个 *对象*，具有属性（比较 [图 20.3](#ch20fig03)
    和 [20.4](#ch20fig04)）。'
- en: Figure 20.4\. Once the
  id: totrans-723
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 20.4\. 一旦
- en: '![](20fig04.jpg)'
  id: totrans-724
  prefs: []
  type: TYPE_IMG
  zh: '![](20fig04.jpg)'
- en: The following listing updates [listing 20.1](#ch20ex01), parsing the loaded
    text to obtain a Java-Script object, before logging the data to the console.
  id: totrans-725
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表更新了 [列表 20.1](#ch20ex01)，在将数据记录到控制台之前，解析加载的文本以获取 Java-Script 对象。
- en: Listing 20.2\. Parsing JSON text to obtain a JavaScript object ([http://jsbin.com/rexolo/edit?js,console](http://jsbin.com/rexolo/edit?js,console))
  id: totrans-726
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 20.2\. 将 JSON 文本解析为 JavaScript 对象 ([http://jsbin.com/rexolo/edit?js,console](http://jsbin.com/rexolo/edit?js,console))
- en: '![](373fig01_alt.jpg)'
  id: totrans-727
  prefs: []
  type: TYPE_IMG
  zh: '![](373fig01_alt.jpg)'
- en: You should have a big smile on your face. With just a few lines of code, you
    can access data from anywhere in the world. (Well, from the server hosting your
    web page. But that could be anywhere.) Big hugs.
  id: totrans-728
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该面带微笑。只需几行代码，你就可以访问世界各地的数据。（好吧，从托管你网页的服务器。但那可以是任何地方。）大大的拥抱。
- en: All of the apps developed in *Get Programming with JavaScript* could benefit
    from an easy way to access data on JS Bin; the bin codes it generates, like `qiwizo`,
    are a bit fiddly. In the next section, you package the XHR code into a `load`
    function that makes retrieving data even easier.
  id: totrans-729
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *Get Programming with JavaScript* 中开发的全部应用程序都可以从一种简单的方法中受益，以便访问 JS Bin 上的数据；它生成的
    bin 代码，如 `qiwizo`，有点麻烦。在下一节中，你将 XHR 代码打包到一个 `load` 函数中，这使得获取数据变得更加容易。
- en: 20.1.5\. Loading JS Bin data—a handy function
  id: totrans-730
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.1.5\. 加载 JS Bin 数据——一个实用的函数
- en: The quiz app, the My Movie Ratings page, the fitness app news page, and *The
    Crypt* could all use the ability to load data while running, just like the fitness
    app itself. To streamline the process of loading data from JS Bin, you create
    a module, *Bin Data*.
  id: totrans-731
  prefs: []
  type: TYPE_NORMAL
  zh: 测验应用程序、我的电影评分页面、健身应用程序新闻页面以及*The Crypt*都可以在运行时加载数据，就像健身应用程序本身一样。为了简化从JS Bin加载数据的过程，你创建了一个模块，*Bin
    Data*。
- en: 'As a general utility function, you add the `load` function to the `gpwj` namespace,
    already home to templating functions (see [chapter 19](kindle_split_029.html#ch19)).
    To load the data in a JS Bin file, you use code of the following form:'
  id: totrans-732
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一项通用实用函数，你将`load`函数添加到`gpwj`命名空间中，该命名空间已经是模板函数的家园（参见[第19章](kindle_split_029.html#ch19)）。要加载JS
    Bin文件中的数据，你使用以下形式的代码：
- en: '[PRE107]'
  id: totrans-733
  prefs: []
  type: TYPE_PRE
  zh: '[PRE107]'
- en: The next listing shows the function in action. It produces the output in [figure
    20.4](#ch20fig04).
  id: totrans-734
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了该函数的实际操作。它生成了[图20.4](#ch20fig04)中的输出。
- en: Listing 20.3\. A function for loading JS Bin data ([http://jsbin.com/suxoge/edit?js,console](http://jsbin.com/suxoge/edit?js,console))
  id: totrans-735
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表20.3. 加载JS Bin数据的函数([http://jsbin.com/suxoge/edit?js,console](http://jsbin.com/suxoge/edit?js,console))
- en: '![](373fig02_alt.jpg)'
  id: totrans-736
  prefs: []
  type: TYPE_IMG
  zh: '![](373fig02_alt.jpg)'
- en: You use the `load` function to grab location data in *The Crypt* in [section
    20.3](#ch20lev1sec3). Data-loading versions of the other projects in the book
    are available on the *Get Programming with JavaScript* website at [www.room51.co.uk/books/getprogramming/projects/](http://www.room51.co.uk/books/getprogramming/projects/).
    The fitness app gets the upgrade right now.
  id: totrans-737
  prefs: []
  type: TYPE_NORMAL
  zh: 你使用`load`函数在[第20.3节](#ch20lev1sec3)中的*The Crypt*中获取位置数据。书中其他项目的数据加载版本可在*Get
    Programming with JavaScript*网站上找到，网址为[www.room51.co.uk/books/getprogramming/projects/](http://www.room51.co.uk/books/getprogramming/projects/)。现在，健身应用程序得到了升级。
- en: 20.1.6\. Building the fitness app
  id: totrans-738
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.1.6. 构建健身应用程序
- en: 'The fitness app team is excited to see the working prototype of the console-based
    program. There are three tasks remaining:'
  id: totrans-739
  prefs: []
  type: TYPE_NORMAL
  zh: 健身应用程序团队很高兴看到基于控制台程序的工作原型。还有三个任务待完成：
- en: '**1**.  Update the controller module to use the new `load` function for user
    data'
  id: totrans-740
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**. 更新控制器模块以使用新的`load`函数来处理用户数据'
- en: '**2**.  Use `script` elements to load the modules the app uses'
  id: totrans-741
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**. 使用`script`元素加载应用程序使用的模块'
- en: '**3**.  Add a line of JavaScript to initialize the app'
  id: totrans-742
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**. 添加一行JavaScript代码以初始化应用程序'
- en: The new controller is shown here. It has a `loadUser` function that calls the
    `gpwj.data .load` method. Both `loadUser` and `log` are returned from the `init`
    method as an interface.
  id: totrans-743
  prefs: []
  type: TYPE_NORMAL
  zh: 这里展示了新的控制器。它有一个`loadUser`函数，该函数调用`gpwj.data.load`方法。`loadUser`和`log`都作为接口从`init`方法返回。
- en: Listing 20.4\. The fitness app controller ([http://jsbin.com/nudezo/edit?js,console](http://jsbin.com/nudezo/edit?js,console))
  id: totrans-744
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表20.4. 健身应用程序控制器([http://jsbin.com/nudezo/edit?js,console](http://jsbin.com/nudezo/edit?js,console))
- en: '![](ch20ex04-0.jpg)'
  id: totrans-745
  prefs: []
  type: TYPE_IMG
  zh: '![](ch20ex04-0.jpg)'
- en: '![](ch20ex04-1.jpg)'
  id: totrans-746
  prefs: []
  type: TYPE_IMG
  zh: '![](ch20ex04-1.jpg)'
- en: Because the app loads user data while running, there’s a chance a user may try
    to log an exercise session before the data has loaded (the fitness app users are
    *super*-keen). The `log` method makes sure the user has been set, `user !== null`,
    before allowing logging to take place. Remember, `null` is a special JavaScript
    value often used to signify that an object is expected but is missing or not yet
    assigned.
  id: totrans-747
  prefs: []
  type: TYPE_NORMAL
  zh: 因为应用程序在运行时加载用户数据，所以有可能用户在数据加载完成之前尝试记录锻炼会话（健身应用程序的用户非常*热衷*）。`log`方法确保在允许记录之前用户已被设置，`user
    !== null`。记住，`null`是JavaScript中的一个特殊值，通常用来表示预期一个对象但该对象缺失或尚未分配。
- en: With all the pieces in place, it’s simply a matter of gathering them together
    and firing the starting pistol. The four fitness app modules are shown in [figure
    20.5](#ch20fig05), with the Bin Data module replacing the module that provided
    static data.
  id: totrans-748
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有部件就绪后，只需将它们组合在一起并发射起跑枪。四个健身应用程序模块在[图20.5](#ch20fig05)中显示，其中Bin Data模块取代了提供静态数据的模块。
- en: Figure 20.5\. The modules that make up the fitness app
  id: totrans-749
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图20.5. 构成健身应用程序的模块
- en: '![](20fig05_alt.jpg)'
  id: totrans-750
  prefs: []
  type: TYPE_IMG
  zh: '![](20fig05_alt.jpg)'
- en: You haven’t had to alter the `User` constructor or view. The next listing shows
    the `script` elements used to load the four modules.
  id: totrans-751
  prefs: []
  type: TYPE_NORMAL
  zh: 你不需要修改`User`构造函数或视图。下一个列表显示了用于加载四个模块的`script`元素。
- en: Listing 20.5\. The fitness app (HTML) ([http://jsbin.com/mikigo/edit?html,console](http://jsbin.com/mikigo/edit?html,console))
  id: totrans-752
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表20.5. 健身应用程序（HTML）([http://jsbin.com/mikigo/edit?html,console](http://jsbin.com/mikigo/edit?html,console))
- en: '[PRE108]'
  id: totrans-753
  prefs: []
  type: TYPE_PRE
  zh: '[PRE108]'
- en: The following listing shows the JavaScript that fires the starting pistol, calling
    `fitnessApp.init` with the JS Bin code for an initial user.
  id: totrans-754
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表展示了启动应用程序的JavaScript代码，调用`fitnessApp.init`并使用JS Bin代码为初始用户。
- en: Listing 20.6\. The fitness app ([http://jsbin.com/mikigo/edit?js,console](http://jsbin.com/mikigo/edit?js,console))
  id: totrans-755
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表20.6. 健身应用程序([http://jsbin.com/mikigo/edit?js,console](http://jsbin.com/mikigo/edit?js,console))
- en: '[PRE109]'
  id: totrans-756
  prefs: []
  type: TYPE_PRE
  zh: '[PRE109]'
- en: The best place to see the app in action is on JS Bin, but [figure 20.1](#ch20fig01)
    at the start of the chapter shows a user loading and logging sessions.
  id: totrans-757
  prefs: []
  type: TYPE_NORMAL
  zh: 在JS Bin上查看应用程序的实际运行情况是最好的地方，但本章开头图20.1([figure 20.1](#ch20fig01))展示了用户正在加载和记录会话。
- en: You’re thrilled with the working app and so is the development team. But there’s
    something missing (apart from actually being able to save data somewhere). Isn’t
    [part 3](kindle_split_026.html#part03) of *Get Programming with JavaScript* all
    about HTML-based apps? Why are you back at the console?
  id: totrans-758
  prefs: []
  type: TYPE_NORMAL
  zh: 你对运行中的应用程序感到非常兴奋，开发团队也是如此。但还有一些东西缺失（除了实际上能够将数据保存到某个地方之外）。难道《用JavaScript编程入门》的第三部分[part
    3](kindle_split_026.html#part03)不是全部关于基于HTML的应用程序吗？为什么你又回到了控制台？
- en: 20.1.7\. The fitness app—what’s next?
  id: totrans-759
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.1.7. 健身应用程序——接下来是什么？
- en: '[Figure 20.6](#ch20fig06) shows what you’re really after—an HTML-based fitness
    app with drop-down lists, text boxes, and buttons. You can choose users from a
    list, load their details, and log new sessions. With all you’ve learned in the
    book, could you build the app? There’s nothing like jumping in and trying to build
    something yourself for helping you learn. There’s no pressure, no race, and no
    failure; be brave and curious, make mistakes, and ask for help. Even if you don’t
    make it to the finish line, you’re sure to learn lots along the way, get a great
    JavaScript workout, and build your coding muscles. And once you’ve tried it for
    yourself, you can sneak a peek at [http://jsbin.com/vayogu/edit?output](http://jsbin.com/vayogu/edit?output)
    to see one way of piecing it together. (Don’t forget to run the program.)'
  id: totrans-760
  prefs: []
  type: TYPE_NORMAL
  zh: '[图20.6](#ch20fig06)展示了你真正想要的东西——一个基于HTML的健身应用程序，具有下拉列表、文本框和按钮。你可以从列表中选择用户，加载他们的详细信息，并记录新的会话。凭借你在书中所学的一切，你能构建这个应用程序吗？没有什么比亲自尝试构建一些东西来帮助你学习更好了。没有压力，没有比赛，也没有失败；要勇敢和好奇，犯错误，并寻求帮助。即使你没有到达终点线，你肯定会在旅途中学到很多东西，得到一次很好的JavaScript锻炼，并锻炼你的编码肌肉。而且一旦你亲自尝试了，你就可以偷偷地看看[http://jsbin.com/vayogu/edit?output](http://jsbin.com/vayogu/edit?output)，看看它是如何拼凑起来的。（别忘了运行程序。）'
- en: Figure 20.6\. The fitness app using web-based views
  id: totrans-761
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图20.6. 使用基于Web的视图的健身应用程序
- en: '![](20fig06_alt.jpg)'
  id: totrans-762
  prefs: []
  type: TYPE_IMG
  zh: '![](20fig06_alt.jpg)'
- en: And if it’s an HTML-based data-driven app that you’re after, there’s no better
    place to see it in action than in *The Crypt*.
  id: totrans-763
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要的是一个基于HTML的数据驱动应用程序，那么在*The Crypt*中看到它运行的效果再好不过了。
- en: But first, as promised, here’s a very brief introduction to the JSON data format.
  id: totrans-764
  prefs: []
  type: TYPE_NORMAL
  zh: 但首先，如承诺的那样，这里是对JSON数据格式的一个非常简短的介绍。
- en: 20.2\. JSON—a simple data format
  id: totrans-765
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 20.2. JSON——一种简单的数据格式
- en: 'JSON is a data format that’s easy for humans to read and write and easy for
    computers to parse and generate. It has become very popular as a format for exchanging
    data on the web. Here’s a calendar event written in JSON:'
  id: totrans-766
  prefs: []
  type: TYPE_NORMAL
  zh: JSON是一种易于人类阅读和编写、也易于计算机解析和生成的数据格式。它已成为在网络上交换数据的一种非常流行的格式。以下是一个用JSON编写的日历事件：
- en: '[PRE110]'
  id: totrans-767
  prefs: []
  type: TYPE_PRE
  zh: '[PRE110]'
- en: 'The format should be very familiar; it’s based on a subset of JavaScript. Property
    names and strings must be enclosed in double quotation marks. Property values
    can be arrays or nested objects. Here is some calendar data for June:'
  id: totrans-768
  prefs: []
  type: TYPE_NORMAL
  zh: 格式应该非常熟悉；它基于JavaScript的一个子集。属性名和字符串必须用双引号括起来。属性值可以是数组或嵌套对象。以下是6月份的一些日历数据：
- en: '[PRE111]'
  id: totrans-769
  prefs: []
  type: TYPE_PRE
  zh: '[PRE111]'
- en: Values can also be numbers, booleans, `null`, and `undefined`. That’s as much
    as you need. (There’s not much more to JSON, to be honest. The full specification
    is at [http://json.org](http://json.org). You may be surprised at how brief it
    is—you have to love those train track diagrams for efficiency!)
  id: totrans-770
  prefs: []
  type: TYPE_NORMAL
  zh: 值也可以是数字、布尔值、`null`和`undefined`。这就足够了。（老实说，JSON并没有多少。完整的规范在[http://json.org](http://json.org)。你可能会对它的简短感到惊讶——你不得不爱那些效率极高的火车轨道图！）
- en: JSON data is transferred as text. So, how do you convert it into objects and
    arrays that can be used in a JavaScript program?
  id: totrans-771
  prefs: []
  type: TYPE_NORMAL
  zh: JSON数据以文本形式传输。那么，你如何将其转换为JavaScript程序中可以使用的对象和数组呢？
- en: 20.2.1\. Converting JSON into objects and arrays with JSON.parse
  id: totrans-772
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.2.1. 使用JSON.parse将JSON转换为对象和数组
- en: 'You turn JSON as text into JavaScript objects by passing it to the `JSON.parse`
    method. You can then access the properties or elements in the data using dot or
    bracket notations. If you’ve used an XHR object to send a request for a single
    calendar event as JSON, you can convert the response to a JavaScript object like
    this:'
  id: totrans-773
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过传递给`JSON.parse`方法将JSON文本转换为JavaScript对象。然后，您可以使用点或方括号符号访问数据中的属性或元素。如果您已经使用XHR对象以JSON格式发送请求以获取单个日历事件，您可以像这样将响应转换为JavaScript对象：
- en: '[PRE112]'
  id: totrans-774
  prefs: []
  type: TYPE_PRE
  zh: '[PRE112]'
- en: That’s quite a brief introduction to JSON, but seeing as the whole book is about
    JavaScript, it should be enough.
  id: totrans-775
  prefs: []
  type: TYPE_NORMAL
  zh: 这只是对JSON的简要介绍，但鉴于整本书都是关于JavaScript的，这应该足够了。
- en: It’s time to load map data, mysterious room by mysterious room, as you return
    to *The Crypt*.
  id: totrans-776
  prefs: []
  type: TYPE_NORMAL
  zh: 是时候加载地图数据了，神秘房间一个接一个，当你返回**地窖**时。
- en: 20.3\. The Crypt—loading a map on demand
  id: totrans-777
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 20.3. 地窖——按需加载地图
- en: Adventures in *The Crypt* involve exploring ancient tombs, sprawling spaceships,
    and mysterious forests. Each adventure may cover dozens of locations with little
    chance of completion in a single sitting. Rather than loading the whole map at
    the start of a game, it might make more sense to load places only when a player
    visits them. The game can store the JSON data for each place in a separate file
    on JS Bin and use `XMLHttpRequest` to load the files when needed.
  id: totrans-778
  prefs: []
  type: TYPE_NORMAL
  zh: 在**地窖**中的冒险包括探索古墓、广阔的太空船和神秘的森林。每一次冒险可能覆盖数十个地点，而且很难在一次游戏中完成。与其在游戏开始时加载整个地图，不如在玩家访问时才加载地点。游戏可以在JS
    Bin上为每个地点存储JSON数据，并在需要时使用`XMLHttpRequest`来加载文件。
- en: '[Figure 20.7](#ch20fig07) shows only the first location, loaded at the start
    of a game. The loaded data includes the JS Bin file codes for the exits from the
    location. The data file for the location south of the The Kitchen has the code
    `kacaluy`, for example.'
  id: totrans-779
  prefs: []
  type: TYPE_NORMAL
  zh: '[图20.7](#ch20fig07)只显示了游戏开始时加载的第一个地点。加载的数据包括该地点出口的JS Bin文件代码。例如，厨房南边的地点的数据文件代码是`kacaluy`。'
- en: Figure 20.7\. At the start of the game, only the initial place data is loaded.
  id: totrans-780
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图20.7。在游戏开始时，只加载了初始地点的数据。
- en: '![](20fig07_alt.jpg)'
  id: totrans-781
  prefs: []
  type: TYPE_IMG
  zh: '![20fig07_alt.jpg](20fig07_alt.jpg)'
- en: The data for each place on the map is loaded only when a player moves to that
    place. [Figure 20.8](#ch20fig08) shows the same map once a player has moved south
    from The Kitchen. The data for The Old Library has now been loaded.
  id: totrans-782
  prefs: []
  type: TYPE_NORMAL
  zh: 地图上每个地点的数据只在玩家移动到该地点时加载。[图20.8](#ch20fig08)显示了玩家从厨房向南移动后的同一张地图。现在已经加载了老图书馆的数据。
- en: Figure 20.8\. The data for The Old Library has been loaded because the player
    moved there.
  id: totrans-783
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图20.8。由于玩家移动到了那里，老图书馆的数据已经被加载。
- en: '![](20fig08_alt.jpg)'
  id: totrans-784
  prefs: []
  type: TYPE_IMG
  zh: '![20fig08_alt.jpg](20fig08_alt.jpg)'
- en: To allow step-by-step loading like this, you have to include the JS Bin file
    codes for each place’s exits in its map data.
  id: totrans-785
  prefs: []
  type: TYPE_NORMAL
  zh: 要允许这种逐步加载，您必须在地图数据中包含每个地点出口的JS Bin文件代码。
- en: 20.3.1\. Specifying exits with JS Bin file codes
  id: totrans-786
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.3.1. 使用JS Bin文件代码指定出口
- en: Say a game in *The Crypt* starts in The Kitchen. At first, the game will load
    only the data for The Kitchen, not for any other places on the map. That’s a lot
    less data loaded at the start of the game. The next listing shows the data for
    that single location. (The challenges have been left out so you can focus on the
    `id`s.)
  id: totrans-787
  prefs: []
  type: TYPE_NORMAL
  zh: 假设一个在**地窖**中的游戏从厨房开始。一开始，游戏只会加载厨房的数据，而不会加载地图上的其他任何地点的数据。这样在游戏开始时加载的数据就少多了。下面的列表显示了该单个地点的数据。（挑战已被省略，以便您能专注于`id`。）
- en: Listing 20.7\. The JSON data for The Kitchen ([http://output.jsbin.com/qulude.json](http://output.jsbin.com/qulude.json))
  id: totrans-788
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表20.7.厨房的JSON数据([http://output.jsbin.com/qulude.json](http://output.jsbin.com/qulude.json))
- en: '![](379fig01_alt.jpg)'
  id: totrans-789
  prefs: []
  type: TYPE_IMG
  zh: '![379fig01_alt.jpg](379fig01_alt.jpg)'
- en: 'Each place has a unique `id` that corresponds to the JS Bin code of the file
    where its data is stored. You use the `id` to construct a place’s URL like this:'
  id: totrans-790
  prefs: []
  type: TYPE_NORMAL
  zh: 每个地点都有一个唯一的`id`，它与存储其数据的文件JS Bin代码相对应。您使用`id`来构造地点的URL，如下所示：
- en: '[PRE113]'
  id: totrans-791
  prefs: []
  type: TYPE_PRE
  zh: '[PRE113]'
- en: Players will move back and forth around the map, solving puzzles, collecting
    treasure, dissolving zombies, and licking leopards. They’re likely to visit some
    locations several times, and you’d like to avoid loading the same data again and
    again.
  id: totrans-792
  prefs: []
  type: TYPE_NORMAL
  zh: 玩家将在地图上往返移动，解决谜题，收集宝藏，溶解僵尸，舔舐豹子。他们可能会多次访问某些地点，您希望避免重复加载相同的数据。
- en: 20.3.2\. Using a cache—load each place only once
  id: totrans-793
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.3.2. 使用缓存——只加载每个地点一次
- en: Whenever you create a new place from loaded data, you store it in a cache, using
    the place’s `id` as the key. Further requests for a place can be given the stored
    place from the cache, avoiding repeatedly loading the same data from JS Bin.
  id: totrans-794
  prefs: []
  type: TYPE_NORMAL
  zh: 每次从加载的数据中创建一个新的地点时，你都会使用地点的 `id` 作为键将其存储在缓存中。对于地点的进一步请求可以给出从缓存中存储的地点，从而避免反复从
    JS Bin 加载相同的数据。
- en: '[PRE114]'
  id: totrans-795
  prefs: []
  type: TYPE_PRE
  zh: '[PRE114]'
- en: 20.3.3\. Replacing the Map Data and Map Builder modules with Map Manager
  id: totrans-796
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.3.3\. 用地图管理器替换地图数据和地图构建器模块
- en: The map builder for *The Crypt* used to take data for the whole map, create
    all of the place models, and then add the items, exits, and challenges to the
    places. Once it had done that for the whole map, it would return the first place
    and the game was ready to play. You now load one place at a time; you need a function
    to load the individual place data and a function to build a single place model
    from the loaded data.
  id: totrans-797
  prefs: []
  type: TYPE_NORMAL
  zh: '*The Crypt* 的地图构建器曾经接受整个地图的数据，创建所有地点模型，然后将物品、出口和挑战添加到地点。一旦它为整个地图完成了这些操作，它就会返回第一个地点，游戏就可以开始玩了。你现在一次加载一个地点；你需要一个函数来加载单个地点数据，以及一个函数从加载的数据中构建单个地点模型。'
- en: '[Listing 20.8](#ch20ex08) shows the code for a new Map Manager module that
    will replace the map-building code you were using in previous versions of *The
    Crypt* ([figure 20.9](#ch20fig09)). The Map Manager module makes a single method
    available in its interface, `loadPlace`. Use it with a previously defined callback
    function or a function expression:'
  id: totrans-798
  prefs: []
  type: TYPE_NORMAL
  zh: '[代码列表 20.8](#ch20ex08) 展示了一个新的地图管理器模块的代码，该模块将替换你在 *The Crypt* 的早期版本中使用的地图构建代码（[图
    20.9](#ch20fig09)）。地图管理器模块在其接口中提供了一个单独的方法，`loadPlace`。使用之前定义的回调函数或函数表达式：'
- en: Figure 20.9\. The modules for *The Crypt* with new or updated modules highlighted
  id: totrans-799
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 20.9\. *The Crypt* 的模块，突出显示新的或更新的模块
- en: '![](20fig09_alt.jpg)'
  id: totrans-800
  prefs: []
  type: TYPE_IMG
  zh: '![](20fig09_alt.jpg)'
- en: '[PRE115]'
  id: totrans-801
  prefs: []
  type: TYPE_PRE
  zh: '[PRE115]'
- en: Listing 20.8\. Map Manager ([http://jsbin.com/xesoxu/edit?js](http://jsbin.com/xesoxu/edit?js))
  id: totrans-802
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 代码列表 20.8\. 地图管理器 ([http://jsbin.com/xesoxu/edit?js](http://jsbin.com/xesoxu/edit?js))
- en: '![](ch20ex08-0.jpg)'
  id: totrans-803
  prefs: []
  type: TYPE_IMG
  zh: '![](ch20ex08-0.jpg)'
- en: '![](ch20ex08-1.jpg)'
  id: totrans-804
  prefs: []
  type: TYPE_IMG
  zh: '![](ch20ex08-1.jpg)'
- en: The Map Manager is made up of two functions. Let’s explore them in turn.
  id: totrans-805
  prefs: []
  type: TYPE_NORMAL
  zh: 地图管理器由两个函数组成。让我们依次探索它们。
- en: Adding a place to the store
  id: totrans-806
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 将地点添加到存储中
- en: The `addPlace` function uses the `Place` constructor to create a model from
    the data; adds items, exits, and challenges; stores the place in the cache; and
    returns it.
  id: totrans-807
  prefs: []
  type: TYPE_NORMAL
  zh: '`addPlace` 函数使用 `Place` 构造函数从数据中创建一个模型；添加项目、出口和挑战；将地点存储在缓存中；并返回它。'
- en: '[PRE116]'
  id: totrans-808
  prefs: []
  type: TYPE_PRE
  zh: '[PRE116]'
- en: There’s nothing more to say for the function; apart from the cache, you’ve seen
    it all before.
  id: totrans-809
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个函数，没有更多要说的了；除了缓存之外，你之前已经看到了所有内容。
- en: Loading the data for a single place
  id: totrans-810
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 加载单个地点的数据
- en: When you call the `loadPlace` function, you give it the `id` of the place you
    want and a callback function. Your callback will be called with the place model
    for the `id` as an argument.
  id: totrans-811
  prefs: []
  type: TYPE_NORMAL
  zh: 当你调用 `loadPlace` 函数时，你给它你想要的位置的 `id` 和一个回调函数。你的回调将使用 `id` 的地点模型作为参数调用。
- en: '[PRE117]'
  id: totrans-812
  prefs: []
  type: TYPE_PRE
  zh: '[PRE117]'
- en: But where does the `loadPlace` function get the place model from? First, it
    tries the cache. If the place isn’t there, it loads the place data from JS Bin.
  id: totrans-813
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，`loadPlace` 函数从哪里获取地点模型呢？首先，它尝试缓存。如果地点不在那里，它将从 JS Bin 加载地点数据。
- en: '[PRE118]'
  id: totrans-814
  prefs: []
  type: TYPE_PRE
  zh: '[PRE118]'
- en: If the `loadPlace` function has to load the data, it uses the Bin Data module’s
    `load` function to get it from JS Bin. The place wasn’t in the cache, so the code
    passes the place data to `addPlace`, to create and store the model, before passing
    the new place model to the callback.
  id: totrans-815
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 `loadPlace` 函数需要加载数据，它将使用 Bin 数据模块的 `load` 函数从 JS Bin 获取它。地点不在缓存中，因此代码将地点数据传递给
    `addPlace`，以创建和存储模型，然后再将新的地点模型传递给回调。
- en: '[PRE119]'
  id: totrans-816
  prefs: []
  type: TYPE_PRE
  zh: '[PRE119]'
- en: Now you know how the data loading works, you put it to use in the game controller,
    for loading an initial location and for moving a player to a new location.
  id: totrans-817
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经知道了数据加载的工作原理，你可以在游戏控制器中使用它，用于加载初始位置并将玩家移动到新位置。
- en: 20.3.4\. Updating the game controller to use the Map Manager
  id: totrans-818
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.3.4\. 更新游戏控制器以使用地图管理器
- en: You’ll need to update two controller methods to make use of the new Map Manager.
    The `init` method used to call `buildMap` to build the whole map for an adventure.
    Now it will call `loadPlace` to load only the first place in the game. And because
    places are no longer preloaded, the `go` method will need to call `loadPlace`
    to retrieve a place from the cache or load it from JS Bin.
  id: totrans-819
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要更新两个控制器方法来使用新的地图管理器。`init` 方法曾经调用 `buildMap` 来为一次冒险构建整个地图。现在它将调用 `loadPlace`
    来仅加载游戏中的第一个地点。由于地点不再预先加载，`go` 方法将需要调用 `loadPlace` 来从缓存中检索地点或从 JS Bin 加载它。
- en: The next listing shows the two updated methods in the context of the controller.
  id: totrans-820
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了在控制器上下文中的两个更新方法。
- en: Listing 20.9\. The game controller using the Map Manager ([http://jsbin.com/vezaza/edit?js](http://jsbin.com/vezaza/edit?js))
  id: totrans-821
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 20.9\. 使用地图管理器的游戏控制器 ([http://jsbin.com/vezaza/edit?js](http://jsbin.com/vezaza/edit?js))
- en: '![](ch20ex09-0.jpg)'
  id: totrans-822
  prefs: []
  type: TYPE_IMG
  zh: '![](ch20ex09-0.jpg)'
- en: '![](ch20ex09-1.jpg)'
  id: totrans-823
  prefs: []
  type: TYPE_IMG
  zh: '![](ch20ex09-1.jpg)'
- en: The `init` method can’t do the bulk of its work until the starting place has
    been loaded. Most of its code, therefore, is inside the callback function passed
    to `loadPlace`. Similarly, the `go` method gets the place with `loadPlace` before
    setting it as the player’s new location.
  id: totrans-824
  prefs: []
  type: TYPE_NORMAL
  zh: '`init` 方法必须在加载起始位置之后才能完成大部分工作。因此，其大部分代码都在传递给 `loadPlace` 的回调函数中。同样，`go` 方法在将位置设置为玩家的新位置之前，使用
    `loadPlace` 获取位置。'
- en: 20.3.5\. Building the game page
  id: totrans-825
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.3.5\. 构建游戏页面
- en: All that’s left is to import the modules and add a few lines of JavaScript to
    initialize the game.
  id: totrans-826
  prefs: []
  type: TYPE_NORMAL
  zh: 剩下的就是导入模块，并添加几行 JavaScript 代码来初始化游戏。
- en: The following listing shows the full HTML for the game. The messages `div` and
    the text box for commands have been moved above the place and player sections.
  id: totrans-827
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了游戏的完整 HTML。消息 `div` 和命令文本框已移动到位置和玩家部分上方。
- en: Listing 20.10\. The Crypt (HTML) ([http://jsbin.com/cujibok/edit?html,output](http://jsbin.com/cujibok/edit?html,output))
  id: totrans-828
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 20.10\. 密室 (HTML) ([http://jsbin.com/cujibok/edit?html,output](http://jsbin.com/cujibok/edit?html,output))
- en: '[PRE120]'
  id: totrans-829
  prefs: []
  type: TYPE_PRE
  zh: '[PRE120]'
- en: The next listing shows the JavaScript initialization code. It now specifies
    the JS Bin code for the data file of the first place in the game.
  id: totrans-830
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个列表显示了 JavaScript 初始化代码。它现在指定了游戏中第一个位置的数据文件的 JS Bin 代码。
- en: Listing 20.11\. The Crypt ([http://jsbin.com/cujibok/edit?js,output](http://jsbin.com/cujibok/edit?js,output))
  id: totrans-831
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 20.11\. 密室 ([http://jsbin.com/cujibok/edit?js,output](http://jsbin.com/cujibok/edit?js,output))
- en: '![](386fig01_alt.jpg)'
  id: totrans-832
  prefs: []
  type: TYPE_IMG
  zh: '![](386fig01_alt.jpg)'
- en: 20.3.6\. Enter The Crypt
  id: totrans-833
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 20.3.6\. 进入密室
- en: Fantastic! The templates for the game are organized with the rest of the HTML;
    if the design needs changing, the templates are easy to find and there’s no intertwining
    of JavaScript, data, and HTML to wrangle. Simpler maintenance, fewer mistakes,
    and happier designers. Win, win, win!
  id: totrans-834
  prefs: []
  type: TYPE_NORMAL
  zh: 太棒了！游戏模板与 HTML 中的其余部分组织在一起；如果需要更改设计，模板很容易找到，而且没有 JavaScript、数据和 HTML 的纠缠。更简单的维护，更少的错误，让设计师更快乐。双赢，双赢，双赢！
- en: Now, you just need to survive *The Crypt*. Test your strength, skill, and stamina
    and play the game on JS Bin at [http://output.jsbin.com/cujibok](http://output.jsbin.com/cujibok).
    Good luck!
  id: totrans-835
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你只需要在 *The Crypt* 中生存下来。测试你的力量、技能和耐力，并在 JS Bin 上玩游戏 [http://output.jsbin.com/cujibok](http://output.jsbin.com/cujibok)。祝你好运！
- en: 20.4\. Summary
  id: totrans-836
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 20.4\. 总结
- en: Use `XMLHttpRequest` objects to load resources for a web page without reloading
    the whole page.
  id: totrans-837
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `XMLHttpRequest` 对象加载网页的资源，而无需重新加载整个页面。
- en: Transfer data for your applications using JSON, a lightweight, readable, JavaScript-based
    data exchange format.
  id: totrans-838
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用轻量级、易读的基于 JavaScript 的数据交换格式 JSON 传输您的应用程序数据。
- en: 'To load data, create an `XMLHttpRequest` object, set an event listener for
    the `load` event, call the `open` method with the URL of the resource, and finally
    call the `send` method:'
  id: totrans-839
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要加载数据，创建一个 `XMLHttpRequest` 对象，为 `load` 事件设置事件监听器，使用资源的 URL 调用 `open` 方法，最后调用
    `send` 方法：
- en: '[PRE121]'
  id: totrans-840
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE121]'
- en: Access JSON data when the `load` event has fired via the `responseText` property
    of the XHR object.
  id: totrans-841
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当 `load` 事件通过 XHR 对象的 `responseText` 属性触发时访问 JSON 数据。
- en: 'Convert the JSON data string into a JavaScript object by passing it to the
    `JSON.parse` method:'
  id: totrans-842
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过传递给 `JSON.parse` 方法将 JSON 数据字符串转换为 JavaScript 对象：
- en: '[PRE122]'
  id: totrans-843
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE122]'
- en: Use a JavaScript object as a cache. Place loaded data or models into the cache
    and check the cache before using XHR.
  id: totrans-844
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 JavaScript 对象作为缓存。将加载的数据或模型放入缓存，并在使用 XHR 之前检查缓存。
- en: 'Chapter 21\. Conclusion: get programming with JavaScript'
  id: totrans-845
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第 21 章．结论：开始用 JavaScript 编程
- en: '***This chapter covers***'
  id: totrans-846
  prefs: []
  type: TYPE_NORMAL
  zh: '***本章涵盖***'
- en: Carrying on your good work
  id: totrans-847
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 继续你的好工作
- en: Working locally with files
  id: totrans-848
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本地使用文件工作
- en: Books and resources
  id: totrans-849
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 书籍和资源
- en: So, how do you get programming with JavaScript?
  id: totrans-850
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，你是如何开始用 JavaScript 编程的呢？
- en: Well, you just get programming with JavaScript.
  id: totrans-851
  prefs: []
  type: TYPE_NORMAL
  zh: 好吧，你只是开始用 JavaScript 编程。
- en: If you really want to understand programming, you have to jump in and write
    programs. Reading books and pondering code can be fun and informative, but it’s
    trying to solve problems and create code yourself that really builds up your skills,
    experience, and resilience. But you’re not alone. In this chapter you look at
    ways you can get help if you get stuck on a project or are just curious about
    how things work. First, you investigate using JavaScript in web pages saved on
    your own computer, rather than on JS Bin.
  id: totrans-852
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你真的想理解编程，你必须跳进去编写程序。阅读书籍和思考代码可以很有趣，也很富有信息量，但真正能提升你的技能、经验和韧性的还是自己解决问题和编写代码。但你不孤单。在本章中，你将了解在遇到项目难题或只是对事物的工作原理感到好奇时，你可以如何获得帮助。首先，你将研究在自己的电脑上保存网页而不是在JS
    Bin中使用JavaScript。
- en: 21.1\. Working locally with files
  id: totrans-853
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 21.1\. 本地文件工作
- en: JS Bin and other online coding sites are great for trying out your ideas and
    checking that your code works. But you want to break out from the sandbox and
    create your own sites. This section looks at writing and saving your files locally
    (on your own computer) and opening them in your browser.
  id: totrans-854
  prefs: []
  type: TYPE_NORMAL
  zh: JS Bin和其他在线编码网站非常适合尝试你的想法并检查你的代码是否工作。但你想跳出沙盒，创建自己的网站。本节将探讨在本地（在自己的电脑上）编写和保存文件，并在浏览器中打开它们。
- en: 21.1.1\. Writing code
  id: totrans-855
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 21.1.1\. 编写代码
- en: JavaScript and HTML files are just text files. You can write them in any text
    editor. Notepad for Windows and TextEdit on OS X would both do the job, although
    they’re very basic. More advanced text editors perform syntax highlighting, using
    colors to differentiate keywords from variables, arguments, strings, and so on,
    and they perform code completion, suggesting what you might be trying to type
    and letting you insert the suggestions quickly. Some popular editors are Sublime
    Text, BBEdit, Notepad++, Atom, and Emacs.
  id: totrans-856
  prefs: []
  type: TYPE_NORMAL
  zh: JavaScript和HTML文件只是文本文件。你可以在任何文本编辑器中编写它们。Windows上的记事本和OS X上的TextEdit都可以完成这项工作，尽管它们非常基础。更高级的文本编辑器会进行语法高亮，使用颜色区分关键字、变量、参数、字符串等，并执行代码补全，建议你可能正在尝试输入的内容，并允许你快速插入建议。一些流行的编辑器包括Sublime
    Text、BBEdit、Notepad++、Atom和Emacs。
- en: There are also integrated development environments (IDEs) that provide extra
    tools that let you manage projects, collaborate, track versions, merge files,
    minify and compress files, and lots more. Examples are Visual Studio, Dreamweaver,
    Eclipse, and WebStorm. [Figure 21.1](#ch21fig01) shows three editors with increasing
    levels of project support.
  id: totrans-857
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，还有集成开发环境（IDEs），它们提供了额外的工具，让你可以管理项目、协作、跟踪版本、合并文件、压缩和缩小文件等等。例如，Visual Studio、Dreamweaver、Eclipse和WebStorm。![图21.1](#ch21fig01)显示了具有不同项目支持级别的三个编辑器。
- en: Figure 21.1\. Notepad, Notepad++, and WebStorm provide increasing levels of
    project support.
  id: totrans-858
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: '![图21.1]. Notepad、Notepad++和WebStorm提供不同级别的项目支持。'
- en: '![](21fig01_alt.jpg)'
  id: totrans-859
  prefs: []
  type: TYPE_IMG
  zh: '![图片](21fig01_alt.jpg)'
- en: 21.1.2\. Saving files
  id: totrans-860
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 21.1.2\. 保存文件
- en: 'Save your files in an organized way, with sensible folders splitting them into
    types or subprojects. [Figure 21.2](#ch21fig02) shows a possible structure of
    files for *The Crypt*. There are separate folders for style sheets, JavaScript
    files, and game maps. The main HTML file is in the root of the project. Various
    project folders from *Get Programming with JavaScript* are available in its GitHub
    repository: [https://github.com/jrlarsen/GetProgramming](https://github.com/jrlarsen/GetProgramming).'
  id: totrans-861
  prefs: []
  type: TYPE_NORMAL
  zh: 以有组织的方式保存你的文件，使用合理的文件夹将它们分成类型或子项目。![图21.2](#ch21fig02)显示了*The Crypt*可能的文件结构。有单独的文件夹用于样式表、JavaScript文件和游戏地图。主要HTML文件位于项目的根目录中。*Get
    Programming with JavaScript*的各种项目文件夹可在其GitHub仓库中找到：[https://github.com/jrlarsen/GetProgramming](https://github.com/jrlarsen/GetProgramming)。
- en: Figure 21.2\. A possible structure of folders and files for *The Crypt*
  id: totrans-862
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: '![图21.2]. *The Crypt*可能的文件夹和文件结构'
- en: '![](21fig02.jpg)'
  id: totrans-863
  prefs: []
  type: TYPE_IMG
  zh: '![图片](21fig02.jpg)'
- en: The files have names that represent their purpose. Just because JS Bin assigns
    random names to files, that doesn’t mean you should. The following listing shows
    the HTML file for the game with the `script` elements used to load the JavaScript.
    There’s also a `link` element in the `head` section that loads the CSS file that
    styles the page. The templates have been omitted because they haven’t changed.
  id: totrans-864
  prefs: []
  type: TYPE_NORMAL
  zh: 文件名代表了它们的目的。尽管JS Bin会给文件分配随机的名称，但这并不意味着你应该这样做。以下列表显示了游戏的HTML文件，其中使用了`script`元素来加载JavaScript。在`head`部分还有一个`link`元素，用于加载样式化页面的CSS文件。模板已被省略，因为它们没有变化。
- en: Listing 21.1\. script elements in theCrypt.html
  id: totrans-865
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表21.1\. Crypt.html中的`script`元素
- en: '![](ch21ex01-0.jpg)'
  id: totrans-866
  prefs: []
  type: TYPE_IMG
  zh: '![图片](ch21ex01-0.jpg)'
- en: '![](ch21ex01-1.jpg)'
  id: totrans-867
  prefs: []
  type: TYPE_IMG
  zh: '![图片](ch21ex01-1.jpg)'
- en: The paths used in the `src` attributes to tell the browser where to find the
    files to load are relative to theCrypt.html. For example, maps/TheDarkHouse.js
    means “starting from the same folder as theCrypt.html, find the maps folder, and
    in that folder find the file called TheDarkHouse.js.”
  id: totrans-868
  prefs: []
  type: TYPE_NORMAL
  zh: 用于在`src`属性中指定浏览器查找要加载的文件的路径是相对于crypt.html的。例如，maps/TheDarkHouse.js意味着“从crypt.html相同的文件夹开始，找到maps文件夹，然后在那个文件夹中找到名为TheDarkHouse.js的文件。”
- en: 21.1.3\. Opening your pages in a browser
  id: totrans-869
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 21.1.3. 在浏览器中打开你的页面
- en: In your browser menu, choose File > Open and browse your filesystem for theCrypt.html.
    The page should open in the browser.
  id: totrans-870
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的浏览器菜单中，选择文件 > 打开，浏览你的文件系统以找到crypt.html。页面应该在浏览器中打开。
- en: 21.1.4\. Concatenating and minifying files
  id: totrans-871
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 21.1.4. 合并和压缩文件
- en: If you were hosting your project on a web server for users to access over the
    internet, it would be better to place all of your JavaScript modules into a single
    file. For each `script` element, the browser will make a request to the server
    for the file specified by the `src` attribute. If all of the files are needed
    to make the application work, then it will be quicker to load one large file rather
    than many small files.
  id: totrans-872
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你将你的项目托管在互联网上供用户访问的Web服务器上，将所有的JavaScript模块放入一个单独的文件会更好。对于每个`script`元素，浏览器将向服务器发送请求，以获取由`src`属性指定的文件。如果所有文件都需要使应用程序工作，那么加载一个大型文件比加载许多小文件要快。
- en: 'You can see a version of *The Crypt* on JS Bin with all of the JavaScript in
    the one bin: [http://jsbin.com/xewozi/edit?js,output](http://jsbin.com/xewozi/edit?js,output).'
  id: totrans-873
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在JS Bin上看到*The Crypt*的一个版本，所有的JavaScript都在一个bin中：[http://jsbin.com/xewozi/edit?js,output](http://jsbin.com/xewozi/edit?js,output)。
- en: While developing the application, using separate files helps with focus, reuse,
    and flexibility. But when the time comes to publish the app, merging the files
    will help the code load more quickly. You can copy the code by hand into a single
    file, but there are tools to help. They may be a bit advanced for beginners, but
    if you’re interested, look out for Grunt, Gulp, Browserify, and CodeKit.
  id: totrans-874
  prefs: []
  type: TYPE_NORMAL
  zh: 在开发应用程序时，使用单独的文件有助于集中注意力、重用和灵活性。但是，当发布应用程序的时候，合并文件将有助于代码更快地加载。你可以手动将代码复制到一个单独的文件中，但也有一些工具可以帮助你。这些工具可能对初学者来说有点高级，但如果你感兴趣，可以关注Grunt、Gulp、Browserify和CodeKit。
- en: The tools will also *minify* your code, squashing it down into a smaller file.
    When the browser runs your JavaScript, it doesn’t need the spaces and line breaks
    that help *you* read the code. It doesn’t need well-named variables either; `a`,
    `b`, and `c` will do the job just as well as `loadData`, `checkGameStatus`, and
    `renderMessage`. The tools will strip the spaces and rename the variables to create
    a smaller file that does exactly the same job. The next two listings show the
    same code, the `use` function from *The Crypt* controller module.
  id: totrans-875
  prefs: []
  type: TYPE_NORMAL
  zh: 工具还会将你的代码*压缩*，将其压缩成更小的文件。当浏览器运行你的JavaScript时，它不需要那些帮助你*阅读*代码的空格和换行符。它也不需要命名良好的变量；`a`、`b`和`c`可以像`loadData`、`checkGameStatus`和`renderMessage`一样完成工作。工具会删除空格并重命名变量，以创建一个更小的文件，它执行的工作完全相同。接下来的两个列表显示了相同的代码，来自*The
    Crypt*控制器模块的`use`函数。
- en: Listing 21.2\. The use function (minified)
  id: totrans-876
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表21.2. 使用函数（压缩版）
- en: '[PRE123]'
  id: totrans-877
  prefs: []
  type: TYPE_PRE
  zh: '[PRE123]'
- en: Listing 21.3\. The use function
  id: totrans-878
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表21.3. 使用函数
- en: '[PRE124]'
  id: totrans-879
  prefs: []
  type: TYPE_PRE
  zh: '[PRE124]'
- en: You can probably appreciate that file-size savings can be significant.
  id: totrans-880
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能能够理解文件大小的节省可以非常显著。
- en: 21.2\. Getting help
  id: totrans-881
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 21.2. 寻求帮助
- en: The fact that you’ve read this book shows you appreciate guided, organized instruction.
    Once you’re up and running, though, it’s great to be able to dip in and out of
    resources, look things up, and ask for help with specific problems. For reference,
    a great site is the Mozilla Developer Network ([https://developer.mozilla.org](https://developer.mozilla.org))
    which has documentation and examples for HTML, CSS, JavaScript, and more. For
    answers to specific questions, join the forums at stackoverflow ([http://stackoverflow.com](http://stackoverflow.com)).
    Members of the community usually answer questions quickly. JavaScript was the
    first language to reach one million questions asked!
  id: totrans-882
  prefs: []
  type: TYPE_NORMAL
  zh: 你阅读这本书的事实表明你欣赏有指导、有组织的指导。一旦你开始运行，能够随时查阅资源、查找信息并就特定问题寻求帮助是非常好的。作为参考，一个很棒的网站是Mozilla开发者网络([https://developer.mozilla.org](https://developer.mozilla.org))，它提供了HTML、CSS、JavaScript等文档和示例。对于特定问题的答案，可以加入stackoverflow([http://stackoverflow.com](http://stackoverflow.com))的论坛。社区成员通常会快速回答问题。JavaScript是第一个达到一百万个提问问题的语言！
- en: 21.3\. What next?
  id: totrans-883
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 21.3. 接下来是什么？
- en: '*Get Programming with JavaScript* was written as an introduction to programming.
    Whereas [part 1](kindle_split_008.html#part01) looked at the building blocks of
    the JavaScript language, [parts 2](kindle_split_019.html#part02) and [3](kindle_split_026.html#part03)
    had a greater emphasis on organizing larger projects and getting a taste for things
    to come. The book was not written as a complete reference but as a practical experience
    of programming. So where next?'
  id: totrans-884
  prefs: []
  type: TYPE_NORMAL
  zh: '*《用 JavaScript 编程》* 被编写为一本编程入门书籍。虽然 [第 1 部分](kindle_split_008.html#part01)
    探讨了 JavaScript 语言的构建块，[第 2 部分](kindle_split_019.html#part02) 和 [第 3 部分](kindle_split_026.html#part03)
    更侧重于组织大型项目和体验即将到来的事物。本书并非作为完整的参考书籍，而是作为编程的实际体验。那么接下来呢？'
- en: 21.3.1\. The companion site
  id: totrans-885
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 21.3.1\. 伴侣网站
- en: Articles, tutorials, videos, resources, examples, and links to other support
    and reference sites will continue to be added to the *Get Programming with JavaScript*
    website at [www.room51.co.uk/books/getProgramming/index.html](http://www.room51.co.uk/books/getProgramming/index.html).
    Some topics that have been left out of the book, like prototypes, inheritance,
    working with `this`, Node.js, and recent additions to JavaScript, will be covered
    there along with guides to improving the examples from the book, like the quiz
    app, the fitness app, fitness app news, and My Movie Ratings.
  id: totrans-886
  prefs: []
  type: TYPE_NORMAL
  zh: 文章、教程、视频、资源、示例，以及指向其他支持和参考网站的链接将继续添加到 *《用 JavaScript 编程》* 网站 [www.room51.co.uk/books/getProgramming/index.html](http://www.room51.co.uk/books/getProgramming/index.html)。书中未涉及的一些主题，如原型、继承、使用
    `this`、Node.js 和 JavaScript 的最新添加功能，将在那里介绍，同时还有改进书中示例（如测验应用、健身应用、健身应用新闻和我的电影评分）的指南。
- en: 21.3.2\. Books
  id: totrans-887
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 21.3.2\. 书籍
- en: 'There are many, many books on JavaScript. Here are a couple I’ve read and enjoyed.
    The first would follow nicely from this one, and the second is a much more in-depth
    dive into the language:'
  id: totrans-888
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 JavaScript 的书籍有很多。以下是我阅读并喜欢的几本书。第一本与这本书很好地衔接，第二本则更深入地探讨了该语言：
- en: '*Eloquent JavaScript: A Modern Introduction to Programming* (No Starch Press;
    2nd ed., 2014) by Marijn Haverbeke'
  id: totrans-889
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*《JavaScript：现代编程导论》*（No Starch Press；第 2 版，2014 年）作者：马里恩·哈弗贝克'
- en: '*Professional JavaScript for Web Developers* (Wrox; 3rd ed., 2012) by Nicholas
    C. Zakas'
  id: totrans-890
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*《专业 JavaScript：网络开发者指南》*（Wrox；第 3 版，2012 年）作者：尼古拉斯·C·扎卡斯'
- en: 21.3.3\. Sites
  id: totrans-891
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 21.3.3\. 网站
- en: A number of sites mix video tutorials with interactive exercises. One I particularly
    like is Code School, [http://codeschool.com](http://codeschool.com). The folks
    at Code School have also built a nice introductory JavaScript site at [http://javascript.com](http://javascript.com).
  id: totrans-892
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多网站将视频教程与交互式练习相结合。我特别喜欢的是 Code School，[http://codeschool.com](http://codeschool.com)。Code
    School 的人们还在 [http://javascript.com](http://javascript.com) 建立了一个很好的 JavaScript
    入门网站。
- en: 21.3.4\. Practice makes permanent
  id: totrans-893
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 21.3.4\. 熟能生巧
- en: Keep practicing. Get on JS Bin and try things out. There are a number of suggestions
    for projects on the book’s website. If you get stuck, feel free to post a question
    on the book’s forum ([https://forums.manning.com/forums/get-programming-with-javascript](https://forums.manning.com/forums/get-programming-with-javascript))
    at [Manning.com](http://Manning.com) or join the community at [stackoverflow.com](http://stackoverflow.com).
  id: totrans-894
  prefs: []
  type: TYPE_NORMAL
  zh: 继续练习。登录 JS Bin 尝试新事物。本书网站上有一些建议的项目。如果您遇到困难，请随时在本书论坛 [Manning.com](http://Manning.com)
    上的 [https://forums.manning.com/forums/get-programming-with-javascript](https://forums.manning.com/forums/get-programming-with-javascript)
    发帖提问，或者加入 [stackoverflow.com](http://stackoverflow.com) 的社区。
- en: I hope you’ve enjoyed working through the book, tinkering with all of the code,
    making conjectures, and testing out your ideas on JS Bin. Stay curious and *Get
    Programming with JavaScript!*
  id: totrans-895
  prefs: []
  type: TYPE_NORMAL
  zh: 我希望您在阅读本书、摆弄所有代码、提出假设，并在 JS Bin 上测试您的想法时感到愉快。保持好奇心，*用 JavaScript 编程！*
- en: 21.4\. Summary
  id: totrans-896
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 21.4\. 摘要
- en: Use a text editor to write and save JavaScript and HTML files.
  id: totrans-897
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用文本编辑器编写和保存 JavaScript 和 HTML 文件。
- en: Organize the files for a project using folders and appropriate filenames.
  id: totrans-898
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用文件夹和适当的文件名组织项目文件。
- en: Open the HTML files in your browser.
  id: totrans-899
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在您的浏览器中打开 HTML 文件。
- en: Find out more and get help at the Mozilla Developer Network and [stackoverflow.com](http://stackoverflow.com).
  id: totrans-900
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Mozilla 开发者网络和 [stackoverflow.com](http://stackoverflow.com) 获取更多信息并获得帮助。
- en: Make the most of the resources on the book’s website.
  id: totrans-901
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 充分利用本书网站上的资源。
- en: Practice, practice, practice.
  id: totrans-902
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 练习，练习，再练习。
- en: Be curious, adventurous, resilient, and patient. Good luck on your adventures!
  id: totrans-903
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 保持好奇心、冒险精神、弹性和耐心。祝您冒险成功！
