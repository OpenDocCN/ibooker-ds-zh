- en: Chapter 8\. Using spatial reference systems
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第8章\. 使用空间参考系统
- en: '*This chapter covers*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*本章涵盖*'
- en: Understanding spatial reference systems
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解空间参考系统
- en: Transforming data using OSR
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用OSR转换数据
- en: Transforming data using pyproj
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用pyproj转换数据
- en: Great-circle calculations using pyproj
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用pyproj进行大圆计算
- en: Most people are familiar with the concept of using latitude and longitude to
    specify a location on the earth’s surface. Would you be surprised to learn that
    many other coordinate systems are also used, and that these different spatial
    reference systems are used for different purposes? To make things even more complicated,
    the earth isn’t a perfect sphere, and multiple models, called *datums*, are used
    to represent the planet’s shape. Given this, coordinates from any system, including
    latitude and longitude, aren’t absolute—a set of coordinates can specify a slightly
    different location depending on the datum used.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数人熟悉使用纬度和经度来指定地球表面位置的概念。你会不会惊讶地发现，还有许多其他坐标系也被使用，并且不同的空间参考系统用于不同的目的？更复杂的是，地球不是一个完美的球体，使用了多个称为*基准面*的模型来表示地球的形状。鉴于这一点，任何系统（包括纬度和经度）的坐标都不是绝对的——一组坐标可以指定一个略微不同的位置，这取决于使用的基准面。
- en: Because so many coordinate systems exist, it’s unlikely that all of your data
    will use the one you need, so the ability to convert data between them is critical.
    Not only that, but it’s impossible to transform data from one spatial reference
    system to another if you don’t know which system they currently use, so you must
    ensure that this information is documented or risk rendering your data unusable.
    To effectively work with coordinate systems, you need to understand why so many
    of them exist in the first place and how to select an appropriate one for your
    purposes, so we’ll start with background information and then move on to transforming
    data.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 由于存在许多坐标系，因此你的数据很可能不会使用你需要的那个，因此能够在它们之间转换数据的能力至关重要。不仅如此，如果你不知道它们目前使用的是哪个系统，就无法将数据从一个空间参考系统转换到另一个，因此你必须确保这些信息得到记录，否则可能会使你的数据变得不可用。为了有效地处理坐标系，你需要了解为什么存在如此多的坐标系，以及如何为你的目的选择一个合适的坐标系，因此我们将从背景信息开始，然后转向数据转换。
- en: 8.1\. Introduction to spatial reference systems
  id: totrans-8
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.1\. 空间参考系统简介
- en: A spatial reference system is made of three components—a coordinate system,
    a datum, and a projection—all of which affect where on the earth a set of coordinates
    refers to. Briefly, datums are used to represent the curvature of the earth, and
    projections transform coordinates from a three-dimensional globe to a two-dimensional
    map. Different projections are appropriate for different purposes, such as web
    mapping, accurately measuring distances, or calculating areas. There’s more to
    it than that, however, and it’s important to understand the role that both datums
    and projections play. Let’s back up and review how coordinates are represented
    on a globe. Latitude and longitude are the distance, in degrees, from the equator
    and the prime meridian, respectively. Latitude values range from -90 to 90, with
    positive values north of the equator. Longitudes range from -180 to 180, with
    positive values east of the Greenwich prime meridian (shown in [figure 8.1](#ch08fig01)).
    Using degrees makes perfect sense on a spherical surface, and although the earth
    isn’t a perfect sphere, it’s close enough for this to be a convenient way to specify
    a precise location on the planet.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 空间参考系统由三个组成部分——坐标系、基准面和投影——所有这些都影响一组坐标在地球上的位置。简而言之，基准面用于表示地球的曲率，而投影将坐标从三维地球转换到二维地图。不同的投影适用于不同的目的，例如网络地图、精确测量距离或计算面积。然而，这还远不止这些，理解基准面和投影所起的作用非常重要。让我们回顾一下如何在地球上表示坐标。纬度和经度分别是赤道和本初子午线的度数距离。纬度值范围从-90到90，正值位于赤道以北。经度范围从-180到180，正值位于格林威治本初子午线以东（如图8.1所示）。在球面上使用度数是完美的，尽管地球不是一个完美的球体，但足够接近，可以方便地指定地球上精确的位置。
- en: Figure 8.1\. Latitude and longitude lines at 30° intervals. Positive latitude
    values are north of the equator, and positive longitudes are east of the prime
    meridian.
  id: totrans-10
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.1\. 每隔30°的纬度和经度线。正纬度值位于赤道以北，正经度位于本初子午线以东。
- en: '![](08fig01.jpg)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![图片](08fig01.jpg)'
- en: '|  |'
  id: totrans-12
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Definition
  id: totrans-13
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 定义
- en: The prime meridian is the line of longitude that passes through the Royal Observatory,
    Greenwich, in London. This has been recognized by much of the world as the reference
    meridian since 1884\. The equator is the line of latitude that is equal distances
    from both the north and south poles.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 本初子午线是通过伦敦格林尼治皇家天文台的经线。自 1884 年以来，这已被世界上的许多地区认可为参考子午线。赤道是距离南北两极等距离的纬线。
- en: '|  |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: '|  |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: '**Methods of specifying latitude and longitude**'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '**指定经纬度的方法**'
- en: 'Multiple methods exist for specifying latitude and longitude coordinates. For
    example, these are all equivalent:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 存在多种方法来指定经纬度坐标。例如，以下都是等效的：
- en: '***Decimal degrees (DD)*** —37.8197° N, 122.4786° W'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***十进制度数（DD）*** —37.8197° N, 122.4786° W'
- en: '***Degrees decimal minutes (DM)*** —37° 49.182′ N, 122° 28.716′ W'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***十进制度分（DM）*** —37° 49.182′ N, 122° 28.716′ W'
- en: '***Degrees minutes seconds (DMS)*** —37° 49′ 11″ N, 122° 28′ 43″ W'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***度分秒（DMS）*** —37° 49′ 11″ N, 122° 28′ 43″ W'
- en: These different notations are based on the fact that angles are divided up into
    minutes, where one degree in an angle is made up of 60 minutes, and each minute
    is made up of 60 seconds. Because latitude and longitude are degree measurements,
    they’re also divided up into minutes and seconds. To get decimal minutes from
    decimal degrees, multiply the fractional part of the DD value by 60, so for example,
    60 × 0.8197 = 49.182\. Therefore, 37.8197 degrees equals 37 degrees and 49.182
    minutes. Similarly, you can multiply the fractional part of the minutes value
    by 60 to get seconds. Because 60 × 0.182 = 10.92, now you have 37 degrees, 49
    minutes, and about 11 seconds.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 这些不同的符号基于这样一个事实，即角度被分成分钟，其中角度的一个度由 60 分钟组成，每个分钟由 60 秒组成。因为纬度和经度是度数测量，它们也被分成分钟和秒。要从十进制度数中获取十进制度分，将
    DD 值的小数部分乘以 60，例如，60 × 0.8197 = 49.182。因此，37.8197 度等于 37 度和 49.182 分钟。同样，您可以将分钟值的小数部分乘以
    60 来获取秒。因为 60 × 0.182 = 10.92，现在您有 37 度，49 分钟，大约 11 秒。
- en: 'To go the opposite direction and convert DMS to DD, divide the minutes by 60
    and the seconds by 3600 and add those results to the hours value, like this (notice
    the rounding error):'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 要进行相反方向的转换，将 DMS 转换为 DD，将分钟除以 60，将秒除以 3600，并将这些结果加到小时值上，如下所示（注意舍入误差）：
- en: '![](155equ01.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![](155equ01.jpg)'
- en: Additionally, south and west values are represented as negative numbers if the
    directions aren’t specified. For example, -122.4786° is the same as 122.4786°
    W.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，如果未指定方向，南和西的值用负数表示。例如，-122.4786° 等同于 122.4786° W。
- en: To use latitude and longitude values in your Python code, you’ll need to make
    sure that they use the decimal degrees format and specify directions using positive
    and negative values instead of N, S, E, or W.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 要在您的 Python 代码中使用经纬度值，您需要确保它们使用十进制度数格式，并使用正负值而不是 N、S、E 或 W 来指定方向。
- en: '|  |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: However, a complication arises from the fact that the earth isn’t a perfect
    sphere or even a perfect ellipsoid. As you probably learned in geometry class,
    but then promptly forgot, simple equations can model the shape of ellipsoids,
    including spheres. But these equations assume a perfect geometry with a nice smooth
    surface and no protrusions and dips. It would be quite something if a planet were
    to form that perfectly, and ours certainly didn’t. Have you ever seen a worn-out
    ball, like a volleyball, that has developed a weak spot and has a bulge that wasn’t
    there when the ball was new? Not only does the earth have mountains and valleys,
    but it’s a little lopsided like that volleyball, which definitely makes describing
    its surface with a simple set of equations more complicated.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，由于地球不是一个完美的球体，甚至不是一个完美的椭圆体，这引发了一个复杂的问题。您可能在上几何课时学过，但很快就会忘记，简单的方程可以模拟椭圆体的形状，包括球体。但这些方程假设了一个完美的几何形状，有一个光滑的表面，没有突出和凹陷。如果有一个星球能够完美地形成，那将是一件相当了不起的事情，但我们的地球显然不是。您见过一个磨损的球，比如排球，它已经形成了一个弱点，并且有一个在新球时并不存在的凸起吗？地球不仅有山脉和山谷，而且它有点像那个排球，这确实使得用一组简单的方程描述其表面变得更加复杂。
- en: Because of these anomalies in the planet’s surface, and also because measurement
    accuracies vary, the earth’s ellipsoid has multiple models. These models are called
    datums, and every spatial reference system is based on one of them. One widely
    used global datum, the *World Geodetic System*, was last revised in 1984\. This
    datum, called WGS84 for short, is the one used for data with a global coverage,
    including the Global Positioning System (GPS). Most datums are designed to model
    the curvature of the earth in a more localized area, such as a continent or even
    a smaller area. A datum designed for one area will not work well elsewhere. For
    example, the North American Datum of 1983 (NAD83) shouldn’t be used in Europe.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 由于地球表面的这些异常，以及测量精度不同，地球椭球体有多个模型。这些模型被称为基准，每个空间参考系统都基于其中之一。一个广泛使用的全球基准，即世界大地测量系统（World
    Geodetic System），最后一次修订是在1984年。这个基准，简称为WGS84，用于全球覆盖的数据，包括全球定位系统（GPS）。大多数基准都是为了在更局部化的区域，如大陆甚至更小的区域，模拟地球的曲率。为某一区域设计的基准在其他地方可能效果不佳。例如，1983年的北美基准（NAD83）不应用于欧洲。
- en: Depending on which datum is being used, the same set of latitude and longitude
    coordinates can refer to slightly different locations, because the underlying
    ellipsoids are different shapes. Sometimes the difference between coordinates
    using two different datums is negligible, but other times it can be hundreds of
    meters. Because of this, you always need to know which datum your geographic data
    is based on.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 根据所使用的基准数据不同，同一组纬度和经度坐标可以指代略微不同的位置，因为底层的椭球体形状不同。有时，使用两个不同基准数据的坐标之间的差异可以忽略不计，但有时它可能达到数百米。正因为如此，你总是需要知道你的地理数据基于哪个基准。
- en: Until now we’ve only talked about three-dimensional ellipsoids, but what you
    really want in most cases is a two-dimensional map because they tend to be more
    convenient for most purposes. After all, it’s hard to fold up a globe and put
    it in your pocket or embed one inside of a book! How do mapmakers go from three
    to two dimensions? One way to solve the problem is with what’s called an *interrupted
    map*, like that shown in [figure 8.2](#ch08fig02). You’ve probably seen these
    before, and perhaps you’ve even cut one out and bent the paper to make a globe.
    That’s kind of cool, but in its two-dimensional form, the map would be much easier
    to use if land masses weren’t split up into chunks and separated by wasted space.
    This is where projections come in. As their name implies, they’re used to project,
    or transform, locational data into a different coordinate system. These map projections
    use Cartesian coordinate systems, so locations are specified with x,y coordinate
    pairs based on two perpendicular axes, like scatterplots or line graphs. The tricky
    part is converting coordinates on a sphere to a two-dimensional plane.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们只讨论了三维椭球体，但大多数情况下你真正想要的是二维地图，因为它们对于大多数目的来说更方便。毕竟，很难将地球仪折叠起来放入口袋，或者将其嵌入书中！制图者如何从三维转换到二维？解决这个问题的方法之一是所谓的*中断地图*，就像图8.2中所示的那样。你可能以前见过这些，也许你甚至剪下过一张并弯曲纸张来制作一个地球仪。这有点酷，但在二维形式中，如果陆地不被分割成块并由浪费的空间隔开，地图将更容易使用。这就是投影的作用所在。正如其名所示，它们用于将位置数据投影或转换到不同的坐标系。这些地图投影使用笛卡尔坐标系，因此位置由基于两个垂直轴的x,y坐标对指定，就像散点图或线图。棘手的部分是将球体上的坐标转换为二维平面。
- en: Figure 8.2\. An interrupted map
  id: totrans-32
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.2. 一个中断地图
- en: '![](08fig02.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![图片](08fig02.jpg)'
- en: In fact, many ways to accomplish this exist, and they all have their own strengths
    and weaknesses. Think about stretching the different parts of the interrupted
    map shown in [figure 8.2](#ch08fig02) so that the map was a single rectangle with
    no cutouts. Geographic features would obviously get warped, especially near the
    poles where you had to stretch farther. No matter how you project geographic data
    to two dimensions, you’ll get distortion, but the type of distortion depends on
    how you do the conversion. Depending on what you plan to use the data for, some
    types of distortion may be acceptable while others won’t. [Figure 8.3](#ch08fig03)
    shows a couple of ways a piece of paper could be wrapped around a globe and used
    to convert the geographic data to 2D. Even with those methods shown here, the
    angle of the paper could be changed to get a different effect.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，存在许多实现这一目标的方法，它们都有各自的优点和缺点。想想将[图8.2](#ch08fig02)中显示的间断地图的不同部分拉伸，使地图成为一个没有缺口的单个矩形。地理特征显然会变形，尤其是在你必须拉伸得更远的极地附近。无论你如何将地理数据投影到二维，你都会得到扭曲，但扭曲的类型取决于你如何进行转换。根据你计划使用数据的目的，某些类型的扭曲可能是可接受的，而其他类型的则不可接受。[图8.3](#ch08fig03)展示了将一张纸围绕地球包裹并用于将地理数据转换为2D的几种方法。即使有这里展示的方法，纸张的角度也可以改变以获得不同的效果。
- en: Figure 8.3\. Two different ways that a piece of paper could be wrapped around
    a globe and used to project geographic data onto a two-dimensional surface. The
    example on the left is cylindrical, and the one on the right is conical.
  id: totrans-35
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.3\. 将一张纸围绕地球包裹的两种不同方式，可用于将地理数据投影到二维表面上。左侧的例子是圆柱形，右侧的例子是圆锥形。
- en: '![](08fig03.jpg)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![图8.3](08fig03.jpg)'
- en: Certain projections, called *conformal*, preserve local shapes. For example,
    the shape of Lake Titicaca on the border of Bolivia and Peru wouldn’t change between
    the globe and the 2D map. No mathematical trickery can preserve the shape of a
    large area, such as all of Eurasia, however. Mercator projections, including the
    Universal Transverse Mercator (UTM), are examples of conformal projections. Others,
    called *equal-area projections*, keep the amount of area the same, so the measured
    area of Greenland wouldn’t change, although the shape might. The Lambert equal-area
    and Gall-Peters projections are two examples of this. Equidistant projections,
    such as the Azimuthal equidistant, keep distances and scales the same, but only
    for a certain part of the map, such as the equator. The farther you get from this
    true line, the greater the distortion. [Figure 8.4](#ch08fig04) shows examples
    of different projections.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 某些投影，称为**正形投影**，可以保持局部形状。例如，玻利维亚和秘鲁边界的的的喀喀湖的形状在地球仪和二维地图之间不会改变。然而，没有任何数学技巧可以保持像整个欧亚大陆这样的大区域的形状。墨卡托投影，包括通用横轴墨卡托（UTM），是正形投影的例子。其他称为**等面积投影**的投影，保持面积相同，因此格陵兰岛的测量面积不会改变，尽管形状可能会变化。兰伯特等面积投影和加尔-彼得斯投影是这类投影的两个例子。等距投影，如方位等距投影，保持距离和比例尺相同，但仅适用于地图的某一部分，如赤道。你离这条真实线越远，扭曲就越大。[图8.4](#ch08fig04)展示了不同投影的示例。
- en: Figure 8.4\. Examples of different types of projections
  id: totrans-38
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.4\. 不同类型投影的示例
- en: '![](08fig04_alt.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![图8.4](08fig04_alt.jpg)'
- en: '|  |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Tip
  id: totrans-41
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 小贴士
- en: Several terms exist for data that use latitude and longitude coordinate values.
    You might see them referred to as having a geographic projection or see them called
    unprojected or geographic.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 存在多个术语用于使用经纬度坐标值的数据。你可能看到它们被称为具有地理投影，或者看到它们被称为未投影或地理数据。
- en: '|  |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Why should you care about all of these differences? Depending on your purposes,
    maybe you don’t. I doubt I’d be worried about it if I was making a map of the
    small town I live in. But if I was making a map of the state I live in, I might
    care if it looked short and fat or a little taller and skinnier, as shown in [figure
    8.5](#ch08fig05). What if you cared more about measurements and less about appearances?
    Let’s consider a dramatic example and think about what would happen if you needed
    to compare the amount of forested area in Columbia and Chile. Sticking with latitude
    and longitude wouldn’t work, because the lines of longitude converge at the poles,
    so one degree of longitude doesn’t represent a constant distance. In fact, one
    degree of longitude is equal to approximately 111 kilometers at the equator, but
    only about 79 km at a latitude of 45 degrees. Although latitude distance can vary
    slightly because the earth isn’t a perfect sphere, it’s generally around 111 kilometers
    per degree. Therefore, a square 100 km long on each side would measure about 0.8
    square degrees in Columbia, but closer to 0.5 square degrees at the southern tip
    of Chile. Using latitude and longitude to compare the amount of forested area
    in the two countries would obviously give inaccurate results. Instead, you’d want
    to choose an appropriate equal-area projection for this purpose.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 你为什么应该关心所有这些差异呢？根据你的目的，可能你并不关心。如果我要制作我居住的小镇地图，我可能不会担心这个问题。但如果我要制作我居住的州地图，我可能会关心它看起来是短而胖还是稍微高而瘦，如图8.5所示。如果你更关心测量而不是外观呢？让我们考虑一个戏剧性的例子，并思考如果你需要比较哥伦比亚和智利的森林面积会发生什么。坚持使用经纬度是不行的，因为经线在两极会聚，所以一度经线并不代表一个恒定的距离。实际上，一度经线在赤道上的长度大约是111公里，但在45度纬度上只有大约79公里。尽管由于地球不是完美的球体，纬度距离可能会有轻微的变化，但它通常在每度111公里左右。因此，每边100公里的正方形在哥伦比亚的测量值约为0.8平方度，但在智利南端则更接近0.5平方度。显然，使用经纬度来比较两个国家的森林面积会给出不准确的结果。相反，你可能会选择一个合适的等面积投影来完成这个目的。
- en: Figure 8.5\. The state of Utah shown using geographic (lat/lon) coordinates
    on the left and UTM Zone 12N on the right. Both examples use the NAD83 datum.
  id: totrans-45
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.5. 使用地理坐标（纬度/经度）在左侧显示犹他州的状态，右侧显示UTM区12N。两个示例都使用了NAD83基准。
- en: '![](08fig05.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![图片](08fig05.jpg)'
- en: Projections aren’t tied to specific datums, so knowing the projection of your
    data isn’t enough. You also need to know the datum, and it’s the combination of
    the two that defines the spatial reference system. For example, most of the data
    I get for Utah uses a UTM projection and the NAD83 datum, but I can’t safely assume
    that all UTM data I receive uses NAD83\. It could easily be NAD27 or WGS84 instead,
    so I don’t have a complete spatial reference system unless I know both the projection
    and the datum. If you don’t know both components, you might map your data in the
    wrong location. I’ve known people who unknowingly set their GPS to display coordinates
    in an unusual spatial reference system and then collected data by writing down
    the coordinates shown on their screen. Unfortunately, their data were then unusable
    because they didn’t know what spatial reference system the GPS had been set to
    display at the time. On the other hand, I also know people who lacked spatial
    reference information for their data, but fortunately the data were in a common
    system and they figured it out. If you’re collecting data, please simplify your
    life by paying attention to this crucial information at the beginning of the process,
    no matter how boring it might seem.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 投影与特定的基准无关，因此仅知道数据的投影是不够的。你还需要知道基准，这两个的结合定义了空间参考系统。例如，我得到的犹他州的大部分数据使用UTM投影和NAD83基准，但我不能安全地假设我收到的所有UTM数据都使用NAD83。它可能很容易是NAD27或WGS84，所以除非我知道投影和基准，否则我没有完整的空间参考系统。如果你不知道这两个组成部分，你可能会将数据映射到错误的位置。我认识一些人，他们无意中将他们的GPS设置为显示不寻常的空间参考系统坐标，然后通过写下屏幕上显示的坐标来收集数据。不幸的是，他们的数据因此变得不可用，因为他们不知道GPS当时被设置为显示哪个空间参考系统。另一方面，我也认识一些人，他们的数据缺乏空间参考信息，但幸运的是，数据在一个常见的系统中，他们找到了解决方案。如果你正在收集数据，请简化你的生活，在过程的开始就注意这个关键信息，无论它看起来多么无聊。
- en: '|  |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Tip
  id: totrans-49
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 小贴士
- en: If you collect geographic data, it’s crucial to know from the beginning what
    projection and datum your coordinates use. If you don’t pay attention to this,
    then your data may end up useless, and nobody wants that.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您收集地理数据，从开始就知道您的坐标使用什么投影和基准至关重要。如果您不重视这一点，那么您的数据可能最终变得无用，没有人希望这样。
- en: '|  |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 8.2\. Using spatial references with OSR
  id: totrans-52
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.2. 使用OSR进行空间参考
- en: Because spatial reference systems (SRSs) are so important, most vector data
    formats provide a way to store this information with the data, and you need to
    know how to work with it. When using spatial data, one common task is to convert
    the dataset from one spatial reference system to another so that it can be used
    with other datasets or for a particular analysis. The analysis techniques discussed
    in the last chapter, for example, only work if the geometries all use the same
    SRS. Another reason you might need to convert between SRSs is if you’re using
    an online mapping solution that requires a Web Mercator projection to display
    data.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 因为空间参考系统（SRS）非常重要，大多数矢量数据格式都提供了一种方法来存储与数据一起的信息，并且您需要知道如何处理它。在使用空间数据时，一个常见的任务是将数据集从一种空间参考系统转换为另一种，以便它可以与其他数据集一起使用或用于特定分析。例如，上一章中讨论的分析技术只有在几何体都使用相同的SRS时才有效。您可能需要在不同SRS之间转换的另一个原因是，如果您正在使用需要Web
    Mercator投影来显示数据的在线地图解决方案。
- en: '|  |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Warning
  id: totrans-55
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 警告
- en: Many GIS software packages will project on-the-fly, which means that they’ll
    automatically convert data to a different SRS when displaying it. For example,
    if you load in a dataset that uses an Albers equal-area projection, the map will
    be drawn using that projection. But if you then load a second file that uses UTM,
    it will be converted to Albers so it can be displayed correctly with the first.
    Of course, this only happens if both of the datasets have SRS information stored
    with them, because without that the software doesn’t know what to do. Also, this
    process only changes what’s in memory and doesn’t alter what’s stored on disk
    in any way. Although this behavior can be helpful when you’re using a GIS, sometimes
    it leads people to assume that datasets use the same SRS when in reality they
    don’t.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 许多GIS软件包会即时投影，这意味着它们在显示数据时会自动将数据转换为不同的SRS。例如，如果您加载了一个使用Albers等面积投影的数据集，地图将使用该投影绘制。但是，如果您随后加载第二个使用UTM的数据文件，它将被转换为Albers，以便可以正确地与第一个一起显示。当然，这仅发生在两个数据集都存储了SRS信息的情况下，因为没有这些信息，软件不知道该怎么做。此外，这个过程仅更改内存中的内容，不会以任何方式更改存储在磁盘上的内容。尽管这种行为在您使用GIS时可能很有帮助，但有时它会导致人们假设数据集使用相同的SRS，而实际上它们并不相同。
- en: '|  |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: The osgeo package contains a module called OSR (short for OGR Spatial Reference)
    that’s used to work with SRSs. This section will show you how to use OSR to assign
    SRS information to your data so that GIS software, including OSR, knows how to
    work with it. You’ll also learn how to convert data between different SRSs so
    that you can transform data to whichever SRS you need for a particular project.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '`osgeo`包包含一个名为OSR（OGR空间参考的简称）的模块，用于处理SRS。本节将向您展示如何使用OSR将SRS信息分配给您的数据，以便GIS软件（包括OSR）知道如何处理它。您还将学习如何在不同SRS之间转换数据，以便将数据转换为特定项目所需的任何SRS。'
- en: 8.2.1\. Spatial reference objects
  id: totrans-59
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.2.1. 空间参考对象
- en: To work with a spatial reference system, you need a `SpatialReference` object
    that represents it. If you already have a layer that uses the SRS you want, then
    you can get the SRS from it using the `GetSpatialRef` function. A similar function,
    `GetSpatial-Reference`, will get an SRS from a geometry. Both of these functions
    will return `None` if the layer or geometry doesn’t have an SRS stored with it.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 要与空间参考系统一起工作，你需要一个`SpatialReference`对象来表示它。如果你已经有一个使用你想要的SRS的图层，那么你可以使用`GetSpatialRef`函数从它那里获取SRS。一个类似的功能，`GetSpatial-Reference`，将从几何体中获取SRS。这两个函数如果图层或几何体没有存储SRS，都将返回`None`。
- en: 'Let’s look at the information contained in one of these SRS objects. Perhaps
    the easiest way is to print it out, which will display a nicely formatted description
    of the SRS in WKT format and doesn’t require the OSR module to be imported. The
    states_48 shapefile uses a geographic, or unprojected, coordinate system along
    with the North American Datum of 1983 (NAD83):'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看这些SRS对象中包含的信息。也许最简单的方法是将其打印出来，这将显示一个格式良好的SRS描述，以WKT格式呈现，并且不需要导入OSR模块。`states_48`形状文件使用地理坐标系统，或未投影坐标系统，以及1983年北美地理基准（NAD83）：
- en: '[PRE0]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: You can tell that this isn’t a projected SRS because it doesn’t have a `PROJCS`
    entry, only a `GEOGCS` one. If you were looking at a projected SRS, there would
    be more information describing the parameters of the coordinate system, such as
    the UTM example show in [figure 8.6](#ch08fig06).
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以判断这不是一个投影SRS，因为它没有`PROJCS`条目，只有一个`GEOGCS`条目。如果你在查看一个投影SRS，会有更多描述坐标系参数的信息，例如[图8.6](#ch08fig06)中显示的UTM示例。
- en: Figure 8.6\. Well-known text for the NAD83 UTM Zone 12N spatial reference system
  id: totrans-64
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.6\. NAD83 UTM Zone 12N空间参考系统的已知文本
- en: '![](08fig06.jpg)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](08fig06.jpg)'
- en: 'WKT isn’t the only string representation of an SRS. I like PROJ.4 strings because
    they’re especially concise. For example, this is the PROJ.4 string for the UTM
    SRS shown in [figure 8.6](#ch08fig06):'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: WKT并不是SRS的唯一字符串表示。我喜欢PROJ.4字符串，因为它们特别简洁。例如，这是[图8.6](#ch08fig06)中显示的UTM SRS的PROJ.4字符串：
- en: '[PRE1]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The PROJ.4 Cartographic Projections Library is a popular open source library
    for converting data between projections, and you can read about the details of
    PROJ.4 definitions at [http://trac.osgeo.org/proj/](http://trac.osgeo.org/proj/).
    See appendix D for other functions you can use to get text representations of
    spatial reference systems. (Appendixes C through E are available online on the
    Manning Publications website at [https://www.manning.com/books/geoprocessing-with-python](https://www.manning.com/books/geoprocessing-with-python).)
    Several of the results are wordy; try out `Export-ToXML` to see what I mean.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: The PROJ.4 Cartographic Projections Library是一个流行的开源库，用于在投影之间转换数据，你可以在[http://trac.osgeo.org/proj/](http://trac.osgeo.org/proj/)上阅读关于PROJ.4定义的详细信息。参见附录D，了解你可以使用的其他函数，以获取空间参考系统的文本表示。（附录C至E可在Manning
    Publications网站上在线获取，网址为[https://www.manning.com/books/geoprocessing-with-python](https://www.manning.com/books/geoprocessing-with-python)。）其中一些结果可能比较冗长；尝试使用`Export-ToXML`来了解我的意思。
- en: '|  |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Definition
  id: totrans-70
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 定义
- en: Spatial Reference System Identifiers (SRIDs) are used to uniquely identify each
    spatial reference system, datum, and several other related items within a GIS.
    The software can use its own set of IDs, or it can use a common set such as EPSG
    (short for European Petroleum Survey Group) codes. These are the `AUTHORITY` entries
    in the WKT examples.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 空间参考系统标识符（SRIDs）用于唯一标识GIS中的每个空间参考系统、基准以及几个其他相关项目。软件可以使用自己的ID集，也可以使用一个公共集，如EPSG（欧洲石油调查组）代码。这些是WKT示例中的`AUTHORITY`条目。
- en: '|  |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'Fortunately, you don’t have to print anything out to discover if an SRS is
    geographic or projected, because handy functions called `IsGeographic` and `IsProjected`
    can provide that information. You can also get other information about the SRS,
    although you do need to know the structure of an SRS to do so. Go back and look
    at the WKT in [figure 8.6](#ch08fig06). You can use the `GetAttrValue` function
    to get the text corresponding to the first occurrence of each keyword such as
    `PROJCS` or `DATUM`, where the keywords aren’t case-sensitive. Assuming that the
    `utm_sr` variable holds the SRS from [figure 8.6](#ch08fig06), you could get the
    projection name like this:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，你不需要打印任何东西来发现一个SRS是地理的还是有投影的，因为有两个方便的函数叫做`IsGeographic`和`IsProjected`可以提供这些信息。你也可以获取关于SRS的其他信息，尽管这样做你需要知道SRS的结构。回到[图8.6](#ch08fig06)查看WKT。你可以使用`GetAttrValue`函数来获取与每个关键词（如`PROJCS`或`DATUM`）第一次出现相对应的文本，其中关键词不区分大小写。假设`utm_sr`变量包含了[图8.6](#ch08fig06)中的SRS，你可以这样获取投影名称：
- en: '[PRE2]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Several `AUTHORITY` entries are in the UTM SRS. Which one do you think will
    be returned by `GetAttrValue`? Let’s try it and see:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在UTM SRS中有几个`AUTHORITY`条目。你认为`GetAttrValue`会返回哪一个？让我们试一试看看：
- en: '[PRE3]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'That didn’t tell you much, because the first value of each one happens to be
    `''EPSG''`. An optional parameter to `GetAttrValue` lets you specify which child
    you want returned using its index. The string `''EPSG''` is the first child, but
    the second is a number, so try getting it:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 这并没有告诉你太多，因为每个的第一个值恰好是`'EPSG'`。`GetAttrValue`的一个可选参数允许你指定使用其索引返回哪个子项。字符串`'EPSG'`是第一个子项，但第二个是一个数字，所以尝试获取它：
- en: '[PRE4]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Why did it get the last one shown in [figure 8.6](#ch08fig06) instead of the
    first? This is because items are nested inside each other in the SRS, and this
    one is the least nested, so it’s the first one returned by the function.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么它返回的是[图8.6](#ch08fig06)中显示的最后一个而不是第一个？这是因为项目在SRS中嵌套在一起，而这个项目是最少嵌套的，所以它是函数返回的第一个。
- en: 'If `GetAttrValue` only grabs the first item that appears with a given keyword,
    how do you get the others? To get authority codes, or SRIDs, pass the key for
    the SRID that you’re interested in to `GetAuthorityCode`:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`GetAttrValue`只获取带有给定关键字的第一个出现的项，那么如何获取其他项？要获取权威代码或SRID，将您感兴趣的SRID的关键字传递给`GetAuthorityCode`：
- en: '[PRE5]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'You can get values with a `PARAMETER` key using `GetProjParm`, which takes
    one of the `SRS_PP` constants from appendix D as an argument:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用`GetProjParm`并使用附录D中的`SRS_PP`常量之一作为参数来获取具有`PARAMETER`键的值：
- en: '[PRE6]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Many other functions are available for getting information from an SRS, several
    of which only apply to certain types of SRSs. See appendix D for a full list.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 许多其他函数可用于从SRS获取信息，其中一些仅适用于某些类型的SRS。请参阅附录D以获取完整列表。
- en: 8.2.2\. Creating spatial reference objects
  id: totrans-85
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.2.2。创建空间参考对象
- en: 'Because you can’t always get an appropriate spatial reference object from a
    layer or geometry, you may need to create your own. Because I like short representations,
    my two favorite ways to do this are to use a standard EPSG code if it exists for
    the SRS I want to use, or a PROJ.4 string. As you saw with the UTM example, the
    EPSG code for NAD83 UTM 12N is 26912, which you can pass to the `ImportFromEPSG`
    function after importing OGR and creating a blank `SpatialReference` object:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 由于您不能总是从图层或几何体中获得适当的空间参考对象，您可能需要创建自己的。因为我喜欢简短的表达方式，我最喜欢的两种方法是：如果存在我想要使用的SRS的标准EPSG代码，就使用它；或者使用PROJ.4字符串。正如您在UTM示例中看到的，NAD83
    UTM 12N的EPSG代码是26912，您可以在导入OGR并创建一个空的`SpatialReference`对象后将其传递给`ImportFromEPSG`函数：
- en: '[PRE7]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The SRS you create is equivalent to the UTM example from earlier. The zero
    returned by `ImportFromEPSG` means that the SRS was imported successfully. Interestingly,
    watch what happens if you use the PROJ.4 string you saw earlier:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 您创建的SRS与之前提到的UTM示例等效。`ImportFromEPSG`返回的零表示SRS已成功导入。有趣的是，如果您使用之前看到的PROJ.4字符串：
- en: '[PRE8]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The datum name is no longer part of the SRS name because the datum wasn’t specified
    in the PROJ.4 string. However, the GRS80 ellipsoid used by the NAD83 datum was
    part of the string, so the required information is still there (if you want to
    prove it to yourself, print the WKT and compare the `SPHEROID` values to the ones
    from [figure 8.6](#ch08fig06)). To include the datum, add `+datum=NAD83` to the
    PROJ.4 representation.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 基准名称不再是SRS名称的一部分，因为基准在PROJ.4字符串中未指定。然而，NAD83基准使用的GRS80椭球体是字符串的一部分，因此所需信息仍然存在（如果您想证明这一点，请打印WKT并比较`SPHEROID`值与[图8.6](#ch08fig06)中的值）。要包含基准，请将`+datum=NAD83`添加到PROJ.4表示中。
- en: '|  |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Tip
  id: totrans-92
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 小贴士
- en: You can look up EPSG codes, WKT, PROJ.4 strings, and several other representations
    of SRSs, at [www.spatialreference.org](http://www.spatialreference.org).
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在[www.spatialreference.org](http://www.spatialreference.org)查找EPSG代码、WKT、PROJ.4字符串以及SRS的几种其他表示形式。
- en: '|  |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 'Several different functions for exporting SRS information exist, and so do
    multiple methods for importing this information into a spatial reference object,
    including one to import information from a URL such as a definition on [www.spatialreference.org](http://www.spatialreference.org)
    (again, see appendix D). You can also create a spatial reference object from a
    WKT string without having to use one of the importer functions:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 存在多种不同的函数用于导出SRS信息，同样也有多种方法可以将这些信息导入到空间参考对象中，包括从诸如[www.spatialreference.org](http://www.spatialreference.org)（再次，见附录D）上的定义等URL导入信息。您还可以从WKT字符串创建空间参考对象，而无需使用导入函数之一：
- en: '[PRE9]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'You can also build a spatial reference object yourself, and several projection-specific
    functions can help you with this. Let’s branch out from UTM and build the Albers
    Conic Equal Area SRS that the United States Geological Survey uses for the lower
    48 states ([figure 8.7](#ch08fig07)). The projection-specific function for Albers
    looks like this:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 您也可以自己构建空间参考对象，并且有几个特定于投影的函数可以帮助您完成这项工作。让我们从UTM扩展到构建美国地质调查局用于下48个州的Albers圆锥等面积SRS（[图8.7](#ch08fig07)）。Albers的特定投影函数如下所示：
- en: '[PRE10]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Figure 8.7\. The lower 48 states are shown using geographic coordinates and
    an Albers equal-area projection.
  id: totrans-99
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.7。使用地理坐标和Albers等面积投影显示了下48个州。
- en: '![](08fig07_alt.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![08fig07_alt.jpg](08fig07_alt.jpg)'
- en: 'The parameters are standard parallel 1, standard parallel 2, latitude of center,
    longitude of center, false easting, and false northing, in that order. You could
    use this to build the USGS Albers spatial reference:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 参数顺序为标准平行1、标准平行2、中心纬度、中心经度、虚假东西向和虚假南北向。您可以使用此方法构建USGS Albers空间参考：
- en: '[PRE11]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The first thing you do after creating an empty SRS is set a name for it, then
    specify a datum, and last you provide the required parameters for the Albers projection.
    The call to `Fixup` adds default values for missing parameters and reorders items
    so that they match the standard. The last thing you need to do is call `Validate`
    to make sure that you didn’t forget anything. In this case, `Validate` returns
    a zero, which means everything is fine (in fact, many of the other functions in
    this example also returned zero, but I cut the returned values out of the examples
    in the interest of space). Try leaving out the datum and see what happens when
    you call `Validate`. In that case, it should return 5, which means that the SRS
    is corrupt. This is because an SRS needs either a datum or a spheroid, neither
    of which is specified if you leave out the call to `SetWellKnownGeogCS`. If you
    turn on exception handling with `osr.UseExceptions (True)` then `Validate` will
    throw an exception instead of return a number.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个空的SRS后，你首先需要给它设置一个名称，然后指定一个基准，最后提供Albers投影所需的相关参数。调用`Fixup`会为缺失的参数添加默认值，并重新排序项目以匹配标准。最后，你需要调用`Validate`来确保你没有忘记任何东西。在这种情况下，`Validate`返回零，这意味着一切正常（实际上，这个例子中的许多其他函数也返回了零，但我出于空间考虑省略了返回值）。尝试省略基准并查看调用`Validate`时会发生什么。在这种情况下，它应该返回5，这意味着SRS已损坏。这是因为SRS需要一个基准或椭球体，如果你省略了`SetWellKnownGeogCS`的调用，这两个都没有指定。如果你通过`osr.UseExceptions
    (True)`打开异常处理，那么`Validate`将抛出一个异常而不是返回一个数字。
- en: 8.2.3\. Assigning an SRS to data
  id: totrans-104
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.2.3\. 将SRS分配给数据
- en: It’s a good idea to attach SRS information to your dataset whenever possible,
    so that you always know what coordinate system it uses. You can assign an SRS
    to layers and individual geometries, although all geometries in a layer share
    the same SRS. A data source can’t be assigned an SRS because individual layers
    are allowed to have different spatial reference systems.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在可能的情况下，将SRS信息附加到你的数据集上是个好主意，这样你总是知道它使用的是哪种坐标系。你可以将SRS分配给图层和单个几何形状，尽管图层中的所有几何形状共享相同的SRS。数据源不能分配SRS，因为单个图层允许有不同的空间参考系统。
- en: Do you remember when you created new layers in [chapter 3](kindle_split_011.html#ch03)?
    One of the parameters for the `CreateLayer` function was a spatial reference object.
    The default value for this parameter is `None`, because OGR can’t figure out what
    SRS the data use on its own. If you have a spatial reference object, you need
    to provide it when you create a new layer because you have no function to add
    an SRS to an existing layer.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 你还记得你在[第3章](kindle_split_011.html#ch03)中创建新图层的时候吗？`CreateLayer`函数的一个参数是空间参考对象。这个参数的默认值是`None`，因为OGR无法自己确定数据使用的是哪种SRS。如果你有一个空间参考对象，你需要在创建新图层时提供它，因为你没有添加SRS到现有图层的函数。
- en: '![](164fig01_alt.jpg)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![图片](164fig01_alt.jpg)'
- en: Now the new counties shapefile and all of the geometries contained in it will
    know that they use a UTM SRS (EPSG 26912). Of course, you must create the geometries
    using UTM coordinates. Assigning an SRS to a layer doesn’t magically convert all
    of the data to that coordinate system. All it does is provide information, so
    if you assign a different SRS than you’re using, you’re basically lying and causing
    confusion because nothing will know how to work with the data.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，新的县形状文件以及其中包含的所有几何形状都将知道它们使用的是UTM SRS（EPSG 26912）。当然，你必须使用UTM坐标创建几何形状。将SRS分配给图层并不会神奇地将所有数据转换为该坐标系。它只是提供信息，所以如果你分配了一个不同于你使用的SRS，你基本上是在撒谎并造成混淆，因为没有人知道如何处理这些数据。
- en: 'If you’re working with individual geometries instead of layers, you might want
    to assign an SRS to a geometry. You can do this with the `AssignSpatialReference`
    method:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在处理单个几何形状而不是图层，你可能想要为一个几何形状分配一个SRS。你可以使用`AssignSpatialReference`方法来完成这个操作：
- en: '[PRE12]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Again, this doesn’t force the geometry to use the assigned spatial reference,
    but instead provides information about the SRS, whether right or wrong.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 再次强调，这并不强迫几何形状使用分配的空间参考，而是提供了关于SRS的信息，无论是对是错。
- en: 8.2.4\. Reprojecting geometries
  id: totrans-112
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.2.4\. 几何形状的重投影
- en: If you need your data to use a different SRS than the one they’re already using,
    you’ll need to reproject them to the new SRS. I have to do this most commonly
    when I get a new dataset from somewhere but it doesn’t use the SRS that I usually
    use. If I want to use the new data with my existing files, I need to project it
    so that the SRSs match. I’ve also needed to do this recently when using software
    that required data to use Web Mercator but my originals used UTM.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要你的数据使用与它们当前使用的不同SRS（空间参考系统），你需要将它们重新投影到新的SRS。我通常在从某处获得新的数据集但该数据集不使用我通常使用的SRS时这样做。如果我想使用新数据与现有文件一起使用，我需要将其投影，以便SRSs匹配。最近在使用需要使用Web
    Mercator坐标系的软件时，我也需要这样做，但我的原始数据使用的是UTM。
- en: You have two different ways of projecting a geometry. One assumes that the geometry
    already has an SRS assigned to it, and the other doesn’t. We’ll look at them both,
    but first let’s get data to work with. This book’s data has a shapefile called
    ne_110m_land_1p.shp that contains the world’s landmasses as one multipolygon,
    and the ospybook module has a function called `get_shp_geom` that pulls the first
    geometry out of a shapefile. You can use these to get the global multipolygon,
    and for good measure, why don’t you also create a point containing the latitude
    and longitude of the Eiffel Tower?
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 你有两种不同的方式来投影一个几何形状。一种假设几何形状已经分配了一个SRS，另一种则没有。我们将探讨这两种方法，但首先让我们获取一些可以工作的数据。这本书的数据有一个名为ne_110m_land_1p.shp的shapefile，它包含一个多边形，表示世界陆地，而ospybook模块有一个名为`get_shp_geom`的函数，可以从shapefile中提取第一个几何形状。你可以使用这些来获取全球多边形，为了保险起见，为什么不也创建一个包含埃菲尔铁塔经纬度的点呢？
- en: '![](164fig02_alt.jpg)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![图片](164fig02_alt.jpg)'
- en: Because WGS84 is so common, the OSR module has a constant that contains the
    WKT for that geographic coordinate system, which you use here to add an SRS to
    the `tower` geometry. The `world` geometry also has a WGS84 SRS associated with
    it because the shapefile it came from does. If you plot the multipolygon, you
    should see something similar to [figure 8.8](#ch08fig08).
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 由于WGS84非常常见，OSR模块有一个包含该地理坐标系统WKT（Well-Known Text）的常量，你在这里使用它来向`tower`几何形状添加SRS。`world`几何形状也与WGS84
    SRS相关联，因为来自shapefile的它。如果你绘制多边形，你应该看到类似于[图8.8](#ch08fig08)的东西。
- en: Figure 8.8\. The world’s landmasses plotted with geographic coordinates
  id: totrans-117
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.8. 使用地理坐标绘制的世界陆地
- en: '![](08fig08.jpg)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![图片](08fig08.jpg)'
- en: 'Because both geometries know their SRS, you can reproject them using their
    `TransformTo` function, where you only need to provide the target SRS. We’ll use
    this to transform them both to a Web Mercator projection. Certain points, such
    as the North and South poles, can’t always be successfully reprojected, however.
    This is the case when transforming the `world` geometry to Web Mercator, so you
    also need to use the built-in module to set an environment variable telling it
    that it’s okay to skip those points. Without that, the world geometry won’t be
    successfully transformed, and you’ll get an error message that says “ERROR 1:
    Full reprojection failed, but partial is possible if you define OGR_ENABLE_PARTIAL_REPROJECTION
    configuration option to TRUE.” You can fix this by importing the `gdal` module
    and using its `SetConfigOption` method:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 因为两个几何形状都知道它们的SRS，你可以使用它们的`TransformTo`函数重新投影它们，你只需要提供目标SRS。我们将使用这个方法将它们都转换成Web
    Mercator投影。然而，某些点，如北极和南极，可能无法成功重新投影。当将`world`几何形状转换为Web Mercator时就是这种情况，因此你还需要使用内置模块设置一个环境变量，告诉它跳过这些点是可以的。如果没有这个，世界几何形状将无法成功转换，你将得到一个错误消息，说“ERROR
    1：完全重新投影失败，但如果定义OGR_ENABLE_PARTIAL_REPROJECTION配置选项为TRUE，则部分重新投影是可能的。”你可以通过导入`gdal`模块并使用其`SetConfigOption`方法来修复这个问题：
- en: '![](165fig01_alt.jpg)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![图片](165fig01_alt.jpg)'
- en: As you can see, the coordinates for the Eiffel Tower no longer fall in the range
    for latitude and longitude values, and the world geometry should look like [figure
    8.9](#ch08fig09) when plotted. Notice also that the world and tower geometries
    themselves were changed instead of returning new geometries, which is different
    behavior than many other functions we’ve looked at.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，埃菲尔铁塔的坐标不再在经纬度值范围内，当绘制时，世界几何形状应该看起来像[图8.9](#ch08fig09)。注意，世界和铁塔几何形状本身被更改，而不是返回新的几何形状，这与我们之前查看的许多其他函数的行为不同。
- en: Figure 8.9\. The world’s landmasses plotted with Web Mercator coordinates
  id: totrans-122
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.9. 使用Web Mercator坐标绘制的世界陆地
- en: '![](08fig09.jpg)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![图片](08fig09.jpg)'
- en: 'If you use `TransformTo` on a geometry that doesn’t have an SRS assigned to
    it, it won’t change and you’ll get an error code of 6\. You can still transform
    it provided that you know what its SRS is, however. To do this, you need a `CoordinateTransformation`
    object, which you can create using a source and a target spatial reference. For
    example, let’s pretend that the `world` geometry doesn’t have spatial reference
    data and use this technique to convert it from Web Mercator to Gall-Peters. This
    time you’ll use the `Transform` function, which requires a `CoordinateTransformation`
    object:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在一个没有分配空间参考（SRS）的几何体上使用`TransformTo`，它将不会改变，并且你会得到一个错误代码6。然而，如果你知道它的SRS，你仍然可以转换它。为此，你需要一个`CoordinateTransformation`对象，你可以通过使用源和目标空间参考来创建它。例如，让我们假设`world`几何体没有空间参考数据，并使用这种技术将其从Web
    Mercator转换为Gall-Peters。这次你将使用`Transform`函数，它需要一个`CoordinateTransformation`对象：
- en: '[PRE13]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Now your plot should look like [figure 8.10](#ch08fig10). If you wanted to reverse
    this and go from Gall-Peters to Web Mercator, you’d switch the order of the arguments
    when creating the coordinate transformation.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你的图表应该看起来像[图8.10](#ch08fig10)。如果你想要反向操作，从Gall-Peters转换到Web Mercator，你需要在创建坐标转换时交换参数的顺序。
- en: Figure 8.10\. The world’s landmasses plotted with Gall-Peters coordinates
  id: totrans-127
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.10.使用Gall-Peters坐标绘制的世界陆地
- en: '![](08fig10.jpg)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![](08fig10.jpg)'
- en: Changing datums
  id: totrans-129
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 更改基准
- en: Sometimes you’ll also need to change the datum that your dataset uses. For example,
    sometimes I’m given data that uses the NAD27 datum, which I then need to convert
    to NAD83 so that it matches the rest of my data. The `TransformTo` and `Transform`
    functions will convert between datums if the necessary information is present.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 有时你可能还需要更改数据集使用的基准数据。例如，有时我会收到使用NAD27基准数据的资料，然后我需要将其转换为NAD83，以便与我的其他数据匹配。如果存在必要的信息，`TransformTo`和`Transform`函数可以在基准之间进行转换。
- en: Because mathematical equations to convert between datums don’t always exist,
    many times GIS uses data files called *grid shift files* to help with the conversion.
    These contain the information needed to accurately transform coordinates from
    one datum to another. The OSR module will use the appropriate files for datum
    transformations if it can find them on your system, although you must make sure
    that both your source and target spatial references contain datum information.
    [Figure 8.11](#ch08fig11) shows an example of two spatial references that use
    the same projection and ellipsoid, but one has a datum included and the other
    doesn’t. Although both are valid spatial references, only the one with the datum
    will work for datum transformations. See appendix D for more information about
    making grid shift files available to OSR.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 由于并非总是存在用于在基准之间进行转换的数学方程，因此GIS经常使用称为*网格偏移文件*的数据文件来帮助转换。这些文件包含将坐标从一个基准准确转换到另一个基准所需的信息。如果OSR模块能在你的系统上找到它们，它将使用适当的文件进行基准转换。不过，你必须确保你的源和目标空间参考都包含基准信息。[图8.11](#ch08fig11)展示了两个使用相同投影和椭球体的空间参考示例，但其中一个包含基准信息，而另一个则没有。尽管两者都是有效的空间参考，但只有包含基准的那个才能用于基准转换。有关将网格偏移文件提供给OSR的更多信息，请参阅附录D。
- en: Figure 8.11\. Examples of two spatial references that use the same spheroid,
    but only one has the datum specified
  id: totrans-132
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.11.使用相同椭球体但只有一个指定基准的两个空间参考示例
- en: '![](08fig11_alt.jpg)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](08fig11_alt.jpg)'
- en: 'If you don’t have the appropriate grid shift files for your datum transformation,
    you can set the `towgs84` parameters for your source and target spatial references.
    These parameters describe an approximate transformation from a particular datum
    to the WGS84 datum. If you don’t know the parameters that you need, you can look
    them up at [www.epsg-registry.org](http://www.epsg-registry.org). Make sure you
    set the search type to Coordinate Transformation, select a geographic area, and
    enter the name of the datum you’re interested in. I searched for *nad27* in the
    United States, and then selected the *NAD27 to WGS 84 (4)* result because it was
    described as being appropriate for the lower 48 states. This gave me x, y, and
    z translation values equal to -8, 160, and 176, respectively. Once you have the
    appropriate parameters, you can use `SetTOWGS84` to add them to your SRS:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你没有用于数据转换的适当网格偏移文件，你可以为源和目标空间参考设置`towgs84`参数。这些参数描述了从特定基准到WGS84基准的大致转换。如果你不知道你需要哪些参数，你可以在[www.epsg-registry.org](http://www.epsg-registry.org)上查找。确保你将搜索类型设置为坐标转换，选择一个地理区域，并输入你感兴趣的基准名称。我在美国搜索了*nad27*，然后选择了*nad27
    to WGS 84 (4)*结果，因为它被描述为适用于下48个州。这给了我x，y和z平移值分别为-8，160和176。一旦你有了适当的参数，你可以使用`SetTOWGS84`将它们添加到你的空间参考中：
- en: '[PRE14]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: It’s easier to rely on grid shift files if you can get them, however.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你能获取到网格偏移文件，那么依赖网格偏移文件会更容易。
- en: 8.2.5\. Reprojecting an entire layer
  id: totrans-137
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.2.5\. 重新投影整个层
- en: No function exists for projecting an entire layer at once, but it’s not hard
    to do. After creating the new layer, you need to loop through each of the features
    in the original layer, get the geometry and transform it, and then insert a feature
    containing the transformed geometry into the new layer. Chances are, you’ll also
    want to keep all of the attribute fields, so you’ll need to copy the field definitions
    from the original layer when creating the new one. The following listing shows
    a simple example of this that assumes the new layer doesn’t already exist and
    that the layer being reprojected contains point geometries.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 目前还没有一个函数可以一次性投影整个层，但这并不难做。在创建新层之后，你需要遍历原始层中的每个要素，获取几何形状并进行转换，然后将包含转换几何形状的要素插入到新层中。很可能，你也会想要保留所有的属性字段，因此你需要在创建新层时复制原始层的字段定义。以下列表展示了这样一个简单示例，它假设新层尚不存在，并且正在重新投影的层包含点几何形状。
- en: Listing 8.1\. Projecting a point layer
  id: totrans-139
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.1\. 投影点层
- en: '![](168fig01_alt.jpg)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![168fig01_alt.jpg](168fig01_alt.jpg)'
- en: The first thing the code in this listing does is create an output spatial reference.
    Then it opens a data source for writing and gets the existing layer to reproject.
    Next, a new layer is created and the field definitions are copied from the input
    layer to the output layer. If you don’t do this, then you can’t copy attribute
    values into the new layer. After the new layer is ready to go, then you loop through
    each of the features in the original layer, and for each one you get its geometry
    and transform it using the spatial reference created at the beginning of the listing.
    Notice that you don’t provide an input spatial reference and instead are assume
    that the input layer has an SRS associated with it. After transforming the geometry,
    you add it to a new feature, copy all of the attribute values to this feature,
    and then use it to insert the data into the new layer.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 列表中这段代码首先创建一个输出空间参考。然后它打开一个用于写入的数据源，并获取现有层以进行重新投影。接下来，创建一个新层，并将输入层的字段定义复制到输出层。如果你不这样做，那么你无法将属性值复制到新层中。新层准备就绪后，然后遍历原始层中的每个要素，并为每个要素获取其几何形状，使用列表开头创建的空间参考进行转换。请注意，你没有提供输入空间参考，而是假设输入层与其关联了一个空间参考。在转换几何形状后，你将其添加到一个新要素中，将所有属性值复制到这个要素中，然后使用它将数据插入到新层中。
- en: 8.3\. Using spatial references with pyproj
  id: totrans-142
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.3\. 在pyproj中使用空间参考
- en: As briefly mentioned earlier, the PROJ.4 Cartographic Projections Library is
    a C library for converting data between SRSs. It’s used by a variety of open source
    projects, including OSR. You don’t need to install all of GDAL and OGR in order
    to take advantage of PROJ.4 with Python, however, because the pyproj module provides
    a Python wrapper for PROJ.4\. Instead of working with geometries, like OSR does,
    this module works with lists of coordinate values, which can be provided as Python
    lists, tuples, arrays, NumPy arrays, or scalars (NumPy is a Python module designed
    to work with large arrays, and you’ll learn more about it in [chapter 11](kindle_split_019.html#ch11)).
    If you had a collection of coordinates in a text file, the functions contained
    in the pyproj module would be an ideal way to convert them to other coordinate
    systems.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，PROJ.4 地图投影库是一个用于在 SRS 之间转换数据的 C 库。它被包括 OSR 在内的各种开源项目使用。然而，您不需要安装 GDAL
    和 OGR 的所有内容来利用 Python 中的 PROJ.4，因为 pyproj 模块为 PROJ.4 提供了一个 Python 包装器。与 OSR 一样，这个模块不是处理几何形状，而是处理坐标值的列表，这些坐标值可以作为
    Python 列表、元组、数组、NumPy 数组或标量（NumPy 是一个用于处理大型数组的 Python 模块，您将在第 11 章中了解更多关于它的信息）提供。如果您有一组坐标在文本文件中，pyproj
    模块中的函数将是一个将它们转换为其他坐标系统的理想方式。
- en: '|  |'
  id: totrans-144
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Tip
  id: totrans-145
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 提示
- en: You can find online documentation and downloads for the pyproj module at [https://code.google.com/p/pyproj/](https://code.google.com/p/pyproj/).
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在 [https://code.google.com/p/pyproj/](https://code.google.com/p/pyproj/)
    找到 pyproj 模块的在线文档和下载。
- en: '|  |'
  id: totrans-147
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 8.3.1\. Transforming coordinates between spatial reference systems
  id: totrans-148
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.3.1\. 在空间参考系统之间转换坐标
- en: 'There are a couple of different ways to convert coordinates between spatial
    reference systems using pyproj. You can use the `Proj` class to convert between
    geographic and projected coordinates or the module-level `transform` function
    to convert between two spatial reference systems. Let’s start with converting
    the Eiffel Tower coordinates from latitude and longitude to UTM Zone 31N. The
    first thing to do is initialize a `Proj` object with the UTM spatial reference
    system using a PROJ.4 string, and then use that to transform the coordinates.
    The syntax might look a bit odd to you, because you don’t need to call a specific
    function on the `Proj` object to do the conversion:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 pyproj 在空间参考系统之间转换坐标有几种不同的方法。您可以使用 `Proj` 类在地理坐标和投影坐标之间进行转换，或者使用模块级别的 `transform`
    函数在两个空间参考系统之间进行转换。让我们从将埃菲尔铁塔的坐标从纬度和经度转换为 UTM 区 31N 开始。首先需要做的是使用 PROJ.4 字符串初始化一个
    `Proj` 对象，并指定 UTM 空间参考系统，然后使用它来转换坐标。语法可能看起来有点奇怪，因为您不需要在 `Proj` 对象上调用特定的函数来完成转换：
- en: '![](169fig01_alt.jpg)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![](169fig01_alt.jpg)'
- en: Here you pass a single x and single y coordinate to `utm_proj`, and in return
    it gives you one x and one y. You could also pass in a list of x values and a
    list of y values (where `x[i]` and `y[i]` are a coordinate pair), and then you’d
    get two lists in return.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，您向 `utm_proj` 传递单个 x 和单个 y 坐标，然后它返回一个 x 和一个 y。您也可以传递 x 值的列表和 y 值的列表（其中 `x[i]`
    和 `y[i]` 是一个坐标对），然后您将返回两个列表。
- en: 'To go the other direction, from projected to geographic coordinates, set the
    optional `inverse` parameter to `True` and pass in the UTM coordinates. If you
    use the UTM coordinates just calculated, you’ll get the original latitude and
    longitude values, except with a slight bit of rounding error:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 要进行相反方向的转换，即从投影坐标到地理坐标，将可选的 `inverse` 参数设置为 `True` 并传入 UTM 坐标。如果您使用刚刚计算出的 UTM
    坐标，您将得到原始的纬度和经度值，但会有轻微的四舍五入误差：
- en: '[PRE15]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '|  |'
  id: totrans-154
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**Initializing Proj objects**'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '**初始化 Proj 对象**'
- en: 'You can initialize `Proj` objects using PROJ.4 strings, arguments corresponding
    to the parameters in the PROJ.4 string, or with an EPSG code. For example, these
    are all equivalent:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用 PROJ.4 字符串、与 PROJ.4 字符串中的参数相对应的参数或 EPSG 代码来初始化 `Proj` 对象。例如，这些都是等效的：
- en: '[PRE16]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '|  |'
  id: totrans-158
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'If you need to convert between two projected coordinate systems, then it’s
    easiest to use the pyproj `transform` function instead. In addition, you’re required
    to use `transform` if you want to convert between datums. Let’s use UTM coordinates
    for the Statue of Liberty in New York City to compare the difference between the
    WGS84 and NAD27 datums. The `transform` function takes four required parameters:
    source SRS, target SRS, x, and y, where the spatial reference information is contained
    in `Proj` objects. This example converts coordinates from the WGS84 datum to NAD27\.
    Both sets of coordinates use the UTM Zone 18N projection.'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要在不同投影坐标系统之间进行转换，那么使用pyproj的`transform`函数会更容易。此外，如果你想在大地基准之间进行转换，也必须使用`transform`。让我们使用纽约市自由女神像的UTM坐标来比较WGS84和NAD27大地基准之间的差异。`transform`函数需要四个必需参数：源SRS、目标SRS、x和y，其中空间参考信息包含在`Proj`对象中。此示例将坐标从WGS84大地基准转换为NAD27。这两组坐标都使用UTM
    Zone 18N投影。
- en: '![](170fig01_alt.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![图片](170fig01_alt.jpg)'
- en: Comparing the input and output numbers, it looks like the two datums differ
    by 30 meters or so in the east/west direction, but the north/south difference
    is over 200 meters, at least in New York City. As shown in [figure 8.12](#ch08fig12),
    using the NAD27 coordinates as if they were WGS84 puts the Statue of Liberty in
    the water rather than on Liberty Island.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 比较输入和输出数字，看起来这两个大地基准在东西方向上相差大约30米，但在纽约市，南北方向的差异超过200米。如图[图8.12](#ch08fig12)所示，如果将NAD27坐标当作WGS84坐标使用，自由女神像就会被放在水中而不是在自由岛上。
- en: Figure 8.12\. The black dot shows where NAD27 coordinates would place the Statue
    of Liberty if they were treated as if they were WGS84.
  id: totrans-162
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.12\. 黑色圆点显示了如果将NAD27坐标当作WGS84坐标处理，自由女神像将被放置的位置。
- en: '![](08fig12.jpg)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![图片](08fig12.jpg)'
- en: This example is a good illustration of why you should always know your datum.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 这个例子很好地说明了为什么你应该始终了解你的大地基准。
- en: 8.3.2\. Great-circle calculations
  id: totrans-165
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.3.2\. 大圆计算
- en: 'The shortest distance between two points on the globe is called the *great-circle
    distance*. Because travelers don’t like to travel farther than necessary, these
    have been important for navigation for centuries. You can use pyproj to get this
    distance between two sets of latitude and longitude coordinates, along with the
    starting and ending bearings of the great-circle line between them. To illustrate
    how this is done, let’s look at the distance between Los Angeles and Berlin ([figure
    8.13](#ch08fig13)). The first thing you need to do is instantiate an object of
    the `Geod` class with the ellipsoid you want to use. A list of options is available
    on the pyproj website mentioned earlier. Once you have the `Geod`, pass the starting
    and ending coordinates in decimal degrees to its `inv` function in order to get
    the forward bearing, backward bearing, and distance:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 地球上两点之间的最短距离被称为**大圆距离**。由于旅行者不喜欢走不必要的远路，这些距离在几个世纪以来对导航一直很重要。你可以使用pyproj来获取两组经纬度坐标之间的距离，以及它们之间大圆线的起始和终止方位角。为了说明如何做到这一点，让我们看看洛杉矶和柏林之间的距离（[图8.13](#ch08fig13)）。你需要做的第一件事是实例化一个`Geod`类的对象，并指定你想要使用的椭球体。有关可选列表，请参阅前面提到的pyproj网站。一旦你有了`Geod`对象，将起始和结束坐标以十进制度数传递给它的`inv`函数，以获取正向方位角、反向方位角和距离：
- en: '[PRE17]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Figure 8.13\. The great-circle path between Los Angeles and Berlin
  id: totrans-168
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.13\. 洛杉矶和柏林之间的大圆路径
- en: '![](08fig13.jpg)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![图片](08fig13.jpg)'
- en: What exactly do these results mean? If you were to head out from Los Angeles
    (the first set of coordinates passed to `inv`) at a bearing of 27.2328 degrees
    and travel 9,331,935 meters, you’d find yourself in Berlin. Or if you wanted to
    travel the other way, leave Berlin at a bearing of -38.4915° and travel the same
    distance to arrive in Los Angeles.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 这些结果究竟意味着什么？如果你从洛杉矶（传递给`inv`的第一个坐标集）出发，以27.2328度的方位角前进，旅行9,331,935米，你会发现自己到了柏林。或者，如果你想反方向旅行，从柏林以-38.4915°的方位角出发，走同样的距离，你将到达洛杉矶。
- en: 'You can also find out where you’d end up if you followed a bearing for a certain
    distance. To do this, pass the starting coordinates, bearing, and distance in
    meters to the `fwd` function. This will return the ending longitude, latitude,
    and bearing back to where you came from. For example, if you plug in the Berlin
    coordinates, backward bearing, and distance you got a minute ago, it should spit
    out the coordinates for Los Angeles along with the bearing from LA to Berlin:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以找出如果你沿着某个方位角走一段距离，最终会到达哪里。为此，将起始坐标、方位角和以米为单位距离传递给 `fwd` 函数。这将返回结束时的经度、纬度和返回起点的方位角。例如，如果你输入柏林的坐标、反向方位角和刚才得到的距离，它应该会输出洛杉矶的坐标，以及从洛杉矶到柏林的方位角：
- en: '[PRE18]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'You can also get a list of equally spaced coordinates along the great-circle
    line by passing starting and ending coordinates and the number of desired points
    to the `npts` function:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以通过传递起始和结束坐标以及所需点的数量给 `npts` 函数，来获取大圆线上等间距坐标的列表：
- en: '[PRE19]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: I used the `npts` function to generate the points used to draw the great circle
    path between Los Angeles and Berlin in [figure 8.13](#ch08fig13).
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 我使用 `npts` 函数生成了用于绘制洛杉矶和柏林之间大圆路径的点，这些点在[图8.13](#ch08fig13)中展示。
- en: 8.4\. Summary
  id: totrans-176
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.4. 摘要
- en: Several main types of map projections exist, and each is used to preserve a
    specific property of the data. Make sure you choose a projection appropriate for
    your use.
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存在几种主要的地图投影类型，每种都用于保留数据的一个特定属性。确保你选择一个适合你使用的投影。
- en: Always make sure you know both the projection and datum of your datasets.
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 总是要确保你知道你的数据集的投影和基准。
- en: You can’t transform data to another spatial reference system if you don’t know
    the one it currently uses.
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你不知道当前使用的是哪个空间参考系统，你不能将数据转换到另一个空间参考系统。
- en: You can use either OSR or pyproj to transform data between spatial reference
    systems.
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以使用 OSR 或 pyproj 在空间参考系统之间转换数据。
- en: Use pyproj for great-circle calculations.
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 pyproj 进行大圆计算。
