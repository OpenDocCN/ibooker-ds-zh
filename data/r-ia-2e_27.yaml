- en: 22 Creating a package
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 22 创建软件包
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Creating the functions for a package
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建软件包的函数
- en: Adding package documentation
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加软件包文档
- en: Building the package and sharing it with others
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建软件包并与他人共享
- en: In previous chapters, you completed most tasks by using functions that were
    provided by others. The functions came from packages in the base R installation
    or from contributed packages downloaded from CRAN.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的章节中，你通过使用其他人提供的函数来完成大多数任务。这些函数来自基础R安装中的软件包或从CRAN下载的贡献软件包。
- en: Installing a new package extends R’s functionality. For example, installing
    the `mice` package provides you with new ways of dealing with missing data. Installing
    the `ggplot2` packages provides you with new ways of visualizing data. Many of
    R’s most powerful capabilities come from contributed packages.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 安装一个新的软件包扩展了R的功能。例如，安装 `mice` 软件包为你提供了处理缺失数据的新方法。安装 `ggplot2` 软件包为你提供了数据可视化的新方法。R中许多最强大的功能都来自贡献软件包。
- en: Technically, a package is simply a set of functions, documentation, and data
    saved in a standardized format. A package allows you to organize your functions
    in a well-defined and fully documented manner and facilitates sharing your programs
    with others.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 从技术上来说，一个软件包只是一个由函数、文档和数据以标准化格式保存的集合。软件包允许你以定义良好且完全文档化的方式组织你的函数，并便于与他人共享你的程序。
- en: 'There are several reasons why you might want to create a package:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能想要创建软件包的几个原因：
- en: To make a set of frequently used functions easily accessible, along with the
    documentation on how to use them.
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使一组常用函数易于访问，并提供如何使用它们的文档。
- en: To create a set of examples and datasets that can be distributed to students
    in a classroom.
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一组示例和数据集，可以分发给课堂上的学生。
- en: To create a program (a set of interrelated functions) that can be used to solve
    a significant analytic problem (such as imputing missing values).
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个程序（一组相互关联的函数），可以用来解决一个重要的分析问题（例如，填补缺失值）。
- en: To promote research reproducibility by organizing study data, analysis code,
    and documentation into a portable and standardized format.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过组织研究数据、分析代码和文档到一个便携和标准化的格式来促进研究可重复性。
- en: Creating a useful package is also a great way of introducing yourself to others
    and giving back to the R community. Packages can be shared directly or through
    online repositories such as CRAN and GitHub.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个有用的软件包也是向他人介绍自己并回馈R社区的好方法。软件包可以直接共享或通过在线仓库如CRAN和GitHub进行共享。
- en: In this chapter, you’ll have an opportunity to develop a package from start
    to finish. By the end of the chapter, you’ll be able to build your own R packages
    (and enjoy the smug self-satisfaction and bragging rights that attend such a feat).
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你将有机会从头到尾开发一个软件包。到本章结束时，你将能够构建自己的R软件包（并享受这种成就带来的自豪感和炫耀的权利）。
- en: The package you’ll develop is called `edatools`. It provides functions for describing
    the contents of a data frame. The functions are purposely simple so you can focus
    on the process of creating a package without getting bogged down in code details.
    In section 22.1, you’ll take the `edatools` package for a test drive. Then in
    section 22.2, you’ll build your own copy of the package from scratch.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 你将要开发的软件包名为 `edatools`。它提供了描述数据框内容的函数。这些函数故意设计得简单，这样你就可以专注于创建软件包的过程，而不会陷入代码细节。在第22.1节中，你将对
    `edatools` 软件包进行测试。然后在第22.2节中，你将从零开始构建软件包的副本。
- en: 22.1 The edatools package
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 22.1 edatools软件包
- en: '*Exploratory* *data analysis (EDA**)* is an approach to understanding data
    by describing its characteristics through statistical summaries and visualizations.
    The `edatools` package is a small subset of a comprehensive EDA package called
    `qacBase` *(*[http://rkabacoff.github.io/qacBase](http://rkabacoff.github.io/qacBase)*).*'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '*探索性数据分析（EDA**）* 是一种通过描述数据的特征来理解数据的方法，这些特征通过统计摘要和可视化来展示。`edatools` 软件包是名为 `qacBase`
    的综合EDA软件包的一个小子集（*[http://rkabacoff.github.io/qacBase](http://rkabacoff.github.io/qacBase)*）。'
- en: The `edatools` package contains functions that describe and visualize the contents
    of a data frame. The package also contains a dataset called `happiness` that contains
    the responses of 460 individuals to a survey about life satisfaction. The survey
    describes individuals’ ratings of agreement with the statement “I am happy most
    of the time,” along with demographic variables such as income, education, sex,
    race, and number of children. Ratings occur on a 6-point scale from *strongly
    disagree* to *strongly agree*. The data are fictitious and included to allow users
    to experiment with a data frame containing several types of variables and varying
    levels of missing data per variable.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '`edatools` 包包含描述和可视化数据框内容的函数。该包还包含一个名为 `happiness` 的数据集，其中包含460位个人对关于生活满意度的调查的回应。调查描述了个人对陈述“我大多数时间都很快乐”的同意程度评级，以及如收入、教育、性别、种族和子女数量等人口统计变量。评级采用从
    *强烈不同意* 到 *强烈同意* 的6点量表。数据是虚构的，包含在内以使用户能够在一个包含多种类型变量和每个变量不同缺失数据级别的数据框中进行实验。'
- en: 'You can install the `edatools` package with the following code:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下代码安装 `edatools` 包：
- en: '[PRE0]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This downloads the package from `GitHub` and installs it in your default R library.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 这将从 `GitHub` 下载包并将其安装到您的默认 R 库中。
- en: The `edatools` package has one main function called `contents``()` that collects
    information about a data frame, and `print``()` and `plot()` functions to display
    the results. The following listing demonstrates the functions, and figure 22.1
    provides the resulting graph.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '`edatools` 包有一个主要函数 `contents()`，用于收集有关数据框的信息，以及 `print()` 和 `plot()` 函数用于显示结果。以下列表展示了这些函数，图22.1提供了相应的图表。'
- en: Listing 22.1 Describing a data frame with the `edatools` package
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 列表22.1 使用 `edatools` 包描述数据框
- en: '[PRE1]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![](Images/CH22_F01_Kabacoff3.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH22_F01_Kabacoff3.png)'
- en: Figure 22.1 Graph describing the contents of the `happiness` data frame. There
    are 11 variables, with 70% missing data on the `IQ` variable and 20% missing on
    the `Race` variable. The data frame contains 6 different types of data (ordered
    factor, numeric, integer, etc.).
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图22.1 描述 `happiness` 数据框内容的图表。有11个变量，`IQ` 变量的70%数据缺失，`Race` 变量的20%数据缺失。数据框包含6种不同的数据类型（有序因子、数值、整数等）。
- en: The printed output lists the number of variables and observations and the size
    of the data frame in megabytes. Each variable’s position in the data frame, name,
    type, number of unique values, and number and percent of missing values are displayed.
    Variables that can serve as unique identifiers (where each row has a unique value)
    are starred. The graph arranges and color-codes the variables by type, and the
    length of the bars indicates the percentage of cases available for analysis.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 打印输出列出了变量的数量和观测值数量以及数据框的大小（以兆字节为单位）。显示每个变量在数据框中的位置、名称、类型、唯一值的数量以及缺失值的数量和百分比。可以作为唯一标识符的变量（每行都有一个唯一值）被标记。图表按类型排列并按颜色编码变量，条形图的长度表示可用于分析的案例百分比。
- en: From the table and graph, you can see that the data frame has 11 variables and
    460 observations. It takes up 0.1 megabytes in RAM. `ID` is a unique identifier,
    there are 10 zip codes in the data, and 70% of the `IQ` data is missing. As expected,
    the happiness rating (`happy`) is an ordered factor with six levels. What else
    can you see?
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 从表格和图表中，您可以看到数据框有11个变量和460个观测值。它占用0.1兆字节的RAM。`ID` 是一个唯一标识符，数据中有10个邮政编码，`IQ`
    数据的70%缺失。正如预期的那样，幸福评级（`happy`）是一个有序因子，有六个水平。您还能看到什么？
- en: The next section describes the general steps in building an R package. In the
    following sections, you’ll go through the steps sequentially to build the `edatools`
    package from scratch.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 下一节描述了构建 R 包的一般步骤。在接下来的几节中，您将按顺序逐步构建 `edatools` 包。
- en: 22.2 Creating a package
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 22.2 创建包
- en: Creating an R package was once an arduous task meant only for a select group
    of highly trained R professionals (secret handshake included). With the advent
    of user-friendly development tools, the process is much more straightforward.
    However, it’s still a detailed, multistep process. The steps are
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 创建 R 包曾经是一项艰巨的任务，仅限于一小部分经过高度训练的 R 专业人士（包括秘密握手）。随着用户友好型开发工具的出现，这个过程变得更加直接。然而，它仍然是一个详细的多步骤过程。步骤如下
- en: Install development tools.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装开发工具。
- en: Create a package project.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个包项目。
- en: Add the functions.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加函数。
- en: Add function documentation.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加函数文档。
- en: Add a general help file.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个一般帮助文件。
- en: Add sample data and sample data documentation.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加样本数据和样本数据文档。
- en: Add a vignette.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个示例文档。
- en: Edit the DESCRIPTION file.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑DESCRIPTION文件。
- en: Build and install the package.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建并安装包。
- en: Steps 5–7 are optional, but good development practice. The following sections
    will take you through each step in turn. You can also download the finished product
    from http://rkabacoff.com/RiA/edatools.zip and save yourself some typing.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 步骤5-7是可选的，但良好的开发实践。以下各节将依次介绍每个步骤。你也可以从http://rkabacoff.com/RiA/edatools.zip下载成品，以节省一些输入时间。
- en: 22.2.1 Installing development tools
  id: totrans-42
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.2.1 安装开发工具
- en: In this chapter, I’m assuming that you are using RStudio when building the package.
    In addition, there are support packages you will want to install. First, install
    the `devtools`, `usethis``,` and `roxygen2` packages using `install.packages(c("devtools",`
    `"usethis",` `"roxygen2"),` `depend=TRUE``)`. The `devtools` and `usethis` packages
    contain functions that simplify and automate package development. The `roxygen2`
    package streamlines the creation of package documentation.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我假设你在构建包时使用的是RStudio。此外，还有一些你想要安装的支持包。首先，使用以下命令安装`devtools`、`usethis`和`roxygen2`包：`install.packages(c("devtools",
    "usethis", "roxygen2"), depend=TRUE)`。`devtools`和`usethis`包包含简化并自动化包开发的函数。`roxygen2`包简化了包文档的创建。
- en: 'The remaining software is situation-specific:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 剩余的软件是特定情况的：
- en: 'Package documentation is normally in HTML format. If you want to create documentation
    (e.g., a manual and/or vignettes) in PDF format, you’ll need to install LaTeX,
    a high-quality typesetting system. Several software distributions are available.
    I recommend TinyTex ([https://yihui.org/tinytex/](https://yihui.org/tinytex/)),
    a lightweight, cross-platform distribution. You can install it with the following
    code:'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包文档通常是HTML格式。如果你想以PDF格式创建文档（例如，手册和/或vignettes），你需要安装LaTeX，一个高质量的排版系统。有几种软件发行版可供选择。我推荐TinyTex（[https://yihui.org/tinytex/](https://yihui.org/tinytex/)），这是一个轻量级、跨平台的发行版。你可以使用以下代码安装它：
- en: '[PRE2]'
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The `pkgdown` package will help you create a website for your package. This
    is an optional step described in section 22.3.4.
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`pkgdown`包将帮助你为你的包创建一个网站。这是第22.3.4节中描述的可选步骤。'
- en: Finally, if you’re on a Windows platform and you’re going to build R packages
    that include C, C++, or Fortran code, you’ll want to install Rtools.exe ([http://cran.r-project.org/bin/windows/Rtools](http://cran.r-project.org/bin/windows/Rtools)).
    Installation instructions are provided on the download page. macOS and Linux users
    already have the necessary tools. While I briefly describe use of external compiled
    code in section 22.4, we won’t be using it in this book.
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后，如果你在Windows平台上，并且打算构建包含C、C++或Fortran代码的R包，你需要安装Rtools.exe（[http://cran.r-project.org/bin/windows/Rtools](http://cran.r-project.org/bin/windows/Rtools)）。安装说明在下载页面提供。macOS和Linux用户已经拥有了必要的工具。虽然我在第22.4节中简要描述了外部编译代码的使用，但我们在这本书中不会使用它。
- en: 22.2.2 Creating a package project
  id: totrans-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.2.2 创建包项目
- en: Once you have the necessary tools, the next step is to create a package project.
    When you run the following code
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你有了必要的工具，下一步就是创建一个包项目。当你运行以下代码时
- en: '[PRE3]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: an RStudio project is created with the folder structure given in figure 22.2\.
    You are automatically placed into the project, with the current working directory
    set to the `edatools` folder.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`create_project()`函数创建的RStudio项目具有图22.2所示的文件夹结构。你将自动进入该项目，当前工作目录设置为`edatools`文件夹。
- en: '![](Images/CH22_F02_Kabacoff3.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH22_F02_Kabacoff3.png)'
- en: Figure 22.2 Contents of the `edatools` project folder created by the `create_project()`
    function
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图22.2 `edatools`项目文件夹的内容，由`create_project()`函数创建
- en: Function code will go in the R folder. The other important files are the DESCRIPTION
    and NAMESPACE files. We will discuss them in later sections. The `.gitignore`,
    `.Rbuildignore`, and `edatools.Rproj` are support files that allow you to customize
    aspects of the package creation process. You can leave them as is.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 函数代码将放在R文件夹中。其他重要的文件是DESCRIPTION和NAMESPACE文件。我们将在后面的章节中讨论它们。`.gitignore`、`.Rbuildignore`和`edatools.Rproj`是支持文件，允许你自定义包创建过程的一些方面。你可以保持它们不变。
- en: 22.2.3 Writing the package functions
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.2.3 编写包函数
- en: 'The `edatools` package consists of three functions: `contents``()`, `print
    .contents()`, and `plot.contents``()`. The first is the primary function that
    gathers information about the data frame, and the others are S3 object-oriented
    generic functions (see section 20.4.1) used to print and plot the results.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '`edatools`包由三个函数组成：`contents()`、`print .contents()`和`plot.contents()`。第一个是主要函数，用于收集有关数据框的信息，其他的是用于打印和绘图结果的S3面向对象泛型函数（见第20.4.1节）。'
- en: Function code files are placed in the R folder created in section 22.2.2\. It’s
    a good idea to place each function in a separate text file with a .R extension.
    This isn’t strictly necessary, but it makes organizing the work easier. Additionally,
    it isn’t necessary for the names of the functions and the names of the files to
    match, but again, it’s good coding practice. Each file has a header consisting
    of a set of comments that start with the characters `#'`. The R interpreter ignores
    these lines, but you’ll use the `roxygen2` package to turn the comments into your
    package documentation. These header comments will be discussed in section 22.2.4.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 函数代码文件放置在22.2.2节中创建的R文件夹中。将每个函数放置在单独的以.R扩展名的文本文件中是个好主意。这并不是严格必要的，但它使得组织工作更加容易。此外，函数名称和文件名称不需要匹配，但再次强调，这是良好的编码实践。每个文件都有一个包含以字符`#`开头的注释集的头信息。R解释器会忽略这些行，但你会使用`roxygen2`包将这些注释转换为你的包文档。这些头注释将在22.2.4节中讨论。
- en: Listings 22.2 through 22.4 provide the files.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 列表22.2至22.4提供了文件。
- en: Gathering data frame information
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 收集数据框信息
- en: The `contents()` function in the contents.R text file describes a data frame
    and saves the results in a list. The function call is `contents(data)` where `data`
    is the name of a data frame in the working environment.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: contents.R文本文件中的`contents()`函数描述了一个数据框，并将结果保存到一个列表中。函数调用为`contents(data)`，其中`data`是工作环境中数据框的名称。
- en: Listing 22.2 Contents of the contents.R file
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 列表22.2 contents.R文件的内容
- en: '[PRE4]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: ❶ Checks input
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 检查输入
- en: ❷ Saves the data frame name
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 保存数据框名称
- en: ❸ Obtains the data frame size
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 获取数据框大小
- en: ❹ Collects variable information
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 收集变量信息
- en: ❺ Returns results
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 返回结果
- en: When the function is called, it checks to see if the input is a data frame.
    If not, an error is generated ❶. Next, the name of the data frame is recorded
    as text ❷ and the size of the data frame is recorded in bytes ❸. For each variable,
    the position, name, type, number of unique values, and number and percent of missing
    values are recorded and saved into a data frame called `varinfo` ❹. Finally, the
    results are bundled up and returned as a list ❺. The list contains five components
    that are summarized in table 22.1\. Additionally, the class of the list is set
    to `c("contents", "list")`. This is a critical step in creating generic functions
    for handling the results.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 当函数被调用时，它会检查输入是否为数据框。如果不是，将生成错误❶。接下来，将数据框的名称记录为文本❷，并将数据框的大小记录为字节❸。对于每个变量，记录并保存其位置、名称、类型、唯一值的数量以及缺失值的数量和百分比，并将这些信息保存到一个名为`varinfo`的数据框中❹。最后，将结果打包并作为列表返回❺。列表包含五个组件，这些组件在表22.1中进行了总结。此外，将列表的类设置为`c("contents",
    "list")`。这是创建用于处理结果的泛型函数的关键步骤。
- en: Table 22.1 List object returned by the `contents()` function
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 表22.1 `contents()`函数返回的列表对象
- en: '| Component | Description |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
  zh: '| 组件 | 描述 |'
- en: '| `dfname` | Name of the data frame |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '| `dfname` | 数据框的名称 |'
- en: '| `size` | Size of the data frame |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
  zh: '| `size` | 数据框的大小 |'
- en: '| `nrow` | Number of rows |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '| `nrow` | 行数 |'
- en: '| `ncol` | Number of columns |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '| `ncol` | 列数 |'
- en: '| `varinfo` | A data frame containing variable information (position, name,
    type, number of unique values, and number and percent of missing values) |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '| `varinfo` | 包含变量信息的数据框（位置、名称、类型、唯一值的数量以及缺失值的数量和百分比） |'
- en: Although the list provides all the information required, you’d rarely access
    the components directly. Instead, you’ll create generic `print``()` and `plot()`
    functions to present this information in more concise and meaningful ways. We
    consider these generic functions next.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然列表提供了所需的所有信息，但你很少直接访问其组件。相反，你会创建通用的`print()`和`plot()`函数，以更简洁和更有意义的方式呈现这些信息。我们将在下一节中考虑这些通用函数。
- en: print and plot functions
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 打印和绘图函数
- en: Most analytic functions of any breadth come with generic `print``()` and `summary()`
    functions. `print``()` provides basic or raw information about an object, and
    `summary``()` provides more detailed or processed (summarized) information. A
    `plot()`function is frequently included when a plot makes sense in the given context.
    You’ll only need `print` and `plot` functions for this package.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 任何广度上的分析函数通常都带有通用的`print()`和`summary()`函数。`print()`提供了关于对象的基本或原始信息，而`summary()`提供了更详细或处理过的（总结的）信息。当在给定上下文中绘制图形有意义时，通常会包括`plot()`函数。你只需要这个包的`print`和`plot`函数。
- en: Following the S3 OOP guidelines described in section 20.4.1, if an object has
    the class attribute `"foo"`, then `print(x)` executes `print.foo(x)` if it exists
    or `print .default(x)` otherwise. The same goes for `plot()`. Because the `contents()`
    function returns an object of class `"contents"`, you need to define the `print
    .contents``()` and `plot.contents()` functions. The following listing gives the
    `print.contents()` function.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 根据第20.4.1节中描述的S3 OOP指南，如果一个对象具有类属性 `"foo"`，那么 `print(x)` 将执行 `print.foo(x)`（如果存在）或
    `print .default(x)`。对于 `plot()` 也是如此。因为 `contents()` 函数返回一个类为 `"contents"` 的对象，你需要定义
    `print .contents``()` 和 `plot.contents()` 函数。以下列表给出了 `print.contents()` 函数。
- en: Listing 22.3 Contents of the print.R file
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 列表22.3 print.R文件的内容
- en: '[PRE5]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: ❶ Checks input
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 检查输入
- en: ❷ Prints a header
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 打印标题
- en: ❸ Identifies unique identifiers
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 识别唯一标识符
- en: ❹ Prints data frame size
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 打印数据框大小
- en: ❺ Prints variable information
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 打印变量信息
- en: First, the function checks that the input has class "`contents`" ❶. Next, a
    header with the data frame name and number of variables and observations is printed
    ❷. If the number of unique values in a column is equal to the number of observations,
    that variable uniquely identifies each case. Such variables are listed with a
    star (*) after their name ❸. Next, the size of the data frame is printed in megabytes
    ❹. Finally, a table of variable information is printed ❺.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，函数检查输入是否具有类"`contents`" ❶。接下来，打印出包含数据框名称、变量数量和观测数量的标题 ❷。如果某一列中的唯一值数量等于观测数量，则该变量唯一标识每个案例。这样的变量在其名称后带有星号
    (*) ❸。接下来，打印出数据框的大小（以兆字节为单位） ❹。最后，打印出变量信息的表格 ❺。
- en: The final function, `plot``()`, visualizes the results returned by the `contents()`
    function. This is accomplished via a horizontal `ggplot2` bar chart. The following
    listing displays the code.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个函数 `plot``()`，通过水平 `ggplot2` 条形图可视化 `contents()` 函数返回的结果。以下列表显示了代码。
- en: Listing 22.4 Contents of the plot.R file
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 列表22.4 plot.R文件的内容
- en: '[PRE6]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: ❶ Checks input
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 检查输入
- en: ❷ Generates data to be plotted
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 生成要绘制的图形数据
- en: ❸ Plots the bar chart
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 绘制条形图
- en: ❹ Reverses order of the legend
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 反转图例顺序
- en: ❺ Reverses the x- and y-axes
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 反转x轴和y轴
- en: Again, you check the class of the object passed to the function ❶. Next, the
    variable names, classes, and percent of nonmissing data are arranged into a data
    frame. The class of each variable is appended as a number that is used to sort
    the variables by type when the graph is plotted ❷. The data is plotted as a bar
    chart ❸, and the order of the legend is reversed so the colors line up vertically
    with the bars ❹. Finally, the x- and y-axes are flipped so that you get a horizontal
    bar chart ❺. When you have many variables or variables with long names, a horizontal
    bar chart can help avoid overlapping labels.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，你检查传递给函数的对象类别 ❶。接下来，变量名称、类别和非缺失数据的百分比被整理成一个数据框。每个变量的类别被附加为一个数字，用于在绘图时按类型对变量进行排序
    ❷。数据以条形图的形式绘制 ❸，图例的顺序被反转，以便颜色垂直对齐条形 ❹。最后，x轴和y轴被翻转，从而得到一个水平条形图 ❺。当你有很多变量或变量名称很长时，水平条形图可以帮助避免标签重叠。
- en: 22.2.4 Adding function documentation
  id: totrans-98
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.2.4 添加函数文档
- en: Every R package follows the same set of enforced guidelines for documentation.
    Each function in a package must be documented in the same fashion using LaTeX.
    Each function is placed in a separate .R file, and the documentation for that
    function (written in LaTeX) is placed in a .Rd file. Both the .R and .Rd files
    are text files.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 每个R包都遵循相同的强制文档指南。包中的每个函数都必须以相同的方式使用LaTeX进行文档化。每个函数都放置在一个单独的 .R 文件中，该函数的文档（用LaTeX编写）放置在一个
    .Rd 文件中。.R 和 .Rd 文件都是文本文件。
- en: There are two limitations to this approach. First, the documentation is stored
    separately from the functions it describes. If you change the function code, you
    have to search out the documentation and change it as well. Second, the user has
    to learn LaTeX. If you thought R has a steep learning curve, wait until you start
    working with LaTeX!
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法有两个限制。首先，文档存储在与它描述的函数分开的地方。如果你更改了函数代码，你必须找到文档并对其进行更改。其次，用户必须学习LaTeX。如果你认为R的学习曲线很陡峭，那么等你开始使用LaTeX时会更陡峭！
- en: The `roxygen2` package can dramatically simplify the creation of documentation.
    You place comments in the head of each .R file that will serve as the function’s
    documentation. These comments start with the characters `#'` and use a simple
    set of markup tags (called *roclets*). Table 22.2 lists common tags. The R interpreter
    sees these lines as comments and ignores them. But when the file is processed
    by `roxygen2`, lines that start with `#'` are used to generate the LaTeX (.Rd)
    documentation files automatically.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '`roxygen2` 包可以显著简化文档的创建。您在每个.R文件的开头放置注释，这些注释将作为函数的文档。这些注释以字符`#''`开头，并使用一组简单的标记标签（称为*roclets*）。表22.2列出了常见标签。R解释器将这些行视为注释并忽略它们。但是当文件由`roxygen2`处理时，以`#''`开头的行将用于自动生成LaTeX
    (.Rd) 文档文件。'
- en: Table 22.2 Tags for use with `roxygen2`
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 表22.2 与 `roxygen2` 一起使用的标签
- en: '| Tag | Description |'
  id: totrans-103
  prefs: []
  type: TYPE_TB
  zh: '| 标签 | 描述 |'
- en: '| `@title` | Function title |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '| `@title` | 函数标题 |'
- en: '| `@description` | One-line function description |'
  id: totrans-105
  prefs: []
  type: TYPE_TB
  zh: '| `@description` | 一行函数描述 |'
- en: '| `@details` | Multiline function description (indent after the first line)
    |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
  zh: '| `@details` | 多行函数描述（第一行后缩进） |'
- en: '| `@parm` | Function parameter |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
  zh: '| `@parm` | 函数参数 |'
- en: '| `@export` | Makes this function available to users of your package |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| `@export` | 使此函数对您的包用户可用 |'
- en: '| `@import` | Imports all functions from a package for use in your own package’s
    functions |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '| `@import` | 从一个包中导入所有函数以供自己的包函数使用 |'
- en: '| `@importFrom` | Selectively imports functions from a package for use in your
    own package’s functions |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '| `@importFrom` | 选择性地从包中导入函数以供自己的包函数使用 |'
- en: '| `@return` | Value returned by the function |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| `@return` | 函数返回的值 |'
- en: '| `@author` | Author(s) and contact address(es) |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| `@author` | 作者和联系地址 |'
- en: '| `@examples` | Examples using the function |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| `@examples` | 使用该函数的示例 |'
- en: '| `@note` | Any notes about the operation of the function |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '| `@note` | 关于函数操作的任何说明 |'
- en: '| `@references` | References concerning the methodology employed by function
    |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '| `@references` | 关于函数使用的方法的参考文献 |'
- en: '| `@seealso` | Link to related functions |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '| `@seealso` | 链接到相关函数 |'
- en: 'In addition to the tags in table 22.2, a few markup elements are useful to
    know as you create documentation:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 除了表22.2中的标签外，还有一些标记元素在创建文档时很有用：
- en: '`\code{*text*}` prints text in `code font`.'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`\code{*text*}`以代码字体打印文本。'
- en: '`\link{*function*}` generates a hypertext link to help on another R function.'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`\link{*function*}`生成一个超文本链接，以帮助另一个R函数。'
- en: '`\href{*URL*}{*text*}` adds a hyperlink.'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`\href{*URL*}{*text*}`添加一个超链接。'
- en: '`\item{*text*}` can be used to generate an itemized list.'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`\item{*text*}`可用于生成项目符号列表。'
- en: The `roxygen2` comments from the `contents()` function in listing 22.2 are reproduced
    in listing 22.5\. First, the title and description of the function are specified
    ❶. Next, the parameters are described ❷. Tags can appear in any order.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 列表22.2中 `contents()` 函数的 `roxygen2` 注释在列表22.5中重现。首先，指定函数的标题和描述 ❶。接下来，描述参数 ❷。标签可以按任何顺序出现。
- en: Listing 22.5 `roxygen2` comments for the `contents()` function
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 列表22.5 `roxygen2` 对 `contents()` 函数的注释
- en: '[PRE7]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: ❶ Title and description
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 标题和描述
- en: ❷ Parameters
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 参数
- en: ❸ Imports functions
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 导入函数
- en: ❹ Returns value
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 返回值
- en: ❺ Exports function
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 导出函数
- en: The `@importFrom` tag indicates that this function uses the `object.size()`
    function from the `utils` package ❸. Use `@importFrom` when you want to make a
    limited set of functions available from a given package. Use the `@import` function
    to make *all* the functions of a package available. For example, the `plot.contents()`
    function uses the `@import ggplot2` tag to make all `ggplot2` functions available
    to that function.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '`@importFrom` 标签表示此函数使用 `utils` 包中的 `object.size()` 函数 ❸。当您想从给定包中使一组有限的函数可用时使用
    `@importFrom`。使用 `@import` 函数使包中的所有函数都可用。例如，`plot.contents()` 函数使用 `@import ggplot2`
    标签使所有 `ggplot2` 函数对该函数可用。'
- en: The `@return` tag indicates what the function returns (a list in this case)
    ❹. It will appear in the help under the heading `Value`. Use `@details` to provide
    more information about the function. The `@seealso` tag provides hyperlinks to
    other functions of interest. The `@export` tag makes the function available to
    the user ❺. If you omit it, the function is still accessible to other functions
    in your package but cannot be called directly from the command line. You would
    omit the `@export` tag for functions that shouldn’t be called directly by the
    user.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '`@return` 标签表示函数返回的内容（在本例中是一个列表）。它将出现在帮助文档的 `Value` 标题下。使用 `@details` 提供有关函数的更多信息。`@seealso`
    标签提供对其他感兴趣函数的超链接。`@export` 标签使函数对用户可用 ❺。如果你省略它，函数仍然可以被包中的其他函数访问，但不能直接从命令行调用。对于不应该由用户直接调用的函数，应省略
    `@export` 标签。'
- en: Finally, the `@examples` tag lets you include one or more examples demonstrating
    the function. Note that these examples are expected to work! Otherwise, surround
    the example code with the `\dontrun{}` markup code. For example, use
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，`@examples` 标签允许你包含一个或多个演示函数的示例。请注意，这些示例应该能正常工作！否则，用 `\dontrun{}` 标记代码包围示例代码。例如，使用
- en: '[PRE8]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: if there is no data frame called `prettyflowers`. Since the code is surrounded
    by `\dontrun{}`, it won’t throw an error. The `\dontrun{}` markup is often used
    when an example would take a long time to run.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有名为 `prettyflowers` 的数据框。由于代码被 `\dontrun{}` 包围，它不会抛出错误。`\dontrun{}` 标记通常用于示例需要很长时间才能运行的情况。
- en: 22.2.5 Adding a general help file (optional)
  id: totrans-135
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.2.5 添加一个通用的帮助文件（可选）
- en: By adding `roxygen2` comments to each function, help files are generated during
    the document and build steps (section 22.3) When the package is installed and
    loaded, typing `?contents` or `help(contents)` will bring up the help file for
    that function. But there is no help available for the package name itself. In
    other words, `help (edatools)` will fail.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 通过为每个函数添加 `roxygen2` 注释，在文档和构建步骤（第 22.3 节）期间生成帮助文件。当包安装并加载时，输入 `?contents` 或
    `help(contents)` 将会显示该函数的帮助文件。但包名称本身没有帮助信息。换句话说，`help(edatools)` 将会失败。
- en: How is the user to know what package functions are available? One way would
    be to type `help(package="edatools")`, but you can make it easier for them by
    adding another file to the documentation. Add the file edatools.R (listing 22.6)
    to the R folder.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 用户如何知道哪些包函数可用？一种方法是通过输入 `help(package="edatools")`，但你可以通过添加另一个文件到文档中使其更容易。将文件
    `edatools.R`（列表 22.6）添加到 R 文件夹中。
- en: Listing 22.6 Contents of the edatools.R file
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 22.6 `edatools.R` 文件的内容
- en: '[PRE9]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Note that the last line of this file must be blank. When the package is built,
    a call to `help(edatools)` will now produce a description of the package with
    a clickable link to an index of functions.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，此文件的最后一行必须是空的。当包构建时，调用 `help(edatools)` 将会生成一个包含可点击链接到函数索引的包描述。
- en: 22.2.6 Adding sample data to the package (optional)
  id: totrans-141
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.2.6 添加样本数据到包中（可选）
- en: When you’re creating a package, it’s a good idea to include one or more datasets
    that can be used to demonstrate its functions. For the `edatools` package, you’ll
    add the `happiness` data frame. It contains six types of variables and differing
    amounts of missing data per variable.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 当你创建一个包时，包括一个或多个可以用来演示其函数的数据集是一个好主意。对于 `edatools` 包，你将添加 `happiness` 数据框。它包含六种类型的变量以及每个变量不同数量的缺失数据。
- en: 'To add a data frame to a package, first place it in memory. The following code
    loads the `happiness` data frame into the global environment:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 要将数据框添加到包中，首先将其放置在内存中。以下代码将 `happiness` 数据框加载到全局环境中：
- en: '[PRE10]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Next, run
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，运行
- en: '[PRE11]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: This creates a folder called data (if it doesn’t exist) and places the happiness
    data frame into it as a compressed .rda file named happiness.rda.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 这将创建一个名为 data 的文件夹（如果不存在），并将 `happiness` 数据框作为名为 happiness.rda 的压缩 .rda 文件放入其中。
- en: You also need to create a .R file that documents the data frame. The following
    listing gives the code.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 你还需要创建一个 .R 文件来记录数据框。以下列表给出了代码。
- en: Listing 22.7 Contents of the happiness.R file
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 22.7 `happiness.R` 文件的内容
- en: '[PRE12]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Note that the code in listing 22.7 consists entirely of comments. Place it in
    the R folder with the function code files.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，列表 22.7 中的代码完全由注释组成。将其放置在 R 文件夹中与函数代码文件一起。
- en: 22.2.7 Adding a vignette (optional)
  id: totrans-152
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.2.7 添加一个示例文章（可选）
- en: People are more likely to use your package if you include a brief article describing
    its features and use. To create a vignette, run
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你包含一篇简要的文章来描述其功能和用途，人们更有可能使用你的包。要创建一个示例文章，运行
- en: '[PRE13]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: This will create a folder called vignettes (if it doesn’t exist) and place an
    RMarkdown template file called edatools.Rmd in it. It will also open the file
    for editing in RStudio. Section 21.2 describes editing RMarkdown documents. The
    following listing shows the completed vignette.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 这将创建一个名为 vignettes 的文件夹（如果不存在），并在其中放置一个名为 edatools.Rmd 的 RMarkdown 模板文件。它还会在
    RStudio 中打开文件以供编辑。第 21.2 节描述了编辑 RMarkdown 文档。以下列表显示了完成的文档。
- en: Listing 22.8 `edatools` vignette
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 22.8 `edatools` 文档
- en: '[PRE14]{r, include = FALSE}'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE14]{r, include = FALSE}'
- en: knitr::opts_chunk$set(
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: knitr::opts_chunk$set(
- en: collapse = TRUE,
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: collapse = TRUE,
- en: comment = "#>"
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: comment = "#>"
- en: )
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: '[PRE15]{r example}'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE15]{r example}'
- en: library(edatools)
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: library(edatools)
- en: df_info <- contents(happiness)
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: df_info <- contents(happiness)
- en: print(df_info, digits=3)
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: print(df_info, digits=3)
- en: plot(df_info)
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: plot(df_info)
- en: '[PRE16]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: When the package is installed, users can access the vignette using `vignette`
    `("edatools")`.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 当包安装后，用户可以使用 `vignette` `("edatools")` 访问文档。
- en: 22.2.8 Editing the DESCRIPTION file
  id: totrans-169
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.2.8 编辑 DESCRIPTION 文件
- en: Every package has a DESCRIPTION file that contains metadata such as package
    title, version, author(s), license, and package dependencies. The file was created
    automatically when you invoked `build_package("edatools")` in section 22.2.2\.
    Other functions from the `usethis` package will add additional information to
    the DESCRIPTION file.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 每个包都有一个包含元数据（如包标题、版本、作者、许可和包依赖）的 DESCRIPTION 文件。当你在 22.2.2 节中调用 `build_package("edatools")`
    时，该文件会自动创建。`usethis` 包的其他函数将向 DESCRIPTION 文件添加更多信息。
- en: First, indicate which contributed packages your package will require to run.
    The `edatools` package depends on the `ggplot2` package to run. Executing
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，指出你的包运行所需的贡献包。`edatools` 包依赖于 `ggplot2` 包来运行。执行
- en: '[PRE17]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: will add this requirement to the DESCRIPTION file. You can invoke the command
    numerous times if you have multiple dependencies. You needn’t specify any base
    R packages. When `edtools` is installed, required contributed packages will also
    be installed if they are missing.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 将此要求添加到 DESCRIPTION 文件中。如果你有多个依赖项，你可以多次调用此命令。你不需要指定任何基础 R 包。当 `edtools` 安装时，如果缺少所需的贡献包，它们也会被安装。
- en: Next, indicate the license under which the package is being released. Common
    license types include MIT, GPL-2, and GPL-3\. See [www.r-project.org/Licenses](http://www.r-project.org/Licenses)
    for license descriptions. We’ll use the MIT license that basically says you can
    do anything you want with this AS IS software as long as you retain the copyright
    notice. Type
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，指出包发布的许可协议。常见的许可类型包括 MIT、GPL-2 和 GPL-3。请参阅 [www.r-project.org/Licenses](http://www.r-project.org/Licenses)
    了解许可描述。我们将使用 MIT 许可，它基本上意味着你可以对这种 AS IS 软件做任何你想做的事情，只要保留版权声明。输入
- en: '[PRE18]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: in the console to add the license to your package.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 在控制台中添加许可到你的包。
- en: Finally, edit the DESCRIPTION file manually. Since it is a simple text file,
    you can edit it in RStudio or via any text editor. The following listing gives
    the final version of the DESCRIPTION file.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，手动编辑 DESCRIPTION 文件。由于它是一个简单的文本文件，你可以在 RStudio 或任何文本编辑器中编辑它。以下列表给出了 DESCRIPTION
    文件的最终版本。
- en: Listing 22.9 Contents of the DESCRIPTION file
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 22.9 DESCRIPTION 文件内容
- en: '[PRE19]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The only fields you will need to edit are `Title`, `Version`, `Authors@R`, and
    `Description`. The `Title` should be a single line in sentence case. The `Version`
    number is up to you. The convention is *`major.minor.patch.dev`*. See [https://r-pkgs.org/release.html](https://r-pkgs.org/release.html)
    for details.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要编辑的唯一字段是 `Title`、`Version`、`Authors@R` 和 `Description`。`Title` 应该是单行句型。`Version`
    号码由你决定。约定是 *`major.minor.patch.dev`*。请参阅 [https://r-pkgs.org/release.html](https://r-pkgs.org/release.html)
    了解详细信息。
- en: In the `Authors@R:` section, specify each contributor and their roles. Here
    I entered my name and indicated that I am a full author (`"auth"`) and package
    maintainer (`"cre"`). Of course, when creating your own package, don’t use my
    name (unless the package is really good!). See [http://mng.bz/eMlP](http://mng.bz/eMlP)
    to learn about participant roles.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `Authors@R:` 部分，指定每个贡献者和他们的角色。在这里，我输入了我的名字，并表明我是一个完整作者（`"auth"`）和包维护者（`"cre"`）。当然，当你创建自己的包时，不要使用我的名字（除非这个包真的很优秀！）请参阅
    [http://mng.bz/eMlP](http://mng.bz/eMlP) 了解参与者角色。
- en: The `Description:` section can span several lines but must be indented after
    the first line. The `LazyData:` `yes` statement indicates that the datasets in
    the package (`happiness`, in this case) should be available as soon as the package
    is loaded. If this was set to `no`, the user would have to use `data(happiness)`
    to access the dataset.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '`描述:`部分可以跨越多行，但必须在第一行之后缩进。`LazyData:` `yes`语句表示该包中的数据集（在本例中为`happiness`）应在包加载时即可使用。如果设置为`no`，则用户必须使用`data(happiness)`来访问数据集。'
- en: 22.2.9 Building and installing the package
  id: totrans-183
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.2.9 构建和安装包
- en: It’s finally time to build the package. (Really, I promise.) At this point,
    your package should have the structure described in figure 22.3\. The italicized
    folders and files are optional. (Note that the plot.R and print.R files are only
    required because the `edatools` package includes specialized print and plot functions.)
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 终于到了构建包的时候了。（真的，我保证。）此时，你的包应该具有图22.3中描述的结构。斜体文件夹和文件是可选的。（注意，plot.R和print.R文件仅因为`edatools`包包含专门的打印和绘图函数而必需。）
- en: '![](Images/CH22_F03_Kabacoff3.png)'
  id: totrans-185
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH22_F03_Kabacoff3.png)'
- en: Figure 22.3 File and folder structure for the `edatools` package prior to the
    building step. Italicized folders and files are optional.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 图22.3 在构建步骤之前`edatools`包的文件和文件夹结构。斜体文件夹和文件是可选的。
- en: RStudio has a Build tab for building a package (see figure 22.4). Click the
    More drop-down menu and select Configure Build Tools. This will bring up the dialog
    in figure 22.5\. Make sure that both options are checked. Then click the Configure
    button to bring up the Roxygen Options dialog. Make sure the first six options
    are checked (see figure 22.6).
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: RStudio有一个用于构建包的构建选项卡（见图22.4）。点击更多下拉菜单并选择配置构建工具。这将弹出图22.5中的对话框。确保两个选项都已勾选。然后点击配置按钮以弹出Roxygen选项对话框。确保前六个选项已勾选（见图22.6）。
- en: '![](Images/CH22_F04_Kabacoff3.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH22_F04_Kabacoff3.png)'
- en: Figure 22.4 RStudio Build Tab. Use the options on this tab to create package
    documentation, build, and install the finished package.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 图22.4 RStudio构建选项卡。使用此选项卡上的选项创建包文档、构建和安装完成的包。
- en: '![](Images/CH22_F05_Kabacoff3.png)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH22_F05_Kabacoff3.png)'
- en: Figure 22.5 Project options dialog. Make sure both check boxes are checked.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 图22.5 项目选项对话框。确保两个复选框都已勾选。
- en: '![](Images/CH22_F06_Kabacoff3.png)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH22_F06_Kabacoff3.png)'
- en: Figure 22.6 `Roxygen` options dialog. Make sure the first six options are checked.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 图22.6 `Roxygen`选项对话框。确保前六个选项已勾选。
- en: Now there are two simple steps. First, build the documentation by selecting
    More > Document (or Ctrl+Shift+D). This will convert the `roxygen2` comments in
    the .R files into LaTeX help files (ending in .Rd). The .Rd files are placed in
    a folder called man (short for manual). The document command will also add information
    to the DESCRIPTION file and NAMESPACE file.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 现在有两个简单的步骤。首先，通过选择更多 > 文档（或Ctrl+Shift+D）来构建文档。这将把.R文件中的`roxygen2`注释转换为LaTeX帮助文件（以.Rd结尾）。.Rd文件放置在名为man（意为手册）的文件夹中。文档命令还会向DESCRIPTION文件和NAMESPACE文件添加信息。
- en: The following listing gives the resulting NAMESPACE file, which controls the
    visibility of your functions. Are all functions available to the package user
    directly, or are some used internally by other functions? In the current case,
    all functions are available to the user. It also makes functions from contributed
    packages available to your package. In this case, the `object.size``()`, `reorder``()`
    and all `ggplot2` functions can be called. To learn more about namespaces, see
    [http://adv-r.had.co.nz/Namespaces.html](http://adv-r.had.co.nz/Namespaces.html).
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的列表给出了生成的NAMESPACE文件，该文件控制了函数的可见性。所有函数都直接对包用户可用，还是有些函数被其他函数内部使用？在当前情况下，所有函数都对用户可用。它还使贡献包中的函数对您的包可用。在这种情况下，`object.size()`、`reorder()`和所有`ggplot2`函数都可以调用。要了解更多关于命名空间的信息，请参阅[http://adv-r.had.co.nz/Namespaces.html](http://adv-r.had.co.nz/Namespaces.html)。
- en: Listing 22.10 Contents of the NAMESPACE file
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 列表22.10 NAMESPACE文件内容
- en: '[PRE20]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Next, click the Install and Restart button. This will build the package, install
    it in your R local library, and load it into the session. At this point, your
    package will have the file structure depicted in figure 22.7\. Congratulations,
    your package is ready to use!
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，点击安装和重启按钮。这将构建包，将其安装到你的R本地库中，并将其加载到会话中。此时，你的包将具有图22.7中描述的文件结构。恭喜，你的包现在可以使用了！
- en: Where is my vignette?
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 我的vignette在哪里？
- en: 'If you added a vignette to your package and followed the instructions in this
    section, you won’t see the vignette. Why not?! The Install and Restart button
    does not build the vignette by default. Since this can be a time-consuming process,
    it’s assumed that the developer will not want to do this each time the package
    is rebuilt. When you build a *source package* (section 22.2.9), the vignette will
    be built and added to it. To see it on your system, install the package from this
    source package (Packages Tab > Install > Install from Package Archive File). Alternatively,
    you can run the following code:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在软件包中添加了vignette，并遵循本节中的说明，您将看不到vignette。为什么？因为默认情况下，“安装和重启”按钮不会构建vignette。由于这可能是一个耗时的过程，所以假设开发者不会希望在每次重新构建软件包时都这样做。当您构建一个*源代码包*（第22.2.9节）时，vignette将被构建并添加到其中。要在您的系统上查看它，请从源代码包安装软件包（包选项卡
    > 安装 > 从包存档文件安装）。或者，您可以运行以下代码：
- en: '[PRE21]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![](Images/CH22_F07_Kabacoff3.png)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH22_F07_Kabacoff3.png)'
- en: Figure 22.7 Package structure after running Document and Install and Restart.
    Again, optional files and folders are italicized.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 图22.7 运行“文档和安装及重启”后的软件包结构。再次说明，可选文件和文件夹以斜体显示。
- en: Before moving on, you should check the package for potential problems. Clicking
    the Check button on the Build tab runs extensive consistency checks on the package.
    It is a good idea to run these checks before sharing your package with others.
    If you find any errors, correct them, redocument (if documentation has changed),
    and rebuild the package.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续之前，您应该检查软件包中可能存在的问题。在“构建”选项卡上点击“检查”按钮会对软件包进行广泛的完整性检查。在与其他人共享软件包之前运行这些检查是个好主意。如果您发现任何错误，请纠正它们，重新编写文档（如果文档已更改），并重新构建软件包。
- en: 22.3 Sharing your package
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 22.3 分享您的软件包
- en: 'Once you’ve created a useful package, you’ll probably want to share it with
    others. There are several common methods for distributing an R package, including
    these:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您创建了一个有用的软件包，您可能希望与他人分享它。有几种常见的R软件包分发方法，包括以下这些：
- en: Distributing a source or binary package file
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分发源代码或二进制包文件
- en: Submitting the package to CRAN
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将软件包提交到CRAN
- en: Hosting the package on GitHub
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在GitHub上托管软件包
- en: Creating a package website
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个软件包网站
- en: In this section, we’ll look at each in turn.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将逐一查看。
- en: 22.3.1 Distributing a source package file
  id: totrans-212
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.3.1 分发源代码包文件
- en: You can bundle your package into a single compressed file that can be sent to
    others via email or cloud services. On the Build tab, click More > Build Source
    Package. This will create a source package file in your project’s parent directory.
    In this case, edatools_0.0.0.90000.tar.gz will appear one level above the edatools
    folder. The version number in the name is taken from the DESCRIPTION file. The
    package is now in a format that can be sent to others or submitted to CRAN.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以将您的软件包打包成一个单一的压缩文件，通过电子邮件或云服务发送给他人。在“构建”选项卡上，点击更多 > 构建源代码包。这将在一个名为edatools的文件夹之上创建一个源代码包文件。在这个例子中，edatools_0.0.0.90000.tar.gz将出现在edatools文件夹的一级目录上。文件名中的版本号是从DESCRIPTION文件中获取的。现在，软件包已经是一个可以发送给他人或提交给CRAN的格式。
- en: Recipients can install the package via the Packages tab by selecting Install
    and specifying Install from Package Archive File. Alternatively, they can use
    the code
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 收件人可以通过“包”选项卡选择安装，并指定从包存档文件安装。或者，他们可以使用以下代码
- en: '[PRE22]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: This will bring up a dialog box allowing them to select to the source package.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 这将弹出一个对话框，允许他们选择源代码包。
- en: If you have a LaTeX distribution installed (section 22.2.1), you can also create
    a PDF manual for your package. Run
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您已安装LaTeX发行版（第22.2.1节），您还可以为您的软件包创建PDF手册。运行
- en: '[PRE23]'
  id: totrans-218
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: in the console, and a PDF manual will be created in the parent directory.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 在控制台中，并在父目录中创建PDF手册。
- en: 22.3.2 Submitting to CRAN
  id: totrans-220
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.3.2 提交到CRAN
- en: 'The Comprehensive R Archive Network (CRAN) is the primary service for distributing
    contributed packages. This morning, the count was 17,788, but that number is already
    woefully out of date. To contribute your package to CRAN, follow these four steps:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 综合R档案网络（CRAN）是分发贡献软件包的主要服务。今天早上，计数为17,788，但这个数字已经过时了。要将您的软件包贡献给CRAN，请遵循以下四个步骤：
- en: Read the CRAN Repository Policy ([http://cran.r-project.org/web/packages/policies.html](http://cran.r-project.org/web/packages/policies.html)).
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 阅读CRAN仓库政策([http://cran.r-project.org/web/packages/policies.html](http://cran.r-project.org/web/packages/policies.html)).
- en: Make sure the package passes all checks without errors or warnings (Build tab
    > Check). Otherwise, the package will be rejected.
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保软件包通过所有检查，没有错误或警告（构建选项卡 > 检查）。否则，软件包将被拒绝。
- en: Create a source package file (see section 22.3.1).
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个源包文件（见第22.3.1节）。
- en: Submit the package. To do so via web form, use the submission form at [http://cran.r-project.org/submit.html](http://cran.r-project.org/submit.html).
    You’ll receive an automated confirmation email that needs to be accepted.
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提交包。要通过网页表单提交，请使用[http://cran.r-project.org/submit.html](http://cran.r-project.org/submit.html)上的提交表单。你将收到一封自动确认电子邮件，需要接受。
- en: But please don’t upload the `edatools` package you just created to CRAN. You
    now have the tools to create your own packages.
  id: totrans-226
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 但请不要上传你刚刚创建的`edatools`包到CRAN。你现在有了创建自己包的工具。
- en: 22.3.3 Hosting on GitHub
  id: totrans-227
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.3.3 在GitHub上托管
- en: 'Many package developers host their packages on GitHub ([http://www.github.com](http://www.github.com))
    even if they’re also posted on CRAN. GitHub is a popular Git repository-hosting
    service with many additional features. There are several good reasons to host
    a package on GitHub:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 许多包开发者即使在CRAN上发布了包，也会在GitHub上托管他们的包（[http://www.github.com](http://www.github.com)）。GitHub是一个流行的Git仓库托管服务，拥有许多附加功能。托管包在GitHub上有几个很好的理由：
- en: Your package may not be ready for prime time (i.e., it’s not fully developed
    yet).
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你的包可能还没有准备好进入主流（即，它还没有完全开发）。
- en: You want to allow others to work on the package with you or give you feedback
    and suggestions.
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你希望允许其他人与你一起工作在包上或给你反馈和建议。
- en: You want to host the production version on CRAN and the current development
    version on GitHub.
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你希望将生产版本托管在CRAN上，将当前开发版本托管在GitHub上。
- en: You want to use Git version control in the development process. (Nice, but not
    necessary.)
  id: totrans-232
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你希望在开发过程中使用Git版本控制。（很好，但不是必需的。）
- en: Hosting your packages on GitHub is free for both individuals and organizations.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 在GitHub上托管你的包对个人和组织都是免费的。
- en: To host a package on GitHub, first add a REAME.md file to your package. At the
    console, enter
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 要在GitHub上托管包，首先在你的包中添加一个REAME.md文件。在控制台输入
- en: '[PRE24]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: This will place a text file called README.md in the editor. The file uses a
    simple markdown language like RMarkdown. In RStudio, you can go to Help > Markdown
    Quick Reference for details. The following listing displays the README.md file
    for the `edatools` package.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 这将在编辑器中放置一个名为README.md的文本文件。该文件使用类似于RMarkdown的简单Markdown语言。在RStudio中，你可以通过帮助>Markdown快速参考来获取详细信息。以下列表显示了`edatools`包的README.md文件。
- en: Listing 22.11 Contents of the README.md file
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 列表22.11 README.md文件的内容
- en: '[PRE25] r'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE25] r'
- en: if(!require(remotes)){
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: if(!require(remotes)){
- en: install.packages("remotes")
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: install.packages("remotes")
- en: '}'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: remotes::install_github("rkabacoff/edatools")
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: remotes::install_github("rkabacoff/edatools")
- en: '[PRE26] r'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE26] r'
- en: library(edatools)
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: library(edatools)
- en: df_info<- contents(happiness)
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: df_info<- contents(happiness)
- en: df_info
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: df_info
- en: plot(df_info)
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: plot(df_info)
- en: '[PRE27]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Save the file, and you are ready to host the package on GitHub.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 保存文件，你就可以在GitHub上托管包了。
- en: To host the package,
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 要托管包，
- en: Sign up for an account and log in.
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注册账户并登录。
- en: Click New to create a new repository. On the next page, give it the same name
    as your package (see figure 22.8). Use with the default options and click Create
    Repository.
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“新建”以创建一个新的仓库。在下一页，给它起一个与你的包相同的名字（见图22.8）。使用默认选项并点击“创建仓库”。
- en: '![](Images/CH22_F08_Kabacoff3.png)'
  id: totrans-253
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](Images/CH22_F08_Kabacoff3.png)'
- en: Figure 22.8 GitHub Create a new repository page. Enter the name of the package
    and click Create Repository.
  id: totrans-254
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图22.8 GitHub创建新仓库页面。输入包名并点击创建仓库。
- en: On the next page, select Uploading an Existing File. The option can be hard
    to see (figure 22.9). Note that this assumes you want to upload the package files
    directly. If you are using Git version control, the process would be different.
    See Happy Git and GitHub for the user ([https://happygitwithr.com/](https://happygitwithr.com/))
    for details.
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页，选择“上传现有文件”。这个选项可能很难看到（见图22.9）。请注意，这假设你想要直接上传包文件。如果你使用Git版本控制，过程将不同。有关Happy
    Git and GitHub的用户详情（[https://happygitwithr.com/](https://happygitwithr.com/)）。
- en: On the next page, upload the contents of your package folder (the files and
    folders *in* your package, not the package folder itself). Click the Commit Changes
    button at the bottom of the page. Don’t forget this last step or the files will
    not appear.
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页，上传你的包文件夹的内容（包中的文件和文件夹，而不是包文件夹本身）。点击页面底部的“提交更改”按钮。不要忘记这一步，否则文件将不会显示。
- en: Give everyone the URL ([https://github.com/youraccountname/packagename](https://github.com/youraccountname/packagename)).
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给每个人分配URL（[https://github.com/youraccountname/packagename](https://github.com/youraccountname/packagename)）。
- en: '![](Images/CH22_F09_Kabacoff3.png)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH22_F09_Kabacoff3.png)'
- en: Figure 22.9 GitHub Quick Setup or new repository page. Select Uploading an Existing
    file.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 图 22.9 GitHub 快速设置或新建仓库页面。选择上传现有文件。
- en: You can see the GitHub repository for the `edatools` package at [https://github.com/Rkabacoff/edatools](https://github.com/Rkabacoff/edatools).
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在 [https://github.com/Rkabacoff/edatools](https://github.com/Rkabacoff/edatools)
    查看关于 `edatools` 软件包的 GitHub 仓库。
- en: 22.3.4 Creating a package website
  id: totrans-261
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 22.3.4 创建一个软件包网站
- en: A dedicated website can be a great way to promote and support your package.
    You can create such website with the `pkgdown` package ([https://pkgdown.r-lib.org/](https://pkgdown.r-lib.org/)).
    From within the package project, type
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 专门的网站可以是一个很好的推广和支持您软件包的方式。您可以使用 `pkgdown` 软件包（[https://pkgdown.r-lib.org/](https://pkgdown.r-lib.org/)）创建这样的网站。在软件包项目中，输入
- en: '[PRE28]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: in the console. This will add a folder to your project called docs, containing
    the HTML, cascading style sheets, and JavaScript files needed for a website. Simply
    put these files on a web server to make you package site available.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 在控制台中。这将为您项目添加一个名为 docs 的文件夹，其中包含创建网站所需的 HTML、层叠样式表和 JavaScript 文件。只需将这些文件放在
    Web 服务器上，就可以使您的软件包网站可用。
- en: GitHub Pages gives you free websites for your projects. Simply upload the docs
    folder to your GitHub package repository (section 22.3.3). Go to the repository
    Settings and click the GitHub Pages link. For source, select main, /docs, and
    Save (see figure 22.10). Your website is now available at [https://youraccountname.github.io/packagename](https://youraccountname.github.io/).
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: GitHub Pages 为您的项目提供免费的网站。只需将 docs 文件夹上传到您的 GitHub 软件包仓库（第 22.3.3 节）。转到仓库设置，点击
    GitHub Pages 链接。对于源，选择 main、/docs，然后保存（见图 22.10）。您的网站现在可在 [https://youraccountname.github.io/packagename](https://youraccountname.github.io/)
    上访问。
- en: '![](Images/CH22_F10_Kabacoff3.png)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH22_F10_Kabacoff3.png)'
- en: Figure 22.10 Setup page for GitHub Pages
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 图 22.10 GitHub Pages 设置页面
- en: The `edatools` package website is [https://rkabacoff.github.io/edatools](https://rkabacoff.github.io/edatools)
    (figure 22.11).
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: '`edatools` 软件包网站是 [https://rkabacoff.github.io/edatools](https://rkabacoff.github.io/edatools)（图
    22.11）。'
- en: '![](Images/CH22_F11_Kabacoff3.png)'
  id: totrans-269
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH22_F11_Kabacoff3.png)'
- en: Figure 22.11 `edatools` website hosted on GitHub Pages
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 图 22.11 基于 GitHub Pages 的 `edatools` 网站
- en: Note that the contents of the REAME.md file provide the text for the home page.
    The `edatools` vignette is linked to the Get Started tab. Each function is described
    and demonstrated in the Reference tab.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，REAME.md 文件的内容提供了主页的文本。`edatools` 演示文档链接到了“入门”标签。每个函数都在“参考”标签中进行了描述和演示。
- en: It is easy to customize your site by editing the _pkgdown.yml file in the docs
    folder before building the site. See “Customise Your Site” ([http://mng.bz/pJw2](http://mng.bz/pJw2))
    for details.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 在构建网站之前，通过编辑 docs 文件夹中的 _pkgdown.yml 文件，可以轻松地自定义您的网站。有关详细信息，请参阅“自定义您的网站”([http://mng.bz/pJw2](http://mng.bz/pJw2))。
- en: 22.4 Going further
  id: totrans-273
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 22.4 进一步学习
- en: In this chapter, all the code used to create the `edtools` package was R code.
    In fact, most packages contain code that is written entirely in R. But you can
    also call compiled C, C++, Fortran, and Java code from R. External code is typically
    included when doing so will improve execution speed or when the author wants to
    use existing external libraries from within their R code.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，用于创建 `edtools` 软件包的所有代码都是 R 代码。实际上，大多数软件包都包含完全用 R 编写的代码。但您也可以从 R 中调用编译后的
    C、C++、Fortran 和 Java 代码。外部代码通常在这样做可以提高执行速度或作者希望在 R 代码中使用现有的外部库时包含。
- en: There are several methods for including compiled external code. Useful base
    R functions include `.C``()`, `.Fortran``()`, `.External``()`, and `.Call``()`.
    Several packages have also been written to facilitate the process, including `inline`
    (C, C++, Fortran), `Rcpp` (C++), and `rJava` (Java). Adding external compiled
    code to an R package is beyond the scope of this book. See [https://r-pkgs.org/src.html](https://r-pkgs.org/src.html)
    to learn more.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 包含编译后的外部代码有几种方法。有用的基础 R 函数包括 `.C()`、`.Fortran()`、`.External()` 和 `.Call()`。还有一些软件包被编写来简化这个过程，包括
    `inline`（C、C++、Fortran）、`Rcpp`（C++）和 `rJava`（Java）。将外部编译代码添加到 R 软件包超出了本书的范围。请参阅
    [https://r-pkgs.org/src.html](https://r-pkgs.org/src.html) 了解更多信息。
- en: There are many excellent resources for learning more about developing R packages.
    “Writing R Extensions” by the R Core Team ([https://cran.r-project.org/doc/manuals/r-release/R-exts.html](https://cran.r-project.org/doc/manuals/r-release/R-exts.html))
    is the original text on the subject. Hadley Wickham and Jenny Bryan’s R Packages
    ([https://r-pkgs.org/](https://r-pkgs.org/)) contains a wealth of information
    and is freely available online. Cosima Meyer and Dennis Hammershmidt offer a comprehensive
    blog article on “How to Write Your Own R Package and Publish it on CRAN” ([http://mng.bz/O14o](http://mng.bz/O14o)).
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多优秀的资源可以帮助你学习更多关于开发R包的知识。“Writing R Extensions”由R核心团队编写([https://cran.r-project.org/doc/manuals/r-release/R-exts.html](https://cran.r-project.org/doc/manuals/r-release/R-exts.html))是关于这个主题的原始文本。Hadley
    Wickham和Jenny Bryan的《R Packages》([https://r-pkgs.org/](https://r-pkgs.org/))包含大量信息，并且可以在网上免费获取。Cosima
    Meyer和Dennis Hammershmidt提供了一篇关于“如何在CRAN上编写和发布你的R包”的全面博客文章([http://mng.bz/O14o](http://mng.bz/O14o))。
- en: R packages are a great way to organize your frequently used functions, develop
    complete applications, and share your results with others. In this era of reproducible
    research, it can also be a great way of bundling all the data and code for an
    extensive project. In this chapter, you created a complete R package from start
    to finish. Although packages seem complicated at first, they’re pretty easy to
    create once you have the process down. Now, get to work! And remember, have fun
    out there!
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: R包是组织你常用函数、开发完整应用程序以及与他人分享你结果的绝佳方式。在这个可重复研究的时代，它也可以是捆绑一个大型项目所有数据和代码的绝佳方式。在本章中，你从头到尾创建了一个完整的R包。尽管一开始包看起来很复杂，但一旦掌握了流程，创建它们就变得相当简单。现在，开始工作吧！并且记住，享受这个过程！
- en: Summary
  id: totrans-278
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: An R package is a set of functions, documentation, and data saved in a standardized
    format.
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R包是一组以标准化格式保存的函数、文档和数据。
- en: R packages can be used to simplify access to frequently used functions, solve
    complex analytic problems, share code and data with others, and give back to the
    R community.
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R包可以用来简化对常用函数的访问、解决复杂的分析问题、与他人共享代码和数据，并为R社区做出贡献。
- en: Developing a package is a multistep process. Packages such as `devtools`, `usethis`,
    and `roxygen2` can streamline this process.
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开发一个包是一个多步骤的过程。例如`devtools`、`usethis`和`roxygen2`这样的包可以简化这一过程。
- en: Steps include creating a package project, writing functions and documentation,
    building and installing the package, and distributing the package to others.
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 步骤包括创建包项目、编写函数和文档、构建和安装包，以及将包分发给他人。
- en: Packages can be shared with others by distributing source or binary package
    files, submitting to packages to CRAN, and/or hosting packages on GitHub.
  id: totrans-283
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以通过分发源代码或二进制包文件、提交到CRAN以及/或托管在GitHub上来与他人共享包。
- en: You can use the `pkgdown` package and GitHub pages to easily create a website
    that supports your package. It can also become part of your data science portfolio.
  id: totrans-284
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以使用`pkgdown`包和GitHub页面轻松创建一个支持你的包的网站。它也可以成为你数据科学组合的一部分。
