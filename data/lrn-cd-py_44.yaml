- en: Lesson 36\. Testing and debugging your programs
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第36课：测试和调试你的程序
- en: After reading [lesson 36](#ch36), you’ll be able to
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在阅读[第36课](#ch36)之后，你将能够
- en: Use the unittest library
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用unittest库
- en: Write tests for your program
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为你的程序编写测试
- en: Efficiently debug your programs
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 高效地调试你的程序
- en: It’s unlikely that you’ll write a perfect program on the first try. Often you’ll
    write code, test it with a few inputs, make changes to it, and test it again,
    repeating this process until your program runs as expected.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 很可能你不会在第一次尝试时就编写出一个完美的程序。通常，你会编写代码，用几个输入测试它，对其进行修改，然后再次测试，重复这个过程，直到程序按预期运行。
- en: '|  |'
  id: totrans-6
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: '**Consider this**'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '**考虑以下内容**'
- en: Think about your experience in programming so far. When you write a program
    and it doesn’t work, what kinds of things do you do to fix it?
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 回顾你到目前为止的编程经验。当你编写一个程序并且它不起作用时，你会做些什么来修复它？
- en: 'Answer:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 答案：
- en: Look at the error message, if any, and see whether there are clues like line
    numbers that can direct me toward the issue. Put `print` statements at certain
    locations. Try a different input.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 查看错误消息（如果有），看看是否有像行号这样的线索可以指引我找到问题所在。在特定位置放置`print`语句。尝试不同的输入。
- en: '|  |'
  id: totrans-11
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 36.1\. Working with the unittest library
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 36.1. 使用unittest库
- en: Python has many libraries that can help you create a testing structure around
    your program. A testing library is especially useful when you have programs that
    contain different functions. One testing library comes with your Python installation,
    and its documentation for Python 3.5 is available at [https://docs.python.org/3.5/library/unittest.html](https://docs.python.org/3.5/library/unittest.html).
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: Python有许多库可以帮助你围绕你的程序创建测试结构。当你有包含不同函数的程序时，测试库特别有用。一个测试库随Python安装一起提供，Python
    3.5的文档可在[https://docs.python.org/3.5/library/unittest.html](https://docs.python.org/3.5/library/unittest.html)找到。
- en: To create a suite of tests, you create a class representing that suite. Methods
    inside that class represent different tests. Every test that you want to run should
    have `test_` as a prefix, and then any name for the method. The following listing
    contains code that defines two simple tests and then runs them.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一组测试，你需要创建一个代表该组测试的类。该类内部的方法代表不同的测试。你想要运行的每个测试都应该以`test_`作为前缀，然后是任何方法名。以下列表包含定义了两个简单测试并运行它们的代码。
- en: Listing 36.1\. Simple test suite
  id: totrans-15
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表36.1：简单的测试套件
- en: '[PRE0]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '***1* Imports the unittest library**'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 导入unittest库**'
- en: '***2* Class for the suite of tests to do**'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 用于执行测试套件类的类**'
- en: '***3* Method to test whether 2 + 2 is 4**'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 测试2 + 2是否等于4的方法**'
- en: '***4* Test checks whether 2 + 2 is 4 by asserting that the 2 + 2 and 4 are
    equal**'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 测试检查2 + 2是否等于4，通过断言2 + 2和4相等**'
- en: '***5* Method to test whether 2 - 2 isn’t 4**'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***5* 测试2 - 2是否不等于4的方法**'
- en: '***6* Test checks whether 2 - 2 isn’t 4 by asserting that the 2 - 2 and 4 aren’t
    equal**'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***6* 测试检查2 - 2是否不等于4，通过断言2 - 2和4不相等**'
- en: '***7* Runs the tests defined in your test suite class**'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***7* 运行你在测试套件类中定义的测试**'
- en: 'The code prints the following:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 代码打印以下内容：
- en: '[PRE1]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'This is expected because the first test checks whether 2 + 2 is equal to 4,
    which is true. And the second test checks whether 2 - 2 isn’t equal to 4, which
    is true. Now suppose that one of the tests is `False` by making the following
    change:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 这是预期的，因为第一个测试检查2 + 2是否等于4，这是正确的。第二个测试检查2 - 2是否不等于4，这也是正确的。现在假设通过以下更改使其中一个测试为`False`：
- en: '[PRE2]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Now the test checks whether 2 + 2 is equal to 5, which is `False`. Running
    the test program again now prints the following:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 现在测试检查2 + 2是否等于5，这是`False`。再次运行测试程序现在会打印以下内容：
- en: '[PRE3]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'This message is rife with information. It tells you the following:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 这条消息充满了信息。它告诉你以下内容：
- en: 'Which test suite failed: `TestMyCode`'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哪个测试套件失败了：`TestMyCode`
- en: 'Which test failed: `test_addition_2_2`'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哪个测试失败了：`test_addition_2_2`
- en: 'Which line inside the test failed: `self.assertEqual(2+2, 5)`'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测试中失败的哪一行：`self.assertEqual(2+2, 5)`
- en: 'Why it failed, by comparing what value it got and what value it expected: `4
    != 5`'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为什么它失败了，通过比较它得到的价值和预期的价值：`4 != 5`
- en: Comparing values in this way is a bit silly. Clearly, you’d never have to check
    that 2 + 2 is 4\. You usually need to test code that has more substance to it;
    typically, you want to make sure that functions do the correct thing. You’ll see
    how to do this in the next section.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 以这种方式比较值有点愚蠢。显然，你永远不会需要检查2 + 2是否等于4。你通常需要测试具有更多实质性的代码；通常，你想要确保函数做正确的事情。你将在下一节中看到如何做到这一点。
- en: '|  |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: '**Quick check 36.1**'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '**快速检查36.1**'
- en: '**[Q1:](kindle_split_056.html#app01qa141q0a1)**'
  id: totrans-38
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[Q1:](kindle_split_056.html#app01qa141q0a1)**'
- en: ''
  id: totrans-39
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Fill in each of the following lines:'
  id: totrans-40
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 填写以下每一行：
- en: ''
  id: totrans-41
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-42
  prefs:
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '|  |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 36.2\. Separating the program from the tests
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 36.2. 将程序与测试分离
- en: You should decouple the code you write as part of your program from the code
    that you write to test the program. Decoupling reinforces the idea of modularity,
    in that you separate code into different files. This way, you avoid cluttering
    the program itself with unnecessary testing commands.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该将你作为程序编写的一部分代码与编写来测试程序的代码解耦。解耦强化了模块化的概念，即你将代码分离到不同的文件中。这样，你可以避免在程序本身中添加不必要的测试命令。
- en: Suppose you have one file that contains the two functions shown in [listing
    36.2](#ch36ex02). One function checks whether a number is prime (divisible by
    only 1 and itself, and not equal to 1) and returns `True` or `False`. The other
    returns the absolute value of a number. Each of these functions has an error in
    its implementation. Before reading further on how to write tests, can you spot
    the errors?
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你有一个文件包含 [列表 36.2](#ch36ex02) 中显示的两个函数。一个函数检查一个数是否为素数（只能被 1 和它本身整除，且不等于 1），并返回
    `True` 或 `False`。另一个返回一个数的绝对值。这些函数的实现中都有错误。在进一步阅读如何编写测试之前，你能找出这些错误吗？
- en: Listing 36.2\. File, named funcs.py, containing functions to test
  id: totrans-47
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 36.2\. 包含要测试的函数的文件，命名为 funcs.py
- en: '[PRE5]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: In a separate file, you can write unit tests to check whether the functions
    you wrote are behaving as expected. You can create different classes to organize
    different suites of tests corresponding to different functions. This is a good
    idea because you should have more than one test for each function, making sure
    to try a variety of inputs. Creating tests for every function you write is called
    *unit testing* because you’re testing each function’s behavior by itself.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个单独的文件中，你可以编写单元测试来检查你编写的函数是否按预期运行。你可以创建不同的类来组织与不同函数对应的测试套件。这是一个好主意，因为你应该为每个函数编写多个测试，确保尝试各种输入。为每个编写的函数编写测试被称为
    *单元测试*，因为你是通过单独测试每个函数的行为来进行的。
- en: '|  |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Definition
  id: totrans-51
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 定义
- en: A *unit test* is a series of tests that checks whether the actual output matches
    the expected output for a function.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '*单元测试* 是一系列测试，用于检查实际输出是否与函数的预期输出匹配。'
- en: '|  |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'A common way of writing unit tests for a method is to use the Arrange Act Assert
    pattern:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 为一个方法编写单元测试的常见方式是使用 Arrange Act Assert 模式：
- en: '*Arrange*—Sets up objects and their values to pass to the function undergoing
    unit testing'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Arrange*—设置对象及其值以传递给正在接受单元测试的函数'
- en: '*Act*—Calls the function with the parameters set up previously'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Act*—使用之前设置的参数调用函数'
- en: '*Assert*—Makes sure the function behavior is what was expected'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Assert*—确保函数的行为符合预期'
- en: The following listing shows the code for unit testing the functions in funcs.py.
    The class `TestPrime` contains tests related to the `is_prime` function, and the
    class `TestAbs` contains tests related to the `absolute_value` function.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表显示了在 funcs.py 中对函数进行单元测试的代码。类 `TestPrime` 包含与 `is_prime` 函数相关的测试，类 `TestAbs`
    包含与 `absolute_value` 函数相关的测试。
- en: Listing 36.3\. File, named test.py, containing the tests
  id: totrans-59
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 36.3\. 包含测试的文件，命名为 test.py
- en: '[PRE6]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '***1* Brings in unittest classes and functions**'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 引入 unittest 类和函数**'
- en: '***2* Brings in the functions you defined in funcs.py**'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 引入在 funcs.py 中定义的函数**'
- en: '***3* One class for a set of tests**'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 一个类用于一组测试**'
- en: '***4* One test, with the method name describing what the test is for**'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***4* 一个测试，方法名描述了测试的目的**'
- en: '***5* Calls the function is_prime from the funcs.py file with parameter 5 and
    assigns the return to isprime**'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***5* 从 funcs.py 文件中调用 is_prime 函数，参数为 5，并将返回值赋给 isprime**'
- en: '***6* Adds the test that checks whether the result from the function call is
    True**'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***6* 添加测试以检查函数调用结果是否为 True**'
- en: 'Running this code shows that it ran six tests and found two errors:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此代码显示它运行了六个测试并发现了两个错误：
- en: '[PRE7]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'With this information, you can make changes to your functions in funcs.py to
    try to fix them. The information provided here tells you the tests that failed:
    `test_abs_0` and `test_prime_5`. You can now go back to your function and try
    to fix it. This process is called *debugging* and is discussed in the next section.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 根据这些信息，你可以修改 funcs.py 中的函数来尝试修复它们。这里提供的信息告诉你哪些测试失败了：`test_abs_0` 和 `test_prime_5`。你现在可以回到你的函数并尝试修复它。这个过程被称为
    *调试*，将在下一节中讨论。
- en: '|  |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**Thinking like a programmer**'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '**像程序员一样思考**'
- en: Using descriptive names for the methods is useful for providing quick, at-a-glance,
    information when tests fail. You can include the function name, the inputs, and
    possibly a oneor two-word description of what it’s testing.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 使用描述性的方法名称对于在测试失败时提供快速、一目了然的信息是有用的。你可以包括函数名称、输入，以及可能的一个或两个词的描述，说明它正在测试什么。
- en: '|  |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: It’s important to make your changes incrementally. Every time you make a change,
    you should run the tests again by running tests.py. You do this to make sure that
    any changes you make to fix one issue won’t cause another issue to pop up.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是要逐步进行更改。每次你进行更改时，你应该通过运行tests.py再次运行测试。你这样做是为了确保你为修复一个问题所做的任何更改不会导致另一个问题出现。
- en: '|  |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: '**Quick check 36.2**'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '**快速检查 36.2**'
- en: '**[Q1:](kindle_split_056.html#app01qa142q0a1)**'
  id: totrans-77
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[Q1:](kindle_split_056.html#app01qa142q0a1)**'
- en: ''
  id: totrans-78
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Modify the code in [listing 36.2](#ch36ex02) to fix the two errors. After each
    change, run tests.py to see whether you fixed the errors.
  id: totrans-79
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 修改[列表 36.2](#ch36ex02)中的代码以修复两个错误。每次更改后，运行tests.py以查看你是否已修复错误。
- en: '|  |'
  id: totrans-80
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 36.2.1\. Types of tests
  id: totrans-81
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 36.2.1. 测试类型
- en: The unittest library has a variety of tests you can perform, not just to check
    whether one value is equal to another using `assertEqual`. The complete list is
    in the documentation for the library. Take a moment to browse through the list.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: unittest库有多种测试可以执行，不仅仅是使用`assertEqual`检查一个值是否等于另一个值。完整的列表可以在库的文档中找到。花点时间浏览一下这个列表。
- en: '|  |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: '**Quick check 36.3**'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '**快速检查 36.3**'
- en: Looking at the list of tests you can do, which would be most appropriate in
    the following situations?
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 在查看测试列表时，以下哪种情况最合适？
- en: '**[1](kindle_split_056.html#app01qa143q0a1)**'
  id: totrans-86
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[1](kindle_split_056.html#app01qa143q0a1)**'
- en: ''
  id: totrans-87
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: To check that a value is `False`
  id: totrans-88
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 检查一个值是否为`False`
- en: '**[2](kindle_split_056.html#app01qa143q0a2)**'
  id: totrans-89
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[2](kindle_split_056.html#app01qa143q0a2)**'
- en: ''
  id: totrans-90
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: To check that a value is in a list
  id: totrans-91
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 检查一个值是否在列表中
- en: '**[3](kindle_split_056.html#app01qa143q0a3)**'
  id: totrans-92
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[3](kindle_split_056.html#app01qa143q0a3)**'
- en: ''
  id: totrans-93
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: To check that two dictionaries are equal
  id: totrans-94
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 检查两个字典是否相等
- en: '|  |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 36.3\. Debugging your code
  id: totrans-96
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 36.3. 调试你的代码
- en: The process of debugging code is somewhat an art form in that there’s no specific
    formula for how to do it. The process begins after you have a set of tests that
    have failed. These tests offer a starting point for where to look in the code
    and under what specific conditions; you have a set of inputs you gave to a function,
    which gave you output that wasn’t what you expected.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 调试代码的过程在某种程度上是一种艺术形式，因为没有一个特定的公式来指导如何进行。这个过程在你有一组失败的测试之后开始。这些测试为你提供了一个在代码中查找的位置和具体条件；你给一个函数提供了一组输入，该函数给出了你预期的输出。
- en: Often, a brute-force solution for debugging is most efficient; this means being
    systematic about looking at every line, and using a pen and paper to note values.
    Starting with the inputs that caused the test to fail, pretend you’re the computer
    and execute each line. Write down what values are assigned to each variable, and
    ask yourself whether that’s correct. As soon as you find an incorrect value being
    calculated from what you expect, you’ve likely found where an error is occurring.
    Now it’s up to you to figure out why the error is occurring, using what you’ve
    learned.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，调试的一个暴力解决方案是最有效的；这意味着系统地查看每一行，并使用笔和纸来记录值。从导致测试失败的原因开始，假装你是计算机，执行每一行。写下分配给每个变量的值，并问问自己这是否正确。一旦你发现从你期望的值中计算出的错误值，你很可能已经找到了错误发生的地方。现在，你需要根据你所学到的知识来找出错误发生的原因。
- en: As you’re tracing through your program by going line by line, a common mistake
    is to assume that simple lines of code are correct, especially if you’re debugging
    your own code. Be skeptical of every line. Pretend that you’re explaining your
    code to someone who doesn’t know anything about programming. This process is called
    *rubber ducky debugging*, which means you explain your code to a real (or imaginary)
    rubber duck, or any other inanimate object. This forces you to explain the code
    in plain English, not programming jargon, and gets you to tell your helper what
    each line of code is trying to accomplish.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 当你逐行跟踪程序时，一个常见的错误是假设简单的代码行是正确的，特别是如果你正在调试自己的代码。对每一行都持怀疑态度。假装你正在向一个对编程一无所知的人解释你的代码。这个过程被称为*橡皮鸭调试*，这意味着你向一个真实（或想象）的橡皮鸭或任何其他非生命物体解释你的代码。这迫使你用普通的英语而不是编程术语来解释代码，并让你告诉你的助手每一行代码试图完成什么。
- en: 36.3.1\. Using tools to help you step through code
  id: totrans-100
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 36.3.1. 使用工具帮助你逐步执行代码
- en: Many tools have been designed to help make your debugging process easier. A
    debugger is built into Spyder. The name is misleading because it doesn’t do the
    debugging for you. Rather, it prints variable values for you with each step you
    take. It’s still up to you to determine why a line of code is incorrect when the
    value for a variable isn’t what you expect it to be. A debugger can be used on
    any code that you write.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 已经设计了许多工具来帮助你使调试过程更容易。Spyder内置了一个调试器。这个名字有点误导，因为它不会为你进行调试。相反，它会随着你每一步的操作为你打印变量值。当变量的值不是你期望的时，你仍然需要自己确定代码中哪一行是错误的。你可以对任何你写的代码使用调试器。
- en: 'You can use the Spyder debugger to identify the problem with the code shown
    in [listing 36.2](#ch36ex02), using the test created in [listing 36.3](#ch36ex03).
    You know that two tests failed: `test_abs_0` and `test_prime_5`. You should debug
    each one separately.'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用Spyder调试器来识别[列表36.2](#ch36ex02)中显示的代码的问题，使用[列表36.3](#ch36ex03)中创建的测试。你知道有两个测试失败了：`test_abs_0`和`test_prime_5`。你应该分别单独调试每一个。
- en: You’ll now debug `test_abs_0`. [Figure 36.1](#ch36fig01) shows what your Spyder
    editor should look like after you’ve opened tests.py. You have the editor on the
    left, the IPython console on the bottom right, and the variable explorer at the
    top right.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你将调试`test_abs_0`。[图36.1](#ch36fig01)显示了在打开tests.py后你的Spyder编辑器应该看起来是什么样子。你左边有编辑器，右下角是IPython控制台，右上角是变量浏览器。
- en: Figure 36.1\. Screenshot of the debugging window
  id: totrans-104
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图36.1. 调试窗口截图
- en: '![](images/36fig01_alt.jpg)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![](images/36fig01_alt.jpg)'
- en: The first step is to put a breakpoint in your code (#1 in [figure 36.1](#ch36fig01)).
    A breakpoint indicates a spot in the code where you’d like to stop execution so
    that you can inspect the value. Because the test `test_abs_0` failed, put a breakpoint
    at the first line inside that method. You can insert a breakpoint by double-clicking
    the area just to the left on the line on which you want to put the breakpoint;
    a dot appears.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是在你的代码中设置一个断点（[图36.1](#ch36fig01)中的#1）。断点表示代码中的一个位置，你希望在这里停止执行以便检查值。因为测试`test_abs_0`失败了，所以在那个方法的第一行设置一个断点。你可以在想要设置断点的行的左侧双击区域来插入一个断点；会出现一个点。
- en: 'Then, you can start running the program in debugging mode. You do this by clicking
    the button with the blue arrow and two vertical lines (#2 in [figure 36.1](#ch36fig01)).
    The console now shows you the first few lines of the code and an arrow, ----->,
    indicating which line is to be executed:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，你可以以调试模式开始运行程序。这是通过点击带有蓝色箭头和两条垂直线的按钮来完成的（[图36.1](#ch36fig01)中的#2）。现在控制台会显示代码的前几行和一个箭头，----->，指示要执行哪一行：
- en: '[PRE8]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Click the blue double arrows (#4 in [figure 36.1](#ch36fig01)) to go to the
    breakpoint you put in. Now, the console shows where you are in the code:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 点击蓝色双箭头（[图36.1](#ch36fig01)中的#4）以转到你设置的断点。现在，控制台显示了你在代码中的位置：
- en: '[PRE9]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'You’d like to go into the function to see why the value for `absolute` isn’t
    0 and this test fails. Click the button with the small blue arrow that goes into
    three horizontal lines to “step into” the function (#3 in [figure 36.1](#ch36fig01)).
    Now you’re inside the function call. Your variable explorer window should show
    you that the value for `n` is 0, and the console shows that you’ve just entered
    the function call:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 你想进入函数中查看为什么`absolute`的值不是0并且这个测试失败了。点击带有小蓝色箭头并指向三条水平线的按钮以“进入”函数（[图36.1](#ch36fig01)中的#3）。现在你已经在函数调用内部了。你的变量浏览器窗口应该显示`n`的值是0，控制台显示你已经进入了函数调用：
- en: '[PRE10]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: If you click the Step Into button two more times, it takes you to the line
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你再点击两次“进入”按钮，它将带你到那一行
- en: '[PRE11]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: At this point, you can see what’s wrong. The `if` statement isn’t executed because
    `n` is 0\. The `else` statement also isn’t executed because `n` is 0\. You’ve
    likely figured out the issue and can now exit debugging by clicking the blue square.
    The function returns `None` because no case handles what the program should do
    when `n` is 0.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，你可以看到问题所在。`if`语句没有执行，因为`n`是0。`else`语句也没有执行，因为`n`是0。你很可能已经找到了问题，现在可以通过点击蓝色方块退出调试。函数返回`None`，因为没有处理当`n`为0时程序应该做什么的情况。
- en: '|  |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**Quick check 36.4**'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '**快速检查36.4**'
- en: 'Use the debugger to debug the other test case that fails, `test_prime_5`:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 使用调试器调试其他失败的测试用例`test_prime_5`：
- en: '**[1](kindle_split_056.html#app01qa144q0a1)**'
  id: totrans-119
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[1](kindle_split_056.html#app01qa144q0a1)**'
- en: ''
  id: totrans-120
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Set a breakpoint at an appropriate line.
  id: totrans-121
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在适当的行设置一个断点。
- en: '**[2](kindle_split_056.html#app01qa144q0a2)**'
  id: totrans-122
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[2](kindle_split_056.html#app01qa144q0a2)**'
- en: ''
  id: totrans-123
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Run the debugger; go to the breakpoint.
  id: totrans-124
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 运行调试器；转到断点。
- en: '**[3](kindle_split_056.html#app01qa144q0a3)**'
  id: totrans-125
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[3](kindle_split_056.html#app01qa144q0a3)**'
- en: ''
  id: totrans-126
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Step into the function call and keep stepping through the program until you
    see the issue.
  id: totrans-127
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 进入函数调用，并继续逐步通过程序，直到看到问题。
- en: '|  |'
  id: totrans-128
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Summary
  id: totrans-129
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 摘要
- en: In this lesson, my goal was to teach you the basics of testing and debugging
    and to give you more practice at importing and using libraries. I showed you how
    to use the unittest library to organize your tests and the importance of separating
    the code from the testing framework. You used a debugger to step through your
    code.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节课中，我的目标是教你们测试和调试的基础知识，并让你们在导入和使用库方面有更多的实践机会。我展示了如何使用unittest库来组织测试，以及将代码与测试框架分离的重要性。你们使用调试器逐步执行了代码。
- en: Let’s see if you got this...
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 看看你是否掌握了这个...
- en: '**[Q36.1](kindle_split_056.html#app01qa145q0a1)**'
  id: totrans-132
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[Q36.1](kindle_split_056.html#app01qa145q0a1)**'
- en: ''
  id: totrans-133
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Here’s a buggy program. Write unit tests and try to debug it:'
  id: totrans-134
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 这里有一个有问题的程序。编写单元测试并尝试调试它：
- en: ''
  id: totrans-135
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-136
  prefs:
  - PREF_BQ
  type: TYPE_PRE
  zh: '[PRE12]'
