- en: 6 Basic graphs
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 6 基本图表
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Plotting data with bar, box, and dot plots
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用条形图、箱线图和点图绘制数据
- en: Creating pie charts and tree maps
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建饼图和树状图
- en: Using histograms and kernel density plots
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用直方图和核密度图
- en: Whenever we analyze data, the first thing we should do is *look* at it. For
    each variable, what are the most common values? How much variability is present?
    Are there any unusual observations? R provides a wealth of functions for visualizing
    data. In this chapter, we’ll look at graphs that help you understand a single
    categorical or continuous variable. This topic includes
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 每当我们分析数据时，我们首先应该做的是*查看*它。对于每个变量，最常见的值是什么？存在多少可变性？是否有任何异常观测值？R提供了丰富的数据可视化函数。在本章中，我们将探讨有助于您理解单个分类或连续变量的图表。这个主题包括
- en: Visualizing the distribution of a variable
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可视化变量的分布
- en: Comparing the distribution of a variable across two or more groups
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 比较两个或多个组中变量的分布
- en: In both cases, the variable can be continuous (for example, car mileage as miles
    per gallon) or categorical (for example, treatment outcome as none, some, or marked).
    In later chapters, we’ll explore graphs that display more complex relationships
    among variables.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在这两种情况下，变量可以是连续的（例如，汽车里程作为每加仑英里数）或分类的（例如，治疗结果作为无、一些或明显）。在后面的章节中，我们将探讨显示变量之间更复杂关系的图表。
- en: The following sections explore the use of bar charts, pie charts, tree maps,
    histograms, kernel density plots, box plots, violin plots, and dot plots. Some
    of these may be familiar to you, whereas others (such as tree charts or violin
    plots) may be new. The goal, as always, is to understand your data better and
    to communicate this understanding to others. Let’s start with bar charts.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 以下章节探讨了条形图、饼图、树状图、直方图、核密度图、箱线图、小提琴图和点图的用法。其中一些可能您已经熟悉，而其他一些（如树状图或小提琴图）可能对您来说是新的。目标，一如既往，是更好地理解您的数据，并将这种理解传达给他人。让我们从条形图开始。
- en: 6.1 Bar charts
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6.1 条形图
- en: A bar plot displays the distribution (frequency) of a categorical variable through
    vertical or horizontal bars. Using the `ggplot2` package, we can create a bar
    chart using the code
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 条形图通过垂直或水平条形显示分类变量的分布（频率）。使用`ggplot2`包，我们可以使用以下代码创建条形图
- en: '[PRE0]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: where `data` is a data frame and `catvar` is a categorical variable.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 其中`data`是一个数据框，`catvar`是一个分类变量。
- en: In the following examples, you’ll plot the outcome of a study investigating
    a new treatment for rheumatoid arthritis. The data is contained in the `Arthritis`
    data frame distributed with the `vcd` package. This package isn’t included in
    the default R installation, so install it before first use (`install.packages("vcd")`).
    Note that the `vcd` package isn’t needed to create bar charts. You’re installing
    it to gain access to the `Arthritis` dataset.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下示例中，您将绘制一项研究新治疗类风湿性关节炎的结果。数据包含在`vcd`包中分发的`Arthritis`数据框中。此包不包括在默认R安装中，因此在使用之前请安装它（`install.packages("vcd")`）。请注意，`vcd`包不是创建条形图所必需的。您安装它是为了访问`Arthritis`数据集。
- en: 6.1.1 Simple bar charts
  id: totrans-15
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.1.1 简单条形图
- en: 'In the Arthritis study, the variable `Improved` records the patient outcomes
    for individuals receiving a placebo or drug:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在关节炎研究中，变量`Improved`记录了接受安慰剂或药物的患者结果：
- en: '[PRE1]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Here, you see that 28 patients showed marked improvement, 14 showed some improvement,
    and 42 showed no improvement. We’ll discuss the use of the `table()` function
    to obtain cell counts more fully in chapter 7.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，您可以看到28名患者显示出明显的改善，14名患者显示出一些改善，而42名患者没有改善。我们将在第7章中更全面地讨论使用`table()`函数来获取单元格计数。
- en: You can graph these counts using a vertical or horizontal bar chart. The following
    listing shows the code, and figure 6\. 1 displays the resulting graphs.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用垂直或水平条形图来绘制这些计数。以下列表显示了代码，图6.1显示了生成的图形。
- en: Listing 6.1  Simple bar charts
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 列表6.1 简单条形图
- en: '[PRE2]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: ❶ Simple bar chart
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 简单条形图
- en: ❷ Horizontal bar chart
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 水平条形图
- en: '![](Images/CH06_F01_Kabacoff3.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F01_Kabacoff3.png)'
- en: Figure 6.1 Simple vertical and horizontal bar charts
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.1 简单的垂直和水平条形图
- en: What happens if you have long labels? In section 6.1.4, you’ll see how to tweak
    labels so they don’t overlap.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您有很长的标签会发生什么？在第6.1.4节中，您将看到如何调整标签以避免重叠。
- en: 6.1.2 Stacked, grouped, and filled bar charts
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.1.2 堆叠、分组和填充条形图
- en: 'The central question in the Arthritis study is, “How does the level of improvement
    vary between the placebo and treated conditions?” The `table()` function can used
    to generate a cross-tabulation of the variables:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 关节炎研究中的核心问题是，“安慰剂组和治疗组的改善水平之间是如何变化的？”`table()`函数可以用来生成变量的交叉表：
- en: '[PRE3]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: While the tabulation is helpful, the results are easier to grasp with a bar
    chart. The relationship between two categorical variables can be plotted using
    *stacked*, *grouped*, or *filled* bar charts. The next listing provides the code,
    and figure 6.2 displays the graph.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然交叉表很有帮助，但条形图使结果更容易理解。两个分类变量之间的关系可以用*堆叠*、*分组*或*填充*条形图来绘制。接下来的列表提供了代码，图6.2显示了图表。
- en: Listing 6.2  Stacked, grouped, and filled bar charts
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 列表6.2  堆叠、分组和填充条形图
- en: '[PRE4]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: ❶ Stacked bar chart
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 堆叠条形图
- en: ❷ Grouped bar chart
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 分组条形图
- en: ❸ Filled bar chart
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 填充条形图
- en: In the stacked bar chart, each segment represents the frequency or proportion
    of cases within a given Treatment (Placebo, Treated) and Improvement (None, Some,
    Marked) level combination. The segments are stacked separately for each Treatment
    level. The grouped bar chart places the segments representing Improvement side
    by side within each Treatment level. The filled bar chart is a stacked bar chart
    rescaled so that the height of each bar is 1 and the segment heights represent
    proportions.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在堆叠条形图中，每个部分代表给定治疗（安慰剂、治疗）和改善（无、一些、显著）水平组合内案例的频率或比例。每个治疗水平分别堆叠这些部分。分组条形图在每个治疗水平内将代表改善的部分并排放置。填充条形图是一个重新缩放的堆叠条形图，使得每个条形的高度为1，部分高度代表比例。
- en: Filled bar charts are particularly useful for comparing the proportions of one
    categorical variable over the levels of another categorical variable. For example,
    the filled bar chart in figure 6.2 clearly displays the larger percentage of treated
    patients with marked improvement compared with patients receiving a placebo.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 填充条形图特别适用于比较一个分类变量的比例在另一个分类变量的水平上的变化。例如，图6.2中的填充条形图清楚地显示了与接受安慰剂的病人相比，有显著改善的治疗病人的比例更高。
- en: '![](Images/CH06_F02_Kabacoff3.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F02_Kabacoff3.png)'
- en: Figure 6.2 Stacked, grouped, and filled bar charts
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.2 堆叠、分组和填充条形图
- en: 6.1.3 Mean bar charts
  id: totrans-40
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.1.3 平均条形图
- en: Bar plots needn’t be based on counts or frequencies. You can create bar charts
    that represent means, medians, percentages, standard deviations, and so forth
    by summarizing the data with an appropriate statistic and passing the results
    to `ggplot2`.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 条形图不必基于计数或频率。你可以通过使用适当的统计量总结数据，并将结果传递给`ggplot2`来创建表示平均值、中位数、百分比、标准差等条形图。
- en: In the following graph, we’ll plot the mean illiteracy rate for regions of the
    United States in 1970\. The built-in R dataset `state.x77` has the illiteracy
    rates by state, and the dataset `state.region` has the region names for each state.
    The following listing provides the code needed to create the graph in figure 6.3.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下图表中，我们将绘制1970年美国各地区的平均文盲率。内置的R数据集`state.x77`包含了各州的文盲率，数据集`state.region`包含了各州的地区名称。以下列表提供了创建图6.3中图表所需的代码。
- en: Listing 6.3  Bar chart for sorted mean values
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 列表6.3  按排序平均值绘制的条形图
- en: '[PRE5]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: ❶ Generates means by region
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 按地区生成平均值
- en: ❷ Plots means in a sorted bar chart
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 在排序条形图中绘制平均值
- en: '![](Images/CH06_F03_Kabacoff3.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F03_Kabacoff3.png)'
- en: Figure 6.3 Bar chart of mean illiteracy rates for US regions sorted by rate
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.3 按文盲率排序的美国地区平均文盲率条形图
- en: First, the mean illiteracy rate is calculated for each region ❶. Next, the means
    are sorted in ascending order and plotted as bars ❷. Normally, the `geom_bar()`
    function calculates and plots cell counts, but adding the `stat="identity"` option
    forces the function to plot the numbers provided (means, in this case). The `reorder()`
    function is used to order the bars by increasing mean illiteracy.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，计算每个地区的平均文盲率 ❶。接下来，按升序排序平均值，并以条形的形式绘制 ❷。通常，`geom_bar()`函数计算并绘制单元格计数，但添加`stat="identity"`选项会强制函数绘制提供的数字（在这种情况下是平均值）。使用`reorder()`函数按递增的平均文盲率对条形进行排序。
- en: When plotting summary statistics such as means, it’s good practice to indicate
    the variability of the estimates involved. One measure of variability is the standard
    error of the statistic—an estimate of the expected variation of the statistic
    across hypothetical repeated samples. The following plot (figure 6.4) adds error
    bars using the standard error of the mean.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 当绘制均值等汇总统计量时，指出涉及估计的变异性是一种良好的做法。变异性的一种度量是统计量的标准误差——对统计量在假设重复样本中预期变化的估计。以下图形（图6.4）使用均值的标准误差添加了误差线。
- en: Listing 6.4  Bar chart of mean values with error bars
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 列表6.4  带有误差线的均值条形图
- en: '[PRE6]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: ❶ Generates means and standard errors by region
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 按地区生成均值和标准误差
- en: ❷ Plots means in a sorted bar chart
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 在排序条形图中绘制均值
- en: ❸ Adds error bars
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 添加误差线
- en: The means and standard errors are calculated for each region ❶. The bars are
    then plotted in order of increasing illiteracy. The color is changed from a default
    dark grey to a lighter shade (sky blue) so that error bars that will be added
    in the next step will stand out ❷. Finally, the error bars are plotted ❸. The
    `width` option in the `geom_ errorbar()` function controls the horizontal width
    of the error bars and is purely aesthetic—it has no statistical meaning. In addition
    to displaying the mean illiteracy rates, we can see that the mean for the North
    Central region is the most reliable (least variability) and the mean for the West
    region is least reliable (largest variability).
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 为每个地区计算了均值和标准误差 ❶。然后按文盲率升序绘制条形。颜色从默认的深灰色变为较浅的色调（天蓝色），以便在下一步添加的误差线更加突出 ❷。最后，绘制误差线
    ❸。`geom_errorbar()`函数中的`width`选项控制误差线的水平宽度，纯粹是美学上的——它没有统计意义。除了显示平均文盲率外，我们还可以看到，中北部地区的均值最可靠（变异性最小），而西部地区的均值最不可靠（变异性最大）。
- en: '![](Images/CH06_F04_Kabacoff3.png)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F04_Kabacoff3.png)'
- en: Figure 6.4 Bar chart of mean illiteracy rates for US regions sorted by rate.
    The standard error of the mean has been added to each bar.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.4 按比率排序的美国地区平均文盲率条形图。每个条形都添加了均值的标准误差。
- en: 6.1.4 Tweaking bar charts
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.1.4 调整条形图
- en: There are several ways to tweak the appearance of a bar chart. The most common
    are customizing the bar colors and labels. We’ll look at each in turn.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种方法可以调整条形图的外观。最常见的是自定义条形颜色和标签。我们将逐一查看。
- en: Bar chart colors
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 条形图颜色
- en: Custom colors can be selected for the bar areas and borders. In the `geom_bar()`
    function, the option `fill="color"` assigns a color for the area, while `color
    ="color"` assigns a color for the border.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 可以为条形图的区域和边框选择自定义颜色。在`geom_bar()`函数中，选项`fill="color"`为区域分配颜色，而`color="color"`为边框分配颜色。
- en: Fill vs. color
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 填充与颜色
- en: In general, `ggplot2` uses fill to specify the color of geometric objects that
    have area (such as bars, pie slices, boxes) and color when referring to the color
    of geometric objects without area (such as lines, points, and borders).
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，`ggplot2`使用填充来指定具有面积（如条形、饼图切片、箱形）的几何对象的颜色，当提到没有面积（如线条、点和边框）的几何对象的颜色时使用颜色。
- en: For example, the code
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，以下代码
- en: '[PRE7]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: produces the graph in figure 6.5.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 生成图6.5中的图形。
- en: '![](Images/CH06_F05_Kabacoff3.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F05_Kabacoff3.png)'
- en: Figure 6.5 Bar chart with custom fill and border colors
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.5 带有自定义填充和边框颜色的条形图
- en: In the previous example, single colors were assigned. Colors can also be mapped
    to the levels of a categorical variable. For example, the code
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一个示例中，分配了单色。颜色也可以映射到分类变量的级别。例如，以下代码
- en: '[PRE8]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: produces the graph in figure 6.6.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 生成图6.6中的图形。
- en: '![](Images/CH06_F06_Kabacoff3.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F06_Kabacoff3.png)'
- en: Figure 6.6 Stacked bar chart with custom fill colors mapped to Improvement
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.6 按改进映射的自定义填充颜色的堆叠条形图
- en: Here, bar fill colors are mapped to the levels of the variable `Improved`. The
    `scale_ fill_manual()` function specifies red for `None`, grey for `Some`, and
    gold for `Marked` improvement. Color names can be obtained from [http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf](http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf).
    Chapter 19 discusses other methods of selecting colors.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，条形填充颜色映射到变量`Improved`的级别。`scale_fill_manual()`函数指定`None`为红色，`Some`为灰色，`Marked`
    improvement为金色。颜色名称可以从[http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf](http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf)获取。第19章讨论了选择颜色的其他方法。
- en: Bar chart labels
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 条形图标签
- en: When there are many bars or long labels, bar chart labels tend to overlap and
    become unreadable. Consider the following example. The dataset `mpg` in the `ggplot2`
    package describes fuel economy data for 38 popular car models in 1999 and 2008\.
    Each model has several configurations (transmission type, number of cylinders,
    etc.). Let’s say that we want a count of how many instances of each model are
    in the dataset. The code
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 当有多个条形或长标签时，条形图标签往往会重叠并变得难以阅读。考虑以下示例。`ggplot2`包中的`mpg`数据集描述了1999年和2008年38种流行汽车模型的燃油经济数据。每个模型都有几种配置（传动类型、气缸数量等）。假设我们想要统计数据集中每种模型的实例数量。以下代码
- en: '[PRE9]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: produces the graph in figure 6.7.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 生成图6.7。
- en: '![](Images/CH06_F07_Kabacoff3.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH06_F07_Kabacoff3.png)'
- en: Figure 6.7 Bar chart with overlapping labels
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.7 带重叠标签的条形图
- en: 'Even with my glasses (or a glass of wine), I can’t read this. Two simple tweaks
    will make the labels readable. First, we can plot the data as a horizontal bar
    chart (figure 6.8):'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 即使戴上眼镜（或一杯酒），我也无法阅读这个。两个简单的调整可以使标签可读。首先，我们可以将数据作为水平条形图绘制（图6.8）：
- en: '[PRE10]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](Images/CH06_F08_Kabacoff3.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH06_F08_Kabacoff3.png)'
- en: Figure 6.8 A horizontal bar chart avoids label overlap.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.8 水平条形图避免标签重叠。
- en: 'Second, we can angle the label text and use a smaller font (figure 6.9):'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 第二，我们可以倾斜标签文本并使用较小的字体（图6.9）：
- en: '[PRE11]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](Images/CH06_F09_Kabacoff3.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH06_F09_Kabacoff3.png)'
- en: Figure 6.9 Bar chart with angled labels and a smaller label font
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.9 倾斜标签文本和较小标签字体的条形图
- en: Chapter 19 discusses the `theme()` function more fully. In addition to bar charts,
    pie charts are popular vehicles for displaying the distribution of a categorical
    variable. We’ll consider them next.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 第19章更详细地讨论了`theme()`函数。除了条形图外，饼图也是显示分类变量分布的流行工具。我们将在下一节考虑它们。
- en: 6.2 Pie charts
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6.2 饼图
- en: Pie charts are ubiquitous in the business world, but they’re denigrated by most
    statisticians, including the authors of the R documentation. They recommend bar
    or dot plots over pie charts because people are able to judge length more accurately
    than volume. Perhaps for this reason, the pie chart options in R are severely
    limited compared with other statistical platforms.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 饼图在商业世界中无处不在，但大多数统计学家，包括R文档的作者，都对其不屑一顾。他们推荐使用条形图或点图而不是饼图，因为人们能够更准确地判断长度而不是体积。也许正因为如此，R中的饼图选项与其他统计平台相比严重受限。
- en: However, there are times when pie charts can be useful. In particular, they
    can capture part-whole relationships well. For example, a pie chart can be used
    to display the percentage of tenured faculty at a university who are female.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，有时饼图是有用的。特别是，它们可以很好地捕捉部分与整体的关系。例如，饼图可以用来显示大学中终身教授中女性的百分比。
- en: 'You can create a pie chart in base R using the `pie()` function, but as I’ve
    said, the functionality is limited, and the plots are unattractive. To address
    this, I’ve created a package called `ggpie` that allows you to create a wide variety
    of pie charts using `ggplot2` (no flame emails, please!). You can install it from
    my GitHub repository with the following code:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用`pie()`函数在基础R中创建饼图，但正如我所说的，功能有限，且图形不吸引人。为了解决这个问题，我创建了一个名为`ggpie`的包，允许您使用`ggplot2`创建各种饼图（请勿发送愤怒邮件！）。您可以使用以下代码从我的GitHub仓库安装它：
- en: '[PRE12]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The basic syntax is
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 基本语法是
- en: '[PRE13]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: where
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 其中
- en: '`data` is a data frame.'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`data`是数据框。'
- en: '`x` is the categorical variable to be plotted.'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`x`是要绘制的分类变量。'
- en: '`by` is an optional second categorical variable. If present, a pie will be
    produced for each level of this variable.'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`by`是可选的第二分类变量。如果存在，将为该变量的每个级别生成一个饼图。'
- en: '`offset` is the distance of the pie slice labels from the origin. A value of
    `0.5` will place the labels in the center of the slices, and a value greater than
    `1.0` will place them outside the slice.'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`offset`表示饼图标签与原点的距离。值为`0.5`时，标签将放置在切片的中心，而值大于`1.0`时，标签将放置在切片外部。'
- en: '`percent` is logical. If `FALSE`, percentage printing is suppressed.'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`percent`是逻辑值。如果为`FALSE`，则抑制百分比打印。'
- en: '`legend` is logical. If `FALSE`, the legend is omitted, and each pie slice
    is labeled.'
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`legend`是逻辑值。如果为`FALSE`，则省略图例，每个饼图切片将进行标注。'
- en: '`title` is an option title.'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`title`是可选的标题。'
- en: 'Additional options (described on the `ggpie` website) allow you to customize
    the pie chart’s appearance. Let’s create a pie chart displaying the distribution
    of car classes in the `mpg` data frame:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 其他选项（在`ggpie`网站上描述）允许您自定义饼图的外观。让我们创建一个显示`mpg`数据集中汽车类别分布的饼图：
- en: '[PRE14]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Figure 6.10 shows the results. From the graph, we see that 26% percent of cars
    are SUVS, while only 2% are two-seaters.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.10显示了结果。从图中我们可以看到，26%的汽车是SUV，而只有2%是双座车。
- en: '![](Images/CH06_F10_Kabacoff3.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F10_Kabacoff3.png)'
- en: Figure 6.10 Pie chart displaying the percentage of each car class in the `mpg`
    data frame
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.10 显示`mpg`数据帧中每个汽车类别的百分比的饼图
- en: 'In the next version (figure 6.11), the legend is removed, and each pie slice
    is labeled. In addition, the labels are placed outside the pie area, and a title
    is added:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个版本（图6.11）中，移除了图例，并为每个饼图切片添加了标签。此外，标签放置在饼图区域外，并添加了一个标题：
- en: '[PRE15]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](Images/CH06_F11_Kabacoff3.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F11_Kabacoff3.png)'
- en: Figure 6.11 Pie chart with labels displayed outside the pie
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.11 饼图标签显示在饼图外
- en: In the final example (figure 6.12), the distribution of car class is displayed
    by year.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后的例子（图6.12）中，按年份显示了汽车类别的分布。
- en: '[PRE16]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![](Images/CH06_F12_Kabacoff3.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F12_Kabacoff3.png)'
- en: Figure 6.12 Pie charts displaying the distribution of car classes by year
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.12 按年份显示汽车类别分布的饼图
- en: Between 1999 and 2008, the distribution of car classes appears to have remained
    rather constant. The `ggpie` package can create more complex and customized pie
    charts. See the documentation ([https://rkabacoff.github.io/ggpie](https://rkabacoff.github.io/ggpie))
    for details.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在1999年至2008年之间，汽车类别的分布似乎保持相当稳定。`ggpie`包可以创建更复杂和定制的饼图。有关详细信息，请参阅文档([https://rkabacoff.github.io/ggpie](https://rkabacoff.github.io/ggpie))。
- en: 6.3 Tree maps
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6.3 树状图
- en: An alternative to a pie chart is a tree map, which displays the distribution
    of a categorical variable using rectangles that are proportional to variable levels.
    We’ll create tree maps using the `treemapify` package. Be sure to install it before
    proceeding (`install.packages("treemapify")`).
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 饼图的一个替代方案是树状图，它使用与变量级别成比例的矩形来显示分类变量的分布。我们将使用`treemapify`包创建树状图。在继续之前，请确保安装它（`install.packages("treemapify")`）。
- en: We’ll start by creating a tree map displaying the distribution of car manufacturers
    in the `mpg` data frame. The following listing shows the code, and figure 6.13
    shows the resulting graph.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先创建一个显示`mpg`数据帧中汽车制造商分布的树状图。以下列表显示了代码，图6.13显示了生成的图表。
- en: Listing 6.5  Simple tree map
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 列表6.5  简单的树状图
- en: '[PRE17]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: ❶ Summarizes the data
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 总结数据
- en: ❷ Creates the tree map
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 创建树状图
- en: First, we calculate the frequency counts for each level of the `manufacturer`
    variable ❶. This information is passed to `ggplot2` to create the graph ❷. In
    the `aes()` function, `fill` refers to the categorical variable, `area` is the
    count for each level, and `label` is the option variable used to label the cells.
    The `geom_treemap()` function creates the tree map, and the `geom_treemap_text()`
    function adds the labels to each cell. The `theme()` function is used to suppress
    the legend, which is redundant here because each cell is labeled.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们计算`manufacturer`变量每个级别的频率计数❶。这些信息传递给`ggplot2`以创建图表❷。在`aes()`函数中，`fill`指的是分类变量，`area`是每个级别的计数，而`label`是用于标记单元格的选项变量。`geom_treemap()`函数创建树状图，`geom_treemap_text()`函数为每个单元格添加标签。`theme()`函数用于抑制图例，在这里它是多余的，因为每个单元格都有标签。
- en: '![](Images/CH06_F13_Kabacoff3.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F13_Kabacoff3.png)'
- en: Figure 6.13 Tree map displaying the distribution of car manufacturers in the
    `mpg` dataset. Rectangle size is proportional to the number of cars from each
    manufacturer.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.13 显示`mpg`数据集中汽车制造商分布的树状图。矩形大小与每个制造商的汽车数量成比例。
- en: As you can see, a tree map can be used to visualize a categorical variable with
    *many* levels (unlike a pie chart). In the next example, a second variable is
    added—`drivetrain`. The number of cars by manufacturer is plotted for front-wheel,
    rear-wheel, and four-wheel drives. The next listing provides the code, and figure
    6.14 shows the plot.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，树状图可以用来可视化具有*许多*级别的分类变量（与饼图不同）。在下一个例子中，添加了第二个变量——`drivetrain`。绘制了前轮驱动、后轮驱动和四轮驱动的制造商的汽车数量。下一个列表提供了代码，图6.14显示了该图。
- en: Listing 6.6  Tree map with subgrouping
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 列表6.6  具有子分组的树状图
- en: '[PRE18]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: ❶ Computes cell counts
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 计算单元格计数
- en: ❷ Provides better labels for drivetrains
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 提供了更好的传动系统标签
- en: ❸ Creates tree map
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 创建树状图
- en: First, the frequencies for each manufacturer-drivetrain combination are calculated
    ❶. Next, better labels are provided for the `drivetrain` variable ❷. The new data
    frame is passed to `ggplot2` to produce the tree map ❸. The subgroup option in
    the `aes()` function creates separate subplots for each `drivetrain` type. The
    `geom_treemap_ border()` and `geom_treemap_subgroup_text()` add borders and labels
    for the subgroups, respectively. Options in each function control their appearance.
    The subgroup text is centered and given some transparency (`alpha=0.5`). The text
    font remains a constant size, rather than growing to fill the area (`grow=FALSE`).
    The tree map cell text is printed in a white font, centered in each cell, and
    does not grow to fill the boxes.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，计算每个制造商-驱动方式组合的频率 ❶。接下来，为`drivetrain`变量提供更好的标签 ❷。将新的数据框传递给`ggplot2`以生成树状图
    ❸。`aes()`函数中的子组选项为每种`drivetrain`类型创建单独的子图。`geom_treemap_border()`和`geom_treemap_subgroup_text()`分别添加子组的边框和标签。每个函数中的选项控制其外观。子组文本居中，并赋予一定的透明度（`alpha=0.5`）。文本字体保持恒定大小，而不是填充区域（`grow=FALSE`）。树状图单元格文本以白色字体打印，在每个单元格中居中，并且不会填充盒子。
- en: From the graph in figure 6.14, it is clear, for example, that Hyundai has front-wheel-drive
    cars, but not rear-wheel- or four-wheel-drive cars. The manufacturers with rear-wheel-drive
    cars are primarily Ford and Chevrolet. Many of the four-wheel-drive cars are made
    by Dodge.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 从图6.14的图形中可以看出，例如，现代有前轮驱动汽车，但没有后轮驱动或四轮驱动汽车。主要拥有后轮驱动汽车的生产商是福特和雪佛兰。许多四轮驱动汽车由道奇制造。
- en: '![](Images/CH06_F14_Kabacoff3.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F14_Kabacoff3.png)'
- en: Figure 6.14 Tree map with car manufacturers by drive-train type
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.14 按驱动方式分类的汽车制造商树状图
- en: Now that we’ve covered pie charts and tree maps, let’s move on to histograms.
    Unlike bar charts, pie charts, and tree maps, histograms describe the distribution
    of a continuous variable.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经介绍了饼图和树状图，让我们继续讨论直方图。与条形图、饼图和树状图不同，直方图描述了连续变量的分布。
- en: 6.4 Histograms
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6.4 直方图
- en: Histograms display the distribution of a continuous variable by dividing the
    range of scores into a specified number of bins on the x-axis and displaying the
    frequency of scores in each bin on the y-axis. You can create histograms using
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图通过将分数范围分为指定数量的箱，并在x轴上显示每个箱的频率，来显示连续变量的分布。您可以使用以下方式创建直方图：
- en: '[PRE19]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: where `data` is a data frame and `contvar` is a continuous variable. Using the
    `mpg` datasets in the `ggplot` package, we’ll examine the distribution of city
    miles per gallon (`cty`) for 117 automobile configurations in 2008\. The following
    listing creates four variations of a histogram, and figure 6.15 shows the resulting
    graphs.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 其中`data`是一个数据框，`contvar`是一个连续变量。使用`ggplot`包中的`mpg`数据集，我们将检查2008年117种汽车配置的城市每加仑英里数（`cty`）的分布。以下列表创建了直方图的四个变体，图6.15显示了结果图形。
- en: Listing 6.7  Histograms
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 列表6.7  直方图
- en: '[PRE20]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: ❶ Simple histogram
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 简单直方图
- en: ❷ Colored histogram with 20 bins
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 带有20个箱的彩色直方图
- en: ❸ Histogram with percentages
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 带有百分比的直方图
- en: ❹ Histogram with density curve
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 带有密度曲线的直方图
- en: '![](Images/CH06_F15_Kabacoff3.png)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F15_Kabacoff3.png)'
- en: Figure 6.15 Histogram examples
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.15 直方图示例
- en: The first histogram ❶ demonstrates the default plot when no options are specified.
    In this case, 30 bins are created. For the second histogram ❷, 20 bins, a steel-blue
    fill, and a white border color are specified. In addition, more informative labels
    have been added. The number of bins can strongly influence the appearance of the
    histogram. It is a good idea to experiment with the `bins` value until you find
    one that captures the distribution well. With 20 bins, it appears that there are
    two peaks to the distribution—one around 13 mpg and one around 20.5 mpg.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个直方图 ❶ 展示了未指定任何选项时的默认绘图。在这种情况下，创建了30个箱。对于第二个直方图 ❷，指定了20个箱、深蓝色填充和白色边框颜色。此外，还添加了更详细标签。箱的数量可以显著影响直方图的外观。尝试调整`bins`值，直到找到一个能够很好地捕捉分布的值是个好主意。使用20个箱时，分布似乎有两个峰值——一个在13
    mpg左右，另一个在20.5 mpg左右。
- en: The third histogram ❸ plots the data as percentages rather than frequencies.
    This is accomplished by assigning the built-in variable `..density..` to the y-axis.
    The `scales` package is used to format the y-axis as percentages. Be sure to install
    the package (`install.packages("scales")`) before running this part of the code.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 第三个直方图 ❸ 以百分比而不是频率绘制数据。这是通过将内置变量 `..density..` 分配给 y 轴来实现的。使用 `scales` 包格式化
    y 轴为百分比。在运行此代码部分之前，请确保安装该包（`install.packages("scales")`）。
- en: The fourth histogram ❹ is similar to the previous plot but adds a density curve.
    The density curve is a kernel density estimate and is described in the next section.
    It provides a smoother description of the distribution of scores. The `geom_density()`
    function is used to plot the kernel curve in a red color and a width that’s slightly
    larger than the default thickness for lines. The density curve also suggests a
    bimodal distribution (two peaks).
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 第四个直方图 ❹ 与之前的图表相似，但增加了密度曲线。密度曲线是核密度估计，将在下一节中描述。它提供了对分数分布的更平滑的描述。使用 `geom_density()`
    函数以红色和略大于默认线条厚度的宽度绘制核曲线。密度曲线还暗示了双峰分布（两个峰值）。
- en: 6.5 Kernel density plots
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6.5 核密度图
- en: In the previous section, you saw a kernel density plot superimposed on a histogram.
    Technically, kernel density estimation is a nonparametric method for estimating
    the probability density function of a random variable. Basically, we’re trying
    to draw a smoothed histogram, where the area under the curve equals 1\. Although
    the mathematics are beyond the scope of this text, density plots can be an effective
    way to view the distribution of a continuous variable. The format for a density
    plot is
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一节中，您看到了一个叠加在直方图上的核密度图。从技术上讲，核密度估计是估计随机变量概率密度函数的非参数方法。基本上，我们试图绘制一个平滑的直方图，其中曲线下的面积等于
    1。尽管数学超出了本文的范围，但密度图可以是一种有效查看连续变量分布的方法。密度图的格式为
- en: '[PRE21]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: where `data` is a data frame and `contvar` is a continuous variable. Again,
    let’s plot the distribution of city miles per gallon (`cty`) for cars in 2008\.
    The next listing gives three kernel density examples, and figure 6.16 shows the
    results.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 `data` 是一个数据框，`contvar` 是一个连续变量。再次，让我们绘制 2008 年汽车的城市每加仑英里数（`cty`）的分布。下一列表提供了三个核密度示例，图
    6.16 显示了结果。
- en: Listing 6.8  Kernel density plots
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 6.8  核密度图
- en: '[PRE22]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: ❶ Default density plot
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 默认密度图
- en: ❷ Filled density plot
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 填充密度图
- en: ❸ Prints default bandwidth
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 打印默认带宽
- en: ❹ Density plot with smaller bandwidth
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 使用较小带宽的密度图
- en: The default kernel density plot is given first ❶. In the second example, the
    area under the curve is fill with red. The smoothness of the curve is control
    with a bandwidth parameter, which is calculated from the data being plotted ❷.
    The code `bw.nrd0(cars2008$cty)` displays this value (`1.408`) ❸. Using a larger
    bandwidth will give a smoother curve with fewer details. A smaller value will
    give a more jagged curve. The third example uses a smaller bandwidth (`bw=.5`),
    allowing us to see more detail ❹. As with the `bins` parameter for histograms,
    it is a good idea to try several bandwidth values to see which value helps you
    visualize the data most effectively.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 首先给出默认核密度图 ❶。在第二个示例中，曲线下的面积用红色填充。曲线的平滑度由带宽参数控制，该参数从正在绘制的数据中计算得出 ❷。代码 `bw.nrd0(cars2008$cty)`
    显示此值（`1.408`）❸。使用较大的带宽将给出更平滑的曲线，但细节较少。较小的值将给出更锯齿状的曲线。第三个示例使用较小的带宽（`bw=.5`），使我们能够看到更多细节
    ❹。与直方图的 `bins` 参数一样，尝试几个带宽值以查看哪个值可以帮助您最有效地可视化数据是个好主意。
- en: Kernel density plots can be used to compare groups. This is a highly underutilized
    approach, probably due to a general lack of easily accessible software. Fortunately,
    the `ggplot2` package fills this gap nicely.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 核密度图可以用于比较组。这是一个高度未被充分利用的方法，可能是因为普遍缺乏易于访问的软件。幸运的是，`ggplot2` 包很好地填补了这一空白。
- en: '![](Images/CH06_F16_Kabacoff3.png)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F16_Kabacoff3.png)'
- en: Figure 6.16 Kernel density plots
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.16 核密度图
- en: For this example, we’ll compare the 2008 city gas mileage estimates for four-,
    six-, and eight-cylinder cars. There are only a handful of cars with 5 cylinders,
    so we will drop them from the analyses. The next listing presents the code. Figures
    6.17 and 6.18 show the resulting graphs.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个例子，我们将比较四缸、六缸和八缸汽车的 2008 年城市油耗估计。只有少数几辆汽车有五缸，因此我们将它们从分析中排除。下一列表展示了代码。图 6.17
    和 6.18 显示了生成的图表。
- en: Listing 6.9  Comparative kernel density plots
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 6.9  比较核密度图
- en: '[PRE23]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: ❶ Prepares the data
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 准备数据
- en: ❷ Plots the density curves
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 绘制密度曲线
- en: ❸ Plots the filled density curves
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 绘制填充密度曲线
- en: First, a fresh copy of the data is loaded, and 2008 data for cars with four,
    six, or eight cylinders is retained ❶. The number of cylinders (`cyl`) is saved
    as a categorical factor (`Cylinders`). The transformation is required because
    `ggplot2` expects the grouping variable to be categorical (and `cyl` is stored
    as a continuous variable).
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，加载数据的副本，并保留四、六或八缸汽车2008年的数据 ❶。气缸数（`cyl`）被保存为分类因子（`Cylinders`）。这种转换是必要的，因为`ggplot2`期望分组变量是分类的（而`cyl`被存储为连续变量）。
- en: A kernel density curve is plotted for each level of the `Cylinders` variable
    ❷. Both the color (red, green, blue) and line type (solid, dotted, dashed) are
    mapped to the number of cylinders. Finally, the same plot is produced with filled
    curves ❸. Transparency is added (`alpha=0.4`), since the filled curves overlap,
    and we want to be able to see each one.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 为`Cylinders`变量的每个级别绘制一个核密度曲线 ❷。颜色（红色、绿色、蓝色）和线型（实线、点线、虚线）都映射到气缸数。最后，用填充曲线生成相同的图表
    ❸。添加了透明度（`alpha=0.4`），因为填充曲线重叠，我们希望能够看到每一个。
- en: '![](Images/CH06_F17_Kabacoff3.png)'
  id: totrans-178
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F17_Kabacoff3.png)'
- en: Figure 6.17 Kernel density curves of city mpg by number of cylinders
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.17 按气缸数划分的城市mpg值的核密度曲线
- en: '![](Images/CH06_F18_Kabacoff3.png)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F18_Kabacoff3.png)'
- en: Figure 6.18 Filled kernel density curves of city mpg by number of cylinders
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.18 城市mpg值的填充核密度曲线，按气缸数划分
- en: Printing in greyscale
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 以灰度打印
- en: By default, `ggplot2` selects colors that may be difficult to distinguish when
    printed in greyscale. This is the case for figure 6.18 in the hard copy version
    of this book. When greyscale figures are required, you can add the `scale_fill_grey()`
    and `scale_color_grey()` functions to your code. This will produce a color scheme
    that works well when it’s printed in black and white. Alternatively, you can select
    colors using the `bpy.colors()` function in the `sp` package. This will choose
    a blue-pink-yellow color scheme that also prints well on both color and black/white
    printers. However, you have to like blue, pink, and yellow!
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`ggplot2`选择的颜色在以灰度打印时可能难以区分。这是本书硬拷贝版本中图6.18的情况。当需要灰度图表时，您可以在代码中添加`scale_fill_grey()`和`scale_color_grey()`函数。这将产生一种在黑白打印时效果良好的颜色方案。或者，您可以使用`sp`包中的`bpy.colors()`函数选择颜色。这将选择一种蓝色-粉色-黄色颜色方案，这种颜色方案在彩色和黑白打印机上打印效果都很好。然而，您必须喜欢蓝色、粉色和黄色！
- en: Overlapping kernel density plots can be a powerful way to compare groups of
    observations on an outcome variable. Here you can see both the shapes of the distributions
    and the amount of overlap between groups. (The moral of the story is that my next
    car will have four cylinders—or a battery.)
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 重叠的核密度图可以是一种强大的方法，用于比较结果变量上的观测组。在这里，您可以同时看到分布的形状和组之间的重叠程度。（故事的寓意是，我的下一辆车将有四个气缸——或者一个电池。）
- en: Box plots are also a wonderful (and more commonly used) graphical approach to
    visualizing distributions and differences among groups. We’ll discuss them next.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 箱线图也是可视化分布和组间差异的一种奇妙（且更常用的）图形方法。我们将在下一节讨论它们。
- en: 6.6 Box plots
  id: totrans-186
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6.6 箱线图
- en: 'A *box-and-whiskers plot* describes the distribution of a continuous variable
    by plotting its five-number summary: the minimum, lower quartile (25th percentile),
    median (50th percentile), upper quartile (75th percentile), and maximum. It can
    also display observations that may be outliers (values outside the range of ±
    1.5 × QR, where IQR is the interquartile range defined as the upper quartile minus
    the lower quartile). For example, the following code produces the plot shown in
    figure 6.19:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: '*箱线图*通过绘制其五个数值摘要来描述连续变量的分布：最小值、下四分位数（25百分位数）、中位数（50百分位数）、上四分位数（75百分位数）和最大值。它还可以显示可能为异常值（值在±
    1.5 × QR范围之外，其中IQR是四分位距，定义为上四分位数减去下四分位数）的观测值。例如，以下代码生成了图6.19所示的图表：'
- en: '[PRE24]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: In figure 6.19, I’ve added annotations by hand to illustrate the components.
    By default, each whisker extends to the most extreme data point, which is no more
    than 1.5 times the interquartile range for the box. Values outside this range
    are depicted as dots.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 在图6.19中，我手动添加了注释来展示组成部分。默认情况下，每根胡须延伸到最极端的数据点，这不超过箱子的四分位距的1.5倍。超出此范围的值被描绘为点。
- en: '![](Images/CH06_F19_Kabacoff3.png)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH06_F19_Kabacoff3.png)'
- en: Figure 6.19 Box plot with annotations added by hand
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.19 添加了手写注释的箱线图
- en: For example, in this sample of cars, the median mpg is 17, 50% of the scores
    fall between 14 and 19, the smallest value is 9, and the largest value is 35\.
    How did I read this so precisely from the graph? Issuing `boxplot.stats(mtcars$mpg)`
    prints the statistics used to build the graph (in other words, I cheated). There
    are four outliers (greater than the upper hinge of 26). These values would be
    expected to occur less than 1% of the time in a normal distribution.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在这个汽车样本中，中位数的mpg是17，50%的分数在14到19之间，最小值是9，最大值是35。我是如何从图中如此精确地读取这些信息的？运行`boxplot.stats(mtcars$mpg)`会打印出构建图形所使用的统计数据（换句话说，我作弊了）。有四个异常值（大于上四分位数26）。在正态分布中，这些值预期发生的概率不到1%。
- en: 6.6.1 Using parallel box plots to compare groups
  id: totrans-193
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.6.1 使用平行箱线图比较组
- en: 'Box plots are a useful method of comparing the distribution of a quantitative
    variable across the levels of a categorical variable. Once again, let’s compare
    city gas mileage for four-, six-, and eight-cylinder cars, but this time, we’ll
    use both 1999 and 2008 data. Since there are only a few five-cylinder cars, we
    will delete them. We’ll also convert `year` and `cyl` from continuous numeric
    variables into categorical (grouping) factors:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 箱线图是用于比较定量变量在分类变量水平上的分布的有用方法。再次，让我们比较四缸、六缸和八缸汽车的城市油耗，但这次我们将使用1999年和2008年的数据。由于只有少数五缸汽车，我们将删除它们。我们还将把`year`和`cyl`从连续的数值变量转换为分类（分组）因素：
- en: '[PRE25]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: The code
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 代码
- en: '[PRE26]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: produces the graph in figure 6.20\. You can see that there’s a good separation
    of groups based on gas mileage, with fuel efficiency dropping as the number of
    cylinders increases. There are also four outliers (cars with unusually high mileage)
    in the four-cylinder group.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 生成图6.20所示的图形。你可以看到，基于油耗，组间有很好的分离，随着汽缸数的增加，燃油效率下降。四缸组中也有四个异常值（油耗异常高的汽车）。
- en: '![](Images/CH06_F20_Kabacoff3.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH06_F20_Kabacoff3.png)'
- en: Figure 6.20 Box plots of car mileage vs. number of cylinders
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.20 汽车油耗与汽缸数的箱线图
- en: 'Box plots are very versatile. By adding `notch=TRUE`, you get *notched* box
    plots. If two boxes’ notches don’t overlap, there’s strong evidence that their
    medians differ (Chambers et al., 1983, p. 62). The following code creates notched
    box plots for the mileage example:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 箱线图非常灵活。通过添加`notch=TRUE`，你可以得到带凹槽的箱线图。如果两个箱子的凹槽不重叠，那么有强有力的证据表明它们的均值不同（Chambers
    et al., 1983, p. 62）。以下代码为油耗示例创建了带凹槽的箱线图：
- en: '[PRE27]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: The `fill` option fills the box plots with a dark color. In a standard box plot,
    the box width has no meaning. Adding `varwidth=TRUE` draws box widths proportional
    to the square roots of the number of observations in each group.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '`fill`选项用深色填充箱线图。在标准箱线图中，箱宽没有意义。添加`varwidth=TRUE`会根据每个组中观测值的平方根绘制箱宽。'
- en: You can see in figure 6.21 that the median car mileage for four-, six-, and
    eight-cylinder cars differs. Mileage clearly decreases with number of cylinders.
    Additionally, there are fewer eight-cylinder cars, than four- or six-cylinder
    cars (although the difference is subtle).
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在图6.21中看到，四缸、六缸和八缸汽车的汽车中位数的油耗不同。油耗显然随着汽缸数的增加而减少。此外，八缸汽车的数量比四缸或六缸汽车少（尽管差异微妙）。
- en: 'Finally, you can produce box plots for more than one grouping factor. The following
    code provides box plots for city miles per gallon versus the number of cylinders
    by year (see figure 6.21). The `scale_fill_manual()` function has been added to
    customize the fill colors:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你可以为多个分组因素生成箱线图。以下代码提供了城市每加仑英里数与汽缸数按年份的箱线图（见图6.21）。已添加`scale_fill_manual()`函数来自定义填充颜色：
- en: '[PRE28]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '![](Images/CH06_F21_Kabacoff3.png)'
  id: totrans-207
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH06_F21_Kabacoff3.png)'
- en: Figure 6.21 Notched box plots for car mileage vs. number of cylinders
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.21 汽车油耗与汽缸数的带凹槽箱线图
- en: As figure 6.22 shows, it’s again clear that median mileage decreases with number
    of cylinders. Additionally, for each group, mileage has increased between 1999
    and 2008.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 如图6.22所示，再次清楚地表明，中位数的油耗随着汽缸数的增加而减少。此外，对于每个组，1999年至2008年间油耗都有所增加。
- en: '![](Images/CH06_F22_Kabacoff3.png)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH06_F22_Kabacoff3.png)'
- en: Figure 6.22 Box plots for car mileage vs. year and number of cylinders
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.22 汽车油耗与年份和汽缸数的箱线图
- en: 6.6.2 Violin plots
  id: totrans-212
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.6.2 小提琴图
- en: Before we end our discussion of box plots, it’s worth examining a variation
    called a *violin plot*. A violin plot is a combination of a box plot and a kernel
    density plot. You can create one using the `geom_violin()` function. In the following
    listing, we’ll add violin plots to the box plots, shown in figure 6.23.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们结束对箱线图的讨论之前，值得考察一种称为 *小提琴图* 的变体。小提琴图是箱线图和核密度图的组合。你可以使用 `geom_violin()` 函数创建一个。在下面的列表中，我们将向图
    6.23 中的箱线图添加小提琴图。
- en: Listing 6.10  Violin plots
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 6.10  小提琴图
- en: '[PRE29]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: The width of the box plots is set to `0.2` so they will fit inside the violin
    plots. The violin plots are Figure 6.23 set with a transparency level of `0.3`
    so the box plots are still visible.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 箱线图的宽度设置为 `0.2`，以便它们可以适合在小提琴图中。小提琴图设置为图 6.23 的透明度级别为 `0.3`，以便箱线图仍然可见。
- en: '![](Images/CH06_F23_Kabacoff3.png)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH06_F23_Kabacoff3.png)'
- en: Figure 6.23 Violin plots of mpg vs. number of cylinders
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.23 mpg 与汽缸数的对比小提琴图
- en: Violin plots are basically kernel density plots superimposed in a mirror-image
    fashion over box plots. The middle lines are the medians, the black boxes range
    from the lower to the upper quartile, and the thin black lines represent the whiskers.
    Dots are outliers. The outer shape provides the kernel density plot. Here we can
    see that the distribution of gas mileage for eight-cylinder cars may be bimodal—a
    fact that is obscured by using box plots alone. Violin plots haven’t really caught
    on yet. Again, this may be due to a lack of easily accessible software; time will
    tell.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 小提琴图基本上是在箱线图上以镜像方式叠加的核密度图。中间的线是中位数，黑色方框从下四分位数到上四分位数，细黑线代表触须。点代表异常值。外部形状提供了核密度图。在这里我们可以看到，八缸车的油耗分布可能是双峰的——这是一个仅使用箱线图就无法揭示的事实。小提琴图尚未真正流行起来。再次强调，这可能是由于缺乏易于访问的软件；时间会证明一切。
- en: We’ll end this chapter with a look at dot plots. Unlike the graphs you’ve seen
    previously, dot plots plot every value for a variable.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将以查看点图结束本章。与之前看到的图表不同，点图绘制了变量的每个值。
- en: 6.7 Dot plots
  id: totrans-221
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6.7 点图
- en: Dot plots provide a method of plotting a large number of labeled values on a
    simple horizontal scale. You create them with the `dotchart()` function, using
    the format
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 点图提供了一种在简单水平尺度上绘制大量标记值的方法。你可以使用 `dotchart()` 函数创建它们，格式如下
- en: '[PRE30]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'where `data` is a data frame, `contvar` is a continuous variable, and `catvar`
    is a categorical variable. Here’s an example using the highway gas mileage for
    the 2008 automobiles in the `mpg` dataset. Highway gas mileage is averaged by
    car model:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: '`data` 是一个数据框，`contvar` 是一个连续变量，而 `catvar` 是一个分类变量。以下是一个使用 `mpg` 数据集中 2008
    年汽车的高速油耗的例子。高速油耗按车型平均：'
- en: '[PRE31]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: The resulting plot is shown in figure 6.24.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 结果图显示在图 6.24 中。
- en: 'This graph allows you to see the mpg for each car model on the same horizontal
    axis. Dot plots typically become most useful when they’re sorted. The following
    code sorts the cars from lowest to highest mileage:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 此图允许你看到每个车型在相同水平轴上的 mpg。点图通常在排序后最有用。以下代码按最低到最高里程对汽车进行排序：
- en: '[PRE32]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: The resulting graph is given in figure 6.25\. To plot in descending order, use
    `reorder (model, -meanHwy)`.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 结果图见图 6.25。要按降序绘图，请使用 `reorder (model, -meanHwy)`。
- en: You can gain significant insight from the dot plot in this example because each
    point is labeled, the value of each point is inherently meaningful, and the points
    are arranged in a manner that promotes comparisons. But as the number of data
    points increases, the utility of the dot plot decreases.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以从这个例子中的点图中获得显著的洞察力，因为每个点都有标签，每个点的值本身就有意义，而且点以促进比较的方式排列。但随着数据点的数量增加，点图的效用会降低。
- en: '![](Images/CH06_F24_Kabacoff3.png)'
  id: totrans-231
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH06_F24_Kabacoff3.png)'
- en: Figure 6.24 Dot plot of mpg for each car model
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.24 每个车型 mpg 的点图
- en: '![](Images/CH06_F25_Kabacoff3.png)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH06_F25_Kabacoff3.png)'
- en: Figure 6.25 Dot plot of mpg for car models sorted by mileage
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.25 按里程排序的车型 mpg 的点图
- en: Summary
  id: totrans-235
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Bar charts (and, to a lesser extent, pie charts and tree maps) can be used to
    gain insight into the distribution of a categorical variable.
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 条形图（以及在一定程度上饼图和树状图）可以用来了解分类变量的分布。
- en: Stacked, grouped, and filled bar charts can help you understand how groups differ
    on a categorical outcome.
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 堆叠、分组和填充条形图可以帮助你了解组在分类结果上的差异。
- en: Histograms, box plots, violin plots, and dot plots can help you visualize the
    distribution of continuous variables.
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 直方图、箱线图、小提琴图和点图可以帮助你可视化连续变量的分布。
- en: Overlapping kernel density plots and parallel box plots can help you visualize
    group differences on a continuous outcome variable.
  id: totrans-239
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重叠的核密度图和平行箱线图可以帮助你可视化连续结果变量上的组间差异。
