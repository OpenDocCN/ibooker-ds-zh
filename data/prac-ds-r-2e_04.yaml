- en: Chapter 3\. Exploring data
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第3章\. 探索数据
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Using summary statistics to explore data
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用汇总统计来探索数据
- en: Exploring data using visualization
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用可视化探索数据
- en: Finding problems and issues during data exploration
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在数据探索过程中发现问题和问题
- en: In the last two chapters, you learned how to set the scope and goal of a data
    science project, and how to start working with your data in R. In this chapter,
    you’ll start to get your hands into the data. As shown in the mental model ([figure
    3.1](../Text/03.xhtml#ch03fig01)), this chapter emphasizes the science of exploring
    the data, prior to the model-building step. Your goal is to have data that is
    as clean and useful as possible.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在前两章中，您学习了如何设定数据科学项目的范围和目标，以及如何在R中开始处理您的数据。在本章中，您将开始深入数据。如图3.1所示的心理模型([图3.1](../Text/03.xhtml#ch03fig01))，本章强调在建模步骤之前探索数据的科学。您的目标是拥有尽可能干净和有用的数据。
- en: '* * *'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Example
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 示例
- en: '*Suppose your goal is to build a model to predict which of your customers don’t
    have health insurance. You’ve collected a dataset of customers whose health insurance
    status you know. You’ve also identified some customer properties that you believe
    help predict the probability of insurance coverage: age, employment status, income,
    information about residence and vehicles, and so on.*'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '*假设您的目标是构建一个模型来预测哪些客户没有健康保险。您收集了一个您知道其健康保险状态的客户数据集。您还确定了一些客户属性，您认为这些属性有助于预测保险覆盖率的概率：年龄、就业状态、收入、居住和车辆信息等。*'
- en: '* * *'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Figure 3.1\. [Chapter 3](../Text/03.xhtml#ch03) mental model
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.1\. [第3章](../Text/03.xhtml#ch03) 心理模型
- en: '![](Images/03fig01.jpg)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig01.jpg)'
- en: You’ve put all your data into a single data frame called customer_data that
    you’ve input into R.^([[1](../Text/03.xhtml#ch03fn1)]) Now you’re ready to start
    building the model to identify the customers you’re interested in.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经将所有数据放入了一个名为customer_data的单个数据框中，并将其输入到R中.^([[1](../Text/03.xhtml#ch03fn1)])
    现在您已经准备好开始构建模型以识别您感兴趣的客户。
- en: ¹
  id: totrans-13
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ¹
- en: ''
  id: totrans-14
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: We have a copy of this synthetic dataset available for download from [https://github.com/WinVector/PDSwR2/tree/master/Custdata](https://github.com/WinVector/PDSwR2/tree/master/Custdata),
    and once it's saved, you can load it into R with the command `customer_data <-
    readRDS("custdata.RDS")`. This dataset is derived from the census data that you
    saw in [chapter 2](../Text/02.xhtml#ch02). We have introduced a little noise to
    the `age` variable to reflect what is typically seen in real-world noisy datasets.
    We have also included some columns not necessarily relevant to our example scenario,
    but which exhibit some important data anomalies.
  id: totrans-15
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 我们可以从[https://github.com/WinVector/PDSwR2/tree/master/Custdata](https://github.com/WinVector/PDSwR2/tree/master/Custdata)下载这个合成数据集，一旦保存，您可以使用命令`customer_data
    <- readRDS("custdata.RDS")`将其加载到R中。这个数据集是从您在第二章中看到的普查数据派生出来的。我们在`age`变量中引入了一些噪声，以反映在现实世界噪声数据集中通常看到的情况。我们还包含了一些可能与我们示例场景不相关的列，但这些列展示了某些重要的数据异常。
- en: 'It’s tempting to dive right into the modeling step without looking very hard
    at the dataset first, especially when you have a lot of data. Resist the temptation.
    No dataset is perfect: you’ll be missing information about some of your customers,
    and you’ll have incorrect data about others. Some data fields will be dirty and
    inconsistent. If you don’t take the time to examine the data before you start
    to model, you may find yourself redoing your work repeatedly as you discover bad
    data fields or variables that need to be transformed before modeling. In the worst
    case, you’ll build a model that returns incorrect predictions—and you won’t be
    sure why.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 很容易在没有仔细查看数据集的情况下直接进入建模步骤，尤其是当您有大量数据时。抵制这种诱惑。没有数据集是完美的：您将缺少一些客户的信息，并且关于其他客户的数据可能是不正确的。一些数据字段将是杂乱无章和不一致的。如果您在开始建模之前不花时间检查数据，您可能会发现自己反复重做工作，因为您发现了需要转换的坏数据字段或变量。在最坏的情况下，您将构建一个返回错误预测的模型——您也不会知道为什么。
- en: '* * *'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Get to know your data before modeling
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在建模之前了解您的数据
- en: By addressing data issues early, you can save yourself some unnecessary work,
    and a lot of headaches!
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 通过早期解决数据问题，您可以节省一些不必要的劳动，并避免很多头痛！
- en: '* * *'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: You’d also like to get a sense of who your customers are. Are they young, middle-aged,
    or seniors? How affluent are they? Where do they live? Knowing the answers to
    these questions can help you build a better model, because you’ll have a more
    specific idea of what information most accurately predicts the probability of
    insurance coverage.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 您还希望了解您的客户是谁。他们是年轻人、中年人还是老年人？他们的富裕程度如何？他们住在哪里？了解这些问题的答案可以帮助您构建更好的模型，因为您将有一个更具体的概念，了解哪些信息最准确地预测了保险覆盖的概率。
- en: In this chapter, we’ll demonstrate some ways to get to know your data, and discuss
    some of the potential issues that you’re looking for as you explore. Data exploration
    uses a combination of *summary statistics*—means and medians, variances, and counts—and
    *visualization*, or graphs of the data. You can spot some problems just by using
    summary statistics; other problems are easier to find visually.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将演示一些了解数据的方法，并讨论您在探索过程中寻找的一些潜在问题。数据探索结合了*描述性统计*——均值和中位数、方差和计数——以及*可视化*，即数据的图表。您只需使用描述性统计就能发现一些问题；其他问题则更容易通过视觉发现。
- en: '* * *'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: '**Organizing data for analysis**'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '**组织数据以进行分析**'
- en: 'For most of this book, we’ll assume that the data you’re analyzing is in a
    single data frame. This is not how data is usually stored. In a database, for
    example, data is usually stored in *normalized form* to reduce redundancy: information
    about a single customer is spread across many small tables. In log data, data
    about a single customer can be spread across many log entries, or sessions. These
    formats make it easy to add (or, in the case of a database, modify) data, but
    are not optimal for analysis. You can often join all the data you need into a
    single table in the database using SQL, but in [chapter 5](../Text/05.xhtml#ch05),
    we’ll discuss commands like `join` that you can use within R to further consolidate
    data.'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的大部分内容中，我们将假设您正在分析的数据在一个单一的数据框中。数据通常不是这样存储的。例如，在数据库中，数据通常以*规范化形式*存储以减少冗余：关于单个客户的信息分布在许多小的表中。在日志数据中，关于单个客户的信息可以分布在许多日志条目或会话中。这些格式使得添加（或，在数据库的情况下，修改）数据变得容易，但不是分析的最佳选择。您通常可以使用SQL将所有需要的数据合并到一个数据库中的单个表中，但在[第5章](../Text/05.xhtml#ch05)中，我们将讨论您可以在R中使用以进一步合并数据的`join`等命令。
- en: '* * *'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: 3.1\. Using summary statistics to spot problems
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 3.1\. 使用描述性统计来发现问题
- en: In R, you’ll typically use the `summary()` command to take your first look at
    the data. The goal is to understand whether you have the kind of customer information
    that can potentially help you predict health insurance coverage, and whether the
    data is of good enough quality to be informative.^([[1](../Text/03.xhtml#ch03fn2)])
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在R中，您通常会使用`summary()`命令来首次查看数据。目标是了解您是否有可以帮助预测健康保险覆盖的客户信息，以及数据是否足够好，足以提供信息。[1](../Text/03.xhtml#ch03fn2)]
- en: ¹
  id: totrans-29
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ¹
- en: ''
  id: totrans-30
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: If you haven’t already done so, we suggest you follow the steps in [section
    A.1](../Text/A.xhtml#app01lev1sec1) of [appendix A](../Text/A.xhtml#app01) to
    install R, packages, tools, and the book examples.
  id: totrans-31
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 如果您还没有这样做，我们建议您按照[附录A](../Text/A.xhtml#app01)中的[章节A.1](../Text/A.xhtml#app01lev1sec1)中的步骤安装R、包、工具和本书的示例。
- en: Listing 3.1\. The `summary()` command
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 列表3.1\. `summary()`命令
- en: '[PRE0]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: ❶ Change this to your actual path to the directory where you unpacked PDSwR2
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 将此路径更改为您实际解压PDSwR2的目录路径
- en: ❷ The variable is_employed is missing for about a third of the data. The variable
    income has negative values, which are potentially invalid.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 变量is_employed大约有三分之一的缺失值。变量income有负值，这些值可能是无效的。
- en: ❸ About 90% of the customers have health insurance.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 大约90%的客户有健康保险。
- en: ❹ The variables housing_type, recent_move, num_vehicles, and gas_usage are each
    missing 1720 or 1721 values.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 变量housing_type、recent_move、num_vehicles和gas_usage中每个变量都缺失1720或1721个值。
- en: ❺ The average value of the variable age seems plausible, but the minimum and
    maximum values seem unlikely. The variable state_of_res is a categorical variable;
    summary() reports how many customers are in each state (for the first few states).
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 变量age的平均值看起来合理，但最小值和最大值似乎不太可能。变量state_of_res是一个分类变量；`summary()`报告了每个州（对于前几个州）有多少客户。
- en: The `summary()` command on a data frame reports a variety of summary statistics
    on the numerical columns of the data frame, and count statistics on any categorical
    columns (if the categorical columns have already been read in as factors^([[1](../Text/03.xhtml#ch03fn3)])).
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在数据框上使用 `summary()` 命令会报告数据框数值列的各种摘要统计信息，以及任何分类列的计数统计信息（如果分类列已经作为因子读入^([[1](../Text/03.xhtml#ch03fn3)])）。
- en: ¹
  id: totrans-40
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ¹
- en: ''
  id: totrans-41
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Categorical variables are of class `factor` in R. They can be represented as
    strings (class `character`), and some analytical functions will automatically
    convert string variables to factor variables. To get a useful summary of a categorical
    variable, it needs to be a factor.
  id: totrans-42
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在 R 中，分类变量属于 `factor` 类。它们可以用字符串（`character` 类）表示，并且一些分析函数会自动将字符串变量转换为因子变量。为了得到一个有用的分类变量总结，它需要是一个因子。
- en: As you see from [listing 3.1](../Text/03.xhtml#ch03ex01), the summary of the
    data helps you quickly spot potential problems, like missing data or unlikely
    values. You also get a rough idea of how categorical data is distributed. Let’s
    go into more detail about the typical problems that you can spot using the summary.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 如[列表 3.1](../Text/03.xhtml#ch03ex01)所示，数据的总结可以帮助你快速发现潜在问题，如缺失数据或不可能的值。你还可以大致了解分类数据的分布情况。让我们更详细地讨论一下你可以通过总结发现的典型问题。
- en: 3.1.1\. Typical problems revealed by data summaries
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 3.1.1\. 数据总结揭示的典型问题
- en: 'At this stage, you’re looking for several common issues:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个阶段，你正在寻找几个常见问题：
- en: Missing values
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 缺失值
- en: Invalid values and outliers
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无效值和异常值
- en: Data ranges that are too wide or too narrow
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据范围过宽或过窄
- en: The units of the data
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据的单位
- en: Let’s address each of these issues in detail.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们详细讨论这些问题中的每一个。
- en: Missing values
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 缺失值
- en: A few missing values may not really be a problem, but if a particular data field
    is largely unpopulated, it shouldn’t be used as an input without some repair (as
    we’ll discuss in [section 4.1.2](../Text/04.xhtml#ch04lev2sec2)). In R, for example,
    many modeling algorithms will, by default, quietly drop rows with missing values.
    As you see in the following listing, all the missing values in the `is_employed`
    variable could cause R to quietly ignore more than a third of the data.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 一些缺失值可能并不是真正的问题，但如果某个特定数据字段大部分未填充，在没有一些修复的情况下不应作为输入使用（我们将在[第 4.1.2 节](../Text/04.xhtml#ch04lev2sec2)中讨论）。例如，在
    R 中，许多建模算法默认会静默地丢弃包含缺失值的行。正如你在下面的列表中看到的，`is_employed` 变量中的所有缺失值可能导致 R 静默地忽略超过三分之二的数据。
- en: Listing 3.2\. Will the variable `is_employed` be useful for modeling?
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 3.2\. 变量 `is_employed` 对建模是否有用？
- en: '[PRE1]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: ❶ The variable is_employed is missing for more than a third of the data. Why?
    Is employment status unknown? Did the company start collecting employment data
    only recently? Does NA mean “not in the active workforce” (for example, students
    or stay-at-home parents)?
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 变量 is_employed 缺失的数据超过三分之二。为什么？就业状态是否未知？公司是否最近才开始收集就业数据？NA 是否表示“不在活跃劳动力中”（例如，学生或全职主妇）？
- en: ❷ The variables housing_type, recent_move, num_vehicles, and gas_usage are missing
    relatively few values—about 2% of the data. It’s probably safe to just drop the
    rows that are missing values, especially if the missing values are all in the
    same 1720 rows.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 变量 housing_type、recent_move、num_vehicles 和 gas_usage 缺失值相对较少——大约占数据的 2%。仅删除缺失值的行可能是安全的，尤其是如果这些缺失值都集中在同一
    1720 行中。
- en: If a particular data field is largely unpopulated, it’s worth trying to determine
    why; sometimes the fact that a value is missing is informative in and of itself.
    For example, why is the `is_employed` variable missing so many values? There are
    many possible reasons, as we noted in [listing 3.2](../Text/03.xhtml#ch03ex02).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 如果某个特定数据字段大部分未填充，尝试确定原因是有意义的；有时，一个值缺失本身就有信息量。例如，为什么 `is_employed` 变量缺失了这么多值？正如我们注意到的，有许多可能的原因，如[列表
    3.2](../Text/03.xhtml#ch03ex02)所示。
- en: Whatever the reason for missing data, you must decide on the most appropriate
    action. Do you include a variable with missing values in your model, or not? If
    you decide to include it, do you drop all the rows where this field is missing,
    or do you convert the missing values to `0` or to an additional category? We’ll
    discuss ways to treat missing data in [chapter 4](../Text/04.xhtml#ch04). In this
    example, you might decide to drop the data rows where you’re missing data about
    housing or vehicles, since there aren’t many of them. You probably don’t want
    to throw out the data where you’re missing employment information, since employment
    status is probably highly predictive of having health insurance; you might instead
    treat the NAs as a third employment category. You will likely encounter missing
    values when model scoring, so you should deal with them during model training.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 无论缺失数据的原因是什么，您都必须决定最合适的行动。您是否要在模型中包含缺失值的变量，或者不包含？如果您决定包含它，您是删除所有该字段缺失的行，还是将缺失值转换为`0`或额外的类别？我们将在[第
    4 章](../Text/04.xhtml#ch04)中讨论处理缺失数据的方法。在这个例子中，您可能决定删除关于房屋或车辆的数据行，因为它们不多。您可能不想丢弃缺失就业信息的数据，因为就业状况可能是健康保险的强预测因素；您可能将
    NAs 作为第三个就业类别处理。在模型评分时，您可能会遇到缺失值，因此您应该在模型训练期间处理它们。
- en: Invalid values and outliers
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 无效值和异常值
- en: Even when a column or variable isn’t missing any values, you still want to check
    that the values that you do have make sense. Do you have any invalid values or
    outliers? Examples of invalid values include negative values in what should be
    a non-negative numeric data field (like age or income) or text where you expect
    numbers. Outliers are data points that fall well out of the range of where you
    expect the data to be. Can you spot the outliers and invalid values in the next
    listing?
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 即使某一列或变量没有缺失值，您仍然想要检查您拥有的值是否有意义。您是否有任何无效值或异常值？无效值的例子包括在应该是非负数值数据字段（如年龄或收入）中的负值或您期望数字的文本。异常值是那些远远超出您期望数据所在范围的数值点。您能否在下一个列表中找到异常值和无效值？
- en: Listing 3.3\. Examples of invalid values and outliers
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 3.3\. 无效值和异常值的示例
- en: '[PRE2]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: ❶ Negative values for income could indicate bad data. They might also have a
    special meaning, like “amount of debt.” Either way, you should check how prevalent
    the issue is, and decide what to do. Do you drop the data with negative income?
    Do you convert negative values to zero?
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 收入为负值可能表明数据有误。它们也可能有特殊含义，例如“债务金额”。无论哪种情况，您都应该检查这个问题有多普遍，并决定如何处理。您是否要删除收入为负的数据？您是否要将负值转换为零？
- en: '❷ Customers of age zero, or customers of an age greater than about 110, are
    outliers. They fall out of the range of expected customer values. Outliers could
    be data input errors. They could be special sentinel values: zero might mean “age
    unknown” or “refuse to state.” And some of your customers might be especially
    long-lived.'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 年龄为零或年龄大于大约 110 的客户是异常值。它们超出了预期客户值的范围。异常值可能是数据输入错误。它们可能是特殊的哨兵值：零可能表示“年龄未知”或“拒绝声明”。而且，您的某些客户可能特别长寿。
- en: Often, invalid values are simply bad data input. A negative number in a field
    like `age`, however, could be a *sentinel value* to designate “unknown.” Outliers
    might also be data errors or sentinel values. Or they might be valid but unusual
    data points—people do occasionally live past 100.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，无效值仅仅是数据输入错误。然而，在`年龄`这样的字段中，负数可能是一个*哨兵值*，表示“未知”。异常值也可能是数据错误或哨兵值。或者，它们可能是有效但异常的数据点——人们偶尔会活过
    100 岁。
- en: 'As with missing values, you must decide the most appropriate action: drop the
    data field, drop the data points where this field is bad, or convert the bad data
    to a useful value. For example, even if you feel certain outliers are valid data,
    you might still want to omit them from model construction, if the outliers interfere
    with the model-fitting process. Generally, the goal of modeling is to make good
    predictions on typical cases, and a model that is highly skewed to predict a rare
    case correctly may not always be the best model overall.'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 与缺失值一样，您必须决定最合适的行动：删除数据字段、删除该字段有问题的数据点，或将不良数据转换为有用的值。例如，即使您确信某些异常值是有效数据，您可能仍然希望在不干扰模型拟合过程的情况下，将它们从模型构建中省略。通常，建模的目标是在典型情况下做出良好的预测，而一个高度偏向于正确预测罕见情况的模型可能并不总是最好的模型。
- en: Data range
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 数据范围
- en: You also want to pay attention to how much the values in the data vary. If you
    believe that age or income helps to predict the probability of health insurance
    coverage, then you should make sure there is enough variation in the age and income
    of your customers for you to see the relationships. Let’s look at income again,
    in the next listing. Is the data range wide? Is it narrow?
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 你还应该注意数据中的值变化有多大。如果你认为年龄或收入有助于预测健康保险覆盖的概率，那么你应该确保你的客户在年龄和收入上有足够的差异，以便你能看到这些关系。让我们再次看看收入，在下一个列表中。数据范围是宽的还是窄的？
- en: Listing 3.4\. Looking at the data range of a variable
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 3.4\. 查看变量的数据范围
- en: '[PRE3]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: ❶ Income ranges from zero to over a million dollars, a very wide range.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 收入范围从零到超过一百万美元，这是一个非常宽的范围。
- en: Even ignoring negative income, the `income` variable in [listing 3.4](../Text/03.xhtml#ch03ex04)
    ranges from zero to over a million dollars. That’s pretty wide (though typical
    for income). Data that ranges over several orders of magnitude like this can be
    a problem for some modeling methods. We’ll talk about mitigating data range issues
    when we talk about logarithmic transformations in [chapter 4](../Text/04.xhtml#ch04).
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 即使忽略负收入，[列表 3.4](../Text/03.xhtml#ch03ex04) 中的 `income` 变量范围从零到超过一百万美元。这相当宽（尽管对于收入来说很典型）。像这样跨越几个数量级的范围的数据可能会对某些建模方法造成问题。当我们谈到第
    4 章中的对数变换时，我们将讨论缓解数据范围问题的方法。
- en: Data can be too narrow, too. Suppose all your customers are between the ages
    of 50 and 55\. It’s a good bet that age range wouldn’t be a very good predictor
    of the probability of health insurance coverage for that population, since it
    doesn’t vary much at all.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 数据也可能太窄。假设你的所有客户年龄都在 50 到 55 岁之间。可以肯定的是，这个年龄范围可能不是预测该人群健康保险覆盖概率的好指标，因为它几乎没有任何变化。
- en: '* * *'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: '**How narrow is “too narrow” for a data range?**'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '**数据范围“太窄”是什么意思？**'
- en: Of course, the term *narrow* is relative. If we were predicting the ability
    to read for children between the ages of 5 and 10, then age probably is a useful
    variable as is. For data including adult ages, you may want to transform or bin
    ages in some way, as you don’t expect a significant change in reading ability
    between ages 40 and 50\. You should rely on information about the problem domain
    to judge if the data range is narrow, but a rough rule of thumb relates to the
    ratio of the standard deviation to the mean. If that ratio is very small, then
    the data isn’t varying much.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，术语“窄”是相对的。如果我们预测的是 5 到 10 岁儿童的阅读能力，那么年龄可能是一个有用的变量。对于包括成人年龄的数据，你可能需要以某种方式转换或分组年龄，因为你不期望在
    40 到 50 岁之间阅读能力有显著变化。你应该根据问题域的信息来判断数据范围是否狭窄，但一个粗略的经验法则是与标准差与平均值之比相关。如果这个比率非常小，那么数据变化不大。
- en: '* * *'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: We’ll revisit data range in [section 3.2](../Text/03.xhtml#ch03lev1sec2), when
    we talk about examining data graphically.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们谈到图形化检查数据时，我们将在 [第 3.2 节](../Text/03.xhtml#ch03lev1sec2) 回顾数据范围。
- en: One factor that determines apparent data range is the unit of measurement. To
    take a nontechnical example, we measure the ages of babies and toddlers in weeks
    or in months, because developmental changes happen at that time scale for very
    young children. Suppose we measured babies’ ages in years. It might appear numerically
    that there isn’t much difference between a one-year-old and a two-year-old. In
    reality, there’s a dramatic difference, as any parent can tell you! Units can
    present potential issues in a dataset for another reason, as well.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 决定数据范围的一个因素是计量单位。以一个非技术性的例子来说，我们用周或月来衡量婴儿和幼儿的年龄，因为在这个时间尺度上，非常年幼的儿童会经历发育变化。假设我们用年来衡量婴儿的年龄。从数字上看，一岁和两岁之间可能没有太大的区别。实际上，差异是巨大的，正如任何父母都可以告诉你的那样！单位也可能因为另一个原因在数据集中引起潜在问题。
- en: Units
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 单位
- en: Does the income data in [listing 3.5](../Text/03.xhtml#ch03ex05) represent hourly
    wages, or yearly wages in units of $1000? As a matter of fact, it’s yearly wages
    in units of $1000, but what if it were hourly wages? You might not notice the
    error during the modeling stage, but down the line someone will start inputting
    hourly wage data into the model and get back bad predictions in return.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 3.5](../Text/03.xhtml#ch03ex05) 中的收入数据代表的是每小时工资，还是以 $1000 为单位的年工资？实际上，它是以
    $1000 为单位的年工资，但如果它代表的是小时工资呢？你可能在建模阶段不会注意到这个错误，但最终有人会将小时工资数据输入模型，并得到错误的预测结果。'
- en: Listing 3.5\. Checking units; mistakes can lead to spectacular errors
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 3.5\. 检查单位；错误可能导致惊人的错误
- en: '[PRE4]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: ❶ The variable IncomeK is defined as IncomeK = customer_data$income/1000\. But
    suppose you didn’t know that. Looking only at the summary, the values could plausibly
    be interpreted to mean either “hourly wage” or “yearly income in units of $1000.”
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 变量IncomeK被定义为IncomeK = customer_data$income/1000。但假设你不知道这一点。仅通过查看摘要，这些值可能合理地解释为“时薪”或“以1000美元为单位的年收入。”
- en: Are time intervals measured in days, hours, minutes, or milliseconds? Are speeds
    in kilometers per second, miles per hour, or knots? Are monetary amounts in dollars,
    thousands of dollars, or 1/100 of a penny (a customary practice in finance, where
    calculations are often done in fixed-point arithmetic)? This is actually something
    that you’ll catch by checking data definitions in data dictionaries or documentation,
    rather than in the summary statistics; the difference between hourly wage data
    and annual salary in units of $1000 may not look that obvious at a casual glance.
    But it’s still something to keep in mind while looking over the value ranges of
    your variables, because often you can spot when measurements are in unexpected
    units. Automobile speeds in knots look a lot different than they do in miles per
    hour.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 时间间隔是以天、小时、分钟还是毫秒来衡量的？速度是以每秒公里、每小时英里还是节来衡量的？货币金额是以美元、千美元还是1/100美分（在金融中这是一种习惯做法，计算通常使用定点算术）？这实际上是通过检查数据字典或文档中的数据定义来捕捉的，而不是在总结统计中；按每小时工资数据和每年工资单位为1000美元之间的差异在随意一瞥时可能并不明显。但在查看变量的值范围时，这仍然是一件需要记住的事情，因为通常你可以发现测量单位是否意外。汽车速度以节为单位看起来与以每小时英里为单位大不相同。
- en: 3.2\. Spotting problems using graphics and visualization
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 3.2. 使用图形和可视化发现问题
- en: As you’ve seen, you can spot plenty of problems just by looking over the data
    summaries. For other properties of the data, pictures are better than text.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所见，你只需查看数据摘要就能发现许多问题。对于数据的其他属性，图片比文字更好。
- en: '*We cannot expect a small number of numerical values [summary statistics] to
    consistently convey the wealth of information that exists in data. Numerical reduction
    methods do not retain the information in the data.*'
  id: totrans-88
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*我们不能期望少数数值[总结统计]能够持续传达数据中存在的丰富信息。数值缩减方法并不保留数据中的信息。*'
- en: ''
  id: totrans-89
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '*William Cleveland, The Elements of Graphing Data*'
  id: totrans-90
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*威廉·克利夫兰，《数据绘图要素》*'
- en: '[Figure 3.2](../Text/03.xhtml#ch03fig02) shows a plot of how customer ages
    are distributed. We’ll talk about what the y-axis of the graph means later; for
    now, just know that the height of the graph corresponds to how many customers
    in the population are of that age. As you can see, information like the peak age
    of distribution, the range of the data, and the presence of outliers is easier
    to absorb visually than it is to determine textually.'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '[图3.2](../Text/03.xhtml#ch03fig02) 展示了客户年龄分布的图表。我们稍后会讨论图表的y轴代表什么；现在只需知道，图表的高度对应于人口中该年龄段的客户数量。正如你所见，分布的峰值年龄、数据的范围以及异常值的存在，通过视觉吸收比通过文本确定要容易得多。'
- en: Figure 3.2\. Some information is easier to read from a graph, and some from
    a summary.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.2. 一些信息从图表中更容易阅读，而另一些则从摘要中更容易阅读。
- en: '![](Images/03fig02_alt.jpg)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/03fig02_alt.jpg)'
- en: 'The use of graphics to examine data is called *visualization*. We try to follow
    William Cleveland’s principles for scientific visualization. Details of specific
    plots aside, the key points of Cleveland’s philosophy are these:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 使用图形来检查数据被称为*可视化*。我们试图遵循威廉·克利夫兰的科学可视化原则。除了特定图表的细节之外，克利夫兰哲学的关键点如下：
- en: A graphic should display as much information as it can, with the lowest possible
    cognitive strain to the viewer.
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一张图表应尽可能多地展示信息，同时给观众带来最低的认知压力。
- en: 'Strive for clarity. Make the data stand out. Specific tips for increasing clarity
    include these:'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 力求清晰。使数据突出。提高清晰度的具体技巧包括以下这些：
- en: Avoid too many superimposed elements, such as too many curves in the same graphing
    space.
  id: totrans-97
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免过多的叠加元素，例如在同一绘图空间中过多的曲线。
- en: Find the right aspect ratio and scaling to properly bring out the details of
    the data.
  id: totrans-98
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 找到合适的宽高比和缩放比例，以正确展示数据的细节。
- en: Avoid having the data all skewed to one side or the other of your graph.
  id: totrans-99
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免数据在图表的一侧或另一侧过于倾斜。
- en: Visualization is an iterative process. Its purpose is to answer questions about
    the data.
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可视化是一个迭代的过程。它的目的是回答关于数据的问题。
- en: During the visualization stage, you graph the data, learn what you can, and
    then regraph the data to answer the questions that arise from your previous graphic.
    Different graphics are best suited for answering different questions. We’ll look
    at some of them in this section.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在可视化阶段，你绘制数据，学习你能学到的，然后重新绘制数据以回答从先前图形中产生的问题。不同的图形最适合回答不同的问题。我们将在本节中查看其中的一些。
- en: In this book, we’ll demonstrate the visualizations and graphics using the R
    graphing package `ggplot2` (the R realization of Leland Wilkinson’s *Grammar of
    Graphics*, Springer, 1999), as well as some prepackaged `ggplot2` visualizations
    from the package `WVPlots`. You may also want to check out the `ggpubr` and `ggstatsplot`
    packages for more prepackaged `ggplot2` graphs. And, of course, other R visualization
    packages, such as base graphics or the `lattice` package, can produce similar
    plots.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我们将使用 R 绘图包 `ggplot2`（Leland Wilkinson 的 *图形语法* 的 R 实现，Springer，1999）以及来自
    `WVPlots` 包的一些预包装 `ggplot2` 可视化来展示可视化图形。你也可以查看 `ggpubr` 和 `ggstatsplot` 包以获取更多预包装的
    `ggplot2` 图形。当然，其他 R 可视化包，如基础图形或 `lattice` 包，也可以生成类似的图形。
- en: '* * *'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: '**A note on ggplot2**'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '**关于 ggplot2 的注意事项**'
- en: 'The theme of this section is how to use visualization to explore your data,
    not how to use `ggplot2`. The `ggplot2` package is based on Leland Wilkinson’s
    book, *Grammar of Graphics*. We chose `ggplot2` because it excels at combining
    multiple graphical elements together, but its syntax can take some getting used
    to. Here are the key points to understand when looking at our code snippets:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 本节的主题是如何使用可视化来探索你的数据，而不是如何使用 `ggplot2`。`ggplot2` 包基于 Leland Wilkinson 的书籍，*图形语法*。我们选择
    `ggplot2` 是因为它擅长将多个图形元素组合在一起，但其语法可能需要一些时间来适应。以下是在查看我们的代码片段时需要理解的关键点：
- en: Graphs in `ggplot2` can only be defined on data frames. The variables in a graph—the
    *x* variable, the *y* variable, the variables that define the color or the size
    of the points—are called *aesthetics*, and are declared by using the `aes` function.
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ggplot2` 中的图形只能定义在数据框上。图形中的变量——*x* 变量、*y* 变量、定义点颜色或大小的变量——被称为 *美学*，通过使用 `aes`
    函数声明。'
- en: The `ggplot()` function declares the graph object. The arguments to `ggplot()`
    can include the data frame of interest and the aesthetics. The `ggplot()` function
    doesn’t itself produce a visualization; visualizations are produced by *layers*.
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ggplot()` 函数声明了图形对象。`ggplot()` 的参数可以包括感兴趣的数据框和美学。`ggplot()` 函数本身并不产生可视化；可视化是通过
    *层* 产生的。'
- en: Layers produce the plots and plot transformations and are added to a given graph
    object using the `+` operator. Each layer can also take a data frame and aesthetics
    as arguments, in addition to plot-specific parameters. Examples of layers are
    `geom_point` (for a scatter plot) or `geom_line` (for a line plot).
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 层生成图形和图形变换，并使用 `+` 操作符添加到给定的图形对象中。每个层也可以接受数据框和美学作为参数，以及特定的图形参数。层的例子包括 `geom_point`（用于散点图）或
    `geom_line`（用于线图）。
- en: This syntax will become clearer in the examples that follow. For more information,
    we recommend Hadley Wickham’s reference site [https://ggplot2.tidyverse.org/reference/](https://ggplot2.tidyverse.org/reference/),
    which has pointers to online documentation; the Graphs section of Winston Chang’s
    site [http://www.cookbook-r.com/](http://www.cookbook-r.com/); and Winston Chang’s
    *R Graphics Cookbook* (O’Reilly, 2012).
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的示例中，这种语法将变得更加清晰。有关更多信息，我们建议参考 Hadley Wickham 的参考网站 [https://ggplot2.tidyverse.org/reference/](https://ggplot2.tidyverse.org/reference/)，该网站提供了在线文档的链接；Winston
    Chang 网站的图形部分 [http://www.cookbook-r.com/](http://www.cookbook-r.com/)；以及 Winston
    Chang 的 *R 图形烹饪书*（O’Reilly，2012）。
- en: '* * *'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: In the next two sections, we’ll show how to use pictures and graphs to identify
    data characteristics and issues. In [section 3.2.2](../Text/03.xhtml#ch03lev2sec3),
    we’ll look at visualizations for two variables. But let’s start by looking at
    visualizations for single variables.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的两个章节中，我们将展示如何使用图片和图形来识别数据特征和问题。在 [3.2.2 节](../Text/03.xhtml#ch03lev2sec3)
    中，我们将查看两个变量的可视化。但让我们先看看单变量的可视化。
- en: 3.2.1\. Visually checking distributions for a single variable
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 3.2.1\. 检查单变量分布的视觉
- en: In this section we will look at
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中我们将查看
- en: Histograms
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 直方图
- en: Density plots
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密度图
- en: Bar charts
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 条形图
- en: Dot plots
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 点图
- en: 'The visualizations in this section help you answer questions like these:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 本节中的可视化可以帮助你回答如下问题：
- en: What is the peak value of the distribution?
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分布的峰值是多少？
- en: How many peaks are there in the distribution (unimodality versus bimodality)?
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分布中有多少个峰值（单峰与双峰）？
- en: How normal (or lognormal) is the data? We’ll discuss normal and lognormal distributions
    in [appendix B](../Text/B.xhtml#app02).
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据有多正常（或对数正态）？我们将在附录B中讨论正态和对数正态分布。[附录B](../Text/B.xhtml#app02)。
- en: How much does the data vary? Is it concentrated in a certain interval or in
    a certain category?
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据变化有多大？它是否集中在某个区间或某个类别中？
- en: 'One of the things that’s easy to grasp visually is the shape of the data distribution.
    The graph in [figure 3.3](../Text/03.xhtml#ch03fig03) is somewhat flattish between
    the ages of about 25 and about 60, falling off slowly after 60\. However, even
    within this range, there seems to be a peak at around the late-20s to early 30s
    range, and another in the early 50s. This data has multiple peaks: it is not *unimodal*.^([[1](../Text/03.xhtml#ch03fn4)])'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 容易直观理解的一件事是数据分布的形状。图3.3中的图表在25岁到60岁之间相对平坦，60岁之后缓慢下降。然而，即使在范围内，似乎在20年代末到30年代初和50年代初存在峰值。这些数据有多个峰值：它不是*单峰的*。^([[1](../Text/03.xhtml#ch03fn4)])
- en: ¹
  id: totrans-124
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ¹
- en: ''
  id: totrans-125
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The strict definition of *unimodal* is that a distribution has a unique maximum
    value; in that sense, [figure 3.3](../Text/03.xhtml#ch03fig03) is unimodal. However,
    most people use the term “unimodal” to mean that a distribution has a unique peak
    (local maxima); the customer age distribution has multiple peaks, and so we will
    call it *multimodal*.
  id: totrans-126
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*单峰*的严格定义是分布有一个唯一的最大值；从这个意义上说，[图3.3](../Text/03.xhtml#ch03fig03)是单峰的。然而，大多数人使用“单峰”一词来表示分布有一个唯一的峰值（局部最大值）；客户年龄分布有多个峰值，因此我们将它称为*多峰的*。'
- en: Figure 3.3\. The density plot of age
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.3\. 年龄密度图
- en: '![](Images/03fig03_alt.jpg)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/03fig03_alt.jpg)'
- en: Unimodality is a property you want to check in your data. Why? Because (roughly
    speaking) a unimodal distribution corresponds to one population of subjects. For
    the solid curve in [figure 3.4](../Text/03.xhtml#ch03fig04), the mean customer
    age is about 50, and 50% of the customers are between 34 and 64 (the first and
    third quartiles, shown shaded). So you can say that a “typical” customer is middle-aged
    and probably possesses many of the demographic qualities of a middle-aged person—though,
    of course, you have to verify that with your actual customer information.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 单峰性是你在数据中想要检查的一个属性。为什么？因为（粗略地说）单峰分布对应于一个受试者群体。对于图3.4中的实线曲线，平均客户年龄约为50岁，50%的客户年龄在34岁到64岁之间（第一和第三四分位数，以阴影表示）。因此，可以说“典型”的客户是中年人，并且可能拥有许多中年人的人口统计特征——尽管，当然，你必须用你的实际客户信息来验证这一点。
- en: Figure 3.4\. A unimodal distribution (solid curve) can usually be modeled as
    coming from a single population of users. With a bimodal distribution (dashed
    curve), your data often comes from two populations of users.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.4\. 单峰分布（实线曲线）通常可以建模为来自单一用户群体的数据。双峰分布（虚线曲线）时，你的数据通常来自两个用户群体。
- en: '![](Images/03fig04_alt.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/03fig04_alt.jpg)'
- en: 'The dashed curve in [figure 3.4](../Text/03.xhtml#ch03fig04) shows what can
    happen when you have two peaks, or a *bimodal distribution*. (A distribution with
    more than two peaks is *multimodal.*) This set of customers has about the same
    mean age as the customers represented by the solid curve—but a 50-year-old is
    hardly a “typical” customer! This (admittedly exaggerated) example corresponds
    to two populations of customers: a fairly young population mostly in their teens
    to late twenties, and an older population mostly in their 70s. These two populations
    probably have very different behavior patterns, and if you want to model whether
    a customer probably has health insurance or not, it wouldn’t be a bad idea to
    model the two populations separately.'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.4中的虚线曲线显示了当你有两个峰值或*双峰分布*时可能发生的情况。（具有超过两个峰值的分布是*多峰的*。）这组客户群体的平均年龄与实线曲线所代表的客户群体的平均年龄大致相同——但50岁的人
    hardly 可以算作“典型”客户！这个（诚然是夸张的）例子对应于两个客户群体：一个相对年轻的群体，主要在十几岁到二十年代末，另一个是70多岁的老年群体。这两个群体可能具有非常不同的行为模式，如果你想要建模一个客户是否可能有医疗保险，分别对这两个群体进行建模可能不是一个坏主意。
- en: The histogram and the density plot are two visualizations that help you quickly
    examine the distribution of a numerical variable. [Figures 3.1](../Text/03.xhtml#ch03fig01)
    and [3.3](../Text/03.xhtml#ch03fig03) are density plots. Whether you use histograms
    or density plots is largely a matter of taste. We tend to prefer density plots,
    but histograms are easier to explain to less quantitatively-minded audiences.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图和密度图是两种可视化工具，可以帮助您快速检查数值变量的分布。[图3.1](../Text/03.xhtml#ch03fig01)和[3.3](../Text/03.xhtml#ch03fig03)是密度图。您使用直方图还是密度图在很大程度上取决于个人喜好。我们倾向于更喜欢密度图，但直方图对不那么注重量化的人群来说更容易解释。
- en: Histograms
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图
- en: 'A basic histogram bins a variable into fixed-width buckets and returns the
    number of data points that fall into each bucket as a height. For example, suppose
    you wanted a sense of how much your customers pay in monthly gas heating bills.
    You could group the gas bill amounts in intervals of $10: $0–10, $10–20, $20–30,
    and so on. Customers at a boundary go into the higher bucket: people who pay around
    $20 a month go into the $20–30 bucket. For each bucket, you then count how many
    customers are in that bucket. The resulting histogram is shown in [figure 3.5](../Text/03.xhtml#ch03fig05).'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 基本直方图将变量分成固定宽度的桶，并返回每个桶中数据点的数量作为高度。例如，假设您想了解您的客户每月天然气供暖账单的支付情况。您可以将天然气账单金额分组为$10间隔：$0–10，$10–20，$20–30，等等。处于边界的客户进入更高的桶：每月支付约$20的人进入$20–30桶。然后，您为每个桶计数该桶中有多少客户。生成的直方图显示在[图3.5](../Text/03.xhtml#ch03fig05)中。
- en: Figure 3.5\. A histogram tells you where your data is concentrated. It also
    visually highlights outliers and anomalies.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.5\. 直方图告诉您数据集中在哪里。它还直观地突出显示异常值和异常。
- en: '![](Images/03fig05_alt.jpg)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig05_alt.jpg)'
- en: You create the histogram in [figure 3.5](../Text/03.xhtml#ch03fig05) in `ggplot2`
    with the `geom_histogram` layer.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在`ggplot2`中使用`geom_histogram`层在[图3.5](../Text/03.xhtml#ch03fig05)中创建直方图。
- en: Listing 3.6\. Plotting a histogram
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 列表3.6\. 绘制直方图
- en: '[PRE5]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: ❶ Load the ggplot2 library, if you haven’t already done so.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 如果您还没有这样做，请加载ggplot2库。
- en: '❷ The binwidth parameter tells the geom_histogram call how to make bins of
    $10 intervals (default is datarange/30). The fill parameter specifies the color
    of the histogram bars (default: black).'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ `binwidth`参数告诉`geom_histogram`调用如何创建$10间隔的桶（默认为datarange/30）。`fill`参数指定直方图条的颜色（默认：黑色）。
- en: With the proper `binwidth`, histograms visually highlight where the data is
    concentrated, and point out the presence of potential outliers and anomalies.
    In [figure 3.5](../Text/03.xhtml#ch03fig05), for example, you see that some outlier
    customers have much larger gas bills than is typical, so you may possibly want
    to drop those customers from any analysis that uses gas heating bills as an input.
    You also see an unusually high concentration of people who pay $0–10/month in
    gas. This could mean that most of your customers don’t have gas heating, but on
    further investigation you notice this in the data dictionary ([table 3.1](../Text/03.xhtml#ch03table01)).
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 适当的`binwidth`可以使直方图直观地突出数据集中的集中区域，并指出潜在异常值和异常的存在。例如，在[图3.5](../Text/03.xhtml#ch03fig05)中，您可以看到一些异常客户有比典型情况大得多的天然气账单，因此您可能希望从任何使用天然气账单作为输入的分析中排除这些客户。您还看到支付$0–10/月天然气费用的异常高人群集中。这可能意味着您的客户中大多数没有天然气供暖，但在进一步调查数据字典（[表3.1](../Text/03.xhtml#ch03table01)）时，您发现了这一点。
- en: Table 3.1\. Data dictionary entry for `gas_usage`
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 表3.1\. `gas_usage`的数据字典条目
- en: '| Value | Definition |'
  id: totrans-145
  prefs: []
  type: TYPE_TB
  zh: '| 值 | 定义 |'
- en: '| --- | --- |'
  id: totrans-146
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| NA | Unknown or not applicable |'
  id: totrans-147
  prefs: []
  type: TYPE_TB
  zh: '| NA | 未知或不适用 |'
- en: '| 001 | Included in rent or condo fee |'
  id: totrans-148
  prefs: []
  type: TYPE_TB
  zh: '| 001 | 包含在租金或公寓费中 |'
- en: '| 002 | Included in electricity payment |'
  id: totrans-149
  prefs: []
  type: TYPE_TB
  zh: '| 002 | 包含在电费中 |'
- en: '| 003 | No charge or gas not used |'
  id: totrans-150
  prefs: []
  type: TYPE_TB
  zh: '| 003 | 无费用或未使用天然气 |'
- en: '| 004-999 | $4 to $999 (rounded and top-coded) |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '| 004-999 | $4至$999（四舍五入并上限编码） |'
- en: In other words, the values in the `gas_usage` column are a mixture of numerical
    values and symbolic codes encoded as numbers. The values `001`, `002`, and `003`
    are *sentinel values*, and to treat them as numerical values could potentially
    lead to incorrect conclusions in your analysis. One possible solution in this
    case is to convert the numeric values `1`-`3` into `NA`, and add additional Boolean
    variables to indicate the possible cases (included in rent/condo fee, and so on).
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 换句话说，`gas_usage` 列中的值是数值和作为数字编码的符号代码的混合。值 `001`、`002` 和 `003` 是**哨兵值**，将它们视为数值可能会在分析中导致错误的结论。在这种情况下的一种可能的解决方案是将数值
    `1`-`3` 转换为 `NA`，并添加额外的布尔变量来指示可能的案例（包括租金/公寓费等）。
- en: The primary disadvantage of histograms is that you must decide ahead of time
    how wide the buckets are. If the buckets are too wide, you can lose information
    about the shape of the distribution. If the buckets are too narrow, the histogram
    can look too noisy to read easily. An alternative visualization is the density
    plot.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图的主要缺点是您必须提前决定桶的宽度。如果桶太宽，您可能会丢失关于分布形状的信息。如果桶太窄，直方图可能看起来太嘈杂，难以阅读。一种替代的可视化方法是密度图。
- en: Density plots
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 密度图
- en: You can think of a *density plot* as a *continuous histogram* of a variable,
    except the area under the density plot is rescaled to equal one. A point on a
    density plot corresponds to the fraction of data (or the percentage of data, divided
    by 100) that takes on a particular value. This fraction is usually very small.
    When you look at a density plot, you’re more interested in the overall shape of
    the curve than in the actual values on the y-axis. You’ve seen the density plot
    of age; [figure 3.6](../Text/03.xhtml#ch03fig06) shows the density plot of income.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以将**密度图**视为变量的**连续直方图**，除了密度图下的面积重新缩放为等于一。密度图上的一个点对应于具有特定值的数值（或数值的百分比，除以 100）的数据（或数据百分比）。这个分数通常非常小。当你查看密度图时，你更感兴趣的是曲线的整体形状，而不是
    y 轴上的实际值。你已经看到了年龄的密度图；[图 3.6](../Text/03.xhtml#ch03fig06) 显示了收入的密度图。
- en: Figure 3.6\. Density plots show where data is concentrated.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.6\. 密度图显示了数据集中的集中位置。
- en: '![](Images/03fig06_alt.jpg)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig06_alt.jpg)'
- en: You produce [figure 3.6](../Text/03.xhtml#ch03fig06) with the `geom_density`
    layer, as shown in the following listing.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 `geom_density` 层生成 [图 3.6](../Text/03.xhtml#ch03fig06)，如下面的列表所示。
- en: Listing 3.7\. Producing a density plot
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 3.7\. 生成密度图
- en: '[PRE6]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: ❶ The scales package brings in the dollar scale notation.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ The scales package brings in the dollar scale notation.
- en: ❷ Sets the x-axis labels to dollars
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 将 x 轴标签设置为美元
- en: When the data range is very wide and the mass of the distribution is heavily
    concentrated to one side, like the distribution in [figure 3.6](../Text/03.xhtml#ch03fig06),
    it’s difficult to see the details of its shape. For instance, it’s hard to tell
    the exact value where the income distribution has its peak. If the data is non-negative,
    then one way to bring out more detail is to plot the distribution on a logarithmic
    scale, as shown in [figure 3.7](../Text/03.xhtml#ch03fig07). This is equivalent
    to plotting the density plot of `log10(income)`.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 当数据范围非常广且分布的质量严重集中在一边时，就像 [图 3.6](../Text/03.xhtml#ch03fig06) 中的分布一样，很难看到其形状的细节。例如，很难确定收入分布的峰值的确切值。如果数据是非负的，那么一种突出更多细节的方法是将分布绘制在对数尺度上，如图
    [图 3.7](../Text/03.xhtml#ch03fig07) 所示。这相当于绘制 `log10(income)` 的密度图。
- en: Figure 3.7\. The density plot of income on a log10 scale highlights details
    of the income distribution that are harder to see in a regular density plot.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.7\. 在 log10 尺度上的收入密度图突出了在常规密度图中难以看到的收入分布的细节。
- en: '![](Images/03fig07_alt.jpg)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig07_alt.jpg)'
- en: In `ggplot2`, you can plot [figure 3.7](../Text/03.xhtml#ch03fig07) with the
    `geom_density` and `scale_x_log10` layers, such as in the following listing.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `ggplot2` 中，您可以使用 `geom_density` 和 `scale_x_log10` 层绘制 [图 3.7](../Text/03.xhtml#ch03fig07)，如下面的列表所示。
- en: Listing 3.8\. Creating a log-scaled density plot
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 3.8\. 创建对数刻度的密度图
- en: '[PRE7]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: ❶ Sets the x-axis to be in log10 scale, with manually set tick points and labels
    as dollars
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 将 x 轴设置为 log10 尺度，并手动设置刻度和标签为美元
- en: ❷ Adds log-scaled tick marks to the top and bottom of the graph
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 在图表的顶部和底部添加对数刻度的刻度线
- en: 'When you issue the preceding command, you also get back a warning message:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 当你发出前面的命令时，你也会收到一个警告信息：
- en: '[PRE8]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: This tells you that `ggplot2` ignored the zero- and negative-valued rows (since
    `log(0) = Infinity`), and that there were 6856 such rows. Keep that in mind when
    evaluating the graph.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 这表明`ggplot2`忽略了零值和负值行（因为`log(0) = Infinity`），并且有6856这样的行。在评估图表时请记住这一点。
- en: '* * *'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '*** '
- en: '**When should you use a logarithmic scale ?**'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: '**何时应该使用对数刻度？**'
- en: You should use a logarithmic scale when percent change, or change in orders
    of magnitude, is more important than changes in absolute units. You should also
    use a log scale to better visualize data that is heavily skewed.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 当百分比变化或数量级的变化比绝对单位的变化更重要时，你应该使用对数刻度。你也应该使用对数刻度来更好地可视化严重偏斜的数据。
- en: For example, in income data, a difference in income of $5,000 means something
    very different in a population where the incomes tend to fall in the tens of thousands
    of dollars than it does in populations where income falls in the hundreds of thousands
    or millions of dollars. In other words, what constitutes a “significant difference”
    depends on the order of magnitude of the incomes you’re looking at. Similarly,
    in a population like that in [figure 3.7](../Text/03.xhtml#ch03fig07), a few people
    with very high income will cause the majority of the data to be compressed into
    a relatively small area of the graph. For both those reasons, plotting the income
    distribution on a logarithmic scale is a good idea.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在收入数据中，收入差异为5,000美元在收入倾向于数万美元的人口中意味着与收入在数十万或数百万美元的人口中意味着大不相同。换句话说，“显著差异”的定义取决于你所查看的收入的数量级。同样，在[图3.7](../Text/03.xhtml#ch03fig07)中类似的人口中，少数高收入者会导致大多数数据压缩到图表的相对较小区域。出于这两个原因，将收入分布绘制在对数刻度上是一个好主意。
- en: '* * *'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '***'
- en: In log space, income is distributed as something that looks like a “normalish”
    distribution, as will be discussed in [appendix B](../Text/B.xhtml#app02). It’s
    not exactly a normal distribution (in fact, it appears to be at least two normal
    distributions mixed together).
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在对数空间中，收入分布看起来像“正常”分布，这将在[附录B](../Text/B.xhtml#app02)中讨论。它并不完全是一个正态分布（实际上，它似乎至少是两个正态分布混合在一起）。
- en: Bar charts and dotplots
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 条形图和点图
- en: 'A *bar chart* is a histogram for discrete data: it records the frequency of
    every value of a categorical variable. [Figure 3.8](../Text/03.xhtml#ch03fig08)
    shows the distribution of marital status in your customer dataset. If you believe
    that marital status helps predict the probability of health insurance coverage,
    then you want to check that you have enough customers with different marital statuses
    to help you discover the relationship between being married (or not) and having
    health insurance.'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '*条形图* 是离散数据的直方图：它记录了分类变量每个值的频率。[图3.8](../Text/03.xhtml#ch03fig08)显示了客户数据集中婚姻状况的分布。如果你认为婚姻状况有助于预测健康保险覆盖的可能性，那么你想要检查你是否拥有足够的不同婚姻状况的客户，以帮助你发现已婚（或未婚）与拥有健康保险之间的关系。'
- en: Figure 3.8\. Bar charts show the distribution of categorical variables.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '[图3.8]_条形图显示了分类变量的分布_。'
- en: '![](Images/03fig08_alt.jpg)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/03fig08_alt.jpg)'
- en: 'The `ggplot2` command to produce [figure 3.8](../Text/03.xhtml#ch03fig08) uses
    `geom_bar`:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 生成[图3.8](../Text/03.xhtml#ch03fig08)的`ggplot2`命令使用`geom_bar`：
- en: '[PRE9]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: This graph doesn’t really show any more information than `summary(customer_data$marital.stat)`
    would show, but some people find the graph easier to absorb than the text. Bar
    charts are most useful when the number of possible values is fairly large, like
    state of residence. In this situation, we often find that a horizontal graph like
    that shown in [figure 3.9](../Text/03.xhtml#ch03fig09) is more legible than a
    vertical graph.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 这个图表实际上并没有比`summary(customer_data$marital.stat)`显示的更多信息，但有些人发现图表比文本更容易吸收。当可能的值数量相当大时，如居住状态，条形图最有用。在这种情况下，我们经常发现像[图3.9](../Text/03.xhtml#ch03fig09)中所示的水平图表比垂直图表更易读。
- en: Figure 3.9\. A horizontal bar chart can be easier to read when there are several
    categories with long names.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: '[图3.9]_A水平条形图在存在几个具有长名称的分类时更容易阅读_。'
- en: '![](Images/03fig09_alt.jpg)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/03fig09_alt.jpg)'
- en: The `ggplot2` command to produce [figure 3.9](../Text/03.xhtml#ch03fig09) is
    shown in the next listing.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 生成[图3.9](../Text/03.xhtml#ch03fig09)的`ggplot2`命令将在下一列表中展示。
- en: Listing 3.9\. Producing a horizontal bar chart
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 列表3.9\. 生成水平条形图
- en: '[PRE10]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '❶ Plots bar chart as before: state_of_res is on x-axis, count is on y-axis'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 如前所述绘制条形图：居住状态在x轴上，计数在y轴上
- en: '❷ Flips the x and y axes: state_of_res is now on the y-axis'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 翻转 x 和 y 轴：state_of_res 现在位于 y 轴
- en: Cleveland^([[1](../Text/03.xhtml#ch03fn5)]) prefers the *dot plot* to the bar
    chart for visualizing discrete counts. This is because bars are two dimensional,
    so that a difference in counts looks like a difference in bar *areas*, rather
    than merely in bar heights. This can be perceptually misleading. Since the dot-and-line
    of a dot plot is not two dimensional, the viewer considers only the height difference
    when comparing two quantities, as they should.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 克利夫兰^([[1](../Text/03.xhtml#ch03fn5)]) 更喜欢使用 *点图* 而不是条形图来可视化离散计数。这是因为条形图是二维的，所以计数差异看起来像是条形
    *面积* 的差异，而不是仅仅在条形高度上的差异。这可能会产生感知上的误导。由于点图中的点线和线不是二维的，所以在比较两个数量时，观众只考虑高度差异，正如他们应该的那样。
- en: ¹
  id: totrans-195
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ¹
- en: ''
  id: totrans-196
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: See William S. Cleveland, *The Elements of Graphing Data*, Hobart Press, 1994.
  id: totrans-197
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 见威廉·S·克利夫兰，*数据绘图元素*，霍巴特出版社，1994年。
- en: Cleveland also recommends that the data in a bar chart or dot plot be sorted,
    to more efficiently extract insight from the data. This is shown in [figure 3.10](../Text/03.xhtml#ch03fig10).
    Now it is easy to see in which states the most customers—or the fewest—live.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 克利夫兰还建议对条形图或点图中的数据进行排序，以便更有效地从数据中提取洞察。这如图 3.10 所示。[图 3.10](../Text/03.xhtml#ch03fig10)。现在可以很容易地看到哪些州居住着最多的客户——或者最少的客户。
- en: Figure 3.10\. Using a dot plot and sorting by count makes the data even easier
    to read.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.10\. 使用点图和按计数排序使数据更容易阅读。
- en: '![](Images/03fig10_alt.jpg)'
  id: totrans-200
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig10_alt.jpg)'
- en: A sorted visualization requires a bit more manipulation, at least in `ggplot2`,
    because by default, `ggplot2` will plot the categories of a factor variable in
    alphabetical order. Fortunately, much of the code is already wrapped in the `ClevelandDotPlot`
    function from the `WVPlots` package.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 排序的可视化需要更多的操作，至少在 `ggplot2` 中是这样，因为默认情况下，`ggplot2` 将按字母顺序绘制因子变量的类别。幸运的是，大部分代码已经包含在
    `WVPlots` 包中的 `ClevelandDotPlot` 函数中。
- en: Listing 3.10\. Producing a dot plot with sorted categories
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 3.10\. 生成排序类别的点图
- en: '[PRE11]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: ❶ Loads the WVPlots library
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 加载 WVPlots 库
- en: ❷ Plots the state_of_res column of the customer_data data frame
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 绘制客户数据数据框的 state_of_res 列
- en: ❸ “sort = 1” sorts the categories in increasing order (most frequent last).
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ “sort = 1”按递增顺序（最频繁的放在最后）排序类别。
- en: ❹ Flips the axes as before
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 如前所述翻转坐标轴
- en: Before we move on to visualizations for two variables, we’ll summarize the visualizations
    that we’ve discussed in this section in [table 3.2](../Text/03.xhtml#ch03table02).
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们继续讨论两个变量的可视化之前，我们将总结本节中讨论的可视化，见[表 3.2](../Text/03.xhtml#ch03table02)。
- en: Table 3.2\. Visualizations for one variable
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 表 3.2\. 单变量可视化
- en: '| Graph type | Uses | Examples |'
  id: totrans-210
  prefs: []
  type: TYPE_TB
  zh: '| 图表类型 | 用途 | 例子 |'
- en: '| --- | --- | --- |'
  id: totrans-211
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Histogram or density plot | Examine data range Check number of modes Check
    if distribution is normal/lognormal Check for anomalies and outliers | Examine
    the distribution of customer age to get the typical customer age range Examine
    the distribution of customer income to get typical income range |'
  id: totrans-212
  prefs: []
  type: TYPE_TB
  zh: '| 直方图或密度图 | 检查数据范围 检查数量模式 检查分布是否为正态/对数正态 检查异常值和离群值 | 检查客户年龄的分布以获取典型客户年龄范围 检查客户收入的分布以获取典型收入范围
    |'
- en: '| Bar chart or dot plot | Compare frequencies of the values of a categorical
    variable | Count the number of customers from different states of residence to
    determine which states have the largest or smallest customer base |'
  id: totrans-213
  prefs: []
  type: TYPE_TB
  zh: '| 条形图或点图 | 比较分类变量值的频率 | 计算来自不同居住州的客户的数量，以确定哪些州拥有最大的或最小的客户基础 |'
- en: 3.2.2\. Visually checking relationships between two variables
  id: totrans-214
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 3.2.2\. 检查两个变量之间的关系
- en: 'In addition to examining variables in isolation, you’ll often want to look
    at the relationship between two variables. For example, you might want to answer
    questions like these:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 除了单独检查变量外，你通常会想查看两个变量之间的关系。例如，你可能想回答以下问题：
- en: Is there a relationship between the two inputs *age* and *income* in my data?
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的数据中两个输入 *年龄* 和 *收入* 之间是否存在关系？
- en: If so, what kind of relationship, and how strong?
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果有的话，是什么类型的关系，有多强？
- en: Is there a relationship between the input *marital status* and the output *health
    insurance*? How strong?
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输入 *婚姻状况* 和输出 *健康保险* 之间是否存在关系？有多强？
- en: You’ll precisely quantify these relationships during the modeling phase, but
    exploring them now gives you a feel for the data and helps you determine which
    variables are the best candidates to include in a model.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 你将在建模阶段精确量化这些关系，但现在探索它们可以让你对数据有一个感觉，并帮助你确定哪些变量是模型中最佳候选变量。
- en: 'This section explores the following visualizations:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 本节探讨了以下可视化：
- en: Line plots and scatter plots for comparing two continuous variables
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于比较两个连续变量的折线图和散点图
- en: Smoothing curves and hexbin plots for comparing two continuous variables at
    high volume
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于比较大量两个连续变量的平滑曲线和六边形图
- en: Different types of bar charts for comparing two discrete variables
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于比较两个离散变量的不同类型的条形图
- en: Variations on histograms and density plots for comparing a continuous and discrete
    variable
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于比较连续和离散变量的直方图和密度图的变体
- en: First, let’s consider the relationship between two continuous variables. The
    first plot you might think of (though it’s not always the best) is the line plot.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们考虑两个连续变量之间的关系。你可能首先想到的图表（尽管它并不总是最好的）是折线图。
- en: Line plots
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 折线图
- en: '*Line plots* work best when the relationship between two variables is relatively
    clean: each *x* value has a unique (or nearly unique) *y* value, as in [figure
    3.11](../Text/03.xhtml#ch03fig11). You plot [figure 3.11](../Text/03.xhtml#ch03fig11)
    with `geom_line`.'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: '*折线图*在两个变量之间的关系相对清晰时效果最好：每个*x*值都有一个唯一的（或几乎唯一的）*y*值，如[图3.11](../Text/03.xhtml#ch03fig11)所示。你使用`geom_line`绘制[图3.11](../Text/03.xhtml#ch03fig11)。'
- en: Figure 3.11\. Example of a line plot
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.11。折线图的示例
- en: '![](Images/03fig11_alt.jpg)'
  id: totrans-229
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig11_alt.jpg)'
- en: Listing 3.11\. Producing a line plot
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 列表3.11。生成折线图
- en: '[PRE12]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: ❶ First, generate the data for this example. The x variable is uniformly randomly
    distributed between 0 and 1.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 首先，生成本例的数据。x变量在0和1之间均匀随机分布。
- en: ❷ The y variable is a quadratic function of x.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ y变量是x的二次函数。
- en: ❸ Plots the line plot
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 绘制折线图
- en: When the data is not so cleanly related, line plots aren’t as useful; you’ll
    want to use the scatter plot instead, as you’ll see in the next section.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 当数据关系不是那么清晰时，折线图并不那么有用；你将想要使用散点图，正如你将在下一节中看到的。
- en: Scatter plots and smoothing curves
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 散点图和平滑曲线
- en: You’d expect there to be a relationship between age and health insurance, and
    also a relationship between income and health insurance. But what is the relationship
    between age and income? If they track each other perfectly, then you might not
    want to use both variables in a model for health insurance. The appropriate summary
    statistic is the correlation, which we compute on a safe subset of our data.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会预期年龄和健康保险之间存在关系，收入和健康保险之间也存在关系。但年龄和收入之间的关系是什么？如果它们完美地相互跟踪，那么你可能不想在健康保险模型中使用这两个变量。适当的汇总统计量是相关性，我们在数据的一个安全子集上计算它。
- en: Listing 3.12\. Examining the correlation between age and income
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 列表3.12。检查年龄和收入之间的相关性
- en: '[PRE13]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: ❶ Only consider a subset of data with reasonable age and income values.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 只考虑具有合理年龄和收入值的子集数据。
- en: ❷ Gets correlation of age and income
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 获取年龄和收入的相关性
- en: ❸ Resulting correlation is positive but nearly zero.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 结果相关性为正但几乎为零。
- en: The correlation is positive, as you might expect, but nearly zero, meaning there
    is apparently not much relation between age and income. A visualization gives
    you more insight into what’s going on than a single number can. Let’s try a scatter
    plot first ([figure 3.12](../Text/03.xhtml#ch03fig12)). Because our dataset has
    over 64,000 rows, which is too large for a legible scatterplot, we will sample
    the dataset down before plotting. You plot [figure 3.12](../Text/03.xhtml#ch03fig12)
    with `geom_point`, as shown in [listig 3.13](../Text/03.xhtml#ch03ex13).
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 相关性为正，正如你可能预期的，但几乎为零，这意味着年龄和收入之间似乎没有太多关系。可视化比单个数字能提供更多关于正在发生的事情的洞察。让我们先尝试散点图（[图3.12](../Text/03.xhtml#ch03fig12)）。由于我们的数据集有超过64,000行，这对于可读的散点图来说太大，我们将在绘图之前对数据集进行抽样。你使用`geom_point`绘制[图3.12](../Text/03.xhtml#ch03fig12)，如[列表3.13](../Text/03.xhtml#ch03ex13)所示。
- en: Figure 3.12\. A scatter plot of income versus age
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.12。收入与年龄的散点图
- en: '![](Images/03fig12_alt.jpg)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig12_alt.jpg)'
- en: Listing 3.13\. Creating a scatterplot of age and income
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 列表3.13。创建年龄和收入的散点图
- en: '[PRE14]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: ❶ Make the random sampling reproducible by setting the random seed.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 通过设置随机种子使随机抽样可重复。
- en: ❷ For legibility, only plot a 10% sample of the data. We will show how to plot
    all the data in a following section.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 为了可读性，只绘制数据的10%样本。我们将在下一节中展示如何绘制所有数据。
- en: ❸ Creates the scatterplot
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 创建散点图
- en: The relationship between age and income isn’t easy to see. You can try to make
    the relationship clearer by also plotting a smoothing curve through the data,
    as shown in [figure 3.13](../Text/03.xhtml#ch03fig13).
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 年龄与收入之间的关系并不容易看出。你可以尝试通过在数据上绘制平滑曲线来使这种关系更清晰，如图3.13图所示。
- en: Figure 3.13\. A scatter plot of income versus age, with a smoothing curve
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.13. 收入与年龄的散点图，带有平滑曲线
- en: '![](Images/03fig13_alt.jpg)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig13_alt.jpg)'
- en: The smoothing curve makes it easier to see that in this population, income tends
    to increase with age from a person’s twenties until their mid-thirties, after
    which income increases at a slower, almost flat, rate until about a person’s mid-fifties.
    Past the mid-fifties, income tends to decrease with age.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 平滑曲线使得更容易看出，在这个群体中，收入通常从二十多岁开始随着年龄增长，直到三十多岁中期，之后收入以较慢、几乎平缓的速度增长，直到大约五十多岁中期。五十多岁中期之后，收入通常随着年龄的增长而减少。
- en: 'In `ggplot2`, you can plot a smoothing curve to the data by using `geom_smooth`:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `ggplot2` 中，你可以通过使用 `geom_smooth` 来对数据进行平滑曲线绘制：
- en: '[PRE15]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: For datasets with a small number of points, the `geom_smooth` function uses
    the `loess` (or `lowess`) function to calculate smoothed local linear fits of
    the data. For larger datasets, like this one, `geom_smooth` uses a spline fit.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 对于点数较少的数据集，`geom_smooth` 函数使用 `loess`（或 `lowess`）函数来计算数据的平滑局部线性拟合。对于像这样较大的数据集，`geom_smooth`
    使用样条拟合。
- en: By default, `geom_smooth` also plots a "standard error" ribbon around the smoothing
    curve. This ribbon is wider where there are fewer data points and narrower where
    the data is dense. It’s meant to indicate where the smoothing curve estimate is
    more uncertain. For the plot in [figure 3.13](../Text/03.xhtml#ch03fig13), the
    scatterplot is so dense that the smoothing ribbon isn’t visible, except at the
    extreme right of the graph. Since the scatterplot already gives you the same information
    that the standard error ribbon does, you can turn it off with the argument `se=FALSE`,
    as we will see in a later example.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`geom_smooth` 还会在平滑曲线周围绘制一个“标准误差”带。这个带子在哪里数据点较少就较宽，在哪里数据密集就较窄。它的目的是表示平滑曲线估计的不确定性。对于图3.13中的图表，散点图非常密集，以至于平滑带在图表的极端右侧之外是不可见的。由于散点图已经提供了标准误差带所提供的信息，你可以通过
    `se=FALSE` 参数将其关闭，正如我们将在后面的例子中看到的那样。
- en: A scatter plot with a smoothing curve also makes a useful visualization of the
    relationship between a continuous variable and a Boolean. Suppose you’re considering
    using age as an input to your health insurance model. You might want to plot health
    insurance coverage as a function of age, as shown in [figure 3.14](../Text/03.xhtml#ch03fig14).
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 带有平滑曲线的散点图也用于连续变量与布尔值之间关系的可视化。假设你正在考虑将年龄作为你的医疗保险模型的输入。你可能想绘制医疗保险覆盖范围作为年龄的函数，如图3.14图所示。
- en: Figure 3.14\. Fraction of customers with health insurance, as a function of
    age
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.14. 拥有医疗保险的客户比例，作为年龄的函数
- en: '![](Images/03fig14_alt.jpg)'
  id: totrans-261
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig14_alt.jpg)'
- en: The variable `health_ins` has the value `1` (for TRUE) when the person has health
    insurance, and `0` (for FALSE) otherwise. A scatterplot of the data will have
    all the y-values at `0` or `1`, which may not seem informative, but a smoothing
    curve of the data estimates the average value of the `0`/`1` variable `health_ins`
    as a function of age. The average value of `health_ins` for a given age is simply
    the probability that a person of that age in your dataset has health insurance.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 当一个人有医疗保险时，变量 `health_ins` 的值为 `1`（表示 TRUE），否则为 `0`（表示 FALSE）。数据的散点图将会有所有的 y
    值都是 `0` 或 `1`，这可能看起来没有太多信息量，但数据的平滑曲线估计了 `0`/`1` 变量 `health_ins` 作为年龄的函数的平均值。给定年龄的
    `health_ins` 的平均值简单地是该年龄的人在你数据集中拥有医疗保险的概率。
- en: '[Figure 3.14](../Text/03.xhtml#ch03fig14) shows you that the probability of
    having health insurance increases as customer age increases, from about 80% at
    age 20 to nearly 100% after about age 75.'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: '[图3.14](../Text/03.xhtml#ch03fig14) 展示了随着客户年龄的增长，拥有医疗保险的概率也在增加，从20岁时的约80%增加到75岁后的近100%。'
- en: '* * *'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: '**Why keep the scatterplot?**'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: '**为什么保留散点图？**'
- en: You might ask, why bother to plot the points? Why not just plot the smoothing
    curve? After all, the data only takes on the values `0` and `1`, so the scatterplot
    doesn’t seem informative.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会问，为什么费心绘制这些点？为什么不直接绘制平滑曲线？毕竟，数据只取`0`和`1`这两个值，所以散点图似乎没有太多信息量。
- en: This is a matter of taste, but we like to keep the scatterplot because it gives
    us a visual estimate of how much data there is in different ranges of the *x*
    variable. For example, if your data has only a dozen or so customers in the 70–100
    age range, then you know that estimates of the probability of health insurance
    in that age range may not be very good. Conversely, if you have hundreds of customers
    spread over that age range, then you can have more confidence in the estimate.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 这是个品味问题，但我们喜欢保留散点图，因为它能让我们直观地估计出在*x*变量的不同范围内有多少数据。例如，如果你的数据在70-100岁年龄段的客户只有十几个，那么你就知道那个年龄段健康保险概率的估计可能不太准确。相反，如果你有数百名客户分布在那个年龄段，那么你对估计的信心就会更大。
- en: The standard error ribbon that `geom_smooth` plots around the smoothing curve
    gives equivalent information, but we find the scatterplot more helpful.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: '`geom_smooth`在平滑曲线周围绘制的标准误差带提供了等效的信息，但我们发现散点图更有帮助。'
- en: '* * *'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: 'An easy way to plot [figure 3.14](../Text/03.xhtml#ch03fig14) is with the `BinaryYScatterPlot`
    function from `WVPlots`:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`WVPlots`中的`BinaryYScatterPlot`函数绘制[图3.14](../Text/03.xhtml#ch03fig14)是一个简单的方法：
- en: '[PRE16]'
  id: totrans-271
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: By default, `BinaryYScatterPlot` fits a logistic regression curve through the
    data. You will learn more about logistic regression in [chapter 8](../Text/08.xhtml#ch08),
    but for now just know that a logistic regression tries to estimate the probability
    that the Boolean outcome `y` is true, as a function of the data `x`.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`BinaryYScatterPlot`通过数据拟合逻辑回归曲线。你将在[第8章](../Text/08.xhtml#ch08)中了解更多关于逻辑回归的内容，但就现在而言，只需知道逻辑回归试图估计布尔结果`y`为真的概率，作为数据`x`的函数。
- en: If you tried to plot all the points from the `customer_data2` dataset, the scatter
    plot would turn into an illegible smear. To plot all the data in higher volume
    situations like this, try an aggregated plot, like a hexbin plot.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你尝试绘制`customer_data2`数据集中所有点的散点图，散点图将变成难以辨认的涂抹。为了在类似这种情况的高容量情况下绘制所有数据，尝试一个聚合图，如hexbin图。
- en: Hexbin plots
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: Hexbin图
- en: A *hexbin plot* is like a two-dimensional histogram. The data is divided into
    bins, and the number of data points in each bin is represented by color or shading.
    Let’s go back to the income versus age example. [Figure 3.15](../Text/03.xhtml#ch03fig15)
    shows a hexbin plot of the data. Note how the smoothing curve traces out the shape
    formed by the densest region of data.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: '*hexbin*图就像一个二维直方图。数据被分成几个区间，每个区间中的数据点数量用颜色或阴影表示。让我们回到收入与年龄的例子。[图3.15](../Text/03.xhtml#ch03fig15)展示了数据的hexbin图。注意平滑曲线是如何追踪数据最密集区域形成的形状的。'
- en: Figure 3.15\. Hexbin plot of income versus age, with a smoothing curve superimposed
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.15\. 收入与年龄的hexbin图，叠加了平滑曲线
- en: '![](Images/03fig15_alt.jpg)'
  id: totrans-277
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/03fig15_alt.jpg)'
- en: To make a hexbin plot in R, you must have the `hexbin` package installed. We’ll
    discuss how to install R packages in [appendix A](../Text/A.xhtml#app01). Once
    `hexbin` is installed and the library loaded, you create the plots using the `geom_hex`
    layer, or use the convenience function `HexBinPlot` from `WVPlots`, as we do here.
    `HexBinPlot` predefines a color scale where denser cells are colored darker; the
    default `ggplot2` color scale colors denser cells lighter.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 要在R中制作hexbin图，你必须安装`hexbin`包。我们将在[附录A](../Text/A.xhtml#app01)中讨论如何安装R包。一旦安装了`hexbin`并加载了库，你可以使用`geom_hex`层创建图表，或者使用`WVPlots`中的便利函数`HexBinPlot`，就像我们在这里做的那样。`HexBinPlot`预先定义了一个颜色尺度，其中密集的单元格被着色得更深；默认的`ggplot2`颜色尺度将密集的单元格着色得更浅。
- en: Listing 3.14\. Producing a `hexbin` plot
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 列表3.14\. 制作`hexbin`图
- en: '[PRE17]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: ❶ Loads the WVPlots library
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 加载WVPlots库
- en: ❷ Plots the hexbin of income as a function of age
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 绘制收入作为年龄函数的hexbin图
- en: ❸ Adds the smoothing line in black; suppresses standard error ribbon (se=FALSE)
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 在黑色中添加平滑线；抑制标准误差带（se=FALSE）
- en: In this section and the previous section, we’ve looked at plots where at least
    one of the variables is numerical. But in our health insurance example, the output
    is categorical, and so are many of the input variables. Next we’ll look at ways
    to visualize the relationship between two categorical variables.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节和上一节中，我们查看了一些至少有一个变量是数值的图表。但在我们的健康保险例子中，输出是分类的，许多输入变量也是分类的。接下来，我们将探讨可视化两个分类变量之间关系的方法。
- en: Bar charts for two categorical variables
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 两个分类变量的条形图
- en: Let’s examine the relationship between marital status and the probability of
    health insurance coverage. The most straightforward way to visualize this is with
    a *stacked bar chart*, as shown in [figure 3.16](../Text/03.xhtml#ch03fig16).
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们考察婚姻状态与健康保险覆盖率概率之间的关系。可视化这种关系的最直接方法是使用*堆积条形图*，如图3.16所示。
- en: 'Figure 3.16\. Health insurance versus marital status: stacked bar chart'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.16\. 健康保险与婚姻状态：堆积条形图
- en: '![](Images/03fig16_alt.jpg)'
  id: totrans-288
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig16_alt.jpg)'
- en: The stacked bar chart makes it easy to compare the total number of people in
    each marital category, and to compare the number of uninsured people in each marital
    category. However, you can’t directly compare the number of insured people in
    each category, because the bars don’t all start at the same level. So some people
    prefer the *side-by-side bar chart*, shown in [figure 3.17](../Text/03.xhtml#ch03fig17),
    which makes it easier to compare the number of both insured and uninsured across
    categories—but not the total number of people in each category.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 堆积条形图使得比较每个婚姻类别中的人数总和以及比较每个婚姻类别中未投保人数变得容易。然而，你不能直接比较每个类别中投保人数的数量，因为条形并不都从同一水平开始。所以有些人更喜欢[图3.17](../Text/03.xhtml#ch03fig17)中显示的*并列条形图*，这使得比较不同类别中投保和未投保人数变得更容易——但不是每个类别中总人数。
- en: 'Figure 3.17\. Health insurance versus marital status: side-by-side bar chart'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.17\. 健康保险与婚姻状态：并列条形图
- en: '![](Images/03fig17_alt.jpg)'
  id: totrans-291
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig17_alt.jpg)'
- en: If you want to compare the number of insured and uninsured people across categories,
    while keeping a sense of the total number of people in each category, one plot
    to try is what we call a *shadow plot*. A shadow plot of this data creates two
    graphs, one for the insured population and one for the uninsured population. Both
    graphs are superimposed against a “shadow graph” of the total population. This
    allows comparison both across and within marital status categories, while maintaining
    information about category totals. This is shown in [figure 3.18](../Text/03.xhtml#ch03fig18).
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要比较不同类别中投保和未投保人数，同时保持每个类别中总人数的概念，一个可以尝试的图表是我们所说的阴影图。这个数据集的阴影图创建了两个图表，一个用于投保人口，一个用于未投保人口。这两个图表都叠加在总人口的“阴影图”上。这允许在婚姻状态类别之间和内部进行比较，同时保持类别总数的信息。这如图3.18所示。
- en: 'Figure 3.18\. Health insurance versus marital status: shadow plot'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.18\. 健康保险与婚姻状态：阴影图
- en: '![](Images/03fig18_alt.jpg)'
  id: totrans-294
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig18_alt.jpg)'
- en: The main shortcoming of all the preceding charts is that you can’t easily compare
    the ratios of insured to uninsured across categories, especially for rare categories
    like Widowed. You can use what `ggplot2` calls a *filled bar chart* to plot a
    visualization of the ratios directly, as in [figure 3.19](../Text/03.xhtml#ch03fig19).
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 所有前面图表的主要缺点是，你不能轻易地比较投保与未投保人数的比率，特别是对于像丧偶这样的罕见类别。你可以使用`ggplot2`所说的*填充条形图*直接绘制比率的可视化，如图3.19所示。
- en: 'Figure 3.19\. Health insurance versus marital status: filled bar chart'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.19\. 健康保险与婚姻状态：填充条形图
- en: '![](Images/03fig19_alt.jpg)'
  id: totrans-297
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig19_alt.jpg)'
- en: The filled bar chart makes it obvious that divorced customers are slightly more
    likely to be uninsured than married ones. But you’ve lost the information that
    being widowed, though highly predictive of insurance coverage, is a rare category.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 填充条形图使得明显看出离婚客户比已婚客户更有可能未投保。但你失去了关于丧偶的信息，尽管它高度预测保险覆盖率，但这是一个罕见的类别。
- en: Which bar chart you use depends on what information is most important for you
    to convey. The code to generate each of these plots is given next. Note the use
    of the `fill` aesthetic in the `ggplot2` commands; this tells `ggplot2` to color
    (fill) the bars according to the value of the variable `health_ins`. The `position`
    argument to `geom_bar` specifies the bar chart style.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 你使用哪种条形图取决于你需要传达的最重要信息是什么。接下来给出生成这些图表的代码。注意`ggplot2`命令中使用`fill`美学；这告诉`ggplot2`根据变量`health_ins`的值来着色（填充）条形。`geom_bar`的`position`参数指定条形图样式。
- en: Listing 3.15\. Specifying different styles of bar chart
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 列表3.15\. 指定不同的条形图样式
- en: '[PRE18]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: ❶ Stacked bar chart, the default
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 堆积条形图，默认样式
- en: ❷ Side-by-side bar chart
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 并列条形图
- en: ❸ Uses the ShadowPlot command from the WVPlots package for the shadow plot
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 使用来自WVPlots包的ShadowPlot命令进行阴影图绘制
- en: ❹ Filled bar chart
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 填充条形图
- en: In the preceding examples, one of the variables was binary; the same plots can
    be applied to two variables that each have several categories, but the results
    are harder to read. Suppose you’re interested in the distribution of marriage
    status across housing types. Some find the side-by-side bar chart easiest to read
    in this situation, but it’s not perfect, as you see in [figure 3.20](../Text/03.xhtml#ch03fig20).
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的例子中，一个变量是二元的；相同的图表可以应用于每个变量都有几个类别的两个变量，但结果更难阅读。假设你对不同住房类型的婚姻状况分布感兴趣。有些人发现在这种情况下并排条形图最容易阅读，但它并不完美，如你在
    [图 3.20](../Text/03.xhtml#ch03fig20) 中所见。
- en: 'Figure 3.20\. Distribution of marital status by housing type: side-by-side
    bar chart'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.20\. 按住房类型分布的婚姻状况：并排条形图
- en: '![](Images/03fig20_alt.jpg)'
  id: totrans-308
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig20_alt.jpg)'
- en: A graph like [figure 3.20](../Text/03.xhtml#ch03fig20) gets cluttered if either
    of the variables has a large number of categories. A better alternative is to
    break the distributions into different graphs, one for each housing type. In `ggplot2`
    this is called *faceting* the graph, and you use the `facet_wrap` layer. The result
    is shown in [figure 3.21](../Text/03.xhtml#ch03fig21).
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 如果任何一个变量有大量类别，像 [图 3.20](../Text/03.xhtml#ch03fig20) 这样的图表就会显得杂乱。更好的选择是将分布分解成不同的图表，每个住房类型一个。在
    `ggplot2` 中，这被称为 *分面* 图表，并使用 `facet_wrap` 层。结果如图 [图 3.21](../Text/03.xhtml#ch03fig21)
    所示。
- en: 'Figure 3.21\. Distribution of marital status by housing type: faceted side-by-side
    bar chart'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.21\. 按住房类型分布的婚姻状况：分面并排条形图
- en: '![](Images/03fig21_alt.jpg)'
  id: totrans-311
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig21_alt.jpg)'
- en: The code for [figures 3.20](../Text/03.xhtml#ch03fig20) and [3.21](../Text/03.xhtml#ch03fig21)
    looks like the next listing.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 3.20](../Text/03.xhtml#ch03fig20) 和 [3.21](../Text/03.xhtml#ch03fig21) 的代码看起来像下面的列表。'
- en: Listing 3.16\. Plotting a bar chart with and without facets
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 3.16\. 带与不带分面的条形图绘制
- en: '[PRE19]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: ❶ Restricts to the data where housing_type is known
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 限制为已知住房类型的数据
- en: ❷ Side-by-side bar chart
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 并排条形图
- en: ❸ Uses coord_flip () to rotate the graph so that marital_status is legible
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 使用 coord_flip() 函数旋转图表，以便婚姻状况可读
- en: ❹ The faceted bar chart
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 分面条形图
- en: ❺ Facets the graph by housing.type. The scales="free_x" argument specifies that
    each facet has an independently scaled x-axis; the default is that all facets
    have the same scales on both axes. The argument "free_y" would free the y-axis
    scaling, and the argument "free" frees both axes.
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 通过 housing.type 对图表进行分面。参数 scales="free_x" 指定每个分面都有一个独立缩放的 x 轴；默认情况下，所有分面在两个轴上都有相同的缩放。参数
    "free_y" 将释放 y 轴缩放，而参数 "free" 则释放两个轴。
- en: ❻ Uses coord_flip() to rotate the graph
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: ❻ 使用 coord_flip() 函数旋转图表
- en: Comparing a continuous and categorical variable
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 比较连续变量和分类变量
- en: 'Suppose you want to compare the age distributions of people of different marital
    statuses in your data. You saw in [section 3.2.1](../Text/03.xhtml#ch03lev2sec2)
    that you can use histograms or density plots to look at the distribution of continuous
    variables like `age`. Now you want multiple distribution plots: one for each category
    of marital status. The most straightforward way to do this is to superimpose these
    plots in the same graph.'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你想比较你数据中不同婚姻状况人群的年龄分布。你在 [3.2.1 节](../Text/03.xhtml#ch03lev2sec2) 中看到，你可以使用直方图或密度图来查看连续变量（如
    `age`）的分布。现在你想要多个分布图：每个婚姻状况类别一个。最直接的方法是将这些图叠加在同一张图上。
- en: '[Figure 3.22](../Text/03.xhtml#ch03fig22) compares the age distributions of
    the widowed (dashed line) and never married (solid line) populations in the data.
    You can quickly see that the two populations are distributed quite differently:
    the widowed population skews older, and the never married population skews younger.'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 3.22](../Text/03.xhtml#ch03fig22) 比较了数据中丧偶（虚线）和从未结婚（实线）人群的年龄分布。你可以快速看到这两个种群分布差异很大：丧偶人群偏老，而从未结婚的人群偏年轻。'
- en: Figure 3.22\. Comparing the distribution of marital status for widowed and never
    married populations
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.22\. 比较丧偶和从未结婚人群的婚姻状况分布
- en: '![](Images/03fig22_alt.jpg)'
  id: totrans-325
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig22_alt.jpg)'
- en: The code to produce [figure 3.22](../Text/03.xhtml#ch03fig22) is as follows.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 生成 [图 3.22](../Text/03.xhtml#ch03fig22) 的代码如下。
- en: Listing 3.17\. Comparing population densities across categories
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 3.17\. 比较不同类别的种群密度
- en: '[PRE20]'
  id: totrans-328
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: ❶ Restricts to the data for widowed or never married people
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 限制为丧偶或从未结婚的人的数据
- en: ❷ Differentiates the color and line style of the plots by marital_status
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 通过婚姻状况区分图表的颜色和线型
- en: 'Overlaid density plots give you good information about distribution shape:
    where populations are dense and where they are sparse, whether the populations
    are separated or overlap. However, they lose information about the relative size
    of each population. This is because each individual density plot is scaled to
    have unit area. This has the advantage of improving the legibility of each individual
    distribution, but can fool you into thinking that all the populations are about
    the same size. In fact, the superimposed density plots in [figure 3.22](../Text/03.xhtml#ch03fig22)
    can also fool you into thinking that the widowed population becomes greater than
    the never married population after age 55, which is actually not true.'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 重叠密度图可以提供关于分布形状的良好信息：人口密集和稀疏的地方，人口是否分离或重叠。然而，它们会失去关于每个种群相对大小的信息。这是因为每个个体的密度图都按单位面积缩放。这有利于提高每个个体分布的可读性，但可能会让你误以为所有种群的大小都差不多。实际上，[图3.22](../Text/03.xhtml#ch03fig22)中的重叠密度图也可能让你误以为55岁后丧偶人口会超过从未结婚的人口，这实际上是不正确的。
- en: To retain information about the relative size of each population, use histograms.
    Histograms don’t superimpose well, so you can use the `facet_wrap()` command with
    `geom_histogram()`, as you saw with bar charts in [listing 3.16](../Text/03.xhtml#ch03ex16).
    You can also produce a histogram version of the shadow plot, using the `ShadowHist()`
    function from `WVPlots`, as shown next.
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保留关于每个种群相对大小的信息，使用直方图。直方图不易重叠，因此你可以使用`facet_wrap()`命令与`geom_histogram()`一起使用，就像你在[列表3.16](../Text/03.xhtml#ch03ex16)中看到的柱状图一样。你还可以使用`WVPlots`中的`ShadowHist()`函数生成阴影图的直方图版本，如下所示。
- en: Listing 3.18\. Comparing population densities across categories with `ShadowHist()`
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 列表3.18. 使用`ShadowHist()`比较不同类别的种群密度
- en: '[PRE21]'
  id: totrans-334
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: ❶ Sets the bin widths of the histogram to 5
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 将直方图的箱宽设置为5
- en: The result is shown in [figure 3.23](../Text/03.xhtml#ch03fig23). Now you can
    see that the widowed population is quite small, and doesn’t exceed the never married
    population until after about age 65—10 years later than the crossover point in
    [figure 3.22](../Text/03.xhtml#ch03fig22).
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 结果显示在[图3.23](../Text/03.xhtml#ch03fig23)中。现在你可以看到，丧偶人口相当少，并且直到大约65岁后才会超过从未结婚的人口——比[图3.22](../Text/03.xhtml#ch03fig22)中的交叉点晚10年。
- en: Figure 3.23\. `ShadowHist` comparison of the age distributions of widowed and
    never married populations
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.23. 丧偶和从未结婚人口年龄分布的`ShadowHist`比较
- en: '![](Images/03fig23_alt.jpg)'
  id: totrans-338
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig23_alt.jpg)'
- en: You should also use faceting when comparing distributions across more than two
    categories, because too many overlaid plots are hard to read. Try examining the
    age distributions for all four categories of marital status; the plot is shown
    in [figure 3.24](../Text/03.xhtml#ch03fig24).
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 当比较超过两个类别的分布时，你也应使用分面，因为过多的重叠图表难以阅读。尝试检查所有四个婚姻状况类别的年龄分布；该图表显示在[图3.24](../Text/03.xhtml#ch03fig24)中。
- en: Figure 3.24\. Faceted plot of the age distributions of different marital statuses
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.24. 不同婚姻状况年龄分布的截面图
- en: '![](Images/03fig24_alt.jpg)'
  id: totrans-341
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/03fig24_alt.jpg)'
- en: '[PRE22]'
  id: totrans-342
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Again, these density plots give you good information about distribution shape,
    but they lose information about the relative size of each population.
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，这些密度图可以提供关于分布形状的良好信息，但会失去关于每个种群相对大小的信息。
- en: Overview of visualizations for two variables
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 两个变量可视化概述
- en: '[Table 3.3](../Text/03.xhtml#ch03table03) summarizes the visualizations for
    two variables that we’ve covered.'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: '[表3.3](../Text/03.xhtml#ch03table03)总结了我们所涵盖的两个变量的可视化。'
- en: Table 3.3\. Visualizations for two variables
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 表3.3. 两个变量的可视化
- en: '| Graph type | Uses | Examples |'
  id: totrans-347
  prefs: []
  type: TYPE_TB
  zh: '| 图表类型 | 使用 | 示例 |'
- en: '| --- | --- | --- |'
  id: totrans-348
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Line plot | Shows the relationship between two continuous variables. Best
    when that relationship is functional, or nearly so. | Plot *y = f(x)*. |'
  id: totrans-349
  prefs: []
  type: TYPE_TB
  zh: '| 折线图 | 显示两个连续变量之间的关系。当这种关系是函数性的或几乎如此时最佳。 | 绘制 *y = f(x)*。 |'
- en: '| Scatter plot | Shows the relationship between two continuous variables. Best
    when the relationship is too loose or cloud-like to be easily seen on a line plot.
    | Plot income vs. years in the workforce (income on the y-axis). |'
  id: totrans-350
  prefs: []
  type: TYPE_TB
  zh: '| 散点图 | 显示两个连续变量之间的关系。当关系过于松散或类似云朵，难以在折线图上轻易看出时最佳。 | 绘制收入与工作年限的关系图（收入在y轴上）。
    |'
- en: '| Smoothing curve | Shows underlying “average” relationship, or trend, between
    two continuous variables. Can also be used to show the relationship between a
    continuous and a binary or Boolean variable: the fraction of true values of the
    discrete variable as a function of the continuous variable. | Estimate the “average”
    relationship of income to years in the workforce. |'
  id: totrans-351
  prefs: []
  type: TYPE_TB
  zh: '| 平滑曲线 | 展示两个连续变量之间的“平均”关系或趋势。也可以用来展示连续变量与二进制或布尔变量之间的关系：离散变量的真实值作为连续变量的函数的分数。|
    估计收入与工作年限之间的“平均”关系。|'
- en: '| Hexbin plot | Shows the relationship between two continuous variables when
    the data is very dense. | Plot income vs. years in the workforce for a large population.
    |'
  id: totrans-352
  prefs: []
  type: TYPE_TB
  zh: '| 六边形图 | 当数据非常密集时，展示两个连续变量之间的关系。| 为大量人口绘制收入与工作年限的关系图。|'
- en: '| Stacked bar chart | Shows the relationship between two categorical variables
    (var1 and var2). Highlights the frequencies of each value of var1\. Works best
    when var2 is binary. | Plot insurance coverage (var2) as a function of marital
    status (var1) when you wish to retain information about the number of people in
    each marital category. |'
  id: totrans-353
  prefs: []
  type: TYPE_TB
  zh: '| 堆积条形图 | 展示两个分类变量（var1 和 var2）之间的关系。突出显示 var1 的每个值的频率。当 var2 为二进制时效果最佳。| 当您想保留每个婚姻类别中人数的信息时，将保险覆盖范围（var2）作为婚姻状况（var1）的函数绘制。|'
- en: '| Side-by-side bar chart | Shows the relationship between two categorical variables
    (var1 and var2). Good for comparing the frequencies of each value of var2 across
    the values of var1\. Works best when var2 is binary. | Plot insurance coverage
    (var2) as a function of marital status (var1) when you wish to directly compare
    the number of insured and uninsured people in each marital category. |'
  id: totrans-354
  prefs: []
  type: TYPE_TB
  zh: '| 并列条形图 | 展示两个分类变量（var1 和 var2）之间的关系。适用于比较 var1 的每个值上 var2 的频率。当 var2 为二进制时效果最佳。|
    当您想直接比较每个婚姻类别中投保和未投保人数时，将保险覆盖范围（var2）作为婚姻状况（var1）的函数绘制。|'
- en: '| Shadow plot | Shows the relationship between two categorical variables (var1
    and var2). Displays the frequency of each value of var1, while allowing comparison
    of var2 values both within and across the categories of var1. | Plot insurance
    coverage (var2) as a function of marital status (var1) when you wish to directly
    compare the number of insured and uninsured people in each marital category *and*
    still retain information about the total number of people in each marital category.
    |'
  id: totrans-355
  prefs: []
  type: TYPE_TB
  zh: '| 阴影图 | 展示两个分类变量（var1 和 var2）之间的关系。显示 var1 的每个值的频率，同时允许比较 var2 的值在 var1 的各个类别内和类别间的比较。|
    当您想直接比较每个婚姻类别中投保和未投保人数，并且仍然保留每个婚姻类别中总人数的信息时，将保险覆盖范围（var2）作为婚姻状况（var1）的函数绘制。|'
- en: '| Filled bar chart | Shows the relationship between two categorical variables
    (var1 and var2). Good for comparing the relative frequencies of each value of
    var2 within each value of var1\. Works best when var2 is binary. | Plot insurance
    coverage (var2) as a function of marital status (var1) when you wish to compare
    the *ratio* of uninsured to insured people in each marital category. |'
  id: totrans-356
  prefs: []
  type: TYPE_TB
  zh: '| 填充条形图 | 展示两个分类变量（var1 和 var2）之间的关系。适用于比较 var1 的每个值内 var2 的相对频率。当 var2 为二进制时效果最佳。|
    当您想比较每个婚姻类别中未投保与投保人数的比率时，将保险覆盖范围（var2）作为婚姻状况（var1）的函数绘制。|'
- en: '| Bar chart with faceting | Shows the relationship between two categorical
    variables (var1 and var2). Best for comparing the relative frequencies of each
    value of var2 within each value of var1 when var2 takes on more than two values.
    | Plot the distribution of marital status (var2) as a function of housing type
    (var1). |'
  id: totrans-357
  prefs: []
  type: TYPE_TB
  zh: '| 分面条形图 | 展示两个分类变量（var1 和 var2）之间的关系。当 var2 有超过两个值时，最适合比较 var1 的每个值内 var2 的相对频率。|
    将婚姻状况（var2）的分布作为住房类型（var1）的函数绘制。|'
- en: '| Overlaid density plot | Compares the distribution of a continuous variable
    over different values of a categorical variable. Best when the categorical variable
    has only two or three categories. Shows whether the continuous variable is distributed
    differently or similarly across the categories. | Compare the age distribution
    of married vs. divorced populations. |'
  id: totrans-358
  prefs: []
  type: TYPE_TB
  zh: '| 叠加密度图 | 比较连续变量在不同分类变量值上的分布。当分类变量只有两个或三个类别时效果最佳。显示连续变量在各个类别中的分布是否不同或相似。| 比较已婚与离婚人口年龄分布。|'
- en: '| Faceted density plot | Compares the distribution of a continuous variable
    over different values of a categorical variable. Suitable for categorical variables
    with more than three or so categories. Shows whether the continuous variable is
    distributed differently or similarly across the categories. | Compare the age
    distribution of several marital statuses (never married, married, divorced, widowed).
    |'
  id: totrans-359
  prefs: []
  type: TYPE_TB
  zh: '| 分面密度图 | 比较连续变量在不同分类变量值上的分布。适用于有超过三个或更多类别的分类变量。显示连续变量在类别之间是分布不同还是相似。 | 比较几种婚姻状况（未婚、已婚、离婚、丧偶）的年龄分布。|'
- en: '| Faceted histogram or shadow histogram | Compares the distribution of a continuous
    variable over different values of a categorical variable while retaining information
    about the relative population sizes. | Compare the age distribution of several
    marital statuses (never married, married, divorced, widowed), while retaining
    information about relative population sizes. |'
  id: totrans-360
  prefs: []
  type: TYPE_TB
  zh: '| 分面直方图或阴影直方图 | 在保留关于相对人口规模信息的同时，比较连续变量在不同分类变量值上的分布。 | 在保留关于相对人口规模信息的同时，比较几种婚姻状况（未婚、已婚、离婚、丧偶）的年龄分布。|'
- en: There are many other variations and visualizations you could use to explore
    the data; the preceding set covers some of the most useful and basic graphs. You
    should try different kinds of graphs to get different insights from the data.
    It’s an interactive process. One graph will raise questions that you can try to
    answer by replotting the data again, with a different visualization.
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用许多其他变体和可视化来探索数据；前面的一组涵盖了最有用和最基本的一些图表。你应该尝试不同类型的图表，从数据中获得不同的见解。这是一个互动的过程。一个图表可能会提出一些问题，你可以通过重新绘制数据并使用不同的可视化来尝试回答这些问题。
- en: Eventually, you’ll explore your data enough to get a sense of it and to spot
    most major problems and issues. In the next chapter, we’ll discuss some ways to
    address common problems that you may discover in the data.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 最终，你会探索足够多的数据，以获得对它的感觉，并发现大多数主要问题和问题。在下一章中，我们将讨论一些解决你可能在数据中发现的一些常见问题的方法。
- en: Summary
  id: totrans-363
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: At this point, you’ve gotten a feel for your data. You’ve explored it through
    summaries and visualizations; you now have a sense of the quality of your data,
    and of the relationships among your variables. You’ve caught and are ready to
    correct several kinds of data issues—although you’ll likely run into more issues
    as you progress.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，你已经对你的数据有了感觉。你已经通过摘要和可视化来探索它；你现在对你的数据质量以及变量之间的关系有了感觉。你已经发现了并准备纠正几种数据问题——尽管随着你继续前进，你很可能会遇到更多的问题。
- en: Maybe some of the things you’ve discovered have led you to reevaluate the question
    you’re trying to answer, or to modify your goals. Maybe you’ve decided that you
    need more or different types of data to achieve your goals. This is all good.
    As we mentioned in the previous chapter, the data science process is made of loops
    within loops. The data exploration and data cleaning stages (we’ll discuss cleaning
    in the next chapter) are two of the more time-consuming—and also the most important—stages
    of the process. Without good data, you can’t build good models. Time you spend
    here is time you don’t waste elsewhere.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 可能你发现的一些事情让你重新评估了你试图回答的问题，或者修改了你的目标。也许你决定你需要更多或不同类型的数据来实现你的目标。这些都是好事。正如我们在上一章提到的，数据科学过程是由层层嵌套的循环组成的。数据探索和数据清洗阶段（我们将在下一章讨论清洗）是过程中耗时较长且最重要的两个阶段。没有好的数据，你无法构建好的模型。你在这里花费的时间是你在其他地方不会浪费的时间。
- en: In the next chapter, we’ll talk about fixing the issues that you’ve discovered
    in the data.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将讨论解决你在数据中发现的问题。
- en: In this chapter you have learned
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了
- en: Take the time to examine and understand your data before diving into the modeling.
  id: totrans-368
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在深入建模之前，花时间检查和理解你的数据。
- en: The summary command helps you spot issues with data range, units, data type,
    and missing or invalid values.
  id: totrans-369
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 摘要命令帮助你发现数据范围、单位、数据类型以及缺失或无效值的问题。
- en: The various visualization techniques have different benefits and applications.
  id: totrans-370
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不同的可视化技术有不同的优点和应用。
- en: Visualization is an iterative process and helps answer questions about the data.
    Information you learn from one visualization may lead to more questions—that you
    might try to answer with another visualization. If one visualization doesn’t work,
    try another. Time spent here is time not wasted during the modeling process.
  id: totrans-371
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可视化是一个迭代的过程，有助于解答关于数据的问题。从一次可视化中获得的信息可能会引出更多问题——你可能会尝试用另一次可视化来回答这些问题。如果一次可视化不起作用，就尝试另一次。在这里花费的时间是在建模过程中没有浪费的时间。
