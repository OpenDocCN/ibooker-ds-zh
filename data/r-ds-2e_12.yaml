- en: Chapter 10\. Exploratory Data Analysis
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第10章. 探索性数据分析
- en: Introduction
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: 'This chapter will show you how to use visualization and transformation to explore
    your data in a systematic way, a task that statisticians call *exploratory data
    analysis*, or EDA for short. EDA is an iterative cycle. You:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将向你展示如何系统地使用可视化和转换来探索你的数据，这是统计学家称之为*探索性数据分析*或简称EDA的任务。EDA是一个迭代循环。你：
- en: Generate questions about your data.
  id: totrans-3
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提出关于你的数据的问题。
- en: Search for answers by visualizing, transforming, and modeling your data.
  id: totrans-4
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过视觉化、转换和建模数据来寻找答案。
- en: Use what you learn to refine your questions and/or generate new questions.
  id: totrans-5
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 利用你所学到的知识来完善你的问题和/或生成新问题。
- en: EDA is not a formal process with a strict set of rules. More than anything,
    EDA is a state of mind. During the initial phases of EDA you should feel free
    to investigate every idea that occurs to you. Some of these ideas will pan out,
    and some will be dead ends. As your exploration continues, you will home in on
    a few particularly productive insights that you’ll eventually write up and communicate
    to others.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: EDA不是一个具有严格规则集的正式过程。比任何其他东西都重要的是，EDA是一种心态。在EDA的初始阶段，你应该随心所欲地调查每一个想法。其中一些想法会得到验证，而另一些则是死胡同。随着探索的继续，你将聚焦于几个特别有生产力的见解，最终会将它们写下并传达给其他人。
- en: 'EDA is an important part of any data analysis, even if the primary research
    questions are handed to you on a platter, because you always need to investigate
    the quality of your data. Data cleaning is just one application of EDA: you ask
    questions about whether your data meets your expectations. To do data cleaning,
    you’ll need to deploy all the tools of EDA: visualization, transformation, and
    modeling.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: EDA是任何数据分析的重要部分，即使主要的研究问题已经摆在你面前，因为你始终需要调查数据的质量。数据清洗只是EDA的一个应用：你要问关于你的数据是否符合期望的问题。要进行数据清洗，你需要使用EDA的所有工具：视觉化、转换和建模。
- en: Prerequisites
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 先决条件
- en: In this chapter we’ll combine what you’ve learned about dplyr and ggplot2 to
    interactively ask questions, answer them with data, and then ask new questions.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将结合你已学到的dplyr和ggplot2，以互动方式提出问题、用数据回答问题，然后提出新问题。
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Questions
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: “There are no routine statistical questions, only questionable statistical routines.”
    —Sir David Cox
  id: totrans-12
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “没有例行统计问题，只有可疑的统计惯例。” —David Cox爵士
- en: “Far better an approximate answer to the right question, which is often vague,
    than an exact answer to the wrong question, which can always be made precise.”
    —John Tukey
  id: totrans-13
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “对正确问题的近似答案要好得多，即使这些问题通常模糊，也要好过对错误问题的精确答案，因为后者总是可以被明确化。” —John Tukey
- en: Your goal during EDA is to develop an understanding of your data. The easiest
    way to do this is to use questions as tools to guide your investigation. When
    you ask a question, the question focuses your attention on a specific part of
    your dataset and helps you decide which graphs, models, or transformations to
    make.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在EDA过程中，你的目标是深入了解你的数据。做到这一点最简单的方法是将问题作为指导调查的工具。当你提出一个问题时，问题会集中你的注意力在数据集的特定部分，并帮助你决定制作哪些图表、模型或转换。
- en: EDA is fundamentally a creative process. And like most creative processes, the
    key to asking *quality* questions is to generate a large *quantity* of questions.
    It is difficult to ask revealing questions at the start of your analysis because
    you do not know what insights can be gleaned from your dataset. On the other hand,
    each new question that you ask will expose you to a new aspect of your data and
    increase your chance of making a discovery. You can quickly drill down into the
    most interesting parts of your data—and develop a set of thought-provoking questions—if
    you follow up each question with a new question based on what you find.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: EDA从根本上讲是一个创造性的过程。就像大多数创造性过程一样，提出*高质量*问题的关键在于生成大量的*问题*。在分析开始时很难提出具有启发性的问题，因为你不知道数据集中可以获取什么洞见。另一方面，每个新问题的提出都会让你接触数据的一个新方面，并增加你发现的机会。如果你根据所发现的内容提出新问题，你可以迅速深入探究数据中最有趣的部分，并形成一系列发人深省的问题。
- en: 'There is no rule about which questions you should ask to guide your research.
    However, two types of questions will always be useful for making discoveries within
    your data. You can loosely word these questions as:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 没有关于应该问什么问题来引导你的研究的规则。然而，有两种类型的问题将始终有助于在你的数据中发现新发现。你可以笼统地用以下问题表达这些问题：
- en: What type of variation occurs within my variables?
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我的变量内部存在哪种类型的变异？
- en: What type of covariation occurs between my variables?
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我的变量之间发生了什么类型的协变？
- en: The rest of this chapter will look at these two questions. We’ll explain what
    variation and covariation are, and we’ll show you several ways to answer each
    question.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的其余部分将探讨这两个问题。我们将解释变异和协变是什么，并展示几种回答每个问题的方式。
- en: Variation
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 变异
- en: '*Variation* is the tendency of the values of a variable to change from measurement
    to measurement. You can see variation easily in real life; if you measure any
    continuous variable twice, you will get two different results. This is true even
    if you measure quantities that are constant, like the speed of light. Each of
    your measurements will include a small amount of error that varies from measurement
    to measurement. Variables can also vary if you measure across different subjects
    (e.g., the eye colors of different people) or at different times (e.g., the energy
    levels of an electron at different moments). Every variable has its own pattern
    of variation, which can reveal interesting information about how it varies between
    measurements on the same observation as well as across observations. The best
    way to understand that pattern is to visualize the distribution of the variable’s
    values, which you’ve learned about in [Chapter 1](ch01.xhtml#chp-data-visualize).'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '*变异* 是变量值在测量之间变化的倾向。您可以很容易地在现实生活中看到变异；如果您两次测量任何连续变量，您将得到两个不同的结果。即使您测量恒定的量，如光速，也是如此。每次测量都会包括一小部分从测量到测量变化的误差。变量还可以因为在不同主体（例如，不同人的眼睛颜色）或不同时间（例如，电子的能级在不同时刻）上测量而变化。每个变量都有其自己的变异模式，这可以揭示关于它如何在同一观察的测量之间以及跨观察之间变化的有趣信息。理解该模式的最佳方法是可视化变量值的分布，这是您在[第1章](ch01.xhtml#chp-data-visualize)中学到的。'
- en: 'We’ll start our exploration by visualizing the distribution of weights (`carat`)
    of about 54,000 diamonds from the `diamonds` dataset. Since `carat` is a numerical
    variable, we can use a histogram:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过可视化约54,000颗钻石的重量（`carat`）分布来开始我们的探索，来自`diamonds`数据集。由于`carat`是一个数值变量，我们可以使用直方图：
- en: '[PRE1]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![A histogram of carats of diamonds, with the x-axis ranging from 0 to 4.5
    and the y-axis ranging from 0 to 30000\. The distribution is right skewed with
    very few diamonds in the bin centered at 0, almost 30000 diamonds in the bin centered
    at 0.5, approximately 15000 diamonds in the bin centered at 1, and much fewer,
    approximately 5000 diamonds in the bin centered at 1.5\. Beyond this, there''s
    a trailing tail.](assets/rds2_10in01.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![一幅钻石克拉数的直方图，x轴范围从0到4.5，y轴范围从0到30000。分布右偏，中心在0的箱中几乎没有钻石，中心在0.5的箱中约有30000颗钻石，中心在1的箱中约有15000颗钻石，中心在1.5的箱中少得多，约有5000颗钻石。此外还有尾部延伸。](assets/rds2_10in01.png)'
- en: Now that you can visualize variation, what should you look for in your plots?
    And what type of follow-up questions should you ask? We’ve put together a list
    in the next section of the most useful types of information that you will find
    in your graphs, along with some follow-up questions for each type of information.
    The key to asking good follow-up questions will be to rely on your curiosity (what
    do you want to learn more about?) as well as your skepticism (how could this be
    misleading?).
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您可以可视化变异，您在图中应该寻找什么？以及您应该提出什么类型的后续问题？我们在下一节中列出了您将在图表中找到的最有用的信息类型及其相应的后续问题。提出良好后续问题的关键将是依靠您的好奇心（您想更多了解什么？）以及您的怀疑心（这可能是误导的方式？）。
- en: Typical Values
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 典型值
- en: 'In both bar charts and histograms, tall bars show the common values of a variable,
    and shorter bars show less-common values. Places that do not have bars reveal
    values that were not seen in your data. To turn this information into useful questions,
    look for anything unexpected:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 在条形图和直方图中，高柱显示变量的常见值，而较短的柱显示不常见的值。没有柱的地方显示未在数据中看到的值。要将此信息转化为有用的问题，寻找任何意外的事物：
- en: Which values are the most common? Why?
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哪些值最常见？为什么？
- en: Which values are rare? Why? Does that match your expectations?
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哪些值是罕见的？为什么？这是否符合你的期望？
- en: Can you see any unusual patterns? What might explain them?
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您能看到任何不寻常的模式吗？可能是什么原因？
- en: 'Let’s take a look at the distribution of `carat` for smaller diamonds:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看较小钻石的`carat`分布：
- en: '[PRE2]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![A histogram of carats of diamonds, with the x-axis ranging from 0 to 3 and
    the y-axis ranging from 0 to roughly 2500\. The binwidth is quite narrow (0.01),
    resulting in a very large number of skinny bars. The distribution is right skewed,
    with many peaks followed by bars in decreasing heights, until a sharp increase
    at the next peak.](assets/rds2_10in02.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![一幅钻石克拉数的直方图，x 轴范围从 0 到 3，y 轴大约从 0 到 2500。箱宽很窄（0.01），导致了大量细长的条。分布右偏，有许多峰值后面是高度递减的条，直到下一个峰值处急剧增加。](assets/rds2_10in02.png)'
- en: 'This histogram suggests several interesting questions:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 这幅直方图提出了几个有趣的问题：
- en: Why are there more diamonds at whole carats and common fractions of carats?
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为什么整数克拉和常见克拉分数的钻石较多？
- en: Why are there more diamonds slightly to the right of each peak than there are
    slightly to the left of each peak?
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为什么每个峰值右侧的钻石比左侧稍多？
- en: 'Visualizations can also reveal clusters, which suggest that subgroups exist
    in your data. To understand the subgroups, ask:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 可视化也可以显示出聚类，这表明数据中存在子群体。要理解这些子群体，可以问：
- en: How are the observations within each subgroup similar to each other?
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个子群体内的观察结果如何相似？
- en: How are the observations in separate clusters different from each other?
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分离聚类中的观察结果如何不同？
- en: How can you explain or describe the clusters?
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你如何解释或描述这些聚类？
- en: Why might the appearance of clusters be misleading?
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为什么聚类的外观可能会误导？
- en: Some of these questions can be answered with the data, while some will require
    domain expertise about the data. Many of them will prompt you to explore a relationship
    *between* variables, for example, to see if the values of one variable can explain
    the behavior of another variable. We’ll get to that shortly.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 其中一些问题可以通过数据回答，而一些则需要关于数据的领域专业知识。其中许多问题将促使你探索*变量之间*的关系，例如看看一个变量的值是否可以解释另一个变量的行为。我们很快就会讨论这个问题。
- en: Unusual Values
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 不寻常的值
- en: Outliers are observations that are unusual, in other words, data points that
    don’t seem to fit the pattern. Sometimes outliers are data entry errors, sometimes
    they are simply values at the extremes that happened to be observed in this data
    collection, and other times they suggest important new discoveries. When you have
    a lot of data, outliers are sometimes difficult to see in a histogram. For example,
    take the distribution of the `y` variable from the `diamonds` dataset. The only
    evidence of outliers is the unusually wide limits on the x-axis.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 离群值是不寻常的观察结果，换句话说，是不符合模式的数据点。有时离群值是数据输入错误，有时它们只是极端值在数据收集中被观察到，而有时则暗示重要的新发现。当你有大量数据时，在直方图中有时很难看到离群值。例如，看一下`diamonds`数据集中`y`变量的分布。唯一显示离群值的证据是
    x 轴上异常宽的限制。
- en: '[PRE3]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![A histogram of lengths of diamonds. The x-axis ranges from 0 to 60 and the
    y-axis ranges from 0 to 12000\. There is a peak around 5, and the data appear
    to be completely clustered around the peak.](assets/rds2_10in03.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![一幅钻石长度的直方图，x 轴范围从 0 到 60，y 轴范围从 0 到 12000。在约为 5 的地方有一个峰值，数据完全聚集在峰值周围。](assets/rds2_10in03.png)'
- en: 'There are so many observations in the common bins that the rare bins are very
    short, making it difficult to see them (although maybe if you stare intently at
    0, you’ll spot something). To make it easy to see the unusual values, we need
    to zoom to small values of the y-axis with [`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml):'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在常见箱中有很多观察结果，罕见箱非常短，使得很难看到它们（虽然也许如果你仔细盯着0看，你会发现一些东西）。为了便于看到不寻常的值，我们需要使用[`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml)来缩小
    y 轴的值：
- en: '[PRE4]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![A histogram of lengths of diamonds. The x-axis ranges from 0 to 60 and the
    y-axis ranges from 0 to 50\. There is a peak around 5, and the data appear to
    be completely clustered around the peak. Other than those data, there is one bin
    at 0 with a height of about 8, one a little over 30 with a height of 1 and another
    one a little below 60 with a height of 1.](assets/rds2_10in04.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![一幅钻石长度的直方图，x 轴范围从 0 到 60，y 轴范围从 0 到 50。在约为 5 的地方有一个峰值，数据完全聚集在峰值周围。除了这些数据外，还有一个高约为
    8 的 0 箱，一个略高于 30 高度约为 1 的箱，以及一个略低于 60 高度约为 1 的箱。](assets/rds2_10in04.png)'
- en: '[`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml)
    also has an [`xlim()`](https://ggplot2.tidyverse.org/reference/lims.xhtml) argument
    for when you need to zoom into the x-axis. ggplot2 also has [`xlim()`](https://ggplot2.tidyverse.org/reference/lims.xhtml)
    and [`ylim()`](https://ggplot2.tidyverse.org/reference/lims.xhtml) functions that
    work slightly differently: they throw away the data outside the limits.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '[`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml)
    还有一个 [`xlim()`](https://ggplot2.tidyverse.org/reference/lims.xhtml) 参数，用于缩放 x
    轴。ggplot2 还有 [`xlim()`](https://ggplot2.tidyverse.org/reference/lims.xhtml) 和
    [`ylim()`](https://ggplot2.tidyverse.org/reference/lims.xhtml) 函数，它们的工作方式略有不同：它们会丢弃超出限制范围的数据。'
- en: 'This allows us to see that there are three unusual values: 0, ~30, and ~60\.
    We pluck them out with dplyr:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 这使我们看到有三个异常值：0、约30 和约60。我们使用 dplyr 将它们挑出：
- en: '[PRE5]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The `y` variable measures one of the three dimensions of these diamonds, in
    mm. We know that diamonds can’t have a width of 0mm, so these values must be incorrect.
    By doing EDA, we have discovered missing data that were coded as 0, which we never
    would have found by simply searching for `NA`s. Going forward we might choose
    to re-code these values as `NA`s to prevent misleading calculations. We might
    also suspect that measurements of 32mm and 59mm are implausible: those diamonds
    are more than an inch long but don’t cost hundreds of thousands of dollars!'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: '`y` 变量以毫米测量这些钻石的三个尺寸之一。我们知道钻石不能有 0 毫米的宽度，因此这些值必定是不正确的。通过探索数据分析，我们发现编码为 0 的缺失数据，这是我们仅仅搜索
    `NA` 时无法发现的。未来，我们可能选择重新编码这些值为 `NA`，以防止误导性计算。我们还可能怀疑，32 毫米和 59 毫米的测量值是不可能的：这些钻石超过一英寸长，但价格不会成百上千美元！'
- en: It’s good practice to repeat your analysis with and without the outliers. If
    they have minimal effect on the results and you can’t figure out why they’re there,
    it’s reasonable to omit them and move on. However, if they have a substantial
    effect on your results, you shouldn’t drop them without justification. You’ll
    need to figure out what caused them (e.g., a data entry error) and disclose that
    you removed them in your write-up.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 反复进行分析，有无异常值。如果异常值对结果影响不大，并且您无法弄清楚它们存在的原因，则删除它们并继续是合理的。但是，如果它们对结果有重大影响，则不应在没有理由的情况下删除它们。您需要找出引起它们的原因（例如，数据输入错误），并在报告中披露您已删除它们。
- en: Exercises
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习
- en: Explore the distribution of each of the `x`, `y`, and `z` variables in `diamonds`.
    What do you learn? Think about a diamond and how you might decide which dimension
    is the length, width, and depth.
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 探索 `diamonds` 中 `x`、`y` 和 `z` 变量的分布。您学到了什么？考虑一颗钻石，您可能如何确定长度、宽度和深度。
- en: 'Explore the distribution of `price`. Do you discover anything unusual or surprising?
    (Hint: Carefully think about the `binwidth` and make sure you try a wide range
    of values.)'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 探索 `price` 的分布。您发现了什么异常或令人惊讶的事情吗？（提示：仔细考虑 `binwidth` 并确保尝试一系列值。）
- en: How many diamonds are 0.99 carat? How many are 1 carat? What do you think is
    the cause of the difference?
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 有多少颗钻石是 0.99 克拉？有多少是 1 克拉？您认为造成这种差异的原因是什么？
- en: Compare and contrast [`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml)
    and [`xlim()`](https://ggplot2.tidyverse.org/reference/lims.xhtml) or [`ylim()`](https://ggplot2.tidyverse.org/reference/lims.xhtml)
    when zooming in on a histogram. What happens if you leave `binwidth` unset? What
    happens if you try to zoom so only half a bar shows?
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 比较和对比 [`coord_cartesian()`](https://ggplot2.tidyverse.org/reference/coord_cartesian.xhtml)
    和 [`xlim()`](https://ggplot2.tidyverse.org/reference/lims.xhtml) 或 [`ylim()`](https://ggplot2.tidyverse.org/reference/lims.xhtml)
    在缩放直方图时的情况。如果不设置 `binwidth` 会发生什么？如果试图缩放以显示一半条柱子会发生什么？
- en: Unusual Values
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 异常值
- en: 'If you’ve encountered unusual values in your dataset and simply want to move
    on to the rest of your analysis, you have two options:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的数据集中出现异常值，并且只想继续分析剩余部分，则有两个选择：
- en: 'Drop the entire row with the strange values:'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 删除具有奇怪值的整行：
- en: '[PRE6]'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: We don’t recommend this option because one invalid value doesn’t imply that
    all the other values for that observation are also invalid. Additionally, if you
    have low-quality data, by the time that you’ve applied this approach to every
    variable you might find that you don’t have any data left!
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们不建议选择此选项，因为一个无效值并不意味着该观察的所有其他值也无效。此外，如果您的数据质量较低，当您将此方法应用于每个变量时，您可能会发现没有任何数据剩余！
- en: 'Instead, we recommend replacing the unusual values with missing values. The
    easiest way to do this is to use [`mutate()`](https://dplyr.tidyverse.org/reference/mutate.xhtml)
    to replace the variable with a modified copy. You can use the [`if_else()`](https://dplyr.tidyverse.org/reference/if_else.xhtml)
    function to replace unusual values with `NA`:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 相反，我们建议将异常值替换为缺失值。最简单的方法是使用 [`mutate()`](https://dplyr.tidyverse.org/reference/mutate.xhtml)
    来替换变量为修改后的副本。你可以使用 [`if_else()`](https://dplyr.tidyverse.org/reference/if_else.xhtml)
    函数将异常值替换为 `NA`：
- en: '[PRE7]'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'It’s not obvious where you should plot missing values, so ggplot2 doesn’t include
    them in the plot, but it does warn that they’ve been removed:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 不明显的是你应该在哪里绘制缺失值，因此 ggplot2 不会在图中包含它们，但会警告它们已被移除：
- en: '[PRE8]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![A scatterplot of widths vs. lengths of diamonds. There is a strong, linear
    association between the two variables. All but one of the diamonds has length
    greater than 3\. The one outlier has a length of 0 and a width of about 6.5.](assets/rds2_10in05.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![一张钻石宽度与长度的散点图。两个变量之间有强烈的线性关系。除了一个钻石外，其余的钻石长度均大于3。这个异常值的长度为0，宽度约为6.5。](assets/rds2_10in05.png)'
- en: 'To suppress that warning, set `na.rm = TRUE`:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 要消除该警告，请设置 `na.rm = TRUE`：
- en: '[PRE9]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Other times you want to understand what makes observations with missing values
    different to observations with recorded values. For example, in [`nycflights13::flights,`](https://rdrr.io/pkg/nycflights13/man/flights.xhtml)^([1](ch10.xhtml#idm44771307799104))
    missing values in the `dep_time` variable indicate that the flight was cancelled.
    So you might want to compare the scheduled departure times for cancelled and noncancelled
    times. You can do this by making a new variable, using [`is.na()`](https://rdrr.io/r/base/NA.xhtml)
    to check whether `dep_time` is missing.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 有时候，你想了解带有缺失值的观测与带有记录值的观测有何不同。例如，在 [`nycflights13::flights`](https://rdrr.io/pkg/nycflights13/man/flights.xhtml)^([1](ch10.xhtml#idm44771307799104))
    中，`dep_time` 变量中的缺失值表明航班被取消。因此，你可能想比较已取消和未取消航班的计划起飞时间。你可以通过创建一个新变量来实现此目的，使用 [`is.na()`](https://rdrr.io/r/base/NA.xhtml)
    来检查 `dep_time` 是否缺失。
- en: '[PRE10]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![A frequency polygon of scheduled departure times of flights. Two lines represent
    flights that are cancelled and not cancelled. The x-axis ranges from 0 to 25 minutes
    and the y-axis ranges from 0 to 10000\. The number of flights not cancelled are
    much higher than those cancelled.](assets/rds2_10in06.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![航班计划起飞时间的频率多边形图。两条线分别代表取消和未取消的航班。x轴范围从0到25分钟，y轴范围从0到10000。未取消航班的数量远远超过取消航班的数量。](assets/rds2_10in06.png)'
- en: However, this plot isn’t great because there are many more noncancelled flights
    than cancelled flights. In the next section, we’ll explore some techniques for
    improving this comparison.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这个图表并不理想，因为未取消航班比取消航班要多得多。在下一节中，我们将探讨一些改进这种比较的技术。
- en: Exercises
  id: totrans-76
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习
- en: What happens to missing values in a histogram? What happens to missing values
    in a bar chart? Why is there a difference in how missing values are handled in
    histograms and bar charts?
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 缺失值在直方图中会发生什么？缺失值在条形图中会发生什么？为什么直方图和条形图在处理缺失值时会有差异？
- en: What does `na.rm = TRUE` do in [`mean()`](https://rdrr.io/r/base/mean.xhtml)
    and [`sum()`](https://rdrr.io/r/base/sum.xhtml)?
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 [`mean()`](https://rdrr.io/r/base/mean.xhtml) 和 [`sum()`](https://rdrr.io/r/base/sum.xhtml)
    中，`na.rm = TRUE` 是什么作用？
- en: Re-create the frequency plot of `scheduled_dep_time` colored by whether the
    flight was cancelled or not. Also facet by the `cancelled` variable. Experiment
    with different values of the `scales` variable in the faceting function to mitigate
    the effect of more noncancelled flights than cancelled flights.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新创建 `scheduled_dep_time` 的频率图，并根据航班是否取消进行着色。还要按 `cancelled` 变量进行分面。尝试在分面函数中使用不同的
    `scales` 变量值，以减轻未取消航班比取消航班更多的影响。
- en: Covariation
  id: totrans-80
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 协变
- en: If variation describes the behavior *within* a variable, covariation describes
    the behavior *between* variables. *Covariation* is the tendency for the values
    of two or more variables to vary together in a related way. The best way to spot
    covariation is to visualize the relationship between two or more variables.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 如果变异描述了变量内部的行为，那么协变描述了变量之间的行为。*协变* 是两个或多个变量值一起以相关方式变化的倾向。发现协变的最佳方法是可视化两个或多个变量之间的关系。
- en: A Categorical and a Numerical Variable
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 一个分类变量和一个数值变量
- en: 'For example, let’s explore how the price of a diamond varies with its quality
    (measured by `cut`) using [`geom_freqpoly()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml):'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，让我们探索一下钻石价格如何随其品质（由 `cut` 衡量）变化，使用 [`geom_freqpoly()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml)：
- en: '[PRE11]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![A frequency polygon of prices of diamonds where each cut of carat (Fair,
    Good, Very Good, Premium, and Ideal) is represented with a different color line.
    The x-axis ranges from 0 to 30000 and the y-axis ranges from 0 to 5000\. The lines
    overlap a great deal, suggesting similar frequency distributions of prices of
    diamonds. One notable feature is that Ideal diamonds have the highest peak around
    1500.](assets/rds2_10in07.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![一幅频率多边形图，显示了不同克拉切割（Fair、Good、Very Good、Premium 和 Ideal）的钻石价格。x 轴范围从 0 到 30000，y
    轴范围从 0 到 5000。线条重叠较多，表明钻石价格频率分布相似。一个显著特点是 Ideal 钻石在约 1500 价格处有最高峰值。](assets/rds2_10in07.png)'
- en: Note that ggplot2 uses an ordered color scale for `cut` because it’s defined
    as an ordered factor variable in the data. You’ll learn more about these in [“Ordered
    Factors”](ch16.xhtml#sec-ordered-factors).
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，ggplot2 对 `cut` 使用有序颜色比例尺，因为它在数据中被定义为有序因子变量。您将在[“有序因子”](ch16.xhtml#sec-ordered-factors)中了解更多相关内容。
- en: The default appearance of [`geom_freqpoly()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml)
    is not that useful here because the height, determined by the overall count, differs
    so much across `cut`s, making it hard to see the differences in the shapes of
    their distributions.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，默认的 [`geom_freqpoly()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml)
    外观并不那么有用，因为高度由总计决定，在 `cut` 中差异很大，使得难以看出它们分布形状的差异。
- en: 'To make the comparison easier, we need to swap what is displayed on the y-axis.
    Instead of displaying count, we’ll display the *density*, which is the count standardized
    so that the area under each frequency polygon is 1:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更容易比较，我们需要交换显示在 y 轴上的内容。而不是显示计数，我们将显示 *density*，这是将每个频率多边形下面积标准化为 1 的计数：
- en: '[PRE12]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![A frequency polygon of densities of prices of diamonds where each cut of
    carat (Fair, Good, Very Good, Premium, and Ideal) is represented with a different
    color line. The x-axis ranges from 0 to 20000\. The lines overlap a great deal,
    suggesting similar density distributions of prices of diamonds. One notable feature
    is that all but Fair diamonds have high peaks around a price of 1500 and Fair
    diamonds have a higher mean than others.](assets/rds2_10in08.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![一幅频率多边形图，显示了不同克拉切割（Fair、Good、Very Good、Premium 和 Ideal）的钻石价格密度。x 轴范围从 0 到
    20000。线条重叠较多，表明钻石价格密度分布相似。一个显著特点是除了 Fair 钻石外，其他钻石在价格约为 1500 时有很高的峰值，而 Fair 钻石的平均价格高于其他品质。](assets/rds2_10in08.png)'
- en: Note that we’re mapping the density the `y`, but since `density` is not a variable
    in the `diamonds` dataset, we need to first calculate it. We use the [`after_stat()`](https://ggplot2.tidyverse.org/reference/aes_eval.xhtml)
    function to do so.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，我们将 `density` 映射到 `y` 轴，但由于 `density` 不是 `diamonds` 数据集中的变量，我们需要先计算它。我们使用
    [`after_stat()`](https://ggplot2.tidyverse.org/reference/aes_eval.xhtml) 函数来完成这一点。
- en: 'There’s something rather surprising about this plot: it appears that fair diamonds
    (the lowest quality) have the highest average price! But maybe that’s because
    frequency polygons are a little hard to interpret; there’s a lot going on in this
    plot.'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这幅图有一点令人惊讶：似乎低质量的 Fair 钻石拥有最高的平均价格！但也许这是因为频率多边形图有点难以解释；这幅图中有很多信息。
- en: 'A visually simpler plot for exploring this relationship is using side-by-side
    boxplots:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 使用并排箱线图探索这种关系的可视化简化图：
- en: '[PRE13]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![Side-by-side boxplots of prices of diamonds by cut. The distribution of prices
    is right skewed for each cut (Fair, Good, Very Good, Premium, and Ideal). The
    medians are close to each other, with the median for Ideal diamonds lowest and
    that for Fair highest.](assets/rds2_10in09.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![并排箱线图，显示了不同切割的钻石价格。每个切割的价格分布都呈右偏态。中位数相互接近，Ideal 钻石的中位数最低，Fair 钻石的最高。](assets/rds2_10in09.png)'
- en: We see much less information about the distribution, but the boxplots are much
    more compact so we can more easily compare them (and fit more on one plot). It
    supports the counterintuitive finding that better-quality diamonds are typically
    cheaper! In the exercises, you’ll be challenged to figure out why.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 我们关于分布的信息要少得多，但是箱线图更为紧凑，因此我们可以更轻松地比较它们（并且在一幅图上容纳更多）。这支持了一个反直觉的发现，即更高质量的钻石通常更便宜！在练习中，您将被挑战找出其中原因。
- en: '`cut` is an ordered factor: fair is worse than good, which is worse than very
    good and so on. Many categorical variables don’t have such an intrinsic order,
    so you might want to reorder them to make a more informative display. One way
    to do that is with [`fct_reorder()`](https://forcats.tidyverse.org/reference/fct_reorder.xhtml).
    You’ll learn more about that function in [“Modifying Factor Order”](ch16.xhtml#sec-modifying-factor-order),
    but we wanted to give you a quick preview here because it’s so useful. For example,
    take the `class` variable in the `mpg` dataset. You might be interested to know
    how highway mileage varies across classes:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: '`cut`是一个有序因子：fair比good差，good比very good差，依此类推。许多分类变量没有这种固有顺序，因此您可能希望重新排序它们以获得更具信息量的显示。一种方法是使用[`fct_reorder()`](https://forcats.tidyverse.org/reference/fct_reorder.xhtml)。您将在[“修改因子顺序”](ch16.xhtml#sec-modifying-factor-order)中了解更多关于该函数的信息，但我们在这里提前为您展示它是如此有用。例如，考虑`mpg`数据集中的`class`变量。您可能想知道不同类别的汽车在公路里程上的变化：'
- en: '[PRE14]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![Side-by-side boxplots of highway mileages of cars by class. Classes are on
    the x-axis (2seaters, compact, midsize, minivan, pickup, subcompact, and suv).](assets/rds2_10in10.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![不同类别汽车的公路里程的并列箱线图。类别在x轴上（两座车、紧凑型车、中型车、面包车、皮卡车、小型车和SUV）。](assets/rds2_10in10.png)'
- en: 'To make the trend easier to see, we can reorder `class` based on the median
    value of `hwy`:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更容易看到趋势，我们可以基于`hwy`的中位数值重新排序`class`：
- en: '[PRE15]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![Side-by-side boxplots of highway mileages of cars by class. Classes are on
    the x-axis and ordered by increasing median highway mileage (pickup, suv, minivan,
    2seater, subcompact, compact, and midsize).](assets/rds2_10in11.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![不同类别汽车的公路里程的并列箱线图。类别在x轴上，按中位数公路里程递增排序（皮卡车、SUV、面包车、两座车、小型车、紧凑型车和中型车）。](assets/rds2_10in11.png)'
- en: 'If you have long variable names, [`geom_boxplot()`](https://ggplot2.tidyverse.org/reference/geom_boxplot.xhtml)
    will work better if you flip it 90°. You can do that by exchanging the x and y
    aesthetic mappings:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您有较长的变量名称，[`geom_boxplot()`](https://ggplot2.tidyverse.org/reference/geom_boxplot.xhtml)在将其翻转90°后将表现得更好。您可以通过交换x和y的美学映射来实现：
- en: '[PRE16]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![Side-by-side boxplots of highway mileages of cars by class. Classes are on
    the y-axis and ordered by increasing median highway mileage.](assets/rds2_10in12.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![不同类别汽车的公路里程的并列箱线图。类别在y轴上，按中位数公路里程递增排序。](assets/rds2_10in12.png)'
- en: Exercises
  id: totrans-106
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习
- en: Use what you’ve learned to improve the visualization of the departure times
    of cancelled versus noncancelled flights.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 利用所学知识改进取消与未取消航班的起飞时间可视化。
- en: Based on EDA, what variable in the diamonds dataset appears to be most important
    for predicting the price of a diamond? How is that variable correlated with cut?
    Why does the combination of those two relationships lead to lower-quality diamonds
    being more expensive?
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 基于探索性数据分析，钻石数据集中哪个变量似乎对预测钻石价格最重要？该变量与切割质量的相关性如何？为什么这两种关系的结合导致较低质量的钻石更昂贵？
- en: Instead of exchanging the x and y variables, add [`coord_flip()`](https://ggplot2.tidyverse.org/reference/coord_flip.xhtml)
    as a new layer to the vertical boxplot to create a horizontal one. How does this
    compare to exchanging the variables?
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 与交换变量相比，将[`coord_flip()`](https://ggplot2.tidyverse.org/reference/coord_flip.xhtml)作为垂直箱线图的新图层添加以创建水平箱线图。这与交换变量有何不同？
- en: One problem with boxplots is that they were developed in an era of much smaller
    datasets and tend to display a prohibitively large number of “outlying values.”
    One approach to remedy this problem is the letter value plot. Install the lvplot
    package, and try using `geom_lv()` to display the distribution of price versus
    cut. What do you learn? How do you interpret the plots?
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 箱线图的一个问题是它们是在数据集较小的时代开发的，往往显示出过多的“异常值”。解决这个问题的一种方法是使用字母值图。安装lvplot包，并尝试使用`geom_lv()`来显示价格与切割质量的分布。您从中学到了什么？如何解释这些图形？
- en: Create a visualization of diamond prices versus a categorical variable from
    the `diamonds` dataset using [`geom_violin()`](https://ggplot2.tidyverse.org/reference/geom_violin.xhtml),
    then a faceted [`geom_histogram()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml),
    then a colored [`geom_freqpoly()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml),
    and then a colored [`geom_density()`](https://ggplot2.tidyverse.org/reference/geom_density.xhtml).
    Compare and contrast the four plots. What are the pros and cons of each method
    of visualizing the distribution of a numerical variable based on the levels of
    a categorical variable?
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用[`geom_violin()`](https://ggplot2.tidyverse.org/reference/geom_violin.xhtml)创建钻石价格与`diamonds`数据集中的分类变量的可视化，然后使用分面[`geom_histogram()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml)，接着使用着色的[`geom_freqpoly()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml)，最后使用着色的[`geom_density()`](https://ggplot2.tidyverse.org/reference/geom_density.xhtml)。比较和对比这四种可视化数值变量分布的方法。基于分类变量级别的优缺点是什么？
- en: If you have a small dataset, it’s sometimes useful to use [`geom_jitter()`](https://ggplot2.tidyverse.org/reference/geom_jitter.xhtml)
    to avoid overplotting to more easily see the relationship between a continuous
    and categorical variable. The ggbeeswarm package provides a number of methods
    similar to [`geom_jitter()`](https://ggplot2.tidyverse.org/reference/geom_jitter.xhtml).
    List them and briefly describe what each one does.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果数据集较小，有时使用[`geom_jitter()`](https://ggplot2.tidyverse.org/reference/geom_jitter.xhtml)可以避免过度绘制，更容易看到连续变量与分类变量之间的关系。ggbeeswarm包提供了几种类似于[`geom_jitter()`](https://ggplot2.tidyverse.org/reference/geom_jitter.xhtml)的方法。列出它们并简要描述每种方法的作用。
- en: Two Categorical Variables
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 两个分类变量
- en: 'To visualize the covariation between categorical variables, you’ll need to
    count the number of observations for each combination of levels of these categorical
    variables. One way to do that is to rely on the built-in [`geom_count()`](https://ggplot2.tidyverse.org/reference/geom_count.xhtml):'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 要可视化分类变量之间的协变量关系，您需要计算每个分类变量级别组合的观察次数。一种方法是依赖内置的[`geom_count()`](https://ggplot2.tidyverse.org/reference/geom_count.xhtml)：
- en: '[PRE17]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![A scatterplot of color vs. cut of diamonds. There is one point for each combination
    of levels of cut (Fair, Good, Very Good, Premium, and Ideal) and color (D, E,
    F, G, G, I, and J). The sizes of the points represent the number of observations
    for that combination. The legend indicates that these sizes range between 1000
    and 4000.](assets/rds2_10in13.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![钻石颜色与切割的散点图。每个点表示切割（Fair，Good，Very Good，Premium和Ideal）和颜色（D，E，F，G，G，I和J）级别的组合中的一个，点的大小表示该组合的观察次数。图例显示这些点的大小范围在1000到4000之间。](assets/rds2_10in13.png)'
- en: The size of each circle in the plot displays how many observations occurred
    at each combination of values. Covariation will appear as a strong correlation
    between specific x values and specific y values.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 图中每个圆圈的大小显示了每个值组合的观察次数。协变量将显示为特定x值和特定y值之间的强相关性。
- en: 'Another approach for exploring the relationship between these variables is
    computing the counts with dplyr:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种探索这些变量之间关系的方法是使用dplyr计算计数：
- en: '[PRE18]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Then visualize with [`geom_tile()`](https://ggplot2.tidyverse.org/reference/geom_tile.xhtml)
    and the fill aesthetic:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 然后使用[`geom_tile()`](https://ggplot2.tidyverse.org/reference/geom_tile.xhtml)和填充美学：
- en: '[PRE19]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![A tile plot of cut vs. color of diamonds. Each tile represents a cut/color
    combination and tiles are colored according to the number of observations in each
    tile. There are more Ideal diamonds than other cuts, with the highest number being
    Ideal diamonds with color G. Fair diamonds and diamonds with color I are the lowest
    in frequency.](assets/rds2_10in14.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![钻石切割与颜色的瓷砖图。每个瓷砖表示一个切割/颜色组合，并根据每个瓷砖中的观察数量进行着色。Ideal钻石比其他切割更多，其中最多的是颜色为G的Ideal钻石。Fair钻石和颜色为I的钻石出现频率最低。](assets/rds2_10in14.png)'
- en: If the categorical variables are unordered, you might want to use the seriation
    package to simultaneously reorder the rows and columns to more clearly reveal
    interesting patterns. For larger plots, you might want to try the heatmaply package,
    which creates interactive plots.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 如果分类变量无序，可能需要使用seriation包同时重新排序行和列，以更清晰地显示有趣的模式。对于较大的图表，您可以尝试使用heatmaply包，该包创建交互式图表。
- en: Exercises
  id: totrans-124
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习
- en: How could you rescale the previous count dataset to more clearly show the distribution
    of cut within color, or color within cut?
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如何重新调整先前的计数数据集以更清晰地显示切割在颜色内部的分布或颜色在切割内部的分布？
- en: What different data insights do you get with a segmented bar chart if color
    is mapped to the `x` aesthetic and `cut` is mapped to the `fill` aesthetic? Calculate
    the counts that fall into each of the segments.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果将颜色映射到`x`美学，将`cut`映射到`fill`美学，分段条形图可以为您提供不同的数据洞见？计算落入每个段的计数。（在这一部分，我们将使用“smaller”数据集，专注于克拉数小于3的大部分钻石。）
- en: Use [`geom_tile()`](https://ggplot2.tidyverse.org/reference/geom_tile.xhtml)
    together with dplyr to explore how average flight departure delays vary by destination
    and month of year. What makes the plot difficult to read? How could you improve
    it?
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 [`geom_tile()`](https://ggplot2.tidyverse.org/reference/geom_tile.xhtml)
    结合 dplyr 探索飞行延误平均时间如何随目的地和年份的月份变化。什么使得绘图难以阅读？您如何改进它？
- en: Two Numerical Variables
  id: totrans-128
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 两个数值变量
- en: 'You’ve already seen one great way to visualize the covariation between two
    numerical variables: draw a scatterplot with [`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml).
    You can see covariation as a pattern in the points. For example, you can see a
    positive relationship between the carat size and price of a diamond: diamonds
    with more carats have a higher price. The relationship is exponential.'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经看到了一个很好的方法来可视化两个数值变量之间的协变关系：使用 [`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)
    绘制散点图。您可以将协变关系视为点的模式。例如，您可以看到钻石的克拉数与价格之间的正相关关系：克拉数更大的钻石价格更高。这种关系是指数的。
- en: '[PRE20]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![A scatterplot of price vs. carat. The relationship is positive, somewhat
    strong, and exponential.](assets/rds2_10in15.png)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![一个价格与克拉数的散点图。关系为正向，较为强烈且呈指数形态。](assets/rds2_10in15.png)'
- en: (In this section we’ll use the `smaller` dataset to stay focused on the bulk
    of the diamonds that are smaller than 3 carats.)
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: （在这一部分，我们将使用“smaller”数据集，专注于克拉数小于3的大部分钻石。）
- en: 'Scatterplots become less useful as the size of your dataset grows, because
    points begin to overplot and pile up into areas of uniform black, making it hard
    to judge differences in the density of the data across the two-dimensional space
    as well as making it hard to spot the trend. You’ve already seen one way to fix
    the problem: using the `alpha` aesthetic to add transparency.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 随着数据集的规模增长，散点图在数据重叠和堆积方面变得不那么有用，因为点开始堆积成均匀黑色的区域，这使得难以判断数据在二维空间中密度的差异，也难以发现趋势。您已经看到解决这个问题的一种方法：使用`alpha`美学添加透明度。
- en: '[PRE21]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![A scatterplot of price vs. carat. The relationship is positive, somewhat
    strong, and exponential. The points are transparent, showing clusters where the
    number of points is higher than other areas, The most obvious clusters are for
    diamonds with 1, 1.5, and 2 carats.](assets/rds2_10in16.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![一个价格与克拉数的散点图。关系为正向，较为强烈且呈指数形态。点是透明的，显示了点数较高的簇集，最明显的簇集是克拉数为1、1.5和2的钻石。](assets/rds2_10in16.png)'
- en: But using transparency can be challenging for very large datasets. Another solution
    is to use bins. Previously you used [`geom_histogram()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml)
    and [`geom_freqpoly()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml)
    to bin in one dimension. Now you’ll learn how to use [`geom_bin2d()`](https://ggplot2.tidyverse.org/reference/geom_bin_2d.xhtml)
    and [`geom_hex()`](https://ggplot2.tidyverse.org/reference/geom_hex.xhtml) to
    bin in two dimensions.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 但是对于非常大的数据集，使用透明度可能会很具挑战性。另一种解决方案是使用网格。之前您使用了[`geom_histogram()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml)
    和 [`geom_freqpoly()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml)
    在一个维度上进行网格化。现在您将学习如何使用 [`geom_bin2d()`](https://ggplot2.tidyverse.org/reference/geom_bin_2d.xhtml)
    和 [`geom_hex()`](https://ggplot2.tidyverse.org/reference/geom_hex.xhtml) 在两个维度上进行网格化。
- en: '[`geom_bin2d()`](https://ggplot2.tidyverse.org/reference/geom_bin_2d.xhtml)
    and [`geom_hex()`](https://ggplot2.tidyverse.org/reference/geom_hex.xhtml) divide
    the coordinate plane into 2D bins and then use a fill color to display how many
    points fall into each bin. [`geom_bin2d()`](https://ggplot2.tidyverse.org/reference/geom_bin_2d.xhtml)
    creates rectangular bins. [`geom_hex()`](https://ggplot2.tidyverse.org/reference/geom_hex.xhtml)
    creates hexagonal bins. You will need to install the hexbin package to use [`geom_hex()`](https://ggplot2.tidyverse.org/reference/geom_hex.xhtml).'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '[`geom_bin2d()`](https://ggplot2.tidyverse.org/reference/geom_bin_2d.xhtml)
    和 [`geom_hex()`](https://ggplot2.tidyverse.org/reference/geom_hex.xhtml) 将坐标平面分成2D网格，并使用填充颜色显示每个网格中有多少个点。[`geom_bin2d()`](https://ggplot2.tidyverse.org/reference/geom_bin_2d.xhtml)
    创建矩形网格。[`geom_hex()`](https://ggplot2.tidyverse.org/reference/geom_hex.xhtml)
    创建六角形网格。您需要安装hexbin包来使用 [`geom_hex()`](https://ggplot2.tidyverse.org/reference/geom_hex.xhtml)。'
- en: '[PRE22]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '![Plot 1: A binned density plot of price vs. carat. Plot 2: A hexagonal bin
    plot of price vs. carat. Both plots show that the highest density of diamonds
    have low carats and low prices.](assets/rds2_10in17.png)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![图1：价格与克拉的分箱密度图。图2：价格与克拉的六边形图。这两个图显示，密度最高的钻石克拉和价格都较低。](assets/rds2_10in17.png)'
- en: 'Another option is to bin one continuous variable so it acts like a categorical
    variable. Then you can use one of the techniques for visualizing the combination
    of a categorical and a continuous variable that you learned about. For example,
    you could bin `carat` and then for each group display a boxplot:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个选项是将一个连续变量分箱，使其像分类变量一样运行。然后，您可以使用您学到的技术之一来可视化分类和连续变量的组合。例如，您可以对`克拉`进行分箱，然后为每个组显示一个箱线图：
- en: '[PRE23]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![Side-by-side box plots of price by carat. Each box plot represents diamonds
    that are 0.1 carats apart in weight. The box plots show that as carat increases
    the median price increases as well. Additionally, diamonds with 1.5 carats or
    lower have right skewed price distributions, 1.5 to 2 have roughly symmetric price
    distributions, and diamonds that weigh more have left skewed distributions. Cheaper,
    smaller diamonds have outliers on the higher end, more expensive, bigger diamonds
    have outliers on the lower end.](assets/rds2_10in18.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![按克拉分组的并列箱形图。每个箱形图代表相隔`0.1`克拉的钻石的价格。箱形图显示，随着克拉数的增加，价格中位数也增加。此外，克拉数为`1.5`或更低的钻石价格分布右偏，`1.5`到`2`的价格分布大致对称，而重量更大的钻石价格分布左偏。更便宜、更小的钻石在高端有异常值，更昂贵、更大的钻石在低端有异常值。](assets/rds2_10in18.png)'
- en: '`cut_width(x, width)`, as used here, divides `x` into bins of width `width`.
    By default, boxplots look roughly the same (apart from the number of outliers)
    regardless of how many observations there are, so it’s difficult to tell that
    each boxplot summarizes a different number of points. One way to show that is
    to make the width of the boxplot proportional to the number of points with `varwidth
    = TRUE`.'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '`cut_width(x, width)`，如此使用，将`x`分为宽度为`width`的箱子。默认情况下，除了异常值的数量不同外，箱线图看起来大致相同，因此很难告诉每个箱线图总结了不同数量的点。显示这一点的一种方法是使箱线图的宽度与点数成比例，使用`varwidth
    = TRUE`。'
- en: Exercises
  id: totrans-144
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习
- en: Instead of summarizing the conditional distribution with a boxplot, you could
    use a frequency polygon. What do you need to consider when using [`cut_width()`](https://ggplot2.tidyverse.org/reference/cut_interval.xhtml)
    versus [`cut_number()`](https://ggplot2.tidyverse.org/reference/cut_interval.xhtml)?
    How does that impact a visualization of the 2D distribution of `carat` and `price`?
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不使用箱线图总结条件分布，而是使用频率多边形。使用[`cut_width()`](https://ggplot2.tidyverse.org/reference/cut_interval.xhtml)与[`cut_number()`](https://ggplot2.tidyverse.org/reference/cut_interval.xhtml)时需要考虑什么？这如何影响`克拉`和`价格`的二维分布可视化？
- en: Visualize the distribution of `carat`, partitioned by `price`.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可视化按`价格`分区的`克拉`分布。
- en: How does the price distribution of very large diamonds compare to small diamonds?
    Is it as you expect, or does it surprise you?
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 很大钻石的价格分布与小钻石相比如何？是否符合您的预期，还是让您感到惊讶？
- en: Combine two of the techniques you’ve learned to visualize the combined distribution
    of cut, carat, and price.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 结合你学到的两种技术，可视化切割、克拉和价格的联合分布。
- en: Two-dimensional plots reveal outliers that are not visible in one-dimensional
    plots. For example, some points in the following plot have an unusual combination
    of `x` and `y` values, which makes the points outliers even though their `x` and
    `y` values appear normal when examined separately. Why is a scatterplot a better
    display than a binned plot for this case?
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 二维图表揭示了在一维图表中看不到的异常值。例如，以下图中的一些点具有不寻常的`x`和`y`值组合，这使得这些点在单独检查`x`和`y`值时看起来正常，但在散点图中则成为异常值。为什么散点图对于这种情况比分箱图更好？
- en: '[PRE24]'
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Instead of creating boxes of equal width with [`cut_width()`](https://ggplot2.tidyverse.org/reference/cut_interval.xhtml),
    we could create boxes that contain roughly equal number of points with [`cut_number()`](https://ggplot2.tidyverse.org/reference/cut_interval.xhtml).
    What are the advantages and disadvantages of this approach?
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不使用[`cut_width()`](https://ggplot2.tidyverse.org/reference/cut_interval.xhtml)创建等宽的箱子，而是使用[`cut_number()`](https://ggplot2.tidyverse.org/reference/cut_interval.xhtml)创建大致包含相同数量点的箱子。这种方法的优缺点是什么？
- en: '[PRE25]'
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Patterns and Models
  id: totrans-153
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 模式和模型
- en: 'If a systematic relationship exists between two variables, it will appear as
    a pattern in the data. If you spot a pattern, ask yourself:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 如果两个变量之间存在系统关系，它将在数据中显示为一种模式。如果您发现了一个模式，请问自己：
- en: Could this pattern be due to coincidence (i.e., random chance)?
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这种模式可能是巧合造成的吗（即随机事件）？
- en: How can you describe the relationship implied by the pattern?
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您如何描述由模式暗示的关系？
- en: How strong is the relationship implied by the pattern?
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这种模式所暗示的关系有多强？
- en: What other variables might affect the relationship?
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 其他变量可能会影响这种关系吗？
- en: Does the relationship change if you look at individual subgroups of the data?
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果您查看数据的各个子组，关系是否会发生变化？
- en: Patterns in your data provide clues about relationships; i.e., they reveal covariation.
    If you think of variation as a phenomenon that creates uncertainty, covariation
    is a phenomenon that reduces it. If two variables covary, you can use the values
    of one variable to make better predictions about the values of the second. If
    the covariation is due to a causal relationship (a special case), then you can
    use the value of one variable to control the value of the second.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 您数据中的模式提供了有关关系的线索；即，它们显示协变。如果您将变异视为创建不确定性的现象，协变则是减少不确定性的现象。如果两个变量协变，您可以使用一个变量的值来更好地预测第二个变量的值。如果协变是由因果关系引起的（一种特殊情况），则可以使用一个变量的值来控制第二个变量的值。
- en: Models are a tool for extracting patterns out of data. For example, consider
    the diamonds data. It’s hard to understand the relationship between cut and price,
    because cut and carat, and carat and price, are tightly related. It’s possible
    to use a model to remove the very strong relationship between price and carat
    to explore the subtleties that remain. The following code fits a model that predicts
    `price` from `carat` and then computes the residuals (the difference between the
    predicted value and the actual value). The residuals give us a view of the price
    of the diamond, once the effect of carat has been removed. Note that instead of
    using the raw values of `price` and `carat`, we log transform them first and fit
    a model to the log-transformed values. Then, we exponentiate the residuals to
    put them back in the scale of raw prices.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 模型是从数据中提取模式的工具。例如，考虑钻石数据。要理解切割和价格之间的关系很困难，因为切割与克拉、克拉与价格之间紧密相关。可以使用模型去除价格和克拉之间非常强的关系，以探索剩余的微妙差异。以下代码拟合一个模型，预测`price`基于`carat`，然后计算残差（预测值与实际值之间的差异）。残差使我们能够看到钻石的价格，一旦克拉的影响被消除。请注意，我们不使用`price`和`carat`的原始值，而是先对它们进行对数变换，然后拟合对数变换后的值的模型。然后，我们将残差指数化，以将它们放回到原始价格的尺度。
- en: '[PRE26]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '![A scatter plot of residuals vs. carat of diamonds. The x-axis ranges from
    0 to 5, the y-axis ranges from 0 to almost 4\. Much of the data are clustered
    around low values of carat and residuals. There is a clear, curved pattern showing
    decrease in residuals as carat increases.](assets/rds2_10in19.png)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![钻石残差与克拉的散点图。 x 轴范围从 0 到 5，y 轴范围从 0 到接近 4。大部分数据聚集在低克拉和残差的低值周围。有一个明显的曲线模式，显示随着克拉增加残差减少。](assets/rds2_10in19.png)'
- en: 'Once you’ve removed the strong relationship between carat and price, you can
    see what you expect in the relationship between cut and price: relative to their
    size, better-quality diamonds are more expensive.'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦消除了克拉与价格之间的强关系，您可以看到切割与价格之间的预期关系：相对于它们的大小，更高质量的钻石更贵。
- en: '[PRE27]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '![Side-by-side box plots of residuals by cut. The x-axis displays the various
    cuts (Fair to Ideal), the y-axis ranges from 0 to almost 5\. The medians are quite
    similar, between roughly 0.75 to 1.25\. Each of the distributions of residuals
    is right skewed, with many outliers on the higher end.](assets/rds2_10in20.png)'
  id: totrans-166
  prefs: []
  type: TYPE_IMG
  zh: '![残差的并列箱线图。 x 轴显示各种切割（从优到良），y 轴范围从 0 到接近 5。中位数非常相似，大约在 0.75 到 1.25 之间。每个残差分布都是右偏的，高端有许多异常值。](assets/rds2_10in20.png)'
- en: We’re not discussing modeling in this book because understanding what models
    are and how they work is easiest once you have tools for data wrangling and programming
    in hand.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不在本书中讨论建模，因为理解模型及其工作方式最容易是在掌握了数据整理和编程工具之后。
- en: Summary
  id: totrans-168
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 概要
- en: In this chapter you learned a variety of tools to help you understand the variation
    within your data. You saw a technique that works with a single variable at a time
    and with a pair of variables. This might seem painfully restrictive if you have
    tens or hundreds of variables in your data, but they’re the foundation upon which
    all other techniques are built.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了各种工具，帮助你理解数据中的变异性。你看到了一种每次只处理一个变量或一对变量的技术。如果你的数据中有数十个甚至数百个变量，这可能看起来非常受限，但它们是所有其他技术构建的基础。
- en: In the next chapter, we’ll focus on the tools we can use to communicate our
    results.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将专注于可以用来传达我们结果的工具。
- en: ^([1](ch10.xhtml#idm44771307799104-marker)) Remember that when we need to be
    explicit about where a function (or dataset) comes from, we’ll use the special
    form `package::function()` or `package::dataset`.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](ch10.xhtml#idm44771307799104-marker)) 请记住，当我们需要明确函数（或数据集）来自何处时，我们将使用特殊形式
    `package::function()` 或 `package::dataset`。
