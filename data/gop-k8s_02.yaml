- en: 1 Why GitOps?
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1 为什么选择 GitOps？
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: What is GitOps?
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 什么是 GitOps？
- en: Why GitOps is important
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为什么 GitOps 很重要
- en: GitOps compared with other approaches
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GitOps 与其他方法的比较
- en: Benefits of GitOps
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GitOps 的优势
- en: '*Kubernetes* is a massively popular open source platform that orchestrates
    and automates operations. Although it improves the management and scaling of infrastructure
    and applications, Kubernetes frequently has challenges managing the complexity
    of releasing applications.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '*Kubernetes* 是一个非常流行的开源平台，它编排和自动化操作。尽管它提高了基础设施和应用程序的管理和扩展，但 Kubernetes 经常面临管理应用程序复杂性的挑战。'
- en: '*Git* is the most widely used version-control system in the software industry
    today. *GitOps* is a set of procedures that uses the power of Git to provide both
    revision and change control within the Kubernetes platform. A GitOps strategy
    can play a big part in how quickly and easily teams manage their services’ environment
    creation, promotion, and operation.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '*Git* 是目前软件行业中应用最广泛的版本控制系统。*GitOps* 是一套使用 Git 的力量在 Kubernetes 平台上提供修订和变更控制的一系列流程。GitOps
    策略在团队快速且轻松地管理其服务的环境创建、升级和运营方面可以发挥重要作用。'
- en: Using GitOps with Kubernetes is a natural fit, with the deployment of declarative
    Kubernetes manifest files being controlled by common Git operations. GitOps brings
    the core benefits of Infrastructure as Code and immutable infrastructure to the
    deployment, monitoring, and life-cycle management of Kubernetes applications in
    an intuitive, accessible way.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 GitOps 与 Kubernetes 是一种自然匹配，声明式 Kubernetes 清单文件的部署由常见的 Git 操作控制。GitOps 以直观、易于访问的方式，将基础设施即代码和不可变基础设施的核心优势带给
    Kubernetes 应用的部署、监控和生命周期管理。
- en: 1.1 Evolution to GitOps
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.1 向 GitOps 的演变
- en: Two everyday tasks in managing and operating computer systems are infrastructure
    configuration and software deployment. *Infrastructure configuration* prepares
    computing resources (such as servers, storage, and load balancers) that enable
    the software application to operate correctly. *Software deployment* is the process
    of taking a particular version of a software application and making it ready to
    run on the computing infrastructure. Managing these two processes is the core
    of GitOps. Before we dig into how this management is done in GitOps, however,
    it is useful to understand the challenges that have led the industry toward DevOps
    and the immutable, declarative infrastructure of GitOps.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 管理和运营计算机系统的两个日常任务是基础设施配置和软件部署。*基础设施配置* 准备计算资源（如服务器、存储和负载均衡器），使软件应用能够正确运行。*软件部署*
    是将特定版本的软件应用部署到计算基础设施上的过程。管理这两个过程是 GitOps 的核心。然而，在我们深入探讨 GitOps 中如何进行这种管理之前，了解导致行业走向
    DevOps 和 GitOps 的不可变、声明式基础设施的挑战是有用的。
- en: 1.1.1 Traditional Ops
  id: totrans-11
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.1.1 传统运维
- en: In a traditional information technology operations model, development teams
    are responsible for periodically delivering new versions of a software application
    to a quality-assurance (QA) team that tests the new version and then delivers
    it to an operations team for deployment. New versions of software may be released
    once a year, once a quarter, or at shorter intervals. It becomes increasingly
    difficult for a traditional operations model to support increasingly compressed
    release cycles.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在传统的信息技术运维模型中，开发团队负责定期向质量保证（QA）团队交付新的软件应用版本，该团队测试新版本并将其交付给运维团队进行部署。软件的新版本可能每年发布一次，每季度发布一次，或者更短的时间间隔。对于传统的运维模型来说，支持越来越压缩的发布周期变得越来越困难。
- en: The operations team is responsible for the infrastructure configuration and
    deployment of the new software application versions to that infrastructure. The
    operations team’s primary focus is to ensure the reliability, resilience, and
    security of the system running the software. Without sophisticated management
    frameworks, infrastructure management can be a difficult task that requires a
    lot of specialized knowledge.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 运维团队负责新软件应用版本的配置和部署到该基础设施。运维团队的主要关注点是确保运行软件的系统的可靠性、弹性和安全性。没有复杂的管理框架，基础设施管理可能是一项困难的任务，需要大量的专业知识。
- en: '![](Images/CH01_F01_Yuen.png)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH01_F01_Yuen.png)'
- en: Figure 1.1 Traditional IT teams are typically composed of separate development,
    QA, and operations teams. Each team specializes in a different aspect of the application
    development process.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.1 传统 IT 团队通常由独立的开发、质量保证（QA）和运维团队组成。每个团队专注于应用开发过程中的不同方面。
- en: it operations *IT operations* is the set of all processes and services that
    are both provisioned by an IT staff to internal or external clients and used by
    the staff to provide a business’s technology needs. Operations work can include
    responding to tickets generated for maintenance work or customer issues.^([1](#pgfId-1074171))
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: IT运维*IT operations*是指由IT人员为内部或外部客户提供并由他们使用以提供企业技术需求的所有流程和服务。运维工作可以包括响应为维护工作或客户问题生成的票证。[1](#pgfId-1074171)
- en: Because three teams are involved, often with different management-reporting
    structures, a detailed handoff process and thorough documentation of the application
    changes are needed to ensure that the application is adequately tested, appropriate
    changes are made to infrastructure, and the application is installed correctly.
    These requirements, however, cause deployments to take a long time and reduce
    the frequency at which deployments can be made. Also, with each transition between
    teams, the possibility that essential details will not being communicated increases,
    possibly leading to gaps in testing or incorrect deployment.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 由于涉及三个团队，通常具有不同的管理-报告结构，因此需要一个详细的手递过程和对应用程序更改的彻底文档记录，以确保应用程序得到充分的测试，对基础设施进行适当的更改，并且应用程序被正确安装。然而，这些要求会导致部署时间延长，并减少可以进行的部署频率。此外，在每个团队之间的过渡中，关键细节可能无法得到有效沟通的可能性增加，可能导致测试中的差距或部署错误。
- en: '![](Images/CH01_F02_Yuen.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH01_F02_Yuen.png)'
- en: Figure 1.2 In the traditional deployment flow, the development team opens a
    ticket for the QA team to test a new product version. When the testing is successful,
    the QA team opens a ticket for the operations team to deploy the latest version
    to production.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.2 在传统的部署流程中，开发团队为QA团队打开一个工单以测试新产品版本。当测试成功时，QA团队为运维团队打开一个工单以将最新版本部署到生产环境。
- en: Fortunately, most development teams compile, test, and produce their deployable
    artifacts by using automated build systems and a process called *continuous integration
    (CI)*. But the new code’s deployment is often a manual process performed by the
    operations team, involving lengthy manual procedures or partial automation through
    deployment scripts. In a worst-case scenario, the operations engineer manually
    copies the executable binary file to the needed location on multiple servers and
    manually restarts the application to make the new binary version take effect.
    This process is error prone and offers few options for controls such as review,
    approval, auditability, and rollback.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，大多数开发团队通过使用自动化构建系统和称为*持续集成（CI）*的过程来编译、测试和生成可部署的工件。但新代码的部署通常是由运维团队手动执行的，涉及漫长的手动程序或通过部署脚本的局部自动化。在最坏的情况下，运维工程师手动将可执行二进制文件复制到多个服务器上所需的位置，并手动重新启动应用程序以使新二进制版本生效。这个过程容易出错，并且很少提供如审查、批准、可审计性和回滚等控制选项。
- en: Continuous Integration (CI) *CI* involves automated building, testing, and packaging
    of software applications. In a typical development workflow, software engineers
    make code changes that are checked into the central code repository. These changes
    must be tested and integrated with the main code branch intended to be deployed
    to production. A CI system facilitates the review, building, and testing of code
    to ensure its quality before merging to the main branch.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 持续集成（CI）*CI*涉及软件应用程序的自动化构建、测试和打包。在典型的发展工作流程中，软件工程师将代码更改提交到中央代码仓库。这些更改必须经过测试并与旨在部署到生产的主体代码分支集成。CI系统简化了代码的审查、构建和测试，以确保在合并到主分支之前其质量。
- en: 'With the rise of cloud computing infrastructure, the interfaces that manage
    compute and network resources have become increasingly based on application programming
    interfaces (APIs), allowing for more automation but requiring more programming
    skills to implement. This fact, coupled with many organizations’ search for ways
    to optimize operations, reduce deployment times, increase deployment frequency,
    and improve their computing systems’ reliability, stability, and performance,
    led to a new industry trend: DevOps.'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 随着云计算基础设施的兴起，管理和控制计算和网络资源的接口越来越多地基于应用程序编程接口（APIs），这使得自动化程度更高，但同时也需要更多的编程技能来实现。这一事实，加上许多组织寻求优化运营、缩短部署时间、增加部署频率以及提高其计算系统的可靠性、稳定性和性能的方法，导致了新的行业趋势：DevOps。
- en: 1.1.2 DevOps
  id: totrans-23
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.1.2 DevOps
- en: '*DevOps* is both an organizational structure and a mindset change with an emphasis
    on automation. An operations team is no longer responsible for deployment and
    operation; the application’s development team takes on these responsibilities.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '*DevOps* 既是组织结构，也是一种注重自动化的思维模式变革。运维团队不再负责部署和运营；应用的开发团队承担这些责任。'
- en: devops *DevOps* is a set of software development practices that combine software
    development (Dev) and IT operations (Ops) to shorten the system development life
    cycle while delivering features, fixes, and updates frequently in close alignment
    with business objectives.^([2](#pgfId-1074208))
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: devops *DevOps* 是一套软件开发实践，它将软件开发（Dev）和 IT 运营（Ops）相结合，以缩短系统开发周期，同时频繁地、与业务目标紧密一致地交付功能、修复和更新.^([2](#pgfId-1074208))
- en: Figure 1.3 shows how, in a traditional operations model, the organization is
    divided by functional boundaries, with different teams for development, quality,
    and operations. In the DevOps model, teams are divided by products or components
    and are interdisciplinary, containing team members who have skill sets across
    all functions. Although figure 1.3 indicates team members with a specific role,
    all members of a high-functioning team practicing DevOps contribute across functions;
    each member is able to code, test, deploy, and operate their product or component.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.3 展示了在传统的运维模型中，组织是如何通过功能边界进行划分的，有不同团队负责开发、质量和运维。在 DevOps 模型中，团队是根据产品或组件进行划分的，并且是跨学科的，包含具有所有功能技能集的团队成员。尽管图
    1.3 指出了具有特定角色的团队成员，但在实践 DevOps 的高效能团队中，所有成员都跨功能贡献；每个成员都能够编码、测试、部署和运营他们的产品或组件。
- en: '![](Images/CH01_F03_Yuen.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH01_F03_Yuen.png)'
- en: Figure 1.3 The traditional organizational model has separate teams for development,
    quality, and operations. A DevOps organizational model allows interdisciplinary
    teams centered on a specific product or component. Each DevOps team is self-sufficient
    and contains members who have the skills to develop, test, and deploy their application.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.3 传统的组织模型有独立的团队负责开发、质量和运维。DevOps 组织模型允许以特定产品或组件为中心的跨学科团队。每个 DevOps 团队都是自给自足的，包含具有开发、测试和部署其应用程序技能的成员。
- en: The benefits of DevOps include
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: DevOps 的好处包括
- en: Better collaboration between development and operations
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开发和运维之间更好的协作
- en: Improved product quality
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提高产品质量
- en: More frequent releases
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更频繁的发布
- en: Reduced time to market for new features
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 新功能上市时间的缩短
- en: Decreased costs of design, development, and operations
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设计、开发和运维成本的降低
- en: 'Case study: Netflix'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 案例研究：Netflix
- en: Netflix was one of the early adopters of the DevOps process, with every engineer
    being responsible for coding, testing, deployment, and support of their features.
    Netflix’s culture promotes “Freedom and Responsibility,” which means that every
    engineer can push releases independently but must ensure the proper operation
    of that release. All deployment processes are fully automated, so engineers can
    deploy and roll back with the press of a button. All new features are in end users’
    hands as soon as the functionality is complete.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: Netflix 是 DevOps 流程的早期采用者之一，每位工程师都负责其功能的编码、测试、部署和支持。Netflix 的文化推崇“自由与责任”，这意味着每位工程师都可以独立发布，但必须确保该发布的正确运行。所有部署流程都是完全自动化的，因此工程师可以一键部署和回滚。所有新功能在功能完成时立即交付给最终用户。
- en: 1.1.3 GitOps
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.1.3 GitOps
- en: The term *GitOps* was coined in August 2017 in a series of blogs by Alexis Richardson,
    cofounder and CEO of Weaveworks.^([3](#pgfId-1074237)) Since then, the term has
    developed significant mindshare in the cloud-native community in general and the
    Kubernetes community in particular. GitOps is a DevOps process characterized by
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 术语 *GitOps* 于 2017 年 8 月由 Weaveworks 的联合创始人兼首席执行官 Alexis Richardson 在一系列博客文章中提出.^([3](#pgfId-1074237))
    从那时起，该术语在云原生社区以及 Kubernetes 社区中获得了显著的认知。GitOps 是一种以 Git 为特色的 DevOps 流程，其特点为
- en: Best practices for deployment, management, and monitoring of containerized applications
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 部署、管理和监控容器化应用程序的最佳实践
- en: A developer-centric experience for managing applications, with fully automated
    pipelines/workflows using Git for development and operations
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以开发者为中心的应用管理体验，使用 Git 进行开发和运维的完全自动化管道/工作流程
- en: Use of the Git revision control system to track and approve changes to the infrastructure
    and run-time environment of applications
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Git 版本控制系统跟踪和批准对应用程序的基础设施和运行时环境的更改
- en: '![](Images/CH01_F04_Yuen.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH01_F04_Yuen.png)'
- en: Figure 1.4 The GitOps release workflow starts with creating a branch of the
    repository containing changes to the definition of the system’s desired state.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.4 GitOps发布工作流程从创建包含系统期望状态定义更改的仓库分支开始。
- en: GitHub (along with GitLab, Bitbucket, and so on) is central to the modern software
    development life cycle, so it seems natural that it is also used for systems operation
    and management.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: GitHub（以及GitLab、Bitbucket等）是现代软件开发生命周期中的核心，因此它也被用于系统操作和管理似乎是自然而然的。
- en: In a GitOps model, the system’s desired configuration is stored in a revision
    control system, such as Git. Instead of making changes directly to the system
    via a UI or CLI, an engineer makes changes to the configuration files that represent
    the desired state. A difference between the desired state stored in Git and the
    system’s actual state indicates that not all changes have been deployed. These
    changes can be reviewed and approved through standard revision control processes
    such as pull requests, code reviews, and merges to master. When changes have been
    approved and merged to the main branch, an operator software process is responsible
    for changing the system’s current state to the desired state based on the configuration
    stored in Git.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在GitOps模型中，系统的期望配置存储在版本控制系统（如Git）中。工程师不是直接通过UI或CLI对系统进行更改，而是更改表示期望状态的配置文件。Git中存储的期望状态与系统实际状态之间的差异表明并非所有更改都已部署。这些更改可以通过标准版本控制流程（如拉取请求、代码审查和合并到主分支）进行审查和批准。当更改被批准并合并到主分支后，操作软件进程负责根据Git中存储的配置将系统的当前状态更改为期望状态。
- en: In an ideal implementation of GitOps, manual changes to the system are not permitted,
    and all changes to the configuration must be made to files stored in Git. In an
    extreme case, permission to change the system is granted only to the operator
    software process. The infrastructure and operations engineers’ role in a GitOps
    model shifts from performing the infrastructure changes and application deployments
    to developing and maintaining the GitOps automation and helping teams review and
    approve changes by using Git.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在GitOps的理想实现中，不允许手动更改系统，所有对配置的更改都必须是对存储在Git中的文件的更改。在极端情况下，更改系统的权限仅授予操作软件进程。在GitOps模型中，基础设施和运维工程师的角色从执行基础设施更改和应用部署转变为开发和维护GitOps自动化，并帮助团队使用Git审查和批准更改。
- en: 'Git has many features and technical capabilities that make it an ideal choice
    for use with GitOps:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: Git具有许多功能和技术能力，使其成为GitOps的理想选择：
- en: Git stores each commit. With proper access control and security configuration
    (covered in chapter 6), all changes are auditable and tamperproof.
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Git存储每个提交。通过适当的访问控制和安全配置（在第6章中介绍），所有更改都是可审计的和防篡改的。
- en: Each commit in Git represents a complete configuration of the system up to that
    point in time.
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Git中的每个提交都代表了一个系统在该时间点的完整配置。
- en: Each commit object in Git is associated with its parent commit so that as branches
    are created and merged, the commit history is available when needed.
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Git中的每个提交对象都与它的父提交相关联，这样在创建和合并分支时，提交历史在需要时是可用的。
- en: Note GitOps is important because it enables traceability of changes made to
    an environment and enables easy rollback, recoverability, and self-healing with
    Git, a tool with which most developers are already familiar.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 注意GitOps的重要性，因为它使对环境所做的更改具有可追溯性，并使使用大多数开发者已经熟悉的Git工具轻松回滚、恢复和自我修复变得容易。
- en: Git provides the basis to validate and audit deployments. Although it may be
    possible to implement GitOps by using a version-control system other than Git,
    Git’s distributed nature, branching and merging strategy, and widespread adoption
    make it an ideal choice.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: Git为验证和审计部署提供了基础。尽管可能可以使用除Git之外的版本控制系统实现GitOps，但Git的分布式特性、分支和合并策略以及广泛的应用使其成为理想选择。
- en: 'GitOps doesn’t require a particular set of tools, but the tools must offer
    this standard functionality:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: GitOps不需要特定的工具集，但工具必须提供以下标准功能：
- en: Operate on the desired state of the system that is stored in Git
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Git中操作存储的系统期望状态
- en: Detect differences between the desired state and the actual state
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 检测期望状态与实际状态之间的差异
- en: Perform the required operations on the infrastructure to synchronize the actual
    state with the desired state
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对基础设施执行必要的操作，以同步实际状态与期望状态
- en: Although this book focuses on GitOps in relation to Kubernetes, many of the
    principles of GitOps could be implemented independently of Kubernetes.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这本书主要关注 Kubernetes 中的 GitOps，但 GitOps 的许多原则可以独立于 Kubernetes 实现。
- en: 1.2 Developer benefits of GitOps
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.2 GitOps 的开发者好处
- en: 'GitOps provides many benefits to developers because it allows them to treat
    the configuration of infrastructure and deployment of code in much the same way
    that they manage their software development process, and with a familiar tool:
    Git.'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: GitOps 为开发者提供了许多好处，因为它允许他们以与他们的软件开发过程管理方式相同的方式处理基础设施配置和代码部署，并且使用一个熟悉的工具：Git。
- en: 1.2.1 Infrastructure as code
  id: totrans-60
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.2.1 基础设施即代码
- en: '*Infrastructure* *as code* (IaC) is a foundational paradigm for GitOps. The
    configuration of the infrastructure that runs your applications is accomplished
    by executing an automated process rather than manual steps.^([4](#pgfId-1074280))
    In practice, IaC means that infrastructure changes are codified and the source
    code for the infrastructure is stored in a version-control system. Let’s go through
    the most notable benefits:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '*基础设施* *即代码* (IaC) 是 GitOps 的基础范式。运行您应用程序的基础设施配置是通过执行自动化流程而不是手动步骤来完成的。[4](#pgfId-1074280)
    在实践中，IaC 意味着基础设施更改被编码化，并且基础设施的源代码存储在版本控制系统之中。让我们来看看最显著的好处：'
- en: '*Repeatability*—Everyone who has experience provisioning infrastructure manually
    agrees that this process is time consuming and error prone. Don’t forget that
    the same process has to be repeated multiple times, because applications are typically
    deployed into multiple environments. If a problem is discovered, it is easier
    to roll back to an earlier working configuration with a repeatable process, allowing
    quicker recoveries.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*可重复性*——所有有手动配置基础设施经验的都知道这个过程既耗时又容易出错。不要忘记，同样的过程通常需要重复多次，因为应用程序通常部署到多个环境中。如果发现问题，使用可重复的过程回滚到早期的工作配置会更简单，从而允许更快的恢复。'
- en: '*Reliability*—The automated process significantly reduces the chance of inevitable
    human errors, thereby reducing the possibility of outages. When the process is
    codified, infrastructure quality no longer depends on the knowledge and skill
    of the particular engineer who is performing the deployment. The automation of
    the infrastructure configuration can be steadily improved.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*可靠性*——自动化流程显著减少了不可避免的人类错误的可能性，从而降低了故障的可能性。当过程被编码化时，基础设施质量不再依赖于执行部署的特定工程师的知识和技能。基础设施配置的自动化可以稳步改进。'
- en: '*Efficiency*—IaC increases the productivity of the team. With IaC, engineers
    are more productive because they use familiar tools, such as APIs, software development
    kits (SDKs), version-control systems, and text editors. Engineers can use familiar
    processes and take advantage of code review and automated testing.'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*效率*——IaC 提高了团队的生产力。使用 IaC，工程师更有效率，因为他们使用熟悉的工具，如 API、软件开发工具包 (SDK)、版本控制系统和文本编辑器。工程师可以使用熟悉的过程并利用代码审查和自动化测试。'
- en: '*Savings*—The initial implementation of IaC requires significant investment
    of effort and time. Despite the initial cost, however, it is more cost effective
    in the long run. The provisioning of infrastructure for the next environment does
    not require wasting valuable engineer time for manual configuration. Because provisioning
    is quick and cheap, there is no need to keep unused environments running. Instead,
    each environment might be created on demand and destroyed when it is no longer
    needed.'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*节省*——IaC 的初始实施需要大量的努力和时间投资。然而，尽管初始成本较高，但从长远来看，它更经济。为下一个环境提供基础设施不需要浪费宝贵的工程师时间进行手动配置。因为提供是快速且便宜的，所以没有必要保持未使用的环境运行。相反，每个环境可能根据需要创建，并在不再需要时销毁。 '
- en: '*Visibility*—When you define IaC, the code itself documents how the infrastructure
    should look.'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*可见性*——当你定义 IaC 时，代码本身记录了基础设施应该如何看起来。'
- en: IaC enables developers to produce higher-quality software while saving time
    and money. It might be easier to configure the infrastructure manually for one
    environment, but it will become increasingly challenging to maintain that environment,
    along with dozens of other environments for your application. Using automated
    infrastructure provisioning and following IaC principles enables repeatable deployments
    and prevents run-time issues caused by configuration drift or missing dependencies.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: IaC使开发者能够在节省时间和金钱的同时生产出高质量的软件。对于单一环境来说，手动配置基础设施可能更容易，但随着需要维护的应用程序环境数量不断增加，这将变得越来越具有挑战性。使用自动化的基础设施配置和遵循IaC原则可以实现可重复部署，并防止由配置漂移或缺失依赖项引起的运行时问题。
- en: 1.2.2 Self-service
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.2.2 自助服务
- en: As mentioned previously, in a traditional operations model, infrastructure management
    is performed by a dedicated team or even a separate organization within the company.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，在传统的运维模型中，基础设施管理由专门的团队或公司内的独立组织执行。
- en: 'There is a problem, however: this approach does not scale. The dedicated team
    will quickly become a bottleneck, no matter how many members it has. Instead of
    making an infrastructure change themselves, application developers have to file
    a ticket, send an email, schedule a meeting, and wait. Regardless of the process,
    a barrier exists, introducing many delays and discouraging the team from proactively
    proposing infrastructure changes. GitOps aims to break the barrier by automating
    the process and making it self-service.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这种方法存在一个问题：它无法扩展。无论团队有多少成员，专用团队都会很快成为瓶颈。应用程序开发者不能自己进行基础设施更改，他们必须提交工单、发送电子邮件、安排会议并等待。无论过程如何，都会存在一个障碍，导致许多延迟并阻碍团队主动提出基础设施更改。GitOps旨在通过自动化流程和实现自助服务来打破这个障碍。
- en: Instead of sending a ticket, when using a GitOps model, the developer works
    on a solution independently and commits a change to the infrastructure’s declarative
    configuration in the repository. The infrastructure change does not require cross-team
    communication anymore, allowing the application development team to move forward
    much more quickly and have more freedom to experiment. The ability to make infrastructure
    changes rapidly and independently encourages developers to take ownership of their
    application infrastructure. Instead of asking a central operations team for a
    solution, developers can experiment and develop a design that efficiently solves
    the business requirements.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用GitOps模型时，开发者独立工作，并在存储库中对基础设施的声明性配置提交更改，而不是发送工单。基础设施的更改不再需要跨团队沟通，这使得应用程序开发团队能够更快地前进，并拥有更多的自由进行实验。快速独立地做出基础设施更改的能力鼓励开发者承担其应用程序基础设施的责任。开发者不必向中央运维团队寻求解决方案，他们可以进行实验并开发出能够高效解决业务需求的设计。
- en: '![](Images/CH01_F06_Yuen.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH01_F06_Yuen.png)'
- en: Figure 1.5 The development team can change the system’s desired state by updating
    files stored in the Git repository. These changes are code-reviewed by other team
    members and merged to the main branch upon approval. The main branch is processed
    by a GitOps operator that deploys the cluster’s desired configuration.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.5 开发团队可以通过更新存储在Git存储库中的文件来更改系统的期望状态。这些更改将由其他团队成员进行代码审查，并在批准后合并到主分支。主分支由GitOps操作员处理，以部署集群的期望配置。
- en: Developers don’t get full control to do whatever they want, however, possibly
    compromising security or reliability. Every change requires creating a pull request
    that can be reviewed by another member of the application development team, as
    described in the following sections.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 开发者不能完全控制所欲为，这可能会影响安全性或可靠性。每个更改都需要创建一个可以由应用程序开发团队的其他成员审查的拉取请求，如下文所述。
- en: The advantage of GitOps is that it allows self-service infrastructure changes
    and provides the right balance between control and development speed.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: GitOps的优势在于它允许自助服务基础设施更改，并在控制与开发速度之间提供了正确的平衡。
- en: 1.2.3 Code reviews
  id: totrans-76
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.2.3 代码审查
- en: '*Code* *review* is a software development practice in which code changes are
    proactively examined for errors or omissions by a second pair of eyes, leading
    to fewer preventable outages. Performing code reviews is a natural process in
    the software development life cycle with which software engineers doing DevOps/GitOps
    should be familiar. When the DevOps engineer can treat infrastructure as code,
    the logical next step is to perform code reviews on the infrastructure changes
    before deployment. When GitOps is used with Kubernetes, the “code” being reviewed
    may be primarily Kubernetes YAML manifests or other declarative configuration
    files, not traditional code written in a programming language.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '*代码审查* 是一种软件开发实践，其中代码更改由第二双眼睛主动检查错误或遗漏，从而导致可预防的中断更少。执行代码审查是软件开发生命周期中的一个自然过程，DevOps/GitOps
    的软件工程师应该熟悉。当 DevOps 工程师可以将基础设施视为代码时，逻辑上的下一步就是在部署之前对基础设施更改进行代码审查。当与 Kubernetes
    一起使用 GitOps 时，“代码”审查可能主要是 Kubernetes YAML 清单或其他声明性配置文件，而不是用编程语言编写的传统代码。'
- en: 'Besides error prevention, code reviews provide the following benefits:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 除了错误预防外，代码审查还提供以下好处：
- en: '*Teaching and sharing knowledge*—While reviewing the changes, the reviewer
    has a chance not only to give feedback, but also to learn something.'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*教学和知识分享*—在审查更改时，审查者不仅有机会提供反馈，还可以学习到一些东西。'
- en: '*Consistency in design and implementation*—During the review, the team can
    ensure that changes are aligned with the overall code structure and follow the
    company’s code style guidelines.'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*设计和实现的一致性*—在审查过程中，团队可以确保更改与整体代码结构保持一致，并遵循公司的代码风格指南。'
- en: '*Team cohesion*—Code review is not only for criticizing and requesting changes.
    This process is also an excellent way for team members to give kudos to one another,
    get closer, and make sure that everyone is fully engaged.'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*团队凝聚力*—代码审查不仅用于批评和请求更改。这个过程也是团队成员互相表扬、增进关系并确保每个人都充分参与的一个绝佳方式。'
- en: In a proper code review process, only verified and approved infrastructure changes
    are committed to the main branch, preventing errors and incorrect modifications
    to the operating environment. Code review doesn’t necessarily need to be done
    entirely by humans. The code review process also can run automated tools such
    as code linters,^([5](#pgfId-1074325)) static code analysis, and security tools.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 在适当的代码审查过程中，只有经过验证和批准的基础设施更改才会提交到主分支，从而防止错误和操作环境的错误修改。代码审查不一定完全由人类完成。代码审查过程还可以运行自动化工具，如代码检查器、^([5](#pgfId-1074325))
    静态代码分析和安全工具。
- en: Note Other automated tools for code and vulnerability analysis are covered in
    chapter 4.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：其他用于代码和漏洞分析的自动化工具在第 4 章中介绍。
- en: Code reviews have long been accepted as a critical part of software development
    best practices. The key premise of GitOps is that the same rigor of code reviews
    used in the application code should be applied to changes in the application operational
    environment.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 代码审查长期以来一直被视为软件开发最佳实践的 critical 部分。GitOps 的关键前提是，应用于应用程序代码的代码审查的严谨性应该应用于应用程序操作环境中的更改。
- en: 1.2.4 Git pull requests
  id: totrans-85
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.2.4 Git 拉取请求
- en: The Git version-control system provides a mechanism in which proposed changes
    can be committed to a branch or fork and then merged with the main branch through
    a pull request. In 2005, Git introduced a `request-pull` command. This command
    generates a human-readable summary of all the changes, which can be mailed to
    the project maintainer manually. The pull request collects all the changes to
    the repository files and presents the differences for code review and approval.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: Git 版本控制系统提供了一种机制，可以将提议的更改提交到分支或分叉，然后通过拉取请求与主分支合并。2005 年，Git 引入了 `request-pull`
    命令。此命令生成所有更改的易读摘要，可以手动邮寄给项目维护者。拉取请求收集存储库文件的所有更改，并展示代码审查和批准的差异。
- en: Pull requests can be used to enforce premerge code reviews. Controls can be
    put in place to require specific testing or approval before a pull request is
    merged to the main branch. Like code reviews, pull requests are a familiar process
    in the software development life cycle that software engineers likely already
    use.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用拉取请求来强制执行预合并代码审查。可以实施控制措施，要求在拉取请求合并到主分支之前进行特定的测试或批准。与代码审查一样，拉取请求是软件开发生命周期中的一个熟悉的过程，软件工程师可能已经使用。
- en: 'Figure 1.6 demonstrates the typical pull request life cycle:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.6 展示了典型的拉取请求生命周期：
- en: The developer creates a new branch and starts working on the changes.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 开发者创建一个新的分支并开始对更改进行工作。
- en: When changes are ready, the developer sends a pull request for code review.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当更改准备就绪时，开发者会发送一个代码审查的拉取请求。
- en: Team members review the pull request and request more changes (if needed).
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 团队成员审查拉取请求，并根据需要要求更多更改。
- en: The developer keeps making changes in a branch until the pull request is approved.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 开发者在分支中持续进行更改，直到拉取请求获得批准。
- en: The project maintainer merges the pull request into the main branch.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 项目维护者将拉取请求合并到主分支。
- en: After the merge, the branch used for the pull request may be deleted.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 合并后，用于拉取请求的分支可以被删除。
- en: '![](Images/CH01_F07_Yuen.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH01_F07_Yuen.png)'
- en: Figure 1.6 The pull request life cycle allows multiple rounds of code review
    and revisions until the changes are approved. Then the changes may be merged to
    the main branch and the pull request branch deleted.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.6 拉取请求生命周期允许进行多轮代码审查和修订，直到更改获得批准。然后，更改可以合并到主分支，并删除拉取请求分支。
- en: The review step is especially interesting when applied to an infrastructure
    change review. After the pull request is created, the project maintainers receive
    a notification and review the proposed changes. As a result, reviewers ask questions,
    receive answers, and possibly request more changes. That information is typically
    stored and available for future reference, so now the pull request is a live documentation
    of an infrastructure change. In case of an incident, it is straightforward to
    find out who made the change and why it was applied.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 当应用于基础设施更改审查时，审查步骤尤其有趣。在创建拉取请求后，项目维护者会收到通知并审查提议的更改。因此，审查者会提出问题，接收答案，并可能要求更多更改。这些信息通常会被存储并可供将来参考，因此现在拉取请求是基础设施更改的实时文档。在发生事件的情况下，可以轻松地找出谁进行了更改以及为什么应用了该更改。
- en: 1.3 Operational benefits of GitOps
  id: totrans-98
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.3 GitOps的操作优势
- en: Combining a GitOps methodology with Kubernetes’ declarative configuration and
    active reconciliation model provides many operational benefits that provide a
    more predictable and reliable system.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 将GitOps方法与Kubernetes的声明式配置和主动协调模型相结合，提供了许多操作优势，这些优势提供了更可预测和可靠的系统。
- en: 1.3.1 Declarative
  id: totrans-100
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.1 声明式
- en: One of the most prominent paradigms to emerge from the DevOps movement is the
    model of *declarative systems and configuration*. Simply put, with declarative
    models, you describe *what* you want to achieve as opposed to how to get there.
    By contrast, in an imperative model, you describe a sequence of instructions for
    manipulating the system to reach your desired state.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 从DevOps运动中涌现出的最突出的范例之一是*声明式系统和配置*模型。简单来说，使用声明式模型，你描述的是*想要实现什么*，而不是如何实现。相比之下，在命令式模型中，你描述的是一系列指令，用于操纵系统以达到你希望的状态。
- en: 'To illustrate this difference, imagine two styles of a television remote control:
    an *imperative* style and a *declarative* style. Both remotes can control the
    TV’s power, volume, and channel. For the sake of discussion, assume that the TV
    has only three volume settings (loud, soft, mute) and only three channels (1,
    2, 3).'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明这种差异，想象两种电视遥控器的样式：一种*命令式*样式和一种*声明式*样式。两种遥控器都可以控制电视的电源、音量和频道。为了讨论方便，假设电视只有三个音量设置（响亮、柔和、静音）和三个频道（1、2、3）。
- en: '![](Images/CH01_F08_Yuen.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH01_F08_Yuen.png)'
- en: Figure 1.7 This figure illustrates the differences between imperative and declarative
    remote controls. The imperative remote lets you perform operations such as “Increment
    the channel by 1” and “Toggle the state of the power.” By contrast, the declarative
    remote lets you perform operations such as “Tune to channel 2” or “Set the state
    of the power to off.”
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.7 此图说明了命令式和声明式远程控制之间的差异。命令式远程控制允许你执行“增加频道1”和“切换电源状态”等操作。相比之下，声明式远程控制允许你执行“调谐到频道2”或“将电源状态设置为关闭”等操作。
- en: Imperative remote example
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 命令式远程示例
- en: Suppose that you had the simple task of changing to channel 3 with both remotes.
    To accomplish this task with the imperative remote, you would use the channel-up
    button, which signals the TV to increment the current channel by 1\. To reach
    channel 3, you would keep pressing the channel-up button some number of times
    until the TV reached the desired channel.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你有一个简单的任务，即使用两个远程端同时切换到频道3。要使用命令式远程端完成这个任务，你会使用频道上调按钮，该按钮向电视发送信号，使其当前频道增加1。要达到频道3，你需要连续按几次频道上调按钮，直到电视达到所需的频道。
- en: Declarative remote example
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 声明式远程示例
- en: By contrast, the declarative remote provides individual buttons that jump directly
    to the specific numbered channel. In this case, to switch to channel 3, you would
    press the channel- 3 button once, and the TV would be on the correct channel.
    You are declaring your intended end state (I want the TV to be tuned to channel
    3). With the imperative remote, you describe the actions that you need to be performed
    to achieve your desired state (keep pressing the channel-up button until the TV
    is tuned to channel 3).
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，声明式遥控器提供了可以直接跳转到特定数字频道的独立按钮。在这种情况下，要切换到频道3，你只需按一次频道-3按钮，电视就会调到正确的频道。你是在声明你想要达到的最终状态（我想电视调到频道3）。而在命令式遥控器上，你描述了需要执行的动作以达到你想要的状态（一直按频道上调按钮，直到电视调到频道3）。
- en: You may have noticed that in the imperative approach to changing channels, the
    user must consider whether to continue pushing the channel-up button, depending
    on the channel to which the TV is currently tuned. In the declarative approach,
    however, you can press the channel-3 button without a second thought because that
    button on the declarative remote is considered to be idempotent (and the channel-up
    button on the imperative remote is not).
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能已经注意到，在命令式更改频道的方法中，用户必须考虑是否继续按频道上调按钮，这取决于电视当前调谐的频道。然而，在声明式方法中，你可以毫不犹豫地按下频道-3按钮，因为声明式遥控器上的这个按钮被认为是幂等的（而命令式遥控器上的频道上调按钮则不是）。
- en: IDEMPOTENCY *Idempotency* is a property of an operation whereby the operation
    can be performed any number of times and produce the same result. In other words,
    an operation is said to be idempotent if you can perform the operation an arbitrary
    number of times, and the system is in the same state as it would be if you had
    performed the operation only once. Idempotency is one of the properties that distinguish
    declarative systems from imperative systems. Declarative systems are idempotent;
    imperative systems are not.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '**幂等性**（Idempotency）是操作的一个属性，即操作可以执行任意多次并产生相同的结果。换句话说，如果一个操作可以任意多次执行，并且系统状态与只执行一次操作时的状态相同，那么这个操作就是幂等的。幂等性是区分声明式系统和命令式系统属性之一。声明式系统是幂等的；命令式系统则不是。'
- en: 1.3.2 Observability
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.2 可观察性
- en: '*Observability* is the ability to examine and describe a system’s current running
    state and be alerted when unexpected conditions occur. Deployed environments are
    expected to be observable. In other words, you should always be able to inspect
    an environment to see what is currently running and how things are configured.
    To that end, service and cloud providers provide a fair number of methods to promote
    observability (including CLIs, APIs, GUIs, dashboards, alerts, and notifications),
    making it as convenient as possible for users to understand the current state
    of the environment.'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '**可观察性**是检查和描述系统当前运行状态的能力，并在出现意外条件时发出警报。部署的环境预期应该是可观察的。换句话说，你应该始终能够检查环境，以查看当前正在运行的内容以及配置情况。为此，服务和云提供商提供了一系列方法来促进可观察性（包括CLIs、APIs、GUIs、仪表板、警报和通知），使用户尽可能方便地了解环境的当前状态。'
- en: '![](Images/CH01_F09_Yuen.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH01_F09_Yuen.png)'
- en: Figure 1.8 Observability is the operator’s ability (perhaps human or automated)
    to determine an environment’s running state. The operator can make informed decisions
    about what changes to the environment are needed only once if the environment’s
    current running state is known. Proper control of an environment requires observability
    of that environment.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.8 可观察性是操作员（可能是人或自动化）确定环境运行状态的能力。如果已知环境的当前运行状态，操作员可以仅一次就做出关于需要改变环境哪些方面的明智决策。适当控制环境需要对该环境进行可观察性。
- en: Although these observability mechanisms can help answer the question, “What’s
    currently running in my environment?” they cannot answer the question, “For the
    resources currently configured and running in my environment, are they *supposed*
    to be configured and running in that way?” If you have ever held duties as a systems
    administrator or operator, you’re likely to be all too familiar with this problem.
    At one point or another—typically, when troubleshooting an environment—you come
    across a suspicious configuration setting and think that it doesn’t seem right.
    Did someone (possibly you) accidentally or mistakenly change this setting, or
    is the setting intentional?
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这些可观察性机制可以帮助回答“我的环境中当前正在运行什么？”的问题，但它们不能回答“对于我环境中当前配置和运行的资源，它们*应该*以这种方式配置和运行吗？”的问题。如果您曾经担任过系统管理员或操作员的职责，您可能非常熟悉这个问题。在某个时候——通常是当调试环境时——您会遇到一个可疑的配置设置，并认为它似乎不正确。有人（可能是您自己）意外或错误地更改了这个设置，还是这个设置是有意的？
- en: 'In all likelihood, you may already be practicing a fundamental principle of
    GitOps: storing a copy of your application configuration in source control and
    using it as a source of truth for the desired state of your application. You may
    not be storing this configuration in Git to drive continuous deployment—only to
    have a copy duplicated *somewhere* so that the environment can be reproduced,
    such as in a disaster recovery scenario. This copy can be thought of as the desired
    application state, and aside from the disaster recovery use case, it serves another
    useful purpose: it enables operators to compare the actual running state with
    the desired state held in source control at any point in time to verify that the
    states match.'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 很可能，您已经在实践中遵循了GitOps的一个基本原则：将应用程序配置的副本存储在源代码控制中，并使用它作为应用程序期望状态的真相来源。您可能并不是为了驱动持续部署而将此配置存储在Git中——只是为了确保环境可以被复制，例如在灾难恢复场景中。这个副本可以被视为期望的应用程序状态，除了灾难恢复用例之外，它还服务于另一个有用的目的：它使操作员能够在任何时间点将实际运行状态与源代码控制中保存的期望状态进行比较，以验证状态是否匹配。
- en: '![](Images/CH01_F10_Yuen.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/CH01_F10_Yuen.png)'
- en: Figure 1.9 If the environment’s running state can be observed, and the desired
    state of the environment is defined in Git, the environment can be verified by
    comparing the two states.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.9 如果可以观察到环境的运行状态，并且环境的期望状态在Git中定义，则可以通过比较这两个状态来验证环境。
- en: The ability to verify your environment is a core tenet of GitOps that has been
    formalized as a practice. By storing your desired state in one system (such as
    Git) and regularly comparing that desired state with the running state, you unlock
    a new dimension of observability. Not only do you have the standard observability
    mechanisms provided by your provider, but also, you are able to detect divergence
    from the desired state.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 验证您环境的能力是GitOps的一个核心原则，它已被正式化为一种实践。通过将期望状态存储在一个系统中（例如Git），并定期将该期望状态与运行状态进行比较，您解锁了新的可观察性维度。您不仅拥有提供商提供的标准可观察性机制，而且还能检测到与期望状态的偏差。
- en: Divergence from your desired state, also called *configuration drift*, can happen
    for any number of reasons. Common examples include mistakes made by operators,
    unintended side effects due to automation, and error scenarios. Configuration
    drift could even be expected, such as a temporary state caused by a transition
    period (maintenance mode, for example).
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 与期望状态的偏差，也称为*配置漂移*，可能由任何数量的原因引起。常见的例子包括操作员犯的错误、由于自动化而产生的意外副作用以及错误场景。配置漂移甚至可能是预期的，例如由过渡期（例如维护模式）引起的临时状态。
- en: But the most significant reason for a divergence in configuration could be malicious.
    In the worst case, a bad actor could have compromised the environment and reconfigured
    the system to run a malicious image. For this reason, observability and verification
    are crucial for the security of the system. Unless you have a source of truth
    of your desired state in place, and without a mechanism to verify convergence
    to that source of truth, it is impossible to know that your environment is truly
    secure.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，配置差异的最重要原因可能是恶意的。在最坏的情况下，一个恶意行为者可能已经破坏了环境并重新配置了系统以运行恶意镜像。因此，可观察性和验证对于系统的安全性至关重要。除非您已经建立了期望状态的真相来源，并且没有验证收敛到该真相来源的机制，否则您无法知道您的环境是否真正安全。
- en: 1.3.3 Auditability and compliance
  id: totrans-122
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.3 审计性和合规性
- en: Allowing for compliance and auditability is a must for organizations that do
    business in countries whose laws and regulations affect information management
    and frameworks for assessing compliance—which is most countries in this day and
    age. Some industries are more regulated than others, but almost all companies
    need to comply with basic privacy and data security laws. Many organizations have
    to invest substantially in their processes and systems to be compliant and auditable.
    With GitOps and Kubernetes, most of the compliance and auditability requirements
    can be satisfied with minimal effort.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 对于在受法律和法规影响信息管理和合规性评估框架的国家（在这个时代的大多数国家）开展业务的组织来说，确保合规性和可审计性是必不可少的。一些行业比其他行业监管更严格，但几乎所有公司都需要遵守基本的隐私和数据安全法律。许多组织必须大量投资于其流程和系统，以确保合规性和可审计性。使用GitOps和Kubernetes，大多数合规性和可审计性要求都可以以最小的努力得到满足。
- en: '*Compliance* refers to verifying that an organization’s information system
    meets a particular set of industry standards, typically focused on customer data
    security and adherence to the organization’s documented policies on the people
    and systems that have access to that customer data. Chapter 6 covers access control
    in depth, and chapter 4 covers pipelines to define and enforce your deployment
    process for compliance.'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '*合规性*是指验证组织的信息系统是否符合特定的行业标准，通常侧重于客户数据安全和遵守组织关于访问该客户数据的个人和系统的记录政策。第6章深入探讨了访问控制，第4章涵盖了管道来定义和执行您的合规性部署流程。'
- en: '*Auditability* is a system’s capability to be verified as being compliant with
    a set of standards. If a system can’t be shown to an internal or external auditor
    to be compliant, no statement about the system’s compliance can be made. Chapter
    8 covers observability, including using the Git commit history and Kubernetes
    events for auditability.'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '*可审计性*是指系统被验证为符合一系列标准的能力。如果一个系统无法向内部或外部审计员展示其符合性，则不能对该系统的符合性做出任何声明。第8章涵盖了可观察性，包括使用Git提交历史和Kubernetes事件来实现可审计性。'
- en: 'Case study: Facebook and Cambridge Analytica'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 案例研究：Facebook和剑桥分析公司
- en: Cambridge Analytica, a political data firm hired by President Trump’s 2016 election
    campaign, gained improper access to the private information of more than 50 million
    Facebook users. The data was used to generate a personality score for each user
    and match that user with US voter records. Cambridge Analytica used this information
    for its voter profiling and targeted advertising services. Facebook was found
    not to have implemented the proper controls required to enforce data privacy and
    was eventually fined $5 billion by the Federal Trade Commission due to the breach.^a
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 剑桥分析公司，一家受特朗普2016年竞选活动总统聘请的政治数据公司，未经许可获取了超过5000万Facebook用户的私人信息。这些数据被用来为每个用户生成一个性格评分，并将其与美国的选民记录相匹配。剑桥分析公司利用这些信息为其选民画像和定向广告服务。Facebook被发现没有实施必要的控制措施来执行数据隐私，最终因违规行为被联邦贸易委员会罚款50亿美元。^a
- en: ^a [https://www.ftc.gov/news-events/press-releases/2019/07/ftc-imposes-5-billion-penalty-sweeping-new-privacy-restrictions](https://www.ftc.gov/news-events/press-releases/2019/07/ftc-imposes-5-billion-penalty-sweeping-new-privacy-restrictions)
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: ^a [https://www.ftc.gov/news-events/press-releases/2019/07/ftc-imposes-5-billion-penalty-sweeping-new-privacy-restrictions](https://www.ftc.gov/news-events/press-releases/2019/07/ftc-imposes-5-billion-penalty-sweeping-new-privacy-restrictions)
- en: Auditability also refers to an auditor’s ability to achieve a comprehensive
    examination of an organization’s internal controls. In a typical audit, the auditor
    requests evidence to ensure that rules and policies are enforced accordingly.
    Evidence could include the process of restricting access to user data, the handling
    of personally identifiable information (PII), and the integrity of the software
    release process.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 可审计性也指审计员能够全面审查组织内部控制的程度。在典型的审计中，审计员会要求提供证据以确保规则和政策得到相应执行。证据可能包括限制用户数据访问的过程、处理个人可识别信息（PII）的方式以及软件发布流程的完整性。
- en: '![](Images/CH01_F11_Yuen.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![图1.10](Images/CH01_F11_Yuen.png)'
- en: Figure 1.10 In a traditional audit process, it is often difficult to determine
    the system’s desired state. Auditors may need to look at various sources of this
    information, including documentation, change requests, and deployment scripts.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.10 在传统的审计过程中，往往很难确定系统的期望状态。审计员可能需要查看各种信息来源，包括文档、变更请求和部署脚本。
- en: 'Case study: Payment Card Industry Data Security Standard'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 案例研究：支付卡行业数据安全标准
- en: The Payment Card Industry Data Security Standard (PCI DSS) is an information
    security standard for organizations that handle branded credit cards from the
    major card networks. Violation of the PCI DSS could result in steep fines and,
    in the worst case, suspension from credit card processing. PCI DSS dictates that
    “access control systems are configured to enforce privileges assigned to individuals
    based on job classification and function.” During an audit, organizations need
    to provide evidence that access control systems are in place for PCI compliance.^a
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 信用卡行业数据安全标准（PCI DSS）是为处理主要信用卡网络品牌信用卡的组织制定的信息安全标准。违反 PCI DSS 可能会导致高额罚款，在最坏的情况下，甚至可能被暂停信用卡处理。PCI
    DSS 规定，“访问控制系统配置为根据工作分类和职能分配给个人的权限进行权限管理。”在审计期间，组织需要提供证据证明已实施访问控制系统以符合 PCI 标准.^a
- en: ^a [https://en.wikipedia.org/wiki/Payment_Card_Industry_Data_Security_Standard](https://en.wikipedia.org/wiki/Payment_Card_Industry_Data_Security_Standard)
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: ^a [https://en.wikipedia.org/wiki/Payment_Card_Industry_Data_Security_Standard](https://en.wikipedia.org/wiki/Payment_Card_Industry_Data_Security_Standard)
- en: What does all that have to do with GitOps?
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些与 GitOps 有什么关系？
- en: Git is version-control software that helps organizations manage changes and
    access control to their code. Git keeps track of every modification to the code
    in a special kind of database designed to preserve the managed source code’s integrity.
    The files’ content and the true relationships among files and directories, versions,
    tags, and commits in the Git repository are secured with the Secure Hash Algorithm
    (SHA) checksum hashing algorithm. This algorithm protects the code and the change
    history from both accidental and malicious change and ensures that the history
    is fully traceable.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: Git 是一种版本控制软件，帮助组织管理代码的更改和访问控制。Git 通过一种特殊类型的数据库跟踪代码的每一次修改，该数据库旨在保护受管理源代码的完整性。Git
    仓库中文件的 内容以及文件和目录之间、版本、标签和提交之间的真实关系都通过安全哈希算法（SHA）校验和散列算法得到保护。此算法保护代码和更改历史，防止意外和恶意更改，并确保历史记录可完全追溯。
- en: Git’s history tracking also includes the author, date, and written notes on
    each change’s purpose. With well-written commit comments, you know *why* a particular
    commit was made. Git can also integrate with project management and bug-tracking
    software, allowing full traceability of all changes and enabling root-cause analysis
    and other forensics.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: Git 的历史跟踪还包括每个更改的作者、日期和关于更改目的的书面注释。通过良好的提交注释，你可以知道特定提交的 *原因*。Git 还可以与项目管理软件和缺陷跟踪软件集成，允许对所有更改进行完全追溯，并实现根本原因分析和其他法医分析。
- en: As mentioned earlier, Git supports the pull request mechanism, which prevents
    any single person from altering the system without approval by a second person.
    When the pull request is approved, changes are recorded in the secured Git change
    history. Git’s strength in change control, traceability, and change history authenticity,
    along with Kubernetes’ declarative configuration, naturally satisfy the security,
    availability, and processing integrity principles needed for auditability and
    compliance.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，Git 支持拉取请求机制，这防止任何单一个人在没有第二个人批准的情况下更改系统。当拉取请求被批准时，更改会被记录在安全的 Git 更改历史中。Git
    在变更控制、可追溯性和变更历史真实性方面的优势，加上 Kubernetes 的声明式配置，自然满足了审计性和合规性所需的 安全、可用性和处理完整性原则。
- en: '![](Images/CH01_F12_Yuen.png)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/CH01_F12_Yuen.png)'
- en: Figure 1.11 With GitOps, the audit process can be simplified because the auditor
    can determine the system’s desired state by examining the source code repository.
    The current state of the system can be determined by reviewing the hosting service
    and Kubernetes objects.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.11 在 GitOps 中，审计过程可以简化，因为审计员可以通过检查源代码仓库来确定系统的期望状态。系统的当前状态可以通过审查托管服务和 Kubernetes
    对象来确定。
- en: 1.3.4 Disaster recovery
  id: totrans-141
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.4 灾难恢复
- en: Disasters happen for many reasons and take many forms. A disaster may be naturally
    occurring (an earthquake hitting a data center), caused by an equipment failure
    (loss of hard drives in a storage array), accidental (a software bug corrupting
    a critical database table), or even malicious (a cyberattack causing data loss).
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 灾难可能由许多原因和多种形式引起。灾难可能是自然发生的（地震袭击数据中心），由设备故障引起（存储阵列中硬盘驱动器的丢失），意外发生（软件错误损坏关键数据库表），甚至可能是恶意的（网络攻击导致数据丢失）。
- en: GitOps helps in the recovery of infrastructure environments by storing declarative
    specifications of the environment under source control as a source of truth. Having
    a complete definition of what the environment should be facilitates the re-creation
    of the environment in the event of a disaster. Disaster recovery becomes a simple
    exercise of (re)applying all the configuration stored in the Git repository. You
    might observe that there is not much difference between the procedures followed
    during a disaster versus those used in routine day-to-day upgrades and deployments.
    With GitOps, you are in effect practicing disaster recovery procedures on a regular
    basis, making you well prepared if a real disaster strikes.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: GitOps通过将环境的声明性规范存储在源控制中作为真相来源，有助于恢复基础设施环境。拥有环境应具备的完整定义，便于在灾难发生时重新创建环境。灾难恢复变成了一种简单的练习，即（重新）应用存储在Git仓库中的所有配置。您可能会观察到，在灾难期间遵循的程序与日常升级和部署中使用的程序之间没有太大的区别。使用GitOps，您实际上是在定期练习灾难恢复程序，这使得您在真正发生灾难时做好了充分的准备。
- en: 'Importance of Data Backups Although GitOps helps simplify disaster recovery
    for computing and networking infrastructure, recovery of persistent and stateful
    applications needs to be handled differently. There is no substitute for traditional
    disaster recovery solutions for storage-related infrastructure: backups, snapshotting,
    and replication.'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 数据备份的重要性 虽然GitOps有助于简化计算和网络基础设施的灾难恢复，但持久性和有状态应用程序的恢复需要不同的处理方式。对于与存储相关的基础设施，没有传统的灾难恢复解决方案可以替代：备份、快照和复制。
- en: Summary
  id: totrans-145
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: GitOps is a DevOps deployment process that uses Git as the system of record
    to manage deployment in complex systems.
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GitOps是一种使用Git作为记录系统的DevOps部署流程，用于管理复杂系统中的部署。
- en: Traditional Ops requires a separate team for deployment, and a new version can
    take days (if not weeks) to be deployed.
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 传统运维需要单独的团队进行部署，新版本可能需要几天（如果不是几周）才能部署完成。
- en: DevOps enables engineers to deploy a new version as soon as the code is complete
    without waiting for a centralized operations team.
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DevOps使工程师能够在代码完成后立即部署新版本，而无需等待集中的运维团队。
- en: GitOps provides full traceability and release control.
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GitOps提供完整的可追溯性和发布控制。
- en: Declarative models describe what you want to achieve instead of the steps necessary
    to achieve it.
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 声明性模型描述了您想要实现的目标，而不是实现它的必要步骤。
- en: Idempotency is a property of an operation whereby the operation can be performed
    any number of times and produce the same result.
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一致性是操作的一个属性，即操作可以执行任意次数并产生相同的结果。
- en: Additional GitOps benefits include
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GitOps的其他好处包括
- en: Pull requests for code quality and release control
  id: totrans-153
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代码质量和发布控制的拉取请求
- en: Observable running state and desired state
  id: totrans-154
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可观察的运行状态和期望状态
- en: Simplified compliance and auditability process with historical authenticity
    and traceability
  id: totrans-155
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 简化的合规性和可审计性流程，具有历史真实性和可追溯性
- en: Straightforward disaster recovery and rollback procedures that are consistent
    with the familiar deployment experience
  id: totrans-156
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 简单的灾难恢复和回滚程序，与熟悉的部署体验保持一致
- en: '* * *'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: 1.[https://en.wikipedia.org/wiki/Data_center_management#Operations](https://en.wikipedia.org/wiki/Data_center_management#Operations).
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 1.[https://en.wikipedia.org/wiki/Data_center_management#Operations](https://en.wikipedia.org/wiki/Data_center_management#Operations).
- en: 2.[https://en.wikipedia.org/wiki/DevOps](https://en.wikipedia.org/wiki/DevOps).
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 2.[https://en.wikipedia.org/wiki/DevOps](https://en.wikipedia.org/wiki/DevOps).
- en: 3.[https://www.weave.works/blog/gitops-operations-by-pull-request](https://www.weave.works/blog/gitops-operations-by-pull-request).
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 3.[https://www.weave.works/blog/gitops-operations-by-pull-request](https://www.weave.works/blog/gitops-operations-by-pull-request).
- en: 4.[https://www.hashicorp.com/resources/what-is-infrastructure-as-code](https://www.hashicorp.com/resources/what-is-infrastructure-as-code).
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 4.[https://www.hashicorp.com/resources/what-is-infrastructure-as-code](https://www.hashicorp.com/resources/what-is-infrastructure-as-code).
- en: 5.[https://en.wikipedia.org/wiki/Lint_(software)](https://en.wikipedia.org/wiki/Lint_(software)).
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 5.[https://en.wikipedia.org/wiki/Lint_(software)](https://en.wikipedia.org/wiki/Lint_(software)).
