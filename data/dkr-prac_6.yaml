- en: Appendix B. Docker configuration
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 附录 B. Docker 配置
- en: At various points in this book you’re advised to change your Docker configuration
    to make changes permanent on starting up your Docker host machines. [Appendix
    B](#app02) will advise you on the best practices to achieve this. The operating
    system distribution you use will be significant in this context.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的各个部分，你被建议更改 Docker 配置，以便在启动 Docker 主机时使更改永久化。[附录 B](#app02) 将为你提供实现此目的的最佳实践建议。你使用的操作系统分发版在此背景下将非常重要。
- en: Configuring Docker
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置 Docker
- en: The location of the config files for most mainstream distributions is listed
    in [table B.1](#app02table01).
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数主流分发版的配置文件位置列在 [表 B.1](#app02table01) 中。
- en: Table B.1\. Docker configuration file locations
  id: totrans-4
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表 B.1\. Docker 配置文件位置
- en: '| **Distribution** | **Configuration** |'
  id: totrans-5
  prefs: []
  type: TYPE_TB
  zh: '| **分发** | **配置** |'
- en: '| --- | --- |'
  id: totrans-6
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| Ubuntu, Debian, Gentoo | /etc/default/docker |'
  id: totrans-7
  prefs: []
  type: TYPE_TB
  zh: '| Ubuntu, Debian, Gentoo | /etc/default/docker |'
- en: '| OpenSuse, CentOS, Red Hat | /etc/sysconfg/docker |'
  id: totrans-8
  prefs: []
  type: TYPE_TB
  zh: '| OpenSuse, CentOS, Red Hat | /etc/sysconfg/docker |'
- en: Note that some distributions keep the configuration to a single file, whereas
    others use a directory and multiple files. For example, on Red Hat Enterprise
    License, there’s a file called /etc/sysconfig/docker/docker-storage, which by
    convention contains configuration relating to storage options for the Docker daemon.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，一些分发版将配置保留为单个文件，而其他分发版则使用目录和多个文件。例如，在 Red Hat Enterprise License 上，有一个名为
    /etc/sysconfig/docker/docker-storage 的文件，按照惯例，它包含与 Docker 守护进程存储选项相关的配置。
- en: If your distribution doesn’t have any files that match the names in table B.1,
    it’s worth checking for an /etc/docker folder, as there may be relevant files
    in there.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的分发版中没有与表 B.1 中列出的名称匹配的文件，那么检查 /etc/docker 文件夹是值得的，因为那里可能存在相关的文件。
- en: Within these files, arguments to the Docker daemon’s startup command are managed.
    For example, when edited, a line such as the following allows you to set the starting
    arguments for the Docker daemon on your host.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在这些文件中，管理 Docker 守护进程启动命令的参数。例如，当编辑时，以下类似的行允许你为主机上的 Docker 守护进程设置启动参数。
- en: '[PRE0]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'For example, if you want to change the location of Docker’s root directory
    from the default (which is /var/lib/docker), you might change the preceding line
    as follows:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果你想将 Docker 的根目录位置从默认位置（即 /var/lib/docker）更改为其他位置，你可能需要将前面的行更改为以下内容：
- en: '[PRE1]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'If your distribution uses systemd config files (as opposed to /etc), you can
    also search for the `ExecStart` line in the docker file under the systemd folder,
    and change that if you want. This file might be located at /usr/lib/systemd/system/service/docker
    or /lib/systemd/system/docker.service, for example. Here’s an example file:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的分发版使用 systemd 配置文件（而不是 /etc），你还可以在 systemd 文件夹下的 docker 文件中搜索 `ExecStart`
    行，并根据需要更改它。例如，该文件可能位于 /usr/lib/systemd/system/service/docker 或 /lib/systemd/system/docker.service。以下是一个示例文件：
- en: '[PRE2]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The `EnvironmentFile` line refers the startup script to the file with the `DOCKER_OPTS`
    entry we discussed earlier. If you change the systemctl file directly, you’ll
    need to run `systemctl daemon-reload` to ensure that the change is picked up by
    the systemd daemon.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '`EnvironmentFile` 行将启动脚本指向我们之前讨论的 `DOCKER_OPTS` 条目的文件。如果你直接更改 systemctl 文件，你需要运行
    `systemctl daemon-reload` 来确保更改被 systemd 守护进程拾取。'
- en: Restarting Docker
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 重启 Docker
- en: Altering the configuration for the Docker daemon isn’t sufficient—in order to
    apply the changes, the daemon must be restarted. Be aware that this will stop
    any running containers and cancel any in-progress image downloads.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 仅更改 Docker 守护进程的配置是不够的——为了应用更改，守护进程必须重启。请注意，这将停止任何正在运行的容器并取消任何正在进行的镜像下载。
- en: '***Restarting with systemctl***'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '***使用 systemctl 重启***'
- en: Most modern Linux distributions use systemd to manage the startup of services
    on the machine. If you run `systemctl` on the command line and get pages of output,
    then your host is running systemd. If you get a “command not found” message, go
    to the next section.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数现代 Linux 分发版使用 systemd 来管理机器上服务的启动。如果你在命令行上运行 `systemctl` 并得到一页的输出，那么你的主机正在运行
    systemd。如果你得到“命令未找到”的消息，请转到下一节。
- en: 'If you want to make changes to your configuration, you can stop and start Docker
    as follows:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想更改配置，你可以按照以下步骤停止并启动 Docker：
- en: '[PRE3]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Or you can just restart:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你也可以直接重启：
- en: '[PRE4]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Check the progress by running these commands:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 通过运行以下命令来检查进度：
- en: '[PRE5]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The first line here outputs available logs for the docker daemon process. The
    second follows the logs for any new entries.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 这里第一行输出了 docker 守护进程的可用日志。第二行跟随任何新的条目。
- en: '***Restarting with service***'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '***使用服务重启***'
- en: If your system is running a System V-based set of init scripts, try running
    `service --status-all`. If that returns a list of services, you can use `service`
    to restart Docker with your new configuration.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的系统正在运行基于 System V 的 init 脚本集，请尝试运行 `service --status-all`。如果它返回服务列表，您可以使用
    `service` 命令以新的配置重启 Docker。
- en: '[PRE6]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
