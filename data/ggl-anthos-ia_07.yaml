- en: 7 Hybrid applications
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 7 混合应用程序
- en: Jason Quek
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 贾森·奎克
- en: This chapter covers
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Highly available applications
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 高可用应用程序
- en: Geographically distributed applications
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 地理上分布式的应用程序
- en: Hybrid multicloud applications
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 混合多云应用程序
- en: Applications regulated by law
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 受法律监管的应用程序
- en: Applications that must run on the edge
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 必须在边缘运行的应用程序
- en: In the real world, applications are bound by rules such as data locality requirements,
    resource constraints, situations where a stable connection to the cloud cannot
    be guaranteed—such as at a baseball stadium, a construction site, or on a fighter
    jet—to do low-latency computation locally on the edge to avoid large amounts of
    data transfer. The application must be available and survive a regional disaster
    or cloud outage.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在现实世界中，应用程序受到诸如数据本地性要求、资源限制、无法保证稳定连接到云的情况（例如在棒球场、建筑工地或战斗机上）等规则的约束，需要在边缘进行低延迟计算以避免大量数据传输。应用程序必须可用，并能在区域灾难或云服务中断中生存。
- en: However, a need to run applications with the same consistency and stability
    that the Kubernetes platform provides still exists. Thus, solutions such as Anthos
    are designed to create this conformant distributed cloud platform for such applications.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，仍然存在运行与 Kubernetes 平台提供的一致性和稳定性相同的应用程序的需求。因此，像 Anthos 这样的解决方案被设计出来，为这类应用程序创建一个符合规定的分布式云平台。
- en: In this chapter, we will go over these different situations and show various
    architectures involving the use of Anthos and its suite of products to support
    these types of applications.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨这些不同的情况，并展示涉及使用 Anthos 及其产品套件的各种架构，以支持这些类型的应用程序。
- en: 7.1 Highly available applications
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7.1 高可用应用程序
- en: This class of applications must run 24 hours a day, 7 days a week. Financial
    institutions managing transactions, health care applications, and traffic management
    are just some of the examples of applications that affect the real world if they
    are unavailable for a short period of time.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 这类应用程序必须每天24小时、每周7天运行。管理交易的金融机构、医疗保健应用程序和交通管理只是少数几个在短时间内不可用就会影响现实世界应用的事例。
- en: In Google Kubernetes Engine, you can create clusters to span availability zones
    within a region. This practice provides insurance in the event one of the availability
    zones within a region goes down—the other availability zones are still running
    the application. The Kubernetes scheduler would then spin up additional replicas
    on the nodes still active on the other availability zones to meet replica requirements
    defined in the Kubernetes configuration.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Google Kubernetes Engine 中，您可以在一个区域内创建跨可用区的集群。这种做法在区域内某个可用区发生故障时提供保障——其他可用区仍在运行应用程序。Kubernetes
    调度器随后会在其他活跃的可用区上的节点上启动额外的副本，以满足 Kubernetes 配置中定义的副本要求。
- en: However, what if an entire region, or an entire cloud provider, was down? An
    article found in Forbes ([http://mng.bz/DZa0](http://mng.bz/DZa0)) mentioned a
    scenario where a banking client wanted to use a single cloud and the regulator
    was concerned about what would happen during an outage. The client estimated they
    would have a maximum of two hours of downtime during the cloud outage, but the
    plan was rejected by the regulator as an unviable option.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果整个区域或整个云服务提供商都宕机了怎么办？福布斯杂志上的一篇文章([http://mng.bz/DZa0](http://mng.bz/DZa0))提到了一个场景，其中一家银行客户希望使用单一云服务，而监管机构担心在故障期间会发生什么。客户估计在云服务中断期间最多会有两小时的停机时间，但该计划被监管机构拒绝，因为它不是一个可行的选择。
- en: In this situation, companies would have to span multiple clouds and regions,
    but doing so would introduce complexity and overhead in managing multiple cloud
    providers and require double the skill set across their operations, development,
    and security management at the same time.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，公司可能需要跨越多个云和区域，但这样做会引入管理多个云服务提供商的复杂性和开销，同时还需要在他们的运营、开发和安全管理上具备双倍的技能集。
- en: With Anthos, companies can standardize on Kubernetes with one unified pattern
    of deployment, scaling, security, and development, while still being able to take
    advantage of the availability of multiple cloud providers and move workloads across
    regions and availability zones.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Anthos，公司可以在一个统一的部署、扩展、安全和开发模式上标准化 Kubernetes，同时仍然能够利用多个云服务提供商的可用性，并在区域和可用区之间迁移工作负载。
- en: 7.1.1 Architecture
  id: totrans-17
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.1.1 架构
- en: 'The setup shown in figure 7.1 is simple: installing Anthos GKE, GKE on AWS,
    and GKE on-prem, and including them all in a service mesh. Such a setup would
    give high availability not just on the regional level but also at the cloud provider
    level.'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.1所示的设置很简单：安装Anthos GKE、AWS上的GKE和本地GKE，并将它们全部包含在一个服务网格中。这样的设置不仅能在区域级别提供高可用性，还能在云服务提供商级别提供高可用性。
- en: '![07-01](../../OEBPS/Images/07-01.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![07-01](../../OEBPS/Images/07-01.png)'
- en: Figure 7.1 Multicloud availability with Service Mesh connectivity
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.1 多云可用性与服务网格连接
- en: Note that this structure assumes that the application just has to be available
    but may not be required to be accessible from the internet. This distinction is
    important because this architecture will survive even in the extremely unlikely
    event that one of the cloud providers has a severe outage. Anthos clusters can
    still function, even if they cannot reach Google Cloud APIs for a limited amount
    of time.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，这种结构假设应用只需可用，但不一定需要从互联网上可访问。这种区别很重要，因为即使是在极其不可能的情况下，某个云服务提供商出现严重故障，这种架构也能生存。即使Anthos集群无法在有限时间内访问Google
    Cloud API，它们仍然可以继续运行。
- en: 7.1.2 Benefits
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.1.2 优势
- en: Installation of the managed Kubernetes service across all three clouds may seem
    simple, but each has different processes, options, and best practices. Versions
    of Kubernetes available also differ across cloud providers. By using Anthos, such
    problems are handled by Google engineers who work behind the scenes to make sure
    that everything works on the different clouds. Solutions such as Workload Identity
    can be deployed across hybrid and multiclouds to provide a unified authentication
    framework. This situation provides a true sense of a multicloud managed service
    where the customer says to Google, “Take my budget and help me manage my clusters
    everywhere, even on your competitors’ services.”
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有三个云中安装托管Kubernetes服务可能看起来很简单，但每个云都有不同的流程、选项和最佳实践。可用的Kubernetes版本在云服务提供商之间也有所不同。通过使用Anthos，这些问题由幕后工作的Google工程师处理，确保一切在不同的云上都能正常工作。例如，Workload
    Identity可以在混合云和多云环境中部署，以提供统一的身份验证框架。这种情况提供了真正的多云托管服务的感觉，客户对Google说：“把我的预算拿去，帮助我在任何地方管理我的集群，甚至是在你的竞争对手的服务上。”
- en: 7.1.3 Limitations
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.1.3 局限性
- en: Such applications normally require somewhere to persist state, which then creates
    a dependency on a provider, unless the organizations choose to host their own
    data solution on the cloud. With the emergence of Kubernetes-native databases
    such as CockroachDB, which can be deployed across multiple clusters, or using
    MirrorMaker to replicate messages across Kafka deployments in multiple clusters,
    this problem is beginning to have robust solutions.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 这样的应用通常需要一个地方来持久化状态，这就会对提供商产生依赖，除非组织选择在云上托管自己的数据解决方案。随着Kubernetes原生数据库（如CockroachDB）的出现，这些数据库可以部署在多个集群中，或者使用MirrorMaker在多个集群中的Kafka部署之间复制消息，这个问题开始有了稳健的解决方案。
- en: Anthos does not manage the underlying networks, storage, and compute used to
    build the clusters, and organizations still need to manage networking and ensure
    storage and compute availability across hybrid and multiple clouds. It is all
    about the Kubernetes API and making it available to developers on any surface
    throughout the organization—a shared responsibility that differs from competing
    products.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos不管理构建集群所使用的底层网络、存储和计算资源，组织仍然需要管理网络并确保在混合云和多云环境中存储和计算的可用性。这全部关乎Kubernetes
    API，并使其在整个组织中的任何表面上对开发者可用——这是一个与竞争对手产品不同的共享责任。
- en: It is important to understand that such architecture might not be easy to build
    and maintain, but for organizations that have regulatory, financial, and reputational
    reasons to have their applications always available and disaster resistant, Anthos
    provides a path to that.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是要理解，这样的架构可能不容易构建和维护，但对于有监管、财务和声誉原因需要其应用始终可用且具有灾难恢复能力的组织来说，Anthos提供了一条通往这一目标的路径。
- en: 7.2 Geographically distributed applications
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7.2 地理分布式应用
- en: These applications must be located around the world to serve a worldwide audience.
    Having a managed service be able to route to the nearest cluster from one single
    IP from anywhere in the world makes application scaling across the world much
    simpler.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 这些应用必须分布在全球各地，以服务全球用户。一个托管服务能够从世界任何地方的单个IP地址路由到最近的集群，这使得应用在全球范围内的扩展变得更加简单。
- en: The most important point for this setup is to provide the user access to this
    application from the location nearest to them to minimize latency. The application
    is often an exact copy of microservices deployed to clusters in different regions
    but with no requirement that it span multiple clouds. This is coupled with multigeographical
    databases, which can be used either as a managed service from Google, (e.g., Spanner)
    or CockroachDB, which can be deployed across multiple Kubernetes clusters spanning
    the globe.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这种设置来说，最重要的是提供用户从他们最近的位置访问此应用程序的途径，以最小化延迟。该应用程序通常是部署到不同区域集群中的微服务的精确副本，但没有要求它跨越多个云。这与多地理数据库相结合，这些数据库可以作为
    Google 的托管服务（例如 Spanner）或 CockroachDB 使用，CockroachDB 可以部署在全球范围内的多个 Kubernetes
    集群中。
- en: However, with Anthos, the same application can be deployed in multiple regions,
    which opens new opportunities in various markets. One important component that
    ties this together is Ingress for Anthos, a cloud-hosted gateway for distributed
    clusters.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，使用 Anthos，同一个应用程序可以部署在多个区域，这为各种市场开辟了新的机遇。将这一切联系在一起的一个重要组件是 Anthos for Ingress，这是一个为分布式集群提供的云托管网关。
- en: With Ingress for Anthos, all users of the application can access it through
    an anycast IP and get routed to the cluster nearest to the user. One use case
    where this ability is important is the retail sector, where customer churn is
    proven to be directly related to the latency of the e-commerce site.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Anthos for Ingress，所有应用程序的用户都可以通过一个任播 IP 访问它，并被路由到用户最近的集群。这种能力在零售行业中非常重要，因为客户流失已被证明与电子商务网站的延迟直接相关。
- en: 7.2.1 Ingress for Anthos architecture
  id: totrans-33
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.2.1 Anthos for Ingress 架构
- en: Ingress for Anthos builds on top of the existing Google HTTP load-balancing
    architecture, using Google Cloud points of presence to route traffic efficiently
    to the nearest available cluster, as can be seen in figure 7.2\. With such an
    architecture, you can deploy applications that need to serve a new audience in
    a different region on an Anthos cluster on that specific region and configure
    Ingress for Anthos to send traffic to that new region, while keeping the same
    IP address and domain name.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos for Ingress 建立在现有的 Google HTTP 负载均衡架构之上，使用 Google Cloud 存在点有效地将流量路由到最近的可用集群，如图
    7.2 所示。在这种架构下，您可以在特定区域的 Anthos 集群上部署需要为不同区域的新受众提供服务的应用程序，并配置 Anthos for Ingress
    将流量发送到该新区域，同时保持相同的 IP 地址和域名。
- en: '![07-02](../../OEBPS/Images/07-02.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![07-02](../../OEBPS/Images/07-02.png)'
- en: Figure 7.2 Ingress for Anthos architecture
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.2 Anthos for Ingress 架构
- en: Any cluster can be designated as a config cluster, and two custom Kubernetes
    objects, MultiClusterIngress and MultiClusterService, are deployed on this one,
    which is just a centralized configuration storage for the Anthos Ingress controller
    to read from.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 任何集群都可以被指定为配置集群，并且在这个集群上部署了两个自定义 Kubernetes 对象，MultiClusterIngress 和 MultiClusterService，这只是一个
    Anthos Ingress 控制器的集中配置存储，供其读取。
- en: The Anthos Ingress controller is a set of Compute Engine instances that sit
    in multiple Google Cloud regions outside of the user’s control and are managed
    by Google. These instances must be placed nearest to the Google points of presence
    where traffic enters to make routing decisions based on Anthos clusters that are
    members in the same Anthos fleet[¹](#pgfId-1112872) and Pod availability.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos Ingress 控制器是一组 Compute Engine 实例，这些实例位于用户控制之外的多个 Google Cloud 区域，并由 Google
    管理。这些实例必须放置在最近的 Google 存在点，以便根据 Anthos 集群（这些集群是同一 Anthos 舰队中的成员）和 Pod 可用性做出路由决策[¹](#pgfId-1112872)。
- en: The key concept of Ingress for Anthos is the use of network endpoint groups
    (NEGs). NEGs are groups of backend endpoints or services, which can be deployed
    on Anthos clusters. The Compute Engine instances in the Ingress for Anthos service
    seen in figure 7.2 route to the correct NEG, based on the availability of the
    service.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos for Ingress 的关键概念是使用网络端点组（NEGs）。NEGs 是一组后端端点或服务，可以在 Anthos 集群上部署。如图 7.2
    所示的 Anthos for Ingress 服务中的 Compute Engine 实例根据服务的可用性路由到正确的 NEG。
- en: To understand more about Ingress for Anthos networking, please refer to chapter
    10.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于 Anthos for Ingress 网络的信息，请参阅第 10 章。
- en: 7.2.2 Ingress for Anthos benefits
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.2.2 Anthos for Ingress 的优势
- en: Creating load balancers to route traffic to clusters from points of presence
    that are also aware of the state of service availability of each cluster is a
    complex task. This process breaks down the problem into a single cluster problem,
    so developers can concentrate on building more features and know that they can
    be deployed in a standardized way across the globe and be accessible to their
    users with low latency.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 创建负载均衡器以将流量从也了解每个集群服务可用状态的存在点路由到集群是一项复杂任务。这个过程将问题分解为单个集群问题，因此开发者可以专注于构建更多功能，并知道它们可以以标准化的方式在全球范围内部署，并且用户可以以低延迟访问。
- en: 7.2.3 Ingress for Anthos limitations
  id: totrans-43
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.2.3 Anthos的入口限制
- en: Ingress for Anthos is currently restricted to only Anthos Google Kubernetes
    Engine clusters and does not support GKE on-prem or GKE on AWS clusters. It is
    possible, however, to have a solution that also supports GKE on-prem clusters—using
    the Traffic Director would be a possible solution.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，Ingress for Anthos仅限于Anthos Google Kubernetes Engine集群，不支持GKE on-prem或GKE
    on AWS集群。然而，可能存在一个同时支持GKE on-prem集群的解决方案——使用Traffic Director可能是一个可能的解决方案。
- en: 7.3 Hybrid multicloud applications with internet access
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7.3 具有互联网访问的混合多云应用
- en: Some enterprises have invested in remote data centers or have a multicloud strategy,
    which makes Anthos a good fit as a product for them. However, when exposing their
    services to the public internet, they need to protect these applications so bad
    actors are unable to disrupt their availability and latency. One limitation of
    Ingress for Anthos is that these clusters must be on Google Cloud, but they also
    need to route to applications deployed across private and public clouds. Thus,
    they can use the Traffic Director, which can route traffic to clusters in a hybrid
    multicloud architecture.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 一些企业已经投资于远程数据中心或采用多云策略，这使得Anthos成为适合他们的产品。然而，当将他们的服务暴露给公共互联网时，他们需要保护这些应用，以防止恶意行为者干扰其可用性和延迟。Anthos的入口限制之一是这些集群必须在Google
    Cloud上，但它们还需要路由到部署在私有和公共云中的应用。因此，他们可以使用Traffic Director，它可以将流量路由到混合多云架构中的集群。
- en: 7.3.1 Traffic Director architecture
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.3.1 Traffic Director架构
- en: Traffic Director architecture looks similar to the Ingress for Anthos setup,
    with a key difference being that all the services must be in a Service Mesh for
    Traffic Director to work. For more details on Service Mesh, please refer to chapter
    4\. See figure 7.3 for an overview of using the Traffic Director for routing hybrid
    applications.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: Traffic Director架构看起来与Anthos的入口设置相似，但关键区别在于所有服务都必须在Service Mesh中，Traffic Director才能工作。有关Service
    Mesh的更多详细信息，请参阅第4章。图7.3概述了使用Traffic Director路由混合应用的方法。
- en: '![07-03](../../OEBPS/Images/07-03.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![07-03](../../OEBPS/Images/07-03.png)'
- en: Figure 7.3 Traffic Director architecture for hybrid applications
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.3 混合应用的Traffic Director架构
- en: In figure 7.3, the GKE on-prem cluster provides backend services to be used
    with the Traffic Director. The Traffic Director then directs the Google Cloud
    load balancer to direct traffic to the GKE on-prem cluster. This paradigm works
    for Anthos clusters on other clouds as well.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在图7.3中，GKE on-prem集群提供后端服务，用于与Traffic Director一起使用。然后，Traffic Director将Google
    Cloud负载均衡器引导到将流量路由到GKE on-prem集群。这种范式也适用于其他云上的Anthos集群。
- en: 7.3.2 Traffic Director benefits
  id: totrans-52
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.3.2 Traffic Director的优势
- en: The Traffic Director allows the use of Google Cloud load balancers to front
    hybrid applications, and, in doing so, can use cloud native services such as Google
    Cloud Armor ([https://cloud.google.com/armor](https://cloud.google.com/armor)*),*
    Cloud CDN ([https://cloud.google.com/cdn](https://cloud.google.com/cdn)*),* Identity-Aware
    Proxy ([https://cloud.google.com/iap](https://cloud.google.com/iap)*),* and managed
    certificates ([http://mng.bz/lJPz](http://mng.bz/lJPz)*).*
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 'Traffic Director允许使用Google Cloud负载均衡器作为混合应用的入口，并且在这个过程中，可以使用云原生服务，例如Google
    Cloud Armor ([https://cloud.google.com/armor](https://cloud.google.com/armor)*),*
    Cloud CDN ([https://cloud.google.com/cdn](https://cloud.google.com/cdn)*),* Identity-Aware
    Proxy ([https://cloud.google.com/iap](https://cloud.google.com/iap)*),* 以及托管证书
    ([http://mng.bz/lJPz](http://mng.bz/lJPz)*).* '
- en: All traffic coming into the application, regardless of where the services are
    hosted, will enter via a Google point of presence to a Google Cloud load balancer,
    which is then proxied via Envoy proxies programmed by the Traffic Director to
    a service that is part of the service mesh. The service can be hosted on-prem
    or across multiple clouds but is known through the service mesh. By using these
    services, hybrid applications on-prem can be protected from denial of service
    (DDoS) attacks, which can be a problem for hybrid applications.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 所有进入应用中的交通，无论服务托管在何处，都将通过一个谷歌接入点进入谷歌云负载均衡器，然后通过由流量导演编程的Envoy代理进行代理，连接到服务网格中的服务。该服务可以托管在本地或多个云中，但通过服务网格来识别。通过使用这些服务，本地混合应用可以免受拒绝服务（DDoS）攻击的保护，这对于混合应用来说可能是一个问题。
- en: The Traffic Director can also direct traffic to Google Compute Engines if the
    application is not running on Google Kubernetes Engine. The Traffic Director can
    also be used to split traffic between cloud services and on-prem services, to
    aid migration of services from on-prem to the cloud with no downtime.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 如果应用不在谷歌Kubernetes Engine上运行，流量导演还可以将流量引导到谷歌计算引擎。流量导演还可以用于在云服务和本地服务之间分割流量，以帮助服务从本地迁移到云，而无需停机。
- en: 7.3.3 Traffic Director limitations
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.3.3 流量导演的限制
- en: In figure 7.3, the middle proxy is deployed on a managed instance group, which
    scales according to traffic from the external load balancer before forwarding
    it to the GKE on-prem cluster. This additional compute cost is borne by the application
    owner.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在图7.3中，中间代理部署在托管实例组上，根据来自外部负载均衡器的流量进行扩展，然后再将其转发到本地GKE集群。这种额外的计算成本由应用所有者承担。
- en: 7.4 Applications regulated by law
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7.4 受法律监管的应用
- en: One set of applications belongs to highly regulated industries, which are bound
    to data locality restrictions. A list of these industries includes financial institutions,
    health care providers, pharmaceutical companies, and government agencies.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 一组应用属于高度监管的行业，这些行业受到数据本地性限制的约束。这些行业的列表包括金融机构、医疗保健提供者、制药公司和政府机构。
- en: Such applications require constant monitoring and complicated audit and security
    policies, which are aided using GKE on-prem, Anthos Config Management, Anthos
    Service Mesh, and VPC Service Controls.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 这类应用需要持续的监控和复杂的审计和安全策略，这些可以通过GKE本地、Anthos配置管理、Anthos服务网格和VPC服务控制来辅助实现。
- en: 7.4.1 Architecture
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.4.1 架构
- en: 'VPC Service Controls enable administrators to restrict access to certain Google
    Cloud APIs to allowed IP addresses, identities, and client devices. Such APIs
    include gkehub.googleapis.com, gkeconnect.googleapis.com, meshca.googleapis.com,
    and containerregistry.googleapis.com, which are the GKE Hub, GKE Connect, Anthos
    Service Mesh, and Container Registry services used throughout the Anthos offering.
    This process uses BeyondCorp ([https://cloud.google.com/beyondcorp](https://cloud.google.com/beyondcorp)*),*
    a concept made popular by Google Cloud: that trust should be built on identity,
    not on networking, and a zero-trust policy is used within a network. This allows
    users to work more securely from any trusted locations without a VPN. See figure
    7.4 for a visualization of the setup.'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: VPC服务控制允许管理员限制对某些谷歌云API的访问，仅允许特定的IP地址、身份和客户端设备。这些API包括gkehub.googleapis.com、gkeconnect.googleapis.com、meshca.googleapis.com和containerregistry.googleapis.com，它们是Anthos提供中使用的GKE
    Hub、GKE Connect、Anthos服务网格和容器注册服务。此过程使用BeyondCorp ([https://cloud.google.com/beyondcorp](https://cloud.google.com/beyondcorp)*)，*这是一个由谷歌云推广的概念：信任应该建立在身份上，而不是网络，网络内部使用零信任策略。这使用户能够从任何受信任的位置安全地工作，而无需VPN。参见图7.4以了解设置的可视化。
- en: '![07-04](../../OEBPS/Images/07-04.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![07-04](../../OEBPS/Images/07-04.png)'
- en: Figure 7.4 Regulated application with VPC Service Control, ACM, and ASM
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.4 带有VPC服务控制、ACM和ASM的受监管应用
- en: Enterprises can configure Anthos clusters to read config management from a repository
    hosted on-prem, set up role-based access controls in one location, and have that
    setup propagated through a continuous sync. With the Policy Controller deployed
    with Anthos Config Management, administrators and security teams can define policies
    to restrict the use of unapproved container registries, prevent the creation of
    privileged Pods, and define read-only operating system filesystems. To understand
    how to do this in detail, please refer to chapter 13.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 企业可以将Anthos集群配置为从本地托管的仓库读取配置管理，在一个位置设置基于角色的访问控制，并通过持续同步传播此设置。通过部署Anthos Config
    Management的Policy Controller，管理员和安全团队可以定义策略以限制未经批准的容器注册库的使用，防止创建特权Pod，并定义只读操作系统文件系统。要详细了解如何操作，请参阅第13章。
- en: With Anthos Service Mesh, administrators can enforce mutual TLS communication
    between all Pods as well as define which Pods can communicate with each other—and
    only with each other, nothing more. This restriction prevents unauthorized access
    to sensitive data and prevents data exfiltration in the event a rogue Pod is deployed
    on the system. For a deeper dive into this subject, please refer to chapter 4.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Anthos Service Mesh，管理员可以强制所有Pod之间的相互TLS通信，并定义哪些Pod可以相互通信——而且仅限于彼此，没有其他。这种限制防止了对敏感数据的未授权访问，并在系统上部署了恶意Pod的情况下防止数据泄露。欲深入了解此主题，请参阅第4章。
- en: 7.4.2 Benefits
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.4.2 优势
- en: All the services mentioned in the previous section are built for purpose and
    have security as their highest consideration. For example, if the Anthos Config
    Management is disconnected from the repo, the last synced policies are still in
    effect. All components have also been tested to work with each other, and any
    problems are a quick ticket away from Google Support.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 上一节中提到的所有服务都是为了特定目的而构建的，并将安全性视为其最高考虑因素。例如，如果Anthos Config Management与仓库断开连接，最后同步的策略仍然有效。所有组件也都经过测试，以确保它们可以相互工作，并且任何问题都可以通过Google支持快速解决。
- en: This architecture is also extensible and automatable, so that new on-prem regulated
    clusters can be created, be hooked up to the same ACM and ASM artifacts, and benefit
    from the work already done.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 此架构也具有可扩展性和自动化能力，因此可以创建新的本地监管集群，将其连接到相同的ACM和ASM工件，并从已经完成的工作中受益。
- en: 7.5 Applications that must run on the edge
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7.5 必须在边缘运行的应用程序
- en: Edge devices mean different things for different companies and business use
    cases. For example, a telecom edge use case would refer to computing requirements
    for 5G capabilities. See chapter 8 for a detailed look at how Anthos enables this
    case.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 边缘设备对不同公司和业务用例意味着不同的事情。例如，电信边缘用例将涉及5G能力的计算需求。请参阅第8章，了解Anthos如何实现这一用例的详细情况。
- en: Edge devices can also be used by retailers and remote manufacturing sites, where
    applications can be deployed closer to users to provide a low-latency experience
    while delivering high-performance compute. One example is calculating statistics
    for a baseball game right in the stadium while the game is going on and delivering
    those statistics in real time to commentators and the audience. This was a driving
    force behind Major League Baseball’s decision to use Anthos to process and analyze
    data in the cloud as well as on-prem at each of their ballparks (see [http://mng.bz/Blyq](http://mng.bz/Blyq)).
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 边缘设备还可以由零售商和远程制造站点使用，在这些地方，应用程序可以部署得更靠近用户，以提供低延迟体验，同时提供高性能计算。一个例子是在比赛进行时直接在体育场计算棒球比赛的统计数据，并将这些统计数据实时传递给解说员和观众。这是美国职业棒球大联盟决定在每个棒球场使用Anthos在云中以及本地处理和分析数据背后的驱动力（见[http://mng.bz/Blyq](http://mng.bz/Blyq)）。
- en: These applications must run on edge appliances with low resource requirements
    and without depending on a continuous internet connection. The biggest problem
    relates to deploying the latest versions of your software over the air to these
    edge nodes. Anthos at the edge provides this capability while still giving developers
    the ability to deploy their applications uniformly in a cloud native way and trust
    that their applications will work in the same way as on the cloud due to the conformant
    deployment of Kubernetes.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 这些应用程序必须在资源需求低且不依赖于持续互联网连接的边缘设备上运行。最大的问题与通过空中部署软件的最新版本到这些边缘节点有关。Anthos在边缘提供这种能力，同时仍然允许开发人员以云原生的方式统一部署他们的应用程序，并相信由于Kubernetes的合规部署，他们的应用程序将以与云相同的方式运行。
- en: 7.5.1 Architecture
  id: totrans-74
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.5.1 架构
- en: The architecture shown in figure 7.5 represents retail stores of the future,
    where shoppers can shop without any cashiers. The retailer can still monitor purchases
    securely through video and transact via an application in the store, as well as
    identify hot spots of traffic, identify when to restock goods, and comply with
    privacy regulations while providing a real-time low-latency experience.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.5所示的架构代表了未来的零售商店，顾客可以在没有任何收银员的情况下购物。零售商仍然可以通过视频安全地监控购买，通过商店中的应用程序进行交易，以及识别交通热点，确定何时补货商品，并在提供实时低延迟体验的同时遵守隐私法规。
- en: '![07-05](../../OEBPS/Images/07-05.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![07-05](../../OEBPS/Images/07-05.png)'
- en: Figure 7.5 Anthos at the edge retail architecture
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.5 Anthos边缘零售架构
- en: 'For such a use case, many machine learning models would be used for detection
    of theft, detection of low stocks, recommendations, and determining traffic hot
    spots. Models such as RetailNet can be used for people counting and hot spot detection
    in retail stores, referenced here: [http://mng.bz/dJ9z](http://mng.bz/dJ9z). What
    is required for this setup is a way to continuously train and update the model
    and deploy it reliably on the edge with high performance compute for inference.
    As can be seen in figure 7.5, you can use Anthos on bare metal to deliver just
    that. Streaming video data back to the cloud for inference requires large bandwidth
    and causes a lag, degrading the real-time experience in the store.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 对于此类用例，将使用许多机器学习模型用于盗窃检测、库存不足检测、推荐和确定交通热点。例如，可以使用RetailNet在零售店中进行人数统计和热点检测，参考此处：[http://mng.bz/dJ9z](http://mng.bz/dJ9z)。为此设置所需的是一个可以持续训练和更新模型，并在边缘以高性能计算进行推理的可靠部署方式。如图7.5所示，您可以使用Anthos
    on bare metal来实现这一点。将流媒体视频数据回传到云中进行推理需要大量带宽，并导致延迟，从而降低商店的实时体验。
- en: Aggregated and anonymized data can then be sent back to the cloud, and models
    can be trained via Kubeflow and updated and then deployed on-prem again, creating
    a feedback loop to continuously update and enhance the accuracy of the models.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，可以将汇总和匿名化的数据发送回云中，并通过Kubeflow进行模型训练，然后更新并在本地再次部署，创建一个反馈循环，以持续更新和增强模型的准确性。
- en: 7.5.2 Benefits
  id: totrans-80
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.5.2 优势
- en: One key benefit is the improved performance of applications on the edge due
    to the direct application access to hardware and skipping the cost of a virtual
    machine license. Anthos on edge 1.9+ can also use a private registry mirror instead
    of gcr.io to pull container images so it can run completely air-gapped from the
    internet.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 一个关键的好处是由于直接访问硬件并跳过虚拟机许可证的成本，边缘应用程序的性能得到了提升。Anthos on edge 1.9+还可以使用私有镜像库而不是gcr.io来拉取容器镜像，这样它就可以完全断网运行。
- en: 7.5.3 Limitations
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.5.3 限制
- en: Without a virtualization layer, node scaling requires you to install new hardware
    nodes and connect them to the fleet of bare metal devices.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 没有虚拟化层，节点扩展需要您安装新的硬件节点并将它们连接到裸金属设备的集群。
- en: Summary
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: The different Google Cloud and Anthos services play an important role in the
    different use cases of high availability, geographical spread, regulated industries,
    and edge computing. Many enterprises need these different use cases to enrich
    their digital offerings and can use the prescribed architectures to do this.
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不同的Google Cloud和Anthos服务在可用性、地理分布、受监管行业和边缘计算的不同用例中发挥着重要作用。许多企业需要这些不同的用例来丰富他们的数字产品，并可以使用规定的架构来实现这一点。
- en: With Anthos, companies can standardize on Kubernetes with one unified pattern
    of deployment, scaling, security, and development and maintain the ability to
    move workloads across regions and availability zones.
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Anthos，公司可以采用统一的部署、扩展、安全和开发模式来标准化Kubernetes，并保持跨区域和可用区迁移工作负载的能力。
- en: Solutions such as Workload Identity can be deployed across multiple and hybrid
    clouds to provide a unified authentication framework.
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 像工作负载身份这样的解决方案可以部署在多个和混合云中，以提供统一的身份验证框架。
- en: Ingress for Anthos allows you to create load balancers to route traffic to clusters
    from points of presence, which allows the deployment of features in a standardized
    way globally, with accessibility to users with low latency.
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Anthos Ingress允许您创建负载均衡器，将流量从存在点路由到集群，这允许以标准化的方式在全球范围内部署功能，并使用户能够以低延迟访问。
- en: The Traffic Director allows the use of Google Cloud load balancers to front
    hybrid applications and use cloud native services, which are part of the service
    mesh.
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Traffic Director允许使用Google Cloud负载均衡器作为混合应用程序的前端，并使用服务网格的一部分云原生服务。
- en: VPC Service Controls enable administrators to restrict access to certain Google
    Cloud APIs to specific IP addresses, identities, and client services.
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VPC服务控制允许管理员限制对特定Google Cloud API的访问，仅限于特定的IP地址、身份和客户端服务。
- en: Anthos on the edge improves performance of applications via direct application
    access to hardware, thus bypassing the cost of a virtual machine license.
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Anthos on the edge通过直接应用访问硬件来提高应用程序的性能，从而绕过虚拟机许可证的成本。
- en: '* * *'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '***'
- en: ^(1.)See chapter 2 for the definition of a fleet.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: ^（1.）请参阅第2章以了解舰队的定义。
