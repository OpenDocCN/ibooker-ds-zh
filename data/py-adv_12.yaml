- en: '12 Database: We need good storage'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 12 数据库：我们需要良好的存储
- en: In this chapter
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章内容
- en: Simon proposes a separate folder for the application
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 西蒙建议为应用程序创建一个单独的文件夹
- en: Erik and Emily move the application files to the new folder structure
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 埃里克和艾米丽将应用程序文件移动到新的文件夹结构
- en: Erik reuses the functions for reading text files
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 埃里克重用了读取文本文件的函数
- en: Erik and Emily learn about databases
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 埃里克和艾米丽学习数据库
- en: Simon helps Emily and Erik change the application to use a database
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 西蒙帮助艾米丽和埃里克将应用程序改为使用数据库
- en: “Let’s make our project a bit more serious,” Simon said when the friends met
    the next time.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: “让我们让我们的项目更正式一些，”西蒙在朋友们下次见面时说。
- en: “Yesterday, you said something about a database,” Erik said. “Is that what you
    mean?”
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: “昨天，你提到了数据库的事情，”埃里克说，“你是这个意思吗？”
- en: “Yes, that too,” Simon answered. “But first, I suggest we make changes in our
    folder structure. Let’s organize our files. Look at our files and folders.”
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，也包括这个，”西蒙回答，“但首先，我建议我们修改文件夹结构。让我们整理一下我们的文件。看看我们的文件和文件夹。”
- en: He took a piece of paper and started drawing and explaining.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 他拿了一张纸，开始画图并解释。
- en: “When we started with the Mu editor, it placed all our programs in its default
    folder, which is `mu_code`. Then we discovered that it also has all the necessary
    templates for web applications under the `templates` folder inside `mu_code`.
    If you look at it in the file manager—Finder on macOS or Explorer on Windows—you’ll
    see that it also has more folders, such as `static`, `images`, `fonts`, and so
    on. Remember, we already created a couple of templates ourselves, `order.html`
    and `print.html`, and we placed them under `templates`. If you look into the `static`
    folder, you’ll find the `css` folder—I think you, Emily, know that it’s for style
    sheets—and there are a couple of files there.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: “当我们开始使用Mu编辑器时，它把所有的程序都放在了它的默认文件夹中，即`mu_code`。然后我们发现它还在`mu_code`文件夹内的`templates`文件夹下提供了所有必要的网络应用程序模板。如果你在文件管理器中查看——macOS上的Finder或Windows上的资源管理器——你会发现它还有更多的文件夹，比如`static`、`images`、`fonts`等等。记住，我们已经自己创建了一些模板，`order.html`和`print.html`，并将它们放在了`templates`下。如果你查看`static`文件夹，你会找到`css`文件夹——我想你知道它是用于样式表的——那里有几个文件。
- en: '![](../Images/12-01-orig-dir-structure.png)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![原始目录结构](../Images/12-01-orig-dir-structure.png)'
- en: “You see, our application has several files in different folders. I suggest
    we create our own folder for the Coffee Shop application and copy all the files
    we need into that folder. That will also help us separate our web-based Coffee
    Shop application from our previous version. It’s always a good practice to keep
    your different projects in separate folders.”
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: “你看，我们的应用程序在不同的文件夹中有几个文件。我建议我们为咖啡店应用程序创建一个自己的文件夹，并将所有需要的文件复制到这个文件夹中。这也有助于我们将基于网络的咖啡店应用程序与我们之前的版本分开。将不同的项目保存在不同的文件夹中始终是一个好的做法。”
- en: Simon continued, “Let’s create a folder for all our projects—including future
    projects. Usually, I name it `Projects`, similar to the `Downloads`, `Pictures`,
    and `Documents` folders that we already have. Under `Projects`, we’ll create another
    folder and call it `coffeeshop`. We’ll move all the files related to our web-based
    coffee shop project to it. I also suggest renaming `first_app.py` to just `app.py`.
    That’s what people usually call their Flask applications. Let me show you what
    I mean.” Simon added another diagram to the one he created before.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 西蒙继续说，“让我们为所有我们的项目创建一个文件夹——包括未来的项目。通常，我把它命名为`Projects`，类似于我们已有的`Downloads`、`Pictures`和`Documents`文件夹。在`Projects`下，我们将创建另一个文件夹，命名为`coffeeshop`。我们将把所有与我们的基于网络的咖啡店项目相关的文件移动到它里面。我还建议将`first_app.py`重命名为`app.py`。这就是人们通常称呼他们的Flask应用程序的方式。让我给你展示一下我的意思。”西蒙在他之前创建的图表上添加了另一个图表。
- en: '![](../Images/12-02-new-dir-structure.png)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![新的目录结构](../Images/12-02-new-dir-structure.png)'
- en: “Do you know how to do it?” Simon asked Emily and Erik.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: “你知道怎么操作吗？”西蒙问艾米丽和埃里克。
- en: “Yes,” Emily said. They started working on creating folders and moving files.
    After a while, they showed Simon their `coffeeshop` project folder.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，”艾米丽说。他们开始创建文件夹并移动文件。过了一会儿，他们向西蒙展示了他们的`coffeeshop`项目文件夹。
- en: “Does this look good?” Erik asked.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: “这看起来怎么样？”埃里克问道。
- en: '*Your Turn!* Create your application folder'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '*轮到你了!* 创建你的应用程序文件夹'
- en: Create a folder for your projects (you can use the name `Projects` or some other
    name). Create another folder for your application. Name it according to your application—it
    could be `icecream` or `pizzaplace`. Move the files related to the web application
    from `mu_code` to this new folder.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 为你的项目创建一个文件夹（你可以使用`Projects`或其他名称）。为你的应用程序创建另一个文件夹。根据你的应用程序命名它——可以是`icecream`或`pizzaplace`。将与网络应用程序相关的文件从`mu_code`移动到这个新文件夹中。
- en: '![](../Images/12-03-new-dir-finder.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/12-03-new-dir-finder.png)'
- en: “Let me see,” Simon said, looking at their folder. “You moved your `static`
    directory, with all its content, and your `templates` directory, good. You even
    moved `fonts` and `images`—we don’t use them now, but that’s okay.”
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: “让我看看，”西蒙看着他们的文件夹说，“你把包含所有内容的`static`目录和`templates`目录都移动了，很好。你甚至把`fonts`和`images`也移动了——我们现在不用它们，但没关系。”
- en: “I have a question,” Erik said. “Why do you sometimes say ‘directories’ and
    sometimes ‘folders’? I guess they mean the same, right?”
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: “我有个问题，”艾瑞克说，“你为什么有时说‘目录’有时说‘文件夹’？我想它们的意思是一样的，对吧？”
- en: '“Sorry, I don’t follow strict terminology,” Simon said. “You’re right, those
    two words mean the same thing: something that holds files. They are used to organize
    files that belong to a certain project, like `coffeeshop`; or they’re used for
    files of a certain type, like `templates`. Historically, in Unix and Linux systems,
    they are called directories. MacOS is based on Unix, and, in my robotics club,
    we use Linux, so I’m used to calling them directories. In Windows, they’re called
    folders—it’s exactly the same thing. Just get used to the different terms, it’s
    not a big deal.”'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: “抱歉，我并不严格遵守术语，”西蒙说，“你说得对，这两个词的意思是相同的：用来存放文件的东西。它们用于组织属于某个项目的文件，比如`coffeeshop`；或者用于特定类型的文件，比如`templates`。从历史上看，在Unix和Linux系统中，它们被称为目录。MacOS基于Unix，在我的机器人俱乐部里，我们使用Linux，所以我习惯于称它们为目录。在Windows中，它们被称为文件夹——这完全一样。只需习惯不同的术语，这没什么大不了的。”
- en: “Also, yesterday you said that we can keep our menus in text files, like we
    did in our previous version,” Erik said. “For the shop manager who doesn’t know
    HTML, remember?”
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: “还有，昨天你说我们可以把菜单保存在文本文件里，就像我们之前的版本一样，”艾瑞克说，“为了那些不知道HTML的商店经理记住？”
- en: “Thanks for reminding me, Erik,” Simon said. “I’m going to show you how to work
    with a database today. But it’s a serious subject. Let’s warm up with these menu
    files first. Can you copy them to your new directory from `mu_code`?”
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: “谢谢提醒我，艾瑞克，”西蒙说，“我今天要给你展示如何使用数据库。但这是一个严肃的主题。我们先从这些菜单文件开始热身吧。你能把它们从`mu_code`复制到你的新目录里吗？”
- en: “Yes, just a second,” Erik said. He copied the files `drinks.txt`, `flavors.txt`,
    and `toppings.txt` to the `coffeeshop` project folder.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，稍等一下，”艾瑞克说。他将`drinks.txt`、`flavors.txt`和`toppings.txt`文件复制到了`coffeeshop`项目文件夹中。
- en: '*Your Turn!* Move the menu files'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '*轮到你了!* 移动菜单文件'
- en: Move the menu files to the new folder you just created.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 将菜单文件移动到您刚刚创建的新文件夹中。
- en: “Now take a look at our old program and see how we worked with these files,”
    Simon said. “Open the `menu_files.py` file and refresh your memory. Try to explain
    it to Emily—that’s the best way to understand something better.”
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: “现在看看我们的旧程序，看看我们是如何处理这些文件的，”西蒙说，“打开`menu_files.py`文件，刷新一下你的记忆。试着向艾米丽解释一下——这是更好地理解事物的最佳方式。”
- en: “Yes, I’d love to learn what you did with this program before,” Emily said.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，我很想了解你之前对这个程序做了什么，”艾米丽说。
- en: Erik looked at the code and started explaining, “We created a function called
    `read_menu()` that would read a text file with drinks, flavors, or toppings, and
    create a list of menu choices. We passed that list to the `menu()` function. The
    `menu()` function printed the list and asked the customer to choose the drink,
    then the flavor, then the topping. After all that, we printed the order.”
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 艾瑞克看着代码，开始解释，“我们创建了一个名为`read_menu()`的函数，它会读取包含饮料、口味或配料文本文件的列表，并创建一个菜单选择列表。我们将这个列表传递给`menu()`函数。`menu()`函数打印列表，并要求顾客选择饮料，然后是口味，然后是配料。所有这些完成后，我们打印出订单。”
- en: 'Listing 12\. 1 `menu_files.py`: Read menu items from files'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '列表 12\. 1 `menu_files.py`: 从文件中读取菜单项'
- en: '[PRE0]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: “I see,” Emily said. “What is a *list*? Is it like an *array* in JavaScript?”
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: “我明白了，”艾米丽说，“什么是*列表*？它像JavaScript中的*数组*吗？”
- en: '“Yes, exactly,” Simon confirmed. “It’s the same thing: a collection of items
    placed in order. It’s called different names in different programming languages,
    but it’s the same thing. The most important thing is that you can pick items by
    their position in the list: like item number three or item number five. These
    numbers are called the *indices* of the list.”'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，完全正确，”西蒙确认道，“这和之前一样：按顺序排列的一组项目。在不同的编程语言中，它有不同的名称，但本质上是相同的。最重要的是，你可以通过列表中的位置来选择项目：比如第三项或第五项。这些数字被称为列表的*索引*。”
- en: “Can we use this function again?” Erik asked.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: “我们可以再次使用这个函数吗？”艾瑞克问道。
- en: “Of course!” Simon said. “This is what functions are created for—to reuse! Let’s
    copy this `read_menu()` function to our new `app.py` file. Place it right after
    the `load_orders()` function. Also, copy the three function calls that go right
    after the function. We need to create these lists here too.”
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: “当然！” 西蒙说。“这就是函数被创建的原因——为了重用！让我们将这个 `read_menu()` 函数复制到我们的新 `app.py` 文件中。将其放在
    `load_orders()` 函数之后。还要复制紧随函数之后的三次函数调用。我们在这里也需要创建这些列表。”
- en: Erik copied the `read_menu()` function and the three lines after it from `menu_
    files.py` to `app.py` in the `coffeeshop` directory.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 埃里克将 `menu_ files.py` 中的 `read_menu()` 函数及其后面的三行代码从 `coffeeshop` 目录的 `app.py`
    中复制过来。
- en: '“Now we have the lists of menu choices from these three files: `drinks.txt`,
    `flavors.txt`, and `toppings.txt`. We have to display the choices on our order
    page. The good thing is that our `order.html` file is not a plain HTML file, but
    a *template*. We can use *variables* in the template and pass the *values* that
    we want to display. Remember, we did this in the `print.html` template when we
    passed the `new_order` dictionary. Let me remind you. Here is the Python code
    for that in `app.py`:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: “现在我们有这三个文件的菜单选择列表：`drinks.txt`、`flavors.txt` 和 `toppings.txt`。我们必须在我们的订单页面上显示这些选择。好事是，我们的
    `order.html` 文件不是一个普通的HTML文件，而是一个 *模板*。我们可以在模板中使用 *变量* 并传递我们想要显示的 *值*。记住，我们在 `print.html`
    模板中就是这样做的，当时我们传递了 `new_order` 字典。让我提醒你。这是 `app.py` 中的Python代码：
- en: '[PRE1]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: “And here is the part of the `order.html` template that uses the `new_order`
    dictionary,” Simon continued.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: “这里是 `order.html` 模板中使用 `new_order` 字典的部分，” 西蒙继续说。
- en: '[PRE2]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: “Now we should use the `order.html` template and pass the lists with choices
    to it. In the template, we’ll use them to build the menus. Find the `render_template()`
    function call that uses the `order.html` template and pass these three lists the
    same way you passed the `new_order` dictionary a couple of lines above.”
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: “现在我们应该使用 `order.html` 模板，并将带有选择的列表传递给它。在模板中，我们将使用它们来构建菜单。找到使用 `order.html`
    模板的 `render_template()` 函数调用，并以与上面几行传递 `new_order` 字典相同的方式传递这三个列表。”
- en: 'Erik found that line (it was the last line of the program) and changed it to
    this:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 埃里克找到了那行代码（它是程序的最后一行）并将其更改为以下内容：
- en: '[PRE3]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: “Good,” Simon said. “Now, after we have passed the lists to the template, we
    have to change the template. Emily, you’ll be surprised. It won’t look like plain
    HTML. We’ll use *loops* in the template.”
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: “好，” 西蒙说。“现在，在我们将列表传递给模板之后，我们必须更改模板。艾米丽，你会感到惊讶的。它不会看起来像普通的HTML。我们将在模板中使用 *循环*。”
- en: “Like in Python?” Erik said.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: “像在Python中一样吗？” 埃里克说。
- en: “Yes, they look much the same, and they work similarly,” Simon said. “Instead
    of printing the options in our `select` menu as strings, we’ll take them from
    the list. Our loops will look like `for d in drinks`—much like what you did in
    your `menu()` function. I think that’s because the template language was created
    by the same person who created Flask—Armin Ronacher. So it’s very close to Python,
    as you can imagine. The template language, by the way, is called *Jinja*—yes,
    like ninja.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，它们看起来非常相似，并且工作方式也类似，” 西蒙说。“我们不会将选项作为字符串打印到我们的 `select` 菜单中，而是从列表中获取它们。我们的循环将看起来像
    `for d in drinks`——就像你在你的 `menu()` 函数中所做的那样。我想这是因为模板语言是由创建Flask的同一人创建的——Armin
    Ronacher。所以它非常接近Python，就像你可以想象的那样。顺便说一句，模板语言被称为 *Jinja*——是的，就像忍者。
- en: “Let me help you with the `order.html` template,” Simon continued. “I collected
    some examples, so I’ll use them here.”
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: “让我帮你处理 `order.html` 模板，” 西蒙继续说。“我收集了一些示例，所以我会在这里使用它们。”
- en: “So you don’t know *everything* yourself?” Erik winked at his brother.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: “所以你自己并不了解 *所有* 东西？” 埃里克对他的兄弟眨了眨眼。
- en: “Of course not,” Simon answered seriously. “I’m learning, myself. When I need
    something, I search the internet for examples and documentation, and I use them.
    Luckily, the Flask and Jinja documentation is well written and very helpful. Also,
    there are plenty of examples and tutorials that people have shared:”
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: “当然不是，” 西蒙严肃地回答。“我自己也在学习。当我需要什么的时候，我会上网搜索示例和文档，并使用它们。幸运的是，Flask和Jinja文档写得很好，非常有帮助。此外，还有很多人分享的示例和教程：”
- en: 'Simon changed the `templates/order.html` file to the following:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 西蒙将 `templates/order.html` 文件更改为以下内容：
- en: 'Listing 12\. 2 `order.html`: Use menu lists to display menu items in the template'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 12.2 `order.html`：在模板中使用菜单列表显示菜单项
- en: '[PRE4]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: ❶ Instruction option
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 指令选项
- en: ❷ A for loop includes options from the list in the menu.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 一个for循环包括菜单中的选项。
- en: '*Your Turn!* Change `order.html`'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '*轮到你了!* 修改 `order.html`'
- en: Change your `templates/order.html` template the same way. Be careful when copying
    the text—note that we use *double* curly braces in templates. Don’t forget all
    the dashes and percent signs.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 以相同的方式更改你的`templates/order.html`模板。复制文本时要小心——注意我们在模板中使用的是*双*花括号。不要忘记所有的破折号和百分号。
- en: They tested the page, and it worked the same way as before. Simon suggested,
    “Emily, try adding something to one of the menu text files, and let’s see if the
    page is updated.”
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 他们测试了页面，它和以前一样工作。西蒙建议，“艾米丽，试着在其中一个菜单文本文件中添加一些内容，看看页面是否更新。”
- en: Emily opened the `toppings.txt` file and added `vanilla powder` at the end of
    the file. She saved the file and restarted the application. Indeed, they saw the
    new topping item in the menu.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 艾米丽打开了`toppings.txt`文件，在文件末尾添加了`vanilla powder`。她保存了文件并重新启动了应用程序。果然，他们在菜单中看到了新的配料项目。
- en: '![](../Images/12-04-new-topping.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/12-04-new-topping.png)'
- en: '*Your Turn!* Test your page'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '*轮到你了!* 测试你的页面'
- en: Test your page with the new template. Does it look the same as before? Add a
    new item to one of the files with a text editor. Test the menus again and check
    if the new item is displayed.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 使用新的模板测试你的页面。它看起来和以前一样吗？使用文本编辑器在其中一个文件中添加一个新项目。再次测试菜单，并检查新项目是否显示。
- en: “Simon, I see that you added that `capitalize` word in the template,” she said,
    “and now it shows `Vanilla powder` with a capital ‘V’. Pretty cool!”
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: “西蒙，我看到你在模板中添加了那个`capitalize`单词，”她说，“现在它显示的是`Vanilla powder`，首字母大写的‘V’。真酷！”
- en: “Yes,” Simon said, “there are a lot of interesting things you can do with templates.
    That’s just one of them. We can use something else later, if you want. But now
    we’re going to learn about databases!
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，”西蒙说，“你可以用模板做很多有趣的事情。这只是其中之一。如果你想的话，我们稍后可以学习其他内容。但现在我们将学习数据库！
- en: “Do you know why we need databases?” Simon asked. “We used a JSON file to store
    our orders, and it worked pretty well, right? But imagine that we want to find
    all orders with vanilla flavor in our list of orders, for example. Or all orders
    from all customers whose name is Alex. Or find out if we used more peppermint
    flavor this month or in the previous one. We could write such functions ourselves,
    right? But it turns out that questions like these are so common that people long
    ago started creating special programs that not only store data like orders and
    customers, but that can also answer such questions. These questions are usually
    called *queries* in the database world. Many years ago, some smart people created
    a language called *Structured Query Language*, or *SQL* for short. People usually
    pronounce it *sequel*.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: “你知道为什么我们需要数据库吗？”西蒙问，“我们使用JSON文件来存储我们的订单，它工作得相当不错，对吧？但想象一下，如果我们想在订单列表中找到所有香草口味的订单，或者所有名为Alex的客户的所有订单。或者找出这个月我们是否比上个月使用了更多的薄荷味。我们自己可以编写这样的函数，对吧？但结果是，像这样的问题非常常见，很久以前人们就开始创建特殊的程序，这些程序不仅存储像订单和客户这样的数据，而且还可以回答这样的问题。这些问题通常在数据库世界中被称为*查询*。多年前，一些聪明的人创造了一种名为*结构化查询语言*的语言，简称*SQL*。人们通常读作*sequel*。
- en: “We’re not going to learn SQL today,” Simon continued, “but the reason I’m telling
    you this is that we’re going to use a database called SQLite—call it *sequelight*
    if you want.”
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: “我们今天不会学习SQL，”西蒙继续说，“但我告诉你这个的原因是我们将使用一个名为SQLite的数据库——如果你想的话，可以称之为*sequelight*。”
- en: “Are we going to use the database instead of a JSON file to load and store orders?”
    Erik asked.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: “我们是不是要用数据库而不是JSON文件来加载和存储订单？”艾瑞克问。
- en: “Yes,” Simon answered, “but we don’t have to load orders anymore. Remember,
    we had to load orders into a list to be able to add new orders to that list and
    to save that list in a JSON file when we were done? Now the database will keep
    all our orders in its own file. The database knows how to add a new record to
    the list of orders, so we don’t have to worry about that.”
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，”西蒙回答，“但我们不再需要加载订单了。记住，我们当时必须将订单加载到列表中，以便能够向该列表添加新订单，并在完成后将列表保存到JSON文件中？现在数据库会将其所有订单保存在自己的文件中。数据库知道如何将新记录添加到订单列表中，所以我们不必担心这一点。”
- en: “I like it,” Erik said. “What should we do now?”
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: “我喜欢，”艾瑞克说，“我们现在该做什么？”
- en: Simon started drawing a diagram. “We’ll use a database file called `orders.db`.
    We don’t need the `load_orders()` function anymore.” He crossed it out with a
    red marker.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 西蒙开始画图。“我们将使用一个名为`orders.db`的数据库文件。我们不再需要`load_orders()`函数。”他用红笔划掉了它。
- en: “We don’t need the list of orders—the database will keep that for us. We’ll
    also rewrite our `save_orders()` function. We don’t have to save *all* the orders
    in the file each time we have a new order. We’ll just save the new order in the
    database—all previous orders will already be there. I suggest renaming the function
    to `save_order()`.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: “我们不需要订单列表——数据库会为我们保存。我们还将重写我们的`save_orders()`函数。每次我们有一个新订单时，我们不需要在文件中保存*所有*订单。我们只需将新订单保存在数据库中——所有之前的订单已经在那里了。我建议将函数重命名为`save_order()`。”
- en: “Look at the diagram and see the difference between our old way of using a JSON
    file and the new way with a database.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: “看看这个图，看看我们以前使用JSON文件的老方法和新方法使用数据库之间的区别。”
- en: '![](../Images/12-05-file-vs-database.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![文件与数据库对比图](../Images/12-05-file-vs-database.png)'
- en: “Each time we want to save a new order, we create a *connection* to the database.
    Then we issue a special command to *insert* our new order into the database. After
    that, we call a special `commit()` function to make sure our order is saved in
    the database.”
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: “每次我们想要保存一个新订单时，我们都会创建一个*连接*到数据库。然后我们发出一个特殊的命令来*插入*我们的新订单到数据库中。之后，我们调用一个特殊的`commit()`函数来确保我们的订单已保存在数据库中。”
- en: “It’s like what we did with the file,” Erik said.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: “就像我们处理文件时做的那样，”埃里克说。
- en: “Yes, pretty similar,” Simon agreed. “The difference is that now we talk to
    the database, not to the file. We’re working on a very simple program, but what
    if we had more than one barista who accepts orders in our coffee shop? If several
    people start writing to the same file at the same time, it creates a lot of problems.
    When we work with a database, the database takes care of that. Even better, if
    you learn how to work with SQLite using the SQL language, you can also use that
    language with many other databases. They will understand SQL just fine.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，非常相似，”西蒙同意。“区别在于现在我们与数据库交流，而不是与文件交流。我们正在开发一个非常简单的程序，但如果我们咖啡店有不止一个咖啡师接受订单呢？如果几个人同时向同一个文件写入，会引发很多问题。当我们与数据库一起工作时，数据库会处理这些问题。更好的是，如果你学会了如何使用SQL语言与SQLite一起工作，你还可以使用该语言与许多其他数据库一起工作。它们会很好地理解SQL。
- en: '“Enough theory, let’s write some code,” Simon said. “First of all, we should
    create a *table* in our database. In our case, the table is pretty simple—it contains
    the customer’s name and our usual options: drink, flavor, and topping.”'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: “理论够多了，让我们写一些代码吧，”西蒙说。“首先，我们应该在我们的数据库中创建一个*表*。在我们的例子中，这个表非常简单——它包含顾客的姓名和我们常用的选项：饮料、口味和配料。”
- en: He started editing the `app.py` file and explaining. “I added the `import sqlite3`
    line at the beginning. Then I removed the `orders = load_orders()` function call
    and the whole `load_orders()` function. Just before the `app = Flask()` line,
    I added three lines that make a connection to the database and create the table
    called `orders`.”
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 他开始编辑`app.py`文件并解释。“我在开头添加了`import sqlite3`行。然后我移除了`orders = load_orders()`函数调用和整个`load_orders()`函数。在`app
    = Flask()`行之前，我添加了三条使数据库建立连接并创建名为`orders`的表的语句。”
- en: '[PRE5]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: ❶ Imports the sqlite3 package
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 导入sqlite3包
- en: ❷ Connects to the database
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 连接到数据库
- en: ❸ Creates the orders table
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 创建订单表
- en: '*Your Turn!* Add commands to connect to a database and create a table'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '*轮到你了!* 添加命令以连接到数据库并创建一个表'
- en: Change your `app.py` file and add the three lines like Simon did. Don’t forget
    to add `import sqlite3` at the very beginning of your `app.py` file.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 修改你的`app.py`文件并添加西蒙所做的三条语句。别忘了在你的`app.py`文件开头添加`import sqlite3`。
- en: “What is `cur`?” Emily asked.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: “`cur`是什么？”艾米丽问。
- en: “It’s called a *cursor* in the database world. Like your mouse cursor, it can
    point to a specific place in a database. We’re not going to go into the details—in
    this case, I’m following the examples from the official Python documentation.
    The documentation says we need this cursor to execute SQL commands in the database.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: “在数据库领域，这被称为*游标*。就像你的鼠标游标一样，它可以指向数据库中的特定位置。我们不会深入细节——在这种情况下，我正在遵循官方Python文档中的示例。文档说我们需要这个游标来在数据库中执行SQL命令。
- en: “Look at the next line with `cur.execute()`. This is our first SQL instruction.
    It creates a table called `orders` with *columns* named `name`, `drink`, `flavor`,
    and `topping`. In databases, tables are just normal tables with rows and columns.
    Each new order is a new row in the table. In each row, we have four columns with
    names that I mentioned already. Easy, huh?” He drew a simple table.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: “看看下一行中的`cur.execute()`。这是我们第一个SQL指令。它创建了一个名为`orders`的表，其中包含名为`name`、`drink`、`flavor`和`topping`的*列*。在数据库中，表只是带有行和列的正常表格。每个新订单都是表中的一个新行。在每一行中，我们都有四个列，列名就是我刚才提到的。简单，对吧？”他画了一个简单的表格。
- en: '![](../Images/12-06-database-table.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/12-06-database-table.png)'
- en: “Now let’s rewrite the `save_orders()` function. First, we’ll rename it to `save_order()`
    because we’re going to save just one order at a time. Then, we’ll repeat the two
    lines I wrote earlier to create a connection and create a cursor. After that,
    we can execute the SQL command. In this case, we’ll use the `INSERT` command and
    pass the values from the `order[]` dictionary. Finally, we’ll call the `commit()`
    function to save the new order in the database.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: “现在让我们重写 `save_orders()` 函数。首先，我们将将其重命名为 `save_order()`，因为我们一次只保存一个订单。然后，我们将重复我之前写的两行来创建连接和创建游标。之后，我们可以执行
    SQL 命令。在这种情况下，我们将使用 `INSERT` 命令并传递来自 `order[]` 字典的值。最后，我们将调用 `commit()` 函数以将新订单保存到数据库中。”
- en: 'Listing 12\. 3 `app.py`: Add orders to the table'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '列表 12.3 `app.py`: 向表中添加订单'
- en: '[PRE6]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '*Your Turn!* Create a `save_order()` function'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '*你的回合！* 创建一个 `save_order()` 函数'
- en: Copy the `save_order()` function to your program. Pay attention to quotes, square
    brackets, commas, and parentheses.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 将 `save_order()` 函数复制到你的程序中。注意引号、方括号、逗号和括号。
- en: “I know, it looks complicated, but if you just read it, it’s pretty easy to
    understand. You tell the database to `INSERT` some `VALUES` into the `orders`
    database. Then you list those values in parentheses. You’re already familiar with
    dictionaries, and you know how to pull a *value* for a certain *key*.”
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: “我知道，看起来很复杂，但如果你只是阅读它，理解起来相当简单。你告诉数据库将一些 `VALUES` 插入到 `orders` 数据库中。然后你在括号中列出这些值。你已经熟悉字典了，也知道如何为某个特定的
    `key` 提取 `value`。”
- en: “Why did you write some words in all caps?” Erik asked.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: “你为什么要把一些词写成大写？”埃里克问道。
- en: “It’s a convention in SQL. People use all caps for SQL commands and keywords,
    like `INSERT` and `INTO`. For variables, like the table name `orders`, people
    use lowercase letters. I tried using lowercase for commands too and it worked.
    So the capitals are just a readability convention to separate SQL words from variables.”
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: “这是 SQL 中的一个约定。人们使用大写字母来表示 SQL 命令和关键字，如 `INSERT` 和 `INTO`。对于变量，如表名 `orders`，人们使用小写字母。我尝试使用小写字母来表示命令，也成功了。所以大写字母只是一个可读性约定，用于将
    SQL 词汇与变量区分开来。”
- en: “Let’s try it!” Emily said.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: “让我们试试！”埃米莉说。
- en: “Wait!” Simon said. “I almost forgot—we should remove the `load_orders()` call
    from the `order()` function. And we should rename the save function too.”
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: “等等！”西蒙说。“我差点忘了——我们应该从 `order()` 函数中删除 `load_orders()` 调用。我们也应该重命名保存函数。”
- en: 'He edited the `order()` function so it looked like this:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 他编辑了 `order()` 函数，使其看起来像这样：
- en: 'Listing 12\. 4 `app.py`: Remove `load_orders()`'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '列表 12.4 `app.py`: 删除 `load_orders()`'
- en: '[PRE7]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '*Your Turn!* Edit your `order()` function'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '*你的回合！* 编辑你的 `order()` 函数'
- en: Edit your `order()` function the same way Simon did. Don’t forget to change
    `save _orders()` (plural) to `save_order()` (singular).
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 按照西蒙的方式编辑你的 `order()` 函数。别忘了将 `save _orders()`（复数）改为 `save_order()`（单数）。
- en: He saved the file and said, “Ready now. Emily, run it! But let me fill the order,
    okay?”
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 他保存了文件，说：“现在准备好了。埃米莉，运行它！但让我先填写订单，好吗？”
- en: Emily clicked Run and reloaded the order page. Simon entered the menu choices.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 埃米莉点击了运行并重新加载订单页面。西蒙输入了菜单选项。
- en: '*Your Turn!* Test it'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '*你的回合！* 测试它'
- en: Test your program. Now it uses a database instead of a JSON file, but the interface
    should look the same.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 测试你的程序。现在它使用数据库而不是 JSON 文件，但界面应该相同。
- en: '![](../Images/12-07-simons-order.png)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/12-07-simons-order.png)'
- en: “It works!” Simon said, with a sigh of relief. He wasn’t sure himself that he’d
    done everything right, and he didn’t want to show that.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: “成功了！”西蒙如释重负地说。他自己也不确定是否做对了所有的事情，而且他不想表现出来。
- en: “Can we check if the order was saved in the database, like we did with the JSON
    file?” Erik asked.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: “我们能检查订单是否已保存到数据库中，就像我们处理 JSON 文件那样吗？”埃里克问道。
- en: “Good question!” Simon said. “No, the database file is not a text file that
    we can read. But we can do better. We can create a new function that will show
    us all the orders on the web page.”
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: “好问题！”西蒙说。“不，数据库文件不是一个我们可以读取的文本文件。但我们能做得更好。我们可以创建一个新的函数，它将显示网页上的所有订单。”
- en: “That would be great!” Erik said. “For example, if a shop manager wants to see
    how many portions of caramel we have used today.”
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: “那太好了！”埃里克说。“例如，如果一位商店经理想看看今天我们使用了多少份焦糖。”
- en: “And we could see what a particular customer likes to order,” Emily added.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: “而且我们可以看到某个特定客户喜欢订购什么，”埃米莉补充道。
- en: “Great ideas,” Simon said. “Are you ready to work a little more? We’ll need
    three things. First, remember that to open the order page, we add `/order` to
    the site address. In Flask, that’s called a *route*. We should create a function
    for a new route that we can use to list the orders.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: “好主意，”西蒙说。“你准备好工作得更深入一些了吗？我们需要三样东西。首先，记住为了打开订单页面，我们在网站地址中添加`/order`。在Flask中，这被称为*路由*。我们应该为一个新的路由创建一个函数，我们可以使用它来列出订单。
- en: “Let’s call this route `/list`. The function for this route will also be called
    `list()`. It’s very similar to the `order()` function. At the end of this `list()`
    function, we’ll also call the `render_template()` function to display the list
    of orders.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: “让我们称这个路由为`/list`。这个路由的函数也将被称为`list()`。它与`order()`函数非常相似。在这个`list()`函数的末尾，我们也将调用`render_template()`函数来显示订单列表。
- en: “Second,” he continued, “we’ll create a function that will talk to the database
    and return the list of orders to the `list()` function. Let’s call it `get_orders()`.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: “其次，”他继续说，“我们将创建一个函数，它将与数据库通信并将订单列表返回给`list()`函数。让我们称它为`get_orders()`。
- en: “And third, we should create a template to display the orders. Emily, did you
    learn how to create tables in HTML?”
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: “第三，我们应该创建一个模板来显示订单。艾米丽，你学过如何在HTML中创建表格吗？”
- en: “Tables? Yes, I can do that,” Emily said. “We should use the `<table>` tag to
    create a table, then the `<tr>` tag for each row, and the `<td>` tag for each
    cell in the row.”
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: “表格？是的，我能做到，”艾米丽说。“我们应该使用`<table>`标签来创建表格，然后为每一行使用`<tr>`标签，为每一行中的每个单元格使用`<td>`标签。”
- en: “Great!” Simon said. “Then you’ll create the template for our `list()` function.
    Erik, you write the functions, okay?”
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: “太好了！”西蒙说。“那么你将为我们创建`list()`函数的模板。埃里克，你写函数，好吗？”
- en: “Sure,” Erik said. “Where should I start?”
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: “当然，”埃里克说。“我应该从哪里开始？”
- en: '“Right after the `save_order()` function. Create a function called `get_orders()`.
    Start with the same first line as in the `save_order()` function. Add one more
    line after it: `con.row_factory = sqlite3.Row`. It’s a special instruction that
    allows us to use column names when working with the result. Don’t worry about
    it now—you’ll see it later. Then, create a cursor with the same line as before:
    `cur = con.cursor()`. Let me see your code.”'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: “在`save_order()`函数之后立即创建一个名为`get_orders()`的函数。从`save_order()`函数中的相同第一行开始。在其后添加一行：`con.row_factory
    = sqlite3.Row`。这是一条特殊指令，允许我们在处理结果时使用列名。现在不用担心它——你稍后会看到。然后，使用之前的相同行创建一个游标：`cur
    = con.cursor()`。让我看看你的代码。”
- en: 'Erik showed what he had written:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 埃里克展示了他所写的：
- en: '[PRE8]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '“Good,” Simon said. “Now the important part: we have to get all the orders
    from the table called `orders`. We’ll use one of the most common SQL instructions,
    which tells the database to give us all rows and all columns from a table. It
    looks like this: `SELECT * FROM orders;`. The asterisk `*` means ‘everything.’'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: “很好，”西蒙说。“现在重要的部分：我们必须从名为`orders`的表中获取所有订单。我们将使用最常用的SQL指令之一，它告诉数据库给我们表中的所有行和所有列。它看起来像这样：`SELECT
    * FROM orders;`。星号`*`表示‘所有内容。’
- en: “We should use this instruction with the same `cur.execute()` function that
    we used in `save_order()`. After we execute the instruction, the results should
    be *fetched* from the database. You’ll have to store the results in the list called
    `rows` using the `cur .fetchall()` function. Then, you’ll return the list of rows
    from this function.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: “我们应该使用与在`save_order()`中使用的相同的`cur.execute()`函数。执行指令后，我们应该从数据库中*检索*结果。您需要使用`cur
    .fetchall()`函数将结果存储在名为`rows`的列表中。然后，您将从这个函数返回行列表。
- en: '“Don’t worry, here is the documentation page I’m getting it from. Use it as
    an example.” Simon showed the tab he had open in the browser: [https://docs.python.org/3.8/library/sqlite3.html](https://docs.python.org/3.8/library/sqlite3.html).'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: “别担心，这是我从这里获取文档的页面。把它作为例子使用。”西蒙展示了他在浏览器中打开的标签：[https://docs.python.org/3.8/library/sqlite3.html](https://docs.python.org/3.8/library/sqlite3.html)。
- en: 'Erik started typing. After several minutes, he showed his code to Simon:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 埃里克开始输入。几分钟后，他向西蒙展示了他的代码：
- en: 'Listing 12.5 `app.py`: The `get_orders()` function'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '列表12.5 `app.py`: `get_orders()`函数'
- en: '[PRE9]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '*Your Turn!* Create a `get_orders()` function'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '*轮到你了!* 创建一个`get_orders()`函数'
- en: Create a `get_orders()` function like Erik just did.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个像埃里克刚刚做的那样`get_orders()`函数。
- en: “Looks good to me,” Simon said. “We’ll see when we test it.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: “看起来不错，”西蒙说。“我们测试时就会看到。
- en: “Now we have to add another function that handles the `/list` route. We should
    add it after the `order()` function that handles `/order`. Let me help you.” He
    started writing the function at the end of the file.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: “现在我们必须添加另一个处理`/list`路由的函数。我们应该在处理`/order`的`order()`函数之后添加它。让我来帮你。”他在文件的末尾开始编写函数。
- en: '“First, I specify the route we’re going to handle using `@app.route()`. Then,
    I define the function the usual way. The function itself is pretty simple: I just
    call `get_orders()` and pass the results to `render_template()`. As you’ll remember,
    this function displays the data in the browser using the template we pass to it.”'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: “首先，我使用`@app.route()`指定我们将要处理的路由。然后，我以通常的方式定义函数。函数本身很简单：我只是调用`get_orders()`并将结果传递给`render_template()`。正如你将记得的，这个函数使用我们传递给它的模板在浏览器中显示数据。”
- en: 'Listing 12.6 `app.py`: Create the `list()` function'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 12.6 `app.py`：创建 `list()` 函数
- en: '[PRE10]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '*Your Turn!* Create a `list()` function'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '*轮到你了!* 创建一个 `list()` 函数'
- en: Create a `list()` function like Erik just did.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个像埃里克那样做的 `list()` 函数。
- en: “Why didn’t we get all the orders from the database right in this function?”
    Erik asked. “Why did you ask me to write a separate function?”
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: “为什么在这个函数中我们没有从数据库中正确获取所有订单？”埃里克问道。“你为什么让我写一个单独的函数？”
- en: “Good question,” Simon said. “I’m trying to separate the functions that work
    with the *user* from the functions that work with the *data*. Sometimes people
    call this the *frontend* and *backend*. If we want to change how we work with
    data, we have to change the `get_orders()` function. For example, suppose we wanted
    to be able to get only the orders with caramel flavor. We would pass that request
    to the function, and it would return the list of orders the same way as before.
    Our `list()` function will display whatever it gets from `get_orders()`. It doesn’t
    care if it’s the full list of orders, or just some of the orders—it just displays
    them. On the other hand, the `get_orders()` function doesn’t care about how the
    orders will be displayed. It just returns the list of orders.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: “好问题，”西蒙说。“我正在尝试将处理*用户*的函数与处理*数据*的函数分开。有时人们称之为*前端*和*后端*。如果我们想改变我们处理数据的方式，我们必须改变`get_orders()`函数。例如，假设我们想要能够只获取带有焦糖风味的订单。我们会将这个请求传递给函数，它将以与之前相同的方式返回订单列表。我们的`list()`函数将显示从`get_orders()`获取的任何内容。它不在乎是完整的订单列表，还是只是部分订单——它只是显示它们。另一方面，`get_orders()`函数不关心订单将如何显示。它只是返回订单列表。
- en: “This idea is usually called the *separation of concerns* in computer science.
    I’ll give you a Wikipedia article about that to read later.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: “这个想法在计算机科学中通常被称为*关注点分离*。我会给你一篇关于这个话题的维基百科文章，稍后阅读。
- en: 'Note The Wikipedia article about the separation of concerns is here: [https://en.wikipedia.org/wiki/Separation_of_concerns](https://en.wikipedia.org/wiki/Separation_of_concerns).'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：关于关注点分离的维基百科文章在这里：[https://en.wikipedia.org/wiki/Separation_of_concerns](https://en.wikipedia.org/wiki/Separation_of_concerns)。
- en: “The only thing that’s left is the list template,” Simon said. “Emily, let’s
    start a new file in the editor. Remove the sample web application that Mu created
    for us. Save your new file under `templates` with the name `list.html`. Don’t
    forget to change the file type from ‘Python (*.py)’ to ‘Other (*.*)’.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: “唯一剩下的事情是列表模板，”西蒙说。“艾米丽，让我们在编辑器中创建一个新文件。删除穆为我们创建的示例网络应用程序。将你的新文件保存在`templates`目录下，文件名为`list.html`。别忘了将文件类型从‘Python
    (*.py)’更改为‘Other (*.*)’。
- en: '![](../Images/12-08-save-list-html.png)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/12-08-save-list-html.png)'
- en: “Start with the same template lines that we used in the `print.html` template.
    The first two lines and the last line should be the same.”
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: “从我们在`print.html`模板中使用的相同模板行开始。前两行和最后一行应该是相同的。”
- en: 'Emily copied these three lines:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 艾米丽复制了这三行：
- en: '[PRE11]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: “Now create a table with one empty row and empty cells. We’ll have four cells
    in each row and four column headers. That will be the first row. Do you know how
    to create column headers?” Simon asked Emily.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: “现在创建一个包含一个空行和空单元格的表格。每一行将有四个单元格和四个列标题。那将是第一行。你知道如何创建列标题吗？”西蒙问艾米丽。
- en: “Yes, with the `<th>` tag,” she answered. She started working on an HTML table
    in the `templates/list.html` file.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，使用`<th>`标签，”她回答。她开始在`templates/list.html`文件中创建一个HTML表格。
- en: “You can add the headers now,” Simon said. “There will be `Name`, `Drink`, `Flavor`,
    and `Topping`.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: “现在你可以添加标题了，”西蒙说。“将有`名称`、`饮料`、`风味`和`配料`。”
- en: Listing 12.7 The `templates/list.html` template with headers
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 12.7 带有标题的 `templates/list.html` 模板
- en: '[PRE12]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '“Great,” Simon said. “Now let me add the loop. We’ll use the same `for` loop
    here that we used to display the menus. Remember, we pass the list called `orders`
    to this template. The loop will go over that list, like this: `for o in orders`.
    In each cell, between `<td>` and `</td>`, we’ll insert the value for each of the
    keys: `name`, `drink`, `flavor`, and `topping`.” Simon changed the template:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: “太好了，”西蒙说，“现在让我添加循环。我们将在这里使用与显示菜单相同的`for`循环。记住，我们将名为`orders`的列表传递给这个模板。循环将遍历这个列表，就像这样：`for
    o in orders`。在每个单元格中，在`<td>`和`</td>`之间，我们将插入每个键的值：`name`、`drink`、`flavor`和`topping`。”西蒙修改了模板：
- en: Listing 12.8 The `templates/list.html` template with the `for` loop
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 列表12.8 带有`for`循环的`templates/list.html`模板
- en: '[PRE13]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '*Your Turn!* Create a list template'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '*你的机会!* 创建一个列表模板'
- en: Create a `templates/list.html` file like Emily just did. Pay attention to quotes,
    square brackets, and double curly braces.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个像艾米丽刚刚做的`templates/list.html`文件。注意引号、方括号和双大括号。
- en: “It’s time to try the list function!” Simon said, after he saved the file. “Start
    the application and enter two or three orders.”
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: “是时候尝试列表函数了！”西蒙在保存文件后说，“启动应用程序并输入两三个订单。”
- en: 'Erik started the application, opened the tab with `127.0.0.1:5000/order`, and
    entered three orders: for Simon, for Emily, and for himself.'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 埃里克启动了应用程序，打开带有`127.0.0.1:5000/order`的标签页，并输入了三个订单：为西蒙、为艾米丽和为自己。
- en: “Now, change that `/order` route in the address to `/list`,” Simon said.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: “现在，将地址中的`/order`路由改为`/list`，”西蒙说。
- en: Erik did, and they saw the result.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 埃里克做了，他们看到了结果。
- en: '![](../Images/12-09-list-orders.png)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/12-09-list-orders.png)'
- en: “Looks great,” Emily said. “Very useful for a shop manager!”
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: “看起来很棒，”艾米丽说，“对商店经理来说非常有用！”
- en: “Yes, I like it too,” Erik said. “I think we should add numbers to the rows
    to see how many people we have served.”
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，我也喜欢，”埃里克说，“我觉得我们应该给行添加数字，看看我们服务了多少人。”
- en: “Great idea!” Simon said. “And you can add dates and times to see how many customers
    you served each day. It’s all possible—we just have to change our database to
    keep this information. But we’ll do that later. For tomorrow, I have another idea.
    Emily, do you know CSS by any chance?”
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: “好主意！”西蒙说，“而且你可以添加日期和时间，看看你每天服务了多少客户。所有这些都是可能的——我们只需要更改我们的数据库来保存这些信息。但我们稍后再做。明天，我还有一个想法。艾米丽，你碰巧知道CSS吗？”
- en: “We learned a little bit in our class,” Emily answered.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: “我们在课堂上学到了一点，”艾米丽回答。
- en: “What is CSS?” Erik asked.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: “CSS是什么？”埃里克问。
- en: “It’s a way to change how your HTML page looks in the browser,” Emily explained.
    “I think it stands for *Cascading Style Sheets*.”
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: “这是一种改变浏览器中HTML页面外观的方法，”艾米丽解释说，“我认为它代表的是*Cascading Style Sheets*。”
- en: “Exactly right,” Simon said. “Tomorrow, let’s work on making our site look even
    better with CSS. But before you go, let’s recap what we did today.”
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: “完全正确，”西蒙说，“明天，让我们用CSS让我们的网站看起来更好。但在你走之前，让我们回顾一下今天我们做了什么。”
- en: Emily started, “We created a new project directory and moved all our content
    into it. We renamed the main application file to `app.py`.”
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 艾米丽开始说，“我们创建了一个新的项目目录，并将所有内容都移动到里面。我们将主应用程序文件重命名为`app.py`。”
- en: “We used the text files for menu items the same way we did in the previous version,”
    Erik added. “Now the shop manager can simply edit those files instead of changing
    the program.”
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: “我们像在之前的版本中一样使用文本文件作为菜单项，”埃里克补充说，“现在商店经理可以简单地编辑这些文件，而不是更改程序。”
- en: “And then we started using the database,” Emily said. “It’s not easy.”
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: “然后我们开始使用数据库，”艾米丽说，“这并不容易。”
- en: “Yes, I agree,” Simon said. “But it’s worth it. With the database, our program
    is more professional. Now it’s time to make it more beautiful. We’ll work on that
    tomorrow.”
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: “是的，我同意，”西蒙说，“但这值得。有了数据库，我们的程序更专业了。现在是我们让它更美观的时候了。我们明天会处理这件事。”
- en: New things you have learned today
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 今天你学到的新东西
- en: '*Folders and directories*—In different operating systems, people use different
    terms for the same thing. Folders and directories are both collections of files
    that belong to a certain project or files of a certain type.'
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*文件夹和目录*——在不同的操作系统中，人们用不同的术语来表示相同的东西。文件夹和目录都是属于某个项目或特定类型文件的文件集合。'
- en: '*Jinja templates*—Jinja templates are used by Flask to create HTML pages. You
    can pass variables, lists, and dictionaries into templates and use them as you
    would in Python. You can use `for` loops in templates, similar to in Python.'
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Jinja模板*——Jinja模板被Flask用于创建HTML页面。你可以将变量、列表和字典传递到模板中，就像在Python中使用它们一样。你可以在模板中使用`for`循环，就像在Python中一样。'
- en: '*Database*—A database is a program that can store data and perform various
    operations on the data. Databases can search records using specific criteria or
    summarize data (like the number of vanilla flavor orders for this month).'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*数据库*—数据库是一个可以存储数据并对数据进行各种操作的程序。数据库可以使用特定标准搜索记录或总结数据（例如，本月的香草口味订单数量）。'
- en: '*SQL*—SQL stands for Structured Query Language, and it’s used to work with
    databases.'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*SQL*—SQL代表结构化查询语言，用于与数据库交互。'
- en: '*Frontend and backend*—The frontend part of an application works with users:
    it displays pages and gets input from the keyboard and menus. The backend part
    works with data: it stores and retrieves data from files and databases. The frontend
    and backend parts are used to separate the concerns when working on big applications.'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*前端和后端*—应用程序的前端部分与用户交互：它显示页面并从键盘和菜单获取输入。后端部分与数据交互：它存储和从文件和数据库中检索数据。前端和后端部分用于在处理大型应用程序时分离关注点。'
- en: Code for this chapter
  id: totrans-182
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 本章代码
- en: 'You can find the code for this chapter here: [https://github.com/pavelanni/pythonicadventure-code/tree/main/ch12](https://github.com/pavelanni/pythonicadventure-code/tree/main/ch12).'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在此处找到本章的代码：[https://github.com/pavelanni/pythonicadventure-code/tree/main/ch12](https://github.com/pavelanni/pythonicadventure-code/tree/main/ch12)。
