- en: Chapter 8\. Django!
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第8章。Django！
- en: '|  |'
  id: totrans-1
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**This chapter covers**'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '**本章涵盖**'
- en: '*Writing web applications in Django*'
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*在Django中编写Web应用程序*'
- en: '*Designing a web application*'
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*设计一个Web应用程序*'
- en: '*Some common web practices, such as only editing via POST*'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*一些常见的Web实践，例如仅通过POST进行编辑*'
- en: '|  |'
  id: totrans-6
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: In [chapter 3](kindle_split_011.html#ch03), we looked at building a simple todo
    list to help you track what you were working on. Now we’re going to look at expanding
    the application and making it available through a web browser, so you can see
    what you need to do next regardless of where you are (as long as you have an internet
    connection, obviously). To make your life easier, you’re going to use a web framework
    called Django.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第3章](kindle_split_011.html#ch03)中，我们探讨了构建一个简单的待办事项列表来帮助你跟踪你正在做什么。现在我们将扩展应用程序并通过Web浏览器使其可用，这样无论你在哪里（只要你有互联网连接，显然），你都可以看到你需要做什么。为了使你的生活更轻松，你将使用一个名为Django的Web框架。
- en: 'What’s a web framework, you ask? When you’re developing for the web, you need
    to keep track of a lot of details. In addition to displaying the HTML and handling
    form input, there are lots of extra bits and pieces:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 你问什么是Web框架？当你为Web开发时，你需要跟踪很多细节。除了显示HTML和处理表单输入外，还有很多额外的部分：
- en: Handling cookies, sessions, and logins
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理cookies、会话和登录
- en: Detecting errors and displaying them
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 检测错误并显示它们
- en: Storing data in a database
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在数据库中存储数据
- en: Separating your page design from the rest of the application (so your web designers
    can design the pages without having to bother you)
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将页面设计从应用程序的其他部分分离出来（这样你的网页设计师就可以在不打扰你的情况下设计页面）
- en: And so on. With a framework like Django, you can use code to handle all these
    things and get your web application built more quickly.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 等等。使用像Django这样的框架，你可以使用代码来处理所有这些事情，并更快地构建你的Web应用程序。
- en: Writing web-based applications with Django
  id: totrans-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用Django编写基于Web的应用程序
- en: Django is the main Python web framework, and has a large developer following.
    It’s not the only Python framework by a long stretch, but it’s the most commonly
    used and best documented one. It mostly follows the Model-View-Controller (MVC)
    style of programming, but it sometimes bends that structure a little. In Django,
    there’s a lot of built-in functionality to make your life much easier when developing
    web applications.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: Django是主要的Python Web框架，拥有庞大的开发者群体。它不是唯一的Python框架，但它是使用最广泛且文档最完善的框架之一。它主要遵循模型-视图-控制器（MVC）编程风格，但有时会稍微调整这种结构。在Django中，有许多内置功能可以使开发Web应用程序变得更加容易。
- en: Table 8.1\. Django-ese to MVC-ese
  id: totrans-16
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表8.1\. Django术语与MVC术语对照
- en: '| Django | MVC | Purpose |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| Django | MVC | 目的 |'
- en: '| --- | --- | --- |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Model | Model | Stores data |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| 模型 | 模型 | 存储数据 |'
- en: '| Template | View | Presents a user interface |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| 模板 | 视图 | 展示用户界面 |'
- en: '| View | Controller | Does “stuff” |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| 视图 | 控制器 | 执行“操作” |'
- en: '|  |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**Model-View-Controller**'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '**模型-视图-控制器**'
- en: Model-View-Controller (MVC) is a method of design that separates out your data
    from how it’s presented. The Model stores your data and has functions for manipulating
    it. The View presents your data and a user interface to the end user. Finally,
    the Controller does everything in between.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 模型-视图-控制器（MVC）是一种设计方法，它将数据与其展示方式分离。模型存储数据并具有操作它的函数。视图向最终用户展示数据和用户界面。最后，控制器处理两者之间的所有事情。
- en: MVC is often used as a catch-all term, but different people, applications, and
    web frameworks interpret and use it in different ways; it’s hard to give a definition
    that will work in every situation. See [table 8.1](#ch08table01) for the differences
    between Django’s terminology and “classic” Model-View-Controller. The most important
    thing to take away is that it separates your data, the presentation of that data,
    and the business logic “glue” that exists in between.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: MVC经常被用作一个万能术语，但不同的人、应用程序和Web框架以不同的方式解释和使用它；很难给出一个在每种情况下都适用的定义。参见[表8.1](#ch08table01)，了解Django术语和“经典”模型-视图-控制器之间的区别。最重要的是，它将数据、数据的展示以及存在于两者之间的业务逻辑“胶水”分离出来。
- en: '|  |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Installing Django
  id: totrans-27
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 安装Django
- en: Django is straightforward to install, because you already have Python. Download
    the latest release from [www.djangoproject.com/download/](http://www.djangoproject.com/download/),
    decompress it, and run *python setup.py install* from within the install directory.
    On Linux and Mac OS X, you’ll need to prefix it with *sudo*, and on Windows you’ll
    need to run it from a command shell with administrator privileges. Once the install
    process has finished, type *import django* from within Python to make sure it’s
    working. You shouldn’t see any errors.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: Django 的安装很简单，因为你已经安装了 Python。从 [www.djangoproject.com/download/](http://www.djangoproject.com/download/)
    下载最新版本，解压它，然后在安装目录中运行 *python setup.py install*。在 Linux 和 Mac OS X 上，你需要在其前面加上
    *sudo*，而在 Windows 上你需要从具有管理员权限的命令行中运行它。安装过程完成后，在 Python 中输入 *import django* 以确保它正在工作。你不应该看到任何错误。
- en: '![](f0255-01.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![f0255-01.jpg](f0255-01.jpg)'
- en: If you run into any issues, or if you think you might need to install a more
    complicated setup (if you want to run a PostgreSQL or MySQL database server, or
    use a separate web server such as Apache or Nginx), more detailed installation
    instructions are available at [http://docs.djangoproject.com/en/dev/topics/install/](http://docs.djangoproject.com/en/dev/topics/install/).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你遇到任何问题，或者如果你认为你可能需要安装一个更复杂的设置（如果你想要运行 PostgreSQL 或 MySQL 数据库服务器，或者使用单独的 Web
    服务器，如 Apache 或 Nginx），更详细的安装说明可在 [http://docs.djangoproject.com/en/dev/topics/install/](http://docs.djangoproject.com/en/dev/topics/install/)
    找到。
- en: Setting up Django
  id: totrans-31
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 设置 Django
- en: 'Now that you’ve installed Django, you can start work on your project. Django
    sets most things up for you; all you need to do is to plug your code into the
    right places and change a few settings. Pick a directory on your computer where
    you’d like to store and run your project, and type the code in [listing 8.1](#ch08list1)
    into the command line. This should work as-is under Linux, but for Windows you’ll
    need to do two extra things:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经安装了 Django，你可以开始你的项目工作了。Django 会为你设置大多数事情；你只需要将你的代码插入到正确的位置并更改一些设置。在你的电脑上选择一个你想要存储和运行项目的目录，然后在命令行中输入
    [列表 8.1](#ch08list1) 中的代码。在 Linux 下应该可以按原样工作，但在 Windows 上你需要做两件额外的事情：
- en: Add C:\Python26\Scripts to your PATH environment variable, as you did in [chapter
    1](kindle_split_009.html#ch01), and then restart your terminal for *django-admin*
    to work.
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将 C:\Python26\Scripts 添加到你的 PATH 环境变量中，就像你在 [第 1 章](kindle_split_009.html#ch01)
    中做的那样，然后重新启动你的终端以便 *django-admin* 能够工作。
- en: Include your project path in a second environment variable called *PYTHONPATH*.
    This variable lets you add extra paths for Python to check when importing modules.
    Django’s settings are imported as a Python module, so Python needs to know where
    to find them. The following figure shows how I edited them on my PC.
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在名为 *PYTHONPATH* 的第二个环境变量中包含你的项目路径。这个变量允许你为 Python 添加额外的路径，以便在导入模块时进行检查。Django
    的设置作为 Python 模块导入，因此 Python 需要知道它们的位置。以下图示显示了我在我的电脑上如何编辑它们。
- en: Listing 8.1\. Django first run
  id: totrans-35
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 8.1\. Django 首次运行
- en: '![](08list01_alt.jpg)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![08list01_alt.jpg](08list01_alt.jpg)'
- en: Once you’ve made the necessary adjustments, you’re ready to go!
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你做了必要的调整，你就可以开始了！
- en: Figure 8.1\. Setting system paths for Django
  id: totrans-38
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 8.1\. 设置 Django 系统路径
- en: '![](08fig01_alt.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![08fig01_alt.jpg](08fig01_alt.jpg)'
- en: Most of the setup and later interaction with your server is done through *django-admin*![](one.jpg),
    which is a script that comes included with Django.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数设置和与你的服务器后续交互都是通过 *django-admin* ![one.jpg](one.jpg) 完成的，这是一个 Django 内置的脚本。
- en: '![](f0256-01.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![f0256-01.jpg](f0256-01.jpg)'
- en: Once you’ve created your project, you can take a look around and see what Django
    has created ![](two.jpg). There’s not much to see right now, but you’ll be building
    on it as you write the application.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你创建了你的项目，你可以四处看看 Django 创建了什么 ![two.jpg](two.jpg)。现在没有什么可看的，但随着你编写应用程序，你将在此基础上构建。
- en: While you’re at it, start up Django and see what happens. From within the todos
    folder, type *python manage.py runserver* ![](three.jpg).
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在此同时，启动 Django 并看看会发生什么。在 todos 文件夹内，输入 *python manage.py runserver* ![three.jpg](three.jpg)。
- en: When the server starts, it will tell you what IP address and port number it’s
    running on ![](four.jpg). If you’d like to run on a different IP address or port,
    specify it when you run *manage.py*. For example, *python manage.py runserver
    0.0.0.0:80* will connect to every interface on your PC on port 80, so you can
    impress your friends by allowing them to connect to the fancy new web server running
    on your computer.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 当服务器启动时，它会告诉你它正在运行的 IP 地址和端口号 ![four.jpg](four.jpg)。如果你想在不同的 IP 地址或端口上运行，请在运行
    *manage.py* 时指定它。例如，*python manage.py runserver 0.0.0.0:80* 将连接到你的电脑上的端口 80 上的每个接口，这样你就可以通过允许你的朋友连接到运行在你电脑上的新潮的
    Web 服务器来给他们留下深刻印象。
- en: Django will keep running until you stop it manually ![](five.jpg). *runserver*
    is the development server, which will automatically detect changes to your files
    and restart if necessary, so in most cases you don’t even need to restart to refresh
    your application.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: Django 将持续运行，直到你手动停止它 ![](five.jpg)。*runserver* 是开发服务器，它将自动检测文件的变化并在必要时重新启动，所以在大多数情况下你甚至不需要重新启动来刷新你的应用程序。
- en: As requests come in, Django will print log lines out so you can see what it’s
    doing ![](six.jpg); this can be useful for debugging.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 当请求到来时，Django 将打印日志行以便你可以看到它在做什么 ![](six.jpg)；这可以用于调试。
- en: If you go to the URL listed in the previous output, http://127.0.0.1:8000/,
    you should see something like [figure 8.2](#ch08fig02).
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你访问前一个输出中列出的 URL，http://127.0.0.1:8000/，你应该能看到类似于[图 8.2](#ch08fig02) 的内容。
- en: Figure 8.2\. Django’s starting screen
  id: totrans-48
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 8.2\. Django 的起始屏幕
- en: '![](08fig02_alt.jpg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](08fig02_alt.jpg)'
- en: If you look carefully, you’ll see that Django even tells you what steps to take
    next; but you’ll ignore the database part for now and install an application.
    In Django’s terminology, an application is a module that does a specific thing,
    such as managing todos or user registration. A project might have several applications
    included, and Django will set up and coordinate between them. You can leave the
    development server running—it will automatically detect and reimport most changes
    you make.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你仔细观察，你会发现 Django 甚至会告诉你下一步要采取的步骤；但现在你可以忽略数据库部分，安装一个应用程序。在 Django 的术语中，一个应用程序是一个执行特定任务的模块，例如管理待办事项或用户注册。一个项目可能包含多个应用程序，Django
    将设置并协调它们。你可以让开发服务器继续运行——它将自动检测并重新导入你做出的大多数更改。
- en: '|  |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-52
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: The Django developers encourage you to reuse code, and one of the ways they
    do that is to split projects into applications. Ideally, you’ll have a number
    of applications within any one project, which all contribute their own part. You
    might have one application for storing your todos, another for email handling,
    a third for Paypal sign-ups, and so on. The next time you create a site with Django,
    you’ll be able to reuse some of these applications to help you build it.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: Django 开发者鼓励你重用代码，他们实现这一目标的一种方式是将项目拆分为应用程序。理想情况下，你可以在任何一个项目中拥有多个应用程序，它们各自贡献自己的部分。你可能有一个应用程序用于存储待办事项，另一个用于处理电子邮件，第三个用于
    PayPal 注册，等等。下次你使用 Django 创建网站时，你将能够重用其中的一些应用程序来帮助你构建它。
- en: '|  |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 'Now you can add an application and create your first simple page. This will
    help you confirm that everything’s working and give you your first taste of creating
    a Django application. You need to edit two files: urls.py and todo/view.py. The
    next listing shows how I set up my todo application and what I put into my settings.py
    and url.py files.'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你可以添加一个应用程序并创建你的第一个简单页面。这将帮助你确认一切正常，并让你第一次尝试创建 Django 应用程序。你需要编辑两个文件：urls.py
    和 todo/view.py。下面的列表显示了我是如何设置我的 todo 应用程序以及我在 settings.py 和 url.py 文件中放入的内容。
- en: Listing 8.2\. First steps
  id: totrans-56
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 8.2\. 第一步
- en: '![](08list02_alt.jpg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![](08list02_alt.jpg)'
- en: The first step is to create your application with *manage.py* ![](one.jpg).
    Django will create a *todo* folder to store all of your application-specific code.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是使用 *manage.py* ![](one.jpg) 创建你的应用程序。Django 将创建一个 *todo* 文件夹来存储所有应用程序特定的代码。
- en: Next you create your view. Django helpfully puts a comment in so you know you’re
    in the right place ![](two.jpg).
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你创建你的视图。Django 有助于在正确的地方放置一个注释 ![](two.jpg)。
- en: 'When you create a page to send back to the requester, there’s a lot of detail
    involved: setting MIME types, status codes, and so on. Django’s *HttpResponse*
    takes care of all that ![](three.jpg) and stores all the possible variables in
    one place if you need to alter them.'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 当你创建一个页面以发送回请求者时，涉及了很多细节：设置 MIME 类型、状态码等等。Django 的 *HttpResponse* 处理所有这些 ![](three.jpg)，并在一个地方存储所有可能的变量，如果你需要修改它们。
- en: '![](four.jpg) is a function that Django can call to display a web page. It
    takes a *Request* object, which represents the request for a web page, and returns
    a *Response* object. You’re not doing anything fancy for now— just returning a
    response of “Hello world!”'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '![](four.jpg) 是 Django 可以调用的一个函数，用于显示网页。它接受一个 *Request* 对象，代表对网页的请求，并返回一个 *Response*
    对象。目前你不需要做任何复杂的事情——只需返回一个“Hello world!”的响应。'
- en: '*urls.py* is where you tie everything together ![](five.jpg); you could think
    of it as Django’s traffic controller, making sure each request goes to the right
    place. The *patterns* function takes a number of tuples containing regular expressions
    and functions. If a regular expression matches, Django will call the corresponding
    function and display whatever it returns. For now, you’ll use *.**, which will
    match everything.'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '*urls.py* 是你将一切联系在一起的地方 ![five.jpg](five.jpg)；你可以将其视为Django的交通控制器，确保每个请求都到达正确的位置。*patterns*
    函数接受包含正则表达式和函数的多个元组。如果正则表达式匹配，Django将调用相应的函数并显示它返回的内容。目前，你将使用 *.**，这将匹配所有内容。'
- en: '|  |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Tip
  id: totrans-64
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 提示
- en: Save time by keeping a directory somewhere with everything you need to set up
    a new project—in this case, the Django installer, your initial “Hello world!”
    setup, and anything you find useful as you go. It makes setting up your next project
    much faster.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在某个地方保存一个目录，里面包含你设置新项目所需的所有内容——在这个例子中，是Django安装程序、你的初始“Hello world！”设置，以及你在进行过程中找到的所有有用的东西，这样可以大大节省时间。
- en: '|  |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: If you refresh your page now, you should see the not-quite-so-helpful “Hello
    world!” message, something like [figure 8.3](#ch08fig03).
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你现在刷新你的页面，你应该看到不那么有帮助的“Hello world！”消息，类似于[图8.3](#ch08fig03)。
- en: Figure 8.3\. “Hello world!”
  id: totrans-68
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.3\. “Hello world！”
- en: '![](08fig03.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![08fig03.jpg](08fig03.jpg)'
- en: '![](f0259-01.jpg)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![f0259-01.jpg](f0259-01.jpg)'
- en: It’s not much, but it’s *your* “Hello world!” Now that you know a bit more about
    Django and how it works, let’s start working on your todo list!
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 这不是很多，但这是你的“Hello world！”现在你对Django及其工作方式有了更多了解，让我们开始着手你的待办事项列表！
- en: Writing your application
  id: totrans-72
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 编写你的应用程序
- en: Because you have a pretty good idea of what your todo application should look
    like, you’ll start with the front view and add back-end functionality as you need
    it, or else create a simple stand-in. As the need arises, you’ll gradually introduce
    more and more of Django’s functionality.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 由于你对你的待办事项应用程序应该是什么样子有相当好的想法，你将从前端视图开始，并在需要时添加后端功能，或者创建一个简单的替代品。随着需求的出现，你将逐渐引入更多Django的功能。
- en: '|  |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-75
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: This development strategy is only one way of building a program with Django.
    You can use other methods, such as creating the models you’ll be working with
    first, or the business logic you’ll need to control everything. It all depends
    on your application, where the technical risks lie, and what makes the most sense.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 这种开发策略只是使用Django构建程序的一种方式。你可以使用其他方法，例如首先创建你将工作的模型，或者你需要来控制一切的业务逻辑。这完全取决于你的应用程序，技术风险在哪里，什么最有意义。
- en: '|  |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: The simplest possible todo list
  id: totrans-78
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 最简单的待办事项列表
- en: Here’s your new todo list! It’s simple, but you can already use it to keep track
    of your todos. You need to return the HTML for your todo page from your view,
    instead of the simple “Hello world!”
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是你的新待办事项列表！它很简单，但你已经可以用它来跟踪你的待办事项。你需要从你的视图中返回待办事项页面的HTML，而不是简单的“Hello world！”
- en: Listing 8.3\. A simple todo list
  id: totrans-80
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.3\. 一个简单的待办事项列表
- en: '[PRE0]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: If you need a new todo, add it into your view. When you’ve finished something,
    delete it. Perhaps that’s not very useful, and it’s annoying having to enter all
    the HTML by hand, but bear in mind that this is what Django does with any web
    page you ask it for. You need a better way of generating your HTML markup.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要一个新的待办事项，将其添加到你的视图中。当你完成某事时，删除它。也许这并不是很有用，手动输入所有HTML也很烦人，但请记住，这就是Django对你请求的任何网页所做的事情。你需要一种更好的方法来生成你的HTML标记。
- en: Using a template
  id: totrans-83
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 使用模板
- en: Django and most other web frameworks solve this problem by using a template.
    Rather than typing all the HTML up front, you can use a simple programming language
    to generate it from variables and lists that you have access to. The following
    listing gives a simple example.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: Django和大多数其他Web框架通过使用模板来解决此问题。你不需要一开始就输入所有的HTML，你可以使用一种简单的编程语言，从你可以访问的变量和列表中生成它。下面的列表提供了一个简单的例子。
- en: '![](f0261-01.jpg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![f0261-01.jpg](f0261-01.jpg)'
- en: Listing 8.4\. Using a template
  id: totrans-86
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.4\. 使用模板
- en: '![](08list04_alt.jpg)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![08list04_alt.jpg](08list04_alt.jpg)'
- en: 'Here’s your todo list. Nothing fancy for the moment: just remembering to mow
    the lawn, back up your PC, and buy some milk ![](one.jpg).'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是你的待办事项列表。目前还没有什么特别之处：只是记得割草、备份你的电脑，以及买一些牛奶 ![one.jpg](one.jpg)。
- en: The template handles the display of the page ![](two.jpg), including all the
    fiddly HTML bits. You’ll see what a template looks like and how to create it in
    a minute.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 模板负责显示页面 ![two.jpg](two.jpg)，包括所有繁琐的HTML片段。你将在一分钟内看到模板的样子以及如何创建它。
- en: A context is a way of passing in variables to a template ![](three.jpg). In
    this case, you’re only interested in your list of todos, so that’s all the template
    needs to know about.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 上下文是一种将变量传递给模板的方式 ![three.jpg](three.jpg)。在这种情况下，你只对你的待办事项列表感兴趣，所以这就是模板需要了解的所有信息。
- en: '![](four.jpg) is where all the work gets done. You call the template’s *.render()*
    method with a particular context, create an *HttpResponse* object with it, and
    send it back.'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '![four.jpg](four.jpg) 是所有工作完成的地方。你使用模板的 *.render()* 方法，并传入特定的上下文，创建一个 *HttpResponse*
    对象，然后将其发送回去。'
- en: If you run this code as is, though, you’ll get a *TemplateNotFound* error (as
    shown in [figure 8.4](#ch08fig04)), because you haven’t told Django about the
    index.tmpl template.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你直接运行这段代码，你会得到一个 *TemplateNotFound* 错误（如图 8.4 所示），因为你没有告诉 Django 关于 index.tmpl
    模板的信息。
- en: Figure 8.4\. Where’s my template?
  id: totrans-93
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 8.4\. 我的模板在哪里？
- en: '![](08fig04.jpg)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![08fig04.jpg](08fig04.jpg)'
- en: You’ll need to create the index.tmpl template, either within your todos application
    or within a separate template directory. My version of the template is shown in
    the following listing.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要创建 index.tmpl 模板，无论是在 todos 应用程序内部还是在单独的模板目录中。以下是我版本的模板示例。
- en: Listing 8.5\. A simple template
  id: totrans-96
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 8.5\. 一个简单的模板
- en: '![](08list05.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![08list05.jpg](08list05.jpg)'
- en: '![](f0263-01.jpg)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![f0263-01.jpg](f0263-01.jpg)'
- en: Your Django template is just an HTML page ![](one.jpg), but with a few special
    commands to create some extra HTML on the fly. If you’re familiar with HTML, templates
    won’t be too much of a stretch.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 你的 Django 模板只是一个 HTML 页面 ![one.jpg](one.jpg)，但包含了一些特殊的命令来动态创建一些额外的 HTML。如果你熟悉
    HTML，模板不会让你感到太陌生。
- en: Your first bit of template code is an *if* statement ![](two.jpg). Python within
    the templates is wrapped within either *{% %}* brackets for program code, or *{{
    }}* brackets for variables. The variables are sourced from the context the template
    is passed when it’s rendered by your application.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 你的模板代码的第一部分是一个 *if* 语句 ![two.jpg](two.jpg)。模板中的 Python 代码被包裹在 *{% %}* 括号中用于程序代码，或者
    *{{ }}* 括号中用于变量。变量来源于模板被应用程序渲染时传入的上下文。
- en: You can also use *for* loops in your templates, to loop over a list or iterator
    ![](three.jpg).
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以在模板中使用 *for* 循环，来遍历一个列表或迭代器 ![three.jpg](three.jpg)。
- en: Normal Python programs rely on indentation to tell where a *for* loop or *if*
    statement begins and ends, but that’s impossible when embedding code in a HTML
    template. To get around this problem, you need to include explicit end tags when
    closing your *if* statements or *for* loops ![](four.jpg).
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 正常的 Python 程序依赖于缩进来指示 *for* 循环或 *if* 语句的开始和结束位置，但在 HTML 模板中嵌入代码时这是不可能的。为了解决这个问题，你需要在关闭
    *if* 语句或 *for* 循环时包含显式的结束标签 ![four.jpg](four.jpg)。
- en: Last of all, you need to edit the settings.py file within your todos project
    so Django knows where to find the templates for your todo application.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你需要编辑 todos 项目中的 settings.py 文件，以便 Django 知道在哪里找到你的待办应用程序的模板。
- en: Listing 8.6\. Editing settings.py
  id: totrans-104
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 8.6\. 编辑 settings.py
- en: '![](08list60_alt.jpg)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![08list60_alt.jpg](08list60_alt.jpg)'
- en: Here’s where your todo templates are stored ![](one.jpg). Django will search
    subfolders, so if you find the application directory getting cluttered, you can
    store your templates within a subdirectory such as todo/ templates/. Now if you
    refresh the page within your browser, you should see a nicely formatted table
    listing the tasks you have to do. If you think of another task, then add another
    item to the todos dictionary, and the template will take care of the rest.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 这里就是你的待办模板存储的地方 ![one.jpg](one.jpg)。Django 会搜索子文件夹，所以如果你发现应用程序目录变得杂乱，你可以在子目录如
    todo/ templates/ 中存储你的模板。现在如果你在浏览器中刷新页面，你应该会看到一个格式良好的表格，列出你必须完成的任务。如果你想到了另一个任务，那么在待办字典中添加另一个条目，模板会处理其余部分。
- en: 'But you still have a similar problem: you’ve gone from editing your HTML directly
    to editing a dictionary directly. Separating the presentation and data is an improvement,
    though, since now you’re able to store your tasks in a database.'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 但你仍然会遇到类似的问题：你从直接编辑 HTML 转变为直接编辑字典。虽然将表示和数据进行分离是一个改进，因为你现在能够将任务存储在数据库中。
- en: Using a model
  id: totrans-108
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用模型
- en: But before you do that, you need to start a database, tell Django where it is,
    and populate it with your initial data. That’s quite a lot of work—but Django
    will do most of it for you. You’re using the built-in SQLite database, which is
    fine for your needs, but if you’re writing a larger application, you might want
    a more industrial strength database, like MySQL or PostgreSQL.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 但在这样做之前，你需要启动一个数据库，告诉 Django 数据库的位置，并用你的初始数据填充它。这是一项相当多的工作——但 Django 会为你做大部分。你正在使用内置的
    SQLite 数据库，这对于你的需求来说已经足够好了，但如果你正在编写一个更大的应用程序，你可能需要一个更强大的工业级数据库，比如 MySQL 或 PostgreSQL。
- en: '![](f0264-01.jpg)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![图片](f0264-01.jpg)'
- en: Setting up the database
  id: totrans-111
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 设置数据库
- en: 'First of all, you need to edit your settings.py file to tell Django what database
    file to use. Open it up in your favorite editor, and change the database lines
    to look like this:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你需要编辑你的 settings.py 文件，告诉 Django 使用哪个数据库文件。在你的首选编辑器中打开它，并将数据库行更改为如下所示：
- en: '[PRE1]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The rest of the database lines you can leave as they are. There are some other
    settings to do with admin emails and time zones—which you can edit if you want
    to—but they’re not immediately necessary. The one exception is that your time
    zone needs to be set to the same one as your system if you’re running under Windows.
    See the documentation at [http://docs.djangoproject.com/en/dev/ref/settings/#time-zone](http://docs.djangoproject.com/en/dev/ref/settings/#time-zone)
    for more details, including a link to a list of valid time zone settings.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 其余的数据库行你可以保持不变。还有一些其他与管理员电子邮件和时区有关的设置——如果你想要编辑它们，也可以——但它们不是立即必要的。一个例外是，如果你的系统在
    Windows 下运行，你的时区需要设置为与系统相同的时区。有关更多详细信息，包括有效时区设置的链接，请参阅 [http://docs.djangoproject.com/en/dev/ref/settings/#time-zone](http://docs.djangoproject.com/en/dev/ref/settings/#time-zone)。
- en: Now, type
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，输入
- en: '[PRE2]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: and Django will set up your database. During the process, it will also ask you
    to create an admin user (a good idea). If you don’t set up an admin user at this
    point, you can do so later on by running *python manage.py* *createsuperuser*.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 并且 Django 会为你设置数据库。在这个过程中，它还会要求你创建一个管理员用户（这是一个好主意）。如果你在这个时候没有设置管理员用户，你可以稍后通过运行
    *python manage.py* *createsuperuser* 来完成。
- en: Creating a model
  id: totrans-118
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 创建模型
- en: Now you’re ready to create model to store your data. Because you’ve already
    done a todo application back in [chapter 4](kindle_split_012.html#ch04), you’ll
    build on that data structure. You’ll need to open up the models.py file within
    the *todo* directory and type something similar to what’s in the following listing.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经准备好创建模型来存储你的数据了。因为你已经在 [第 4 章](kindle_split_012.html#ch04) 中创建了一个 todo
    应用程序，你将在此基础上构建数据结构。你需要打开 *todo* 目录中的 models.py 文件，并输入类似于以下列表中的内容。
- en: Listing 8.7\. A todo model
  id: totrans-120
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 8.7\. 一个 todo 模型
- en: '![](08list07.jpg)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![图片](08list07.jpg)'
- en: All the database interaction code is stored within Django’s *db* module ![](one.jpg).
    To declare your todos in a format Django can understand, you create a *Todo* class
    as a subclass of *models.Model*.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 所有数据库交互代码都存储在 Django 的 *db* 模块 ![图片](one.jpg) 中。为了以 Django 可以理解的方式声明你的 todos，你创建一个
    *Todo* 类作为 *models.Model* 的子类。
- en: Fields in the database ![](two.jpg) are similar to variables in Python—they
    store the values you need. Django has a number of different field types, and you
    can even create your own.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库中的字段 ![图片](two.jpg) 与 Python 中的变量类似——它们存储你需要的数据。Django 有许多不同的字段类型，你甚至可以创建自己的。
- en: One of the important parts of using a database is that you can restrict the
    values that get entered into it ![](three.jpg). This way, you can’t enter nonsense
    information into your application—Django will catch it and refuse to add or edit
    your todo. You’ve placed *importance_choices* outside the model so you can access
    it in other contexts.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 使用数据库的一个重要部分是你可以限制输入到其中的值 ![图片](three.jpg)。这样，你就不能将无意义的信息输入到你的应用程序中——Django
    会捕获它并拒绝添加或编辑你的 todo。你已经将 *importance_choices* 放在模型外部，这样你就可以在其他上下文中访问它。
- en: Once you’ve created your model, you need to let Django know it exists. You’ll
    update your settings.py to tell Django about the todo application, and then sync
    your database, which tells Django to look for new models or fields and create
    them. The next listing shows how I did it.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你创建了你的模型，你需要让 Django 知道它的存在。你将更新 settings.py 来告诉 Django 关于 todo 应用程序的信息，然后同步你的数据库，这将告诉
    Django 查找新的模型或字段并创建它们。下一个列表显示了我是如何做到这一点的。
- en: Listing 8.8\. Adding the todo application to your project
  id: totrans-126
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 8.8\. 将 todo 应用程序添加到你的项目中
- en: '![](08list08.jpg)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![图片](08list08.jpg)'
- en: '![](one.jpg) is the line you need to add. These lines will be converted to
    *import* lines by Django, so to be safe, you’ll generally want to include the
    project name and the application.'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '![需要添加的行](one.jpg) 是你需要添加的行。这些行将被 Django 转换为 *import* 行，所以为了安全起见，你通常想要包含项目名称和应用。'
- en: Once you’ve done that, you can use manage.py to create your tables ![](two.jpg).
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你完成了这个操作，你就可以使用 manage.py 来创建你的表 ![two.jpg]。
- en: If you have some database experience and want to look at what Django’s doing
    behind the scenes, the next listing shows you how to use manage.py’s *sql* command
    to inspect the todo model.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有一些数据库经验，并且想看看 Django 在幕后做了什么，下面的列表展示了如何使用 manage.py 的 *sql* 命令来检查待办事项模型。
- en: Listing 8.9\. Showing your model’s SQL
  id: totrans-131
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 8.9\. 显示你的模型的 SQL
- en: '[PRE3]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Now that you have a database, all you need to do is add in some data so you
    can test the application. Django has an easy way to do that, too.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经有了一个数据库，你只需要添加一些数据以便你可以测试应用程序。Django 也有一个简单的方法来做这件事。
- en: '|  |'
  id: totrans-134
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-135
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: When picking a framework like Django, one of the things to look out for is how
    many time-saving libraries it offers. Most web frameworks offer features like
    Model-View-Controller and routing URLs to views, so it’s the extra features like
    the admin module that will make your life easier.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 当选择一个框架如 Django 时，需要注意的一个问题是它提供了多少节省时间的库。大多数 Web 框架都提供了像模型-视图-控制器和路由 URL 到视图这样的功能，所以像管理模块这样的额外功能将使你的生活更轻松。
- en: '|  |'
  id: totrans-137
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Django’s admin module
  id: totrans-138
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: Django 的管理模块
- en: One of Django’s strengths is its built-in admin system, which will let you view
    and edit your data without having to write a lot of data handling and checking
    yourself. You only need to make a few changes to settings.py and urls.py, and
    sync your database, and you’ll be ready to define an admin interface. Let’s start
    by switching it on
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: Django 的一个优势是其内置的管理系统，它将允许你查看和编辑数据，而无需自己编写大量的数据处理和检查。你只需要对 settings.py 和 urls.py
    进行一些修改，并同步你的数据库，你就可以准备定义一个管理界面了。让我们先开启它
- en: Listing 8.10\. Activating Django’s admin system
  id: totrans-140
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 8.10\. 激活 Django 的管理系统
- en: '![](08list10.jpg)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![08list10.jpg]'
- en: All the admin functionality is stored in the admin application, and it needs
    to create some database tables, so you include *django.contrib.admin* as an application
    ![](one.jpg).
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 所有的管理功能都存储在 admin 应用中，它需要创建一些数据库表，所以你需要包含 *django.contrib.admin* 作为应用 ![one.jpg]。
- en: The *autodiscover* function looks through the admin interfaces you’ve written
    and automatically generates the configuration Django needs ![](two.jpg). You’ll
    also find that the admin functionality is already added to your urls.py—you only
    need to remove the comment characters from the start of the relevant lines.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '*autodiscover* 函数会遍历你编写的管理接口，并自动生成 Django 需要的配置 ![two.jpg]。你还会发现，管理功能已经添加到了你的
    urls.py 中——你只需要从相关行的开头移除注释字符。'
- en: '![](f0268-01.jpg)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![f0268-01.jpg]'
- en: The convention is for *^admin/(.*)*, but you can add whatever path you’d like
    if you’d prefer to keep things secret ![](three.jpg). Anything that matches the
    path gets sent off to the admin module’s root function.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 习惯上使用 *^admin/(.*)*，但如果你更喜欢保密，你可以添加任何你想要的路径 ![three.jpg]。任何匹配该路径的内容都会被发送到管理模块的根函数。
- en: Now all you need to do is to sync your db again, using *python manage.py* *syncdb*,
    and Django will create the admin tables and indexes it needs to function. Then
    visit http://127.0.0.1:8000/admin/, and you should see the login page for your
    server. Use the admin username and password you entered earlier and you should
    be able to get access to the admin page.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你只需要再次同步你的数据库，使用 *python manage.py* *syncdb*，Django 将创建它需要来运行的管理表和索引。然后访问
    http://127.0.0.1:8000/admin/，你应该能看到服务器的登录页面。使用你之前输入的管理员用户名和密码，你应该能够访问管理页面。
- en: You’re in, and there are some website-looking things, but where do you edit
    your todos? First you need to register your model with the Django admin interface,
    so it will know to include the model, which fields to display, and so on.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经进来了，有一些看起来像网站的东西，但你在哪里编辑你的待办事项？首先，你需要使用 Django 管理界面注册你的模型，这样它就会知道包含该模型，显示哪些字段等等。
- en: Figure 8.5\. Logging into Django’s admin system
  id: totrans-148
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 8.5\. 登录 Django 的管理系统
- en: '![](08fig05_alt.jpg)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![08fig05_alt.jpg]'
- en: Adding an admin interface
  id: totrans-150
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 添加管理界面
- en: Django gives you a lot of flexibility in how your admin interfaces are designed,
    but for now, we’re going to keep things simple. The following listing gives you
    the bare minimum you need to be able to see your todos in the admin interface.
    All the admin code is stored in todo/ admin.py. There’s not a lot—import your
    *Todo* model and *admin*, and register the *Todo* class as something that should
    be in the admin interface. Django will take care of the rest.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: Django在如何设计你的管理界面方面提供了很多灵活性，但到目前为止，我们将保持简单。以下列表提供了你能够在管理界面中看到待办事项所需的最小内容。所有的管理代码都存储在todo/admin.py中。内容不多——导入你的*Todo*模型和*admin*，并将*Todo*类注册为应该出现在管理界面中的内容。Django将处理其余部分。
- en: 'Listing 8.11\. Registering your model: admin.py'
  id: totrans-152
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.11\. 注册你的模型：admin.py
- en: '[PRE4]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The only change you’ll need to make to your model is to add a *__unicode__*
    method. Without this, Django won’t know how to refer to any particular todo, and
    you’ll get the model name: *Todo.* You’ll need to restart the server for the *admin.autodiscover*
    function to pick up your admin changes, but once you do, you should see a Todos
    link appear in the interface. If you click Todos and then Add Todo, you’ll see
    something like [figure 8.6](#ch08fig06). Also, notice that if you don’t enter
    a value, or enter something that doesn’t fit in your model, Django will notice
    and give you an error.'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要对你的模型进行的唯一更改是添加一个*__unicode__*方法。没有这个方法，Django将不知道如何引用任何特定的待办事项，你将得到模型名称：*Todo.*你需要重新启动服务器，以便*admin.autodiscover*函数能够检测到你的管理更改。一旦这样做，你应该在界面中看到待办事项链接出现。如果你点击待办事项然后添加待办事项，你会看到类似于[图8.6](#ch08fig06)的内容。此外，请注意，如果你没有输入值，或者输入了不适合你模型的内容，Django会注意到并给你一个错误。
- en: Figure 8.6\. Editing a todo in the Django admin interface
  id: totrans-155
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.6\. 在Django管理界面编辑待办事项
- en: '![](08fig06_alt.jpg)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![08fig06_alt.jpg](08fig06_alt.jpg)'
- en: You can go ahead now and enter some todo items for yourself, then go back and
    have a look at the Todos page. You’ll see that Django’s admin page gives you a
    table of all the todos, and you can click through and edit any you need to.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在可以继续添加一些待办事项给自己，然后返回并查看待办事项页面。你会看到Django的管理页面为你提供了一个所有待办事项的表格，你可以点击并编辑任何你需要修改的。
- en: 'The admin interface is also easy to customize if you need to show or hide some
    of the fields, or sort by a certain field. Let’s add a column to show the importance
    of each todo:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要显示或隐藏某些字段，或者按特定字段排序，管理界面也很容易进行自定义。让我们添加一列来显示每个待办事项的重要性：
- en: '[PRE5]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![](f0270-01.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![f0270-01.jpg](f0270-01.jpg)'
- en: Normally, the Django admin will create this class for you automatically, based
    on some simple defaults. To create your own custom version, you subclass *ModelAdmin*
    and override the parts you’d like to change, such as which items to display in
    the list view.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，Django会根据一些简单的默认值自动为你创建这个类。要创建你自己的自定义版本，你需要继承*ModelAdmin*并覆盖你想要更改的部分，例如在列表视图中显示哪些项目。
- en: There are many other attributes that can affect the admin display. For example,
    you can include searching of title and description by adding this one line.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 还有许多其他属性可以影响管理显示。例如，你可以通过添加这一行来实现对标题和描述的搜索。
- en: Now, when you register your class, you include the custom admin class instead
    of letting Django pick its own one.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当你注册你的类时，你将包含自定义的管理类而不是让Django自己选择。
- en: If you restart your server and look at the todo list now, you’ll see a second
    column. When you created your list of priorities earlier, you might remember that
    it used the values A, B, C, and D. The secret reason is that you can sort your
    todos according to priority by clicking at the top of the column.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你现在重新启动你的服务器并查看待办事项列表，你会看到第二列。当你之前创建优先级列表时，你可能记得它使用了A、B、C和D这些值。秘密原因是你可以通过点击列顶来根据优先级对待办事项进行排序。
- en: All right, I think your admin interface is done. You don’t normally want to
    give everyone access to the admin interface, so we’ll take a look at how to provide
    a front end suitable for general consumption in the next section.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 好的，我认为你的管理界面已经完成了。你通常不希望让每个人都访问管理界面，所以我们将查看如何在下一节中提供一个适合一般消费的前端。
- en: Making use of your data
  id: totrans-166
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 利用你的数据
- en: Now that you have data to work with, you should provide an interface so other
    people can see what you’re up to. It’s often a good idea to have tangible output
    from your programs as soon as possible; that way, you can see what needs to be
    done, and people can give you feedback and ideas as early as possible.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你有了可以工作的数据，你应该提供一个接口，以便其他人可以看到你在做什么。尽快从你的程序中得到有形的输出通常是一个好主意；这样，你可以看到需要做什么，人们可以尽早给你反馈和想法。
- en: Using the model
  id: totrans-168
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 使用模型
- en: Let’s first find out how you can get at the data in your database and make use
    of it. You’ll update your previous view so it makes use of the database instead
    of your dictionary.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们首先了解你如何访问数据库中的数据并利用它。你将更新你的前一个视图，使其使用数据库而不是你的字典。
- en: Listing 8.12\. Altering your view
  id: totrans-170
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.12\. 修改你的视图
- en: '![](08list12.jpg)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![](08list12.jpg)'
- en: Your model class is the main interface between the view and the database, so
    you need to import it ![](one.jpg).
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 你的模型类是视图和数据库之间的主要接口，因此你需要导入它！![one.jpg](one.jpg)。
- en: '![](two.jpg) looks for all your todos—nothing too fancy yet. *Todo.objects.all()*
    will return a *QuerySet* object that contains all your Todos, that you can then
    order with the *.order_by* method. There are other *QuerySet* methods that will
    help you to search through your model—a short list is in [table 8.2](#ch08table02).'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: '![](two.jpg) 查找所有你的待办事项——目前还没有什么复杂的功能。*Todo.objects.all()* 将返回一个 *QuerySet*
    对象，其中包含所有你的待办事项，你可以使用 *.order_by* 方法对其进行排序。还有其他 *QuerySet* 方法可以帮助你搜索模型——一个简短的列表在
    [表8.2](#ch08table02) 中。'
- en: Table 8.2\. Some common Django `QuerySet` methods
  id: totrans-174
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表8.2\. 一些常见的Django `QuerySet`方法
- en: '| Method | Description |'
  id: totrans-175
  prefs: []
  type: TYPE_TB
  zh: '| 方法 | 描述 |'
- en: '| --- | --- |'
  id: totrans-176
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| .all()[0] | A QuerySet object won’t trigger a query until it absolutely has
    to, so you can use slices like these to filter only the first few results in a
    query. |'
  id: totrans-177
  prefs: []
  type: TYPE_TB
  zh: '| .all()[0] | 一个QuerySet对象只有在绝对需要时才会触发查询，因此你可以使用这些切片来过滤查询中的前几个结果。 |'
- en: '| .filter(criteria) .exclude(criteria)'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '| .filter(criteria) .exclude(criteria)'
- en: .get(criteria) | .filter(), .exclude(), and .get() will return results according
    to criteria you specify as keyword arguments. |
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: .get(criteria) | .filter(), .exclude(), 和 .get() 将根据你指定的关键字参数返回结果。 |
- en: '| .get(id__exact=14) | The keywords are specified as follows: |'
  id: totrans-180
  prefs: []
  type: TYPE_TB
  zh: '| .get(id__exact=14) | 关键字如下指定： |'
- en: '| .filter(importance__lte=''B'') | <field>__<type of match> |'
  id: totrans-181
  prefs: []
  type: TYPE_TB
  zh: '| .filter(importance__lte=''B'') | <字段>__<匹配类型> |'
- en: '| .exclude( title__contains='
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '| .exclude( title__contains='
- en: '''[blocked]'') | Django will convert them to the relevant SQL. You can also
    chain QuerySets together to further restrict the results you return. |'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: '| Django将它们转换为相关的SQL。你还可以将QuerySets链接起来，以进一步限制你返回的结果。 |'
- en: Other than that, you don’t need to make any changes to your view ![](three.jpg)—Django’s
    templates are smart enough to adjust when you feed it a set of objects instead
    of a list of dictionaries.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 除了这些，你不需要对你的视图做任何更改！![three.jpg](three.jpg)——Django的模板足够智能，当你给它一组对象而不是字典列表时，它能够调整。
- en: There’s one thing you need to change about your display, though. Your priorities
    are shown using the underlying letter, rather than the human-readable one. Fortunately,
    that’s a simple change to the model and template, so let’s do it now.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，关于你的显示，你需要做一些更改。你的优先级是通过底层的字母来显示的，而不是人类可读的字母。幸运的是，这只是一个简单的模型和模板更改，所以让我们现在就做。
- en: Listing 8.13\. Readable priorities
  id: totrans-186
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.13\. 可读的优先级
- en: '![](08list13.jpg)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![](08list13.jpg)'
- en: The first step is to update your model so it can provide you with the human-readable
    version of the priority without having to jump through too many hoops. The easy
    way to do that is to convert the *importance_choices* tuple to a dictionary ![](one.jpg)
    and then use *self.importance* to access the right one.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是更新你的模型，使其能够提供优先级的人类可读版本，而无需跳过太多环节。做到这一点的一个简单方法是将 *importance_choices* 元组转换为字典！![one.jpg](one.jpg)，然后使用
    *self.importance* 来访问正确的选项。
- en: Now, use the *text_importance* method within the template to display the importance
    of your todo ![](two.jpg). Notice that Django’s templates are once again smart
    enough to do the right thing regardless of what you feed them.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在模板中使用 *text_importance* 方法来显示待办事项的重要性！![two.jpg](two.jpg)。请注意，Django的模板足够智能，无论你给它什么输入，都能做正确的事情。
- en: '![](f0273-01.jpg)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![](f0273-01.jpg)'
- en: That’s the basic functionality you need to display your todo items. You can
    extend your template to make the page look prettier, perhaps color-code the items
    according to how important they are, and so on. The *for* and *if* elements and
    the methods of your models should be enough to create most of the application.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 这是您需要显示待办事项的基本功能。您可以通过扩展模板来使页面看起来更美观，例如根据重要程度对项目进行颜色编码等。*for* 和 *if* 元素以及您模型的方法应该足以创建大多数应用程序。
- en: '[Table 8.3](#ch08table03) shows some other template syntax elements that might
    be useful—but you’re normally better off trying to include the functionality within
    the model or controller rather than the template if you need anything more complicated.'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: '[表 8.3](#ch08table03) 展示了一些可能有用的其他模板语法元素——但如果你需要更复杂的功能，通常更好的做法是在模型或控制器中而不是在模板中包含这些功能。'
- en: Table 8.3\. Django template syntax cheat sheet
  id: totrans-193
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表 8.3\. Django 模板语法速查表
- en: '| Syntax | Usage |'
  id: totrans-194
  prefs: []
  type: TYPE_TB
  zh: '| 语法 | 用法 |'
- en: '| --- | --- |'
  id: totrans-195
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| {% for variable in iterable %} <tr class="{% cycle ''row1'' ''row2'' %}"'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: '| {% for variable in iterable %} <tr class="{% cycle ''row1'' ''row2'' %}"'
- en: '{{ variable }}'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: '{{ variable }}'
- en: '{% endfor %} | You’ve already seen the for loop in action. One handy extra,
    though, is cycle—it will swap between the values you give it on each pass through
    the loop. |'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: '{% endfor %} | 您已经看到了 for 循环的作用。不过，还有一个方便的额外功能，那就是 cycle——它将在每次循环遍历时在您提供的值之间切换。
    |'
- en: '| {% comment %} ...'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: '| {% comment %} ...'
- en: '{% endcomment %} | If you need to add comments to your template, this is the
    way to do it. Neither the comment tags nor the code between them will appear in
    the final output. Adding comments can be useful, but generally your templates
    should be simple enough that you don’t need them. |'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '{% endcomment %} | 如果您需要在模板中添加注释，这是您应该这样做的方式。注释标签及其之间的代码都不会出现在最终输出中。添加注释可能很有用，但通常您的模板应该足够简单，以至于您不需要它们。
    |'
- en: '| {% filter force_escape&#124;lower %} HTML-escaped lower case text.'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: '| {% filter force_escape&#124;lower %} HTML 转义的小写文本。'
- en: '{% endfilter %}'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: '{% endfilter %}'
- en: '{{ variable&#124;urlencode}} | You can apply various filters to the output
    of the template by either wrapping filter tags around what you need to escape
    or using the pipe character &#124; and filter names. There are many different
    filters, such as upper, lower, and urlencode, that you can use—you can even write
    your own! |'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '{{ variable&#124;urlencode}} | 您可以通过将过滤标签包裹在需要转义的文本周围，或者使用管道字符 `|` 和过滤名称来应用各种过滤器到模板的输出。有许多不同的过滤器可供使用，例如大写、小写和urlencode，您甚至可以编写自己的过滤器！
    |'
- en: Now you have a way of getting data from the database out to the end user—but
    you need to be able to get data back again. To do that, you’ll need to be able
    to submit forms.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您有了一种从数据库获取数据到最终用户的方法——但是您需要能够再次获取数据。要做到这一点，您需要能够提交表单。
- en: Setting up your URLs
  id: totrans-205
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 设置您的 URL
- en: First, you need to think a little about how your application will be laid out.
    One good way that is easily supported by Django is called Representational State
    Transfer, or REST for short. In a nutshell, it’s a style you can use to represent
    resources on the web, and the actions that can be performed on them.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您需要稍微考虑一下您的应用程序的布局方式。Django 容易支持的一种好方法是称为表示状态转移（Representational State Transfer），简称
    REST。简而言之，这是一种您可以用它来表示网络上的资源及其上可以执行的操作的风格。
- en: REST works well for typical data-based applications, such as your todo application.
    In this case, you have a number of todos, and you’d like to be able to view, add,
    edit, and delete each individual todo. A typical REST design might look like the
    following listing.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: REST 对于典型基于数据的应用程序，如您的待办事项应用程序，效果很好。在这种情况下，您有许多待办事项，并且您希望能够查看、添加、编辑和删除每个单独的待办事项。一个典型的
    REST 设计可能看起来像以下列表。
- en: Listing 8.14\. A RESTful URL design
  id: totrans-208
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 8.14\. 一个 RESTful URL 设计
- en: '![](08list14.jpg)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
  zh: '![](08list14.jpg)'
- en: If you think of the list of todos as a resource, this is the root level of your
    application ![](one.jpg). Adding a todo won’t be linked to a todo, so it’s best
    to make *add* a method of your root resource.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您将待办事项列表视为一个资源，那么这是您应用程序的根级别 ![one.jpg](one.jpg)。添加待办事项不会链接到另一个待办事项，因此最好将
    *添加* 作为您根资源的一种方法。
- en: Once you’ve created a todo, viewing it means appending its ID onto the end of
    the URL ![](two.jpg).
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您创建了一个待办事项，查看它意味着将它的 ID 附加到 URL 的末尾 ![two.jpg](two.jpg)。
- en: Generally, the default method for any resource is to view it, but when you need
    to edit or delete a todo, you’ll sometimes want to append the method ![](three.jpg).
    In this application, though, you’ll just use the same URL for viewing and editing.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，任何资源的默认方法都是查看它，但是当您需要编辑或删除待办事项时，您有时会想要附加方法 ![three.jpg](three.jpg)。然而，在这个应用程序中，您将只使用相同的
    URL 来查看和编辑。
- en: '|  |'
  id: totrans-213
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-214
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: One of the advantages of using a RESTful interface is that it encourages you
    to do one piece at a time. It’s not normally a big deal if you haven’t got deletion
    working yet—you can still test the other parts, because they’re independent.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 使用RESTful接口的一个优点是它鼓励你一次只做一件事情。如果你还没有实现删除功能，这通常不是什么大问题——你仍然可以测试其他部分，因为它们是独立的。
- en: '|  |'
  id: totrans-216
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Now that you’ve mapped out how the application should work, how do you put it
    into practice? All your URL handling is stored within urls.py. It’s there that
    you can specify which URLs will work and which views should handle them, and also
    extract the IDs. To help encapsulate your todo application a little better, though,
    you’re going to create your own urls.py within todo and then include it from the
    standard urls.py.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经规划了应用程序应该如何工作，那么如何将其付诸实践呢？所有的URL处理都存储在urls.py中。正是在那里你可以指定哪些URL将工作以及哪些视图应该处理它们，还可以提取ID。然而，为了更好地封装你的待办事项应用程序，你将在todo中创建自己的urls.py，然后从标准的urls.py中包含它。
- en: Listing 8.15\. Setting URLs and views
  id: totrans-218
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.15\. 设置URL和视图
- en: '![](08list15_alt.jpg)'
  id: totrans-219
  prefs: []
  type: TYPE_IMG
  zh: '![08list15_alt.jpg](https://example.org/08list15_alt.jpg)'
- en: First, you include a separate urls.py file from within the root urls.py![](one.jpg).
    Note that the path is relative to the root of the project. You can also remove
    *import todo.views*.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你从根urls.py中包含一个单独的urls.py文件 ![one.jpg](https://example.org/one.jpg) 。请注意，路径相对于项目根目录。你也可以删除
    *import todo.views* 。
- en: '![](f0276-01.jpg)'
  id: totrans-221
  prefs: []
  type: TYPE_IMG
  zh: '![f0276-01.jpg](https://example.org/f0276-01.jpg)'
- en: Next, create urls.py within todo and add these two lines to it ![](two.jpg).
    The first includes the default Django URL-handling functions, and the second imports
    the views.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，在todo中创建urls.py并在其中添加这两行 ![two.jpg](https://example.org/f0276-01.jpg) 。第一行包含默认的Django
    URL处理函数，第二行导入视图。
- en: Your pattern definition ![](three.jpg) is exactly the same function definition
    you’ve been using in the root urls.py. One time saver here is that you can include
    the starting part of the function, rather than call *todo.views.some_function*
    several times.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 你的模式定义 ![three.jpg](https://example.org/three.jpg) 与你在根urls.py中使用的函数定义完全相同。这里的省时之处在于你可以包含函数的开始部分，而不是多次调用
    *todo.views.some_function* 。
- en: Next, you define the URLs for viewing your todo list ![](four.jpg) and adding
    a todo. Note that I’ve renamed the *hello_world* view to *todo_index*, which is
    a bit more sensible. The *include* function will also snip the previous *todos/*
    part off the front, so you’re matching a blank URL.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你为查看待办事项列表和添加待办事项定义URL ![four.jpg](https://example.org/f0277-01.jpg) 。请注意，我已经将
    *hello_world* 视图重命名为 *todo_index* ，这更符合逻辑。*include* 函数也会从前面剪掉 *todos/* 部分，因此你匹配的是一个空URL。
- en: Finally, ![](five.jpg) is the URLs for individual todos. There’s one for viewing,
    one for editing, and another for deleting. Note that the URL regular expression
    has a group defined with brackets. The number that it matches will be fed in as
    an extra argument to the view—you’ll see how to make use of it when we look at
    how to handle individual todo items.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 最后， ![five.jpg](https://example.org/five.jpg) 是单个待办事项的URL。有一个用于查看，一个用于编辑，还有一个用于删除。请注意，URL正则表达式定义了一个带有括号的组。它匹配的数字将被作为额外的参数传递给视图——当我们查看如何处理单个待办事项时，你会看到如何利用它。
- en: '![](f0277-01.jpg)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![f0277-01.jpg](https://example.org/f0277-01.jpg)'
- en: Note that in the todo/urls.py file, you’re not specifying the absolute path
    to any of your views, or anything outside your area of responsibility. This will
    help you later, particularly if you’re trying to combine several different applications
    or you need to use your application somewhere else.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，在todo/urls.py文件中，你没有指定任何视图的绝对路径，或者任何超出你责任范围的东西。这将在以后帮助你，尤其是如果你试图组合几个不同的应用程序或者需要在其他地方使用你的应用程序。
- en: That’s all you need to do to your URLs for now. Let’s move on and write some
    views that can handle input from the user.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 目前你需要对URL做的就这些。让我们继续编写一些可以处理用户输入的视图。
- en: Submitting forms
  id: totrans-229
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 提交表单
- en: The first thing you’ll do is create the form and view necessary to handle adding
    a new todo. There’s not much point in writing a todo-editing form if there aren’t
    any todos to start with. You’ll add it to the root page—it makes the most sense
    to include it there. When it’s submitted, it will go to http://localhost:8080/todos/add,
    which will take care of the rest. The next listing shows how you can add a form
    to your template.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 你首先需要创建处理添加新待办事项所需的表单和视图。如果没有待办事项开始编写待办事项编辑表单就没有太多意义。你将把它添加到根页面——将其包含在那里是最有意义的。提交后，它将转到
    http://localhost:8080/todos/add ，这将处理其余部分。下一个列表显示了如何将表单添加到模板中。
- en: Listing 8.16\. A submission form
  id: totrans-231
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.16\. 提交表单
- en: '![](ch08list16-0.jpg)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![ch08list16-0.jpg](https://example.org/ch08list16-0.jpg)'
- en: '![](ch08list16-1.jpg)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![ch08list16-1.jpg](https://example.org/ch08list16-1.jpg)'
- en: Don’t forget that you’d like your todo application to be portable. It’s tempting
    to use a hard-coded path like /todos/add, but that would mean you’d need to edit
    your template whenever you reused the application.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 不要忘记你希望你的待办事项应用程序是可移植的。使用硬编码的路径，如 /todos/add，很有诱惑力，但那样意味着每次你重用应用程序时都需要编辑你的模板。
- en: So that you don’t have to repeatedly add separate instances of *importance_choices*—which
    could get out of sync—you include the version from your model ![](one.jpg). The
    choices will need to be passed through to the template from the model ![](two.jpg).
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 这样你就不必反复添加 *importance_choices* 的单独实例——这可能会导致不同步——你包含来自你模型的版本 ![一](one.jpg)。选择将需要从模型传递到模板
    ![二](two.jpg)。
- en: Now, if you refresh the /todos/ page, you should see a form at the bottom, under
    the list of todos.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果你刷新 /todos/ 页面，你应该在待办事项列表下方看到表单。
- en: But if you try to submit the form, you’ll get an error. You haven’t written
    your handler yet, so despite the fact that, in theory, Django knows what to do,
    it can’t find the function. The next listing shows you how to do that.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 但如果你尝试提交表单，你会得到一个错误。你还没有编写你的处理器，所以尽管在理论上Django知道该怎么做，但它找不到这个函数。下一个列表显示了如何做到这一点。
- en: Figure 8.7\. A form to add a todo
  id: totrans-238
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.7\. 添加待办事项的表单
- en: '![](08fig07.jpg)'
  id: totrans-239
  prefs: []
  type: TYPE_IMG
  zh: '![08fig07.jpg]'
- en: Listing 8.17\. A view to handle adding a todo
  id: totrans-240
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.17\. 处理添加待办事项的视图
- en: '![](08fig17_alt.jpg)'
  id: totrans-241
  prefs: []
  type: TYPE_IMG
  zh: '![08fig17_alt.jpg]'
- en: Handling post requests is no different than any other view. Define a function
    that takes a request parameter ![](one.jpg).
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 处理POST请求与其他视图没有不同。定义一个函数，它接受一个请求参数 ![一](one.jpg)。
- en: '![](f0279-01.jpg)'
  id: totrans-243
  prefs: []
  type: TYPE_IMG
  zh: '![f0279-01.jpg]'
- en: Next, you create a new *Todo* instance, based on the values fed in via HTTP
    POST ![](two.jpg). There aren’t any restrictions on what you can enter, so you
    feed the parameters straight in.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你创建一个新的 *Todo* 实例，基于通过HTTP POST传入的值 ![二](two.jpg)。你可以输入的内容没有限制，所以你直接输入参数。
- en: Once you’ve created the todo, its *.save()* method writes it out to the database
    ![](three.jpg).
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你创建了待办事项，其 *.save()* 方法就会将其写入数据库 ![三](three.jpg)。
- en: You’re finished, so you return to the index page with *HttpResponse-Redirect*
    ![](four.jpg). So you’re not hard-coding the URL with something like /todos/,
    you use the *reverse()* function, which takes either a view or the name of a view
    and returns its URL.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 你完成了，所以你使用 *HttpResponse-Redirect* 返回到索引页面 ![四](four.jpg)。这样你就不会用类似 /todos/
    的东西硬编码URL，而是使用 *reverse()* 函数，它接受一个视图或视图的名称，并返回其URL。
- en: The *reverse()* function doesn’t like having unimplemented views, so you’ll
    add some now. Because they’re all related to a particular todo, you make sure
    the ID for the todo is included ![](five.jpg).
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: '*reverse()* 函数不喜欢未实现的观点，所以你现在需要添加一些。因为它们都与特定的待办事项相关，所以你确保待办事项的ID被包含在内 ![五](five.jpg)。'
- en: That should be all you need to do. If you enter a todo in the form and submit
    it, you should see it appear in the list. Congratulations! You now have a functioning
    web application. You can display data to the user from a database and accept input
    back, which your application can use to make additions to that data.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该就足够了。如果你在表单中输入待办事项并提交，你应该看到它在列表中显示。恭喜！你现在有一个功能齐全的Web应用程序。你可以从数据库向用户显示数据，并接受输入，你的应用程序可以使用这些输入来添加数据。
- en: '|  |'
  id: totrans-249
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Security in Django
  id: totrans-250
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: Django中的安全
- en: If you’ve had some previous experience in web development, you’re probably gritting
    your teeth over the previous code. Normally, blindly accepting input from the
    people using your site is a major security hole, leading to SQL injection and
    XSS (cross-site scripting) attacks, but Django’s database layer and templating
    layer will automatically escape any input and data being displayed unless you
    tell it otherwise.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有一些之前的Web开发经验，你可能对之前的代码感到牙痒痒。通常，盲目接受使用你网站的人的输入是一个主要的安全漏洞，会导致SQL注入和XSS（跨站脚本）攻击，但Django的数据库层和模板层会自动转义任何输入和显示的数据，除非你告诉它否则。
- en: '|  |'
  id: totrans-252
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Almost any web framework, or even a CGI application, will let you do show data
    and accept requests. The nice thing about Django is that you can do it with only
    a small amount of simple, straightforward code, and build more advanced things
    on it easily.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 几乎任何Web框架，甚至是一个CGI应用程序，都会让你能够显示数据和接受请求。Django的好处是你可以用少量简单、直接的代码来做这件事，并轻松地构建更高级的功能。
- en: You still need to take care of the individual todos, though—editing and deleting
    are just as important as being able to create new ones. We’ll also look at some
    other ways you can make your development even easier, using some of Django’s more
    advanced functionality.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如此，你仍然需要关注单个待办事项——编辑和删除与创建新事项一样重要。我们还将探讨一些其他方法，你可以使用Django的一些更高级功能使你的开发更加容易。
- en: Handling individual todos
  id: totrans-255
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 处理单个待办事项
- en: 'One of the main advantages in using a web framework is that a lot of the simple,
    boilerplate stuff is already written for you. In Django’s case, two of the most
    useful parts are generic views and model forms:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Web框架的主要优势之一是许多简单的模板代码已经为你准备好了。在Django的情况下，最有用的两个部分是通用视图和模型表单：
- en: Generic views are implementations of common types of views, for example, displaying
    a list of items from a particular model in the database, and all of the editing,
    updating, and deleting associated with it.
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通用视图是常见视图类型的实现，例如，在数据库中显示特定模型的项列表，以及与之相关的所有编辑、更新和删除操作。
- en: Model forms are forms that are built directly from your model. Because they
    know the structure and type of your data, they can take care of the parsing and
    sanitizing of form data automatically, making it easy to get information back
    from the user of your application.
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模型表单是从你的模型直接构建的表单。因为它们知道你的数据结构和类型，它们可以自动处理表单数据的解析和清理，这使得从应用程序的用户那里获取信息变得容易。
- en: You’ll mainly be using generic views for your application, but we’ll touch on
    some of the model forms. Because your models and views are already written, you’ll
    start with the URLs for your application and move on to templates in a minute.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 你主要会使用通用视图来构建你的应用程序，但我们将简要介绍一些模型表单。因为你的模型和视图已经编写好了，你将从应用程序的URL开始，然后很快转向模板。
- en: Listing 8.18\. Updating urls.py
  id: totrans-260
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.18\. 更新urls.py
- en: '![](08list18.jpg)'
  id: totrans-261
  prefs: []
  type: TYPE_IMG
  zh: '![图片](08list18.jpg)'
- en: '*django.views.generic.create_update* contains the two views you need to use
    ![](one.jpg). There are other views within *create_update*, but these are the
    only two you need.'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: '*django.views.generic.create_update*包含了你需要使用的两个视图![图片](one.jpg)。*create_update*中还有其他视图，但只有这两个是你需要的。'
- en: Now that you’re using generic views, the sources of your views differ and you
    can’t use the *'todo.views'* shortcut. Instead, you’ll feed in the functions directly
    ![](two.jpg).
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你正在使用通用视图，视图的来源不同，你不能使用*'todo.views'*快捷方式。相反，你将直接输入函数![图片](two.jpg)。
- en: '![](f0282-01.jpg)'
  id: totrans-264
  prefs: []
  type: TYPE_IMG
  zh: '![图片](f0282-01.jpg)'
- en: '![](four.jpg) is a more advanced way of linking to a view, broken into multiple
    lines to make it easier to follow. The first line is the URL regular expression
    as usual, and the second is the view function. The third line onward is a dictionary
    of arguments to the view, which you also put one per line. The only mandatory
    one is *model*, but you’re overriding *template_name* too (the default is todo/todo_form.html).
    The final parameter, *post_save_* *redirect*, tells Django where to go next. *%(id)s*
    is interpreted in the context of whatever object you’re editing, so it will evaluate
    to /todos/1 if you’re editing a *Todo* model with ID 1.'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片](four.jpg)是一种更高级的链接到视图的方式，分成多行以便于跟踪。第一行是通常的URL正则表达式，第二行是视图函数。从第三行开始是传递给视图的参数字典，你也将它们逐行放置。唯一必需的是*model*，但你还在覆盖*template_name*（默认为todo/todo_form.html）。最后一个参数*post_save_*
    *redirect*告诉Django下一步去哪里。*%(id)s*在编辑的任何对象的上下文中被解释，所以如果你正在编辑ID为1的*Todo*模型，它将评估为/todos/1。'
- en: If you read ![](four.jpg) and wondered how the view knew which object to edit,
    the *?P<object_id>* part here is how it’s done ![](three.jpg). If you have a named
    match like this in your URL, Django will add it to the dictionary of arguments
    that is passed to the view, so you don’t need to specify it explicitly. I normally
    name all the parameters in my URLs, because if you don’t, they’ll be fed in as
    arguments, and might be in the wrong order.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你阅读了![图片](four.jpg)并想知道视图是如何知道编辑哪个对象的，这里的*?P<object_id>*部分就是它的工作方式![图片](three.jpg)。如果你在URL中有一个这样的命名匹配，Django会将其添加到传递给视图的参数字典中，因此你不需要明确指定它。我通常在URL中命名所有参数，因为如果不这样做，它们将被作为参数传入，并且可能顺序不正确。
- en: Finally, ![](five.jpg) is the generic *delete* function. It’s pretty much the
    same as the update one, except that once you’ve deleted your todo, you won’t be
    able to redirect back to it; so you jump back one directory to the index page
    with the *post_delete_redirect* argument.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，![five.jpg](#) 是通用的 *删除* 函数。它与更新函数几乎相同，只是在你删除待办事项后，你将无法重新定向回它；因此，你使用 *post_delete_redirect*
    参数跳回一个目录到索引页面。
- en: 'That’s all you need to do within your URLs. Now you need to add two templates:
    one for updating and the other for confirming deletion. These have the same HTML
    as the previous index template, so I’ve omitted everything that’s the same.'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的 URL 中，你需要做的是这些。现在你需要添加两个模板：一个用于更新，另一个用于确认删除。这些模板与之前的索引模板具有相同的 HTML，所以我省略了所有相同的内容。
- en: Listing 8.19\. A todo editing template
  id: totrans-269
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 8.19\. 待办事项编辑模板
- en: '![](08list19_alt.jpg)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
  zh: '![08list19_alt.jpg](#)'
- en: The generic edit template is fed two variables automatically. The first one
    is object ![](one.jpg), which is the object you’re editing—in this case, your
    todo.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 通用编辑模板自动传递两个变量。第一个是对象 ![one.jpg](#)，这是你正在编辑的对象——在本例中是你的待办事项。
- en: The view handles both the display and editing, so you don’t need to do anything
    with the form’s action attribute ![](two.jpg); your input will be passed to the
    current URL.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 视图处理显示和编辑，所以你不需要对表单的 action 属性做任何事情 ![two.jpg](#)；你的输入将被传递到当前 URL。
- en: 'The second variable you’re given is *form*, which is one of Django’s *ModelForm*
    objects that we touched on at the start of this section ![](three.jpg). It has
    fields that match the ones defined in your model, along with a *label_tag* attribute,
    so you don’t have to repeat the field names in your template. The *ModelForm*
    field will automatically output the right input element for the fields: text for
    the title, a dropdown for the importance, and a *textarea* element for the description.'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 你得到的第二个变量是 *形式*，这是 Django 的 *ModelForm* 对象之一，我们在本节开头提到过 ![three.jpg](#)。它包含与你的模型中定义的字段相匹配的字段，以及一个
    *label_tag* 属性，因此你不需要在模板中重复字段名称。*ModelForm* 字段将自动输出正确的输入元素：标题为文本，重要性为下拉列表，描述为
    *textarea* 元素。
- en: If you don’t want to edit a todo, or you’ve finished editing, you can use this
    link to go back to the main index page ![](four.jpg). The 1 in todos/1 doesn’t
    count as a directory, so you want to go to your current directory, which is “.”
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不想编辑待办事项，或者你已经完成了编辑，你可以使用此链接返回主索引页面 ![four.jpg](#)。todos/1 中的 1 不算作目录，所以你想回到当前目录，即
    “.”。
- en: Let’s see what the edit form looks like. For now, you’ll need to type the URL
    to your todo manually. http://localhost:8080/todos/1 should look like [figure
    8.8](#ch08fig08).
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看编辑表单的样子。目前，你需要手动输入待办事项的 URL。http://localhost:8080/todos/1 应该看起来像 [图 8.8](#ch08fig08)。
- en: Figure 8.8\. Your edit view
  id: totrans-276
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 8.8\. 你的编辑视图
- en: '![](08fig08.jpg)'
  id: totrans-277
  prefs: []
  type: TYPE_IMG
  zh: '![08fig08.jpg](#)'
- en: If you enter new values for the todo and click Save, they should be saved to
    the database. You might want to have a separate window open with the index page,
    and refresh when you save, to double check.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你为待办事项输入了新值并点击保存，它们应该会被保存到数据库中。你可能想打开一个包含索引页面的单独窗口，并在保存时刷新，以进行双重检查。
- en: Last but not least, you’ll need to be able to delete a todo once you’re done
    with it. The following form will let you do that.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 最后但同样重要的是，你需要在完成待办事项后能够删除它。以下表单将允许你这样做。
- en: Listing 8.20\. A deletion template
  id: totrans-280
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 8.20\. 删除模板
- en: '![](089list20_alt.jpg)'
  id: totrans-281
  prefs: []
  type: TYPE_IMG
  zh: '![089list20_alt.jpg](#)'
- en: It’s a good idea to force destructive behavior, such as editing or deleting
    a todo, to be done with a POST rather than a GET request ![](one.jpg); this way,
    if someone accidentally browses to that page, or Google tries to index your site,
    nothing is damaged. Django follows this behavior—typing *http://localhost:8000/todos/1/delete*
    into the address bar of your browser is a GET request, so Django will prompt you
    to confirm your action via a POST.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 强制使用 POST 请求而不是 GET 请求来执行破坏性行为，例如编辑或删除待办事项，是个好主意 ![one.jpg](#)；这样，如果有人意外浏览到该页面，或者
    Google 试图索引你的网站，就不会造成任何损害。Django 遵循这种行为——在浏览器地址栏中输入 *http://localhost:8000/todos/1/delete*
    是一个 GET 请求，所以 Django 会提示你通过 POST 确认你的操作。
- en: You might not want to delete the todo (perhaps you clicked the wrong thing or
    mistyped), so you include a way to go back to the index page ![](two.jpg). /todos/1/delete
    is one level deeper than /todos/1 because the /1/ is counted as a directory, so
    this back link goes one directory up.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能不想删除待办事项（也许你点击了错误的东西或输入错误），所以你提供了一个返回索引页面的方法 ![two.jpg](#)。/todos/1/delete
    比 /todos/1 深一级，因为 /1/ 被视为一个目录，所以这个回链会向上跳一个目录。
- en: 'Now if you go to http://localhost:8000/todos/1/delete, you should be prompted
    to delete todo #1\. If you click Delete, your todo should be deleted from the
    system.'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果您访问http://localhost:8000/todos/1/delete，您应该会收到提示以删除待办事项#1。如果您点击删除，您的待办事项应该从系统中删除。
- en: Final polishing
  id: totrans-285
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 最终润色
- en: You’re almost done with adding, editing, and deleting—the last thing you need
    to do is tie it all together and make it easy to click through to edit and delete
    an entry. You’ll improve a few other things in the interface while you’re at it.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 您几乎完成了添加、编辑和删除的工作——您需要做的最后一件事是将所有这些整合在一起，并使其易于点击以编辑和删除条目。当您在界面中做这些事情时，您还会改进一些其他事情。
- en: Listing 8.21\. Editing the index page
  id: totrans-287
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.21。编辑索引页
- en: '![](08list21_alt.jpg)'
  id: totrans-288
  prefs: []
  type: TYPE_IMG
  zh: '![](08list21_alt.jpg)'
- en: You’ve added two extra columns to your listing ![](one.jpg). The first is for
    a link to delete the todo, and the second is a snippet of the description.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 您在列表中增加了两列！[](one.jpg)。第一列是用于删除待办事项的链接，第二列是描述的片段。
- en: You also added links to the edit and delete functionality you’ve just written
    ![](two.jpg).
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 您还添加了您刚刚编写的编辑和删除功能的链接！[](two.jpg)。
- en: '![](f0286-01.jpg)'
  id: totrans-291
  prefs: []
  type: TYPE_IMG
  zh: '![](f0286-01.jpg)'
- en: A description might be several lines long and mess up your beautiful page, so
    you include *todo.short_ description* ![](three.jpg) instead. This is a convenience
    method ![](four.jpg) that returns, at most, 80 characters from the first line
    of the description.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 描述可能很长，会弄乱您漂亮的页面，因此您可以使用*todo.short_description*！[](three.jpg)代替。这是一个便利的方法！[](four.jpg)，它最多返回描述的第一行中的80个字符。
- en: Now you can add, edit, and delete todos by clicking through from the index page.
    Polish isn’t so important while you’re developing your application, but once you
    start to use it, you’ll appreciate the extra effort you put in to make your application
    more usable.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以通过点击索引页来添加、编辑和删除待办事项。在开发应用时，润色并不是那么重要，但一旦开始使用，您就会欣赏您为使应用更易用所付出的额外努力。
- en: Where to from here?
  id: totrans-294
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 接下来该做什么？
- en: 'Your application is pretty much feature complete, although the design of the
    front page is bare “programmer HTML” and might need a little work. You can also
    add more functionality, to make your application easier to use or more featureful.
    Here are some ideas:'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 您的应用功能几乎已经完善，尽管首页的设计看起来像是“程序员HTML”，可能需要一点修改。您还可以添加更多功能，使您的应用更易于使用或功能更强大。以下是一些想法：
- en: Color-code todos based on their importance.
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据重要性对待办事项进行颜色编码。
- en: Include some JavaScript to sort the columns by clicking the header of the table.
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含一些JavaScript，通过点击表头对列进行排序。
- en: Allow todos to be assigned to a group. You’ll need to be able to add and remove
    groups, and you’ll want to create a foreign-key link from the todo model to a
    particular group.
  id: totrans-298
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许将待办事项分配给一个组。您需要能够添加和删除组，并希望从待办事项模型创建一个外键链接到特定的组。
- en: Assign optional due dates to the todos, and sort by those instead of the importance.
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为待办事项分配可选的截止日期，并按这些日期进行排序。
- en: We’re not done with Django yet. In [chapter 11](kindle_split_019.html#ch11),
    you’ll extend the todo application further, allowing your friends to log in and
    create their own todo lists. We’ll also look at some of Django’s more advanced
    functionality, such as built-in unit testing, and look at some advanced database
    manipulation.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还没有完成Django。在第11章[kindle_split_019.html#ch11]中，您将进一步扩展待办事项应用，允许您的朋友登录并创建他们自己的待办事项列表。我们还将探讨Django的一些更高级功能，例如内置单元测试，以及查看一些高级数据库操作。
- en: Summary
  id: totrans-301
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 摘要
- en: Now you can create your own web applications in Python using Django. We’ve covered
    all the basics in this chapter, including designing the URLs for your site and
    setting up views, models, and templates.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以使用Django在Python中创建自己的Web应用。我们已经在本章中涵盖了所有基础知识，包括为您的网站设计URL，设置视图、模型和模板。
- en: We also touched on several design issues when writing web applications, such
    as separating the design and data models from each other, limiting destructive
    edits to POST requests, and some simple design strategies. These suggestions are
    based on common practices and experience; working “with the grain” like this can
    save you lots of time and energy fighting with your development environment.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 在编写Web应用时，我们也触及了几个设计问题，例如将设计和数据模型分开，限制破坏性编辑到POST请求，以及一些简单的设计策略。这些建议基于常见实践和经验；以这种方式“顺应潮流”可以为您节省大量时间和精力，避免与开发环境斗争。
- en: We’ll return to the todo application in [chapter 11](kindle_split_019.html#ch11),
    but for now take a break and try your hand at writing a desktop application. In
    this case, you’ll be using a graphics library called Pyglet to create your own
    arcade game.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在[第11章](kindle_split_019.html#ch11)回到待办事项应用，但在此期间，请休息一下并尝试编写一个桌面应用程序。在这种情况下，您将使用一个名为Pyglet的图形库来创建自己的街机游戏。
