- en: '4 Anthos Service Mesh: Security and observability at scale'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 4 Anthos 服务网格：大规模的安全性和可观察性
- en: Onofrio Petragallo
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Onofrio Petragallo
- en: This chapter covers
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Sidecar proxy and proxyless architectures
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 旁路代理和无代理架构
- en: Introducing the main features of Istio
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍 Istio 的主要功能
- en: Security and observability with Istio
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Istio 的安全和可观察性
- en: Exploring Anthos Service Mesh
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索 Anthos 服务网格
- en: A practical example with code
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 带有代码的实际示例
- en: One of the key aspects of being cloud native is to break up your application
    into microservices. This means an application that may have run on a single server
    now has multiple services, backed by multiple Pods, as separate components. As
    applications scale out their services, it becomes difficult to troubleshoot problems
    that you may encounter with the application. With this added complexity, we needed
    a tool to help organize, secure, and add resilience to the expanding complexities
    that microservices introduced. Another important problem is that enterprises often
    have a huge number of microservices and aren’t always able to control, manage,
    and observe them—something a service mesh could fix.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 云原生的一个关键方面是将您的应用程序拆分为微服务。这意味着原本可能运行在单个服务器上的应用程序现在有多个服务，由多个 Pod 作为独立组件支持。随着应用程序扩展其服务，您可能会遇到的问题变得难以调试。随着这种附加的复杂性，我们需要一个工具来帮助组织、安全和增强微服务引入的扩展复杂性。另一个重要问题是，企业通常拥有大量的微服务，并且并不总是能够控制、管理和观察它们——这是服务网格可以解决的问题。
- en: In this chapter, we will discuss Anthos Service Mesh (ASM) and the features
    that ASM inherits from Istio ([https://istio.io/](https://istio.io/)), a popular
    open source framework for creating, managing, and implementing a service mesh.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论 Anthos 服务网格（ASM）以及 ASM 从流行的开源框架 Istio（[https://istio.io/](https://istio.io/)）继承的特性，Istio
    是用于创建、管理和实施服务网格的框架。
- en: The implementation of a service mesh not only facilitates communication between
    microservices using a dedicated communication management control plane; it also
    includes tools to observe communication between services—increase observability,
    enhance security, control application traffic flow, and simulate faults in an
    application.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 服务网格的实施不仅通过专用通信管理控制平面促进了微服务之间的通信；还包括观察服务之间通信的工具——提高可观察性、增强安全性、控制应用流量流和模拟应用故障。
- en: Anthos Service Mesh is a Google-managed service that allows enterprise management
    of all the service meshes present in a hybrid cloud or multicloud architecture
    from a single point, providing complete and in-depth visibility of all microservices.
    The visualization of the topography of the service mesh and the complete integration
    with Cloud Monitoring provides users the tools to identify failing workloads or
    other problems, making problem resolution faster.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos 服务网格是 Google 管理的一项服务，它允许企业从单一位置管理混合云或多云架构中存在的所有服务网格，提供对所有微服务的完整和深入可见性。服务网格拓扑的可视化和与
    Cloud Monitoring 的完全集成，为用户提供识别失败的工作负载或其他问题的工具，使问题解决更快。
- en: The security features made available by Anthos Service Mesh allow you to manage
    the authentication, authorization, and encryption of communications through mutual
    authentication (mTLS; [http://mng.bz/1Mly](http://mng.bz/1Mly)), to secure and
    ensure trust in both directions for the communication between microservices; mTLS
    ensures a high level of security, minimizing the related risks. The traffic management
    features of Istio provide users the tools to manipulate traffic using request
    routing, fault injection, request timeouts, circuit breaking, and mirroring.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos 服务网格提供的安全功能允许您通过相互认证（mTLS；[http://mng.bz/1Mly](http://mng.bz/1Mly)）管理通信的认证、授权和加密，以确保微服务之间通信的双向安全和信任；mTLS
    确保了高水平的安全性，最小化了相关风险。Istio 的流量管理功能为用户提供工具，通过请求路由、故障注入、请求超时、断路器和镜像来操纵流量。
- en: As you can see, Istio includes several complex features that may be difficult
    to troubleshoot. Few offerings in the market today include support for Istio,
    leaving you to support your service mesh on your own. Google has addressed this
    lack by including ASM in Anthos, providing a single support point for your Kubernetes
    clusters and Istio.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您所看到的，Istio 包含了几个可能难以调试的复杂功能。目前市场上很少有产品提供对 Istio 的支持，这使您必须自行支持您自己的服务网格。Google
    通过在 Anthos 中包含 ASM 来解决这一不足，为您的 Kubernetes 集群和 Istio 提供单一的支持点。
- en: Before talking about the Anthos Service Mesh features and Istio in detail, let’s
    start by explaining what a service mesh actually is.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在详细讨论 Anthos 服务网格功能和 Istio 之前，让我们首先解释一下服务网格实际上是什么。
- en: 4.1 Technical requirements
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.1 技术要求
- en: 'The hands-on portion of this chapter will require you to have access to a Kubernetes
    cluster running on GCP with the following deployment pattern: a GKE cluster with
    at least three nodes with four CPUs and 16 GB of RAM.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的实践部分需要你能够访问一个运行在 GCP 上的 Kubernetes 集群，其部署模式如下：一个至少有三个节点、每个节点有四个 CPU 和 16
    GB RAM 的 GKE 集群。
- en: 4.2 What is a service mesh?
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.2 什么是服务网格？
- en: 'To understand how a service mesh works and why it’s becoming a standard tool
    in the microservices toolbox, you need to understand what a service mesh provides.
    The main advantages of adopting a service mesh are the ability to do the following:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解服务网格是如何工作的以及为什么它正在成为微服务工具箱中的标准工具，你需要了解服务网格提供的内容。采用服务网格的主要优势包括以下能力：
- en: Observe and monitor all communications between the individual microservices
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 观察和监控各个微服务之间的所有通信
- en: Secure connections between the available microservices
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可用微服务之间的安全连接
- en: Deliver resilient services (distributed services) through multicluster and multicloud
    architecture patterns
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过多集群和多云架构模式提供具有弹性的服务（分布式服务）
- en: 'Provide advanced traffic management: A/B testing, traffic splitting, and canary
    rollouts'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供高级流量管理：A/B 测试、流量分割和金丝雀发布
- en: A service mesh is an infrastructure layer in a microservices architecture that
    controls the communication between services. We can not only create a mesh of
    services within a microservice’s architecture that runs in a Kubernetes cluster,
    but we can also create a single service mesh that spans multiple clusters, or
    even nonmicroservice services running on virtual machines.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 服务网格是微服务架构中的一个基础设施层，它控制服务之间的通信。我们不仅可以在运行在 Kubernetes 集群中的微服务架构内创建服务网格，还可以创建跨越多个集群或甚至运行在虚拟机上的非微服务服务的单个服务网格。
- en: A service mesh manages all the ingress, or inbound traffic, and egress, or outbound
    traffic, for each microservice. Traffic management is a complex topic and something
    that most users do not want to deal with. To remove this burden, Istio doesn’t
    require the developer to make any changes in their application logic; instead,
    the service mesh handles all of this by using a sidecar proxy approach or a proxyless
    approach.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 服务网格管理每个微服务的所有入站（或传入）流量和出站（或传出）流量。流量管理是一个复杂的话题，大多数用户都不想处理。为了减轻这种负担，Istio 不要求开发者在他们的应用逻辑中进行任何更改；相反，服务网格通过使用
    Sidecar 代理方法或无代理方法来处理所有这些。
- en: The sidecar proxy is one of the main components of a service mesh that manages
    the ingress and egress traffic for each microservice, abstracting itself from
    the application logic of the microservices. Because all the traffic flows through
    the sidecar proxy, it can monitor this traffic to send metrics and logs to the
    centralized control plane.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: Sidecar 代理是服务网格的主要组件之一，它管理每个微服务的入站和出站流量，同时将自己从微服务的应用逻辑中抽象出来。因为所有流量都通过 Sidecar
    代理流动，所以它可以监控这些流量，并将指标和日志发送到集中式控制平面。
- en: 'The following three approaches are available, with the sidecar proxy the most
    common approach to creating a service:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 以下三种方法可供选择，其中 Sidecar 代理是创建服务最常见的方法：
- en: '*Sidecar proxy*—Used in a microservices architecture where a proxy is connected
    to each microservice, with the same life cycle as the microservice itself, but
    executes as a separate process, as shown in figure 4.1.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Sidecar 代理*—在微服务架构中使用，每个代理都与微服务相连，具有与微服务相同的生命周期，但作为单独的进程执行，如图 4.1 所示。'
- en: '![04-01](../../OEBPS/Images/04-01.png)'
  id: totrans-28
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![04-01](../../OEBPS/Images/04-01.png)'
- en: Figure 4.1 Sidecar proxy architecture
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.1 Sidecar 代理架构
- en: '*Proxyless*—Used in a microservices architecture where the microservice can
    send the telemetry directly to the control plane by using gRPC, a remote procedure
    call system developed by Google.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*无代理*—在微服务架构中使用，微服务可以通过 Google 开发的远程过程调用系统 gRPC 直接将遥测数据发送到控制平面。'
- en: '*Proxy inside a VM*—An L7 proxy runs inside VMs as a process or an agent that
    can be added to the service mesh as if it were a sidecar proxy.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*虚拟机内的代理*—一个 L7 代理作为进程或代理在虚拟机内部运行，可以像 Sidecar 代理一样添加到服务网格中。'
- en: 'After seeing what a service mesh is and what the approaches are to create one,
    let’s review how Anthos Service Mesh uses each of them. To monitor in real time
    the telemetry of all inbound and outbound communications between the microservices
    of the various service mesh networks, ASM uses the following two approaches:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在了解了服务网格是什么以及创建服务网格的方法之后，让我们回顾 Anthos 服务网格如何使用每种方法。为了实时监控来自各种服务网格网络微服务之间所有传入和传出通信的遥测数据，ASM
    使用以下两种方法：
- en: The sidecar proxy approach, using Envoy ([https://www.envoyproxy.io/](https://www.envoyproxy.io/))
    proxies, an open source service proxy attached on each Pod to get the real-time
    telemetry, as shown in figure 4.2.
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Envoy（[https://www.envoyproxy.io/](https://www.envoyproxy.io/)）代理的无代理代理方法，每个
    Pod 上附加的开源服务代理，以获取实时遥测，如图 4.2 所示。
- en: '![04-02](../../OEBPS/Images/04-02.png)'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![04-02](../../OEBPS/Images/04-02.png)'
- en: Figure 4.2 Sidecar proxy approach
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.2 侧边车代理方法
- en: The proxyless approach using Google Cloud Traffic Director ([https://cloud .google.com/traffic-director](https://cloud.google.com/traffic-director)),
    which can use gRPC with xDS API ([https://github .com/envoyproxy/data-plane-api](https://github.com/envoyproxy/data-plane-api)),
    the same technology used by Envoy to communicate with the control plane, as shown
    in figure 4.3.
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Google Cloud Traffic Director（[https://cloud.google.com/traffic-director](https://cloud.google.com/traffic-director)）的无代理方法，该方法可以使用
    xDS API（[https://github.com/envoyproxy/data-plane-api](https://github.com/envoyproxy/data-plane-api)）与
    gRPC 一起使用，正如图 4.3 所示，这是 Envoy 与控制平面通信所使用的技术。
- en: '![04-03](../../OEBPS/Images/04-03.png)'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![04-03](../../OEBPS/Images/04-03.png)'
- en: Figure 4.3 Proxyless approach
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.3 无代理方法
- en: The proxyless approach removes the Istio sidecar from your deployments. By removing
    the sidecar, we are removing an extra hop in the network traffic to the service,
    leading to a reduction in network latency, enhancing the service overall response
    time.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 无代理方法从您的部署中移除了 Istio 侧边车。通过移除侧边车，我们消除了服务网络流量中的额外跳数，从而降低了网络延迟，提高了服务的整体响应时间。
- en: A single service mesh can have services that use both the standard Istio sidecar
    and the proxyless approach. This flexibility allows you to use the correct approach
    for different applications, including gRPC using a proxyless approach, sidecars
    for services that do not use gRPC, and sidecars for services that use gRPC.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 单个服务网格可以包含使用标准 Istio 侧边车和无代理方法的服务的组合。这种灵活性允许您为不同的应用程序使用正确的方法，包括使用无代理方法进行 gRPC，为不使用
    gRPC 的服务使用侧边车，以及为使用 gRPC 的服务使用侧边车。
- en: As discussed in previous chapters, Anthos is a complete platform from Google
    to build applications running on hybrid or multicloud platforms. Anthos Service
    Mesh is the main component that provides service management to developers and
    cluster administrators.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 如前几章所述，Anthos 是一个完整的平台，由 Google 提供，用于构建在混合云或多云平台上运行的应用程序。Anthos 服务网格是主要组件，为开发人员和集群管理员提供服务管理。
- en: In the next section, we will examine the features of Istio, which is the basis
    for the Anthos Service Mesh.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将探讨 Istio 的特性，它是 Anthos 服务网格的基础。
- en: 4.3 An introduction to Istio
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.3 Istio 简介
- en: 'Istio is an open platform that offers a uniform way to integrate microservices,
    manage traffic flow across microservices, enforce policies, and aggregate telemetry
    data. Istio’s control plane provides an abstraction layer over the underlying
    cluster management platform, such as Kubernetes. The main features of Istio ([http://mng.bz/WA6x](http://mng.bz/WA6x))
    follow:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: Istio 是一个开源平台，提供了一种统一的方式来集成微服务、管理微服务之间的流量流、执行策略和聚合遥测数据。Istio 的控制平面在底层集群管理平台（如
    Kubernetes）之上提供了一个抽象层。Istio 的主要功能（[http://mng.bz/WA6x](http://mng.bz/WA6x)）如下：
- en: Automatic load balancing for HTTP, gRPC, WebSocket, and TCP traffic
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对 HTTP、gRPC、WebSocket 和 TCP 流量的自动负载均衡
- en: Fine-grained control of traffic behavior with robust routing rules, retries,
    failover, and fault injection
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用强大的路由规则、重试、故障转移和故障注入进行细粒度流量行为控制
- en: A pluggable policy layer and configuration API supporting access controls, rate
    limits, and quotas
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持访问控制、速率限制和配额的可插拔策略层和配置 API
- en: Automatic metrics, logs, and traces for all traffic within a cluster, including
    cluster ingress and egress
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 集群内所有流量的自动指标、日志和跟踪，包括集群入口和出口
- en: Secure service-to-service communication in a cluster with strong identity-based
    authentication and authorization
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在集群中实现基于强身份验证和授权的安全服务间通信
- en: 'Given its open source nature, Istio is extensible and usable in various environments:
    for example, you can execute it on-prem, in the cloud, inside a VM, or with microservices,
    allowing you to customize the service mesh to your security and monitoring requirements.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 由于其开源性质，Istio 可扩展且适用于各种环境：例如，您可以在本地、云中、虚拟机内或与微服务一起执行它，允许您根据安全和监控需求自定义服务网格。
- en: To understand Istio, you need to understand the underlying architecture of the
    system. In the next section, we will explain the components of Istio and the features
    they provide.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 要理解 Istio，您需要了解系统的底层架构。在下一节中，我们将解释 Istio 的组件及其提供的功能。
- en: 4.3.1 Istio architecture
  id: totrans-52
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.3.1 Istio 架构
- en: Istio’s flexible architecture allows you to implement a service mesh from scratch.
    You do not have to have Istio installed before developers start using the cluster—a
    service mesh can be deployed before or after the developers have implemented and
    deployed their services. Remember, as shown in figure 4.4, Istio uses the sidecar
    proxy injection to intercept the ingress and egress traffic from inside and outside
    the network of microservices, so there are no dependencies on the developers.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: Istio 的灵活架构允许您从头开始实现服务网格。开发者在使用集群之前不需要安装 Istio——服务网格可以在开发者实现和部署他们的服务之前或之后部署。记住，如图
    4.4 所示，Istio 使用边车代理注入来拦截来自微服务网络内外部的入站和出站流量，因此没有对开发者的依赖。
- en: '![04-04](../../OEBPS/Images/04-04.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![04-04](../../OEBPS/Images/04-04.png)'
- en: Figure 4.4 Detailed Istio architecture
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.4 详细 Istio 架构
- en: 'Starting with Istio version 1.5, the main components of Istio’s architecture
    are the sidecar proxy and istiod, which contains three subcomponents: Pilot, Citadel,
    and Galley*.*'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 从 Istio 版本 1.5 开始，Istio 架构的主要组件是边车代理和 istiod，其中包含三个子组件：Pilot、Citadel 和 Galley*.*
- en: 'Istiod provides service discovery, configuration, and certificate management,
    as well as high-level routing rules that control traffic behavior into a specific
    configuration for the Envoy proxy, injecting them into the sidecars at runtime.
    It also acts as a certificate authority that generates certificates to allow secure
    mTLS communication in the data plane. Istiod contains the following three processes
    to provide its services:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: Istiod 提供服务发现、配置和证书管理，以及控制流量行为进入 Envoy 代理特定配置的高级路由规则，在运行时将它们注入到边车中。它还充当证书颁发机构，生成证书以允许数据平面中的安全
    mTLS 通信。Istiod 包含以下三个进程以提供其服务：
- en: '*Pilot*—Responsible for the life cycle of Envoy sidecar proxy instances deployed
    across the service mesh. Pilot abstracts platform-specific service discovery mechanisms
    and is conformant with any sidecar that can consume the Envoy API.'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Pilot*—负责跨服务网格部署的 Envoy 代理实例的生命周期。Pilot 抽象了平台特定的服务发现机制，并符合任何可以消费 Envoy API
    的边车。'
- en: '*Galley*—Interprets the YAML files for Kubernetes and transforms them into
    a format that Istio understands. Galley makes it possible for Istio to work with
    environments other than Kubernetes—for example, virtual machine—because it translates
    various configuration data into the common format that Istio understands.'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Galley*—解释 Kubernetes 的 YAML 文件，并将它们转换为 Istio 理解的格式。Galley 使得 Istio 能够与 Kubernetes
    以外的环境（例如虚拟机）一起工作，因为它将各种配置数据转换为 Istio 理解的通用格式。'
- en: '*Citadel*—Enables robust service-to-service and end user authentication with
    built-in identity and credential management.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Citadel*—通过内置的身份和凭证管理，实现强大的服务间和终端用户身份验证。'
- en: 'So far, we have covered Istio at a high level, but now let’s go through the
    features of Istio in detail. We can divide the features into three main categories:
    traffic management, security, and observability.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经从高层次概述了 Istio，但现在让我们详细探讨 Istio 的功能。我们可以将这些功能分为三个主要类别：流量管理、安全和可观察性。
- en: 4.3.2 Istio traffic management
  id: totrans-62
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.3.2 Istio 流量管理
- en: Istio provides powerful traffic management ([https://istio.io/latest/docs/tasks/traffic-management/](https://istio.io/latest/docs/tasks/traffic-management/)),
    which allows users to control ingress and egress traffic. This control is not
    limited to simply routing traffic to a specific service; it also offers the ability
    to split traffic between different versions and simulate failures and timeouts
    in applications. Table 4.1 shows Istio’s traffic management features.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: Istio 提供强大的流量管理功能（[https://istio.io/latest/docs/tasks/traffic-management/](https://istio.io/latest/docs/tasks/traffic-management/)），允许用户控制入站和出站流量。这种控制不仅限于简单地路由流量到特定服务；它还提供了在应用程序的不同版本之间分割流量以及模拟故障和超时的能力。表
    4.1 展示了 Istio 的流量管理功能。
- en: Table 4.1 Istio traffic management features
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 表 4.1 Istio 流量管理功能
- en: '| Feature | Description |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| 功能 | 描述 |'
- en: '| Ingress | Controls the ingress traffic for the service mesh, to expose a
    service outside the service mesh over TLS or mTLS using the Istio gateway. In
    another chapter, we will deep-dive into ingress for Anthos. |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| 入口 | 控制服务网格的入口流量，通过 Istio 网关使用 TLS 或 mTLS 暴露服务到服务网格之外。在另一章中，我们将深入探讨 Anthos
    的入口。 |'
- en: '| Egress | Controls the egress traffic from the service mesh, routes traffic
    to an external system, performs TLS for outbound traffic, and configures the outbound
    gateway to use an HTTPS proxy. |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| 出口 | 控制服务网格的出口流量，将流量路由到外部系统，对出站流量执行 TLS，并配置出站网关使用 HTTPS 代理。 |'
- en: '| Request routing and traffic splitting | Dynamically routes the traffic to
    multiple versions of the microservice or migrates traffic from one version to
    another version gradually and in a controlled way. |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| 请求路由和流量分割 | 动态地将流量路由到多个微服务版本，或以逐步和受控的方式将流量从某个版本迁移到另一个版本。 |'
- en: '| Fault injection | Provides configurable HTTP delays and fault injection with
    an HTTP status code, allowing developers to discover problems before they would
    occur in production. |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| 故障注入 | 提供可配置的 HTTP 延迟和故障注入功能，通过 HTTP 状态码允许开发者发现生产环境中可能出现的问题。 |'
- en: Traffic management is a powerful feature of Istio, allowing developers to completely
    control traffic, down to the level where a single user could be directed to a
    new version of an application, while all other requests are directed to the current
    version. The fault injection feature enables developers to cause a delay between
    services, simulating an HTTP delay or faults, to verify how the application will
    react to unexpected problems. All these features can be used by users without
    any code changes to their application, providing a big advantage over the old
    “legacy” development days.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 流量管理是 Istio 的强大功能之一，允许开发者完全控制流量，甚至可以控制到将单个用户引导到应用程序的新版本，而其他所有请求都导向当前版本。故障注入功能使开发者能够在服务之间引入延迟，模拟
    HTTP 延迟或故障，以验证应用程序对意外问题的反应。所有这些功能都可以在不修改应用程序代码的情况下由用户使用，这为旧“传统”开发时代提供了巨大优势。
- en: Security is everyone’s job, but not everyone has a sufficient background in
    security to create the code to enhance application security. Just like the traffic
    management features, Istio provides extra security features, all without requiring
    developers to create any code.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 安全是每个人的责任，但并非每个人都有足够的背景知识来编写增强应用程序安全性的代码。就像流量管理功能一样，Istio 提供了额外的安全功能，而无需开发者编写任何代码。
- en: In the next section, we will explain the security features included with Istio
    and ASM.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将解释 Istio 和 ASM 包含的安全功能。
- en: 4.3.3 Istio security
  id: totrans-73
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.3.3 Istio 安全性
- en: Services in the mesh need to communicate with each other over a network connection,
    so you need to consider additional security to defend against various attacks,
    including man-in-the-middle and unknown service communication. Istio includes
    components to enhance your application security ([https://istio.io/latest/docs/tasks/security/](https://istio.io/latest/docs/tasks/security/)),
    ranging from an included certificate authority to peer authentication and authorization,
    helping you adopt a zero-trust posture.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 网格中的服务需要通过网络连接相互通信，因此您需要考虑额外的安全措施来防御各种攻击，包括中间人攻击和未知服务通信。Istio 包括增强应用程序安全性的组件（[https://istio.io/latest/docs/tasks/security/](https://istio.io/latest/docs/tasks/security/)），从内置的证书颁发机构到对等认证和授权，帮助您采用零信任策略。
- en: 'The first component that Istio provides to increase your application security
    is the handling of certificate management, including an Istio certificate authority
    (CA) with an existing root certificate. In cryptography, a certificate authority
    or certification authority is an entity that issues digital certificates. A digital
    certificate certifies the ownership of a public key by the named subject of the
    certificate. This allows others to rely on signatures or assertions made about
    the private key that corresponds to the certified public key—proving the identity
    of the certificate owner. A CA acts as a trusted third party: trusted both by
    the owner of the certificate and by the party relying on the certificate.'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: Istio提供的第一个组件是为了提高您的应用程序安全性，包括处理证书管理，包括带有现有根证书的Istio证书授权（CA）。在密码学中，证书授权机构或认证机构是一个发行数字证书的实体。数字证书证实了证书中命名的主题对公钥的所有权。这允许其他人依赖与对应于认证公钥的私钥相关的签名或声明——证明证书所有者的身份。CA充当受信任的第三方：既受证书所有者的信任，也受依赖证书的实体的信任。
- en: In an organization, the root certificate signatory may want to remain responsible
    for signing all certificates issued for all entities in the organization. It is
    also possible that whoever has the responsibility of signing the root certificate
    wants to delegate the responsibility of signing the certificates to a subordinate
    entity. In this case, we refer to the subordinate entity as a *delegate CA*.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个组织中，根证书的签署者可能希望继续负责签署组织中所有实体的所有证书。也可能出现负责签署根证书的人希望将签署证书的责任委托给下属实体。在这种情况下，我们将下属实体称为*委托CA*。
- en: Istio’s certificate authority can be configured in multiple ways. By default,
    the CA generates a self-signed root certificate and key, which is used to sign
    the certificates for microservices. Istio’s CA can also sign certificates using
    an administrator-specified certificate and key and with an administrator-specified
    root certificate. The last configuration is most common in enterprise environments,
    where the CA is configured with an existing root certificate or delegated CA signing
    certificate and key.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: Istio的证书授权可以通过多种方式配置。默认情况下，CA生成一个自签名的根证书和密钥，用于签署微服务的证书。Istio的CA还可以使用管理员指定的证书和密钥以及管理员指定的根证书来签署证书。最后一种配置在企业环境中最为常见，其中CA配置了现有的根证书或委托CA签名证书和密钥。
- en: The CA in Istio is used to securely provision strong identities to every workload
    in the mesh. Certificates are issued using X.509 certificates, which is a standard
    that defines the format of public key certificates. X.509 certificates are used
    in many protocols, including TLS/SSL, which is the basis for HTTPS, the secure
    protocol for browsing the web.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: Istio中的CA用于为网格中的每个工作负载安全地提供强大的身份。证书使用X.509证书颁发，这是一个定义公钥证书格式的标准。X.509证书用于许多协议中，包括TLS/SSL，这是HTTPS的基础，是浏览网页的安全协议。
- en: Istio agents, running alongside each Envoy proxy, work together with the Istio
    CA component of istiod to automate key and certificate rotation at scale. Because
    the rotation and distribution of certificates is automated, once configured, little
    overhead remains for operators or users of the cluster—a powerful feature of Istio
    to secure communications between services.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: Istio代理，与每个Envoy代理并行运行，与istiod的Istio CA组件协同工作，以实现大规模的关键和证书轮换自动化。由于证书的轮换和分发是自动化的，一旦配置完成，集群的操作员或用户几乎不需要额外的开销——这是Istio确保服务间通信安全的一个强大功能。
- en: Certificates are the building block for additional security in our service mesh.
    In the next section, we will discuss authentication and mutual TLS encryption—a
    security layer that relies on the issued certificates to secure the mesh workloads.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 证书是我们服务网格中额外安全的基础。在下一节中，我们将讨论身份验证和相互TLS加密——一个依赖于颁发的证书来保护网格工作负载的安全层。
- en: Istio authentication
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: Istio身份验证
- en: 'Istio uses peer authentication for service-to-service authentication and to
    verify the client initiating the connection. Istio also makes mTLS available as
    a full-stack solution for transport authentication, which can be enabled without
    requiring changes to any application code. Peer authentication provides the following
    benefits:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: Istio使用对等身份验证进行服务间身份验证和验证发起连接的客户端。Istio还提供mTLS作为全栈传输身份验证解决方案，无需修改任何应用程序代码即可启用。对等身份验证提供了以下好处：
- en: Each service has a strong identity that represents its role to enable interoperability
    inside the clusters.
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个服务都有一个强大的身份，代表其在集群中的角色，以实现集群内部的互操作性。
- en: Encryption of all communication between services.
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 之间所有服务通信的加密。
- en: A key management system to automate the generation, distribution, and rotation
    of keys and certificates.
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个密钥管理系统，用于自动化密钥和证书的生成、分发和轮换。
- en: Istio allows request-level authentication with JSON Web Token (JWT) validation
    with many authentication providers (e.g., Google Auth [[https://developers.google.com/identity](https://developers.google.com/identity)]).
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: Istio 允许使用 JSON Web Token (JWT) 验证进行请求级别的认证，支持许多认证提供者（例如，Google Auth [[https://developers.google.com/identity](https://developers.google.com/identity)]）。
- en: Istio authorization
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: Istio 授权
- en: 'Istio provides a mechanism for operators to define authorization policies to
    control access to the service mesh, namespace, and workloads within the service
    mesh, as shown in figure 4.5\. Traffic can be restricted by type, such as TCP
    or HTTP, and the identity of the requestor. The advantages that authorization
    provides follow:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: Istio 为操作员提供了一种定义授权策略的机制，以控制对服务网格、命名空间以及服务网格内工作负载的访问，如图 4.5 所示。可以通过类型（如 TCP
    或 HTTP）和请求者的身份来限制流量。授权提供的优势如下：
- en: '*Authorization*—Between workloads and from user to workload.'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*授权*—在工作负载之间以及从用户到工作负载之间。'
- en: '*Flexible semantics*—Operators can define custom conditions on Istio attributes
    and use the DENY and ALLOW actions to tune the policies to suit their needs.'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*灵活的语义*—操作员可以在 Istio 属性上定义自定义条件，并使用 DENY 和 ALLOW 动作调整策略以满足其需求。'
- en: '*High performance*—Istio authorization is applied natively on the Envoy proxy.'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*高性能*—Istio 授权在 Envoy 代理上原生化应用。'
- en: '*Flexibility*—Supports gRPC, HTTP, HTTPS, and HTTP2 natively as well as all
    regular TCP protocols.'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*灵活性*—原生支持 gRPC、HTTP、HTTPS 和 HTTP2，以及所有常规 TCP 协议。'
- en: '*Distributed*—Each Envoy proxy runs its own authorization engine that authorizes
    each request to be executed.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*分布式*—每个 Envoy 代理运行自己的授权引擎，授权每个请求执行。'
- en: '![04-05](../../OEBPS/Images/04-05.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![04-05](../../OEBPS/Images/04-05.png)'
- en: Figure 4.5 Istio authorization architecture
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.5 Istio 授权架构
- en: At the beginning of the chapter, we mentioned that one advantage of a service
    mesh was the ability to organize microservices. As your number of services grows,
    so does your architecture’s complexity. The only way to maintain health and to
    troubleshoot problems in services is to have a powerful set of tools that allow
    you to look deep into the mesh activities. In the next section, we will go over
    the tools that you can use with Istio to view the activities in the mesh.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章开头，我们提到服务网格的一个优势是能够组织微服务。随着服务数量的增长，你的架构复杂性也会增加。维护健康状态和排查服务问题的唯一方法是拥有一个强大的工具集，允许你深入了解网格活动。在下一节中，我们将介绍你可以与
    Istio 一起使用的工具，以查看网格中的活动。
- en: 4.3.4 Istio observability
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.3.4 Istio 可观察性
- en: To offer a view into the service mesh, Istio features multiple add-on components
    ([https://istio.io/latest/docs/tasks/observability/](https://istio.io/latest/docs/tasks/observability/))
    that provide distributed tracing, metrics and logging, and a dashboard.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提供对服务网格的视图，Istio 提供了多个附加组件 ([https://istio.io/latest/docs/tasks/observability/](https://istio.io/latest/docs/tasks/observability/))，这些组件提供分布式跟踪、指标和日志记录以及仪表板。
- en: Istio contains a few options that provide a mesh with distributed tracing. Distributed
    tracing allows you to track the user through all the services and understand request
    latency, serialization, and parallelism. You can configure Istio to send distributed
    metrics to different systems, including Jaeger ([https://www.jaegertracing.io/](https://www.jaegertracing.io/)),
    Zipkin ([https://zipkin.io/](https://zipkin.io/)), and Lightstep ([https://lightstep.com/](https://lightstep.com/)).
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: Istio 包含一些选项，提供具有分布式跟踪的网格。分布式跟踪允许你跟踪用户通过所有服务，并了解请求延迟、序列化和并行性。你可以配置 Istio 将分布式指标发送到不同的系统，包括
    Jaeger ([https://www.jaegertracing.io/](https://www.jaegertracing.io/))、Zipkin
    ([https://zipkin.io/](https://zipkin.io/)) 和 Lightstep ([https://lightstep.com/](https://lightstep.com/))。
- en: 'Jaeger, a distributed tracing system released as open source by Uber Technologies,
    is used for monitoring and troubleshooting microservices-based distributed systems,
    including the following features: distributed context propagation, distributed
    transaction monitoring, root cause analysis, service dependency analysis, and
    performance optimization.'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: Jaeger 是 Uber 技术公司作为开源发布的一个分布式跟踪系统，用于监控和调试基于微服务的分布式系统，包括以下功能：分布式上下文传播、分布式事务监控、根本原因分析、服务依赖分析以及性能优化。
- en: Zipkin and Lightstep are other distributed tracing systems. They help gather
    timing data needed to troubleshoot latency problems in service architectures.
    Features include both the collection and lookup of this data.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: Zipkin 和 Lightstep 是其他分布式跟踪系统。它们帮助收集解决服务架构中延迟问题的所需时间数据。功能包括收集和查找此数据。
- en: You can collect all the metrics and logs from Envoy proxies and TCP sessions
    and customize the metrics using Istio metrics, making available all the data via
    Kiali ([https://kiali.io/](https://kiali.io/)), Prometheus ([https://prometheus.io/](https://prometheus.io/)),
    or Grafana ([https://grafana.com/](https://grafana.com/)).
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从 Envoy 代理和 TCP 会话收集所有指标和日志，并使用 Istio 指标自定义指标，通过 Kiali ([https://kiali.io/](https://kiali.io/))、Prometheus
    ([https://prometheus.io/](https://prometheus.io/)) 或 Grafana ([https://grafana.com/](https://grafana.com/))
    使所有数据可用。
- en: Kiali, shown in figure 4.6, is a management console for Istio-based service
    meshes that can build a service graph based on the telemetry data sourced from
    Envoy sidecar proxies. Kiali provides dashboards and observability and lets you
    operate your mesh with robust configuration and validation capabilities. It shows
    the structure of your service mesh by inferring traffic topology and displays
    the health of your mesh. Kiali provides detailed metrics, powerful validation,
    Grafana access, and strong integration for distributed tracing with Jaeger. This
    application allows you to use Kubernetes JWT tokens to provide native RBAC permission.
    The JWT presented by the user allows access to all namespaces they have access
    to in the cluster while denying all users that do not have permissions to the
    namespaces—all without any configuration required by cluster admins.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 如图 4.6 所示的 Kiali，是一个基于 Istio 的服务网格的管理控制台，可以根据来自 Envoy 侧边代理的遥测数据构建服务图。Kiali 提供仪表板和可观察性，并让您通过强大的配置和验证功能操作您的网格。它通过推断流量拓扑显示您的服务网格结构，并显示您的网格健康状况。Kiali
    提供详细的指标、强大的验证、Grafana 访问以及与 Jaeger 的强大集成，用于分布式跟踪。此应用允许您使用 Kubernetes JWT 令牌提供原生
    RBAC 权限。用户提供的 JWT 允许访问他们在集群中可以访问的所有命名空间，同时拒绝所有没有对命名空间权限的用户——所有这些都不需要集群管理员进行任何配置。
- en: '![04-06](../../OEBPS/Images/04-06.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![04-06](../../OEBPS/Images/04-06.png)'
- en: Figure 4.6 Kiali console UI
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.6 Kiali 控制台 UI
- en: 'Prometheus is an open source system-monitoring and -alerting application that
    has the following features: a multidimensional data model with time-series data
    identified by metric name and key-value pairs, and a flexible query language to
    use this dimensionality named PromQL. The time-series collection happens via a
    pull model over HTTP, and pushing time series is supported via an intermediary
    gateway.'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: Prometheus 是一个开源的系统监控和警报应用，具有以下特性：一个多维数据模型，通过指标名称和键值对识别时间序列数据，以及一个名为 PromQL
    的灵活查询语言来使用这种维度。时间序列收集通过 HTTP 的拉模型进行，并且支持通过中介网关推送时间序列。
- en: Grafana is open source visualization and analytics software application. It
    allows you to query, visualize, alert on, and explore your metrics, no matter
    where they are stored. It provides you with tools to turn your time-series database
    data into beautiful graphs and visualizations. Grafana can connect with Prometheus
    and Kiali.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: Grafana 是一个开源的可视化和分析软件应用。它允许您查询、可视化、警报和探索您的指标，无论它们存储在哪里。它为您提供了将时间序列数据库数据转换为美丽图表和可视化的工具。Grafana
    可以连接到 Prometheus 和 Kiali。
- en: Now that we have looked at Istio, let’s see what features and advantages Istio
    offers when it is used by Anthos Service Mesh, managed by Google Cloud.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了 Istio，让我们看看 Istio 在由 Google Cloud 管理的 Anthos 服务网格中使用时提供了哪些功能和优势。
- en: 4.4 What is Anthos Service Mesh?
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.4 什么是 Anthos 服务网格？
- en: Anthos Service Mesh has a suite of features and tools that help you observe
    and manage secure, reliable services in a unified way. With Anthos Service Mesh,
    you get an Anthos-tested and -supported distribution of Istio, managed by Google,
    letting you create and deploy a service mesh on GKE on Google Cloud and other
    platforms, with full Google support.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos Service Mesh 提供了一系列功能和工具，帮助您以统一的方式观察和管理安全、可靠的服务。使用 Anthos Service Mesh，您将获得
    Google 测试和支持的 Istio 分发版，由 Google 管理，让您能够在 Google Cloud 和其他平台上创建和部署服务网格，并获得完整的
    Google 支持。
- en: The use of Istio features in Anthos Service Mesh varies according to the architecture
    you want to design and implement, including full cloud, multicloud, hybrid cloud,
    or edge. Each implementation has different available features; therefore, it is
    necessary to check the availability of the supported features for the various
    scenarios (see [http://mng.bz/81R2](http://mng.bz/81R2)).
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 根据您想要设计和实施的架构，在 Anthos Service Mesh 中使用 Istio 功能会有所不同，包括全云、多云、混合云或边缘。每种实现都有不同的可用功能；因此，有必要检查各种场景支持的功能可用性（见
    [http://mng.bz/81R2](http://mng.bz/81R2)）。
- en: 'Before installing Anthos Service Mesh, always check the documentation and choose
    the most suitable and updated configuration profile. The configuration profiles,
    YAML files that are used by the IstioOperator API, define and configure the features
    installed with Anthos Service Mesh. At time of writing, you can install ASM in
    the following scenarios:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装 Anthos Service Mesh 之前，请始终检查文档并选择最合适和最新的配置配置文件。配置配置文件是 IstioOperator API
    使用的 YAML 文件，用于定义和配置与 Anthos Service Mesh 一起安装的功能。截至编写时，您可以在以下场景中安装 ASM：
- en: Anthos cluster (GKE) on Google Cloud in a single project
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在单个项目中运行的 Google Cloud 上的 Anthos 集群 (GKE)
- en: Anthos cluster (GKE) on Google Cloud between different projects
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在不同项目之间运行的 Google Cloud 上的 Anthos 集群 (GKE)
- en: Anthos cluster (GKE) on VMware
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 VMware 上的 Anthos 集群 (GKE)
- en: Anthos cluster (GKE) on bare metal
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在裸金属上运行的 Anthos 集群 (GKE)
- en: Anthos cluster (GKE) on AWS
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 AWS 上运行的 Anthos 集群 (GKE)
- en: Attached cluster Amazon Elastic Kubernetes Service (Amazon EKS)
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 附加集群 Amazon Elastic Kubernetes Service (Amazon EKS)
- en: Attached cluster Microsoft Azure Kubernetes Service (Microsoft AKS)
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 附加集群 Microsoft Azure Kubernetes Service (Microsoft AKS)
- en: 4.5 Installing ASM
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.5 安装 ASM
- en: 'You install ASM differently on GKE clusters on GCP and on-prem. You can view
    the most current installation procedures on the ASM site at [http://mng.bz/El7l](http://mng.bz/El7l).
    Explaining each option of the installation is beyond the scope of a single chapter,
    but the steps to deploy ASM on a GKE cluster with all components for testing requires
    only a few steps, as described next for ASM 1.12 in a cluster:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 您在 GCP 上的 GKE 集群和本地安装 ASM 的方式不同。您可以在 ASM 网站上查看最新的安装程序，网址为 [http://mng.bz/El7l](http://mng.bz/El7l)。解释安装的每个选项超出了单章的范围，但将
    ASM 部署到 GKE 集群并包含所有测试组件的步骤只需要几个步骤，如下所述，针对 ASM 1.12 在集群中：
- en: 'Download the ASM installation script as follows:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按以下方式下载 ASM 安装脚本：
- en: '[PRE0]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Make the script executable like this:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使脚本可执行如下：
- en: '[PRE1]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Install ASM using asmcli:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 asmcli 安装 ASM：
- en: '[PRE2]'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: After Istio is deployed into the Kubernetes cluster, you can start configuring
    and using it right away. One of the first things to do is define which approach
    you want to follow to make proxies communicate within the service mesh.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Istio 部署到 Kubernetes 集群后，您可以直接开始配置和使用它。要做的第一件事是定义您想要采用哪种方法来使代理在服务网格内进行通信。
- en: In the next section, we will define how Istio handles the sidecar proxy injection.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将定义 Istio 如何处理边车代理注入。
- en: 4.5.1 Sidecar proxy injection
  id: totrans-130
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.1 边车代理注入
- en: Activating Anthos Service Mesh features is an easy, transparent process, thanks
    to the possibility of injecting a sidecar proxy next to each workload or microservice.
    You can inject a sidecar proxy manually by updating your Pods’ Kubernetes manifest,
    or you can use automatic sidecar injection. By default, sidecar autoinjection
    is disabled for all namespaces. To enable autoinjection for a single namespace,
    execute
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 由于可以在每个工作负载或微服务旁边注入边车代理，因此激活 Anthos Service Mesh 功能是一个简单、透明的过程。您可以通过更新 Pod 的
    Kubernetes 清单手动注入边车代理，或者您可以使用自动边车注入。默认情况下，所有命名空间都禁用了边车自动注入。要为单个命名空间启用自动注入，请执行
- en: '[PRE3]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: where NAMESPACE is the name of the *namespace f*or your application’s services
    and rev=asm-managed is the release channel (see [http://mng.bz/Nm72](http://mng.bz/Nm72)*)*.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 NAMESPACE 是您应用程序服务的 *namespace* 名称，rev=asm-managed 是发布渠道（见 [http://mng.bz/Nm72](http://mng.bz/Nm72)）*。
- en: All channels are based on a generally available (GA) release (although individual
    features may not always be GA, as marked). New Anthos Service Mesh versions are
    first released to the Rapid channel and over time are promoted to the Regular
    and Stable channels. This progression allows you to select a channel that meets
    your business, stability, and functionality needs.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 所有通道都基于一般可用（GA）版本（尽管某些功能可能并非总是GA，如标记所示）。新的Anthos Service Mesh版本首先发布到快速通道，随着时间的推移，将升级到常规和稳定通道。这种进展允许您选择满足您的业务、稳定性和功能需求的通道。
- en: Because sidecars are injected when Pods are created, after you execute the command,
    you must restart any running Pods for the change to take effect. When Kubernetes
    invokes the webhook, the admissionregistration.k8s.io/v1beta1#MutatingWebhookConfiguration
    configuration is applied. The default configuration injects the sidecar into Pods
    in any namespace with the istio-injection=enabled label. The label should be consistent
    with the previous command. The istio-sidecar-injector configuration map specifies
    the configuration for the injected sidecar.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 由于sidecar在创建Pod时注入，在您执行命令后，您必须重启任何正在运行的Pod以使更改生效。当Kubernetes调用webhook时，将应用admissionregistration.k8s.io/v1beta1#MutatingWebhookConfiguration配置。默认配置将sidecar注入到任何命名空间中带有istio-injection=enabled标签的Pod中。该标签应与上一个命令一致。istio-sidecar-injector配置映射指定了注入sidecar的配置。
- en: 'The way you restart Pods depends very much on the way they were created, as
    described here:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 您重启Pod的方式很大程度上取决于它们的创建方式，如这里所述：
- en: 'If you used a deployment, you should update or recreate the deployment first
    like this, which will restart all Pods, adding the sidecar proxies:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您使用了部署，您应该首先更新或重新创建部署，如下所示，这将重启所有Pod，并添加sidecar代理：
- en: '[PRE4]'
  id: totrans-138
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'If you didn’t use a deployment, you should delete the Pods as follows. They
    will be automatically recreated with sidecars:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您没有使用部署，您应该按照以下方式删除Pod。它们将自动与sidecar一起重新创建：
- en: '[PRE5]'
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Check that all the Pods in the namespace have sidecars injected:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查命名空间中的所有Pod是否都注入了sidecar：
- en: '[PRE6]'
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'In the following example, output from the previous command, you will notice
    that the READY column indicates two containers exist for each of your workloads:
    the *primary container and the container for the sidecar proxy:*'
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在以下示例中，您将注意到上一个命令的输出中，READY列表明每个工作负载存在两个容器：*主容器和sidecar代理容器*：
- en: '[PRE7]'
  id: totrans-144
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: We have now seen how to install Anthos Service Mesh, using the approach with
    a sidecar proxy, and how important it is to choose the right profile. Now let’s
    see what the other features of Anthos Service Mesh are and the advantages of using
    them.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经看到了如何使用带有sidecar代理的方法安装Anthos Service Mesh，以及选择正确配置文件的重要性。现在让我们看看Anthos
    Service Mesh的其他功能和使用它们的优点。
- en: 4.5.2 Uniform observability
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.2 统一可观察性
- en: One of the most important and useful features of the Anthos Service Mesh is
    observability. Implementing a service mesh through the proxy architecture and
    taking advantage of the Google Cloud Monitoring services ensures in-depth visibility
    of what is happening among the various microservices present in the mesh.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos Service Mesh最重要的和最有用的功能之一是可观察性。通过代理架构实现服务网格并利用Google Cloud Monitoring服务确保对网格中存在的各种微服务之间发生的事情有深入的了解。
- en: Through the proxy, each microservice can send telemetry automatically, without
    the developers having to add any code in their application. All traffic is intercepted
    by proxies, and the telemetry data is sent to Anthos Service Mesh. In addition,
    each proxy sends the data to Google Cloud Monitoring and Google Cloud Logging
    without any extra development, using the APIs that Google makes available.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 通过代理，每个微服务可以自动发送遥测数据，开发者无需在应用程序中添加任何代码。所有流量都被代理拦截，遥测数据被发送到Anthos Service Mesh。此外，每个代理都会将数据发送到Google
    Cloud Monitoring和Google Cloud Logging，无需额外开发，使用Google提供的API。
- en: 'The Anthos Service Mesh control plane discussed in chapter 1 provides two main
    dashboards: table view and topology view. In the table view, you have a complete
    view of all the services deployed in the cluster. You can see all the metrics,
    and you can add SLI and SLO to better monitor your services.'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 第1章中讨论的Anthos Service Mesh控制平面提供了两个主要仪表板：表格视图和拓扑视图。在表格视图中，您可以看到集群中部署的所有服务。您可以查看所有指标，并且可以添加SLI和SLO以更好地监控您的服务。
- en: In the topology view, service meshes are represented as a graphical map. All
    the services such as workloads, Pod, systems services, and relative owners are
    connected as a network of nodes. This view provides a comprehensive look at the
    overall performance of the entire service mesh and an inside look into each node
    with detailed information.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 在拓扑视图中，服务网格以图形地图的形式表示。所有服务，如工作负载、Pod、系统服务和相关所有者都作为节点网络连接。此视图提供了对整个服务网格整体性能的全面了解，以及对每个节点内部信息的深入了解。
- en: 4.5.3 Operational agility
  id: totrans-151
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.3 运营敏捷性
- en: If observability is one of the most “visible” features for managing a service
    mesh, then the management of traffic within a microservices architecture is another
    fundamental asset to manage operations easily. Because Anthos Service Mesh is
    based on Istio, it inherits most of the traffic and network management features
    that Istio provides ([http://mng.bz/DZ79](http://mng.bz/DZ79)*),* so let’s look
    at these features next.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 如果可观察性是管理服务网格最“明显”的功能之一，那么在微服务架构中管理流量则是另一个管理操作的基本资产。由于Anthos Service Mesh基于Istio，它继承了Istio提供的多数流量和网络管理功能([http://mng.bz/DZ79](http://mng.bz/DZ79)*)，因此接下来让我们看看这些功能。
- en: Request routing and traffic splitting
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 请求路由和流量分割
- en: Using Istio, you can redirect traffic to multiple versions of the same microservice
    deployed in the cluster and safely (under a possible quota) control part of the
    traffic from an old version of the microservice to a newly installed version.
    Both options allow you to be agile in the deployment of new features or to fix
    bugs that may affect the business.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Istio，您可以将流量重定向到集群中部署的同一微服务的多个版本，并安全地（在可能的配额下）控制从微服务的旧版本到新安装版本的部分流量。这两种选项都允许您在部署新功能或修复可能影响业务的错误时保持敏捷。
- en: For example, let’s imagine we need to urgently fix a microservice. After the
    deployment of the new version, we can redirect a small part of the incoming traffic,
    verify that the fix works correctly, and then completely redirect the traffic
    to the new version without any downtime. If the fix is carried out only for a
    specific case, it is possible to keep both versions of the microservice active,
    redirecting traffic to both versions based on preestablished rules, without necessarily
    having to delete the old version, which is working well for most cases.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，让我们假设我们需要紧急修复一个微服务。在新版本部署后，我们可以将一小部分入站流量重定向，验证修复是否正确，然后完全将流量重定向到新版本，而无需任何停机时间。如果修复仅针对特定情况执行，则可以同时保持微服务的两个版本活跃，根据预先设定的规则将流量重定向到两个版本，而不必删除运行良好的旧版本。
- en: Through these traffic management features, Anthos Service Mesh can manage A/B
    testing, allowing you to direct a particular percentage of traffic to a new version
    of a service. This practice is helpful when you want to introduce a new version
    of a service by first testing it using a small percentage of user traffic and,
    if all goes well, then increasing the percentage while simultaneously phasing
    out the old version.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这些流量管理功能，Anthos Service Mesh可以管理A/B测试，允许您将特定百分比的流量引导到服务的某个新版本。当您想通过先使用一小部分用户流量测试新版本的服务，如果一切顺利，然后逐步增加百分比同时淘汰旧版本时，这种做法非常有用。
- en: Thanks to these functionalities, it is possible to implement canary deployments
    or progressive rollout strategies, directly testing the new versions of the services
    released. If the new version of the service experiences no problems with a small
    percentage of the traffic directed toward it, you could move all traffic to the
    new version and discard the old one.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 多亏了这些功能，可以直接测试发布的服务的新版本，实现金丝雀部署或渐进式发布策略。如果服务的新版本在少量流量下没有出现任何问题，您可以将所有流量转移到新版本，并丢弃旧版本。
- en: In figure 4.7, a canary deployment with traffic splitting is used to redirect
    5% of the traffic to test the new release of Service A.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在图4.7中，使用带有流量分流的金丝雀部署来将5%的流量重定向到测试服务A的新版本。
- en: '![04-07](../../OEBPS/Images/04-07.png)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![04-07](../../OEBPS/Images/04-07.png)'
- en: Figure 4.7 Istio canary deployment feature based on traffic
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.7 基于 流量的Istio金丝雀部署功能
- en: In figure 4.8, a canary deployment with traffic splitting is used to redirect
    the iPhone’s traffic to test the new release of Service A.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在图4.8中，使用带有流量分流的金丝雀部署将iPhone的流量重定向以测试服务A的新版本。
- en: '![04-08](../../OEBPS/Images/04-08.png)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![04-08](../../OEBPS/Images/04-08.png)'
- en: Figure 4.8 Istio canary deployment feature based on user-agent
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.8 基于 user-agent的Istio金丝雀部署功能
- en: The operations departments that manage the production environment take advantage
    of these features as they release plans for fixes and new versions of microservices.
    Each of these scenarios can be executed on the fly without disrupting the end
    users.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 管理生产环境的运维部门利用这些功能，在发布修复和新版本的微服务时计划。这些场景中的每一个都可以即时执行，而不会干扰最终用户。
- en: Circuit breaking
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 电路断开
- en: Microservices architectures were born to be scalable, agile, and resilient,
    but it is not always easy to design and implement these architectures to manage
    high workloads or manage integration with external services with consequent possible
    downtime or timeout. As mentioned earlier, the service mesh is independent of
    the application code and the programming language used, and, consequently, this
    facilitates the adoption of functions dedicated to the management of the office.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 微服务架构是为了可扩展性、敏捷性和弹性而生的，但设计并实现这些架构以管理高负载或管理外部服务的集成并不总是容易，这可能导致可能的停机或超时。如前所述，服务网格独立于应用程序代码和使用的编程语言，因此这有助于采用专门用于管理办公室的功能。
- en: The functionality that allows you to manage timeouts, failures, and loads on
    the architecture is called *circuit breaking* ([http://mng.bz/lJAM](http://mng.bz/lJAM)).
    When you design a microservices architecture, you must always put yourself in
    position to manage faults correctly. These faults may have been caused not only
    by bugs in the application code but also from external factors, for example, in
    the network or infrastructure. In the event of a fault or failure to reach the
    SLA (on availability and/or performance of a given service), circuit breaking
    automatically allows you to redirect traffic to another microservice or external
    service to limit downtime or to limit the loss of functionality by the end user.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 允许您管理架构中的超时、故障和负载的功能称为 *电路断开* ([http://mng.bz/lJAM](http://mng.bz/lJAM))。在设计微服务架构时，您必须始终确保能够正确处理故障。这些故障可能不仅是由应用程序代码中的错误引起的，也可能是由外部因素引起的，例如网络或基础设施。在发生故障或无法达到
    SLA（特定服务的可用性和/或性能）的情况下，电路断开会自动允许您将流量重定向到另一个微服务或外部服务，以限制停机时间或限制最终用户功能损失。
- en: Let’s see an example. In figure 4.9, the service consumer is invoking Istio
    Ingress to call Service A, which is distributed in two Pods. Let’s assume that
    Service A inside Pod 1 has a load problem and becomes unreachable. Thanks to the
    circuit breaking feature, Istio will close the connection of the proxy to Service
    A inside Pod 1 and redirect all traffic to the proxy inside Pod 2, until Service
    A in Pod 1 works properly again.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看一个例子。在图 4.9 中，服务消费者正在调用 Istio 入口以调用 Service A，该服务分布在两个 Pod 中。假设 Service
    A 在 Pod 1 中存在负载问题，变得不可达。多亏了电路断开功能，Istio 将关闭代理到 Pod 1 中 Service A 的连接，并将所有流量重定向到
    Pod 2 中的代理，直到 Pod 1 中的 Service A 正常工作。
- en: '![04-09](../../OEBPS/Images/04-09.png)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![04-09](../../OEBPS/Images/04-09.png)'
- en: Figure 4.9 Istio circuit breaking feature example
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.9 Istio 电路断开功能示例
- en: Egress control
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 出口控制
- en: Usually, when it comes to service mesh, an important feature is the control
    of the Ingress gateway to ensure absolute security to the network. However, if
    we find ourselves in situations for which the regulations (e.g., PCI [[http://mng.bz/Bl7g](http://mng.bz/Bl7g)])
    or the customer’s requirements require us to also control the outgoing traffic
    from the service mesh, then, thanks to Istio and thanks to the egress gateway
    control, we can cover the security required.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 通常情况下，当涉及到服务网格时，一个重要的功能是控制入口网关以确保网络的安全性。然而，如果我们发现自己处于需要我们控制服务网格出向流量的情况下（例如，法规要求，如
    PCI [[http://mng.bz/Bl7g](http://mng.bz/Bl7g)]）或客户的要求，那么，多亏了 Istio 和出口网关控制，我们可以覆盖所需的安全。
- en: With Anthos Service Mesh, you can configure the routing of the traffic from
    the service mesh to the external services (HTTP or HTTPS) using a dedicated Egress
    gateway or an external HTTPS proxy, if necessary, to perform TLS origination (SDS
    or file mount) from the service mesh for the connection on those external services.
    See figure 4.10 for an illustration.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Anthos Service Mesh，您可以通过专用出口网关或必要时使用外部 HTTPS 代理来配置从服务网格到外部服务（HTTP 或 HTTPS）的流量路由。对于这些外部服务的连接，从服务网格执行
    TLS 原始（SDS 或文件挂载）。请参阅图 4.10 以了解说明。
- en: '![04-10](../../OEBPS/Images/04-10.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![04-10](../../OEBPS/Images/04-10.png)'
- en: Figure 4.10 Istio egress control example
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.10 Istio 出口控制示例
- en: 4.5.4 Policy-driven security
  id: totrans-176
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.5.4 政策驱动安全
- en: Since the adoption of containers, shared services, and distributed architectures,
    it has become more difficult to mitigate insider threats and minimize and limit
    data breaches, ensuring that communications between workloads remain encrypted,
    authenticated, and authorized. Anthos Service Mesh security features ([http://mng.bz/dJOX](http://mng.bz/dJOX)*)*
    help mitigate these threats, configuring context-sensitive service levels or context-sensitive
    networks.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 自从采用容器、共享服务和分布式架构以来，减轻内部威胁和最小化及限制数据泄露变得更加困难，确保工作负载之间的通信保持加密、认证和授权。Anthos Service
    Mesh的安全功能([http://mng.bz/dJOX](http://mng.bz/dJOX)*)*有助于减轻这些威胁，配置上下文相关的服务级别或上下文相关的网络。
- en: 'Before offerings like Istio, securing an application was the responsibility
    of the application developer, and many of the tasks were complex and time consuming,
    including the following:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 在Istio等解决方案出现之前，保护应用程序是应用程序开发者的责任，许多任务复杂且耗时，包括以下内容：
- en: Encrypting the communications between the application and other services, which
    required certificate management and maintenance
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 加密应用程序与其他服务之间的通信，这需要证书管理和维护
- en: Creating modules that were language specific to authenticate access based on
    open identity standards like JSON web tokens (JWTs)
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建特定语言的模块以基于开放身份标准（如JSON Web令牌（JWTs））进行访问认证
- en: Implementing a complex authorization system to limit the permissions allowed
    using the assertions on the presented JWT
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实施复杂的授权系统以限制使用呈现的JWT上的断言允许的权限
- en: Instead of a developer taking time to create and manage this security, they
    can take advantage of the features of Istio, which address each of these tasks
    without any additional code required.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 而不是开发者花费时间创建和管理这种安全措施，他们可以利用Istio的功能，这些功能无需任何额外代码即可解决每个任务。
- en: With Anthos Service Mesh, it is possible to adopt an in-depth defense posture
    consistent with zero-trust security principles via declarative criteria and without
    modifying any application code. The principal security features in ASM are the
    managed private certificate authority, Identity-Aware access controls, request
    claims-aware access control policies, user authentication with Identity-Aware
    Proxy, and access logging and monitoring.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Anthos Service Mesh，可以通过声明性标准和无需修改任何应用程序代码的方式，采用与零信任安全原则一致的深度防御姿态。ASM的主要安全特性包括管理的私有证书颁发机构、基于身份的访问控制、请求声明感知的访问控制策略、使用基于身份的代理进行用户认证以及访问日志和监控。
- en: The first feature, the managed private certificate authority (Mesh CA), includes
    a Google-managed multiregional private certificate authority for issuing certificates
    for mTLS. The Mesh CA is a highly reliable and scalable service, optimized for
    dynamically scaled workloads on a cloud platform. Mesh CA lets you rely on a single
    root of trust across Anthos clusters. When using Mesh CA, you can rely on workload
    identity pools to provide coarse-grained isolation. By default, authentication
    fails if the client and the server are not in the same workload identity pool.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个特性，管理的私有证书颁发机构（Mesh CA），包括为mTLS颁发证书的Google管理的多区域私有证书颁发机构。Mesh CA是一个高度可靠和可扩展的服务，针对云平台上的动态扩展工作负载进行了优化。Mesh
    CA允许您在Anthos集群之间依赖单一信任根。当使用Mesh CA时，您可以使用工作负载身份池提供粗粒度隔离。默认情况下，如果客户端和服务器不在同一工作负载身份池中，则认证失败。
- en: The next feature, Identity-Aware access control (firewall) policies, allows
    you to configure network security policies based on the mTLS identity versus the
    IP address of the peer. This lets you create policies that are independent of
    the network location of the workload. Only communications across clusters in the
    same Google Cloud project are currently supported.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个特性，基于身份的访问控制（防火墙）策略，允许您根据mTLS身份与对等方的IP地址配置网络安全策略。这使您能够创建独立于工作负载网络位置的策略。目前仅支持同一Google
    Cloud项目中集群之间的通信。
- en: The third feature, request claims-aware access control (firewall) policies,
    enables you to grant access to services based on request claims in the JWT header
    of HTTP or gRPC requests. Anthos Service Mesh lets you assert that a JWT is signed
    by a trusted entity, so you can configure policies that allow access from certain
    clients only if a request claim exists or matches a specified value.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 第三个特性，请求声明感知的访问控制（防火墙）策略，允许您根据HTTP或gRPC请求的JWT头中的请求声明来授予对服务的访问权限。Anthos Service
    Mesh允许您断言JWT是由受信任实体签发的，因此您可以配置策略，仅当请求声明存在或与指定的值匹配时，才允许来自某些客户端的访问。
- en: The fourth feature, user authentication with Identity-Aware Proxy, authenticates
    users accessing any service exposed on an Anthos Service Mesh Ingress gateway
    by using Identity-Aware Proxy (IAP). IAP can authenticate users that log in from
    a browser, integrate with custom identity providers, and issue a short-lived JWT
    token or an RCToken that can then be used to grant access at the Ingress gateway
    or a downstream service (by using a sidecar).
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 第四个特性，使用身份感知代理进行用户身份验证，通过使用身份感知代理（IAP）对在Anthos Service Mesh Ingress网关上公开的任何服务进行访问的用户进行身份验证。IAP可以验证从浏览器登录的用户，与自定义身份提供者集成，并颁发一个短期有效的JWT令牌或RCToken，然后可以使用它通过边车在网关或下游服务（通过使用边车）授予访问权限。
- en: The final features, access logging and monitoring, ensure that access logs and
    metrics are available in Google Cloud’s operations suite and provides an integrated
    dashboard to understand access patterns for a service or workload based on this
    data. You can also choose to configure a private destination. Anthos Service Mesh
    lets you reduce noise in access logs by logging only successful accesses in a
    configurable time window. Requests that are denied by a security policy or result
    in an error are always logged, letting you significantly reduce the costs associated
    with ingesting, storing, and processing logs, without the loss of key security
    signals.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 最终特性，访问日志记录和监控，确保访问日志和指标在Google Cloud的操作套件中可用，并提供一个集成仪表板来理解基于这些数据的某个服务或工作负载的访问模式。您还可以选择配置一个私有目标。Anthos
    Service Mesh允许您通过仅记录可配置时间窗口内的成功访问来减少访问日志中的噪音。被安全策略拒绝或导致错误的请求始终会被记录，这样您可以显著减少与日志摄取、存储和处理相关的成本，而不会丢失关键的安全信号。
- en: 4.6 Conclusion
  id: totrans-189
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.6 结论
- en: In this chapter, we have seen what a service mesh is, what the advantages of
    implementing it are, and how Anthos Service Mesh exploits the potential of Istio
    to manage the entire service mesh. Thanks to Anthos Service Mesh, developers can
    be more agile in implementing microservices architectures and don’t need to worry
    about implementing monitoring probes within the application code, by taking advantage
    of sidecar proxy and proxyless approaches.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们了解了什么是服务网格，实施它的优势是什么，以及Anthos Service Mesh如何利用Istio的潜力来管理整个服务网格。得益于Anthos
    Service Mesh，开发者可以更敏捷地实施微服务架构，并且不需要担心在应用程序代码中实现监控探针，通过利用边车代理和无代理方法。
- en: The operations structures can monitor everything that happens within the service
    mesh in real time, guaranteeing the required service levels. The traffic splitting
    and rolling release features allow you to efficiently release new versions of
    the services, ensuring that everything works correctly. Thanks to the security
    features, the service mesh is protected from risks that can come from outside
    or inside the network, implementing effective authentication and authorization
    policies.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 运营结构可以实时监控服务网格内发生的所有事件，保证所需的服务级别。流量分割和滚动发布功能允许您有效地发布新版本的服务，确保一切正常工作。得益于安全功能，服务网格可以抵御来自网络外部或内部的潜在风险，实施有效的身份验证和授权策略。
- en: 4.7 Examples and case studies
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.7 例子和案例研究
- en: Using the knowledge from the chapter, address each of the requirements in the
    following case study.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 使用本章的知识，解决以下案例研究中的每个要求。
- en: 4.7.1 Evermore Industries
  id: totrans-194
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4.7.1 永恒工业
- en: Evermore Industries has asked you to enable ASM on a GKE cluster running in
    GCP. The cluster will be used for initial service mesh testing and should be installed
    with all features to allow the developers to test any feature. They have also
    asked you to deploy an online Boutique application to prove that the service mesh
    is up and running as expected.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 永恒工业要求您在GCP上运行的GKE集群上启用ASM。该集群将用于初始服务网格测试，并应安装所有功能，以便开发者可以测试任何功能。他们还要求您部署一个在线精品应用程序，以证明服务网格按预期运行。
- en: Because they are new to Istio and the advantages of using a service mesh, they
    do not have any special requirements outside of deploying ASM and the Boutique
    demo application. The only additional requirement is to provide proof that the
    Boutique application is running in the mesh as expected, from the GCP console.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 由于他们刚开始使用Istio以及使用服务网格的优势，他们除了部署ASM和精品演示应用程序外，没有其他特殊要求。唯一的额外要求是提供证明，表明精品应用程序在GCP控制台中按预期在网格中运行。
- en: The next section contains the solution to address Evermore’s requirements. You
    can follow along with the solution, or, if you are comfortable, you can configure
    your cluster to address the requirements and use the solution to verify your results.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 下一节包含解决Evermore需求的解决方案。您可以跟随解决方案进行操作，或者如果您感到舒适，您可以配置您的集群以满足需求，并使用解决方案来验证您的结果。
- en: 'Evermore Industries solution: Installing ASM'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: Evermore Industries解决方案：安装ASM
- en: 'To install ASM, you can download the ASM installation script to deploy ASM
    with all components installed. Follow the next steps to install ASM with all components
    on your GKE cluster running in GCP:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装ASM，您可以下载ASM安装脚本以部署带有所有组件的ASM。按照以下步骤在运行在GCP上的GKE集群上安装带有所有组件的ASM：
- en: 'Download the ASM installation script:'
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载ASM安装脚本：
- en: '[PRE8]'
  id: totrans-201
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Make the installer executable:'
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使安装器可执行：
- en: '[PRE9]'
  id: totrans-203
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'You will need the following information from your project and GKE cluster to
    execute the installation script: Project ID, GKE cluster name, and the GKE cluster
    location.'
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您需要从您的项目和GKE集群中获取以下信息以执行安装脚本：项目ID、GKE集群名称和GKE集群位置。
- en: 'Execute the installation script with the information from your cluster to install
    ASM:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用您的集群信息执行安装脚本以安装ASM：
- en: '[PRE10]'
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The installation will take a few minutes. Once the installation is complete,
    you will see a message like the one shown here:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装将花费几分钟。一旦安装完成，您将看到类似以下的消息：
- en: '[PRE11]'
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Verify that the istio-system namespace has healthy Pods that have been started
    successfully using the following code:'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下代码验证istio-system命名空间中是否有健康且成功启动的Pods：
- en: '[PRE12]'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'This should show you that there are four running Pods: two istio-ingressgateway
    Pods and two istiod Pods. Example output follows:'
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这应该显示有四个正在运行的Pods：两个istio-ingressgateway Pods和两个istiod Pods。以下是一个示例输出：
- en: '[PRE13]'
  id: totrans-212
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Now that Istio has been deployed, you need to create a namespace and enable
    Istio for sidecar injection.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 现在Istio已部署，您需要创建一个命名空间并启用Istio以进行sidecar注入。
- en: 'Evermore Industries solution: Enabling sidecar injection'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: Evermore Industries解决方案：启用sidecar注入
- en: 'To enable the namespace for sidecar injection, follow the steps shown here:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 要为命名空间启用sidecar注入，请按照以下步骤操作：
- en: 'Create a namespace that will be used to deploy the Boutique application. In
    our example, we will use a namespace called demo:'
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个用于部署Boutique应用程序的命名空间。在我们的示例中，我们将使用名为demo的命名空间：
- en: '[PRE14]'
  id: totrans-217
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Next, we need to label the namespace with the correct label to enable sidecar
    injection. Starting with Istio 1.7, the label used to enable sidecar injection
    changed from a generic istio-injection to using the value of the control plane
    version.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要使用正确的标签标记命名空间以启用sidecar注入。从Istio 1.7开始，用于启用sidecar注入的标签从通用的istio-injection更改为使用控制平面版本的值。
- en: 'To find the control plane version we will use in the label, retrieve the labels
    in the istio-system namespace:'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要在标签中找到我们将使用的控制平面版本，检索istio-system命名空间中的标签：
- en: '[PRE15]'
  id: totrans-220
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'This will return the labels of the istiod Pods, which contains the value we
    need. The output will look similar to the following example. (Note: The label
    value we will need is in bold.)'
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将返回istiod Pods的标签，其中包含我们需要的值。输出将类似于以下示例。（注意：我们需要的标签值已加粗。）
- en: '[PRE16]'
  id: totrans-222
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Using the istio/io value, label the demo namespace to enable sidecar injection
    as follows:'
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用istio/io值，按照以下方式标记demo命名空间以启用sidecar注入：
- en: '[PRE17]'
  id: totrans-224
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Evermore Industries solution: Installing the Boutique application'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: Evermore Industries解决方案：安装Boutique应用程序
- en: 'Now that ASM has been installed and we have created a new namespace with the
    correct label to enable sidecar injection, we can deploy the Boutique application.
    Follow the next steps to deploy the Boutique demo:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 现在ASM已安装，并且我们已经创建了一个带有正确标签的新命名空间以启用sidecar注入，我们可以部署Boutique应用程序。按照以下步骤部署Boutique演示：
- en: 'Download the Boutique demo application from the Git repository. The following
    command will download the GIT repo into a directory called online-boutique:'
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从Git仓库下载Boutique演示应用程序。以下命令将下载GIT仓库到名为online-boutique的目录中：
- en: '[PRE18]'
  id: totrans-228
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Deploy the application using the files in the online-boutique directory:'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用online-boutique目录中的文件部署应用程序：
- en: '[PRE19]'
  id: totrans-230
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: This command will install several deployments and services into the demo namespace.
    It will take a few minutes for the Pods to start up. You can watch the namespace
    or list the Pods in the namespace to verify that each Pod enters a running state
    and that each Pod shows two containers. (Remember that each Pod will have a sidecar
    injected for the Istio proxy.)
  id: totrans-231
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此命令将安装几个部署和服务到演示命名空间。Pod启动可能需要几分钟。您可以监视命名空间或列出命名空间中的Pod以验证每个Pod进入运行状态，并且每个Pod显示两个容器。（请记住，每个Pod将为Istio代理注入一个sidecar。）
- en: 'Once all Pods are running, the demo namespace output should look similar to
    the following:'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦所有Pod都在运行，演示命名空间的输出应类似于以下内容：
- en: '[PRE20]'
  id: totrans-233
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'As part of the deployment, a load balancer service was created that allows
    connectivity to the Boutique application from the internet. To find the IP address
    that has been assigned, get the service called frontend-external in the demo namespace:'
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 作为部署的一部分，创建了一个负载均衡器服务，允许从互联网连接到Boutique应用程序。要找到分配的IP地址，请从演示命名空间获取名为frontend-external的服务：
- en: '[PRE21]'
  id: totrans-235
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: This code will output the service details, which will contain the external address
    you can use to verify the application is working.
  id: totrans-236
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此代码将输出服务详情，其中将包含您可以使用的外部地址来验证应用程序是否运行。
- en: Use the address from the output in step 3 to connect to the application from
    a web browser. Once you connect, you should see the main Boutique page, shown
    in figure 4.11.
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用步骤3中的输出地址通过网页浏览器连接到应用程序。一旦连接，您应该看到Boutique的主页，如图4.11所示。
- en: '![04-11](../../OEBPS/Images/04-11.png)'
  id: totrans-238
  prefs: []
  type: TYPE_IMG
  zh: '![04-11](../../OEBPS/Images/04-11.png)'
- en: Figure 4.11 Online Boutique web application
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.11在线Boutique网络应用程序
- en: 'Evermore Industries solution: Observing services using the GCP console'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: Evermore Industries解决方案：使用GCP控制台观察服务
- en: The final requirement from Evermore is to prove that the Boutique application
    is running in the mesh, using the GCP console. To prove this, you can navigate
    to Anthos > Service Mesh from the GCP console, as shown in figure 4.12.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: Evermore的最终要求是使用GCP控制台证明Boutique应用程序在网格中运行。为了证明这一点，您可以从GCP控制台导航到Anthos > 服务网格，如图4.12所示。
- en: '![04-12](../../OEBPS/Images/04-12.png)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![04-12](../../OEBPS/Images/04-12.png)'
- en: 'Figure 4.12 Google Cloud Console: Anthos menu'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.12 Google Cloud控制台：Anthos菜单
- en: This interface will provide a list of all services in the service mesh. The
    default table view, shown in figure 4.13, will show each service and metrics including
    requests, latency, and failures.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 此界面将提供服务网格中所有服务的列表。默认的表格视图，如图4.13所示，将显示每个服务及其指标，包括请求、延迟和失败。
- en: '![04-13](../../OEBPS/Images/04-13.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![04-13](../../OEBPS/Images/04-13.png)'
- en: 'Figure 4.13 Anthos Service Mesh: list of services'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.13 Anthos服务网格：服务列表
- en: You can change the view from the table view to a topology view by clicking the
    topology button in the upper-right corner of the console. This will provide a
    graphical topology layout of the mesh services, shown in figure 4.14.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过点击控制台右上角的拓扑按钮从表格视图更改到拓扑视图。这将提供网格服务的图形拓扑布局，如图4.14所示。
- en: '![04-14](../../OEBPS/Images/04-14.png)'
  id: totrans-248
  prefs: []
  type: TYPE_IMG
  zh: '![04-14](../../OEBPS/Images/04-14.png)'
- en: 'Figure 4.14 Anthos Service Mesh: topology view'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.14 Anthos服务网格：拓扑视图
- en: Both views will show services in the service mesh. Because we see the expected
    services for the Boutique application, this proves that the deployment is successfully
    working inside of the mesh. In this exercise, you deployed ASM in a GKE cluster,
    created a new namespace that was enabled for sidecar injection, and deployed a
    test application into the service mesh.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 两个视图都会显示服务网格中的服务。因为我们看到了Boutique应用程序的预期服务，这证明了部署在网格内部成功运行。在这个练习中，你在GKE集群中部署了ASM，创建了一个启用sidecar注入的新命名空间，并将测试应用程序部署到服务网格中。
- en: Summary
  id: totrans-251
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: A service mesh based on Anthos Service Mesh helps organizations run microservices
    at scale.
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于Anthos Service Mesh的服务网格有助于组织在规模上运行微服务。
- en: We covered all the components of Istio and what each component does to provide
    the service mesh features.
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们涵盖了Istio的所有组件以及每个组件如何提供服务网格功能。
- en: ASM increases security between workloads using mutual TLS (mTLS) to encrypt
    all communication between mesh resources and by using native Istio authentication
    and authorization policies.
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ASM通过使用相互TLS（mTLS）加密网格资源之间的所有通信以及使用本地的Istio身份验证和授权策略来提高工作负载之间的安全性。
- en: ASM provides traffic-routing abilities, allowing for a more flexible release
    process, including A/B testing and canary deployments.
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ASM提供流量路由能力，允许更灵活的发布过程，包括A/B测试和金丝雀部署。
- en: You can discover application failures before releasing any new code, which increases
    availability and resilience, using circuit breakers and fault injection to proactively
    find problems with how an application will handle common problems like network
    delays or HTTP errors.
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以在发布任何新代码之前发现应用程序故障，通过使用断路器和故障注入来主动查找应用程序处理常见问题（如网络延迟或 HTTP 错误）的方式，从而提高可用性和弹性。
- en: ASM provides visibility, monitoring, security, and control of the entire service
    mesh and between multiple environments.
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ASM 提供了对整个服务网格以及多个环境之间的可见性、监控、安全和控制。
- en: To use the features of ASM, developers do not need to modify their code, thanks
    to the Envoy proxy sidecar, which handles the traffic flow for the application.
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于 Envoy 代理边车的存在，开发者无需修改他们的代码即可使用 ASM 的功能，该边车负责处理应用程序的流量流。
