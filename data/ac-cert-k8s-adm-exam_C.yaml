- en: Appendix C. Installing a CNI in a kind cluster
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录 C. 在 kind 集群中安装 CNI
- en: This appendix shows how to install a new CNI in your kind cluster. We’ll install
    Flannel and Calico, which are both used for the CKA exam, going through the process
    step by step on how to do this within a kind cluster. This involves creating the
    kind cluster without a CNI, installing the bridge CNI plugin, and then installing
    either Flannel or Calico.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本附录展示了如何在你的 kind 集群中安装一个新的 CNI。我们将安装 Flannel 和 Calico，这两个都用于 CKA 考试，我们将逐步说明如何在
    kind 集群内完成这个过程。这包括创建一个没有 CNI 的 kind 集群，安装网桥 CNI 插件，然后安装 Flannel 或 Calico。
- en: C.1 Creating a kind cluster without CNI
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: C.1 不使用 CNI 创建 kind 集群
- en: 'Before we create a kind Kubernetes cluster, we must first create a YAML file
    that we can use as an input with the `kind create` command. Create a file named
    `config.yaml` and paste it in the contents like this:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们创建一个新的 Kubernetes 集群之前，我们必须首先创建一个 YAML 文件，我们可以使用这个文件作为 `kind create` 命令的输入。创建一个名为
    `config.yaml` 的文件，并将内容粘贴如下：
- en: '[PRE0]'
  id: totrans-4
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Now run the command `kind create cluster --image kindest/node:v1.25.0-beta.0
    --config config.yaml` to create a kind cluster according to the configuration
    we specified in the `config.yaml` file. The output will look similar to this:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，运行命令 `kind create cluster --image kindest/node:v1.25.0-beta.0 --config config.yaml`
    来根据我们在 `config.yaml` 文件中指定的配置创建一个 kind 集群。输出将类似于以下内容：
- en: '[PRE1]'
  id: totrans-6
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: C.2 Installing a bridge CNI plugin
  id: totrans-7
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: C.2 安装网桥 CNI 插件
- en: 'Now that our cluster is created, let’s get a shell to both of the node containers,
    one at a time, with the commands `docker exec -it kind-control-plane bash` and
    `docker exec -it kind-worker bash`. Once you have a Bash shell, go ahead and run
    the command `apt update; apt install wget` on both `kind-control-plane` and `kind-worker`.
    This will install wget, a command-line tool that we can use to download files
    from the web, which is what we’ll do with the command `wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz`.
    Because this file is a tarball, you’ll have to untar it with the command `tar
    -xvf cni-plugins-linux-amd64-v1.1.1.tgz`. The output will look similar to this:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经创建了集群，让我们通过命令 `docker exec -it kind-control-plane bash` 和 `docker exec
    -it kind-worker bash` 分别获取到两个节点容器的 shell，一次一个。一旦你有了 Bash shell，就可以在 `kind-control-plane`
    和 `kind-worker` 上运行命令 `apt update; apt install wget`。这将安装 wget，这是一个命令行工具，我们可以用它从网络上下载文件，这就是我们将使用
    `wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz`
    命令所做的事情。因为这是一个 tarball 文件，你需要使用命令 `tar -xvf cni-plugins-linux-amd64-v1.1.1.tgz`
    来解压它。输出将类似于以下内容：
- en: '[PRE2]'
  id: totrans-9
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The bridge file is the one that’s most important for our case, as this will
    provide the necessary plugin for Kubernetes to use Flannel as a CNI. This file
    also needs to be in a specific directory to be picked up for the cluster. That
    directory is `/opt/cni/bin/`, so we’ll move the file bridge to that directory
    with the command `mv bridge /opt/cni/bin``/`.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 网桥文件对于我们来说是最重要的，因为它将为 Kubernetes 提供使用 Flannel 作为 CNI 所必需的插件。此文件还需要位于特定的目录中，以便被集群识别。那个目录是
    `/opt/cni/bin/`，因此我们将使用命令 `mv bridge /opt/cni/bin/` 将文件 bridge 移动到那个目录。
- en: C.3 Installing Flannel CNI
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: C.3 安装 Flannel CNI
- en: 'Now that we’ve installed the bridge CNI plugin on both `kind-control-plane`
    and `kind-worker`, we can install Flannel CNI by creating the Flannel Kubernetes
    objects inside our cluster while inside of a shell on the control plane node with
    the command `kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml`.
    You can verify that the nodes are now in a ready state with the command `kubectl
    get no`. The output will look similar to this:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经在 `kind-control-plane` 和 `kind-worker` 上安装了网桥 CNI 插件，我们可以在控制平面节点的 shell
    内创建 Flannel Kubernetes 对象来安装 Flannel CNI，命令为 `kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml`。你可以使用命令
    `kubectl get no` 验证节点现在是否处于就绪状态。输出将类似于以下内容：
- en: '[PRE3]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'We can also verify that the CoreDNS Pods are running, as well as the Flannel
    Pods created and running, with the command `kubectl get po -A`. The output will
    look similar to this:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也可以使用命令 `kubectl get po -A` 验证 CoreDNS Pods 是否正在运行，以及 Flannel Pods 是否已创建并正在运行。输出将类似于以下内容：
- en: '[PRE4]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This will complete the setup of installing Flannel.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 这将完成 Flannel 安装的设置。
- en: C.4 Creating a new kind cluster
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: C.4 创建一个新的集群类型
- en: 'Installing the Calico CNI is very similar to installing Flannel, except for
    the YAML that’s used to create the Kubernetes objects. So, go through sections
    C.1 and C.2 again, and let’s proceed from there. If you already have a kind cluster
    running, you can either perform the command `kind delete cluster` to delete the
    existing cluster or you can create a new cluster named `cka` alongside the existing
    cluster with the command `kind create cluster --image kindest/node:v1.25.0-beta.0
    --config config.yaml --name cka``.` You will see an output similar to this:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 安装Calico CNI与安装Flannel非常相似，只是用于创建Kubernetes对象的YAML文件不同。因此，再次浏览C.1节和C.2节，然后从那里继续。如果你已经有一个kind集群在运行，你可以执行命令`kind
    delete cluster`来删除现有的集群，或者你可以使用命令`kind create cluster --image kindest/node:v1.25.0-beta.0
    --config config.yaml --name cka`在现有集群旁边创建一个名为`cka`的新集群。你将看到类似于以下输出的内容：
- en: '[PRE5]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: If you chose to install a new cluster alongside the one you already have to
    get a shell to the nodes, you have to address them by the correct prefix (e.g.,
    `cka`). For example, if you are following along and chose `cka` as the name for
    your cluster, to get a shell to the control plane node you would type `docker
    exec -it cka-control-plane bash`. To get a shell to the worker node, you would
    type `docker exec -it cka-worker bash`. Now that we’re caught up, let’s go through
    the process of installing Calico as our CNI.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你选择在已有的集群旁边安装一个新的集群以获取到节点shell，你必须使用正确的前缀来引用它们（例如，`cka`）。例如，如果你在跟随教程并选择了`cka`作为你的集群名称，要获取控制平面节点的shell，你应该输入`docker
    exec -it cka-control-plane bash`。要获取工作节点的shell，你应该输入`docker exec -it cka-worker
    bash`。现在我们已经跟上了进度，让我们继续安装Calico作为我们的CNI。
- en: C.5 Installing the Calico CNI
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: C.5 安装Calico CNI
- en: 'Picking up from section C.2 where you installed the bridge CNI plugin, let’s
    install the Kubernetes objects required to implement the Calico CNI. While in
    a shell to your control plane (e.g., `docker exec -it cka-control-plane bash`),
    you can create those Kubernetes objects with the command `kubectl apply -f https://raw.githubusercontent
    .com/projectcalico/calico/v3.25.0/manifests/calico.yaml``.` You will see a similar
    output to the following:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 从C.2节开始，那里你安装了Calico CNI插件，现在让我们安装实现Calico CNI所需的Kubernetes对象。在你控制平面的shell中（例如，`docker
    exec -it cka-control-plane bash`），你可以使用命令`kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.25.0/manifests/calico.yaml`来创建这些Kubernetes对象。你将看到类似于以下输出的内容：
- en: '[PRE6]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Now that you’ve installed the Kubernetes objects necessary to install the Calico
    CNI, you can verify that the nodes are in a ready status with the command `kubectl
    get no`. You’ll see output similar to the following:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经安装了安装Calico CNI所需的Kubernetes对象，你可以使用命令`kubectl get no`来验证节点是否处于就绪状态。你将看到类似于以下内容的输出：
- en: '[PRE7]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'You can also see that the CoreDNS Pods, as well as the Calico Pods, are now
    up and running in the `kube-system` namespace by using the command `kubectl get
    po -A`. The output will look similar to the following:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以通过使用命令`kubectl get po -A`看到，CoreDNS Pods以及Calico Pods现在已经在`kube-system`命名空间中启动并运行。输出将类似于以下内容：
- en: '[PRE8]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: This completes installing the Calico CNI.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 这就完成了Calico CNI的安装。
