- en: '12 Iterating on someone else’s work: Data preparation'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 12 在他人的工作中迭代：数据准备
- en: This chapter covers
  id: totrans-1
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Continuing the work of another analyst
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 继续另一位分析师的工作
- en: Investigating and verifying an existing analysis
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调查和验证现有分析
- en: Preparing event-level data to be suitable for user-level segmentation
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备事件级别数据以适合用户级别分割
- en: Every analyst will need to continue someone else’s work at some point. This
    “someone” might be a past version of you from months ago. The process for working
    on the second version of a project is the same as starting from scratch.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 每个分析师在某个时候都需要继续他人的工作。这个人可能是几个月前的你。处理项目第二版的过程与从头开始是一样的。
- en: Because we will own this new version, we still need to understand the problem,
    look at the available data, and so on, even if someone else has already done it.
    In this project, you will get the opportunity to practice taking over from someone
    else. Another analyst has prepared the minimum viable answer to a stakeholder
    question, on which you will iterate.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 因为我们将拥有这个新版本，即使别人已经做过，我们仍然需要理解问题、查看可用数据等等。在这个项目中，你将有机会练习接替他人。另一位分析师已经为利益相关者问题准备了一个最小可行答案，你将在此基础上进行迭代。
- en: 'The specific topic of this chapter is one that is also common in the real world:
    segmentation. Most businesses have questions in the form of “How are some things
    similar to other things?” where the thing in question could be anything from a
    product to a customer to an entire geographic area.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的具体主题是现实世界中也很常见的一个问题：分割。大多数企业都会提出类似“某些事物与其它事物有哪些相似之处？”的问题，而这个问题中的“事物”可以是任何东西，从产品到客户，甚至是一个完整的地理区域。
- en: 'Real business case: Segmenting customers based on buying activity'
  id: totrans-8
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 真实业务案例：基于购买活动分割客户
- en: The specific methods required to segment customers will come in handy for segmenting
    anything. For example, one project I worked on was identifying customers who bought
    similar used cars at auction. Having a notion of buyer similarity meant we could
    find more buyers to whom we could proactively recommend upcoming auctions. Being
    able to invite buyers to an auction because we know they buy similar stock led
    to more productive conversations and more eyes on our auctioned cars.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 用于分割客户的具体方法对于分割任何事物都很有用。例如，我参与的一个项目是识别在拍卖会上购买类似二手车的客户。有了买家相似性的概念，我们就能找到更多买家，并主动向他们推荐即将到来的拍卖。因为我们知道他们会购买类似的股票，所以能够邀请买家参加拍卖，这导致了更有效的对话，并使更多人关注我们拍卖的车辆。
- en: The process for finding similar entities, what we refer to here as “segmentation,”
    is the same regardless of the type of entity. In this chapter specifically, you
    will practice segmenting mobile users into groups based on their app usage activity.
    You will work with event-level data and continue the work of another analyst who
    has already completed an iteration of the project.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 找到相似实体的过程，我们在这里称之为“分割”，无论实体的类型如何，都是相同的。具体来说，在本章中，你将练习根据用户的APP使用活动将移动用户分组。你将使用事件级别数据，并继续另一位分析师已完成的项目迭代的工作。
- en: 12.1 Finding similar entities
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 12.1 寻找相似实体
- en: The problem of segmentation appears in many places. The typical use case is
    finding customers who are similar to each other based on characteristics such
    as demographics or behavior. A business may also want to apply segmentation to
    its product catalog to categorize and simplify its offering.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 分割问题出现在许多地方。典型的用例是根据人口统计或行为等特征找到彼此相似的客户。企业还可能希望将其产品目录应用于分割，以分类和简化其产品提供。
- en: In each case, the outcome is that different actions will be taken for different
    segments. Users in different financial segments will be targeted with different
    banking products. Products that are grouped into a segment may be recommended
    alongside each other to the end user. Recommendation engines make heavy use of
    the notion of user and product similarity.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在每种情况下，结果都是对不同分割采取不同的行动。不同财务段的用户将被针对不同的银行产品。可能被分组到同一分割的产品可能被推荐给最终用户。推荐引擎大量使用用户和产品相似性的概念。
- en: In machine learning, segmentation, or clustering, is an example of unsupervised
    learning. This means that, unlike supervised prediction problems, we don’t have
    examples of the “truth,” that is, actual customer segments against which to compare
    our results. Our ability to measure how good our segments are is, therefore, limited.
    The evaluation of these segments is usually done subjectively by human experts
    instead.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在机器学习中，细分或聚类是无监督学习的一个例子。这意味着，与监督预测问题不同，我们没有“真理”的例子，即实际客户细分来比较我们的结果。因此，我们衡量我们的细分好坏的能力是有限的。这些细分通常由人类专家主观评估。
- en: Supervised vs. unsupervised learning
  id: totrans-15
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 监督学习与无监督学习
- en: In machine learning, the difference between supervised and unsupervised learning
    is whether we have historical examples of correct predictions against which to
    compare our model’s predictions.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在机器学习中，监督学习与无监督学习之间的区别在于我们是否有历史正确的预测例子来比较我们的模型预测。
- en: If we are predicting the price of a house based on its properties, we need training
    data that includes both the properties of the houses and the prices they sold
    for. This is *supervised* learning because we can compare our model’s predictions
    to actual values, thus supervising our prediction model.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们根据房屋的特性预测房价，我们需要包含房屋特性和其售价的训练数据。这是*监督*学习，因为我们可以将我们的模型预测与实际值进行比较，从而监督我们的预测模型。
- en: In *unsupervised* learning, we do not have such past examples. There are no
    correct answers to compare against. Instead, we are trying to find patterns of
    some sort in
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在*无监督*学习中，我们没有这样的过去例子。没有正确答案可以与之比较。相反，我们试图在
- en: our data, which we then evaluate more subjectively. Customer segmentation falls
    neatly into this latter category.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的数据，然后我们对其进行更主观的评价。客户细分恰好属于这个后者类别。
- en: 'In any similarity problem, there are certain factors to consider when deciding
    on our approach:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在任何相似性问题中，当我们决定我们的方法时，需要考虑某些因素：
- en: What action will we take when we have our groups? This is the most important
    question to ask since it motivates the entire project.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当我们有了我们的组时，我们将采取什么行动？这是最重要的问题，因为它激励了整个项目。
- en: What features are important when determining similarity? Do we care about users
    who live in the same area or who have similar purchasing patterns?
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在确定相似性时，哪些特征是重要的？我们是否关心住在同一地区或具有相似购买模式的人？
- en: On a related note, do we have redundant features? If we’re segmenting cars,
    we don’t want to include their top speed in both kilometers and miles per hour.
    One variable to measure a particular concept is enough.
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在相关的问题上，我们是否有冗余的特征？如果我们正在细分汽车，我们不想在千米和每小时英里数中包含它们的最高速度。一个变量来衡量一个特定的概念就足够了。
- en: How many groups do we believe we will find? We may not have an exact number,
    but even a ballpark will help.
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们相信我们会找到多少组？我们可能没有确切的数字，但即使是一个大致的范围也会有所帮助。
- en: How will we evaluate the outcome of the segmentation? Usually, this is done
    with the help of domain experts.
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们将如何评估细分的结果？通常，这是在领域专家的帮助下完成的。
- en: In this project, in addition to these factors, we will also want a checklist
    of actions for how to continue the previous analyst’s work.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个项目中，除了这些因素外，我们还想有一个清单，列出如何继续前一位分析师的工作。
- en: 12.2 Continuing someone else’s work
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 12.2 继续他人的工作
- en: In a situation where we are continuing someone else’s work, the first step should
    be to replicate their findings whether or not the original source code is available.
    The reasons for this are
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们继续他人工作的情境中，第一步应该是复制他们的发现，无论原始源代码是否可用。这样做的原因是
- en: Having our own version of the previous pipeline means we can more easily make
    changes to it.
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拥有我们自己的先前流程版本意味着我们可以更容易地对其进行更改。
- en: Recreating someone else’s work checks for mistakes, not with the purpose of
    blaming anyone, but to verify that their steps did what they said they did.
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重新创建他人的工作是为了检查错误，而不是为了责怪任何人，而是为了验证他们的步骤是否如他们所说的那样做了。
- en: We also want to verify the assumptions present in the previous analyst’s work.
    It’s possible they made incorrect assumptions or even just different assumptions
    to the ones we’d make. Being explicit about these assumptions gives everyone clarity.
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们还想验证前一位分析师工作中存在的假设。他们可能做出了错误的假设，甚至可能做出了与我们不同的假设。明确这些假设可以让每个人都很清楚。
- en: Replicating the work puts us in a better position to understand the details
    of the project, the limitations, and what further steps are possible. Looking
    at someone else’s work briefly is not the same as getting into the weeds ourselves.
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 复制工作使我们能够更好地理解项目的细节、局限性以及可能的进一步步骤。简要查看他人的工作并不等同于亲自深入其中。
- en: If we consider these factors before we start work, then, combined with our results-driven
    approach, we will be well equipped for the project to succeed.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们在开始工作之前考虑这些因素，并结合我们的以结果为导向的方法，我们将为项目的成功做好充分准备。
- en: Collaborating with others
  id: totrans-34
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 与他人协作
- en: In this project, you are indirectly collaborating with another analyst by continuing
    their work. You won’t always be the only analyst on a project; there will be times
    when you share the work with other analysts. Being an effective collaborator means
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个项目中，您通过继续另一位分析师的工作间接地与另一位分析师协作。您不总是项目中的唯一分析师；有时您需要与其他分析师共享工作。成为一名有效的协作者意味着
- en: Communicating your work to other technical colleagues
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与其他技术同事沟通您的工作
- en: Applying best practices to your work to make your code easier to work with
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将最佳实践应用于您的工作中，使您的代码更容易使用
- en: Consistently looking for ways to improve and learn from others
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不断寻找改进和学习的方法
- en: To hone these skills, you can contribute to open source projects or spend time
    looking at other people’s work.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 为了磨练这些技能，您可以参与开源项目或花时间研究他人的工作。
- en: Let’s now take a look at this chapter’s project.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们看看这一章的项目。
- en: '12.3 Project 8: Finding customer segments from mobile activity'
  id: totrans-41
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 12.3 项目8：从移动活动中发现客户细分
- en: In this project, we will look at mobile phone activity to identify groups of
    similar customers. We will examine the problem statement, the available data,
    the project deliverables, and the tools you will need to attempt the project.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个项目中，我们将研究手机活动以识别相似客户群体。我们将审查问题陈述、可用数据、项目交付成果以及您尝试项目所需的工具。
- en: The data is available for you to attempt the project yourself at [https://davidasboth.com/book-code](https://davidasboth.com/book-code).
    You will find the files that you can use for the project, including the previous
    analyst’s work on which we will build, as well as the example solution in the
    form of a Jupyter notebook.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 数据已可供您在[https://davidasboth.com/book-code](https://davidasboth.com/book-code)自行尝试项目。您将找到可用于项目的文件，包括我们将在此基础上构建的前分析师的工作，以及以Jupyter笔记本形式的示例解决方案。
- en: 12.3.1 Problem statement
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 12.3.1 问题陈述
- en: You’re working for AppEcho Insights, an analytics company focused on mobile
    user behavior. They analyze data on how users use their phones and provide insights
    to mobile phone manufacturers and app developers. Their latest initiative is customer
    segmentation. They want to understand whether there are groups of users who behave
    in a similar way. Knowing these user segments would be useful as their clients
    could target entire user bases with different initiatives. For example, they could
    market productivity tips to casual users or insights on extending battery life
    to heavy users.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 您在AppEcho Insights工作，这是一家专注于移动用户行为的分析公司。他们分析用户如何使用手机，并向手机制造商和应用程序开发者提供见解。他们的最新举措是客户细分。他们想了解是否存在行为相似的用户群体。了解这些用户细分对他们的客户来说将非常有用，因为他们的客户可以用不同的举措针对整个用户群体。例如，他们可以向休闲用户推广生产力技巧，向重度用户提供延长电池寿命的见解。
- en: A previous analyst already performed a basic segmentation of the user base and
    presented their findings to the stakeholders. Unfortunately, they left the company
    after that, and their code was lost. Your manager has asked you to work on a second
    version of the analysis, using the results of the first as a starting point.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 前一位分析师已经对用户群体进行了基本的细分，并向利益相关者展示了他们的发现。不幸的是，他们之后离开了公司，并且他们的代码丢失了。您的经理要求您使用第一版分析的结果作为起点，进行第二次分析。
- en: 'The conclusion of the first version was that it is possible to segment customers
    based on the number of apps they use and the average length of their browsing
    sessions. The analyst proposed six unique customer categories and assigned them
    personas, such as “casual users” and “power users.” Your stakeholders want the
    second version of the segmentation to be more complex and include more features.
    They’d like to focus on the following:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 第一版本的结论是，可以根据用户使用的应用数量和浏览会话的平均长度对客户进行细分。分析师提出了六个独特的客户类别，并为他们分配了角色，例如“休闲用户”和“高级用户”。你的利益相关者希望第二版本的细分更加复杂，并包含更多特征。他们希望关注以下方面：
- en: The types of apps that people use. For example, do some customers use their
    phones more for social media than others?
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 人们使用的应用类型。例如，一些客户是否比其他人更频繁地使用社交媒体应用？
- en: Look at temporal patterns. Do users prefer to browse their phones at different
    times of the day?
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 观察时间模式。用户是否喜欢在一天中的不同时间浏览他们的手机？
- en: Potentially use a more suitable segmentation method (e.g., an algorithm that
    can handle grouping users based on multiple dimensions).
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可能需要使用更合适的分段方法（例如，可以基于多个维度对用户进行分组的算法）。
- en: They have provided you with the dataset of mobile events and the presentation
    the initial analyst delivered. The dataset consists of individual mobile events,
    such as a user opening or closing a mobile app. There are only a few columns,
    but it is possible to extract rich behavioral information. The events are timestamped,
    so the temporal element can also be analyzed. See chapters 8 and 9 for more details
    about working with time data.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 他们已经为你提供了移动事件数据集和初始分析师提供的演示文稿。数据集包括单个移动事件，例如用户打开或关闭移动应用。列数不多，但可以提取丰富的行为信息。事件都有时间戳，因此时间元素也可以进行分析。有关处理时间数据的更多详细信息，请参阅第8章和第9章。
- en: NOTE  The data was originally taken from [https://github.com/aliannejadi/LSApp](https://github.com/aliannejadi/LSApp).
    Thank you to Mohammad Aliannejadi for permission to use the data.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '备注  数据最初来自[https://github.com/aliannejadi/LSApp](https://github.com/aliannejadi/LSApp)。感谢Mohammad
    Aliannejadi允许使用数据。 '
- en: Both the data and presentation files are in the supplementary materials. Your
    task will be to review the analyst’s work and continue the project to answer your
    stakeholders’ questions.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 数据和演示文稿文件都在补充材料中。你的任务是审查分析师的工作，并继续项目以回答利益相关者的问题。
- en: 12.3.2 Data dictionary
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 12.3.2 数据字典
- en: As always, a key initial step is to take a look at the available data. Table
    12.1 shows the data dictionary.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 总是，一个关键的初始步骤是查看可用的数据。表12.1显示了数据字典。
- en: Table 12.1 Data dictionary
  id: totrans-56
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表12.1 数据字典
- en: '| Column | Definition |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| 列 | 定义 |'
- en: '| --- | --- |'
  id: totrans-58
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| User ID  | A user’s unique identifier.  |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| 用户ID | 一个用户的唯一标识符。 |'
- en: '| Session ID  | Uniquely identifies a user’s activity session.  |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| 会话ID | 唯一标识用户的会话活动。 |'
- en: '| Timestamp  | Date and time of an individual event.  |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| 时间戳 | 单个事件的日期和时间。 |'
- en: '| App name  | The name of the app in use.  |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| 应用名称 | 正在使用中的应用名称。 |'
- en: '| Event type  | The type of the event that took place. Values are one of the
    following: “Opened,” “Closed,” “User Interaction,” or “Broken.”  |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| 事件类型 | 发生的事件类型。值可以是以下之一：“打开”、“关闭”、“用户交互”或“损坏”。 |'
- en: Now that we have seen what’s available, let’s look at the outcomes of this project.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经看到了可用的数据，让我们看看这个项目的成果。
- en: 12.3.3 Desired outcomes
  id: totrans-65
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 12.3.3 预期成果
- en: Our stakeholders want a more in-depth analysis and customer segments based on
    more dimensions. Our solution should consist of a recreation of the initial analysis
    followed by our own improvements. The final output is the definition of our user
    segments, meaning what factors describe each segment and which users belong to
    which group.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的利益相关者希望进行更深入的分析，并基于更多维度创建客户细分。我们的解决方案应包括对初始分析的重新创建以及我们的改进。最终输出是我们用户细分的定义，即哪些因素描述了每个细分，哪些用户属于哪个组。
- en: 12.3.4 Required tools
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 12.3.4 必需工具
- en: In the example solution, I use Python and the `pandas` library for data exploration,
    `matplotlib` for visualization, and `scikit-learn` for clustering. To complete
    this project, you will need a tool that can
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在示例解决方案中，我使用Python和`pandas`库进行数据探索，`matplotlib`进行可视化，以及`scikit-learn`进行聚类。为了完成这个项目，你需要一个能够
- en: Load a dataset from a CSV or similar
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从CSV或类似文件加载数据集
- en: Perform basic data manipulation tasks, such as sorting, grouping, and reshaping
    data
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行基本数据操作任务，如排序、分组和重塑数据
- en: Create data visualizations
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建数据可视化
- en: Perform segmentation (e.g., with a clustering algorithm)
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行分割（例如，使用聚类算法）
- en: You can decide to perform the segmentation “by hand,” meaning decide on what
    values of your dimensions make up the groups. However, this becomes increasingly
    difficult to do manually after two to three dimensions, which is why I recommend
    choosing a tool that can apply a relevant algorithm.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以选择手动执行分割，这意味着决定哪些维度的值组成组。然而，在两个或三个维度之后，手动执行变得越来越困难，这就是为什么我建议选择一个可以应用相关算法的工具。
- en: Let’s now see how we might approach this problem step by step using our results-driven
    framework.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们看看我们如何可能使用我们的以结果为导向的框架逐步解决这个问题。
- en: 12.4 Applying the results-driven method to creating the second iteration of
    a customer segmentation
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 12.4 将以结果为导向的方法应用于创建客户细分第二迭代
- en: Let’s look at a results-driven approach to this problem and formulate our action
    plan.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看以结果为导向的解决方案，并制定我们的行动计划。
- en: '![figure](../Images/12-unnumb-1.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-unnumb-1.png)'
- en: 'The problem statement is clear: allocate users to distinct segments. Beyond
    this, what we also need to understand is the work the previous analyst has already
    done. Only then can we understand exactly what our task is. Recreating the analyst’s
    work is also crucial. First, we need to ensure we can replicate their results
    and verify their assumptions, but in this case, we also need to have the code
    available as the original was lost.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 问题陈述是清晰的：将用户分配到不同的细分市场。除此之外，我们还需要了解前一位分析师已经完成的工作。只有这样，我们才能确切地了解我们的任务是什么。重现分析师的工作也是至关重要的。首先，我们需要确保我们可以复制他们的结果并验证他们的假设，但在这个案例中，我们还需要有代码可用，因为原始代码已经丢失。
- en: '![figure](../Images/12-unnumb-2.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-unnumb-2.png)'
- en: Starting at the end, in this case, means answering the questions posed in section
    12.1\. How many groups should there be? What kind of groups make sense in light
    of what our stakeholders want to do with the output? They want to be able to target
    different user groups with different offerings, so our evaluation of the user
    groups should be made with that in mind.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 从末尾开始，在这种情况下，意味着回答第12.1节中提出的问题。应该有多少个组？根据我们的利益相关者想要如何使用输出结果，哪种类型的组是有意义的？他们希望能够针对不同的用户群体提供不同的产品，因此我们在评估用户群体时应该考虑到这一点。
- en: '![figure](../Images/12-unnumb-3.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-unnumb-3.png)'
- en: In this instance, the data has been identified for us. However, we should also
    think about ways to enhance this data. Can we extract more information from the
    data, or are there external sources we could join on?
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个实例中，数据已经被为我们识别出来。然而，我们也应该考虑如何增强这些数据。我们能否从数据中提取更多信息，或者是否有外部数据源我们可以将其合并？
- en: '![figure](../Images/12-unnumb-4.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-unnumb-4.png)'
- en: The data has been downloaded for us in its raw form. Again, however, we could
    enhance it. We will review some ideas for enhancement in the example solution.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 数据已经以原始形式为我们下载。然而，我们仍然可以增强它。在示例解决方案中，我们将回顾一些增强的想法。
- en: '![figure](../Images/12-unnumb-5.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-unnumb-5.png)'
- en: 'The segmentation process resembles any data analysis problem, for the most
    part:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 分割过程与大多数数据分析问题相似：
- en: We will start by exploring the data, looking for missing and incorrect values,
    outliers, and so on.
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们将首先探索数据，寻找缺失和错误的数据值、异常值等。
- en: Next, we will investigate which features our records vary along. That is, do
    some features have more variance than others? If all customers live in the same
    geographic area, there is no need to include geography as one of the dimensions
    on which to segment them.
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 接下来，我们将调查我们的记录在哪些特征上有所变化。也就是说，某些特征的变化是否比其他特征更大？如果所有客户都居住在同一个地理区域内，那么就没有必要将地理作为分割客户的一个维度。
- en: We also want to visualize our data along the different dimensions in the hope
    of discovering obvious groups. In large, complex datasets, this is unlikely, but
    we might find outlier groups, such as a few customers who spend a lot more than
    the others.
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们还希望沿着不同的维度可视化我们的数据，以期发现明显的组。在大型、复杂的数据集中，这不太可能发生，但我们可能会发现异常值组，例如一些客户的花费远高于其他人。
- en: The final two steps are unique to the segmentation problem. First, we will choose
    which dimensions to segment on and apply a clustering algorithm. Different algorithms
    exist for different use cases, some of which are discussed in the example solution.
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后两个步骤是分割问题的独特之处。首先，我们将选择要分割的维度并应用聚类算法。存在不同的算法适用于不同的用例，其中一些在示例解决方案中进行了讨论。
- en: Then, we will evaluate the results. We will do this by analyzing the groups
    to see if they meaningfully differ from one another. One way to do this is to
    assign group labels or personas to each group. If we can give each group a unique
    description, the results will be more useful than if we have created multiple
    segments with the same characteristics.
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 然后，我们将评估结果。我们将通过分析这些组来查看它们是否在意义上彼此不同。一种方法是为每个组分配组标签或角色。如果我们能给出每个组的独特描述，结果将比我们创建了具有相同特征的多组更有用。
- en: This step will be done once we have an allocation for each user, that is, know
    which of our newly created groups they belong to.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 此步骤将在我们为每个用户分配资源后完成，也就是说，我们知道他们属于我们新创建的哪些组。
- en: '![figure](../Images/12-unnumb-6.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-unnumb-6.png)'
- en: 'The presentation from the previous iteration was a short slide deck. We could
    consider creating a similar presentation as an output. At the very least, we should
    have all the same ingredients to hand: a list of the final groups, the number
    of users in each group, and what characteristics describe each group.'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 上一次迭代的演示文稿是一个简短的幻灯片集。我们可以考虑创建一个类似的演示文稿作为输出。至少，我们应该有所有相同的成分在手：最终组的列表、每个组中的用户数量以及描述每个组的特征。
- en: '![figure](../Images/12-unnumb-7.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-unnumb-7.png)'
- en: Since this will be the second iteration of the project, we should make recommendations
    to our stakeholders about additional steps that could be taken after our version
    is finished. Clearly, this is an important company initiative, which we can support
    by providing suggestions for further work if our stakeholders decide to allocate
    more resources.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这将是我们项目的第二次迭代，我们应该向我们的利益相关者提出建议，关于我们版本完成后可能采取的额外步骤。显然，这是一个重要的公司倡议，如果我们利益相关者决定分配更多资源，我们可以通过提供进一步工作的建议来支持它。
- en: '12.5 An example solution: Creating customer segments'
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 12.5 示例解决方案：创建客户细分
- en: Now, let’s walk through an example solution. As always, I strongly recommend
    attempting the project yourself first.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们通过一个示例解决方案来了解整个过程。一如既往，我强烈建议您首先尝试自己完成这个项目。
- en: As for the action plan, first, we will attempt to recreate the initial analysis.
    Next, we will investigate the additional features requested by our stakeholders
    before finally grouping our customers into new segments and analyzing these groups.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 至于行动计划，首先，我们将尝试重新创建初始分析。接下来，我们将调查我们的利益相关者请求的附加功能，最后将我们的客户分组到新的细分市场并分析这些组。
- en: 12.5.1 Recreating someone else’s analysis
  id: totrans-100
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 12.5.1 重新创建他人的分析
- en: In this first part, we will review the slides presented by the previous analyst
    and attempt to replicate their findings. Slide 4 contains some summary metrics,
    which is where we should start. Figure 12.1 shows the slide in question.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在本部分的第一部分，我们将回顾前一位分析师展示的幻灯片，并尝试复制他们的发现。幻灯片4包含一些汇总指标，这是我们应从哪里开始的地方。图12.1显示了相关的幻灯片。
- en: '![figure](../Images/12-1.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-1.png)'
- en: Figure 12.1 Slide 4 from the original presentation, showing summary metrics
  id: totrans-103
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.1 原始演示文稿中的幻灯片4，显示了汇总指标
- en: Our first task is to verify that we can recreate these metrics.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的首要任务是验证我们能否重新创建这些指标。
- en: Verifying reported metrics
  id: totrans-105
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 验证报告的指标
- en: 'First, we’ll read in the data with the following code, and a preview of the
    rows is shown in figure 12.2\. Note that the data is in the .tsv format, meaning
    values are separated by a tab character, not a comma:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将使用以下代码读取数据，并在图12.2中展示行预览。请注意，数据格式为.tsv，意味着值由制表符分隔，而不是逗号：
- en: '[PRE0]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '#1 Specifies the separator as the tab character'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 指定分隔符为制表符'
- en: '#2 Gives the data specific column names'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 给数据指定特定的列名'
- en: '#3 Explicitly converts the timestamp column to a date type'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 明确将时间戳列转换为日期类型'
- en: '#4 Ignores the original column headers since we’re supplying our own'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 忽略原始列标题，因为我们提供了自己的'
- en: '![figure](../Images/12-2.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-2.png)'
- en: Figure 12.2 A snapshot of the raw data
  id: totrans-113
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.2 原始数据的快照
- en: The output of the code tells us that there are over three million rows of data,
    and the snapshot tells us that we have one row per app event, which is when the
    user opens or closes an app. Let’s now investigate the claims on the appendix
    slide, which say that missing data and events tagged as broken were dropped. The
    slide in question is shown in figure 12.3.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 代码的输出告诉我们有超过三百万行数据，快照告诉我们每行对应一个应用事件，即用户打开或关闭应用时。现在，让我们调查附录幻灯片上的声明，该声明称丢失的数据和标记为损坏的事件已被删除。相关的幻灯片如图12.3所示。
- en: '![figure](../Images/12-3.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-3.png)'
- en: Figure 12.3 The relevant part of the appendix from the slides, showing additional
    data cleaning steps
  id: totrans-116
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.3 幻灯片附录中相关的部分，显示了额外的数据清理步骤
- en: 'To investigate these additional data cleaning steps, the following code investigates
    missing data and produces the output in figure 12.4:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 为了调查这些额外的数据清理步骤，以下代码调查缺失数据，并在图12.4中产生输出：
- en: '[PRE1]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![figure](../Images/12-4.png)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-4.png)'
- en: Figure 12.4 The result of investigating missing data
  id: totrans-120
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.4 查询缺失数据的结果
- en: 'This figure shows there is one missing value in each column. Regardless of
    whether those missing values are in the same record, it’s safe to drop missing
    data as it makes up a negligible percentage of our dataset:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 此图显示每个列中都有一个缺失值。无论这些缺失值是否在同一记录中，都可以安全地删除缺失数据，因为它只占我们数据集的一小部分：
- en: '[PRE2]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Figure 12.2 also shows that user ID and session ID, which should typically
    be integers, are treated as decimal values. This is because the version of the
    `pandas` library I’m using does not have a nullable integer type. It is not crucial
    to convert this column to an integer, but we will do it to be explicit and avoid
    any confusion. Figure 12.5 verifies that all the columns have the correct data
    type:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.2 也显示，用户ID和会话ID，通常应该是整数，被当作十进制值处理。这是因为我所使用的`pandas`库版本没有可空整数类型。将此列转换为整数不是至关重要，但我们仍会这样做以明确表示并避免任何混淆。图12.5验证了所有列都有正确的数据类型：
- en: '[PRE3]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![figure](../Images/12-5.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-5.png)'
- en: Figure 12.5 The corrected data types in our dataset
  id: totrans-126
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.5 我们数据集中的修正数据类型
- en: 'Before verifying the summary metrics on the slides, let’s investigate the “Broken”
    event type that, according to the appendix, was dropped. The following code looks
    at the distribution of event type as a percentage of the entire data, and the
    result is shown in figure 12.6:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在验证幻灯片上的摘要指标之前，让我们调查根据附录，被删除的“损坏”事件类型。以下代码查看事件类型的分布，作为整个数据的百分比，结果如图12.6所示：
- en: '[PRE4]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![figure](../Images/12-6.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-6.png)'
- en: Figure 12.6 Percentage breakdown of each event type
  id: totrans-130
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.6 每个事件类型的百分比分解
- en: This figure tells us that only 0.1% of our data is a “Broken” event. We don’t
    have a lot of context about what this means, so we will agree with the initial
    analysis and drop these records using the following code.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 此图告诉我们，我们数据中只有0.1%是“损坏”事件。我们没有太多关于这代表什么的信息，所以我们同意初始分析，并使用以下代码删除这些记录。
- en: '[PRE5]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Before we go further, let’s start building up our diagram of the process we
    are following. Figure 12.7 shows what we have done so far and where the analysis
    might have diverged.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们继续之前，让我们开始构建我们正在遵循的过程图。图12.7显示了我们所做的一切以及分析可能发生分歧的地方。
- en: '![figure](../Images/12-7.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-7.png)'
- en: Figure 12.7 The first step in recreating the initial analysis
  id: totrans-135
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.7 重新创建初始分析的第一步
- en: 'Let’s now verify that, as per the “Dataset at a glance” slide in figure 12.1,
    we have 292 users, 87 unique apps, events spanning eight months, and three distinct
    event types. First, we verify the number of users:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们验证根据图12.1中“数据集概览”幻灯片，我们有292个用户，87个独特应用程序，跨越八个月的事件，以及三种不同的事件类型。首先，我们验证用户数量：
- en: '[PRE6]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'This code returns 292, as expected. Now, we verify the number of distinct apps:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 此代码返回预期的292。现在，我们验证不同应用程序的数量：
- en: '[PRE7]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Again, we get the expected value of 87\. Let’s now look at the date range in
    our data:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，我们得到了预期的87。现在，让我们看看我们数据中的日期范围：
- en: '[PRE8]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The output tells us the data spans September 2017 to May 2018, which is approximately
    eight months, as stated on the slides. We also know there are three event types
    since there were four when we first investigated them, and we dropped one of them
    entirely. The next step is to recreate some of the underlying data behind the
    charts in the slides.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 输出告诉我们数据跨度为2017年9月至2018年5月，大约八个月，正如幻灯片上所述。我们还知道有三个事件类型，因为我们最初调查时是四个，我们完全删除了一个。下一步是重新创建幻灯片中图表背后的部分基础数据。
- en: First, there is a slide showing the number of sessions per user, as shown in
    figure 12.8.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，有一张幻灯片显示了每个用户的会话数量，如图12.8所示。
- en: '![figure](../Images/12-8.png)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-8.png)'
- en: Figure 12.8 A slide from the original presentation showing the distribution
    of the number of sessions per user
  id: totrans-145
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.8 原始演示文稿中的一张幻灯片，显示了每个用户的会话数量分布
- en: 'Number of sessions per user seems like a useful metric to calculate as it is
    a proxy for how active a user is. To do this, we’ll create a DataFrame where,
    for each user, we count how many unique sessions they have in the data. We will
    then explore the distribution of this measure. The following code creates this
    DataFrame, and the output showing its descriptive statistics is presented in figure
    12.9:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 每个用户的会话数量似乎是一个有用的指标来计算，因为它是一个用户活跃度的代理。为此，我们将创建一个DataFrame，其中对于每个用户，我们计算他们在数据中拥有的唯一会话数量。然后我们将探索这个指标的分布。以下代码创建了此DataFrame，其描述性统计结果如图12.9所示：
- en: '[PRE9]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![figure](../Images/12-9.png)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-9.png)'
- en: Figure 12.9 Descriptive statistics of the number of sessions per user
  id: totrans-149
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.9 每个用户的会话数量描述性统计
- en: 'This tells us that the median number of sessions per user is 95, but there
    were users with a single session all the way to a user with over 5,000\. Let’s
    see this distribution visually to better understand both the spread and where
    the data is concentrated. The following code creates the histogram shown in figure
    12.10:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 这告诉我们，每个用户的会话中位数是95，但有些用户只有一次会话，而有些用户超过5,000次。让我们通过可视化分布来更好地理解数据的分布和集中情况。以下代码创建了图12.10所示的直方图：
- en: '[PRE10]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![figure](../Images/12-10.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-10.png)'
- en: Figure 12.10 Distribution of number of sessions per user
  id: totrans-153
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.10 每个用户的会话数量分布
- en: As we might have expected from the descriptive statistics, the distribution
    tells us most users have few sessions, with a long tail stretching to users with
    thousands. The initial analysis didn’t mention what the profiles of those prolific
    users look like, so let’s investigate them. Before we do that, let’s update our
    diagram to document the process so far. Figure 12.11 shows the latest version.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们从描述性统计中可能预期的，分布告诉我们大多数用户会话很少，但有一个长尾延伸到拥有数千次会话的用户。初步分析没有提到这些多产用户的情况，所以让我们调查他们。在我们这样做之前，让我们更新我们的图表来记录到目前为止的过程。图12.11显示了最新版本。
- en: '![figure](../Images/12-11.png)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-11.png)'
- en: Figure 12.11 The steps we have taken so far
  id: totrans-156
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.11 我们迄今为止采取的步骤
- en: 'From this point, we will go beyond the results presented in the slides and
    into our own analysis. Let’s now look at the data for the user with the highest
    number of sessions. The following code finds the users with the most sessions,
    and the output is shown in figure 12.12:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 从这个点开始，我们将超越幻灯片上展示的结果，进入我们自己的分析。现在让我们看看具有最高会话数量的用户的数据。以下代码找到了具有最多会话的用户，输出结果如图12.12所示：
- en: '[PRE11]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![figure](../Images/12-12.png)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-12.png)'
- en: Figure 12.12 The users with the most unique sessions
  id: totrans-160
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.12 最具独特会话的用户
- en: 'The following code extracts the raw data for the user with the most sessions:
    user 138\. A snapshot of their data is shown in figure 12.13:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码提取了具有最多会话的用户（用户138）的原始数据。他们的数据快照如图12.13所示：
- en: '[PRE12]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![figure](../Images/12-13.png)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-13.png)'
- en: Figure 12.13 A snapshot of the activity of the user with the most sessions
  id: totrans-164
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.13 具有最多会话的用户活动快照
- en: It looks like the data for this user starts with them using various apps at
    around 5:30 a.m. One noticeable aspect of this data is that it starts with an
    “Opened” event followed immediately by a “Closed” event and then another “Opened”
    event, all for the same app. Is this information relevant or redundant? In the
    example in figure 12.13, we have some exact duplicates, namely, the first and
    third rows. Let’s see how big this problem is.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来这个用户的数据从大约早上5:30开始使用各种应用。这个数据的一个明显方面是它从一个“打开”事件开始，紧接着是一个“关闭”事件，然后是另一个“打开”事件，所有这些事件都是针对同一应用的。这个信息是相关的还是冗余的？在图12.13的例子中，我们有一些精确重复，即第一行和第三行。让我们看看这个问题有多大。
- en: Investigating duplicate event records
  id: totrans-166
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 调查重复事件记录
- en: 'The following code calculates the proportion of records that are exact duplicates:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码计算了精确重复记录的比例：
- en: '[PRE13]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The output is 0.597, meaning nearly 60% of our data is an exact duplicate of
    another row. That means a record with the same user ID, same session ID, and the
    same event type occurring for the same app at the same time.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 输出结果是0.597，这意味着我们近60%的数据是另一行的精确重复。这意味着具有相同用户ID、相同会话ID和相同事件类型在相同时间发生同一应用的记录。
- en: This result could potentially require a lot of work to investigate and clear
    up, so before we do anything, let’s consider whether duplicates are a problem
    for the specific analysis we want to conduct. We are interested in
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 这个结果可能需要大量工作来调查和澄清，所以在我们做任何事情之前，让我们考虑一下重复项是否是我们想要进行的特定分析的问题。我们感兴趣的是
- en: What types of apps do people use? If we are counting things like the number
    of unique apps per user, duplicates won’t be a problem.
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 人们使用哪些类型的应用？如果我们计算每个用户独特的应用数量，重复记录就不会成为问题。
- en: When do people use their phones? Unfortunately, having duplicate records would
    skew the results because we may accidentally inflate some parts of the day versus
    others if there happen to be more duplicates at different times of the day.
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 人们何时使用他们的手机？不幸的是，由于可能在不同时间有更多重复记录，重复记录会导致结果偏差，我们可能会无意中夸大一天中某些部分相对于其他部分。
- en: 'We, therefore, can’t ignore the fact there are duplicates. We need to take
    stock of our possible options instead:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们不能忽视存在重复记录的事实。我们需要权衡我们的可能选项：
- en: We could simply drop duplicate records. What would happen if we did this for
    the example in figure 12.13? We would end up with an “Opened” event followed by
    two “Closed” events. The “Closed” events wouldn’t be duplicates as they occurred
    at different times. Dropping exact duplicates is too basic and would cause additional
    problems.
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以简单地删除重复记录。如果我们对图12.13中的示例这样做会发生什么？我们会得到一个“打开”事件后面跟着两个“关闭”事件。由于“关闭”事件发生在不同时间，它们不会是重复的。删除完全重复的记录过于基础，并可能引起其他问题。
- en: Another option is to drop pairs of “Opened” and “Closed” events that occurred
    at the same time. However, this assumes that an “Opened” event always has a corresponding
    “Closed” event, which may not hold in practice.
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 另一个选择是删除同时发生的“打开”和“关闭”事件对。然而，这假设“打开”事件总是有一个相应的“关闭”事件，这在实践中可能并不成立。
- en: We could also think about the problem differently. As it stands, we are not
    interested in the single-event level but in summarizing behavior at the user level.
    This means that we could say that “Closed” events are less informative. If a user
    opens five apps in a browsing session, we would know that even without the presence
    of “Closed” events.
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们也可以从不同的角度思考这个问题。目前，我们并不对单个事件级别感兴趣，而是要总结用户级别的行为。这意味着我们可以认为“关闭”事件信息量较小。如果一个用户在浏览会话中打开了五个应用，即使没有“关闭”事件，我们也会知道这一点。
- en: 'The idea that “Closed” events are informationally redundant is quite appealing,
    so let’s go with that approach. The following code drops events that are “Closed”
    and calculates the percentage of records we dropped, as well as the percentage
    of exact duplicates in the remaining data:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: “关闭”事件信息上冗余的想法非常吸引人，所以我们采用这种方法。以下代码删除了“关闭”事件，并计算了我们删除的记录百分比以及剩余数据中完全重复记录的百分比：
- en: '[PRE14]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The outputs of these three commands are 1,987,090, 0.54, and 0.599\. This means
    we have just under 2 million records remaining out of an initial 3.7 million,
    which is about half our original data. It also tells us that we still have nearly
    60% exact duplicates. Now, an exact duplicate is entirely redundant for our purposes,
    so we can drop those, too. The following code does this and calculates how much
    data we have left:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 这三个命令的输出分别是1,987,090，0.54和0.599。这意味着我们剩余的记录数接近两百万，而最初有370万条记录，大约是原始数据的一半。这也告诉我们，我们仍有近60%的完全重复记录。现在，对于我们的目的来说，完全重复是完全没有必要的，因此我们也可以删除这些记录。以下代码执行此操作，并计算我们剩余的数据量：
- en: '[PRE15]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: We are left with just under 800,000 records. It is unusual to drop so much data
    as part of an analysis, but in this case, it was justified. Figure 12.14 shows
    the process so far, including the choices we have just made.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 我们最终剩下不到80万条记录。在分析过程中删除如此多的数据是不寻常的，但在这个案例中，这是有道理的。图12.14显示了至今为止的过程，包括我们刚刚做出的选择。
- en: '![figure](../Images/12-14.png)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-14.png)'
- en: Figure 12.14 The process so far, including choices about handling duplicate
    data
  id: totrans-183
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.14至今为止的过程，包括处理重复数据的决策
- en: 'Having cleaned up a lot of duplication, let’s reexamine our data. The following
    code examines the first few rows, which are shown in figure 12.15:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 经过清理了大量重复数据后，让我们重新审视我们的数据。以下代码检查了前几行，如图12.15所示：
- en: '[PRE16]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![figure](../Images/12-15.png)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-15.png)'
- en: Figure 12.15 Example events after duplicate records were removed
  id: totrans-187
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.15移除重复记录后的示例事件
- en: This latest figure shows a new challenge. There are sequential instances of
    a user opening Minesweeper, sometimes only a few seconds apart. What could this
    mean?
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 这个最新的图显示了一个新的挑战。有用户连续打开扫雷游戏的实例，有时间隔只有几秒钟。这可能意味着什么？
- en: Was the user constantly changing their mind about whether they wanted to play?
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户是否一直在改变他们是否想要玩游戏的想法？
- en: Was the user trying to open the app, but it kept crashing?
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户是否尝试打开应用，但它不断崩溃？
- en: Are these artifacts of how the data was collected/collated?
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这些是数据收集/整理过程中的问题吗？
- en: We would need more information to know for sure.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要更多信息才能确定。
- en: Handling related pairs of event records
  id: totrans-193
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 处理相关的事件记录对
- en: 'As it stands, we must make a choice about what, if anything, to do about this
    kind of repetition:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 按现状，我们必须就如何处理这类重复问题做出选择：
- en: We could assume that multiple repeated events related to an app are actually
    a single instance of the user using that app. In the case of someone opening Minesweeper
    10 times in the data followed by opening another app, we could treat that as 2
    events instead of 11\.
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以假设与一个应用相关的多个重复事件实际上是用户使用该应用的单一实例。在数据中，某人打开扫雷10次之后打开另一个应用的情况下，我们可以将其视为2个事件而不是11个。
- en: We could look at the time difference between interactions of the same app and
    remove interactions that are too short. This requires us to strictly define “too
    short,” which is a strong built-in assumption.
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以查看同一应用交互之间的时间差，并移除过短的交互。这需要我们严格定义“过短”，这是一个强烈的内置假设。
- en: We could also ignore this problem entirely. Again, we are interested in user-level
    and session-level metrics, not individual event-level ones. If we define the length
    of a user session by the difference between when it started and ended, it doesn’t
    matter what happened in between as the user was interacting with their phone one
    way or another.
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们也可以完全忽略这个问题。再次强调，我们感兴趣的是用户级和会话级指标，而不是单个事件级指标。如果我们通过会话开始和结束的时间差来定义用户会话的长度，那么用户以某种方式与手机交互期间发生的事情并不重要。
- en: Thinking about this in a results-driven way, we can answer our stakeholders’
    questions about app types and user browsing times without explicitly handling
    these instances of users opening and closing apps in quick succession. Since we’re
    making another choice, we’ll add that to our diagram, the latest version of which
    is shown in figure 12.16.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 以结果为导向思考这个问题，我们可以回答利益相关者关于应用类型和用户浏览时间的问题，而无需明确处理用户快速连续打开和关闭应用的情况。由于我们做出了另一个选择，我们将它添加到我们的图中，最新的版本如图12.16所示。
- en: '![figure](../Images/12-16.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-16.png)'
- en: Figure 12.16 Our latest progress after investigating various types of duplicate
    event
  id: totrans-200
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.16 调查各种重复事件后的最新进展
- en: Now that we’ve handled the duplication issue, we can recreate the chart from
    the slides relating to the average session length of each user. This is shown
    in figure 12.17.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经处理了重复问题，可以重新创建与每个用户的平均会话长度相关的图表，如图12.17所示。
- en: '![figure](../Images/12-17.png)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-17.png)'
- en: Figure 12.17 A slide from the original presentation showing the distribution
    of users’ average session length
  id: totrans-203
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.17 原始演示文稿中显示用户平均会话长度分布的幻灯片
- en: 'To recreate this, we need to create a DataFrame of individual sessions and
    their length. First, we need to establish whether a session ID is unique to a
    user. If session 1 can only ever relate to user 0, we can simply group by the
    session ID; otherwise, we must include the user ID to distinguish between two
    different users’ sessions, both with an ID of 1\. The following code looks for
    session IDs that belong to more than one user:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 为了重新创建这个图表，我们需要创建一个包含单个会话及其长度的DataFrame。首先，我们需要确定会话ID是否对用户是唯一的。如果会话1只能与用户0相关联，我们就可以简单地按会话ID分组；否则，我们必须包含用户ID以区分两个不同用户的会话，这两个会话的ID都是1。以下代码查找属于多个用户的会话ID：
- en: '[PRE17]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'The output of this code is an empty `pandas` `Series`, meaning there are no
    session IDs across multiple users. Therefore, the session ID is unique to a user.
    Now, we can create the DataFrame of sessions that we need. The following code
    does this and produces the DataFrame, which is previewed in figure 12.18:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 此代码的输出是一个空的`pandas` `Series`，这意味着没有会话ID跨越多个用户。因此，会话ID对用户是唯一的。现在，我们可以创建所需的会话DataFrame。以下代码执行此操作，并生成DataFrame，如图12.18所示预览：
- en: '[PRE18]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![figure](../Images/12-18.png)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-18.png)'
- en: Figure 12.18 A snapshot of user sessions and their duration in minutes
  id: totrans-209
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.18 用户会话及其持续时间的快照（以分钟为单位）
- en: 'This DataFrame contains one row per user session, so grouping by user ID and
    averaging the session duration gives us the data we need to produce the chart
    from the slides. The following code does this and produces the chart in figure
    12.19:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 这个DataFrame每行包含一个用户会话，因此按用户ID分组并计算会话平均时长，可以得到制作幻灯片图表所需的数据。以下代码执行此操作，并生成图12.19所示的图表：
- en: '[PRE19]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![figure](../Images/12-19.png)'
  id: totrans-212
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-19.png)'
- en: Figure 12.19 The distribution of users’ average session lengths
  id: totrans-213
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.19 用户平均会话长度的分布
- en: This result tells us that most users’ sessions last less than 2 minutes but
    with a long tail. There are sessions that are even over 10 minutes in duration.
    You might notice that this chart doesn’t exactly match the one in the slides,
    as shown by the difference between figures 12.17 and 12.19\. That is because we
    have chosen to drop “Closed” events and have therefore already diverged from the
    initial analysis. That’s fine because we are making different assumptions and
    thus coming to different conclusions.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 这个结果告诉我们，大多数用户的会话时间不到2分钟，但有一个长尾。有些会话甚至超过10分钟。你可能注意到，这个图表与幻灯片中的图表并不完全一致，如图12.17和12.19之间的差异所示。这是因为我们选择删除“关闭”事件，因此已经与初始分析有所不同。这没关系，因为我们正在做出不同的假设，从而得出不同的结论。
- en: Our particular approach might skew results slightly if there are sessions that
    end in a “Closed” event because we’d underestimate how long those sessions are.
    However, since our primary goal is to look at what kinds of apps people use in
    a session and what time those sessions occur, the initial “Opened” event is sufficient.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有会话以“关闭”事件结束，我们的特定方法可能会稍微扭曲结果，因为我们低估了这些会话的时长。然而，由于我们的主要目标是观察人们在会话中使用了哪些类型的应用程序以及这些会话发生的时间，因此最初的“打开”事件就足够了。
- en: We have recreated the relevant parts of the original analysis, but before moving
    on to our stakeholders’ questions, let’s recap the process. The latest diagram
    is shown in figure 12.20.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经重新创建了原始分析的相关部分，但在继续回答利益相关者的问题之前，让我们回顾一下这个过程。最新的图表如图12.20所示。
- en: '![figure](../Images/12-20.png)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-20.png)'
- en: Figure 12.20 The process of reproducing the original analysis
  id: totrans-218
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.20 重新生成原始分析的过程
- en: Let’s move on to the next part of the analysis, answering our stakeholders’
    new questions about the users.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们继续分析的下一段，回答我们的利益相关者关于用户的新问题。
- en: 12.5.2 Analyzing event data to learn about customer behavior
  id: totrans-220
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 12.5.2 分析事件数据以了解客户行为
- en: Now that we have verified the findings of the original analysis, we can move
    on to our stakeholders’ new questions. The first one was about what time people
    use their phones and whether this would be a useful dimension for clustering.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经验证了原始分析的结果，我们可以继续回答利益相关者的新问题。第一个问题是关于人们何时使用手机，以及这是否会成为聚类的有用维度。
- en: Analyzing timestamps to learn about browsing behavior
  id: totrans-222
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 分析时间戳以了解浏览行为
- en: To investigate when people use their phones, we need a definition of what counts
    as “usage time.” That is, do we care about the times that every single data point
    occurred? Probably not because a group of “Opened” and “Closed” events close together
    in time should count as one example of a user using their phone around that time.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 为了调查人们何时使用手机，我们需要一个定义，即“使用时间”的定义。也就是说，我们关心每个数据点发生的时间吗？可能不是，因为时间上紧密相连的一组“打开”和“关闭”事件应该算作一个用户在那个时间使用手机的例子。
- en: 'That means we could use the start time from the session-level DataFrame created
    earlier. The following code creates a column to extract the hour component of
    the dates so we can isolate just the hour in which browsing began. Then, we plot
    the distribution of these “start hours,” the result of which is shown in figure
    12.21:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着我们可以使用之前创建的会话级DataFrame中的开始时间。以下代码创建了一个列来提取日期的小时部分，这样我们就可以隔离浏览开始的那个小时。然后，我们绘制了这些“开始小时”的分布，结果如图12.21所示：
- en: '[PRE20]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![figure](../Images/12-21.png)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-21.png)'
- en: Figure 12.21 The distribution of when users start their browsing sessions
  id: totrans-227
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.21 用户开始浏览会话的时间分布
- en: This chart tells us that most browsing sessions start in the late afternoon/early
    evening, with a dip in the early hours of the day. What it doesn’t tell us is
    whether there are users who behave differently to this general trend. For that,
    we need to calculate what the most common starting hour, or part of the day, is
    for each user.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 这个图表告诉我们，大多数浏览会话在傍晚/晚上开始，在一天早些时候有所下降。但它没有告诉我们是否有用户的行为与这个总体趋势不同。为了做到这一点，我们需要计算每个用户最常见的开始小时或一天中的哪个部分。
- en: Note  In this section, we will explore the temporal aspect of this data. If
    you’re interested in more examples of working with time series data, see chapters
    8 and 9.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 注释：在本节中，我们将探讨数据的时序方面。如果你对处理时间序列数据的更多示例感兴趣，请参阅第8章和第9章。
- en: Let’s now calculate the most common starting hour for each user. We can use
    the statistical mode for this, which simply returns the most common value. However,
    we need to decide what happens if there is a tie. What if someone’s most common
    browsing time is both 8 a.m. and 5 p.m.? There is no reason to prefer one or the
    other, so we will leave both values in. Therefore, that user will be represented
    twice, which may skew the results by overrepresenting some users, but it will
    also retain valuable information.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们现在计算每个用户最常开始的小时。我们可以使用统计众数来做这件事，它简单地返回最常出现的值。然而，我们需要决定如果出现平局怎么办。如果某人的最常见浏览时间是早上8点和下午5点怎么办？没有理由偏好其中一个，所以我们将保留两个值。因此，该用户将被表示两次，这可能会通过过度代表某些用户来扭曲结果，但也会保留有价值的信息。
- en: 'The following code defines a function to return possibly multiple values of
    the mode for each user and then applies it to the DataFrame. A snapshot of the
    resulting DataFrame is shown in figure 12.22:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码定义了一个函数，用于返回每个用户可能的多重众数值，并将其应用于DataFrame。结果DataFrame的快照如图12.22所示：
- en: '[PRE21]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '#1 Calculates the mode, possibly returning multiple values'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 计算众数，可能返回多个值'
- en: '#2 Applies this function and extracts all the most common starting hours'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 应用此函数并提取所有最常开始的小时'
- en: '#3 Cleans up unnecessary columns created by grouping and aggregating'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 清理由分组和聚合创建的不必要列'
- en: '![figure](../Images/12-22.png)'
  id: totrans-236
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-22.png)'
- en: Figure 12.22 A snapshot of the most common starting hour for users’ browsing
    sessions
  id: totrans-237
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.22 用户浏览会话最常见开始时间的快照
- en: 'As shown in figure 12.22, there are instances of a user having multiple most
    frequent start times, such as user 0, who browses equally frequently around 4
    p.m. and 10 p.m. From this data, we can now look at the distribution of the newly
    created `most_ frequent_hour` column to understand whether there are users who
    prefer different times in the day for using their phones. The following code investigates
    this and produces the chart in figure 12.23:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 如图12.22所示，有用户有多个最频繁的开始时间的情况，例如用户0，他们在下午4点和晚上10点浏览的频率相同。从这些数据中，我们现在可以查看新创建的`most_frequent_hour`列的分布，以了解是否有用户更喜欢一天中的不同时间使用他们的手机。以下代码调查了这一点，并生成了图12.23中的图表：
- en: '[PRE22]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '![figure](../Images/12-23.png)'
  id: totrans-240
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-23.png)'
- en: Figure 12.23 Distribution of users’ most common browsing times
  id: totrans-241
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.23 用户最常见浏览时间的分布
- en: What this chart tells us is that there are distinct groups of users who prefer
    to browse in the morning around 6 a.m., at lunchtime around 1 p.m., or at 5 p.m.
    in the evening, with another peak starting at midnight.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 这个图表告诉我们，有不同群体的用户更喜欢在早上6点左右、中午1点左右或晚上5点左右浏览，还有一个高峰在午夜开始。
- en: Before we move on to decide how to use this information in our user segments,
    let’s add this to our growing diagram of our analysis, which is shown in figure
    12.24.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们决定如何在我们用户分割中使用这些信息之前，让我们将这个信息添加到我们不断增长的图表中，该图表如图12.24所示。
- en: '![figure](../Images/12-24.png)'
  id: totrans-244
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-24.png)'
- en: Figure 12.24 The process diagram, including the start of part 2 of the analysis
  id: totrans-245
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.24 过程图，包括分析第二部分的开头
- en: 'We could use the data shown in figure 12.22 as a dimension in our segments,
    that is, the actual most common start hour for a user. However, there would be
    two problems:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用图12.22中显示的数据作为我们分割的一个维度，即用户实际最常开始浏览的小时。然而，会有两个问题：
- en: Some users would have multiple rows, which will not work for a segmentation
    problem.
  id: totrans-247
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一些用户可能有多个行，这在分割问题中可能不起作用。
- en: Some hours of the day are very similar, that is, it doesn’t matter if a user
    started their browsing at 4 p.m. or 5 p.m.
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一天中的某些小时非常相似，也就是说，用户在下午4点或5点开始浏览没有区别。
- en: We want to find distinct user groups so we can group these similar times together
    instead. We could have done this up front, that is, grouped different parts of
    the day together into “morning,” “midday,” and so on, and investigated the distribution
    of those categories. However, we would have made assumptions about which hours
    are similar in terms of mobile usage. By looking at the distribution of individual
    hours first, we can create groups that closely match what we find in the data.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 我们想要找到不同的用户群体，这样我们就可以将这些相似的时间分组在一起。我们本可以在一开始就做这件事，即把一天的不同时间段分组为“早上”、“中午”等等，并调查这些类别的分布。然而，我们会做出关于哪些小时在移动使用方面相似的假设。通过首先查看个别小时的分布，我们可以创建与我们在数据中找到的非常接近的组。
- en: Creating customer labels based on browsing patterns
  id: totrans-250
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 根据浏览模式创建客户标签
- en: Looking at the chart in figure 12.23, we could conclude there are anywhere between
    two and five “peaks,” which could act as different parts of the day. The choice
    of how many categories to use will be somewhat subjective. Let’s go with four
    categories, as this might fit the data best without creating too many user segments
    down the line. Our groups will be
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 观察图12.23中的图表，我们可以得出结论，有两个到五个“峰值”，这些可以作为一天中的不同部分。使用多少个类别的选择将有些主观。让我们选择四个类别，因为这可能最适合数据，而不会在后续创建太多的用户细分。我们的群体将是
- en: Night owls, who tend to browse between 9 p.m. and 3 a.m. (inclusive)
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 夜猫子，通常在晚上9点到凌晨3点（含）之间浏览
- en: Early morning users, who tend to browse between 4 a.m. and 9 a.m. (inclusive)
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 早晨用户，通常在凌晨4点到上午9点（含）之间浏览
- en: Midday users, who tend to browse between 10 a.m. and 2 p.m. (inclusive)
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 中午用户，通常在上午10点到下午2点（含）之间浏览
- en: Late-day users, who tend to browse between 3 p.m. and 8 p.m. (inclusive)
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 晚间用户，通常在下午3点到晚上8点（含）之间浏览
- en: 'Let’s create these groups and investigate how many users are in each group.
    The following code does the categorization and produces the output in figure 12.25:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们创建这些群体并调查每个群体中有多少用户。以下代码进行分类并在图12.25中生成输出：
- en: '[PRE23]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '#1 Fixes additional night owl values'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 修复了额外的夜猫子值'
- en: '![figure](../Images/12-25.png)'
  id: totrans-259
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-25.png)'
- en: Figure 12.25 Users’ most common browsing hours grouped into four categories
  id: totrans-260
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.25 将用户最常浏览的时间分组为四个类别
- en: Now, we can investigate the membership in these groups. The following code calculates
    the distribution and produces the output shown in figure 12.26.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以调查这些群体的成员资格。以下代码计算分布并生成图12.26所示的输出。
- en: '[PRE24]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![figure](../Images/12-26.png)'
  id: totrans-263
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-26.png)'
- en: Figure 12.26 Distribution of the categories of users’ browsing sessions
  id: totrans-264
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.26 用户浏览会话类别的分布
- en: 'Let’s now use this dataset to create a one-hot encoded representation of these
    categories, that is, one binary column to indicate membership in each category.
    Crucially, a user can be in multiple categories, as shown in figure 12.25\. See
    chapter 6 for more examples of this in practice. The following code creates the
    one-hot encoding and produces the start of a user-level dataset, which we will
    use for segmentation. A snapshot of this new dataset is shown in figure 12.27:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们使用这个数据集来创建这些类别的one-hot编码表示，即一个二进制列来指示每个类别的成员资格。关键的是，一个用户可以属于多个类别，如图12.25所示。更多实践中的例子请见第6章。以下代码创建one-hot编码并生成用户级别数据集的开始部分，我们将使用它进行细分。这个新数据集的快照如图12.27所示：
- en: '[PRE25]'
  id: totrans-266
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '#1 get_dummies created the one-hot encoded columns.'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 get_dummies 创建了one-hot编码的列。'
- en: '![figure](../Images/12-27.png)'
  id: totrans-268
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-27.png)'
- en: Figure 12.27 A snapshot of user-level data showing which browsing time categories
    users belong to
  id: totrans-269
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.27 用户级别的数据快照，显示用户属于哪些浏览时间类别
- en: We have now created a dataset that we can add additional columns to and run
    the segmentation algorithm on. Before we move on to the next stakeholder question,
    which is about what types of apps people use, let’s update our diagram of the
    work done so far. The latest version is shown in figure 12.28.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在创建了一个可以添加额外列并运行细分算法的数据集。在我们继续下一个利益相关者问题之前，即人们使用哪些类型的应用程序，让我们更新到目前为止完成的工作的图表。最新版本如图12.28所示。
- en: '![figure](../Images/12-28.png)'
  id: totrans-271
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-28.png)'
- en: Figure 12.28 The process so far, including grouping people into categories based
    on when they browse
  id: totrans-272
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.28 到目前为止的过程，包括根据浏览时间将人们分组到类别中
- en: We can now move on to our next stakeholder question about what types of apps
    people use.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以继续我们的下一个利益相关者问题，即人们使用哪些类型的应用程序。
- en: Using AI to label data
  id: totrans-274
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 使用人工智能进行数据标注
- en: Our stakeholders want us to investigate what types of apps people use and potentially
    use that information in the segmentation. However, we do not have data on app
    type directly, just a list of app names. This is a clear example of more information
    being contained in the raw data than we might think at first. A domain expert
    could easily categorize each app name into some broader category. This is a perfect
    use case for AI to augment our work.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的利益相关者希望我们调查人们使用哪些类型的应用程序，并可能使用这些信息进行细分。然而，我们没有关于应用程序类型的直接数据，只有应用程序名称的列表。这是一个明显的例子，原始数据中包含的信息比我们最初想象的要多。领域专家可以轻松地将每个应用程序名称分类到更广泛的类别中。这是一个非常适合使用人工智能来增强我们工作的用例。
- en: 'There are over 80 distinct app names to categorize. It’s doable but repetitive
    to do by hand, so let’s ask an AI to do it. We can use the following code snippet
    to get the app names as a list to pass to the AI tool:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 有超过80个不同的应用名称需要分类。手动操作虽然可行但很重复，所以让我们请一个AI来帮忙。我们可以使用以下代码片段来获取应用名称列表，然后传递给AI工具：
- en: '[PRE26]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: The following prompt, asking ChatGPT to categorize the app names for us, generates
    the output shown in figure 12.29.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 以下提示，要求ChatGPT为我们分类应用名称，生成了图12.29所示的输出。
- en: 'I will provide a list of mobile application names. To the best of your ability,
    group them into logical categories, e.g., email, social media, web browser, mobile
    games, etc. I’d like the response as a table with columns *''app_name''* and *''category''*.
    If you are unsure what category an app belongs to, put “Unknown.” Here is the
    list of app names: <app names follow>.'
  id: totrans-279
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 我将提供一个移动应用名称列表。尽你所能，将它们分组到逻辑类别中，例如，电子邮件、社交媒体、网络浏览器、移动游戏等。我希望以包含列*'app_name'*和*'category'*的表格形式得到响应。如果你不确定一个应用属于哪个类别，请填写“未知。”以下是应用名称列表：<app
    names follow>。
- en: '![figure](../Images/12-29.png)'
  id: totrans-280
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-29.png)'
- en: Figure 12.29 Part of ChatGPT’s response to categorize app names into broader
    categories
  id: totrans-281
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.29 ChatGPT对将应用名称分类到更广泛类别的一部分响应
- en: Note  It is important to note that these tools don’t always produce the same
    output for the same prompt. They are also evolving all the time, so you will almost
    certainly get a different output than I do for the same prompt. This is a feature
    of the analytics process, not a bug.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：重要的是要注意，这些工具并不总是对相同的提示产生相同的输出。它们也在不断进化，所以你几乎肯定会得到与我相同的提示不同的输出。这是分析过程的一个特性，而不是一个错误。
- en: 'Once we are satisfied with the output, we can specifically request the data
    as a CSV file and merge it into our own data. The following code achieves this,
    and a snapshot is shown in figure 12.30:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们对输出满意，我们可以特别请求以CSV文件形式的数据，并将其合并到我们自己的数据中。以下代码实现了这一点，并在图12.30中展示了快照：
- en: '[PRE27]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '![figure](../Images/12-30.png)'
  id: totrans-285
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-30.png)'
- en: Figure 12.30 A snapshot of the categorization data produced by ChatGPT
  id: totrans-286
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.30 ChatGPT生成的分类数据快照
- en: Let’s add this latest step to our process diagram, the latest version of which
    is shown in figure 12.31.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将这个最新的步骤添加到我们的流程图中，最新的版本如图12.31所示。
- en: '![figure](../Images/12-31.png)'
  id: totrans-288
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-31.png)'
- en: Figure 12.31 The latest diagram of our steps, including ChatGPT’s categorization
    of apps
  id: totrans-289
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.31我们步骤的最新图示，包括ChatGPT对应用分类
- en: 'Let’s now see the distribution of this category data. The following code calculates
    this and produces the output in figure 12.32:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们现在看看这个类别数据的分布。以下代码计算了这一点，并在图12.32中产生了输出：
- en: '[PRE28]'
  id: totrans-291
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '![figure](../Images/12-32.png)'
  id: totrans-292
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-32.png)'
- en: Figure 12.32 Distribution of newly created app categories
  id: totrans-293
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.32新创建的应用类别分布
- en: 'There are a couple of things to notice here. One is that there are a few “Unknown”
    values, which we should investigate and manually categorize. The second is that
    there are quite a lot of categories, probably too many to be useful. First, let’s
    resolve the “Unknown” values. The following code investigates these values, and
    they are shown in figure 12.33:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里有几个需要注意的事项。一是存在一些“未知”值，我们应该调查并手动分类。二是分类很多，可能太多以至于没有实际用途。首先，让我们解决“未知”值的问题。以下代码调查了这些值，并在图12.33中展示：
- en: '[PRE29]'
  id: totrans-295
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '![figure](../Images/12-33.png)'
  id: totrans-296
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-33.png)'
- en: Figure 12.33 App names that ChatGPT could not categorize
  id: totrans-297
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.33 ChatGPT无法分类的应用名称
- en: 'We can manually categorize these with a bit of research and some code snippets.
    The following code updates the category of these specific app names:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过一些研究和一些代码片段手动对这些应用名称进行分类。以下代码更新了这些特定应用名称的分类：
- en: '[PRE30]'
  id: totrans-299
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Now, let’s handle the second problem, which is that ChatGPT created too many
    categories. We can choose to ask ChatGPT to revise its categorization and ask
    for fewer columns, or we could use ChatGPT’s categories as subcategories and define
    main categories ourselves. It’s a personal choice, but it shouldn’t take too long
    to do this ourselves, and that way, we have the categorization code ready if we
    decide to change the categories later.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们处理第二个问题，即ChatGPT创建了太多的类别。我们可以选择要求ChatGPT修订其分类并请求更少的列，或者我们可以使用ChatGPT的类别作为子类别，并自己定义主类别。这是一个个人选择，但这不应该花费太多时间，这样我们就有分类代码了，如果以后决定更改类别的话。
- en: Reviewing AI-created data labels
  id: totrans-301
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 审查AI创建的数据标签
- en: 'One `pandas` trick is to use the `map` method to map categories to new ones
    based on a dictionary. We don’t want to type this dictionary out ourselves, but
    we can write a bit of code to print the categories in the required format, which
    we copy and paste into our main mapping code. The following code prints the existing
    categories in the right format, leaving space for the new category alongside.
    The output is shown in figure 12.34, so you can see how it would be pasted to
    create the code snippet that follows later:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 一个`pandas`技巧是使用`map`方法根据字典将类别映射到新的类别。我们不想自己输入这个字典，但我们可以编写一些代码来以所需格式打印类别，然后将它们复制并粘贴到我们的主要映射代码中。以下代码以正确的格式打印现有类别，并在旁边留出空间用于新类别。输出显示在图12.34中，因此您可以看到它如何粘贴以创建稍后跟随的代码片段：
- en: '[PRE31]'
  id: totrans-303
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '![figure](../Images/12-34.png)'
  id: totrans-304
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-34.png)'
- en: Figure 12.34 Our categories in a format required by a Python dictionary
  id: totrans-305
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.34 我们所需的Python字典格式的类别
- en: 'Now, we can use this output to create the following code, which updates each
    existing category with its new categorization. We will keep the existing category
    column as a subcategory, so we have two levels of app category hierarchy. Figure
    12.35 shows a snapshot of the categories dataset after these updates:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以使用这个输出创建以下代码，该代码将更新每个现有类别及其新的分类。我们将保留现有的类别列作为子类别，因此我们有应用类别层次结构的两个级别。图12.35显示了这些更新后的类别数据集的快照。
- en: '[PRE32]'
  id: totrans-307
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '![figure](../Images/12-35.png)'
  id: totrans-308
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-35.png)'
- en: Figure 12.35 A snapshot of the categories data after applying our new categorization
  id: totrans-309
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.35 应用类别数据应用新分类后的快照
- en: Before we merge this back into the main app data, let’s review our process by
    updating our diagram. The latest version is shown in figure 12.36.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们将这些合并回主要应用数据之前，让我们通过更新我们的流程图来回顾我们的过程。最新版本显示在图12.36中。
- en: '![figure](../Images/12-36.png)'
  id: totrans-311
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-36.png)'
- en: Figure 12.36 The latest process, including a review of ChatGPT’s categorization
  id: totrans-312
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.36 最新流程，包括对ChatGPT分类的回顾
- en: Now, it’s time to merge these categories back to our original data and see how
    people use these various app types. The following code joins the event-level app
    data to the app categories, creating merged data, a snapshot of which is shown
    in figure 12.37.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，是时候将这些类别合并回我们的原始数据，看看人们如何使用这些各种应用类型了。以下代码将事件级应用数据与应用类别合并，创建合并数据，图12.37显示了其快照。
- en: '[PRE33]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '#1 Raises an error message if we don’t have the same number of rows after the
    merge'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 如果合并后我们没有相同数量的行，将引发错误信息'
- en: '![figure](../Images/12-37.png)'
  id: totrans-316
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-37.png)'
- en: Figure 12.37 A snapshot of the app data merged with app categories
  id: totrans-317
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.37 应用数据与应用类别合并后的快照
- en: From this data, we want to find each user’s most common app category. After
    that, we will investigate whether there are ties, that is, users who have more
    than one category as their most common.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 从这些数据中，我们希望找到每个用户最常用的应用类别。之后，我们将调查是否存在平局，即拥有多个类别作为最常用类别的用户。
- en: Analyzing newly created category labels
  id: totrans-319
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 分析新创建的类别标签
- en: 'The following code calculates the top categories per user, and a snapshot of
    the output is shown in figure 12.38\. Note that `pandas` creates a column called
    `level_1` because the mode function could return multiple values, as it did when
    we looked at app usage times:'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码计算每个用户的顶级类别，并在图12.38中显示了输出快照。请注意，`pandas`创建了一个名为`level_1`的列，因为`mode`函数可以返回多个值，就像我们在查看应用使用时间时做的那样：
- en: '[PRE34]'
  id: totrans-321
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '![figure](../Images/12-38.png)![figure](../Images/12-38.png)'
  id: totrans-322
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-38.png)![figure](../Images/12-38.png)'
- en: Figure 12.38 A snapshot of the “most common category per user” dataset
  id: totrans-323
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.38 “每个用户最常用类别”数据集的快照
- en: 'From this data, we can investigate whether there are users with multiple categories
    as their most common. We can use this `level_1` column that `pandas` created to
    filter our data. Anything with a value of zero means the user’s top category,
    so values greater than zero mean a user has multiple top categories. The following
    code investigates this and produces the output in figure 12.39:'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 从这些数据中，我们可以调查是否存在用户将多个类别作为他们最常用的类别。我们可以使用`pandas`创建的`level_1`列来过滤我们的数据。任何值为零的项意味着用户的顶级类别，因此大于零的值意味着用户有多个顶级类别。以下代码调查了这一点，并在图12.39中产生了输出：
- en: '[PRE35]'
  id: totrans-325
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '![figure](../Images/12-39.png)'
  id: totrans-326
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-39.png)'
- en: Figure 12.39 Users with more than one top app category
  id: totrans-327
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.39 拥有多个顶级应用类别的用户
- en: 'Let’s examine these users in more detail and see if we can decide how to proceed.
    The following code retrieves all records for these users and produces the output
    in figure 12.40:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们更详细地检查这些用户，看看我们是否可以决定如何继续。以下代码检索这些用户的全部记录，并在图 12.40 中生成输出：
- en: '[PRE36]'
  id: totrans-329
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: '![figure](../Images/12-40.png)'
  id: totrans-330
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-40.png)'
- en: Figure 12.40 All category data for users with more than one top category
  id: totrans-331
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 12.40 拥有多个顶级类别的用户的所有类别数据
- en: 'We can either remove one of those categories per user or record our data the
    same way we did with app times, that is, users would be allowed more than one
    top category. As there are only three affected users in this case, we will investigate
    whether we could drop one of their top categories. How do we decide which of the
    two categories to drop? Let’s first look at the underlying data for the user with
    ID 35\. The following code retrieves the data for that user at an individual app
    level, which is then shown in figure 12.41:'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以为每个用户删除一个类别，或者以与我们处理应用程序时间相同的方式记录我们的数据，即用户可以拥有多个顶级类别。在这种情况下，只有三个受影响的用户，我们将调查是否可以删除他们的一个顶级类别。我们如何决定删除哪两个类别？让我们首先查看
    ID 为 35 的用户的底层数据。以下代码检索该用户的单个应用程序级别的数据，然后显示在图 12.41 中：
- en: '[PRE37]'
  id: totrans-333
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: '![figure](../Images/12-41.png)'
  id: totrans-334
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-41.png)'
- en: Figure 12.41 User 35’s app usage by category and app name
  id: totrans-335
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 12.41 用户 35 的按类别和应用程序名称的应用程序使用情况
- en: 'This user used the Settings app quite heavily, which contributed to the “Utility”
    category being joint top for them. We don’t have more detailed information about
    why this user kept opening their phone settings. We can use what we have to decide
    if it’s more relevant that the user uses the “Social” apps most frequently. We
    will drop the necessary record for this user to have “Social” as their only top
    category. User 132 also had “Utility” as their joint top category, so for the
    same reason, we’ll drop that record as well. The following code cleans up the
    data for these two users:'
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 这个用户非常频繁地使用设置应用程序，这导致了对于他们来说“实用”类别是并列的顶级类别。我们没有更多关于为什么这个用户持续打开他们的手机设置的原因的详细信息。我们可以使用我们所拥有的信息来决定用户最频繁使用“社交”应用程序是否更相关。我们将删除这个用户必要的记录，使其“社交”成为他们唯一的顶级类别。用户
    132 也将“实用”作为他们的并列顶级类别，因此出于同样的原因，我们将删除该记录。以下代码清理了这两个用户的数据：
- en: '[PRE38]'
  id: totrans-337
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Finally, let’s look at user 223 and decide whether they better fit a “Social”
    or “Browsing” category. The following code looks at their data at an app level
    and produces the output shown in figure 12.42:'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，让我们看看用户 223，并决定他们更适合“社交”还是“浏览”类别。以下代码查看他们的应用程序级别的数据，并生成图 12.42 中的输出：
- en: '[PRE39]'
  id: totrans-339
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: '![figure](../Images/12-42.png)'
  id: totrans-340
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-42.png)'
- en: Figure 12.42 App-level usage data for user 223
  id: totrans-341
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 12.42 用户 223 的应用程序级别使用数据
- en: 'This one is trickier to categorize because they make heavy use of social apps
    but also frequently use the Google app. However, that could mean multiple things,
    some of which might not fit under “Browsing,” so we’ll decide that this user better
    fits the “Social” label. The following code removes the necessary record. We then
    retest the data to verify there are no users with multiple “top app category”
    records:'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 这个分类比较困难，因为他们大量使用社交应用程序，同时也频繁使用谷歌应用程序。然而，这可能意味着多件事，其中一些可能不适合“浏览”类别，因此我们将决定这个用户更适合“社交”标签。以下代码删除必要的记录。然后我们重新测试数据以验证没有用户有多个“顶级应用程序类别”记录：
- en: '[PRE40]'
  id: totrans-343
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'The output of that latest snippet is an empty list, meaning we no longer have
    users with multiple top app categories. We can now create the indicator variables
    required for our clustering algorithm. The following code creates these indicator
    variables and produces the output in figure 12.43:'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 那个最新片段的输出是一个空列表，这意味着我们不再有拥有多个顶级应用程序类别的用户。我们现在可以创建聚类算法所需的指标变量。以下代码创建这些指标变量，并在图
    12.43 中生成输出：
- en: '[PRE41]'
  id: totrans-345
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: '![figure](../Images/12-43.png)'
  id: totrans-346
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-43.png)'
- en: Figure 12.43 The one-hot encoded version of our “top app category by user” data
  id: totrans-347
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 12.43 我们“按用户顶级应用程序类别”数据的独热编码版本
- en: The data in this format is ready to be joined to the user-level data that we
    created in figure 12.27\. Before merging the two datasets, let’s review our progress
    so far. The latest diagram of our analysis is shown in figure 12.44.
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 这种格式的数据已准备好与我们在图 12.27 中创建的用户级别数据合并。在合并这两个数据集之前，让我们回顾一下到目前为止的进展。我们分析的最新图示显示在图
    12.44 中。
- en: '![figure](../Images/12-44.png)'
  id: totrans-349
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/12-44.png)'
- en: Figure 12.44 The latest progress in our analysis
  id: totrans-350
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 12.44 我们分析的最新进展
- en: We have investigated the data relating to our stakeholder questions. Now, we
    will merge the most frequent app category data and the most frequent browsing
    time data to build up our user-level dataset. We will also create and include
    columns from the initial analysis and have a user-level dataset ready for segmentation.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经调查了与我们的利益相关者问题相关的数据。现在，我们将合并最频繁使用的应用类别数据和最频繁的浏览时间数据，以构建我们的用户级数据集。我们还将创建并包含初始分析中的列，并准备好用于分割的用户级数据集。
- en: Creating a user-level dataset for segmentation
  id: totrans-352
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 创建用于分割的用户级数据集
- en: 'So far, we have one user-level dataset of what times people tend to use their
    phones the most and another that contains the most frequent app category per user.
    We’ll join these together and then add other metrics. The following code merges
    the two datasets, and a snapshot of the merged data is shown in figure 12.45:'
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们有一个用户级数据集，其中包含人们倾向于使用手机的时间，以及另一个包含每个用户最频繁使用的应用类别。我们将它们合并在一起，然后添加其他指标。以下代码合并了这两个数据集，合并数据的快照如图12.45所示：
- en: '[PRE42]'
  id: totrans-354
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: '![figure](../Images/12-45.png)'
  id: totrans-355
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-45.png)'
- en: Figure 12.45 A snapshot of the user-level data so far
  id: totrans-356
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.45 到目前为止的用户级数据快照
- en: The initial analysis involved the number of unique apps used per user and the
    average length of their browsing sessions to segment the users. There is no reason
    not to keep these metrics in there, so let’s recreate them and join them to our
    current dataset. We will also add “number of sessions” as a proxy for how heavily
    a user uses their phone since, otherwise, that aspect of usage is not captured
    in any of our variables.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 初始分析包括每个用户使用的唯一应用数量和他们的浏览会话的平均长度，以分割用户。没有理由不保留这些指标，所以让我们重新创建它们并将它们添加到我们当前的数据集中。我们还将添加“会话数量”作为用户如何频繁使用手机的代理，因为否则，使用方面的这一方面在我们的任何变量中都没有被捕捉到。
- en: 'First, we can add columns relating to the number of apps and sessions straight
    from the raw app data. The following code counts the number of unique apps and
    sessions per user and produces a dataset, a snapshot of which is shown in figure
    12.46:'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们可以直接从原始应用数据中添加与应用数量和会话数量相关的列。以下代码计算每个用户的唯一应用和会话数量，并生成一个数据集，其快照如图12.46所示：
- en: '[PRE43]'
  id: totrans-359
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '![figure](../Images/12-46.png)'
  id: totrans-360
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-46.png)'
- en: Figure 12.46 A user-level dataset counting the number of unique apps and sessions
    per user
  id: totrans-361
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.46 计算每个用户唯一应用和会话数量的用户级数据集
- en: 'Let’s now join this table to the dataset we created in figure 12.45\. The following
    code achieves this:'
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们将此表与我们在图12.45中创建的数据集结合起来。以下代码实现了这一点：
- en: '[PRE44]'
  id: totrans-363
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'To add the average session length, we need to turn to the session-level data
    we created earlier in section 12.5.1\. We will group it by user ID and calculate
    the median duration of each session per user. The following code does this and
    produces a dataset, a snapshot of which is shown in figure 12.47:'
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 要添加平均会话长度，我们需要转向我们在12.5.1节中早期创建的会话级数据。我们将按用户ID对其进行分组，并计算每个用户的会话中值持续时间。以下代码执行此操作并生成一个数据集，其快照如图12.47所示：
- en: '[PRE45]'
  id: totrans-365
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: '![figure](../Images/12-47.png)'
  id: totrans-366
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-47.png)'
- en: Figure 12.47 Average session duration per user
  id: totrans-367
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.47 每个用户的平均会话持续时间
- en: 'Our final step before segmentation is to merge this table into the main user-level
    data. The following code does this, and figure 12.48 shows all the columns in
    the data we will use for segmentation:'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 在分割之前，我们的最后一步是将此表合并到主要用户级数据中。以下代码执行此操作，图12.48显示了我们将用于分割的数据中的所有列：
- en: '[PRE46]'
  id: totrans-369
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: '![figure](../Images/12-48.png)'
  id: totrans-370
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-48.png)'
- en: Figure 12.48 All the columns we will use to segment users
  id: totrans-371
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.48 我们将用于分割用户的所有列
- en: 'Let’s export this user-level data directly to the next chapter’s folder so
    we can start the segmentation process directly from this dataset:'
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将此用户级数据直接导出到下一章的文件夹中，这样我们就可以直接从这个数据集开始分割过程：
- en: '[PRE47]'
  id: totrans-373
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: Before moving on to the segmentation part in the next chapter, let’s review
    everything we’ve done so far.
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 在进入下一章的分割部分之前，让我们回顾一下到目前为止我们所做的一切。
- en: 12.5.3 Project progress so far
  id: totrans-375
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 12.5.3 到目前为止的项目进度
- en: 'Let’s recap the progress on this project:'
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回顾一下这个项目的进度：
- en: We started by investigating the work behind the initial presentation and verified
    the summary statistics that were presented.
  id: totrans-377
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们首先调查了初始演示背后的工作，并验证了所展示的总结统计信息。
- en: We continued the analysis by diving deeper into user behavior and concluded
    that there are distinct groups of people who use their phones at different times.
  id: totrans-378
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们通过深入分析用户行为继续分析，并得出结论，有不同时间使用手机的人群群体。
- en: We used generative AI to categorize app names into broader app categories.
  id: totrans-379
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们使用生成式AI将应用名称分类到更广泛的应用类别中。
- en: We used these app categories to identify different user behaviors based on what
    apps a user uses the most.
  id: totrans-380
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们根据用户最常使用哪些应用来识别不同的用户行为，并使用这些应用类别。
- en: Finally, we exported a user-level dataset ready for segmentation in the next
    phase.
  id: totrans-381
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后，我们导出了一个准备在下一阶段进行分段的用户级数据集。
- en: Figure 12.49 shows the entire process up to this point.
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.49显示了到目前为止的整个过程。
- en: '![figure](../Images/12-49.png)'
  id: totrans-383
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/12-49.png)'
- en: Figure 12.49 Parts 1 and 2 of the analysis before segmentation starts
  id: totrans-384
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图12.49 分段开始前的分析部分1和2
- en: In the following chapter, we will use the exported user-level data to segment
    users into distinct groups to answer our stakeholders’ questions.
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将使用导出的用户级数据将用户划分为不同的组，以回答利益相关者的问题。
- en: Summary
  id: totrans-386
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Continuing someone else’s work starts with retracing their steps.
  id: totrans-387
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 继续别人的工作从重新追踪他们的步骤开始。
- en: Recreating the initial analysis helps us understand the problem and find any
    errors.
  id: totrans-388
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重新创建初始分析有助于我们理解问题并找出任何错误。
- en: When continuing someone else’s work, their assumptions and decisions should
    be checked and verified.
  id: totrans-389
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在继续别人的工作时，应该检查和验证他们的假设和决策。
