- en: 'Chapter 6\. Emergency tools: Building a system recovery device'
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第六章\. 紧急工具：构建系统恢复设备
- en: '*This chapter covers*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*本章涵盖*'
- en: Recovering broken Linux systems
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 恢复损坏的Linux系统
- en: Controlling resources with Linux live-boot drives
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Linux live-boot驱动控制资源
- en: Recovering data from damaged storage media
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从损坏的存储介质恢复数据
- en: Manipulating an inaccessible file system
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 操作无法访问的文件系统
- en: 'Don’t try to convince yourself otherwise: along with all the good stuff, you’re
    going to have bad days with Linux. Sometimes you’re going to forget the syntax
    for commands (which is why you should always keep a copy of this book within reach).
    You (or the users you support) are going to mistype commands and permanently destroy
    documents. Or, you’re going to experience that sinking feeling when you realize
    that some important piece of hardware or software has failed. (That’s gratitude
    after everything you did for it all those years.) Being properly backed up, as
    the last couple of chapters demonstrated, means that you can walk away from a
    nonfunctioning operating system (OS) or computer and rebuild it all somewhere
    else. But that’s always going to be Plan B. Plan A is to recover.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 不要试图说服自己否则：除了所有的好东西，你还会在Linux中遇到坏日子。有时你会忘记命令的语法（这就是为什么你应该总是把这本书放在手边）。你（或你支持的用户）会误打命令并永久性地破坏文档。或者，当你意识到某些重要的硬件或软件已经失败时，你会感到一种沉沦的感觉。（那是在你为它做了所有那些年后的感激。）正如最后几章所展示的，正确备份意味着你可以离开一个无法工作的操作系统（OS）或计算机，并在其他地方重建它。但那始终将是B计划。A计划是恢复。
- en: This chapter is where I’ll introduce you to key tools from the Linux recovery
    suite. You’ll learn how you can use a live-boot device to load a fresh copy of
    Linux, mount the drive that’s giving you trouble, and either update corrupted
    configuration files so you can boot normally again or rescue whatever data can
    be recovered before repurposing or destroying the damaged drive. And you’ll see
    how the files of a non-functional system can be *brought to life* and run within
    their own virtual environment, so you can do things like changing a user’s forgotten
    password.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我将向你介绍Linux恢复套件中的关键工具。你将了解如何使用live-boot设备加载Linux的新副本，挂载给你带来麻烦的驱动器，或者更新损坏的配置文件以便你可以正常启动，或者在你重新使用或销毁损坏的驱动器之前恢复任何可以恢复的数据。你还将看到如何使非功能系统的文件“复活”并在它们自己的虚拟环境中运行，这样你就可以做一些事情，比如更改用户忘记的密码。
- en: 'There’s a lot that can go wrong when you try to throw hardware and software
    into a single box and expect them to play nicely together. I’m going to focus
    on catastrophic events like these:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 当你试图将硬件和软件放入一个盒子中并期望它们和睦相处时，可能会出很多问题。我将专注于这些灾难性事件：
- en: Your computer boots, the hard drive is working, but Linux doesn’t load.
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你的计算机启动了，硬盘工作正常，但Linux没有加载。
- en: Your computer boots (as far as you can tell, anyway), but you’re not quite sure
    whether the hard drive is fully functional.
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你的计算机启动了（至少就你所知是这样），但你并不确定硬盘是否完全正常工作。
- en: Everything works, but a software problem or lost password prevents you from
    logging in to Linux.
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一切都正常工作，但软件问题或丢失的密码阻止你登录到Linux。
- en: The specific problem you’re facing will determine your plan of action to get
    yourself back in business. [Figure 6.1](#ch06fig01) illustrates some diagnostic
    and recovery options, most of which I’ll discuss later in this chapter.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 你面临的具体问题将决定你采取的行动计划以恢复业务。![图6.1](#ch06fig01)展示了某些诊断和恢复选项，其中大部分我将在本章后面讨论。
- en: Figure 6.1\. Common system problems along with diagnostic and solution considerations
    that we’ll explore in this chapter
  id: totrans-13
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.1\. 本章我们将探讨的常见系统问题以及诊断和解决方案考虑因素
- en: '![](Images/06fig01_alt.jpg)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![图片6.1的替代文本](Images/06fig01_alt.jpg)'
- en: 6.1\. Working in recovery/rescue mode
  id: totrans-15
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.1\. 在恢复/救援模式下工作
- en: Linux not letting you log in normally? Perhaps the boot process unexpectedly
    stops before displaying the login screen. You’ll want some basic system administration
    tools.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: Linux不让你正常登录？也许启动过程在显示登录屏幕之前意外停止。你可能需要一些基本的系统管理工具。
- en: 'But wait: if Linux won’t load, how are you going to launch those tools? Well,
    even if Linux won’t load all the way to a normal command prompt, often it’ll get
    you to the GRUB menu. From there (as [figure 6.2](#ch06fig02) shows), you can
    use the up and down arrow keys and then Enter to select a Linux kernel running
    in recovery mode. That, as you’ll soon see, will open up a whole bag of tricks.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 但等等：如果Linux无法加载，你将如何启动这些工具？好吧，即使Linux无法完全加载到正常命令提示符，它通常也会带你到GRUB菜单。从那里（如图6.2所示），你可以使用上箭头键和下箭头键，然后按Enter键来选择在恢复模式下运行的Linux内核。正如你很快就会看到的，这将打开一整套技巧。
- en: Figure 6.2\. The GRUB Advanced Options menu of an Ubuntu installation showing
    links to both current and older kernel versions, along with options for launching
    in recovery mode
  id: totrans-18
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.2\. Ubuntu安装的GRUB高级选项菜单，显示指向当前和较旧内核版本的链接，以及启动恢复模式的选项
- en: '![](Images/06fig02_alt.jpg)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![图6.2替代](Images/06fig02_alt.jpg)'
- en: Before you’ll be able to take full advantage of those tools, however, you’ll
    first need to understand what GRUB is and how it works. In the next several sections,
    I’m going to explain what GRUB does, how it can be used to access recovery tools,
    and how you can use those tools to get yourself out of some nasty jams.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在你能够充分利用这些工具之前，然而，你首先需要了解GRUB是什么以及它是如何工作的。在接下来的几个部分中，我将解释GRUB的功能，它是如何被用来访问恢复工具的，以及你如何使用这些工具来摆脱一些棘手的困境。
- en: 6.1.1\. The GRUB bootloader
  id: totrans-21
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 6.1.1\. GRUB引导加载程序
- en: What’s *GRUB*? It’s the GNU GRand Unified Bootloader. OK, what’s a *bootloader*?
    It’s the code an OS uses to bring itself to life when it’s powered on. [Figure
    6.3](#ch06fig03) illustrates the process.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 什么是*GRUB*？它是GNU GRand Unified Bootloader。好吧，什么是*引导加载程序*？它是操作系统在开机时用来唤醒自己的代码。[图6.3](#ch06fig03)说明了这个过程。
- en: Figure 6.3\. The key steps in the boot process of a Linux computer
  id: totrans-23
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.3\. Linux计算机启动过程中的关键步骤
- en: '![](Images/06fig03.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![图6.3](Images/06fig03.jpg)'
- en: When a computer powers up, firmware instructions embedded in the basic system
    hardware identify the network, storage, and memory resources that are available.
    This was done through the BIOS system on older computers and, more recently, using
    UEFI (both of which you briefly met back in [chapter 4](kindle_split_012.xhtml#ch04)).
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 当计算机开机时，嵌入在基本系统硬件中的固件指令会识别可用的网络、存储和内存资源。这通过较老计算机上的BIOS系统完成，以及最近使用UEFI（两者你都在第4章中简要了解过）。
- en: Once the system finds a hard-drive partition containing a Master Boot Record
    (MBR), it loads the contents into active memory. On Linux systems, the MBR partition
    contains a number of files that, when run, present one or more loadable kernel
    image boot configurations. You can choose to load any of those configurations
    from the GRUB bootloader menu.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦系统找到一个包含主引导记录（MBR）的硬盘分区，它就会将内容加载到活动内存中。在Linux系统中，MBR分区包含一些文件，当运行时，会提供一到多个可加载的内核映像启动配置。你可以从GRUB引导加载程序菜单中选择加载这些配置中的任何一个。
- en: '|  |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-28
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: Often, GRUB will load its default image automatically without asking for your
    opinion, unless a previous session fails to load. If you want to force the GRUB
    menu to appear, press the right Shift key as your computer boots.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，GRUB会自动加载其默认映像，而不会询问你的意见，除非之前的会话加载失败。如果你想强制GRUB菜单出现，请在计算机启动时按下右Shift键。
- en: '|  |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 6.1.2\. Using recovery mode on Ubuntu
  id: totrans-31
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 6.1.2\. 在Ubuntu上使用恢复模式
- en: As you can see from [figure 6.4](#ch06fig04), once Ubuntu is loaded in recovery
    mode, you’ll be shown a menu of tools that address some common boot-time problems.
    It’s worth trying each in turn, in case one of those ends up addressing your root
    problem. The clean option, for instance, removes unused files if you suspect the
    trouble stems from a full disk. And the dpkg option attempts to fix any broken
    APT-based software packages that might be gumming things up. (The dpkg tool might
    require that you first enable networking.)
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 如[图6.4](#ch06fig04)所示，一旦Ubuntu在恢复模式下加载，你会看到一个工具菜单，这些工具可以解决一些常见的启动时问题。逐一尝试它们是值得的，以防其中之一解决了你的根本问题。例如，清洁选项会在你怀疑问题源于磁盘已满时删除未使用的文件。而dpkg选项则尝试修复任何可能使事情变得混乱的基于APT的软件包（dpkg工具可能需要你首先启用网络）。
- en: Figure 6.4\. The Ubuntu Recovery menu with links to some basic diagnostic and
    repair tools, along with the option of opening a shell session as root
  id: totrans-33
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.4\. Ubuntu恢复菜单，包含指向一些基本诊断和修复工具的链接，以及以root用户打开shell会话的选项
- en: '![](Images/06fig04_alt.jpg)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![图6.4替代](Images/06fig04_alt.jpg)'
- en: The root option opens a root command-line shell session for you where you’ll
    have Bash at your disposal. In general, using a simple shell session for recovery
    rather than a full GUI desktop makes a lot of sense. That’s because the fewer
    complicated services you’ve got running, the more likely it is that you’ll be
    able to at least get your system going.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 根选项为你打开一个根命令行 shell 会话，在那里你可以使用 Bash。一般来说，使用简单的 shell 会话进行恢复而不是完整的 GUI 桌面是有很多道理的。这是因为你运行的服务越少，你至少能够启动系统的可能性就越大。
- en: Once you do manage to get a working command prompt, you can start poking around
    to see if you can identify and fix the problem. At the very least, you’ll look
    mighty cool doing that.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你成功获得一个可用的命令提示符，你就可以开始探索以确定是否可以识别和修复问题。至少，这样做会让你看起来非常酷。
- en: 6.1.3\. Using rescue mode on CentOS
  id: totrans-37
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 6.1.3\. 在 CentOS 上使用救援模式
- en: The GRUB menu for CentOS offers a rescue kernel at boot time rather than a recovery
    mode. This kernel doesn’t include a tool menu like Ubuntu’s, but it will similarly
    drop you into a single-user shell session as root. [Figure 6.5](#ch06fig05) shows
    the rescue boot option in CentOS GRUB.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: CentOS 的 GRUB 菜单在启动时提供救援内核而不是恢复模式。这个内核不包含像 Ubuntu 那样的工具菜单，但它将以类似的方式将你放入一个作为
    root 的单用户 shell 会话。图 6.5 显示了 CentOS GRUB 中的救援启动选项。
- en: Figure 6.5\. CentOS Linux offers a rescue kernel for booting directly to a single-user
    shell session for troubleshooting a damaged system.
  id: totrans-39
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 6.5\. CentOS Linux 提供了一个救援内核，可以直接启动到单用户 shell 会话，用于排除系统损坏的故障。
- en: '![](Images/06fig05_alt.jpg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/06fig05_alt.jpg)'
- en: Once you choose the rescue selection on your CentOS machine, what’s next? You’ll
    get to meet some useful tools through the rest of this chapter. But first, why
    not take a page from the Ubuntu playbook and manually apply some of the tools
    from the automated Recovery menu? “Easier said than done,” I hear you say. “But
    just how do those tools work?” Over next page or so, I’m going to show you how
    to put some of your Bash and scripting skills to work figuring some of that out.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你在 CentOS 机器上选择了救援选项，接下来是什么？你将通过本章的其余部分遇到一些有用的工具。但首先，为什么不从 Ubuntu 操场手册中取一页，手动应用自动化恢复菜单中的某些工具？“说起来容易做起来难，”我听到你说。“但那些工具是如何工作的？”在接下来的几页中，我将向你展示如何运用你的
    Bash 和脚本技能来找出一些答案。
- en: 6.1.4\. Finding command-line rescue tools
  id: totrans-42
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 6.1.4\. 查找命令行救援工具
- en: 'Got an Ubuntu machine running (this one won’t work on Debian)? If there’s code
    running the menu, it must already exist somewhere within the Ubuntu file system.
    Go take a look for yourself. Use `locate` to find it:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有正在运行的 Ubuntu 机器（这个脚本在 Debian 上无法工作）？如果代码正在运行菜单，它必须已经存在于 Ubuntu 文件系统的某个地方。自己去看看吧。使用
    `locate` 来查找它：
- en: '[PRE0]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '***1* The 110n.sh script sets appropriate environment variables for the menu.**'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 110n.sh 脚本为菜单设置适当的环境变量。**'
- en: '***2* The recovery-menu script file**'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 恢复菜单脚本文件**'
- en: '***3* The script for reducing disk usage**'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 减少磁盘使用量的脚本**'
- en: If you navigate over to the /lib/recovery-mode/ directory, you’ll see that the
    recovery-menu file is the script that displays the menu interface you saw back
    in [figure 6.3](#ch06fig03). The options/ directory contains files for executing
    each of the menu items. For example, fsck will check and fix, if possible, any
    broken file systems.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你导航到 /lib/recovery-mode/ 目录，你会看到 recovery-menu 文件是显示你在图 6.3 中看到的菜单界面的脚本。options/
    目录包含执行每个菜单项的文件。例如，fsck 将检查并修复（如果可能的话）任何损坏的文件系统。
- en: 'Because you’re now an accomplished Bash scripting expert, why not take a look
    at each of the scripts in the options/ directory to see if you can figure out
    how they work? Here are the contents of the fsck script to get you going. Note
    the way the script is nicely documented (using the `#` character) to help you
    understand what’s going on:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 因为现在你是一位熟练的 Bash 脚本专家，为什么不查看 options/ 目录中的每个脚本，看看你是否能弄清楚它们是如何工作的？以下是为你提供的 fsck
    脚本内容。注意脚本是如何很好地使用 `#` 字符进行文档化，以帮助你理解正在发生的事情：
- en: '[PRE1]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '***1* The 110n.sh script is called to set the environment.**'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 调用 110n.sh 脚本以设置环境。**'
- en: '***2* This comment tells you where the real action takes place.**'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 这条注释告诉你在哪里发生真正的操作。**'
- en: Here are a couple of things you can try on your own. Manually run the clean
    script on a Ubuntu machine. What happened? Then try carefully editing the /lib/recovery-mode/recovery-menu
    script (make a backup copy first). Change something simple, like the menu title
    or one of the script descriptions. Then reboot your machine and, from the GRUB
    menu, go into Recovery Mode to see what the recovery environment looks like. With
    some variations and exceptions, you should be able to put those scripts to good
    use elsewhere, including on CentOS.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一些您可以自己尝试的事情。在Ubuntu机器上手动运行clean脚本。发生了什么？然后尝试仔细编辑/lib/recovery-mode/recovery-menu脚本（首先创建备份副本）。更改一些简单的内容，比如菜单标题或脚本描述之一。然后重启您的机器，从GRUB菜单进入恢复模式，看看恢复环境的样子。通过一些变化和例外，您应该能够在其他地方很好地使用这些脚本，包括在CentOS上。
- en: 6.2\. Building a live-boot recovery drive
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.2\. 构建实时启动恢复驱动器
- en: As you probably already know, those .ISO OS images you employed for your VirtualBox
    VMs back in [chapter 2](kindle_split_010.xhtml#ch02) can also be written to a
    CD or USB drive and used to boot a *live* session of the OS. Such live-boot devices
    let you load fully functioning Linux sessions without having to install anything
    to a hard drive. Many people use such drives to confirm that a particular Linux
    distribution will run happily on their hardware before trying to install it. Others
    will run live sessions as a secure way to maintain their privacy while engaged
    in sensitive activities like online banking.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 如您可能已经知道，您在[第2章](kindle_split_010.xhtml#ch02)中为您的VirtualBox虚拟机使用的那些.ISO操作系统镜像也可以写入CD或USB驱动器，并用于启动OS的*实时*会话。这种实时启动设备允许您加载完全功能的Linux会话，而无需将任何内容安装到硬盘上。许多人使用这样的驱动器来确认特定的Linux发行版是否能在他们的硬件上顺利运行，然后再尝试安装。其他人则会运行实时会话，作为一种在参与敏感活动（如在线银行）时维护隐私的安全方式。
- en: It turns out that those live boot drives are also a fantastic tool for system
    rescue and recovery. Remember our second disaster scenario from earlier in this
    chapter?
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 结果表明，这些实时启动驱动器也是系统救援和恢复的绝佳工具。还记得本章前面提到的第二个灾难场景吗？
- en: '*Your computer boots (as far as you can tell, anyway), but you’re not quite
    sure whether the hard drive is fully functional.*'
  id: totrans-57
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*您的计算机启动了（至少您是这样认为的），但您并不完全确定硬盘是否完全正常工作。*'
- en: Plugging a live-boot drive into a troubled computer and launching Linux with
    all of its administration tools can help you figure out what’s really going on—and
    give you the tools to fix it. I’m going to show you how to create a live-boot
    USB drive and then how to use it. But first, a quick look at some of the most
    useful distro images currently available.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 将实时启动驱动器插入故障计算机，并使用所有管理工具启动Linux，可以帮助您弄清楚真正发生的事情——并为您提供解决问题的工具。我将向您展示如何创建实时启动USB驱动器，然后如何使用它。但首先，让我们快速看一下目前可用的最有用的发行版镜像。
- en: 6.2.1\. System rescue images
  id: totrans-59
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 6.2.1\. 系统救援镜像
- en: If you happen to already have a DVD or USB drive with a full Linux system (like
    Ubuntu) lying around anyway, then that’ll be your simplest solution because most
    of the software you’ll need will come preinstalled. Assuming you’ve got a network
    connection, you can always install other packages during a live session. Otherwise,
    the following sections describe some specialty images.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您碰巧已经有一个包含完整Linux系统（如Ubuntu）的DVD或USB驱动器，那么这将是您最简单的解决方案，因为您需要的软件中的大部分都将预先安装。假设您有一个网络连接，您可以在实时会话期间安装其他包。否则，以下几节将描述一些特殊镜像。
- en: Boot-Repair
  id: totrans-61
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: Boot-Repair
- en: If it’s an Ubuntu system you’re trying to rescue, then you’ll want to try out
    Boot-Repair. A small and fast Boot-Repair live-boot checks your GRUB settings
    and, if necessary, rebuilds them. It can, as shown in [figure 6.6](#ch06fig06),
    also perform other useful administration tasks. This one has saved the day for
    me more times than I can remember.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您正在尝试救援的是Ubuntu系统，那么您将想要尝试Boot-Repair。一个小巧快速的Boot-Repair实时启动会检查您的GRUB设置，并在必要时重新构建它们。如图6.6所示，它还可以执行其他有用的管理任务。这个工具在我需要的时候救了我很多次。
- en: Figure 6.6\. The Boot-Repair desktop with the System Tools menu visible
  id: totrans-63
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.6\. Boot-Repair桌面，系统工具菜单可见
- en: '![](Images/06fig06_alt.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![图片6.6](Images/06fig06_alt.jpg)'
- en: Boot-Repair can also be installed on an already-launched live session. The website
    ([https://help.ubuntu.com/community/Boot-Repair](https://help.ubuntu.com/community/Boot-Repair))
    has great instructions.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: Boot-Repair也可以安装在已经启动的实时会话上。网站([https://help.ubuntu.com/community/Boot-Repair](https://help.ubuntu.com/community/Boot-Repair))提供了很好的说明。
- en: GParted Live
  id: totrans-66
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: GParted Live
- en: If your problem relates to corrupted partitions that can damage your data or
    prevent you from successfully booting, the GParted Live image brings the full-featured
    and powerful GParted partition editor to a live CD or USB. Like Boot-Repair, GParted
    can also be installed and used from any normal Linux session. If you know your
    problem is partition-related, however, the full live-boot version can be the quickest
    and most direct way to fix it. Unlike Boot-Repair, GParted is built to be used
    on about any Linux distribution, rather than just Ubuntu.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的问题与可能损坏你的数据或阻止你成功启动的损坏分区有关，GParted Live镜像将全功能的强大GParted分区编辑器带到实时CD或USB上。像Boot-Repair一样，GParted也可以从任何正常的Linux会话中安装和使用。如果你知道你的问题是与分区相关的，那么完整的实时启动版本可能是最快和最直接解决问题的方法。与Boot-Repair不同，GParted是为了在几乎所有Linux发行版上使用而构建的，而不仅仅是Ubuntu。
- en: SystemRescueCd
  id: totrans-68
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: SystemRescueCd
- en: Another alternative, SystemRescueCd, is a lightweight image built on the Gentoo
    Linux distribution. As it comes with loads of useful system recovery tools, SystemRescueCd
    makes a great USB to carry around with you. (The CD is also great, although it
    doesn’t fit so easily into back pockets, and sitting down safely can be a challenge.)
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个替代方案，SystemRescueCd，是基于Gentoo Linux发行版的轻量级镜像。由于它包含大量有用的系统恢复工具，SystemRescueCd成为随身携带的出色USB驱动器。（CD也很棒，尽管它不太容易放入后口袋，而且安全地坐着可能是一个挑战。）
- en: 6.2.2\. Writing live-boot images to USB drives
  id: totrans-70
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 6.2.2\. 将实时启动镜像写入USB驱动器
- en: Before you can write any .ISO image, you’ll need to download it. I think I’m
    safe assuming that you’re OK finding the right page on the website of the distro
    you’re after to get that done. But you might not know that large downloads can
    sometimes be corrupted during their journeys across the internet. Worse, they
    can be switched with malware by intrusion or man-in-the-middle attackers. That
    happened to some people downloading Mint Linux a while back.^([[1](#ch06fn01)])
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在你可以写入任何.ISO镜像之前，你需要下载它。我认为我可以安全地假设你能够找到你想要的发行版的网站上的正确页面来完成这项工作。但你可能不知道，大型下载有时在跨越互联网的过程中可能会损坏。更糟糕的是，它们可能会被入侵者或中间人攻击者用恶意软件替换。这发生在一些人在一段时间前下载Mint
    Linux时。[1](#ch06fn01)
- en: ¹
  id: totrans-72
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ¹
- en: ''
  id: totrans-73
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: See Kelly Fiveash, “Linux Mint Hit by Malware Infection on Its Website, Forum
    After Hack Attack,” *Ars Technica*, February 22, 2016, [http://mng.bz/irPi](http://mng.bz/irPi).
  id: totrans-74
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 参考凯利·菲瓦什的文章，“Linux Mint网站和论坛在遭受黑客攻击后感染恶意软件，” *Ars Technica*，2016年2月22日，[http://mng.bz/irPi](http://mng.bz/irPi)。
- en: Besides checking to make sure the website you’re on is properly encrypted (your
    browser should show some kind of lock icon in the URL bar), your best defense
    is to generate a hash on the downloaded file and compare it to the hash provided
    by the website. (Hashes were discussed back in [chapter 2](kindle_split_010.xhtml#ch02).)
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 除了检查你所在的网站是否已正确加密（你的浏览器应该在URL栏中显示某种锁形图标），你的最佳防御措施是生成下载文件的哈希值，并将其与网站提供的哈希值进行比较。（哈希值在[第2章](kindle_split_010.xhtml#ch02)中已有讨论。）
- en: The hashes will sometimes be displayed right on the image download page, but
    some distros make them a bit harder to find. Canonical (the fine people who give
    us Ubuntu) has not exactly bathed itself in glory on this one. There is a single
    page ([https://help.ubuntu.com/community/UbuntuHashes](https://help.ubuntu.com/community/UbuntuHashes))
    with links to all its hashes. Finding that page from the download site isn’t simple.
    You’re usually better off using a reliable internet search engine. [Figure 6.7](#ch06fig07)
    shows you what the hashes for Ubuntu 17.04 will look like.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 有时哈希值会直接显示在镜像下载页面上，但某些发行版使它们变得有点难以找到。Canonical（为我们提供Ubuntu的杰出人士）在这方面并没有完全赢得荣誉。有一个单独的页面([https://help.ubuntu.com/community/UbuntuHashes](https://help.ubuntu.com/community/UbuntuHashes))，其中包含所有哈希值的链接。从下载站点找到该页面并不简单。通常，使用可靠的互联网搜索引擎会更好。[图6.7](#ch06fig07)显示了Ubuntu
    17.04的哈希值将看起来是什么样子。
- en: Figure 6.7\. SHA256 hashes for the various images of Ubuntu 17.04, currently
    available for download
  id: totrans-77
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.7\. 可下载的Ubuntu 17.04各种镜像的SHA256哈希值
- en: '![](Images/06fig07_alt.jpg)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/06fig07_alt.jpg)'
- en: 'Once you find the published hashes for your image, you’ll compute the hash
    for the file you’ve downloaded and compare the two values. This example generates
    the SHA256 hash for the SystemRescueCd image from the same directory to which
    it was downloaded:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦找到你镜像的已发布哈希值，你将计算下载文件的哈希值，并将两个值进行比较。以下示例从下载到同一目录的SystemRescueCd镜像生成SHA256哈希值：
- en: '[PRE2]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: With a reliable image of one kind or another safely downloaded, it’s time to
    create that recovery tools live-boot drive. If both your current computer and
    the live-boot USB you’re creating will run Debian, Ubuntu, or a derivative, the
    simplest approach is to use the Ubuntu Startup Disk Creator.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在安全下载了某种可靠的镜像之后，是时候创建恢复工具的live-boot驱动器了。如果您当前计算机和您正在创建的live-boot USB都将运行Debian、Ubuntu或其衍生版本，最简单的方法是使用Ubuntu启动磁盘创建器。
- en: The Creator tool is available from the regular GUI menus and, as you can see
    from [figure 6.8](#ch06fig08), is straightforward. Select an .ISO from somewhere
    on your hard drive and a target USB (or CD) where you’d like the image written.
    The Creator will take care of the rest.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 创建者工具可以从常规GUI菜单中访问，正如您从[图6.8](#ch06fig08)中可以看到，它是直接的。从您的硬盘上的某个位置选择一个.ISO文件，以及您希望写入图像的目标USB（或CD）驱动器。创建者将处理其余部分。
- en: Figure 6.8\. Ubuntu’s Startup Disk Creator with an Ubuntu Server 16.04 image
    and target USB drive selected
  id: totrans-83
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.8\. Ubuntu启动磁盘创建器，已选择Ubuntu Server 16.04图像和目标USB驱动器
- en: '![](Images/06fig08_alt.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/06fig08_alt.jpg)'
- en: If, on the other hand, you need a live-boot device built from a different distro
    (you’re trying to rescue a CentOS machine and want to use CentOS tools to do it),
    then you’ll need to dust off your old friend `dd`. If you want a CD or DVD-based
    live bootable, `dd` running on any Linux host is up to the job. But if the image
    will be written to a USB drive and if you happen to be working on an Ubuntu host,
    you’ll first need to modify the image by adding an MBR to the .ISO archive so
    that BIOS and UEFI firmware will know what to do with it. [Figure 6.9](#ch06fig09)
    represents how the process looks.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，如果您需要从不同的发行版构建live-boot设备（您正在尝试恢复CentOS机器，并希望使用CentOS工具来完成它），那么您需要重新启用您的好友`dd`。如果您需要一个基于CD或DVD的live可引导设备，任何Linux主机上的`dd`都可以完成这项工作。但如果图像将被写入USB驱动器，并且您正在Ubuntu主机上工作，您首先需要通过向.ISO存档中添加MBR来修改图像，这样BIOS和UEFI固件就会知道如何处理它。[图6.9](#ch06fig09)展示了这个过程的外观。
- en: Figure 6.9\. The steps necessary for writing a working live-boot USB image
  id: totrans-86
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.9\. 编写可工作的live-boot USB镜像所需的步骤
- en: '![](Images/06fig09_alt.jpg)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/06fig09_alt.jpg)'
- en: 'On Ubuntu hosts, you use `isohybrid` for that image modification. The apt package
    containing `isohybrid` is called syslinux-utils. Once that’s installed, move to
    the directory containing the downloaded image and run `isohybrid` using the image
    filename as the sole argument:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在Ubuntu主机上，您使用`isohybrid`进行图像修改。包含`isohybrid`的apt包被称为syslinux-utils。一旦安装，转到包含下载的图像的目录，并使用图像文件名作为唯一参数运行`isohybrid`：
- en: '[PRE3]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The next steps should work no matter what distribution you’re on. Carefully
    identify the system designation for your target device. As you’ll remember, `df`
    lists all the currently recognized file systems along with their designations:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步应该适用于您使用的任何发行版。仔细识别目标设备的系统标识。如您所记得，`df`列出了所有当前识别的文件系统及其标识：
- en: '[PRE4]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '***1* This is my root file system. I definitely don’t want to overwrite that!**'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 这是我的根文件系统。我绝对不希望覆盖它！**'
- en: '***2* The file system on my removable USB drive**'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 我的可移动USB驱动器上的文件系统**'
- en: In this example, there’s a file system mounted on my Kingston USB device called
    /dev/sdb1\. This tells me that the device itself is known as /dev/sdb.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我的金士顿USB设备上挂载了一个名为/dev/sdb1的文件系统。这告诉我该设备本身被称为/dev/sdb。
- en: 'If you plan to write the image to an optical drive like a CD or DVD, then you
    get its designation through `lsblk`, which stands for *list block devices*. The
    drive itself must be writable. Here my DVD drive is known as sr0:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您计划将图像写入CD或DVD等光驱，那么您可以通过`lsblk`获取其标识，它代表*列出块设备*。驱动器本身必须是可写的。在这里，我的DVD驱动器被称为sr0：
- en: '[PRE5]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '***1* The writable DVD drive**'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 可写的DVD驱动器**'
- en: The moment of truth. No more putting it off. It’s time to unleash `dd` on your
    poor, defenseless file system and write your image to your USB.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 真正的时刻。不再推迟。是时候将`dd`释放到您可怜的、毫无防备的文件系统上，并将您的图像写入USB驱动器了。
- en: First unmount the drive itself so `dd` can get full access. Then write the archive.
    In this example, I used the systemrescuecd-x86-5.0.2.iso image and wrote it to
    the drive at /dev/sdb.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，卸载驱动器本身，以便`dd`可以完全访问。然后写入存档。在这个例子中，我使用了systemrescuecd-x86-5.0.2.iso图像，并将其写入到/dev/sdb的驱动器上。
- en: 'Careful! Typing `sda` instead of `sdb` (in this particular case) will irretrievably
    overwrite your host file system and ruin your day, not to mention your life. Naturally,
    you should also make sure there’s nothing important on the USB drive, as that
    will definitely disappear:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 小心！在特定情况下，将`sda`而不是`sdb`（在这种情况下）输入将不可恢复地覆盖您的宿主文件系统，并毁掉您的一天，更不用说您的生命了。当然，您还应该确保USB驱动器上没有重要内容，因为那肯定会消失：
- en: '[PRE6]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '***1* The added sync command ensures that all cached data is immediately written
    to the target disk.**'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 添加的同步命令确保所有缓存的数据立即写入目标磁盘。**'
- en: It might take some time for `dd` to finish writing the image to your USB device,
    but, when it’s done, you should be able to plug the drive into a computer, power
    it up, and enter a live session. This is assuming that your computer is configured
    to boot from a USB drive. If it isn’t, you can force it to boot to a selected
    device this one time by entering the Boot menu during the boot process. Each PC
    manufacturer designates its own keys for such things (often displaying a list
    of keystroke options during the startup process). But pressing one of F1, F9,
    or F12 early in the boot sequence will often work.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '`dd`将镜像写入USB设备可能需要一些时间，但完成时，您应该能够将驱动器插入计算机，打开电源，并进入live会话。这是假设您的计算机已配置为从USB驱动器启动。如果不是，您可以在启动过程中进入Boot菜单，强制将计算机引导到选定的设备这一次。每个PC制造商都为其指定了自己的键（通常在启动过程中显示按键选项列表）。但通常在启动序列的早期按下F1、F9或F12中的一个键会起作用。'
- en: 'You could also enter the setup utility (either BIOS or UEFI) to permanently
    set the order used to boot devices. Accessing the setup utility might also happen
    through a range of keys: I’ve seen F2, F10, Del, and Enter.'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 您也可以进入设置实用程序（无论是BIOS还是UEFI）以永久设置用于启动设备的顺序。访问设置实用程序也可能通过一系列键来完成：我见过F2、F10、Del和Enter。
- en: 6.3\. Putting your live-boot drive to work
  id: totrans-105
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.3. 使用您的live-boot驱动器
- en: You can do a lot of things with this Linux-in-a-pocket drive that you’ve created.
    The following sections describe a few common scenarios and the ways you might
    address them.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用您创建的口袋Linux驱动器做很多事情。以下几节描述了一些常见场景及其解决方法。
- en: 6.3.1\. Testing system memory
  id: totrans-107
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 6.3.1. 测试系统内存
- en: If you’ve experienced sudden and unexpected system crashes, a likely culprit
    is your physical memory (RAM). Like all hardware, RAM will eventually fail. The
    problem is that you can’t properly test your RAM for errors while it’s being used
    by a running OS. Instead, you’ve got to catch it before the OS loads. Fortunately,
    as the proud owner of a Linux live-boot drive, you’ve already got everything you’ll
    need for this job. As [figure 6.10](#ch06fig10) shows, one of the menu items that
    will be displayed after booting to an Ubuntu drive is Test Memory.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您经历过突然和意外的系统崩溃，一个可能的原因是您的物理内存（RAM）。像所有硬件一样，RAM最终会失效。问题是，当操作系统正在使用时，您无法正确测试RAM的错误。相反，您必须在操作系统加载之前捕捉到它。幸运的是，作为Linux
    live-boot驱动器的自豪拥有者，您已经拥有了完成这项工作所需的一切。如图6.10所示，在启动到Ubuntu驱动器后，将显示的一个菜单项是测试内存。
- en: Figure 6.10\. The main menu of an Ubuntu installation process showing Test Memory
  id: totrans-109
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.10. Ubuntu安装过程中的主菜单显示测试内存
- en: '![](Images/06fig10_alt.jpg)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/06fig10_alt.jpg)'
- en: Selecting Test Memory (using the up and down arrow keys and pressing Enter)
    takes you to the Memtest86+ program ([figure 6.11](#ch06fig11)). That program
    runs multiple scans of your RAM, displaying any errors it finds. Honestly, I’m
    not sure that the tool will ever stop on its own; I’ve certainly never reached
    that point. But if it returns no errors after running for at least a few full
    passes, you’re memory is probably not the cause of your trouble. Which can be
    either good news or bad news...after all, you still don’t know what’s causing
    your crashes.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 选择测试内存（使用上箭头和下箭头键并按Enter键）将您带到Memtest86+程序（如图6.11所示）。该程序对您的RAM进行多次扫描，显示它发现的任何错误。老实说，我不确定这个工具是否会自己停止；我肯定从未达到那个点。但如果它运行了至少几轮完整的扫描后没有返回错误，那么您的内存可能不是麻烦的原因。这可能是好消息也可能是坏消息……毕竟，您仍然不知道是什么导致了您的崩溃。
- en: '|  |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-113
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: Besides Test Memory, the Rescue a Broken System option in the main menu of an
    Ubuntu installation process will give you a working Bash shell.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 除了测试内存外，Ubuntu安装过程中的主菜单中的“修复损坏的系统”选项将为您提供工作的Bash shell。
- en: '|  |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Figure 6.11\. The Memtest86+ tool shows the location and kind of any errors
    in your RAM memory. This system is clean (so far).
  id: totrans-116
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.11. Memtest86+工具显示了RAM内存中任何错误的位置和类型。这个系统是干净的（到目前为止）。
- en: '![](Images/06fig11_alt.jpg)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/06fig11_alt.jpg)'
- en: CentOS installation disks include their own link to Memtest86+ in the Troubleshooting
    menu ([figure 6.12](#ch06fig12)).
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: CentOS安装盘在故障排除菜单中包含了对Memtest86+的链接（如图6.12所示）。
- en: Figure 6.12\. The Troubleshooting menu linked to from the main menu on a CentOS
    installation disk
  id: totrans-119
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.12。从CentOS安装盘主菜单链接的故障排除菜单
- en: '![](Images/06fig12_alt.jpg)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/06fig12_alt.jpg)'
- en: 6.3.2\. Damaged partitions
  id: totrans-121
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 6.3.2。损坏的分区
- en: A *partition* is really metadata pointing to the location on a physical disk
    occupied by a file system. They’re fragile things, those partitions, and it doesn’t
    seem to take much to upset them. If disk data is somehow corrupted and the exact
    addresses of a partition’s start and end points are changed or lost, then the
    file system on the partition will become unreachable. And if a file system is
    unreachable, then the data on the file system is as good as gone.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 一个*分区*实际上是指向物理磁盘上文件系统位置的元数据。这些分区很脆弱，它们似乎很容易被破坏。如果磁盘数据以某种方式损坏，并且分区的起始和结束地址被更改或丢失，那么分区上的文件系统将变得无法访问。如果一个文件系统无法访问，那么该文件系统上的数据就相当于丢失了。
- en: Can’t access your partition? It’s time to boot up your new SystemRescue drive.
    SystemRescue is a lightweight package, so don’t expect all the GUI miracles of
    a full-featured distro. Things like laptop touch pads and automatic WiFi connectivity
    might not work the way you expect. But it’s a quick way to get some powerful rescue
    tools into play. As you can see in [figure 6.13](#ch06fig13), the default boot
    option will open a special command-line shell.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 无法访问你的分区？是时候启动你的新SystemRescue驱动了。SystemRescue是一个轻量级的包，所以不要期待一个功能齐全的发行版的所有GUI奇迹。像笔记本电脑触摸板和自动WiFi连接这样的功能可能不会按你期望的方式工作。但这是快速获取一些强大救援工具的方法。如图6.13所示，默认的启动选项将打开一个特殊的命令行shell。
- en: Figure 6.13\. The Boot Options menu displayed during SystemRescue startup. Note
    the detailed explanations for each option at the bottom of the page.
  id: totrans-124
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.13。SystemRescue启动期间显示的启动选项菜单。注意页面底部的每个选项的详细说明。
- en: '![](Images/06fig13_alt.jpg)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/06fig13_alt.jpg)'
- en: 'As you gear up toward rescuing your stricken partition (or its data), SystemRescue
    provides some useful orientation information along with the command line, including
    networking and text-editing basics ([figure 6.14](#ch06fig14)). Worry not: both
    Vim and Nano are available from the command line. And typing `startx` will load
    a fast and light GUI desktop.'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 当你准备恢复你的受损分区（或其数据）时，SystemRescue提供了有关命令行（包括网络和文本编辑基础）的一些有用的方向信息（如图6.14所示）。不用担心：Vim和Nano都可以从命令行访问。输入`startx`将加载一个快速轻量的GUI桌面。
- en: Figure 6.14\. The SystemRescue shell. Note the text editors available by default
    (including Nano) and also that typing `startx` launches a graphical desktop.
  id: totrans-127
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.14。SystemRescue shell。注意默认可用的文本编辑器（包括Nano），以及输入`startx`将启动图形桌面。
- en: '![](Images/06fig14_alt.jpg)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/06fig14_alt.jpg)'
- en: If you’re going to need network access to download or install more tools, perhaps,
    or to transfer data, you’ll type `net-setup` at the command prompt, select the
    correct interface, and indicate whether your network is wired or wireless. If
    it’s wireless, you’ll enter your WiFi router’s SSID and its encryption key (which
    will probably use ASCII rather than hex characters). In most cases, you’ll want
    to let DHCP auto-detect your network.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要网络访问来下载或安装更多工具，或许，或者传输数据，你将在命令提示符下输入`net-setup`，选择正确的接口，并指明你的网络是有线还是无线。如果是无线，你需要输入你的WiFi路由器的SSID及其加密密钥（这可能会使用ASCII字符而不是十六进制字符）。在大多数情况下，你希望让DHCP自动检测你的网络。
- en: 'With a damaged partition to worry about, your primary concern right now will
    be recovery. If there’s any chance that the physical disk itself might be failing,
    then your first task must be to secure its data. For that, I’d use `dd` at the
    SystemRescue command prompt to create a perfect copy of the partition in its current
    state and save it to a healthy disk of equal or greater capacity. After running
    `lsblk` to confirm the designations of both partitions, the copy operation might
    look something like this, where the failing disk is /dev/sda and the empty partition
    on your target drive is /dev/sdc1:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 当你需要担心损坏的分区时，你现在的首要任务是恢复。如果物理磁盘本身可能正在损坏，那么你的首要任务必须是确保其数据的安全。为此，我会在SystemRescue命令提示符下使用`dd`创建分区当前状态的完美副本，并将其保存到容量相等或更大的健康磁盘上。在运行`lsblk`以确认两个分区的指定后，复制操作可能看起来像这样，其中损坏的磁盘是`/dev/sda`，而你目标驱动器上的空分区是`/dev/sdc1`。
- en: '[PRE7]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: With that done, you’re free to see whether you can save the original copy. Type
    `testdisk`. You’ll be asked how you’d like session events logged, which disk you
    want to recover, and which partition type to expect to find. More often than not,
    TestDisk will guess the right one and highlight it as the default.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这些后，你可以自由地看看是否可以保存原始副本。输入`testdisk`。你会被询问你希望如何记录会话事件，你想恢复哪个磁盘，以及你期望找到哪种分区类型。通常情况下，TestDisk会猜对正确的类型并将其突出显示为默认选项。
- en: You’ll then find yourself facing a screen that looks like the one in [figure
    6.15](#ch06fig15), where you can ask TestDisk to analyze your disk, looking for
    existing partitions. When you’ve discovered and appropriately marked your damaged
    partitions, you can write the changes to disk, and you should be able to successfully
    boot once again.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 你会发现你面对的屏幕看起来像[图6.15](#ch06fig15)，在那里你可以要求TestDisk分析你的磁盘，寻找现有的分区。当你已经发现并适当地标记了损坏的分区后，你可以将更改写入磁盘，你应该能够再次成功启动。
- en: Figure 6.15\. The TestDisk Partition Repair page, where partitions discovered
    through Analyze can then be edited and recovered using the other tools
  id: totrans-134
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图6.15\. TestDisk分区修复页面，在这里可以通过分析发现的分区然后使用其他工具进行编辑和恢复
- en: '![](Images/06fig15_alt.jpg)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/06fig15_alt.jpg)'
- en: Wait...that’s it? What about all the fine print? Does “discovered and appropriately
    marked your damaged partitions” cover the complex process in a way that’s at all
    useful? Nope. But, then, why are you reading this chapter? I’d say it’s either
    because you’re trying to prepare for some future catastrophe or because the future
    is now and you’re looking at your broken partition.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 等等...这就结束了？所有那些细节呢？“发现并适当地标记了损坏的分区”是否以某种有用的方式涵盖了复杂的过程？不，没有。但是，那么，你为什么还要读这一章呢？我会说，要么是因为你正在为未来的灾难做准备，要么是因为未来已经到来，你正在查看你损坏的分区。
- en: If it’s the future that worries you, then following along with me as I work
    through the narrowly focused details of one or two hypothetical solutions won’t
    help all that much. Besides, I’m not going to advise you to purposely corrupt
    a real partition so you can try out TestDisk for real. And if you’ve got your
    own real-world problem to deal with, then it’s highly unlikely that any example
    I happen to choose will be useful to you. Practically, the best I can do is let
    you know that such software exists and teach you how to get it running. Oh, and
    there’s some pretty good documentation available at [https://cgsecurity.org/testdisk.pdf](https://cgsecurity.org/testdisk.pdf).
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你对未来感到担忧，那么跟随我处理一个或两个假设解决方案的狭窄细节并不会帮到你太多。此外，我不会建议你故意损坏一个真实的分区以便你可以真正尝试TestDisk。如果你有自己的实际问题要处理，那么我随机选择的任何例子很可能对你都没有用。实际上，我能做的最好的事情就是让你知道这样的软件存在，并教你如何运行它。哦，还有，[https://cgsecurity.org/testdisk.pdf](https://cgsecurity.org/testdisk.pdf)上有一些相当不错的文档。
- en: 6.3.3\. Recovering files from a damaged file system
  id: totrans-138
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 6.3.3\. 从损坏的文件系统中恢复文件
- en: If it turns out that you can’t fully rescue your disk, perhaps you managed to
    revive your partitions just enough to allow access to the files but not enough
    to reliably boot from the disk. Then your new priority is to save as many important
    files as you can.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 如果最终发现你无法完全恢复你的磁盘，也许你只是设法复活了分区，足以允许访问文件，但不足以从磁盘可靠地启动。那么你的新优先级就是尽可能多地保存重要的文件。
- en: The simplest approach is to use the regular Linux file system management tools
    from any kind of live-boot session. If you’re not sure about the partition’s designation,
    running `lsblk` will, as always, get you up to speed.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 最简单的方法是使用任何类型的实时启动会话中的常规Linux文件系统管理工具。如果你不确定分区的指定，运行`lsblk`将像往常一样让你了解情况。
- en: 'It’s possible that your partition won’t yet be accessible as a file system
    because it hasn’t been mounted. If, in fact, it doesn’t show up among the results
    of a `df` command, then you’ll have to *mount* it, meaning assign it to a location
    within a file system where it can be accessed. You can fix that one quickly enough
    by creating a new directory where your partition will be mounted and then using
    the `mount` command. I chose to create my temporary mount point directory in /run/,
    but any unused location you happen to find (like /media/ or /mnt/) will do as
    well. Let’s assume, as before, that the partition is called /dev/sdc1:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 可能您的分区还无法作为文件系统访问，因为它尚未挂载。如果实际上它没有出现在 `df` 命令的结果中，那么您将不得不 *挂载* 它，这意味着将其分配到文件系统中的一个位置，以便可以访问。您可以通过创建一个新目录来快速解决这个问题，其中您的分区将被挂载，然后使用
    `mount` 命令。我选择在 /run/ 中创建我的临时挂载点目录，但任何您找到的未使用位置（如 /media/ 或 /mnt/）也可以。假设，像之前一样，分区是
    /dev/sdc1：
- en: '[PRE8]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: From here on in, any healthy files from the stricken file system will be available
    to copy or edit from within temp-directory. They’ll probably also automatically
    show up in any GUI desktop file management tool you might want to use.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 从现在开始，任何来自受损害文件系统的健康文件都可以在 temp-directory 内进行复制或编辑。它们也可能自动出现在您可能想要使用的任何 GUI
    桌面文件管理工具中。
- en: Recovery using ddrescue
  id: totrans-144
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 使用 ddrescue 进行恢复
- en: 'Didn’t work? Time to pull out the heavy guns. The data-recovery tool, ddrescue,
    copies files between file systems. But there’s something else it does at the same
    time that should put a smile on your face: it analyzes your files and attempts
    to repair any that are broken. No tool is guaranteed to fix everything that’s
    gone sour, but by reputation, ddrescue is as good as you’re going to get.'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 如果不起作用？是时候拿出重型武器了。数据恢复工具 ddrescue 在文件系统之间复制文件。但它在同时还做了一件能让您笑的事情：它分析您的文件并尝试修复任何损坏的文件。没有工具能保证修复所有变坏的东西，但据传闻，ddrescue
    是您能得到的最好的选择。
- en: 'If it’s not already installed on the live boot you’re using, ddrescue comes
    as part of SystemRescue by default. Grab it from your repository. Then identify
    the troubled partition (/dev/sdc1 in this example), the partition where you want
    the image saved, and the name and location of a log file where a record of operation
    events can be written. Having a log file allows ddrescue to continue a stopped
    operation rather than starting again from scratch. My example uses an external
    drive (of greater capacity than the source drive) mounted to a directory called
    /run/usb-mount:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用的实时启动中没有安装 ddrescue，那么它默认是 SystemRescue 的一部分。从您的仓库中获取它。然后确定有问题的分区（在这个例子中是
    /dev/sdc1），您想要保存镜像的分区以及记录操作事件的日志文件的名字和位置。拥有日志文件允许 ddrescue 继续停止的操作而不是从头开始。我的例子使用了一个外部驱动器（容量大于源驱动器）挂载到一个名为
    /run/usb-mount 的目录：
- en: '[PRE9]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '***1* Note: for CentOS, the command would be yum install ddrescue.**'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 注意：对于 CentOS，命令将是 yum install ddrescue。**'
- en: '***2* Tells ddrescue to ignore the kernel cache and access the disk directly**'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 告诉 ddrescue 忽略内核缓存并直接访问磁盘**'
- en: 'You can test the rescue by using `dd` to write the backup image to a new, empty
    drive (called /dev/sdd/ in my example) and then booting the system to the new
    drive:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过使用 `dd` 将备份镜像写入新的空驱动器（在我的例子中称为 /dev/sdd/）并从新驱动器启动系统来测试恢复：
- en: '[PRE10]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Even if you find that you still can’t boot the partition, it may now be possible
    to use it to reliably access important individual files. Either way, you’re ahead
    of where you would have been.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 即使您发现您仍然无法启动分区，现在可能可以使用它来可靠地访问重要的单个文件。无论如何，您都比之前的情况要好。
- en: File recovery using PhotoRec
  id: totrans-153
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 使用 PhotoRec 进行文件恢复
- en: Another tool that can help you grab files off a damaged drive is PhotoRec. One
    look at the interface tells you that it must have come from the same place as
    TestDisk. And, in fact, both were created and are maintained by Christophe Grenier
    of CGSecurity. To load the program, type
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个可以帮助您从损坏的驱动器中提取文件的工具是 PhotoRec。一眼看去，您就会知道它必须来自与 TestDisk 相同的地方。事实上，这两个工具都是由
    CGSecurity 的 Christophe Grenier 创建和维护的。要加载程序，请输入
- en: '[PRE11]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Once you identify the file system that needs rescuing, which file types you
    want to include, and the location to which you’d like the files saved, the files
    are saved to numbered directories using the `recup_dir.?` prefix:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您确定了需要恢复的文件系统、您想要包含的文件类型以及您想要保存文件的位置，文件将使用 `recup_dir.?` 前缀保存到编号目录中：
- en: '[PRE12]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Something to keep in mind about PhotoRec is that the files are all given new
    numbered filenames while retaining their original file extensions. This can sometimes
    make finding individual files difficult, but it sure beats losing them altogether.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 PhotoRec 有一点需要注意，文件都被赋予了新的编号文件名，同时保留了它们的原始文件扩展名。这有时会使得寻找单个文件变得困难，但总比完全丢失要好。
- en: '6.4\. Password recovery: Mounting a file system using chroot'
  id: totrans-159
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.4. 密码恢复：使用 chroot 挂载文件系统
- en: You know that the passwords chosen by the people you support are probably not
    strong enough to protect your infrastructure against a serious attack. And even
    the few exceptions to the rule are probably being reused on multiple servers and
    accounts. You beg and nag and beg and nag, but it seems like a losing battle.
    All is not entirely lost.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 你知道你支持的人选择的密码可能不足以保护你的基础设施免受严重攻击。即使是规则的少数例外，可能也在多个服务器和账户上重复使用。你恳求和唠叨，但似乎是一场输不起的战斗。但并非一切都已失去。
- en: The problem of keeping track of sufficiently complex passwords can be largely
    solved by using a good password vault like KeePass2 or LastPass. And the problem
    of overusing passwords can be at least blunted by implementing a single sign-on
    solution such as Kerberos. Still, uh-ohs are always going to happen.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用像 KeePass2 或 LastPass 这样的良好密码保险库，可以很大程度上解决跟踪足够复杂的密码的问题。而过度使用密码的问题至少可以通过实施像
    Kerberos 这样的单一登录解决方案来减轻。然而，不幸的事情总是会发生。
- en: 'What happens to the one or two users who care enough to dream up good, strong
    passwords for each server they access? Every now and then they forget a password.
    That won’t be a problem if there’s another admin with `sudo` power who can log
    in to the server and run `passwd` to create a new password for the user:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 对于那些足够关心并为每个访问的服务器想出好、强密码的用户来说，会发生什么？他们时不时地会忘记密码。如果有另一个拥有 `sudo` 权限的管理员可以登录到服务器并运行
    `passwd` 为用户创建一个新的密码，那么这不会是问题：
- en: '[PRE13]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: But if your unlucky and forgetful user was the only admin with an account on
    that machine, you’ve got trouble. Except that you don’t. The grandfather of all
    Linux virtualization, `chroot`, is going to save your day. Here’s one way that
    it might work.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 但如果你的不幸且健忘的用户是唯一一个在该机器上有账户的管理员，那你就有麻烦了。除了这个之外，你没有。Linux 虚拟化的鼻祖 `chroot` 将会拯救你的日子。这里有一种可能的工作方式。
- en: 'Use a live-boot drive to power up the server that’s got you locked out, run
    `lsblk` to determine the designation of your root partition on the server’s hard
    disk, and mount the root partition to a temporary directory:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 live-boot 驱动为被锁定的服务器供电，运行 `lsblk` 确定服务器硬盘上根分区的指定，并将根分区挂载到一个临时目录：
- en: '[PRE14]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Then whisper the magic words, and you’re in:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 然后低声说出魔法词语，你就进来了：
- en: '[PRE15]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: That’s all it takes. At this point, you’re free to run commands as though you
    were working on a running version of the physical hard drive. Use `passwd` to
    give your admin a new password to replace the lost one. And, after typing `exit`
    to shut down your `chroot` session, reboot the machine (without the live-boot
    USB). Everything should now be fine.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是全部。到了这一点，你可以像在运行物理硬盘的版本上工作一样运行命令。使用 `passwd` 为你的管理员提供一个新密码来替换丢失的密码。然后，在输入
    `exit` 关闭你的 `chroot` 会话后，重新启动机器（不要使用 live-boot USB）。现在一切应该都正常了。
- en: '|  |'
  id: totrans-170
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**To encrypt or not to encrypt?**'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: '**加密还是不加密？**'
- en: Encrypting the data on your storage drives using a tool like ecryptfs or dm-crypt
    makes it a great deal less likely that your data will be compromised. But on the
    other hand, many of the rescue and recovery operations discussed in this chapter
    won’t work on an encrypted volume.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 ecryptfs 或 dm-crypt 等工具加密存储驱动器上的数据，将大大降低你的数据被泄露的风险。但另一方面，本章中讨论的许多救援和恢复操作在加密卷上都不会工作。
- en: '|  |'
  id: totrans-173
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Striking a balance between security and accessibility isn’t an exact science.
    Many admins leave local servers and desktop workstations unencrypted because those
    are at least protected by locked office doors, but they insist that mobile devices
    be encrypted.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 在安全性和易用性之间取得平衡并不是一门精确的科学。许多管理员没有对本地服务器和桌面工作站进行加密，因为至少它们可以通过锁着的办公室门得到保护，但他们坚持要求移动设备必须加密。
- en: Summary
  id: totrans-175
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 摘要
- en: Linux recovery modes provide access to administration tools useful for repairing
    systems that won’t boot normally.
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Linux 恢复模式提供了访问用于修复无法正常启动的系统管理工具的权限。
- en: Live-boot drives allow you to boot your choice of Linux distros independently
    of the file systems on a computer’s physical drives.
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Live-boot 驱动允许您独立于计算机物理驱动器上的文件系统，独立启动您选择的 Linux 发行版。
- en: Purpose-build distros like SystemRescueCd are lightweight versions of Linux
    that come preinstalled with a full range of rescue tools.
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定制构建的发行版，如SystemRescueCd，是Linux的轻量级版本，预装了完整的救援工具。
- en: Damaged partitions can sometimes be restored using tools like TestDisk.
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有时可以使用TestDisk等工具恢复损坏的分区。
- en: Data from damaged partitions can sometimes be recovered using tools like ddrescue
    and PhotoRec.
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有时可以使用ddrescue和PhotoRec等工具从损坏的分区中恢复数据。
- en: File systems can be mounted and administered using a virtual process called
    `chroot`.
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以使用名为`chroot`的虚拟进程挂载和管理文件系统。
- en: Key terms
  id: totrans-182
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 关键术语
- en: '*GRUB* is a bootloader that manages the images to be used in the Linux boot
    process.'
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*GRUB* 是一个引导加载程序，它管理Linux引导过程中使用的镜像。'
- en: A *hash* (checksum) is a cryptographically generated value that can be checked
    against a master copy to confirm an image’s authenticity.
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 *哈希*（校验和）是一个通过密码学生成的值，可以与主副本进行比较以确认镜像的真实性。
- en: A partition’s *Master Boot Record* (MBR) for a CD/DVD will be different than
    for a USB, requiring special attention for creating live-boot USBs.
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CD/DVD的分区 *主引导记录*（MBR）将不同于USB，创建live-boot USB时需要特别注意。
- en: The tool `chroot` opens virtual root shells within mounted file systems.
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工具`chroot`在挂载的文件系统中打开虚拟根shell。
- en: Security best practices
  id: totrans-187
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安全最佳实践
- en: Always confirm that downloaded images are authentic by checking their hashes.
    And avoid downloading from unencrypted (HTTP rather than HTTPS) websites.
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 总是确认下载的镜像是否真实，通过检查它们的哈希值。并且避免从未加密的网站（HTTP而不是HTTPS）下载。
- en: Carefully consider whether or not to encrypt the data at rest on your system
    drives, balancing accessibility against security.
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 仔细考虑是否在系统驱动器上加密静态数据，在可访问性和安全性之间取得平衡。
- en: Enforce the use of password vaults and single sign-on services for users of
    your infrastructure.
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 强制使用密码保险库和单点登录服务来保护你的基础设施用户。
- en: Command-line review
  id: totrans-191
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 命令行审查
- en: '`sha256sum systemrescuecd-x86-5.0.2.iso` calculates the SHA256 checksum of
    a .ISO file.'
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sha256sum systemrescuecd-x86-5.0.2.iso` 计算一个.ISO文件的SHA256校验和。'
- en: '`isohybrid systemrescuecd-x86-5.0.2.iso` adds a USB-friendly MBR to a live-boot
    image.'
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`isohybrid systemrescuecd-x86-5.0.2.iso` 向live-boot镜像添加一个USB友好的MBR。'
- en: '`dd bs=4M if=systemrescuecd-x86-5.0.2.iso of=/dev/sdb && sync` writes a live-boot
    image to an empty drive.'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dd bs=4M if=systemrescuecd-x86-5.0.2.iso of=/dev/sdb && sync` 将live-boot镜像写入一个空驱动器。'
- en: '`mount /dev/sdc1 /run/temp-directory` mounts a partition to a directory on
    the live file system.'
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mount /dev/sdc1 /run/temp-directory` 将分区挂载到live文件系统上的一个目录。'
- en: '`ddrescue -d /dev/sdc1 /run/usb-mount/sdc1-backup.img /run/usb-mount/ sdc1-backup.logfile`
    saves files on a damaged partition to an image named sdc1-backup.img and writes
    events to a log file.'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ddrescue -d /dev/sdc1 /run/usb-mount/sdc1-backup.img /run/usb-mount/ sdc1-backup.logfile`
    将损坏分区上的文件保存到名为sdc1-backup.img的镜像，并将事件写入日志文件。'
- en: '`chroot /run/mountdir/` opens a root shell on a file system.'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`chroot /run/mountdir/` 在文件系统上打开一个根shell。'
- en: Test yourself
  id: totrans-198
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 测试自己
- en: '**[1](#ch06qa2q0a1)**'
  id: totrans-199
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[1](#ch06qa2q0a1)**'
- en: ''
  id: totrans-200
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following will allow you to access a damaged Linux machine’s own
    recovery mode?
  id: totrans-201
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个选项可以让你访问损坏的Linux机器的自己的恢复模式？
- en: ''
  id: totrans-202
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: SystemRecovery
  id: totrans-203
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: SystemRecovery
- en: GRUB
  id: totrans-204
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: GRUB
- en: Hitting CRTL+Right Shift during boot
  id: totrans-205
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动时按CRTL+右Shift
- en: chkdsk
  id: totrans-206
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: chkdsk
- en: '**[2](#ch06qa2q0a2)**'
  id: totrans-207
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[2](#ch06qa2q0a2)**'
- en: ''
  id: totrans-208
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which user account is used by default for a Linux recovery mode shell session?
  id: totrans-209
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 默认情况下，Linux恢复模式shell会话使用哪个用户账户？
- en: ''
  id: totrans-210
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: root
  id: totrans-211
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: root
- en: The initial account created during installation
  id: totrans-212
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装过程中创建的初始账户
- en: admin
  id: totrans-213
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: admin
- en: guest
  id: totrans-214
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: guest
- en: '**[3](#ch06qa2q0a3)**'
  id: totrans-215
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[3](#ch06qa2q0a3)**'
- en: ''
  id: totrans-216
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: What is the goal of the Clean option in the Ubuntu Recovery Mode menu?
  id: totrans-217
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: Ubuntu恢复模式菜单中的“清洁”选项的目标是什么？
- en: ''
  id: totrans-218
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Find and remove viruses
  id: totrans-219
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查找并删除病毒
- en: Remove unused program files
  id: totrans-220
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 删除未使用的程序文件
- en: Remove unused user accounts
  id: totrans-221
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 删除未使用的用户账户
- en: Clean up a session and shut down
  id: totrans-222
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 清理会话并关闭
- en: '**[4](#ch06qa2q0a4)**'
  id: totrans-223
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[4](#ch06qa2q0a4)**'
- en: ''
  id: totrans-224
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Booting a Linux live-boot device will do which of the following?
  id: totrans-225
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 引导Linux live-boot设备将执行以下哪项操作？
- en: ''
  id: totrans-226
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Launch a system recovery environment
  id: totrans-227
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动系统恢复环境
- en: Launch a file recovery environment
  id: totrans-228
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动文件恢复环境
- en: Launch a Linux session using host machine partitions
  id: totrans-229
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用宿主机的分区启动Linux会话
- en: Launch a Linux session using only live-boot partitions
  id: totrans-230
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 仅使用live-boot分区启动Linux会话
- en: '**[5](#ch06qa2q0a5)**'
  id: totrans-231
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[5](#ch06qa2q0a5)**'
- en: ''
  id: totrans-232
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: What tool do you need in order to create a live-boot image that can be used
    to boot from a USB device?
  id: totrans-233
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 你需要什么工具来创建一个可以从USB设备引导的live-boot镜像？
- en: ''
  id: totrans-234
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ddrescue
  id: totrans-235
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: ddrescue
- en: GRUB
  id: totrans-236
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: GRUB
- en: isohybrid
  id: totrans-237
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: isohybrid
- en: ecryptfs
  id: totrans-238
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: ecryptfs
- en: '**[6](#ch06qa2q0a6)**'
  id: totrans-239
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[6](#ch06qa2q0a6)**'
- en: ''
  id: totrans-240
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The sha256sum program is used for what purpose?
  id: totrans-241
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: sha256sum程序用于什么目的？
- en: ''
  id: totrans-242
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Opening a virtual shell session on a mounted file system
  id: totrans-243
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在挂载的文件系统上打开虚拟shell会话
- en: Managing Linux images at system startup
  id: totrans-244
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 管理系统启动时的Linux镜像
- en: Generating hashes to authenticate file integrity
  id: totrans-245
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成散列以验证文件完整性
- en: Managing file recovery from damaged drives
  id: totrans-246
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 管理从损坏的驱动器中恢复文件
- en: '**[7](#ch06qa2q0a7)**'
  id: totrans-247
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[7](#ch06qa2q0a7)**'
- en: ''
  id: totrans-248
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following will write a SystemRescue image to the second block device
    on your system?
  id: totrans-249
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个选项会将SystemRescue镜像写入系统上的第二个块设备？
- en: ''
  id: totrans-250
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`dd if=systemrescuecd-x86-5.0.2.iso of=/dev/sdb`'
  id: totrans-251
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`dd if=systemrescuecd-x86-5.0.2.iso of=/dev/sdb`'
- en: '`dd if=/dev/sdb of=systemrescuecd-x86-5.0.2.iso`'
  id: totrans-252
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`dd if=/dev/sdb of=systemrescuecd-x86-5.0.2.iso`'
- en: '`dd if=/dev/sdc of=systemrescuecd-x86-5.0.2.iso`'
  id: totrans-253
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`dd if=/dev/sdc of=systemrescuecd-x86-5.0.2.iso`'
- en: '`dd if=systemrescuecd-x86-5.0.2.iso of=/dev/sdb2`'
  id: totrans-254
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`dd if=systemrescuecd-x86-5.0.2.iso of=/dev/sdb2`'
- en: '**[8](#ch06qa2q0a8)**'
  id: totrans-255
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[8](#ch06qa2q0a8)**'
- en: ''
  id: totrans-256
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: What does the `chroot` command do?
  id: totrans-257
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`chroot`命令的作用是什么？'
- en: ''
  id: totrans-258
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Creates a live-boot image that can be used to boot from a USB device
  id: totrans-259
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个可用于从USB设备启动的实时引导镜像
- en: Opens a virtual shell session on a mounted file system
  id: totrans-260
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在挂载的文件系统上打开虚拟shell会话
- en: Generates hashes to authenticate file integrity
  id: totrans-261
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成散列以验证文件完整性
- en: Removes unused program files
  id: totrans-262
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 删除未使用的程序文件
- en: Answer key
  id: totrans-263
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 答案键
- en: '**[1.](#ch06qa1q1)**'
  id: totrans-264
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[1.](#ch06qa1q1)**'
- en: ''
  id: totrans-265
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: b
  id: totrans-266
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: b
- en: '**[2.](#ch06qa1q2)**'
  id: totrans-267
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[2.](#ch06qa1q2)**'
- en: ''
  id: totrans-268
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: a
  id: totrans-269
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: a
- en: '**[3.](#ch06qa1q3)**'
  id: totrans-270
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[3.](#ch06qa1q3)**'
- en: ''
  id: totrans-271
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: b
  id: totrans-272
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: b
- en: '**[4.](#ch06qa1q4)**'
  id: totrans-273
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[4.](#ch06qa1q4)**'
- en: ''
  id: totrans-274
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: d
  id: totrans-275
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: d
- en: '**[5.](#ch06qa1q5)**'
  id: totrans-276
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[5.](#ch06qa1q5)**'
- en: ''
  id: totrans-277
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: c
  id: totrans-278
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: c
- en: '**[6.](#ch06qa1q6)**'
  id: totrans-279
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[6.](#ch06qa1q6)**'
- en: ''
  id: totrans-280
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: c
  id: totrans-281
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: c
- en: '**[7.](#ch06qa1q7)**'
  id: totrans-282
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[7.](#ch06qa1q7)**'
- en: ''
  id: totrans-283
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: a
  id: totrans-284
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: a
- en: '**[8.](#ch06qa1q8)**'
  id: totrans-285
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[8.](#ch06qa1q8)**'
- en: ''
  id: totrans-286
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: b
  id: totrans-287
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: b
