- en: Chapter 13\. Troubleshooting system performance issues
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第13章：系统性能问题故障排除
- en: '*This chapter covers*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*本章涵盖*'
- en: Understanding and measuring your system behavior
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解和衡量你的系统行为
- en: Controlling application and client demands on system resources
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 控制应用和客户端对系统资源的需求
- en: Multilevel strategies for addressing resource shortages
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应对资源短缺的多层次策略
- en: Strategies for effective ongoing monitoring protocols
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有效的持续监控协议策略
- en: Do “cascading chaos” and “impending doom” describe your IT operations right
    now? Are your servers slow and unresponsive? Do your customers complain about
    poor application performance? Or have you stopped bragging about the unbelievable
    experience you get from your new-ish workstation?
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: “级联混沌”和“即将到来的灾难”是否正是你现在IT运营的写照？你的服务器是否运行缓慢且无响应？你的客户是否抱怨应用性能不佳？或者，你是否已经停止吹嘘你那新购置的工作站带来的不可思议体验？
- en: 'Even if it’s not as bad as all that, life won’t always progress smoothly. The
    fact that, by definition, we’re always trying to squeeze the greatest possible
    value from our IT investments means that sometimes we’ll push a bit too far: stressed
    systems will sometimes break, and complicated software stack elements will sometimes
    stop working together.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 即使情况没有这么糟糕，生活也不会总是顺利。我们总是试图从IT投资中获得最大价值，这是定义上的，这意味着有时我们会做得太过分：压力过大的系统有时会崩溃，复杂的软件堆栈元素有时会停止协同工作。
- en: The secret to a long and happy life is to anticipate trouble, quickly identify
    the symptoms and causes, and apply the right fixes at the right time. And this
    should help in your work as an IT admin as well.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 长寿和幸福生活的秘诀是预见麻烦，快速识别症状和原因，并在正确的时间采取正确的修复措施。这对于你作为IT管理员的工作同样适用。
- en: 'What do I mean by *system*? It’s the hardware and software environment you’re
    using to deliver your service, whether it’s an application, database, web server,
    or the reliable use of a simple standalone workstation. In this chapter, you’ll
    focus on the health and well being of the four core elements of your system: the
    central processing unit (CPU), memory (RAM, both physical and virtual), storage
    devices, and network load management. You’ll learn about spotting trouble, pinpointing
    the cause, and then either fixing the underlying problem or, if necessary, throwing
    more hardware at it.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我所说的“系统”是指你用来提供服务的硬件和软件环境，无论是应用、数据库、Web服务器，还是简单独立工作站的可靠使用。在本章中，你将关注系统四个核心元素的健康和福祉：中央处理器（CPU）、内存（RAM，包括物理和虚拟）、存储设备和网络负载管理。你将学习如何发现问题、确定原因，然后修复根本问题，或者在必要时投入更多硬件。
- en: Of course, you would always prefer to avoid problems altogether. One way to
    do that is to subject your healthy system to stress testing to see how it stands
    up. A bit later in the chapter I’ll also include a quick look at `yes`, a great
    tool for subjecting your infrastructure to cruel and unusual torture.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，你总是希望避免问题。一种方法是让你的健康系统接受压力测试，看看它如何应对。在本章稍后，我还会简要介绍`yes`，这是一个将你的基础设施暴露于残酷和非常规折磨的出色工具。
- en: 'In any case, I’m going to assume that one of the servers or workstations for
    which you’re responsible has been misbehaving: crashing or slowing down at the
    worst possible moments. You glare at it with your meanest, nastiest expression
    for a minute or two, but the machine doesn’t seem impressed, nor does it respond.
    Let’s work through this one step at a time.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在任何情况下，我将假设你负责的其中一台服务器或工作站出现了异常行为：在最糟糕的时刻崩溃或变慢。你用你最凶狠、最恶毒的表情瞪视它一两分钟，但机器似乎并不在意，也没有响应。让我们一步一步解决这个问题。
- en: 13.1\. CPU load problems
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.1. CPU负载问题
- en: 'The CPU is your computer’s brain. The electronic circuits that make up a CPU,
    no matter how many cores there might be and how wide the bus they’re using, are
    only expected to do one thing: wait for instructions passed in by software programs,
    perform calculations, and spit back answers.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: CPU是电脑的大脑。构成CPU的电子电路，无论有多少核心和它们使用的总线有多宽，都只预期做一件事：等待软件程序传入的指令，执行计算，并返回答案。
- en: By and large, either your CPU will work or it won’t. Most CPU-related performance
    issues (like sluggish response times or unexpected shutdowns) can be traced to
    pushing them beyond their physical capacity. One of the first things you’ll need
    to do when wondering whether a particular performance issue may be connected to
    the CPU is find out if you’re being too rough on the poor dear.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 总体来说，你的CPU要么工作，要么不工作。大多数与CPU相关的性能问题（如响应时间缓慢或意外关机）都可以追溯到超出它们的物理容量。当你怀疑某个性能问题可能与CPU有关时，你需要做的第一件事就是找出你是否对它太过苛刻。
- en: 13.1.1\. Measuring CPU load
  id: totrans-15
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.1.1. 测量CPU负载
- en: 'Two indicators of CPU state include CPU load and CPU utilization:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: CPU状态的两个指标包括CPU负载和CPU利用率：
- en: '*CPU load* is a measure of the amount of work (meaning the number of currently
    active and queued processes) being performed by the CPU as a percentage of total
    capacity. Load averages that represent system activity over time, because they
    present a much more accurate picture of the state of your system, are a better
    way to represent this metric.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*CPU负载*是衡量CPU作为总容量百分比所执行的工作量（意味着当前活跃和排队进程的数量）的度量。表示随时间推移的系统活动的负载平均数，因为它们提供了一个更准确的系统状态图景，是表示此指标更好的方式。'
- en: '*CPU utilization* (or usage) is a measure of the time a CPU is not idle (described
    as a proportion of the total CPU capacity).'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*CPU利用率*（或使用率）是衡量CPU不空闲时间的度量（描述为总CPU容量的比例）。'
- en: A load score of 1 on a single-core machine would represent full capacity. If
    your system has multiple CPU cores, say four, then full capacity would be represented
    by the number 4\. User experience will probably start to suffer (at least from
    time to time) once the CPU utilization score rises above 75%, which would be 0.75
    for a single core, and 3.0 on a quad-core system.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在单核机器上，负载得分为1表示满负荷。如果你的系统有多个CPU核心，比如四个，那么满负荷将表示为数字4。一旦CPU利用率得分超过75%，用户体验可能会开始受到影响（至少有时如此），对于单核来说，这将表示为0.75，而对于四核系统来说，将表示为3.0。
- en: 'Getting your CPU load average is easy. Running `uptime` returns the current
    time, the elapsed time since the more recent system boot, the number of users
    currently logged in, and, most importantly for us right now, load averages for
    the last minute, 5 minutes, and 15 minutes:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 获取你的CPU负载平均数很容易。运行`uptime`会返回当前时间、自最近一次系统启动以来经过的时间、当前登录的用户数，以及对我们来说现在最重要的是，过去一分钟、五分钟和十五分钟的负载平均数：
- en: '[PRE0]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: A load average of 1.27 on a system with one CPU would mean that, on average,
    the CPU is working to capacity and another 27% of processes are waiting for the
    their turn with the CPU. By contrast, a load average of 0.27 on a system with
    one CPU would mean that, on average, the CPU was unused for 73% of the time. On
    a four-core system, you might see load averages in the range of 2.1, which would
    be just over 50% of capacity (or unused for around 52% of the time).
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个拥有一个CPU的系统上，平均负载为1.27意味着CPU平均处于满负荷工作状态，另外27%的进程正在等待轮到它们使用CPU。相比之下，在一个拥有一个CPU的系统上，平均负载为0.27意味着CPU平均有73%的时间未被使用。在一个四核系统上，你可能会看到负载平均在2.1左右，这将是50%以上的容量（或大约52%的时间未被使用）。
- en: 'To properly understand those numbers, you’ll have to know how many cores your
    system is running. In case that information isn’t printed on a chassis sticker
    and you’re not interested in opening up the case and looking for yourself, you
    can query the pseudo file cpuinfo:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 要正确理解这些数字，你需要知道你的系统有多少核心。如果这些信息没有打印在机箱标签上，而你又不感兴趣打开机箱亲自查看，你可以查询伪文件cpuinfo：
- en: '[PRE1]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Looks like there are four cores in that system. Because you’re there anyway,
    take a look through the rest of that file to get a feel for the way Linux describes
    your CPU. In particular, try to make sense of the flags section, which lists the
    features supported by your hardware.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来那个系统有四个核心。因为你在那里，不妨浏览一下那个文件的其余部分，以了解Linux是如何描述你的CPU的。特别是，尝试理解标志部分，它列出了你的硬件支持的功能。
- en: 13.1.2\. Managing CPU load
  id: totrans-26
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.1.2. 管理CPU负载
- en: Consistently under capacity (based on the results you get from `uptime`)? You
    could just enjoy the extra head space. Or you might consider consolidating resources
    by using the underused computer to deliver additional services (rather than purchasing
    additional servers) to maximize your return on investment.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 持续低于满负荷（基于你从`uptime`得到的结果）？你可以只是享受额外的空间。或者，你可能会考虑通过使用未充分利用的计算机提供额外服务（而不是购买额外的服务器）来整合资源，以最大化投资回报率。
- en: Consistently over capacity? You’ll either need to switch to a more robust hardware
    architecture with more CPU cores or, in a virtual environment, provision for more
    VMs or containers to pick up the extra work. Once in a while, you could also take
    a closer look at the processes running on your system to see if there isn’t something
    that could be shut down or even something that’s been running rogue without your
    knowledge. Running `top` provides a rich, self-updating display of process information.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 持续超负荷？你可能需要切换到具有更多CPU核心的更健壮的硬件架构，或者在虚拟环境中，为更多的VM或容器提供额外的负载。偶尔，你也可以仔细查看系统上运行的进程，看看是否有可以关闭的，甚至是否有未经你知晓而运行异常的进程。运行`top`提供了丰富、自动更新的进程信息显示。
- en: '[Figure 13.1](#ch13fig01) is a typical screenfull of data from `top`. Notice
    how the first line provides the same insights you would get from running `uptime`.
    Because you’re trying to resolve performance problems, the columns of data that
    should interest you the most are %CPU (percentage of CPU capacity currently used
    by a given process) and especially the processes showing up at the top of the
    list.'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '[图13.1](#ch13fig01) 是`top`的典型全屏数据。注意第一行提供了与运行`uptime`相同的见解。因为你试图解决性能问题，你应该最感兴趣的列是%CPU（当前由给定进程使用的CPU容量百分比）以及特别是出现在列表顶部的进程。'
- en: Figure 13.1\. A snapshot of process data displayed by `top`
  id: totrans-30
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图13.1\. `top`显示的进程数据快照
- en: '![](Images/13fig01_alt.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/13fig01_alt.jpg)'
- en: In this case, you can see that the MySQL daemon is using 4.3% of the server’s
    CPU and, from the next column, 13% of its memory. If you follow that row over
    to the left, you’ll see that the process ID is 1367 and the process is owned by
    the mysql user. You might conclude that this process was taking more resources
    than can be justified and will have to be sacrificed (for the greater good, you
    understand). You can exit `top` by pressing the q key.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，你可以看到MySQL守护进程正在使用服务器CPU的4.3%，从下一列来看，占其内存的13%。如果你将那一行向左移动，你会看到进程ID是1367，进程属于mysql用户。你可能会得出结论，这个进程占用的资源比可以证明的要多，将不得不牺牲（为了更大的利益，你知道的）。你可以通过按q键退出`top`。
- en: 'That `top` display gave you everything you’ll need to kill the process. Because
    MySQL is a service managed by systemd, your first choice should be to use `systemctl`
    to bring the process down gently, without putting any application data at risk:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 那个`top`显示给了你结束进程所需的一切。因为MySQL是由systemd管理的服务，你的首选应该是使用`systemctl`来温和地结束进程，以免任何应用程序数据处于风险之中：
- en: '[PRE2]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'If it’s not managed by systemd, or if something’s gone wrong and `systemctl`
    failed to stop it, then you can use either `kill` or `killall` to eliminate your
    process (some systems require you install `killall` as part of the psmisc package).
    You pass the PID to `kill` this way:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 如果它不是由systemd管理的，或者如果出了问题，`systemctl`未能停止它，那么你可以使用`kill`或`killall`来消除你的进程（某些系统要求你作为psmisc包的一部分安装`killall`）。你可以这样将PID传递给`kill`：
- en: '[PRE3]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'On the other hand, `killall` uses the process name rather than its ID:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，`killall`使用进程名而不是其ID：
- en: '[PRE4]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: To `kill` or to `killall`, that is the question. Actually, the answer is kind
    of obvious. `kill` will shut down a single process, based as it is on the PID,
    whereas `killall` will kill as many instances of a particular program as happen
    to be running. If there were two or three separate MySQL instances, perhaps belonging
    to separate users, all would be stopped.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 要`kill`还是要`killall`，这是一个问题。实际上，答案相当明显。`kill`将基于PID关闭单个进程，而`killall`将杀死尽可能多的特定程序实例。如果有两个或三个独立的MySQL实例，可能属于不同的用户，所有这些都将被停止。
- en: '|  |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-41
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: Before launching `killall`, make sure there aren’t any similarly named processes
    running that could become collateral damage.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在启动`killall`之前，确保没有运行着类似名称的进程，否则可能会成为附带损害。
- en: '|  |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'You’ll also have to use systemctl once again to make sure that the process
    doesn’t restart the next time you boot:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 你还必须再次使用systemctl来确保进程在下次启动时不会重新启动：
- en: '[PRE5]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Setting priorities with nice
  id: totrans-46
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 使用“良好”来设置优先级
- en: Sometimes you won’t be able to kill a process because it’s a necessary part
    of a mission-critical service. But you can limit the CPU resources it gets using
    `nice`. By default, a new process is given a `nice` value of `0`, but you can
    change that to any number between -20 and 19\. The higher the number, the nicer
    the process will be when it comes to giving up resources in favor of other processes.
    And, by contrast, the lower the number, the less nice the process will be as it
    grabs as many resources as it can get, regardless of the pain and suffering that
    might cause others.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 有时候您可能无法终止一个进程，因为它是一个关键任务服务的必要部分。但您可以使用 `nice` 来限制它获得的 CPU 资源。默认情况下，新进程被赋予 `nice`
    值为 `0`，但您可以将其更改为介于 -20 和 19 之间的任何数字。数字越高，进程在放弃资源以供其他进程使用时越“友好”。相反，数字越低，进程在尽可能多地获取资源时越“不友好”，无论这可能会给其他人带来多少痛苦和困扰。
- en: Let’s say that you want to run a script called mybackup.sh that sets a large
    remote backup operation in motion. The problem is that this is an active server
    that, from time to time, needs a lot of power to respond to important client requests.
    If a request comes in while the backup is running at full speed, the performance
    won’t be acceptable. On the other hand, if the backup is throttled back from start
    to finish, it might never finish.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 假设您想运行一个名为 mybackup.sh 的脚本，该脚本启动一个远程备份操作。问题是这是一个活跃的服务器，它不时需要大量电力来响应重要的客户端请求。如果在备份全速运行时收到请求，性能将无法接受。另一方面，如果从开始到结束备份都进行节流，它可能永远无法完成。
- en: 'Here’s how `nice` can help you deal with this in a way that leaves everyone
    relaxed and smiling. Prepend the script (or any other command name) with `nice`
    and the numeric value you’ve chosen for it. In this case, the dash (`-`) followed
    by `15` tells Linux that the script will run with a very nice attitude. This means
    that when there’s a conflict over resource access, your script will back off,
    but otherwise it’ll take whatever’s available:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是 `nice` 如何帮助您以让每个人都轻松微笑的方式处理这种情况。在脚本（或任何其他命令名称）前加上 `nice` 和您为其选择的数值。在这种情况下，跟在破折号（`-`）后面的
    `15` 告诉 Linux 该脚本将以非常友好的态度运行。这意味着当资源访问发生冲突时，您的脚本会退让，但除此之外，它会接受可用的任何资源：
- en: '[PRE6]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'If running your script is an urgent priority that has to complete as soon as
    possible, you could add a second dash to give the process a negative value (`-15`),
    as in this example:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 如果运行您的脚本是一个紧急优先事项，必须尽快完成，您可以在第二个破折号中添加一个负值（`-15`），如下例所示：
- en: '[PRE7]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Either way, if you want to see this in action, create a script and, while it’s
    executing, have a second terminal running `top`. You should see your process running,
    and its appropriate `nice` value should appear in the NI column.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 无论哪种方式，如果您想看到这种情况，创建一个脚本，并在它执行时，在第二个终端中运行 `top`。您应该看到您的进程正在运行，并且其适当的 `nice`
    值应出现在 NI 列中。
- en: For many Linux programs, you can also set default `nice` values. rsync, on Ubuntu
    at least, allows you to explicitly define how nice it will be through the RSYNC_NICE
    setting in /etc/default/rsync.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 对于许多 Linux 程序，您也可以设置默认的 `nice` 值。至少在 Ubuntu 上，rsync 允许您通过 /etc/default/rsync
    中的 RSYNC_NICE 设置显式定义其友好程度。
- en: Listing 13.1\. A possible `nice` setting from the /etc/default/rsync configuration
    file
  id: totrans-55
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 13.1\. 来自 /etc/default/rsync 配置文件的可能的 `nice` 设置
- en: '[PRE8]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'You can also use `renice` to change the way a process behaves even after it’s
    started. This example will, when necessary, limit the resources available to the
    process currently assigned PID 2145:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用 `renice` 来更改进程的行为，即使它在启动后也是如此。此示例将在必要时限制分配给 PID 2145 的进程可用的资源：
- en: '[PRE9]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Tips for top
  id: totrans-59
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: '`top` 的技巧'
- en: In case you ever need them, the third line of the `top` output you saw a bit
    earlier gives you time values (as percentages) for a number of other CPU metrics.
    [Table 13.1](#ch13table01) offers a quick rundown of the jumble of acronyms you’ll
    see there.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要，您之前看到的 `top` 输出的第三行会为您提供许多其他 CPU 指标的时间值（作为百分比）。[表 13.1](#ch13table01)
    提供了您在那里看到的混乱缩写的快速概述。
- en: Table 13.1\. Symbols for CPU-related metrics displayed by `top`
  id: totrans-61
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表 13.1\. `top` 显示的与 CPU 相关的指标符号
- en: '| Metric | Meaning |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| 指标 | 含义 |'
- en: '| --- | --- |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| us | Time running high-priority (un-niced) processes |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| us | 运行高优先级（非友好）进程花费的时间 |'
- en: '| sy | Time running kernel processes |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| sy | 运行内核进程花费的时间 |'
- en: '| ni | Time running low-priority (nice) processes |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| ni | 运行低优先级（友好）进程花费的时间 |'
- en: '| id | Time spent idling |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| id | 空闲时间 |'
- en: '| wa | Time waiting for I/O events to complete |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| wa | 等待 I/O 事件完成花费的时间 |'
- en: '| hi | Time spent managing hardware interrupts |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| hi | 管理硬件中断花费的时间 |'
- en: '| si | Time spent managing software interrupts |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| si | 软件中断管理所花费的时间 |'
- en: '| st | Time stolen from this VM by its hypervisor (host) |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
  zh: '| st | 虚拟机（主机）从该VM中窃取的时间 |'
- en: Note that the `top` display can be customized in real time through keyboard
    input. Type `h` to learn more.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，`top`显示可以通过键盘输入实时自定义。输入`h`以获取更多信息。
- en: 13.1.3\. Making trouble (simulating CPU load)
  id: totrans-73
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.1.3\. 制造麻烦（模拟CPU负载）
- en: Need to try some of these tricks out but, wouldn’t you know it, everything is
    running smoothly? Why not simulate crisis-level CPU overload for yourself?
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 想要尝试这些技巧，但你知道吗，一切似乎都在正常运行？为什么不自己模拟危机级别的CPU过载呢？
- en: 'Much like children, `yes` will output (digital) noise continuously until told
    to stop. On second thought, that’s not at all like kids. This command will redirect
    that noise to the disposable /dev/null file and the ampersand (`&`) character
    will push the process into the background, giving control of the command line
    back to you. To ramp up the pressure, launch the command a few more times:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 与孩子一样，`yes`会持续输出（数字）噪音，直到被告知停止。再想想，这根本不像孩子。这个命令会将噪音重定向到可丢弃的`/dev/null`文件，并且`&`字符会将进程推入后台，将命令行的控制权交还给你。为了增加压力，可以多次启动该命令：
- en: '[PRE10]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'That should keep them busy. While all that’s running, watch `top` to see what’s
    happening. You could also try to run other applications to see how much it will
    take to slow them down. When you’re done, run `killall` to knock off all your
    `yes` sessions in one go:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 这样应该能让它们忙起来。当所有这些都在运行时，观察`top`以了解发生了什么。你也可以尝试运行其他应用程序，看看需要多少才能使它们变慢。完成后，运行`killall`一次性结束所有的`yes`会话：
- en: '[PRE11]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 13.2\. Memory problems
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.2\. 内存问题
- en: For all the great advances in information technology over the years, random
    access memory (RAM) itself is still used the same way it always was. Computers
    speed up core compute operations by loading OS kernels and other software code
    into volatile RAM modules. This permits quick system access to frequently requested
    software instructions.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管信息技术在过去的几十年中取得了巨大的进步，但随机存取存储器（RAM）本身的使用方式仍然和以前一样。计算机通过将操作系统内核和其他软件代码加载到易失性RAM模块中来加速核心计算操作。这允许快速访问频繁请求的软件指令。
- en: The biggest challenge with memory is usually its limits. My first computer had
    640 KB of RAM (that’s less than 1 MB) and it wasn’t enough. I’d leave my computer
    on overnight just to render a single 640 × 480 GIF image. The workstation sitting
    under my desk right now has 8 GB and, once I add three VirtualBox VMs to my regular
    workload it, too, starts to feel the pain.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 内存的最大挑战通常是它的限制。我的第一台电脑有640 KB的RAM（那不到1 MB），这还不够。我不得不让电脑整夜运行，只是为了渲染一个640 × 480的GIF图像。现在放在我桌子下的工作站有8
    GB，一旦我向我的常规工作量添加三个VirtualBox虚拟机，它也开始感到压力。
- en: 13.2.1\. Assessing memory status
  id: totrans-82
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.2.1\. 评估内存状态
- en: Generally, a memory-starved system will fail to complete requested tasks or
    just slow down. Of course, these problems can describe all kinds of things, so
    you’ll want confirmation before jumping to conclusions. Short of focusing an electron
    microscope on the memory modules plugged into your motherboard, running `free`
    is the most direct way to do that.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，内存不足的系统将无法完成请求的任务或只是变慢。当然，这些问题可以描述各种各样的事情，所以在得出结论之前，你需要得到确认。除了将电子显微镜聚焦在你主板上的内存模块上，运行`free`是最直接的方法。
- en: '`free` parses the /proc/meminfo file and displays the total physical memory
    available (described as 7.1 GB in this example) and the way it’s currently being
    used. `shared` is memory that’s used by tmpfs to maintain the various pseudo file
    systems we’ve come to know and love, like /dev/ and /sys/. Buffers and cache are
    associated with memory used by the kernel for block level I/O operations (don’t
    worry too much if you don’t understand what that’s all about).'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '`free`解析`/proc/meminfo`文件并显示可用的总物理内存（在本例中描述为7.1 GB）以及它的当前使用方式。`shared`是tmpfs使用的内存，用于维护我们熟悉和喜爱的各种伪文件系统，如`/dev/`和`/sys/`。缓冲区和缓存与内核用于块级I/O操作的内存相关联（如果你不理解这一切，不必过于担心）。'
- en: 'Any memory in use by any system process is designated as `used`. The `available`
    value is an estimate of the memory that’s currently available for launching new
    applications, even if it’s currently being used by disk caching, without having
    to dip into swap memory (which you’ll meet in much a moment or two). Here’s an
    example:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 任何由系统进程使用的内存都被标记为`used`。`available`值是对当前可用于启动新应用程序的内存的估计，即使它目前正被磁盘缓存使用，也不需要涉及到交换内存（你将在稍后遇到它）。以下是一个例子：
- en: '[PRE12]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: You’ll notice that I added the `-h` argument to `free`, which displays the output
    in human-readable format, using easier-to-read larger numeric units (GB, MB, and
    KB) rather than bytes.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 您会注意到我为`free`添加了`-h`参数，它以人类可读的格式显示输出，使用更易于阅读的较大数值单位（GB、MB和KB）而不是字节。
- en: This example looks like a healthy system with plenty of room for growth. But
    if the value of `free` is consistently a lot closer to 0 and transferring load
    to swap memory doesn’t alleviate the problem, then you may need to add memory.
    Now, about that swap...
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 这个例子看起来像是一个健康系统，有足够的空间进行扩展。但如果`free`的值持续接近0，并且将负载转移到交换内存不能缓解问题，那么您可能需要增加内存。现在，关于那个交换空间...
- en: 13.2.2\. Assessing swap status
  id: totrans-89
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.2.2\. 评估交换状态
- en: Because, byte for byte, RAM modules tend to be more expensive than disk storage,
    many OS installations designate a file or partition on the storage drive for use
    as an emergency source of virtual RAM. That way even if, strictly speaking, you
    don’t have quite enough RAM for all of the processes that’ll be running, an overloaded
    system won’t fail, although it will run noticeably slower.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 因为，从字节到字节，RAM模块通常比磁盘存储更昂贵，许多操作系统安装将存储驱动器上的一个文件或分区指定为用作虚拟RAM的紧急来源。这样，即使严格来说，您可能没有足够的RAM来运行所有进程，过载的系统也不会失败，尽管它会明显变慢。
- en: 'You can get a glimpse of the way swap is being used on your system from `vmstat`.
    The `30` and `4` arguments added to the command here tell the program to return
    four readings with 30-second intervals between each reading. In a real-world case,
    you’d probably want to extend the testing over a longer period, perhaps a couple
    of hours, to increase the accuracy of your results. The two columns you should
    watch most closely are `si`, which measures data transfers from swap into system
    memory, and `so`, which reports transfers out of system memory into swap. As promised,
    here’s the command:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过`vmstat`命令了解系统上交换空间的使用情况。在此命令中添加的`30`和`4`参数告诉程序返回四个读数，每个读数之间间隔30秒。在实际情况下，您可能希望将测试扩展到更长时间，例如几个小时，以提高结果的准确性。您应该密切关注的两列是`si`，它衡量从交换空间到系统内存的数据传输，以及`so`，它报告从系统内存到交换空间的传输。正如承诺的那样，以下是该命令：
- en: '[PRE13]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: If you’re getting consistent movement into and out of swap, you should consider
    adding physical RAM, unless the slower performance isn’t a problem for your workload.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您发现交换空间中的数据流动持续不断，您应该考虑增加物理RAM，除非较慢的性能对您的负载不是问题。
- en: 13.3\. Storage availability problems
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.3\. 存储可用性问题
- en: If your application software stack regularly writes new documents, data, or
    log files to storage drives, then you can’t ignore the fact that there are always
    limits to the space you’ve got available. Something that can’t go on forever will
    eventually stop. And those data writes will stop when there’s no free space left
    on your drive, taking your system functionality with it.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的应用程序软件堆栈经常将新的文档、数据或日志文件写入存储驱动器，那么您不能忽视这样一个事实：您可用的空间总是有限的。有些事情不可能永远持续下去，最终会停止。当您的驱动器上没有剩余空间时，这些数据写入将停止，您的系统功能也将随之停止。
- en: 'How can you tell how close you are? Easy. You’ve already met `df`. Because
    devices don’t use any actual disk space, you can ignore those listed in the `Use%`
    column as using 0% of their maximum space. You already know that they’re pseudo
    file systems. But you should focus on the others, and particularly the root partition
    (`/`). In this case, root still has 686 GB (nearly 80%) free, so there’s no need
    to worry right now. But this is obviously something you’ll want to check regularly:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 您如何知道您有多接近极限？很简单。您已经遇到了`df`。因为设备不使用任何实际的磁盘空间，您可以忽略`Use%`列中列出的使用0%最大空间的条目。您已经知道它们是伪文件系统。但您应该关注其他条目，尤其是根分区（`/`）。在这种情况下，根仍有686
    GB（近80%）的空闲空间，所以目前没有必要担心。但显然这是您需要定期检查的事情：
- en: '[PRE14]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '***1* The root partition entry**'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 根分区条目**'
- en: '***2* A pseudo file system; note the 0 bytes used.**'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 一个伪文件系统；注意使用了0字节。**'
- en: That’s the easy way to track your usage. The hard way happens when you find
    you’re unable to save a file to disk, or you log in to the system and get a message
    that your session is read-only.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 这是跟踪使用情况的一种简单方法。困难的方式发生在您发现无法将文件保存到磁盘上，或者您登录到系统并收到一条消息，表明您的会话是只读的。
- en: '|  |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**Full or failure?**'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '**满载或失败？**'
- en: To be sure, not every read-only failure is a result of a full storage drive.
    It could also mean that the physical device is failing. In that case, you’ll want
    to immediately get to work saving any important data on to peripheral drives or
    online storage accounts before the drive goes down completely. How can you tell
    the difference? `df`, if your system is healthy enough to run it, should help,
    but if in doubt, safe beats sorry every time.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，并非所有的只读失败都是由于存储驱动器已满。这也可能意味着物理设备正在故障。在这种情况下，你将需要立即开始将任何重要数据保存到外围驱动器或在线存储账户中，以免驱动器完全故障。你如何判断区别？如果你的系统足够健康可以运行`df`，那么它应该会帮助，但如果不确定，安全总是比后悔好。
- en: '|  |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 13.3.1\. Inode limits
  id: totrans-105
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.3.1\. Inode限制
- en: Physical space isn’t the only constraint on Linux data storage. You’ll remember
    our discussion back in [chapter 12](kindle_split_020.xhtml#ch12) where we noted
    that all Linux file system objects are identified and managed through metadata
    contained in unique inodes. It turns out that there’s a hard limit to the number
    of inodes you’re permitted on a system, and it’s possible to run out of inodes
    even though there’s still plenty of physical space available.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 物理空间并不是Linux数据存储的唯一限制。你还记得我们在[第12章](kindle_split_020.xhtml#ch12)中的讨论，我们提到所有Linux文件系统对象都是通过包含在唯一inode中的元数据来识别和管理的。结果证明，系统上允许的inode数量有一个硬限制，即使还有足够的物理空间，也可能耗尽inode。
- en: '|  |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-108
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: The number of available inodes is permanently set when the file system is created.
    Considering that inodes themselves take up space, when creating a file system
    (using a tool like mkfs.ext4, for instance), the goal is to find a balance that
    allows for the most potential files while wasting the least disk space.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 当文件系统创建时，可用的inode数量是永久设置的。考虑到inode本身会占用空间，在创建文件系统（例如使用mkfs.ext4这样的工具）时，目标是找到一个平衡点，既能允许最多的潜在文件，又能浪费最少的磁盘空间。
- en: '|  |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'Here’s what it looks like when I run `df` on the same system as before, but
    this time with the `-i` argument to display inode data:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是我在之前相同的系统上运行 `df` 命令时的样子，但这次使用了 `-i` 参数来显示inode数据：
- en: '[PRE15]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '***1* This is the root partition, the one whose inode status is most important.**'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 这是根分区，其inode状态最为重要。**'
- en: With so many free inodes, there’s no immediate cause for alarm on this system,
    but you would definitely want to take action if you saw yourself getting within
    10% or 20% of your ceiling. One of my servers was once hit with maxed-out inodes,
    and it took a few minutes before I even understood what had happened. Let me tell
    you all about it.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这个系统上有许多空闲inode，但并没有立即的警报原因，但如果你发现自己接近了10%或20%的容量上限，你肯定会想采取行动。我的一个服务器曾经遇到过inode用尽的情况，我花了几分钟才明白发生了什么。让我告诉你所有关于这件事的细节。
- en: 'The first indication of trouble was when I tried to install some new software
    using `apt`. The installation failed, displaying an error message that included
    the words *No Space Left on Device*. Now that was plain crazy talk, as I knew
    there were still gigabytes free. It took some web searching to prompt me to check
    my inode levels: sure enough, I was fresh out on that particular partition.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 当我尝试使用`apt`安装一些新软件时，麻烦的第一迹象出现了。安装失败，显示的错误信息中包含了“设备空间不足”的字样。这显然是胡说八道，因为我知道还有几GB的空闲空间。经过一些网络搜索，我意识到需要检查inode级别：果然，我恰好在那个特定的分区上耗尽了inode。
- en: 'Logically, the next step is to search for directories containing the largest
    numbers of files. After all, concentrations of inodes will probably be found hanging
    out in the places frequented by lots of files. Here’s how to tune `find` to give
    you that information:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 从逻辑上讲，下一步是搜索包含最多文件的目录。毕竟，inode的集中可能会出现在文件频繁访问的地方。以下是如何调整`find`以获取这些信息的方法：
- en: '[PRE16]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '[Table 13.2](#ch13table02) explains what it all means.'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '[表13.2](#ch13table02)解释了这一切的含义。'
- en: Table 13.2\. `find` command syntax
  id: totrans-119
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 表13.2\. `find`命令语法
- en: '| Syntax | Function |'
  id: totrans-120
  prefs: []
  type: TYPE_TB
  zh: '| 语法 | 功能 |'
- en: '| --- | --- |'
  id: totrans-121
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| . | Start searching within and below the current directory. |'
  id: totrans-122
  prefs: []
  type: TYPE_TB
  zh: '| . | 在当前目录及其以下开始搜索。 |'
- en: '| -xdev | Remain within a single file system. |'
  id: totrans-123
  prefs: []
  type: TYPE_TB
  zh: '| -xdev | 保持在一个文件系统内。 |'
- en: '| -type f | Search for objects of type file. |'
  id: totrans-124
  prefs: []
  type: TYPE_TB
  zh: '| -type f | 搜索文件类型的对象。 |'
- en: '| cut -d "/" | Remove text identified by the delimiter (/ character, in this
    case). |'
  id: totrans-125
  prefs: []
  type: TYPE_TB
  zh: '| cut -d "/" | 删除由分隔符（/字符，在这种情况下）标识的文本。 |'
- en: '| -f 2 | Select the second field found. |'
  id: totrans-126
  prefs: []
  type: TYPE_TB
  zh: '| -f 2 | 选择找到的第二个字段。 |'
- en: '| sort | Sort lines of output, and send to standard out (stout). |'
  id: totrans-127
  prefs: []
  type: TYPE_TB
  zh: '| sort | 对输出行进行排序，并发送到标准输出（stout）。 |'
- en: '| uniq -c | Count the number of lines sent by sort. |'
  id: totrans-128
  prefs: []
  type: TYPE_TB
  zh: '| uniq -c | 计算sort发送的行数。 |'
- en: '| sort -n | Display the output in numeric order. |'
  id: totrans-129
  prefs: []
  type: TYPE_TB
  zh: '| sort -n | 以数字顺序显示输出。 |'
- en: 'That’s a great command. The trouble was that it failed because `find` temporarily
    saves raw data to disk. But because I was out of inodes, saving anything was currently
    impossible. Terrific. Now what? Free up a little space by finding a couple of
    unnecessary files and deleting them. With that done, here’s what `find` showed
    me:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个很棒的命令。问题是它失败了，因为`find`临时将原始数据保存到磁盘上。但是因为我inode用完了，所以目前保存任何东西都是不可能的。太棒了。现在怎么办？通过找到一些不必要的文件并将它们删除来腾出一些空间。完成这些后，这是`find`显示给我的：
- en: '[PRE17]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '***1* The /usr/ directory obviously wins the award for “most files in a single
    directory tree.”**'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* /usr/目录显然是“单个目录树中文件最多”的奖项获得者。**'
- en: '|  |'
  id: totrans-133
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Warning
  id: totrans-134
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 警告
- en: Because it might have to search through thousands of files and directories,
    `find` can take some time to run.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 因为它可能需要搜索成千上万的文件和目录，`find`可能需要一些时间来运行。
- en: '|  |'
  id: totrans-136
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: 'By far the largest number of files were somewhere beneath the /usr/ directory.
    But where? No problem, move down a level and run `find` once again:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 最大的文件数量都在/usr/目录的某个地方。但具体在哪里？没问题，降级一层并再次运行`find`：
- en: '[PRE18]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '***1* The directory containing the most files**'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 包含最多文件的目录**'
- en: This time, /usr/src/ is the obvious culprit. Just what goes on in /usr/src/?
    It turns out that that’s where the kernel headers are kept, including those left
    over from previous kernel versions installed on your machine. If you drill down
    through the directory tree, you’ll see that there are, indeed, a whole lot of
    files.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 这次，/usr/src/显然是罪魁祸首。/usr/src/里到底发生了什么？结果是那里保存了内核头文件，包括之前安装在你机器上的旧内核版本留下的那些。如果你深入目录树，你会发现确实有很多文件。
- en: 13.3.2\. The solution
  id: totrans-141
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.3.2. 解决方案
- en: 'To free up space, you may need to manually remove some of the older directories.
    Then, assuming you’re using Ubuntu, let `dpkg` safely remove whatever else isn’t
    needed through `--configure`:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 为了腾出空间，你可能需要手动删除一些旧的目录。然后，假设你使用的是Ubuntu，让`dpkg`通过`--configure`安全地移除不需要的其他内容：
- en: '[PRE19]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'To safely remove all the old kernel headers themselves, run `autoremove`, and
    everything should go back to optimal working order:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 要安全地移除所有旧的内核头文件，运行`autoremove`，一切应该都会恢复到最佳工作状态：
- en: '[PRE20]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'On CentOS, install the yum-utils package and then run `package-cleanup`. Adding
    `--count=2` will remove all but the most recent two kernels:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在CentOS上，安装yum-utils包，然后运行`package-cleanup`。添加`--count=2`将删除除了最新的两个内核之外的所有内核：
- en: '[PRE21]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '|  |'
  id: totrans-148
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Tip
  id: totrans-149
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 小贴士
- en: It’s always a good idea to keep at least one older kernel to fall back on in
    case something breaks with the latest one.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 总是保留至少一个较旧的内核以备不时之需是个好主意，以防最新的内核出现问题。
- en: '|  |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: What can be done to address storage limitations? The most obvious thing is to
    add more storage. But you can also periodically audit your system to see what
    can be deleted or transferred to alternate and often cheaper storage solutions.
    Amazon’s Glacier is a great place to keep large data stores that aren’t accessed
    frequently.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决存储限制，我们可以做些什么？最明显的事情是添加更多的存储。但你也可以定期审计你的系统，看看什么可以被删除或转移到替代的、通常更便宜的存储解决方案。亚马逊的Glacier是一个存放不常访问的大型数据存储的绝佳地点。
- en: You should also work to reduce the sheer volume of data you produce. As you
    saw in [chapter 11](kindle_split_019.xhtml#ch11), one way to do that is to make
    sure your logs are regularly rotated and retired.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 你还应该努力减少你产生的数据量。正如你在[第11章](kindle_split_019.xhtml#ch11)中看到的，做到这一点的一种方法就是确保你的日志定期轮换和退役。
- en: 13.4\. Network load problems
  id: totrans-154
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.4. 网络负载问题
- en: When the words *network* and *problem* come together in a single sentence, most
    people probably think first of failed connections. But that’s what we’re going
    to talk about in the next chapter. Here, however, is where we discuss how to handle
    an active and healthy connection that’s overloaded.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 当单词“网络”和“问题”在同一个句子中出现时，大多数人可能首先想到的是失败的连接。但这就是我们将在下一章讨论的内容。然而，在这里我们将讨论如何处理一个活跃且健康的过载连接。
- en: When should you suspect the load’s beyond your capacity? On a regular desktop
    workstation, you’ll probably see downloads that take longer than they should or
    fail altogether; on a public-facing server, your clients may complain of slow
    service. Such symptoms could be the result of more than one cause, so you’ll want
    to do some further investigations and then try out possible solutions. That’s
    what you’ll learn next.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该在什么时候怀疑负载超出了您的处理能力？在常规桌面工作站上，您可能会看到下载时间比预期长或完全失败；在面向公众的服务器上，您的客户可能会抱怨服务缓慢。这些症状可能是多个原因的结果，因此您将需要进行一些进一步的调查，然后尝试可能的解决方案。这就是您接下来将要学习的。
- en: 13.4.1\. Measuring bandwidth
  id: totrans-157
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.4.1\. 测量带宽
- en: Literally dozens of Linux tools exist for providing insight into network usage.
    The two that I’m going to show you are particularly useful for quickly identifying
    the resources using most of the bandwidth that, in turn, will allow you to intelligently
    address the underlying issues.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上存在数十种 Linux 工具可以提供对网络使用的洞察。我将向您展示的两个工具特别有用，可以快速识别使用最多带宽的资源，从而让您能够智能地解决根本问题。
- en: 'Like top, iftop (acquired by installing the iftop package through the usual
    channels) displays a self-updating record of the greediest network activity traveling
    through the network interface: specify `iftop -i eth0`.'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 与 top 类似，iftop（通过通过安装 iftop 软件包通过常规渠道获得）显示通过网络接口传输的最贪婪的网络活动的自更新记录：指定 `iftop
    -i eth0`。
- en: As you can see from [figure 13.2](#ch13fig02), iftop lists the network connections
    between my computer (workstation) and remote hosts, along with the bandwidth consumed
    in bytes or kilobytes. The connections are listed in inbound/outbound pairs. Obviously,
    high-consuming connections will have to be examined and, if necessary, removed.
    The bottom rows of the display track cumulative and peak usage (both inbound and
    outbound), along with average usage rates.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从 [图 13.2](#ch13fig02) 中所见，iftop 列出了我的计算机（工作站）和远程主机之间的网络连接，以及以字节或千字节为单位的带宽消耗。连接按入站/出站对列出。显然，高消耗的连接需要检查，并在必要时删除。显示的底部行跟踪累积和峰值使用（入站和出站），以及平均使用率。
- en: Figure 13.2\. A typical iftop display of network connections and their bandwidth
    usage
  id: totrans-161
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 13.2\. 网络连接及其带宽使用的典型 iftop 显示
- en: '![](Images/13fig02_alt.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/13fig02_alt.jpg)'
- en: You should carefully scan and analyze the remote hosts iftop identifies. Regular
    monitoring could uncover unexpected drains on your network resources and even
    previously unidentified malware that iftop catches “calling home.” Calls to Amazon
    or Google might not be noteworthy, but strange and obscure URLs should inspire
    a second look.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该仔细扫描和分析 iftop 识别的远程主机。定期监控可能会揭示您网络资源上的意外消耗，甚至 iftop 捕获的以前未识别的恶意软件“回家”的调用。对亚马逊或谷歌的调用可能并不引人注目，但奇怪和隐秘的
    URL 应该激发您再次审视。
- en: 'iftop is great for narrowing down network usage from a remote host perspective
    (something that will be useful for troubleshooting web browser traffic, for instance).
    But sometimes you’ll need to manage local processes through their PIDs; iftop
    won’t help with that. NetHogs (installed through the nethogs repository package),
    on the other hand, will. Launch NetHogs from the command line by specifying a
    network interface. Note that this time you don’t include a `-i` flag:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: iftop 对于从远程主机角度缩小网络使用范围非常有用（例如，对于故障排除网络浏览器流量很有用）。但有时您需要通过它们的 PID 管理本地进程；iftop
    对此无能为力。另一方面，NetHogs（通过 nethogs 存储库软件包安装），将会有所帮助。通过指定网络接口从命令行启动 NetHogs。请注意，这次您不需要包含
    `-i` 标志：
- en: '[PRE22]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '[Figure 13.3](#ch13fig03) shows a typical NetHogs display on my workstation,
    including PIDs for both my Linux Slack client (hey, I also need to keep up with
    my colleagues) and the Chrome browser. If something was misbehaving, I could track
    it down and control it through its PID.'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 13.3](#ch13fig03) 展示了我工作站的典型 NetHogs 显示，包括我的 Linux Slack 客户端（嘿，我还需要跟上我的同事）和
    Chrome 浏览器的 PID。如果有什么行为不当，我可以通过其 PID 跟踪并控制它。'
- en: Figure 13.3\. A relatively quiet day on my workstation, as seen through NetHogs
  id: totrans-167
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 13.3\. 通过 NetHogs 看到的我的工作站上相对安静的一天
- en: '![](Images/13fig03_alt.jpg)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/13fig03_alt.jpg)'
- en: 13.4.2\. Solutions
  id: totrans-169
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.4.2\. 解决方案
- en: 'Once you’ve narrowed down a system process that’s causing you trouble, you’ll
    have to figure out how to deal with it. If it’s not essential or if it’s a rogue,
    malware process, you could shut it down permanently the way you saw earlier using
    `systemctl`, `kill`, or `killall`. But, more often than not, that won’t be possible:
    most of the processes running on your servers are probably there for a reason.'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你缩小了导致你麻烦的系统进程，你就必须找出如何处理它。如果不是必需的，或者它是一个恶意软件进程，你可以像之前使用 `systemctl`、`kill`
    或 `killall` 那样永久关闭它。但，更常见的情况是，这不可能：你服务器上运行的大多数进程可能都有一定的原因。
- en: You could also consider upgrading your network connection. This might involve
    calling your ISP to discuss increasing the level of service provided. For local
    on-site networks, you might also think about improving your networking hardware.
    If your cabling capacity is currently capped at 100 MB/s (CAT 5), you could upgrade
    to 1000 MB/s (CAT 6). Remember that it’s not enough to change the cables. All
    your routers, switches, and the interfaces attached to your devices must also
    have that capacity for the benefits to be fully felt. Beyond ethernet cabling,
    moving to fiber optics can deliver even higher performance but for a much higher
    price.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以考虑升级你的网络连接。这可能涉及联系你的 ISP 讨论提高提供的服务级别。对于本地现场网络，你也可能考虑改善你的网络硬件。如果你的布线容量目前限制在
    100 MB/s（CAT 5），你可以升级到 1000 MB/s（CAT 6）。记住，仅仅更换电缆是不够的。你所有的路由器、交换机以及连接到你的设备的接口也必须具备这种容量，才能充分感受到好处。除了以太网布线外，转向光纤可以提供更高的性能，但价格要高得多。
- en: 13.4.3\. Shaping network traffic with tc
  id: totrans-172
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.4.3\. 使用 tc 整形网络流量
- en: A more subtle and sophisticated solution to load problems is *traffic shaping*.
    Rather than completely shutting down particular services, you can, as an example,
    place a ceiling on how much bandwidth processes are given. In a way, you want
    to manage bandwidth the same way that you earlier saw `nice` managing processes.
    This could make it possible for limited resources to be evenly, or strategically,
    shared across your system.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 对于负载问题，有一种更微妙和复杂的解决方案，即 *流量整形*。而不是完全关闭特定的服务，例如，你可以限制进程所获得的带宽上限。从某种意义上说，你希望以与之前看到
    `nice` 管理进程相同的方式管理带宽。这可以使有限的资源在你的系统中均匀或战略性地共享。
- en: For instance, you could limit the bandwidth allowed to web clients to guarantee
    that other processes (like DNS updates or backups) won’t be starved of bandwidth.
    As a quick and dirty illustration, I’ll show you how to impose a basic throttle
    on an internet-facing network interface using the Traffic Control (`tc`) tool.
    `tc` is normally installed on Linux by default.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，你可以限制允许网络客户端的带宽，以确保其他进程（如 DNS 更新或备份）不会因带宽不足而受影响。作为一个快速而简单的说明，我将向你展示如何使用流量控制
    (`tc`) 工具对面向互联网的网络接口施加基本节流。`tc` 通常在 Linux 上默认安装。
- en: 'First, ping a remote site and note the response times you get. This example
    averaged around 37 milliseconds:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，ping 一个远程站点，并注意你得到的响应时间。这个例子平均大约是 37 毫秒：
- en: '[PRE23]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '***1* The time value represents the time needed for a single round-trip operation.**'
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 时间值表示单程操作所需的时间。**'
- en: 'To make sure there aren’t any existing rules associated with your network interface
    (eth0, in this example), list all the current rules:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保没有与你的网络接口（例如，eth0）关联的现有规则，列出所有当前规则：
- en: '[PRE24]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '***1* qdisc stands for queueing discipline, a queue through which network-bound
    data packets must pass.**'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* qdisc 代表排队规则，网络数据包必须通过的队列。**'
- en: 'Now add a rule that delays all traffic by 100 ms. This will add 100 extra milliseconds
    to each network transfer, allowing other processes a greater share of resources.
    It’ll also slow down your network activity, so you have to be comfortable with
    the results. Don’t worry, I’ll show you how to undo all of this in just a moment:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 现在添加一个规则，延迟所有流量 100 毫秒。这将给每个网络传输增加 100 毫秒的额外时间，允许其他进程获得更多的资源份额。它也会减慢你的网络活动，所以你必须对结果感到满意。别担心，我很快就会向你展示如何撤销所有这些操作：
- en: '[PRE25]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Once again, list the `tc` rules and note the new rule that delays traffic by
    100 ms:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 再次列出 `tc` 规则，并注意新的规则将延迟流量 100 毫秒：
- en: '[PRE26]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '***1* qdisc now has a single rule delaying traffic by 100 ms.**'
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* qdisc 现在有一个单独的规则，延迟流量 100 毫秒。**'
- en: 'Test your rule. Run `ping` again, and watch the values of `time`. They should
    now be higher by around 100 milliseconds:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 测试你的规则。再次运行 `ping`，并观察 `time` 的值。它们现在应该比之前高约 100 毫秒：
- en: '[PRE27]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Worked out as you expected? Great. You’ll probably want to restore your system
    to its original state, so run this command to delete the rules, and then test
    everything again to confirm you’re back to normal:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 如您预期的那样完成了吗？太好了。您可能想要将系统恢复到原始状态，因此运行此命令以删除规则，然后再次测试一切以确认您已恢复正常：
- en: '[PRE28]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '`tc` is a complicated piece of software, and a complete guide could probably
    fill a book of its own. But I think you’ve seen enough to get a taste of the functionality
    it offers. As with everything else here, the goal is to put the tools in your
    hands so you can dig deeper and apply them to your specific problems.'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: '`tc`是一个复杂的软件，一本完整的指南可能需要填满一本书。但我认为您已经看到了足够的功能。与其他所有内容一样，目标是将工具交到您的手中，以便您可以深入研究并将它们应用于您特定的难题。'
- en: 13.5\. Monitoring tools
  id: totrans-191
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 13.5. 监控工具
- en: As with most administration-related tasks, remembering to get around to running
    each of the various tools discussed so far in this chapter, well, it just isn’t
    going to happen all that often. Some tasks can be scripted, managed by cron, and
    programmed to issue alerts when preset thresholds are met. Those are great. But
    there’s also no substitute for having eyes on actual ongoing data at least once
    in a while. Here are a few ideas to help you set up an effective monitoring system.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 就像大多数与管理工作相关的任务一样，记住运行本章中讨论的各个工具，嗯，这并不经常发生。一些任务可以编写脚本，由cron管理，并在预设阈值达到时发出警报。这些都很不错。但有时，至少偶尔查看实际进行中的数据也是不可或缺的。以下是一些帮助您设置有效监控系统的一些建议。
- en: 13.5.1\. Aggregating monitoring data
  id: totrans-193
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.5.1. 聚合监控数据
- en: nmon is a multi-target system monitoring and benchmarking tool. It offers you
    a customizable single view of limited details into the status of all system components.
    You get it going by installing the nmon package and then running `nmon` from the
    command line. The first screen you’ll see will look like the one in [figure 13.4](#ch13fig04)
    and will display the keystrokes used to toggle various views.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: nmon是一个多目标系统监控和基准测试工具。它为您提供了一个可定制的单视图，可以查看所有系统组件的状态的有限细节。您可以通过安装nmon软件包并在命令行中运行`nmon`来启动它。您将看到的第一个屏幕将类似于[图13.4](#ch13fig04)，并显示用于切换各种视图的按键。
- en: Figure 13.4\. The nmon intro screen, including basic usage instructions
  id: totrans-195
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图13.4。nmon简介屏幕，包括基本使用说明
- en: '![](Images/13fig04_alt.jpg)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/13fig04_alt.jpg)'
- en: The key here is *toggle* because, for instance, pressing c once displays the
    CPU information view, whereas pressing it again will make CPU go away. This setup
    makes it possible to add multiple views to the screen. Pressing c, m, and n will
    enable the CPU, Memory, and Network views all at once, as you can see in [figure
    13.5](#ch13fig05). This is a great way to build a single window view through which
    you can catch frequently updated overviews of your system. By the way, q will
    quit the screen.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 关键在于*切换*，因为例如，按一次c键会显示CPU信息视图，而再次按它会使CPU消失。这种设置使得在屏幕上添加多个视图成为可能。按c、m和n键可以同时启用CPU、内存和网络视图，正如您在[图13.5](#ch13fig05)中看到的那样。这是一种构建单个窗口视图的绝佳方式，通过它可以捕捉到系统频繁更新的概述。顺便说一句，按q键将退出屏幕。
- en: Figure 13.5\. Multiple services being monitored in a single nmon screen
  id: totrans-198
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图13.5。在单个nmon屏幕中监控多个服务
- en: '![](Images/13fig05_alt.jpg)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/13fig05_alt.jpg)'
- en: nmon will only cover you for a single server. If you’re responsible for a whole
    fleet of them, you’ll need something a bit more robust like Nagios or collectd
    for keeping track of the health and activities of multiple servers, and Munin
    for tracking trends and providing useful analysis.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: nmon只能覆盖单个服务器。如果您负责整个服务器群，您将需要一些更健壮的工具，如Nagios或collectd来跟踪多个服务器的健康和活动，以及Munin来跟踪趋势并提供有用的分析。
- en: 13.5.2\. Visualizing your data
  id: totrans-201
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 13.5.2. 可视化您的数据
- en: 'Great. But this will still only work when you’re actually looking. Head out
    for an extended coffee break, and you could completely miss a full-scale melt
    down. Helpfully, nmon lets you record the data it collects over time to a file.
    This example saves data collected every 30 seconds over a full hour (120 * 30
    seconds) to a file in the current working directory:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 太好了。但这仍然只能在您实际查看时起作用。如果您出去喝个长时间的咖啡，可能会完全错过全面崩溃。幸运的是，nmon允许您将随时间收集的数据记录到文件中。此示例将收集到的数据每30秒保存一次，持续一小时（120
    * 30秒），保存到当前工作目录的文件中：
- en: '[PRE29]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'If your system hostname is ubuntu, then the default filename will consist of
    ubuntu, a date and time stamp, and a .nmon extension:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的系统主机名为ubuntu，则默认文件名将包含ubuntu、日期和时间戳，以及.nmon扩展名：
- en: '[PRE30]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'As long as your system has a web server installed, you can use a tool called
    nmonchart to convert the data files to the much more user-friendly .html format.
    You’ll need to get the tool from the nmon SourceForge site ([https://sourceforge.net/projects/nmon/files](https://sourceforge.net/projects/nmon/files)).
    The simplest way is to right-click the nmonchartx.tar file (the *x* will be a
    version number) and copy the URL. From the command line of your server, use wget
    to download the tar file, and then unpack the archive the usual way:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 只要您的系统安装了Web服务器，您就可以使用一个名为nmonchart的工具将数据文件转换为更用户友好的.html格式。您需要从nmon SourceForge网站([https://sourceforge.net/projects/nmon/files](https://sourceforge.net/projects/nmon/files))获取该工具。最简单的方法是右键单击nmonchartx.tar文件（*x*
    将是版本号）并复制URL。从您的服务器的命令行使用wget下载tar文件，然后以通常的方式解压缩存档：
- en: '[PRE31]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Here’s how you’ll invoke nmonchart to convert the .nmon file and save it to
    your web root directory:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 这是您将如何调用nmonchart以转换.nmon文件并将其保存到您的Web根目录的方法：
- en: '[PRE32]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'In case you’re faced with an error complaining about the lack of a ksh interpreter,
    feel free to install the ksh package. A command-line interpreter, ksh is an alternative
    to Bash:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您遇到一个关于缺少ksh解释器的错误，请随意安装ksh包。ksh是一个命令行解释器，是Bash的替代品：
- en: '[PRE33]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'When all that’s done, you can point your browser to your server’s IP address
    followed by the filename you specified for nmonchart:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 当所有这些完成后，您可以将浏览器指向您的服务器的IP地址，后面跟您为nmonchart指定的文件名：
- en: '[PRE34]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: That should give you a page looking something like [figure 13.6](#ch13fig06).
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该会给你一个看起来像[图13.6](#ch13fig06)的页面。
- en: Figure 13.6\. An nmap-generated web page with the Network button clicked
  id: totrans-215
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图13.6\. 点击网络按钮的nmap生成的网页
- en: '![](Images/13fig06_alt.jpg)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/13fig06_alt.jpg)'
- en: You can script all this, including code to generate sequential .html filenames.
    That makes it convenient to keep up with both new and archived events.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以将所有这些脚本化，包括生成顺序.html文件名的代码。这使得跟踪新事件和归档事件都变得方便。
- en: Summary
  id: totrans-218
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 摘要
- en: The `uptime` tool can provide insight into average CPU loads over time, and
    unusual results can prompt you to look for and manage high-use processes.
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`uptime` 工具可以提供关于平均CPU负载随时间变化的洞察，异常结果可能会提示您查找和管理高使用进程。'
- en: The `nice` command can closely control the way processes compete with each other
    for limited system resources.
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`nice` 命令可以密切控制进程之间为有限系统资源竞争的方式。'
- en: Actual and swap memory can be monitored using tools like `free` and `vmstat`.
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实际内存和交换内存可以使用`free`和`vmstat`等工具进行监控。
- en: Storage limits are defined by both available physical disk space and available
    inodes.
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储限制由可用的物理磁盘空间和可用的inode定义。
- en: iftop and NetHogs are two among dozens of Linux tools for accessing network
    load data, and tc can be used to control usage.
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: iftop和NetHogs是众多用于访问网络负载数据的Linux工具中的两个，而tc可以用来控制使用。
- en: Regular monitoring is possible using command-line tools, but scripting them
    or pushing monitoring data to browser-based visual representations is far more
    likely to be effective.
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定期监控是可能的，但使用命令行工具进行脚本化或推送监控数据到基于浏览器的可视化表示可能更有效。
- en: Key terms
  id: totrans-225
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 关键术语
- en: '*CPU load* is the amount of work being performed by the CPU.'
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*CPU负载* 是CPU正在执行的工作量。'
- en: '*CPU utilization* is the proportion of CPU capacity currently being used.'
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*CPU利用率* 是当前正在使用的CPU容量的比例。'
- en: '`nice` lets you control the priority a process has in the face of conflicts
    for limited resources.'
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`nice` 允许您在有限资源冲突的情况下控制进程的优先级。'
- en: '*RAM memory* holds the OS kernel and other important software to provide fast
    access to key data.'
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*RAM内存* 存储操作系统内核和其他重要软件，以提供对关键数据的快速访问。'
- en: '*Swap memory* is space on a hard drive designated as virtual RAM, in case you
    run out of the real thing.'
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*交换内存* 是在硬盘上指定为虚拟RAM的空间，以防您用完真实的东西。'
- en: '*Inodes* are metadata containing location and other information and are associated
    with all Linux file system objects.'
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*inode* 是包含位置和其他信息的元数据，并与所有Linux文件系统对象相关联。'
- en: '*Network traffic throttling* limits the amount of bandwidth allowed to one
    process in favor of one or more processes of higher priority.'
  id: totrans-232
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*网络流量限制* 限制了允许一个进程使用的带宽量，以优先考虑一个或多个优先级更高的进程。'
- en: Security best practices
  id: totrans-233
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安全最佳实践
- en: Periodically scan your running processes, looking for rogue software that wasn’t
    started by authenticated users or by your base system.
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定期扫描正在运行的过程，寻找未经认证用户或您的基系统启动的恶意软件。
- en: Running iftop can show you remote network hosts with live connections to your
    system. If you don’t recognize a connection, it might be unauthorized and dangerous.
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行iftop可以显示与你的系统有实时连接的远程网络主机。如果你不认识一个连接，它可能是未经授权且危险的。
- en: Command-line review
  id: totrans-236
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 命令行审查
- en: '`uptime` returns the CPU load averages over the past 1, 5, and 15 minutes.'
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`uptime` 返回过去1分钟、5分钟和15分钟的CPU负载平均值。'
- en: '`cat /proc/cpuinfo | grep processor` returns the number of system CPU processors.'
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cat /proc/cpuinfo | grep processor` 返回系统CPU处理器的数量。'
- en: '`top` displays real-time statistics for running Linux processes.'
  id: totrans-239
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`top` 显示正在运行的Linux进程的实时统计信息。'
- en: '`killall yes` shuts down all running instances of the `yes` command.'
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`killall yes` 关闭所有正在运行的 `yes` 命令的实例。'
- en: '`nice --15 /var/scripts/mybackup.sh` raises the priority of the mybackup.sh
    script for system resources.'
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`nice --15 /var/scripts/mybackup.sh` 提高了 mybackup.sh 脚本的系统资源优先级。'
- en: '`free -h` displays total and available system RAM.'
  id: totrans-242
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`free -h` 显示系统总RAM和可用RAM。'
- en: '`df -i` displays the available and total inodes for each file system.'
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`df -i` 显示每个文件系统的可用和总inode。'
- en: '`find . -xdev -type f | cut -d "/" -f 2 | sort | uniq -c | sort -n` counts
    and displays the numbers of files by parent directory.'
  id: totrans-244
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`find . -xdev -type f | cut -d "/" -f 2 | sort | uniq -c | sort -n` 按父目录计数并显示文件数量。'
- en: '`apt-get autoremove` removes old and unused kernel headers.'
  id: totrans-245
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`apt-get autoremove` 删除旧的未使用的内核头文件。'
- en: '`nethogs eth0` displays processes and transfers data related to network connections
    using the eth0 interface.'
  id: totrans-246
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`nethogs eth0` 使用 eth0 接口显示与网络连接相关的进程和数据传输。'
- en: '`tc qdisc add dev eth0 root netem delay 100ms` slows down all network transfers
    through the eth0 interface by 100 milliseconds.'
  id: totrans-247
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`tc qdisc add dev eth0 root netem delay 100ms` 通过eth0接口将所有网络传输速度减慢100毫秒。'
- en: '`nmon -f -s 30 -c 120` records data from a series of `nmon` scans to a file.'
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`nmon -f -s 30 -c 120` 将一系列 `nmon` 扫描的数据记录到一个文件中。'
- en: Test yourself
  id: totrans-249
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 测试自己
- en: '**[1](#ch13qa2q0a1)**'
  id: totrans-250
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[1](#ch13qa2q0a1)**'
- en: ''
  id: totrans-251
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following CPU load scores would likely cause system slowdowns on
    a two-core system?
  id: totrans-252
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个CPU负载分数可能会在双核系统上导致系统减慢？
- en: ''
  id: totrans-253
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '1.7'
  id: totrans-254
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '1.7'
- en: '2.1'
  id: totrans-255
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '2.1'
- en: '.17'
  id: totrans-256
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '.17'
- en: '3.0'
  id: totrans-257
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '3.0'
- en: '**[2](#ch13qa2q0a2)**'
  id: totrans-258
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[2](#ch13qa2q0a2)**'
- en: ''
  id: totrans-259
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The load scores displayed by `uptime` represent averages over
  id: totrans-260
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`uptime` 显示的负载分数代表过去1分钟、5分钟和15分钟的平均值。'
- en: ''
  id: totrans-261
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 1, 10, and 25 minutes
  id: totrans-262
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1分钟、10分钟和25分钟
- en: 1, 5, and 24 hours
  id: totrans-263
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1小时、5小时和24小时
- en: 1, 5, and 15 minutes
  id: totrans-264
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1分钟、5分钟和15分钟
- en: 10, 60, and 300 seconds
  id: totrans-265
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 10秒、60秒和300秒
- en: '**[3](#ch13qa2q0a3)**'
  id: totrans-266
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[3](#ch13qa2q0a3)**'
- en: ''
  id: totrans-267
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following files will contain information about the number of processors
    on your system?
  id: totrans-268
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个文件将包含有关系统处理器数量的信息？
- en: ''
  id: totrans-269
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: /proc/uptime
  id: totrans-270
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: /proc/uptime
- en: /sys/cpuconf
  id: totrans-271
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: /sys/cpuconf
- en: /proc/cpuinfo
  id: totrans-272
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: /proc/cpuinfo
- en: /etc/proc/envinfo
  id: totrans-273
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: /etc/proc/envinfo
- en: '**[4](#ch13qa2q0a4)**'
  id: totrans-274
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[4](#ch13qa2q0a4)**'
- en: ''
  id: totrans-275
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following commands will shut down a mysqld process with a PID of
    4398?
  id: totrans-276
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个命令将关闭PID为4398的mysqld进程？
- en: ''
  id: totrans-277
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`kill mysqld`'
  id: totrans-278
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`kill mysqld`'
- en: '`killall mysqld`'
  id: totrans-279
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`killall mysqld`'
- en: '`killall 4398`'
  id: totrans-280
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`killall 4398`'
- en: '`kill mysqld:4398`'
  id: totrans-281
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`kill mysqld:4398`'
- en: '**[5](#ch13qa2q0a5)**'
  id: totrans-282
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[5](#ch13qa2q0a5)**'
- en: ''
  id: totrans-283
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: You want to reduce the priority given to your mybackup.sh script. Which of the
    following will drop its priority the most?
  id: totrans-284
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 你想要降低mybackup.sh脚本所赋予的优先级。以下哪个选项会将其优先级降低最多？
- en: ''
  id: totrans-285
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`nice -10 /var/scripts/mybackup.sh`'
  id: totrans-286
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`nice -10 /var/scripts/mybackup.sh`'
- en: '`nice -0 /var/scripts/mybackup.sh`'
  id: totrans-287
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`nice -0 /var/scripts/mybackup.sh`'
- en: '`nice --15 /var/scripts/mybackup.sh`'
  id: totrans-288
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`nice --15 /var/scripts/mybackup.sh`'
- en: '`nice -15 /var/scripts/mybackup.sh`'
  id: totrans-289
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`nice -15 /var/scripts/mybackup.sh`'
- en: '**[6](#ch13qa2q0a6)**'
  id: totrans-290
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[6](#ch13qa2q0a6)**'
- en: ''
  id: totrans-291
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following sets of symptoms most suggests a serious, ongoing memory
    problem?
  id: totrans-292
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪组症状最可能表明一个严重且持续的记忆问题？
- en: ''
  id: totrans-293
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Slow application performance and high levels of data transfers into and out
    of swap
  id: totrans-294
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 慢速应用程序性能和交换进出的数据传输高等级
- en: Slow application performance and low levels of data transfers into and out of
    swap
  id: totrans-295
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 慢速应用程序性能和交换进出的数据传输低水平
- en: Slow application performance and high CPU load average scores
  id: totrans-296
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 慢速应用程序性能和高的CPU平均负载分数
- en: Slow application performance and high inode availability
  id: totrans-297
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 慢速应用程序性能和高inode可用性
- en: '**[7](#ch13qa2q0a7)**'
  id: totrans-298
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[7](#ch13qa2q0a7)**'
- en: ''
  id: totrans-299
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following will provide PIDs along with network bandwidth data?
  id: totrans-300
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个选项将提供与网络带宽数据一起的进程ID？
- en: ''
  id: totrans-301
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`nmon -i eth0`'
  id: totrans-302
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`nmon -i eth0`'
- en: '`nethogs eth0`'
  id: totrans-303
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`nethogs eth0`'
- en: '`nethogs -i eth0`'
  id: totrans-304
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`nethogs -i eth0`'
- en: '`iftop eth0`'
  id: totrans-305
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`iftop eth0`'
- en: '**[8](#ch13qa2q0a8)**'
  id: totrans-306
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[8](#ch13qa2q0a8)**'
- en: ''
  id: totrans-307
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: How should you slow down network traffic through the eth0 interface by 100 milliseconds?
  id: totrans-308
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 你应该如何通过eth0接口减慢网络流量100毫秒？
- en: ''
  id: totrans-309
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`tc qdisc add dev eth0 root netem delay 1000ms`'
  id: totrans-310
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`tc qdisc add dev eth0 root netem delay 1000ms`'
- en: '`tc qdisc add eth0 root netem delay 100ms`'
  id: totrans-311
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`tc qdisc add eth0 root netem delay 100ms`'
- en: '`tc qdisc add dev eth0 root netem delay 100ms`'
  id: totrans-312
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`tc qdisc add dev eth0 root netem delay 100ms`'
- en: '`tc qdisc add dev eth0 root netem -h delay 100ms`'
  id: totrans-313
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`tc qdisc add dev eth0 root netem -h delay 100ms`'
- en: Answer key
  id: totrans-314
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 答案键
- en: '**[1.](#ch13qa1q1)**'
  id: totrans-315
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[1.](#ch13qa1q1)**'
- en: ''
  id: totrans-316
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: a
  id: totrans-317
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: a
- en: '**[2.](#ch13qa1q2)**'
  id: totrans-318
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[2.](#ch13qa1q2)**'
- en: ''
  id: totrans-319
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: c
  id: totrans-320
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: c
- en: '**[3.](#ch13qa1q3)**'
  id: totrans-321
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[3.](#ch13qa1q3)**'
- en: ''
  id: totrans-322
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: c
  id: totrans-323
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: c
- en: '**[4.](#ch13qa1q4)**'
  id: totrans-324
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[4.](#ch13qa1q4)**'
- en: ''
  id: totrans-325
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: b
  id: totrans-326
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: b
- en: '**[5.](#ch13qa1q5)**'
  id: totrans-327
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[5.](#ch13qa1q5)**'
- en: ''
  id: totrans-328
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: d
  id: totrans-329
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: d
- en: '**[6.](#ch13qa1q6)**'
  id: totrans-330
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[6.](#ch13qa1q6)**'
- en: ''
  id: totrans-331
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: a
  id: totrans-332
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: a
- en: '**[7.](#ch13qa1q7)**'
  id: totrans-333
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[7.](#ch13qa1q7)**'
- en: ''
  id: totrans-334
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: b
  id: totrans-335
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: b
- en: '**[8.](#ch13qa1q8)**'
  id: totrans-336
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[8.](#ch13qa1q8)**'
- en: ''
  id: totrans-337
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: c
  id: totrans-338
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: c
