- en: Chapter 1\. Data Visualization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第1章 数据可视化
- en: Introduction
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 引言
- en: “The simple graph has brought more information to the data analyst’s mind than
    any other device.” —John Tukey
  id: totrans-2
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “简单的图表给数据分析师带来的信息比任何其他设备都多。” —John Tukey
- en: R has several systems for making graphs, but ggplot2 is one of the most elegant
    and most versatile. ggplot2 implements the *grammar of graphics*, a coherent system
    for describing and building graphs. With ggplot2, you can do more faster by learning
    one system and applying it in many places.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: R 有几种制作图形的系统，但 ggplot2 是其中最优雅和最多才多艺的之一。ggplot2 实现了*图形语法*，这是一种描述和构建图形的一致系统。通过学习并在多个场景中应用
    ggplot2，你能更快速地完成更多工作。
- en: This chapter will teach you how to visualize your data using ggplot2\. We will
    start by creating a simple scatterplot and use it to introduce aesthetic mappings
    and geometric objects—the fundamental building blocks of ggplot2\. We will then
    walk you through visualizing distributions of single variables as well as visualizing
    relationships between two or more variables. We’ll finish off with saving your
    plots and troubleshooting tips.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将教你如何使用 ggplot2 来可视化你的数据。我们将从创建一个简单的散点图开始，介绍美学映射和几何对象——ggplot2 的基本构建块。接着，我们将指导你如何可视化单变量的分布以及两个或多个变量之间的关系。最后，我们将讲解如何保存你的图形以及故障排除技巧。
- en: Prerequisites
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 先决条件
- en: 'This chapter focuses on ggplot2, one of the core packages in the tidyverse.
    To access the datasets, help pages, and functions used in this chapter, load the
    tidyverse by running:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 本章重点介绍 ggplot2，这是 tidyverse 中的核心包之一。要访问本章中使用的数据集、帮助页面和函数，请运行：
- en: '[PRE0]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: That one line of code loads the core tidyverse, the packages that you will use
    in almost every data analysis. It also tells you which functions from the tidyverse
    conflict with functions in base R (or from other packages you might have loaded).^([1](ch01.xhtml#idm44771333724368))
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 那一行代码加载了核心 tidyverse，这些包几乎在每次数据分析中都会用到。它还告诉你 tidyverse 中的哪些函数与基础 R（或其他可能已加载的包）中的函数冲突。^([1](ch01.xhtml#idm44771333724368))
- en: 'If you run this code and get the error message `there is no package called
    ''tidyverse''`, you’ll need to first install it, and then run [`library()`](https://rdrr.io/r/base/library.xhtml)
    once again:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 如果运行此代码出现错误消息 `there is no package called 'tidyverse'`，你需要首先安装它，然后再次运行 [`library()`](https://rdrr.io/r/base/library.xhtml)：
- en: '[PRE1]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: You need to install a package only once, but you need to load it every time
    you start a new session.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 你只需要安装一次软件包，但每次启动新会话时都需要加载它。
- en: In addition to tidyverse, we will use the palmerpenguins package, which includes
    the `penguins` dataset containing body measurements for penguins on three islands
    in the Palmer Archipelago, and the ggthemes package, which offers a colorblind
    safe color palette.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 除了 tidyverse，我们还将使用 palmerpenguins 包，其中包括 `penguins` 数据集，其中包含了南极洲帕尔默群岛上三个岛屿上企鹅的体测量数据，以及
    ggthemes 包，提供色盲安全的配色方案。
- en: '[PRE2]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: First Steps
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第一步
- en: Do penguins with longer flippers weigh more or less than penguins with shorter
    flippers? You probably already have an answer, but try to make your answer precise.
    What does the relationship between flipper length and body mass look like? Is
    it positive? Negative? Linear? Nonlinear? Does the relationship vary by the species
    of the penguin? How about by the island where the penguin lives? Let’s create
    visualizations that we can use to answer these questions.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 长翼鳐鸟的鳍比短翼鳐鸟的鳍更重还是更轻？你可能已经有了答案，但试着让你的答案更精确。鳍长和体重之间的关系是什么样子的？是正相关？负相关？线性？非线性？这种关系是否因鳐鸟的物种而异？以及它们所在的岛屿是否有影响？让我们创建可视化图表来回答这些问题。
- en: The penguins Data Frame
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 企鹅数据帧
- en: You can test your answers to these questions with the `penguins` data frame
    found in palmerpenguins (aka [`palmerpenguins::penguins`](https://allisonhorst.github.io/palmerpenguins/reference/penguins.xhtml)).
    A data frame is a rectangular collection of variables (in the columns) and observations
    (in the rows). `penguins` contains 344 observations collected and made available
    by Dr. Kristen Gorman and the Palmer Station, Antarctica LTER.^([2](ch01.xhtml#idm44771333851472))
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 palmerpenguins 中的 `penguins` 数据帧来测试这些问题的答案（又名 [`palmerpenguins::penguins`](https://allisonhorst.github.io/palmerpenguins/reference/penguins.xhtml)）。数据帧是一个包含变量（列）和观测（行）的矩形集合。`penguins`
    包含了由 Kristen Gorman 博士和帕尔默站南极洲 LTER 团队收集并提供的 344 个观测数据。^([2](ch01.xhtml#idm44771333851472))
- en: 'To make the discussion easier, let’s define some terms:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 为了讨论更容易，让我们先定义一些术语：
- en: Variable
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 变量
- en: A quantity, quality, or property that you can measure.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 可以测量的数量、质量或属性。
- en: Value
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 值
- en: The state of a variable when you measure it. The value of a variable may change
    from measurement to measurement.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 当你测量它时变量的状态。变量的值可能会从一次测量到一次测量发生变化。
- en: Observation
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 观察
- en: A set of measurements made under similar conditions (you usually make all of
    the measurements in an observation at the same time and on the same object). An
    observation will contain several values, each associated with a different variable.
    We’ll sometimes refer to an observation as a *data point*.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 一组在相似条件下进行的测量（通常您在一个观察中同时进行所有测量并在同一个对象上进行）。一个观察将包含几个值，每个与不同的变量相关联。我们有时将观察称为*数据点*。
- en: Tabular data
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 表格数据
- en: A set of values, each associated with a variable and an observation. Tabular
    data is *tidy* if each value is placed in its own “cell,” each variable in its
    own column, and each observation in its own row.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 一组值，每个与一个变量和一个观测相关联。如果每个值放在自己的“单元格”中，每个变量放在自己的列中，每个观测放在自己的行中，则表格数据是*tidy*。
- en: In this context, a variable refers to an attribute of all the penguins, and
    an observation refers to all the attributes of a single penguin.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，变量指的是所有企鹅的属性，而观察指的是单个企鹅的所有属性。
- en: Type the name of the data frame in the console, and R will print a preview of
    its contents. Note that it says `tibble` on top of this preview. In the tidyverse,
    we use special data frames called *tibbles* that you will learn about soon.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在控制台中输入数据框的名称，R会打印其内容的预览。请注意，预览顶部写着`tibble`。在整洁的宇宙中，我们使用称为*tibbles*的特殊数据框，你很快就会了解到。
- en: '[PRE3]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: This data frame contains eight columns. For an alternative view, where you can
    see all variables and the first few observations of each variable, use [`glimpse()`](https://pillar.r-lib.org/reference/glimpse.xhtml).
    Or, if you’re in RStudio, run `View(penguins)` to open an interactive data viewer.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 此数据框包含八列。要查看所有变量和每个变量的前几个观测的另一种视图，请使用[`glimpse()`](https://pillar.r-lib.org/reference/glimpse.xhtml)。或者，如果您在RStudio中，请运行`View(penguins)`以打开交互式数据查看器。
- en: '[PRE4]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Among the variables in `penguins` are:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '`penguins`中的变量包括：'
- en: '`species`'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '`species`'
- en: A penguin’s species (Adelie, Chinstrap, or Gentoo)
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 企鹅的物种（阿德利企鹅、燕鸥企鹅或巴拉鸭企鹅）
- en: '`flipper_length_mm`'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '`flipper_length_mm`'
- en: The length of a penguin’s flipper, in millimeters
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 企鹅鳍长度，以毫米为单位
- en: '`body_mass_g`'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '`body_mass_g`'
- en: The body mass of a penguin, in grams
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 企鹅的体重，以克为单位
- en: To learn more about `penguins`, open its help page by running [`?penguins`](https://allisonhorst.github.io/palmerpenguins/reference/penguins.xhtml).
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于`penguins`的信息，请通过运行[`?penguins`](https://allisonhorst.github.io/palmerpenguins/reference/penguins.xhtml)打开其帮助页面。
- en: Ultimate Goal
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 终极目标
- en: Our ultimate goal in this chapter is to re-create the following visualization
    displaying the relationship between flipper lengths and body masses of these penguins,
    taking into consideration the species of the penguin.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的最终目标是重新创建以下可视化，显示企鹅的鳍长度与体重之间的关系，考虑到企鹅的物种。
- en: '![A scatterplot of body mass vs. flipper length of penguins, with a best fit
    line of the relationship between these two variables overlaid. The plot displays
    a positive, fairly linear, and relatively strong relationship between these two
    variables. Species (Adelie, Chinstrap, and Gentoo) are represented with different
    colors and shapes. The relationship between body mass and flipper length is roughly
    the same for these three species, and Gentoo penguins are larger than penguins
    from the other two species.](assets/rds2_01in01.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![企鹅体重与鳍长度的散点图，同时还有这两个变量之间关系的最佳拟合线。图显示这两个变量之间的正相关、相对线性和相对强的关系。物种（阿德利、燕鸥和巴拉鸭）用不同的颜色和形状表示。这三个物种之间体重和鳍长度的关系大致相同，而巴拉鸭企鹅比其他两个物种的企鹅要大。](assets/rds2_01in01.png)'
- en: Creating a ggplot
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建一个ggplot
- en: Let’s re-create this plot step by step.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们一步一步重新创建这个图。
- en: With ggplot2, you begin a plot with the function [`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml),
    defining a plot object that you then add *layers* to. The first argument of [`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml)
    is the dataset to use in the graph, so `ggplot(data = penguins)` creates an empty
    graph that is primed to display the `penguins` data, but since we haven’t told
    it how to visualize it yet, for now it’s empty. This is not a very exciting plot,
    but you can think of it like an empty canvas where you’ll paint the remaining
    layers of your plot.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 ggplot2，您可以使用函数[`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml)开始绘制图表，定义一个图表对象，然后添加*图层*。[`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml)的第一个参数是图表中要使用的数据集，因此`ggplot(data
    = penguins)`创建了一个空图表，准备显示`penguins`数据，但由于我们还没有告诉它如何可视化数据，所以目前它是空的。这并不是一个非常令人兴奋的图表，但您可以把它想象成一个空画布，在这里您将绘制图表的其余部分的图层。
- en: '[PRE5]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![A blank, gray plot area.](assets/rds2_01in02.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![一个空白的灰色绘图区域。](assets/rds2_01in02.png)'
- en: Next, we need to tell [`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml)
    how the information from our data will be visually represented. The `mapping`
    argument of the [`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml)
    function defines how variables in your dataset are mapped to visual properties
    (*aesthetics*) of your plot. The `mapping` argument is always defined in the [`aes()`](https://ggplot2.tidyverse.org/reference/aes.xhtml)
    function, and the `x` and `y` arguments of [`aes()`](https://ggplot2.tidyverse.org/reference/aes.xhtml)
    specify which variables to map to the x- and y-axes. For now, we will map only
    the flipper length to the `x` aesthetic and body mass to the `y` aesthetic. ggplot2
    looks for the mapped variables in the `data` argument, in this case, `penguins`.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要告诉[`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml)如何将我们的数据信息在视觉上呈现出来。[`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml)函数的`mapping`参数定义了如何将数据集中的变量映射到图表的视觉属性（*美学*）。`mapping`参数总是在[`aes()`](https://ggplot2.tidyverse.org/reference/aes.xhtml)函数中定义，[`aes()`](https://ggplot2.tidyverse.org/reference/aes.xhtml)函数的`x`和`y`参数指定了要映射到
    x 轴和 y 轴的变量。现在，我们将仅将翻转器长度映射到`x`美学属性，将身体质量映射到`y`美学属性。ggplot2 在`data`参数中查找映射的变量，此处为`penguins`数据集。
- en: The following plot shows the result of adding these mappings.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表显示了添加这些映射的结果。
- en: '[PRE6]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![The plot shows flipper length on the x-axis, with values that range from
    170 to 230, and body mass on the y-axis, with values that range from 3000 to 6000.](assets/rds2_01in03.png)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![图表显示翻转器长度在 x 轴上，值范围从 170 到 230，身体质量在 y 轴上，值范围从 3000 到 6000。](assets/rds2_01in03.png)'
- en: Our empty canvas now has more structure—it’s clear where flipper lengths will
    be displayed (on the x-axis) and where body masses will be displayed (on the y-axis).
    But the penguins themselves are not yet on the plot. This is because we have not
    yet articulated, in our code, how to represent the observations from our data
    frame on our plot.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们的空画布具有更多的结构——清楚地显示了翻转器长度将显示在 x 轴上，身体质量将显示在 y 轴上。但是企鹅自身还没有显示在图表上。这是因为我们还没有在我们的代码中表达如何在图表上表示数据帧中的观测值。
- en: 'To do so, we need to define a *geom*: the geometrical object that a plot uses
    to represent data. These geometric objects are made available in ggplot2 with
    functions that start with `geom_`. People often describe plots by the type of
    geom that the plot uses. For example, bar charts use bar geoms ([`geom_bar()`](https://ggplot2.tidyverse.org/reference/geom_bar.xhtml)),
    line charts use line geoms ([`geom_line()`](https://ggplot2.tidyverse.org/reference/geom_path.xhtml)),
    boxplots use boxplot geoms ([`geom_boxplot()`](https://ggplot2.tidyverse.org/reference/geom_boxplot.xhtml)),
    scatterplots use point geoms ([`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)),
    and so on.'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 为此，我们需要定义一个*几何对象*（geom）：图表用于表示数据的几何对象。在 ggplot2 中，这些几何对象通过以`geom_`开头的函数提供。人们通常通过图表使用的几何对象类型来描述图表。例如，柱状图使用柱形几何对象([`geom_bar()`](https://ggplot2.tidyverse.org/reference/geom_bar.xhtml))，折线图使用线条几何对象([`geom_line()`](https://ggplot2.tidyverse.org/reference/geom_path.xhtml))，箱线图使用箱线图几何对象([`geom_boxplot()`](https://ggplot2.tidyverse.org/reference/geom_boxplot.xhtml))，散点图使用点几何对象([`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml))，依此类推。
- en: The function [`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)
    adds a layer of points to your plot, which creates a scatterplot. ggplot2 comes
    with many geom functions, and each adds a different type of layer to a plot. You’ll
    learn a whole bunch of geoms throughout the book, particularly in [Chapter 9](ch09.xhtml#chp-layers).
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 函数[`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)将一个点层添加到您的图表中，从而创建一个散点图。ggplot2提供了许多geom函数，每个函数都向图表添加不同类型的层。您将在本书中学习到许多这样的geoms，特别是在[第9章](ch09.xhtml#chp-layers)中。
- en: '[PRE7]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![A scatterplot of body mass vs. flipper length of penguins. The plot displays
    a positive, linear, and relatively strong relationship between these two variables.](assets/rds2_01in04.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![企鹅体重与翼鳍长度的散点图。该图显示了这两个变量之间的正向、线性和相对强的关系。](assets/rds2_01in04.png)'
- en: 'Now we have something that looks like what we might think of as a “scatterplot.”
    It doesn’t yet match our “ultimate goal” plot, but using this plot we can start
    answering the question that motivated our exploration: “What does the relationship
    between flipper length and body mass look like?” The relationship appears to be
    positive (as flipper length increases, so does body mass), fairly linear (the
    points are clustered around a line instead of a curve), and moderately strong
    (there isn’t too much scatter around such a line). Penguins with longer flippers
    are generally larger in terms of their body mass.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们得到了看起来像我们可能认为的“散点图”的东西。它还不完全符合我们的“最终目标”图，但是使用这个图，我们可以开始回答促使我们探索的问题：“翼鳍长度和体重之间的关系是什么样的？”这种关系似乎是正向的（随着翼鳍长度的增加，体重也增加），相当线性（点围绕一条线而不是曲线聚集），并且适度强（围绕这样一条线没有太多的散布）。翼鳍更长的企鹅通常在体重上更大。
- en: 'Before we add more layers to this plot, let’s pause for a moment and review
    the warning message we got:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们向这张图添加更多图层之前，让我们暂停一下，回顾一下我们收到的警告消息：
- en: Removed 2 rows containing missing values ([`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)).
  id: totrans-59
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 删除了包含缺失值的2行数据（[`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)）。
- en: We’re seeing this message because there are two penguins in our dataset with
    missing body mass and/or flipper length values and ggplot2 has no way of representing
    them on the plot without both of these values. Like R, ggplot2 subscribes to the
    philosophy that missing values should never silently go missing. This type of
    warning is probably one of the most common types of warnings you will see when
    working with real data—missing values are a common issue, and you’ll learn more
    about them throughout the book, particularly in [Chapter 18](ch18.xhtml#chp-missing-values).
    For the remaining plots in this chapter we will suppress this warning so it’s
    not printed alongside every single plot we make.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到这条消息是因为我们的数据集中有两只企鹅的体重和/或翼鳍长度数值缺失，ggplot2无法在图表中表示它们。与R一样，ggplot2秉持缺失值不应该悄悄消失的理念。当处理真实数据时，这种警告消息可能是您会遇到的最常见的警告之一——缺失值是一个常见问题，您将在本书中更多地了解到它们，特别是在[第18章](ch18.xhtml#chp-missing-values)中。在本章的其余绘图中，我们将抑制此警告，以便它不会在每个单独的绘图旁边打印出来。
- en: Adding Aesthetics and Layers
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加美学和图层
- en: Scatterplots are useful for displaying the relationship between two numerical
    variables, but it’s always a good idea to be skeptical of any apparent relationship
    between two variables and ask if there may be other variables that explain or
    change the nature of this apparent relationship. For example, does the relationship
    between flipper length and body mass differ by species? Let’s incorporate species
    into our plot and see if this reveals any additional insights into the apparent
    relationship between these variables. We will do this by representing species
    with different colored points.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 散点图对于展示两个数值变量之间的关系非常有用，但对于任何两个变量之间的表面关系都保持怀疑是个好主意，并询问是否有其他变量可以解释或改变这种表面关系的性质。例如，翼鳍长度和体重之间的关系是否因物种而异？让我们将物种纳入我们的图表中，看看这是否揭示了这些变量之间表面关系的任何额外洞见。我们将通过用不同颜色的点表示物种来实现这一点。
- en: To achieve this, will we need to modify the aesthetic or the geom? If you guessed
    “in the aesthetic mapping, inside of [`aes()`](https://ggplot2.tidyverse.org/reference/aes.xhtml),”
    you’re already getting the hang of creating data visualizations with ggplot2!
    And if not, don’t worry. Throughout the book you will make many more ggplots and
    have many more opportunities to check your intuition as you make them.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 要达到这一点，我们需要修改美观或者几何？如果你猜到了“在美学映射中，[`aes()`](https://ggplot2.tidyverse.org/reference/aes.xhtml)内部”，那么你已经开始学习如何使用ggplot2创建数据可视化了！如果没有，不用担心。在本书中，你将制作更多的ggplots，并有更多机会在制作它们时检查你的直觉。
- en: '[PRE8]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![A scatterplot of body mass vs. flipper length of penguins. The plot displays
    a positive, fairly linear, and relatively strong relationship between these two
    variables. Species (Adelie, Chinstrap, and Gentoo) are represented with different
    colors.](assets/rds2_01in05.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![企鹅体重与鳍长散点图。图显示这两个变量之间存在正向、相对线性且相对强的关系。不同物种（阿德利企鹅、黑眉企鹅和根趾企鹅）用不同颜色表示。](assets/rds2_01in05.png)'
- en: When a categorical variable is mapped to an aesthetic, ggplot2 will automatically
    assign a unique value of the aesthetic (here a unique color) to each unique level
    of the variable (each of the three species), a process known as *scaling*. ggplot2
    will also add a legend that explains which values correspond to which levels.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 当将分类变量映射到美学时，ggplot2会自动为变量的每个唯一级别（三个物种）分配美学的唯一值（这里是唯一颜色），这个过程称为*缩放*。ggplot2还会添加一个解释哪些值对应哪些级别的图例。
- en: 'Now let’s add one more layer: a smooth curve displaying the relationship between
    body mass and flipper length. Before you proceed, refer to the previous code,
    and think about how we can add this to our existing plot.'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们再添加一层：显示体重与鳍长之间关系的平滑曲线。在继续之前，请参考先前的代码，并考虑如何将其添加到我们现有的图形中。
- en: 'Since this is a new geometric object representing our data, we will add a new
    geom as a layer on top of our point geom: [`geom_smooth()`](https://ggplot2.tidyverse.org/reference/geom_smooth.xhtml).
    And we will specify that we want to draw the line of best fit based on a `l`inear
    `m`odel with `method = "lm"`.'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这是表示我们数据的新几何对象，我们将在我们的点几何层之上添加一个新的几何层：[`geom_smooth()`](https://ggplot2.tidyverse.org/reference/geom_smooth.xhtml)。我们将指定基于`l`inear
    `m`odel和`method = "lm"`绘制最佳拟合线。
- en: '[PRE9]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![A scatterplot of body mass vs. flipper length of penguins. Overlaid on the
    scatterplot are three smooth curves displaying the relationship between these
    variables for each species (Adelie, Chinstrap, and Gentoo). Different penguin
    species are plotted in different colors for the points and the smooth curves.](assets/rds2_01in06.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![一张企鹅体重与鳍长散点图。在散点图上叠加了三条平滑曲线，显示了这些变量在每个物种（阿德利企鹅、黑眉企鹅和根趾企鹅）中的关系。不同的企鹅物种用不同的颜色表示。](assets/rds2_01in06.png)'
- en: We have successfully added lines, but this plot doesn’t look like the plot from
    [“Ultimate Goal”](#sec-ultimate-goal), which has only one line for the entire
    dataset as opposed to separate lines for each of the penguin species.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我们成功地添加了线条，但这个图形看起来不像[“最终目标”](#sec-ultimate-goal)中的图形，后者只有一条线代表整个数据集，而不是每个企鹅物种分别的线条。
- en: When aesthetic mappings are defined in [`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml),
    at the *global* level, they’re passed down to each of the subsequent geom layers
    of the plot. However, each geom function in ggplot2 can also take a `mapping`
    argument, which allows for aesthetic mappings at the *local* level that are added
    to those inherited from the global level. Since we want points to be colored based
    on species but don’t want the lines to be separated out for them, we should specify
    `color = species` for [`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)
    only.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 当在[`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml)中定义美学映射时，它们是在*全局*级别传递给绘图的每个后续几何层。然而，ggplot2中的每个几何函数也可以接受一个`mapping`参数，允许在*局部*级别进行美学映射，这些映射会添加到从全局级别继承的映射中。由于我们希望根据物种对点进行着色，但不希望将线分隔开来，我们应该仅为[`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)指定`color
    = species`。
- en: '[PRE10]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![A scatterplot of body mass vs. flipper length of penguins. Overlaid on the
    scatterplot is a single line of best fit displaying the relationship between these
    variables for each species (Adelie, Chinstrap, and Gentoo). Different penguin
    species are plotted in different colors for the points only.](assets/rds2_01in07.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![一张关于企鹅体重与鳍长的散点图。在散点图上叠加了一条最佳拟合线，显示了每个物种（阿德利企鹅、燕带企鹅和根趾企鹅）之间这两个变量的关系。点的颜色只是不同的企鹅物种的标识。](assets/rds2_01in07.png)'
- en: Voilà! We have something that looks very much like our ultimate goal, though
    it’s not yet perfect. We still need to use different shapes for each species of
    penguins and improve labels.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 瞧！我们得到了一些非常接近我们终极目标的东西，尽管它还不完美。我们仍然需要为每个企鹅物种使用不同的形状，并改进标签。
- en: It’s generally not a good idea to represent information using only colors on
    a plot, as people perceive colors differently due to color blindness or other
    color vision differences. Therefore, in addition to color, we can map `species`
    to the `shape` aesthetic.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 通常不建议仅使用颜色在图表上表示信息，因为人们由于色盲或其他色觉差异可能会对颜色有不同的感知。因此，除了颜色外，我们还可以将 `species` 映射到
    `shape` 美学上。
- en: '[PRE11]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![A scatterplot of body mass vs. flipper length of penguins. Overlaid on the
    scatterplot is a single line of best fit displaying the relationship between these
    variables for each species (Adelie, Chinstrap, and Gentoo). Different penguin
    species are plotted in different colors and shapes for the points only.](assets/rds2_01in08.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![一张关于企鹅体重与鳍长的散点图。在散点图上叠加了一条最佳拟合线，显示了每个物种（阿德利企鹅、燕带企鹅和根趾企鹅）之间这两个变量的关系。点的颜色和形状分别表示不同的企鹅物种。](assets/rds2_01in08.png)'
- en: Note that the legend is automatically updated to reflect the different shapes
    of the points as well.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，图例会自动更新以反映点的不同形状。
- en: 'Finally, we can improve the labels of our plot using the [`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml)
    function in a new layer. Some of the arguments to [`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml)
    might be self-explanatory: `title` adds a title, and `subtitle` adds a subtitle
    to the plot. Other arguments match the aesthetic mappings: `x` is the x-axis label,
    `y` is the y-axis label, and `color` and `shape` define the label for the legend.
    In addition, we can improve the color palette to be color-blind safe with the
    [`scale_color_colorblind()`](https://rdrr.io/pkg/ggthemes/man/colorblind.xhtml)
    function from the ggthemes package.'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们可以使用 [`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml) 函数在新的层中改善图表的标签。[`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml)
    的一些参数可能是不言自明的：`title` 添加标题，`subtitle` 添加副标题到图表中。其他参数匹配美学映射：`x` 是 x 轴标签，`y` 是 y
    轴标签，`color` 和 `shape` 定义图例的标签。此外，我们可以使用 ggthemes 包中的 [`scale_color_colorblind()`](https://rdrr.io/pkg/ggthemes/man/colorblind.xhtml)
    函数改善配色方案，以适应色盲人群。
- en: '[PRE12]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![A scatterplot of body mass vs. flipper length of penguins, with a line of
    best fit displaying the relationship between these two variables overlaid. The
    plot displays a positive, fairly linear, and relatively strong relationship between
    these two variables. Species (Adelie, Chinstrap, and Gentoo) are represented with
    different colors and shapes. The relationship between body mass and flipper length
    is roughly the same for these three species, and Gentoo penguins are larger than
    penguins from the other two species.](assets/rds2_01in09.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![一张关于企鹅体重与鳍长的散点图，同时还有一条最佳拟合线显示这两个变量之间的关系。图表展示了这两个变量之间正向、相当线性且比较强的关系。不同的物种（阿德利企鹅、燕带企鹅和根趾企鹅）用不同的颜色和形状表示。体重与鳍长的关系对这三个物种来说大致相同，而根趾企鹅比其他两个物种的企鹅体型更大。](assets/rds2_01in09.png)'
- en: We finally have a plot that perfectly matches our “ultimate goal”!
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 我们终于得到了一个完美匹配我们“终极目标”的图表！
- en: Exercises
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习
- en: How many rows are in `penguins`? How many columns?
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`penguins` 中有多少行？多少列？'
- en: What does the `bill_depth_mm` variable in the `penguins` data frame describe?
    Read the help for [`?penguins`](https://allisonhorst.github.io/palmerpenguins/reference/penguins.xhtml)
    to find out.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`penguins` 数据框中的 `bill_depth_mm` 变量是描述什么的？阅读 [`?penguins`](https://allisonhorst.github.io/palmerpenguins/reference/penguins.xhtml)
    的帮助文件来了解。'
- en: Make a scatterplot of `bill_depth_mm` versus `bill_length_mm`. That is, make
    a scatterplot with `bill_depth_mm` on the y-axis and `bill_length_mm` on the x-axis.
    Describe the relationship between these two variables.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 制作一个 `bill_depth_mm` 对 `bill_length_mm` 的散点图。即，将 `bill_depth_mm` 放在 y 轴，`bill_length_mm`
    放在 x 轴。描述这两个变量之间的关系。
- en: What happens if you make a scatterplot of `species` versus `bill_depth_mm`?
    What might be a better choice of geom?
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你绘制`species`与`bill_depth_mm`的散点图会发生什么？可能有更好的几何图形选择吗？
- en: Why does the following give an error, and how would you fix it?
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为什么以下代码会报错，你会如何修复它？
- en: '[PRE13]'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: What does the `na.rm` argument do in [`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)?
    What is the default value of the argument? Create a scatterplot where you successfully
    use this argument set to `TRUE`.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)中的`na.rm`参数是做什么的？这个参数的默认值是什么？创建一个散点图，其中成功使用此参数设置为`TRUE`。'
- en: 'Add the following caption to the plot you made in the previous exercise: “Data
    come from the palmerpenguins package.” Hint: Take a look at the documentation
    for [`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml).'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你之前绘制的图表上添加以下标题：“数据来自palmerpenguins包。”提示：查看[`labs()`](https://ggplot2.tidyverse.org/reference/labs.xhtml)的文档。
- en: Re-create the following visualization. What aesthetic should `bill_depth_mm`
    be mapped to? And should it be mapped at the global level or at the geom level?
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新创建以下可视化。`bill_depth_mm`应该映射到哪个美学特征？它应该在全局级别还是在几何级别映射？
- en: '![A scatterplot of body mass vs. flipper length of penguins, colored by bill
    depth. A smooth curve of the relationship between body mass and flipper length
    is overlaid. The relationship is positive, fairly linear, and moderately strong.](assets/rds2_01in10.png)'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![企鹅的体重与鳍长的散点图，按脖深着色。叠加了体重与鳍长之间关系的平滑曲线。关系是正向的，相当线性，且适度强。](assets/rds2_01in10.png)'
- en: Run this code in your head and predict what the output will look like. Then,
    run the code in R and check your predictions.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在脑中运行此代码并预测输出的样子。然后，在R中运行代码并检查你的预测。
- en: '[PRE14]'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Will these two graphs look different? Why/why not?
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这两个图看起来会有不同吗？为什么/为什么不？
- en: '[PRE15]'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: ggplot2 Calls
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '`ggplot2`调用'
- en: 'As we move on from these introductory sections, we’ll transition to a more
    concise expression of ggplot2 code. So far we’ve been very explicit, which is
    helpful when you are learning:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们从这些介绍性部分过渡，我们将转向更简洁的表达`ggplot2`代码。到目前为止，我们一直非常明确，这在学习过程中很有帮助：
- en: '[PRE16]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Typically, the first one or two arguments to a function are so important that
    you should know them by heart. The first two arguments to [`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml)
    are `data` and `mapping`; in the remainder of the book, we won’t supply those
    names. That saves typing and, by reducing the amount of extra text, makes it easier
    to see what’s different between plots. That’s a really important programming concern
    that we’ll come back to in [Chapter 25](ch25.xhtml#chp-functions).
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，函数的前一个或两个参数非常重要，你应该牢记它们。[`ggplot()`](https://ggplot2.tidyverse.org/reference/ggplot.xhtml)函数的前两个参数分别是`data`和`mapping`；在本书的其余部分，我们不会提供这些名称。这样做可以节省输入，减少额外文本的数量，更容易看出图之间的差异。这是一个非常重要的编程问题，我们将在[第25章](ch25.xhtml#chp-functions)回顾。
- en: 'Rewriting the previous plot more concisely yields:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 将上一个图表以更简洁的方式重写如下：
- en: '[PRE17]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'In the future, you’ll also learn about the pipe, `|>`, which will allow you
    to create that plot with:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在未来，你还将学习管道符号`|>`，它将允许你使用以下代码创建该图表：
- en: '[PRE18]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Visualizing Distributions
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 可视化分布
- en: 'How you visualize the distribution of a variable depends on the type of variable:
    categorical or numerical.'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 如何可视化变量的分布取决于变量的类型：分类或数值型。
- en: A Categorical Variable
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 一个分类变量
- en: A variable is *categorical* if it can take only one of a small set of values.
    To examine the distribution of a categorical variable, you can use a bar chart.
    The height of the bars displays how many observations occurred with each `x` value.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一个变量只能取少量值中的一个，那么它是*categorical*变量。要检查分类变量的分布，可以使用条形图。条的高度显示了每个`x`值发生了多少次观察。
- en: '[PRE19]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![A bar chart of frequencies of species of penguins: Adelie (approximately
    150), Chinstrap (approximately 90), Gentoo (approximately 125).](assets/rds2_01in11.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![一个企鹅物种频率条形图：阿德利（约150只）、帝企鹅（约90只）、金斑企鹅（约125只）。](assets/rds2_01in11.png)'
- en: In bar plots of categorical variables with nonordered levels, like the previous
    penguin `species`, it’s often preferable to reorder the bars based on their frequencies.
    Doing so requires transforming the variable to a factor (how R handles categorical
    data) and then reordering the levels of that factor.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在具有非顺序级别的分类变量的条形图中，像之前的企鹅`species`一样，通常最好根据它们的频率重新排序条形。这需要将变量转换为因子（R如何处理分类数据），然后重新排序该因子的级别。
- en: '[PRE20]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![A bar chart of frequencies of species of penguins, where the bars are ordered
    in decreasing order of their heights (frequencies): Adelie (approximately 150),
    Gentoo (approximately 125), Chinstrap (approximately 90).](assets/rds2_01in12.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![一张企鹅物种频率条形图，柱子按高度（频率）降序排列：阿德利（约150）、根足（约125）、黑脸金鱼（约90）。](assets/rds2_01in12.png)'
- en: You will learn more about factors and functions for dealing with factors (such
    as [`fct_infreq()`](https://forcats.tidyverse.org/reference/fct_inorder.xhtml))
    in [Chapter 16](ch16.xhtml#chp-factors).
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 你将在[第16章](ch16.xhtml#chp-factors)中学习更多关于因子及其处理函数（如[`fct_infreq()`](https://forcats.tidyverse.org/reference/fct_inorder.xhtml)）的内容。
- en: A Numerical Variable
  id: totrans-117
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数值变量
- en: A variable is *numerical* (or quantitative) if it can take on a wide range of
    numerical values and it is sensible to add, subtract, or take averages with those
    values. Numerical variables can be continuous or discrete.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一个变量能够取一系列数值，并且可以对这些数值进行加减和平均，那么这个变量就是*数值*（或定量）变量。数值变量可以是连续的或离散的。
- en: One commonly used visualization for distributions of continuous variables is
    a histogram.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 处理连续变量分布常用的一种可视化方法是直方图。
- en: '[PRE21]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![A histogram of body masses of penguins. The distribution is unimodal and
    right skewed, ranging between approximately 2500 to 6500 grams.](assets/rds2_01in13.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![一张企鹅体重直方图。分布单峰，呈右偏，范围约为2500至6500克。](assets/rds2_01in13.png)'
- en: A histogram divides the x-axis into equally spaced bins and then uses the height
    of a bar to display the number of observations that fall in each bin. In the previous
    graph, the tallest bar shows that 39 observations have a `body_mass_g` value between
    3,500 and 3,700 grams, which are the left and right edges of the bar.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图将x轴等间隔地划分为多个区间，并使用柱的高度显示落入每个区间的观测次数。在上一个图中，最高的柱子表明有39个观测值的`body_mass_g`在3500至3700克之间，这是该柱子的左右边缘。
- en: You can set the width of the intervals in a histogram with the `binwidth` argument,
    which is measured in the units of the `x` variable. You should always explore
    a variety of `binwidth` values when working with histograms, as different `binwidth`
    values can reveal different patterns. In the following plots, a `binwidth` of
    20 is too narrow, resulting in too many bars, making it difficult to determine
    the shape of the distribution. Similarly, a `binwidth` of 2,000 is too high, resulting
    in all data being binned into only three bars and also making it difficult to
    determine the shape of the distribution. A `binwidth` of 200 provides a sensible
    balance.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用`binwidth`参数设置直方图中的间隔宽度，单位为`x`变量的单位。在处理直方图时，应当尝试多种`binwidth`值，因为不同的`binwidth`值可以展现出不同的模式。在以下图表中，`binwidth`为20时太窄，导致了太多的柱子，使得难以确定分布的形状。同样，`binwidth`为2,000时太高，导致所有数据只分为三个柱子，同样使得难以确定分布的形状。`binwidth`为200则提供了一个合理的平衡。
- en: '[PRE22]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '![Two histograms of body masses of penguins, one with binwidth of 20 (left)
    and one with binwidth of 2000 (right). The histogram with binwidth of 20 shows
    lots of ups and downs in the heights of the bins, creating a jagged outline. The
    histogram  with binwidth of 2000 shows only three bins.](assets/rds2_01in14.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![两张企鹅体重直方图，左侧为`binwidth`为20，右侧为`binwidth`为2000。`binwidth`为20的直方图显示出许多柱子的起伏，创建了一个锯齿状的轮廓。`binwidth`为2000的直方图只显示了三个柱子。](assets/rds2_01in14.png)'
- en: An alternative visualization for distributions of numerical variables is a density
    plot. A density plot is a smoothed-out version of a histogram and a practical
    alternative, particularly for continuous data that comes from an underlying smooth
    distribution. We won’t go into how [`geom_density()`](https://ggplot2.tidyverse.org/reference/geom_density.xhtml)
    estimates the density (you can read more about that in the function documentation),
    but let’s explain how the density curve is drawn with an analogy. Imagine a histogram
    made out of wooden blocks. Then, imagine that you drop a cooked spaghetti string
    over it. The shape the spaghetti will take draped over blocks can be thought of
    as the shape of the density curve. It shows fewer details than a histogram but
    can make it easier to quickly glean the shape of the distribution, particularly
    with respect to modes and skewness.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 数值变量分布的另一种可视化方式是密度图。密度图是直方图的平滑版本，特别适用于来自平滑分布的连续数据。我们不会深入讨论[`geom_density()`](https://ggplot2.tidyverse.org/reference/geom_density.xhtml)如何估计密度（您可以在函数文档中阅读更多），但让我们用一个类比来解释密度曲线是如何绘制的。想象一个由木块组成的直方图。然后，想象你在上面放一根熟意面条。意面条掉在木块上的形状可以看作是密度曲线的形状。它显示的细节比直方图少，但可以更快速地了解分布的形状，特别是关于众数和偏度方面。
- en: '[PRE23]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![A density plot of body masses of penguins. The distribution is unimodal and
    right skewed, ranging between approximately 2500 to 6500 grams.](assets/rds2_01in15.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![企鹅体重密度图。分布是单峰且右偏，范围大约在2500到6500克之间。](assets/rds2_01in15.png)'
- en: Exercises
  id: totrans-129
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习
- en: Make a bar plot of `species` of `penguins`, where you assign `species` to the
    `y` aesthetic. How is this plot different?
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 制作一个`penguins`的`species`条形图，将`species`分配给`y`美学。这个图与之前的有何不同？
- en: How are the following two plots different? Which aesthetic, `color` or `fill`,
    is more useful for changing the color of bars?
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下面这两个图有何不同？哪个美学，`color`还是`fill`，更适合改变条形图的颜色？
- en: '[PRE24]'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: What does the `bins` argument in [`geom_histogram()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml)
    do?
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[`geom_histogram()`](https://ggplot2.tidyverse.org/reference/geom_histogram.xhtml)中的`bins`参数是做什么用的？'
- en: Make a histogram of the `carat` variable in the `diamonds` dataset that is available
    when you load the tidyverse package. Experiment with different `binwidth` values.
    What value reveals the most interesting patterns?
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 制作`diamonds`数据集中`carat`变量的直方图，该数据集在加载tidyverse包时可用。尝试不同的`binwidth`值。哪个值显示出最有趣的模式？
- en: Visualizing Relationships
  id: totrans-135
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 可视化关系
- en: To visualize a relationship we need to have at least two variables mapped to
    aesthetics of a plot. In the following sections you will learn about commonly
    used plots for visualizing relationships between two or more variables and the
    geoms used for creating them.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 要可视化一个关系，我们需要将至少两个变量映射到绘图的美学上。在接下来的几节中，您将学习关于常用绘图来可视化两个或多个变量之间关系的绘图和用于创建它们的几何对象。
- en: A Numerical and a Categorical Variable
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数值变量和分类变量
- en: 'To visualize the relationship between a numerical and a categorical variable
    we can use side-by-side box plots. A *boxplot* is a type of visual shorthand for
    measures of position (percentiles) that describe a distribution. It is also useful
    for identifying potential outliers. As shown in [Figure 1-1](#fig-eda-boxplot),
    each boxplot consists of:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 要可视化数值和分类变量之间的关系，我们可以使用并列箱线图。*箱线图*是描述分布的位置（百分位数）的一种视觉简写。它还有助于识别潜在的异常值。如[图1-1](#fig-eda-boxplot)所示，每个箱线图包括：
- en: A box that indicates the range of the middle half of the data, a distance known
    as the *interquartile range* (IQR), stretching from the 25th percentile of the
    distribution to the 75th percentile. In the middle of the box is a line that displays
    the median, i.e., 50th percentile, of the distribution. These three lines give
    you a sense of the spread of the distribution and whether the distribution is
    symmetric about the median or skewed to one side.
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个显示数据中间一半范围的方框，这个距离被称为*四分位距*（IQR），从分布的第25百分位到第75百分位延伸。在方框中间有一条显示分布中位数，即第50百分位的线。这三条线让你了解分布的扩展情况，以及分布是否关于中位数对称或偏向一侧。
- en: Visual points that display observations that fall more than 1.5 times the IQR
    from either edge of the box. These outlying points are unusual so they are plotted
    individually.
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 显示落在箱子任一边缘1.5倍IQR之外的观察点的可视点。这些异常点很不寻常，因此单独绘制。
- en: A line (or whisker) that extends from each end of the box and goes to the farthest
    nonoutlier point in the distribution.
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个箱线图上都有一条线（或者叫做须），它从箱子的两端延伸出去，直到分布中最远的非异常点。
- en: '![A diagram depicting how a boxplot is created following the steps outlined
    above.](assets/rds2_0101.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![展示了如何按照上述步骤创建箱线图的示意图。](assets/rds2_0101.png)'
- en: Figure 1-1\. Diagram depicting how a boxplot is created.
  id: totrans-143
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 1-1\. 展示了如何创建箱线图的示意图。
- en: 'Let’s take a look at the distribution of body mass by species using [`geom_boxplot()`](https://ggplot2.tidyverse.org/reference/geom_boxplot.xhtml):'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看使用 [`geom_boxplot()`](https://ggplot2.tidyverse.org/reference/geom_boxplot.xhtml)
    显示的各种企鹅体重分布：
- en: '[PRE25]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '![Side-by-side box plots of distributions of body masses of Adelie, Chinstrap,
    and Gentoo penguins. The distribution of Adelie and Chinstrap penguins'' body
    masses appear to be symmetric with medians around 3750 grams. The median body
    mass of Gentoo penguins is much higher, around 5000 grams, and the distribution
    of the body masses of these penguins appears to be somewhat right skewed.](assets/rds2_01in16.png)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![Adelie、Chinstrap 和 Gentoo 企鹅体重分布的并列箱线图。Adelie 和 Chinstrap 企鹅的体重分布呈对称分布，中位数约为3750克。Gentoo
    企鹅的中位体重要高得多，约为5000克，体重分布呈现出稍微右偏态。](assets/rds2_01in16.png)'
- en: 'Alternatively, we can make density plots with [`geom_density()`](https://ggplot2.tidyverse.org/reference/geom_density.xhtml):'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，我们可以使用 [`geom_density()`](https://ggplot2.tidyverse.org/reference/geom_density.xhtml)
    制作密度图：
- en: '[PRE26]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '![A density plot of body masses of penguins by species of penguins. Each species
    (Adelie, Chinstrap, and Gentoo) is represented with different colored outlines
    for the density curves.](assets/rds2_01in17.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![按照企鹅物种制作的体重密度图。每种企鹅（Adelie、Chinstrap 和 Gentoo）在密度曲线中用不同颜色的轮廓表示。](assets/rds2_01in17.png)'
- en: We’ve also customized the thickness of the lines using the `linewidth` argument
    to make them stand out a bit more against the background.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还使用 `linewidth` 参数自定义了线条的厚度，使其在背景中更加突出。
- en: 'Additionally, we can map `species` to both `color` and `fill` aesthetics and
    use the `alpha` aesthetic to add transparency to the filled density curves. This
    aesthetic takes values between 0 (completely transparent) and 1 (completely opaque).
    In the following plot it’s set to 0.5:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，我们还可以将 `species` 同时映射到 `color` 和 `fill` 美学，并使用 `alpha` 美学为填充的密度曲线增加透明度。该美学接受介于0（完全透明）和1（完全不透明）之间的值。在以下图中，它被设置为0.5：
- en: '[PRE27]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '![A density plot of body masses of penguins by species of penguins. Each species
    (Adelie, Chinstrap, and Gentoo) is represented in different colored outlines for
    the density curves. The density curves are also filled with the same colors, with
    some transparency added.](assets/rds2_01in18.png)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![按照企鹅物种制作的体重密度图。每种企鹅（Adelie、Chinstrap 和 Gentoo）在密度曲线中用不同颜色的轮廓表示，密度曲线也填充有相同颜色，透明度有所增加。](assets/rds2_01in18.png)'
- en: 'Note the terminology we have used here:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 注意我们在这里使用的术语：
- en: We *map* variables to aesthetics if we want the visual attribute represented
    by that aesthetic to vary based on the values of that variable.
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果我们希望视觉属性根据变量的值而变化，我们可以将变量*映射*到美学。
- en: Otherwise, we *set* the value of an aesthetic.
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 否则，我们可以*设置*美学的值。
- en: Two Categorical Variables
  id: totrans-157
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 两个分类变量
- en: We can use stacked bar plots to visualize the relationship between two categorical
    variables. For example, the following two stacked bar plots both display the relationship
    between `island` and `species`, or, specifically, visualize the distribution of
    `species` within each island.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用堆叠条形图来可视化两个分类变量之间的关系。例如，以下两个堆叠条形图都显示了 `island` 和 `species` 之间的关系，或者具体来说，显示了每个岛上
    `species` 的分布情况。
- en: The first plot shows the frequencies of each species of penguins on each island.
    The plot of frequencies shows that there are equal numbers of Adelies on each
    island, but we don’t have a good sense of the percentage balance within each island.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个图显示了每个岛上各种企鹅的频率。频率图显示每个岛上 Adelie 数量相等，但我们对每个岛内的百分比分布没有很好的感知。
- en: '[PRE28]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '![Bar plots of penguin species by island (Biscoe, Dream, and Torgersen)](assets/rds2_01in19.png)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![按照岛屿（Biscoe、Dream 和 Torgersen）显示的企鹅物种的条形图](assets/rds2_01in19.png)'
- en: The second plot is a relative frequency plot, created by setting `position =
    "fill"` in the geom, and is more useful for comparing species distributions across
    islands since it’s not affected by the unequal numbers of penguins across the
    islands. Using this plot we can see that Gentoo penguins all live on Biscoe island
    and make up roughly 75% of the penguins on that island, Chinstrap all live on
    Dream island and make up roughly 50% of the penguins on that island, and Adelie
    live on all three islands and make up all of the penguins on Torgersen.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个图表是一个相对频率图，通过在几何体中设置`position = "fill"`创建，并且更适合比较物种在不同岛屿上的分布，因为它不受各岛屿企鹅数量不均匀分布的影响。使用此图表，我们可以看到Gentoo企鹅全部生活在Biscoe岛上，并占该岛企鹅总数的约75%，Chinstrap全部生活在Dream岛上，并占该岛企鹅总数的约50%，而Adelie企鹅则生活在三个岛屿上，并占Torgersen岛上的所有企鹅。
- en: '[PRE29]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '![Bar plots of penguin species by island (Biscoe, Dream, and Torgersen) the
    bars are scaled to the same height, making it a relative frequencies plot](assets/rds2_01in20.png)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![企鹅物种按岛屿（Biscoe、Dream和Torgersen）分的条形图。条形的高度缩放到相同高度，形成一个相对频率图。](assets/rds2_01in20.png)'
- en: In creating these bar charts, we map the variable that will be separated into
    bars to the `x` aesthetic, and the variable that will change the colors inside
    the bars to the `fill` aesthetic.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建这些条形图时，我们将将要分隔成条的变量映射到`x`美学属性上，将用于填充条形内颜色的变量映射到`fill`美学属性上。
- en: Two Numerical Variables
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 两个数值变量
- en: So far you’ve learned about scatterplots (created with [`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml))
    and smooth curves (created with [`geom_smooth()`](https://ggplot2.tidyverse.org/reference/geom_smooth.xhtml))
    for visualizing the relationship between two numerical variables. A scatterplot
    is probably the most commonly used plot for visualizing the relationship between
    two numerical variables.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，您已经学习了关于散点图（由[`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.xhtml)创建）和平滑曲线（由[`geom_smooth()`](https://ggplot2.tidyverse.org/reference/geom_smooth.xhtml)创建）用于可视化两个数值变量之间关系的知识。散点图可能是最常用于展示两个数值变量之间关系的图表类型。
- en: '[PRE30]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '![A scatterplot of body mass vs. flipper length of penguins. The plot displays
    a positive, linear, relatively strong relationship between these two variables.](assets/rds2_01in21.png)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![企鹅体重与鳍长度的散点图。图表显示这两个变量之间呈现出正线性、相对强烈的关系。](assets/rds2_01in21.png)'
- en: Three or More Variables
  id: totrans-170
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 三个或更多变量
- en: 'As we saw in [“Adding Aesthetics and Layers”](#sec-adding-aesthetics-layers),
    we can incorporate more variables into a plot by mapping them to additional aesthetics.
    For example, in the following scatterplot the colors of points represent species,
    and the shapes of points represent islands:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在[“添加美学和图层”](#sec-adding-aesthetics-layers)中看到的那样，我们可以通过将更多变量映射到额外的美学属性来将更多变量合并到一个图表中。例如，在以下散点图中，点的颜色表示物种，点的形状表示岛屿：
- en: '[PRE31]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '![A scatterplot of body mass vs. flipper length of penguins. The plot displays
    a positive, linear, relatively strong relationship between these two variables.
    The points are colored based on the species of the penguins and the shapes of
    the points represent islands (round points are Biscoe island, triangles are Dream
    island, and squared are Torgersen island). The plot is very busy and it''s difficult
    to distinguish the shapes of the points.](assets/rds2_01in22.png)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
  zh: '![一张企鹅体重与鳍长度的散点图。图表显示这两个变量之间呈现出正线性、相对强烈的关系。点的颜色基于企鹅的物种，点的形状代表岛屿（圆形点为Biscoe岛，三角形为Dream岛，方形为Torgersen岛）。图表非常繁忙，很难辨别点的形状。](assets/rds2_01in22.png)'
- en: However, adding too many aesthetic mappings to a plot makes it cluttered and
    difficult to make sense of. Another option, which is particularly useful for categorical
    variables, is to split your plot into *facets*, subplots that each display one
    subset of the data.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，向图表中添加过多的美学映射会使其变得混乱且难以理解。另一个选择，特别适用于分类变量的情况，是将图表拆分为*分面*，每个分面显示数据的一个子集。
- en: To facet your plot by a single variable, use [`facet_wrap()`](https://ggplot2.tidyverse.org/reference/facet_wrap.xhtml).
    The first argument of [`facet_wrap()`](https://ggplot2.tidyverse.org/reference/facet_wrap.xhtml)
    is a formula,^([3](ch01.xhtml#idm44771330671200)) which you create with `~` followed
    by a variable name. The variable that you pass to [`facet_wrap()`](https://ggplot2.tidyverse.org/reference/facet_wrap.xhtml)
    should be categorical.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 要通过单一变量来划分你的图，使用[`facet_wrap()`](https://ggplot2.tidyverse.org/reference/facet_wrap.xhtml)。[`facet_wrap()`](https://ggplot2.tidyverse.org/reference/facet_wrap.xhtml)的第一个参数是一个公式，^([3](ch01.xhtml#idm44771330671200))，你用`~`后跟一个变量名来创建它。你传递给[`facet_wrap()`](https://ggplot2.tidyverse.org/reference/facet_wrap.xhtml)的变量应该是分类的。
- en: '[PRE32]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '![A scatterplot of body mass vs. flipper length of penguins. The shapes and
    colors of points represent species. Penguins from each island are on a separate
    facet. Within each facet, the relationship between body mass and flipper length
    is positive, linear, relatively strong.](assets/rds2_01in23.png)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![企鹅体重与鳍长的散点图。点的形状和颜色代表物种。每个岛上的企鹅在不同的分面上。在每个分面内，体重与鳍长之间的关系呈正线性，相对较强。](assets/rds2_01in23.png)'
- en: You will learn about many other geoms for visualizing distributions of variables
    and relationships between them in [Chapter 9](ch09.xhtml#chp-layers).
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 你将在[第9章](ch09.xhtml#chp-layers)学习关于用于可视化变量分布和它们之间关系的许多其他几何图形。
- en: Exercises
  id: totrans-179
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习
- en: 'The `mpg` data frame that is bundled with the ggplot2 package contains 234
    observations collected by the US Environmental Protection Agency on 38 car models.
    Which variables in `mpg` are categorical? Which variables are numerical? (Hint:
    Type [`?mpg`](https://ggplot2.tidyverse.org/reference/mpg.xhtml) to read the documentation
    for the dataset.) How can you see this information when you run `mpg`?'
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 与ggplot2软件包捆绑的`mpg`数据框包含了由美国环境保护局收集的38个车型的234个观测值。`mpg`中的哪些变量是分类变量？哪些是数值变量？（提示：输入[`?mpg`](https://ggplot2.tidyverse.org/reference/mpg.xhtml)来阅读数据集的文档。）当你运行`mpg`时，如何查看这些信息？
- en: Make a scatterplot of `hwy` versus `displ` using the `mpg` data frame. Next,
    map a third, numerical variable to `color`, then `size`, then both `color` and
    `size`, and then `shape`. How do these aesthetics behave differently for categorical
    versus numerical variables?
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 利用`mpg`数据框绘制`hwy`与`displ`的散点图。接下来，将第三个数值变量映射到`color`、`size`、`color`和`size`以及`shape`。这些美学在分类变量和数值变量上表现有何不同？
- en: In the scatterplot of `hwy` versus `displ`, what happens if you map a third
    variable to `linewidth`?
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`hwy`与`displ`的散点图中，如果将第三个变量映射到`linewidth`会发生什么？
- en: What happens if you map the same variable to multiple aesthetics?
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果将同一变量映射到多个美学上会发生什么？
- en: Make a scatterplot of `bill_depth_mm` versus `bill_length_mm` and color the
    points by `species`. What does adding coloring by species reveal about the relationship
    between these two variables? What about faceting by species?
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 制作`bill_depth_mm`与`bill_length_mm`的散点图，并按`species`着色。按物种着色的效果揭示了这两个变量之间的关系的什么？按物种分面又有什么不同？
- en: Why does the following yield two separate legends? How would you fix it to combine
    the two legends?
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为什么以下操作会生成两个单独的图例？如何修复以合并这两个图例？
- en: '[PRE33]'
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Create the two following stacked bar plots. Which question can you answer with
    the first one? Which question can you answer with the second one?
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建以下两个堆积条形图。第一个可以回答哪个问题？第二个可以回答哪个问题？
- en: '[PRE34]'
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Saving Your Plots
  id: totrans-189
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 保存你的图
- en: 'Once you’ve made a plot, you might want to get it out of R by saving it as
    an image that you can use elsewhere. That’s the job of [`ggsave()`](https://ggplot2.tidyverse.org/reference/ggsave.xhtml),
    which will save the plot most recently created to disk:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你绘制了图，你可能想通过将其保存为可以在其他地方使用的图像来将其导出R。这就是[`ggsave()`](https://ggplot2.tidyverse.org/reference/ggsave.xhtml)的工作方式，它将最近创建的图保存到磁盘上：
- en: '[PRE35]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: This will save your plot to your working directory, a concept you’ll learn more
    about in [Chapter 6](ch06.xhtml#chp-workflow-scripts).
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 这将把你的图保存到你的工作目录中，关于这个概念，你将在[第6章](ch06.xhtml#chp-workflow-scripts)中学到更多。
- en: If you don’t specify the `width` and `height`, they will be taken from the dimensions
    of the current plotting device. For reproducible code, you’ll want to specify
    them. You can learn more about [`ggsave()`](https://ggplot2.tidyverse.org/reference/ggsave.xhtml)
    in the documentation.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你没有指定`width`和`height`，它们将从当前绘图设备的尺寸中取值。为了可重现的代码，你需要指定它们。你可以在文档中了解更多关于[`ggsave()`](https://ggplot2.tidyverse.org/reference/ggsave.xhtml)的信息。
- en: Generally, however, we recommend that you assemble your final reports using
    Quarto, a reproducible authoring system that allows you to interleave your code
    and your prose and automatically include your plots in your write-ups. You will
    learn more about Quarto in [Chapter 28](ch28.xhtml#chp-quarto).
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，我们推荐您使用 Quarto 来汇编最终报告，Quarto 是一个可复制的创作系统，允许您交替使用代码和散文，并自动将图表包含在您的写作中。您将在[第28章](ch28.xhtml#chp-quarto)更多地了解
    Quarto。
- en: Exercises
  id: totrans-195
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习
- en: Run the following lines of code. Which of the two plots is saved as `mpg-plot.png`?
    Why?
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下代码行。哪一个图表保存为`mpg-plot.png`？为什么？
- en: '[PRE36]'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: What do you need to change in the previous code to save the plot as a PDF instead
    of a PNG? How could you find out what types of image files would work in [`ggsave()`](https://ggplot2.tidyverse.org/reference/ggsave.xhtml)?
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在前面的代码中，您需要更改什么以将图表保存为 PDF 而不是 PNG？您如何找出[`ggsave()`](https://ggplot2.tidyverse.org/reference/ggsave.xhtml)支持哪些图像文件类型？
- en: Common Problems
  id: totrans-199
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 常见问题
- en: As you start to run R code, you’re likely to run into problems. Don’t worry—it
    happens to everyone. We have all been writing R code for years, but every day
    we still write code that doesn’t work on the first try!
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 当您开始运行 R 代码时，可能会遇到问题。别担心——这种情况发生在每个人身上。我们多年来一直在写 R 代码，但每天我们仍然会写出不起作用的代码！
- en: 'Start by carefully comparing the code that you’re running to the code in the
    book. R is extremely picky, and a misplaced character can make all the difference.
    Make sure that every `(` is matched with a `)` and every `"` is paired with another
    `"`. Sometimes you’ll run the code and nothing happens. Check the left side of
    your console: if it’s a `+`, it means that R doesn’t think you’ve typed a complete
    expression and it’s waiting for you to finish it. In this case, it’s usually easy
    to start from scratch again by pressing Escape to abort processing the current
    command.'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，仔细比较您运行的代码与书中的代码。R 非常挑剔，一个错位的字符可能导致截然不同的结果。确保每个`（`都与一个`）`匹配，每个`"`都与另一个`"`配对。有时您运行代码却什么也不发生。检查您控制台的左侧：如果出现`+`，这意味着
    R 认为您尚未输入完整的表达式，并且正在等待您完成它。在这种情况下，通过按下 Escape 键中止当前命令的处理，通常很容易重新开始。
- en: 'One common problem when creating ggplot2 graphics is to put the `+` in the
    wrong place: it has to come at the end of the line, not the start. In other words,
    make sure you haven’t accidentally written code like this:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 创建 ggplot2 图形时的一个常见问题是将`+`放错位置：它必须放在行末，而不是行首。换句话说，请确保您没有意外地编写类似以下代码：
- en: '[PRE37]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: If you’re still stuck, try the help. You can get help about any R function by
    running `?function_name` in the console or highlighting the function name and
    pressing F1 in RStudio. Don’t worry if the help doesn’t seem that helpful; instead,
    skip down to the examples and look for code that matches what you’re trying to
    do.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您仍然被卡住，请尝试获取帮助。您可以通过在控制台中运行`?function_name`或在 RStudio 中高亮显示函数名称并按下 F1 来获取有关任何
    R 函数的帮助。如果帮助似乎不太有用，请跳转到示例部分，并查找与您尝试完成的代码匹配的代码。
- en: 'If that doesn’t help, carefully read the error message. Sometimes the answer
    will be buried there! But when you’re new to R, even if the answer is in the error
    message, you might not yet know how to understand it. Another great tool is Google:
    try googling the error message, as it’s likely someone else has had the same problem
    and has gotten help online.'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这些方法都无效，请仔细阅读错误消息。有时答案可能隐藏在其中！但是，当您刚开始使用 R 时，即使答案在错误消息中，您可能还不知道如何理解它。另一个好的工具是
    Google：尝试搜索错误消息，因为很可能有人遇到过相同的问题并在线获得了帮助。
- en: Summary
  id: totrans-206
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: 'In this chapter, you’ve learned the basics of data visualization with ggplot2\.
    We started with the basic idea that underpins ggplot2: a visualization is a mapping
    from variables in your data to aesthetic properties such as position, color, size,
    and shape. You then learned about increasing the complexity and improving the
    presentation of your plots layer by layer. You also learned about commonly used
    plots for visualizing the distribution of a single variable, as well as for visualizing
    relationships between two or more variables, by levering additional aesthetic
    mappings and/or splitting your plot into small multiples using faceting.'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您已经学习了使用 ggplot2 进行数据可视化的基础知识。我们从支持 ggplot2 的基本思想开始：可视化是将数据中的变量映射到美学属性（如位置、颜色、大小和形状）的过程。然后，您学习了通过逐层添加图层来增加复杂性和改善图表的展示。您还了解了用于可视化单个变量分布以及可视化两个或多个变量之间关系的常用图表，通过额外的美学映射和/或将图表分割成小多个部分进行绘制。
- en: We’ll use visualizations again and again throughout this book, introducing new
    techniques as we need them, as well as do a deeper dive into creating visualizations
    with ggplot2 in [Chapter 9](ch09.xhtml#chp-layers) through [Chapter 11](ch11.xhtml#chp-communication).
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在整本书中反复使用可视化技术，根据需要引入新技术，并在[第9章](ch09.xhtml#chp-layers)到[第11章](ch11.xhtml#chp-communication)深入探讨使用
    ggplot2 创建可视化图表。
- en: Now that you understand the basics of visualization, in the next chapter we’re
    going to switch gears a little and give you some practical workflow advice. We
    intersperse workflow advice with data science tools throughout this part of the
    book because it’ll help you stay organized as you write increasing amounts of
    R code.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经了解了可视化的基础知识，接下来的章节我们将转变一下思路，给你一些实用的工作流建议。我们在本书的这一部分穿插工作流建议和数据科学工具，因为这将帮助你在编写越来越多的
    R 代码时保持组织有序。
- en: ^([1](ch01.xhtml#idm44771333724368-marker)) You can eliminate that message and
    force conflict resolution to happen on demand by using the conflicted package,
    which becomes more important as you load more packages. You can learn more about
    conflicted on the [package website](https://oreil.ly/01bKz).
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](ch01.xhtml#idm44771333724368-marker)) 你可以通过使用 conflicted 包来消除该消息，并在需要时强制解决冲突。随着加载更多的包，使用
    conflicted 包变得更为重要。你可以在[包网站](https://oreil.ly/01bKz)上了解更多有关 conflicted 的信息。
- en: '^([2](ch01.xhtml#idm44771333851472-marker)) Horst AM, Hill AP, Gorman KB (2020).
    palmerpenguins: Palmer Archipelago (Antarctica) penguin data. R package version
    0.1.0\. [*https://oreil.ly/ncwc5*](https://oreil.ly/ncwc5). doi: 10.5281/zenodo.3960218.'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: '^([2](ch01.xhtml#idm44771333851472-marker)) Horst AM, Hill AP, Gorman KB (2020).
    palmerpenguins：帕尔默群岛（南极洲）企鹅数据。R包版本 0.1.0。[*https://oreil.ly/ncwc5*](https://oreil.ly/ncwc5)。doi:
    10.5281/zenodo.3960218。'
- en: ^([3](ch01.xhtml#idm44771330671200-marker)) Here “formula” is the name of the
    thing created by `~`, not a synonym for “equation.”
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: ^([3](ch01.xhtml#idm44771330671200-marker)) 这里，“formula”是由`~`创建的对象名称，而不是“equation”的同义词。
