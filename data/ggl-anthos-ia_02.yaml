- en: 2 One single pane of glass
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2 一个单一视角
- en: Melika Golkaram
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Melika Golkaram
- en: This chapter covers
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: The advantages of having a single pane of glass and its components
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拥有一个单一视角及其组件的优势
- en: How different personas can use and benefit from these components
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不同角色如何使用和从这些组件中获益
- en: Getting some hands-on experience configuring the UI and attaching a cluster
    to the Anthos UI
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取一些实际经验来配置UI并将集群连接到Anthos UI
- en: We live in a world where application performance is critical for success. To
    better serve their end users, many organizations have pushed to distribute their
    workloads from centralized data centers. Whether to be closer to their users,
    to enhance disaster recovery, or to take advantage of the benefits of cloud computing,
    this distribution has placed additional pressure on the tooling used to manage
    and support this strategy. The tools that have flourished under this new paradigm
    are those that have matured and become more sophisticated and scalable.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 我们生活在一个应用性能对成功至关重要的世界中。为了更好地服务其最终用户，许多组织已经推动将他们的工作负载从集中的数据中心分散出去。无论是为了更接近用户、增强灾难恢复还是利用云计算的好处，这种分散都给用于管理和支持这一策略的工具带来了额外的压力。在这种新范式下繁荣的工具是那些已经成熟、变得更加复杂和可扩展的工具。
- en: There is no one-size-fits-all tool. Likewise, no one person can manage the infrastructure
    of even a small organization. All applications require tools to manage CI/CD,
    monitoring, logging, orchestration, deployments, storage, authentication/ authorization,
    and more. In addition to the scalability and sophistication mentioned earlier,
    most of the tools in this space offer an informative and user-friendly graphical
    user interface (GUI). Having an easily understood GUI can help people use the
    tool more effectively because it lowers the bar for learning the software and
    increases the amount of pertinent output the user receives.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 没有一劳永逸的工具。同样，也没有哪个人能够管理甚至一个小型组织的整个基础设施。所有应用程序都需要工具来管理持续集成/持续部署（CI/CD）、监控、日志记录、编排、部署、存储、身份验证/授权等。除了前面提到的可扩展性和复杂性之外，这个领域的大多数工具还提供了一个信息丰富且用户友好的图形用户界面（GUI）。拥有一个易于理解的GUI可以帮助人们更有效地使用工具，因为它降低了学习软件的门槛，并增加了用户收到的相关信息量。
- en: Anthos itself has the capacity to support hundreds of applications and thousands
    of services, so a high-quality GUI and a consolidated user experience are required
    to use the ecosystem to its full potential and reduce the operational overhead.
    To this end, Google Cloud Platform offers a rich set of dashboards and integrated
    tools within the Google Cloud console to help you monitor, troubleshoot, and interact
    with your deployed Anthos clusters, regardless of their location or infrastructure
    provider. This single pane of glass allows administrators, operations professionals,
    developers, and business owners to view the status of their clusters and application
    workloads, all while benefiting from the capabilities of Google Cloud’s Identity
    and Access Management (IAM) framework and any additional security provided on
    each cluster.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos本身具有支持数百个应用程序和数千个服务的容量，因此需要一个高质量的GUI和统一的用户体验，以充分利用生态系统并降低运营成本。为此，Google
    Cloud Platform在Google Cloud控制台中提供了一套丰富的仪表板和集成工具，以帮助您监控、故障排除和与部署的Anthos集群交互，无论其位置或基础设施提供商如何。这个单一视角允许管理员、运维专业人员、开发人员和业务所有者查看其集群和应用工作负载的状态，同时受益于Google
    Cloud的标识和访问管理（IAM）框架以及每个集群提供的任何附加安全措施。
- en: The Anthos GUI, its “single pane of glass,” is not the first product to attempt
    to centralize the visibility and operations of a fleet of clusters, but it is
    the one that offers support to provide real-time visibility to a large variety
    of environments. To fully understand the benefits of the Anthos GUI, in this chapter,
    we are going to look at some of the options available to aggregate and standardize
    interactions with multiple Kubernetes clusters.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos GUI及其“单一视角”并不是第一个尝试集中管理集群舰队可见性和操作的产品，但它提供了对大量不同环境提供实时可见性的支持。为了全面了解Anthos
    GUI的好处，在本章中，我们将探讨一些可用于聚合和标准化与多个Kubernetes集群交互的选项。
- en: 2.1 Single pane of glass
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.1 单一视角
- en: 'A single pane of glass offers the following three characteristics that are
    shared across all operators, industries, and operations scales:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 单一视角提供了以下三个在所有操作员、行业和操作规模中共享的特征：
- en: '*Centralization*—As the name suggests, a single pane of glass should provide
    a central UI for resources, no matter where they run and to whom they are provided.
    The former aspect relates to the infrastructure and cloud provider on which the
    clusters are operating and the latter relates to inherently multitenant services,
    where one operator centrally manages multiple clients’ clusters and workloads.
    With the benefits of a central dashboard, admins will be able to get a high-level
    view of resources and drill down to areas of interest without switching the view.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*集中化*——正如其名所示，单视图应该为资源提供一个中心UI，无论它们在哪里运行以及提供给谁。前者与集群运行的底层基础设施和云提供商相关，后者与本质上多租户服务相关，其中一位操作员集中管理多个客户的集群和工作负载。利用中心仪表板的优点，管理员将能够获得资源的高级视图，并深入到感兴趣的领域，而无需切换视图。'
- en: However, a central environment might cause some concern in areas of privacy
    and security. Not every administrator is required to connect to all clusters,
    and not all admins should be able to have access to the UI. A central environment
    should come with its own safeguards to avoid any operational compromise with industry
    standards.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 然而，中心环境可能会在隐私和安全领域引起一些担忧。并非每个管理员都需要连接到所有集群，并且并非所有管理员都应该能够访问UI。中心环境应附带其自身的安全措施，以避免与行业标准有任何操作上的妥协。
- en: '*Consistency*—Let’s go back to the scenario of an operator running clusters
    and customers in multicloud or hybrid architectures. Most infrastructure providers,
    whether they offer proprietary services or run on open source, attempt to offer
    a solid interface for their users. However, they use different terminology and
    have inconsistent views on priorities. Finally, depending on their UI philosophy
    and approach, they design the view and navigation differently. Remember, for a
    cloud provider, cluster and container management are only parts of the bigger
    suite of services and components of a predesigned dashboard. Although this might
    be a positive element in single operating environments (you can learn to navigate
    outside of the Kubernetes dashboard into the rest of the Cloud Services dashboard
    with minimum switching), it becomes a headache in multienvironment services and
    for those who focus only on Kubernetes.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*一致性*——让我们回到一个操作员在多云或混合架构中运行集群和客户的场景。大多数基础设施提供商，无论是提供专有服务还是基于开源，都试图为用户提供一个稳定的界面。然而，他们使用不同的术语，对优先级的看法也不一致。最后，根据他们的UI哲学和方法，他们设计视图和导航的方式也不同。记住，对于云提供商来说，集群和容器管理只是更大服务套件和预设计仪表板组件的一部分。虽然这可能在单一操作环境中是一个积极的因素（你可以在Kubernetes仪表板之外学习导航到其他云服务仪表板，而无需进行最小切换），但在多环境服务和仅关注Kubernetes的人看来，这会变成一个头疼的问题。'
- en: '*Ease of use*—Part of the appeal of a single pane of glass in operation is
    how data coming from different sources is aggregated, normalized, and visualized.
    This brings a lot of simplicity in drilling down into performance management and
    triage, especially if it combines a graphical interface with it.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*易用性*——操作中单视图的吸引力之一在于来自不同来源的数据是如何聚合、规范化和可视化的。这为深入性能管理和分类提供了很多简便性，尤其是如果它结合了图形界面的话。'
- en: A graphical UI has always been an important part of any online application.
    First, at some point in an app management cycle, a team doesn’t have either the
    skills or the interest for working with remote calls. They expect a robust, easy-to-navigate,
    and a highly device-agnostic UI for their day-to-day responsibilities.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 图形用户界面一直是任何在线应用的重要组成部分。首先，在应用管理周期中的某个时刻，团队可能既没有与远程调用工作的技能，也没有兴趣。他们期望有一个强大、易于导航且高度设备无关的UI来处理日常职责。
- en: Second, regardless of the team’s skill sets, an aggregated dashboard has so
    much more to offer in one concentrated view than calling service providers and
    perhaps clusters individually given that the UI provides lots of data fields with
    the right installation and readability.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，无论团队的技术能力如何，一个聚合的仪表板在一个集中的视图中提供的功能远比逐个调用服务提供商和集群要多，因为UI提供了许多具有正确安装和可读性的数据字段。
- en: 2.2 Non-Anthos visibility and interaction
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.2 非Anthos可见性和交互
- en: Anthos is not the first solution to expose information about a Kubernetes cluster
    through a more easily digested form than the built-in APIs. Although many developers
    and operators have used the command-line interface (CLI), kubectl, to interact
    with a cluster, the information presented can be very technical and does not usually
    display potential problems in a friendly way. Extensions to Kubernetes, such as
    Istio or Anthos Config Management, typically come with their own CLIs as well
    (istioctl and nomos, for example). Cross-referencing information between all the
    disparate tools can be a substantial exercise, even for the most experienced developer
    or operator.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos 并非第一个通过比内置 API 更易于消化的形式来暴露 Kubernetes 集群信息的解决方案。尽管许多开发者和运维人员已经使用命令行界面
    (CLI) kubectl 与集群交互，但呈现的信息可能非常技术性，并且通常不会以友好的方式显示潜在问题。Kubernetes 的扩展，如 Istio 或
    Anthos Config Management，通常也附带自己的 CLI（例如 istioctl 和 nomos）。在所有不同的工具之间交叉引用信息可能是一项艰巨的任务，即使是经验最丰富的开发人员或运维人员也是如此。
- en: 2.2.1 Kubernetes Dashboard
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.2.1 Kubernetes 仪表板
- en: One of the first tools developed to solve this problem was the Kubernetes Dashboard
    ([https://github.com/kubernetes/dashboard](https://github.com/kubernetes/dashboard)).
    Although this utility is not deployed by default on new Kubernetes clusters, it
    is easy to deploy to the cluster and begin using the information it provides.
    In addition to providing a holistic view of most of the components of a Kubernetes
    cluster, the dashboard also provides users with a GUI interface to deploy new
    workloads into the cluster. This makes the dashboard a convenient and quick way
    to view the status and interact with a new cluster.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 解决此问题最早开发的工具之一是 Kubernetes 仪表板 ([https://github.com/kubernetes/dashboard](https://github.com/kubernetes/dashboard))。尽管这个实用程序默认情况下不会部署到新的
    Kubernetes 集群，但它很容易部署到集群并开始使用它提供的信息。除了提供对 Kubernetes 集群大多数组件的整体视图外，仪表板还向用户提供了一个图形用户界面来将新工作负载部署到集群中。这使得仪表板成为查看状态和与新的集群交互的便捷且快速的方式。
- en: However, it works on only one cluster. You can certainly deploy the Kubernetes
    Dashboard to each of your clusters, but they will remain independent of each other
    and have no cross-connection. In addition, because the dashboard is located on
    the cluster itself, accessing it remotely requires a level of effort similar to
    using the CLI tool, requiring services, load balancing, and ingress rules to properly
    route and validate incoming traffic. Although the dashboard can be powerful for
    proof of concept or small developer clusters, multiuser clusters need a more powerful
    tool.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，它只适用于一个集群。你当然可以将 Kubernetes 仪表板部署到每个集群中，但它们将保持相互独立，没有交叉连接。此外，由于仪表板位于集群本身上，远程访问它需要与使用
    CLI 工具相似的努力，需要服务、负载均衡和入口规则来正确路由和验证传入流量。尽管仪表板对于概念验证或小型开发者集群来说可能非常强大，但多用户集群需要更强大的工具。
- en: 2.2.2 Provider-specific UIs
  id: totrans-23
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.2.2 提供商特定的 UI
- en: Kubernetes was released from the beginning as an open source project. Though
    based on internal Google tools, the structure of Kubernetes allowed vendors and
    other cloud providers to easily create their own customized versions of Kubernetes,
    either to simplify deployment or management on their platforms or to add additional
    features. Many of these adaptations have customized UIs for either deployment
    or management operations.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: Kubernetes 从一开始就是一个开源项目。尽管基于 Google 内部工具，但 Kubernetes 的结构允许供应商和其他云服务提供商轻松创建他们自己的定制版本，无论是为了简化平台上的部署或管理，还是为了添加额外的功能。许多这些修改都为部署或管理操作定制了
    UI。
- en: For cloud providers, many of the user interfaces for their other products already
    existed and followed a particular style. Each provider developed a different UI
    for their version of Kubernetes. Although a portion of these UIs dealt with provisioning
    and maintaining the infrastructure of a cluster, some of each UI was dedicated
    to cluster operations and manipulation. However, each UI was implemented differently
    and couldn’t manage clusters other than the native Kubernetes flavor for that
    cloud provider.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 对于云服务提供商来说，他们其他产品的许多用户界面已经存在，并遵循特定的风格。每个提供商都为其版本的 Kubernetes 开发了不同的 UI。尽管这些
    UI 中有一部分处理集群的基础设施配置和维护，但每个 UI 中都有一些是专门用于集群操作和管理的。然而，每个 UI 的实现方式都不同，无法管理除该云提供商原生
    Kubernetes 风味以外的集群。
- en: 2.2.3 Bespoke software
  id: totrans-26
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.2.3 定制软件
- en: 'Some companies have decided to push the boundaries and develop their own custom
    software and UIs to visualize and manage their Kubernetes installations and operations.
    Though always an option due to the open standards of the Kubernetes APIs, any
    bespoke development brings all the associated challenges that come with maintaining
    any custom operations software: maintaining the software for new versions, bug
    fixing, handling OS and package upgrades, and so on. For the highest degree of
    customization, nothing beats bespoke software, but the cost-versus-benefit calculation
    does not work out for most companies.'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 一些公司决定突破界限，开发自己的定制软件和 UI 来可视化和管理他们的 Kubernetes 安装和操作。尽管由于 Kubernetes API 的开放标准，这始终是一个选项，但任何定制开发都会带来维护任何定制操作软件所伴随的所有挑战：维护软件的新版本、修复错误、处理操作系统和软件包升级等等。对于最高程度的定制，没有比定制软件更好的选择，但对于大多数公司来说，成本与收益的计算并不划算。
- en: 2.3 The Anthos UI
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.3 Anthos UI
- en: Each of the previous solutions has a fundamental flaw that prevents most companies
    from fully benefiting from it. The Kubernetes Dashboard has no multicluster capability
    and does not handle remote access easily. The provider-specific UIs work well
    for their flavor but cannot handle clusters that are not on their network or running
    their version of Kubernetes. And bespoke software comes with a high cost of development
    and maintenance. This is where the Anthos multicluster single pane of glass comes
    into play. This single pane of glass is an extension of, and embedded in, Google
    Cloud Platform’s already extensive Cloud console that allows users to view, monitor,
    and manage their entire cloud infrastructure and workloads.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 之前每种解决方案都有一个基本缺陷，阻止了大多数公司充分利用它。Kubernetes 仪表板没有多集群功能，且难以处理远程访问。供应商特定的 UI 对于其特定版本工作良好，但不能处理不在其网络或运行其版本
    Kubernetes 的集群。而定制软件的开发和维护成本很高。这就是 Anthos 多集群单视图仪表板发挥作用的地方。这个单视图仪表板是 Google Cloud
    Platform 已广泛使用的云控制台的扩展和嵌入，允许用户查看、监控和管理他们整个云基础设施和工作负载。
- en: The solution Google has developed for multicluster visibility in Anthos depends
    on a new concept called *fleets* (formerly referred to as *environs*), the Connect
    framework, and the Anthos dashboard. The Anthos dashboard is an enhancement of
    the existing GKE dashboard that Google has provided for several years for its
    in-cloud GKE clusters. The Connect framework is new with Anthos and simplifies
    the communication process between Google Cloud and clusters located anywhere in
    the world. Fleets are methods of aggregating clusters to simplify common work
    between them. Let’s take a moment to discuss a bit more about fleets.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 谷歌为 Anthos 中的多集群可见性开发的解决方案依赖于一个名为 *fleets*（之前被称为 *environs*）的新概念，Connect 框架以及
    Anthos 仪表板。Anthos 仪表板是谷歌为其已经提供多年的、针对其云中 GKE 集群的现有 GKE 仪表板的增强。Connect 框架是 Anthos
    的新特性，简化了 Google Cloud 与世界各地集群之间的通信过程。Fleets 是一种聚合集群的方法，以简化它们之间的常见工作。让我们花点时间来更深入地讨论一下
    Fleets。
- en: 2.3.1 Fleets
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.3.1 Fleets
- en: Fleets are a Google Cloud concept for logically organizing clusters and other
    resources, letting you use and manage multicluster capabilities and apply consistent
    policies across your systems. Think of them as a grouping mechanism that applies
    several security and operation boundaries to resources within a single project.[¹](#pgfId-1063266)
    They help administrators build a one-to-many relationship between a fleet and
    its member clusters and resources to reduce the configuration burden of individual
    security and access rules. The clusters in a fleet also exist in a higher trust
    relationship with each other by belonging to the same fleet. This makes it easier
    to manage traffic into and between the clusters and join their service meshes
    together.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: Fleets 是谷歌用于逻辑组织集群和其他资源的一个云概念，让您可以使用和管理多集群功能，并在您的系统中应用一致的政策。把它们想象成一个分组机制，它为单个项目内的资源应用了多个安全和操作边界。[¹](#pgfId-1063266)
    它们帮助管理员在 fleet 和其成员集群及资源之间建立一对一的关系，以减少单个安全性和访问规则的配置负担。属于同一 fleet 的集群之间也存在更高的信任关系。这使得管理集群之间的流量以及将它们的服务网格连接起来变得更加容易。
- en: An Anthos cluster will belong to one and only one fleet and cannot join another
    without leaving the first. Unfortunately, this limitation can present a small
    problem in complex service communications. For example, assume we have an API
    service and a Data Processing service that need to run in distinct fleets for
    security reasons, but both need to talk to a bespoke Permissioning service. The
    Permissioning service can be placed in one of the two fleets, but whichever service
    does not belong to Permissioning’s fleet will need to talk to the service using
    outside-the-cluster networking. However, this rule for fleets prevents users from
    accidentally merging clusters that must remain separate, because allowing the
    common service to exist in both fleets simultaneously would open additional attack
    vectors (see figure 2.1).
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 一个 Anthos 集群将只属于一个且仅属于一个舰队，并且不能在不离开第一个舰队的情况下加入另一个舰队。不幸的是，这种限制在复杂的服务通信中可能会带来一些小问题。例如，假设我们有一个
    API 服务和一个数据处理服务，由于安全原因，它们需要运行在不同的舰队中，但两者都需要与一个定制的权限服务进行通信。权限服务可以放置在两个舰队中的任何一个，但任何不属于权限服务舰队的服务都需要通过集群外部的网络与该服务进行通信。然而，这个关于舰队的规则阻止了用户意外地将必须保持分离的集群合并，因为允许通用服务同时存在于两个舰队中会打开额外的攻击向量（见图
    2.1）。
- en: '![02-01](../../OEBPS/Images/02-01.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![02-01](../../OEBPS/Images/02-01.png)'
- en: Figure 2.1 Example of fleet merging causing security problems
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.1 舰队合并导致的安全问题示例
- en: When multiple clusters are in the same fleet, many types of resources must have
    unique names, or they will be treated as the same resource. This obviously includes
    the clusters themselves but also covers namespaces, services, and identities.
    Anthos refers to this as *sameness*. Sameness forces consistent ownership across
    all clusters within a fleet, and namespaces that are defined on one cluster, but
    not on another, will be reserved implicitly.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 当多个集群位于同一舰队中时，许多类型的资源必须具有唯一的名称，否则它们将被视为相同的资源。这显然包括集群本身，但也包括命名空间、服务和标识。Anthos
    将其称为“相同性”。相同性强制在舰队中的所有集群之间保持一致的所有权，并且在一个集群上定义但在另一个集群上未定义的命名空间将被隐式保留。
- en: When designing the architecture of your services, this sameness concept must
    be kept in mind. Anthos Service Mesh, for example, typically treats a service
    that exists in the same namespace with the same name as an identical service across
    the entire fleet and load balances traffic between clusters automatically. If
    the namespace and/or service in question has a unique name, this should not cause
    any confusion. However, accessing the Webserver service in the Demo namespace
    might yield unexpected results.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在设计您服务的架构时，必须牢记这个相同的概念。例如，Anthos 服务网格通常将同一命名空间中具有相同名称的服务视为整个舰队中的相同服务，并自动在集群之间进行流量负载均衡。如果所涉及的命名空间和/或服务具有唯一名称，这不应引起任何混淆。然而，访问
    Demo 命名空间中的 Webserver 服务可能会产生意外的结果。
- en: Finally, Anthos allows all services to use a common identity when accessing
    external resources such as Google Cloud services, object stores, and so on. This
    common identity makes it possible to give the services within a fleet access to
    an external resource once, rather than cluster by cluster. Although this can be
    overridden and multiple identities defined, if resources are not architected carefully
    and configured properly, negative outcomes can occur.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，Anthos 允许所有服务在访问外部资源，如 Google Cloud 服务、对象存储等时使用一个共同的标识。这个共同的标识使得在舰队内部的服务一次访问外部资源成为可能，而不是每个集群分别访问。尽管这可以被覆盖并且可以定义多个标识，但如果资源没有精心设计和正确配置，可能会出现负面结果。
- en: '2.3.2 Connect: How does it work?'
  id: totrans-39
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.3.2 连接：它是如何工作的？
- en: Now that we have discussed fleets, we need to examine how the individual clusters
    communicate with Google Cloud. Any cluster that is part of Anthos, whether attached[²](#pgfId-1063287)
    or Anthos managed, has Connect deployed to the cluster as part of the installation
    or registration process. This deployment establishes a persistent connection from
    the cluster outbound to Google Cloud that accepts traffic from the cloud and provides
    cloud-side operations secure access to the cluster. Because the initial connection
    is outbound, it does not rely on a fully routable connection from the cloud to
    the cluster. This setup greatly reduces the security considerations and does not
    require the cluster to be discoverable on the public internet.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经讨论了舰队，我们需要检查各个集群如何与 Google Cloud 进行通信。任何作为 Anthos 部分的一部分的集群，无论是附加[²](#pgfId-1063287)
    还是 Anthos 管理的，都会在安装或注册过程中将 Connect 部署到集群。这种部署从集群到 Google Cloud 建立了一个持久的连接，该连接接受来自云的流量并为集群提供云侧操作的安全访问。由于初始连接是外出的，它不依赖于从云到集群的完全可路由连接。这种设置大大减少了安全考虑，并且不需要集群在公共互联网上被发现。
- en: Once the persistent connection is established, Anthos can proxy requests made
    by Google Cloud services or users using the Google Cloud UI to the cluster, whether
    it is located within Google Cloud, in another cloud provider, at the edge, or
    on-prem. These requests use the user’s or the service’s credentials, maintaining
    the security on the cluster and allowing the existing role-based access controls
    (RBAC)[³](#pgfId-1063294) rules to span direct connectivity as well as connections
    through the proxy. A request using the Anthos UI may look like figure 2.2.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦建立了持久连接，Anthos 可以代理 Google Cloud 服务或用户通过 Google Cloud UI 向集群发起的请求，无论该集群位于
    Google Cloud 内部、其他云服务提供商、边缘或本地。这些请求使用用户或服务的凭证，保持集群的安全性，并允许现有的基于角色的访问控制（RBAC）[³](#pgfId-1063294)
    规则跨越直接连接以及通过代理的连接。使用 Anthos UI 的请求可能看起来像图 2.2。
- en: '![02-02](../../OEBPS/Images/02-02.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![02-02](../../OEBPS/Images/02-02.png)'
- en: Figure 2.2 Flow of request and response from Google Cloud to cluster and back
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.2 从 Google Cloud 到集群及返回的请求和响应流程
- en: While the tunnel from the Connect Agent to Google Cloud is persistent, each
    stage of each request is authenticated using various mechanisms to validate the
    identity of the requestor and confirm that layer is allowed to make the request.
    Skipping layers is not permitted and will be rejected by the next layer receiving
    the invalid request. An overview of the request-response authentication is seen
    in figure 2.3.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管从 Connect 代理到 Google Cloud 的隧道是持久的，但每个请求的每个阶段都使用各种机制进行身份验证，以验证请求者的身份并确认该层是否允许发起请求。跳过层是不允许的，并且无效请求将被接收下一层的层拒绝。请求-响应身份验证的概述可见于图
    2.3。
- en: '![02-03](../../OEBPS/Images/02-03.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![02-03](../../OEBPS/Images/02-03.png)'
- en: Figure 2.3 Request validation steps from Google Cloud to cluster
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.3 从 Google Cloud 到集群的请求验证步骤
- en: Regardless of any authorization measures at the cluster level, a user must still
    be allowed to view the Google Cloud project to which the cluster is attached to
    use the Connect functionality. This method uses the standard IAM processes for
    a given project, but having the separate permission allows the security team to
    grant a user access to a cluster through a direct connection (or some other tunnel)
    but not allow them remote access via Google Cloud.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 无论集群级别的任何授权措施如何，用户仍然必须允许查看集群附加的 Google Cloud 项目，以使用 Connect 功能。此方法使用给定项目的标准
    IAM 流程，但拥有单独的权限允许安全团队通过直接连接（或某些其他隧道）授予用户对集群的访问权限，但不允许他们通过 Google Cloud 进行远程访问。
- en: 'Connect is compliant with Google’s Access Transparency,[⁴](#pgfId-1063311)
    which provides transparency to the customer in the following two areas:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: Connect 符合 Google 的访问透明度[⁴](#pgfId-1063311)，在以下两个领域为顾客提供透明度：
- en: '*Access approval*—Customers can authorize Google support staff to work on certain
    parts of their services. Customers can view the reasons a Google employee might
    need that access.'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*访问批准*—客户可以授权 Google 支持人员对其服务的一部分进行工作。客户可以查看 Google 员工可能需要该访问的原因。'
- en: '*Activity visibility*—Customers can import access logs into their project cloud
    logging to have visibility into Google employees’ actions and location and can
    query the logs in real time, if necessary.'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*活动可见性*—客户可以将访问日志导入其项目云日志中，以了解 Google 员工的操作和位置，并在必要时实时查询日志。'
- en: 2.3.3 Installation and registration
  id: totrans-51
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.3.3 安装和注册
- en: To use the Connect functionality, we obviously need to install the Connect Agent
    on our cluster. We also need to inform Google about our cluster and determine
    which project, and, therefore, which fleets, the cluster belongs to. Fortunately,
    Google has provided a streamlined utility for performing this task via the gcloud
    command-line tool (see [http://mng.bz/Op72](http://mng.bz/Op72)). This process
    uses either Workload Identity or a Google Cloud service account to enroll the
    cluster with the project’s Connect pool and install and start the Connect Agent
    on the cluster.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用Connect功能，我们显然需要在我们的集群上安装Connect代理。我们还需要通知谷歌我们的集群属于哪个项目，以及因此属于哪个舰队。幸运的是，谷歌已经通过gcloud命令行工具提供了一种简化的实用程序来完成此任务（见[http://mng.bz/Op72](http://mng.bz/Op72)）。此过程使用工作负载身份或谷歌云服务账户将集群注册到项目的Connect池，并在集群上安装和启动Connect代理。
- en: Though these steps enroll the cluster with Google and enable most Anthos features,
    you still need to authenticate with the cluster from the Google Console to view
    and interact with the cluster from Google Cloud. Connect allows authentication
    via Cloud identity (when using the Connect gateway),[⁵](#pgfId-1063328) bearer
    token, or OIDC, if enabled on the cluster. The easiest, and recommended, method
    is to use Cloud Identity, but this requires the activation and configuration of
    the Connect Gateway for the cluster. For more information on Connect Gateway,
    please see chapter 5 on operations management with Anthos.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这些步骤将集群注册到谷歌并启用了大多数Anthos功能，但您仍然需要从谷歌控制台对集群进行身份验证，才能从谷歌云中查看和交互集群。Connect允许通过云身份（当使用Connect网关时）、[⁵](#pgfId-1063328)载体令牌或如果集群上启用了OIDC进行身份验证。最简单且推荐的方法是使用云身份，但这需要为集群激活和配置Connect网关。有关Connect网关的更多信息，请参阅第5章关于Anthos的操作管理。
- en: 2.4 The Anthos Cloud UI
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.4 Anthos云UI
- en: Now that we’ve done the plumbing, we can walk through and show off the UI. Google
    provides the Anthos UI via the Cloud console at the project level. Because the
    Anthos UI is visible only at the project level, only clusters registered to that
    project’s fleets are visible. The Anthos UI menu contains multiple subpages, each
    focusing on a distinct aspect of cluster management. At the time of writing, these
    sections are the Dashboard, Service Mesh, Config Management, Clusters, Features,
    Migrate to Containers, Security, Cloud Run for Anthos, and Virtual Machines. Let’s
    look at each of these pages.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成了管道安装，我们可以走一遍并展示UI界面。谷歌通过项目级别的云控制台提供Anthos UI。由于Anthos UI仅在项目级别可见，因此只有注册到该项目舰队中的集群是可见的。Anthos
    UI菜单包含多个子页面，每个页面都专注于集群管理的不同方面。在撰写本文时，这些部分包括仪表板、服务网格、配置管理、集群、功能、迁移到容器、安全、Anthos的云运行和虚拟机。让我们逐一查看这些页面。
- en: 2.4.1 The Anthos dashboard
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.4.1 Anthos仪表板
- en: The default page for the Anthos menu, and the central hub for the UI, is the
    dashboard. The dashboard is intended to give admins a wide-angle view of the clusters
    in the current fleet, while making it easy to drill down into details for the
    specific components. To start, go to the hamburger menu on the top-left corner
    of the console (figure 2.4). Select Anthos from the menu to enter the Anthos Features
    page.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos菜单的默认页面，以及UI的中心枢纽是仪表板。仪表板旨在让管理员对当前舰队中的集群有一个宽视角，同时便于深入到特定组件的细节。首先，前往控制台左上角的三明治菜单（图2.4）。从菜单中选择Anthos以进入Anthos功能页面。
- en: '![02-04](../../OEBPS/Images/02-04.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![02-04](../../OEBPS/Images/02-04.png)'
- en: Figure 2.4 Navigation to the Anthos dashboard
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.4导航到Anthos仪表板
- en: Figure 2.5 shows an example of the Anthos dashboard view.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.5显示了Anthos仪表板视图的示例。
- en: '![02-05](../../OEBPS/Images/02-05.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![02-05](../../OEBPS/Images/02-05.png)'
- en: Figure 2.5 Example of an Anthos dashboard
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.5 Anthos仪表板示例
- en: Although this example shows the current Anthos project cost, the dashboard still
    uses Google’s IAM, and that information will appear only if the viewing user has
    the appropriate billing-related permissions. The remaining sections highlight
    critical errors or other user-involved problems for that aspect of Anthos. Following
    those links takes you to the appropriate subpage.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这个示例显示了当前的Anthos项目成本，但仪表板仍然使用谷歌的IAM，并且只有查看用户具有适当的计费相关权限时，该信息才会出现。其余部分突出了Anthos该方面的关键错误或其他用户参与的问题。点击这些链接将带您到相应的子页面。
- en: 2.4.2 Service Mesh
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.4.2 服务网格
- en: The Service Mesh page shows all services registered in any of the clusters in
    the current fleet. The initial list shows the names, namespaces, and clusters
    of each service, as well as basic metrics, such as error rate and latency, at
    predefined thresholds. You can also filter this list by namespace, cluster name,
    requests per second, error rate, latency, request size, and resource usage to
    allow admins to easily drill down for specific tasks. Figure 2.6 shows the Service
    Mesh screen filtered for services in the default namespace.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 服务网格页面显示了当前舰队中任何集群中注册的所有服务。初始列表显示了每个服务的名称、命名空间和集群，以及预定义阈值下的基本指标，如错误率和延迟。您还可以通过命名空间、集群名称、每秒请求数、错误率、延迟、请求大小和资源使用情况来过滤此列表，以便管理员可以轻松地深入特定任务。图2.6显示了针对默认命名空间中的服务进行过滤的服务网格屏幕。
- en: '![02-06](../../OEBPS/Images/02-06.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![02-06](../../OEBPS/Images/02-06.png)'
- en: Figure 2.6 Service Mesh UI with filters
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.6 带有过滤器的服务网格UI
- en: 2.4.3 Config Management
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.4.3 配置管理
- en: Anthos Config Management, explored in depth in chapter 11, is Anthos’s method
    of automatically adding and maintaining resources on a Kubernetes cluster. These
    resources can include most common Kubernetes core objects (such as Pods, Services,
    and Service Accounts) as well as custom entities such as policies and cloud-configuration
    objects. This tab displays the list of all clusters in the current fleet, their
    sync status, and which revision is currently enforced on the cluster (figure 2.7).
    The table also shows whether Policy Controller[⁶](#pgfId-1063382) has been enabled
    for the cluster.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在第11章中深入探讨的Anthos Config Management是Anthos在Kubernetes集群上自动添加和维护资源的方法。这些资源可以包括大多数常见的Kubernetes核心对象（如Pods、Services和Service
    Accounts）以及自定义实体，如策略和云配置对象。此选项卡显示了当前舰队中所有集群的列表、它们的同步状态以及当前在集群上强制执行的修订版本（图2.7）。表格还显示是否已为集群启用了策略控制器[⁶](#pgfId-1063382)。
- en: '![02-07](../../OEBPS/Images/02-07.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![02-07](../../OEBPS/Images/02-07.png)'
- en: Figure 2.7 Clusters in Config Management view
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.7 配置管理视图中的集群
- en: Selecting a specific cluster opens the Config Management cluster detail, as
    shown in figure 2.8\. This detailed view gives further information about the configuration
    settings, including the location of the repo used, the cycle for syncing, and
    the version of ACM running on the cluster.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 选择特定的集群将打开配置管理集群详细视图，如图2.8所示。此详细视图提供了有关配置设置的更多信息，包括使用的仓库位置、同步周期以及集群上运行的ACM版本。
- en: '![02-08](../../OEBPS/Images/02-08.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![02-08](../../OEBPS/Images/02-08.png)'
- en: Figure 2.8 Cluster detail in Config Management view
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.8 配置管理视图中的集群详细
- en: 2.4.4 Clusters
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.4.4 集群
- en: 'The Clusters menu lists all clusters in the current fleet, along with the location,
    type, labels, and any warnings associated with each cluster, as shown in figure
    2.9\. By selecting a cluster in the list, a more detailed view of the cluster,
    with the current Kubernetes version, the CPU and memory available, and the features
    enabled, will be displayed in the right sidebar, as shown in figure 2.10\. Below
    the sidebar information, a Manage Features button will take you to the Features
    tab for that cluster. In figure 2.9, the following clusters are created on the
    project:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 集群菜单列出了当前舰队中的所有集群，包括位置、类型、标签以及与每个集群关联的任何警告，如图2.9所示。通过在列表中选择一个集群，将在右侧边栏中显示集群的更详细视图，包括当前Kubernetes版本、可用的CPU和内存以及启用的功能，如图2.10所示。在侧边栏信息下方，一个管理功能按钮将带您进入该集群的功能选项卡。在图2.9中，以下集群在项目中创建：
- en: GKE (cluster-gcp)
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GKE (cluster-gcp)
- en: Baremetal (cluster-1)
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 硬件（cluster-1）
- en: Azure AKS (azure-cluster and externalazure)
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure AKS (azure-cluster和externalazure)
- en: '![02-09](../../OEBPS/Images/02-09.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![02-09](../../OEBPS/Images/02-09.png)'
- en: Figure 2.9 List view in the Clusters menu
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.9 集群菜单中的列表视图
- en: '![02-10](../../OEBPS/Images/02-10.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![02-10](../../OEBPS/Images/02-10.png)'
- en: Figure 2.10 Cluster detail sidebar in the Clusters menu
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.10 集群菜单中的集群详细侧边栏
- en: 2.4.5 Features
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.4.5 功能
- en: 'The Anthos service encompasses several features (covered in more detail in
    other chapters), including:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos服务包含几个功能（在其他章节中更详细地介绍），包括：
- en: Configuration Management
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置管理
- en: Ingress
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 入口
- en: Binary Authorization
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 二进制授权
- en: Cloud Run for Anthos
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Anthos的Cloud Run
- en: Service Mesh
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务网格
- en: The Features menu provides an easy way to enable and disable specific services
    for the entire fleet. Figure 2.11 shows the list of existing features for every
    cluster.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 功能菜单提供了一个简单的方法来为整个舰队启用和禁用特定的服务。图2.11显示了每个集群现有功能的列表。
- en: '![02-11](../../OEBPS/Images/02-11.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![02-11](../../OEBPS/Images/02-11.png)'
- en: Figure 2.11 Features menu
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.11 功能菜单
- en: An admin also can disable or enable most of these features from the interface
    (some features are integral components of Anthos and cannot be disabled). The
    same possibility also exists through gcloud or the fleet management API for better
    automation. It’s worth noting that if enablement is not fully possible through
    the visual interface, the console generates the right commands for the admin to
    seamlessly enter them into their CLI.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员还可以从界面禁用或启用这些功能中的大多数（某些功能是 Anthos 的基本组件，无法禁用）。同样，通过 gcloud 或舰队管理 API 也可以实现这种可能性，以实现更好的自动化。值得注意的是，如果无法通过可视化界面完全启用，控制台会生成管理员可以无缝输入
    CLI 的正确命令。
- en: 2.4.6 Migrating to containers
  id: totrans-95
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.4.6 迁移到容器
- en: One of the major benefits of Anthos is the automatable migration of Windows
    and Linux VMs to containers and their deployment onto a compatible Anthos cluster.
    Previously, this was primarily done via CLI and initiated from the source cluster,
    but this menu now provides a convenient, centralized process for shifting VMs
    to containers and into a different deployment scheme. The menu contains tabs for
    viewing and managing your migrations, sources, and processing clusters. For more
    information on the process of migrating your existing VMs to containers, see chapter
    15, “Migrate.”
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: Anthos 的一大优势是自动将 Windows 和 Linux VM 迁移到容器，并将它们部署到兼容的 Anthos 集群。以前，这主要是通过 CLI
    完成，并从源集群启动，但此菜单现在提供了一个方便的集中流程，用于将 VM 转移到容器，并进入不同的部署方案。该菜单包含用于查看和管理迁移、源和处理集群的标签页。有关将现有
    VM 迁移到容器的过程的信息，请参阅第 15 章，“迁移。”
- en: 2.4.7 Security
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.4.7 安全
- en: The Security menu is where you find multiple tools related to viewing, enabling,
    and auditing the security posture of the clusters in the current fleet. Figure
    2.12 shows the basic view when you first select the Security menu.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 安全菜单是您找到与查看、启用和审计当前舰队中集群安全状态相关的多个工具的地方。图 2.12 显示了您首次选择安全菜单时的基本视图。
- en: '![02-12](../../OEBPS/Images/02-12.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![02-12](../../OEBPS/Images/02-12.png)'
- en: Figure 2.12 Security menu
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.12 安全菜单
- en: As you can see, we do not currently have Binary Authorization[⁷](#pgfId-1063468)
    enabled, but Anthos provides us a shortcut to quickly turn it on. Once we do,
    we are presented with the configuration page for Binary Authorization (figure
    2.13), enabling us to view and edit the policy, if needed.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，我们目前尚未启用二进制授权[⁷](#pgfId-1063468)，但 Anthos 提供了一个快捷方式，可以快速将其启用。一旦我们启用，就会显示二进制授权的配置页面（图
    2.13），使我们能够查看和编辑策略（如果需要的话）。
- en: '![02-13](../../OEBPS/Images/02-13.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![02-13](../../OEBPS/Images/02-13.png)'
- en: Figure 2.13 Binary Authorization policy details
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.13 二进制授权策略详情
- en: 2.5 Monitoring and logging
  id: totrans-104
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.5 监控和日志
- en: The Anthos menu in the GCP console is only part of the solution, however. Google
    also provides the operations suite, including Cloud Monitoring and Cloud Logging,
    to help with managing the operations of applications and infrastructure. Anthos
    simplifies the logging of application data and metrics to the operations suite
    as part of the default deployment. This can make it easy to add SLOs and SLAs
    based on these metrics.[⁸](#pgfId-1063490) In addition, several pages within the
    Anthos menu include shortcuts and buttons that trigger wizards to create SLOs
    in a guided fashion.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，GCP 控制台中的 Anthos 菜单只是解决方案的一部分。Google 还提供了操作套件，包括云监控和云日志，以帮助管理应用程序和基础设施的操作。Anthos
    将应用程序数据的记录和指标简化为操作套件的一部分，作为默认部署的一部分。这可以使基于这些指标的 SLO 和 SLA 的添加变得容易。[⁸](#pgfId-1063490)
    此外，Anthos 菜单中的几个页面包括快捷方式和按钮，可以触发向导以引导方式创建 SLO。
- en: 2.6 GKE dashboard
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.6 GKE 仪表板
- en: Google has provided the GKE dashboard for several years to assist with viewing
    and managing your clusters for GKE in GCP. With the release of Anthos, the GKE
    dashboard has been expanded to display the details for Kubernetes clusters attached
    via GKE Connect. Although the Anthos menu is focused on the clusters at a high
    level and on the Anthos-specific features, such as the Service Mesh and Config
    Management, the GKE dashboard allows an admin to drill down to specific workloads
    and services. The next section presents a tutorial to register an Azure AKS cluster
    into an Anthos dashboard.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: Google 已经提供了 GKE 仪表板多年，以帮助您在 GCP 中查看和管理 GKE 集群。随着 Anthos 的发布，GKE 仪表板已扩展以显示通过
    GKE Connect 连接的 Kubernetes 集群的详细信息。尽管 Anthos 菜单专注于集群的高级功能和 Anthos 特定的功能，如服务网格和配置管理，但
    GKE 仪表板允许管理员深入到特定的工作负载和服务。下一节将介绍如何将 Azure AKS 集群注册到 Anthos 仪表板中的教程。
- en: 2.7 Connecting to a remote cluster
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.7 连接到远程集群
- en: 'In this example, a cluster is already created in the Azure Kubernetes Service
    (AKS) engine. Google allows several cluster types to be registered remotely, referred
    to as *attached clusters* (see [http://mng.bz/Y6ne](http://mng.bz/Y6ne)). To attach
    these clusters, you will need to take the following steps:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在本例中，Azure Kubernetes Service (AKS)引擎中已经创建了一个集群。谷歌允许远程注册几种集群类型，称为*附加集群*（见[http://mng.bz/Y6ne](http://mng.bz/Y6ne)）。要附加这些集群，您需要执行以下步骤：
- en: Open a terminal window on a computer that has access to the cluster to be registered.
    Note the full path to the kubeconfig file used to connect to the cluster.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在可以访问要注册的集群的计算机上打开一个终端窗口。注意连接到集群使用的kubeconfig文件的完整路径。
- en: In the Google console, under the IAM section, create a Google Service account
    with the role GKE Connect Agent. Generate an account key and save it.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在谷歌控制台中，在IAM部分下，创建一个具有GKE Connect Agent角色的Google服务帐户。生成一个账户密钥并保存。
- en: Decide on the official designation for the cluster in your Anthos project; this
    is the Membership Name.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的Anthos项目中确定集群的官方名称；这是成员名称。
- en: Use the next command to register your cluster, replacing the <FULLCAPS> fields
    with the appropriate information:[⁹](#pgfId-1063519)
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令注册您的集群，将<FULLCAPS>字段替换为适当的信息：[⁹](#pgfId-1063519)
- en: '[PRE0]'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: In a few minutes, your cluster appears on the GCP console, as displayed in figure
    2.14.
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 几分钟后，您的集群出现在GCP控制台中，如图2.14所示。
- en: '![02-14](../../OEBPS/Images/02-14.png)'
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![02-14](../../OEBPS/Images/02-14.png)'
- en: Figure 2.14 Registered cluster view
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图2.14 已注册集群视图
- en: Authenticate to the registered cluster. As you can see, a warning sign appears
    next to the recently created cluster (externalazure). That is normal and a reminder
    to sign in to the cluster to perform more operations on it. Figure 2.15 shows
    the view of the registration status of the cluster.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证已注册的集群。如图所示，最近创建的集群（externalazure）旁边出现了一个警告标志。这是正常的，也是提醒您登录到集群以执行更多操作。图2.15显示了集群注册状态的视图。
- en: '![02-15](../../OEBPS/Images/02-15.png)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![02-15](../../OEBPS/Images/02-15.png)'
- en: Figure 2.15 View of the registration status of the cluster
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.15 集群注册状态视图
- en: 'By clicking the three dots for a cluster, you can see the available actions.
    Click Login, and you can see the following login options are available:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 通过点击集群的三点，您可以看到可用的操作。点击登录，您可以看到以下登录选项可用：
- en: Use your Google identity to log in
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用您的谷歌身份登录
- en: Token
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 令牌
- en: Basic authentication
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基本认证
- en: Authenticate with Identity Provider configured for the cluster
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用为集群配置的标识提供者进行认证
- en: 'Let’s go ahead and authenticate with a token. To do that, you need to have
    a Kubernetes Service Account (KSA) with the right permissions. If you do not already
    have one, create a KSA by typing the following in your terminal:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们继续使用令牌进行认证。为此，您需要一个具有正确权限的Kubernetes服务帐户（KSA）。如果您还没有，请在您的终端中键入以下内容来创建一个KSA：
- en: '[PRE1]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: KSA permissions
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: KSA权限
- en: 'All accounts logging in to a cluster need to hold at least the following Kubernetes
    RBAC roles in the cluster:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 所有登录到集群的帐户都需要在集群中至少持有以下Kubernetes RBAC角色：
- en: view—Kubernetes primitive role that allows read-only access to see most objects
    in a namespace. It does not allow viewing roles or role bindings.
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: view—Kubernetes基本角色，允许以只读访问权限查看命名空间中的大多数对象。它不允许查看角色或角色绑定。
- en: cloud-console-reader—Users who want to view your cluster’s resources in the
    console need to have the relevant permissions to do so. You define this set of
    permissions by creating a ClusterRole RBAC resource, cloud-console-reader, in
    the cluster. cloud-console-reader grants its users the get, list, and watch permissions
    on the cluster’s nodes, persistent volumes, and storage classes, which allow them
    to see details about these resources.
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: cloud-console-reader—希望查看控制台中集群资源的用户需要具有相应的权限。您通过在集群中创建一个ClusterRole RBAC资源，即cloud-console-reader，来定义这一组权限。cloud-console-reader授予其用户对集群节点、持久卷和存储类的get、list和watch权限，使他们能够查看这些资源的详细信息。
- en: 'Having created the KSA, acquire the KSA’s bearer token:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 创建了KSA后，获取KSA的Bearer令牌：
- en: '[PRE2]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: After you have pasted the token in the login prompt in the Google console, you
    immediately get the same view in your AKS cluster (externalazure) that you would
    see in other cluster types. Figure 2.16 provides that view.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在谷歌控制台中粘贴令牌到登录提示后，你立即会在你的AKS集群（externalazure）中看到与其他集群类型相同的视图。图2.16展示了该视图。
- en: '![02-16](../../OEBPS/Images/02-16.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![02-16](../../OEBPS/Images/02-16.png)'
- en: Figure 2.16 Anthos attached cluster authenticated
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.16 Anthos附加集群已认证
- en: Figure 2.17 shows the nodes and their health status through the dashboard.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.17 通过仪表板显示了节点及其健康状态。
- en: '![02-17](../../OEBPS/Images/02-17.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![02-17](../../OEBPS/Images/02-17.png)'
- en: Figure 2.17 Node view on attached cluster
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.17 附加集群的节点视图
- en: Several other types of Kubernetes clusters that are not managed by GCP can be
    attached to Anthos this way. Doing so gives operations simplicity and consistency,
    and permits access security to administrators from a single platform.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过这种方式将几种不由 GCP 管理的 Kubernetes 集群附加到 Anthos 上。这样做可以简化操作并提供一致性，并允许管理员从单一平台访问安全权限。
- en: Summary
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Providing a single pane of glass to hybrid and multicloud Kubernetes for any
    organization who uses microservices is a stepping stone to a successful and global
    operation.
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为使用微服务的任何组织提供单一视角的混合和多云 Kubernetes 是成功和全球运营的基石。
- en: One of the biggest benefits to a single pane of glass is that admins can use
    the same interface to configure service-level objectives and alerts to reassure
    service guarantees.
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 单一视角的最大好处之一是管理员可以使用相同的界面来配置服务级别目标（SLO）和警报，以确保服务保证。
- en: 'The Anthos UI provides some major advantages including these:'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Anthos UI 提供了一些主要优势，包括以下这些：
- en: Central operation of services and resources
  id: totrans-145
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务和资源的集中操作
- en: Consistent operation experience across multiple service providers
  id: totrans-146
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在多个服务提供商之间保持一致的运营体验
- en: Effortless navigation and easy staff training
  id: totrans-147
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无需费力的导航和简单的员工培训
- en: A window to any organizational persona
  id: totrans-148
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 任何组织角色的窗口
- en: The Anthos UI provides multiple usages, including cluster management, service
    operation, and observability, using a unified interface.
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Anthos UI 提供多种用法，包括集群管理、服务操作和可观察性，使用统一的界面。
- en: '* * *'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^(1.)A Google Cloud Platform project is a set of configuration settings that
    define how your app interacts with Google services and what resources it uses.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: ^（1）Google Cloud Platform 项目是一组配置设置，它定义了您的应用程序如何与 Google 服务交互以及它使用哪些资源。
- en: ^(2.)Attaching clusters lets you view your existing Kubernetes clusters in the
    Google Cloud console along with your Anthos clusters and enable a subset of Anthos
    features on them, including configuration with Anthos Config Management. More
    details can be found at [http://mng.bz/pdRE](http://mng.bz/pdRE).
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: ^（2）通过附加集群，您可以在 Google Cloud 控制台中查看现有的 Kubernetes 集群以及您的 Anthos 集群，并在它们上启用 Anthos
    的一些功能子集，包括与 Anthos Config Management 的配置。更多详情请参阅 [http://mng.bz/pdRE](http://mng.bz/pdRE)。
- en: ^(3.)Role-based access control (RBAC) is a set of permissions and an authorization
    component that allows or denies admin or compute objects access to a set of requesting
    resources.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: ^（3）基于角色的访问控制（RBAC）是一组权限和授权组件，它允许或拒绝管理员或计算对象对一组请求资源的访问。
- en: ^(4.)Access Transparency-enabled services let customers control access to their
    organization’s data by Google personnel. It also provides logs that capture the
    actions Google personnel take when accessing the customer’s content.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: ^（4）启用了访问透明度的服务允许客户通过 Google 人员控制对其组织数据的访问。它还提供了日志，记录 Google 人员在访问客户内容时采取的操作。
- en: ^(5.)Google Cloud Identity and Access Management (IAM) lets you grant more granular
    access to specific Google Cloud resources and prevents unwanted access to other
    resources.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: ^（5）Google Cloud Identity and Access Management (IAM) 允许您授予对特定 Google Cloud
    资源的更细粒度的访问权限，并防止对其他资源的未授权访问。
- en: ^(6.)Policy Controller is part of Anthos Config Management, allowing administrators
    to define customized rules to place guardrails for security, resource management,
    or operational reasons.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: ^（6）策略控制器是 Anthos Config Management 的一部分，允许管理员定义自定义规则，为安全、资源管理或操作原因设置护栏。
- en: ^(7.)Binary Authorization is explored in further detail in chapter 12, “Integrations
    with CI/CD.”
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: ^（7）在第 12 章“与 CI/CD 的集成”中进一步探讨了二进制授权。
- en: ^(8.)See chapter 4 for details on SLIs, SLOs, and SLAs with Anthos.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: ^（8）有关 Anthos 的 SLIs、SLOs 和 SLAs 的详细信息，请参阅第 4 章。
- en: ^(9.)The --kubeconfig line is the local filepath where your kubeconfig containing
    an entry for the cluster being registered is stored. This defaults to $KUBECONFIG
    if that environment variable is set; otherwise, this defaults to $HOME/.kube/config.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: ^（9）`--kubeconfig` 行是存储包含要注册的集群条目的 kubeconfig 的本地文件路径。如果设置了该环境变量，则默认为 `$KUBECONFIG`；否则，默认为
    `$HOME/.kube/config`。
