- en: 1 Introducing infrastructure as code
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1 介绍基础设施即代码
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Defining *infrastructure*
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义*基础设施*
- en: Defining *infrastructure as code*
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义*基础设施即代码*
- en: Understanding why infrastructure as code is important
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解基础设施即代码的重要性
- en: If you just started working with public cloud providers or data center infrastructure,
    you might feel overwhelmed with all that you have to learn. You don’t know *what*
    you need to know to do your job! Between data center infrastructure concepts,
    new public cloud offerings, container orchestrators, programming languages, and
    software development, you have a lot to research.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你刚开始与公共云提供商或数据中心基础设施合作，你可能会觉得所有需要学习的内容让你感到不知所措。你不知道*需要知道什么*来完成你的工作！在数据中心基础设施概念、新的公共云服务、容器编排器、编程语言和软件开发之间，你需要研究很多东西。
- en: Besides learning everything you can, you also have to keep up with your company’s
    requirements to innovate and grow. Building systems to support it all gets challenging.
    You need a way to support more complex systems, minimize your maintenance effort,
    and avoid disruption to customers using your application.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 除了学习尽可能多的知识外，你还必须跟上公司的创新和增长需求。构建支持所有这些的系统具有挑战性。你需要一种方式来支持更复杂的系统，最小化你的维护工作，并避免对你的应用程序使用者的服务中断。
- en: What do you need to know to work with cloud computing or data center infrastructure?
    How can you scale your systems across a team and your organization? The answer
    to both questions involves *infrastructure as code* (*IaC*), the process of automating
    infrastructure changes in a codified manner to achieve scalability, reliability,
    and security.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要了解什么才能与云计算或数据中心基础设施合作？你如何在一个团队和组织中扩展你的系统？这两个问题的答案都涉及*基础设施即代码*（*IaC*），这是一种以编码方式自动化基础设施变更的过程，以实现可扩展性、可靠性和安全性。
- en: Everyone can use IaC, from system administrators, site reliability engineers,
    DevOps engineers, security engineers, and software developers, to quality assurance
    engineers. Whether you’ve just run your first tutorial for IaC or passed a public
    cloud certification (congratulations!), you can apply IaC to larger systems and
    teams to simplify, sustain, and scale your infrastructure.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 每个人都可以使用IaC，从系统管理员、站点可靠性工程师、DevOps工程师、安全工程师和软件开发人员，到质量保证工程师。无论你是否刚刚完成了你的第一个IaC教程，或者已经通过了公共云认证（恭喜！），你都可以将IaC应用于更大的系统和团队，以简化、持续和扩展你的基础设施。
- en: This book offers a practical approach to IaC by applying software development
    practices and patterns to infrastructure management. The book presents practices
    like testing, continuous delivery, refactoring, and design patterns with an infrastructure
    twist. You’ll find practices and patterns to help you manage your infrastructure
    no matter the automation, tool, platform, or technology.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 这本书通过将软件开发实践和模式应用于基础设施管理，提供了一种实用的基础设施即代码（IaC）方法。书中介绍了测试、持续交付、重构和设计模式等实践，并从基础设施的角度进行阐述。你将找到各种实践和模式，以帮助你在任何自动化、工具、平台或技术下管理你的基础设施。
- en: I divided this book into three parts (figure 1.1). Part 1 covers the practices
    you can apply to write IaC, while part 2 describes your team’s patterns and practices
    to collaborate on it. Part 3 covers some approaches to scaling IaC across your
    organization.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 我将这本书分为三个部分（图1.1）。第一部分涵盖了你可以应用于编写IaC的实践，第二部分描述了你的团队在协作时使用的模式和实践。第三部分涵盖了在组织内扩展IaC的一些方法。
- en: '![](../../OEBPS/Images/CH01_F01_Wang.png)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/CH01_F01_Wang.png)'
- en: Figure 1.1 In this book, you will learn the intersections of practices among
    you, your team, and your organization and how they help you scale systems and
    support mission-critical applications.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.1 在本书中，你将学习到你的实践、团队和组织之间的交集，以及它们如何帮助你扩展系统和支持关键任务应用。
- en: Many of the patterns and practices in this book intersect these three interests.
    Writing good IaC individually helps you better share and scale it across your
    team and organization. Well-written IaC helps solve problems with *collaborating*
    on IaC, especially as more people adopt it.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本书中的许多模式和实践都与这三个兴趣点相交。单独编写好的IaC可以帮助你更好地在团队和组织中共享和扩展它。良好的IaC有助于解决与*协作*相关的IaC问题，特别是随着越来越多的人采用它。
- en: Part 1 starts by defining *infrastructure* and explaining common IaC design
    patterns. These topics involve foundational concepts that help you scale IaC across
    your team. You may already be familiar with some of the material in this part,
    so review these chapters to establish foundations for more advanced concepts.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 第一部分从定义*基础设施*和解释常见的IaC设计模式开始。这些主题涉及帮助你在团队中扩展IaC的基础概念。你可能已经熟悉本部分的一些材料，因此请回顾这些章节，为更高级的概念建立基础。
- en: In parts 2 and 3, you’ll learn the patterns and practices you need to scale
    systems and support infrastructure for mission-critical applications. These practices
    extend from you to your team and organization, from creating one application metrics
    alert for an application to implementing a network change across a 50,000-person
    organization. Many terms and concepts build on each other in these parts, so you
    might find it helpful to read the chapters in order.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在第2部分和第3部分，你将学习到扩展系统和支持关键任务应用程序基础设施所需的模式和最佳实践。这些实践从你扩展到你的团队和组织，从为应用程序创建一个指标警报到在一个拥有50,000人的组织中实施网络变更。许多术语和概念在这些部分中相互依赖，因此你可能发现按顺序阅读章节会有所帮助。
- en: 1.1 What is infrastructure?
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.1 什么是基础设施？
- en: Before I dive into IaC, let’s begin with the definition of *infrastructure*.
    When I began working in a data center, the literature often defined infrastructure
    as hardware or devices that provide network, storage, or compute capability. Figure
    1.2 shows how applications run on servers (compute), connect through a switch
    (network), and maintain data on disks (storage).
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在我深入探讨基础设施即代码（IaC）之前，让我们先从*基础设施*的定义开始。当我开始在数据中心工作时，文献通常将基础设施定义为提供网络、存储或计算能力的硬件或设备。图1.2展示了应用程序如何在服务器上运行（计算）、通过交换机连接（网络），并在磁盘上维护数据（存储）。
- en: '![](../../OEBPS/Images/CH01_F02_Wang.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/CH01_F02_Wang.png)'
- en: Figure 1.2 The data center definition of *infrastructure* includes networking,
    compute, and storage resources used to run an application.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.2 数据中心对*基础设施*的定义包括用于运行应用程序的网络、计算和存储资源。
- en: These three categories matched the physical devices we managed in a data center.
    We made changes by scanning our IDs to get into a building, plugging into a device,
    typing commands, and hoping that everything still worked. With the advent of cloud
    computing, we continued to use these categories to discuss virtualization of specific
    devices.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 这三个类别与我们管理的数据中心中的物理设备相匹配。我们通过扫描我们的ID进入大楼，插入设备，输入命令，并希望一切仍然正常工作。随着云计算的出现，我们继续使用这些类别来讨论特定设备的虚拟化。
- en: 'However, the data center definition of infrastructure doesn’t quite apply to
    today’s services and offerings. Imagine that another team requests that you help
    them deliver their application to production for users. You run through a checklist
    that includes setting up the following:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，数据中心对基础设施的定义并不完全适用于今天的服务和产品。想象一下，另一个团队要求你帮助他们将应用程序交付给用户的生产环境。你通过一个清单，包括以下设置：
- en: Enough servers
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 足够的服务器
- en: Network connectivity for users
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户网络连接
- en: A database for storing application data
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于存储应用程序数据的数据库
- en: Does completing this checklist mean the team can run this application in production?
    Not necessarily. You do not know if you set up enough servers or the proper access
    to log into the application. You also need to know if network latency affects
    the application’s database connection.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这个清单意味着团队可以在生产中运行这个应用程序吗？不一定。你不知道你是否设置了足够的服务器或适当的访问权限来登录应用程序。你还需要知道网络延迟是否会影响应用程序的数据库连接。
- en: 'In this narrow definition of infrastructure, you omit some critical tasks necessary
    for production readiness, including the following:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个狭义的基础设施定义中，你省略了一些对于生产准备至关重要的任务，包括以下内容：
- en: Monitoring application metrics
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控应用程序指标
- en: Exporting metrics for business reporting
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导出指标以进行业务报告
- en: Setting up alerts for teams operating the application
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为操作应用程序的团队设置警报
- en: Adding health checks for servers and databases
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为服务器和数据库添加健康检查
- en: Supporting user authentication
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持用户身份验证
- en: Logging and aggregating application events
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 记录和汇总应用程序事件
- en: Storing and rotating database passwords in a secrets manager
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在密钥管理器中存储和轮换数据库密码
- en: You need these to-do items to deliver an application to production that will
    work reliably and securely. You might think of them as *operational* requirements,
    but they still require infrastructure resources.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要这些待办事项来交付一个可靠且安全的应用程序到生产环境中。您可能会将它们视为*运营*要求，但它们仍然需要基础设施资源。
- en: Besides infrastructure related to operations, public cloud providers abstract
    the management of base networking, compute, and storage and offer platform as
    a service (PaaS) offerings instead, from object stores like storage buckets to
    event-streaming platforms like managed Apache Kafka. Providers even offer function
    as a service (FaaS) or containers as a service, additional abstractions for computing
    resources. The increasing marketplace of software as a service (SaaS), such as
    hosted application performance-monitoring software, might also be required to
    support an application in production and could also be infrastructure.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 除了与运营相关的基础设施之外，公共云提供商抽象化了基础网络、计算和存储的管理，并提供平台即服务（PaaS）产品，例如从存储桶到事件流平台如托管Apache
    Kafka等对象存储。提供商甚至提供函数即服务（FaaS）或容器即服务，这是计算资源的额外抽象。软件即服务（SaaS）市场的日益增长，如托管的应用性能监控软件，可能也需要支持生产中的应用程序，也可能被视为基础设施。
- en: With so many services, we cannot describe infrastructure with just compute,
    network, and storage categories. We need to include operational infrastructure,
    PaaS, or SaaS offerings in our application delivery. Figure 1.3 adjusts the model
    of infrastructure to include additional service offerings like SaaS and PaaS that
    help us deliver applications.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 由于有如此多的服务，我们无法仅用计算、网络和存储类别来描述基础设施。我们需要在我们的应用程序交付中包括运营基础设施、PaaS或SaaS产品。图1.3调整了基础设施模型，包括额外的服务产品，如SaaS和PaaS，帮助我们交付应用程序。
- en: Because of the growing complexity, varying operating models, and user abstraction
    of data center management, you can’t limit the definition of *infrastructure*
    to hardware or physical devices related to compute, network, or storage.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 由于日益增长的复杂性、不同的运营模式以及数据中心管理的用户抽象化，我们不能将*基础设施*的定义限制在硬件或与计算、网络或存储相关的物理设备上。
- en: Definition *Infrastructure* refers to the software, platform, or hardware that
    delivers or deploys applications to production.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 定义*基础设施*是指将应用程序交付或部署到生产环境的软件、平台或硬件。
- en: 'Here is a non-exhaustive list of infrastructure you might encounter:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是一个您可能遇到的非详尽的基础设施列表：
- en: Servers
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器
- en: Workload orchestration platforms (e.g., Kubernetes, HashiCorp Nomad)
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工作负载编排平台（例如，Kubernetes，HashiCorp Nomad）
- en: Network switches
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络交换机
- en: Load balancers
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 负载均衡器
- en: Databases
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库
- en: Object stores
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对象存储
- en: Caches
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 缓存
- en: Queues
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 队列
- en: Event-streaming platforms
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 事件流平台
- en: Monitoring platforms
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控平台
- en: Data pipeline systems
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据管道系统
- en: Payment platforms
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支付平台
- en: Expanding the *infrastructure* definition provides a common language across
    teams managing resources for various purposes. For example, a team managing an
    organization’s continuous integration (CI) framework utilizes infrastructure from
    either a continuous integration SaaS or compute resources from a public cloud.
    Another team builds upon the framework, thus making it critical infrastructure.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 扩展*基础设施*的定义为跨团队提供了管理各种目的资源的通用语言。例如，一个管理组织持续集成（CI）框架的团队可能使用来自持续集成SaaS或公共云的计算资源。另一个团队在此基础上构建，因此使其成为关键基础设施。
- en: '![](../../OEBPS/Images/CH01_F03_Wang.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH01_F03_Wang.png)'
- en: Figure 1.3 The infrastructure for an application might include queues on a public
    cloud, containers running applications, serverless functions for additional processing,
    or even monitoring services to check the system’s health.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.3 应用程序的基础设施可能包括公共云上的队列、运行应用程序的容器、用于额外处理的无服务器函数，甚至用于检查系统健康的监控服务。
- en: 1.2 What is infrastructure as code?
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.2 什么是基础设施即代码？
- en: Before explaining infrastructure as code, we must understand the manual infrastructure
    configuration. In this section, I outline the problem with infrastructure and
    manual configuration. Then I define *infrastructure as code*.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在解释基础设施即代码之前，我们必须理解手动基础设施配置。在本节中，我概述了基础设施和手动配置的问题。然后我定义了*基础设施即代码*。
- en: 1.2.1 Manual configuration of infrastructure
  id: totrans-57
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.2.1 基础设施的手动配置
- en: As part of a network team, I learned to change a network switch by copying and
    pasting commands from a text document. I once pasted `shutdown` instead of `no
    shutdown`, turning off a network interface! I quickly turned it back on, hoping
    that no one noticed and it didn’t affect anything. A week later, however, I discovered
    that it shut off connectivity to a critical application and affected a few customer
    requests.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 作为网络团队的一员，我学会了通过复制粘贴文本文档中的命令来更改网络交换机。我曾在粘贴时将`shutdown`误写成`no shutdown`，关闭了网络接口！我迅速将其重新打开，希望没有人注意到并且没有影响任何事情。然而，一周后，我发现它关闭了与一个关键应用程序的连接，并影响了几个客户请求。
- en: In retrospect, I ran into a few problems with my manual copying and pasting
    of commands and infrastructure configuration. First, I had no idea which resources
    my change would affect (also known as the *blast radius*). I did not know which
    networks or applications used the interface.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 回顾过去，我在手动复制粘贴命令和基础设施配置方面遇到了一些问题。首先，我不知道我的变更会影响哪些资源（也称为*爆炸半径*）。我不知道哪些网络或应用程序使用了该接口。
- en: Definition The *blast radius* refers to the impact a failed change has on a
    system. A larger blast radius often affects more components or the most critical
    components.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 定义：*爆炸半径*指的是一个失败的变更对系统造成的影响。较大的爆炸半径通常会影响更多的组件或最关键的组件。
- en: Second, the network switch accepted my command without testing its effects or
    checking its intent. Finally, no one else knew what affected the application’s
    processing of customer requests, and it took a week for them to identify the root
    cause as my miscopied command.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，网络交换机接受了我的命令，而没有测试其效果或检查其意图。最后，没有人知道是什么影响了应用程序处理客户请求，他们花了整整一周时间才确定根本原因是我的误复制命令。
- en: How does writing infrastructure in a codified manner help catch my miscopied
    network switch command? I could store my configuration and automation under source
    control to record the commands. To catch my mistake going forward, I create a
    virtual switch and a test that runs my script and checks the health of the interface.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 以编码的方式编写基础设施如何帮助我发现误复制的网络交换机命令？我可以将我的配置和自动化存储在源代码管理中，以记录命令。为了防止未来出现错误，我创建了一个虚拟交换机和一个测试，该测试运行我的脚本并检查接口的健康状况。
- en: After the tests pass, I promote the change to production because the tests check
    for the correct command. If I apply the wrong command, I can search infrastructure
    configuration to determine which applications run on the affected network. You
    can refer to chapter 6 for testing practices and chapter 11 for reverting changes.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 测试通过后，我将变更推进到生产环境，因为测试会检查正确的命令。如果我应用了错误的命令，我可以搜索基础设施配置来确定哪些应用程序运行在受影响的网络上。你可以参考第6章了解测试实践，第11章了解变更回滚。
- en: Besides the risk of misconfiguration, my development momentum sometimes slows
    because of manual infrastructure configuration. Once, it took nearly two months
    for me to test my application against a database. Throughout those two months,
    my team submitted over 10 tickets related to creating the database, configuring
    new routing to connect the application to the database, and opening firewall rules
    to allow my application. The platform team manually configured everything in a
    public cloud. Development teams did not have direct access because of security
    concerns.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 除了配置错误的风险外，由于手动配置基础设施，我的开发进度有时会放缓。有一次，我花了近两个月的时间来测试我的应用程序与数据库的兼容性。在这两个月里，我的团队提交了超过10张与创建数据库、配置新的路由以将应用程序连接到数据库以及打开防火墙规则以允许我的应用程序相关的工单。平台团队在公共云中手动配置了一切。由于安全考虑，开发团队没有直接访问权限。
- en: In other words, manual configuration of infrastructure often does not scale
    as systems and teams grow. Manual changes *increase the change failure rate of
    systems, slow development**, and expose the system’s attack surface to a potential
    security exploit*. You will always have the temptation to update some values into
    a console. However, these changes accumulate.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 换句话说，随着系统和团队的增长，手动配置基础设施通常无法扩展。手动变更*增加了系统的变更失败率，减缓了开发进度**，并将系统的攻击面暴露于潜在的安全漏洞之中。你总会诱惑着将一些值更新到控制台。然而，这些变更会累积。
- en: The next person who makes a change to the system may introduce a failure into
    the system that will be difficult to troubleshoot because changes haven’t been
    audited or organized. Changes like updating a firewall to allow some traffic during
    the development process can inadvertently leave the system vulnerable to attack.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个人对系统进行更改时，可能会引入系统故障，因为更改尚未经过审计或整理。例如，在开发过程中更新防火墙以允许某些流量，可能会无意中使系统容易受到攻击。
- en: 1.2.2 Infrastructure as code
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.2.2 基础设施即代码
- en: What should you do to change infrastructure, if not manual changes? You can
    apply a software development life cycle for infrastructure resources and configuration
    in the form of IaC. However, an infrastructure development life cycle goes beyond
    configuration files and scripts.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 如果不是手动更改，你应该做什么来更改基础设施？你可以将软件开发生命周期应用于基础设施资源和配置，形式为IaC。然而，基础设施开发生命周期不仅限于配置文件和脚本。
- en: Infrastructure needs to scale, manage failure, support rapid software development,
    and secure applications. A development life cycle for infrastructure involves
    more specific patterns and practices to support collaboration, deployment, and
    testing. In figure 1.4, a simplified workflow changes infrastructure by using
    configuration or scripts and committing them to version control. A commit automatically
    starts a workflow to deploy and test the changes to your infrastructure.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 基础设施需要扩展、管理故障、支持快速软件开发，并保护应用程序。基础设施开发生命周期涉及更具体的模式和流程来支持协作、部署和测试。在图1.4中，简化的工作流程通过使用配置或脚本更改基础设施，并将它们提交到版本控制。提交会自动启动一个工作流程来部署和测试对基础设施的更改。
- en: '![](../../OEBPS/Images/CH01_F04_Wang.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH01_F04_Wang.png)'
- en: Figure 1.4 A development life cycle for infrastructure includes writing the
    code as documentation, committing it to version control, applying it to infrastructure
    in an automated way, and testing it.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.4 基础设施开发生命周期包括编写代码作为文档、将其提交到版本控制、以自动方式将其应用于基础设施，并对其进行测试。
- en: Why should you remember the development life cycle? You can use it as a general
    pattern for managing changes and verifying that they don’t affect your system.
    The life cycle captures *infrastructure as code*, which automates infrastructure
    changes in a codified manner and applies DevOps practices such as version control
    and continuous delivery.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么你应该记住开发生命周期？你可以将其用作管理更改和验证它们不会影响你系统的一般模式。生命周期捕捉到*基础设施即代码*，以编码方式自动化基础设施更改，并应用DevOps实践，如版本控制和持续交付。
- en: Definition *Infrastructure as code* (*IaC*) applies DevOps practices to automating
    infrastructure changes in a codified manner to achieve scalability, resiliency,
    and security.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 *基础设施即代码* (*IaC*) 将DevOps实践应用于以编码方式自动化基础设施更改，以实现可扩展性、弹性和安全性。
- en: I often find IaC cited as a necessary practice of DevOps. It certainly addresses
    the automation piece of the CAMS model (culture, automation, measurement, and
    sharing). Figure 1.5 positions IaC as part of automation practices and philosophy
    in the DevOps model. The practices of code as documentation, version control,
    software development patterns, and continuous delivery align with the development
    life cycle workflow we discussed previously.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 我经常发现IaC被引用为DevOps的必要实践。它确实解决了CAMS模型（文化、自动化、测量和共享）中的自动化部分。图1.5将IaC定位为DevOps模型中自动化实践和哲学的一部分。代码作为文档、版本控制、软件开发模式和持续交付的实践与之前讨论的开发生命周期工作流程相一致。
- en: '![](../../OEBPS/Images/CH01_F05_Wang.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH01_F05_Wang.png)'
- en: Figure 1.5 IaC applies version control, software development patterns, continuous
    integration, and code as documentation to infrastructure.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.5 IaC应用版本控制、软件开发模式、持续集成和代码作为文档到基础设施。
- en: Why focus on IaC as part of automation in the DevOps model? Your organization
    does not have to adopt DevOps to use IaC. Its benefits improve DevOps adoption
    and metrics but still apply to any infrastructure configuration. You can still
    use IaC practices to improve the process of making infrastructure changes without
    affecting production.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么在DevOps模型中将IaC作为自动化的一部分进行关注？你的组织不必采用DevOps就可以使用IaC。它的好处可以提高DevOps的采用率和指标，但仍然适用于任何基础设施配置。你仍然可以使用IaC实践来改进基础设施更改的过程，而不会影响生产。
- en: note You will see some DevOps practices included in this book, but I do not
    focus on its theory or principles. I recommend *Accelerate* by Nicole Forsgren
    et al. (IT Revolution Press, 2018) for a higher-level understanding of DevOps.
    You can also peruse *The Phoenix Project* by Gene Kim et al. (IT Revolution Press,
    2013), which describes the fictional transformation of an organization adopting
    DevOps.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：您将在本书中看到一些DevOps实践，但我并不专注于其理论或原则。我推荐Nicole Forsgren等人所著的《加速》（IT Revolution
    Press，2018年）以获得对DevOps的更高层次理解。您还可以阅读Gene Kim等人所著的《凤凰项目》（IT Revolution Press，2013年），该书描述了一个采用DevOps的组织所进行的虚构转型。
- en: This book covers some approaches for codifying infrastructure to eliminate the
    friction of scale while maintaining the reliability and security of infrastructure
    for application users, whether you use the data center or cloud. Software development
    practices such as version control of configuration files, CI pipelines, and testing
    can help scale and evolve changes to infrastructure while mitigating downtime
    and building secure configuration.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 本书涵盖了一些将基础设施编码化的方法，以消除扩展的摩擦，同时保持为应用程序用户维护基础设施的可靠性和安全性，无论您使用数据中心还是云。诸如配置文件版本控制、CI管道和测试等软件开发实践可以帮助扩展和演进基础设施的变化，同时减轻停机时间并构建安全的配置。
- en: 1.2.3 What is not infrastructure as code?
  id: totrans-80
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.2.3 什么是非基础设施即代码？
- en: 'Could you be doing IaC if you type out some configuration in a document? You
    might consider IaC to include adding configuration instructions in a change ticket.
    You can argue that a tutorial for building a queue or a shell script for configuring
    a server counts as IaC. Each of these examples *can* be forms of IaC if you can
    use them to do the following:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在文档中键入一些配置，您是否在进行IaC？您可能会认为IaC包括在变更票中添加配置指令。您可能会认为构建队列的教程或配置服务器的shell脚本算作IaC。如果这些例子可以用来做到以下事项，那么它们*可以是*IaC的形式：
- en: Reliably and accurately reproduce the infrastructure it expresses
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可靠且准确地重现所表达的基础设施
- en: Revert configuration to a specific version or point in time
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将配置还原到特定版本或时间点
- en: Communicate and assess the blast radius of a change to the resources
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 传达并评估变更对资源的爆炸半径
- en: The configurations or scripts, however, are usually outdated, unversioned, or
    ambiguous in intent. You may even find yourself struggling to understand and change
    the configuration written in an IaC tool. The tool facilitates IaC workflows but
    not necessarily the practices and approaches that allow systems to grow while
    reducing operational responsibility and change failure. You need a set of principles
    to identify IaC.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，配置或脚本通常过时、未版本化或意图不明确。您甚至可能发现自己难以理解和更改用IaC工具编写的配置。该工具促进了IaC工作流程，但并不一定促进允许系统在减少运营责任和降低变更失败率的同时增长的做法和途径。您需要一套原则来识别IaC。
- en: 1.3 Principles of infrastructure as code
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.3 基础设施即代码的原则
- en: As I mentioned, not every piece of code or configuration related to infrastructure
    will scale or mitigate downtime. Throughout the book, I highlight how IaC principles
    apply to certain code listings or practices. You can even use these principles
    to assess your IaC.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我提到的，并非所有与基础设施相关的代码或配置都能进行扩展或减轻停机时间。在本书中，我强调了IaC原则如何应用于某些代码列表或实践。您甚至可以使用这些原则来评估您的IaC。
- en: While others may add or subtract to this list of principles, I remember four
    of the most important principles with the mnemonic *RICE*. This stands for *reproducibility,
    idempotency, composability, and evolvability*. I define and apply each principle
    in the following sections.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 当其他人可能对这个原则列表进行增减时，我记住四个最重要的原则，即通过记忆法“RICE”。这代表的是*可重现性、幂等性、可组合性和可扩展性*。我在以下章节中定义并应用每个原则。
- en: 1.3.1 Reproducibility
  id: totrans-89
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.1 可重现性
- en: Imagine someone asks you to create a development environment with a queue and
    a server. You share a set of configuration files with your teammate. They use
    them to re-create a new environment for themselves in less than an hour. Figure
    1.6 shows how you shared your configuration and enabled your teammate to reproduce
    a new environment. You discovered the power of *reproducibility*, the first principle
    of IaC!
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下，有人要求您创建一个包含队列和服务器的发展环境。您与您的同事共享一组配置文件。他们用这些文件在不到一个小时的时间内为自己重新创建了一个新环境。图1.6显示了您如何共享配置并使您的同事能够重现一个新环境。您发现了*可重现性*的力量，这是IaC的第一个原则！
- en: Why should IaC conform to this principle of reproducibility? The ability to
    copy and reuse infrastructure configuration saves you and your team’s initial
    engineering time. You don’t have to reinvent the wheel to create new environments
    or infrastructure resources.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么 IaC 应符合这个可重复性原则？能够复制和重用基础设施配置可以节省您和您的团队在创建新环境或基础设施资源时的初始工程时间。您不必重新发明轮子来创建新环境或基础设施资源。
- en: '![](../../OEBPS/Images/CH01_F06_Wang.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH01_F06_Wang.png)'
- en: Figure 1.6 Manual changes introduce drift between version control and actual
    state and affect reproducibility, so you instead update changes in version control.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.6 手动更改会在版本控制和实际状态之间引入漂移，影响可重复性，因此您应该更新版本控制中的更改。
- en: Definition The *principle of reproducibility* means that you can use the same
    configuration to reproduce an environment or infrastructure resources.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 *可重复性原则* 意味着您可以使用相同的配置来重现环境或基础设施资源。
- en: However, you’ll find adhering to the principle of reproducibility more complicated
    than copying and pasting a configuration. To demonstrate this nuance, imagine
    you need to reduce a network address space from `/16` to `/24`. You do have IaC
    written that expresses the network. However, you decide to choose the easy route
    of logging into the cloud provider and typing `/24` into the text box.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，您会发现遵循可重复性原则比复制粘贴配置要复杂得多。为了展示这种细微差别，想象您需要将网络地址空间从 `/16` 减少到 `/24`。您确实有表达网络的
    IaC。然而，您决定选择登录云提供商并在文本框中输入 `/24` 的简单途径。
- en: 'Before you log into the cloud provider, you reflect on whether your change
    workflow adheres to reproducibility. You ask yourself the following questions:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在您登录云提供商之前，您会反思您的更改工作流程是否遵循可重复性。您会问自己以下问题：
- en: Will a teammate know that you’ve updated the network?
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同事是否会知道您已更新了网络？
- en: If you run your configuration, will the network address space return to the
    `/16`?
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果您运行您的配置，网络地址空间会返回到 `/16` 吗？
- en: If you create a new environment with the configuration in version control, will
    it have an address space of `/24`?
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果您使用版本控制中的配置创建新环境，它将具有 `/24` 的地址空间吗？
- en: You answer no to each of those questions. You cannot guarantee that you will
    reproduce the manual change successfully.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 您对每个问题的回答都是否定。您无法保证您能成功重现手动更改。
- en: If you go ahead and type `/24` in the cloud provider’s console, your network
    has *drifted* from its desired state expressed in IaC (figure 1.7). To conform
    to reproducibility, you decide to update the version control configuration to
    `/24` and apply the automation.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在云提供商的控制台中输入 `/24`，则您的网络已从 IaC（图 1.7）中表达的理想状态发生 *漂移*。为了符合可重复性，您决定更新版本控制配置为
    `/24` 并应用自动化。
- en: '![](../../OEBPS/Images/CH01_F07_Wang.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH01_F07_Wang.png)'
- en: Figure 1.7 Manual changes introduce drift between version control and actual
    state and affects reproducibility, so you instead update changes in version control.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.7 手动更改会在版本控制和实际状态之间引入漂移，影响可重复性，因此您应该更新版本控制中的更改。
- en: This scenario demonstrates the challenge of conforming to reproducibility. You
    need to minimize the inconsistency between the expected and actual infrastructure
    configuration, also known as *configuration drift*.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 这个场景展示了符合可重复性的挑战。您需要最小化预期和实际基础设施配置之间的一致性，也称为 *配置漂移*。
- en: Definition *Configuration drift* is the deviation of infrastructure configuration
    from the desired configuration to the actual configuration.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 *配置漂移* 是基础设施配置从期望配置到实际配置的偏差。
- en: As a practice, you can ensure the principle of reproducibility by placing your
    configuration files in version control and keeping version control as updated
    as possible. Maintaining the principle of reproducibility helps you collaborate
    better *and* manage testing environments similar to production.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一种实践，您可以通过将配置文件放在版本控制中并尽可能保持版本控制更新来确保可重复性原则。维护可重复性原则有助于您更好地协作 *并且* 管理与生产环境类似的测试环境。
- en: In chapter 6, you’ll learn more about infrastructure testing environments, which
    benefit from reproducibility. You’ll also apply reproducibility to practices and
    patterns in testing and upgrading infrastructure, from creating test infrastructure
    mirroring production to deploying new infrastructure to replace older systems
    (blue-green deployments).
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在第6章中，你将了解更多关于基础设施测试环境的内容，这些环境受益于可重复性。你还将将可重复性应用于测试和升级基础设施的实践和模式，从创建与生产环境镜像的测试基础设施到部署新的基础设施以替换旧系统（蓝绿部署）。
- en: 1.3.2 Idempotency
  id: totrans-108
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.2 幂等性
- en: 'Some IaC includes *repeatability* as a principle, which means running the same
    automation and yielding consistent results. I pose that IaC needs a stricter requirement.
    Running automation should result in the same *end state* for an infrastructure
    resource. After all, I have one main objective when I write automation: the ability
    to run the automation multiple times and get the same result.'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 一些基础设施即代码（IaC）将*可重复性*作为一个原则，这意味着运行相同的自动化操作并产生一致的结果。我认为IaC需要更严格的要求。运行自动化操作应该导致基础设施资源达到相同的*最终状态*。毕竟，我编写自动化脚本的主要目标就是能够多次运行自动化操作并获得相同的结果。
- en: Let’s consider why IaC needs a stricter requirement. Imagine you write a network
    script that first configures an interface and then reboots. The first time you
    run the script, the switch configures the interface and reboots. You save this
    script as version 1.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们考虑为什么IaC需要更严格的要求。想象一下，你编写了一个网络脚本，首先配置一个接口，然后重启。第一次运行脚本时，交换机配置了接口并重启。你将这个脚本保存为版本1。
- en: A few months later, your teammate asks you to run the script again on the switch.
    You run the script, and the switch reboots. However, the reboot disconnects some
    critical applications! You already configured the network interface. Why do you
    need to reboot the switch?
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 几个月后，你的同事要求你在交换机上再次运行这个脚本。你运行了脚本，交换机重启了。然而，重启断开了某些关键应用程序！你已经配置了网络接口。为什么还需要重启交换机？
- en: You figure out a way to prevent the switch reboot if you’ve already configured
    the network interface. In figure 1.8, you create version 2 of the script and add
    a conditional `if` statement. The statement checks whether you have configured
    the interface already before rebooting the switch. When you run the version 2
    script again, you do not disconnect the applications.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经配置了网络接口，你找到了一种防止交换机重启的方法。在图1.8中，你创建了脚本的版本2并添加了一个条件`if`语句。该语句在重启交换机之前检查你是否已经配置了接口。当你再次运行版本2的脚本时，你不会断开应用程序。
- en: The conditional statement conforms to the principle of idempotency. *Idempotency*
    ensures that you can repeat the automation without affecting the infrastructure
    unless you change the configuration or drift occurs. If an infrastructure configuration
    or script is idempotent, you can rerun the automation multiple times without affecting
    the state or operability of a resource.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 条件语句符合幂等性原则。*幂等性*确保你可以重复自动化操作而不会影响基础设施，除非你更改了配置或发生了漂移。如果一个基础设施配置或脚本具有幂等性，你可以多次重新运行自动化操作，而不会影响资源的状态或可操作性。
- en: '![](../../OEBPS/Images/CH01_F08_Wang.png)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH01_F08_Wang.png)'
- en: Figure 1.8 In version 1 of the script, you reboot the switch each time you run
    the script. In version 2, you check whether the network interface is configured
    before rebooting the switch. This preserves the working state of the network.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.8 在脚本版本1中，每次运行脚本时都会重启交换机。在版本2中，你在重启交换机之前检查网络接口是否已配置。这保留了网络的正常工作状态。
- en: Definition The *principle of idempotency* ensures that you can repeatedly run
    the automation on infrastructure without affecting its end state or having any
    side effects. You should affect infrastructure only when you update its attributes
    in automation.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 *幂等性原则* 确保你可以在基础设施上反复运行自动化操作，而不会影响其最终状态或产生任何副作用。你应该只在更新自动化操作中的基础设施属性时影响基础设施。
- en: Why should you adhere to idempotency in your IaC, such as in the case of your
    network script? In the example, you want to avoid rebooting the network switch
    to keep the network running correctly. You already configured the network interface;
    why configure it again? You should need to configure the interface only if it
    doesn’t exist or change.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么你应该在你的IaC中坚持幂等性，比如在你的网络脚本中？在示例中，你希望避免重启网络交换机以保持网络的正常运行。你已经配置了网络接口；为什么还要重新配置？你应该只有在接口不存在或发生变化时才需要配置接口。
- en: Without idempotency, your automation might break accidentally. For example,
    you may repeat a script and create a new set of servers, doubling their numbers.
    More catastrophically, you might automate a database update only to remove a critical
    database!
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 没有幂等性，你的自动化可能会意外中断。例如，你可能重复执行一个脚本，创建一组新的服务器，使它们的数量翻倍。更严重的是，你可能自动化了一个数据库更新，结果却删除了一个关键的数据库！
- en: You can ensure the principle of idempotency by checking the repeatability of
    scripts and configuration. As a general practice, include a number of *conditional
    statements* checking whether a configuration matches the expected one before running
    your automation. Conditional statements help apply changes when required and avoid
    side effects that may affect the operability of infrastructure.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过检查脚本的重复性和配置来确保幂等性原则。作为一种一般做法，在运行自动化之前，包括一系列*条件语句*来检查配置是否与预期的一致。条件语句有助于在需要时应用更改，并避免可能影响基础设施操作性的副作用。
- en: Designing automation with idempotency reduces risk, as it encourages the inclusion
    of logic to preserve the final expected state of the system. If the automation
    fails once and causes an outage in the system, organizations no longer want to
    automate again because of its perceived risk. Idempotency will become a guiding
    principle as you learn how to safely roll forward changes and preview automation
    changes before deployment in chapter 11.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 使用幂等性设计自动化可以降低风险，因为它鼓励包含逻辑以保留系统的最终预期状态。如果自动化失败一次并导致系统中断，组织不再希望再次自动化，因为其感知的风险。随着你学习如何在第11章中安全地推进更改并在部署前预览自动化更改，幂等性将成为一个指导原则。
- en: 1.3.3 Composability
  id: totrans-121
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.3 可组合性
- en: You want to mix and match any set of infrastructure components, no matter the
    tool or configuration. You also need to update the individual configurations without
    affecting the entire system. Both of these requirements promote modularity and
    decoupling infrastructure dependencies, something you’ll learn more about in chapters
    3 and 4.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 你希望混合和匹配任何一组基础设施组件，无论工具或配置如何。你还需要在不影响整个系统的情况下更新单个配置。这两个要求都促进了模块化和解耦基础设施依赖，你将在第3章和第4章中了解更多关于这方面的内容。
- en: 'For example, imagine you create infrastructure for an application that someone
    accesses at hello-world.com. These are the minimum resources you need for a secure
    and production-ready configuration:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，想象你为在hello-world.com上访问的应用程序创建基础设施。以下是你需要一个安全且生产就绪配置的最小资源：
- en: A server
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器
- en: A load balancer
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 负载均衡器
- en: A private network for a server
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为服务器创建的私有网络
- en: A public network for a load balancer
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为负载均衡器创建的公共网络
- en: A routing rule to allow traffic out of the private network
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许从私有网络流出的流量路由规则
- en: A routing rule to allow public traffic to the load balancer
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许公共流量到达负载均衡器的路由规则
- en: A routing rule to allow traffic from the load balancer to the server
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许从负载均衡器到服务器的流量路由规则
- en: A domain name for hello-world.com
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为hello-world.com创建域名
- en: 'You could write this configuration from scratch. However, what if you found
    preconstructed *modules* that group infrastructure components you can use to assemble
    the system? You now have multiple modules that create the following:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以从头开始编写这个配置。然而，如果你发现预先构建的*模块*，这些模块可以组合你用来构建系统的基础设施组件，你会怎么办？现在你有多个模块可以创建以下内容：
- en: Networks (private and public networks, gateways to route traffic from the private
    network, routing rules to allow traffic out of the private network)
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络（私有和公共网络、路由流量从私有网络的网关、允许流量从私有网络流出的路由规则）
- en: Servers
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器
- en: Load balancers (domain name, routing rules to allow traffic from the load balancer
    to the server)
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 负载均衡器（域名、允许流量从负载均衡器到服务器的路由规则）
- en: In figure 1.9, you pick the network, server, and load balancer modules to build
    your production environment. Later, you realize you need a premium load balancer.
    You swap out the standard load balancer with a premium one so you can serve more
    traffic. The server and network continue running without affecting users.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在图1.9中，你选择了网络、服务器和负载均衡器模块来构建你的生产环境。后来，你意识到你需要一个高级负载均衡器。你用高级负载均衡器替换了标准负载均衡器，以便可以处理更多的流量。服务器和网络继续运行，不会影响用户。
- en: Your teammate can even add a database into the environment without affecting
    the load balancer, servers, or network. You group and select infrastructure resources
    in various combinations, which adheres to the principle of *composability*.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 你的队友甚至可以在不影响负载均衡器、服务器或网络的情况下将数据库添加到环境中。你可以以各种组合分组和选择基础设施资源，这符合*可组合性*原则。
- en: Definition *Composability* ensures that you can assemble any combination of
    infrastructure resources and update each one without affecting the others.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 **组合性** 确保您能够组装任何基础设施资源的组合，并更新每一个资源而不会影响其他资源。
- en: '![](../../OEBPS/Images/CH01_F09_Wang.png)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/CH01_F09_Wang.png)'
- en: Figure 1.9 You build your production environment with building blocks of infrastructure
    so you can add new resources, like the premium load balancer, easily.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.9 您使用基础设施的构建块构建生产环境，这样您可以轻松地添加新的资源，如高级负载均衡器。
- en: The more composable your configuration, the easier it is to create new systems
    with less effort. Think of constructing your IaC with building blocks. You want
    to be able to update or evolve subsets of resources without toppling the entire
    system! If you do not consider the composability of your IaC, you run the risk
    of change failures due to unknown dependencies in complex infrastructure systems.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 您的配置越具有组合性，创建新系统就越容易，且所需努力更少。想象一下用构建块构建您的基础设施即代码（IaC）。您希望能够在不破坏整个系统的情况下更新或演进资源子集！如果您不考虑IaC的组合性，您可能会因为复杂基础设施系统中的未知依赖而导致变更失败。
- en: The self-service benefit of composability can help your organization scale and
    empower teams to interact safely with infrastructure systems. Chapters 3 and 4
    examine some patterns that can help you approach more modular infrastructure construction
    and improve composability.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 组合性带来的自助服务优势可以帮助您的组织进行扩展，并赋予团队安全地与基础设施系统交互的能力。第3章和第4章探讨了可以帮助您接近更模块化基础设施构建并提高组合性的某些模式。
- en: 1.3.4 Evolvability
  id: totrans-143
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.4 可进化性
- en: You want to account for the scale and growth of your system but not optimize
    the configuration too early and unnecessarily. Much of infrastructure configuration
    will change over time, including its architecture.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 您希望考虑到系统的规模和增长，但不要过早和不必要地优化配置。大部分基础设施配置会随着时间的推移而改变，包括其架构。
- en: As a practical example, you might initially name an infrastructure resource
    `example`. Later, you need to change the resource name to `production`. You start
    the change by finding and replacing hundreds of tags, names, dependent resources,
    and more. The procedure of find-and-replace requires a high rate of effort.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 作为实际例子，您可能最初将基础设施资源命名为 `example`。后来，您需要将资源名称更改为 `production`。您开始变更的过程是查找并替换数百个标签、名称、依赖资源等。查找和替换的过程需要大量的努力。
- en: You notice that you forgot to change some fields as you apply the changes, and
    your new infrastructure changes fail. To ensure the future evolution of names,
    tags, and other metadata, you instead create a variable for the name, and the
    configuration references the variable. In figure 1.10, you update the global `NAME`
    variable, and the change propagates across the entire system.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 当您应用变更时，您注意到您忘记更改了一些字段，并且您的新基础设施变更失败了。为了确保名称、标签和其他元数据的未来进化，您创建了一个名称变量，并且配置引用了这个变量。在图1.10中，您更新了全局
    `NAME` 变量，并且变更在整个系统中传播。
- en: '![](../../OEBPS/Images/CH01_F10_Wang.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/CH01_F10_Wang.png)'
- en: Figure 1.10 Rather than finding and replacing all instances of the name, you
    can set a top-level variable with the name for all resources.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.10 而不是查找并替换所有名称实例，您可以设置一个顶层变量，用于所有资源的名称。
- en: The example seems almost too simple. Why does changing a name matter? IaC built
    with *evolvability* as a principle minimizes the effort (time and cost) to change
    a system and the risk of failure for the change.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 这个例子似乎过于简单。为什么更改名称很重要？以 **可进化性** 为原则构建的IaC最小化了更改系统所需的努力（时间和成本）以及变更失败的风险。
- en: Definition The *principle of evolvability* ensures that you can change your
    infrastructure resources to accommodate system scale or growth while minimizing
    effort and risk of failure.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 **可进化性原则** 确保您可以在最小化努力和失败风险的情况下更改基础设施资源，以适应系统规模或增长。
- en: System evolution includes changes beyond minor ones, such as name changes. A
    more disruptive change in infrastructure architecture might involve a replacement
    of Google Cloud Bigtable with Amazon Elastic Map Reduce (EMR). The application
    requiring the replacement has been future-proofed using Apache HBase, an open
    source distributed database that supports both offerings and simply requires the
    database endpoint.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 系统进化包括除微小变更之外的变化，例如名称变更。在基础设施架构中可能涉及更颠覆性的变化，比如用Amazon Elastic Map Reduce (EMR)
    替换Google Cloud Bigtable。需要替换的应用程序已经使用Apache HBase进行了未来化，Apache HBase是一个支持两种提供方式的开源分布式数据库，只需数据库端点即可。
- en: We account for this evolution in the IaC by outputting the database endpoint
    to retrieve the application and completing the update behind the scenes by creating
    configurations for both offerings. After testing the Amazon Web Services (AWS)
    database, we output its endpoint for consumption by the application.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过输出数据库端点以检索应用程序，并在幕后创建配置以更新两种服务来在IaC中考虑这种演进。在测试了亚马逊网络服务（AWS）数据库后，我们输出其端点供应用程序使用。
- en: Note I do not fully cover the theory behind evolving your architecture in this
    book. I highly recommend *Building Evolutionary Architectures* by Neal Ford et
    al. (O’Reilly, 2017) if you want to learn more. The book discusses how to build
    your infrastructure architecture to account for changes.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，本书并未全面涵盖演进架构背后的理论。如果你想要了解更多，我强烈推荐Neal Ford等人所著的《构建演进式架构》（O’Reilly，2017）。这本书讨论了如何构建你的基础设施架构以适应变化。
- en: You might find yourself struggling to evolve your system because you have not
    used patterns and practices that allow it to change. Useful IaC focuses on techniques
    to facilitate future evolution. Many of the chapters in this book demonstrate
    patterns that help maintain evolvability and minimize the impact of changes to
    critical systems.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会发现自己难以演进你的系统，因为你没有使用允许其变化的模式和最佳实践。有用的IaC专注于促进未来演进的技巧。本书中的许多章节都展示了有助于保持可演进性和最小化对关键系统变更影响的模式。
- en: 1.3.5 Applying the principles
  id: totrans-155
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.5 应用原则
- en: Reproducibility, idempotency, composability, and evolvability seem specific
    in their definitions. However, they all help constrain your infrastructure architecture
    and define the behavior of many IaC tools. Your IaC must align with all four principles
    to scale, collaborate, and change your company. Figure 1.11 summarizes these four
    important principles and their definitions.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 可重复性、幂等性、组合性和可演进性在定义上似乎很具体。然而，它们都帮助约束你的基础设施架构并定义了许多IaC工具的行为。你的IaC必须与所有四个原则一致才能扩展、协作和改变你的公司。图1.11总结了这四个重要原则及其定义。
- en: '![](../../OEBPS/Images/CH01_F11_Wang.png)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![](../../OEBPS/Images/CH01_F11_Wang.png)'
- en: Figure 1.11 IaC should be reproducible, idempotent, composable, and evolvable.
    You can ask yourself a series of questions to determine whether your IaC conforms
    to all four principles.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.11 IaC应该是可重复的、幂等的、可组合的和可演进的。你可以问自己一系列问题来确定你的IaC是否符合所有四个原则。
- en: As you write IaC, ask whether you conform to all four principles. These principles
    help you write and share your IaC with less effort and ideally minimize the impact
    of changes to your system. A missing principle can hinder updates to infrastructure
    resources or increase the blast radius of potential failure.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 在编写IaC时，请思考你是否符合所有四个原则。这些原则帮助你更轻松地编写和分享IaC，并理想情况下最小化对系统变更的影响。缺失的原则可能会阻碍基础设施资源的更新或增加潜在失败的影响范围。
- en: 'As you practice IaC, ask whether your configuration or tools align with the
    practices. For example, ask the following questions about your tool:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 在练习基础设施即代码（IaC）时，请思考你的配置或工具是否与最佳实践相符合。例如，对你的工具提出以下问题：
- en: Does the tool allow you to re-create entire environments?
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工具是否允许你重新创建整个环境？
- en: What happens when you rerun the tool to enforce configuration?
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当你重新运行工具以强制配置时会发生什么？
- en: Can you mix and match various configuration snippets to make a new set of infrastructure
    components?
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你能否混合和匹配各种配置片段来创建一组新的基础设施组件？
- en: Does the tool offer capabilities to help you evolve an infrastructure resource
    without impacting other systems?
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工具是否提供帮助你在不影响其他系统的情况下演进基础设施资源的功能？
- en: This book uses the principles to answer these questions and provide you with
    the skills to test, upgrade, and deploy infrastructure with resiliency and scalability
    in mind.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 本书使用这些原则来回答这些问题，并为你提供考虑弹性和可扩展性的技能来测试、升级和部署基础设施。
- en: Exercise 1.1
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 练习1.1
- en: Choose an infrastructure script or configuration in your organization. Assess
    whether it adheres to the principles of IaC. Does it promote reproducibility,
    use idempotency, help with composability, and ease evolvability?
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 选择你组织中的一个基础设施脚本或配置。评估它是否遵循IaC的原则。它是否促进可重复性、使用幂等性、帮助组合性和简化可演进性？
- en: See appendix B for answers to exercises.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 请参阅附录B以获取练习的答案。
- en: 1.4 Why use infrastructure as code?
  id: totrans-169
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.4 为什么使用基础设施即代码？
- en: IaC is typically considered a DevOps practice. However, you don’t have to be
    applying DevOps across your entire organization to use it. You still want to manage
    your infrastructure in a way that reduces the change failure rate and mean time
    to resolution (MTTR), so you can sleep in on the weekends as an operator or spend
    more time writing code as a developer. There are a few reasons to use IaC, even
    if you think you don’t need it.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: IaC通常被认为是一种DevOps实践。然而，你不必在整个组织中应用DevOps就可以使用它。你仍然希望以减少变更失败率和平均恢复时间（MTTR）的方式来管理你的基础设施，这样你就可以在周末睡懒觉，或者作为开发者有更多时间编写代码。即使你认为你不需要它，也有几个原因要使用IaC。
- en: 1.4.1 Change management
  id: totrans-171
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.4.1 变更管理
- en: You might experience a sinking feeling when you’ve applied a change to certain
    infrastructure, only to realize that someone reported it broke something. Organizations
    try to prevent this with *change management*, a set of steps and reviews to ensure
    that your changes do not affect production. The process often includes a change
    review board to review the changes, or change windows to block off time to execute
    the change.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 当你将变更应用到某些基础设施上，却意识到有人报告说它破坏了某些东西时，你可能会感到一种沉没感。组织试图通过*变更管理*来防止这种情况，这是一系列步骤和审查，以确保你的变更不会影响生产。这个过程通常包括一个变更审查委员会来审查变更，或者变更窗口来封锁执行变更的时间。
- en: Definition *Change management* outlines a set of steps and reviews that you
    take in your company to implement changes in production and prevent their failure.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 定义*变更管理*概述了你在公司中采取的一系列步骤和审查，以在生产中实施变更并防止其失败。
- en: However, no change is risk-free. Applying IaC practices can mitigate the risk
    of a change by modularizing your infrastructure (chapter 3) and rolling forward
    changes (chapter 11) to limit the blast radius.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，没有任何变更是没有风险的。通过模块化你的基础设施（第3章）和向前滚动变更（第11章）来限制影响范围，应用IaC实践可以减轻变更的风险。
- en: In one regretful instance, I ignored my intuition to use IaC to mitigate the
    risk of a change. I had to roll out a new binary to servers, which required them
    to restart a set of dependent services. I wrote a script, asked my teammate to
    check it, and had the change review board sign off to run it. After applying and
    verifying the change over the weekend, I came in on Monday to several messages
    telling me servers supporting a reconciliation application went down overnight.
    My teammate traced it to an older operating system incompatibility with the dependencies
    in my script.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个令人遗憾的例子中，我忽视了使用基础设施即代码（IaC）来减轻变更风险的直觉。我不得不在服务器上推出一个新的二进制文件，这要求它们重新启动一系列依赖服务。我编写了一个脚本，让我的队友检查它，并让变更审查委员会签字批准运行它。在周末应用并验证变更后，我周一来到办公室，看到几条消息告诉我支持对账应用程序的服务器在夜间崩溃。我的队友追踪到我的脚本中的依赖与较旧操作系统的不兼容性。
- en: 'In retrospect, IaC could have mitigated the risk of the change. When I applied
    the RICE principles to the change, I realized that I forgot the following:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 回顾过去，IaC本可以减轻变更的风险。当我将RICE原则应用到变更上时，我意识到我忘记了以下内容：
- en: '*Reproducibility*—I did not reproduce my script on various test instances mimicking
    the various servers.'
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*可重复性*——我没有在模拟各种服务器的各种测试实例上重复我的脚本。'
- en: '*Idempotency*—I did not include logic to check the operating system before
    running the command.'
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*幂等性*——我没有在运行命令之前检查操作系统的逻辑。'
- en: '*Composability*—I did not limit the blast radius of the change to a small set
    of less critical servers.'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*可组合性*——我没有将变更的影响范围限制在少量不太关键的服务器上。'
- en: '*Evolvability*—I did not update the servers with a newer operating system and
    reduce variation across the infrastructure.'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*可进化性*——我没有更新服务器以使用较新的操作系统并减少基础设施中的差异。'
- en: Reducing variation allows for infrastructure evolution and risk mitigation because
    the actual configuration matches the one you expect during your automation, making
    changes more straightforward and reliable to apply. We’ll discuss how to fit IaC
    into your change management process in chapter 7.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 减少差异允许基础设施进化和风险缓解，因为实际的配置与你在自动化过程中期望的配置相匹配，使变更更加直接和可靠地应用。我们将在第7章讨论如何将IaC融入你的变更管理流程。
- en: 1.4.2 Return on time investment
  id: totrans-182
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.4.2 时间投资回报
- en: IaC and time investment can be challenging to justify, especially if your devices
    or hardware do not have suitable automation interfaces. In addition to a lack
    of easy automation, it can be difficult to justify spending time automating a
    task that you do only once a year or even a decade. While IaC might take extra
    time to implement, it lowers the time to execute changes in the long term. How
    exactly does that work?
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: IaC和时间投资可能难以证明其合理性，特别是如果你的设备或硬件没有合适的自动化接口。除了缺乏易于自动化的接口外，自动化一年或十年才做一次的任务可能也难以证明花费时间进行自动化是合理的。虽然IaC可能需要额外的时间来实现，但它从长远来看降低了执行变更所需的时间。这究竟是如何工作的呢？
- en: Imagine you need to update the same package on 10 servers. You used to do this
    without IaC. You’d manually log in, update the package, verify that everything
    works, fix errors, and move to the next one. On average, you’d spend 10 hours
    updating the servers.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下，你需要更新10台服务器上的相同软件包。你以前没有使用IaC来做这件事。你会手动登录，更新软件包，验证一切是否正常工作，修复错误，然后转到下一台。平均来说，你会在更新服务器上花费10个小时。
- en: Figure 1.12 shows that changes made without IaC have a constant level of effort
    over time. If you have additional changes, you may spend a few more hours fixing
    or updating the system. A failed change might mean you spend more effort over
    several days to fix the system.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.12显示，没有IaC的变更在时间上具有恒定的努力水平。如果你有额外的变更，你可能需要花费几个小时来修复或更新系统。一个失败的变更可能意味着你需要在几天内花费更多努力来修复系统。
- en: You decide to invest time into building IaC for these servers (the solid line
    in figure 1.12). You reduce the servers’ configuration drift, which takes about
    40 hours. After your initial time investment, you spend less than 5 minutes updating
    all of the servers each time you make the change.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 你决定为这些服务器（图1.12中的实线）投入时间来构建IaC。你减少了服务器的配置漂移，这大约需要40个小时。在你进行初步时间投资之后，每次进行更改时，你只需花费不到5分钟来更新所有服务器。
- en: Why bother understanding the relationship between time and effort for IaC? Prevention
    helps reduce the effort of remediation. Without IaC, you might find yourself spending
    weeks trying to remediate a major system outage. You typically spend those weeks
    trying to reverse engineer the manual changes, revert specific changes, or at
    worst, building a new system from scratch.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么需要理解基础设施即代码（IaC）中时间和努力之间的关系呢？预防有助于减少修复工作的努力。如果没有IaC，你可能会发现自己花费数周时间来修复主要系统故障。你通常会在那几周内尝试逆向工程手动更改，撤销特定更改，或者在最糟糕的情况下，从头开始构建一个新的系统。
- en: '![](../../OEBPS/Images/CH01_F12_Wang.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH01_F12_Wang.png)'
- en: Figure 1.12 IaC requires less effort over time after the high initial automation
    effort. Without IaC, time to execute changes can be highly variable.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.12 在经历初期的高自动化努力后，IaC随时间推移所需的工作量减少。没有IaC，执行变更所需的时间可能高度可变。
- en: You *must* make an initial investment in writing IaC, even if it seems steep.
    This investment helps you over time as you spend less time debugging failed configurations
    or recovering broken systems in the long term. If your system completely fails
    one day, you can reproduce it easily by running your IaC.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 你*必须*在编写IaC上进行初步投资，即使这看起来成本很高。随着时间的推移，这项投资会帮助你，因为你将花费更少的时间调试失败的配置或恢复损坏的系统。如果你的系统有一天完全失败，你可以通过运行你的IaC轻松地重新创建它。
- en: The automation and tests encourage predictability and limit the blast radius
    of a failure change. They lower the change failure rate and MTTR of failed systems.
    As your infrastructure system evolves and scales, you can use the detailed testing
    practices covered in this book to improve the change failure rate in your system
    and alleviate the burden of future changes.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 自动化和测试鼓励可预测性，并限制失败变更的影响范围。它们降低了失败系统的变更失败率和平均修复时间（MTTR）。随着你的基础设施系统发展和扩展，你可以使用本书中涵盖的详细测试实践来提高你系统中变更的失败率，并减轻未来变更的负担。
- en: 1.4.3 Knowledge sharing
  id: totrans-192
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.4.3 知识共享
- en: IaC communicates infrastructure architecture and configuration, which helps
    reduce human error and improve reliability. An engineer once told me, “We don’t
    need to do IaC for a network switch for a tertiary passive data center (used for
    backup). It’s just me configuring stuff anyway, and we’d only need to make this
    change once and never touch it again.”
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: IaC传达基础设施架构和配置，这有助于减少人为错误并提高可靠性。一位工程师曾告诉我：“我们不需要为三级被动数据中心（用于备份）的网络交换机做IaC。反正都是我在配置东西，而且我们只需要做一次这个更改，之后再也不用碰它了。”
- en: The engineer left the organization shortly after configuring the switch. Later,
    my team needed to convert the tertiary passive data center to an active data center
    for compliance requirements. In a panic, we scrambled to reverse engineer the
    configuration on the switch. It took us a good part of two months to figure out
    the network connection, rework its configuration, and manage it with IaC.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 工程师在配置开关后不久就离开了组织。后来，我的团队需要将三级被动数据中心转换为活动数据中心以满足合规性要求。在恐慌中，我们匆忙逆向工程开关上的配置。我们花了大约两个月的时间来弄清楚网络连接，重新配置其配置，并使用IaC进行管理。
- en: Even if a task seems particularly obscure or the team configuring infrastructure
    consists of one person, investing the time and effort to approach infrastructure
    configuration in an “as code” manner can help accommodate evolution, especially
    as infrastructure systems and teams scale. You’ll find that you spend more time
    remembering how you configured the obscure switch when someone reports an outage
    or when teaching the server configuration to a new team member.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 即使一项任务看起来特别晦涩，或者配置基础设施的团队只有一个人，投入时间和精力以“代码即文档”的方式处理基础设施配置，可以帮助适应变化，尤其是在基础设施系统和团队规模扩大时。你会发现，当有人报告故障或向新团队成员教授服务器配置时，你会花更多时间记住如何配置那个晦涩的开关。
- en: Writing a task “as code,” also known as *code as documentation*, communicates
    the expected state of the infrastructure and the system’s architecture.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 将任务“编写为代码”，也称为“代码即文档”，传达了基础设施和系统架构的预期状态。
- en: Definition *Code as documentation* ensures that the code communicates the intent
    of the software or system without the need for additional reference documentation.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 定义：“代码即文档”确保代码在无需额外参考文档的情况下传达软件或系统的意图。
- en: Someone unfamiliar with the system should examine the infrastructure configuration
    and understand its intent. You cannot expect all code to serve as documentation
    from a practical standpoint. However, the code should reflect most of your infrastructure
    architecture and system expectations.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 对于不熟悉该系统的某人来说，应检查基础设施配置并理解其意图。你不能期望所有代码从实用角度来说都能作为文档。然而，代码应反映你大部分的基础设施架构和系统期望。
- en: 1.4.4 Security
  id: totrans-199
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.4.4 安全性
- en: Auditing and checking for insecure configurations in IaC can highlight security
    concerns earlier in the development process. You hear this as *shifting security
    left*. If you incorporate security checks earlier in the process, you find fewer
    vulnerabilities when the system configuration runs in production. You’ll learn
    more about security patterns and practices in chapter 8.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 在IaC中审计和检查不安全的配置可以突出显示开发过程中的早期安全关注。您听到的是“左移安全”。如果在流程中较早地纳入安全检查，当系统配置在生产环境中运行时，您会发现更少的漏洞。您将在第8章中了解更多关于安全模式和惯例的知识。
- en: For example, you might temporarily increase access to an object store such that
    anyone can write and read from it in development. You push it to production. However,
    some of the objects in the store allow everyone to write to and read from them.
    While this seems like a simple mistake, the configuration has grave implications
    if the store contains customer data.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，您可能暂时增加对对象存储的访问权限，以便任何人在开发中都可以读写。您将其推送到生产环境。然而，存储中的一些对象允许每个人都可以读写。虽然这看起来像是一个简单的错误，但如果存储包含客户数据，配置的影响将是严重的。
- en: Note For more examples of insecure infrastructure configuration, you can search
    the news for a misconfigured object store that exposed driver’s license information
    or even a database with a default password that revealed millions of consumer
    credit cards. Some security breaches involve legitimate vulnerabilities, but many
    involve insecure configuration. Organizations that prevent these misconfigurations
    in the first place can usually quickly examine configuration, audit access control,
    assess the blast radius, and remediate the breach.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：要了解更多不安全的配置示例，您可以在新闻中搜索一个配置错误的对象存储，该存储泄露了驾驶执照信息，甚至是一个默认密码泄露了数百万张消费者信用卡的数据库。一些安全漏洞涉及合法漏洞，但许多涉及不安全的配置。那些一开始就防止这些误配置的组织通常可以快速检查配置、审计访问控制、评估影响范围，并修复漏洞。
- en: IaC simplifies access control by expressing it in a single configuration. With
    IaC, you can test the configuration to ensure that the object store does not allow
    public access. Furthermore, you can include a production check to verify that
    your policy allows only read access to specific objects. Even security policies
    in a data center, such as firewall rules, can be expressed in IaC and audited
    to ensure that its rules allow only inbound connections from known sources.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: IaC 通过在单个配置中表达来简化访问控制。使用 IaC，你可以测试配置以确保对象存储不允许公开访问。此外，你可以包括生产检查以验证你的策略只允许对特定对象的读取访问。甚至数据中心中的安全策略，如防火墙规则，也可以用
    IaC 表达并审计，以确保其规则只允许来自已知来源的入站连接。
- en: If you experience a security breach, IaC allows you to examine configuration,
    audit access control quickly, assess the blast radius, and remediate the breach.
    You can use the same IaC practices to make all sorts of changes. You’ll discover
    some practices in this book to help audit and secure your infrastructure in adherence
    to IaC principles.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你遇到安全漏洞，IaC 允许你检查配置，快速审计访问控制，评估影响范围，并修复漏洞。你可以使用相同的 IaC 实践来做出各种更改。你将在本书中找到一些实践，以帮助根据
    IaC 原则审计和确保你的基础设施的安全。
- en: 1.5 Tools
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.5 工具
- en: 'IaC tooling varies quite widely because it applies to various resources. Most
    tools fall into one of three use cases, all of which address very different functions
    and vary widely in behavior, including the following:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: IaC 工具因应用于各种资源而差异很大。大多数工具属于以下三种用例之一，所有这些用例都解决非常不同的功能，并且在行为上差异很大，包括以下内容：
- en: Provisioning
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置部署
- en: Configuration management
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置管理
- en: Image building
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 镜像构建
- en: In this book, I primarily focus on tools used for provisioning, which deploy
    and manage sets of infrastructure resources. I include some sidebars and examples
    in configuration management and image building to highlight differences in approach.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我主要关注用于配置的工具体，这些工具部署和管理一组基础设施资源。我还包括一些配置管理和镜像构建的侧边栏和示例，以突出方法上的差异。
- en: 1.5.1 Examples in this book
  id: totrans-211
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.5.1 本书中的示例
- en: In this book, I faced a challenge to build concrete examples agnostic of tools
    or platforms. As a patterns and practices book, I needed to find a way to express
    the concepts in a general programming language without rewriting the logic of
    a tool.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我面临了一个挑战，即构建与工具或平台无关的具体示例。作为模式和惯例的书籍，我需要找到一种方法，在通用编程语言中表达概念，而不需要重写工具的逻辑。
- en: Python and Terraform
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: Python 和 Terraform
- en: Figure 1.13 outlines the workflow of the code listings and examples. For more
    information, appendix A details the technical implementation. I wrote the code
    listings in Python to create a JavaScript Object Notation (JSON) file consumed
    by HashiCorp Terraform, a provisioning tool with various integrations across public
    clouds and other infrastructure providers.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.13 概述了代码列表和示例的工作流程。更多技术实现信息，请参阅附录 A。我使用 Python 编写代码列表，以创建 HashiCorp Terraform
    消费的 JavaScript 对象表示法 (JSON) 文件，这是一个具有跨公共云和其他基础设施提供商各种集成的配置工具。
- en: '![](../../OEBPS/Images/CH01_F13_Wang.png)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH01_F13_Wang.png)'
- en: Figure 1.13 This book’s examples use Python to create a JSON file that Terraform
    can consume.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.13 本书示例使用 Python 创建 Terraform 可以消费的 JSON 文件。
- en: When you run the Python script by using `python run.py`, the code creates a
    JSON file with the file extension *.tf.json. The JSON file uses syntax specific
    to Terraform. Then you can go into the directory with the *.tf.json file and run
    `terraform` `init` and `terraform` `apply` to create the resources. While the
    Python code seems to add unnecessary abstraction, it ensures that I can offer
    concrete examples agnostic of platform and tool.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 当你使用 `python run.py` 运行 Python 脚本时，代码会创建一个扩展名为 *.tf.json 的 JSON 文件。该 JSON 文件使用
    Terraform 特定的语法。然后你可以进入包含 *.tf.json 文件的目录，并运行 `terraform init` 和 `terraform apply`
    来创建资源。虽然 Python 代码看起来增加了不必要的抽象，但它确保我可以提供与平台和工具无关的具体示例。
- en: I recognize that the complexity of this workflow seems nonsensical. However,
    it serves two purposes. The Python files provide a generalized implementation
    of patterns and practices with a programming language. The JSON configuration
    allows you to run and create the resources with a tool instead of me writing in
    abstractions.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 我认识到这个工作流程的复杂性似乎没有意义。然而，它有两个目的。Python 文件提供了编程语言的通用模式和惯例的实现。JSON 配置允许你使用工具而不是我编写抽象来运行和创建资源。
- en: 'Note You can find the complete code examples at this book’s code repository:
    [https://github.com/joatmon08/manning-book](https://github.com/joatmon08/manning-book).'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：你可以在本书的代码库中找到完整的代码示例：[https://github.com/joatmon08/manning-book](https://github.com/joatmon08/manning-book)。
- en: You do not have to know Python or Terraform in depth to understand the code
    examples. If you would like to run the examples and create the resources, I recommend
    reviewing an introductory tutorial to Terraform or Python for syntax and commands.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 你不需要深入了解Python或Terraform就能理解代码示例。如果你想运行示例并创建资源，我建议你回顾一下Terraform或Python的入门教程，以了解语法和命令。
- en: Note You can find numerous resources on Terraform and Python. Check out *Terraform
    in Action* by Scott Winkler (Manning, 2021), *The Quick Python Book* by Naomi
    R. Cedar (Manning, 2018), or *Python Workout* by Reuven M. Lerner (Manning, 2020).
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：你可以在Terraform和Python的众多资源中找到。查看Scott Winkler的《Terraform in Action》（Manning，2021年），Naomi
    R. Cedar的《The Quick Python Book》（Manning，2018年），或Reuven M. Lerner的《Python Workout》（Manning，2020年）。
- en: Google Cloud Platform
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: Google Cloud Platform
- en: While AWS or Microsoft Azure may be more popular choices at publication, I decided
    to use Google Cloud Platform (GCP) as the primary cloud provider for three main
    reasons. First, GCP requires overall fewer resources to achieve a similar architecture.
    This reduces the verbosity of the examples and focuses on the pattern and approach
    instead of the configuration.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然AWS或Microsoft Azure可能在出版时更为流行，但我决定使用Google Cloud Platform（GCP）作为主要云提供商，主要有三个原因。首先，GCP需要更少的资源来实现类似的架构。这减少了示例的冗长性，并专注于模式和途径，而不是配置。
- en: Second, GCP’s offerings use more straightforward naming and generic infrastructure
    terminology. If you work in a data center, you’ll still be able to recognize what
    the services create. For example, Google Cloud SQL creates SQL databases.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，GCP的提供的服务使用更直接的命名和通用的基础设施术语。如果你在数据中心工作，你仍然能够识别出服务创建的内容。例如，Google Cloud SQL创建SQL数据库。
- en: 'If you run the examples, you will use the following resources in GCP:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你运行示例，你将在GCP中使用以下资源：
- en: Networking (networks, load balancers, and firewalls)
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络管理（网络、负载均衡器和防火墙）
- en: Compute
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计算
- en: Managed queues (Pub/Sub)
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理队列（Pub/Sub）
- en: Storage (Cloud Storage)
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储（Cloud Storage）
- en: Identity and access management (IAM)
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 身份和访问管理（IAM）
- en: Kubernetes offerings (Kubernetes Engine and Cloud Run)
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kubernetes提供的服务（Kubernetes Engine和Cloud Run）
- en: Database (Cloud SQL)
  id: totrans-232
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库（Cloud SQL）
- en: You *do not* have to know the details of each service. I use them to demonstrate
    dependency management between infrastructure resources. I avoided using specialized
    services that are different for each cloud platform, such as machine learning.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 你*不需要*了解每个服务的细节。我使用它们来演示基础设施资源之间的依赖关系管理。我避免了使用每个云平台都不同的专用服务，例如机器学习。
- en: AWS and Azure equivalents
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: AWS和Azure等效
- en: Each example includes sidebars on equivalent AWS and Azure service offerings
    to further solidify specific patterns and techniques. To update the examples for
    the cloud provider of your choice, you may need to do some language replacements
    and change some of your dependencies. For example, you can create GCP networks
    with built-in gateways, while you must explicitly build them in AWS networks.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 每个示例都包括与等效的AWS和Azure服务提供的侧边栏，以进一步巩固特定的模式和技巧。为了更新为你选择的云提供商的示例，你可能需要进行一些语言替换并更改一些依赖项。例如，你可以使用内置网关创建GCP网络，而在AWS网络中你必须明确构建它们。
- en: Some examples have an AWS equivalent in the book’s code repository ([https://github.com/joatmon08/manning-book](https://github.com/joatmon08/manning-book)).
    You’ll also find more information on setting up AWS or Azure to run with examples
    in appendix A.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 书中的代码库中有一些示例具有AWS等效版本（[https://github.com/joatmon08/manning-book](https://github.com/joatmon08/manning-book)）。你还可以在附录A中找到有关设置AWS或Azure以与示例一起运行的更多信息。
- en: The third reason I wrote the examples in GCP involves cost. GCP offers a free
    usage tier. If you create a new account with GCP, you will receive a free trial
    of up to $300 (at time of publication). You can use offerings in the free usage
    tier if you have an existing account. I note any required resources that do not
    qualify for the free usage tier at the time of publication.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 第三个原因是我选择在GCP中编写示例涉及成本。GCP提供免费使用层。如果你使用GCP创建新账户，你将获得高达$300的免费试用（截至出版时）。如果你已有账户，你可以使用免费使用层中的服务。我会在出版时注明任何不符合免费使用层的所需资源。
- en: Using Google Cloud Platform
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Google Cloud Platform
- en: For more information on GCP’s free program, refer to its program web page at
    [https://cloud.google.com/free](https://cloud.google.com/free).
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 有关GCP免费计划的更多信息，请参阅其计划网页 [https://cloud.google.com/free](https://cloud.google.com/free)。
- en: I recommend creating a separate GCP project to run all of the examples. A separate
    project will isolate your resources. When you finish this book, you can delete
    the project and its resources. Review the tutorial for creating GCP projects at
    [http://mng.bz/e7QG](http://mng.bz/e7QG).
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 我建议创建一个单独的GCP项目来运行所有示例。单独的项目将隔离您的资源。当您完成这本书后，您可以删除项目及其资源。请参阅创建GCP项目的教程 [http://mng.bz/e7QG](http://mng.bz/e7QG)。
- en: 1.5.2 Provisioning
  id: totrans-241
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.5.2 配置
- en: '*Provisioning* *tools* create and manage sets of infrastructure resources for
    a given provider, whether it’s a public cloud, data center, or hosted monitoring
    solution. A *provider* refers to a data center, IaaS, PaaS, or SaaS responsible
    for providing infra-structure resources.'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: '*配置* *工具*为特定提供者创建和管理一组基础设施资源，无论是公共云、数据中心还是托管监控解决方案。*提供者*指的是负责提供基础设施资源的数据中心、IaaS、PaaS或SaaS。'
- en: Definition A *provisioning tool* creates and manages a set of infrastructure
    resources for a public cloud, data center, or hosted monitoring solution.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 A *配置工具*为公共云、数据中心或托管监控解决方案创建和管理一组基础设施资源。
- en: Some provisioning tools work with only a specific provider, while others integrate
    with multiple providers (table 1.1).
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 一些配置工具仅与特定提供者合作，而其他工具则与多个提供者集成（表1.1）。
- en: Table 1.1 Examples of provisioning tools and providers
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 表1.1 配置工具和提供者示例
- en: '| Tool | Provider |'
  id: totrans-246
  prefs: []
  type: TYPE_TB
  zh: '| 工具 | 提供者 |'
- en: '| AWS CloudFormation | Amazon Web Services |'
  id: totrans-247
  prefs: []
  type: TYPE_TB
  zh: '| AWS CloudFormation | 亚马逊网络服务|'
- en: '| Google Cloud Deployment Manager | Google Cloud Platform |'
  id: totrans-248
  prefs: []
  type: TYPE_TB
  zh: '| Google Cloud Deployment Manager | Google Cloud Platform |'
- en: '| Azure Resource Manager | Microsoft Azure |'
  id: totrans-249
  prefs: []
  type: TYPE_TB
  zh: '| Azure Resource Manager | 微软Azure |'
- en: '| Bicep | Microsoft Azure |'
  id: totrans-250
  prefs: []
  type: TYPE_TB
  zh: '| Bicep | 微软Azure|'
- en: '| HashiCorp Terraform | Various (for a complete list, see [www.terraform.io/docs/providers/index.xhtml](http://www.terraform.io/docs/providers/index.xhtml))
    |'
  id: totrans-251
  prefs: []
  type: TYPE_TB
  zh: '| HashiCorp Terraform | 各种（完整列表，请参阅 [www.terraform.io/docs/providers/index.xhtml](http://www.terraform.io/docs/providers/index.xhtml))
    |'
- en: '| Pulumi | Various (for a complete list, see [www.pulumi.com/docs/intro/cloud-providers/](http://www.pulumi.com/docs/intro/cloud-providers/))
    |'
  id: totrans-252
  prefs: []
  type: TYPE_TB
  zh: '| Pulumi | 各种（完整列表，请参阅 [www.pulumi.com/docs/intro/cloud-providers/](http://www.pulumi.com/docs/intro/cloud-providers/))
    |'
- en: '| AWS Cloud Development Kit | Amazon Web Services |'
  id: totrans-253
  prefs: []
  type: TYPE_TB
  zh: '| AWS Cloud Development Kit | 亚马逊网络服务|'
- en: '| Kubernetes manifests | Kubernetes (container orchestrator) |'
  id: totrans-254
  prefs: []
  type: TYPE_TB
  zh: '| Kubernetes 清单 | Kubernetes（容器编排器）|'
- en: Most provisioning tools can preview changes to a system and express dependencies
    between infrastructure resources, also known as a *dry run*.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数配置工具可以预览系统更改，并表达基础设施资源之间的依赖关系，这被称为*干运行*。
- en: Definition A *dry run* analyzes and outputs expected changes to infrastructure
    before you apply the changes to resources.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 A *干运行*在您将更改应用到资源之前分析并输出预期的基础设施更改。
- en: For example, you can express a dependency between a network and a server. If
    you change the network, the provisioning tool will show that the server may also
    change.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，您可以表达网络和服务器之间的依赖关系。如果您更改网络，配置工具将显示服务器也可能更改。
- en: 1.5.3 Configuration management
  id: totrans-258
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.5.3 配置管理
- en: '*Configuration* *management* tools ensure that servers and computer systems
    run in the desired state. Most configuration management tools excel at device
    configuration, such as server installation and maintenance.'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: '*配置* *管理*工具确保服务器和计算机系统运行在所需的状态。大多数配置管理工具在设备配置方面表现卓越，例如服务器安装和维护。'
- en: Definition A *configuration management tool* configures a set of servers or
    resources for the packages and attributes hosted on them.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 A *配置管理工具*配置一组服务器或资源上的软件包和属性。
- en: For example, if you have 10,000 servers in your data center, how do you ensure
    that all of them run a specific version of the packages your security team approved?
    It does not scale for you to log into 10,000 servers and manually type commands
    to review. If you configure the servers with a configuration management tool,
    you can run a single command to review all 10,000 servers and execute the packages’
    updates.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果您数据中心有10,000台服务器，您如何确保它们都运行您安全团队批准的特定版本的软件包？手动登录10,000台服务器并手动输入命令来审查是不切实际的。如果您使用配置管理工具配置服务器，您只需运行一个命令即可审查所有10,000台服务器并执行软件包的更新。
- en: 'A non-exhaustive list of configuration management tools that address this problem
    space includes the following:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 解决此问题空间的一些配置管理工具的非详尽列表包括以下内容：
- en: Chef
  id: totrans-263
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Chef
- en: Puppet
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Puppet
- en: Red Hat Ansible
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Red Hat Ansible
- en: Salt
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Salt
- en: CFEngine
  id: totrans-267
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CFEngine
- en: While this book focuses on provisioning tools and managing multiprovider systems,
    I will address some configuration management practices related to infrastructure
    testing, updating infrastructure, and security. Configuration management can help
    tune your server and network infrastructure.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这本书侧重于供应工具和管理多提供者系统，但我将讨论一些与基础设施测试、更新基础设施和安全相关的配置管理实践。配置管理可以帮助调整你的服务器和网络基础设施。
- en: Note I recommend books and tutorials for a configuration management tool of
    your choice for additional information. They will provide a more detailed guide
    specific to their design approach.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：我推荐你选择配置管理工具的书籍和教程以获取更多信息。它们将提供针对其设计方法的更详细指南。
- en: To add to the confusion, you might notice that some configuration management
    tools offer integrations with the data center and cloud providers. As a result,
    you might think of using your configuration tool as your provisioning tool. While
    possible, this approach may not be ideal because provisioning tools often have
    a different design approach for specifically addressing dependencies among infrastructure
    resources. I explore this nuance in the next chapter.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 为了增加混乱，你可能注意到一些配置管理工具提供了与数据中心和云提供商的集成。因此，你可能会考虑将你的配置工具作为供应工具使用。虽然这是可能的，但这种方法可能不是最佳选择，因为供应工具通常针对基础设施资源之间的依赖关系具有不同的设计方法。我将在下一章探讨这个细微差别。
- en: 1.5.4 Image building
  id: totrans-271
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.5.4 形象构建
- en: When you create a server, you must specify a machine image with an operating
    system. *Image-building* tools create images used for application runtime, whether
    a container or server.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 当你创建服务器时，你必须指定一个带有操作系统的机器镜像。*形象构建*工具创建用于应用程序运行时的镜像，无论是容器还是服务器。
- en: Definition An *image-building tool* builds machine images for application runtimes,
    such as containers or servers.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 定义：*形象构建工具*用于为应用程序运行时构建机器镜像，例如容器或服务器。
- en: Most image builders allow you to specify a runtime environment and build targets.
    Table 1.2 outlines a few tools, their supported runtime environments, and their
    build targets and platforms.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数形象构建工具允许你指定运行环境和构建目标。表1.2概述了一些工具、它们支持的运行环境以及它们的构建目标和平台。
- en: Table 1.2 Examples of image builders and providers
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 表1.2形象构建工具和提供者的示例
- en: '| Tool | Runtime environment | Build target |'
  id: totrans-276
  prefs: []
  type: TYPE_TB
  zh: '| 工具 | 运行环境 | 构建目标 |'
- en: '| HashiCorp Packer | Containers and servers | Various (for a complete list,
    see [www.packer.io/docs/builders](https://www.packer.io/docs/builders)) |'
  id: totrans-277
  prefs: []
  type: TYPE_TB
  zh: '| HashiCorp Packer | 容器和服务器 | 各种（完整列表请参阅[www.packer.io/docs/builders](https://www.packer.io/docs/builders)）
    |'
- en: '| Docker | Containers | Container registries |'
  id: totrans-278
  prefs: []
  type: TYPE_TB
  zh: '| Docker | 容器 | 容器注册库 |'
- en: '| EC2 Image Builder | Servers | Amazon Web Services |'
  id: totrans-279
  prefs: []
  type: TYPE_TB
  zh: '| EC2 Image Builder | 服务器 | 亚马逊网络服务 |'
- en: '| Azure VM Image Builder | Servers | Microsoft Azure |'
  id: totrans-280
  prefs: []
  type: TYPE_TB
  zh: '| Azure VM Image Builder | 服务器 | 微软Azure |'
- en: I do not include detailed discussions on image building in this book. However,
    the patterns for testing, delivery, and compliance do have sidebars for image
    building in chapters 6–8\. In the next chapter, you’ll learn about immutability,
    a critical paradigm that informs the approach of image builders.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 我在这本书中不包括关于形象构建的详细讨论。然而，第6至8章中测试、交付和合规性的模式确实有关于形象构建的边栏。在下一章中，你将了解不可变性，这是一个对形象构建者方法至关重要的范例。
- en: Figure 1.14 shows how image building, configuration management, and provisioning
    tools work together. The process of deploying a new server configuration often
    starts with a configuration management tool, as you start building the foundations
    and testing whether your server configuration is correct.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.14展示了形象构建、配置管理和供应工具是如何协同工作的。部署新的服务器配置的过程通常从配置管理工具开始，正如你开始构建基础并测试你的服务器配置是否正确一样。
- en: After establishing the server configuration you want, you use an image builder
    to preserve the server’s image with its versioning and runtime. Finally, your
    provisioning tool references the image builder’s snapshot to create new production
    servers with the configuration you want.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 在确定你想要的服务器配置后，你使用形象构建工具来保存服务器的镜像及其版本和运行时。最后，你的供应工具引用形象构建器的快照来创建具有你想要配置的新生产服务器。
- en: '![](../../OEBPS/Images/CH01_F14_Wang.png)'
  id: totrans-284
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../../OEBPS/Images/CH01_F14_Wang.png)'
- en: Figure 1.14 Each type of IaC tool contributes to the life cycle of a server
    infrastructure resource, from configuration to image capture and deployment.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.14每种IaC工具都对服务器基础设施资源的生命周期做出贡献，从配置到镜像捕获和部署。
- en: This workflow represents the ideal end-to-end approach for managing and deploying
    servers with IaC tooling. However, as you will learn, infrastructure can be complex,
    and this workflow may not apply to every use case. Various infrastructure systems
    and their dependencies complicate provisioning, which I chose to be the primary
    focus of this book, and is why the examples use provisioning tools.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 此工作流程代表了使用基础设施即代码（IaC）工具管理和部署服务器的理想端到端方法。然而，正如你将学到的，基础设施可能很复杂，这个工作流程可能并不适用于每个用例。各种基础设施系统和它们的依赖关系使得配置变得复杂，这也是我选择将此作为本书主要关注点的原因，因此示例使用了配置工具。
- en: Summary
  id: totrans-287
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Infrastructure can be software, a platform, or hardware that delivers or deploys
    applications to production.
  id: totrans-288
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基础设施可以是软件、平台或硬件，它们将应用程序交付或部署到生产环境中。
- en: Infrastructure as code is a DevOps practice of automating infrastructure to
    achieve reliability, scalability, and security.
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基础设施即代码（Infrastructure as Code，简称IaC）是一种DevOps实践，旨在通过自动化基础设施来实现可靠性、可扩展性和安全性。
- en: The principles of IaC are reproducibility, idempotency, composability, and evolvability.
  id: totrans-290
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IaC的原则包括可重复性、幂等性、可组合性和可进化性。
- en: By following the principles of IaC, you can improve change management processes,
    lower time spent on fixing failed systems in the long term, better share knowledge
    and context, and build security into your infrastructure.
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过遵循IaC的原则，你可以改善变更管理流程，长期降低修复失败系统所花费的时间，更好地共享知识和上下文，并将安全性融入你的基础设施。
- en: IaC tools include provisioning, configuration management, and image-building
    tools.
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IaC工具包括配置、配置管理和镜像构建工具。
