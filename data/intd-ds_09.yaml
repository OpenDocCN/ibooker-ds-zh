- en: Appendix A. Setting up Elasticsearch
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 附录A. 设置Elasticsearch
- en: In this appendix, we’ll cover installing and setting up the Elasticsearch database
    used in [Chapters 6](kindle_split_014.xhtml#ch06) and [7](kindle_split_015.xhtml#ch07).
    Instructions for both Linux and Windows installations are included. Note that
    if you get into trouble or want further information on Elasticsearch, it has pretty
    decent documentation you can find located at [https://www.elastic.co/guide/en/elasticsearch/reference/1.4/setup.html](https://www.elastic.co/guide/en/elasticsearch/reference/1.4/setup.html).
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本附录中，我们将介绍安装和设置[第6章](kindle_split_014.xhtml#ch06)和[第7章](kindle_split_015.xhtml#ch07)中使用的Elasticsearch数据库。包括Linux和Windows安装的说明。注意，如果你遇到麻烦或需要有关Elasticsearch的更多信息，它有相当不错的文档，可以在[https://www.elastic.co/guide/en/elasticsearch/reference/1.4/setup.html](https://www.elastic.co/guide/en/elasticsearch/reference/1.4/setup.html)找到。
- en: '|  |'
  id: totrans-2
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-3
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: Elasticsearch is dependent on Java, so we’ll cover how to install that as well.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Elasticsearch依赖于Java，因此我们还将介绍如何安装Java。
- en: '|  |'
  id: totrans-5
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: A.1\. Linux installation
  id: totrans-6
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: A.1. Linux安装
- en: First check to see if you have Java already installed on your machine.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 首先检查你的机器上是否已经安装了Java。
- en: '**1**.  You can check your Java version in a console window with `java –version`.
    If Java is installed, you’ll see a response like the one in [figure A.1](#app01fig01).
    You’ll need at least Java 7 to run the version of Elasticsearch we use in this
    book (1.4). Note: Elasticsearch had moved on to version 2 by the time this book
    was released, but while code might change slightly, the core principles remain
    the same.'
  id: totrans-8
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**. 你可以在控制台窗口中使用`java –version`来检查你的Java版本。如果Java已安装，你将看到类似于[图A.1](#app01fig01)中的响应。你需要至少Java
    7来运行本书中使用的Elasticsearch版本（1.4）。注意：当本书发布时，Elasticsearch已经升级到版本2，但尽管代码可能略有变化，核心原则仍然是相同的。'
- en: ''
  id: totrans-9
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Figure A.1\. Checking the Java version in Linux. Elasticsearch requires Java
    7 or higher.
  id: totrans-10
  prefs:
  - PREF_BQ
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图A.1. 在Linux中检查Java版本。Elasticsearch需要Java 7或更高版本。
- en: ''
  id: totrans-11
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](Images/0afig01_alt.jpg)'
  id: totrans-12
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Images/0afig01_alt.jpg)'
- en: '**2**.  If Java isn’t installed or you don’t have a high enough version, Elasticsearch
    recommends the Oracle version of Java. Use the following console commands to install
    it.'
  id: totrans-13
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**. 如果Java未安装或版本不够高，Elasticsearch推荐使用Oracle版本的Java。使用以下控制台命令进行安装。'
- en: ''
  id: totrans-14
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`sudo add-apt-repository ppa:webupd8team/java sudo apt-get install oracle-java7-installer`'
  id: totrans-15
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`sudo add-apt-repository ppa:webupd8team/java sudo apt-get install oracle-java7-installer`'
- en: 'Now you can install Elasticsearch:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你可以安装Elasticsearch了：
- en: '**1**.  Add the Elasticsearch 1.4 repo, which is the latest one at the time
    of writing, to your repo list and then install it with the following commands.'
  id: totrans-17
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**. 将Elasticsearch 1.4仓库（写作时的最新版本）添加到你的仓库列表中，然后使用以下命令进行安装。'
- en: ''
  id: totrans-18
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`sudo add-apt-repository "deb http://packages.Elasticsearch.org/ ![](Images/enter.jpg)
    Elasticsearch/1.4/debian stable main" sudo apt-get update && sudo apt-get install
    Elasticsearch`'
  id: totrans-19
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`sudo add-apt-repository "deb http://packages.Elasticsearch.org/ ![](Images/enter.jpg)
    Elasticsearch/1.4/debian stable main" sudo apt-get update && sudo apt-get install
    Elasticsearch`'
- en: '**2**.  To make sure Elasticsearch will start on reboot, run the following
    command.'
  id: totrans-20
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**. 确保Elasticsearch在重启后能够启动，运行以下命令。'
- en: ''
  id: totrans-21
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`sudo update-rc.d Elasticsearch defaults 95 10`'
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`sudo update-rc.d Elasticsearch defaults 95 10`'
- en: '**3**.  Turn on Elasticsearch. See [figure A.2](#app01fig02).'
  id: totrans-23
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**. 启用Elasticsearch。见[图A.2](#app01fig02)。'
- en: ''
  id: totrans-24
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Figure A.2\. Starting Elasticsearch on Linux
  id: totrans-25
  prefs:
  - PREF_BQ
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图A.2. 在Linux上启动Elasticsearch
- en: ''
  id: totrans-26
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](Images/0afig02_alt.jpg)'
  id: totrans-27
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Images/0afig02_alt.jpg)'
- en: ''
  id: totrans-28
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`sudo /etc/init.d/Elasticsearch start`'
  id: totrans-29
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`sudo /etc/init.d/Elasticsearch start`'
- en: If Linux is your local computer, open a browser and go to *localhost:9200*.
    9200 is the default port for the Elasticsearch API. See [figure A.3](#app01fig03).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 如果Linux是你的本地计算机，打开浏览器并访问*localhost:9200*。9200是Elasticsearch API的默认端口。见[图A.3](#app01fig03)。
- en: Figure A.3\. The Elasticsearch welcome screen on localhost
  id: totrans-31
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图A.3. 本地主机的Elasticsearch欢迎屏幕
- en: '![](Images/0afig03_alt.jpg)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/0afig03_alt.jpg)'
- en: The Elasticsearch welcome screen should greet you. Notice your database even
    has a name. The name is picked from the pool of Marvel characters and changes
    every time you reboot your database. In production, having an inconsistent and
    non-unique name such as this can be problematic. The instance you started is a
    single node of what could be part of a huge distributed cluster. If all of these
    nodes change names on reboot, it becomes nearly impossible to track them with
    logs in case of trouble. Elasticsearch takes pride in the fact it has little need
    for configuration to get you started and is distributed by nature. While this
    is most certainly true, things such as this random name prove that deploying an
    actual multi-node setup will require you to think twice about certain default
    settings. Luckily Elasticsearch has adequate documentation on almost everything,
    including deployment ([http://www.Elasticsearch.org/guide/en/Elasticsearch/guide/current/deploy.html](http://www.Elasticsearch.org/guide/en/Elasticsearch/guide/current/deploy.html)).
    Multi-node Elasticsearch deployment isn’t in the scope of this chapter but it’s
    good to keep in mind.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: Elasticsearch 的欢迎界面应该会欢迎您。注意您的数据库甚至有一个名字。这个名字是从漫威角色的池中选取的，并且每次您重新启动数据库时都会改变。在生产环境中，拥有这样一个不一致且不唯一的名字可能会出现问题。您启动的实例是可能成为庞大分布式集群一部分的单节点。如果所有这些节点在重启时都更改了名字，那么在出现问题时几乎不可能通过日志跟踪它们。Elasticsearch
    以其几乎不需要配置即可启动并且本质上具有分布式特性而自豪。虽然这无疑是正确的，但像这种随机名字这样的例子证明，部署实际的多个节点设置将需要您仔细考虑某些默认设置。幸运的是，Elasticsearch
    几乎在所有事情上都有充分的文档，包括部署 ([http://www.Elasticsearch.org/guide/en/Elasticsearch/guide/current/deploy.html](http://www.Elasticsearch.org/guide/en/Elasticsearch/guide/current/deploy.html))。多节点
    Elasticsearch 部署不在此章的范围内，但最好记住这一点。
- en: A.2\. Windows installation
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: A.2\. Windows 安装
- en: InWindows, Elasticsearch also requires at least Java 7—the JRE and the JDK—to
    be installed and for the JAVA_HOME variable to be pointing at the Java folder.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Windows 上，Elasticsearch 还需要至少安装 Java 7——JRE 和 JDK——并且需要 JAVA_HOME 变量指向 Java
    文件夹。
- en: '**1**.  Download the Windows installers for Java from [http://www.oracle.com/technetwork/java/javase/downloads/index.html](http://www.oracle.com/technetwork/java/javase/downloads/index.html)
    and run them.'
  id: totrans-36
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**.  从 [http://www.oracle.com/technetwork/java/javase/downloads/index.html](http://www.oracle.com/technetwork/java/javase/downloads/index.html)
    下载 Java 的 Windows 安装程序并运行它们。'
- en: '**2**.  After installation make sure your JAVA_HOME Windows environment variable
    points to where you installed the Java Development Kit. You can find your environment
    variables in System Control Panel > Advanced System Settings. See [figure A.4](#app01fig04).'
  id: totrans-37
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**.  安装完成后，请确保您的 JAVA_HOME Windows 环境变量指向您安装的 Java 开发工具包的位置。您可以在系统控制面板 >
    高级系统设置中找到环境变量。参见 [图 A.4](#app01fig04)。'
- en: ''
  id: totrans-38
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Figure A.4\. The JAVA_HOME variable set to the Java install folder
  id: totrans-39
  prefs:
  - PREF_BQ
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 A.4\. 将 JAVA_HOME 变量设置为 Java 安装文件夹
- en: ''
  id: totrans-40
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](Images/0afig04.jpg)'
  id: totrans-41
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![图片](Images/0afig04.jpg)'
- en: Attempting an install before you have an adequate Java version will result in
    an error. See [figure A.5](#app01fig05).
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在您拥有足够的 Java 版本之前尝试安装将导致错误。参见 [图 A.5](#app01fig05)。
- en: Figure A.5\. The Elasticsearch install fails when JAVA_HOME is not set correctly.
  id: totrans-43
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 A.5\. 当 JAVA_HOME 设置不正确时，Elasticsearch 安装失败。
- en: '![](Images/0afig05_alt.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/0afig05_alt.jpg)'
- en: '|  |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**Installing on a PC with limited rights**'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '**在权限有限的 PC 上安装**'
- en: 'Sometimes you want to try a piece of software but you aren’t free to install
    your own programs. If that’s the case, don’t despair: portable JDKs are out there.
    When you find one of those you can temporarily set your JAVA_HOME variable to
    the path of the portable JDK and start Elasticsearch this way. You don’t even
    need to install Elasticsearch if you’re only checking it out. See [figure A.6](#app01fig06).'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 有时候您想尝试一款软件，但您无法安装自己的程序。如果是这种情况，请不要绝望：便携式 JDK 是存在的。当您找到其中之一时，您可以临时将 JAVA_HOME
    变量设置为便携式 JDK 的路径，并通过这种方式启动 Elasticsearch。如果您只是想检查它，甚至不需要安装 Elasticsearch。参见 [图
    A.6](#app01fig06)。
- en: Figure A.6\. Starting Elasticsearch without an installation. This is only recommended
    for testing purposes on a computer where you have limited rights.
  id: totrans-48
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 A.6\. 不安装即可启动 Elasticsearch。这仅建议在您拥有有限权限的计算机上进行测试。
- en: '![](Images/0afig06_alt.jpg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/0afig06_alt.jpg)'
- en: '|  |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Now that you have Java installed and set up, you can install Elasticsearch.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经安装并设置了 Java，您可以安装 Elasticsearch。
- en: '**1**.  Download the Elasticsearch zip package manually from [http://www.Elasticsearch.org/download/](http://www.Elasticsearch.org/download/).
    Unpack it anywhere on your computer. This folder will now become your self-contained
    database. If you have an SSD drive, consider giving it a place there, because
    it significantly increases the speed of Elasticsearch.'
  id: totrans-52
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**1**. 请手动从[http://www.Elasticsearch.org/download/](http://www.Elasticsearch.org/download/)下载Elasticsearch的zip包。将其解压到你的电脑上的任何位置。这个文件夹现在将成为你的独立数据库。如果你有SSD驱动器，考虑给它分配一个位置，因为它可以显著提高Elasticsearch的速度。'
- en: '**2**.  If you already have a Windows command window open, don’t use it for
    the installation; open a fresh one instead. The environment variables in the open
    window aren’t up to date anymore. Change the directory to your Elasticsearch /bin
    folder and install using the `service install` command. See [figure A.7](#app01fig07).'
  id: totrans-53
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**2**. 如果你已经打开了Windows命令窗口，请不要用它来进行安装；而是打开一个新的窗口。打开窗口中的环境变量已经不再是最新的。将目录更改为你的Elasticsearch
    /bin文件夹，并使用`service install`命令进行安装。参见[图A.7](#app01fig07)。'
- en: ''
  id: totrans-54
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Figure A.7\. An Elasticsearch Windows 64-bit installation
  id: totrans-55
  prefs:
  - PREF_BQ
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图A.7. Elasticsearch Windows 64位安装
- en: ''
  id: totrans-56
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](Images/0afig07_alt.jpg)'
  id: totrans-57
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Images/0afig07_alt.jpg)'
- en: '**3**.  The database should now be ready to start. Use the `service start`
    command. See [figure A.8](#app01fig08).'
  id: totrans-58
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**3**. 数据库现在应该已经准备好启动了。使用`service start`命令。参见[图A.8](#app01fig08)。'
- en: ''
  id: totrans-59
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Figure A.8\. Elasticsearch starts up a node on Windows.
  id: totrans-60
  prefs:
  - PREF_BQ
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图A.8. Elasticsearch在Windows上启动一个节点。
- en: ''
  id: totrans-61
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](Images/0afig08_alt.jpg)'
  id: totrans-62
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Images/0afig08_alt.jpg)'
- en: If you want to stop the server, issue the `service stop` command. Open your
    browser of choice and put *localhost:9200* in the address bar. If the Elasticsearch
    welcome screen appears ([figure A.9](#app01fig09)), you’ve successfully installed
    Elasticsearch.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想停止服务器，请输入`service stop`命令。打开你选择的浏览器，并在地址栏中输入*localhost:9200*。如果出现Elasticsearch欢迎界面（[图A.9](#app01fig09)），则表示你已成功安装Elasticsearch。
- en: Figure A.9\. The Elasticsearch welcome screen on localhost
  id: totrans-64
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图A.9. 本地主机上的Elasticsearch欢迎界面
- en: '![](Images/0afig09_alt.jpg)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/0afig09_alt.jpg)'
