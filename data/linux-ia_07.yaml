- en: 'Chapter 8\. Networked file sharing: Building a Nextcloud file-sharing server'
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第8章. 网络文件共享：构建Nextcloud文件共享服务器
- en: '*This chapter covers*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*本章涵盖*'
- en: Installing and managing software packages using snaps
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用snaps安装和管理软件包
- en: Configuring Apache to manage multiple websites on a single server
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置Apache以在单个服务器上管理多个网站
- en: Provisioning and administering an enterprise file-sharing site
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置和管理企业级文件共享站点
- en: Configuring Nextcloud to use cloud (AWS S3) storage
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置Nextcloud以使用云存储（AWS S3）
- en: After your introduction to the LAMP web server and text-based content management
    collaboration in the previous chapter, I’m sure you started thinking about other
    ways you could use the technology stack. Perhaps your mind didn’t immediately
    turn to the problem of enterprise file sharing, but that’s not a bad place to
    go to learn more about the ways Linux provides web services.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章介绍了LAMP网络服务器和基于文本的内容管理协作之后，我相信您已经开始思考其他可以使用的技术堆栈。也许您的思绪并没有立即转向企业级文件共享的问题，但那并不是一个学习Linux提供网络服务方式的坏地方。
- en: The kind of file sharing I’m talking about has nothing to do with people illegally
    exchanging copyrighted movies and books. Nor am I referring to peer-to-peer sharing
    protocols like BitTorrent, even though they can be used for perfectly legitimate
    purposes. Rather, I’m talking about companies with large collections of documents
    and other media files that must be accessible, but also safely and securely maintained.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 我所谈论的文件共享与人们非法交换受版权保护的电影和书籍无关。我也没有提到像BitTorrent这样的对等共享协议，尽管它们可以用于完全合法的目的。相反，我是在谈论那些拥有大量文档和其他媒体文件的公司，这些文件必须可访问，但同时也必须安全且安全地维护。
- en: Imagine a project involving dozens of developers divided into a handful of teams
    and spread over three or four physical locations. In addition to their code, which
    might live in private repositories, each team produces lots of design documents,
    video demos, project funding proposals, and recordings of video chats, not to
    mention contracts and Statements of Work in PDF format. For this kind of system
    to work, you’ll need to make it all securely available across an insecure network,
    but in a way that carefully controls access so only the right people see the right
    resources.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一个涉及数十名开发者的项目，他们被分成几个团队，分布在三个或四个物理位置。除了可能存放在私有仓库中的代码外，每个团队还会产生大量的设计文档、视频演示、项目资金提案和视频聊天的录音，更不用说PDF格式的合同和工作说明书了。对于这种系统要正常工作，您需要确保所有内容都能在不受保护的网络中安全可用，同时还要仔细控制访问权限，以确保只有正确的人能看到正确的资源。
- en: We’re going to set up a Nextcloud server to illustrate how that can be done
    using some important Linux administrative skills. You’ll see Ubuntu’s new snapd
    package manager, learn about expanding the limits of an Apache configuration,
    understand how applications manage their configuration, and see how data storage
    can span multiple devices.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将设置一个Nextcloud服务器来展示如何使用一些重要的Linux管理技能来完成这项工作。您将看到Ubuntu的新snapd包管理器，了解如何扩展Apache配置的限制，理解应用程序如何管理它们的配置，以及看到数据存储如何跨越多个设备。
- en: 8.1\. Enterprise file sharing and Nextcloud
  id: totrans-10
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.1. 企业级文件共享与Nextcloud
- en: '*Nextcloud* is an open source software suite that can use storage capacity
    for saving, editing, and consuming a wide range of document types, including services
    like audio/video call hosting. Nextcloud also provides client applications that
    allow users on Linux, Windows, MacOS, and smartphone platforms to engage with
    media resources.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '*Nextcloud*是一个开源软件套件，可以使用存储容量来保存、编辑和消费各种文档类型，包括音频/视频通话托管等服务。Nextcloud还提供了客户端应用程序，允许Linux、Windows、MacOS和智能手机平台上的用户参与媒体资源。'
- en: Using Nextcloud, you can create your own private version of Dropbox or Google
    Drive, but on your terms and without having to worry about unexpected changes
    to availability or service/privacy agreements.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Nextcloud，您可以创建自己的Dropbox或Google Drive的私有版本，但这是根据您的条款，而且无需担心可用性或服务/隐私协议的意外变化。
- en: '|  |'
  id: totrans-13
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-14
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: Nextcloud is a fork of the older ownCloud project. While both are still alive,
    Nextcloud seems to have a more robust team of active developers and a richer feature
    set.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: Nextcloud是较老ownCloud项目的分支。虽然两者都还在运行，但Nextcloud似乎拥有一个更强大、活跃的开发者团队和更丰富的功能集。
- en: '|  |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Great. Nextcloud has some real benefits. But going it alone means you’re on
    the hook for the costs and complexity of data hosting, replication, and backups.
    Is Nextcloud worth all the trouble and expense when you can get lots of storage
    at little or no cost from the Dropboxes and Google Drives of the world?
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 太好了。Nextcloud 有一些真正的优势。但是，如果你可以从 Dropbox 和 Google Drive 等服务以极低或零成本获得大量存储空间，那么
    Nextcloud 值得所有这些麻烦和开销吗？
- en: Good news—you can have it both ways. For particularly sensitive data, you can
    keep the whole thing in-house. But, as you’ll soon see, you can also build a Nextcloud
    server as your frontend to finely control how users interface with your media,
    and have the data itself automatically and securely saved to cheaper, reliable
    third-party services, including Dropbox, Google Drive, and Amazon’s S3\. If, down
    the line, you find you need to migrate your data away from say, Dropbox, you can
    do it without your users ever noticing the change.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 好消息是——你可以两者兼得。对于特别敏感的数据，你可以将其全部保留在内部。但是，正如你很快就会看到的，你还可以构建一个 Nextcloud 服务器作为你的前端，精细控制用户如何与你的媒体交互，并将数据本身自动且安全地保存到更便宜、更可靠的第三方服务中，包括
    Dropbox、Google Drive 和亚马逊的 S3。如果你最终发现你需要将数据迁移出 Dropbox 等服务，你可以在用户完全没有察觉到变化的情况下完成迁移。
- en: 'But is all that Linux-y enough to justify giving it a full chapter in this
    book? I think it is. Sure, Nextcloud is a third-party technology that only sits
    on top of the Linux stack, but it’s nevertheless closely interwoven with the Linux
    OS. More to the point: moving through the deployment process will introduce you
    to those Linux administration skills listed earlier.'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，这一切 Linux 的特性是否足以证明在本书中用整整一章来介绍它是合理的？我认为是的。当然，Nextcloud 是一种第三方技术，它只位于 Linux
    栈的顶部，但它仍然与 Linux 操作系统紧密相连。更重要的是：通过部署过程，你会接触到之前列出的那些 Linux 管理技能。
- en: 8.2\. Installing Nextcloud using snaps
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.2\. 使用 snaps 安装 Nextcloud
- en: At this point in the book, I’ll bet you’re already a bit frustrated with the
    conflicts between the package managers used by Linux distributions. As I’ve mentioned,
    it’s not APT versus Yum; there are also managers used by individual distros like
    Arch Linux and SUSE.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 到这本书的这一部分，我敢打赌你对 Linux 发行版使用的包管理器之间的冲突已经有些沮丧了。正如我提到的，这不仅仅是 APT 与 Yum 的对决；还有像
    Arch Linux 和 SUSE 这样的个别发行版使用的管理器。
- en: 'Wouldn’t it be nice if a single set of Linux applications could be uniformly
    installed and managed across the whole range of distributions using a single tool?
    While we’re at it, why can’t people all just get along without having to engage
    in such costly wars? And how about all those rainy days we’ve been having: you
    call that summer?'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 如果能够使用单个工具在所有发行版上统一安装和管理一组 Linux 应用程序，那岂不是很好？当我们谈论这个问题时，为什么人们不能和平相处，而不必参与这样昂贵的战争？还有我们一直在经历的那些雨天：你把那叫做夏天吗？
- en: 'I have the solution to at least one of those problems: Ubuntu’s snaps. I should
    mention that none of the projects in this book rely on snaps, so if the topic
    doesn’t interest you, there’s nothing preventing you from skipping this section
    and joining up with us once again at [section 8.3](#ch08lev1sec3) in a couple
    of pages. No hard feelings.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 我至少有一个问题的解决方案：Ubuntu 的 snaps。我应该提到的是，这本书中的所有项目都不依赖于 snaps，所以如果你对这个话题不感兴趣，你可以跳过这一节，在几页之后再次加入我们，在[第
    8.3 节](#ch08lev1sec3)中。没有坏心情。
- en: Now where was I? Oh, yes. *Snaps* are software packages that are, by design,
    entirely self-contained. All you need is a Linux distro that’s snap-compliant
    and the name of a package. (As of this writing, most distros including CentOS
    and OpenSUSE are either already there or getting close.) If you run this command
    from a Linux terminal
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我又在哪里？哦，是的。*Snaps* 是一种设计上完全自包含的软件包。你所需要的就是一个符合 snap 标准的 Linux 发行版和包的名称。（截至本书写作时，包括
    CentOS 和 OpenSUSE 在内的大多数发行版要么已经实现，要么正在接近实现。）如果你从 Linux 终端运行此命令
- en: '[PRE0]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: it automatically installs the full Blender 3D creation suite, along with all
    the environment dependencies and extensions it’ll need. Updates and patches will
    also be handled for you behind the scenes.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 它会自动安装完整的 Blender 3D 创作套件，以及它需要的所有环境依赖项和扩展。更新和补丁也将由你背后处理。
- en: Blender is only an example. Being a heavily graphic program, it’ll only make
    sense to install that snap on a Linux desktop version; you won’t get good mileage
    on a server.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: Blender 只是一个例子。作为一个高度图形化的程序，它只适合安装在 Linux 桌面版本上；在服务器上你不会得到很好的效果。
- en: Snap is still a work in progress. Because there are plenty of applications that
    don’t have a snap version yet, APT and its friends won’t be going anywhere in
    the immediate future. But the technology has significant advantages, and there’s
    a growing crowd of major industry players joining. You can only gain by introducing
    yourself.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: Snap 仍在开发中。由于许多应用程序还没有Snap版本，APT及其相关工具在短期内不会消失。但这项技术具有显著优势，越来越多的主要行业参与者正在加入。自我介绍会让你受益。
- en: '|  |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-30
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: Ubuntu *Core* is a special lightweight distribution primarily built to work
    with Internet of Things (loT) devices like smart appliances and connected cars,
    and with swarms of Docker-powered containers. By design, Core uses only snaps
    for its package management.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: Ubuntu *Core* 是一个特殊的轻量级发行版，主要用于与物联网（IoT）设备如智能家电和联网汽车以及Docker容器集群一起工作。按照设计，Core仅使用Snap进行软件包管理。
- en: '|  |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: The snap system is more than a package manager. As you can see in [figure 8.1](#ch08fig01),
    snaps are themselves isolated sandboxes with limited access to other system resources.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: Snap系统不仅仅是一个软件包管理器。如您在[图8.1](#ch08fig01)中看到的那样，Snap本身是隔离的沙箱，对其他系统资源的访问有限。
- en: 'Figure 8.1\. Snap architecture: notice how exchanging data between snaps and
    system resources is carefully controlled to maintain security isolation.'
  id: totrans-34
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.1\. Snap架构：注意Snap与系统资源之间交换数据是如何仔细控制以保持安全隔离的。
- en: '![](Images/08fig01_alt.jpg)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/08fig01_alt.jpg)'
- en: 'As this figure shows, communication with other snaps is achieved through a
    system of interfaces that connect only where appropriate. Snaps are given access
    to special locations in the file system (within /var/snap/<snapname>/) where they
    can write their data. In case snap isn’t yet installed on your machine, you’ll
    want the snapd package:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 如此图所示，与其他Snap的通信是通过一套接口系统实现的，这些接口仅在适当的位置连接。Snap被赋予了访问文件系统中的特殊位置（在/var/snap/<snapname>/内）的权限，它们可以在那里写入数据。如果您的机器上尚未安装Snap，您将需要snapd软件包：
- en: '[PRE1]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '***1* The snapd package may not yet be available for CentOS 7, but the dnf
    install snapd command will work on Fedora 25.**'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* snapd软件包可能尚未适用于CentOS 7，但`dnf install snapd`命令将在Fedora 25上工作。**'
- en: 'Application developers have already built hundreds of snaps, which are managed
    through a number of sources including the Ubuntu Store ([https://snapcraft.io](https://snapcraft.io)).
    You can search for available snaps from the command line using `snap find` and
    a keyword describing what you’re looking for. Here are some of the results from
    a search of snaps containing the keyword `server`:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 应用程序开发者已经构建了数百个Snap，这些Snap通过包括Ubuntu Store ([https://snapcraft.io](https://snapcraft.io))在内的多个来源进行管理。您可以使用`snap
    find`命令和描述您要查找内容的关键词在命令行中搜索可用的Snap。以下是从包含关键词`server`的Snap搜索结果中的一些示例：
- en: '[PRE2]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'It turns out that Nextcloud was among the first major application projects
    to add its package as a snap. Running `snap install nextcloud` on a brand-new,
    clean Ubuntu 17.04 VirtualBox VM will give you a fully functioning Nextcloud server
    without having to manually install all the LAMP elements first:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 结果表明，Nextcloud是首批将软件包作为Snap添加的主要应用程序项目之一。在全新的、干净的Ubuntu 17.04 VirtualBox虚拟机上运行`snap
    install nextcloud`将为您提供一个完全功能的Nextcloud服务器，而无需先手动安装所有LAMP组件：
- en: '[PRE3]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '***1* This error message won’t affect the installation; logging out and in
    again before installation will avoid it altogether.**'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 此错误信息不会影响安装；在安装前注销并重新登录可以完全避免它。**'
- en: When the snap is installed, use a browser to navigate to your VM’s web root
    (using the VM’s IP address that, as you recall, can be retrieved using `ip addr`).
    Once the page is loaded, you’ll be asked to create an admin account, and you’re
    off to the races.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 当Snap安装完成后，使用浏览器导航到您的虚拟机（VM）的Web根目录（使用虚拟机的IP地址，如您所记得，可以使用`ip addr`检索）。页面加载后，您将被要求创建一个管理员账户，然后就可以开始使用了。
- en: '|  |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: '**Why Ubuntu 17.04, and why VirtualBox?**'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '**为什么是Ubuntu 17.04，为什么是VirtualBox？**'
- en: It seems that integrating snaps into the LXC environment went a bit more slowly
    than hoped, and it wasn’t yet available for LXC containers previous to Ubuntu
    16.10\. Since I’m currently running Ubuntu 16.04 on my workstation, launching
    a VirtualBox VM built on an Ubuntu 17.04 ISO image is the quickest and simplest
    solution.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来将Snap集成到LXC环境中比预期的要慢一些，并且在Ubuntu 16.10之前，它还没有适用于LXC容器。由于我目前在我的工作站上运行Ubuntu
    16.04，因此使用基于Ubuntu 17.04 ISO镜像构建的VirtualBox虚拟机是最快、最简单的解决方案。
- en: 'This is another illustration of the value of learning to use multiple virtualization
    technologies: when one fails you, another will probably work.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 这又是学习使用多种虚拟化技术的价值的另一个例证：当一种技术失败时，另一种技术可能会工作。
- en: '|  |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 8.3\. Installing Nextcloud manually
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.3\. 手动安装Nextcloud
- en: If installing the Nextcloud snap is so straightforward, why would you ever want
    to do it the old-fashioned, manual way? Here are a couple of reasons. One is that
    snaps can be a bit too simple and don’t allow for a lot of flexibility in design
    and configuration. Another is that, as I write this, at least, you won’t be able
    to add and fully administer applications using the snap version. You’ll soon see
    how valuable that can be. And hand-crafting your application installations means
    learning more about the inner workings of your Linux system and about identifying
    and overcoming problems. What’s not to love about that?
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 如果安装Nextcloud snap如此简单，为什么还要选择老式的、手动的方式呢？这里有几个原因。一个是snaps可能过于简单，不允许在设计和配置上有太多灵活性。另一个原因是，至少在我写这篇文章的时候，您将无法使用snap版本添加和完全管理应用程序。您很快就会看到这有多么有价值。而且手工制作应用程序安装意味着更多地了解您Linux系统的内部工作原理，以及识别和克服问题。这有什么不好呢？
- en: 8.3.1\. Hardware prerequisites
  id: totrans-52
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.3.1\. 硬件要求
- en: It’s always a good idea to check an application’s documentation to make sure
    that you’ve got enough hardware and software muscle to handle the load. [Figure
    8.2](#ch08fig02) shows Nextcloud’s System Requirements web page. If you’re planning
    to host a simple, lightly used server providing for a few dozen users, then you’ll
    find Nextcloud is fairly easy to get along with, demanding nothing that can’t
    be handled by an off-the-shelf container.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 总是检查应用程序的文档是个好主意，以确保您有足够的硬件和软件资源来处理负载。[图8.2](#ch08fig02)显示了Nextcloud的系统要求网页。如果您计划托管一个简单、轻度使用的服务器，为几十个用户提供服务，那么您会发现Nextcloud相当容易使用，不会对现成的容器提出任何无法处理的要求。
- en: Figure 8.2\. Hardware and software requirements for both recommended and minimal
    Nextcloud installations
  id: totrans-54
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.2\. 推荐和最小Nextcloud安装的硬件和软件要求
- en: '![](Images/08fig02_alt.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/08fig02_alt.jpg)'
- en: Any old minimal hardware configuration will work fine for our technology testing,
    but I wouldn’t want to rely on a single LXC container running an old PC to serve
    tens of thousands of users and terabytes of data.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的技术测试，任何旧的最低硬件配置都可以正常工作，但我不想依赖一个运行旧PC的单个LXC容器来服务成千上万的用户和TB级的数据。
- en: 'Planning an enterprise-scale deployment? Nextcloud provides a useful, multilevel
    Deployment Recommendations guide to provisioning full-strength platforms ([http://mng.bz/8ZAO](http://mng.bz/8ZAO)).
    Here, for instance, is what Nextcloud recommends for a smaller workgroup with
    up to 150 users accessing up to 10 TB of data:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 计划企业级部署？Nextcloud提供了一个有用的、多层次的部署建议指南，用于配置全功能平台([http://mng.bz/8ZAO](http://mng.bz/8ZAO))。例如，Nextcloud为拥有最多150个用户且数据量高达10
    TB的小型工作组推荐以下配置：
- en: One server with two CPU cores
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一台拥有两个CPU核心的服务器
- en: 16 GB of RAM
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 16 GB的RAM
- en: Authentication through Lightweight Directory Access Protocol (LDAP, a widely
    used distributed information protocol)
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过轻量级目录访问协议（LDAP，一种广泛使用的分布式信息协议）进行身份验证
- en: Red Hat Enterprise Linux or Ubuntu 16.04 with vendor support
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Red Hat Enterprise Linux或Ubuntu 16.04带有厂商支持
- en: Apache with a TLS/SSL encryption certificate
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配备TLS/SSL加密证书的Apache
- en: The MySQL or MariaDB database
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MySQL或MariaDB数据库
- en: The Btrfs file system mounted with `nodatacow` for Nextcloud data partitions
    to permit *zero* downtime backups
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`nodatacow`挂载的Btrfs文件系统为Nextcloud数据分区提供*零*停机备份
- en: Caching with memcache to speed up access performance
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用memcache进行缓存以加快访问性能
- en: '|  |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: Note
  id: totrans-67
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: '*Btrfs* is a file-system type that, although less widespread than ext4 (mentioned
    briefly in [chapter 1](kindle_split_009.xhtml#ch01)), was designed to provide
    exceptional performance and data reliability at large scale. But, as of release
    7.4 (August 2017), Red Hat Enterprise Linux has deprecated its support for Btrfs.'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '*Btrfs* 是一种文件系统类型，尽管不如ext4（在第1章中简要提及）普及，但旨在在大规模上提供卓越的性能和数据可靠性。但是，截至发布7.4（2017年8月），Red
    Hat Enterprise Linux已经废弃了对Btrfs的支持。'
- en: '|  |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '|'
- en: 8.3.2\. Building a LAMP server
  id: totrans-70
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.3.2\. 构建LAMP服务器
- en: 'The next step should be simple enough by this point. I’d recommend firing up
    a brand-new container or VM rather than using the one left over from your MediaWiki
    project, if for no other reason than that it’ll be good practice. Here are all
    the packages you’ll need for your server in a single command. I threw in wget
    and nano in case they’re not already installed:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，下一步应该足够简单。我建议启动一个全新的容器或虚拟机，而不是使用你MediaWiki项目留下的那个，至少这样做是良好的实践。以下是在单个命令中你需要为你的服务器安装的所有包。我添加了wget和nano，以防它们尚未安装：
- en: '[PRE4]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '***1* To keep the base image as small as possible, packages like nano often
    aren’t installed by default on new LXC containers.**'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 为了尽可能保持基本镜像的大小，像nano这样的包通常在新LXC容器中默认不安装。**'
- en: 'If you’re not picky about using MySQL rather than MariaDB, and you’re on an
    Ubuntu server, then you could just as easily spare yourself a lot of typing and
    go with the LAMP server metapackage I mentioned in the previous chapter. Again,
    don’t forget the caret (`^`) at the end of the package name:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不是特别挑剔，想要使用MySQL而不是MariaDB，并且你在一个Ubuntu服务器上，那么你可以轻松地节省很多输入，并使用我在上一章中提到的LAMP服务器元包。再次提醒，不要忘记在包名末尾的撇号（`^`）：
- en: '[PRE5]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Once installed, remember to run the MySQL secure installation tool:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，请记住运行MySQL安全安装工具：
- en: '[PRE6]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'If you chose the MariaDB route and found yourself having to use `sudo` with
    that command, here’s the quick fix I showed you in [chapter 7](kindle_split_015.xhtml#ch07):'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你选择了MariaDB路径并发现自己必须使用`sudo`执行该命令，这里就是我在第7章中向你展示的快速修复方法：[第7章](kindle_split_015.xhtml#ch07)：
- en: '[PRE7]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: With your LAMP software installed and a database up and running, you’re now
    ready to tell Apache how you want it to work with your application.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装了LAMP软件并启动数据库后，你现在可以告诉Apache如何与你的应用程序一起工作了。
- en: 8.3.3\. Configuring Apache
  id: totrans-81
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.3.3\. 配置Apache
- en: To ensure that Apache will be able to communicate with Nextcloud, there are
    a few relatively simple adjustments you’re going to have to make. First, you should
    enable a couple of Apache modules through the a2enmod tool. The *rewrite* module
    is used to rewrite URLs in real time as they’re moved between a client and the
    server. The *headers* module performs a similar function for HTTP headers.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保Apache能够与Nextcloud通信，你需要做一些相对简单的调整。首先，你应该通过a2enmod工具启用几个Apache模块。*rewrite*模块用于在客户端和服务器之间实时重写URL。*headers*模块对HTTP头执行类似的功能。
- en: '[PRE8]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: If you’re not planning to use this server for any other purpose, putting the
    Nextcloud application files in the Apache document root would work. Because the
    value of the `DocumentRoot` entry in the 000-default.conf file in your /etc/apache2/sites-available/
    directory already points to /var/www/html/, there’s nothing left to do. But placing
    Nextcloud’s data files in the default document root presents a potential security
    risk. You’ll probably want Nextcloud in some other part of your file system.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你没有计划将此服务器用于其他任何目的，将Nextcloud应用程序文件放在Apache文档根目录中是可以的。因为你的/etc/apache2/sites-available/目录中000-default.conf文件中的`DocumentRoot`条目的值已经指向/var/www/html/，所以没有其他事情要做。但是，将Nextcloud的数据文件放在默认文档根目录中可能会带来潜在的安全风险。你可能希望Nextcloud位于你的文件系统的其他部分。
- en: There are two ways to tell Apache how to find site files that aren’t in the
    document root. The Ubuntu method involves adding a new section to your existing
    000-default.conf file that contains all the necessary information. Most people
    seem to prefer creating a new .conf file in the /etc/apache2/sites-available/
    directory for each new service. Both work fine, but here’s what the separate file
    should look like, assuming you placed the application in /var/www/ rather than
    the document root.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 有两种方法可以告诉Apache如何找到不在文档根目录中的站点文件。Ubuntu方法涉及在你的现有000-default.conf文件中添加一个新部分，其中包含所有必要的信息。大多数人似乎更喜欢在/etc/apache2/sites-available/目录中为每个新服务创建一个新的.conf文件。两者都可以正常工作，但这里是一个单独文件应该看起来像什么，假设你将应用程序放置在/var/www/而不是文档根目录中。
- en: Listing 8.1\. Contents of a /etc/apache2/sites-available/nextcloud.conf file
  id: totrans-86
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.1\. /etc/apache2/sites-available/nextcloud.conf文件的内容
- en: '[PRE9]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '***1* Associates the contents of the /var/www/nextcloud/ directory with the
    Nextcloud host (or site)**'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 将/var/www/nextcloud/目录的内容与Nextcloud主机（或站点）关联**'
- en: '***2* Assigns environment variables that define how the Nextcloud application
    works**'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 分配环境变量，定义Nextcloud应用程序的工作方式**'
- en: A similar directive using the Ubuntu method would involve adding a section in
    your 000-default.conf file. It might look something like this.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Ubuntu方法的一个类似指令将涉及在你的000-default.conf文件中添加一个部分。它可能看起来像这样。
- en: Listing 8.2\. Sample Nextcloud directive in the 000-default.conf Apache setup
    file
  id: totrans-91
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表8.2。在000-default.conf Apache配置文件中的Nextcloud示例指令
- en: '[PRE10]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '***1* Note how this example uses the 443 HTTP secure port.**'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 注意这个例子使用了443 HTTP安全端口。**'
- en: '***2* Directs traffic targeted at the bootstrap-it.com/nextcloud address to
    the custom document root**'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 将针对bootstrap-it.com/nextcloud地址的流量重定向到自定义文档根**'
- en: As you can see in [figure 8.3](#ch08fig03), when Apache reads this config file,
    it redirects all incoming traffic addressed to example.com/nextcloud to the application
    files in /var/www/, assuming that your domain is example.com. As before, an IP
    address will work just as well.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你在[图8.3](#ch08fig03)中可以看到的，当Apache读取这个配置文件时，它会将所有指向example.com/nextcloud的传入流量重定向到`/var/www/`中的应用程序文件，假设你的域名是example.com。和之前一样，IP地址也可以工作。
- en: Figure 8.3\. Apache reads configuration files in /etc/apache2/sites-enabled/
    and uses their settings to redirect requests.
  id: totrans-96
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.3。Apache读取`/etc/apache2/sites-enabled/`中的配置文件，并使用它们的设置来重定向请求。
- en: '![](Images/08fig03_alt.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/08fig03_alt.jpg)'
- en: 'Finally, you’ll need to create a symbolic link in the /etc/apache2/sites-enabled/
    directory pointing to the nextcloud.conf file you created in /etc/apache2/sites-available/:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你需要在`/etc/apache2/sites-enabled/`目录中创建一个指向你在`/etc/apache2/sites-available/`中创建的nextcloud.conf文件的符号链接：
- en: '[PRE11]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: But why? And what’s a symbolic link? When Apache starts, it reads the contents
    of /etc/apache2/sites-enabled/ looking for site configurations to load. Those
    configurations won’t actually exist in /etc/apache2/sites-enabled/, but there’ll
    be symbolic links to the real files in /etc/apache2/sites-available/.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 但为什么？什么是符号链接？当Apache启动时，它会读取`/etc/apache2/sites-enabled/`目录的内容，寻找要加载的站点配置。这些配置实际上不会存在于`/etc/apache2/sites-enabled/`中，但会有指向`/etc/apache2/sites-available/`中实际文件的符号链接。
- en: Why not tell Apache to read /etc/apache2/sites-available/ in the first place
    and cut out the middleman? Because hanging it all on symbolic links makes it easy
    and convenient to quickly disable a site and then, when you’ve finished a round
    of edits, re-enable it once again. Rather than having to delete and rewrite the
    real file, you’ll only need to play with an easy-to-manage link to it.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么不一开始就让Apache读取`/etc/apache2/sites-available/`并去掉中间人？因为所有这些都依赖于符号链接，这使得快速禁用站点并在编辑一轮后再次启用它变得容易和方便。你不需要删除和重写实际文件，你只需要玩一个容易管理的链接。
- en: '*Symbolic links*? They’re objects that represent files or directories living
    elsewhere on a file system. They allow a user to execute or view a resource in
    one place, even though the resource itself is elsewhere. You’ll learn more about
    symbolic links when you get to [chapter 12](kindle_split_020.xhtml#ch12).'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '*符号链接*？它们是代表文件或目录在文件系统其他位置的对象。它们允许用户在一个地方执行或查看资源，即使资源本身在其他地方。当你到达第12章时，你会了解更多关于符号链接的内容。[链接到第12章](kindle_split_020.xhtml#ch12)。'
- en: 8.3.4\. Downloading and unpacking Nextcloud
  id: totrans-103
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.3.4。下载和解压Nextcloud
- en: You can download the most recent Nextcloud package from the Nextcloud Install
    page ([https://nextcloud.com/install](https://nextcloud.com/install)). If you’re
    installing to a container or VM, or from a server without a desktop GUI installed,
    then the most convenient approach is to get the package’s download URL and grab
    the package from the command line.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以从Nextcloud安装页面([https://nextcloud.com/install](https://nextcloud.com/install))下载最新的Nextcloud包。如果你是在容器或VM中安装，或者从没有安装桌面GUI的服务器安装，那么最方便的方法是获取包的下载URL，并在命令行中获取包。
- en: One quick way to get that URL from the Nextcloud site using a regular session
    on your own PC is to click the Download tab beneath Get Nextcloud Server and then,
    as you can see in [figure 8.4](#ch08fig04), the Details and Download options button.
    Right-click the .tar.bz2 link, and select Copy Link Address from the menu.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 从Nextcloud网站获取URL的一个快速方法是在你的PC上使用常规会话，点击“获取Nextcloud服务器”下的“下载”标签，然后，如[图8.4](#ch08fig04)所示，点击“详细信息”和“下载”选项按钮。右键单击.tar.bz2链接，并从菜单中选择“复制链接地址”。
- en: 'Figure 8.4\. Links to Nextcloud download archives: either .tar.bz2 or the .zip
    format will work.'
  id: totrans-106
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.4。指向Nextcloud下载存档的链接：无论是.tar.bz2还是.zip格式都可以工作。
- en: '![](Images/08fig04_alt.jpg)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/08fig04_alt.jpg)'
- en: 'You can copy the .tar.bz2 URL into a `wget` command either by right-clicking
    in the terminal and selecting Paste, or by pressing Shift-Ctrl-v. Here’s how the
    command will look:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过在终端中右键单击并选择粘贴，或者按Shift-Ctrl-v来将.tar.bz2 URL复制到`wget`命令中。命令看起来是这样的：
- en: '[PRE12]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Don’t forget to click the MD5 or SHA256 hash links displayed when the Details
    and Download Options button is clicked. Then confirm that those values are identical
    to the hashes you generate from the downloaded archive.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 不要忘记点击在点击“详细信息”和“下载选项”按钮时显示的 MD5 或 SHA256 哈希链接。然后确认这些值与从下载的存档中生成的哈希值相同。
- en: You’ll notice that the file you downloaded has a .tar.bz2 extension rather than
    the .tar.gz you saw back in [chapter 4](kindle_split_012.xhtml#ch04). A .gz archive
    is created using a different compression algorithm than a .bz2 archive. Which
    one’s better? It seems that gzip archives take less time (and resources) to compress,
    but produce larger archives than BZ2\. Therefore, your choice will depend on whether
    your operation values speed or storage space.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 你会注意到你下载的文件具有 .tar.bz2 扩展名，而不是在 [第 4 章](kindle_split_012.xhtml#ch04) 中看到的 .tar.gz。.gz
    存档使用与 .bz2 存档不同的压缩算法创建。哪一个更好？似乎 gzip 存档压缩所需时间（和资源）更少，但产生的存档比 BZ2 大。因此，你的选择将取决于你的操作更重视速度还是存储空间。
- en: 'Unpacking a .tar.bz2 archive requires the `xjf` arguments, rather than the
    `xzf` you’d use for a .gz:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 解包 .tar.bz2 存档需要 `xjf` 参数，而不是用于 .gz 的 `xzf`：
- en: '[PRE13]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '***1* The j argument is invoked to decompress a BZ2-compressed archive.**'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* j 参数用于解压缩 BZ2 压缩的存档。**'
- en: The next step involves copying the unpacked files and directories to their new
    home, which, following the best practices I mentioned earlier, will be in /var/www/.
    That’s a location outside the document root.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步涉及将解包的文件和目录复制到它们的新家，根据我之前提到的最佳实践，这将位于 /var/www/。这是一个位于文档根目录之外的位置。
- en: 'Adding `-r` to the copy command will copy the files recursively to include
    subdirectories and their contents:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在复制命令中添加 `-r` 将递归地复制文件到包括子目录及其内容的目录中：
- en: '[PRE14]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Two more small steps and you’re good to go. Apache will need full access to
    all the files in the Nextcloud directories in order to do its job. You could have
    the root user own them, but that means you’d have to give visiting users root
    powers to access those files. As you might imagine, giving everyone on the internet
    that kind of access to your files poses a wee bit of a problem.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 再进行两个小步骤，你就可以开始了。Apache 需要完全访问 Nextcloud 目录中的所有文件才能完成其工作。你可以让 root 用户拥有这些文件，但这意味着你必须给访问用户赋予
    root 权限来访问这些文件。正如你可能想象的那样，给互联网上每个人提供这种文件访问权限会带来一些问题。
- en: 'Many web servers use a special system user called *www-data*. The next command
    uses `chown` (that you already met back in [chapter 4](kindle_split_012.xhtml#ch04))
    to turn the user and group ownership of all those files over to the web server
    user www-data. Using the uppercase `-R` will (like the lowercase `-r` you used
    with `cp`) apply the command recursively to all files and directories in the directory
    hierarchy:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 许多网络服务器使用一个名为 *www-data* 的特殊系统用户。下一个命令使用 `chown`（你已经在 [第 4 章](kindle_split_012.xhtml#ch04)
    中见过）将所有这些文件的用户和组所有权转移到网络服务器用户 www-data。使用大写 `-R` 将（就像你使用小写 `-r` 与 `cp` 一起使用时那样）递归地应用于目录层次结构中的所有文件和目录：
- en: '[PRE15]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Apache has no idea of the kinds of stuff we’ve been up to while it wasn’t looking.
    You’d better let it in on the fun by restarting the service:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 当 Apache 没有注意到我们在忙些什么时，它对所发生的事情一无所知。你最好通过重新启动服务让它加入乐趣：
- en: '[PRE16]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'If that restart wasn’t successful, then make a note of any error messages and
    see if there’s anything you can fix. You can also dig a bit deeper into the logs
    by displaying the last 10 entries in the Journal using the `tail` command. There
    might, for instance, be a reference to a specific line in the nextcloud.conf file:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 如果重新启动不成功，请记下任何错误消息，并查看是否有可以修复的内容。您还可以通过使用 `tail` 命令显示日志的最后 10 条条目来深入了解日志。例如，可能有一个对
    nextcloud.conf 文件中特定行的引用：
- en: '[PRE17]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'But if everything went well, then direct your browser to your container’s IP
    address followed by `nextcloud`. You’ll be taken to a page where you’re asked
    to create a new admin account and provide valid login credentials for your MariaDB
    database. Unless you’ve created a different database user account for this purpose,
    you’ll use root and the password you gave it earlier:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 但如果一切顺利，请将您的浏览器指向您的容器 IP 地址，然后输入 `nextcloud`。您将被带到要求创建新管理员账户并提供 MariaDB 数据库有效登录凭证的页面。除非您为此目的创建了不同的数据库用户账户，否则您将使用
    root 和您之前提供的密码：
- en: '[PRE18]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '|  |'
  id: totrans-127
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Note
  id: totrans-128
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 注意
- en: There are both security and logistical advantages to associating database resources
    with non-root database users. When you have more than one application using the
    resources of a single database, keeping the applications separate by creating
    multiple isolated accounts is recommended.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 将数据库资源与非root数据库用户关联具有安全和物流方面的优势。当你有多个应用程序使用单个数据库的资源时，建议通过创建多个隔离的账户来保持应用程序的分离。
- en: '|  |'
  id: totrans-130
  prefs: []
  type: TYPE_TB
  zh: '|  |'
- en: Once your information is digested, you’ll be shown links to Nextcloud’s client
    apps and then dropped into the administration console you see in [figure 8.5](#ch08fig05).
    That’s where you can upload, view, and share documents and media files.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你的信息被处理，你将看到指向Nextcloud客户端应用程序的链接，然后被带到你在[图8.5](#ch08fig05)中看到的行政控制台。那里你可以上传、查看和共享文档和媒体文件。
- en: Figure 8.5\. The main Nextcloud console, complete with sample folders and files.
    You can work with objects here as you would using an OS file manager.
  id: totrans-132
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.5\. 主要的Nextcloud控制台，包括示例文件夹和文件。你可以在这里像使用操作系统文件管理器一样处理对象。
- en: '![](Images/08fig05_alt.jpg)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/08fig05_alt.jpg)'
- en: As the site administrator, you can also create groups and users, assign permissions
    and quotas, and manage how the site functions. Now, let’s look at how to manage
    Nextcloud.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 作为网站管理员，你还可以创建组用户，分配权限和配额，并管理网站的功能。现在，让我们看看如何管理Nextcloud。
- en: 8.4\. Nextcloud administration
  id: totrans-135
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.4\. Nextcloud管理
- en: As a Nextcloud site grows in complexity and as your needs change (for example,
    perhaps it’ll be more efficient to manage growing resources with scripts), you’ll
    sometimes need to work with administration resources at the command-line level.
    It’ll be good to know where things are and what they look like.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 随着Nextcloud网站复杂性的增加和你的需求的变化（例如，可能使用脚本管理不断增长的资源会更有效率），你有时需要以命令行级别与行政资源进行交互。了解事物的位置和它们的外观将会很有帮助。
- en: 'Rather than using /etc/ the way many Linux applications do, Nextcloud keeps
    its main configuration file (named config.php) in the /var/www/nextcloud/config/
    directory. The file contains authentication and environment information, along
    with key database connection details. Here’s a quick peek at that file:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 与许多Linux应用程序使用 /etc/ 的方式不同，Nextcloud将其主要配置文件（命名为config.php）保存在 /var/www/nextcloud/config/
    目录中。该文件包含认证和环境信息，以及关键的数据库连接细节。以下是该文件的快速预览：
- en: '[PRE19]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '***1* All encrypted authentication codes have been redacted for security reasons.**'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***1* 为了安全原因，所有加密的认证码都已删除。**'
- en: '***2* The server’s public domain or, in this case, IP address**'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***2* 服务器的公共域名或，在这种情况下，IP地址**'
- en: '***3* The location of the account and document data on the file system**'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***3* 文件系统中账户和文档数据的位置**'
- en: 'Like any good Linux application, Nextcloud has a full-featured command-line
    shell called *occ command*. To use it, you’ll need to prepend a surprisingly detailed
    string to run commands as the www-data user using PHP. Typing `sudo -u www-data
    php occ -h` displays basic syntax help, whereas `list` prints a full list of available
    commands:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 就像任何优秀的Linux应用程序一样，Nextcloud有一个功能齐全的命令行shell，称为*occ命令*。要使用它，你需要使用PHP以www-data用户身份运行命令时，在命令前加上一个令人惊讶的详细字符串。输入`sudo
    -u www-data php occ -h`会显示基本的语法帮助，而`list`会打印出所有可用命令的完整列表：
- en: '[PRE20]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: For now though, let’s ignore those command-line tools and head back to the browser
    console. As you can see in [figure 8.6](#ch08fig06), clicking the gear icon at
    upper right presents links to the Users page (where you manage users and groups),
    the Apps page (with a menu of available apps that can be enabled), and the Admin
    page (where you manage security settings, services, and applications).
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，让我们忽略那些命令行工具，回到浏览器控制台。正如你在[图8.6](#ch08fig06)中可以看到的，点击右上角的齿轮图标会显示到用户页面（在这里你可以管理用户和组）、应用程序页面（包含可以启用的应用程序菜单）和管理页面（在这里你可以管理安全设置、服务和应用程序）的链接。
- en: Figure 8.6\. Clicking the gear icon displays a drop-down menu with links to
    resources appropriate to your account privileges.
  id: totrans-145
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.6\. 点击齿轮图标会显示一个下拉菜单，包含适合你的账户权限的资源链接。
- en: '![](Images/08fig06_alt.jpg)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/08fig06_alt.jpg)'
- en: If you click through to the Admin page, you’ll probably see some security and
    setup warnings. As you can see in [figure 8.7](#ch08fig07), the fact that my site
    isn’t configured to use the encrypted HTTPS protocol for data transfers is a matter
    of concern. Nextcloud definitely has a point on this one, and it’s something I
    plan to address in [chapter 9](kindle_split_017.xhtml#ch09).
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您点击到管理页面，您可能会看到一些安全和设置警告。如图 8.7 所示，我的网站没有配置为使用加密的 HTTPS 协议进行数据传输是一个值得关注的问题。Nextcloud
    在这一点上确实有理，我计划在[第 9 章](kindle_split_017.xhtml#ch09)中解决这个问题。
- en: Figure 8.7\. The Admin page with links to various admin apps in the left panel,
    and warnings and status information in the middle
  id: totrans-148
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 8.7\. 管理页面，左侧面板中有各种管理应用程序的链接，中间有警告和状态信息
- en: '![](Images/08fig07_alt.jpg)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/08fig07_alt.jpg)'
- en: HTTPS is all about encrypting data as it moves between a server (like the one
    running Nextcloud for you right now) and the browser on your visitors’ PCs. This
    is critically important, as you don’t want to expose your data in transit to anyone
    on any network between you and your users. But you should also be concerned about
    your data when it’s at rest.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: HTTPS 的核心是加密数据，在服务器（例如现在为您运行 Nextcloud 的服务器）和您访客的电脑上的浏览器之间传输数据。这一点至关重要，您不希望将数据在传输过程中暴露给任何位于您和用户之间的网络上的任何人。但您也应该关注数据在静止状态时的安全。
- en: Encrypting the files on your server will prevent anyone who somehow gains access
    to your storage drives from mounting them and reading their content. Who might
    that be? Imagine someone hacking into your network. Or someone walking off with
    your physical server. If the files are encrypted, they’ll provide the thieves
    with little or no value.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 加密您服务器上的文件将防止任何以某种方式获得对您的存储驱动器访问权限的人挂载它们并读取其内容。那会是谁呢？想象一下有人黑入您的网络。或者有人带着您的物理服务器离开。如果文件被加密，它们对窃贼几乎没有或没有价值。
- en: To enable encryption, click the Encryption link on the left panel and then select
    the Enable Server-side Encryption check box. As [figure 8.8](#ch08fig08) illustrates,
    you’ll be shown a list of some consequences you should consider. When you’ve read
    through that, click the Enable Encryption button.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用加密，请点击左侧面板上的加密链接，然后选择启用服务器端加密复选框。如图 8.8 所示，您将看到一些您应该考虑的后果列表。阅读完毕后，点击启用加密按钮。
- en: Figure 8.8\. Enabling server-side encryption in Nextcloud is a simple, one-click
    process, but you should be conscious of the consequences.
  id: totrans-153
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 8.8\. 在 Nextcloud 中启用服务器端加密是一个简单的一键过程，但您应该意识到其后果。
- en: '![](Images/08fig08_alt.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/08fig08_alt.jpg)'
- en: No going back now. Only going forward...
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 现在无法回头了。只有向前...
- en: 8.5\. Using AWS S3 as the primary Nextcloud storage
  id: totrans-156
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 8.5\. 使用 AWS S3 作为主要 Nextcloud 存储
- en: The thing about storage is that you have to find space to put it all. And, because
    all storage devices will eventually fail without warning, you’ll need multiple
    copies of each device. Figuring out how to provision, connect, and maintain such
    storage arrays is time-consuming, and keeping it going is relatively expensive.
    But there’s hope.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 关于存储，您必须找到空间来存放所有这些数据。而且，由于所有存储设备最终都会无预警地失败，您将需要每个设备的多个副本。弄清楚如何配置、连接和维护这样的存储阵列是耗时的，而且保持其运行相对昂贵。但还有希望。
- en: Cloud storage is comparatively cheap and, as you can read in my *Learn Amazon
    Web Services in a Month of Lunches* book (Manning, 2017), simple to set up. Because
    the big cloud providers invest vast funds in data security and resilience, their
    services are pretty much guaranteed to be more reliable than anything you could
    put together. Therefore, using cloud-based data as a backend to your locally hosted
    Nextcloud site is a serious option to explore. Here’s how it works.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 云存储相对便宜，并且正如您可以在我的《一个月午餐时间学习亚马逊网络服务》一书中所读到的（Manning，2017），设置简单。由于大型云服务提供商在数据安全和弹性方面投入了大量资金，他们的服务几乎可以保证比您能组合起来的任何东西都更可靠。因此，使用基于云的数据作为您本地托管
    Nextcloud 网站的后端是一个值得探索的严肃选项。以下是它是如何工作的。
- en: You’ll first need to enable the External Storage Support app bundle. From the
    gear icon at top right, click the Apps item, and then the Disabled Apps link in
    the left panel. As [figure 8.9](#ch08fig09) shows, the External Storage Support
    option appears in the list. Click Enable.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 您首先需要启用外部存储支持应用程序包。从右上角的齿轮图标开始，点击应用程序项，然后点击左侧面板中的禁用应用程序链接。如图 8.9 所示，外部存储支持选项出现在列表中。点击启用。
- en: Figure 8.9\. The list of currently available apps, including External Storage
    Support
  id: totrans-160
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 8.9\. 当前可用的应用程序列表，包括外部存储支持
- en: '![](Images/08fig09_alt.jpg)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/08fig09_alt.jpg)'
- en: 'From the command line on any computer with the AWS CLI installed and configured
    for your AWS account (the way you did it back in [chapter 5](kindle_split_013.xhtml#ch05)),
    create a new bucket with a globally unique name:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装并配置了AWS CLI的任何计算机的命令行上（就像您在[第5章](kindle_split_013.xhtml#ch05)中做的那样），创建一个具有全局唯一名称的新存储桶：
- en: '[PRE21]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Again, as you did back in [chapter 5](kindle_split_013.xhtml#ch05), retrieve
    a set of account access keys from the Your Security Credentials page in the AWS
    console. You can also use an existing set of keys if you’ve got one available.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，就像您在[第5章](kindle_split_013.xhtml#ch05)中做的那样，从AWS控制台的“您的安全凭证”页面检索一组账户访问密钥。如果您已有可用的密钥集，您也可以使用它。
- en: Now head back to your Nextcloud console, click Admin from the gear drop-down,
    and then click the External Storage link, which should be visible in the left
    panel. This opens the External Storage page, where you can click the Add Storage
    drop-down and select Amazon S3 from the list. (The list also includes Dropbox
    and Google Drive.)
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，返回您的Nextcloud控制台，点击齿轮下拉菜单中的“管理”，然后点击左侧面板中可见的“外部存储”链接。这会打开外部存储页面，您可以在其中点击“添加存储”下拉菜单并从列表中选择Amazon
    S3。（列表还包括Dropbox和Google Drive。）
- en: You’ll be prompted to enter the S3 bucket you want to use along with your access
    and secret keys. All other fields, which allow you to customize your configuration
    using things like nonstandard ports or SSL encryption, are optional. When you’re
    done, clicking the check mark to the right saves your settings and sets Nextcloud
    off trying to authenticate with AWS.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 您将被提示输入您想要使用的S3存储桶以及您的访问密钥和秘密密钥。所有其他字段，允许您使用非标准端口或SSL加密等来定制配置，都是可选的。完成设置后，点击右侧的勾号保存您的设置，并使Nextcloud尝试与AWS进行身份验证。
- en: If you’re successful, you’ll see a happy green circle to the left, as is visible
    in [figure 8.10](#ch08fig10). If it doesn’t work, the most likely cause is that
    you somehow used invalid authentication keys. It can’t hurt to confirm network
    connectivity to the internet and, in particular, AWS.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您成功，您将看到左侧的愉快绿色圆圈，如图8.10所示。[图8.10](#ch08fig10)。如果它不起作用，最可能的原因是您以某种方式使用了无效的认证密钥。确认网络连接到互联网，特别是AWS，不会有任何坏处。
- en: Figure 8.10\. The External Storages setup page for Amazon S3 shows a successful
    connection to my S3 bucket.
  id: totrans-168
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图8.10。Amazon S3的外部存储设置页面显示了我S3存储桶的成功连接。
- en: '![](Images/08fig10_alt.jpg)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![图片](Images/08fig10_alt.jpg)'
- en: 'You can test your new storage configuration by copying and pasting a file from
    your computer into the folder in your Nextcloud console. Then, from your AWS CLI,
    list the contents of your bucket:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过将文件从您的计算机复制粘贴到Nextcloud控制台中的文件夹来测试您的新存储配置。然后，从您的AWS CLI中列出您的存储桶内容：
- en: '[PRE22]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Of course, you’ll need to test it the other way too. Copy a local file to the
    bucket from your command line:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，您还需要以相反的方式测试它。从您的命令行将本地文件复制到存储桶中：
- en: '[PRE23]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: The test.txt file should appear in your console. Glorious multi-platform storage
    integration.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: test.txt文件应出现在您的控制台中。令人赞叹的多平台存储集成。
- en: Summary
  id: totrans-175
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 摘要
- en: Planning your data storage strategy requires balancing between cost and ease
    of use on one side versus security and control on the other.
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 制定数据存储策略需要在一侧平衡成本和易用性，在另一侧平衡安全性和控制。
- en: Ubuntu’s snaps are a distribution-neutral package management system that also
    provide secure, read-only isolation run environments.
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu的snaps是一个与发行版无关的包管理系统，同时也提供了安全、只读的隔离运行环境。
- en: In order to know how to route incoming HTTP traffic, Apache reads either multiple
    host definitions in a single .conf file or multiple host-definition files.
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为了知道如何路由传入的HTTP流量，Apache读取单个.conf文件中的多个主机定义或多个主机定义文件。
- en: Web servers generally provide resources to visitors using a special web server
    user account to balance access against system security.
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络服务器通常使用特殊的网络服务器用户账户为访客提供资源，以平衡访问和系统安全。
- en: Nextcloud keeps its configuration files in the /<DocumentRoot>/nextcloud/config
    directory and, in particular, in the config.php file.
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Nextcloud将其配置文件存储在/<DocumentRoot>/nextcloud/config目录中，特别是config.php文件中。
- en: Authenticating Nextcloud to an AWS S3 bucket is a matter of providing the bucket
    name and the access keys.
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将Nextcloud验证到AWS S3存储桶的问题在于提供存储桶名称和访问密钥。
- en: Key terms
  id: totrans-182
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 关键术语
- en: A *snap* is a packaged application that can, using `snapd`, be autonomously
    installed on most modern Linux distributions.
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*snap*是一个打包的应用程序，可以使用`snapd`在大多数现代Linux发行版上自主安装。'
- en: A *symbolic link* is a file system object representing a file or directory in
    a different location. Symbolic links in the /etc/apache2/sites-enabled/ directory
    point to files in /etc/apache2/sites-available/ that are read by Apache when it
    starts.
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*符号链接*是表示不同位置中的文件或目录的文件系统对象。/etc/apache2/sites-enabled/目录中的符号链接指向在Apache启动时由Apache读取的/etc/apache2/sites-available/目录中的文件。'
- en: '*Archives* can be compressed using the BZ2 algorithm as an alternative to gzip
    or zip.'
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*归档*可以使用BZ2算法进行压缩，作为gzip或zip的替代方案。'
- en: Security best practices
  id: totrans-186
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安全最佳实践
- en: Avoid keeping Nextcloud data files in the document root.
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免将Nextcloud数据文件保存在文档根目录中。
- en: Make sure that all public-facing files from your website are owned by the www-data
    user rather than the root user.
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保您网站的所有面向公众的文件的所有权属于www-data用户，而不是root用户。
- en: Keep database resources used by separate applications isolated by creating separate
    user accounts.
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过创建单独的用户账户，将不同应用程序使用的数据库资源隔离开来。
- en: Command-line review
  id: totrans-190
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 命令行审查
- en: '`a2enmod rewrite` enables the rewrite module so Apache can edit URLs as they
    move between a client and server.'
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`a2enmod rewrite`启用重写模块，以便Apache可以在客户端和服务器之间移动URL时编辑它们。'
- en: '`nano /etc/apache2/sites-available/nextcloud.conf` creates or edits an Apache
    host-configuration file for Nextcloud.'
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`nano /etc/apache2/sites-available/nextcloud.conf`创建或编辑Nextcloud的Apache主机配置文件。'
- en: '`chown -R www-data:www-data /var/www/nextcloud/` changes the user and group
    ownership of all website files to the www-data user.'
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`chown -R www-data:www-data /var/www/nextcloud/`将所有网站文件的用户和组所有权更改为www-data用户。'
- en: '`sudo -u www-data php occ list` uses the Nextcloud CLI to list available commands.'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sudo -u www-data php occ list`使用Nextcloud CLI列出可用的命令。'
- en: '`aws s3 ls s3://nextcloud32327` lists the contents of an S3 bucket.'
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`aws s3 ls s3://nextcloud32327`列出S3存储桶的内容。'
- en: Test yourself
  id: totrans-196
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 自我测试
- en: '**[1](#ch08qa2q0a1)**'
  id: totrans-197
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[1](#ch08qa2q0a1)**'
- en: ''
  id: totrans-198
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: A snap is which of the following?
  id: totrans-199
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: Snap是以下哪个？
- en: ''
  id: totrans-200
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: An Internet of Things driver for managing devices
  id: totrans-201
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用于管理设备的物联网驱动程序
- en: An isolated environment for securely running applications
  id: totrans-202
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用于安全运行应用程序的隔离环境
- en: An Ubuntu-centric package manager
  id: totrans-203
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以Ubuntu为中心的包管理器
- en: An application packaged for use as a self-contained resource
  id: totrans-204
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用于作为独立资源使用的应用程序包
- en: '**[2](#ch08qa2q0a2)**'
  id: totrans-205
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[2](#ch08qa2q0a2)**'
- en: ''
  id: totrans-206
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following commands will list all packages currently installed on
    the system?
  id: totrans-207
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个命令将列出系统上当前安装的所有包？
- en: ''
  id: totrans-208
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`snap list`'
  id: totrans-209
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`snap list`'
- en: '`snap find`'
  id: totrans-210
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`snap find`'
- en: '`snap ls`'
  id: totrans-211
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`snap ls`'
- en: '`snapd ls`'
  id: totrans-212
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`snapd ls`'
- en: '**[3](#ch08qa2q0a3)**'
  id: totrans-213
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[3](#ch08qa2q0a3)**'
- en: ''
  id: totrans-214
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following is a rationale for not installing the Nextcloud files
    to the document root?
  id: totrans-215
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个不是将Nextcloud文件安装到文档根目录的理由？
- en: ''
  id: totrans-216
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Files in the document root are, by default, exposed to the public.
  id: totrans-217
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认情况下，文档根目录中的文件对公众是开放的。
- en: If there are other hosts being served by Apache, it would cause conflicts.
  id: totrans-218
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果Apache正在为其他主机提供服务，则会导致冲突。
- en: The Nextcloud configuration will only recognize files in /var/www/ nextcloud/
    directory.
  id: totrans-219
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: Nextcloud配置将只识别/var/www/nextcloud/目录中的文件。
- en: Files in the document root can’t be given ownership and group attributes that
    are compatible with Nextcloud.
  id: totrans-220
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: 文档根目录中的文件不能赋予与Nextcloud兼容的所有权和组属性。
- en: '**[4](#ch08qa2q0a4)**'
  id: totrans-221
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[4](#ch08qa2q0a4)**'
- en: ''
  id: totrans-222
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following will create a symbolic link to the nextcloud.conf file
    that will be read by Apache?
  id: totrans-223
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个命令将创建一个指向Apache读取的nextcloud.conf文件的符号链接？
- en: ''
  id: totrans-224
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`ln -s /etc/apache2/sites-enabled/nextcloud.conf /etc/apache2/sites-available/nextcloud.conf`'
  id: totrans-225
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`ln -s /etc/apache2/sites-enabled/nextcloud.conf /etc/apache2/sites-available/nextcloud.conf`'
- en: '`ln -s /etc/apache2/sites-available/nextcloud.conf /etc/apache2/sites-enabled/nextcloud.conf`'
  id: totrans-226
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`ln -s /etc/apache2/sites-available/nextcloud.conf /etc/apache2/sites-enabled/nextcloud.conf`'
- en: '`ln /etc/apache2/sites-enabled/nextcloud.conf /etc/apache2/sites-available/nextcloud.conf`'
  id: totrans-227
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`ln /etc/apache2/sites-enabled/nextcloud.conf /etc/apache2/sites-available/nextcloud.conf`'
- en: '`ln -h /etc/apache2/sites-enabled/nextcloud.conf /etc/apache2/sites-available/nextcloud.conf`'
  id: totrans-228
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`ln -h /etc/apache2/sites-enabled/nextcloud.conf /etc/apache2/sites-available/nextcloud.conf`'
- en: '**[5](#ch08qa2q0a5)**'
  id: totrans-229
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[5](#ch08qa2q0a5)**'
- en: ''
  id: totrans-230
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Which of the following commands will unpack the nextcloud-12.0.0.tar.bz2 archive?
  id: totrans-231
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 以下哪个命令将解压缩nextcloud-12.0.0.tar.bz2存档？
- en: ''
  id: totrans-232
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`tar xcf nextcloud-12.0.0.tar.bz2`'
  id: totrans-233
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`tar xcf nextcloud-12.0.0.tar.bz2`'
- en: '`tar xzf nextcloud-12.0.0.tar.bz2`'
  id: totrans-234
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`tar xzf nextcloud-12.0.0.tar.bz2`'
- en: '`tar jf nextcloud-12.0.0.tar.bz2`'
  id: totrans-235
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`tar jf nextcloud-12.0.0.tar.bz2`'
- en: '`tar xjf nextcloud-12.0.0.tar.bz2`'
  id: totrans-236
  prefs:
  - PREF_BQ
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`tar xjf nextcloud-12.0.0.tar.bz2`'
- en: Answer key
  id: totrans-237
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 答案键
- en: '**[1.](#ch08qa1q1)**'
  id: totrans-238
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[1.](#ch08qa1q1)**'
- en: ''
  id: totrans-239
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: d
  id: totrans-240
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: d
- en: '**[2.](#ch08qa1q2)**'
  id: totrans-241
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[2.](#ch08qa1q2)**'
- en: ''
  id: totrans-242
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: a
  id: totrans-243
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: a
- en: '**[3.](#ch08qa1q3)**'
  id: totrans-244
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[3.](#ch08qa1q3)**'
- en: ''
  id: totrans-245
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: a
  id: totrans-246
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: a
- en: '**[4.](#ch08qa1q4)**'
  id: totrans-247
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[4.](#ch08qa1q4)**'
- en: ''
  id: totrans-248
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: b
  id: totrans-249
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: b
- en: '**[5.](#ch08qa1q5)**'
  id: totrans-250
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**[5.](#ch08qa1q5)**'
- en: ''
  id: totrans-251
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: d
  id: totrans-252
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: d
