- en: 11 Model measurement and why it’s so important
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 11 模型测量及其重要性
- en: This chapter covers
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Methodologies for determining the impact of a model
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定模型影响的方法论
- en: A/B testing approaches for attribution data collection
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 归因数据收集的A/B测试方法
- en: In part 1, we focused on aligning ML project work to business problems. This
    is, after all, the most critical aspect for making the solution viable. While
    those earlier chapters focused on communication before, during, and immediately
    up to a production release, this chapter focuses on the project communication
    *after release*. We’ll cover how to present, discuss, and accurately report on
    the long-term health of ML projects—specifically, in language and methodologies
    that the business will understand.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一部分，我们专注于将机器学习项目工作与业务问题对齐。毕竟，这是使解决方案可行的最关键方面。虽然前面的章节侧重于发布前、发布期间以及发布后立即的沟通，但本章侧重于发布后的项目沟通。我们将介绍如何展示、讨论和准确报告机器学习项目的长期健康状况——特别是以业务能够理解的语言和方法。
- en: 'Discussions about model performance are complex. While the business is focusing
    on measurable attributes of business performance, the ML team is focused on measurements
    of model efficacy as it relates to strength of correlation to a target variable.
    Even though a language barrier is implicitly defined in these differing goals,
    a solution is available. By focusing communications to the business around its
    metrics, you can answer the question the business leaders really want answered:
    “How is this solution helping the company?” Ensuring that analytics are performed
    on those business metrics that the internal customer really cares about, a DS
    team can avoid the situation that figure 11.1 illustrates.'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 关于模型性能的讨论很复杂。当业务部门关注业务性能的可衡量属性时，机器学习团队则专注于与目标变量相关联的模型有效性的测量。尽管在这些不同的目标中隐含地定义了语言障碍，但解决方案是存在的。通过将沟通集中在业务指标上，你可以回答业务领导者真正想要了解的问题：“这个解决方案是如何帮助公司的？”确保在内部客户真正关心的业务指标上执行分析，数据科学团队可以避免图11.1所描述的情况。
- en: '![11-01](../Images/11-01.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![11-01](../Images/11-01.png)'
- en: Figure 11.1 ML project myopia
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.1 机器学习项目短视
- en: This ML team has project myopia. By focusing on their own requirements in order
    to get a solid solution into production, the ML team members are ill-prepared
    to answer their customer’s inevitable questions. Showing correlation metrics,
    after all, will mean absolutely nothing to the customer. Nor should it.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 这个机器学习团队存在短视问题。通过专注于自己的需求以将一个稳固的解决方案投入生产，机器学习团队成员没有准备好回答客户不可避免的疑问。毕竟，展示相关性指标对客户来说毫无意义。也不应该这样。
- en: The solution to this problem is available. It involves a bit of work outside
    the core solution development code, but it is well worth it to keep the business
    involved and informed about the status of the project. It all starts with measuring
    those business attributes.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 解决这个问题的方案是存在的。它涉及到核心解决方案开发代码之外的一点点工作，但保持业务参与并了解项目状态是非常值得的。一切始于衡量那些业务属性。
- en: 11.1 Measuring model attribution
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 11.1 测量模型归因
- en: We’re moving on to ice cream. Specifically, we’re a group of DSs working at
    an ice cream company. A few months ago, the sales and marketing teams approached
    us, asking for a model that will help identify when to send coupons to customers
    to increase the chance of them seeing those coupons in their inboxes. The marketing
    group’s standard behavior is to send out a bulk mailing every Monday morning at
    8 a.m. Our project aims to generate a day-and-hour combination to send the emails
    out on an individualized (personalized) basis.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将转向冰淇淋。具体来说，我们是一群在冰淇淋公司工作的数据科学家。几个月前，销售和营销团队找到我们，希望有一个模型能帮助他们确定何时发送优惠券给客户，以增加客户在收件箱中看到这些优惠券的机会。营销团队的标准做法是每周一早上8点发送大量邮件。我们的项目目标是生成一个日期和小时组合，以便以个性化的方式发送电子邮件。
- en: The top of figure 11.2 shows the components and examples of our prior state.
    The bottom of the figure shows what the model output fashions as part of an image
    component generator, personalized to each of our members.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.2的顶部显示了我们先前状态下的组件和示例。底部显示了模型输出作为图像组件生成器的一部分，针对我们每个成员个性化。
- en: '![11-02](../Images/11-02.png)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![11-02](../Images/11-02.png)'
- en: Figure 11.2 For our ice cream project, we have a baseline and a new experiment
    to test. How can we measure its success?
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.2 对于我们的冰淇淋项目，我们有一个基线和一项新的实验来测试。我们如何衡量它的成功？
- en: We’ve built this MVP and have shown some promising results based on our shadow
    runs. Through tracking our pixel data (a 1 × 1 pixel embedded in our emailed coupon
    codes that show the open and click rates for our marketing ads), we’re finding
    shockingly accurate results from our model based on our monitoring of actual open
    and usage rates of our coupons.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经构建了这个MVP（最小可行产品），并根据我们的影子运行（shadow runs）展示了一些有希望的结果。通过跟踪我们的像素数据（嵌入在我们电子邮件优惠券代码中的1
    × 1像素，显示我们营销广告的打开和点击率），我们发现模型基于我们对优惠券实际打开和使用率的监控，得到了令人震惊的准确结果。
- en: 'While this news is exciting, the business isn’t convinced by our delta error
    in minutes from prediction to actual opening time of the emails. What they really
    want to know is this: “Does this increase sales?” To begin to answer that question,
    we should analyze that metric, shown in figure 11.3.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这个消息令人兴奋，但业务部门并不被我们的预测到实际打开时间的分钟误差所说服。他们真正想知道的是：“这能增加销售额吗？”为了开始回答这个问题，我们应该分析图11.3中显示的指标。
- en: '![11-03](../Images/11-03.png)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![11-03](../Images/11-03.png)'
- en: 'Figure 11.3 Sales: the real target metric for our model'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.3 销售额：我们模型的真正目标指标
- en: How can we determine whether a causal relationship exists between sending targeted
    coupons to customers at times that they are most likely to see the coupons, and
    the customers’ use of those coupons? It all begins with determining what to measure,
    who to measure it on, and what tools to utilize to determine if the model has
    a causal influence.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们如何确定在客户最有可能看到优惠券的时间发送目标优惠券，与客户使用这些优惠券之间存在因果关系？这一切都始于确定要衡量什么，要在谁身上衡量，以及要利用什么工具来确定模型是否有因果影响。
- en: 11.1.1 Measuring prediction performance
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.1.1 衡量预测性能
- en: The first step that we need to think about in measuring our model’s performance
    is the same as we would engage in for any design of experiments (DOE) exercise.
    We start by talking to the experts who engage in the email marketing campaigns
    (our internal customers for this project) well before the production release date
    of our solution. This team, after all, has a fundamentally deep understanding
    of both our customers and their interactions with our product line.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在衡量我们模型性能的第一步，我们需要考虑的与任何实验设计（DOE）练习中需要考虑的是相同的。我们在解决方案的生产发布日期之前很久就开始与参与电子邮件营销活动的专家（我们项目的内部客户）交谈。毕竟，这个团队对我们客户及其与我们产品线的互动有着根本的深入理解。
- en: During these discussions, we’ll want to focus on the marketing team’s knowledge
    of our customer. That deep understanding of the customer base will aid us in determining
    which data that we collect about them can be used to limit the latent effects
    in order to minimize variance in our results. Table 11.1 shows the conjectures
    that the SME groups and the DS team have, along with the results of the analysis.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在这些讨论中，我们将希望关注营销团队对我们客户的了解。对客户基础的深入理解将帮助我们确定我们收集的哪些关于他们的数据可以用来限制潜在的效应，以最小化结果中的方差。表11.1显示了SME小组和DS团队提出的假设，以及分析的结果。
- en: Table 11.1 Hypothesized differentiators vs. actual prior evidence in our data
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 表11.1 假设的不同化因素与我们的数据中的实际先前证据
- en: '| Hypothesis | Significant? | Stratification candidate? |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| 假设 | 显著吗？ | 分层候选者？ |'
- en: '| Customers in hotter climates buy more ice cream. | No | No |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| 热带气候地区的客户购买更多冰淇淋。 | 否 | 否 |'
- en: '| Customers who live in rural areas buy more. | Yes | Maybe* |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| 居住在农村地区的客户购买更多。 | 是 | 可能* |'
- en: '| Customers over the age of 30 buy more. | No | Maybe* |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| 30岁以上的客户购买更多。 | 否 | 可能* |'
- en: '| Customers who open emails buy more. | Yes | Yes |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| 打开电子邮件的客户购买更多。 | 是 | 是 |'
- en: '| Customers who have a long history with us buy more. | Yes | Maybe** |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| 与我们合作历史悠久的客户购买更多。 | 是 | 可能** |'
- en: '| Customers with children buy more. | Yes | No*** |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '| 有孩子的客户购买更多。 | 是 | 否*** |'
- en: '| * Possibility of introducing massive skew in our analysis. Potentially high-risk
    stratification value.** Could be combined with purchase amount and recency of
    purchases.*** Insufficient data and potentially hard to keep track of. |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| * 可能会引入分析中的巨大偏差。潜在的高风险分层值** 可以与购买金额和购买频率结合。*** 数据不足，可能难以跟踪。 |'
- en: The analytical process of evaluating different customer base groupings on our
    historical data will help isolate behavior patterns to minimize within-group variance.
    Figure 11.4 illustrates what we’re going to be doing with the optimal stratification
    methodology that we found in our analytical tests.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 评估我们历史数据中不同客户基础分组的分析过程将有助于隔离行为模式以最小化组内方差。图11.4说明了我们将使用我们在分析测试中找到的最优分层方法所要做的事情。
- en: '![11-04](../Images/11-04.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![11-04](../Images/11-04.png)'
- en: Figure 11.4 Minimizing latent factor effects by stratified grouping in order
    to reduce within-group variance
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.4 通过分层分组最小化潜在因素效应以减少组内方差
- en: We know that we need to minimize the latent variable effects that are causing
    behavior imbalance. We can’t get the data that conclusively identifies the behaviors
    that we’re seeing (multimodality), but we certainly can improve our attribution
    if we control for it. But how can we do that? How do we group our users most effectively?
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 我们知道我们需要最小化导致行为不平衡的潜在变量效应。我们无法获得确定性地识别我们看到的（多模态）行为的资料，但如果我们控制它，我们当然可以改善我们的归因。但我们如何做到这一点？我们如何最有效地对用户进行分组？
- en: Based on our discussions with the SME group, we set about analyzing approaches
    that can reduce the inherent variability within our population. By listening to
    the marketing team, we find that its tried-and-true methodology for evaluating
    customer cohorts is the most optimal solution. By combining the recency of purchases,
    the number of historical purchases, and the total amount of spending sent our
    way by customers, we can define a standard metric to classify our cohorts (see
    the following sidebar regarding RFM for the power of this segmentation technique).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我们与行业专家小组的讨论，我们着手分析可以减少我们人口内在变异性的方法。通过听取营销团队的意见，我们发现其经过验证的方法论，即评估客户群体的最优化解决方案。通过结合购买的最近性、历史购买次数以及客户发送给我们的总消费金额，我们可以定义一个标准指标来分类我们的群体（有关RFM的细分技术功效，请参阅以下侧边栏）。
- en: 'RFM: A great way to group humans if you’re selling things to them'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: RFM：如果你向他们销售东西，这是一个将人类分组的好方法
- en: '*RFM*, an acronym for *recency, frequency, and monetary value*, is a direct
    marketing term coined by Jan Roelf Bult and Tom Wansbeek. In their article “Optimal
    Selection for Direct Mail,” they postulated RFM as a significantly powerful means
    of assigning value to customers. The pair estimated that 80% of a company’s revenue
    actually comes from 20% of its customers.'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '*RFM*，即*最近性、频率和货币价值*的缩写，是一个由Jan Roelf Bult和Tom Wansbeek提出的直接营销术语。在他们关于“直接邮件最优选择”的文章中，他们提出RFM是一种将客户价值化的非常强大的手段。这对估计认为，公司80%的收入实际上来自其20%的客户。'
- en: While prescient in the extreme, the success of this methodology has been proven
    time and again in many industries (not relegated to only business-to-consumer
    companies, either). The principal concept is to define five quantile-based buckets
    of customers on each of these three observational variables. Customers with a
    high value in monetary value, for instance, would be the top 20% of spenders,
    receiving a value of `5` for `M`. Customers with a low value in frequency (the
    number of total purchases over the lifetime of the account), typically consisting
    of one-time purchasers, would have an `F` value of `1`.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然极具先见之明，但这种方法的成功已经在许多行业中得到了反复证明（不仅限于面向消费者的公司）。主要概念是在这三个观测变量中的每一个上定义五个基于分位数的客户桶。例如，货币价值高的客户将是花费最高的前20%，对于“M”的值为`5`。频率低（账户生命周期内的总购买次数）的客户，通常只购买一次，将具有`F`值为`1`。
- en: When combined, RFM values create a matrix of 125 elements ranging from the lowest-value
    customer (111) to the highest-value (555) customer. Applying business-specific
    and industry-specific meta-groupings atop these raw 125 matrix entry values allows
    for a company (and a DS team) to have points of latent-variable-lessening stratification
    points for the purposes of hypothesis testing.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 当结合在一起时，RFM值会形成一个包含125个元素的矩阵，从价值最低的客户（111）到价值最高的客户（555）。在这些原始的125个矩阵条目值之上应用业务特定和行业特定的元分组，使公司（以及数据科学团队）能够为假设测试目的拥有无潜在变量分层点。
- en: I once was a bit incredulous at this technique of grouping human behavior in
    such a simplistic way—until I analyzed it for a third time at a third company.
    I’m now a pretty firm believer in this seemingly simplistic but wondrously powerful
    technique.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 我曾经对这种将人类行为以如此简单的方式分组的技术有点怀疑——直到我在第三家公司第三次分析它。我现在对这个看似简单但神奇强大的技术深信不疑。
- en: Using our RFM calculation to generate customer cohorts is shown in figure 11.5.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 使用我们的RFM计算生成客户群体如图11.5所示。
- en: '![11-05](../Images/11-05.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![11-05](../Images/11-05.png)'
- en: Figure 11.5 Histogram visualizations of the components of RFM for our customer
    base
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.5展示了我们客户基础的RFM组件的直方图可视化
- en: This RFM example isn’t exclusive to humans (or dogs, for that matter). In the
    percentile analysis of our customer base, we run the gamut from the most valuable
    (555, having very recent purchases, frequent historical purchases, and high spending
    over their lifetime) to the least valuable (111, the inversion of the preceding).
    This gives us the ability to generally estimate the massive number of latent factors
    that influence customer behavior. This, in turn, gives us the ability to stratify
    when doing analyses to ensure that we’re exposing tests to relatively uniform
    groups of people who behave similarly. It allows us to reduce variance through
    controlling our experiments.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 这个RFM示例并不局限于人类（或者，就狗而言）。在我们的客户基础的百分位分析中，我们涵盖了从最有价值（555，有非常近期的购买、频繁的历史购买以及在其一生中的高消费）到最无价值（111，前者的反转）。这使我们能够大致估计影响客户行为的潜在因素的大量数量。这反过来又使我们能够在分析时进行分层，以确保我们向行为相似的人群相对均匀的组别展示测试。这使我们能够通过控制实验来减少方差。
- en: Thought exercise If we did population sampling and 90% of the 555 members were
    selected into the control, while only 10% were in testing, what would the results
    of a causation validation be for our model? We would likely conclude that our
    model isn’t very good, which would be misleading. Conversely, what dangers does
    the opposite situation pose?
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 思考练习：如果我们进行人口抽样，并且90%的555名成员被选入对照组，而只有10%在测试组，那么我们的模型因果验证的结果会是什么？我们可能会得出结论，我们的模型不太好，这将是误导性的。相反，相反的情况会带来哪些危险？
- en: 'While the 125 combinations of RFM that occur from these three attributes are
    interesting, they’re not particularly helpful for analyzing our model’s performance
    as it relates to the business metrics of concern. With a collaborative effort
    from the marketing SMEs, we’re able to collapse these 125 groups into three primary
    meta-groups for our analysis: the high-value, medium-value, and low-value groups.'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管由这三个属性产生的125种RFM组合很有趣，但它们对于我们分析模型性能与关注的业务指标之间的关系并不特别有帮助。在市场领域的专家共同努力下，我们能够将这些125个组别合并为三个主要的元组，以便于我们的分析：高价值、中价值和低价值组。
- en: '![11-06](../Images/11-06.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![11-06](../Images/11-06.png)'
- en: Figure 11.6 Analyzing homogeneity among the three meta-groups that we defined
    as part of our RFM calculations collectively with the marketing SME group
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.6展示了我们与市场领域的专家小组共同定义的三个元组在RFM计算中的同质性分析
- en: This results in a general separation of our customer base, shown in figure 11.6\.
    The charts show a clear separation of each component’s contribution to our baseline
    revenue, the statistical significance in these differences, and a winning formula
    for us to use when engaging in hypothesis testing.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 这导致我们的客户基础出现了一般性的分离，如图11.6所示。图表显示了每个组件对我们基准收入的贡献、这些差异的统计显著性，以及我们在进行假设检验时可以使用的获胜公式。
- en: NOTE For further information about how these plots are generated (and the code),
    the statistical packages within Python that are employed to get these significance
    values, and the data generators involved, please see the companion code base to
    this book on GitHub at [https://github.com/BenWilson2/ML-Engineering](https://github.com/BenWilson2/ML-Engineering).
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：有关如何生成这些图表（以及代码）、用于获取这些显著性值的Python中的统计包，以及涉及的数据生成器等更多信息，请参阅GitHub上本书的配套代码库[https://github.com/BenWilson2/ML-Engineering](https://github.com/BenWilson2/ML-Engineering)。
- en: Why can’t I just use my scoring metrics to tell how well the model is doing?
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么我不能仅仅使用我的评分指标来告诉我模型做得怎么样？
- en: Let’s temporarily set aside the fact that the business is likely not familiar
    with the concept of prediction error metrics that we use for estimating the goodness
    of fit of our models. The primary reason that we can’t just use the scoring metrics
    to indicate how well the model is doing is that we aren’t evaluating the same
    things when we’re measuring business influence. Regardless of how well our models
    perform against holdout validation data, the metric performance is simply not
    guaranteed to have an effect on the targeted goal of any project.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们暂时不考虑业务可能不熟悉我们用于估计模型拟合优度的预测误差指标的概念。我们无法仅仅使用评分指标来表明模型表现如何的主要原因是我们测量业务影响力时评估的不是同一件事。无论我们的模型在保留验证数据上的表现如何，指标性能并不能保证对任何项目的目标有影响。
- en: It may seem as though we have completely solved a problem based on looking at
    metric performance against holdout data. However, claiming victory for an entire
    project solution based on these metrics is a bit preemptive and highly misleading.
    The problem with using correlation scores to estimate the quality of our models
    is that collected features don’t encompass all of the factors that influence an
    outcome.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来我们似乎已经完全解决了基于观察指标性能的问题。然而，仅基于这些指标就宣称整个项目解决方案的胜利是有点过于仓促且极具误导性的。使用相关性分数来估计我们模型的质量的问题在于，收集到的特征并没有涵盖影响结果的所有因素。
- en: We are, in the process of generating a feature vector, looking to optimize the
    correlation of our observations to the response variable. We can never really
    be certain that the predictions will do anything at all to influence what we’re
    trying to influence because of this fact.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在生成特征向量的过程中，我们正在努力优化我们的观察与响应变量的相关性。由于这个事实，我们永远无法确定预测会对我们试图影响的事物产生任何影响。
- en: For our scenario, the only way to determine influential effect of the predictions
    is to use *hypothesis testing*, measuring the revenue impact between those who
    see the model’s output and those who do not. The difference in revenue between
    these sample populations can give us confidence that our model has a probabilistic
    effect when applied to the entire population.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的场景，确定预测的影响力的唯一方法是通过 *假设检验*，测量看到模型输出的人和没有看到的人之间的收入影响。这些样本群体之间的收入差异可以让我们有信心，当我们的模型应用于整个群体时，它具有概率效应。
- en: 'Before we get into a larger discussion of why this is (correlation versus causation),
    let’s look at some differences in common supervised learning problems: ML metric
    scores compared to what a business metric for that same project would look like.
    Table 11.2 gives a few examples.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们进行更大范围的讨论之前，为什么这是（相关性 versus 因果性）之前，让我们看看一些常见的监督学习问题中的差异：机器学习指标分数与同一项目的业务指标相比会是什么样子。表11.2提供了一些例子。
- en: Table 11.2 Examples of project metrics vs. business metrics
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 表11.2 项目指标 vs. 业务指标示例
- en: '| Project | ML metric | Business metric |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| 项目 | 机器学习指标 | 业务指标 |'
- en: '| Fraud detection | Area under PR, area under ROC, F1 | Fraud loss dollars,
    number of fraud investigations |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| 欺诈检测 | PR曲线下面积、ROC曲线下面积、F1 | 欺诈损失金额、欺诈调查数量 |'
- en: '| Churn prediction | Area under PR, area under ROC, F1 | Recency of purchases,
    login events for high-churn risk |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| 顾客流失预测 | PR曲线下面积、ROC曲线下面积、F1 | 购买频率、高流失风险用户的登录事件 |'
- en: '| Sales forecasting | AIC, BIC, RMSE, etc. | Revenue |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| 销售预测 | AIC、BIC、RMSE等 | 收入 |'
- en: '| Sentiment analysis | BLEURT, BERTScore | Number of users of tool, engagement
    rate |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| 情感分析 | BLEURT、BERTScore | 工具用户数量、参与率 |'
- en: '| Ice cream coupons | MAE, MSE, RMSE | Revenue, coupon usage |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| 冰淇淋优惠券 | MAE、MSE、RMSE | 收入、优惠券使用率 |'
- en: This focus aligns the DS team’s perspective on what matters to the business,
    rather than solely on applicable loss metrics. While loss metrics are incredibly
    important for training, the possibility exists that an optimized loss metric (particularly
    in the case of an optimization to a spurious correlation within the dataset) does
    not equate to favorable conditions in the target business metric. Utilizing both
    the loss metrics and the business metrics throughout the lifetime of an ML-powered
    project will greatly reduce the risk of not meeting business expectations.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这种关注点与DS团队对业务重要性的看法相一致，而不仅仅是适用损失指标。虽然损失指标对于训练至关重要，但存在一种可能性，即优化的损失指标（尤其是在数据集中优化到虚假相关性的情况下）并不等同于目标业务指标的有利条件。在整个机器学习项目生命周期中利用损失指标和业务指标将大大降低未能满足业务预期的风险。
- en: The most important point to remember in presenting evidentiary results to the
    business at large is to never conflate the ideas of correlation and causation.
    Allowing people to infer causality from your results is a slippery slope to traverse.
    This becomes only more dangerous if the metrics being monitored are company-wide
    critical attributes such as revenue.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在向整个企业展示证据结果时，需要记住的最重要的一点是永远不要混淆相关性和因果关系的概念。让人们从你的结果中推断因果关系是一个容易滑倒的斜坡。如果被监控的指标是公司范围内的关键属性，如收入，这会变得更加危险。
- en: An A/B test can provide an evidence-based determination of a model’s impact
    based on observed differences in behavior, but that’s as far as you can go with
    making a declaration. It’s never a certainty. The best thing to do is to never
    allude to the correlation-based features of the model or the grouping characteristics
    utilized in a stratified analysis as being the actual cause of a driving force.
    We simply just don’t have the whole picture to make such claims.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: A/B 测试可以根据观察到的行为差异提供基于证据的模型影响判断，但这就是你可以做出的声明所能达到的极限。这永远不是确定性。最好的做法是永远不要暗示模型基于相关性的特征或分层分析中使用的分组特征是驱动力的实际原因。我们根本无法拥有完整的画面来做出这样的声明。
- en: A note on ML metrics
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 关于机器学习指标的一点说明
- en: I would be remiss if I didn’t clarify that I don’t have any problem with ML
    metrics. They’re incredibly useful, absolutely critical for the proper construction
    of models, and provide a wealth of information regarding the empirical quality
    of the correlation-focused predictions we’re able to do. If anything, I generally
    find myself collecting too many of them throughout the process of building a solution.
    (I’m a “just in case” sort of mathematical hoarder.)
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我没有明确指出，我没有对机器学习指标有任何问题。它们非常有用，对于正确构建模型至关重要，并且提供了大量关于我们能够进行的基于相关性的预测的经验质量信息。如果有什么不同的话，我通常在构建解决方案的过程中收集了太多的指标。（我是一个“以防万一”的数学收藏家。）
- en: That being said, ML metrics are utterly useless to a business unit. They’re
    irrelevant to internal and external customers.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 话虽如此，机器学习指标对业务部门来说毫无用处。它们对内部和外部客户都不相关。
- en: They don’t guarantee that you’re going to be solving the problem that you’re
    trying to solve. They are, by virtue of their design and purpose, nothing more
    than an informative tool to gauge the relative quality of how well you can match
    a target, provided the limited amount of data that you collect about reality.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 它们并不能保证你将解决你试图解决的问题。根据其设计和目的，它们不过是一个信息工具，用于衡量你如何匹配目标的相对质量，前提是你收集到的关于现实世界的有限数据。
- en: What I’m arguing in this chapter (and, generally, in many parts of the book)
    is that our focus should always be on the end state. We, as ML practitioners,
    should be focused on what it is that we’re building—not in the sense of which
    algorithms we’re using, which statistical models we’re employing, or in how elegant
    and clever our feature-engineering work is. The model and all of its supporting
    infrastructure and data feeds is employed to solve a problem.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章（以及，一般来说，在本书的许多部分）中，我所争论的是，我们的重点始终应该是最终状态。作为机器学习从业者，我们应该关注我们正在构建的东西——不是指我们使用哪种算法，我们使用哪种统计模型，或者我们的特征工程工作多么优雅和巧妙。模型及其所有支持的基础设施和数据流都是为了解决问题而使用的。
- en: Any project that is tackled by a DS team has intrinsic measurable qualities.
    If the project didn't, the chances that it will go beyond the experimentation
    phase is rather limited. The underlying problem being solved in any project has
    its own metrics that are generally defined by the team requesting that the DS
    team solve the problem.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 任何由数据科学团队承担的项目都具有内在的可衡量质量。如果项目没有，那么它将超出实验阶段的可能性相当有限。任何项目中要解决的问题都有其自己的指标，这些指标通常由请求数据科学团队解决问题的团队定义。
- en: Are we trying to increase sales? Then measure revenue, units sold, customer
    retention, repeat purchases, and length of sessions.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 我们是在尝试增加销售额吗？那么就衡量收入、销售单位、客户保留率、重复购买和会话长度。
- en: Are we trying to increase viewing of our content? Then measure percentage watched,
    time on platform, repeat visits, and consumption of recommendations.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 我们是在尝试增加我们内容的观看量吗？那么就衡量观看百分比、平台上的时间、重复访问和推荐内容的消费。
- en: Are we trying to detect fraud? Then measure successful identification rates,
    loss reduction, and customer satisfaction rates.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 我们是在尝试检测欺诈吗？那么就衡量成功识别率、损失减少和客户满意度率。
- en: Are we predicting equipment failure? Then measure post hoc equipment-inspection
    health checks, catastrophic repair-cost levels, and equipment replacement spending.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们是在预测设备故障吗？那么就测量事后设备检查的健康状况、灾难性维修成本水平和设备更换支出。
- en: The project’s directive includes a certain aspect of the business that has been
    measured and that is being closely scrutinized to warrant devoting the DS team’s
    efforts at fixing. The expectation from the business is that the application of
    ML will make things better.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 项目的指令包括一个已经测量并且正在被密切审查的业务方面，这是为了证明值得DS团队投入精力去修复。业务对应用机器学习的期望是使事情变得更好。
- en: If you’re not measuring whether you’re making things better, but instead using
    as justification of the predictive power of your implementation some esoteric
    statistical measure of correlation quality, you’re doing yourself and your team
    a disservice.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不是在衡量你是否在使事情变得更好，而是用一些神秘的统计指标来证明你实施预测能力的有效性，那么你是在对自己和你的团队不利。
- en: Keep the project’s terms in the metrics that the business is familiar with—the
    very reason the business leaders picked up that phone and gave you a ring about
    potentially being a hero for them. This focus will increase their faith in your
    team’s abilities, keep the team honest about the project’s impact on the business,
    and help everyone clearly recognize when things are no longer going as well as
    they once were (and, as you will see in the next section, this is an inevitability).
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 将项目的术语保持在业务熟悉的指标中——这正是业务领导拿起电话给你打电话，认为你可能成为他们英雄的原因。这种关注将增加他们对团队能力的信心，使团队对项目对业务的影响保持诚实，并帮助每个人清楚地认识到事情不再像以前那样顺利（正如你将在下一节中看到的，这是不可避免的）。
- en: 11.1.2 Clarifying correlation vs. causation
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.1.2 明确相关性与因果关系
- en: An important part of presenting model results to a business unit is to be clear
    about the differences between correlation and causation. If there is even a slight
    chance of business leaders inferring a causal relationship from anything that
    you are showing them, it’s best to have this chat.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 向业务部门展示模型结果的一个重要部分是明确区分相关性和因果关系。如果业务领导从你展示给他们的任何内容中推断出因果关系，即使只有一点可能性，最好还是进行这次对话。
- en: '*Correlation* is simply the relationship or association that observed variables
    have to one another. It does not imply any meaning apart from the existence of
    this relationship. This concept is inherently counterintuitive to laypersons who
    are not involved in analyzing data. Making reductionist conclusions that “seem
    to make sense” about the data relationships in an analysis is effectively how
    our brains are wired.'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '*相关性*简单来说就是观察到的变量之间存在的相互关系或关联。它并不暗示这种关系的存在之外有任何意义。这个概念对于不参与数据分析的普通人来说，本质上是不直观的。在分析中得出“看似合理”的关于数据关系的还原论结论，实际上就是我们的大脑是如何工作的。'
- en: 'For example, we could collect sales data for ice cream trucks and sales of
    mittens, both aggregated by week of year and country. We could calculate a strong
    negative correlation between the two (ice cream sales go up as mitten sales increase,
    and vice versa). Most people would chuckle at a conclusion of causality: “Well,
    if we want to sell more ice cream, we need to reduce our supply of mittens!”'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们可以收集冰淇淋车和手套的销售数据，这两者都按年度周和按国家汇总。我们可以计算出两者之间强烈的负相关性（手套销售增加时冰淇淋销售增加，反之亦然）。大多数人会对因果关系的结论感到好笑：“嗯，如果我们想卖更多冰淇淋，我们需要减少我们的手套供应！”
- en: What a layperson might instantly state from such a silly example is, “Well,
    people buy mittens when it’s cold and ice cream when it’s hot.” This is an attempt
    at defining causation. Based on this negative correlation in the observed data,
    we definitely can’t make such an inference regarding causation. We have no way
    of knowing what actually influenced the effect of purchasing ice cream or mittens
    on an individual basis (per observation).
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 普通人可能会从这样一个愚蠢的例子中立刻说出，“嗯，人们冷的时候买手套，热的时候买冰淇淋。”这是一种试图定义因果关系的尝试。基于观察数据中的这种负相关性，我们绝对不能做出这样的因果推断。我们无法知道实际上是什么影响了购买冰淇淋或手套对个人的影响（每个观察值）。
- en: If we were to introduce an additional confounding variable to this analysis
    (outside temperature), we might find additional confirmation of our spurious conclusion.
    However, this ignores the complexity of what drives decisions to purchase. As
    an example, see figure 11.7.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们在这个分析中引入一个额外的混淆变量（外部温度），我们可能会发现对我们虚假结论的额外证实。然而，这忽略了驱动购买决策的复杂性。例如，参见图11.7。
- en: '![11-07](../Images/11-07.png)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![11-07](../Images/11-07.png)'
- en: Figure 11.7 Correlation doesn’t imply causal associations.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.7 相关性并不表示因果关系。
- en: It’s clear that a relationship is present. As temperature increases, ice cream
    sales increase as well. The relationship being exhibited is fairly strong. But
    can we infer anything other than the fact that there is a relationship?
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，存在一种关系。随着温度的升高，冰淇淋的销售量也随之增加。所展示的关系相当强。但我们能推断出除了存在这种关系之外的其他任何东西吗？
- en: Let’s look at another plot. Figure 11.8 shows an additional observational data
    point that we could put into a model to aid in predicting whether someone might
    want to buy our ice cream.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看另一个图表。图11.8展示了我们可以放入模型中以帮助预测某人是否可能购买我们的冰淇淋的额外观察数据点。
- en: '![11-08](../Images/11-08.png)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![11-08](../Images/11-08.png)'
- en: Figure 11.8 A confounding correlation, when we think of the relationship of
    temperature to sales. Which one is driving the sales? Is it the temperature or
    the cloud cover? Is it a mixed effect?
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.8 一个混淆的相关性，当我们思考温度与销售之间的关系。是哪一个在推动销售？是温度还是云层？是混合效应吗？
- en: With the cloud cover plotted against sales, we’re getting an even stronger correlation
    than with temperature. What does this tell us? It simply says that a strong relationship
    (correlation) exists between these observed variables. We can’t infer anything
    other than that. We most certainly can’t make a logical leap of saying that high-temperature,
    cloudless days will guarantee ice cream purchases. Temperature and cloud cover
    certainly seem to have an influential effect on the purchase rate, but we can’t
    definitively say that these are the causes of the choice to either purchase or
    not purchase our ice cream.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 将云层与销售量对比，我们得到比温度更强的相关性。这告诉我们什么？它只是简单地说明这些观察变量之间存在强烈的（相关性）。我们无法推断出除此之外的其他任何东西。我们绝对不能做出逻辑跳跃，声称高温无云的日子将保证冰淇淋的购买。温度和云层似乎对购买率有显著的影响，但我们不能肯定地说这些是购买或不购买我们冰淇淋选择的原因。
- en: In the world of ML models, we’re dealing with optimizing a cost function among
    the relationships of observed variables to achieve the best reasonable estimate
    of (a) prediction variable(s) based on the data that we have. This does not, under
    any circumstances, imply causation.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 在机器学习模型的领域中，我们处理的是在观察变量的关系中优化成本函数，以基于我们所拥有的数据，对（一个或多个）预测变量进行最佳合理估计。在任何情况下，这都不意味着因果关系。
- en: 'There’s a simple reason for this: we’re not omnipotent. We simply don’t capture
    all of the reasons a decision is made. Since we’re not observing *all* of the
    reasons, our model is certainly ignorant of them as well. If we were able to capture
    all of the influences, we would all be out of a job as data scientists anyway,
    as people would be able to directly state expected outcomes with flawless precision
    and near-zero uncertainty.'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 这个现象有一个简单的解释：我们并非全能。我们根本无法捕捉到所有导致决策的原因。由于我们没有观察到所有原因，我们的模型当然也无法了解它们。如果我们能够捕捉到所有的影响因素，那么作为数据科学家，我们都会失业，因为人们能够直接以完美精确和几乎零不确定性来陈述预期的结果。
- en: Let’s imagine that we’re trying to figure out whether someone is going to purchase
    ice cream. Figure 11.9 shows a composite of influencing factors that may drive
    someone’s decision to purchase our product. In this vast sea of reasons, we are
    collecting a limited amount of data about this person. For the other influences
    that could be affecting the decision to buy, we simply can’t collect this information.
    The model likely wouldn’t be very generalizable if we did collect all of that
    information. We’d be crippled by the curse of dimensionality, and to make a useful
    model from this many features would require many billions of rows of data to be
    even remotely accurate.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们设想我们正在试图弄清楚某人是否会购买冰淇淋。图11.9显示了可能影响某人购买我们产品的各种影响因素的综合。在这个庞大的原因海洋中，我们只收集了关于这个人的有限数据。对于可能影响购买决策的其他影响因素，我们根本无法收集这些信息。如果我们收集了所有这些信息，模型可能不会具有很强的泛化能力。要从一个具有许多特征的有用模型中提取信息，我们需要数亿行数据才能达到哪怕是近似准确的程度。
- en: '![11-09](../Images/11-09.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![11-09](../Images/11-09.png)'
- en: Figure 11.9 The sea of influences to events that is unknowable to a model. If
    we’re not observing all of those elements, we can’t ever imply causation; we simply
    *don’t have all of the information*.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.9 模型无法知晓的事件影响之海。如果我们没有观察到所有这些元素，我们就无法推断因果关系；我们只是*没有所有信息*。
- en: It’s always best to not attempt to assign a causal relationship to any ML model’s
    results. Remember, we’re dealing with correlation and a best-effort attempt to
    draw a conclusion from correlated values in order to build predictions. We’re
    not set up for assigning meaning or motivation (causality) based on this myopic
    view of the myriad of forces that actually cause something to happen or not happen.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 总是最好不尝试将因果关系分配给任何机器学习模型的结果。记住，我们处理的是相关性，以及从相关值中得出结论的最佳努力，以构建预测。我们不是基于这种对众多导致某事发生或不发生的力量的狭隘观点来分配意义或动机（因果关系）。
- en: Similarly, we can’t directly infer a causal relationship just because of a statistically
    significant result to an A/B test. We can only reject an equivalency in results
    between testing groups. However, what we are able to do with A/B tests is to validate
    through a causal experiment whether our predictions are useful.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，我们不能仅仅因为 A/B 测试的统计显著结果就直接推断因果关系。我们只能拒绝测试组之间结果的等价性。然而，我们可以通过 A/B 测试来验证我们的预测是否有用。
- en: It’s important to understand these concepts as a data scientist. It’s even more
    important, however, to reinforce them when speaking with your internal customers
    in the business that you’re building projects for. Failing to communicate these
    principles has created a staggering amount of confusion and frustration in groups
    that I’ve worked with.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 作为数据科学家，理解这些概念很重要。然而，在向为你的业务构建项目的内部客户沟通时，强化这些概念更为重要。未能传达这些原则在我合作过的团队中造成了大量的困惑和挫败感。
- en: A note on causal analysis (inference)
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 关于因果分析（推断）的说明
- en: Certain techniques, such as DOE and causal modeling, can arrive at causal relationships
    between features and a target. Unlike supervised learning, which focuses solely
    on minimization of error terms, causal relationships that are discovered through
    DOE modeling can be confidently determined.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 某些技术，如设计实验（DOE）和因果建模，可以确定特征与目标之间的因果关系。与仅关注误差项最小化的监督学习不同，通过 DOE 建模发现的因果关系可以自信地确定。
- en: 'We can determine the magnitude and direction of effects on a target variable
    through the careful construction of directed acyclic graph (DAG) relationships
    in DOE, something that traditional supervised learning is incapable of doing.
    For further reading on the topics of causal modeling and DOE, I highly recommend
    reading *Elements of Causal Inference: Foundations and Learning Algorithms* by
    Jonas Peters et al. (MIT Press, 2017).'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过在 DOE 中精心构建有向无环图（DAG）关系，来确定对目标变量的影响程度和方向，这是传统监督学习无法做到的。关于因果建模和 DOE 的进一步阅读，我强烈推荐阅读由
    Jonas Peters 等人撰写的《因果推断要素：基础与学习算法》（MIT Press，2017年）。
- en: 11.2 Leveraging A/B testing for attribution calculations
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 11.2 利用 A/B 测试进行归因计算
- en: In the previous section, we established the importance of attribution measurement.
    For our ice cream coupon model, we defined a methodology to split our customer
    base into different cohort segments to minimize latent variable influence. We’ve
    defined why it’s so critical to evaluate the success criteria of our implementation
    based on business metrics associated with what we’re trying to improve (our revenue).
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一节中，我们确立了归因测量的重要性。对于我们的冰淇淋优惠券模型，我们定义了一种方法来将我们的客户群分为不同的群体段，以最小化潜在变量影响。我们定义了为什么基于我们试图改进的业务指标（我们的收入）来评估我们实施的成功标准是如此关键。
- en: Armed with this understanding, how do we go about calculating the impact? How
    can we make an adjudication that is mathematically sound and provides an irrefutable
    assessment of something as complex as a model’s impact on the business?
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 带着这种理解，我们如何进行影响力的计算？我们如何做出一个在数学上合理且对模型对业务影响这样复杂事物提供不可辩驳评估的判断？
- en: 11.2.1 A/B testing 101
  id: totrans-108
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.2.1 A/B 测试 101
- en: Now that we have defined our cohorts by using a simple percentile-based RFM
    segmentation (the three groups that we assigned to customers in section 11.1.1),
    we’re ready to conduct random stratified sampling of our customers to determine
    which coupon experience they will get.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经通过简单的基于百分比的RFM分段（第11.1.1节中分配给客户的三个组）定义了我们的群体，我们准备对客户进行随机分层抽样，以确定他们将获得哪种优惠券体验。
- en: The control group will be getting the pre-ML treatment of a generic coupon being
    sent to their inbox on Mondays at 8 a.m. PST. The test group will be getting the
    targeted content and delivery timing.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 控制组将获得在周一早上8点太平洋标准时间（PST）发送到他们收件箱的通用优惠券的预机器学习处理。测试组将获得目标内容和交付时间。
- en: 'NOTE Although simultaneously releasing multiple elements of a project that
    are all significant departures from the control conditions may seem counterintuitive
    for hypothesis testing (and it is confounding to a causal relationship), most
    companies are (wisely) willing to forego scientific accuracy of evaluations in
    the interest of getting a solution out into the world as soon as possible. If
    you’re ever faced with this supposed violation of statistical standards, my best
    advice is this: keep patiently quiet and realize that you can do variation tests
    later by changing aspects of the implementation in further A/B tests to determine
    causal impacts to the different aspects of your solution. When it’s time to release
    a solution, it’s often much more worthwhile to release the best possible solution
    first and then analyze components later.'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：虽然同时发布多个与控制条件显著不同的项目元素在假设检验中可能看起来反直觉（并且它对因果关系造成混淆），但大多数公司（明智地）愿意为了尽快将解决方案推向市场而放弃评估的科学准确性。如果你面临这种所谓的违反统计标准的所谓违规行为，我最好的建议是：保持耐心，保持沉默，并意识到你可以在后续的A/B测试中通过改变实施方面的某些方面来进行变异测试，以确定对解决方案不同方面的因果影响。当是时候发布解决方案时，通常首先发布最佳可能的解决方案，然后分析组件更为有价值。
- en: Within a short period after production release, people typically want to see
    plots illustrating the impact as soon as the data starts rolling in. Many line
    charts will be created, aggregating business parameter results based on the control
    and test group. Before letting everyone go hog wild with making fancy charts,
    a few critical aspects of the hypothesis test need to be defined to make it a
    successful adjudication.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 在生产发布后的短时间内，人们通常希望看到数据开始滚动时即展示影响的图表。将创建许多折线图，基于控制组和测试组汇总业务参数结果。在让每个人都疯狂制作花哨的图表之前，需要定义假设检验的几个关键方面，以确保其成功裁决。
- en: How much data do we need to collect?
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要收集多少数据？
- en: When designing hypothesis testing, a critical part of the process is to determine
    appropriate sample sizes for the evaluation. The following listing shows a relatively
    straightforward method of determining an appropriate sample size based on the
    needs of the business.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在设计假设检验时，过程的一个关键部分是确定评估的适当样本大小。以下列表显示了一种相对直接的方法，根据业务需求确定适当的样本大小。
- en: Listing 11.1 Minimum sample size determinator
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 列表11.1 最小样本大小确定器
- en: '[PRE0]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: ❶ Someone was gracious enough to wrap the power solver from SciPy in statsmodels
    with a high-level API.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 有人为SciPy中的power求解器包装了statsmodels的高级API。
- en: ❷ Generates a list of “lift” deltas between control and test (percentage difference
    between metrics)
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 生成控制与测试之间的“提升”差值列表（指标之间的百分比差异）
- en: ❸ Solves for sample sizes for alpha 0.2 by setting effect_size to None
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 通过将effect_size设置为None来求解alpha 0.2的样本大小
- en: ❹ Solves for sample sizes for alpha of 0.01 (99% certainty in not having a type
    I error)
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 求解alpha为0.01（99%确信没有一类错误）的样本大小
- en: Figure 11.10 shows the result of running this code (the visualization code can
    be seen in the companion repository to this book). In both cases, we’re leaving
    the power value at 0.8, which can and should be adapted if the risk of type II
    errors is detrimental to the business for this use case.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.10显示了运行此代码的结果（可视化代码可在本书的配套仓库中找到）。在两种情况下，我们都将功效值保持在0.8，如果此类用例中二类错误的危险对业务有害，则可以也应该进行调整。
- en: '![11-10](../Images/11-10.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![11-10](../Images/11-10.png)'
- en: Figure 11.10 Sample size determination based on confidence requirements
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.10 基于置信度要求的样本大小确定
- en: As the alpha value (the significance level of our measurements) decreases, the
    number of recorded samples to determine a difference between test and control
    increases. Having the ability to communicate the amount of time required to collect
    enough data in order to make a conclusive judgment is absolutely essential before
    a model enters production. Without these expectations set, the business will simply
    be wondering when, and more depressingly, if, it will ever see promising results
    from the project.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 随着alpha值（我们测量的显著性水平）的降低，确定测试组和对照组之间差异所需的记录样本数量增加。在模型投入生产之前，能够传达收集足够数据所需的时间以做出结论性判断是绝对必要的。如果没有设定这些期望，企业将仅仅在猜测何时，以及更令人沮丧的是，是否能够从项目中看到有希望的结果。
- en: The preceding estimation is based entirely on statistical tests that require
    a normal distribution and homogenous sample group sizes. We will discuss in the
    remaining sections how to not only test parametric data, but also appropriate
    significance tests for nonparametric data and unbalanced sample sizes.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 上述估计完全基于需要正态分布和同质样本群体大小的统计测试。在接下来的章节中，我们将讨论如何不仅测试参数数据，还要测试非参数数据和样本量不平衡的适当显著性测试。
- en: What not to do
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 不应该做什么
- en: Figure 11.11 illustrates the way many companies evaluate attribution early in
    their journeys of using ML project work to impact business. Without proper analytics
    applied to the attribution measurement using sound statistical processes, a great
    deal of frustration can be felt by the business.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.11说明了许多公司在使用机器学习项目工作影响业务早期如何评估归因。如果没有应用适当的统计分析以及合理的统计过程来处理归因测量，企业可能会感到极大的挫败感。
- en: '![11-11](../Images/11-11.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![11-11](../Images/11-11.png)'
- en: Figure 11.11 Ignoring hypothesis testing creates frustration.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.11 忽略假设测试会带来挫败感。
- en: The best way to combat this is to set established rules about how data will
    be evaluated and how much time it’s going to take to adjudicate impacts, and to
    have a monitoring system in place to test for statistical significance of the
    monitored parameters.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 应对这一问题的最佳方法是制定关于如何评估数据和裁决影响所需时间的既定规则，并建立一个监控系统来测试监控参数的统计显著性。
- en: With our RFM cohorts defined, our sample size estimates understood, and an automated
    monitoring job to retrieve our attribution data for measurement, we’re ready to
    start on the evaluation of our project. We’re ready to see if all of the hard
    work was worth it.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 在定义了RFM群体、理解了样本量估计，并且有一个自动监控任务来检索我们的归因数据用于测量后，我们准备开始评估我们的项目。我们准备看看所有辛勤的工作是否值得。
- en: 11.2.2 Evaluating continuous metrics
  id: totrans-132
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.2.2 评估连续度量
- en: For our ice cream coupon optimizations, one of the primary measures that the
    business is concerned with is revenue. In many cases when dealing with measures
    of monetary value, the distributions associated with spending are generally highly
    *non-normal*. Figure 11.12 shows an unbounded purchase plot of spending associated
    with variable priced goods and infinite basket situations (such as in e-commerce).
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的冰淇淋优惠券优化，企业关注的其中一个主要指标是收入。在处理货币价值度量时，许多情况下与支出相关的分布通常是高度**非正态**的。图11.12显示了与可变价格商品和无限篮子情况（如电子商务中）相关的无界购买图。
- en: '![11-12](../Images/11-12.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![11-12](../Images/11-12.png)'
- en: Figure 11.12 A normalcy validation check on revenue by customers
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.12 对客户收入的正常性验证检查
- en: If you’re dealing with distributions that look like this plot, you won’t be
    using the standard parametric tests. For our use case, however, we have a fixed-price
    set of items (all of our ice cream is the same price), and the coupons that we’re
    issuing are for a single item. We’ve done our homework with statistical analysis,
    though, validating that we’re going to have data that is relatively normally distributed.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你处理的是类似这种图表的分布，你将不会使用标准的参数测试。然而，在我们的用例中，我们有一组固定价格的物品（我们所有的冰淇淋价格都相同），我们发放的优惠券针对的是单个物品。尽管如此，我们已经完成了统计分析的家庭作业，验证我们将拥有相对正态分布的数据。
- en: When conducting our experimental test of our solution, we’re going to define
    the parametric tests as shown in listing 11.2\. We’ll be applying these to a standard
    plot that can show not only a specific cohort’s sales data over time, but the
    equivalency test p-values for each of these tests. In actual practice, not all
    of these would be included as a report (displaying and calculating both parametric
    and nonparametric tests here are for demonstration purposes only). You should
    use only the one that is most applicable to your data.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行我们解决方案的实验测试时，我们将定义参数测试，如列表11.2所示。我们将将这些应用于标准图表，不仅可以显示特定客户群体随时间变化的销售数据，还可以显示每个测试的等效性测试p值。在实际操作中，并非所有这些都会包含在报告中（在这里展示和计算参数和非参数测试只是为了演示目的）。你应该只使用最适合你数据的那一个。
- en: Listing 11.2 Line plot with statistical tests
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 列表11.2 线形图与统计测试
- en: '[PRE1]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: ❶ Simple function to get critical stats about each series
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 获取每个序列关键统计信息的简单函数
- en: ❷ Function that calls the SciPy and statsmodels modules for calculating parametric
    and nonparametric equivalency tests
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 调用SciPy和statsmodels模块进行参数和非参数等效性测试的函数
- en: ❸ Calls to the series comparison function for acquiring the significance test
    values for in-plot display
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 调用序列比较函数以获取图表显示的显著性测试值
- en: ❹ Calls to the basic stats calculations for each series
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 调用每个序列的基本统计计算
- en: Figure 11.13 shows the result of executing this code; the first 150 days of
    testing results are depicted for the high-value customer cohort.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.13显示了执行此代码的结果；描绘了高价值客户群体前150天的测试结果。
- en: '![11-13](../Images/11-13.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![11-13](../Images/11-13.png)'
- en: Figure 11.13 Plotting test and control groups over time, showing the nonparametric
    nature of the data
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.13 随时间绘制测试组和对照组，显示数据的非参数性质
- en: The datasets being compared here are nonparametric. This is due to the trend
    over time of sales causing our distributions to shift as a function of time. The
    only condition that would allow us to use comparisons such as ANOVA, T-tests,
    and Z-tests would be if our data had stationarity (a trend of 0).
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 这里比较的数据集是非参数的。这是由于销售随时间趋势的变化，导致我们的分布随时间变化。唯一可能允许我们使用如方差分析、T检验和Z检验等比较的条件是，我们的数据具有平稳性（趋势为0）。
- en: Showing a time-series display in this fashion is but one part of illustrating
    test results. As we focused on in part 1, the ability to communicate clearly with
    the business is incredibly important for any ML project. It’s even more important
    when the topic of attribution and measurement comes into the conversation. Having
    the full picture involves more than a single presentation of the data results,
    as we will cover next.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 以这种方式展示时间序列显示只是展示测试结果的一部分。正如我们在第一部分所关注的，对于任何机器学习项目来说，与业务清晰沟通的能力至关重要。当归因和测量的主题进入对话时，这一点尤为重要。全面了解不仅涉及单一的数据结果展示，我们将在下一部分进行介绍。
- en: Do I really have to do this?!
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 我真的必须这样做吗?!
- en: In short, no.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 简而言之，不。
- en: 'ML project work has varying levels. Each level of business-impacting criticality
    has a corresponding level of urgency with regards to implementing attribution
    (and drift) measurements. Let’s take a look at a few examples:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 机器学习项目工作具有不同的级别。每个影响业务的临界性级别都对应着实施归因（和漂移）测量的紧迫性级别。让我们看看几个例子：
- en: '*Internal tooling model for generating labeled data for other projects*—Standard
    ML metrics are fine.'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*用于为其他项目生成标记数据的公司内部工具模型*——标准的机器学习指标是足够的。'
- en: '*Internal-to-the-company predictive model designed to assist another department
    with repetitive tasks*—Attribution modeling not applicable, periodic ad hoc drift
    detection could be worthwhile.'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*设计用于协助其他部门进行重复性任务的公司内部预测模型*——归因建模不适用，定期的临时漂移检测可能是有价值的。'
- en: '*Internal-to-the-company project that directly affects critical business operations*(helping
    to influence major business decisions)—Absolutely critical to have drift detection,
    and attribution modeling is a good idea to build.'
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*直接影响关键业务运营的公司内部项目*（帮助影响主要商业决策）——绝对需要具备漂移检测功能，并且建立归因建模是个好主意。'
- en: '*External customer-facing model*—Attribution measurement, drift detection,
    and bias detection (evaluation of prejudicial predictions that have real-world
    consequences of amplifying systemic societal issues based on the nature and type
    of data collected) are absolutely required.'
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*面向外部客户的模型*——归因测量、漂移检测和偏差检测（评估基于收集的数据的性质和类型，具有放大系统性社会问题实际后果的偏见预测）是绝对必要的。'
- en: 'The last element is what the majority of production ML is focused on: the critically
    important projects that affect the profitability or efficiency of a company. Of
    particular note in this list is the bias measurement, a topic of active research
    at the time this writing. I don’t go into this topic in this book, but it is a
    critical aspect of what we do. (Entire books are written on this topic, and I
    encourage all professional ML practitioners to read at least one of them.)'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个要素是大多数生产级机器学习所关注的：影响公司盈利能力或效率的关键重要项目。在这个列表中，特别值得注意的是偏差测量，这是在撰写本书时正在进行积极研究的一个主题。我在本书中不深入探讨这个主题，但它是我们工作的一个关键方面。（关于这个主题的书籍已经有很多，我鼓励所有专业机器学习从业者至少阅读其中之一。）
- en: 'Bias measurement becomes very important when our models are affecting people’s
    lives: credit card applications, home loan approvals, police patrol recommendations,
    urban funding, and human behavior risk detection are but a small sampling of some
    of the applications of ML that are being discovered as having severe bias based
    on prior behavior reflected in our datasets. Keeping an eye on the results is
    always going to save you from difficult conversations down the line.'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们的模型影响人们的生活时，偏差测量变得非常重要：信用卡申请、房屋贷款审批、警察巡逻推荐、城市资金和人类行为风险检测只是基于我们数据集中反映的先前行为的一些严重偏差的机器学习应用的小样本。密切关注结果总是能让你避免后续的困难对话。
- en: 11.2.3 Using alternative displays and tests
  id: totrans-158
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.2.3 使用替代显示和测试
- en: To accompany any temporal-referenced hypothesis test, presenting a box plot
    of the results to the business can be useful. While these charts are incredibly
    useful for distilling information in an approachable way, the vast majority of
    laypersons are not familiar with seeing these plots accompanied by the critically
    important statistical summaries that help guide interpretability.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 为了配合任何时间相关的假设检验，向业务展示结果的箱线图可能很有用。虽然这些图表以易于接受的方式提炼信息非常有用，但绝大多数非专业人士并不熟悉看到这些图表伴随着帮助指导可解释性的关键重要的统计摘要。
- en: Without a reference of statistical significance, a judgment can be made too
    easily on insufficient (or high-variance) data. The next listing shows an ANOVA
    plot for parametric data and the required `DataFrame` manipulations to conduct
    the test.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 没有统计显著性的参考，很容易对不足（或高方差）的数据做出判断。下一个列表展示了参数数据的 ANOVA 图和进行测试所需的 `DataFrame` 操作。
- en: Listing 11.3 Generation of ANOVA box plot report for parametric data
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.3 生成针对参数数据的 ANOVA 箱线图报告
- en: '[PRE2]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: ❶ Normalizing (melting) the DataFrame to support the ANOVA calculation in statsmodels
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 将 DataFrame 标准化（熔化）以支持 statsmodels 中的 ANOVA 计算
- en: ❷ Creates the linear model needed for ANOVA
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 创建 ANOVA 所需的线性模型
- en: ❸ Superimposes the ANOVA result statistics to the chart for easy reference
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 将 ANOVA 结果统计信息叠加到图表上，以便于参考
- en: The result of executing this code on an alternative dataset (one that is stationary
    and has no seasonal effects) is shown in figure 11.14\. For details on the differences
    of this dataset’s generation as compared to the one we have been using, see the
    companion repository to this book.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个替代数据集（一个静态且没有季节性影响的数据集）上执行此代码的结果显示在图 11.14 中。有关与我们所使用的数据集相比，此数据集生成的详细差异，请参阅本书的配套仓库。
- en: '![11-14](../Images/11-14.png)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
  zh: '![11-14](../Images/11-14.png)'
- en: Figure 11.14 Stationary parametric test example
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.14 静态参数测试示例
- en: With these parametric tests, we can get a far more accurate determination of
    the magnitude of differences in our testing. This is mostly because of the foundation
    upon which parametric student tests are built (requiring that the sample mean
    follows a normal distribution, and the standard error of the mean follows a chi-squared
    distribution with *n*- 1 degrees of freedom). In our original problem, with several
    groups being tested at the same time, it might have been a bit onerous to plot
    each of the ANOVA tests as paired tests. With merely three groups being split
    between test and control, this might not be too punishing to look through. But
    25 groups under test are a different story.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这些参数测试，我们可以更准确地确定测试中差异的大小。这主要是因为参数学生测试建立的基础（要求样本均值遵循正态分布，均值的标准误差遵循具有 *n*-
    1 个自由度的卡方分布）。在我们的原始问题中，同时测试几个组，可能有点繁重，需要将每个 ANOVA 测试作为配对测试来绘制。当只有三个组被分配到测试组和对照组时，这可能不会太令人痛苦。但是，25
    个组进行测试则是另一回事。
- en: Enter Tukey HSD tests (*HSD* stands for *honestly significant difference*).
    These are another type of parametric test with the main difference from the student
    family of tests being that pairwise comparisons between each of the groups can
    be conducted all at once. The following listing shows an implementation of this
    test and the accompanying visualization report.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 进入 Tukey HSD 测试（*HSD* 代表 *honestly significant difference*）。这是另一种参数测试，与学生家族测试的主要区别在于，可以一次性进行每个组之间的配对比较。以下列表展示了该测试的实现和相应的可视化报告。
- en: Listing 11.4 Tukey HSD hypothesis testing and plot
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11.4 Tukey HSD 假设检验和图表
- en: '[PRE3]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: ❶ Defines the structure of the return type from pairwise_tukeyhsd
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 定义 pairwise_tukeyhsd 返回类型的结构
- en: ❷ Extracts the data from the payload result from the Tukey HSD test
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 从 Tukey HSD 测试的结果中提取数据
- en: ❸ Runs the pairwise Tukey HSD test
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 运行配对 Tukey HSD 测试
- en: ❹ Returns the pairs, sorted by significance and mean delta
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 按显著性排序并返回成对数据
- en: ❺ Creates a display table on top of the box plots that shows the relationships
    among all of the paired groups under evaluation
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 在箱线图上方创建一个显示表，显示所有待评估配对组之间的关系
- en: Executing this code against our stationary full sample test group results in
    the plot shown in figure 11.15\. As you can see by looking at the medium-value
    and low-value groups, visually discerning differences between seemingly similar
    data is incredibly difficult. Setting aside that making visual or simple aggregation
    evaluations is incredibly dangerous, having the statistical validation tests as
    part of any comparison chart that you display to the business can help solidify
    the conclusions.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 将此代码应用于我们的静态全样本测试组结果，产生了图 11.15 中所示的图表。正如您通过查看中等价值和低价值组所看到的，在看似相似的数据之间进行视觉上的区分极其困难。抛开制作视觉或简单汇总评估的危险性不谈，将统计验证测试作为您向业务展示的任何比较图表的一部分，可以帮助巩固结论。
- en: '![11-15](../Images/11-15.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![11-15](../Images/11-15.png)'
- en: Figure 11.15 Tukey HSD pairwise comparison test, showing each group to every
    other group and whether the null hypothesis can be rejected for the paired comparisons
    of equivalency
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.15 Tukey HSD 配对比较测试，显示每个组与其他每个组的关系以及对于等效性的配对比较中是否可以拒绝零假设
- en: This straightforward graph is easy enough for the business units to interpret.
    It helps prevent anyone from making a judgment on the success (or failure) of
    the project until sufficient data exists to endorse that conclusion, whatever
    it may be. In the graph, we see that there is no appreciable difference between
    the test and control group for our medium-value cohort. This can help identify
    which groups may need a different approach (opening the door to the next iteration
    of the model and further tests) and which should be handled carefully (the high-value
    group’s test condition seems to be working splendidly; why change it now?).
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 这个简单的图表对于业务单元来说足够容易理解。它有助于防止在存在足够数据支持该结论之前，任何人就对项目的成功（或失败）做出判断。在图表中，我们可以看到，对于我们的中等价值队列，测试组和对照组之间没有明显的差异。这有助于确定哪些组可能需要不同的方法（为模型的下一迭代和进一步的测试打开大门）以及哪些应该谨慎处理（高价值组的测试条件似乎运作得非常出色；现在为什么要改变它呢？）。
- en: 11.2.4 Evaluating categorical metrics
  id: totrans-182
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 11.2.4 评估分类指标
- en: We’ve been discussing revenue up to this point, but it’s not the whole story
    in our ice cream consumption optimization project. While the executives are concerned
    about the model’s influence on sales figures, the marketing team (our internal
    customer) wants to know the uptake rate for coupon usage.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们一直在讨论收入，但这并不是我们冰淇淋消费优化项目的全部故事。虽然高管们关心模型对销售数字的影响，但市场营销团队（我们的内部客户）想知道优惠券的使用率。
- en: We can’t use the same approach that we used with continuous data for nominal
    data, unfortunately. Gone are the ANOVA tests, the Tukey HSD comparisons, or any
    other such technique. Instead, we need to delve into the world of categorical
    tests. We need to start thinking in the realm of *happen* versus *not happen*
    in regard to events that we’re measuring.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 很遗憾，我们不能使用与连续数据相同的处理方法来处理名义数据。ANOVA 测试、Tukey HSD 比较或其他类似技术都不再适用。相反，我们需要深入研究分类测试的世界。我们需要开始思考我们在测量事件时，是在考虑“发生”还是“未发生”。
- en: Listing 11.5 shows a simplistic mock-up of data measuring the ratios between
    our test and control groups for an example 50,000 coupons issued during the first
    50 days of testing. To keep the visualizations simple, we’ll put all of our cohorts
    into a single group (but in practice, you would have a different chart and set
    of statistical tests for each cohort).
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 列表11.5展示了测量测试组和对照组之间比率的数据的简单模拟，这是测试前50天发行的50,000张优惠券的例子。为了保持可视化简单，我们将所有队列放入一个单独的组中（但在实践中，您会有不同的图表和针对每个队列的统计测试）。
- en: Listing 11.5 Categorical significance testing
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 列表11.5 分类显著性测试
- en: '[PRE4]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: ❶ For each of the series data (event happens, event does not happen) for both
    test and control, gets the sum of these events
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 对于测试组和对照组的每个系列数据（事件发生，事件未发生），获取这些事件的和
- en: ❷ Runs a Fisher’s exact test on the matrix of happen/not happen for each group
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: ❷ 对每个组的“发生/未发生”矩阵运行Fisher精确测试
- en: ❸ Runs a chi-square contingency test on the matrix
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: ❸ 对矩阵运行卡方列联测试
- en: ❹ Gets the statistical tests from the categorical significance function
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: ❹ 从分类显著性函数中获取统计测试
- en: ❺ Stacks the bar charts atop one another for easily viewable rates of interaction
    over time
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: ❺ 将条形图堆叠在一起，以便轻松查看随时间变化的交互率
- en: ❻ Constructs the statistical test reporting box for the plot
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: ❻ 为图表构建统计测试报告框
- en: When we run this code (after having our sent and utilized ETL done for the coupons
    setup), we’ll end up with a chart that looks like figure 11.16.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们运行此代码（在为优惠券设置完成我们的发送和ETL处理后），我们最终会得到一个看起来像图11.16的图表。
- en: '![11-16](../Images/11-16.png)'
  id: totrans-195
  prefs: []
  type: TYPE_IMG
  zh: '![11-16](../Images/11-16.png)'
- en: Figure 11.16 Measuring categorical happen/not happen events in a hypothesis
    test analysis
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.16 在假设测试分析中测量分类的“发生/未发生”事件
- en: Figure 11.16 may not be applicable to all ML projects. The continuous value-based
    measurements in the earlier sections of this chapter are far more common. However,
    should you need to evaluate event-based data and provide a conclusive declaration
    about whether the test conditions are different, having this methodology as a
    tool is indispensable.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.16可能不适用于所有机器学习项目。本章前面的连续值测量更为常见。然而，如果您需要评估基于事件的数据并提供关于测试条件是否不同的结论性声明，拥有这种方法作为工具是必不可少的。
- en: General applications of attribution measurement
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 归因测量的通用应用
- en: We’ve discussed model attribution measurement for ice cream coupon issuance.
    Not to be dismissive of any ice-cream companies out there (I promise you, my dog
    loves you), but what about slightly *more serious* endeavors?
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经讨论了冰淇淋优惠券发行的模型归因测量。不是要贬低任何冰淇淋公司（我向你保证，我的狗爱你），但关于稍微“更严肃”的事业呢？
- en: The key regarding the monitoring of business attributes is to select a measurement
    metric that is useful. The utility of these metrics is, for lack of a better phrase,
    focused entirely on the concept of “the devil is in the details.” The measurement
    of business success has nuances that can range from useful to pointless. It is
    critical to select measurable attributes that incorporate the nuances of the business.
    Having discussions with the business unit SME group that is responsible for that
    aspect of the business is incredibly helpful to ensure that your attribution analysis
    is relevant.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 关于监控商业属性的关键是要选择一个有用的度量指标。这些指标的有用性，用更好的词来形容，完全集中在“细节决定成败”的概念上。商业成功的衡量具有细微差别，可以从有用到毫无意义。选择能够体现商业细微差别的可衡量属性至关重要。与负责该业务方面的业务单元SME团队进行讨论，以确保您的归因分析的相关性非常有帮助。
- en: The devil is in the details
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 细节决定成败
- en: Business metrics are, to an outsider, seemingly wrought from common sense. If
    we’re trying to measure revenue effects from a model, we just look at sales, right?
    If we’re calculating engagement lift, we just look at login events. Optimization
    of flight routes to international airports would look at airplane occupancy rates,
    correct?
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 对于外人来说，商业指标似乎是从常识中产生的。如果我们试图从模型中测量收入效应，我们只需查看销售额，对吧？如果我们计算参与度的提升，我们只需查看登录事件。优化飞往国际机场的航线会查看飞机的载客率，对吗？
- en: While defining these rules may seem trivial, I can assure you that it is not.
    For each use case, the details surrounding how to calculate which metric and the
    details about how those metrics are calculated have proven to be both complex
    and highly specific to the ways in which the company decides to run its business.
    Therefore, it is incredibly important to discuss any attribution metrics with
    your colleagues who otherwise calculate these metrics for reporting purposes for
    the company.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然定义这些规则可能看起来微不足道，但我可以向你保证，事实并非如此。对于每个用例，如何计算哪个指标以及这些指标是如何计算的细节，都已被证明既复杂又高度具体于公司决定如何运营业务的方式。因此，与你的同事讨论任何归因指标非常重要，否则他们将为公司的报告目的计算这些指标。
- en: If you’re building a solution that is attempting to target revenue for the company,
    talk to the finance team. If you’re working on efficiency optimizations for logistics,
    talk to the operations department. If the model is aiming to reduce defect density
    on manufactured parts, you should be talking to the quality assurance and metrology
    departments.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在构建一个试图为公司目标收入的解决方案，与财务团队交谈。如果你正在为物流的效率优化工作，与运营部门交谈。如果模型的目标是减少制造部件的缺陷密度，你应该与质量保证和计量部门交谈。
- en: Having a series of metrics that are consistent with the way the company defines
    its success in the realm that you’re interacting with will ensure that little
    to no confusion occurs when presenting the impact of the model to the business.
    With this consistency, faith in the solution is fostered, securing ML solutions
    as a key critical aspect to the operations of the company, and helping to grow
    innovation and generate further interesting projects for the DS team to solve.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有一系列与公司在互动领域定义其成功方式一致的指标，将确保在向业务展示模型影响时几乎不会出现混淆。有了这种一致性，对解决方案的信心得以培养，确保机器学习解决方案成为公司运营的关键关键方面，并有助于增长创新并为数据科学团队解决更多有趣的项目。
- en: How can I figure out which business metrics to monitor?
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 我该如何确定要监控哪些业务指标？
- en: 'The short answer: ask.'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 简短的回答：询问。
- en: Often the DS team is the one coming up with a great idea for ML project work—though
    the majority of the time, a business unit sponsor or executive approaches the
    team to solve a problem. Still, I can count on one hand the number of novel problems
    that I’ve been involved with.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，数据科学团队是提出出色的机器学习项目想法的一方——尽管大多数时候，业务单元的赞助商或高管会向团队寻求解决问题的帮助。尽管如此，我可以数得清我参与过的创新问题数量。
- en: I’m not understating the work that was done, simply being honest in saying that
    the problem existed before an ML solution was built. The difference is that it
    was being handled by humans rather than algorithms and code. Revenue maximization?
    That’s marketing. Fraud detection? That’s the fraud department. Pricing optimization?
    Demand prediction? Humans that have been doing that for a long time before you
    were called in to help out.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 我并不是在贬低所做的工作，只是诚实地表示，在构建机器学习解决方案之前，问题就已经存在。区别在于，它是由人类而不是算法和代码来处理的。收入最大化？那是市场营销。欺诈检测？那是欺诈部门。定价优化？需求预测？在你被召唤来帮忙之前，已经有很多人在做这些工作了。
- en: These people know their craft. They’ll know more about the nuances of the data,
    the realm of what they’re responsible for, and the nature of customers or processes
    far better than you will. The best source for determining which aspects of the
    business can be used to create a measurable metric for the performance of what
    you’re going to be building is these people.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 这些人了解他们的技艺。他们对于数据的细微差别、他们负责的领域以及客户或流程的本质的了解将远远超过你。确定哪些业务方面可以用来创建衡量你将要构建的性能的可衡量指标的最佳来源是这些人。
- en: Every time I begin work on a new project—aside from the first few solutions
    that I built in a vacuum and that failed quite spectacularly—I get to know these
    people. I invite them to discussions, to lunch, to meetings, and generally just
    listen to everything they say. I ask them pointed questions about how their own
    jobs are measured for success (if the department’s goals are the things that your
    model is measured against, it will be easier for everyone to understand the effects,
    after all). I ask them what queries they utilize to determine the success for
    their department. I ask what the team’s objectives and key results (OKRs) are.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 每次我开始一个新的项目——除了最初在真空状态下构建的几个解决方案，它们失败得相当惨烈——我都会认识这些人。我会邀请他们参与讨论、共进午餐、参加会议，并且一般都会倾听他们说的每一句话。我会就他们自己的工作如何衡量成功（如果部门的目标是衡量你的模型的标准，那么每个人都会更容易理解其影响）提出尖锐的问题。我会询问他们用来确定其部门成功与否的查询。我会询问团队的目标和关键结果（OKR）是什么。
- en: Perhaps they’ll tell you that they’re measured not by the number of correct
    fraud events that they detect, but more on the detection of novel fraud events
    that haven’t been seen before. Maybe they’ll say that they’re focused on catching
    enough fraud but never wanting to falsely flag fraud on a legitimate customer.
    These can influence the construction of your model, but they can also be used
    as the very metrics to gauge the health of your implementation.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 他们可能会告诉你，他们不是通过检测到的正确欺诈事件的数量来衡量的，而是更多地通过检测以前未见过的创新欺诈事件来衡量的。他们可能会说，他们专注于捕捉足够的欺诈，但从不希望错误地将欺诈标记在合法客户身上。这些可能会影响你模型的构建，但也可以用作衡量你实施健康状况的指标。
- en: By doing this alignment and involving the people who know about the topic so
    deeply, you’ll be preparing the project for a greater level of success upon release,
    but more important, for the ability to measure the production release model in
    the same way that the company at large will be viewing it. This will help ensure
    that you’re aware of degradation and issues (hopefully) before the company is
    aware of them, increasing the levels of stability in the project.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 通过进行这种对齐并涉及对主题了解如此深入的人，你将为项目在发布后获得更高的成功率做好准备，但更重要的是，为能够以公司整体将看到的方式衡量生产发布模型的能力做好准备。这将有助于确保你在公司意识到这些问题之前就意识到退化问题（希望如此），从而提高项目的稳定性水平。
- en: Now that we’ve covered how we’re going to measure an ML experiment for attribution
    analysis, focusing on answering the critical questions that the business will
    want to have answered about the project, it’s time to face the other elephant
    in the room. We need to figure out how to detect drift, what to do about it, and
    when to take action when the inevitable deterioration of our model happens. Having
    the statistics established for measuring it with our attribution analysis, paired
    with our internal DS-focused loss metrics, we’re prepared to face it head-on.
    It’s time to think about model drift.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经讨论了如何衡量归因分析中的ML实验，专注于回答业务希望对项目提出的关键问题，现在是时候面对房间里的大象了。我们需要弄清楚如何检测漂移，如何处理它，以及当我们的模型不可避免地恶化时何时采取行动。有了用于测量的统计数据，以及我们内部DS关注的损失指标，我们准备直面挑战。现在是时候考虑模型漂移了。
- en: Summary
  id: totrans-215
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Attribution analysis enables a DS team to communicate clearly about how its
    solution solves the problem that it was intending to solve for the business. Leveraging
    proper statistical methods and controlled testing can provide objective declarations
    of the status of the solution.
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 归因分析使DS团队能够清楚地沟通其解决方案如何解决其打算为业务解决的问题。利用适当的统计方法和受控测试可以提供关于解决方案状态的客观声明。
- en: By utilizing the correct statistical tests for evaluating A/B testing data,
    a statement regarding the status of a solution’s performance can be made, providing
    a data-driven declaration of the impact.
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过使用正确的统计测试来评估A/B测试数据，可以就解决方案性能的状态做出声明，提供基于数据的声明性影响。
