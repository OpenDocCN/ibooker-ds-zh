- en: 1 Before you begin
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1 在开始之前
- en: Docker is a platform for running applications in lightweight units called containers.
    Containers have taken hold in software everywhere, from serverless functions in
    the cloud to strategic planning in the enterprise. Docker is becoming a core competency
    for operators and developers across the industry--in the 2019 Stack Overflow survey,
    Docker polled as people’s number one “most wanted” technology ( *[http://mng.bz/04lW](https://shortener.manning.com/04lW)*
    ).
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Docker 是一个在轻量级单元（称为容器）中运行应用程序的平台。容器在软件的各个领域都取得了成功，从云中的无服务器函数到企业的战略规划。Docker
    正在成为整个行业操作员和开发者的核心能力——在 2019 年 Stack Overflow 调查中，Docker 被评为人们最想要的“最想拥有的”技术（*[http://mng.bz/04lW](https://shortener.manning.com/04lW)*）。
- en: And Docker is a simple technology to learn. You can pick up this book as a complete
    beginner, and you’ll be running containers in chapter 2 and packaging applications
    to run in Docker in chapter 3\. Each chapter focuses on practical tasks, with
    examples and labs that work on any machine that runs Docker--Windows, Mac, and
    Linux users are all welcome here.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: Docker 是一种易于学习的简单技术。你可以作为一个完全的初学者拿起这本书，你将在第 2 章中运行容器，在第 3 章中打包应用程序以便在 Docker
    中运行。每一章都专注于实际任务，包含任何运行 Docker 的机器上的示例和实验室——欢迎 Windows、Mac 和 Linux 用户。
- en: The journey you’ll follow in this book has been honed over the many years I’ve
    been teaching Docker. Every chapter is hands-on--except this one. Before you start
    learning Docker, it’s important to understand just how containers are being used
    in the real world and the type of problems they solve--that’s what I’ll cover
    here. This chapter also describes how I’ll be teaching Docker, so you can figure
    out if this is the right book for you.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在这本书中，你将跟随的旅程是我教授 Docker 多年来的经验结晶。每一章都是实战性的——除了这一章。在你开始学习 Docker 之前，了解容器在现实世界中的使用方式和它们解决的问题类型非常重要——这正是我将在这里介绍的内容。本章还将描述我将如何教授
    Docker，这样你可以判断这本书是否适合你。
- en: Now let’s look at what people are doing with containers--I’ll cover the five
    main scenarios where organizations are seeing huge success with Docker. You’ll
    see the wide range of problems you can solve with containers, some of which will
    certainly map to scenarios in your own work. By the end of this chapter you’ll
    understand why Docker is a technology you need to know, and you’ll see how this
    book will get you there.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们看看人们正在用容器做什么——我将介绍五个主要场景，在这些场景中，组织使用 Docker 取得了巨大的成功。你将看到你可以用容器解决的问题的广泛范围，其中一些无疑会映射到你自己的工作场景。到本章结束时，你将了解为什么
    Docker 是你需要了解的技术，你还将看到这本书将如何帮助你达到这个目标。
- en: 1.1 Why containers will take over the world
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.1 为什么容器将统治世界
- en: My own Docker journey started in 2014 when I was working on a project delivering
    APIs for Android devices. We started using Docker for development tools--source
    code and build servers. Then we gained confidence and started running the APIs
    in containers for test environments. By the end of the project, every environment
    was powered by Docker, including production, where we had strict requirements
    for availability and scale.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 我的 Docker 之旅始于 2014 年，当时我正在为一个为 Android 设备提供 API 的项目工作。我们开始使用 Docker 作为开发工具——源代码和构建服务器。然后我们获得了信心，开始在测试环境中将
    API 运行在容器中。到项目结束时，每个环境都由 Docker 支持，包括对可用性和扩展性有严格要求的生成环境。
- en: When I moved off the project, the handover to the new team was a single README
    file in a GitHub repo. The only requirement for building, deploying, and managing
    the app--in any environment--was Docker. New developers just grabbed the source
    code and ran a single command to build and run everything locally. Administrators
    used the exact same tools to deploy and manage containers in the production cluster.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 当我离开项目时，将项目交接给新团队的方式是在 GitHub 仓库中的一个单独的 README 文件。构建、部署和管理应用程序（在任何环境中）的唯一要求是
    Docker。新开发者只需获取源代码并运行一个命令即可在本地构建和运行一切。管理员使用完全相同的工具在生产集群中部署和管理容器。
- en: Normally on a project of that size, handovers take two weeks. New developers
    need to install specific versions of half a dozen tools, and administrators need
    to install half a dozen completely different tools. Docker centralizes the toolchain
    and makes everything so much easier for everybody that I thought one day every
    project would have to use containers.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，在那个规模的项目中，交接需要两周时间。新开发者需要安装半打工具的特定版本，管理员需要安装完全不同的半打工具。Docker 集中了工具链，让每个人都变得如此容易，以至于我认为有一天每个项目都将不得不使用容器。
- en: I joined Docker in 2016, and I’ve spent the last few years watching that vision
    becoming reality. Docker is approaching ubiquity, partly because it makes delivery
    so much easier, and partly because it’s so flexible--you can bring it into all
    your projects, old and new, Windows and Linux. Let’s look at where containers
    fit in those projects.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我于2016年加入Docker，并在过去几年中见证了这一愿景的实现。Docker正变得无处不在，部分原因是因为它使交付变得如此简单，部分原因是因为它非常灵活——您可以将它带入所有项目，无论是新的还是旧的，Windows还是Linux。让我们看看容器在这些项目中的位置。
- en: 1.1.1 Migrating apps to the cloud
  id: totrans-10
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.1.1 将应用程序迁移到云端
- en: Moving apps to the cloud is top of mind for many organizations. It’s an attractive
    option--let Microsoft or Amazon or Google worry about servers, disks, networks,
    and power. Host your apps across global datacenters with practically limitless
    potential to scale. Deploy to new environments within minutes, and get billed
    only for the resources you’re using. But how do you get your apps to the cloud?
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 将应用程序迁移到云端是许多组织的首要任务。这是一个有吸引力的选择——让微软、亚马逊或谷歌来担心服务器、磁盘、网络和电力问题。在全球数据中心托管您的应用程序，几乎具有无限的可扩展潜力。几分钟内部署到新的环境，并且只需为使用的资源付费。但您如何将应用程序迁移到云端呢？
- en: 'There used to be two options for migrating an app to the cloud: infrastructure
    as a service (IaaS) and platform as a service (PaaS). Neither option was great.
    Your choice was basically a compromise--choose PaaS and run a project to migrate
    all the pieces of your application to the relevant managed service from the cloud.
    That’s a difficult project and it locks you in to a single cloud, but it does
    get you lower running costs. The alternative is IaaS, where you spin up a virtual
    machine for each component of your application. You get portability across clouds
    but much higher running costs. Figure 1.1 shows how a typical distributed application
    looks with a cloud migration using IaaS and PaaS.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 过去，将应用程序迁移到云端有两种选择：基础设施即服务（IaaS）和平台即服务（PaaS）。这两种选择都不太理想。您的选择基本上是一种妥协——选择PaaS，并运行一个项目将应用程序的所有部分迁移到云中的相关托管服务。这是一个困难的项目，并且会将您锁定在单个云中，但它确实可以降低运行成本。另一种选择是IaaS，您需要为应用程序的每个组件启动一个虚拟机。您可以在云之间获得可移植性，但运行成本会高得多。图1.1显示了使用IaaS和PaaS进行云迁移的典型分布式应用程序的外观。
- en: '![](../Images/1-1.jpg)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/1-1.jpg)'
- en: Figure 1.1 The original options for migrating to the cloud--use IaaS and run
    lots of inefficient VMs with high monthly costs, or use PaaS and get lower running
    costs but spend more time on the migration.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.1 迁移到云端的原始选项——使用IaaS并运行大量效率低下的虚拟机，每月成本高昂，或使用PaaS以降低运行成本，但花费更多时间在迁移上。
- en: Docker offers a third option without the compromises. You migrate each part
    of your application to a container, and then you can run the whole application
    in containers using Azure Kubernetes Service or Amazon’s Elastic Container Service,
    or on your own Docker cluster in the datacenter. You’ll learn in chapter 7 how
    to package and run a distributed application like this in containers, and in chapters
    13 and 14 you’ll see how to run at scale in production. Figure 1.2 shows the Docker
    option, which gets you a portable application you can run at low cost in any cloud--or
    in the datacenter, or on your laptop.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: Docker提供了一种没有妥协的第三种选择。您将应用程序的每个部分迁移到容器中，然后您可以使用Azure Kubernetes服务或亚马逊的弹性容器服务，或在数据中心您自己的Docker集群中运行整个应用程序。您将在第7章中学习如何将此类分布式应用程序打包和运行在容器中，在第13章和第14章中您将看到如何在生产中大规模运行。图1.2显示了Docker选项，它使您能够以低成本在任何云中运行可移植的应用程序——或在数据中心，或在您的笔记本电脑上。
- en: '![](../Images/1-2.jpg)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/1-2.jpg)'
- en: Figure 1.2 The same app migrated to Docker before moving to the cloud. This
    application has the cost benefits of PaaS with the portability benefits of IaaS
    and the ease of use you only get with Docker.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.2 在迁移到云端之前将相同的应用程序迁移到Docker。此应用程序具有PaaS的成本效益，以及IaaS的可移植性效益，以及只有Docker才能提供的易用性。
- en: 'It does take some investment to migrate to containers: you’ll need to build
    your existing installation steps into scripts called Dockerfiles and your deployment
    documents into descriptive application manifests using the Docker Compose or Kubernetes
    format. You don’t need to change code, and the end result runs in the same way
    using the same technology stack on every environment, from your laptop to the
    cloud.'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 迁移到容器确实需要一些投资：您需要将现有的安装步骤构建到名为Dockerfile的脚本中，并将部署文档构建到使用Docker Compose或Kubernetes格式的描述性应用程序清单中。您不需要更改代码，并且最终结果将在每个环境中以相同的方式运行，从您的笔记本电脑到云端。
- en: 1.1.2 Modernizing legacy apps
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.1.2 现代化遗留应用程序
- en: You can run pretty much any app in the cloud in a container, but you won’t get
    the full value of Docker or the cloud platform if it uses an older, monolithic
    design. Monoliths work just fine in containers, but they limit your agility. You
    can do an automated staged rollout of a new feature to production in 30 seconds
    with containers. But if the feature is part of a monolith built from two million
    lines of code, you’ve probably had to sit through a two-week regression test cycle
    before you get to the release.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 您几乎可以在云中运行任何应用，但如果没有使用较旧的、单体式设计，您将无法获得Docker或云平台的全部价值。单体在容器中运行得很好，但它们限制了您的敏捷性。您可以使用容器在30秒内自动分阶段推出一个新功能到生产环境中。但如果该功能是构建自两百万行代码的单体的一部分，您可能不得不经历两周的回归测试周期，才能达到发布阶段。
- en: Moving your app to Docker is a great first step to modernizing the architecture,
    adopting new patterns without needing a full rewrite of the app. The approach
    is simple--you start by moving your app to a single container with the Dockerfile
    and Docker Compose syntax you’ll learn in this book. Now you have a monolith in
    a container.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 将您的应用迁移到Docker是现代化架构、采用新模式而不需要全面重写应用的绝佳第一步。方法很简单——您首先使用本书中将学习的Dockerfile和Docker
    Compose语法将您的应用移动到一个单独的容器中。现在您有一个容器中的单体。
- en: Containers run in their own virtual network, so they can communicate with each
    other without being exposed to the outside world. That means you can start breaking
    your application up, moving features into their own containers, so gradually your
    monolith can evolve into a distributed application with the whole feature set
    being provided by multiple containers. Figure 1.3 shows how that looks with a
    sample application architecture.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 容器在自己的虚拟网络中运行，因此它们可以相互通信而无需暴露给外部世界。这意味着您可以从拆分应用程序开始，将功能移动到它们自己的容器中，这样您的单体就可以逐渐演变成一个分布式应用，整个功能集由多个容器提供。图1.3显示了这在一个示例应用架构中的样子。
- en: '![](../Images/1-3.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/1-3.jpg)'
- en: Figure 1.3 Decomposing a monolith into a distributed application without rewriting
    the whole project. All the components run in Docker containers, and a routing
    component decides whether requests are fulfilled by the monolith or a new microservice.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.3 将单体分解为分布式应用，而不需要重写整个项目。所有组件都在Docker容器中运行，一个路由组件决定请求是由单体还是新的微服务来满足。
- en: This gives you a lot of the benefits of a microservice architecture. Your key
    features are in small, isolated units that you can manage independently. That
    means you can test changes quickly, because you’re not changing the monolith,
    only the containers that run your feature. You can scale features up and down,
    and you can use different technologies to suit requirements.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 这为您带来了微服务架构的许多好处。您的主要功能被封装在小型、独立的单元中，您可以独立管理它们。这意味着您可以快速测试更改，因为您不是在更改单体，而是在运行您功能的容器。您可以按需扩展和缩减功能，并且可以使用不同的技术来满足需求。
- en: Modernizing older application architectures is easy with Docker--you’ll do it
    yourself with practical examples in chapters 20 and 21\. You can deliver a more
    agile, scalable, and resilient app, and you get to do it in stages, rather than
    stopping for an 18-month rewrite.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Docker现代化较老的应用架构很容易——您将在第20章和第21章中通过实际示例自己完成这项工作。您可以交付一个更敏捷、可扩展和有弹性的应用，并且您可以在多个阶段完成它，而不是停下来进行为期18个月的全面重写。
- en: 1.1.3 Building new cloud-native apps
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.1.3 构建新的云原生应用
- en: Docker helps you get your existing apps to the cloud, whether they’re distributed
    apps or monoliths. If you have monoliths, Docker helps you break them up into
    modern architectures, whether you’re running in the cloud or in the datacenter.
    And brand-new projects built on cloud-native principles are greatly accelerated
    with Docker.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: Docker帮助您将现有应用迁移到云端，无论它们是分布式应用还是单体应用。如果您有单体应用，Docker可以帮助您将其拆分为现代架构，无论您是在云端运行还是在数据中心。而且，基于云原生原则构建的新项目通过Docker得到了极大的加速。
- en: The Cloud Native Computing Foundation (CNCF) characterizes these new architectures
    as using “an open source software stack to deploy applications as microservices,
    packaging each part into its own container, and dynamically orchestrating those
    containers to optimize resource utilization.”
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 云原生计算基金会（CNCF）将这些新架构描述为使用“开源软件堆栈来部署作为微服务应用，将每个部分打包到自己的容器中，并动态编排这些容器以优化资源利用。”
- en: Figure 1.4 shows a typical architecture for a new microservices application--this
    is a demo application from the community, which you can find on GitHub at *[https://
    github.com/microservices-demo](https://github.com/microservices-demo)* .
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.4 展示了一个新的微服务应用程序的典型架构——这是一个来自社区的演示应用程序，您可以在 GitHub 上找到，网址为 *[https://github.com/microservices-demo](https://github.com/microservices-demo)*
    。
- en: '![](../Images/1-4.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/1-4.jpg)'
- en: Figure 1.4 Cloud-native applications are built with microservice architectures
    where every component runs in a container.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.4 展示了云原生应用程序是使用微服务架构构建的，其中每个组件都在容器中运行。
- en: It’s a great sample application if you want to see how microservices are actually
    implemented. Each component owns its own data and exposes it through an API. The
    frontend is a web application that consumes all the API services. The demo application
    uses various programming languages and different database technologies, but every
    component has a Dockerfile to package it, and the whole application is defined
    in a Docker Compose file.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想了解微服务是如何实际实现的，这是一个很好的示例应用程序。每个组件都拥有自己的数据并通过 API 暴露。前端是一个消耗所有 API 服务的 Web
    应用程序。演示应用程序使用各种编程语言和不同的数据库技术，但每个组件都有一个 Dockerfile 来打包它，整个应用程序在 Docker Compose
    文件中定义。
- en: You’ll learn in chapter 4 how you can use Docker to compile code, as part of
    packaging your app. That means you don’t need any development tools installed
    to build and run apps like this. Developers can just install Docker, clone the
    source code, and build and run the whole application with a single command.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 您将在第 4 章中学习如何使用 Docker 编译代码，作为打包应用程序的一部分。这意味着您不需要安装任何开发工具来构建和运行此类应用程序。开发者只需安装
    Docker，克隆源代码，然后通过单个命令构建和运行整个应用程序。
- en: Docker also makes it easy to bring third-party software into your application,
    adding features without writing your own code. Docker Hub is a public service
    where teams share software that runs in containers. The CNCF publishes a map of
    open source projects you can use for everything from monitoring to message queues,
    and they’re all available for free from Docker Hub.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: Docker 还使将第三方软件引入您的应用程序变得容易，无需编写自己的代码即可添加功能。Docker Hub 是一个公共服务，团队在此共享在容器中运行的软件。CNCF
    发布了一个开源项目地图，您可以使用它进行从监控到消息队列的任何事情，并且所有这些都可以从 Docker Hub 免费获得。
- en: '1.1.4 Technical innovation: Serverless and more'
  id: totrans-36
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.1.4 技术创新：无服务器及其他
- en: 'One of the key drivers for modern IT is consistency: teams want to use the
    same tools, processes, and runtime for all their projects. You can do that with
    Docker, using containers for everything from old .NET monoliths running on Windows
    to new Go applications running on Linux. You can build a Docker cluster to run
    all those apps, so you build, deploy, and manage your entire application landscape
    in the same way.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 现代IT的一个关键驱动因素是一致性：团队希望为所有项目使用相同的工具、流程和运行时。您可以使用 Docker 实现，使用容器从在 Windows 上运行的旧
    .NET 单体应用到在 Linux 上运行的新 Go 应用程序。您可以构建一个 Docker 集群来运行所有这些应用程序，这样您就可以以相同的方式构建、部署和管理整个应用程序景观。
- en: Technical innovation shouldn’t be separate from business-as-usual apps. Docker
    is at the heart of some of the biggest innovations, so you can continue to use
    the same tools and techniques as you explore new areas. One of the most exciting
    innovations (after containers, of course) is serverless functions. Figure 1.5
    shows how you can run all your applications--legacy monoliths, new cloud-native
    apps, and serverless functions--on a single Docker cluster, which could be running
    in the cloud or the datacenter.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 技术创新不应与常规应用分离。Docker 是一些最大创新的核心，因此您可以在探索新领域的同时继续使用相同的工具和技术。最令人兴奋的创新之一（当然是在容器之后）是无服务器函数。图
    1.5 展示了您如何在一个 Docker 集群上运行所有应用程序——遗留的单体应用、新的云原生应用和无服务器函数——这个集群可以运行在云端或数据中心。
- en: Serverless is all about containers. The goal of serverless is for developers
    to write function code, push it to a service, and that service builds and packages
    the code. When consumers use the function, the service starts an instance of the
    function to process the request. There are no build servers, pipelines, or production
    servers to manage; it’s all taken care of by the platform.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 无服务器完全是关于容器的。无服务器的目标是让开发者编写函数代码，将其推送到服务，然后该服务构建和打包代码。当消费者使用该函数时，服务启动一个函数实例来处理请求。没有构建服务器、管道或生产服务器需要管理；这一切都由平台负责。
- en: Under the hood, all the cloud serverless options use Docker to package the code
    and containers to run functions. But functions in the cloud aren’t portable--you
    can’t take your AWS Lambda function and run it in Azure, because there isn’t an
    open standard for serverless. If you want serverless without cloud lock-in, or
    if you’re running in the datacenter, you can host your own platform in Docker
    using Nuclio, OpenFaaS, or Fn Project, which are all popular open source serverless
    frameworks.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在底层，所有云无服务器选项都使用Docker来打包代码和容器以运行函数。但云中的函数不可移植——你不能将你的AWS Lambda函数带到Azure中运行，因为没有无服务器的开放标准。如果你想要无服务器且不锁定云，或者你在数据中心运行，你可以使用Nuclio、OpenFaaS或Fn
    Project等流行的开源无服务器框架在自己的Docker平台上托管平台。
- en: Other major innovations like machine learning, blockchain, and IoT benefit from
    the consistent packaging and deployment model of Docker. You’ll find the main
    projects all deploy to Docker Hub--TensorFlow and Hyperledger are good examples.
    And IoT is particularly interesting, as Docker has partnered with Arm to make
    containers the default runtime for Edge and IoT devices.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 其他主要创新，如机器学习、区块链和物联网，都受益于Docker一致的打包和部署模型。你会发现主要项目都部署到Docker Hub上——TensorFlow和Hyperledger是很好的例子。物联网尤其有趣，因为Docker与Arm合作，使容器成为边缘和物联网设备的默认运行时。
- en: '![](../Images/1-5.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![图片1-5](../Images/1-5.jpg)'
- en: Figure 1.5 A single cluster of servers running Docker can run every type of
    application, and you build, deploy, and manage them all in the same way no matter
    what architecture or technology stack they use.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.5 运行Docker的单个服务器集群可以运行任何类型的应用程序，无论它们使用什么架构或技术栈，你都可以以相同的方式构建、部署和管理它们。
- en: 1.1.5 Digital transformation with DevOps
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.1.5 使用DevOps进行数字化转型
- en: All these scenarios involve technology, but the biggest problem facing many
    organizations is operational--particularly so for larger and older enterprises.
    Teams have been siloed into “developers” and “operators,” responsible for different
    parts of the project life cycle. Problems at release time become a blame cycle,
    and quality gates are put in to prevent future failures. Eventually you have so
    many quality gates you can only manage two or three releases a year, and they
    are risky and labor-intensive.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些场景都涉及技术，但许多组织面临的最大问题是运营问题——尤其是对于更大、更老的企业。团队已经被分割成“开发者”和“运营商”，负责项目生命周期的不同部分。发布时的问题变成了一种指责循环，并设置了质量关卡以防止未来的失败。最终，你会有如此多的质量关卡，你一年只能管理两到三个发布，而且它们是风险和劳动密集型的。
- en: DevOps aims to bring agility to software deployment and maintenance by having
    a single team own the whole application life cycle, combining “dev” and “ops”
    into one deliverable. DevOps is mainly about cultural change, and it can take
    organizations from huge quarterly releases to small daily deployments. But it’s
    hard to do that without changing the technologies the team uses.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: DevOps旨在通过让一个团队拥有整个应用程序的生命周期，将“开发”和“运维”结合成一个可交付成果，从而提高软件部署和维护的敏捷性。DevOps主要关于文化变革，它可以将组织从巨大的季度发布转变为每日的小规模部署。但是，如果不改变团队使用的科技，很难做到这一点。
- en: Operators may have a background in tools like Bash, Nagios, PowerShell, and
    System Center. Developers work in Make, Maven, NuGet, and MSBuild. It’s difficult
    to bring a team together when they don’t use common technologies, which is where
    Docker really helps. You can underpin your DevOps transformation with the move
    to containers, and suddenly the whole team is working with Dockerfiles and Docker
    Compose files, speaking the same languages and working with the same tools.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 运营商可能在Bash、Nagios、PowerShell和System Center等工具方面有背景。开发者使用Make、Maven、NuGet和MSBuild。当团队不使用共同的技术时，很难将团队聚集在一起，这正是Docker真正帮助的地方。你可以通过转向容器来支撑你的DevOps转型，突然之间，整个团队都在使用Dockerfile和Docker
    Compose文件，说着相同的语言，使用相同的工具。
- en: 'It goes further too. There’s a powerful framework for implementing DevOps called
    CALMS--Culture, Automation, Lean, Metrics, and Sharing. Docker works on all those
    initiatives: automation is central to running containers, distributed apps are
    built on lean principles, metrics from production apps and from the deployment
    process can be easily published, and Docker Hub is all about sharing and not duplicating
    effort.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 这还远不止于此。有一个强大的框架用于实现DevOps，称为CALMS——文化、自动化、精益、指标和共享。Docker在所有这些倡议上都发挥作用：自动化是运行容器的核心，分布式应用程序基于精益原则构建，生产应用程序和部署过程的指标可以轻松发布，而Docker
    Hub完全是关于共享，而不是重复工作。
- en: 1.2 Is this book for you?
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.2 这本书适合你吗？
- en: The five scenarios I outlined in the previous section cover pretty much all
    the activity that’s happening in the IT industry right now, and I hope it’s clear
    that Docker is the key to it all. This is the book for you if you want to put
    Docker to work on this kind of real-world problem. It takes you from zero knowledge
    through to running apps in containers on a production-grade cluster.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 我在前一节中概述的五个场景涵盖了目前IT行业几乎所有正在进行的活动，我希望很清楚的是，Docker是这一切的关键。如果你想要将Docker应用于这类现实世界的问题，这本书就是为你准备的。它将带你从零基础开始，直到在生产级集群上运行容器中的应用程序。
- en: The goal of this book is to teach you how to use Docker, so I don’t go into
    much detail on how Docker itself works under the hood. I won’t talk in detail
    about `containerd` or lower-level details like Linux `cgroups` and `namespaces`
    or the Windows Host Compute Service. If you want the internals, Manning’s Docker
    in Action, second edition, by Jeff Nickoloff and Stephen Kuenzli is a great choice.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 这本书的目标是教你如何使用Docker，因此我不会过多地详细介绍Docker本身是如何工作的。我不会详细讨论`containerd`或更底层的细节，如Linux的`cgroups`和`namespaces`或Windows主机计算服务。如果你想要了解内部结构，Jeff
    Nickoloff和Stephen Kuenzli合著的Manning的《Docker in Action》第二版是一个很好的选择。
- en: The samples in this book are all cross-platform, so you can work along using
    Windows, Mac, or Linux--including Arm processors, so you can use a Raspberry Pi
    too. I use several programming languages, but only those that are cross-platform,
    so among others I use .NET Core instead of .NET Framework (which only runs on
    Windows). If you want to learn Windows containers in depth, my blog is a good
    source for that ( *[https://blog.sixeyed.com](https://blog.sixeyed.com)* ).
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 这本书中的所有示例都是跨平台的，所以你可以使用Windows、Mac或Linux进行工作——包括Arm处理器，因此你也可以使用树莓派。我使用了几种编程语言，但只使用那些跨平台的，所以除了其他语言之外，我还使用.NET
    Core而不是.NET Framework（它只能在Windows上运行）。如果你想要深入了解Windows容器，我的博客是一个很好的资源（*[https://blog.sixeyed.com](https://blog.sixeyed.com)*）。
- en: Lastly, this book is specifically on Docker, so when it comes to production
    deployment I’ll be using Docker Swarm, the clustering technology built into Docker.
    In chapter 12 I’ll talk about Kubernetes and how to choose between Swarm and Kubernetes,
    but I won’t go into detail on Kubernetes. Kubernetes needs a month of lunches
    itself, but Kubernetes is just a different way of running Docker containers, so
    everything you learn in this book applies.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，这本书专门讲述Docker，所以在生产部署方面，我将使用内置在Docker中的集群技术Docker Swarm。在第12章中，我会谈到Kubernetes以及如何在Swarm和Kubernetes之间进行选择，但不会深入探讨Kubernetes。Kubernetes本身就需要一个月的午餐时间，但Kubernetes只是运行Docker容器的一种不同方式，所以这本书中学到的所有内容都适用。
- en: 1.3 Creating your lab environment
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.3 创建您的实验室环境
- en: Now let’s get started. All you need to follow along with this book is Docker
    and the source code for the samples.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们开始吧。跟随这本书你需要的是Docker和示例的源代码。
- en: 1.3.1 Installing Docker
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.1 安装Docker
- en: The free Docker Community Edition is fine for development and even production
    use. If you’re running a recent version of Windows 10 or macOS, the best option
    is Docker Desktop; older versions can use Docker Toolbox. Docker also supplies
    installation packages for all the major Linux distributions. Start by installing
    Docker using the most appropriate option for you--you’ll need to create a Docker
    Hub account for the downloads, which is free and lets you share applications you’ve
    built for Docker.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 免费的Docker社区版适用于开发和甚至生产使用。如果你正在运行Windows 10的最新版本或macOS，最佳选择是Docker Desktop；较旧版本可以使用Docker
    Toolbox。Docker还为所有主要的Linux发行版提供了安装包。首先，使用最适合你的选项安装Docker——你需要创建一个Docker Hub账户来下载，这是免费的，并允许你分享为Docker构建的应用程序。
- en: Installing Docker Desktop on Windows 10
  id: totrans-58
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 在Windows 10上安装Docker Desktop
- en: You’ll need Windows 10 Professional or Enterprise to use Docker Desktop, and
    you’ll want to make sure that you have all the Windows updates installed--you
    should be on release `1809` as a minimum (run `winver` from the command line to
    check your version). Browse to *[www.docker.com/products/docker-desktop](http://www.docker.com/products/docker-desktop)*
    and choose to install the stable version. Download the installer and run it, accepting
    all the defaults. When Docker Desktop is running you’ll see Docker’s whale icon
    in the taskbar near the Windows clock.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用Docker Desktop，你需要Windows 10专业版或企业版，并确保你已经安装了所有Windows更新——至少应该是发布`1809`（从命令行运行`winver`来检查你的版本）。浏览到*[www.docker.com/products/docker-desktop](http://www.docker.com/products/docker-desktop)*并选择安装稳定版本。下载安装程序并运行它，接受所有默认设置。当Docker
    Desktop运行时，你会在Windows时钟附近的任务栏中看到Docker的海豚图标。
- en: Installing Docker Desktop on macOS
  id: totrans-60
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 在macOS上安装Docker Desktop
- en: You’ll need macOS Sierra 10.12 or above to use Docker Desktop for Mac--click
    the Apple icon in the top left of the menu bar and select About this Mac to see
    your version. Browse to *[www.docker.com/products/docker-desktop](http://www.docker.com/products/docker-desktop)*
    and choose to install the stable version. Download the installer and run it, accepting
    all the defaults. When Docker Desktop is running, you’ll see Docker’s whale icon
    in the Mac menu bar near the clock.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用Docker Desktop for Mac，你需要macOS Sierra 10.12或更高版本--点击菜单栏左上角的苹果图标，选择“关于本机”以查看你的版本。浏览到*[www.docker.com/products/docker-desktop](http://www.docker.com/products/docker-desktop)*并选择安装稳定版本。下载安装程序并运行它，接受所有默认设置。当Docker
    Desktop运行时，你会在Mac菜单栏靠近时钟的位置看到Docker的海豚图标。
- en: Installing Docker Toolbox
  id: totrans-62
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 安装Docker Toolbox
- en: If you’re using an older version of Windows or OS X, you can use Docker Toolbox.
    The end experience with Docker is the same, but there are a few more pieces behind
    the scenes. Browse to *[https://docs.docker.com/toolbox](https://docs.docker.com/toolbox)*
    and follow the instructions--you’ll need to set up virtual machine software first,
    like VirtualBox (Docker Desktop is a better option if you can use it, because
    you don’t need a separate VM manager).
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在使用较旧的Windows或OS X版本，你可以使用Docker Toolbox。使用Docker的最终体验是相同的，但幕后有一些额外的组件。浏览到*[https://docs.docker.com/toolbox](https://docs.docker.com/toolbox)*并按照说明操作--你首先需要设置虚拟机软件，如VirtualBox（如果你可以使用Docker
    Desktop，它是一个更好的选择，因为你不需要单独的VM管理器）。
- en: Installing Docker Community Edition and Docker Compose
  id: totrans-64
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 安装Docker社区版和Docker Compose
- en: If you’re running Linux, your distribution probably comes with a version of
    Docker you can install, but you don’t want to use that. It will likely be a very
    old version of Docker, because the Docker team now provides their own installation
    packages. You can use a script that Docker updates with each new release to install
    Docker in a non-production environment--browse to *[https://get.docker.com](https://get.docker.com)*
    and follow the instructions to run the script, and then to *[https://docs.docker.com/compose/install](https://docs.docker.com/compose/install)*
    to install Docker Compose.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在运行Linux，你的发行版可能自带了一个可以安装的Docker版本，但你不想使用它。这很可能是非常旧的Docker版本，因为Docker团队现在提供他们自己的安装包。你可以使用Docker在每个新版本中更新的脚本，在非生产环境中安装Docker--浏览到*[https://get.docker.com](https://get.docker.com)*并按照说明运行脚本，然后访问*[https://docs.docker.com/compose/install](https://docs.docker.com/compose/install)*来安装Docker
    Compose。
- en: Installing Docker on Windows Server or Linux Server distributions
  id: totrans-66
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 在Windows Server或Linux服务器发行版上安装Docker
- en: Production deployments of Docker can use the Community Edition, but if you want
    a supported container runtime, you can use the commercial version provided by
    Docker, called Docker Enterprise. Docker Enterprise is built on top of the Community
    Edition, so everything you learn in this book works just as well with Docker Enterprise.
    There are versions for all the major Linux distributions and for Windows Server
    2016 and 2019\. You can find all the Docker Enterprise editions together with
    installation instructions on Docker Hub at *[http://mng.bz/K29E](https://shortener.manning.com/K29E)*
    .
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: Docker的生产部署可以使用社区版，但如果你需要一个受支持的容器运行时，你可以使用Docker提供的商业版本，称为Docker Enterprise。Docker
    Enterprise建立在社区版之上，所以你在本书中学到的所有内容都可以与Docker Enterprise兼容。它适用于所有主要的Linux发行版以及Windows
    Server 2016和2019。你可以在Docker Hub上找到所有Docker Enterprise版本以及安装说明，网址为*[http://mng.bz/K29E](https://shortener.manning.com/K29E)*。
- en: 1.3.2 Verifying your Docker setup
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.2 验证你的Docker设置
- en: There are several components that make up the Docker platform, but for this
    book you just need to verify that Docker is running and that Docker Compose is
    installed.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: Docker平台由几个组件组成，但在这本书中，你只需要验证Docker正在运行，并且Docker Compose已安装。
- en: 'First check Docker itself with the `docker` `version` command:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 首先使用`docker` `version`命令检查Docker本身：
- en: '`PS> docker version` `Client: Docker Engine - Community` `  Version:      
                19.03.5` `  API version:               1.40` `  Go version:      
             go1.12.12` `  Git commit:                633a0ea` `  Built:          
              Wed Nov 13 07:22:37 2019` `  OS/Arch:                   windows/amd64`
    `  Experimental:              false`   `Server: Docker Engine - Community` `  Engine:`
    `    Version:                 19.03.5` `    API version:             1.40 (minimum
    version 1.24)` `    Go version:              go1.12.12` `    Git commit:      
           633a0ea` `    Built:                   Wed Nov 13 07:36:50 2019` `    OS/Arch:
                    windows/amd64` `     Experimental: false`'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '`PS> docker version` `Client: Docker Engine - Community` `  Version:      
                19.03.5` `  API version:               1.40` `  Go version:      
             go1.12.12` `  Git commit:                633a0ea` `  Built:          
              Wed Nov 13 07:22:37 2019` `  OS/Arch:                   windows/amd64`
    `  Experimental:              false` `Server: Docker Engine - Community` `  Engine:`
    `    Version:                 19.03.5` `    API version:             1.40 (minimum
    version 1.24)` `    Go version:              go1.12.12` `    Git commit:      
           633a0ea` `    Built:                   Wed Nov 13 07:36:50 2019` `    OS/Arch:
                    windows/amd64` `     Experimental: false`'
- en: Your output will be different from mine, because the versions will have changed
    and you might be using a different operating system, but as long as you can see
    a version number for the Client and the Server, Docker is working fine. Don’t
    worry about what the client and server are just yet--you’ll learn about the architecture
    of Docker in the next chapter.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 您的输出将与我不同，因为版本可能会发生变化，您可能使用的是不同的操作系统，但只要您能看到客户端和服务器版本号，Docker 就运行正常。现在不必担心客户端和服务器是什么，您将在下一章学习
    Docker 的架构。
- en: 'Next you need to test Docker Compose, which is a separate command line that
    also interacts with Docker. Run `docker-compose` `version` to check:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，您需要测试 Docker Compose，这是一个独立的命令行工具，也用于与 Docker 交互。运行 `docker-compose` `version`
    检查：
- en: '`PS> docker-compose version` `docker-compose version 1.25.4, build 8d51620a`
    `docker-py version: 4.1.0` `CPython version: 3.7.4` ` OpenSSL version: OpenSSL
    1.1.1c 28 May 2019`'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '`PS> docker-compose version` `docker-compose version 1.25.4, build 8d51620a`
    `docker-py version: 4.1.0` `CPython version: 3.7.4` ` OpenSSL version: OpenSSL
    1.1.1c 28 May 2019`'
- en: Again, your exact output will be different from mine, but as long as you get
    a list of versions with no errors, you are good to go.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 再次强调，您的确切输出将与我不同，但只要您得到一个没有错误的版本列表，您就可以继续。
- en: 1.3.3 Downloading the source code for the book
  id: totrans-76
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.3 下载本书的源代码
- en: 'The source code for this book is in a public Git repository on GitHub. If you
    have a Git client installed, just run this command:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 本书源代码位于 GitHub 上的公共 Git 仓库中。如果您已安装 Git 客户端，只需运行此命令：
- en: '`git clone https://github.com/sixeyed/diamol.git`'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '`git clone https://github.com/sixeyed/diamol.git`'
- en: If you don’t have a Git client, browse to *[https://github.com/sixeyed/diamol](https://github.com/sixeyed/diamol)*
    and click the Clone or Download button to download a zip file of the source code
    to your local machine, and expand the archive.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有 Git 客户端，请浏览到 *[https://github.com/sixeyed/diamol](https://github.com/sixeyed/diamol)*
    并点击克隆或下载按钮，将源代码的 zip 文件下载到您的本地计算机，并解压缩存档。
- en: 1.3.4 Remembering the cleanup commands
  id: totrans-80
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1.3.4 记住清理命令
- en: 'Docker doesn’t automatically clean up containers or application packages for
    you. When you quit Docker Desktop (or stop the Docker service), all your containers
    stop and they don’t use any CPU or memory, but if you want to, you can clean up
    at the end of every chapter by running this command:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: Docker 不会自动为您清理容器或应用程序包。当您退出 Docker Desktop（或停止 Docker 服务）时，所有容器都会停止，并且它们不会使用任何
    CPU 或内存，但如果您愿意，您可以在每个章节结束时通过运行此命令来清理：
- en: '`docker container rm -f $(docker container ls -aq)`'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '`docker container rm -f $(docker container ls -aq)`'
- en: 'And if you want to reclaim disk space after following the exercises, you can
    run this command:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在完成练习后想要回收磁盘空间，可以运行此命令：
- en: '`docker image rm -f $(docker image ls -f reference=''diamol/*'' -q)`'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '`docker image rm -f $(docker image ls -f reference=''diamol/*'' -q)`'
- en: Docker is smart about downloading what it needs, so you can safely run these
    commands at any time. The next time you run containers, if Docker doesn’t find
    what it needs on your machine, it will download it for you.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: Docker 在下载所需内容方面很智能，因此您可以在任何时候安全地运行这些命令。下次您运行容器时，如果 Docker 在您的机器上找不到所需内容，它会为您下载。
- en: 1.4 Being immediately effective
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.4 立即生效
- en: “Immediately effective” is another principle of the Month of Lunches series.
    In all the chapters that follow, the focus is on learning skills and putting them
    into practice.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: “立即生效”是《午餐月系列》的另一个原则。在接下来的所有章节中，重点是学习技能并将它们付诸实践。
- en: Every chapter starts with a short introduction to the topic, followed by try-it-now
    exercises where you put the ideas into practice using Docker. Then there’s a recap
    with some more detail that fills in some of the questions you may have from diving
    in. Lastly there’s a hands-on lab for you to go the next stage.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 每一章都从对该主题的简要介绍开始，接着是“现在就试”练习，在这里你将使用Docker将这些想法付诸实践。然后是一个总结，其中包含更多细节，以填补你从深入研究过程中可能产生的疑问。最后，有一个动手实验室，让你进入下一个阶段。
- en: All the topics center around tasks that are genuinely useful in the real world.
    You’ll learn how to be immediately effective with the topic during the chapter,
    and you’ll finish by understanding how to apply the new skill. Let’s start running
    some containers!
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 所有主题都围绕在现实世界中真正有用的任务展开。你将在本章中学习如何立即有效地掌握该主题，并通过理解如何应用新技能来结束学习。让我们开始运行一些容器吧！
