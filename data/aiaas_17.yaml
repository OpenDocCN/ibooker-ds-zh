- en: appendix D. Setting up a DNS domain and certificate
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录 D. 设置 DNS 域和证书
- en: Several of the systems presented in this book require a common AWS setup that
    needs to be done via the AWS Management console, rather than programmatically.
    This is because some manual verification is required. Please ensure that you have
    completed the following setup before running the example systems.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本书介绍的一些系统需要通过 AWS 管理控制台进行常见的 AWS 设置，而不是通过编程方式。这是因为需要一些手动验证。请在运行示例系统之前确保你已经完成了以下设置。
- en: D.1 Setting up a domain
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: D.1 设置域名
- en: When you create dynamic HTTP endpoints for AWS resources like S3 buckets and
    API Gateway, AWS will generate a URL for these endpoints. You can use these generated
    names when you are not building a production application. It quickly becomes frustrating,
    however. Every time you remove and destroy these resources, the URLs may change.
    They are also long and difficult to remember. To avoid these problems, we are
    going to register a domain. The process is made easy by using the Route 53 service
    in AWS. Alternatively, if you already have a domain and wish to use it, or you
    wish to use a subdomain of an already registered domain, consult the Route 53
    documentation ([http://mng.bz/Mox8](http://mng.bz/Mox8)).
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 当你为 AWS 资源如 S3 存储桶和 API 网关创建动态 HTTP 端点时，AWS 将为这些端点生成一个 URL。当你不是在构建生产应用程序时，可以使用这些生成的名称。然而，这很快就会变得令人沮丧。每次你移除和销毁这些资源时，URL
    可能会改变。它们也很长，难以记住。为了避免这些问题，我们将注册一个域名。通过使用 AWS 中的 Route 53 服务，这个过程变得简单。如果你已经有一个域名并希望使用它，或者你希望使用已注册域名的子域名，请查阅
    Route 53 文档（[http://mng.bz/Mox8](http://mng.bz/Mox8)）。
- en: D.1.1 Registering a domain name
  id: totrans-4
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: D.1.1 注册域名
- en: We are going to walk through the process of registering a new domain from scratch
    using Route 53.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 Route 53 从头开始介绍注册新域名的流程。
- en: If you don’t yet have any domain-related resources on this AWS account, clicking
    the Route 53 link in the Networking section of the main AWS Console (assuming
    the All Services control is already expanded) takes you to an introductory screen.
    If you’ve already created resources, you’re instead sent to the Route 53 dashboard.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在这个 AWS 账户上还没有任何与域名相关的资源，点击主 AWS 控制台网络部分中的 Route 53 链接（假设所有服务控制已展开）将带你到一个介绍屏幕。如果你已经创建了资源，你将被发送到
    Route 53 仪表板。
- en: '![](../Images/APPD_F01_Elger.png)'
  id: totrans-7
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/APPD_F01_Elger.png)'
- en: Figure D.1 Amazon Route 53 introduction page showing the service’s four distinct
    elements
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 图 D.1 显示了 Amazon Route 53 介绍页面，展示了该服务的四个不同元素
- en: 'Figure D.1 shows the Route 53 introduction page. As you can see, Route 53 is
    built to deliver four distinct but closely related services: *domain registration*
    (Amazon is a domain name registrar); *DNS management*, which is the tool you’ll
    use to direct traffic to your domain; *traffic management*, to handle traffic
    redirection; and *availability monitoring*, to confirm that your target resources
    are performing the way they’re supposed to. We are only going to concern ourselves
    with domain registration and DNS management.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 图 D.1 显示了 Route 53 介绍页面。正如你所见，Route 53 是为了提供四个不同但紧密相关的服务而构建的：*域名注册*（Amazon 是一个域名注册商）；*DNS
    管理*，这是你用来将流量引导到你的域的工具；*流量管理*，用于处理流量重定向；以及*可用性监控*，用于确认你的目标资源正在按预期运行。我们只关注域名注册和
    DNS 管理。
- en: Click the Get Started Now button beneath Domain Registration, and then click
    Register Domain. Type the main part of the name--for example, *acme-corporation*
    if you wish to register *acme-corporation.com*. A drop-down menu displays domains
    including .com, .org, .net, and so on, with their annual registration cost. Select
    one, and click Check. Route 54 will search online records to see if that combination
    is currently available. When you find a domain name that fits your needs, add
    it to your cart, and go through the checkout process to submit payment for your
    first year’s registration fee. Domain registrations usually cost between $10 and
    $15 US per year and aren’t included in Free Tier usage. In a short time, your
    new domain will appear in the Route 53 dashboard. It may take a while before your
    domain registration is complete. At that point, you are ready to proceed to configuring
    your domain and using it for your newly developed serverless AI application!
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 点击域名注册下方的“立即开始”按钮，然后点击注册域名。输入名称的主要部分--例如，如果您想注册*acme-corporation.com*，则输入*acme-corporation*。一个下拉菜单显示包括.com、.org、.net等在内的域名，以及它们的年度注册费用。选择一个，然后点击检查。Route
    53将在网上搜索记录，查看该组合是否目前可用。当您找到一个符合您需求的域名时，将其添加到购物车，并完成结账流程以提交第一年的注册费用。域名注册通常每年花费10到15美元的美元，并且不包括免费层使用。在短时间内，您的新域名将出现在Route
    53仪表板中。在您的域名注册完成之前可能需要一段时间。到那时，您就可以继续配置您的域名，并使用它来为您的全新开发的Serverless AI应用程序服务了！
- en: Note There’s nothing forcing you to use Route 53 for your domain registration.
    In fact, you may find that other providers offer cheaper alternatives. You can
    use Route 53’s other features even for domains registered through other companies.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 注意 并没有强制您必须使用Route 53进行域名注册。实际上，您可能会发现其他提供商提供更便宜的替代方案。即使是通过其他公司注册的域名，您也可以使用Route
    53的其他功能。
- en: D.1.2 Configuring your hosted zone
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: D.1.2 配置您的托管区域
- en: 'Your domain is now registered, but you haven’t told it what to do with incoming
    requests. Route 53 will automatically create a *Hosted Zone* for your registered
    domain. Click Hosted Zones in the Route 53 section of the Console and follow the
    link to the new hosted zone. You will find yourself on a page with two pre-created
    record sets:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 您的域名现在已注册，但您还没有告诉它如何处理传入的请求。Route 53将自动为您注册的域名创建一个*托管区域*。在控制台的网络部分点击托管区域，然后点击新托管区域的链接。您将发现自己在一个带有两个预先创建的记录集的页面：
- en: '*Start of authority (SOA)*--Identifies your domain’s basic DNS configuration
    information.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*授权开始（SOA）*--标识您域的基本DNS配置信息。'
- en: '*NS*--Lists authoritative name servers that can be queried about your domain
    host. These are the public services that provide answers to domain-name translation
    requests.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*NS*--列出可以查询您的域名主机的权威性名称服务器。这些是提供域名翻译请求答案的公共服务。'
- en: Note *Record set*--A set of data records that defines a particular aspect of
    domain behavior.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 注意 *记录集*--一组数据记录，定义了域行为的特定方面。
- en: Don’t mess with either of these record sets. They’re not enough on their own
    to make your new domain name fully available. Later on, we will use the Serverless
    Framework to automatically add a new record that will tell anyone using your domain
    name servers (by pointing their browsers to your domain) to request the IP address
    used by our application.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 不要随意更改这两个记录集。仅凭它们本身不足以使您的新域名完全可用。稍后，我们将使用Serverless Framework自动添加一个新的记录，告诉任何使用您的域名服务器（通过将他们的浏览器指向您的域名）请求我们应用程序使用的IP地址。
- en: D.2 Settting up a certificate
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: D.2 设置证书
- en: Web security is an extensive topic and well beyond the scope of this book. We
    still want to be sure that we use HTTPS for all web traffic. The days of using
    plain HTTP are long gone, and it’s good to consider security best practices early
    on. In order to make it easy to manage certificate generation and renewal, we
    will use AWS Certificate Manager.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 网络安全是一个广泛的话题，远远超出了本书的范围。我们仍然想要确保我们为所有网络流量使用HTTPS。使用纯HTTP的日子已经一去不复返了，尽早考虑安全最佳实践是明智的。为了便于管理证书的生成和更新，我们将使用AWS证书管理器。
- en: D.2.1 Provisioning a new certificate
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: D.2.1 预配新证书
- en: In the AWS Console, click the link to Certificate Manager in the Networking
    section. This will bring you to the Certificate Manager dashboard, shown in figure
    D.2.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在AWS控制台中，在网络部分点击证书管理器的链接。这将带您到证书管理器仪表板，如图D.2所示。
- en: '![](../Images/APPD_F02_Elger.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/APPD_F02_Elger.png)'
- en: Figure D.2 The Certificate Manager introduction page
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 图D.2 证书管理器介绍页面
- en: Select Get Started under the Provision Certificates section, and choose the
    Request a Public Certificate option. The Request a Certificate page, shown in
    figure D.3, allows us to specify the domains for our certificate. We are going
    to request a wildcard certificate to use with all subdomains of our registered
    domains. For example, if we registered `stuff.org`, the wildcard certificate protects
    `api.stuff.org` and `www.stuff.org`.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在“提供证书”部分下选择“开始”，并选择“请求公共证书”选项。如图 D.3 所示的“请求证书”页面允许我们指定证书的域名。我们将请求一个通配符证书，用于我们注册域名的所有子域名。例如，如果我们注册了
    `stuff.org`，通配符证书将保护 `api.stuff.org` 和 `www.stuff.org`。
- en: Add `*.stuff.org` (the wildcard domain name) and `stuff.org`. Then, click Next
    to select the validation method. This will present a page similar to figure D.3.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 添加 `*.stuff.org`（通配符域名）和 `stuff.org`。然后，点击下一步以选择验证方法。这将显示类似于图 D.3 的页面。
- en: The AWS Console will request validation for the domains you have added to ensure
    you are the owner, as shown in figure D.4.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: AWS 控制台将要求验证您已添加的域名，以确保您是所有者，如图 D.4 所示。
- en: '![](../Images/APPD_F03_Elger.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/APPD_F03_Elger.png)'
- en: Figure D.3 Selecting domain names to protect with a certificate
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 图 D.3 选择要使用证书保护的域名
- en: '![](../Images/APPD_F04_Elger.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/APPD_F04_Elger.png)'
- en: Figure D.4 Choosing a validation method for your certificate
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 图 D.4 选择您的证书验证方法
- en: Choose DNS Validation and confirm this selection. Since we registered the domain
    with Route 53, we have the option to automatically create the special validation
    DNS entries in the hosted zone. Expand the section for each domain, shown in figure
    D.5.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 选择 DNS 验证并确认此选择。由于我们在 Route 53 中注册了域名，我们有自动在托管区域中创建特殊验证 DNS 条目的选项。展开如图 D.5 所示的每个域的章节。
- en: '![](../Images/APPD_F05_Elger.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/APPD_F05_Elger.png)'
- en: Figure D.5 Creating validation DNS records with Route 53
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图 D.5 使用 Route 53 创建验证 DNS 记录
- en: Click Create Record in Route 53\. Confirm this step for each domain before selecting
    Continue.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Route 53 中点击创建记录。在选择继续之前，为每个域名确认此步骤。
- en: You may need to wait up to 30 minutes before your domain has been validated
    and your certificate provisioning has completed. Once this is done, the Certificate
    Manager will show your certificate status as *Verified*, as shown in figure D.6.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能需要等待长达 30 分钟，直到您的域名验证完成并且证书配置完成。一旦完成，证书管理器将显示您的证书状态为 *已验证*，如图 D.6 所示。
- en: '![](../Images/APPD_F06_Elger.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/APPD_F06_Elger.png)'
- en: Figure D.6 A verified certificate shown in the Certificate Manager section of
    the AWS Console
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 图 D.6 在 AWS 控制台的证书管理部分显示的已验证证书
- en: This is excellent work! You have a registered domain and have created an associated
    SSL/TLS certificate to ensure traffic is encrypted. You will use this domain later
    to access your newly deployed application.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 这是非常棒的工作！您已注册了一个域名，并创建了一个相关的 SSL/TLS 证书以确保流量加密。您将稍后使用此域名来访问您新部署的应用程序。
